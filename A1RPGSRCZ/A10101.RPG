000100000000     H        1
000200000000      *****************************************************************
000300000000/*STD *  RPGBASE                                                      *
000400000000/*EXI *  TEXT('Midas SE Interest Consideration Calculation')          *
000500000000      *****************************************************************
000600000000      *                                                               *
000700000000      *  Midas - Securities Trading Module                            *
000800000000      *                                                               *
000900000000      *  A10101   - Utility for Interest & Consideration Calculation  *
001000000000      *                                                               *
001100210601      *  (c) Finastra International Limited 2021                      *
001200000000      *                                                               *
001300210601      *  Last Amend No. BA1007  *CREATE    Date 01Jun21               *
001400000000      *  Prev Amend No.                    Date ddmmmyy               *
001500000000      *                                                               *
001600000000      *---------------------------------------------------------------*
001700000000      *                                                               *
001800000000      *  BA1007 - Store EIR for SE Book Positions                     *
001900000000      *                                                               *
002000000000      *****************************************************************
002100000000      *                                                               *
002200000000     FSEDEV   IF  E           K        DISK
002300000000     FSECEO   IF  E           K        DISK
002400000000     F            SEDEVDF                           KRENAMESEDEVDO
002500000000     F            SNDEVDF                           KRENAMESNDEVDO
002600000000     E/COPY ZSRSRC,ZNCDZ1
002700000000     E/COPY ZSRSRC,ZDATE2Z1
002800000000     E/COPY ZSRSRC,ZPOWER8Z1
002900000000     E                    ZF29   14  32  5 0             29TH FEB ARRAY
003000000000     ISEDEVDF
003100000000     I              NMCY                            NMCYSD
003200000000     ISEDEVDO
003300000000     I              NMCY                            NMCYSD
003400000000     I/COPY ZSRSRC,ZYLDZ1
003500000000     ILDAX       UDS                            600
003600000000     I                                        1 107 ##SECD
003700000000     I                                        1   6 ##MATY
003800000000     I                                       11  22 ##CPNR
003900000000     I                                       31  31 ##DYBS
004000000000     I                                       32  32 ##DVBS
004100000000     I                                       33  33 ##STBS
004200000000     I                                       34  35 ##SYBS
004300000000     I                                       36  83 ##CD
004400000000     I                                       36  39 ##CD01
004500000000     I                                       40  43 ##CD02
004600000000     I                                       44  47 ##CD03
004700000000     I                                       48  51 ##CD04
004800000000     I                                       52  55 ##CD05
004900000000     I                                       56  59 ##CD06
005000000000     I                                       60  63 ##CD07
005100000000     I                                       64  67 ##CD08
005200000000     I                                       68  71 ##CD09
005300000000     I                                       72  75 ##CD10
005400000000     I                                       76  79 ##CD11
005500000000     I                                       80  83 ##CD12
005600000000     I                                       84  95 ##CR
005700000000     I                                       84  84 ##CR01
005800000000     I                                       85  85 ##CR02
005900000000     I                                       86  86 ##CR03
006000000000     I                                       87  87 ##CR04
006100000000     I                                       88  88 ##CR05
006200000000     I                                       89  89 ##CR06
006300000000     I                                       90  90 ##CR07
006400000000     I                                       91  91 ##CR08
006500000000     I                                       92  92 ##CR09
006600000000     I                                       93  93 ##CR10
006700000000     I                                       94  94 ##CR11
006800000000     I                                       95  95 ##CR12
006900000000     I                                       96 101 ##LCPN
007000000000     I                                      102 107 ##NCD
007100000000      *
007200000000     I                                      116 180 XECD
007300000000     I                                      116 1170CMFQ
007400000000     I                                      118 118 DSCB
007500000000     I                                      119 119 DSLC
007600000000     I                                      120 120 PROT
007700000000     I                                      121 123 NMCY
007800000000     I                                      124 1240CDP
007900000000     I                                      125 1250NMDP
008000000000     I                                    P 126 1280MATY
008100000000     I                                    P 129 1310LCPN
008200000000     I                                    P 132 1340NCD
008300000000     I                                    P 135 1370ISSD
008400000000     I                                    P 138 1400ITLD
008500000000     I                                    P 141 1430FCPN
008600000000     I                                    P 144 1497CPNR
008700000000     I                                    P 150 1559CFCT
008800000000     I                                    P 156 1630CPDP
008900000000     I                                    P 164 1710SFPP
009000000000     I                                    P 172 1730IADJ
009100000000     I                                    P 174 1760FNCD
009200000000     I                                      177 177 DYBS
009300000000     I                                      178 178 DVBS
009400000000     I                                      179 179 STBS
009500000000     I                                      180 181 SYBS
009600000000     I                                      182 182 SPBS
009700000000     I                                      183 183 PPDI
009800000000     I                                      201 248 CD
009900000000     I                                      201 248 CDDS
010000000000     I                                      201 2040CD01
010100000000     I                                      205 2080CD02
010200000000     I                                      209 2120CD03
010300000000     I                                      213 2160CD04
010400000000     I                                      217 2200CD05
010500000000     I                                      221 2240CD06
010600000000     I                                      225 2280CD07
010700000000     I                                      229 2320CD08
010800000000     I                                      233 2360CD09
010900000000     I                                      237 2400CD10
011000000000     I                                      241 2440CD11
011100000000     I                                      245 2480CD12
011200000000     I                                      249 260 CRDS
011300000000     I                                      249 260 CR
011400000000     I                                      249 249 CR01
011500000000     I                                      250 250 CR02
011600000000     I                                      251 251 CR03
011700000000     I                                      252 252 CR04
011800000000     I                                      253 253 CR05
011900000000     I                                      254 254 CR06
012000000000     I                                      255 255 CR07
012100000000     I                                      256 256 CR08
012200000000     I                                      257 257 CR09
012300000000     I                                      258 258 CR10
012400000000     I                                      259 259 CR11
012500000000     I                                      260 260 CR12
012600000000     I                                      261 2650IDAYS
012700000000     I                                      266 2700IDYYR
012800000000     I                                      271 280 SESN
012900000000      *
013000000000     I                                      281 403 ##TRDD
013100000000     I                                      281 292 ##NOML
013200000000     I                                      293 308 ##SYLP
013300000000     I                                      309 314 ##TDVD
013400000000     I                                      315 315 ##ACIN
013500000000     I                                      316 331 ##FYLP
013600000000     I                                      332 349 ##CONS
013700000000     I                                      350 367 ##DSPR
013800000000     I                                      368 385 ##INTR
013900000000     I                                      386 403 ##CVAL
014000000000     I                                      404 409 ##PUPP
014100000000      *
014200000000     I                                      410 4200NOML
014300000000     I                                      421 4358TPDY
014400000000     I                                      436 4400TDVD
014500000000     I                                      441 441 ACIN
014600000000     I                                      442 4568PRIC
014700000000     I                                      457 4710CONS
014800000000     I                                      472 4860DSPR
014900000000     I                                      487 5010INTR
015000000000     I                                      502 5160CVAL
015100000000     I                                      517 5214PUPP
015200000000      *
015300000000     I                                      522 522 YP
015400000000     I                                      523 523 LDAC
015500000000     C**********************************************************************
015600000000     C           *NAMVAR   DEFN           LDAX
015700000000     C           *LOCK     IN   LDAX
015800000000      *
015900000000     C                     MOVE '0'       *IN98
016000000000     C                     Z-ADDCDP       ZCDP
016100000000     C                     Z-ADDCDP       NCDP
016200000000      *
016300000000      ** Interest Calculation
016400000000      *
016500000000     C                     EXSR INTCAL
016600000000      *
016700000000      ** Consideration calculation
016800000000      *
016900000000     C                     EXSR CONCAL
017000000000      *
017100000000      ** Countervalue
017200000000      *
017300000000     C           CONS      ADD  INTR      CVAL
017400000000      *
017500000000      **  Terminate program
017600000000     C                     OUT  LDAX
017700000000     C                     RETRN
017800000000     C**********************************************************************
017900000000     C           INTCAL    BEGSR
018000000000      *
018100000000      ** Determine the next coupon date after (or on) the trade value date
018200000000      *
018300000000     C           TDVD      ADD  1         ECD     50
018400000000     C                     EXSR ZNCD
018500000000     C                     Z-ADDNCD       FNCD
018600000000      *
018700000000     C                     Z-ADDTDVD      ECD
018800000000     C                     EXSR ZNCD
018900000000      *
019000000000      ** Set the accrual Indicator
019100000000      *
019200000000     C           TDVD      IFEQ NCD
019300000000     C                     MOVEL'F'       ACIN
019400000000     C                     ELSE
019500000000     C           ACIN      IFNE 'X'
019600000000     C                     MOVEL'C'       ACIN
019700000000     C                     END
019800000000     C                     END
019900000000      *
020000000000      ** Determine the last coupon date (prior to the next coupon date)
020100000000      *
020200000000     C           ACIN      IFEQ 'F'
020300000000     C           LDAC      ANDNE'Y'
020400000000     C                     Z-ADDTDVD      ZZLCD
020500000000     C                     ELSE
020600000000     C           NCD       SUB  1         ZECD
020700000000     C                     EXSR ZLCD
020800000000     C                     END
020900000000      *
021000000000      ** If no security details present
021100000000      *
021200000000     C           ITLD      IFEQ 0
021300000000     C                     Z-ADDZZLCD     ISSD
021400000000     C                     Z-ADDZZLCD     ITLD
021500000000     C                     Z-ADDZZLCD     FCPN
021600000000     C                     END
021700000000      *
021800000000      ** Last coupon date
021900000000      *
022000000000     C                     Z-ADDZZLCD     LCPN
022100000000      *
022200000000      ** Calculate the interest
022300000000      *
022400000000     C                     Z-ADDNOML      ZAMT             * nominal
022500000000     C           ACIN      IFEQ 'X'
022600000000     C                     Z-ADDTDVD      ZDCSDT           * start date
022700000000     C                     Z-ADDNCD       ZDCEDT           * end date
022800000000     C                     ELSE
022900000000     C                     Z-ADDZZLCD     ZDCSDT           * start date
023000000000     C                     Z-ADDTDVD      ZDCEDT           * end date
023100000000     C                     END
023200000000      *
023300000000     C                     EXSR ZACCZ
023400000000     C                     Z-ADDZDCINT    INTR
023500000000     C           PPDI      IFNE 'Y'
023600000000     C           PUPP      ANDNE*ZERO
023700000000     C                     MULT PUPP      INTR      H
023800000000     C                     END
023900000000      *
024000000000     C                     Z-ADDZDDAYS    IDAYS
024100000000     C                     Z-ADDZINTDD    IDYYR
024200000000      *
024300000000      ** Reverse sign if ex-coupon
024400000000      *
024500000000     C           ACIN      IFEQ 'X'
024600000000     C                     Z-SUBINTR      INTR
024700000000     C                     END
024800000000     C                     ENDSR
024900000000      *****************************************************************
025000000000     C           CONCAL    BEGSR
025100000000      *
025200000000      * SET NOMINAL & CUM/EX-COUPON INDICATOR
025300000000      *
025400000000     C                     Z-ADDNOML      ZNOML
025500000000     C                     MOVELACIN      SCUMEX
025600000000      *
025700000000      * Make interest figure a percentage
025800000000      *
025900000000     C           ZNOML     IFNE 0
026000000000     C           ZDCINT    DIV  ZNOML     WRKPI
026100000000     C                     ELSE
026200000000     C                     Z-ADD0         WRKPI
026300000000     C                     END
026400000000      *
026500000000     C           ACIN      IFEQ 'F'
026600000000     C                     Z-ADD0         WRKPI
026700000000     C                     END
026800000000      *
026900000000     C           ACIN      IFEQ 'X'
027000000000     C                     Z-SUBWRKPI     WRKPI
027100000000     C                     END
027200000000      *
027300000000      * Convert price to yield, or yield to price
027400000000      *
027500000000     C                     Z-ADDTDVD      ZFDATE           * value date
027600000000     C           YP        IFEQ 'Y'
027700000000     C                     Z-ADDPRIC      ZPRICE 158       % Price > Yield
027800000000     C           PUPP      IFNE *ZERO
027900000000     C                     DIV  PUPP      ZPRICE    H
028000000000     C                     END
028100000000     C                     EXSR ZPRCO
028200000000     C                     Z-ADDZPRCOT    TPDY
028300000000     C                     ELSE
028400000000     C                     Z-ADDTPDY      ZPRCIN 158       Yield > % Price
028500000000     C                     EXSR ZPRCI
028600000000     C                     Z-ADDZPRCOT    PRIC
028700000000     C           PUPP      IFNE *ZERO
028800000000     C                     MULT PUPP      PRIC      H
028900000000     C                     END
029000000000     C                     END
029100000000      * Consideration
029200000000     C                     Z-ADDPRIC      ZPRC
029300000000     C                     EXSR ZCNSD
029400000000     C                     Z-ADDZCONS     CONS
029500000000      *
029600000000      * Discount/premium = Face value - consideration
029700000000     C                     Z-ADD100       ZPRC
029800000000     C           PUPP      IFNE *ZERO
029900000000     C                     MULT PUPP      ZPRC
030000000000     C                     END
030100000000     C                     EXSR ZCNSD
030200000000     C           ZCONS     SUB  CONS      DSPR
030300000000      *
030400000000     C                     ENDSR
030500000000      *****************************************************************
030600000000     C/SPACE 5
030700000000     C/COPY ZSRSRC,ZCNSDZ1
030800000000     C/SPACE 5
030900000000     C/COPY ZSRSRC,ZACCZZ1
031000000000     C/SPACE 5
031100000000     C/COPY ZSRSRC,ZACCRZ1
031200000000     C/SPACE 5
031300000000     C/COPY ZSRSRC,ZDAYSZ2
031400000000     C/SPACE 5
031500000000     C/COPY ZSRSRC,ZNCDZ3
031600000000     C/SPACE 5
031700000000     C/COPY ZSRSRC,ZDYYRZ3
031800000000     C/SPACE 5
031900000000     C/COPY ZSRSRC,ZDATE1Z2
032000000000     C/SPACE 5
032100000000     C/COPY ZSRSRC,ZDATE2Z2
032200000000     C/SPACE 5
032300000000     C/COPY ZSRSRC,ZLCDZ1
032400000000     C/SPACE 5
032500000000     C/COPY ZSRSRC,ZRATEZ1
032600000000     C/SPACE 5
032700000000     C/COPY ZSRSRC,ZPRCOZ1
032800000000     C/SPACE 5
032900000000     C/COPY ZSRSRC,ZPRCIZ1
033000000000     C/SPACE 5
033100000000     C/COPY ZSRSRC,ZYLDOZ1
033200000000     C/SPACE 5
033300000000     C/COPY ZSRSRC,ZYLDIZ1
033400000000     C/SPACE 5
033500000000     C/COPY ZSRSRC,ZYLDZ2
033600000000     C/SPACE 5
033700000000     C/COPY ZSRSRC,ZCALCD
033800000000**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0339000000000366073110961461
034000000000**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
034100000000000031059090120151181212243273304334365
034200000000**   ZMNM - MONTHS SHORT NAMES
034300000000JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
034400000000**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
03450000000000000001
03460000000000000010
03470000000000000100
03480000000000001000
03490000000000010000
03500000000000100000
03510000000001000000
03520000000010000000
035300000000**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0354000000000006001521029820444305904073650882610287117481320914670161311759219053
0355000000002051421975234362489726358278192928030741322023366335124365853804639507
03560000000040968424294389045351
