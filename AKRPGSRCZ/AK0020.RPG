     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AK Dealing account keys generation')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Account Key Generator                                *
     F*                                                               *
     F*  AK0020 - Account Key Generation - Dealing                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR983834           Date 15Nov23               *     
      *  Prev Amend No. MD058769           Date 21Sep21               *
      *                 MD054576           Date 14Oct19               *
      *                 MD053762           Date 16Jun19               *
      *                 CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL165             Date 23Feb15               *
      *                 MD031566           Date 13Feb15               *
      *                 MD027308B          Date 25Nov14               *
      *                 MD027308A          Date 15Jul14               *
      *                 MD027417           Date 13Jun14               *
      *                 MD027308           Date 10Jun14               *
      *                 AR1071025          Date 16Jan13               *
      *                 CLE134             Date 01Aug12               *
      *                 AR738954           Date 30Mar11               *
      *                 260980             Date 13Jul09               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26326           Date 12Oct09               *
      *                 BUG25379           Date 07Aug09               *
      *                 BUG23884A          Date 08Jul09               *
      *                 BUG23884           Date 10Jun09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23692A          Date 29Apr09               *
      *                 BUG23114           Date 26Feb09               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 245915             Date 22Feb07               *
      *                 239089             Date 15Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 240339             Date 29Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG10281           Date 01Feb06               *
      *                 234421             Date 05Jul05               *
      *                 233565             Date 18May05               *
      *                 233317             Date 02May05               *
      *                 CGL031             Date 05Jul04               *
      *                 CAS011             Date 16May05               *
      *                 CAS009             Date 04May04               *
      *                 CDL038             Date 10May05               *
      *                 BUG6077            Date 07Mar05               *
      *                 CAS010             Date 09Feb05               *
      *                 CAS007             Date 26Apr04               *
      *                 226093             Date 01Apr04               *
      *                 TDA009             Date 19Mar04               *
      *                 CDL017             Date 18Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS005             Date 16Dec02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187633             Date 10Jan01               *
      *                 184889             Date 08Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 183287             Date 08Nov00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 144503             DATE 14Oct99               *
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CTI002 Exposure Management / TI Interface     *
     F*                 CEU015             Date 19Jun98               *
     F*                 120834             Date 14Jul97               *
     F*                 S01408             DATE 04SEP96               *
     F*                 105599             Date 09JUL96               *
     F*                 CAC001             Date 01FEB96               *
     F*                 S01408             Date 28NOV95               *
     F*                 S01408             Date 13APR95               *
     F*                 080603             DATE 10MAR95               *
     F*                 078809             DATE 10NOV94               *
     F*                 067842             DATE 25OCT94               *
     F*                 S01408             DATE 21OCT94               *
     F*                 062855             DATE 14FEB94               *
     F*                 047369             DATE 10JAN94               *
     F*                 S01440             DATE 02SEP93               *
     F*                 S01460             DATE 10DEC93               *
     F*                 S01434             DATE 01SEP93               *
     F*                 S01354             DATE 20JAN92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR983834 - When generating account keys for Deals, the       *
      *             Webfacing screen hangs then becomes blank.        *
      *             Add ELSE clause to exit loop. (Child: AR983835).  *     
      *  MD058769 - Deliverable Data Split for SDNARRPD and TABLETP   *
      *  MD054576 - Account keys not displayed in DKEYSDP report      *
      *             (DL0280) and GEDLPD (DL0295) after Day 1 COBDL    *
      *  MD053762 - Tiered Witholding Tax System Values               *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL165 - Dual Withholding Tax                                *
      *  MD031566 - MISSING TIME DEPOSIT CAPITAL INT. ACKEYS          *
      *             TDIyy___UCcccc, TDIyy___UEcccc & TDIyy___SEcccc   *
      *           - mentioned ackeys should be available for CD & TD  *
      *             and DT & FT when CDL006 is on.                    *
      *  MD027308B - Missing Balance Change A/C Keys xxVyybbbIAcccc   *
      *              and xxMyybbbDAcccc for MM Fixed Deposit/Loan     *
      *            - Correct narratives for IP,IT,TD,TI.              *
      *  MD027308A - Missing Balance Change A/C Keys xxVyybbbIAcccc   *
      *              and xxMyybbbDAcccc for MM Fixed Deposit/Loan     *
      *            - Also include deal types TD and TI                *
      *  MD027417 - Missing Account key in DL0295P2 for Rollover not  *
      *             relevant. Allow xxRyybbbbIcccc account key for    *
      *             for deal type CD/CL only when S01434 is on.       *
      *  MD027308 - Missing Balance Change A/C Keys xxVyybbbIAcccc    *
      *             and xxMyybbbDAcccc for MM Fixed Deposit/Loan      *
      *           - Only allow Principal Increase/Decrease when SVAL  *
      *             AllowPIPDfotITIPD is equal to Y.                  *
      *  AR1071025 - Erroneous field will only highlight after the    *
      *              second enter (Recompile)                         *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  AR738954 - Account key generator hangs (Child: AR738955)     *
      *  260980 - Display fields in introduced by CDL017.             *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26326 - Apply fix of GF1 bug Bug25943/A. This will fix    *
      *             the Taxes errors of GF2 bugs, as follows:         *
      *               - 26326    - 26329    - 26397                   *
      *               - 26328    - 26331                              *
      *  BUG25379 - 3rd tax missing in Acct Movements Enq for rolled  *
      *             over deal                                         *
      *   BUG23884A - Tax deduction on MM Deals shows customer name   *
      *               as narrative                                    *
      *   BUG23884 - Tax deduction on MM Deals shows customer name    *
      *              as narrative                                     *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23692A - Possible incorrect posting on key TDMGE B        *
      *  BUG23114 - Account code of secondary tax account keys should *
      *             be from secondary tax account code as defined on  *
      *             on the country of tax maintenance                 *
      *  CER048 - German Features - Taxes                             *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (recompiled)                                        *
      *  245915 - Made Transfer Keys generated switchable with CDL039 *
      *  239089 - Incorrect Base Currency Equivalent A/C keys genera- *
      *           ted for FX deals when Spot Trade Equivalent A/C     *
      *           code of the base currency is blank.                 *
      *  240339 - Add deal type CF for CDL033.                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
     F*  BUG10281 - Transfer keys to be generated (CDL039)            *
      *  234421 - xxMyy___UR and xxMyy___UV keys missing at rollover  *
      *           date                                                *
      *  233565 - Account key problems.                               *
      *  233317 - Missing account key                                 *
      *  CGL031 - Taxation of Savings Income                          *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CDL038 - Extended Deal Sub Type                              *
      *  BUG6077 - Strange field on Account Key Generator (Recompile) *
      *  CAS010 - IAS + PB Enhancements Upgrade to MidasPlus          *
      *           (Recompile)                                         *
      *  CAS007 - Hedge Accounting Control                            *
      *  226093 - Add UP and UL account key for FX deals.             *
      *  TDA009 - Recompiled due to changes in AK0020DF.              *
      *  CDL017 - Penalty Fees and Early Maturity of Fixed Term Deals *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CAS004 - Hedge Accounting Phase A                            *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
     F*  187633 - If deal type is nostro transfer, do not need to     *
     F*           check deal type/subtype combination exists.         *
      *  184889 - Invalid validation when all account code input are  *
      *           non-title account code.                             *
      *  183287 - Incorrect message output - created new message      *
      *           USR4600 instead of USD4272 which has nothing to do  *
      *           with this.                                          *
     F*  144503 - Duplicate keys generated for key XXDYYCCY_S on FP   *
     F*           deals due to a missing ELSE on the IF statement.    *
     F*           Applied fix 136691.                                 *
      *  CDL006 - Dealing Fiduciary.                                  *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  CEU015 - EMU Enhanced MM Deal Rollover:                      *
     F*           Generate two new account keys:                      *
     F*             o __R____XA - Maturing Principal                  *
     F*             o __V____XR - Rollover Amount                     *
     F*  120834 - Generate FX Margin keys only for FP,FS and CX       *
     F*  S01408 - Addition of hook AK0020CCP4                         *
     F*           Addition of hook AK0020CCP3                         *
     F*  105599 - Internal Deposit deal should be a Liability.        *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Generation of new account codes if Analytical Acctg *
     F*           is installed.                                       *
     F*  S01408 - Addition of hook AK0020C001                         *
     F*           Addition of hook AK0020F001                         *
     F*  S01408 - Addition of hook AK0020CBD4                         *
     F*           Addition of hook AK0020CBD5                         *
     F*  080603 - Enhanced Rollover Rework                            *
     F*           Remove fix 062855                                   *
     F*           Withholding Tax keys generated if BRT is ON         *
     F*           Remove xxIyy...TC key generation                    *
     F*           Amend  xxIyy....T, and xxMyy....T keys              *
     F*           Amend  xxIyy....I, and xxMyy....I keys              *
     F*           Amend  xxIyy...TI, and xxMyy...TI keys              *
     F*           Removed Check for Narrative 31 - Principal Diff     *
     F*           Added Check for Deal type/subtype Combination       *
     F*           Accounting for Hong Kong Tax Added                  *
     F*  078809 - Remove redundant narrative code '28' and replace    *
     F*           with '13' for Swop Profit and '15' for Swop Loss.   *
     F*           Also, check for all required DL narrative codes     *
     F*           and do not check for LE narrative codes.            *
     F*  067842 - Interest capitalisation keys are now generated only *
     F*           for deal types CL and CD.                           *
     F*  S01408 - Addition of hook AK0020IIPG                         *
     F*           Addition of hook AK0020GDTA                         *
     F*           Addition of hook AK0020CCP1                         *
     F*           Addition of hook AK0020CCP2                         *
     F*           Addition of hook AK0020CCBU                         *
     F*           Addition of hook AK0020CBDU                         *
     F*           Addition of hook AK0020CBD1                         *
     F*           Addition of hook AK0020CBD2                         *
     F*           Addition of hook AK0020CBD3                         *
     F*  062855 - For deal types IP and IT on Rollover (Value Date),  *
     F*           the DR and CR entries of contingent A/C should not  *
     F*           be generated for rollover on value date.            *
     F*         - For deal type IT on deal date, the DR and CR entries*
     F*           of contingent A/C are on the reverse side.          *
     F*  047369 - NARRATIVE CODES SHOULD BE ALPHA AND NOT NUMERIC.    *
     F*           RECOMPILE OVER AMENDED FILE ZACKEYAL.               *
     F*  S01440 - Accrual date account keys generated for deal types  *
     F*           SI and PI.                                          *
     F*  S01460 - To allow the Withholding Tax A/C keys to be         *
     F*           produced.                                           *
     F*  S01434 - Rollover Enhancement                                *
     F*  S01354 - Internal Funding Deals                              *
     F*                                                               *
     F*****************************************************************
     FAK0020DFCF  E                    WORKSTN
     FSDCURRL1IF  E           K        DISK
     FZACKEYALO   E                    DISK                      A
     F*SDNARRL1IF  E           K        DISK                                                MD058769
     FSDDLSTL1IF  E           K        DISK
     FFDDTSTL1IF  E           K        DISK                               080603
     FSDBRTDL1IF  E           K        DISK                               080603
     FSDACODL0IF  E           K        DISK
     FSDBOOKL1IF  E           K        DISK                                                   CAS004
     FSDFEEL1 IF  E           K        DISK                                                   CAS009
     FSDCTTXL2IF  E           K        DISK                                                   CGL031
      ** Midas SD Country of Tax Codes by Country of Residence                                CGL031
      *                                                                                       CGL031
     F/COPY WNCPYSRC,AK0020F001                                           S01408
     F********************************************************************
     F* ID F  C  H  L   FUNCTION OF INDICATORS
     F*
     F* 01 Hold Nostro Transfer screen until ENTER pressed
     F* 02 Deal Type TI entered (Money Market screen)
     F* 03 Exit requested (F3 pressed)
     F* 04 End of file - SDCURRPD
     F* 05 F4PREF invalid (Money Market screen)
     F* 06 Deal Type FP,FS,CX entered (FX screen)                         120834
     F* 07 Keys generated successfully, exit program
     F* 08 F1PREF invalid (Foreign Exchange screen)
     F* 09 F2PREF invalid (Foreign Exchange screen)
     F* 10 Chain to SDACODL0 for Account Code from an ICD failed
     F* 11 Chain to SDNARRL1 for Required Narrative failed
     F* 12 Initial screen requested (F12 pressed from second screen)
     F* 13 F4PREF invalid (Foreign Exchange screen)
     F* 14 F6PREF invalid (Foreign Exchange screen)
     F* 15 F2PREF invalid (Negotiable Assets screen)
     F* 16 Deal Type IP (Money Market screen)
     F* 17 Deal Type FP,FS,CX,PI,SI,OP entered (FX screen)
     F* 18 Deal Type TD entered (Money Market screen)
     F**19  eal*Type*CL*entered*(Money*Market*screen)                     S01354
     F* 19 Deal Type CL or IL entered (Money Market screen)               S01354
     F**20*Deal*Type*CD*entered*(Money*Market*screen)                     S01354
     F* 20 Deal Type CD or ID entered (Money Market screen)               S01354
     F* 21 Field F1 entered
     F* 22 Field F2 entered
     F* 23 Field F3 entered
     F* 24 Field F4 entered
     F* 25 Field F5 entered
     F* 26 F4PREF invalid (Negotiable Assets screen)
     F* 27 F6PREF invalid (Negotiable Assets screen)
     F**28*F2PREF*invalid*(Money*Market*screen)************************   CAC001
     F* 28 SFFXC Forward FX Margin Contra invalid (Foreign Exchange)      CAC001
     F* 30 Deal Type SW entered (Foreign Exchange screen)
     F* 31 Deal Type C1 entered (Negotiable Assets screen)
     F* 32 Deal Type C2,BD,BP entered (Negotiable Assets screen)
     F* 33 Deal Type TB, TA, DA entered (Negotiable Assets screen)
     F* 34 Deal Type CI entered (Money Market screen)
     F* 35 F6 entered (Negotiable Assets)
     F* 36 Liability
     F* 37 Set up Debit A/c Code 1 for Key XXVYYCCY.P (FX screen)
     F* 38 Set up Credit A/c Code 1 for Key XXVYYCCY.S (FX screen)
     F* 39 Deal Type IT (Money Market screen)
     F* 40 F2PREF entered
     F* 41 Error occurred in initial screen
     F* 42 F4PREF entered
     F* 43 F6PREF entered (Negotiable Assets)
     F* 44 F1PREF entered (Foreign Exchange)
     F* 45 Key XXDYYCCY.P to be generated
     F* 46 Key XXDYYCCY.S to be generated
     F* 47 F7 entered (Negotiable Assets)
     F* 48 Analytical Accounting is installed                             CAC001
     F* 49 Error in Forward FX Margin                                     CAC001
     F* 50 Invalid Deal Type
     F* 51 Invalid Sub Type
     F* 52 Field F1 invalid
     F* 53 Field F2 invalid
     F* 54 Field F3 invalid
     F* 55 Field F4 invalid
     F* 56 Field F5 invalid
     F* 57 Field F6 invalid
     F* 58 Field F7 invalid
     F* 59 Field F8 invalid
     F* 60 Field F9 invalid
     F* 61 Field F10 invalid                                              080603
     F* 61 Field OP1 invalid
     F* 62 Field F11 invalid                                              080603
     F* 62 Foreign Exchange screen in error
     F* 63 Money Market screen in error
     F* 64 Negotiable Assets screen in error
     F* 65 Error in FX Margin Income Account                              CAC001
     F* 66 Error in Internal Loan Account                                 CAC001
     F* 67 Error in Internal Deposit Account                              CAC001
     F* 68 Error in COF Expense Account                                   CAC001
     F* 69 Up Front Interest Deal Sub-type                                S01460
     F* 70 Witholding Tax is Switchable Ind                               S01460
     F* 71 Witholding Tax account requiredd                               080603
     F* 71 Purchase Accrual Account invalid                               S01440
     F* 72 Purchase Income Account invalid                                S01440
     F* 73 Sale Accrual Account invalid                                   S01440
     F* 74 Sale Expense Account invalid                                   S01440
     F* 75 Purchase Accrual Account entered                               S01440
     F* 76 Purchase Income Account entered                                S01440
     F* 77 Sale Accrual Account entered                                   S01440
     F* 78 Sale Expense Account entered                                   S01440
     F* 79 Error in Accrued COF Payable Account                           CAC001
     F* 80 Foreign Exchange Deal Type entered
     F* 81 Money Market Deal Type entered
     F* 82 Negotiable Assets Deal Type entered
     F* 83 Nostro Transfer Deal Type entered
     F* 84 Error in COF Income Account                                    CAC001
     F* 85 Error in Accrued COF Receivable Account                        CAC001
      * 86 Effective Fair Value Hedge Profit Contra Account          *                        CAS004
      *    Ineffective Fair Value Hedge Profit Contra Account        *                        CAS004
      * 87 Posting Reference 1 or 3                                  *                        CAS004
      * 88 Other Income Account                                      *                        CAS004
      *    Trading Profit Account                                    *                        CAS004
      * 89 Effective Fair Value Hedge Loss Contra Account            *                        CAS004
      *    Ineffective Fair Value Hedge Loss Contra Account          *                        CAS004
      * 90 Posting Reference 1 or 3                                  *                        CAS004
      * 91 Other Expense Account                                     *                        CAS004
      *    Trading Loss Account                                      *                        CAS004
      * 92 Effective Cash Flow Hedge Profit Contra Account           *                        CAS004
      *    Ineffective Cash Flow Hedge Profit Contra Account         *                        CAS004
      * 93 Posting Reference 1 or 3                                  *                        CAS004
      * 94 Other Comprehensive Income Account                        *                        CAS004
      *    Trading Profit Account                                    *                        CAS004
      * 95 Effective Cash Flow Hedge Loss Contra Account             *                        CAS004
      *    Ineffective Cash Flow Hedge Loss Contra Account           *                        CAS004
      * 96 Posting Reference 1 or 3                                  *                        CAS004
      * 97 Other Comprehensive Income Account                        *                        CAS004
      *    Trading Loss Account                                      *                        CAS004
     F* U4 Not all Narrative Codes set up - terminate program
     F* U8 Database error - terminate program
     F********************************************************************
     E                    CCYA      200  3               Dealing Currencies
     E**********          TAC       200  4 0             Spot Trade Equiv Ac                  CGL029
     E                    TAC       200 10 0                                                  CGL029
     E                    PN         16  2               Missing Narrative080603
     E********************PN         15  2               Missing Na078809 080603
     E********************PN          8  2               Missing Narrative078809
     E                    TABFX   7   7  2               Forex Types Types
     E************        TABMM   9   9  2               Money Mkt Types  S01354
     E***********         TABMM  11  11  2               Money Mkt S01354 CDL006
     E                    TABMM  17  17  2               Money Mkt Types  CDL006
     E                    TABNA   1   7  2   TABSA   2   NA's Types
     E                    TABNO   1   1  2               Nostro Types
     E                    NR     16  16  2               Reqd. Narratives 080603
     E************        NR     15  15  2               Reqd. Narr078809 080603
     E********************NR      8   8  2               Reqd. Narratives 078809
     E                    CPY@    1   1 80               Copyright Array
     E                    WLFC        5  2                                                    CAS009
     E**********          WLIA        5  4                                             CAS009 CAS011
     E**********          WLMA        5  4                                             CAS009 CAS011
     E**********          WLAA        5  4                                             CAS009 CAS011
     E                    WLIA        5 10                                                    CAS011
     E                    WLMA        5 10                                                    CAS011
     E                    WLAA        5 10                                                    CAS011
     E                    WLPR        5  1                                                    CAS009
     E                    WNFC        5  2                                                    CAS009
     E**********          WNIA        5  4                                             CAS009 CAS011
     E**********          WNMA        5  4                                             CAS009 CAS011
     E                    WNIA        5 10                                                    CAS011
     E                    WNMA        5 10                                                    CAS011
     E                    WNPR        5  1                                                    CAS009
     E                    WTCA       10  2                                                    CGL031
      ** Withholding Tax Countries Array                                                      CGL031
      *                                                                                       CGL031
     E********************************************************************
     I**   Data Structures
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I** Data Structure for Compilation  - Copyright Insertion
     I*
     IPSDS       SDS
     I                                      244 253 WSID
     I                                      254 263 USRID
     I** Data Structure to retrieve User and Workstation ID.
     I*
     IRUNDAT      DS                             13
     I                                        1   7 RUNA
     I** Rundate Data Area
     I*
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I** Local Data Area
     I*
     ISDACOD    E DSSDACODPD                                                                  CAS001
      ** Trading Details                                                                      CAS001
      *                                                                                       CAS001
     IDSFDY     E DSDSFDY
     I** First DS for Access Programs, Short Data Structure
     I*
     IDSSDY     E DSDSSDY                                                 CDL006
      ** Second DS for access programs, Long Date Structure               CDL006
      *                                                                   CDL006
     ISDBANK    E DSSDBANKPD
     I** Bank Details
     I*
     ISDGELR    E DSSDGELRPD
     I** General Ledger Details
     I              QQACCD                          QQACC1                                    CGL029
     I*
     ISDTRAD    E DSSDTRADPD
     I** Trading Data Details
     I              QQACCD                          QQACC2                                    CGL029
     I*
     ISDDEAL    E DSSDDEALPD
     I** Dealing Data Details
     I              QQACCD                          QQACC3                                    CGL029
     I*
     ISDMMOD    E DSSDMMODPD                                              CAC001
     I** MIDAS Modules                                                    CAC001
     I*                                                                   CAC001
     I/COPY WNCPYSRC,AK0020IIPG                                           S01408
     I/COPY QWINDSRC,AK0020GDTA                                           S01408
     I*
     IDLAKEY      DS
     I                                        1  10 DLKEY
     I                                        1   2 DTYPD
     I                                        3   3 EVENTD
     I                                        4   5 STYPD
     I                                        6   6 PRFCD                 CAC001
     I                                        6   7 BB1                                       CAS009
     I                                        6   8 CYD
     I                                        7   9 BB2                                       CAS009
     I                                        8   9 FEECD                                     CAS009
     I                                        8   8 GRS                                     MD053762
     I                                        9   9 FBD
     I                                       10  10 AMTD
     I                                       11  14 CLASD                                     CDL038
      *************
     I**********                             11  52 FMKEYS                                    CGL029
     I**********                             11  14 AC1                                       CGL029
     I**********                             15  18 AC2                                       CGL029
     I**********                             19  22 AC3                                       CGL029
     I**********                             23  26 AC4                                       CGL029
     I**********                             27  30 AC5                                       CGL029
     I**********                             31  34 AC6                                       CGL029
     I**********                             35  36 PN1                                       CGL029
     I**********                             37  38 PN2                                       CGL029
     I**********                             39  40 PN3                                       CGL029
     I**********                             41  42 PN4                                       CGL029
     I**********                             43  44 PN5                                       CGL029
     I**********                             45  46 PN6                                       CGL029
     I**********                             47  47 PR1                                       CGL029
     I**********                             48  48 PR2                                       CGL029
     I**********                             49  49 PR3                                       CGL029
     I**********                             50  50 PR4                                       CGL029
     I**********                             51  51 PR5                                       CGL029
     I**********                             52  52 PR6                                       CGL029
     I                                       11  88 FMKEYS                                    CGL029
     I                                       11  20 AC1                                       CGL029
     I                                       21  30 AC2                                       CGL029
     I                                       31  40 AC3                                       CGL029
     I                                       41  50 AC4                                       CGL029
     I                                       51  60 AC5                                       CGL029
     I                                       61  70 AC6                                       CGL029
     I                                       71  72 PN1                                       CGL029
     I                                       73  74 PN2                                       CGL029
     I                                       75  76 PN3                                       CGL029
     I                                       77  78 PN4                                       CGL029
     I                                       79  80 PN5                                       CGL029
     I                                       81  82 PN6                                       CGL029
     I                                       83  83 PR1                                       CGL029
     I                                       84  84 PR2                                       CGL029
     I                                       85  85 PR3                                       CGL029
     I                                       86  86 PR4                                       CGL029
     I                                       87  87 PR5                                       CGL029
     I                                       88  88 PR6                                       CGL029
     ILFC         DS                                                                          CAS009
     I                                        1   2 LFC1                                      CAS009
     I                                        3   4 LFC2                                      CAS009
     I                                        5   6 LFC3                                      CAS009
     I                                        7   8 LFC4                                      CAS009
     I                                        9  10 LFC5                                      CAS009
     ILIA         DS                                                                          CAS009
     I**********                              1   4 LIA1                               CAS009 CAS011
     I**********                              5   8 LIA2                               CAS009 CAS011
     I**********                              9  12 LIA3                               CAS009 CAS011
     I**********                             13  16 LIA4                               CAS009 CAS011
     I**********                             17  20 LIA5                               CAS009 CAS011
     I                                        1  10 LIA1                                      CAS011
     I                                       11  20 LIA2                                      CAS011
     I                                       21  30 LIA3                                      CAS011
     I                                       31  40 LIA4                                      CAS011
     I                                       41  50 LIA5                                      CAS011
     ILMA         DS                                                                          CAS009
     I**********                              1   4 LMA1                               CAS009 CAS011
     I**********                              5   8 LMA2                               CAS009 CAS011
     I**********                              9  12 LMA3                               CAS009 CAS011
     I**********                             13  16 LMA4                               CAS009 CAS011
     I**********                             17  20 LMA5                               CAS009 CAS011
     I                                        1  10 LMA1                                      CAS011
     I                                       11  20 LMA2                                      CAS011
     I                                       21  30 LMA3                                      CAS011
     I                                       31  40 LMA4                                      CAS011
     I                                       41  50 LMA5                                      CAS011
     ILAA         DS                                                                          CAS009
     I**********                              1   4 LAA1                               CAS009 CAS011
     I**********                              5   8 LAA2                               CAS009 CAS011
     I**********                              9  12 LAA3                               CAS009 CAS011
     I**********                             13  16 LAA4                               CAS009 CAS011
     I**********                             17  20 LAA5                               CAS009 CAS011
     I                                        1  10 LAA1                                      CAS011
     I                                       11  20 LAA2                                      CAS011
     I                                       21  30 LAA3                                      CAS011
     I                                       31  40 LAA4                                      CAS011
     I                                       41  50 LAA5                                      CAS011
     ILPR         DS                                                                          CAS009
     I                                        1   1 LPR1                                      CAS009
     I                                        2   2 LPR2                                      CAS009
     I                                        3   3 LPR3                                      CAS009
     I                                        4   4 LPR4                                      CAS009
     I                                        5   5 LPR5                                      CAS009
     INFC         DS                                                                          CAS009
     I                                        1   2 NFC1                                      CAS009
     I                                        3   4 NFC2                                      CAS009
     I                                        5   6 NFC3                                      CAS009
     I                                        7   8 NFC4                                      CAS009
     I                                        9  10 NFC5                                      CAS009
     INIA         DS                                                                          CAS009
     I**********                              1   4 NIA1                               CAS009 CAS011
     I**********                              5   8 NIA2                               CAS009 CAS011
     I**********                              9  12 NIA3                               CAS009 CAS011
     I**********                             13  16 NIA4                               CAS009 CAS011
     I**********                             17  20 NIA5                               CAS009 CAS011
     I                                        1  10 NIA1                                      CAS011
     I                                       11  20 NIA2                                      CAS011
     I                                       21  30 NIA3                                      CAS011
     I                                       31  40 NIA4                                      CAS011
     I                                       41  50 NIA5                                      CAS011
     INMA         DS                                                                          CAS009
     I**********                              1   4 NMA1                               CAS009 CAS011
     I**********                              5   8 NMA2                               CAS009 CAS011
     I**********                              9  12 NMA3                               CAS009 CAS011
     I**********                             13  16 NMA4                               CAS009 CAS011
     I**********                             17  20 NMA5                               CAS009 CAS011
     I                                        1  10 NMA1                                      CAS011
     I                                       11  20 NMA2                                      CAS011
     I                                       21  30 NMA3                                      CAS011
     I                                       31  40 NMA4                                      CAS011
     I                                       41  50 NMA5                                      CAS011
     INPR         DS                                                                          CAS009
     I                                        1   1 NPR1                                      CAS009
     I                                        2   2 NPR2                                      CAS009
     I                                        3   3 NPR3                                      CAS009
     I                                        4   4 NPR4                                      CAS009
     I                                        5   5 NPR5                                      CAS009
     ISWTC        DS                                                                          CGL031
     I                                        1   2 SWTC1                                     CGL031
     I                                        3   4 SWTC2                                     CGL031
     I                                        5   6 SWTC3                                     CGL031
     I                                        7   8 SWTC4                                     CGL031
     I                                        9  10 SWTC5                                     CGL031
     I                                       11  12 SWTC6                                     CGL031
     I                                       13  14 SWTC7                                     CGL031
     I                                       15  16 SWTC8                                     CGL031
     I                                       17  18 SWTC9                                     CGL031
     I                                       19  20 SWTC10                                    CGL031
      *                                                                                       CGL031
     ISDCURR    E DSSDCURRPD                                                                  CGL031
      ** Data Structure for Currency Details                                                  CGL031
     I*                                                                   S01460
     ISCSARD    E DSSCSARDPD                                              S01460
     I** DATA STRUCTURE FOR ROLLOVER SWITCH ON FILE                       S01460
     I*                                                                   S01460
     ISDTCLS    E DSSDTCLSPD                                                                  CDL038
     ISDNARR    E DSSDNARRPD                                                                MD058769
     I/COPY WNCPYSRC,AKH00131
     I** Transaction Classes                                                                  CDL038
     I              'AllowPIPDforITIPD'   C         PSVAL1                                  MD027308
      *                                                                                     MD027308
     C           DTST      KLIST                                          080603
     C                     KFLD           TYPE                            080603
     C                     KFLD           STYP                            080603
     C                     KFLD           CLAS                            CDL038
     C*                                                                   080603
     C********************************************************************
     C                     EXSR INIT
     C                     EXSR MAIN
     C                     SETON                     LR
     C                     RETRN
     C********************************************************************
     C*
     C*  MAIN - Main processing
     C*
     C*  Calls - VALDT   - Validate initial screen
     C*        - Y2CLMSC - Clear program message queue (external)
     C*        - FXP     - Validate Foreign Exchange screen/Generate
     C*        - MMP     - Validate Money Market screen/Generate
     C*        - NAP     - Validate Negotiable Assets screen/Generate
     C*        - NOP     - Generate Nostro Transfer Keys
     C*
     C********************************************************************
     C           MAIN      BEGSR
     C*
     C           *IN03     DOWEQ'0'
     C           *IN07     ANDEQ'0'
     C**
     C** Initialise counts of No. Inserts & Amends
     C**
     C                     Z-ADD0         INS     40
     C                     Z-ADD0         AMS     40
     C*
     C                     WRITE#MSGCTL
     C                     EXFMTACKEYSF
     C**
     C** Clear messages from program message queue.
     C**
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGMQ     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C**
     C** If F3 not pressed, validate initial screen, else set up return
     C** code
     C**
     C           *IN03     IFEQ '0'
     C                     EXSR VALDT
     C                     END
     C**
     C** If no errors, select second screen to display
     C**
     C           *IN41     IFEQ '0'                        No errs in 1st screen
     C           *IN03     ANDEQ'0'                        F3 not pressed
     C**
     C** Set F12 indicator to off
     C**
     C                     SETOF                     12
     C**
     C** Blank out previous values entered on screen
     C**
     C                     MOVE *BLANKS   F1
     C                     MOVE *BLANKS   F1PREF
     C                     MOVE *BLANKS   F2
     C                     MOVE *BLANKS   F2PREF
     C                     MOVE *BLANKS   F3
     C                     MOVE *BLANKS   F4
     C                     MOVE *BLANKS   F4PREF
     C                     MOVE *BLANKS   F5
     C                     MOVE *BLANKS   F6
     C                     MOVE *BLANKS   F6PREF
     C                     MOVE *BLANKS   F7
     C                     MOVE *BLANKS   F8
     C                     MOVE *BLANKS   F9
     C                     MOVE *BLANKS   F10                             S01440
     C                     MOVE *BLANKS   F11                             S01440
     C                     MOVE *BLANKS   OP1
     C                     MOVE *BLANKS   SFFXM                           CAC001
     C                     MOVE *BLANKS   SFFXC                           CAC001
     C                     MOVE *BLANKS   SFXMI                           CAC001
     C                     MOVE *BLANKS   SINTL                           CAC001
     C                     MOVE *BLANKS   SINTD                           CAC001
     C                     MOVE *BLANKS   SCOFE                           CAC001
     C                     MOVE *BLANKS   SACOFP                          CAC001
     C                     MOVE *BLANKS   SCOFI                           CAC001
     C                     MOVE *BLANKS   SACOFR                          CAC001
      *                                                                                       CAS001
      ** If CAS001 is installed, initialised AKEYNPV screen fields                            CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE *BLANKS   SUPAC                                               CAS001
     C                     MOVE *BLANKS   SUPPR                                               CAS001
     C                     MOVE *BLANKS   SIEAC                                               CAS001
     C                     MOVE *BLANKS   SULAC                                               CAS001
     C                     MOVE *BLANKS   SULPR                                               CAS001
     C                     MOVE *BLANKS   SEEAC                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS004
      ** If CAS004 is installed, initialise screen fields                                     CAS004
      *                                                                                       CAS004
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           CAS005    OREQ 'Y'                                                           CAS005
     C                     MOVE *BLANKS   SEFVHP                                              CAS004
     C                     MOVE *BLANKS   SFVPPR                                              CAS004
     C                     MOVE *BLANKS   SOTINC                                              CAS004
     C                     MOVE *BLANKS   SEFVHL                                              CAS004
     C                     MOVE *BLANKS   SFVLPR                                              CAS004
     C                     MOVE *BLANKS   SOTEXP                                              CAS004
     C                     MOVE *BLANKS   SECFHP                                              CAS004
     C                     MOVE *BLANKS   SCFPPR                                              CAS004
     C                     MOVE *BLANKS   SOCOMP                                              CAS004
     C                     MOVE *BLANKS   SECFHL                                              CAS004
     C                     MOVE *BLANKS   SCFLPR                                              CAS004
     C                     MOVE *BLANKS   SOCOML                                              CAS004
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           CAS004    IFEQ 'Y'                                                           CAS005
     C                     MOVE *BLANKS   SEFVRP                                              CAS004
     C                     MOVE *BLANKS   SEFVAP                                              CAS004
     C                     MOVE *BLANKS   SEFVRL                                              CAS004
     C                     MOVE *BLANKS   SEFVAL                                              CAS004
     C                     MOVE *BLANKS   SECFRP                                              CAS004
     C                     MOVE *BLANKS   SECFAP                                              CAS004
     C                     MOVE *BLANKS   SECFRL                                              CAS004
     C                     MOVE *BLANKS   SECFAL                                              CAS004
     C                     MOVE *BLANKS   SIFVRP                                              CAS004
     C                     MOVE *BLANKS   SIFVAP                                              CAS004
     C                     MOVE *BLANKS   SIFVRL                                              CAS004
     C                     MOVE *BLANKS   SIFVAL                                              CAS004
     C                     MOVE *BLANKS   SICFRP                                              CAS004
     C                     MOVE *BLANKS   SECFAP                                              CAS004
     C                     MOVE *BLANKS   SICFRL                                              CAS004
     C                     MOVE *BLANKS   SICFAL                                              CAS004
     C                     MOVE 'N'       WCXSCN                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS005
      ** If CAS005 is installed, initialise screen fields                                     CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVE *BLANKS   SUFVRP                                              CAS005
     C                     MOVE *BLANKS   SUVPPR                                              CAS005
     C                     MOVE *BLANKS   SUFVPA                                              CAS005
     C                     MOVE *BLANKS   SUFVRL                                              CAS005
     C                     MOVE *BLANKS   SUVLPR                                              CAS005
     C                     MOVE *BLANKS   SUFVLA                                              CAS005
     C                     MOVE *BLANKS   SUCFRP                                              CAS005
     C                     MOVE *BLANKS   SUFPPR                                              CAS005
     C                     MOVE *BLANKS   SUCFPA                                              CAS005
     C                     MOVE *BLANKS   SUCFRL                                              CAS005
     C                     MOVE *BLANKS   SUFLPR                                              CAS005
     C                     MOVE *BLANKS   SUCFLA                                              CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS007
      *                                                                                       CAS009
      ** If CAS009 is installed, initialise screen fields                                     CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C                     MOVE *BLANKS   UPACAC                                              CAS009
     C                     MOVE *BLANKS   UPACPR                                              CAS009
     C                     MOVE *BLANKS   UPACIE                                              CAS009
     C                     MOVE *BLANKS   ULACAC                                              CAS009
     C                     MOVE *BLANKS   ULACPR                                              CAS009
     C                     MOVE *BLANKS   ULACEE                                              CAS009
     C                     MOVE *BLANKS   LFC                                                 CAS009
     C                     MOVE *BLANKS   LIA                                                 CAS009
     C                     MOVE *BLANKS   LMA                                                 CAS009
     C                     MOVE *BLANKS   LAA                                                 CAS009
     C                     MOVE *BLANKS   LPR                                                 CAS009
     C                     MOVE *BLANKS   NFC                                                 CAS009
     C                     MOVE *BLANKS   NIA                                                 CAS009
     C                     MOVE *BLANKS   NMA                                                 CAS009
     C                     MOVE *BLANKS   NPR                                                 CAS009
     C                     MOVE *BLANKS   DAAMAC                                              CAS009
     C                     MOVE *BLANKS   DAAPR1                                              CAS009
     C                     MOVE *BLANKS   DAAINA                                              CAS009
     C                     MOVE *BLANKS   PAAMAC                                              CAS009
     C                     MOVE *BLANKS   PAAPR1                                              CAS009
     C                     MOVE *BLANKS   PAAEXA                                              CAS009
     C                     ENDIF                                                              CAS009
     C*
     C/COPY WNCPYSRC,AKH00123
     C**
     C** Foreign Exchange screen required
     C**
     C           *IN80     IFEQ '1'                        FX Deal Type entered
     C                     EXSR FXP
     C                     END                             FX Deal Type
     C**
     C** Money Market screen required
     C**
     C           *IN81     IFEQ '1'                        FX Deal Type entered
     C                     EXSR MMP
     C                     END                             MM Deal Type
     C**
     C** Negotiable Assets screen required
     C**
     C           *IN82     IFEQ '1'                        FX Deal Type entered
     C                     EXSR NAP
     C                     END                             NA Deal Type
     C**
     C** Nostro Transfer processing
     C**
     C           *IN83     IFEQ '1'                        NT Deal Type entered
     C                     SETOF                     01
     C                     EXSR NOP
     C                     END                             Nostro Deal Type
     C*
     C                     END                             2nd screen reqd
     C*
     C                     END                             F3 pressed
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FXP - Validate Foreign Exchange screen & structure output/
     C**       update to S/ACKEY
     C**
     C** Called By - MAIN - Main processing
     C**
     C** Calls - ZASNMS - Send message to program message queue
     C**       - ACUP   - Update ZACKEYAL
     C**       - CCYUP  - Update ZACKEYAL -  keys requiring currencies
     C**
     C********************************************************************
     C           FXP       BEGSR                           *** FX ***
     C**
     C                     SETOF                     080913
     C                     SETOF                     212223
     C                     SETOF                     242540
     C                     SETOF                     424452
     C                     SETOF                     535455
     C                     SETOF                     565758
     C                     SETOF                     707172               S01440
     C                     SETOF                     737475               S01440
     C                     SETOF                     767778               S01440
     C                     SETOF                     62                   S01440
     C                     SETOF                     4965                 CAC001
     C                     SETOF                     28                   CAC001
     C                     SETOF                     14                                       226093
     C*****************************************************************
     C**
     C** Keys to be generated are dependant on Deal Type entered
     C**     - Type 1 involves Deal Types FP,FS,CX,PI,SI,OP
     C**     - Type 2 involves Deal Type  SW
     C**
     C*****************************************************************
     C**
     C** Determine Deal Type
     C**
     C                     SETOF                     1730
     C           TYPE      IFEQ 'SW'
     C                     SETON                     30
     C                     ELSE
     C                     SETON                     17
     C                     END
     C*                                                                   120834
     C           TYPE      IFEQ 'FP'                                      120834
     C           TYPE      OREQ 'FS'                                      120834
     C           TYPE      OREQ 'CX'                                      120834
     C                     SETON                     06                   120834
     C                     ELSE                                           120834
     C                     SETOF                     06                   120834
     C                     ENDIF                                          120834
      *                                                                   S01440
      *** If the accruals on int outrights flag is 'Y',and the deal       S01440
      *** type input is 'SI' or 'PI', display extra fields.               S01440
      *                                                                   S01440
     C           BNAOIO    IFEQ 'Y'                                       S01440
     C           TYPE      ANDEQ'SI'                                      S01440
     C           TYPE      OREQ 'PI'                                      S01440
     C           BNAOIO    ANDEQ'Y'                                       S01440
     C                     SETOF                     70                   S01440
     C                     ELSE                                           S01440
     C                     SETON                     70                   S01440
     C                     END                                            S01440
     C*
     C           *IN03     DOUEQ'1'                        F3 pressed  X scrn
     C           *IN12     OREQ '1'                        F12 pressed X scrn
     C           *IN62     OREQ '0'                        No errs in FX scrn
     C*
     C                     WRITE#MSGCTL
     C           WCXSCN    IFEQ 'N'                                                           CAS004
     C           CAS004    ANDEQ'Y'                                                           CAS004
     C           CAS004    OREQ 'N'                                                           CAS004
     C           CAS004    OREQ 'Y'                                                           CAS007
     C           CAS007    ANDEQ'N'                                                           CAS007
     C                     EXFMTACKEYFX
     C                     ENDIF                                                              CAS004
     C**
     C** Clear messages from program message queue.
     C**
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGMQ     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C**
     C** If F3 and F12 not pressed, validate screen
     C**
     C**
     C           *IN03     IFEQ '0'                        F3 pressed  X scrn
     C           *IN12     ANDEQ'0'                        F12 pressed X scrn
     C**
     C** Initialise indicators before validation
     C**
     C                     SETOF                     080913
     C                     SETOF                     212223
     C                     SETOF                     242540
     C                     SETOF                     424452
     C                     SETOF                     525455
     C                     SETOF                     565758
     C                     SETOF                     717273               S01440
     C                     SETOF                     747576               S01440
     C                     SETOF                     7778                 S01440
     C                     SETOF                     62
     C                     SETOF                     4965                 CAC001
     C                     SETOF                     28                   CAC001
     C                     SETOF                     14                                       226093
     C**
     C** Load arrays with valid Dealing Currencies and corresponding
     C** Spot Trade Account Equivalents program run. Initialise
     C** SDCURRL1 & count of no. of currencies in array
     C** Then process all records on SDCURRL1
     C**
     C           *LOVAL    SETLL@A6REA3
     C                     Z-ADD0         C       30
     C*
     C           *IN04     DOUEQ'1'                        Not eof(SDCURRL1)
     C           C         ORGT 200
     C*
     C                     READ @A6REA3                  04
     C**
     C** If not end of file, process Dealing currencies
     C**
     C           *IN04     IFEQ '0'
     C**
     C           A6DLCI    IFEQ 'Y'
     C**
     C** Fill currency array
     C**
     C           C         ADD  1         C
     C                     MOVE A6CYCD    CCYA,C
     C**
     C** Validate Spot Trade A/c Equivalents & move to array
     C**
     C           A6SPAE    CHAINSDACODL0             10
     C*
     C           *IN10     IFEQ '1'                        A/c code invalid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     41    Errors
     C                     MOVELA6CYCD    ZAMSDA           Message parameters
     C                     MOVEL'USR4226' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETOF                     10
     C                     ELSE                            A/c code valid
     C                     MOVE A6SPAE    TAC,C
      *                                                                                       239089
      ** Save the Base Currency Spot Trade Equivalent A/C Code                                239089
      *                                                                                       239089
     C           CCYA,C    IFEQ BJCYCD                                                        239089
     C                     MOVE A6SPAE    BSPAE  10                                           239089
     C                     ENDIF                                                              239089
      *                                                                                       239089
     C                     END                             A/c validation
     C*
     C                     END                             Not Dealing Ccy
     C*
     C                     END                             Eof
     C*
     C                     END                             Eof or C GT 200
     C**
     C** If more than 200 Dealing Currencies send error message
     C**
     C           C         IFGT 200
     C                     SETON                     41    Errors
     C                     MOVEL'USR4220' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Store number of currencies loaded into array
     C**
     C                     Z-ADDC         MAXCCY  30
     C**
     C** Check F1 (Forward Purchases Account) is valid non-title
     C** Account code
     C**
     C**
     C           F1        IFEQ *BLANKS
     C                     SETOF                     2152               screen
     C                     ELSE
     C           F1        CHAINSDACODL0             52
     C                     SETON                     21
     C                     END
     C*
     C           *IN52     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5262  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F1PREF (Posting Ref 1 or 3?) is valid
     C**
     C           F1PREF    IFEQ *BLANKS
     C                     SETOF                     0844
     C                     ELSE
     C                     SETON                     44
     C           F1PREF    IFEQ '1'
     C           F1PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C                     SETON                     0862  Errors in FX
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C**
     C** Check F2 (Forward Sales Account) is valid non-title
     C** Account code
     C**
     C           F2        IFEQ *BLANKS
     C                     SETOF                     2253               screen
     C                     ELSE
     C           F2        CHAINSDACODL0             53
     C                     SETON                     22
     C                     END
     C*
     C           *IN53     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5362  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F2PREF (Posting Ref 1 or 3?) is valid
     C**
     C           F2PREF    IFEQ *BLANKS
     C                     SETOF                     0940
     C                     ELSE
     C                     SETON                     40
     C           F2PREF    IFEQ '1'
     C           F2PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C                     SETON                     0962  Errors in FX
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C**
     C** Check F3 (Forward Position Account) is valid non-title
     C** Account code
     C**
     C           F3        IFEQ *BLANKS
     C                     SETOF                     2354               screen
     C                     ELSE
     C           F3        CHAINSDACODL0             54
     C                     SETON                     23
     C                     END
     C*
     C           *IN54     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5462  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
      *** If the Accruals on int. outright flag is 'Y' (from the          S01440
      ***  dealing ICD) and deal type is 'PI' or 'SI'                     S01440
      *                                                                   S01440
     C           BNAOIO    IFEQ 'Y'                                       S01440
     C           TYPE      ANDEQ'SI'                                      S01440
     C           TYPE      OREQ 'PI'                                      S01440
     C           BNAOIO    ANDEQ'Y'                                       S01440
      *                                                                   S01440
     C**                                                                  S01440
     C** Check F8 (Purchase Accrual Account) if entered is valid          S01440
     C** non-title account code                                           S01440
     C**                                                                  S01440
     C           F8        IFEQ *BLANKS                    F8 blank       S01440
     C                     SETOF                     7571                 S01440
     C                     ELSE                                           S01440
     C           F8        CHAINSDACODL0             71                   S01440
     C                     SETON                     75                   S01440
     C                     END                                            S01440
     C*                                                                   S01440
     C           *IN71     IFEQ '1'                                       S01440
     C           A5TOIN    OREQ 'Y'                                       S01440
     C           *IN71     ANDEQ'0'                                       S01440
     C           *IN75     ANDEQ'1'                                       S01440
     C                     SETON                     7162                 S01440
     C                     MOVEL'USR4230' ZAMSID           Message id.    S01440
     C                     EXSR ZASNMS                     Send message   S01440
     C                     END                                            S01440
     C**                                                                  S01440
     C** Check F9 (Purchase Income Account) if entered is valid           S01440
     C** non-title account code                                           S01440
     C**                                                                  S01440
     C           F9        IFEQ *BLANKS                    F9 blank       S01440
     C                     SETOF                     7672                 S01440
     C                     ELSE                                           S01440
     C           F9        CHAINSDACODL0             72                   S01440
     C                     SETON                     76                   S01440
     C                     END                                            S01440
     C*                                                                   S01440
     C           *IN72     IFEQ '1'                                       S01440
     C           A5TOIN    OREQ 'Y'                                       S01440
     C           *IN72     ANDEQ'0'                                       S01440
     C           *IN76     ANDEQ'1'                                       S01440
     C                     SETON                     7262                 S01440
     C                     MOVEL'USR4230' ZAMSID           Message id.    S01440
     C                     EXSR ZASNMS                     Send message   S01440
     C                     END                                            S01440
     C**                                                                  S01440
     C** Check F10 (Sale Accrual Account) if entered is valid             S01440
     C** non-title account code                                           S01440
     C**                                                                  S01440
     C           F10       IFEQ *BLANKS                    F10 blank      S01440
     C                     SETOF                     7773                 S01440
     C                     ELSE                                           S01440
     C           F10       CHAINSDACODL0             73                   S01440
     C                     SETON                     77                   S01440
     C                     END                                            S01440
     C*                                                                   S01440
     C           *IN73     IFEQ '1'                                       S01440
     C           A5TOIN    OREQ 'Y'                                       S01440
     C           *IN73     ANDEQ'0'                                       S01440
     C           *IN77     ANDEQ'1'                                       S01440
     C                     SETON                     7362                 S01440
     C                     MOVEL'USR4230' ZAMSID           Message id.    S01440
     C                     EXSR ZASNMS                     Send message   S01440
     C                     END                                            S01440
     C**                                                                  S01440
     C** Check F11 (Sale Expense Account) if entered is valid             S01440
     C** non-title account code                                           S01440
     C**                                                                  S01440
     C           F11       IFEQ *BLANKS                    F11 blank      S01440
     C                     SETOF                     7874                 S01440
     C                     ELSE                                           S01440
     C           F11       CHAINSDACODL0             74                   S01440
     C                     SETON                     78                   S01440
     C                     END                                            S01440
     C*                                                                   S01440
     C           *IN74     IFEQ '1'                                       S01440
     C           A5TOIN    OREQ 'Y'                                       S01440
     C           *IN74     ANDEQ'0'                                       S01440
     C           *IN78     ANDEQ'1'                                       S01440
     C                     SETON                     7462                 S01440
     C                     MOVEL'USR4230' ZAMSID           Message id.    S01440
     C                     EXSR ZASNMS                     Send message   S01440
     C                     END                                            S01440
     C**                                                                  S01440
     C** Deal Type SI,PI, then all or none of fields F8, F9, F10, F11     S01440
     C** are required                                                     S01440
     C**                                                                  S01440
     C           *IN75     IFEQ '1'                        F8 entered     S01440
     C           *IN76     ANDEQ'1'                        F9 entered     S01440
     C           *IN77     ANDEQ'1'                        F10 entered    S01440
     C           *IN78     ANDEQ'1'                        F11 entered    S01440
     C                     ELSE                                           S01440
     C           *IN75     IFEQ '0'                        F8 blank       S01440
     C           *IN76     ANDEQ'0'                        F9 blank       S01440
     C           *IN77     ANDEQ'0'                        F10 blank      S01440
     C           *IN78     ANDEQ'0'                        F11 blank      S01440
     C                     ELSE                                           S01440
     C                     SETON                     627172               S01440
     C                     SETON                     7374                 S01440
     C                     MOVEL'USR2164' ZAMSID           Message id.    S01440
     C                     EXSR ZASNMS                     Send message   S01440
     C                     END                             All entered    S01440
     C                     END                             All blanks     S01440
     C                     END                             BNAOIO='Y'?    S01440
     C**                                                                  S01440
     C** Either all or none of these five fields must be entered
     C**
     C           *IN21     IFEQ '1'                        F1 entered
     C           *IN44     ANDEQ'1'                        F1PREF ent
     C           *IN22     ANDEQ'1'                        F2 entered
     C           *IN40     ANDEQ'1'                        F2PREF ent
     C           *IN23     ANDEQ'1'                        F3 entered
     C*
     C                     ELSE
     C           *IN21     IFEQ '0'                        F1 blank
     C           *IN44     ANDEQ'0'                        F1PREF
     C           *IN22     ANDEQ'0'                        F2 blank
     C           *IN40     ANDEQ'0'                        F2PREF
     C           *IN23     ANDEQ'0'                        F3 blank
     C*
     C                     ELSE
     C                     SETON                     525354
     C                     SETON                     080962
     C                     MOVEL'USR4221' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All blank
     C                     END                             All entered
     C**
     C** Validate F4, F4PREF, F5, F6, F6PREF and F7 if Deal Type is
     C** SW (Not displayed for all other Deal Types)
     C**
     C           *IN30     IFEQ '1'                        Deal Type SW
     C*
     C** Check F4 (Swap Profit Accrual Account) is valid, non-title
     C** account code
     C**
     C           F4        IFNE *BLANKS
     C           F4        CHAINSDACODL0             55
     C           *IN55     IFEQ '1'                        Not valid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5562  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     ELSE                            F4 blank
     C                     SETON                     5562  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F4PREF (Posting Reference 1 or 3?) is valid - cannot
     C** be 3 if Accrual Summary Indicator = Y (from SDGELRPD)
     C**
     C           F4PREF    IFNE *BLANKS
     C           F4PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C                     SETON                     1362  Errors in FX screen
     C                     MOVEL'USR4268' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F4PREF    IFEQ '1'
     C           F4PREF    OREQ '3'
     C                     ELSE
     C                     SETON                     1362  Errors in FX screen
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     ELSE                            F4PREF blank
     C                     SETON                     1362  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F5 (Swap Profit Income Account) is valid non-title
     C** account code
     C**
     C           F5        IFNE *BLANKS
     C           F5        CHAINSDACODL0             56
     C           *IN56     IFEQ '1'                        Not valid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5662  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     ELSE
     C                     SETON                     5662  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F6 (Swap Loss Accrual Account) is valid non-title
     C** account code
     C**
     C           F6        IFNE *BLANKS
     C           F6        CHAINSDACODL0             57
     C           *IN57     IFEQ '1'                        Not valid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5762  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     ELSE                            F4 blank
     C                     SETON                     5762  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F6PREF (Posting Reference 1 or 3?) is valid - cannot be
     C** 3 if Accrual Summary Indicator = Y (from SDGELRPD)
     C**
     C           F6PREF    IFNE *BLANKS
     C           F6PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C                     SETON                     1462  Errors in FX screen
     C                     MOVEL'USR4268' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F6PREF    IFEQ '1'
     C           F6PREF    OREQ '3'
     C                     ELSE
     C                     SETON                     1462  Errors in FX screen
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     ELSE                            F4PREF blank
     C                     SETON                     1462  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F7 (Swap Loss Income Account) is valid non-title
     C** account code
     C**
     C           F7        IFNE *BLANKS
     C           F7        CHAINSDACODL0             58
     C           *IN58     IFEQ '1'                        Not valid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5862  Errors in FX screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     ELSE                            F4 blank
     C                     SETON                     5862  Errors in FX screen
     C                     MOVEL'USR4246' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C*
     C                     END                             Deal Type SW
     C**
     C** Check Spot Trade Account Code from SDTRADPD ICD is valid
     C**
     C           BLSPTA    CHAINSDACODL0             10
     C           *IN10     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     62    Errors in FX screen
     C                     MOVEL'USR4224' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETOF                     10
     C                     END
     C**
     C** Check Swap Trade Account Code from SDDEALPD ICD is valid
     C**
     C           BNSWTA    CHAINSDACODL0             10
     C           *IN10     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     62    Errors in FX screen
     C                     MOVEL'USR4225' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETOF                     10
     C                     END
      *                                                                   CAC001
      **  Perform the following validation only if Analytical             CAC001
      **  Accounting module is installed                                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN06     ANDEQ'1'                                       120834
      *                                                                   CAC001
      **  Check SFFXM (Forward FX Margin) is valid non-title              CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SFFXM     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN49                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SFFXM     CHAINSDACODL0             49                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN49     IFEQ *ON                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     4962                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SFFXC (Forward FX Margin Contra) is valid non-title       CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SFFXC     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN28                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SFFXC     CHAINSDACODL0             28                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN28     IFEQ *ON                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     2862                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SFXMI (FX Margin Income Account) is valid non-title       CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SFXMI     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN65                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SFXMI     CHAINSDACODL0             65                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN65     IFEQ *ON                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6562                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  FX Margin Account Codes must all be entered...                  CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           SFFXM     WHNE *BLANKS                                   CAC001
     C           SFFXC     ANDNE*BLANKS                                   CAC001
     C           SFXMI     ANDNE*BLANKS                                   CAC001
     C                     MOVE 'N'       WBLANK  1                       CAC001
      *                                                                   CAC001
      **  ...or all be blanks                                             CAC001
      *                                                                   CAC001
     C           SFFXM     WHEQ *BLANKS                                   CAC001
     C           SFFXC     ANDEQ*BLANKS                                   CAC001
     C           SFXMI     ANDEQ*BLANKS                                   CAC001
     C                     MOVE 'Y'       WBLANK                          CAC001
      *                                                                   CAC001
      **  Otherwise, send an error message                                CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     SETON                     492865               CAC001
     C                     SETON                     62                   CAC001
     C************         MOVEL'USR4272' ZAMSID                   CAC001 183287
     C                     MOVEL'USR4600' ZAMSID                          183287
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDSL                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                                       CAS004
      ** If Hedge Accounting (CAS004) is installed, generate Hedge                            CAS004
      ** Accounting account keys.                                                             CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           *IN62     ANDEQ*OFF                                                          CAS004
     C                     MOVE *BLANK    WEFFEC  1                                           CAS004
     C                     MOVE 'FXP'     WKSUBR                                              CAS004
      *                                                                                       CAS004
      ** If Deal Type is 'CX'                                                                 CAS004
      *                                                                                       CAS004
     C           TYPE      IFEQ 'CX'                                                          CAS004
     C                     MOVE 'Y'       WEFFEC                                              CAS004
     C                     MOVE 'Y'       WCXSCN  1                                           CAS004
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           WUNREL    ANDEQ'Y'                                                           CAS005
     C                     MOVE *BLANK    WUNREL                                              CAS005
     C                     MOVE 'N'       WEFFEC                                              CAS005
     C                     ENDIF                                                              CAS005
     C           WEFFEC    IFEQ 'Y'                                                           CAS005
     C                     EXSR SRDCXS                                                        CAS004
     C                     ENDIF                                                              CAS005
     C           *IN62     IFEQ *OFF                                                          CAS004
     C                     MOVE 'N'       WEFFEC                                              CAS004
     C                     EXSR SRDCXS                                                        CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS007
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     EXSR SRDCX5                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       226093
      ** If not CX, still display NPV screen                                                  226093
      *                                                                                       226093
     C                     ELSE                                                               226093
     C                     MOVE 'FXP'     WKSUBR                                              226093
     C                     EXSR SRDNPV                                                        226093
      *                                                                                       226093
      ** If F12 pressed, redisplay FXP screen                                                 226093
      *                                                                                       226093
     C           *IN12     IFEQ *ON                                                           226093
     C                     MOVE *OFF      *IN12                                               226093
     C                     MOVEA'000000'  *IN,86                                              226093
     C                     MOVE *ON       *IN62                                               226093
     C                     ENDIF                                                              226093
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C**
     C** If errors exist on screen, hold screen and highlight errors
     C** Do not continue processing to generate keys
     C**
     C           *IN62     IFEQ '0'                        No errs in FX scrn
     C**
     C** Set up all fields for ACKEY output/update
     C** Account key is always created, but non-key fields are only
     C** added if the appropriate fields have been entered on screen
     C**
     C                     MOVE *BLANK    DLKEY
     C                     MOVE TYPE      DTYPD
     C                     MOVE STYP      STYPD
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE *BLANK    FMKEYS
     C**
     C** Deal Date Keys                  *** Types 1 & 2 Only ***
     C**
     C           *IN17     IFEQ '1'
     C           *IN30     OREQ '1'
     C**
     C** Format Key XXDYY...FB      (XX=Type,YY=Sub Type,.=blank)
     C**                            ** Not required for Deal Type FS **
     C**
     C                     MOVE 'D'       EVENTD
     C                     MOVE 'F'       FBD
     C                     MOVE 'B'       AMTD
     C**
     C** Set up fields (if F1 entered and therefore F3 also entered)
     C**
     C           F1        IFNE *BLANKS
     C                     MOVE F1        AC1
     C                     MOVE F1PREF    PR1
     C           F1PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '02'      PN1
     C                     END
     C                     MOVE F3        AC4
     C                     MOVE '02'      PN4
     C                     MOVE '1'       PR4
     C                     END                             F1 entered
     C*
     C** Update file
     C*
     C** Only produced for Deal Type FS if Base Ccy for Accting
     C** (from SDBANKPD) is not equal to Base Ccy for Dealing (from
     C** SDDEALPD)
     C*
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FS
     C                     EXSR ACUP
     C                     END
     C**
     C** Format Key XXDYY...BB & update file  ** Not Deal Type FP **
     C**
     C** Only produced for Deal Type FP if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C                     MOVE 'B'       FBD
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FP
     C                     EXSR ACUP
     C                     END
     C**
     C** Format Key XXDYY...BC
     C**
     C                     MOVE 'C'       AMTD
     C**
     C** Set up fields (if F3 entered, and therefore F2 also entered)
     C**
     C           *IN23     IFEQ '1'
     C                     MOVE F3        AC1
     C                     MOVE '1'       PR1
     C                     MOVE '02'      PN1
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '02'      PN4
     C                     END
     C                     END
     C** Update file
     C** Only produced for Deal Type FS if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FS
     C                     EXSR ACUP
     C                     END
     C**
     C** Format Key XXDYY...FC & update file
     C**
     C** Only produced for Deal Type FP if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C                     MOVE 'F'       FBD
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            Type = FP
     C                     EXSR ACUP
     C                     END
      *                                                                   CAC001
      **  If Anal Acctg is installed, for all deal types, set up          CAC001
      **  account keys xxDyy...BM and xxDyy...FM                          CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN06     ANDEQ'1'                                       120834
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE *BLANKS   FBD                             CAC001
     C                     MOVE 'B'       FBD                             CAC001
     C                     MOVE 'M'       AMTD                            CAC001
      *                                                                   CAC001
      **  If FX Margin Account Codes not blank, set up DR/CR details      CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SFFXC     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SFFXM     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
     C                     MOVE 'F'       FBD                             CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   FBD                             CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Format Key XXDYYCCY.P (CCY=Currency code)
     C**
     C                     MOVE ' '       FBD
     C                     MOVE 'P'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C**
     C** Set on indicator for XXDYYCCY.P Key to be generated, set off
     C** after file updated
     C**
     C                     SETON                     45
     C                     EXSR CCYUP
     C                     SETOF                     45
     C**
     C** Format Key XXDYYCCY.S
     C**
     C                     MOVE 'S'       AMTD
     C**
     C** Set on indicator for XXDYYCCY.S key to be generated, set off
     C** once file is updated
     C**
     C                     SETON                     46
     C                     EXSR CCYUP
     C                     SETOF                     46
     C**
     C** The following Deal Date Keys are required for Type 2 only *** ***
     C**
     C           *IN30     IFEQ '1'
     C**
     C** Format Key XXDYY....H
     C**
     C                     MOVE '    H'   DLKEY
     C** DR fields
     C                     MOVE BNSWTA    AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C** CR fields
     C                     MOVE F4        AC4
     C                     MOVE F4PREF    PR4
     C                     MOVE '01'      PN4
     C** Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXDYY....L
     C**
     C                     MOVE 'L'       AMTD
     C** DR fields
     C                     MOVE F6        AC1
     C                     MOVE F6PREF    PR1
     C** CR fields
     C                     MOVE BNSWTA    AC4
     C                     MOVE '1'       PR4
     C** Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY...FB
     C**
     C                     MOVE 'S'       EVENTD
     C                     MOVE 'FB'      DLKEY
     C** Set up fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE '2'       PR1
     C                     MOVE '01'      PN1
     C                     MOVE BNSWTA    AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     c*
     C** If F3 entered, and therefore F1 also entered
     c*
     C           F3        IFNE *BLANKS
     C                     MOVE F3        AC2
     C                     MOVE '03'      PN2
     C                     MOVE '1'       PR2
     C                     MOVE F1        AC5
     C                     MOVE F1PREF    PR5
     C           F1PREF    IFEQ '1'
     C                     MOVE '01'      PN5
     C                     ELSE
     C                     MOVE '03'      PN5
     C                     END
     C                     END
     C** Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY...BB & update file
     C**
     C                     MOVE 'B'       FBD
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY...BB & update file
     C**
     C                     MOVE 'M'       EVENTD
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY...FB & update file
     C**
     C                     MOVE 'F'       FBD
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY...FC
     C**
     C                     MOVE 'C'       AMTD
     C** Set up fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE BNSWTA    AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C*
     C* If F2 is entered, and therefore F3 is also entered
     C*
     C           F2        IFNE *BLANKS
     C                     MOVE F2        AC2
     C                     MOVE F2PREF    PR2
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN2
     C                     ELSE
     C                     MOVE '03'      PN2
     C                     END
     C                     MOVE F3        AC5
     C                     MOVE '03'      PN5
     C                     MOVE '1'       PR5
     C                     END
     C** Update file
     C**
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY...BC & update file
     C**
     C                     MOVE 'B'       FBD
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY...BC & update file
     C**
     C                     MOVE 'S'       EVENTD
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY...FC & update file
     C**
     C                     MOVE 'F'       FBD
     C                     EXSR ACUP
     C**
     C** Format Key XXSYYCCY.P
     C**
     C                     MOVE ' P'      DLKEY
     C**
     C** DR & CR Fields & update file
     C**
     C                     MOVE *BLANK    FMKEYS
     C                     EXSR CCYUP
     C**
     C** Format Key XXSYYCCY.S & update file
     C**
     C                     MOVE 'S'       AMTD
     C                     EXSR CCYUP
     C**
     C** Format Key XXMYYCCY.S & update file
     C**
     C                     MOVE 'M'       EVENTD
     C                     EXSR CCYUP
     C**
     C** Format Key XXMYYCCY.P & update file
     C**
     C                     MOVE 'P'       AMTD
     C                     EXSR CCYUP
     C**
     C** Format Key XXMYY....H & update file
     C**
     C                     MOVE '    H'   DLKEY
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY....L & update file
     C**
     C                     MOVE 'L'       AMTD
     C                     EXSR ACUP
     C**
     C** Format Key XXLYY....L & update file
     C**
     C                     MOVE 'L'       EVENTD
     C** DR fields
     C                     MOVE F7        AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C** CR fields
     C                     MOVE F6        AC4
     C                     MOVE F6PREF    PR4
     C           F6PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '15'      PN4                             078809
     C************         MOVE '28'      PN4                             078809
     C                     END
     C** Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXPYY....H
     C**
     C                     MOVE 'P'       EVENTD
     C                     MOVE 'H'       AMTD
     C** DR fields
     C                     MOVE F4        AC1
     C                     MOVE F4PREF    PR1
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '13'      PN1                             078809
     C************         MOVE '28'      PN1                             078809
     C                     END
     C** CR fields
     C                     MOVE F5        AC4
     C                     MOVE '1'       PR4
     C                     MOVE '01'      PN4
     C** Update file
     C                     EXSR ACUP
     C*
     C                     END                             Type 3 only
     C                     END                             Type 1 or 3
     C*                                                                   S01440
      *** Calculate the interest accrual keys,                            S01440
      *** (XXAYY....P and XXAYY....S)                                     S01440
      *                                                                   S01440
     C           BNAOIO    IFEQ 'Y'                                       S01440
     C           TYPE      ANDEQ'SI'                                      S01440
     C           TYPE      OREQ 'PI'                                      S01440
     C           BNAOIO    ANDEQ'Y'                                       S01440
     C                     MOVE 'A'       EVENTD                          S01440
     C                     MOVE 'P'       AMTD                            S01440
     C                     MOVE *BLANKS   CYD                             S01440
     C*                                                                   S01440
     C** DR fields                                                        S01440
     C                     MOVE F8        AC1                             S01440
     C                     MOVE '1'       PR1                             S01440
     C                     MOVE '01'      PN1                             S01440
     C*                                                                   S01440
     C** CR fields                                                        S01440
     C                     MOVE F9        AC4                             S01440
     C                     MOVE '1'       PR4                             S01440
     C                     MOVE '01'      PN4                             S01440
     C*                                                                   S01440
     C                     EXSR ACUP                                      S01440
     C*                                                                   S01440
     C                     MOVE 'S'       DLKEY                           S01440
     C*                                                                   S01440
     C** DR fields                                                        S01440
     C                     MOVE F10       AC1                             S01440
     C                     MOVE '1'       PR1                             S01440
     C                     MOVE '01'      PN1                             S01440
     C*                                                                   S01440
     C** CR fields                                                        S01440
     C                     MOVE F11       AC4                             S01440
     C                     MOVE '1'       PR4                             S01440
     C                     MOVE '01'      PN4                             S01440
     C                     EXSR ACUP                                      S01440
     C                     END                                            S01440
     C**
     C** Value Date Keys         *** Types 1 only ***
     C**
     C           *IN30     IFEQ '0'                        Not Type 2
     C**
     C** Format Key XXVYY...FB
     C**
     C                     MOVE 'V'       EVENTD
     C                     MOVE '   FB'   DLKEY
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     MOVE BLSPTA    AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C*
     C** If F3 entered, and therefore F1 also entered
     C*
     C           F3        IFNE *BLANKS
     C                     MOVE F3        AC2
     C                     MOVE '03'      PN2
     C                     MOVE '1'       PR2
     C                     MOVE F1        AC5
     C                     MOVE F1PREF    PR5
     C           F1PREF    IFEQ '1'
     C                     MOVE '01'      PN5
     C                     ELSE
     C                     MOVE '03'      PN5
     C                     END
     C                     END
     C*
     C** Only produced for Deal Type FS if Base Ccy for Accting
     C** (from SDBANKPD) is not equal to Base Ccy for Dealing (from
     C** SDDEALPD)
     C*
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FS
     C                     EXSR ACUP
     C**
     C** If Deal Type OP entered , then generate for OT also
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR ACUP
     C                     MOVE 'OP'      DTYPD
     C                     END
     C                     END                             FS
     C**
     C** Format Key XXVYY...BB & update file
     C**
     C** Only produced for Deal Type FP if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C                     MOVE 'B'       FBD
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FP
     C                     EXSR ACUP
     C**
     C** If Deal Type OP, then generate the key again for Deal Type OT
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR ACUP
     C                     MOVE 'OP'      DTYPD
     C                     END
     C*
     C                     END                             FP
     C**
     C** Format Key XXVYY...FC
     C**
     C                     MOVE *BLANKS   FMKEYS
     C                     MOVE 'FC'      DLKEY
     C                     MOVE BLSPTA    AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C*
     C* If F2 entered, and therefore F3 also entered
     C*
     C           F2        IFNE *BLANKS
     C                     MOVE F2        AC2
     C                     MOVE F2PREF    PR2
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN2
     C                     ELSE
     C                     MOVE '03'      PN2
     C                     END                             F2PREF=1
     C                     MOVE F3        AC5
     C                     MOVE '03'      PN5
     C                     MOVE '1'       PR5
     C                     END                             F2<>blank
     C*
     C** Only produced for Deal Type FP if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            Type = FP
     C                     EXSR ACUP
     C**
     C** If Deal Type OP, then generate the key again for Deal Type OT
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR ACUP
     C                     MOVE 'OP'      DTYPD
     C                     END
     C*
     C                     END                             Type FP
     C**
     C** Format Key XXVYY...BC & update file
     C**
     C** Only produced for Deal Type FS if Base Ccy for Accting (from
     C** SDBANKPD) is not the same as Base Ccy for Dealing (from
     C** SDDEALPD)
     C**
     C                     MOVE 'B'       FBD
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFNE BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FS
     C                     EXSR ACUP
     C**
     C** If Deal Type OP, then generate the key again for Deal Type OT
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR ACUP
     C                     MOVE 'OP'      DTYPD
     C                     END                             OP
     C                     END                             FS
      *                                                                   CAC001
      **  If Anal Acctg is installed, for all deals, set up account       CAC001
      **  key xxVyy...BM and xxVyy...FM                                   CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN06     ANDEQ'1'                                       120834
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE *BLANKS   FBD                             CAC001
     C                     MOVE 'F'       FBD                             CAC001
     C                     MOVE 'M'       AMTD                            CAC001
      *                                                                   CAC001
      **  If FX Margin Account Codes not blank, set up DR/CR details      CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SFFXM     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE BLSPTA    AC2                             CAC001
     C                     MOVE '1'       PR2                             CAC001
     C                     MOVE '01'      PN2                             CAC001
     C                     MOVE SFXMI     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     MOVE SFFXC     AC5                             CAC001
     C                     MOVE '1'       PR5                             CAC001
     C                     MOVE '01'      PN5                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
     C                     MOVE 'B'       FBD                             CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  If Deal Type OP, generate the keys again for Deal Type OT       CAC001
      *                                                                   CAC001
     C           TYPE      IFEQ 'OP'                                      CAC001
     C                     MOVE 'OT'      DTYPD                           CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE 'F'       FBD                             CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE 'OP'      DTYPD                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FBD                             CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Format Key XXVYYCCY.P
     C**
     C                     MOVE ' P'      DLKEY
     C** DR fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE '03'      PN1
     C                     MOVE '1'       PR1
     C** Update file
     C                     SETON                     37
     C                     EXSR CCYUP
     C**
     C** If Deal Type is OP, then generate XXVYYCCY.P again for Deal
     C** Type OT
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR CCYUP
     C                     MOVE 'OP'      DTYPD
     C                     END
     C                     SETOF                     37
     C**
     C** Format Key XXVYYCCY.S
     C**
     C                     MOVE 'S'       AMTD
     C** CR Fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE '03'      PN4
     C                     MOVE '1'       PR4
     C** Update file
     C                     SETON                     38
     C                     EXSR CCYUP
     C**
     C** If Deal Type is OP, then generate XXVYYCCY.P again for Deal
     C** Type OT
     C**
     C           TYPE      IFEQ 'OP'
     C                     MOVE 'OT'      DTYPD
     C                     EXSR CCYUP
     C                     MOVE 'OP'      DTYPD
     C                     END
     C                     SETOF                     38
     C*
     C                     END                             Type 1
      *                                                                                       226093
      ** If CAS005 is on, generate NPV account keys                                           226093
      *                                                                                       226093
     C           CAS005    IFEQ 'Y'                                                           226093
     C                     EXSR SRGNPV                                                        226093
     C                     ENDIF                                                              226093
      *                                                                                       CAS004
      ** If Hedge Accounting (CAS004) is installed and type 'CX'                              CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           TYPE      ANDEQ'CX'                                                          CAS004
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           TYPE      ANDEQ'CX'                                                          CAS005
     C                     EXSR SRGCXK                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C**
     C** Deal Type/SubType reset to blanks before redisplaying initial
     C** screen.
     C**
     C                     MOVE *BLANKS   TYPE
     C                     MOVE *BLANKS   STYP
     C                     MOVE *BLANKS   CLAS                                                CDL038
     C                     MOVE '1'       *IN07
     C*
     C                     END                             Errs in FX screen
     C*
     C                     END                             F3/F12 not pressed
     C*
     C                     END                             F3/F12/Errs in scrn
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** MMP - Validate Money Markey Input & structure output/update
     C**       of ACKEY
     C**
     C** Called By - MAIN - Main processing
     C**
     C** Calls - ZASNMS - Send message to program message queue
     C**       - ACUP   - Update ZACKEYAL
     C*********- MMCCY**- Setup Keys which involve a Curr Code     S01460 080603
     C*********           for MM.                                  S01460 080603
     C**
     C********************************************************************
     C           MMP       BEGSR
     C*****************************************************************
     C                     SETOF                     020516
     C                     SETOF                     181920
     C                     SETOF                     222334
     C                     SETOF                     242527
     C                     SETOF                     343940
     C                     SETOF                     42
     C                     SETOF                     525354
     C                     SETOF                     555657
     C                     SETOF                     295859               080603
     C                     SETOF                     6069                 080603
     C                     SETOF                     666768               CAC001
     C                     SETOF                     798485               CAC001
      ** Initialise error indicator flag                                                      CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     MOVE '0'       IND11                                               CGL165
     C                     ENDIF                                                              CGL165
     C                     MOVE ' '       WKSCAA                                              CAS001
     C**
     C** Determine type
     C**
     C           TYPE      IFEQ 'IP'
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     SETON                     16
     C                     END
     C           TYPE      IFEQ 'TI'
     C                     SETON                     02
     C                     END
     C           TYPE      IFEQ 'IT'
     C                     SETON                     39
     C                     END
     C           TYPE      IFEQ 'TD'
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     SETON                     18
     C                     END
     C           TYPE      IFEQ 'CL'
     C           TYPE      OREQ 'IL'                                      S01354
     C           TYPE      OREQ 'LP'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'DP'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     SETON                     19
     C***********                                                  S01460 080603
     C***********          SETON                     58            S01460 080603
     C***********          SETON                     59            S01460 080603
     C***********          SETON                     29            S01460 080603
     C***********                                                  S01460 080603
     C                     END
     C           TYPE      IFEQ 'CD'
     C           TYPE      OREQ 'ID'                                      S01354
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     SETON                     20
     C                     END
     C           TYPE      IFEQ 'CI'
     C           TYPE      OREQ 'CF'                                                          240339
     C                     SETON                     34
     C                     END
     C*
     C           TYPE      IFEQ 'TD'                                      S01460
     C           TYPE      OREQ 'IT'                                      S01460
     C           TYPE      OREQ 'CD'                                      S01460
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     SETON                     29                   S01460
     C                     END                                            S01460
     C*                                                                   S01460
     C** Default BRT tax liability Account                                080603
     C*                                                                   080603
     C           *IN71     IFEQ *ON                                       080603
     C           *IN29     ANDEQ*ON                                       080603
     C           S01383    ANDEQ'Y'                                       080603
     C                     MOVE ACOD      F11                             080603
     C                     ENDIF                                          080603
     C*                                                                   080603
     C           ASFUID    IFEQ 'Y'                                       080603
     C                     MOVE *ON       *IN69                           080603
     C                     ENDIF                                          080603
     C*                                                                   080603
     C           *IN03     DOUEQ'1'                        F3 pressed  X scrn
     C           *IN12     OREQ '1'                        F12 pressed X scrn
     C           *IN63     OREQ '0'                        No errs in FX scrn
     C*
      *                                                                                       CGL165
      ** Re-use *IN06 (save value to temporary variable)                                      CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     MOVE *IN06     IND06   1                                           CGL165
     C                     MOVE *IN11     IND#11  1                                           CGL165
     C           IND11     IFEQ '1'                                                           CGL165
     C                     SETON                     11                                       CGL165
     C                     ELSE                                                               CGL165
     C                     SETOF                     11                                       CGL165
     C                     ENDIF                                                              CGL165
     C                     SETON                     06                                       CGL165
     C                     ENDIF                                                              CGL165
      *
     C                     WRITE#MSGCTL
     C/COPY WNCPYSRC,AK0020C001                                           S01408
     C                     EXFMTACKEYMM
     C*
      *                                                                                       CGL165
      ** Re-use *IN06 (revert back the value from the temporary variable)                     CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     MOVE IND06     *IN06                                               CGL165
     C                     MOVE IND#11    *IN11                                               CGL165
     C                     ENDIF                                                              CGL165
      *
     C                     SETOF                     222324
     C                     SETOF                     2527
     C                     SETOF                     054042
     C                     SETOF                     525354
     C                     SETOF                     555657
     C                     SETOF                     585960               080603
     C                     SETOF                     6162                 080603
     C**
     C** Clear messages from program message queue.
     C**
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGMQ     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C**
     C** If F3 and F12 not pressed, validate screen
     C**
     C           *IN03     IFEQ '0'                        F3 pressed  X scrn
     C           *IN12     ANDEQ'0'                        F12 pressed X scrn
     C**
     C                     SETOF                     63
     C**************************************************************      080603
     C***Load*arrays*with*valid*Dealing*Currencies*and*corresponding      080603
     C***Spot*Trade*Account*Equivalents.*Initialise*****************      080603
     C***SDCURRL1*&*count*of*no.*of*currencies*in*array*************      080603
     C***Then*process*all*records*on*SDCURRL1***********************      080603
     C***********                                                         080603
     C************LOVAL    SETLL@A6REA3                                   080603
     C***********          Z-ADD0         C       30                      080603
     C***********                                                         080603
     C************IN04     DOUEQ'1'                        Not eof(SDCURRL080603
     C***********C         ORGT 200                                       080603
     C***********                                                         080603
     C***********          READ @A6REA3                  04               080603
     C***********                                                         080603
     C***If*not*end of file, process Dealing currencies                   080603
     C***********                                                         080603
     C************IN04     IFEQ '0'                        Not eof(SDCURRL080603
     C***********                                                         080603
     C***********A6DLCI    IFEQ 'Y'                                       080603
     C***********                                                         080603
     C***Fill*Currency array                                              080603
     C***********                                                         080603
     C***********C         ADD  1         C                               080603
     C***********          MOVE A6CYCD    CCYA,C                          080603
     C***********                                                         080603
     C***Validate Spot Trade A/c Equivalents & move to array              080603
     C***********                                                         080603
     C***********A6SPAE    CHAINSDACODL0             10                   080603
     C***********                                                         080603
     C************IN10     IFEQ '1'                        A/c code invali080603
     C***********A5TOIN    OREQ 'Y'                                       080603
     C***********          SETON                     41    Errors         080603
     C***********          MOVELA6CYCD    ZAMSDA           Message paramet080603
     C***********          MOVEL'USR4226' ZAMSID           Message id.    080603
     C***********          EXSR ZASNMS                     Send message   080603
     C***********          SETOF                     10                   080603
     C***********          ELSE                            A/c code valid 080603
     C***********          MOVE A6SPAE    TAC,C                           080603
     C***********                                                  S01460 080603
     C***********A6CYCD    IFEQ BJCYCD                             S01460 080603
     C***********          MOVE TAC,C     BASETA  40               S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********                                                  S01460 080603
     C***********          END                             A/c validation 080603
     C***********                                                         080603
     C***********          END                             Not Dealing Ccy080603
     C***********                                                         080603
     C***********          END                             Eof            080603
     C***********                                                         080603
     C***********          END                             Eof or C GT 200080603
     C***********                                                         080603
     C***If*more*than 200 Dealing Currencies, send error message          080603
     C***********                                                         080603
     C***********C         IFGT 200                                       080603
     C***********          SETON                     41    Errors         080603
     C***********          MOVEL'USR4220' ZAMSID           Message id.    080603
     C***********          EXSR ZASNMS                     Send message   080603
     C***********          END                                            080603
     C***********                                                         080603
     C***Store*number of currencies loaded into array                     080603
     C***********                                                         080603
     C***********          Z-ADDC         MAXCCY  30                      080603
     C**
     C** Check F1 (Principal Account) is entered and is valid non-
     C** title account code. Mandatory for all Deal Types.
     C**
     C           F1        IFEQ *BLANKS
     C                     SETON                     52
     C                     ELSE
     C           F1        CHAINSDACODL0             52
     C                     END
     C*
     C           *IN52     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5263  Errors in MM screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F2 (Interest Accrual Account) if entered is valid
     C** non-title account code
     C**
     C           F2        IFEQ *BLANKS                    F2 blank
     C                     SETOF                     2253
     C                     ELSE
     C           F2        CHAINSDACODL0             53
     C                     SETON                     22
     C                     END
     C*
     C           *IN53     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5363
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F2PREF (Posting Ref 1 or 3?) is valid - cannot be 3 if
     C** Accrual Summary Indicator = Y (from SDGELRPD)
     C**
     C           F2PREF    IFEQ *BLANKS
     C                     SETOF                     2740
     C                     ELSE
     C                     SETON                     40
     C           F2PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C                     SETON                     2763  Errors in MM
     C                     MOVEL'USR4268' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F2PREF    IFEQ '1'
     C           F2PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C                     SETON                     2763  Errors in MM
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     END
     C**
     C** Check if F3 (Interest Income/Expense Account) is entered
     C** It must be a valid non-title account code
     C**
     C           F3        IFEQ *BLANKS
     C                     SETOF                     2354
     C                     ELSE
     C           F3        CHAINSDACODL0             54
     C                     SETON                     23
     C                     END
     C*
     C           *IN54     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5463  Errors in MM screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** If Deal Type CI, then both or neither F2 & F3 must be entered.
     C** For other Deal Types, all or none of fields F2, F2PREF & F3
     C** are required
     C**
     C           *IN34     IFEQ '1'                        CI
     C           *IN22     IFEQ '1'                        F2 entered
     C           *IN23     ANDEQ'1'                        F3 entered
     C                     ELSE
     C           *IN22     IFEQ '0'                        F2 blank
     C           *IN23     ANDEQ'0'                        F3 blank
     C                     ELSE
     C                     SETON                     535463             screen
     C                     MOVEL'USR4254' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All entered
     C                     END                             All blanks
     C                     ELSE                            Not CI
     C*
     C           *IN40     IFEQ '1'                        F2PREF entered
     C           *IN22     ANDEQ'1'                        F2 entered
     C           *IN23     ANDEQ'1'                        F3 entered
     C                     ELSE
     C           *IN40     IFEQ '0'                        F2 blank
     C           *IN22     ANDEQ'0'                        F2PREF blank
     C           *IN23     ANDEQ'0'                        F3 blank
     C                     ELSE
     C                     SETON                     532754             screen
     C                     SETON                     63                 screen
     C                     MOVEL'USR4255' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All entered
     C                     END                             All blanks
     C                     END                             CI
     C**
     C** Check F4 (Deal Date Contingent Account) if entered is valid
     C** non-title account code
     C**
     C           F4        IFEQ *BLANKS                    F2 blank
     C                     SETOF                     2455
     C                     ELSE
     C           F4        CHAINSDACODL0             55
     C                     SETON                     24
     C                     END
     C*
     C           *IN55     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5563
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F4PREF (Posting Ref 1 or 3?) is valid
     C**
     C           F4PREF    IFEQ *BLANKS
     C                     SETOF                     0542
     C                     ELSE
     C                     SETON                     42
     C           F4PREF    IFEQ '1'
     C           F4PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C                     SETON                     0563  Errors in MM
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C**
     C** Check if F5 (Contra Account) is entered
     C** It must be a valid non-title account code
     C**
     C           F5        IFEQ *BLANKS
     C                     SETOF                     2556
     C                     ELSE
     C           F5        CHAINSDACODL0             56
     C                     SETON                     25
     C                     END
     C*
     C           *IN56     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5663  Errors in MM screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** If Deal Type CI, F4 & F5 must be entered.
     C** For other Deal Types, all or none of fields F4, F4PREF & F5
     C** must be entered
     C**
     C           *IN34     IFEQ '1'                        CI
     C           *IN24     IFEQ '1'                        F4 entered
     C           *IN25     ANDEQ'1'                        F5 entered
     C                     ELSE
     C           *IN24     IFEQ '0'                        F4 blank
     C           *IN25     ANDEQ'0'                        F5 blank
     C                     ELSE
     C                     SETON                     555663             screen
     C                     MOVEL'USR4256' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All entered
     C                     END                             All blanks
     C                     ELSE                            Not CI
     C           *IN24     IFEQ '1'                        F4 entered
     C           *IN42     ANDEQ'1'                        F4PREF entered
     C           *IN25     ANDEQ'1'                        F5 entered
     C                     ELSE
     C           *IN24     IFEQ '0'                        F4 blank
     C           *IN42     ANDEQ'0'                        F4PREF blank
     C           *IN25     ANDEQ'0'                        F5 blank
     C                     ELSE
     C                     SETON                     550556             screen
     C                     SETON                     63                 screen
     C                     MOVEL'USR4253' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             CI
     C                     END                             All entered
     C                     END                             All blanks
     C**
     C** Check F6 (Rollover Suspense Account) - Optional for Deal
     C** Types IP,IT,TD,TI but not displayed for others
     C**
     C           F6        IFNE *BLANKS
     C           F6        CHAINSDACODL0             57
     C           *IN57     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5763  Errors in MM screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C**
     C** Check F7 (Non Taxable In/Exp Paid A/c) - Optional for All        080603
     C** Deal Types                                                       080603
     C**                                                                  080603
     C           F7        IFNE *BLANKS                                   S01460
     C           F8        ORNE *BLANKS                                   080603
     C*                                                                   S01460
     C           F7        CHAINSDACODL0             58                   S01460
     C*                                                                   S01460
     C           *IN58     IFEQ '1'                        A/c code inval S01460
     C           A5TOIN    OREQ 'Y'                                       S01460
     C                     SETON                     58    Errors         S01460
     C                     SETON                     63    Errors         S01460
     C***********          MOVELA6CYCD    ZAMSDA           Message S01460 080603
     C***********          MOVEL'USR4226' ZAMSID           Message S01460 080603
     C                     MOVEL'USR4230' ZAMSID           Message id.    080603
     C                     EXSR ZASNMS                     Send message   S01460
     C***********          SETOF                     58            S01460 080603
     C                     ENDIF                           A/c validation S01460
     C************         ENDIF                                   S01460 080603
     C*                                                                   S01460
     C**                                                                  080603
     C** Check F8 (Non Taxable In/Ex Paid Contra A/c) mandatory           080603
     C** when F7 entered                                                  080603
     C**                                                                  080603
     C***********F8        IFNE *BLANKS                            S01460 080603
     C*                                                                   S01460
     C           F8        CHAINSDACODL0             59                   S01460
     C*                                                                   S01460
     C           *IN59     IFEQ '1'                        A/c code inval S01460
     C           A5TOIN    OREQ 'Y'                                       S01460
     C                     SETON                     59    Errors         S01460
     C                     SETON                     63    Errors         S01460
     C***********          MOVELA6CYCD    ZAMSDA           Message S01460 080603
     C***********          MOVEL'USR4226' ZAMSID           Message S01460 080603
     C                     MOVEL'USR4230' ZAMSID           Message id.    080603
     C                     EXSR ZASNMS                     Send message   S01460
     C***********          SETOF                     59            S01460 080603
     C                     ENDIF                           A/c validation S01460
     C                     ENDIF                                          S01460
     C**                                                                  080603
     C** Check F9 (Taxable In/Exp Paid A/c) - Optional for Deal           080603
     C** Types IT,TD,CD when S01460 ON, otherwise not displayed           080603
     C**                                                                  080603
     C           F9        IFNE *BLANKS                                   080603
     C           F10       ORNE *BLANKS                                   080603
     C*                                                                   080603
     C           F9        CHAINSDACODL0             60                   080603
     C*                                                                   080603
     C           *IN60     IFEQ '1'                        A/c code inval 080603
     C           A5TOIN    OREQ 'Y'                                       080603
     C                     SETON                     60    Errors         080603
     C                     SETON                     63    Errors         080603
     C                     MOVEL'USR4230' ZAMSID           Message id.    080603
     C                     EXSR ZASNMS                     Send message   080603
     C                     ENDIF                           A/c validation 080603
     C************         ENDIF                                   S01460 080603
     C*                                                                   080603
     C**                                                                  080603
     C** Check F10 (Taxable In/Exp Paid Contra A/c)                       080603
     C** Mandatory when F9 Entered                                        080603
     C**                                                                  080603
     C*                                                                   080603
     C           F10       CHAINSDACODL0             61                   080603
     C*                                                                   080603
     C           *IN61     IFEQ '1'                        A/c code inval 080603
     C           A5TOIN    OREQ 'Y'                                       080603
     C                     SETON                     61    Errors         080603
     C                     SETON                     63    Errors         080603
     C                     MOVEL'USR4230' ZAMSID           Message id.    080603
     C                     EXSR ZASNMS                     Send message   080603
     C                     ENDIF                           A/c validation 080603
     C                     ENDIF                                          080603
     C**                                                                  080603
     C** Check F11 (Withholding Tax Account) - Mandatory for Deal         080603
     C** Types IT,TD,CD when Taxable, else not displayed                  080603
     C**                                                                  080603
     C           *IN71     IFEQ *ON                                       080603
     C           *IN29     ANDEQ*ON                                       080603
     C           *IN69     ANDEQ*OFF                                      184889
     C*                                                                   080603
     C** Default BRT tax liability Account                                080603
     C*                                                                   080603
     C           S01383    IFEQ 'Y'                                       080603
     C           F11       ANDEQ*BLANK                                    080603
     C                     MOVE ACOD      F11                             080603
     C                     ENDIF                                          080603
     C*                                                                   080603
     C           F11       CHAINSDACODL0             62                   080603
     C*                                                                   080603
     C           *IN62     IFEQ '1'                        A/c code inval 080603
     C           A5TOIN    OREQ 'Y'                                       080603
     C                     SETON                     62    Errors         080603
     C                     SETON                     63    Errors         080603
     C                     MOVEL'USR4230' ZAMSID           Message id.    080603
     C                     EXSR ZASNMS                     Send message   080603
     C                     ENDIF                           A/c validation 080603
     C**                                                                                      CGL165
     C** Check F12 (Secondary Tax) if entered is valid                                        CGL165
     C** non-title account code                                                               CGL165
     C**                                                                                      CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
      *                                                                                       CGL165
      ** Reuse *IN64 (save to temporary variables)                                            CGL165
     C                     MOVE *IN64     IND64   1                                           CGL165
     C                     MOVE '0'       IND11   1                                           CGL165
      *                                                                                       CGL165
     C           F12       CHAINSDACODL0             64                                       CGL165
     C           *IN64     IFEQ '1'                                                           CGL165
     C           A5TOIN    OREQ 'Y'                                                           CGL165
     C                     MOVE '1'       IND11                                               CGL165
     C                     SETON                     63    Errors                             CGL165
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CGL165
     C                     EXSR ZASNMS                     Send message                       CGL165
     C                     END                                                                CGL165
      *                                                                                       CGL165
      ** Reuse *IN64 (revert back the original value of *IN64)                                CGL165
     C                     MOVE IND64     *IN64                                               CGL165
     C                     ENDIF                                                              CGL165
     C                     ENDIF                           W/H Tax,BRT on 080603
      *                                                                                       CAS001
      ** If Analytical Accounting is installed, activate ACKEYAA screen                       CAS001
     C           PREVS1    TAG                                                                CDL017
      *                                                                                       CAS001
     C********** BGN0ST    IFEQ 'Y'                                                    CAS001 260980
     C********** *IN63     ANDEQ*OFF                                                   CAS001 260980
     C********** TYPE      ANDNE'ID'                                                   CAS001 260980
     C********** TYPE      ANDNE'IL'                                                   CAS001 260980
     C********** *IN63     IFEQ *OFF                                                 260980 AR738954
     C           BGN0ST    IFEQ 'Y'                                                         AR738954
     C           *IN63     ANDEQ*OFF                                                        AR738954
     C           TYPE      ANDNE'ID'                                                        AR738954
     C           TYPE      ANDNE'IL'                                                        AR738954
     C/COPY WNCPYSRC,AKH00132
     C                     MOVE 'Y'       WKSCAA  1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CAC001
      **  If Analytical Accounting is installed and fields in ACKEYMM     CAC001
      **  are valid, validate fields in ACKEYAA                           CAC001
      **  ...only if deal is not an internal funding deal                 CAC001
      *                                                                   CAC001
     C           WKSCAA    DOWEQ'Y'                                                           CAS001
      *                                                                                       CAS001
      ** This line is added, so that when ACKEYAA is activated, if user press F12             CAS001
      ** from AKEYNPV screen, the program will display ACKEYAA screen.                        CAS001
      *                                                                                       CAS001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN63     ANDEQ*OFF                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C/COPY WNCPYSRC,AKH00133
      *                                                                   CAC001
      **  Clear messages from program message queue .                     CAC001
      *                                                                   CAC001
     C                     CALL 'Y2CLMSC'                                 CAC001
     C                     PARM SPGMQ     ZAPGM                           CAC001
     C                     PARM '*SAME'   ZAPGRL                          CAC001
      *                                                                   CAC001
      **  Validate until F3 or F12 or new account codes are valid         CAC001
      *                                                                   CAC001
     C           *IN03     DOUEQ*ON                                       CAC001
     C           *IN12     OREQ *ON                                       CAC001
     C           *IN63     OREQ *OFF                                      CAC001
     C                     MOVE *OFF      *IN63                                               CAS001
     C                     WRITE#MSGCTL                                   CAC001
     C/COPY WNCPYSRC,AKH00134
     C                     EXFMTACKEYAA                                   CAC001
     C                     SETOF                     666768               CAC001
     C                     SETOF                     798485               CAC001
     C                     MOVE *OFF      *IN63                                               CAS009
      *                                                                   CAC001
      **  Clear messages from program message queue .                     CAC001
      *                                                                   CAC001
     C                     CALL 'Y2CLMSC'                                 CAC001
     C                     PARM SPGMQ     ZAPGM                           CAC001
     C                     PARM '*SAME'   ZAPGRL                          CAC001
      *                                                                   CAC001
      **  Validate account codes                                          CAC001
      *                                                                   CAC001
     C           *IN03     IFEQ *OFF                                      CAC001
     C           *IN12     ANDEQ*OFF                                      CAC001
     C/COPY WNCPYSRC,AKH00135
      *                                                                   CAC001
      **  Check SINTL (Internal Loan Account) is valid non-title          CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SINTL     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN66                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SINTL     CHAINSDACODL0             66                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN66     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6663                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SINTD (Internal Deposit Account) is valid non-title       CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SINTD     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN67                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SINTD     CHAINSDACODL0             67                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN67     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6763                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00136
      *                                                                   CAC001
      **  Check SCOFE (COF Expense Account) is valid non-title            CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SCOFE     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN68                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SCOFE     CHAINSDACODL0             68                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,AKH00137
     C           *IN68     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6863                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00138
      *                                                                   CAC001
      **  Check SACOFP (Accrued COF Payable Account) is valid non-title   CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SACOFP    IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN79                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SACOFP    CHAINSDACODL0             79                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,AKH00139
     C           *IN79     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     7963                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00140
      *                                                                   CAC001
      **  Check SCOFI (COF Income Account) is valid non-title             CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SCOFI     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN84                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SCOFI     CHAINSDACODL0             84                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,AKH00141
     C           *IN84     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     8463                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00142
      *                                                                   CAC001
      **  Check SACOFR (Accrued COF Receivable Account) is valid          CAC001
      **  non-title account code                                          CAC001
      *                                                                   CAC001
     C           SACOFR    IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN85                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SACOFR    CHAINSDACODL0             85                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C/COPY WNCPYSRC,AKH00143
     C           *IN85     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     8563                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00144
      *                                                                   CAC001
      **  New Funding Account codes must all be entered...                CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           SINTL     WHNE *BLANKS                                   CAC001
     C           SINTD     ANDNE*BLANKS                                   CAC001
     C           SCOFE     ANDNE*BLANKS                                   CAC001
     C           SACOFP    ANDNE*BLANKS                                   CAC001
     C           SCOFI     ANDNE*BLANKS                                   CAC001
     C           SACOFR    ANDNE*BLANKS                                   CAC001
     C                     MOVE 'N'       WBLANK                          CAC001
      *                                                                   CAC001
      **  ...or all be blanks                                             CAC001
      *                                                                   CAC001
     C           SINTL     WHEQ *BLANKS                                   CAC001
     C           SINTD     ANDEQ*BLANKS                                   CAC001
     C           SCOFE     ANDEQ*BLANKS                                   CAC001
     C           SACOFP    ANDEQ*BLANKS                                   CAC001
     C           SCOFI     ANDEQ*BLANKS                                   CAC001
     C           SACOFR    ANDEQ*BLANKS                                   CAC001
     C                     MOVE 'Y'       WBLANK                          CAC001
      *                                                                   CAC001
      **  Otherwise, send an error message                                CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     SETON                     666768               CAC001
     C                     SETON                     798485               CAC001
     C                     SETON                     63                   CAC001
     C                     MOVEL'USR4273' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDSL                                          CAC001
     C/COPY WNCPYSRC,AKH00145
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                                       CDL017
      ** Display the EU Withholding Tax screen if necessary.                                  CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           *IN03     ANDEQ*OFF                                                        AR738954
     C           *IN12     ANDEQ*OFF                                                        AR738954
     C           *IN63     ANDEQ*OFF                                                        AR738954
     C           CER048    OREQ 'Y'                                                           CER048
     C           *IN03     ANDEQ*OFF                                                          CGL031
     C           *IN12     ANDEQ*OFF                                                          CGL031
     C           *IN63     ANDEQ*OFF                                                          CGL031
     C                     EXSR SREWTA                                                        CGL031
      *                                                                                       CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     EXSR SRGWST                                                        CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     EXSR SRGWTT                                                        CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           WEWTA     IFEQ 'Y'                                                           CGL031
     C           WGWST     OREQ 'Y'                                                           CER048
     C           WGWTT     OREQ 'Y'                                                           CER054
     C                     EXSR SRDTAX                                                        CGL031
      *                                                                                       CGL031
      ** Force the AcKeyAA screen on F12.                                                     CGL031
      *                                                                                       CGL031
     C           *IN12     IFEQ *ON                                                           CGL031
     C                     MOVE *OFF      *IN12                                               CGL031
     C                     MOVE *ON       *IN63                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Skip account key generation on F3.                                                   CGL031
      *                                                                                       CGL031
     C           *IN03     IFEQ *ON                                                           CGL031
     C                     MOVE *ON       *IN63                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                          CAC001
      *                                                                                       CAS001
      ** From ACKEYAA screen, if no function key is pressed and no error, proceed to          CAS001
      ** AKEYNPV screen                                                                       CAS001
      *                                                                                       CAS001
     C           *IN12     IFEQ *OFF                                                          CAS001
     C           *IN03     ANDEQ*OFF                                                          CAS001
     C           *IN63     ANDEQ*OFF                                                          CAS001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CAC001
      **  If F12 pressed, set off *IN12 and set on *IN63 for ACKEYMM      CAC001
      **  to be re-displayed                                              CAC001
      *                                                                   CAC001
     C           *IN12     IFEQ *ON                                       CAC001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     MOVE '0'       *IN12                           CAC001
     C                     MOVE '1'       *IN63                           CAC001
      *                                                                   CAC001
      **  If F3 pressed, set on *IN63 to skip a/c key generation          CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
     C           *IN03     IFEQ *ON                                       CAC001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     MOVE '1'       *IN63                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                                       CDL017
      **  Display second screen if deal type is either TD, TI, IP, IT                         CDL017
      *                                                                                       CDL017
     C           *IN12     IFEQ *OFF                                                          CDL017
     C           *IN03     ANDEQ*OFF                                                          CDL017
     C           *IN63     ANDEQ*OFF                                                          CDL017
     C           TYPE      IFEQ 'TD'                                                          CDL017
     C           TYPE      OREQ 'TI'                                                          CDL017
     C           TYPE      OREQ 'IP'                                                          CDL017
     C           TYPE      OREQ 'IT'                                                          CDL017
     C                     EXSR MMP1                                                          CDL017
     C           WKSCAA    IFEQ 'Y'                                                           CDL017
     C                     GOTO PREVS1                                                        CDL017
     C                     ENDIF                                                              CDL017
     C                     ENDIF                                                              CDL017
     C                     ENDIF                                                              CDL017
      *                                                                                       CAS001
      ** Call subroutine that displays NPV screen (if CAS001 is installed)                    CAS001
      *                                                                                       CAS001
     C                     MOVE 'MMP'     WKSUBR  3                                           CAS001
     C                     EXSR SRDNPV                                                        CAS001
      *                                                                                       CAS009
      ** Display the Fee amortisation screen if necessary.                                    CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           *IN03     ANDEQ*OFF                                                          CAS009
     C           *IN12     ANDEQ*OFF                                                          CAS009
     C           *IN63     ANDEQ*OFF                                                          CAS009
     C                     EXSR SREFEA                                                        CAS009
      *                                                                                       CAS009
     C           WEFEA     IFEQ 'Y'                                                           CAS009
     C                     EXSR SRDFEA                                                        CAS009
      *                                                                                       CAS009
      ** Force the AcKeyAA screen on F12.                                                     CAS009
      *                                                                                       CAS009
     C           *IN12     IFEQ *ON                                                           CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
     C                     MOVE *OFF      *IN12                                               CAS009
     C                     MOVE *ON       *IN63                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Skip account key generation on F3.                                                   CAS009
      *                                                                                       CAS009
     C           *IN03     IFEQ *ON                                                           CAS009
     C                     MOVE *ON       *IN63                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ELSE                                                             AR983834
     C                     MOVE ' '       WKSCAA                                            AR983834
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS001
      *                                                                                       CAS001
      ** If Analytical accounting is not installed, from ACKEYMM screen, proceed to           CAS001
      ** AKEYNPV screen                                                                       CAS001
      *                                                                                       CAS001
     C           BGN0ST    IFNE 'Y'                                                           CAS001
     C           *IN63     ANDEQ*OFF                                                          CAS001
     C           TYPE      OREQ 'ID'                                                          CAS001
     C           *IN63     ANDEQ*OFF                                                          CAS001
     C           TYPE      OREQ 'IL'                                                          CAS001
     C           *IN63     ANDEQ*OFF                                                          CAS001
     C                     MOVE 'MMP'     WKSUBR                                              CAS001
     C                     EXSR SRDNPV                                                        CAS001
     C           *IN12     IFEQ '1'                                                           CAS001
     C                     MOVE *OFF      *IN12                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS009
      ** Display the Fee amortisation screen if necessary.                                    CAS009
      *                                                                                       CAS009
     C           BGN0ST    IFNE 'Y'                                                           CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           *IN03     ANDEQ*OFF                                                          CAS009
     C           *IN12     ANDEQ*OFF                                                          CAS009
     C           *IN63     ANDEQ*OFF                                                          CAS009
     C                     EXSR SREFEA                                                        CAS009
      *                                                                                       CAS009
     C           WEFEA     IFEQ 'Y'                                                           CAS009
     C                     EXSR SRDFEA                                                        CAS009
      *                                                                                       CAS009
     C           *IN12     IFEQ *ON                                                           CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
     C                     MOVE *OFF      *IN12                                               CAS009
     C                     MOVE *ON       *IN62                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Skip account key generation on F3.                                                   CAS009
      *                                                                                       CAS009
     C           *IN03     IFEQ *ON                                                           CAS009
     C                     MOVE *ON       *IN63                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CGL031
      ** Display the EU Withholding Tax screen if necessary.                                  CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           BGN0ST    ANDNE'Y'                                                         AR738954
     C           *IN03     ANDEQ*OFF                                                        AR738954
     C           *IN12     ANDEQ*OFF                                                        AR738954
     C           *IN63     ANDEQ*OFF                                                        AR738954
     C           CER048    OREQ 'Y'                                                           CER048
     C           BGN0ST    ANDNE'Y'                                                           CGL031
     C           *IN03     ANDEQ*OFF                                                          CGL031
     C           *IN12     ANDEQ*OFF                                                          CGL031
     C           *IN63     ANDEQ*OFF                                                          CGL031
     C                     EXSR SREWTA                                                        CGL031
      *                                                                                       CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     EXSR SRGWST                                                        CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     EXSR SRGWTT                                                        CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           WEWTA     IFEQ 'Y'                                                           CGL031
     C           WGWST     OREQ 'Y'                                                           CER048
     C           WGWTT     OREQ 'Y'                                                           CER054
     C                     EXSR SRDTAX                                                        CGL031
      *                                                                                       CGL031
      ** Force the AcKeyMM screen on F12.                                                     CGL031
      *                                                                                       CGL031
     C           *IN12     IFEQ *ON                                                           CGL031
     C                     MOVE *OFF      *IN12                                               CGL031
     C                     MOVE *ON       *IN63                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Skip account key generation on F3.                                                   CGL031
      *                                                                                       CGL031
     C           *IN03     IFEQ *ON                                                           CGL031
     C                     MOVE *ON       *IN63                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
     C*                                                                   080603
     C** If errors exist, do not continue processing
     C**
     C           *IN63     IFEQ '0'
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CCP2                                           S01408
     C**
     C** Set up all fields for ACKEY output/update
     C** Account key is always created, but non-key fields are only
     C** added if the appropriate fields have been entered on screen
     C**
     C                     MOVE *BLANK    DLKEY
     C                     MOVE TYPE      DTYPD
     C                     MOVE STYP      STYPD
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE *BLANK    FMKEYS
     C**
     C** Deal Date Keys    *** All Deal Types ***
     C***********                                                         062855
     C***Determine*if*Asset*or*Liability*(for*DR/DC*decisions)*********   062855
     C***********                                                         062855
     C                     SETOF                     36
     C************IN16     IFEQ '1'                        Deal Type IP   062855
     C************IN02     OREQ '1'                        Deal Type TI   062855
     C************IN19     OREQ '1'                        Deal Type CL   062855
     C************         ELSE                            CD,IT,TD,CI    062855
     C************         SETON                     36    Liability      062855
     C************         END                                            062855
     C*                                                                   080603
     C** Determine if Asset or Liability (for DR/DC decisions)            080603
     C*  (REINSTATED)                                                     080603
     C           *IN29     IFEQ '1'                        CD,IT,TD       080603
     C           *IN20     OREQ '1'                        Deal Type ID   105599
     C           *IN34     OREQ '1'                        Deal Type CI   080603
     C                     SETON                     36    Liability      080603
     C                     END                                            080603
     c**                                                                                      245915
     C           CDL039    IFEQ 'Y'                                                           245915
     C**                                                                                    BUG10281
     C** TRANSFER PRINCIPAL Key                                                             BUG10281
     C** Format Key XXTYY....A                                                              BUG10281
     C**                                                                                    BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE 'A'       AMTD                                              BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C** Set up fields                                                                      BUG10281
     C                     MOVE F1        AC1                                               BUG10281
     C*                                                                                     BUG10281
     C* Set up posting reference & narrative depending on Deal Type                         BUG10281
     C*                                                                                     BUG10281
     C           *IN34     IFEQ '1'                        CI                               BUG10281
     C                     MOVE '04'      PN1                                               BUG10281
     C                     MOVE '1'       PR1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '3'       PR1                                               BUG10281
     C           *IN19     IFEQ '1'                        CL, IP                           BUG10281
     C           *IN16     OREQ '1'                         TI                              BUG10281
     C           *IN02     OREQ '1'                                                         BUG10281
     C                     MOVE '21'      PN1                                               BUG10281
     C                     ELSE                            CD, IT, TD                       BUG10281
     C                     MOVE '04'      PN1                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C** Update file                                                                        BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C**                                                                                    BUG10281
     C** TRANSFER INTEREST Key                                                              BUG10281
     C** Format Key XXTYY....I                                                              BUG10281
     C**                                                                                    BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE ' I'      DLKEY                                             BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C** Set up Fields                                                                      BUG10281
     C           F2        IFNE *BLANKS                                                     BUG10281
     C                     MOVE F2        AC1                                               BUG10281
     C*                                                                                     BUG10281
     C** Set up posting reference, depending on whether Deal Type CI                        BUG10281
     C*                                                                                     BUG10281
     C           *IN34     IFEQ '1'                        Deal Type CI                     BUG10281
     C                     MOVE '1'       PR1                                               BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     ELSE                            Not CI                           BUG10281
     C                     MOVE F2PREF    PR1                                               BUG10281
     C           F2PREF    IFEQ '1'                                                         BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '26'      PN1                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C                     END                             F2 entered                       BUG10281
     C**                                                                                    BUG10281
     C* Update file                                                                         BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C**                                                                                      245915
     C                     ENDIF                                                              245915
     C**
     C** Format Key XXDYY....A
     C**
     C                     MOVE 'D'       EVENTD
     C                     MOVE 'A'       AMTD
     C*
     C* Set up Debit & Credit fields
     C* - if F5 entered (and therefore F4 also entered)
     C*
     C           F5        IFNE *BLANKS
     C                     MOVE F5        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     MOVE F4        AC1
     C*
     C* Set up posting reference depending upon whether Deal Type is CI
     C*
     C           *IN34     IFEQ '1'
     C                     MOVE '1'       PR1
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE F4PREF    PR1
     C*
     C* If Posting Reference is 1, then Narrative is 01. Otherwise it
     C* is either 21 or 04 depending on the Deal Type entered
     C*
     C           PR1       IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C           *IN19     IFEQ '1'                        Deal Type CL
     C           *IN16     OREQ '1'                        IP
     C           *IN02     OREQ '1'                        or TI
     C                     MOVE '21'      PN1
     C                     ELSE                            CD, IT , TD
     C                     MOVE '04'      PN1
     C                     END                             CL/IP/TI
     C                     END                             PR1 = 1
     C                     END                             CI
     C                     END                             F5 entered
     C* Update file
     C                     EXSR ACUP
     C***********                                                  062855 080603
     C***Determine*if*Asset*or*Liability*(for*DR/DC*decisions)     062855 080603
     C***********                                                  062855 080603
     C************IN16     IFEQ '1'                        Deal Type IP55 080603
     C************IN02     OREQ '1'                        Deal Type TI55 080603
     C************IN19     OREQ '1'                        Deal Type CL55 080603
     C***********          ELSE                            CD,IT,TD,CI855 080603
     C***********          SETON                     36    Liability62855 080603
     C***********          END                                     062855 080603
     C**
     C** Value Date Keys           *** All Deal Types ***
     C**
     C** Format Key XXVYY....A
     C**
     C                     MOVE 'V'       EVENTD
     C                     MOVE *BLANK    FMKEYS                          080603
     C** Set up fields
     C                     MOVE F1        AC1
     C*
     C* If Deal Type is CI, then posting reference 4 is 1, otherwise
     C* it is hard coded as 2
     C*
     C** If Front up Interest xxVyy....N key used for settlement          080603
     C*                                                                   080603
     C           ASFUID    IFNE 'Y'                                       080603
     C                     MOVE '    '    AC4
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C                     ENDIF                                          080603
     C*
     C* Set up posting reference & narrative depending on Deal Type
     C*
     C           *IN34     IFEQ '1'                        CI
     C                     MOVE '04'      PN1
     C                     MOVE '1'       PR1
     C                     ELSE
     C                     MOVE '3'       PR1
     C           *IN19     IFEQ '1'                        CL, IP
     C           *IN16     OREQ '1'                         TI
     C           *IN02     OREQ '1'
     C                     MOVE '21'      PN1
     C                     ELSE                            CD, IT, TD
     C                     MOVE '04'      PN1
     C                     END
     C                     END
     C*
     C* If F5 entered (and therefore F4 also entered)
     C*
     C           F5        IFNE *BLANKS
     C                     MOVE F5        AC2
     C                     MOVE '01'      PN2
     C                     MOVE '1'       PR2
     C                     MOVE F4        AC5
     C*
     C** Set up posting reference, depending on whether Deal Type CI
     C*
     C           *IN34     IFEQ '1'                        Deal Type=CI
     C                     MOVE '1'       PR5
     C                     MOVE '01'      PN5
     C                     ELSE                            Not CI
     C                     MOVE F4PREF    PR5
     C*
     C* If Posting Reference is 1, then Narrative is 01. If Posting
     C* Reference is 3, then Narrative is dependant on Deal Type
     C*
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN5
     C                     ELSE
     C           *IN16     IFEQ '1'                        Deal Type IP
     C           *IN19     OREQ '1'                        Deal Type CL
     C           *IN02     OREQ '1'                        Deal Type TI
     C                     MOVE '21'      PN5
     C                     ELSE
     C                     MOVE '04'      PN5
     C                     END                             IP/CL/TI
     C                     END                             F4PREF = 1
     C                     END                             Deal Type CI
     C                     END                             F5 entered
     C** Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and loans/deposits...                CAC001
      **  ...not internal funding deals                                   CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C           *IN34     IFEQ *ON                                       CAC001
     C                     MOVE '04'      PN4                             CAC001
     C                     ELSE                                           CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**                                                                  080603
     C** Format Key XXVYY....I for Front Up Interest                      080603
     C**                                                                  080603
     C                     MOVE *BLANK    FMKEYS                          080603
     C           ASFUID    IFEQ 'Y'                                       080603
     C                     MOVE 'I'       AMTD                            080603
     C           F2        IFNE *BLANKS                                   080603
     C                     MOVE F2        AC4                             080603
     C*                                                                   080603
     C** Set up posting reference, depending on whether Deal Type CI      080603
     C*                                                                   080603
     C           *IN34     IFEQ '1'                        Deal Type CI   080603
     C                     MOVE '1'       PR4                             080603
     C                     MOVE '01'      PN4                             080603
     C                     ELSE                            Not CI         080603
     C                     MOVE F2PREF    PR4                             080603
     C           F2PREF    IFEQ '1'                                       080603
     C                     MOVE '01'      PN4                             080603
     C                     ELSE                                           080603
     C                     MOVE '08'      PN4                             080603
     C                     END                                            080603
     C                     END                                            080603
     C                     END                                            080603
     C*                                                                   080603
     C                     EXSR ACUP                                      080603
     C**                                                                  080603
     C** Format Key XXVYY....N for Front Up Interest Settlement           080603
     C**                                                                  080603
     C                     MOVE 'N'       AMTD                            080603
     C                     MOVE *BLANK    FMKEYS                          080603
     C                     MOVE '    '    AC4                             080603
     C                     MOVE '01'      PN4                             080603
     C                     MOVE '2'       PR4                             080603
     C                     EXSR ACUP                                      080603
     C                     ENDIF                           Front up Int.  080603
      *                                                                   CDL006
      ** If feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'FT'                                      CDL006
     C           TYPE      OREQ 'DT'                                      CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXVYY....X for Charge.                                CDL006
      *                                                                   CDL006
     C                     MOVE ' X'      DLKEY                           CDL006
     C                     MOVE *BLANKS   FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
      ** Format Key XXVYY...TX for Tax on charge.                         CDL006
      *                                                                   CDL006
     C                     MOVE 'TX'      DLKEY                           CDL006
     C                     MOVE *BLANKS   FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    FBD                             CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C002
     C**
     C** Rollover Value Date Keys     *** Deal Types IP,IT,TD,TI ***
     C**
     C           TYPE      IFEQ 'IP'
     C           TYPE      OREQ 'IT'
     C           TYPE      OREQ 'TD'
     C           TYPE      OREQ 'TI'
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C**
     C** Format Key XXVYY....R
     C**
     C                     MOVE 'R'       AMTD
     C** Set up fields
     C                     MOVE *BLANK    FMKEYS
     C***********F6        IFNE *BLANKS                                   080603
     C** For Enhanced Rollovers Principal Posted using xxRyy....B, or     080603
     C**     xxRyy....C keys                                              080603
     C           S01434    IFNE 'Y'                        Enhcd Rolovr   080603
     C                     MOVE F1        AC1
     C           TYPE      IFEQ 'IP'
     C           TYPE      OREQ 'TI'
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE '21'      PN1
     C                     ELSE
     C                     MOVE '04'      PN1
     C                     END
     C                     MOVE '3'       PR1
     C                     ENDIF                           Enhcd Rolovr   080603
     C*
     C* If F5 entered (and therefore F4 also entered)
     C*
     C***********F5        IFNE *BLANKS                                   062855
     C***********          MOVE F5        AC2                             062855
     C***********          MOVE '01'      PN2                             062855
     C***********          MOVE '1'       PR2                             062855
     C***********          MOVE F4        AC5                             062855
     C***********F4PREF    IFEQ '1'                                       062855
     C***********          MOVE '01'      PN5                             062855
     C***********          MOVE '1'       PR5                             062855
     C***********          ELSE                                           062855
     C***********TYPE      IFEQ 'IP'                                      062855
     C***********TYPE      OREQ 'TI'                                      062855
     C***********          MOVE '21'      PN5                             062855
     C***********          ELSE                                           062855
     C***********          MOVE '04'      PN5                             062855
     C***********          END                                            062855
     C***********          MOVE '3'       PR5                             062855
     C***********          END                                            062855
     C***********          END                                            062855
     C           F5        IFNE *BLANKS                                   080603
     C                     MOVE F5        AC2                             080603
     C                     MOVE '01'      PN2                             080603
     C                     MOVE '1'       PR2                             080603
     C                     MOVE F4        AC5                             080603
     C           F4PREF    IFEQ '1'                                       080603
     C                     MOVE '01'      PN5                             080603
     C                     MOVE '1'       PR5                             080603
     C                     ELSE                                           080603
     C           TYPE      IFEQ 'IP'                                      080603
     C           TYPE      OREQ 'TI'                                      080603
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE '21'      PN5                             080603
     C                     ELSE                                           080603
     C                     MOVE '04'      PN5                             080603
     C                     END                                            080603
     C                     MOVE '3'       PR5                             080603
     C                     END                                            080603
     C                     END                                            080603
     C*
     C           F6        IFNE *BLANKS                                   080603
     C                     MOVE F6        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     END
     C* Update file
     C                     EXSR ACUP
     C*
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           S01434    ANDEQ'Y'                                       CEU015
     C**                                                                  CEU015
     C** Format Key xxVyy...XR                                            CEU015
     C**                                                                  CEU015
     C                     MOVE 'X'       FBD                             CEU015
     C** Set up fields                                                    CEU015
     C                     MOVE *BLANK    FMKEYS                          CEU015
     C                     MOVE F1        AC1                             CEU015
     C                     MOVE '3'       PR1                             CEU015
     C           TYPE      IFEQ 'IP'                                      CEU015
     C           TYPE      OREQ 'TI'                                      CEU015
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE '21'      PN1                             CEU015
     C                     ELSE                                           CEU015
     C                     MOVE '04'      PN1                             CEU015
     C                     END                                            CEU015
     C           F5        IFNE *BLANKS                                   CEU015
     C                     MOVE F5        AC2                             CEU015
     C                     MOVE '01'      PN2                             CEU015
     C                     MOVE '1'       PR2                             CEU015
     C                     MOVE F4        AC5                             CEU015
     C           F4PREF    IFEQ '1'                                       CEU015
     C                     MOVE '01'      PN5                             CEU015
     C                     MOVE '1'       PR5                             CEU015
     C                     ELSE                                           CEU015
     C           TYPE      IFEQ 'IP'                                      CEU015
     C           TYPE      OREQ 'TI'                                      CEU015
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE '21'      PN5                             CEU015
     C                     ELSE                                           CEU015
     C                     MOVE '04'      PN5                             CEU015
     C                     END                                            CEU015
     C                     MOVE '3'       PR5                             CEU015
     C                     END                                            CEU015
     C                     END                                            CEU015
     C*                                                                   CEU015
     C           F6        IFNE *BLANKS                                   CEU015
     C                     MOVE F6        AC4                             CEU015
     C                     MOVE '01'      PN4                             CEU015
     C                     MOVE '1'       PR4                             CEU015
     C                     END                                            CEU015
     C* Update file                                                       CEU015
     C                     EXSR ACUP                                      CEU015
     C                     MOVE *BLANK    FBD                             CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   CEU015
     C                     END                             IP/IT/TD/TI
     C**
     C** Principal Increase Keys       *** Types CL,CD ******
     C**
     C           *IN19     IFEQ '1'                        If Type CL
     C           *IN20     OREQ '1'                        or Type CD
     C           TYPE      OREQ 'IP'                                                        MD027308
     C           WPIPD     ANDEQ'Y'                                                         MD027308
     C           TYPE      OREQ 'IT'                                                        MD027308
     C           WPIPD     ANDEQ'Y'                                                         MD027308
     C           TYPE      OREQ 'TD'                                                       MD027308A
     C           TYPE      OREQ 'TI'                                                       MD027308A
     C**
     C** Format Key XXVYY...IA
     C**
     C                     MOVE 'IA'      DLKEY
     C** Set up Fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F1        AC1
     C*
     C           *IN19     IFEQ '1'                        Deal Type CL
     C                     MOVE '21'      PN1
     C                     ELSE                            Deal Type CD
     C                     MOVE '04'      PN1
     C                     END
      *                                                                                    MD027308B
     C           TYPE      IFEQ 'IP'                                                       MD027308B
     C           TYPE      OREQ 'TI'                                                       MD027308B
     C                     MOVE '21'      PN1                                              MD027308B
     C                     ENDIF                                                           MD027308B
      *                                                                                    MD027308B
     C           TYPE      IFEQ 'IT'                                                       MD027308B
     C           TYPE      OREQ 'TD'                                                       MD027308B
     C                     MOVE '04'      PN1                                              MD027308B
     C                     ENDIF                                                           MD027308B
     C*
     C                     MOVE '3'       PR1
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C** Update file
     C                     EXSR ACUP
      *                                                                   CDL006
      ** If Feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'DT'                                      CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXVYY...IN for Net amount to be settled.              CDL006
      *                                                                   CDL006
     C                     MOVE 'IN'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    FBD                             CDL006
     C                     MOVE 'IA'      DLKEY                           CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C003
      *                                                                   CAC001
      **  If Anal Acctg is installed and call/notice/demand loans/        CAC001
      **  deposits                                                        CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyT..IA                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyF..IA                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C*
     C                     END                             CL&CD
     C**
     C** Interest Accrual Keys       *** All Deal Types ***
     C**
     C** Format Key XXAYY....A
     C**
     C                     MOVE 'A'       EVENTD
     C                     MOVE ' A'      DLKEY
     C** Set up Fields
     C                     MOVE *BLANK    FMKEYS
     C           F2        IFNE *BLANKS
     C                     MOVE F2        AC1
     C*
     C** Set up posting reference, depending on whether Deal Type CI
     C*
     C           *IN34     IFEQ '1'                        Deal Type CI
     C                     MOVE '1'       PR1
     C                     MOVE '01'      PN1
     C                     ELSE                            Not CI
     C                     MOVE F2PREF    PR1
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '26'      PN1
     C                     END
     C                     END
     C*
     C                     MOVE '01'      PN4
     C                     MOVE F3        AC4
     C                     MOVE '1'       PR4
     C                     END                             F2 entered
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CCBU                                           S01408
     C**                                                                  S01408
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and loans/deposits...                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
     C/COPY WNCPYSRC,AKH00146
      *                                                                   CAC001
      **  Set up account key xxAyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
     C/COPY WNCPYSRC,AKH00147
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     MOVE SCOFI     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SCOFE     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SACOFP    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00148
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxAyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
     C/COPY WNCPYSRC,AKH00149
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SCOFE     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SACOFR    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SCOFI     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,AKH00150
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CDL006
      ** If feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'FT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXAYY....C for Accrued commission not yet posted.     CDL006
      *                                                                   CDL006
     C                     MOVE ' C'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C004
     C**
     C** Interest Payment Date Keys       *** All Deal Types ***
     C**
     C** Format Key XXIYY....I
     C**
     C                     MOVE 'I'       EVENTD
     C                     MOVE 'I'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C* No Interim Interest for Front Up Interest                         080603
     C           ASFUID    IFNE 'Y'                                       080603
     C*                                                                   080603
     C           F2        IFNE *BLANKS
     C* If no Withholding tax or BRT to be deducted, Settle Gross Int.    080603
     C           *IN71     IFEQ *OFF                                      080603
     C           *IN29     OREQ *OFF                                      080603
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     ENDIF                                          080603
     C                     MOVE F2        AC4
     C*
     C** Set up posting reference, depending on whether Deal Type CI
     C*
     C           *IN34     IFEQ '1'
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     ELSE
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END                             Type CI
     C                     END                             F2 entered
     C*                                                                   080603
     C** Add Interest Paid (Non Tax) Accounting                           080603
     C*                                                                   080603
     C           F7        IFNE *BLANKS                                   080603
     C           F8        ANDNE*BLANKS                                   080603
     C                     MOVE F7        AC5                             080603
     C                     MOVE '01'      PN5                             080603
     C                     MOVE '1'       PR5                             080603
     C                     MOVE F8        AC2                             080603
     C                     MOVE '01'      PN2                             080603
     C                     MOVE '1'       PR2                             080603
     C                     END                                            080603
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBDU                                           S01408
     C**                                                                  S01408
     C*
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and loans/deposits...                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SACOFR    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SACOFP    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**                                                                  S01460
     C***Format*Key*XXMYY...TI**********                           S01460 080603
     C** Format Key XXIYY...TI                                            080603
     C**                                                                  S01460
     C***********S01460    IFEQ 'Y'                                S01460 080603
     C** If Deal Type IT, TD,or CD                                        080603
     C*                                                                   S01460
B001 C           *IN29     IFEQ *ON                                       S01460
     C** If W/H Tax                                                       080603
B002 C           *IN70     IFEQ *ON                                       080603
     C*                                                                   S01460
     C                     MOVE 'T'       FBD                             S01460
     C                     MOVE 'I'       AMTD                            S01460
     C                     MOVE *BLANKS   FMKEYS                          S01460
     C*                                                                   S01460
B003 C           F2        IFNE *BLANKS                                   S01460
     C                     MOVE F2        AC4                             S01460
     C                     MOVE F2PREF    PR4                             S01460
     C*                                                                   S01460
B004 C           F2PREF    IFEQ '1'                                       S01460
     C                     MOVE '01'      PN4                             S01460
X004 C                     ELSE                                           S01460
     C                     MOVE '24'      PN4                             S01460
E004 C                     ENDIF                                          S01460
     C*                                                                   S01460
     C***********F7        IFNE *BLANKS                            S01460 080603
     C***********F3        ANDNE*BLANKS                            S01460 080603
     C***********          MOVE F3        AC1                      S01460 080603
     C***********          MOVE '01'      PN1                      S01460 080603
     C***********          MOVE '1'       PR1                      S01460 080603
     C***********          MOVE F7        AC5                      S01460 080603
     C*                                                                   080603
     C** Add Interest Paid (Taxable) Accounting                           080603
     C*                                                                   080603
     C           F9        IFNE *BLANKS                                   080603
     C           F10       ANDNE*BLANKS                                   080603
     C                     MOVE F10       AC2                             080603
     C                     MOVE '01'      PN2                             080603
     C                     MOVE '1'       PR2                             080603
     C                     MOVE F9        AC5                             080603
     C                     MOVE '01'      PN5                             S01460
     C                     MOVE '1'       PR5                             S01460
E004 C                     ENDIF                                          S01460
E003 C                     ENDIF                                          S01460
     C*                                                                   S01460
     C                     EXSR ACUP                                      S01460
      * If CDL013 is On, also format Gross Taxable key XXIYY..GTI                           MD053762
     C           CDL013    IFEQ 'Y'                                                         MD053762
     C                     MOVE 'G'       GRS                                               MD053762
     C                     MOVE '01'      PN1                                               MD053762
     C                     MOVE '2'       PR1                                               MD053762
     C                     EXSR ACUP                                                        MD053762
     C                     MOVE *BLANKS   GRS                                               MD053762
     C                     ENDIF                                                            MD053762
E002 C                     ENDIF                                          080603
     C**                                                                  S01460
     C***Format*Key*XXMYY...N******                                S01460 080603
     C** Format Key XXIYY....N                                            080603
     C**                                                                  080603
     C** If BRT or W/H Tax Generate xxIyy....N & xxIyy....T keys          080603
     C**                                                                  S01460
B002 C           *IN71     IFEQ *ON                                       080603
     C                     MOVE *BLANKS   FBD                             S01460
     C                     MOVE 'N'       AMTD                            S01460
     C                     MOVE *BLANKS   FMKEYS                          S01460
     C*                                                                   S01460
     C***********F7        IFNE *BLANKS                            S01460 080603
     C                     MOVE '01'      PN1                             S01460
     C                     MOVE '2'       PR1                             S01460
     C***********          ENDIF                                   S01460 080603
     C*                                                                   S01460
     C                     EXSR ACUP                                      S01460
      * If CDL013 is On, also format Gross Net key XXIYY..G.N                               MD053762
     C           CDL013    IFEQ 'Y'                                                         MD053762
     C                     MOVE 'G'       GRS                                               MD053762
     C                     MOVE *BLANKS   PN1                                               MD053762
     C                     MOVE *BLANKS   PR1                                               MD053762
     C                     EXSR ACUP                                                        MD053762
     C                     MOVE *BLANKS   GRS                                               MD053762
     C                     ENDIF                                                            MD053762
     C**                                                                  S01460
     C***Format*Key*XXMYY...T********                              S01460 080603
     C** Format Key XXIYY....T                                            080603
     C**                                                                  S01460
     C                     MOVE 'T'       AMTD                            S01460
     C                     MOVE *BLANKS   FMKEYS                          S01460
     C                     MOVE F11       AC1                             080603
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD4                                           S01408
     C**                                                                  S01408
     C                     MOVE '01'      PN1                             080603
     C                     MOVE '1'       PR1                             080603
     C                     EXSR ACUP                                      080603
      * If CDL013 is On, also format Gross Tax key XXIYY..G.T                               MD053762
     C           CDL013    IFEQ 'Y'                                                         MD053762
     C                     MOVE 'G'       GRS                                               MD053762
     C                     MOVE '01'      PN4                                               MD053762
     C                     MOVE '2'       PR4                                               MD053762
     C                     EXSR ACUP                                                        MD053762
     C                     MOVE *BLANKS   GRS                                               MD053762
     C                     ENDIF
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD5                                           S01408
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C** Format Key XXIYY...2T                                                                CGL165
     C**                                                                                      CGL165
     C                     MOVE '2'       FBD                                                 CGL165
     C                     MOVE 'T'       AMTD                                                CGL165
     C                     MOVE *BLANKS   FMKEYS                                              CGL165
     C                     MOVE F12       AC1                                                 CGL165
     C                     MOVE '01'      PN1                                                 CGL165
     C                     MOVE '1'       PR1                                                 CGL165
     C                     EXSR ACUP                                                          CGL165
     C                     MOVE ' '       FBD                                                 CGL165
     C                     ENDIF                                                              CGL165
     C**                                                                  S01408
     C**********                                                   S01460 080603
     C***********F8        IFNE *BLANKS                            S01460 080603
     C**********           EXSR MMCCY                              S01460 080603
     C**********           ENDIF                                   S01460 080603
E002 C                     ENDIF                                          S01460
E001 C                     ENDIF                                          S01460
     C                     ENDIF                           No FU Int.     080603
     C**
     C** Interest Capitalisation Keys      *** All except CI ***
     C**
     C***********TYPE      IFNE 'CI'                       Not CI         067842
B001 C           *IN19     IFEQ '1'                        If type CL     067842
     C           *IN20     OREQ '1'                        or type CD     067842
     C**
     C** Format Key XXIYY....C
     C**
     C                     MOVE 'C'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C*
     C* Only write accounting entries to key if F2 is entered
     C*
B002 C           F2        IFNE *BLANKS
     C                     MOVE F1        AC1
     C                     MOVE '3'       PR1
     C                     MOVE '24'      PN1
     C*                                                                   080603
     C** If Withholding Tax or BRT ON, and Deal type CD (to be here),     080603
     C** Gross interest key has already been generated by xxIyy....I or   080603
     C** xxIyy...TI to clear the F2 - Accrual Account.                    080603
     C*                                                                   080603
B003 C           *IN71     IFEQ *OFF                                      080603
     C           *IN29     OREQ *OFF                                      080603
     C*                                                                   080603
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
B004 C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
X004 C                     ELSE
     C                     MOVE '24'      PN4
E004 C                     END
E003 C                     END                                            080603
E002 C                     END
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD3                                           S01408
     C**                                                                  S01408
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and call/notice/demand loans/        CAC001
      **  deposits                                                        CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyT...C                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyF...C                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
E001 C                     END                             CL,CD          080603
      *                                                                   CDL006
      ** If feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'FT'                                      CDL006
     C           TYPE      OREQ 'DT'                                      CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXIYY...OC for Commission.                            CDL006
      *                                                                   CDL006
     C                     MOVE 'OC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
      ** Format Key XXIYY...AC for Commission due to agent.               CDL006
      *                                                                   CDL006
     C                     MOVE 'AC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
      ** Format Key XXIYY...TC for Tax on commissiom.                     CDL006
      *                                                                   CDL006
     C                     MOVE 'TC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    FBD                             CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C005
     C***********                                                  S01460 080603
     C***Format*Key*XXMYY...TC******                               S01460 080603
     C***********                                                  S01460 080603
     C***********S01460    IFEQ 'Y'                                S01460 080603
     C***********                                                  S01460 080603
     C***********TYPE      IFEQ 'CD'                               S01460 080603
     C***********                                                  S01460 080603
     C***********          MOVE 'T'       FBD                      S01460 080603
     C***********          MOVE 'C'       AMTD                     S01460 080603
     C***********          MOVE *BLANKS   FMKEYS                   S01460 080603
     C***********                                                  S01460 080603
     C***********F2        IFNE *BLANKS                            S01460 080603
     C***********          MOVE F1        AC1                      S01460 080603
     C***********          MOVE '3'       PR1                      S01460 080603
     C***********          MOVE '24'      PN1                      S01460 080603
     C***********          MOVE F2        AC4                      S01460 080603
     C***********          MOVE F2PREF    PR4                      S01460 080603
     C***********                                                  S01460 080603
     C***********F2PREF    IFEQ '1'                                S01460 080603
     C***********          MOVE '01'      PN4                      S01460 080603
     C***********          ELSE                                    S01460 080603
     C***********          MOVE '24'      PN4                      S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********                                                  S01460 080603
     C***********F7        IFNE *BLANKS                            S01460 080603
     C***********          MOVE F7        AC5                      S01460 080603
     C***********          MOVE '1'       PR5                      S01460 080603
     C***********          MOVE '01'      PN5                      S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********                                                  S01460 080603
     C***********          EXSR ACUP                               S01460 080603
     C***********                                                  S01460 080603
     C***********          MOVE *BLANKS   FBD                      S01460 080603
     C***********                                                         080603
     C***********          ENDIF                                   S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********                                                  S01460 080603
     C***********          END                             Not CI         080603
     C***********                                                         080603
     C***Maturity*Payment*Date Keys      *** All Deal Types ***           080603
     C***********                                                  S01434 080603
     C***Format*Key*XXRYY....I*****                                S01434 080603
     C***********                                                  S01434 080603
     C***********          MOVE 'R'       EVENTD                   S01434 080603
     C***********          MOVE 'I'       AMTD                     S01434 080603
     C**Set*up*fields                                              S01434 080603
     C***********          MOVE *BLANK    FMKEYS                   S01434 080603
     C***********          MOVE *BLANKS   AC4                      S01434 080603
     C***********                                                  S01434 080603
     C**Set*up*Posting Reference                                   S01434 080603
     C***********                                                  S01434 080603
     C***********          MOVE '2'       PR1                      S01434 080603
     C***********          MOVE '24'      PN1                      S01434 080603
     C***********                                                  S01434 080603
     C**Update*file                                                S01434 080603
     C***********                                                  S01434 080603
     C***********          EXSR ACUP                               S01434 080603
     C***********                                                  S01434 080603
     C**
     C** Format Key XXMYY....A
     C**
     C                     MOVE 'M'       EVENTD
     C                     MOVE 'A'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F1        AC4
     C*
     C* Set up Posting Reference depending upon whether Deal Type is CI
     C*
     C           *IN34     IFEQ '1'
     C                     MOVE '1'       PR4
     C                     MOVE '05'      PN4
     C                     ELSE
     C                     MOVE '3'       PR4
     C           *IN20     IFEQ '1'                        Deal Type CD
     C           *IN39     OREQ '1'                        Deal Type IT
     C           *IN18     OREQ '1'                        Deal Type TD
     C                     MOVE '05'      PN4
     C                     ELSE                            CL/IP/TI
     C                     MOVE '22'      PN4
     C                     END
     C                     END
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and loans/deposits...                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C           *IN34     IFEQ *ON                                       CAC001
     C                     MOVE '05'      PN1                             CAC001
     C                     ELSE                                           CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Format Key XXMYY....I
     C**
     C                     MOVE 'I'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C** For Front Up interest Subtypes, No Gross Maturity Interest       080603
     C           ASFUID    IFNE 'Y'                                       080603
     C           F2        IFNE *BLANKS
     C                     MOVE F2        AC4
     C*
     C* Set up Posting Reference & Narrative depending upon whether
     C* Deal Type is CI
     C*
     C           *IN34     IFEQ '1'                        Deal Type CI
     C***********F3        IFNE *BLANKS                                   080603
     C                     MOVE '1'       PR4
     C                     MOVE '01'      PN4
     C***********          END                                            080603
     C*
     C* If not Deal Type CI, CD, or CL & Interest Inc/Exp not blank
     C* set up Narrative depending on whether Posting Reference is 1 or 3
     C*
     C                     ELSE                            Not CI
     C***********                                                         080603
     C************IN19     IFNE '1'                                       080603
     C************IN20     ANDNE'1'                                       080603
     C***********F3        ANDNE*BLANKS                                   080603
     C***********          MOVE F2PREF    PR4                             080603
     C***********F2PREF    IFEQ '1'                                       080603
     C***********          MOVE '01'      PN4                             080603
     C***********          ELSE                                           080603
     C***********          MOVE '24'      PN4                             080603
     C***********          END                                            080603
     C***********                                                         080603
     C***Deal*Type CD or CL                                               080603
     C***********                                                         080603
     C***********          ELSE                                           080603
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C*
     C***********          END                                            080603
     C                     END                             Type CI
     C                     END                             F2 entered
     C*                                                                   080603
     C** Add Interest Paid (Non Tax) Accounting                           080603
     C*                                                                   080603
     C           F7        IFNE *BLANKS                                   080603
     C           F8        ANDNE*BLANKS                                   080603
     C                     MOVE F7        AC5                             080603
     C                     MOVE '01'      PN5                             080603
     C                     MOVE '1'       PR5                             080603
     C                     MOVE F8        AC1                             080603
     C                     MOVE '01'      PN1                             080603
     C                     MOVE '1'       PR1                             080603
     C                     END                                            080603
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD1                                           S01408
     C**                                                                  S01408
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and loans/deposits...                CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SACOFR    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'IT'                                      CAC001
     C           TYPE      OREQ 'TD'                                      CAC001
     C           TYPE      OREQ 'CD'                                      CAC001
     C           TYPE      OREQ 'CI'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SACOFP    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                           No Gross Int   080603
     C**
     C** Format Key XXMYY....B
     C**
     C                     MOVE 'B'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
      *                                                                                     BUG26326
      ** Stop double posting on maturity of MB and MUB keys                                 BUG26326
     C           SIPRT     IFEQ 'N'                                                         BUG26326
     C           CGL031    ANDEQ'Y'                                                         MD053762
     C           CDL013    OREQ 'Y'                                                         MD054576
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     ENDIF                                                            BUG26326
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD2                                           S01408
     C**                                                                  S01408
     C* Update file
     C                     EXSR ACUP
      * If CDL013 is On, also format Gross key XXIYY..G.B                                   MD053762
     C           CDL013    IFEQ 'Y'                                                         MD053762
     C                     MOVE 'G'       GRS                                               MD053762
     C                     EXSR ACUP                                                        MD053762
     C                     MOVE *BLANKS   GRS                                               MD053762
     C                     ENDIF                                                            MD053762
     C**                                                                  S01460
     C** Format Key XXMYY...TI                                            S01460
     C**                                                                  S01460
     C***********S01460    IFEQ 'Y'                                S01460 080603
     C** If Deal Type IT, TD,or CD                                        080603
     C*                                                                   S01460
     C           *IN29     IFEQ *ON                                       S01460
     C** If W/H Tax                                                       080603
     C           *IN70     IFEQ *ON                                       080603
     C*                                                                   S01460
     C                     MOVE 'T'       FBD                             S01460
     C                     MOVE 'I'       AMTD                            S01460
     C                     MOVE *BLANKS   FMKEYS                          S01460
     C*                                                                   S01460
     C           F2        IFNE *BLANKS                                   S01460
     C                     MOVE F2        AC4                             S01460
     C*                                                                   S01460
     C************IN19     IFEQ *OFF                               S01460 080603
     C***********F3        ANDNE*BLANKS                            S01460 080603
     C***********          MOVE F2PREF    PR4                      S01460 080603
     C***********                                                  S01460 080603
     C***********F2PREF    IFEQ '1'                                S01460 080603
     C***********          MOVE '01'      PN4                      S01460 080603
     C***********          ELSE                                    S01460 080603
     C***********          MOVE '24'      PN4                      S01460 080603
     C***********          ENDIF                                   S01460 080603
     C***********                                                  S01460 080603
     C***********          ELSE                                    S01460 080603
     C*                                                                   S01460
     C                     MOVE F2PREF    PR4                             S01460
     C           F2PREF    IFEQ '1'                                       S01460
     C                     MOVE '01'      PN4                             S01460
     C                     ELSE                                           S01460
     C                     MOVE '24'      PN4                             S01460
     C                     ENDIF                                          S01460
     C***********          ENDIF                                   S01460 080603
     C*                                                                   S01460
     C***********F7        IFNE *BLANKS                            S01460 080603
     C***********          MOVE F7        AC5                      S01460 080603
     C***********          MOVE '01'      PN5                      S01460 080603
     C***********          MOVE '1'       PR5                      S01460 080603
     C*                                                                   080603
     C** Add Interest Paid (Taxable) Accounting                           080603
     C*                                                                   080603
     C           F9        IFNE *BLANKS                                   080603
     C           F10       ANDNE*BLANKS                                   080603
     C                     MOVE F10       AC1                             080603
     C                     MOVE '01'      PN1                             080603
     C                     MOVE '1'       PR1                             080603
     C                     MOVE F9        AC5                             080603
     C                     MOVE '01'      PN5                             080603
     C                     MOVE '1'       PR5                             080603
     C                     ENDIF                                          S01460
     C                     ENDIF                                          S01460
     C*                                                                   S01460
     C                     EXSR ACUP                                      S01460
     C                     ENDIF                                          080603
     C**                                                                  S01460
     C***Format*Key*XXMYY...TI******                               S01460 080603
     C** Format Key XXMYY....T                                            080603
     C**                                                                  S01460
     C           *IN71     IFEQ *ON                                       080603
     C           *IN69     ANDEQ*OFF                                      184889
     C                     MOVE *BLANKS   FBD                             S01460
     C                     MOVE 'T'       AMTD                            S01460
     C                     MOVE *BLANKS   FMKEYS                          S01460
     C*                                                                   S01460
     C                     MOVE F11       AC1                             080603
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD4                                           S01408
     C**                                                                  S01408
     C                     MOVE '01'      PN1                             080603
     C                     MOVE '1'       PR1                             080603
     C                     EXSR ACUP                                      080603
      * If CDL013 is On, also format Gross tax key XXIYY..G.T                               MD053762
     C           CDL013    IFEQ 'Y'                                                         MD053762
     C                     MOVE 'G'       GRS                                               MD053762
     C                     MOVE '01'      PN4                                               MD053762
     C                     MOVE '2'       PR4                                               MD053762
     C                     EXSR ACUP                                                        MD053762
     C                     MOVE *BLANKS   GRS                                               MD053762
     C                     ENDIF                                                            MD053762
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CBD5                                           S01408
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C** Format Key XXMYY...2T                                                                CGL165
     C**                                                                                      CGL165
     C                     MOVE '2'       FBD                                                 CGL165
     C                     MOVE 'T'       AMTD                                                CGL165
     C                     MOVE *BLANKS   FMKEYS                                              CGL165
     C                     MOVE F12       AC1                                                 CGL165
     C                     MOVE '01'      PN1                                                 CGL165
     C                     MOVE '1'       PR1                                                 CGL165
     C                     EXSR ACUP                                                          CGL165
     C                     MOVE ' '       FBD                                                 CGL165
     C                     ENDIF                                                              CGL165
     C**                                                                  S01408
     C***********F7        IFNE *BLANKS                            S01460 080603
     C***********          EXSR MMCCY                              S01460 080603
     C***********          ENDIF                                   S01460 080603
E002 C                     ENDIF                                          S01460
E001 C                     ENDIF                                          S01460
      *                                                                   CDL006
      ** If Feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'FT'                                      CDL006
     C           TYPE      OREQ 'DT'                                      CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXMYY...OC for Commission.                            CDL006
      *                                                                   CDL006
     C                     MOVE 'OC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
      ** Format Key XXMYY...AC for Commission due to agent.               CDL006
      *                                                                   CDL006
     C                     MOVE 'AC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
      ** Format Key XXAYY...TC for Tax on commission.                     CDL006
      *                                                                   CDL006
     C                     MOVE 'TC'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    FBD                             CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C006
     C**
     C** Rollover Date Keys       *** Deal Types IP,IT,TD,TI ***
     C**
     C           TYPE      IFEQ 'IP'
     C           TYPE      OREQ 'IT'                                    IT
     C           TYPE      OREQ 'TD'                                    TD
     C           TYPE      OREQ 'TI'                                   r
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'FT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C**
     C** Format Key XXMYY....R
     C**
     C                     MOVE 'R'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C           F6        IFNE *BLANKS
     C                     MOVE F6        AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C                     END
     C* Update file
     C                     EXSR ACUP
     C                     ENDIF                                                            MD027417
     C*                                                                   080603
     C** For Enhanced Rollover Processing, on a Rollover Date:            080603
     C*    xxRyy....I is used to settle Interest Paid Separately          080603
     C*    xxRyy....A is used to post the Old Principal to Cust A/C       080603
     C*                  (this Key is Generated Blank)                    080603
     C*    xxRyy....B is used to post Principal Increase to Cust A/c      080603
     C*    xxRyy....C is used to post Principal Decrease to Cust A/c      080603
     C*                                                                   080603
     C** For Front Up interest Subtypes, No Enhanced Rollover Keys        080603
     C*                                                                   080603
     C           TYPE      IFEQ 'IP'                                                        MD027417
     C           TYPE      OREQ 'IT'                                                        MD027417
     C           TYPE      OREQ 'TD'                                                        MD027417
     C           TYPE      OREQ 'TI'                                                        MD027417
     C           TYPE      OREQ 'FL'                                                        MD027417
     C           CDL006    ANDEQ'Y'                                                         MD027417
     C           TYPE      OREQ 'FT'                                                        MD027417
     C           CDL006    ANDEQ'Y'                                                         MD027417
     C           TYPE      OREQ 'CD'                                                        MD027417
     C           S01434    ANDEQ'Y'                                                         MD027417
     C           TYPE      OREQ 'CL'                                                        MD027417
     C           S01434    ANDEQ'Y'                                                         MD027417
      *                                                                                     MD027417
     C           S01434    IFEQ 'Y'                                       080603
     C           ASFUID    ANDNE'Y'                                       080603
     C*                                                                   080603
     C** Format Key XXRYY....I                                            080603
     C*                                                                   080603
     C                     MOVE 'R'       EVENTD                          080603
     C                     MOVE 'I'       AMTD                            080603
     C* Set up fields                                                     080603
     C                     MOVE *BLANK    FMKEYS                          080603
     C                     MOVE '2'       PR1                             080603
     C                     MOVE '01'      PN1                             080603
     C*                                                                   080603
     C* Update file                                                       080603
     C*                                                                   080603
     C                     EXSR ACUP                                      080603
     C*                                                                   080603
     C                     ENDIF                                                            MD027417
      *                                                                                     MD027417
     C           TYPE      IFEQ 'IP'                                                        MD027417
     C           TYPE      OREQ 'IT'                                                        MD027417
     C           TYPE      OREQ 'TD'                                                        MD027417
     C           TYPE      OREQ 'TI'                                                        MD027417
     C           TYPE      OREQ 'FL'                                                        MD027417
     C           CDL006    ANDEQ'Y'                                                         MD027417
     C           TYPE      OREQ 'FT'                                                        MD027417
     C           CDL006    ANDEQ'Y'                                                         MD027417
     C*
     C** Format Key XXRYY....A                                            S01434
     C**                                                                  S01434
     C                     MOVE 'R'       EVENTD                          S01434
     C                     MOVE 'A'       AMTD                            S01434
     C* Set up fields                                                     S01434
     C                     MOVE *BLANK    FMKEYS                          S01434
     C***********          MOVE F6        AC4                      S01434 080603
     C*****************************************************        S01434 080603
     C**Set*up*Posting*Reference*depending*upon*whether****        S01434 080603
     C*****Rollover*Suspense*Account*has*been*entered******        S01434 080603
     C*****************************************************        S01434 080603
     C***********          MOVE '3'       PR4                      S01434 080603
     C***********          MOVE '31'      PN4                      S01434 080603
     C*                                                                   S01434
     C* Update file                                                       S01434
     C*                                                                   S01434
     C                     EXSR ACUP                                      S01434
     C*                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C*                                                                   CEU015
     C** Format Key xxRyy...XA                                            CEU015
     C**                                                                  CEU015
     C                     MOVE 'X'       FBD                             CEU015
     C* Set up fields                                                     CEU015
     C                     MOVE *BLANK    FMKEYS                          CEU015
     C                     MOVE F1        AC4                             CEU015
     C                     MOVE '3'       PR4                             CEU015
     C           TYPE      IFEQ 'IP'                                      CEU015
     C           TYPE      OREQ 'TI'                                      CEU015
     C           TYPE      OREQ 'FL'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE '22'      PN4                             CEU015
     C                     ELSE                                           CEU015
     C                     MOVE '05'      PN4                             CEU015
     C                     END                                            CEU015
     C*                                                                   CEU015
     C* Update file                                                       CEU015
     C*                                                                   CEU015
     C                     EXSR ACUP                                      CEU015
     C                     MOVE *BLANK    FBD                             CEU015
     C                     ENDIF                                          CEU015
     C**                                                                  S01434
     C** Format Key XXRYY....B                                            S01434
     C**                                                                  S01434
     C                     MOVE 'R'       EVENTD                          S01434
     C                     MOVE 'B'       AMTD                            S01434
     C* Set up fields                                                     S01434
     C                     MOVE *BLANK    FMKEYS                          S01434
     C                     MOVE *BLANKS   AC4                             S01434
     C*                                                                   S01434
     C* Set up Posting Reference                                          S01434
     C*                                                                   S01434
     C***********          MOVE '2'       PR1                      S01434 080603
     C***********          MOVE '01'      PN1                      S01434 080603
     C*                                                                   080603
     C                     MOVE F1        AC1                             080603
     C                     MOVE '3'       PR1                             080603
     C                     MOVE '18'      PN1              Prin. Incr     080603
     C*                                                                   S01434
     C* Update file                                                       S01434
     C*                                                                   S01434
     C                     EXSR ACUP                                      S01434
     C**                                                                  S01434
     C** Format Key XXRYY....C                                            S01434
     C**                                                                  S01434
     C                     MOVE 'R'       EVENTD                          S01434
     C                     MOVE 'C'       AMTD                            S01434
     C* Set up fields                                                     S01434
     C                     MOVE *BLANK    FMKEYS                          S01434
     C                     MOVE *BLANKS   AC4                             S01434
     C*                                                                   S01434
     C* Set up Posting Reference                                          S01434
     C*                                                                   S01434
     C***********          MOVE '2'       PR4                      S01434 080603
     C***********          MOVE '01'      PN4                      S01434 080603
     C*                                                                   080603
     C                     MOVE F1        AC4                             080603
     C                     MOVE '3'       PR4                             080603
     C                     MOVE '19'      PN4              Prin. Decr     080603
     C*                                                                   S01434
     C* Update file                                                       S01434
     C*                                                                   S01434
     C                     EXSR ACUP                                      S01434
     C                     END                             S01434         080603
     C*                                                                   080603
     C                     MOVE 'M'       EVENTD                          S01434
     C**                                                                  S01434
     C                     END                             IP/IT/TD/TI
     C**
     C** Principal Decrease Keys    *** Deal Types CL,CD ***
     C**                            *** and  Types IL,ID ***              S01354
     C**
     C           TYPE      IFEQ 'CL'
     C           TYPE      OREQ 'CD'
     C           TYPE      OREQ 'IL'                                      S01354
     C           TYPE      OREQ 'ID'                                      S01354
     C           TYPE      OREQ 'LP'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'DP'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'IP'                                                        MD027308
     C           WPIPD     ANDEQ'Y'                                                         MD027308
     C           TYPE      OREQ 'IT'                                                        MD027308
     C           WPIPD     ANDEQ'Y'                                                         MD027308
     C           TYPE      OREQ 'TD'                                                       MD027308A
     C           TYPE      OREQ 'TI'                                                       MD027308A
     C**
     C** Format Key XXMYY...DA
     C**
     C                     MOVE 'DA'      DLKEY
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     MOVE F1        AC4
     C           *IN20     IFEQ '1'                        Deal Type CD
     C                     MOVE '05'      PN4
     C                     ELSE                            Deal Type CL
     C                     MOVE '22'      PN4
     C                     END
      *                                                                                    MD027308B
     C           TYPE      IFEQ 'IT'                                                       MD027308B
     C           TYPE      OREQ 'TD'                                                       MD027308B
     C                     MOVE '05'      PN4                                              MD027308B
     C                     ENDIF                                                           MD027308B
      *                                                                                    MD027308B
     C           TYPE      IFEQ 'IP'                                                       MD027308B
     C           TYPE      OREQ 'TI'                                                       MD027308B
     C                     MOVE '22'      PN4                                              MD027308B
     C                     ENDIF                                                           MD027308B
      *                                                                                    MD027308B
     C                     MOVE '3'       PR4
     C* Update file
     C                     EXSR ACUP
      *                                                                   CDL006
      ** If feature CDL006 is installed.                                  CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           TYPE      IFEQ 'DT'                                      CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Format Key XXMYY...DN for Net amount to be settled.              CDL006
      *                                                                   CDL006
     C                     MOVE 'DN'      DLKEY                           CDL006
     C                     MOVE *BLANK    FMKEYS                          CDL006
      *                                                                   CDL006
     C                     EXSR ACUP                                      CDL006
      *                                                                   CDL006
     C                     MOVE *BLANK    FBD                             CDL006
     C                     MOVE 'DA'      DLKEY                           CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AK0020C007
      *                                                                   CAC001
      **  If Anal Acctg is installed and call/notice/demand loans/        CAC001
      **  deposits                                                        CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'IL'                                      CAC001
     C           TYPE      ANDNE'ID'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyT..DA                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyF..DA                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
      *                                                                   CAC001
     C           TYPE      WHEQ 'CD'                                      CAC001
     C           TYPE      OREQ 'DT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C           TYPE      OREQ 'LT'                                      CDL006
     C           CDL006    ANDEQ'Y'                                       CDL006
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
      *                                                                   CAC001
     C                     ENDSL                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C*
     C                     END                             Types CL/CD
      *                                                                                       CAS001
      ** If CAS001 is on and TYPE is not 'ID' or 'IL' generate NPV account keys               CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C           TYPE      ANDNE'ID'                                                          CAS001
     C           TYPE      ANDNE'IL'                                                          CAS001
     C********** SUPAC     ANDNE*BLANKS                                                CAS001 CAS004
     C                     EXSR SRGNPV                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Generate EU Withholding Tax account keys if necessary.                               CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           CER048    OREQ 'Y'                                                           CER048
     C           WGFLG     ANDEQ'Y'                                                           CGL031
     C                     EXSR SRGTAX                                                        CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     EXSR SRGSTX                                                        CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     EXSR SRGTTX                                                        CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVE 'N'       WGFLG                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If CAS004 is on and TYPE is not 'ID' or 'IL', generate                               CAS004
      ** Hedge Accounting Account Keys                                                        CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           TYPE      ANDNE'ID'                                                          CAS004
     C           TYPE      ANDNE'IL'                                                          CAS004
     C                     EXSR SRGHAC                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** If CAS005 is on and TYPE is 'ID' or 'IL', generate                                   CAS005
      ** Hedge Accounting Account Keys                                                        CAS005
      *                                                                                       CAS005
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           TYPE      ANDEQ'ID'                                                          CAS005
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           TYPE      ANDEQ'IL'                                                          CAS005
     C                     EXSR SRGHAC                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS007
      *                                                                                       CDL017
      ** Generate account keys for penalty fee                                                CDL017
      ** if deal type is either TD, TI, IP or IT                                              CDL017
      **     xxDyy---RPA Receive Penalty Amount                                               CDL017
      **     xxDyy---PPA Pay Penalty Amount                                                   CDL017
      **     xxMyy---RPA Receive Penalty Amount                                               CDL017
      **     xxMyy---PPA Pay Penalty Amount                                                   CDL017
      *                                                                                       CDL017
     C           TYPE      IFEQ 'TD'                                                          CDL017
     C           TYPE      OREQ 'TI'                                                          CDL017
     C           TYPE      OREQ 'IP'                                                          CDL017
     C           TYPE      OREQ 'IT'                                                          CDL017
      *                                                                                       CDL017
      ** Format Key xxDyy..RPA                                                                CDL017
     C                     MOVE 'D'       EVENTD                                              CDL017
     C                     MOVE *BLANKS   CYD                                                 CDL017
     C                     MOVE 'R'       CYD                                                 CDL017
     C                     MOVE 'P'       FBD                                                 CDL017
     C                     MOVE 'A'       AMTD                                                CDL017
     C                     MOVE *BLANKS   FMKEYS                                              CDL017
     C           F12       IFNE *BLANKS                                                       CDL017
     C                     MOVE F12       AC1              Cr Account                         CDL017
     C                     MOVE F12PRF    PR1                                                 CDL017
     C                     MOVE '01'      PN1                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F13       IFNE *BLANKS                                                       CDL017
     C                     MOVE F13       AC4              Dr Account                         CDL017
     C                     MOVE F12PRF    PR4                                                 CDL017
     C                     MOVE '01'      PN4                                                 CDL017
     C                     ENDIF                                                              CDL017
     C                     EXSR ACUP                                                          CDL017
      *                                                                                       CDL017
      ** Format Key xxDyy..PPA                                                                CDL017
     C                     MOVE 'D'       EVENTD                                              CDL017
     C                     MOVE *BLANKS   CYD                                                 CDL017
     C                     MOVE 'P'       CYD                                                 CDL017
     C                     MOVE 'P'       FBD                                                 CDL017
     C                     MOVE 'A'       AMTD                                                CDL017
     C                     MOVE *BLANKS   FMKEYS                                              CDL017
     C           F15       IFNE *BLANKS                                                       CDL017
     C                     MOVE F15       AC1              Cr Account                         CDL017
     C                     MOVE F12PRF    PR1                                                 CDL017
     C                     MOVE '01'      PN1                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F14       IFNE *BLANKS                                                       CDL017
     C                     MOVE F14       AC4              Dr Account                         CDL017
     C                     MOVE F12PRF    PR4                                                 CDL017
     C                     MOVE '01'      PN4                                                 CDL017
     C                     ENDIF                                                              CDL017
     C                     EXSR ACUP                                                          CDL017
      *                                                                                       CDL017
      ** Format Key xxMyy..RPA                                                                CDL017
     C                     MOVE 'M'       EVENTD                                              CDL017
     C                     MOVE *BLANKS   CYD                                                 CDL017
     C                     MOVE 'R'       CYD                                                 CDL017
     C                     MOVE 'P'       FBD                                                 CDL017
     C                     MOVE 'A'       AMTD                                                CDL017
     C                     MOVE *BLANKS   FMKEYS                                              CDL017
     C           F13       IFNE *BLANKS                                                       CDL017
     C                     MOVE F13       AC1              Cr Account                         CDL017
     C                     MOVE F12PRF    PR1                                                 CDL017
     C                     MOVE '01'      PN1                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F16       IFNE *BLANKS                                                       CDL017
     C                     MOVE F16       AC2                                                 CDL017
     C                     MOVE F16PRF    PR2                                                 CDL017
     C                     MOVE '01'      PN2                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F12       IFNE *BLANKS                                                       CDL017
     C                     MOVE F12       AC4              Dr Account                         CDL017
     C                     MOVE F12PRF    PR4                                                 CDL017
     C                     MOVE '01'      PN4                                                 CDL017
     C                     ENDIF                                                              CDL017
     C                     EXSR ACUP                                                          CDL017
      *                                                                                       CDL017
      ** Format Key xxMyy..PPA                                                                CDL017
     C                     MOVE 'M'       EVENTD                                              CDL017
     C                     MOVE *BLANKS   CYD                                                 CDL017
     C                     MOVE 'P'       CYD                                                 CDL017
     C                     MOVE 'P'       FBD                                                 CDL017
     C                     MOVE 'A'       AMTD                                                CDL017
     C                     MOVE *BLANKS   FMKEYS                                              CDL017
     C           F14       IFNE *BLANKS                                                       CDL017
     C                     MOVE F14       AC1              Cr Account                         CDL017
     C                     MOVE F12PRF    PR1                                                 CDL017
     C                     MOVE '01'      PN1                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F15       IFNE *BLANKS                                                       CDL017
     C                     MOVE F15       AC4              Dr Account                         CDL017
     C                     MOVE F12PRF    PR4                                                 CDL017
     C                     MOVE '01'      PN4                                                 CDL017
     C                     ENDIF                                                              CDL017
     C           F17       IFNE *BLANKS                                                       CDL017
     C                     MOVE F17       AC5                                                 CDL017
     C                     MOVE F12PRF    PR5                                                 CDL017
     C                     MOVE '01'      PN5                                                 CDL017
     C                     ENDIF                                                              CDL017
     C                     EXSR ACUP                                                          CDL017
      *                                                                                       CDL017
     C                     ENDIF                                                              CDL017
      *                                                                                       CAS005
      ** Generate Fee Amortisation account keys if necessary.                                 CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WGFLG     ANDEQ'Y'                                                           CAS009
     C                     EXSR SRGFEA                                                        CAS009
     C                     MOVE 'N'       WGFLG                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C/COPY WNCPYSRC,AK0020CCP4                                           S01408
     C**
     C** Reset Deal Type/ Sub Type to blanks before redisplaying
     C** initial screen.
     C**
     C                     MOVE *BLANKS   TYPE
     C                     MOVE *BLANKS   STYP
     C                     MOVE *BLANKS   CLAS                                                CDL038
     C                     MOVE '1'       *IN07
     C*
     C                     END                             Errs exist
     C*
     C                     END                             F3/F12 not pressed
     C/COPY WNCPYSRC,AK0020CCP3                                           S01408
     C*
     C                     END                             F3/F12/Errs in scrn
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT                                                                                  CAS001
     C********************************************************************                    CDL017
     C*                                                                                       CDL017
     C* MMP1- Validate additional screen for MM deal types                                    CDL017
     C*                                                                                       CDL017
     C********************************************************************                    CDL017
     C           MMP1      BEGSR                                                              CDL017
      *                                                                                       CDL017
     C           *IN03     DOUEQ'1'                        F3 pressed  X s                    CDL017
     C           *IN12     OREQ '1'                        F12 pressed X s                    CDL017
     C           *IN63     OREQ '0'                        No errs in FX s                    CDL017
     C*                                                                                       CDL017
     C/COPY WNCPYSRC,AKH00124
     C                     WRITE#MSGCTL                                                       CDL017
     C                     EXFMTACKEYM1                                                       CDL017
     C*                                                                                       CDL017
     C                     SETOF                     2728                                     CDL017
     C                     SETOF                     525354                                   CDL017
     C                     SETOF                     555657                                   CDL017
     C                     SETOF                     58                                       CDL017
     C                     SETOF                     63                                       CDL017
     C/COPY WNCPYSRC,AKH00125
     C*                                                                                       CDL017
     C** Clear messages from program message queue.                                           CDL017
     C                     CALL 'Y2CLMSC'                                                     CDL017
     C                     PARM SPGMQ     ZAPGM  10                                           CDL017
     C                     PARM '*SAME'   ZAPGRL  5                                           CDL017
     C*                                                                                       CDL017
     C** If F12 pressed then redisplay previous screen                                        CDL017
     C           *IN12     IFEQ '1'                        F12 pressed X s                    CDL017
     C           BGN0ST    IFEQ 'Y'                                                           CDL017
     C           *IN63     ANDEQ*OFF                                                          CDL017
     C           TYPE      ANDNE'ID'                                                          CDL017
     C           TYPE      ANDNE'IL'                                                          CDL017
     C                     MOVE 'Y'       WKSCAA  1                                           CDL017
     C                     ELSE                                                               CDL017
     C                     MOVE *ON       *IN63                                               CDL017
     C**********           MOVE ' '       WKSCAA                                     260980 AR738954
     C                     ENDIF                                                              CDL017
     C                     MOVE *OFF      *IN12                                               CDL017
     C                     LEAVE                                                              CDL017
     C                     ENDIF                                                              CDL017
     C*                                                                                       CDL017
     C** If F3 pressed then terminate program                                                 CDL017
     C           *IN03     IFEQ '1'                        F3 pressed  X s                    CDL017
     C**********           MOVE ' '       WKSCAA                                     260980 AR738954
     C**********           MOVE *ON       *IN63                                      260980 AR738954
     C                     LEAVE                                                              CDL017
     C                     ENDIF                                                              CDL017
     C*                                                                                       CDL017
     C** If F3 and F12 not pressed, validate screen                                           CDL017
     C           *IN03     IFEQ '0'                        F3 pressed  X s                    CDL017
     C           *IN12     ANDEQ'0'                        F12 pressed X s                    CDL017
     C**                                                                                      CDL017
     C** Check if F12 (Deal Date Contingent Penalty Income Account)                           CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F12       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     52                                       CDL017
     C                     ELSE                                                               CDL017
     C           F12       CHAINSDACODL0             52                                       CDL017
     C                     END                                                                CDL017
     C           *IN52     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5263  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check if F13 (Deal Date Contingent Penalty Income Contra)                            CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F13       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     53                                       CDL017
     C                     ELSE                                                               CDL017
     C           F13       CHAINSDACODL0             53                                       CDL017
     C                     END                                                                CDL017
     C           *IN53     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5363  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check if F14 (Deal Date Contingent Penalty Expense Account)                          CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F14       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     54                                       CDL017
     C                     ELSE                                                               CDL017
     C           F14       CHAINSDACODL0             54                                       CDL017
     C                     END                                                                CDL017
     C           *IN54     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5463  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check if F15 (Deal Date Contingent Penalty Expense Contra)                           CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F15       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     55                                       CDL017
     C                     ELSE                                                               CDL017
     C           F15       CHAINSDACODL0             55                                       CDL017
     C                     END                                                                CDL017
     C           *IN55     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5563  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check F12PRF (Posting Ref 1 or 3) is valid                                           CDL017
     C           F12PRF    IFNE *BLANKS                                                       CDL017
     C           F12PRF    IFNE '1'                                                           CDL017
     C           F12PRF    ANDNE'3'                        Pref valid                         CDL017
     C                     SETON                     2763  Errors in MM                       CDL017
     C                     MOVEL'USR4259' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Either all account codes & posting reference should be entered                       CDL017
     C** or all should be blank                                                               CDL017
     C           F12PRF    IFNE *BLANKS                                                       CDL017
     C           F12       ANDNE*BLANKS                                                       CDL017
     C           F13       ANDNE*BLANKS                                                       CDL017
     C           F14       ANDNE*BLANKS                                                       CDL017
     C           F15       ANDNE*BLANKS                                                       CDL017
     C           F12PRF    OREQ *BLANKS                                                       CDL017
     C           F12       ANDEQ*BLANKS                                                       CDL017
     C           F13       ANDEQ*BLANKS                                                       CDL017
     C           F14       ANDEQ*BLANKS                                                       CDL017
     C           F15       ANDEQ*BLANKS                                                       CDL017
     C                     ELSE                                                               CDL017
     C                     SETON                     5253  Errors in MM                       CDL017
     C                     SETON                     5455  Errors in MM                       CDL017
     C                     SETON                     2763  Errors in MM                       CDL017
     C                     MOVEL'USR4253' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check if F16 (Maturity Date Penalty Income Account)                                  CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F16       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     56                                       CDL017
     C                     ELSE                                                               CDL017
     C           F16       CHAINSDACODL0             56                                       CDL017
     C                     END                                                                CDL017
     C           *IN56     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5663  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check if F17 (Maturity Date Penalty Expense Account)                                 CDL017
     C** has been entered and is a valid non-title account code                               CDL017
     C           F17       IFEQ *BLANKS                                                       CDL017
     C                     SETOF                     57                                       CDL017
     C                     ELSE                                                               CDL017
     C           F17       CHAINSDACODL0             57                                       CDL017
     C                     END                                                                CDL017
     C           *IN57     IFEQ '1'                                                           CDL017
     C           A5TOIN    OREQ 'Y'                                                           CDL017
     C                     SETON                     5763  Errors                             CDL017
     C                     MOVEL'USR4230' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Check F16PRF (Posting Ref 1 or 3) is valid                                           CDL017
     C           F16PRF    IFNE *BLANKS                                                       CDL017
     C           F16PRF    IFNE '1'                                                           CDL017
     C           F16PRF    ANDNE'3'                        Pref valid                         CDL017
     C                     SETON                     2863  Errors in MM                       CDL017
     C                     MOVEL'USR4259' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C                     ENDIF                                                              CDL017
     C**                                                                                      CDL017
     C** Either all account codes & posting reference should be entered                       CDL017
     C** or all should be blank                                                               CDL017
     C           F16PRF    IFNE *BLANKS                                                       CDL017
     C           F16       ANDNE*BLANKS                                                       CDL017
     C           F17       ANDNE*BLANKS                                                       CDL017
     C           F16PRF    OREQ *BLANKS                                                       CDL017
     C           F16       ANDEQ*BLANKS                                                       CDL017
     C           F17       ANDEQ*BLANKS                                                       CDL017
     C                     ELSE                                                               CDL017
     C                     SETON                     5657  Errors in MM                       CDL017
     C                     SETON                     2863  Errors in MM                       CDL017
     C                     MOVEL'USR4296' ZAMSID           Message id.                        CDL017
     C                     EXSR ZASNMS                     Send message                       CDL017
     C                     ENDIF                                                              CDL017
     C*                                                                                       CDL017
     C**********           MOVE ' '       WKSCAA                                     260980 AR738954
     C/COPY WNCPYSRC,AKH00126
     C                     ENDIF                                                              CDL017
      *                                                                                       CDL017
     C                     ENDDO                                                              CDL017
      *                                                                                       CDL017
     C                     ENDSR                                                              CDL017
      ********************************************************************                    CDL017
      /EJECT                                                                                  CDL017
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      * SRGNPV - Subroutine to generate account keys for NPV          *                       CAS001
      *                                                               *                       CAS001
      * Called by: MMP, NAP                                           *                       CAS001
      *                                                               *                       CAS001
      * Calls: ACUP                                                   *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
     C           SRGNPV    BEGSR                                                              CAS001
      *                                                                                       CAS001
      * Set flag to prevent reversal of DR/CR in S/R ACUP                                     CAS001
      *                                                                                       CAS001
     C                     MOVE 'Y'       PLFLAG                                              CAS001
      *                                                                                       CAS001
      ** xxAyy___UP - Debit                                                                   CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   DLKEY                                               CAS001
     C                     MOVE TYPE      DTYPD                                               CAS001
     C                     MOVE STYP      STYPD                                               CAS001
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE 'A'       EVENTD                                              CAS001
     C                     MOVE 'UP'      DLKEY                                               CAS001
     C                     MOVE *BLANKS   FMKEYS                                              CAS001
     C                     MOVE SUPAC     AC1                                                 CAS001
     C                     MOVE SUPPR     PR1                                                 CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
      ** xxAyy___UP - Credit                                                                  CAS001
      *                                                                                       CAS001
     C                     MOVE SIEAC     AC4                                                 CAS001
     C                     MOVE SUPPR     PR4                                                 CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           BNBCPL    ANDEQ'Y'                                                           CAS004
     C                     MOVEL'  '      CYD                                                 CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
      ** xxAyy___UL - Debit                                                                   CAS001
      *                                                                                       CAS001
     C                     MOVE 'A'       EVENTD                                              CAS001
     C                     MOVE 'UL'      DLKEY                                               CAS001
     C                     MOVE *BLANKS   FMKEYS                                              CAS001
     C                     MOVE SEEAC     AC1                                                 CAS001
     C                     MOVE SULPR     PR1                                                 CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
      ** xxAyy___UL - Credit                                                                  CAS001
      *                                                                                       CAS001
     C                     MOVE SULAC     AC4                                                 CAS001
     C                     MOVE SULPR     PR4                                                 CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           BNBCPL    ANDEQ'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
     C                     MOVE 'N'       PLFLAG                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *****************************************************************                       CAS001
      /EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      * SRACOD - Subroutine to access SDACODPD via access object      *                       CAS001
      *                                                               *                       CAS001
      * Called by: SRVNPV                                             *                       CAS001
      *                                                               *                       CAS001
      * Calls: AOACODR0                                               *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
     C           SRACOD    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Get Account codes details via access object                                          CAS001
      *                                                                                       CAS001
     C                     CALL 'AOACODR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*KEY  '  POPTN                                               CAS001
     C**********           PARM           PIACOD  4                                    CAS001 CGL029
     C********** SDACOD    PARM           DSFDY                                        CAS001 CGL029
     C                     PARM           PIACOD 10                                           CGL029
     C           SDACOD    PARM           DSSDY                                               CGL029
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WERRCD                                              CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR4239' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C           A5TOIN    IFEQ 'Y'                                                           CAS001
     C                     MOVE 'Y'       WERRCD                                              CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR4239' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *****************************************************************                       CAS001
      /EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      * SRVNPV - Subroutine to validate NPV screen fields             *                       CAS001
      *                                                               *                       CAS001
      * Called by: SRDNPV                                             *                       CAS001
      *                                                               *                       CAS001
      * Calls: SRACOD                                                 *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
     C           SRVNPV    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** If Unrealised Profit NPV Account is blank, all other fields must be blank            CAS001
      *                                                                                       CAS001
     C                     MOVE ' '       WKEREN  1                                           CAS001
     C           SUPAC     IFEQ *BLANKS                                                       CAS001
     C                     SELEC                                                              CAS001
     C           SUPPR     WHNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9188' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN87                                               CAS001
     C           SIEAC     WHNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9189' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN88                                               CAS001
     C           SULAC     WHNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9190' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN89                                               CAS001
     C           SULPR     WHNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9191' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN90                                               CAS001
     C           SEEAC     WHNE *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9192' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN91                                               CAS001
     C                     ENDSL                                                              CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** else, Unrealised Profit NPV account is not blank, therefore, all the other fields    CAS001
      ** must be non-blank                                                                    CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           SUPPR     WHEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9225' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN87                                               CAS001
     C           SIEAC     WHEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9185' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN88                                               CAS001
     C           SULAC     WHEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9186' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN89                                               CAS001
     C           SULPR     WHEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9226' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN90                                               CAS001
     C           SEEAC     WHEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR9187' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN91                                               CAS001
     C                     ENDSL                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If entered, account code must be a valid non-title account codes                     CAS001
      *                                                                                       CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS001
     C                     MOVE SUPAC     PIACOD                                              CAS001
     C                     MOVE *BLANK    WERRCD  1                                           CAS001
     C                     EXSR SRACOD                                                        CAS001
      *                                                                                       CAS001
     C           WERRCD    IFEQ 'Y'                                                           CAS001
     C                     MOVE *ON       *IN86                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Posting reference must be 1 or 3 and must be entered only if                         CAS001
      ** Unrealised Profit NPV Account is entered                                             CAS001
      *                                                                                       CAS001
     C           SUPAC     IFNE *BLANKS                                                       CAS001
     C           SUPPR     IFNE '1'                                                           CAS001
     C           SUPPR     ANDNE'3'                                                           CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR4259' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN87                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Income/Equity Account, if entered, must be a valid non-titled account code           CAS001
      *                                                                                       CAS001
     C           SIEAC     IFNE *BLANKS                                                       CAS001
     C                     MOVE SIEAC     PIACOD                                              CAS001
     C                     MOVE *BLANK    WERRCD                                              CAS001
     C                     EXSR SRACOD                                                        CAS001
      *                                                                                       CAS001
     C           WERRCD    IFEQ 'Y'                                                           CAS001
     C                     MOVE *ON       *IN88                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Unrealised Loss NPV Account, if entered, must be a valid non-titled account code     CAS001
      *                                                                                       CAS001
     C           SULAC     IFNE *BLANKS                                                       CAS001
     C                     MOVE SULAC     PIACOD                                              CAS001
     C                     MOVE *BLANK    WERRCD                                              CAS001
     C                     EXSR SRACOD                                                        CAS001
      *                                                                                       CAS001
     C           WERRCD    IFEQ 'Y'                                                           CAS001
     C                     MOVE *ON       *IN89                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Posting reference must be 1 or 3                                                     CAS001
      *                                                                                       CAS001
     C           SULAC     IFNE *BLANKS                                                       CAS001
     C           SULPR     IFNE '1'                                                           CAS001
     C           SULPR     ANDNE'3'                                                           CAS001
     C                     MOVE 'Y'       WKEREN                                              CAS001
     C                     MOVEL'USR4259' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN90                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Expense/Equity Account, if entered, must be a valid non-titled account code          CAS001
      *                                                                                       CAS001
     C           SEEAC     IFNE *BLANKS                                                       CAS001
     C                     MOVE SEEAC     PIACOD                                              CAS001
     C                     MOVE *BLANK    WERRCD                                              CAS001
     C                     EXSR SRACOD                                                        CAS001
      *                                                                                       CAS001
     C           WERRCD    IFEQ 'Y'                                                           CAS001
     C                     MOVE *ON       *IN91                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS009
     C                     MOVE *ALL'0'   ALLIN2  6                                           CAS009
     C                     MOVEAALLIN2    *IN,72                                              CAS009
      *                                                                                       CAS009
     C           UPACAC    IFEQ *BLANKS                                                       CAS009
     C                     SELEC                                                              CAS009
     C           UPACPR    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Profit Posting Reference must be blank if UP Amortised                               CAS009
      ** Cost Account is blank                                                                CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9282' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN73                                               CAS009
     C           UPACIE    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Income/Equity Account must be blank if UP Amortised                                  CAS009
      ** Cost Account is blank                                                                CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9283' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN74                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Validate Unrealised Profit Amortised Cost Account                                    CAS009
      *                                                                                       CAS009
     C           UPACAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE UPACAC    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
      *                                                                                       CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN72                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Profit Posting Reference should be entered if Unrealised                             CAS009
      ** Profit Amortised Cost Account is entered                                             CAS009
      *                                                                                       CAS009
     C           UPACPR    IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9287' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN73                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Posting reference must be 1 or 3                                                     CAS009
      *                                                                                       CAS009
     C           UPACPR    IFNE '1'                                                           CAS009
     C           UPACPR    ANDNE'3'                                                           CAS009
     C           WKEREN    ANDNE'Y'                                                           CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN73                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Validate Unrealised Income/Equity Account                                            CAS009
      *                                                                                       CAS009
     C           UPACIE    IFNE *BLANKS                                                       CAS009
     C                     MOVE UPACIE    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
      *                                                                                       CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN74                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
      ** Income/Equity Account must be entered since Unrealised                               CAS009
      ** Profit Amortised Cost Account is entered                                             CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9288' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN74                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           ULACAC    IFEQ *BLANKS                                                       CAS009
     C                     SELEC                                                              CAS009
     C           UPACAC    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Unrealised Loss Amortised Cost Account must be entered since                         CAS009
      ** Unrealised Profit Amortised Cost Account is entered                                  CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9289' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN75                                               CAS009
     C           ULACPR    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Loss Profit Reference must be blank if Loss Amortised                                CAS009
      ** Cost Account is blank                                                                CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C**********           MOVEL'USR9285' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'CAS0016' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN76                                               CAS009
     C           ULACEE    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Expense/Equity Account must be blank if Loss Amortised                               CAS009
      ** Cost Account is blank                                                                CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9286' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN77                                               CAS009
     C                     ENDSL                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Validate Unrealised Loss Amortised Cost Account                                      CAS009
      *                                                                                       CAS009
     C           ULACAC    IFNE *BLANKS                                                       CAS009
     C           UPACAC    IFEQ *BLANKS                                                       CAS009
      *                                                                                       CAS009
      ** Unrealized Profit Amortised Cost must be blank if Unrealised                         CAS009
      ** Profit Cost Account is blank                                                         CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C**********           MOVEL'USR9284' ZAMSID                                       CAS009 CAS011
     C                     MOVEL'CAS0015' ZAMSID                                              CAS011
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN75                                               CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE ULACAC    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
      *                                                                                       CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN75                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Loss Posting Reference should be entered if Unrealised                               CAS009
      ** Loss Amortised Cost Account is entered                                               CAS009
      *                                                                                       CAS009
     C           ULACPR    IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9290' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN76                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Posting reference must be 1 or 3                                                     CAS009
      *                                                                                       CAS009
     C           ULACPR    IFNE '1'                                                           CAS009
     C           ULACPR    ANDNE'3'                                                           CAS009
     C           WKEREN    ANDNE'Y'                                                           CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN76                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Validate Unrealised Expense/Equity Account                                           CAS009
      *                                                                                       CAS009
     C           ULACEE    IFNE *BLANKS                                                       CAS009
     C                     MOVE ULACEE    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
      *                                                                                       CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN77                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
      ** Expense/Equity Account must be entered since Unrealised                              CAS009
      ** Loss Amortised Cost Account is entered                                               CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WKEREN                                              CAS009
     C                     MOVEL'USR9291' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN77                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS001
     C           WKEREN    IFEQ 'Y'                                                           CAS001
     C           WKSUBR    IFEQ 'FXP'                                                         226093
     C                     MOVE *ON       *IN62                                               226093
     C                     ENDIF                                                              226093
     C           WKSUBR    IFEQ 'MMP'                                                         CAS001
     C                     MOVE *ON       *IN63                                               CAS001
     C                     ENDIF                                                              CAS001
     C           WKSUBR    IFEQ 'NAP'                                                         CAS001
     C                     MOVE *ON       *IN64                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           WKEREN    IFEQ 'Y'                                                           CAS004
     C                     MOVE 'Y'       WKSNPV  1                                           CAS004
     C                     ELSE                                                               CAS004
     C                     MOVE *BLANKS   WKSNPV                                              CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
      ** If Hedge Accounting (CAS004) is installed, display Hedge                             CAS004
      ** Accounting Account Keys Generation Screen                                            CAS004
      *                                                                                       CAS004
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           WKSUBR    IFNE 'FXP'                                                         226093
     C                     EXSR SRDHAC                                                        CAS004
     C                     ENDIF                                                              226093
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS007
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS001
      *****************************************************************                       CAS001
      /EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      * SRDNPV - Subroutine to display NPV screen fields              *                       CAS001
      *                                                               *                       CAS001
      * Called by: MMP, NAP                                           *                       CAS001
      *                                                               *                       CAS001
      * Calls: SRVNPV                                                 *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
     C           SRDNPV    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** If CAS001 feature is installed, no error from the previous screen, and conditions    CAS001
      ** are satisfied, display and validate AKEYNPV screen                                   CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C           *IN63     ANDEQ*OFF                                                          CAS001
     C           TYPE      ANDNE'ID'                                                          CAS001
     C           TYPE      ANDNE'IL'                                                          CAS001
     C           WKSUBR    ANDEQ'MMP'                                                         CAS001
     C           CAS001    OREQ 'Y'                                                           CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C           WKSUBR    ANDEQ'NAP'                                                         CAS001
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           TYPE      ANDEQ'ID'                                                          CAS005
     C           WKSUBR    ANDEQ'MMP'                                                         CAS005
     C           *IN63     ANDEQ*OFF                                                          CAS005
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           TYPE      ANDEQ'IL'                                                          CAS005
     C           WKSUBR    ANDEQ'MMP'                                                         CAS005
     C           *IN63     ANDEQ*OFF                                                          CAS005
     C           CAS005    OREQ 'Y'                                                           226093
     C           WKSUBR    ANDEQ'FXP'                                                         226093
     C           *IN62     ANDEQ*OFF                                                          226093
      *                                                                                       CAS001
      ** Clear messages from program message queue .                                          CAS001
      *                                                                                       CAS001
     C                     CALL 'Y2CLMSC'                                                     CAS001
     C                     PARM SPGMQ     ZAPGM                                               CAS001
     C                     PARM '*SAME'   ZAPGRL                                              CAS001
      *                                                                                       CAS009
     C                     MOVEA*IN,72    SAVIN2  7                                           CAS009
      *                                                                                       CAS001
      ** Validate until F3 or F12 or error is encountered                                     CAS001
      *                                                                                       CAS001
     C           *IN03     DOUEQ*ON                                                           CAS001
     C           *IN12     OREQ *ON                                                           CAS001
     C           *IN62     OREQ *OFF                                                          226093
     C           WKSUBR    ANDEQ'FXP'                                                         226093
     C           *IN63     OREQ *OFF                                                          CAS001
     C           WKSUBR    ANDEQ'MMP'                                                         CAS001
     C           *IN64     OREQ *OFF                                                          CAS001
     C           WKSUBR    ANDEQ'NAP'                                                         CAS001
     C           CAS004    OREQ 'Y'                                                           CAS004
     C           WKSNPV    ANDEQ*BLANKS                                                       CAS004
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           WKSNPV    ANDEQ*BLANKS                                                       CAS005
     C           WKSUBR    IFEQ 'FXP'                                                         226093
     C                     MOVE *OFF      *IN62                                               226093
     C                     ENDIF                                                              226093
     C           WKSUBR    IFEQ 'MMP'                                                         CAS001
     C                     MOVE *OFF      *IN63                                               CAS001
     C                     ENDIF                                                              CAS001
     C           WKSUBR    IFEQ 'NAP'                                                         CAS001
     C                     MOVE *OFF      *IN64                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     WRITE#MSGCTL                                                       CAS001
     C                     EXFMTAKEYNPV                                                       CAS001
     C                     MOVEA'000000'  *IN,86                                              CAS001
      *                                                                                       CAS001
      ** Clear messages from program message queue .                                          CAS001
      *                                                                                       CAS001
     C                     CALL 'Y2CLMSC'                                                     CAS001
     C                     PARM SPGMQ     ZAPGM                                               CAS001
     C                     PARM '*SAME'   ZAPGRL                                              CAS001
      *                                                                                       CAS001
      ** Validate fields                                                                      CAS001
      *                                                                                       CAS001
     C           *IN03     IFEQ *OFF                                                          CAS001
     C           *IN12     ANDEQ*OFF                                                          CAS001
      *                                                                                       CAS001
      ** Call subroutine that validates NPV screen fields                                     CAS001
      *                                                                                       CAS001
     C                     EXSR SRVNPV                                                        CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDDO                                                              CAS001
      *                                                                                       CAS001
      ** If F12 pressed, if analytical account is installed, and conditions satisfied         CAS001
      ** redisplay previous screen                                                            CAS001
      *                                                                                       CAS001
     C           *IN12     IFEQ *ON                                                           CAS001
     C           BGN0ST    IFEQ 'Y'                                                           CAS001
     C           TYPE      ANDNE'ID'                                                          CAS001
     C           TYPE      ANDNE'IL'                                                          CAS001
     C           WKSUBR    ANDEQ'MMP'                                                         CAS001
     C           BGN0ST    OREQ 'Y'                                                           CAS001
     C           TYPE      ANDNE'TB'                                                          CAS001
     C           TYPE      ANDNE'TA'                                                          CAS001
     C           TYPE      ANDNE'DA'                                                          CAS001
     C           WKSUBR    ANDEQ'NAP'                                                         CAS001
     C           BGN0ST    OREQ 'Y'                                                           226093
     C           WKSUBR    ANDEQ'FXP'                                                         226093
     C                     MOVE 'Y'       WKSCAA                                              CAS001
     C**********           MOVE '0'       *IN12                                        CAS001 CAS009
     C                     ELSE                                                               CAS001
     C           WKSUBR    IFEQ 'FXP'                                                         226093
     C                     MOVE '1'       *IN62                                               226093
     C                     ENDIF                                                              226093
     C           WKSUBR    IFEQ 'MMP'                                                         CAS001
     C                     MOVE '1'       *IN63                                               CAS001
     C                     ENDIF                                                              CAS001
     C           WKSUBR    IFEQ 'NAP'                                                         CAS001
     C                     MOVE '1'       *IN64                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
      ** If F3 is pressed, exit                                                               CAS001
      *                                                                                       CAS001
     C           *IN03     IFEQ *ON                                                           CAS001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C           WKSUBR    IFEQ 'FXP'                                                         226093
     C                     MOVE '1'       *IN62                                               226093
     C                     ENDIF                                                              226093
     C           WKSUBR    IFEQ 'MMP'                                                         CAS001
     C                     MOVE '1'       *IN63                                               CAS001
     C                     ENDIF                                                              CAS001
     C           WKSUBR    IFEQ 'NAP'                                                         CAS001
     C                     MOVE '1'       *IN64                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS009
     C                     MOVEASAVIN2    *IN,72                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS001
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SREWTA - Checks if EU Withholding Tax accounting should      *                       CGL031
      *           be executed in the system.                          *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SREWTA    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       WEWTA   1                                           CGL031
      *                                                                                       CGL031
     C********** TYPE      IFEQ 'IT'                                                   CGL031 233565
     C********** TYPE      OREQ 'TD'                                                   CGL031 233565
     C           TYPE      IFEQ 'TD'                                                          233565
     C           TYPE      OREQ 'CD'                                                          CGL031
     C                     MOVE 'Y'       WEWTA                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           CDL006    IFEQ 'Y'                                                           CGL031
     C           TYPE      IFEQ 'FT'                                                          CGL031
     C           TYPE      OREQ 'DT'                                                          CGL031
     C********** TYPE      OREQ 'LT'                                                   CGL031 233565
     C                     MOVE 'Y'       WEWTA                                               CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGTAX - Generates account keys for EU Withholding Tax       *                       CGL031
      *           accounting.                                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *OFF      *IN36                                               CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   DLKEY                                               CGL031
     C                     MOVE TYPE      DTYPD                                               CGL031
     C                     MOVE STYP      STYPD                                               CGL031
      *                                                                                       CGL031
      ** xxIyy___UD                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'UD'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE BLSPTA    AC4                                                 CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ** xxIyycccUF                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE 'UF'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C           *LOVAL    SETLLSDCURRL1                                                      CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C           *IN10     DOWEQ*OFF                                                          CGL031
     C                     MOVE A6CYCD    CYD                                                 CGL031
     C                     MOVE A6SPAE    AC1                                                 CGL031
     C                     EXSR ACUP                                                          CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** xxIyycccUG                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE 'UG'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C           *LOVAL    SETLLSDCURRL1                                                      CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C           *IN10     DOWEQ*OFF                                                          CGL031
     C                     MOVE A6CYCD    CYD                                                 CGL031
     C                     MOVE A6SPAE    AC4                                                 CGL031
     C                     EXSR ACUP                                                          CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** xxIyy___US                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'US'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE BLSPTA    AC1                                                 CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ** xxIyy___UN                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'UN'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 233565
     C                     MOVE *ZERO     PR4                                                 233565
      *                                                                                       233565
     C           SIPRT     IFEQ 'Y'                                                           233565
     C                     MOVE '01'      PN4                                                 CGL031
     C                     MOVE '2'       PR4                                                 CGL031
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       233565
      ** xxIyy___UC, this must be generated only for 'CD' deal type                           233565
      *                                                                                       233565
     C           DTYPD     IFEQ 'CD'                                                          233565
     C           DTYPD     OREQ 'TD'                                                        MD031566
     C           DTYPD     OREQ 'DT'                                                        MD031566
     C           CDL006    ANDEQ'Y'                                                         MD031566
     C           DTYPD     OREQ 'FT'                                                        MD031566
     C           CDL006    ANDEQ'Y'                                                         MD031566
     C                     MOVE 'I'       EVENTD                                              233565
     C                     MOVE *BLANKS   CYD                                                 233565
     C                     MOVE 'UC'      DLKEY                                               233565
     C                     MOVE *BLANKS   FMKEYS                                              233565
      *                                                                                       233565
     C                     MOVE *ZEROS    AC1                                                 233565
     C                     MOVE *BLANKS   PN1                                                 233565
     C                     MOVE *ZERO     PR1                                                 233565
      *                                                                                       233565
     C                     MOVE *ZEROS    AC4                                                 233565
     C                     MOVE *BLANKS   PN4                                                 233565
     C                     MOVE *ZERO     PR4                                                 233565
      *                                                                                       233565
     C                     EXSR ACUP                                                          233565
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
      ** xxMyy___UD                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'UD'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE BLSPTA    AC4                                                 CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ** xxMyycccUF                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE 'UF'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C           *LOVAL    SETLLSDCURRL1                                                      CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C           *IN10     DOWEQ*OFF                                                          CGL031
     C                     MOVE A6CYCD    CYD                                                 CGL031
     C                     MOVE A6SPAE    AC1                                                 CGL031
     C                     EXSR ACUP                                                          CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** xxMyycccUG                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE 'UG'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C           *LOVAL    SETLLSDCURRL1                                                      CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C           *IN10     DOWEQ*OFF                                                          CGL031
     C                     MOVE A6CYCD    CYD                                                 CGL031
     C                     MOVE A6SPAE    AC4                                                 CGL031
     C                     EXSR ACUP                                                          CGL031
     C                     READ SDCURRL1                 10                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** xxMyy___US                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'US'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE BLSPTA    AC1                                                 CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ***xxMyy___UN****************************************************                CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE 'M'       EVENTD                                       CGL031 233565
     C**********           MOVE *BLANKS   CYD                                          CGL031 233565
     C**********           MOVE 'UN'      DLKEY                                        CGL031 233565
     C**********           MOVE *BLANKS   FMKEYS                                       CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE *ZEROS    AC1                                          CGL031 233565
     C**********           MOVE *BLANKS   PN1                                          CGL031 233565
     C**********           MOVE *ZERO     PR1                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE *ZEROS    AC4                                          CGL031 233565
     C**********           MOVE *BLANKS   PN4                                          CGL031 233565
     C**********           MOVE *ZERO     PR4                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C********** SIPRT     IFEQ 'N'                                                    CGL031 233565
     C**********           MOVE '01'      PN4                                          CGL031 233565
     C**********           MOVE '2'       PR4                                          CGL031 233565
     C**********           ENDIF                                                       CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           EXSR ACUP                                                   CGL031 233565
      *                                                                                       CGL031
      ** xxMyy___UB                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVE 'UB'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C           SIPRT     IFEQ 'Y'                                                           CGL031
     C                     MOVE '01'      PN4                                                 CGL031
     C                     MOVE '2'       PR4                                                 CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ** Handle EU Withholding Tax Countries.                                                 CGL031
      *                                                                                       CGL031
     C                     CLEARWTCA                                                          CGL031
     C                     MOVEASWTC      WTCA                                                CGL031
      *                                                                                       CGL031
     C                     MOVE *IN10     WIN10                                               CGL031
     C                     MOVE 'N'       WIUAK   1                                           233565
     C                     MOVE 'N'       WIUBK   1                                           233565
     C                     MOVE 'N'       WMUAK   1                                           233565
      *                                                                                       CGL031
     C                     DO   10        I       20                                          CGL031
      *                                                                                       CGL031
     C           WTCA,I    IFNE *BLANKS                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE WTCA,I    KCTRR   2                                           CGL031
      *                                                                                       CGL031
      ** Retrieve record from Country of Tax file                                             CGL031
      *                                                                                       CGL031
     C           KCTRR     CHAINSDCTTXL2             10                                       CGL031
      *                                                                                       CGL031
     C           *IN10     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
      ** Generate account keys                                                                CGL031
      *                                                                                       CGL031
     C                     EXSR SRGACT                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE WIN10     *IN10                                               CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGACT - Generates account keys for a Country of Residence.  *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGACT    BEGSR                                                              CGL031
      *****************************************************************                233317 233565
      ***xxIyyzz_UC,*this*must*be*generated*only*for*'CD'*deal*type****                233317 233565
      *****************************************************************                233317 233565
     C********** DTYPD     IFEQ 'CD'                                                   233317 233565
     C**********           MOVE 'I'       EVENTD                                       233317 233565
     C**********           MOVE *BLANKS   CYD                                          233317 233565
     C**********           MOVELEWCTRR    CYD                                          233317 233565
     C**********           MOVE 'UC'      DLKEY                                        233317 233565
     C**********           MOVE *BLANKS   FMKEYS                                       233317 233565
      *****************************************************************                233317 233565
     C**********           MOVE *ZEROS    AC1                                          233317 233565
     C**********           MOVE *BLANKS   PN1                                          233317 233565
     C**********           MOVE *ZERO     PR1                                          233317 233565
      *****************************************************************                233317 233565
     C**********           MOVE *ZEROS    AC4                                          233317 233565
     C**********           MOVE *BLANKS   PN4                                          233317 233565
     C**********           MOVE *ZERO     PR4                                          233317 233565
      *****************************************************************                233317 233565
     C**********           EXSR ACUP                                                   233317 233565
     C**********           ENDIF                                                       233317 233565
      *****************************************************************                CGL031 233565
      ***xxIyyzz_UT****************************************************                CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE 'I'       EVENTD                                       CGL031 233565
     C**********           MOVE *BLANKS   CYD                                          CGL031 233565
     C**********           MOVELEWCTRR    CYD                                          CGL031 233565
     C**********           MOVE 'UT'      DLKEY                                        CGL031 233565
     C**********           MOVE *BLANKS   FMKEYS                                       CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE *ZEROS    AC1                                          CGL031 233565
     C**********           MOVE *BLANKS   PN1                                          CGL031 233565
     C**********           MOVE *ZERO     PR1                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE EWWTAC    AC4                                          CGL031 233565
     C**********           MOVE '01'      PN4                                          CGL031 233565
     C**********           MOVE '1'       PR4                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           EXSR ACUP                                                   CGL031 233565
      *****************************************************************                CGL031 233565
      ***xxIyyzz_UD****************************************************                CGL031 233565
      *                                                                                       CGL031
      ** xxIyy___UA                                                                           233565
      *                                                                                       233565
     C           WIUAK     IFNE 'Y'                                                           233565
      *                                                                                       233565
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C**********           MOVELEWCTRR    CYD                                          CGL031 233565
     C**********           MOVE 'UD'      DLKEY                                        CGL031 233565
     C                     MOVE 'UA'      DLKEY                                               233565
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '2'       PR1                                                 CGL031
      *                                                                                       233565
     C           SIPRT     IFEQ 'Y'                                                           233565
     C                     MOVE *BLANKS   PN1                                                 233565
     C                     MOVE *ZERO     PR1                                                 233565
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       233565
     C                     MOVE 'Y'       WIUAK                                               233565
     C                     ENDIF                                                              233565
      *                                                                                       233565
      ** xxIyy___UE, this must be generated only for 'CD' or 'DT' deal type                   233565
      *                                                                                       233565
     C           DTYPD     IFEQ 'CD'                                                          233565
     C           DTYPD     OREQ 'TD'                                                        MD031566
     C           DTYPD     OREQ 'DT'                                                          233565
     C           CDL006    ANDEQ'Y'                                                           233565
     C           DTYPD     OREQ 'FT'                                                        MD031566
     C           CDL006    ANDEQ'Y'                                                         MD031566
      *                                                                                       233565
     C           WIUBK     IFNE 'Y'                                                           233565
      *                                                                                       233565
     C                     MOVE 'I'       EVENTD                                              233565
     C                     MOVE *BLANKS   CYD                                                 233565
     C                     MOVE 'UE'      DLKEY                                               233565
     C                     MOVE *BLANKS   FMKEYS                                              233565
      *                                                                                       233565
     C                     MOVE *ZEROS    AC1                                                 233565
     C                     MOVE *BLANKS   PN1                                                 233565
     C                     MOVE *ZERO     PR1                                                 233565
      *                                                                                       233565
     C                     MOVE *ZEROS    AC4                                                 233565
     C                     MOVE *BLANKS   PN4                                                 233565
     C                     MOVE *ZERO     PR4                                                 233565
      *                                                                                       233565
     C                     EXSR ACUP                                                          233565
      *                                                                                       233565
     C                     MOVE 'Y'       WIUBK                                               233565
     C                     ENDIF                                                              233565
      *                                                                                       233565
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
      ** xxIyyzz_US                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'I'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVELEWCTRR    CYD                                                 CGL031
     C                     MOVE 'US'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE EWWTAC    AC4                                                 CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
      ***xxMyyzz_UT****************************************************                CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE 'M'       EVENTD                                       CGL031 233565
     C**********           MOVE *BLANKS   CYD                                          CGL031 233565
     C**********           MOVELEWCTRR    CYD                                          CGL031 233565
     C**********           MOVE 'UT'      DLKEY                                        CGL031 233565
     C**********           MOVE *BLANKS   FMKEYS                                       CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE *ZEROS    AC1                                          CGL031 233565
     C**********           MOVE *BLANKS   PN1                                          CGL031 233565
     C**********           MOVE *ZERO     PR1                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           MOVE EWWTAC    AC4                                          CGL031 233565
     C**********           MOVE '01'      PN4                                          CGL031 233565
     C**********           MOVE '1'       PR4                                          CGL031 233565
      *****************************************************************                CGL031 233565
     C**********           EXSR ACUP                                                   CGL031 233565
      *****************************************************************                CGL031 233565
      ***xxMyyzz_UD****************************************************                CGL031 233565
      *                                                                                       CGL031
      ** xxMyy___UA                                                                           233565
      *                                                                                       233565
     C           WMUAK     IFNE 'Y'                                                           233565
      *                                                                                       233565
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C**********           MOVELEWCTRR    CYD                                          CGL031 233565
     C**********           MOVE 'UD'      DLKEY                                        CGL031 233565
     C                     MOVE 'UA'      DLKEY                                               233565
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C**********           MOVE '01'      PN1                                        CGL031 BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '2'       PR1                                                 CGL031
      *                                                                                       233565
     C           SIPRT     IFEQ 'Y'                                                           233565
     C                     MOVE *BLANKS   PN1                                                 233565
     C                     MOVE *ZERO     PR1                                                 233565
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC4                                                 CGL031
     C                     MOVE *BLANKS   PN4                                                 CGL031
     C                     MOVE *ZERO     PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       234421
      ** xxMyy___UR, this must be generated only for 'TD' and 'FT' deal types                 234421
      *                                                                                       234421
     C           DTYPD     IFEQ 'TD'                                                          234421
     C           DTYPD     OREQ 'FT'                                                          234421
      *                                                                                       234421
     C                     MOVE 'M'       EVENTD                                              234421
     C                     MOVE *BLANKS   CYD                                                 234421
     C                     MOVE 'UR'      DLKEY                                               234421
     C                     MOVE *BLANKS   FMKEYS                                              234421
      *                                                                                       234421
     C                     MOVE *ZEROS    AC1                                                 234421
     C                     MOVE *BLANKS   PN1                                                 234421
     C                     MOVE *ZERO     PR1                                                 234421
      *                                                                                       234421
     C********** SIPRT     IFNE 'Y'                                               BUG23692A BUG26326
      *                                                                                    BUG23692A
     C**********           MOVE '01'      PN1                                     BUG23692A BUG23884
     C**********           MOVE '37'      PN1                                     BUG23884 BUG23884A
      *                                                                                     BUG26326
      ** the xxMyy___UR key should never settle                                             BUG26326
     C**********           MOVE '01'      PN1                                     BUG23884A BUG26326
     C**********           MOVE '2'       PR1                                     BUG23692A BUG26326
      *                                                                                    BUG23692A
     C**********           ENDIF                                                  BUG23692A BUG26326
      *                                                                                    BUG23692A
     C                     MOVE *ZEROS    AC4                                                 234421
     C                     MOVE *BLANKS   PN4                                                 234421
     C                     MOVE *ZERO     PR4                                                 234421
      *                                                                                       234421
     C                     EXSR ACUP                                                          234421
      *                                                                                       234421
      ** xxMyy___UV, this must be generated only for 'TD' deal type                           234421
      *                                                                                       234421
     C                     MOVE 'M'       EVENTD                                              234421
     C                     MOVE *BLANKS   CYD                                                 234421
     C                     MOVE 'UV'      DLKEY                                               234421
     C                     MOVE *BLANKS   FMKEYS                                              234421
      *                                                                                       234421
     C                     MOVE *ZEROS    AC1                                                 234421
     C                     MOVE *BLANKS   PN1                                                 234421
     C                     MOVE *ZERO     PR1                                                 234421
      *                                                                                       234421
     C                     MOVE *ZEROS    AC4                                                 234421
     C                     MOVE *BLANKS   PN4                                                 234421
     C                     MOVE *ZERO     PR4                                                 234421
      *                                                                                       234421
     C                     EXSR ACUP                                                          234421
      *                                                                                       234421
     C                     ENDIF                                                              234421
      *                                                                                       233565
     C                     MOVE 'Y'       WMUAK                                               233565
     C                     ENDIF                                                              233565
      *                                                                                       CGL031
      ** xxMyyzz_US                                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE 'M'       EVENTD                                              CGL031
     C                     MOVE *BLANKS   CYD                                                 CGL031
     C                     MOVELEWCTRR    CYD                                                 CGL031
     C                     MOVE 'US'      DLKEY                                               CGL031
     C                     MOVE *BLANKS   FMKEYS                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ZEROS    AC1                                                 CGL031
     C                     MOVE *BLANKS   PN1                                                 CGL031
     C                     MOVE *ZERO     PR1                                                 CGL031
      *                                                                                       CGL031
     C                     MOVE EWWTAC    AC4                                                 CGL031
     C**********           MOVE '01'      PN4                                        CGL031 BUG23884
     C**********           MOVE '37'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CGL031
      *                                                                                       CGL031
     C                     EXSR ACUP                                                          CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRCURR - Gets currency details via AOCURRR0.                 *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRCURR    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM           PCCY    3                                           CGL031
     C           SDCURR    PARM SDCURR    DSFDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELPCCY      DBKEY                                               CGL031
     C                     Z-ADD102       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBERR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRDTAX - Displays the EU Withholding Tax screen.             *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRDTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise relevant variables.                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   SWTC                                                CGL031
     C                     MOVE *BLANKS   SIPRT                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WLFLG   1                                           CGL031
     C                     MOVE 'N'       WGFLG   1                                           CGL031
      *                                                                                       CGL031
     C                     MOVE *ALL'0'   WOFFS  11                                           CGL031
     C                     MOVEAWOFFS     *IN,86                                              CGL031
      *                                                                                       CGL031
      ** Clear program messages.                                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'ZA0250'                                                      CGL031
      *                                                                                       CGL031
     C           WLFLG     DOWEQ'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     WRITE#MSGCTL                                                       CGL031
     C                     EXFMTAKEYTAX                                                       CGL031
      *                                                                                       CGL031
     C                     CALL 'ZA0250'                                                      CGL031
      *                                                                                       CGL031
     C           *IN03     IFEQ *ON                                                           CGL031
     C           *IN12     OREQ *ON                                                           CGL031
     C                     MOVE 'N'       WLFLG                                               CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
      ** Validate input fields.                                                               CGL031
      *                                                                                       CGL031
     C                     EXSR SRVTAX                                                        CGL031
      *                                                                                       CGL031
     C           WEFLG     IFEQ 'Y'                                                           CGL031
     C                     MOVE 'Y'       WLFLG                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'Y'       WGFLG                                               CGL031
     C                     MOVE 'N'       WLFLG                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRVTAX - Validates input for EU Withholding Tax accounting.  *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRVTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *ALL'0'   WOFFS                                               CGL031
     C                     MOVEAWOFFS     *IN,86                                              CGL031
     C                     MOVE 'N'       WEFLG   1                                           CGL031
      *                                                                                       CGL031
      ** Handle EU Withholding Tax Countries.                                                 CGL031
      *                                                                                       CGL031
     C                     CLEARWTCA                                                          CGL031
     C                     MOVEASWTC      WTCA                                                CGL031
      *                                                                                       CGL031
      ** Validate EU Withholding Tax Countries.                                               CGL031
      *                                                                                       CGL031
     C                     MOVE *IN10     WIN10   1                                           CGL031
      *                                                                                       CGL031
     C                     DO   10        I       20                                          CGL031
      *                                                                                       CGL031
     C           WTCA,I    IFNE *BLANKS                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE WTCA,I    KCTRR                                               CGL031
     C           KCTRR     CHAINSDCTTXL2             10                                       CGL031
      *                                                                                       CGL031
      ** Check for repeated inputs.                                                           CGL031
      *                                                                                       CGL031
     C                     DO   10        J       20                                          CGL031
     C           WTCA,I    IFEQ WTCA,J                                                        CGL031
     C           I         ANDNEJ                                                             CGL031
     C                     MOVE *ON       *IN10                                               CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD85        X       20                                          CGL031
     C                     ADD  I         X                                                   CGL031
     C                     MOVE *IN10     *IN,X                                               CGL031
      *                                                                                       CGL031
     C           *IN10     IFEQ *ON                                                           CGL031
     C                     MOVE 'Y'       WEFLG                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE WIN10     *IN10                                               CGL031
      *                                                                                       CGL031
      ** EU Withholding Tax Countries must be unique and valid Country Codes.                 CGL031
      *                                                                                       CGL031
     C           WEFLG     IFEQ 'Y'                                                           CGL031
     C                     MOVEL'USR4712' ZAMSID                                              CGL031
     C                     EXSR ZASNMS                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           SWTC      IFEQ *BLANKS                                                       CGL031
      *                                                                                       CGL031
      ** At least one EU Withholding Tax Country must be input.                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WEFLG                                               CGL031
     C                     MOVE *ALL'1'   WONS   10                                           CGL031
     C                     MOVEAWONS      *IN,86                                              CGL031
     C                     MOVEL'USR4717' ZAMSID                                              CGL031
     C                     EXSR ZASNMS                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Validate Interest and Principal Repaid Together at Maturity flag.                    CGL031
      *                                                                                       CGL031
     C           SIPRT     IFNE 'Y'                                                           CGL031
     C           SIPRT     ANDNE'N'                                                           CGL031
      *                                                                                       CGL031
      ** Flag must be 'Y' or 'N'.                                                             CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WEFLG                                               CGL031
     C                     MOVE *ON       *IN96                                               CGL031
     C                     MOVEL'USR4713' ZAMSID                                              CGL031
     C                     EXSR ZASNMS                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRDHAC - Subroutine to display Hedge Accounting screen fields *                       CAS004
      *                                                               *                       CAS004
      * Called by: SRVNPV                                             *                       CAS004
      *                                                               *                       CAS004
      * Calls: SRVHAC                                                 *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRDHAC    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** If no error from NPV screen, display and validate AKEYHAC screen                     CAS004
      *                                                                                       CAS004
     C           *IN63     IFEQ *OFF                                                          CAS004
     C           TYPE      ANDNE'ID'                                                          CAS004
     C           TYPE      ANDNE'IL'                                                          CAS004
     C           WKSUBR    ANDEQ'MMP'                                                         CAS004
     C           *IN64     OREQ *OFF                                                          CAS004
     C           WKSUBR    ANDEQ'NAP'                                                         CAS004
     C           *IN63     OREQ *OFF                                                          CAS005
     C           TYPE      ANDEQ'IL'                                                          CAS005
     C           CAS005    ANDEQ'Y'                                                           CAS005
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           *IN63     OREQ *OFF                                                          CAS005
     C           TYPE      ANDEQ'ID'                                                          CAS005
     C           CAS005    ANDEQ'Y'                                                           CAS005
     C           CAS007    ANDEQ'Y'                                                           CAS007
      *                                                                                       CAS004
      ** Clear messages from program message queue                                            CAS004
      *                                                                                       CAS004
     C                     CALL 'Y2CLMSC'                                                     CAS004
     C                     PARM SPGMQ     ZAPGM                                               CAS004
     C                     PARM '*SAME'   ZAPGRL                                              CAS004
      *                                                                                       CAS004
      ** Validate until F3 or F12 or error is encountered                                     CAS004
      *                                                                                       CAS004
     C           *IN03     DOUEQ*ON                                                           CAS004
     C           *IN12     OREQ *ON                                                           CAS004
     C           *IN63     OREQ *OFF                                                          CAS004
     C           WKSUBR    ANDEQ'MMP'                                                         CAS004
     C           *IN64     OREQ *OFF                                                          CAS004
     C           WKSUBR    ANDEQ'NAP'                                                         CAS004
      *                                                                                       CAS004
      ** Reset Error Indicators                                                               CAS004
      *                                                                                       CAS004
     C           WKSUBR    IFEQ 'MMP'                                                         CAS004
     C                     MOVE *OFF      *IN63                                               CAS004
     C                     ENDIF                                                              CAS004
     C           WKSUBR    IFEQ 'NAP'                                                         CAS004
     C                     MOVE *OFF      *IN64                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     WRITE#MSGCTL                                                       CAS004
     C                     EXFMTAKEYHAC                                                       CAS004
     C                     MOVEA'000000'  *IN,86                                              CAS004
     C                     MOVEA'000000'  *IN,92                                              CAS004
      *                                                                                       CAS004
      ** Clear messages from program message queue                                            CAS004
      *                                                                                       CAS004
     C                     CALL 'Y2CLMSC'                                                     CAS004
     C                     PARM SPGMQ     ZAPGM                                               CAS004
     C                     PARM '*SAME'   ZAPGRL                                              CAS004
      *                                                                                       CAS004
      ** Validate fields                                                                      CAS004
      *                                                                                       CAS004
     C           *IN03     IFEQ *OFF                                                          CAS004
     C           *IN12     ANDEQ*OFF                                                          CAS004
      *                                                                                       CAS004
      ** Call subroutine that validates Hedge Accounting screen fields                        CAS004
      *                                                                                       CAS004
     C                     EXSR SRVHAC                                                        CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDDO                                                              CAS004
      *                                                                                       CAS004
      ** If F12 pressed, redisplay previous screen                                            CAS004
      *                                                                                       CAS004
     C           *IN12     IFEQ *ON                                                           CAS004
     C                     MOVE 'Y'       WKSNPV                                              CAS004
     C                     MOVE *OFF      *IN12                                               CAS004
     C                     MOVEA'000000'  *IN,86                                              CAS004
     C           WKSUBR    IFEQ 'MMP'                                                         CAS004
     C                     MOVE *ON       *IN63                                               CAS004
     C                     ENDIF                                                              CAS004
     C           WKSUBR    IFEQ 'NAP'                                                         CAS004
     C                     MOVE *ON       *IN64                                               CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** If F3 is pressed, exit                                                               CAS004
      *                                                                                       CAS004
     C           *IN03     IFEQ *ON                                                           CAS004
     C           WKSUBR    IFEQ 'MMP'                                                         CAS004
     C                     MOVE *ON       *IN63                                               CAS004
     C                     ENDIF                                                              CAS004
     C           WKSUBR    IFEQ 'NAP'                                                         CAS004
     C                     MOVE *ON       *IN64                                               CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRVHAC - Subroutine to validate Hedge Accounting screen       *                       CAS004
      *                                                               *                       CAS004
      * Called by: SRDHAC                                             *                       CAS004
      *                                                               *                       CAS004
      * Calls: SRACOD                                                 *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRVHAC    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Effective Fair Value Hedge Profit Contra                       CAS004
      ** Account; Profit Posting Reference; Other Income Account;                             CAS004
      ** Effective Fair Value Hedge Loss Contra Account; Loss Posting                         CAS004
      ** Reference; Other Expenses Account                                                    CAS004
      *                                                                                       CAS004
     C                     MOVE ' '       WKEREN  1                                           CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SEFVHP    WHNE *BLANKS                                                       CAS004
     C           SFVPPR    ANDNE*BLANKS                                                       CAS004
     C           SOTINC    ANDNE*BLANKS                                                       CAS004
     C           SEFVHL    ANDNE*BLANKS                                                       CAS004
     C           SFVLPR    ANDNE*BLANKS                                                       CAS004
     C           SOTEXP    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Effective Fair Value Hedge Profit Account                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD  1                                           CAS004
     C                     MOVELSEFVHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN86                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SFVPPR    IFNE '1'                                                           CAS004
     C           SFVPPR    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN87                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Income Account                                                        CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSOTINC    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SOTINC                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN88                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Effective Fair Value Hedge Loss Account                                     CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSEFVHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN89                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SFVLPR    IFNE '1'                                                           CAS004
     C           SFVLPR    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN90                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Expense Account                                                       CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSOTEXP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SOTEXP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN91                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SEFVHP    WHEQ *BLANKS                                                       CAS004
     C           SFVPPR    ANDEQ*BLANKS                                                       CAS004
     C           SOTINC    ANDEQ*BLANKS                                                       CAS004
     C           SEFVHL    ANDEQ*BLANKS                                                       CAS004
     C           SFVLPR    ANDEQ*BLANKS                                                       CAS004
     C           SOTEXP    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9388' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,86                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Effective Cash Flow Hedge Profit Contra                        CAS004
      ** Account; Profit Posting Reference; Other Comprehensive Income                        CAS004
      ** Account; Effective Cash Flow Hedge Loss Contra Account; Loss                         CAS004
      ** Posting Reference; Other Comprehensive Income Account(Loss)                          CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SECFHP    WHNE *BLANKS                                                       CAS004
     C           SCFPPR    ANDNE*BLANKS                                                       CAS004
     C           SOCOMP    ANDNE*BLANKS                                                       CAS004
     C           SECFHL    ANDNE*BLANKS                                                       CAS004
     C           SCFLPR    ANDNE*BLANKS                                                       CAS004
     C           SOCOML    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Effective Cash Flow Hedge Profit Account                                    CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN92                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SCFPPR    IFNE '1'                                                           CAS004
     C           SCFPPR    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN93                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Comprehensive Income Account                                          CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSOCOMP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SOCOMP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN94                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Effective Cash Flow Hedge Loss Account                                      CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN95                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SCFLPR    IFNE '1'                                                           CAS004
     C           SCFLPR    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN96                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Comprehensive Income Account                                          CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSOCOML    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SOCOML                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN97                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SECFHP    WHEQ *BLANKS                                                       CAS004
     C           SCFPPR    ANDEQ*BLANKS                                                       CAS004
     C           SOCOMP    ANDEQ*BLANKS                                                       CAS004
     C           SECFHL    ANDEQ*BLANKS                                                       CAS004
     C           SCFLPR    ANDEQ*BLANKS                                                       CAS004
     C           SOCOML    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9389' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,92                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
     C           WKEREN    IFEQ 'Y'                                                           CAS004
     C           WKSUBR    IFEQ 'MMP'                                                         CAS004
     C                     MOVE *ON       *IN63                                               CAS004
     C                     ENDIF                                                              CAS004
     C           WKSUBR    IFEQ 'NAP'                                                         CAS004
     C                     MOVE *ON       *IN64                                               CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS004
      ********************************************************************                    CAS001
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRGHAC - Subroutine to generate account keys for Hedge        *                       CAS004
      *          Accounting                                           *                       CAS004
      *                                                               *                       CAS004
      * Called by: MMP, NAP                                           *                       CAS004
      *                                                               *                       CAS004
      * Calls: ACUP                                                   *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRGHAC    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** Set flag to prevent reversal of DR/CR in S/R ACUP                                    CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       PLFLAG                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFIP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE *BLANKS   DLKEY                                               CAS004
     C                     MOVE TYPE      DTYPD                                               CAS004
     C                     MOVE STYP      STYPD                                               CAS004
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE 'A'       EVENTD                                              CAS004
     C                     MOVEL'  '      CYD                                                 CAS004
     C                     MOVE 'FIP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SEFVHP    AC1                                                 CAS004
     C                     MOVE SFVPPR    PR1                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFIP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SOTINC    AC4                                                 CAS004
     C                     MOVE SFVPPR    PR4                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFIL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'FIL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SOTEXP    AC1                                                 CAS004
     C                     MOVE SFVLPR    PR1                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFIL - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SEFVHL    AC4                                                 CAS004
     C                     MOVE SFVLPR    PR4                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCIP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CIP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SECFHP    AC1                                                 CAS004
     C                     MOVE SCFPPR    PR1                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCIP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SOCOMP    AC4                                                 CAS004
     C                     MOVE SCFPPR    PR4                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCIL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CIL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SOCOML    AC1                                                 CAS004
     C                     MOVE SCFLPR    PR1                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCIP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SECFHL    AC4                                                 CAS004
     C                     MOVE SCFLPR    PR4                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       PLFLAG                                              CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRDCXS - Subroutine to display Hedge Accounting screen fields *                       CAS004
      *          for deal type 'CX'.                                  *                       CAS004
      *                                                               *                       CAS004
      * Called by: FXP                                                *                       CAS004
      *                                                               *                       CAS004
      * Calls: SRVECX, SRVICX                                         *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRDCXS    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** If no error from Foreign Exchange Screen, display and validate                       CAS004
      ** AKEYECX and AKEYICX screen                                                           CAS004
      *                                                                                       CAS004
     C           *IN62     IFEQ *OFF                                                          CAS004
     C           WKSUBR    ANDEQ'FXP'                                                         CAS004
      *                                                                                       CAS004
      ** Clear messages from program message queue                                            CAS004
      *                                                                                       CAS004
     C                     CALL 'Y2CLMSC'                                                     CAS004
     C                     PARM SPGMQ     ZAPGM                                               CAS004
     C                     PARM '*SAME'   ZAPGRL                                              CAS004
      *                                                                                       CAS004
      ** Validate until F3 or F12 or error is encountered                                     CAS004
      *                                                                                       CAS004
     C           *IN03     DOUEQ*ON                                                           CAS004
     C           *IN12     OREQ *ON                                                           CAS004
     C           *IN62     OREQ *OFF                                                          CAS004
      *                                                                                       CAS004
      ** Reset Error Indicator                                                                CAS004
      *                                                                                       CAS004
     C                     MOVE *OFF      *IN62                                               CAS004
     C                     WRITE#MSGCTL                                                       CAS004
      *                                                                                       CAS004
     C           WEFFEC    IFEQ 'Y'                                                           CAS004
     C           WCXSCN    ANDEQ'Y'                                                           CAS004
     C                     EXFMTAKEYECX                                                       CAS004
     C                     ELSE                                                               CAS004
     C                     EXFMTAKEYICX                                                       CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     MOVEA'000000'  *IN,86                                              CAS004
     C                     MOVEA'000000'  *IN,92                                              CAS004
      *                                                                                       CAS004
      ** Clear messages from program message queue                                            CAS004
      *                                                                                       CAS004
     C                     CALL 'Y2CLMSC'                                                     CAS004
     C                     PARM SPGMQ     ZAPGM                                               CAS004
     C                     PARM '*SAME'   ZAPGRL                                              CAS004
      *                                                                                       CAS004
      ** Validate fields                                                                      CAS004
      *                                                                                       CAS004
     C           *IN03     IFEQ *OFF                                                          CAS004
     C           *IN12     ANDEQ*OFF                                                          CAS004
      *                                                                                       CAS004
      ** Call subroutine that validates Hedge Accounting screen fields                        CAS004
      *                                                                                       CAS004
     C           WEFFEC    IFEQ 'Y'                                                           CAS004
     C                     EXSR SRVECX                                                        CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR SRVICX                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDDO                                                              CAS004
      *                                                                                       CAS004
      ** If F12 pressed, redisplay FXP screen                                                 CAS004
      *                                                                                       CAS004
     C           *IN12     IFEQ *ON                                                           CAS004
     C                     MOVE *OFF      *IN12                                               CAS004
     C                     MOVEA'000000'  *IN,86                                              CAS004
     C                     MOVE *ON       *IN62                                               CAS004
     C           WEFFEC    IFEQ 'Y'                                                           CAS004
     C                     MOVE 'N'       WCXSCN                                              CAS004
     C                     ELSE                                                               CAS004
     C                     MOVE 'Y'       WCXSCN                                              CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** If F3 is pressed, exit                                                               CAS004
      *                                                                                       CAS004
     C           *IN03     IFEQ *ON                                                           CAS004
     C                     MOVE *ON       *IN62                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS005
      *****************************************************************                       CAS005
      /EJECT                                                                                  CAS005
      *****************************************************************                       CAS005
      *                                                               *                       CAS005
      * SRDCX5 - Subroutine to display Hedge Accounting screen fields *                       CAS005
      *          for deal type 'CX'if CAS005 is installed.            *                       CAS005
      *                                                               *                       CAS005
      * Called by: FXP                                                *                       CAS005
      *                                                               *                       CAS005
      * Calls: SRVUCX                                                 *                       CAS005
      *                                                               *                       CAS005
      *****************************************************************                       CAS005
      *                                                                                       CAS005
     C           SRDCX5    BEGSR                                                              CAS005
      *                                                                                       CAS005
      ** If no error from Foreign Exchange Screen, display and validate                       CAS005
      ** AKEYECX and AKEYICX screen                                                           CAS005
      *                                                                                       CAS005
     C           *IN62     IFEQ *OFF                                                          CAS005
     C           WKSUBR    ANDEQ'FXP'                                                         CAS005
      *                                                                                       CAS005
      ** Clear messages from program message queue                                            CAS005
      *                                                                                       CAS005
     C                     CALL 'Y2CLMSC'                                                     CAS005
     C                     PARM SPGMQ     ZAPGM                                               CAS005
     C                     PARM '*SAME'   ZAPGRL                                              CAS005
      *                                                                                       CAS005
      ** Validate until F3 or F12 or error is encountered                                     CAS005
      *                                                                                       CAS005
     C           *IN03     DOUEQ*ON                                                           CAS005
     C           *IN12     OREQ *ON                                                           CAS005
     C           *IN62     OREQ *OFF                                                          CAS005
      *                                                                                       CAS005
      ** Reset Error Indicator                                                                CAS005
      *                                                                                       CAS005
     C                     MOVE *OFF      *IN62                                               CAS005
     C                     WRITE#MSGCTL                                                       CAS005
      *                                                                                       CAS005
     C           CAS007    IFEQ 'Y'                                                           CAS007
      *                                                                                       CAS007
     C                     EXFMTAKEYUCX                                                       CAS005
      *                                                                                       CAS005
     C                     MOVEA'000000'  *IN,86                                              CAS005
     C                     MOVEA'000000'  *IN,92                                              CAS005
      *                                                                                       CAS005
      ** Clear messages from program message queue                                            CAS005
      *                                                                                       CAS005
     C                     CALL 'Y2CLMSC'                                                     CAS005
     C                     PARM SPGMQ     ZAPGM                                               CAS005
     C                     PARM '*SAME'   ZAPGRL                                              CAS005
      *                                                                                       CAS005
      ** Validate fields                                                                      CAS005
      *                                                                                       CAS005
     C           *IN03     IFEQ *OFF                                                          CAS005
     C           *IN12     ANDEQ*OFF                                                          CAS005
      *                                                                                       CAS005
      ** Call subroutine that validates Hedge Accounting screen fields                        CAS005
      *                                                                                       CAS005
     C                     EXSR SRVUCX                                                        CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS007
      *                                                                                       226093
      ** If no error from Foreign Exchange Screen and F3 or F12 not press,                    226093
      ** display NPV screen for UP and UL                                                     226093
      *                                                                                       226093
     C           CAS005    IFEQ 'Y'                                                           226093
     C           *IN03     ANDEQ*OFF                                                          226093
     C           *IN12     ANDEQ*OFF                                                          226093
     C           *IN62     ANDEQ*OFF                                                          226093
     C                     MOVE 'FXP'     WKSUBR                                              226093
     C                     EXSR SRDNPV                                                        226093
      *                                                                                       226093
      ** If F12 pressed, redisplay UCX screen                                                 226093
      *                                                                                       226093
     C           *IN12     IFEQ *ON                                                           226093
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C                     MOVE *OFF      *IN12                                               226093
     C                     ENDIF                                                              CAS007
     C                     MOVEA'000000'  *IN,86                                              226093
     C           CAS007    IFEQ 'Y'                                                           CAS007
     C                     MOVE *ON       *IN62                                               226093
     C                     ENDIF                                                              CAS007
     C                     ENDIF                                                              226093
     C                     ENDIF                                                              226093
      *                                                                                       CAS005
     C                     ENDDO                                                              CAS005
      *                                                                                       CAS005
      ** If F12 pressed, redisplay FXP screen                                                 CAS005
      *                                                                                       CAS005
     C           *IN12     IFEQ *ON                                                           CAS005
     C                     MOVE *OFF      *IN12                                               CAS005
     C                     MOVEA'000000'  *IN,86                                              CAS005
     C                     MOVE *ON       *IN62                                               CAS005
     C                     MOVE 'Y'       WUNREL  1                                           CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If F3 is pressed, exit                                                               CAS005
      *                                                                                       CAS005
     C           *IN03     IFEQ *ON                                                           CAS005
     C                     MOVE *ON       *IN62                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDSR                                                              CAS005
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRVECX - Subroutine to validate Hedge Accounting screen       *                       CAS004
      *                                                               *                       CAS004
      * Called by: SRDCXS                                             *                       CAS004
      *                                                               *                       CAS004
      * Calls: SRACOD                                                 *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRVECX    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Effective Fair Value Hedge Profit Contra                       CAS004
      ** Account; Profit Posting Reference; Hedge Profit Account;                             CAS004
      ** Effective Fair Value Hedge Loss Contra Account; Loss Posting                         CAS004
      ** Reference; Hedge Loss Account                                                        CAS004
      *                                                                                       CAS004
     C                     MOVE ' '       WKEREN  1                                           CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SEFVHP    WHNE *BLANKS                                                       CAS004
     C           SEFVRP    ANDNE*BLANKS                                                       CAS004
     C           SEFVAP    ANDNE*BLANKS                                                       CAS004
     C           SEFVHL    ANDNE*BLANKS                                                       CAS004
     C           SEFVRL    ANDNE*BLANKS                                                       CAS004
     C           SEFVAL    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Effective Fair Value Hedge Profit Account                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD  1                                           CAS004
     C                     MOVELSEFVHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN86                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SEFVRP    IFNE '1'                                                           CAS004
     C           SEFVRP    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN87                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Hedge Profit Account                                                        CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSEFVAP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVAP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN88                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Effective Fair Value Hedge Loss Account                                     CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSEFVHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN89                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SEFVRL    IFNE '1'                                                           CAS004
     C           SEFVRL    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN90                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Hedge Loss Account                                                          CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSEFVAL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SEFVAL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN91                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SEFVHP    WHEQ *BLANKS                                                       CAS004
     C           SEFVRP    ANDEQ*BLANKS                                                       CAS004
     C           SEFVAP    ANDEQ*BLANKS                                                       CAS004
     C           SEFVHL    ANDEQ*BLANKS                                                       CAS004
     C           SEFVRL    ANDEQ*BLANKS                                                       CAS004
     C           SEFVAL    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9388' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,86                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Effective Cash Flow Hedge Profit Contra                        CAS004
      ** Account; Profit Posting Reference; Other Comprehensive Income                        CAS004
      ** Account; Effective Cash Flow Hedge Loss Contra Account; Loss                         CAS004
      ** Posting Reference; Other Comprehensive Income Account(Loss)                          CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SECFHP    WHNE *BLANKS                                                       CAS004
     C           SECFRP    ANDNE*BLANKS                                                       CAS004
     C           SECFAP    ANDNE*BLANKS                                                       CAS004
     C           SECFHL    ANDNE*BLANKS                                                       CAS004
     C           SECFRL    ANDNE*BLANKS                                                       CAS004
     C           SECFAL    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Effective Cash Flow Hedge Profit Account                                    CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN92                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SECFRP    IFNE '1'                                                           CAS004
     C           SECFRP    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN93                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Comprehensive Income Account                                          CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFAP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFAP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN94                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Effective Cash Flow Hedge Loss Account                                      CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN95                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SECFRL    IFNE '1'                                                           CAS004
     C           SECFRL    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN96                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Other Comprehensive Income Account                                          CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSECFAL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SECFAL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN97                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SECFHP    WHEQ *BLANKS                                                       CAS004
     C           SECFRP    ANDEQ*BLANKS                                                       CAS004
     C           SECFAP    ANDEQ*BLANKS                                                       CAS004
     C           SECFHL    ANDEQ*BLANKS                                                       CAS004
     C           SECFRL    ANDEQ*BLANKS                                                       CAS004
     C           SECFAL    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9389' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,92                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
     C           WKEREN    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN62                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRVICX - Subroutine to validate Hedge Accounting screen       *                       CAS004
      *                                                               *                       CAS004
      * Called by: SRDCXS                                             *                       CAS004
      *                                                               *                       CAS004
      * Calls: SRACOD                                                 *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRVICX    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Ineffective Fair Value Hedge Profit Contra                     CAS004
      ** Account; Profit Posting Reference; Trading Profit Account;                           CAS004
      ** Ineffective Fair Value Hedge Loss Contra Account; Loss Posting                       CAS004
      ** Reference; Trading Loss Account                                                      CAS004
      *                                                                                       CAS004
     C                     MOVE ' '       WKEREN  1                                           CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SIFVHP    WHNE *BLANKS                                                       CAS004
     C           SIFVRP    ANDNE*BLANKS                                                       CAS004
     C           SIFVAP    ANDNE*BLANKS                                                       CAS004
     C           SIFVHL    ANDNE*BLANKS                                                       CAS004
     C           SIFVRL    ANDNE*BLANKS                                                       CAS004
     C           SIFVAL    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Ineffective Fair Value Hedge Profit Account                                 CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD  1                                           CAS004
     C                     MOVELSIFVHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SIFVHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN86                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SIFVRP    IFNE '1'                                                           CAS004
     C           SIFVRP    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN87                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Trading Profit Account                                                      CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSIFVAP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SIFVAP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN88                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Ineffective Fair Value Hedge Loss Account                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSIFVHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SIFVHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN89                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SIFVRL    IFNE '1'                                                           CAS004
     C           SIFVRL    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN90                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Trading Loss Account                                                        CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSIFVAL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SIFVAL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN91                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SIFVHP    WHEQ *BLANKS                                                       CAS004
     C           SIFVRP    ANDEQ*BLANKS                                                       CAS004
     C           SIFVAP    ANDEQ*BLANKS                                                       CAS004
     C           SIFVHL    ANDEQ*BLANKS                                                       CAS004
     C           SIFVRL    ANDEQ*BLANKS                                                       CAS004
     C           SIFVAL    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9390' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,86                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
      ** Enter ALL or NONE of: Ineffective Cash Flow Hedge Profit Contra                      CAS004
      ** Account; Profit Posting Reference; Trading Profit Account                            CAS004
      ** Ineffective Cash Flow Hedge Loss Contra Account; Loss Posting                        CAS004
      ** Reference; Trading Loss Account                                                      CAS004
      *                                                                                       CAS004
     C                     SELEC                                                              CAS004
      *                                                                                       CAS004
     C           SICFHP    WHNE *BLANKS                                                       CAS004
     C           SICFRP    ANDNE*BLANKS                                                       CAS004
     C           SICFAP    ANDNE*BLANKS                                                       CAS004
     C           SICFHL    ANDNE*BLANKS                                                       CAS004
     C           SICFRL    ANDNE*BLANKS                                                       CAS004
     C           SICFAL    ANDNE*BLANKS                                                       CAS004
      *                                                                                       CAS004
      ** Validate Ineffective Cash Flow Hedge Profit Account                                  CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSICFHP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SICFHP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN92                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SICFRP    IFNE '1'                                                           CAS004
     C           SICFRP    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN93                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Trading Profit Account                                                      CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSICFAP    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SICFAP                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN94                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Ineffective Cash Flow Hedge Loss Account                                    CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSICFHL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SICFHL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN95                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Posting Reference                                                           CAS004
      *                                                                                       CAS004
     C           SICFRL    IFNE '1'                                                           CAS004
     C           SICFRL    ANDNE'3'                                                           CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR4259' ZAMSID                                              CAS004
     C                     MOVE *ON       *IN96                                               CAS004
     C                     EXSR ZASNMS                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Validate Trading Loss Account                                                        CAS004
      *                                                                                       CAS004
     C                     MOVE 'N'       WERRCD                                              CAS004
     C                     MOVELSICFAL    PIACOD                                              CAS004
     C                     EXSR SRACOD                                                        CAS004
     C                     MOVELPIACOD    SICFAL                                              CAS004
      *                                                                                       CAS004
     C           WERRCD    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN97                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           SICFHP    WHEQ *BLANKS                                                       CAS004
     C           SICFRP    ANDEQ*BLANKS                                                       CAS004
     C           SICFAP    ANDEQ*BLANKS                                                       CAS004
     C           SICFHL    ANDEQ*BLANKS                                                       CAS004
     C           SICFRL    ANDEQ*BLANKS                                                       CAS004
     C           SICFAL    ANDEQ*BLANKS                                                       CAS004
      *                                                                                       CAS004
     C                     OTHER                                                              CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       WKEREN                                              CAS004
     C                     MOVE 'USR9391' ZAMSID                                              CAS004
     C                     MOVEA'111111'  *IN,92                                              CAS004
     C                     EXSR ZASNMS                                                        CAS004
      *                                                                                       CAS004
     C                     ENDSL                                                              CAS004
      *                                                                                       CAS004
     C           WKEREN    IFEQ 'Y'                                                           CAS004
     C                     MOVE *ON       *IN62                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS005
      *****************************************************************                       CAS005
      /EJECT                                                                                  CAS005
      *****************************************************************                       CAS005
      *                                                               *                       CAS005
      * SRVUCX - Subroutine to validate Hedge Accounting screen       *                       CAS005
      *                                                               *                       CAS005
      * Called by: SRDCX5                                             *                       CAS005
      *                                                               *                       CAS005
      * Calls: SRACOD                                                 *                       CAS005
      *                                                               *                       CAS005
      *****************************************************************                       CAS005
      *                                                                                       CAS005
     C           SRVUCX    BEGSR                                                              CAS005
      *                                                                                       CAS005
      ** Enter ALL or NONE of: Unrealised Fair Value Revalued Profit Contra                   CAS005
      ** Account; Profit Posting Reference; Revalued Profit Account;                          CAS005
      ** Unrealised Fair Value Revalued Loss Contra Account; Loss Posting                     CAS005
      ** Reference; Revalued Loss Account                                                     CAS005
      *                                                                                       CAS005
     C                     MOVE ' '       WKEREN  1                                           CAS005
      *                                                                                       CAS005
     C                     SELEC                                                              CAS005
      *                                                                                       CAS005
     C           SUFVRP    WHNE *BLANKS                                                       CAS005
     C           SUVPPR    ANDNE*BLANKS                                                       CAS005
     C           SUFVPA    ANDNE*BLANKS                                                       CAS005
     C           SUFVRL    ANDNE*BLANKS                                                       CAS005
     C           SUVLPR    ANDNE*BLANKS                                                       CAS005
     C           SUFVLA    ANDNE*BLANKS                                                       CAS005
      *                                                                                       CAS005
      ** Validate Unrealised Fair Value Revalued Profit Contra Account                        CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD  1                                           CAS005
     C                     MOVELSUFVRP    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUFVRP                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN86                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Posting Reference                                                           CAS005
      *                                                                                       CAS005
     C           SUVPPR    IFNE '1'                                                           CAS005
     C           SUVPPR    ANDNE'3'                                                           CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR4259' ZAMSID                                              CAS005
     C                     MOVE *ON       *IN87                                               CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Revalued Profit Account                                                     CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUFVPA    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUFVPA                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN88                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Unrealised Fair Value Revalued Loss Account                                 CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUFVRL    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUFVRL                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN89                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Posting Reference                                                           CAS005
      *                                                                                       CAS005
     C           SUVLPR    IFNE '1'                                                           CAS005
     C           SUVLPR    ANDNE'3'                                                           CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR4259' ZAMSID                                              CAS005
     C                     MOVE *ON       *IN90                                               CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Revalued Loss Account                                                       CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUFVLA    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUFVLA                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN91                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           SUFVRP    WHEQ *BLANKS                                                       CAS005
     C           SUVPPR    ANDEQ*BLANKS                                                       CAS005
     C           SUFVPA    ANDEQ*BLANKS                                                       CAS005
     C           SUFVRL    ANDEQ*BLANKS                                                       CAS005
     C           SUVLPR    ANDEQ*BLANKS                                                       CAS005
     C           SUFVLA    ANDEQ*BLANKS                                                       CAS005
      *                                                                                       CAS005
     C                     OTHER                                                              CAS005
      *                                                                                       CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR9417' ZAMSID                                              CAS005
     C                     MOVEA'111111'  *IN,86                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
      *                                                                                       CAS005
     C                     ENDSL                                                              CAS005
      *                                                                                       CAS005
      ** Enter ALL or NONE of: Unrealised Cash Flow Revalued Profit Contra                    CAS005
      ** Account; Profit Posting Reference; Revalued Profit Account;                          CAS005
      ** Unrealised Cash Flow Revalued Loss Contra Account; Loss Posting                      CAS005
      ** Reference; Revalued Loss Account                                                     CAS005
      *                                                                                       CAS005
     C                     SELEC                                                              CAS005
      *                                                                                       CAS005
     C           SUCFRP    WHNE *BLANKS                                                       CAS005
     C           SUFPPR    ANDNE*BLANKS                                                       CAS005
     C           SUCFPA    ANDNE*BLANKS                                                       CAS005
     C           SUCFRL    ANDNE*BLANKS                                                       CAS005
     C           SUFLPR    ANDNE*BLANKS                                                       CAS005
     C           SUCFLA    ANDNE*BLANKS                                                       CAS005
      *                                                                                       CAS005
      ** Validate Unrealised Cash Flow Revalued Profit Contra Account                         CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUCFRP    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUCFRP                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN92                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Posting Reference                                                           CAS005
      *                                                                                       CAS005
     C           SUFPPR    IFNE '1'                                                           CAS005
     C           SUFPPR    ANDNE'3'                                                           CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR4259' ZAMSID                                              CAS005
     C                     MOVE *ON       *IN93                                               CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Revalued Account                                                            CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUCFPA    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUCFPA                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN94                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Unrealised Cash Flow Revalued Loss Contra Account                           CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUCFRL    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUCFRL                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN95                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Posting Reference                                                           CAS005
      *                                                                                       CAS005
     C           SUFLPR    IFNE '1'                                                           CAS005
     C           SUFLPR    ANDNE'3'                                                           CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR4259' ZAMSID                                              CAS005
     C                     MOVE *ON       *IN96                                               CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Revalued Account                                                            CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WERRCD                                              CAS005
     C                     MOVELSUCFLA    PIACOD                                              CAS005
     C                     EXSR SRACOD                                                        CAS005
     C                     MOVELPIACOD    SUCFLA                                              CAS005
      *                                                                                       CAS005
     C           WERRCD    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN97                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           SUCFRP    WHEQ *BLANKS                                                       CAS005
     C           SUFPPR    ANDEQ*BLANKS                                                       CAS005
     C           SUCFPA    ANDEQ*BLANKS                                                       CAS005
     C           SUCFRL    ANDEQ*BLANKS                                                       CAS005
     C           SUFLPR    ANDEQ*BLANKS                                                       CAS005
     C           SUCFLA    ANDEQ*BLANKS                                                       CAS005
      *                                                                                       CAS005
     C                     OTHER                                                              CAS005
      *                                                                                       CAS005
     C                     MOVE 'Y'       WKEREN                                              CAS005
     C                     MOVE 'USR9418' ZAMSID                                              CAS005
     C                     MOVEA'111111'  *IN,92                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
      *                                                                                       CAS005
     C                     ENDSL                                                              CAS005
      *                                                                                       CAS005
     C           WKEREN    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN62                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDSR                                                              CAS005
      *                                                                                       CAS004
      ********************************************************************                    CAS004
      /EJECT                                                                                  CAS004
      *****************************************************************                       CAS004
      *                                                               *                       CAS004
      * SRGCXK - Subroutine to generate account keys for Hedge        *                       CAS004
      *          Accounting                                           *                       CAS004
      *                                                               *                       CAS004
      * Called by: FXP                                                *                       CAS004
      *                                                               *                       CAS004
      * Calls: ACUP                                                   *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRGCXK    BEGSR                                                              CAS004
      *                                                                                       CAS004
      ** Set flag to prevent reversal of DR/CR in S/R ACUP                                    CAS004
      *                                                                                       CAS004
     C                     MOVE 'Y'       PLFLAG                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFDP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE *BLANKS   DLKEY                                               CAS004
     C                     MOVE TYPE      DTYPD                                               CAS004
     C                     MOVE STYP      STYPD                                               CAS004
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE 'A'       EVENTD                                              CAS004
     C                     MOVEL'  '      CYD                                                 CAS004
     C                     MOVE 'FDP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SEFVHP    AC1                                                 CAS004
     C                     MOVE SEFVRP    PR1                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFDP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SEFVAP    AC4                                                 CAS004
     C                     MOVE SEFVRP    PR4                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFDL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'FDL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SEFVAL    AC1                                                 CAS004
     C                     MOVE SEFVRL    PR1                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFDL - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SEFVHL    AC4                                                 CAS004
     C                     MOVE SEFVRL    PR4                                                 CAS004
     C           SEFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCDP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CDP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SECFHP    AC1                                                 CAS004
     C                     MOVE SECFRP    PR1                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCDP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SECFAP    AC4                                                 CAS004
     C                     MOVE SECFRP    PR4                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCDL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CDL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SECFAL    AC1                                                 CAS004
     C                     MOVE SECFRP    PR1                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCDP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SECFHL    AC4                                                 CAS004
     C                     MOVE SECFRP    PR4                                                 CAS004
     C           SECFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFXP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'FXP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SIFVHP    AC1                                                 CAS004
     C                     MOVE SIFVRP    PR1                                                 CAS004
     C           SIFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFXP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SIFVAP    AC4                                                 CAS004
     C                     MOVE SIFVRP    PR4                                                 CAS004
     C           SIFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFXL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'FXL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SIFVAL    AC1                                                 CAS004
     C                     MOVE SIFVRL    PR1                                                 CAS004
     C           SIFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbFXL - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SIFVHL    AC4                                                 CAS004
     C                     MOVE SIFVRL    PR4                                                 CAS004
     C           SIFVHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCXP - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CXP'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SICFHP    AC1                                                 CAS004
     C                     MOVE SICFRP    PR1                                                 CAS004
     C           SICFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCXP - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SICFAP    AC4                                                 CAS004
     C                     MOVE SICFRP    PR4                                                 CAS004
     C           SICFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCXL - Debit                                                                   CAS004
      *                                                                                       CAS004
     C                     MOVE 'CXL'     DLKEY                                               CAS004
     C                     MOVE *BLANKS   FMKEYS                                              CAS004
     C                     MOVE SICFAL    AC1                                                 CAS004
     C                     MOVE SICFRP    PR1                                                 CAS004
     C           SICFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN1                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** xxAyybbCXL - Credit                                                                  CAS004
      *                                                                                       CAS004
     C                     MOVE SICFHL    AC4                                                 CAS004
     C                     MOVE SICFRP    PR4                                                 CAS004
     C           SICFHP    IFNE *BLANKS                                                       CAS004
     C                     MOVE '01'      PN4                                                 CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           BNBCPL    IFEQ 'Y'                                                           CAS004
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C           *IN99     DOWNE*ON                                                           CAS004
     C                     MOVELBDBKCD    CYD                                                 CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     READ SDBOOKL1                 99                                   CAS004
     C                     ENDDO                                                              CAS004
     C                     ELSE                                                               CAS004
     C                     EXSR ACUP                                                          CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           CAS007    ANDEQ'Y'                                                           CAS007
      *                                                                                       CAS005
      ** xxAyybbFTP - Debit                                                                   CAS005
      *                                                                                       CAS005
     C                     MOVE *BLANKS   DLKEY                                               CAS005
     C                     MOVE TYPE      DTYPD                                               CAS005
     C                     MOVE STYP      STYPD                                               CAS005
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE 'A'       EVENTD                                              CAS005
     C                     MOVEL'  '      CYD                                                 CAS005
     C                     MOVE 'FTP'     DLKEY                                               CAS005
     C                     MOVE *BLANKS   FMKEYS                                              CAS005
     C                     MOVE SUFVRP    AC1                                                 CAS005
     C                     MOVE SUVPPR    PR1                                                 CAS005
     C           SUFVRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN1                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbFTP - Credit                                                                  CAS005
      *                                                                                       CAS005
     C                     MOVE SUFVPA    AC4                                                 CAS005
     C                     MOVE SUVPPR    PR4                                                 CAS005
     C           SUFVRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN4                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           BNBCPL    IFEQ 'Y'                                                           CAS005
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C           *IN99     DOWNE*ON                                                           CAS005
     C                     MOVELBDBKCD    CYD                                                 CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C                     ENDDO                                                              CAS005
     C                     ELSE                                                               CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbFTL - Debit                                                                   CAS005
      *                                                                                       CAS005
     C                     MOVE 'FTL'     DLKEY                                               CAS005
     C                     MOVE *BLANKS   FMKEYS                                              CAS005
     C                     MOVE SUFVLA    AC1                                                 CAS005
     C                     MOVE SUVLPR    PR1                                                 CAS005
     C           SUFVRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN1                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbFTL - Credit                                                                  CAS005
      *                                                                                       CAS005
     C                     MOVE SUFVRL    AC4                                                 CAS005
     C                     MOVE SUVLPR    PR4                                                 CAS005
     C           SUFVRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN4                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           BNBCPL    IFEQ 'Y'                                                           CAS005
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C           *IN99     DOWNE*ON                                                           CAS005
     C                     MOVELBDBKCD    CYD                                                 CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C                     ENDDO                                                              CAS005
     C                     ELSE                                                               CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbCTP - Debit                                                                   CAS005
      *                                                                                       CAS005
     C                     MOVE 'CTP'     DLKEY                                               CAS005
     C                     MOVE *BLANKS   FMKEYS                                              CAS005
     C                     MOVE SUCFRP    AC1                                                 CAS005
     C                     MOVE SUFPPR    PR1                                                 CAS005
     C           SUCFRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN1                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbCTP - Credit                                                                  CAS005
      *                                                                                       CAS005
     C                     MOVE SUCFPA    AC4                                                 CAS005
     C                     MOVE SUFPPR    PR4                                                 CAS005
     C           SUCFRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN4                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           BNBCPL    IFEQ 'Y'                                                           CAS005
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C           *IN99     DOWNE*ON                                                           CAS005
     C                     MOVELBDBKCD    CYD                                                 CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C                     ENDDO                                                              CAS005
     C                     ELSE                                                               CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbCTL - Debit                                                                   CAS005
      *                                                                                       CAS005
     C                     MOVE 'CTL'     DLKEY                                               CAS005
     C                     MOVE *BLANKS   FMKEYS                                              CAS005
     C                     MOVE SUCFLA    AC1                                                 CAS005
     C                     MOVE SUFPPR    PR1                                                 CAS005
     C           SUCFRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN1                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** xxAyybbCTL - Credit                                                                  CAS005
      *                                                                                       CAS005
     C                     MOVE SUCFRL    AC4                                                 CAS005
     C                     MOVE SUFPPR    PR4                                                 CAS005
     C           SUCFRP    IFNE *BLANKS                                                       CAS005
     C                     MOVE '01'      PN4                                                 CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           BNBCPL    IFEQ 'Y'                                                           CAS005
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C           *IN99     DOWNE*ON                                                           CAS005
     C                     MOVELBDBKCD    CYD                                                 CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     READ SDBOOKL1                 99                                   CAS005
     C                     ENDDO                                                              CAS005
     C                     ELSE                                                               CAS005
     C                     EXSR ACUP                                                          CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS004
     C                     MOVE 'N'       PLFLAG                                              CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *                                                                                       CAS004
      *****************************************************************                       CAS004
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SREFEA - Checks if Fee Amortisation accounting should        *                       CAS009
      *           be executed in the system.                          *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SREFEA    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE 'N'       WEFEA   1                                           CAS009
      *                                                                                       CAS009
     C           TYPE      IFEQ 'IP'                                                          CAS009
     C           TYPE      OREQ 'TI'                                                          CAS009
     C           TYPE      OREQ 'CL'                                                          CAS009
     C           TYPE      OREQ 'DL'                                                          CAS009
     C           TYPE      OREQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C           TYPE      OREQ 'C2'                                                          CAS009
     C           TYPE      OREQ 'BP'                                                          CAS009
     C           TYPE      OREQ 'BD'                                                          CAS009
     C           TYPE      OREQ 'TB'                                                          CAS009
     C           TYPE      OREQ 'DA'                                                          CAS009
     C           TYPE      OREQ 'TA'                                                          CAS009
     C                     MOVE 'Y'       WEFEA                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE 'N'       DSCFLG  1                                           CAS009
      *                                                                                       CAS009
      ** Discount and Premium keys will be                                                    CAS009
      ** shown only for these deal types...                                                   CAS009
     C           TYPE      IFEQ 'C2'                                                          CAS009
     C           TYPE      OREQ 'BP'                                                          CAS009
     C           TYPE      OREQ 'BD'                                                          CAS009
     C           TYPE      OREQ 'TB'                                                          CAS009
     C           TYPE      OREQ 'DA'                                                          CAS009
     C           TYPE      OREQ 'TA'                                                          CAS009
     C                     MOVE '1'       *IN78                                               CAS009
     C                     MOVE 'Y'       DSCFLG                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRGFEA - Generates account keys for Fee Amortisation         *                       CAS009
      *           accounting.                                         *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRGFEA    BEGSR                                                              CAS009
      *                                                                                       CAS009
      ** Handle Fee Codes.                                                                    CAS009
      *                                                                                       CAS009
     C                     CLEARWLFC                                                          CAS009
     C                     CLEARWLIA                                                          CAS009
     C                     CLEARWLMA                                                          CAS009
     C                     CLEARWLAA                                                          CAS009
     C                     CLEARWLPR                                                          CAS009
     C                     CLEARWNFC                                                          CAS009
     C                     CLEARWNIA                                                          CAS009
     C                     CLEARWNMA                                                          CAS009
     C                     CLEARWNPR                                                          CAS009
      *                                                                                       CAS009
     C                     MOVEALFC       WLFC                                                CAS009
     C                     MOVEALIA       WLIA                                                CAS009
     C                     MOVEALMA       WLMA                                                CAS009
     C                     MOVEALAA       WLAA                                                CAS009
     C                     MOVEALPR       WLPR                                                CAS009
     C                     MOVEANFC       WNFC                                                CAS009
     C                     MOVEANIA       WNIA                                                CAS009
     C                     MOVEANMA       WNMA                                                CAS009
     C                     MOVEANPR       WNPR                                                CAS009
      *                                                                                       CAS009
      ** Generate account keys.                                                               CAS009
      *                                                                                       CAS009
     C                     DO   5         I       20                                          CAS009
      *                                                                                       CAS009
     C           WLFC,I    IFNE *BLANKS                                                       CAS009
     C                     EXSR SRGLIN                                                        CAS009
     C                     ENDIF                                                              CAS009
     C           WNFC,I    IFNE *BLANKS                                                       CAS009
     C                     EXSR SRGNLN                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS009
      *                                                                                       CAS009
     C           DSCFLG    IFEQ 'Y'                                                           CAS009
     C                     EXSR SRGDSC                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR SRGUPL                                                        CAS009
      *                                                                                       CAS009
      ** Restore indicators...                                                                CAS009
      *                                                                                       CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRGLIN - Generates account keys for a Fee Code (Linear)      *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRGLIN    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *OFF      *IN36                                               CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANKS   DLKEY                                               CAS009
     C                     MOVE TYPE      DTYPD                                               CAS009
     C                     MOVE STYP      STYPD                                               CAS009
      *-----------------+                                                                     CAS009
      ** Amortising Fee |                                                                     CAS009
      **                |                                                                     CAS009
      ** xxAyyS_nnF     |                                                                     CAS009
      *-----------------+                                                                     CAS009
     C           WLMA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVEL'S'       BB1                                                 CAS009
     C                     MOVE *BLANKS   FEECD                                               CAS009
     C                     MOVE WLFC,I    FEECD                                               CAS009
     C                     MOVE 'F'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C           TYPE      IFEQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C                     MOVE WLIA,I    AC1                                                 CAS009
     C                     MOVE WLMA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR1                                                 CAS009
     C                     MOVE WLPR,I    PR4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE WLMA,I    AC1                                                 CAS009
     C                     MOVE WLPR,I    PR1                                                 CAS009
     C                     MOVE WLIA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxRyyS_nnF   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'R'       EVENTD                                              CAS009
     C                     MOVEL'S'       BB1                                                 CAS009
     C                     MOVE *BLANKS   FEECD                                               CAS009
     C                     MOVE WLFC,I    FEECD                                               CAS009
     C                     MOVE 'F'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C           TYPE      IFEQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C                     MOVE WLMA,I    AC1                                                 CAS009
     C                     MOVE WLPR,I    PR1                                                 CAS009
     C                     MOVE '2'       PR4                                                 CAS009
     C                     MOVE *BLANKS   AC4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE *BLANKS   AC1                                                 CAS009
     C                     MOVE '2'       PR1                                                 CAS009
     C                     MOVE WLMA,I    AC4                                                 CAS009
     C                     MOVE WLPR,I    PR4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     ENDIF                                                              CAS009
      *---------------+                                                                       CAS009
      ** Accruing Fee |                                                                       CAS009
      **              |                                                                       CAS009
      ** xxAyy__nnF   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C           WLAA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE *BLANKS   BB1                                                 CAS009
     C                     MOVE *BLANKS   FEECD                                               CAS009
     C                     MOVE WLFC,I    FEECD                                               CAS009
     C                     MOVE 'F'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C           TYPE      IFEQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C                     MOVE WLIA,I    AC1                                                 CAS009
     C                     MOVE WLAA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR1                                                 CAS009
     C                     MOVE WLPR,I    PR4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE WLAA,I    AC1                                                 CAS009
     C                     MOVE WLPR,I    PR1                                                 CAS009
     C                     MOVE WLIA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *--------------+                                                                        CAS009
      ** xxRyy__nnF  |                                                                        CAS009
      *--------------+                                                                        CAS009
     C                     MOVE 'R'       EVENTD                                              CAS009
     C                     MOVE *BLANKS   BB1                                                 CAS009
     C                     MOVE *BLANKS   FEECD                                               CAS009
     C                     MOVE WLFC,I    FEECD                                               CAS009
     C                     MOVE 'F'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C           TYPE      IFEQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C                     MOVE *BLANKS   AC4                                                 CAS009
     C                     MOVE '2'       PR4                                                 CAS009
     C                     MOVE WLAA,I    AC1                                                 CAS009
     C                     MOVE WLPR,I    PR1                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE *BLANKS   AC1                                                 CAS009
     C                     MOVE '2'       PR1                                                 CAS009
     C                     MOVE WLAA,I    AC4                                                 CAS009
     C                     MOVE WLPR,I    PR4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     ENDIF
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRGNLN - Generates account keys for a Fee Code (Non-Linear)  *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRGNLN    BEGSR                                                              CAS009
      *-----------------+                                                                     CAS009
      ** Amortising Fee |                                                                     CAS009
      **                |                                                                     CAS009
      ** xxAyyN_nnF     |                                                                     CAS009
      *-----------------+                                                                     CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE *BLANKS   BB1                                                 CAS009
     C                     MOVEL'N'       BB1                                                 CAS009
     C                     MOVE *BLANKS   FEECD                                               CAS009
     C                     MOVE WNFC,I    FEECD                                               CAS009
     C                     MOVE 'F'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C           TYPE      IFEQ 'IT'                                                          CAS009
     C           TYPE      OREQ 'TD'                                                          CAS009
     C           TYPE      OREQ 'CI'                                                          CAS009
     C           TYPE      OREQ 'CD'                                                          CAS009
     C                     MOVE WNIA,I    AC1                                                 CAS009
     C                     MOVE WNMA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR1                                                 CAS009
     C                     MOVE WNPR,I    PR4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE WNMA,I    AC1                                                 CAS009
     C                     MOVE WNPR,I    PR1                                                 CAS009
     C                     MOVE WNIA,I    AC4                                                 CAS009
     C                     MOVE '1'       PR4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRGDSC - Generates account keys for Discount and Premium     *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRGDSC    BEGSR                                                              CAS009
      *                                                                                       CAS009
      *---------------+                                                                       CAS009
      ** xxAyyN___D   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'D'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE DAAMAC    AC1                                                 CAS009
     C                     MOVE DAAPR1    PR1                                                 CAS009
     C           DAAPR1    IFEQ '1'                                                           CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '27'      PN1                                                 CAS009
     C                     ENDIF                                                              CAS009
     C                     MOVE DAAINA    AC4                                                 CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     MOVE '1'       PR4                                                 CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxAyyN___C   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'C'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE PAAMAC    AC4                                                 CAS009
     C                     MOVE PAAEXA    AC1                                                 CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     MOVE '1'       PR1                                                 CAS009
     C                     MOVE PAAPR1    PR4                                                 CAS009
     C           PAAPR1    IFEQ '1'                                                           CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '27'      PN4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxRyyN___D   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'R'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'D'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE DAAMAC    AC1                                                 CAS009
     C                     MOVE DAAPR1    PR1                                                 CAS009
     C           OP1       IFEQ 'Y'                                                           CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ELSE                                                               CAS009
     C           DAAPR1    IFEQ '1'                                                           CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '10'      PN1                                                 CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxRyyN___C   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'R'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'C'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C           *IN33     IFEQ '1'                                                           CAS009
     C                     MOVE DAAMAC    AC1                                                 CAS009
     C                     MOVE DAAPR1    PR1                                                 CAS009
     C           OP1       IFEQ 'Y'                                                           CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ELSE                                                               CAS009
     C           DAAPR1    IFEQ '1'                                                           CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '10'      PN1                                                 CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE PAAMAC    AC4                                                 CAS009
     C                     MOVE PAAPR1    PR4                                                 CAS009
     C           OP1       IFEQ 'Y'                                                           CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     ELSE                                                               CAS009
     C           PAAPR1    IFEQ '1'                                                           CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE '10'      PN4                                                 CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxSyyN___P   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'S'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'P'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxSyyN___L   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'S'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'L'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *---------------+                                                                       CAS009
      ** xxSyyN___D   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'S'       EVENTD                                              CAS009
     C                     MOVE 'N'       PRFCD                                               CAS009
     C                     MOVE *BLANKS   BB2                                                 CAS009
     C                     MOVE 'D'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     EXSR ACUP                                                          CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRGUPL - Generates account keys for Unrealised P/L           *                       CAS009
      *           (Non-Linear Amortisation)                           *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRGUPL    BEGSR                                                              CAS009
      *                                                                                       CAS009
      *---------------+                                                                       CAS009
      ** xxAyy__NUP   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE *BLANKS   BB1                                                 CAS009
     C                     MOVE 'NU'      FEECD                                               CAS009
     C                     MOVE 'P'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE UPACAC    AC1                                                 CAS009
     C                     MOVE UPACPR    PR1                                                 CAS009
     C           UPACAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE UPACIE    AC4                                                 CAS009
     C                     MOVE UPACPR    PR4                                                 CAS009
     C           UPACAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           BNBCPL    IFEQ 'Y'                                                           CAS009
     C                     MOVEL'  '      CYD                                                 CAS009
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS009
     C                     READ SDBOOKL1                 99                                   CAS009
     C           *IN99     DOWNE*ON                                                           CAS009
     C                     MOVELBDBKCD    CYD                                                 CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     READ SDBOOKL1                 99                                   CAS009
     C                     ENDDO                                                              CAS009
     C                     ELSE                                                               CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     ENDIF                                                              CAS009
      *---------------+                                                                       CAS009
      ** xxAyy__NUL   |                                                                       CAS009
      *---------------+                                                                       CAS009
     C                     MOVE 'A'       EVENTD                                              CAS009
     C                     MOVE *BLANKS   BB1                                                 CAS009
     C                     MOVE 'NU'      FEECD                                               CAS009
     C                     MOVE 'L'       AMTD                                                CAS009
     C                     MOVE *BLANKS   FMKEYS                                              CAS009
      *                                                                                       CAS009
     C                     MOVE ULACEE    AC1                                                 CAS009
     C                     MOVE ULACPR    PR1                                                 CAS009
     C           UPACAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE '01'      PN1                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE ULACAC    AC4                                                 CAS009
     C                     MOVE ULACPR    PR4                                                 CAS009
     C           UPACAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE '01'      PN4                                                 CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           BNBCPL    IFEQ 'Y'                                                           CAS009
     C                     MOVEL'  '      CYD                                                 CAS009
     C           *LOVAL    SETLLSDBOOKL1                                                      CAS009
     C                     READ SDBOOKL1                 99                                   CAS009
     C           *IN99     DOWNE*ON                                                           CAS009
     C                     MOVELBDBKCD    CYD                                                 CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     READ SDBOOKL1                 99                                   CAS009
     C                     ENDDO                                                              CAS009
     C                     ELSE                                                               CAS009
     C                     EXSR ACUP                                                          CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRDFEA - Displays the Fee Amortisation screen.               *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRDFEA    BEGSR                                                              CAS009
      *                                                                                       CAS009
      ** Save indicators...                                                                   CAS009
      *                                                                                       CAS009
     C                     MOVEA*IN,20    SAVIN1 51                                           CAS009
      *                                                                                       CAS009
      ** Initialize relevant variables.                                                       CAS009
      *                                                                                       CAS009
     C                     MOVE *ALL'0'   ALLIN1 51                                           CAS009
     C                     MOVEAALLIN1    *IN,20                                              CAS009
     C                     MOVE 'Y'       WLFLG   1                                           CAS009
     C                     MOVE 'N'       WGFLG   1                                           CAS009
      *                                                                                       CAS009
      ** Clear program messages.                                                              CAS009
      *                                                                                       CAS009
     C                     CALL 'ZA0250'                                                      CAS009
      *                                                                                       CAS009
     C           WLFLG     DOWEQ'Y'                                                           CAS009
      *                                                                                       CAS009
     C                     WRITE#MSGCTL                                                       CAS009
     C                     EXFMTAKEYFEA                                                       CAS009
      *                                                                                       CAS009
     C                     CALL 'ZA0250'                                                      CAS009
      *                                                                                       CAS009
     C           *IN03     IFEQ *ON                                                           CAS009
     C           *IN12     OREQ *ON                                                           CAS009
     C                     MOVE 'N'       WLFLG                                               CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
      ** Validate input fields.                                                               CAS009
      *                                                                                       CAS009
     C                     EXSR SRVFEA                                                        CAS009
     C           DSCFLG    IFEQ 'Y'                                                           CAS009
     C                     EXSR SRVDSC                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WEFLG     IFEQ 'Y'                                                           CAS009
     C                     MOVE 'Y'       WLFLG                                               CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'Y'       WGFLG                                               CAS009
     C                     MOVE 'N'       WLFLG                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRVFEA - Validates input for Fee Amortisation Accounting.    *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRVFEA    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *ALL'0'   ALLIN1                                              CAS009
     C                     MOVEAALLIN1    *IN,20                                              CAS009
     C                     MOVE 'N'       WEFLG   1                                           CAS009
      *                                                                                       CAS009
      ** Handle Fee Codes.                                                                    CAS009
      *                                                                                       CAS009
     C                     CLEARWLFC                                                          CAS009
     C                     CLEARWLIA                                                          CAS009
     C                     CLEARWLMA                                                          CAS009
     C                     CLEARWLAA                                                          CAS009
     C                     CLEARWLPR                                                          CAS009
     C                     CLEARWNFC                                                          CAS009
     C                     CLEARWNIA                                                          CAS009
     C                     CLEARWNMA                                                          CAS009
     C                     CLEARWNPR                                                          CAS009
      *                                                                                       CAS009
     C                     MOVEALFC       WLFC                                                CAS009
     C                     MOVEALIA       WLIA                                                CAS009
     C                     MOVEALMA       WLMA                                                CAS009
     C                     MOVEALAA       WLAA                                                CAS009
     C                     MOVEALPR       WLPR                                                CAS009
     C                     MOVEANFC       WNFC                                                CAS009
     C                     MOVEANIA       WNIA                                                CAS009
     C                     MOVEANMA       WNMA                                                CAS009
     C                     MOVEANPR       WNPR                                                CAS009
      *                                                                                       CAS009
      ** Validate inputs                                                                      CAS009
      *                                                                                       CAS009
     C                     DO   5         I                                                   CAS009
      ** Linear Fee Codes                                                                     CAS009
     C           WLFC,I    IFNE *BLANKS                                                       CAS009
     C           WLFC,I    CHAINSDFEEL1              01                                       CAS009
     C           *IN01     IFEQ *ON                                                           CAS009
     C           I         ADD  19        J       20                                          CAS009
     C                     MOVE '1'       *IN,J                                               CAS009
     C                     MOVEL'USR4242' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Income Account                                                                       CAS009
     C           WLIA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE WLIA,I    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C           I         ADD  24        K       20                                          CAS009
     C                     MOVE *ON       *IN,K                                               CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Each Fee Code/Income Account must have                                               CAS009
      ** corresponding Income Account/Fee Code                                                CAS009
     C           WLFC,I    IFNE *BLANKS                                                       CAS009
     C           WLIA,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  24        K       20                                          CAS009
     C                     MOVE *ON       *IN,K                                               CAS009
     C                     MOVEL'USR4241' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Amortisation Account                                                                 CAS009
     C           WLMA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE WLMA,I    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C           I         ADD  29        L       20                                          CAS009
     C                     MOVE *ON       *IN,L                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Fee Amortisation Account must be blank                                               CAS009
      ** if corresponding Fee Code is blank.                                                  CAS009
     C           WLMA,I    IFNE *BLANKS                                                       CAS009
     C           WLFC,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  29        L       20                                          CAS009
     C                     MOVE *ON       *IN,L                                               CAS009
     C                     MOVEL'USR2679' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     ENDIF                                                              CAS009
      ** Accrual Account                                                                      CAS009
     C           WLAA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE WLAA,I    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C           I         ADD  34        M       20                                          CAS009
     C                     MOVE *ON       *IN,M                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Fee Accrual Account Code must be blank                                               CAS009
      ** if corresponding Fee Code is not entered.                                            CAS009
     C           WLAA,I    IFNE *BLANKS                                                       CAS009
     C           WLFC,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  34        M       20                                          CAS009
     C                     MOVE *ON       *IN,M                                               CAS009
     C                     MOVEL'USR2670' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference                                                                    CAS009
      ** (Linear)                                                                             CAS009
     C           WLPR,I    IFNE *BLANKS                                                       CAS009
     C           WLPR,I    IFNE '1'                                                           CAS009
     C           WLPR,I    ANDNE'3'                                                           CAS009
     C           I         ADD  39        N       20                                          CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,N                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must be entered if                                                 CAS009
      ** Amortisation or Accrual A/c is entered.                                              CAS009
     C           WLPR,I    IFEQ *BLANKS                                                       CAS009
     C           WLMA,I    IFNE *BLANKS                                                       CAS009
     C           WLAA,I    ORNE *BLANKS                                                       CAS009
     C           I         ADD  39        R       20                                          CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2672' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,R                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must be not be entered if                                          CAS009
      ** Amortisation and Accrual A/c are blank                                               CAS009
     C           WLPR,I    IFNE *BLANKS                                                       CAS009
     C           WLMA,I    IFEQ *BLANKS                                                       CAS009
     C           WLAA,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  39        R                                                   CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2673' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,R                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Non-Linear Fee Codes                                                                 CAS009
     C           WNFC,I    IFNE *BLANKS                                                       CAS009
     C           WNFC,I    CHAINSDFEEL1              01                                       CAS009
     C           *IN01     IFEQ *ON                                                           CAS009
     C           I         ADD  44        O       20                                          CAS009
     C                     MOVE '1'       *IN,O                                               CAS009
     C                     MOVEL'USR4242' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Income Account                                                                       CAS009
     C           WNIA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE WNIA,I    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C           I         ADD  49        P       20                                          CAS009
     C                     MOVE *ON       *IN,P                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Each Fee Code/Income Account must have                                               CAS009
      ** corresponding Income Account/Fee Code                                                CAS009
     C           WNFC,I    IFNE *BLANKS                                                       CAS009
     C           WNIA,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  49        P                                                   CAS009
     C                     MOVE *ON       *IN,P                                               CAS009
     C                     MOVEL'USR4241' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Amortisation Account                                                                 CAS009
     C           WNMA,I    IFNE *BLANKS                                                       CAS009
     C                     MOVE WNMA,I    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C           I         ADD  54        Q       20                                          CAS009
     C                     MOVE *ON       *IN,Q                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Fee Amortisation Account must be blank                                               CAS009
      ** if corresponding Fee Code is blank.                                                  CAS009
     C           WNMA,I    IFNE *BLANKS                                                       CAS009
     C           WNFC,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  54        Q                                                   CAS009
     C                     MOVE *ON       *IN,Q                                               CAS009
     C                     MOVEL'USR2679' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference                                                                    CAS009
      ** (Non-Linear)                                                                         CAS009
     C           WNPR,I    IFNE *BLANKS                                                       CAS009
     C           WNPR,I    IFNE '1'                                                           CAS009
     C           WNPR,I    ANDNE'3'                                                           CAS009
     C           I         ADD  59        R       20                                          CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,R                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must be entered                                                    CAS009
      ** if Amortisation A/C is entered.                                                      CAS009
     C           WNPR,I    IFEQ *BLANKS                                                       CAS009
     C           WNMA,I    IFNE *BLANKS                                                       CAS009
     C           I         ADD  59        R       20                                          CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2672' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,R                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must not be entered                                                CAS009
      ** if Amortisation A/C is blank.                                                        CAS009
     C           WNPR,I    IFNE *BLANKS                                                       CAS009
     C           WNMA,I    ANDEQ*BLANKS                                                       CAS009
     C           I         ADD  59        R                                                   CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2673' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN,R                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT                                                                                  CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRVDSC - Validates input for Discount and Premium Accounting *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRVDSC    BEGSR                                                              CAS009
      *                                                                                       CAS009
      ** Discount Amortisation Account                                                        CAS009
     C           DAAMAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE DAAMAC    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN65                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference                                                                    CAS009
     C           DAAPR1    IFNE *BLANKS                                                       CAS009
     C           DAAPR1    IFNE '1'                                                           CAS009
     C           DAAPR1    ANDNE'3'                                                           CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN66                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must be entered                                                    CAS009
      ** if Amortisation A/C is entered.                                                      CAS009
     C           DAAPR1    IFEQ *BLANKS                                                       CAS009
     C           DAAMAC    ANDNE*BLANKS                                                       CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2672' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN66                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must not be entered                                                CAS009
      ** if Amortisation A/C is blank.                                                        CAS009
     C           DAAPR1    IFNE *BLANKS                                                       CAS009
     C           DAAMAC    ANDEQ*BLANKS                                                       CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2673' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN66                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Income Account                                                                       CAS009
     C           DAAINA    IFNE *BLANKS                                                       CAS009
     C                     MOVE DAAINA    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN67                                               CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Premium Amortisation Account                                                         CAS009
     C           PAAMAC    IFNE *BLANKS                                                       CAS009
     C                     MOVE PAAMAC    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN68                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference                                                                    CAS009
     C           PAAPR1    IFNE *BLANKS                                                       CAS009
     C           PAAPR1    IFNE '1'                                                           CAS009
     C           PAAPR1    ANDNE'3'                                                           CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR4259' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN69                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must be entered                                                    CAS009
      ** if Amortisation A/C is entered.                                                      CAS009
     C           PAAPR1    IFEQ *BLANKS                                                       CAS009
     C           PAAMAC    ANDNE*BLANKS                                                       CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2672' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN69                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Posting Reference must not be entered                                                CAS009
      ** if Amortisation A/C is blank.                                                        CAS009
     C           PAAPR1    IFNE *BLANKS                                                       CAS009
     C           PAAMAC    ANDEQ*BLANKS                                                       CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     MOVEL'USR2673' ZAMSID                                              CAS009
     C                     EXSR ZASNMS                                                        CAS009
     C                     MOVE *ON       *IN69                                               CAS009
     C                     ENDIF                                                              CAS009
      ** Expense Account                                                                      CAS009
     C           PAAEXA    IFNE *BLANKS                                                       CAS009
     C                     MOVE PAAEXA    PIACOD                                              CAS009
     C                     MOVE *BLANK    WERRCD                                              CAS009
     C                     EXSR SRACOD                                                        CAS009
     C           WERRCD    IFEQ 'Y'                                                           CAS009
     C                     MOVE *ON       *IN70                                               CAS009
     C                     MOVE 'Y'       WEFLG                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /EJECT
     C********************************************************************
     C**
     C** NAP - Validate Negotiable Asset screen and structure output/
     C**       update of ACKEY
     C**
     C** Called By - MAIN - Main processing
     C**
     C** Calls - ZASNMS - Send message to program message queue
     C**       - ACUP   - Update ZACKEYAL
     C**
     C********************************************************************
     C           NAP       BEGSR
     C*****************************************************************
     C**
     C** Keys to be generated depend upon Deal Type entered
     C**     - Type 10 involves Deal Types C1
     C**     - Type 11 involves Deal Types C2,BD,BP
     C**     - Type 12 involves Deal Types TB,TA,DA
     C**
     C*****************************************************************
     C                     SETOF                     242561
     C                     SETOF                     525354
     C                     SETOF                     555657
     C                     SETOF                     585960
     C                     SETOF                     666768               CAC001
     C                     SETOF                     798485               CAC001
     C                     SETOF                     150527                                   CDL038
     C                     MOVE ' '       WKSCAA                                              CAS001
     C*
     C* Determine Type
     C*
     C                     SETOF                     313233
     C           TYPE      IFEQ 'C1'
     C                     SETON                     31    Type 10
     C                     ELSE
     C           TYPE      IFEQ 'C2'
     C           TYPE      OREQ 'BD'
     C           TYPE      OREQ 'BP'
     C                     SETON                     32    Type 11
     C                     ELSE
     C                     SETON                     33    Type 12
     C                     END
     C                     END
     C*
     C           *IN03     DOUEQ'1'                        F3 pressed  X scrn
     C           *IN12     OREQ '1'                        F12 pressed X scrn
     C           *IN64     OREQ '0'                        No errs in FX scrn
     C*
     C                     WRITE#MSGCTL
     C                     EXFMTACKEYNA
     C**
     C** Clear messages from program message queue.
     C**
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGMQ     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C**
     C** If F3 and F12 not pressed, validate screen
     C**
     C           *IN03     IFEQ '0'                        F3 pressed  X scrn
     C           *IN12     ANDEQ'0'                        F12 pressed X scrn
     C**
     C                     SETOF                     64
     C**
     C** Load arrays with valid Dealing Currencies and corresponding
     C** Spot Trade Account Equivalents program run. Initialise
     C** SDCURRL1 & count of no. of currencies in array
     C** Then process all records on SDCURRL1
     C**
     C           *LOVAL    SETLL@A6REA3
     C                     Z-ADD0         C       30
     C*
     C           *IN04     DOUEQ'1'                        Not eof(SDCURRL1)
     C           C         ORGT 200
     C*
     C                     READ @A6REA3                  04
     C**
     C** If not end of file, process Dealing Currencies
     C**
     C           *IN04     IFEQ '0'                        Not eof(SDCURRL1)
     C*
     C           A6DLCI    IFEQ 'Y'
     C**
     C** Fill Currency array
     C**
     C           C         ADD  1         C
     C                     MOVE A6CYCD    CCYA,C
     C**
     C** Validate Spot Trade A/c Equivalents & move to array
     C**
     C           A6SPAE    CHAINSDACODL0             10
     C*
     C           *IN10     IFEQ '1'                        A/c code invalid
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     41    Errors
     C                     MOVELA6CYCD    ZAMSDA           Message parameters
     C                     MOVEL'USR4226' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETOF                     10
     C                     ELSE                            A/c code valid
     C                     MOVE A6SPAE    TAC,C
     C                     END                             A/c validation
     C*
     C                     END                             Not Dealing Ccy
     C*
     C                     END                             Eof         200
     C*
     C                     END                             Eof
     C**
     C** If more than 200 Dealing Currencies send error message
     C**
     C           C         IFGT 200
     C                     SETON                     41    Errors
     C                     MOVEL'USR4220' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Store number of currencies loaded into array
     C**
     C                     Z-ADDC         MAXCCY  30
     C**
     C** If Type 10 or 11 entered then Separate Accruals of Disc/Prem
     C** & Interest Indicator on SDDEALPD must be 'Y'. If it is not 'Y'
     C** send error message and do not continue to validate screen
     C**
     C           *IN33     IFEQ '0'                        Type 10 or 11
     C           BNNAIA    IFNE 'Y'
     C                     SETON                     64    Errors in NA screen
     C                     MOVEL'USR4231' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C**
     C** Only validate screen fields if error has not occurred on
     C** SDDEALPD ICD
     C**
     C           *IN64     IFEQ '0'
     C**
     C** Check F1 (Principal Account) - mandatory for all Types
     C** and must be valid non-title account code
     C**
     C           F1        IFEQ *BLANKS
     C                     SETON                     52
     C                     ELSE
     C           F1        CHAINSDACODL0             52
     C                     END
     C*
     C           *IN52     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5264  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F2 (Interest Accrual Account Code) is valid
     C** non-title account code
     C**
     C           F2        IFEQ *BLANKS
     C                     SETOF                     2253
     C                     ELSE
     C           F2        CHAINSDACODL0             53
     C                     SETON                     22
     C                     END
     C*
     C           *IN53     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5364  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F2PREF (Posting Ref 1 or 3?) is valid - cannot be 3 if
     C** Accrual Summary Indicator = Y (on SDGELRPD ICD)
     C**
     C           F2PREF    IFEQ *BLANKS
     C*********************SETOF                     2740                                     CDL038
     C                     SETOF                     1540                                     CDL038
     C                     ELSE
     C                     SETON                     40
     C           F2PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C*********************SETON                     2764  Errors in MM                       CDL038
     C                     SETON                     1564  Errors in NA                       CDL038
     C                     MOVEL'USR4268' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F2PREF    IFEQ '1'
     C           F2PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C*********************SETON                     2764  Errors in MM                       CDL038
     C                     SETON                     1564  Errors in NA                       CDL038
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     END
     C**
     C** Check F3 (Interest Income Account Code) is entered
     C** If entered must be valid non-title account code
     C**
     C           F3        IFEQ *BLANKS
     C                     SETOF                     2354
     C                     ELSE
     C           F3        CHAINSDACODL0             54
     C                     SETON                     23
     C                     END
     C*
     C           *IN54     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5464  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** If Type 10 & 11, then F2, F2PREF & F3 must be all entered or
     C** all blank. (For Type 12, the 3 fields are not displayed)
     C**
     C           *IN31     IFEQ '1'                        Type 10
     C           *IN32     OREQ '1'                        Type 11
     C           *IN22     IFEQ '1'                        F2 entered
     C           *IN23     ANDEQ'1'                        F3 entered
     C           *IN40     ANDEQ'1'                        F2PREF enter
     C                     ELSE
     C           *IN22     IFEQ '0'                        F2 blank
     C           *IN23     ANDEQ'0'                        F3 blank
     C           *IN40     ANDEQ'0'                        F2PREF blank
     C                     ELSE
     C*********************SETON                     275354             screen                CDL038
     C                     SETON                     155354             screen                CDL038
     C                     SETON                         64                                   CDL038
     C                     MOVEL'USR4263' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All entered
     C                     END                             All blanks
     C                     END                             Types 10/11
     C**
     C** Check F4 (Discount Amort. Account) if entered is valid non-
     C** title account code
     C**
     C           F4        IFEQ *BLANKS
     C                     SETOF                     2455
     C                     ELSE
     C           F4        CHAINSDACODL0             55
     C                     SETON                     24
     C                     END
     C*
     C           *IN55     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5564  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F4PREF (Posting Ref 1 or 3?) if entered is valid -
     C** cannot be 3 if Accrual Summary Indicator = Y (from SDGELRPD)
     C**
     C           F4PREF    IFEQ *BLANKS
     C                     SETOF                     0542
     C                     ELSE
     C                     SETON                     42
     C           F4PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C*********************SETON                     0563  Errors in MM                       CDL038
     C                     SETON                     0564  Errors in NA                       CDL038
     C                     MOVEL'USR4268' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F4PREF    IFEQ '1'
     C           F4PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C*********************SETON                     0563  Errors in MM                       CDL038
     C                     SETON                     0564  Errors in NA                       CDL038
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     END
     C**
     C** Check F5 (Discount Income Account) if entered is a valid
     C** non-title account code
     C**
     C           F5        IFEQ *BLANKS
     C                     SETOF                     2556
     C                     ELSE
     C           F5        CHAINSDACODL0             56
     C                     SETON                     25
     C                     END
     C*
     C           *IN56     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5664  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** For Types 11 & 12, F4, F4PREF & F5 must all be blank or all be
     C** entered. (For Type 10, the 3 foelds are non-displayed)
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C           *IN33     OREQ '1'                        Type 12
     C           *IN24     IFEQ '1'                        F4 entered
     C           *IN42     ANDEQ'1'                        F4PREF entered
     C           *IN25     ANDEQ'1'                        F5 entered
     C                     ELSE
     C           *IN24     IFEQ '0'                        F4 blank
     C           *IN42     ANDEQ'0'                        F4PREF blank
     C           *IN25     ANDEQ'0'                        F5 blank
     C                     ELSE
     C                     SETON                     550556             screen
     C                     SETON                     64                 screen                CDL038
     C*********************SETON                     63                 screen                CDL038
     C                     MOVEL'USR4258' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All blanks
     C                     END                             All entered
     C                     END                             Type 11/12
     C**
     C** Check F6 (Premium Accrual Account) if entered is a valid
     C** non-title account code
     C**
     C           F6        IFEQ *BLANKS
     C                     SETOF                     3557
     C                     ELSE
     C           F6        CHAINSDACODL0             57
     C                     SETON                     35
     C                     END
     C*
     C           *IN57     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5764  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F6PREF (Posting Ref 1 or 3?) if entered is valid
     C** - cannot be 3 if Accrual Summary Indiactor = Y (from SDGELRPD)
     C**
     C           F6PREF    IFEQ *BLANKS
     C                     SETOF                     2743
     C                     ELSE
     C                     SETON                     43
     C           F6PREF    IFEQ '3'
     C           BKAKSI    ANDEQ'Y'
     C*********************SETON                     2763  Errors in MM                       CDL038
     C                     SETON                     2764  Errors in NA                       CDL038
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           F6PREF    IFEQ '1'
     C           F6PREF    OREQ '3'                        Pref valid
     C                     ELSE
     C*********************SETON                     2763  Errors in MM                       CDL038
     C                     SETON                     2764  Errors in NA                       CDL038
     C                     MOVEL'USR4259' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     END
     C**
     C** Check F7 (Premium Expense Account) if entered is a valid
     C** non-title account code
     C**
     C           F7        IFEQ *BLANKS
     C                     SETOF                     4758
     C                     ELSE
     C           F7        CHAINSDACODL0             58
     C                     SETON                     47
     C                     END
     C*
     C           *IN58     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5864  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** If Type 11, then F6, F&PREF & F7 must all be entered
     C** or all be blank. (These 3 fields are not displayed
     C** for Types 10 & 12)
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C*
     C           *IN43     IFEQ '1'                        F6PREF entered
     C           *IN35     ANDEQ'1'                        F6 entered
     C           *IN47     ANDEQ'1'                        F7 entered
     C                     ELSE
     C           *IN35     IFEQ '0'                        F6 blank
     C           *IN43     ANDEQ'0'                        F6PREF blank
     C           *IN47     ANDEQ'0'                        F7 blank
     C                     ELSE
     C                     SETON                     575827             screen
     C                     SETON                     64                 screen
     C                     MOVEL'USR4229' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             All blanks
     C                     END                             All entered
     C                     END                             Type 11
     C**
     C** Check F8 (Profit on Sale of NA) - mandatory for all Types
     C** and must be valid non-title account code
     C**
     C           F8        IFEQ *BLANKS
     C                     SETON                     59
     C                     ELSE
     C           F8        CHAINSDACODL0             59
     C                     END
     C*
     C           *IN59     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     5964  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check F9 (Loss on Sale of NA) - mandatory for all Types
     C** and must be valid non-title account code
     C**
     C           F9        IFEQ *BLANKS
     C                     SETON                     60
     C                     ELSE
     C           F9        CHAINSDACODL0             60
     C                     END
     C*
     C           *IN60     IFEQ '1'
     C           A5TOIN    OREQ 'Y'
     C                     SETON                     6064  Errors in NA screen
     C                     MOVEL'USR4230' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**
     C** Check OP1 (Reverse Accounting Required?) is valid
     C** ('Y', 'N' or ' '). If Yes, set on indicator 36. If blank
     C** default it to 'N'
     C**
     C           OP1       IFEQ 'Y'
     C                     SETON                     36
     C                     ELSE
     C           OP1       IFEQ 'N'
     C                     ELSE
     C           OP1       IFEQ ' '
     C                     MOVE 'N'       OP1
     C                     ELSE
     C                     SETON                     6461  Errs in fld&screen
     C                     MOVEL'USR4234' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C                     END
     C                     END
      *                                                                                       CAS001
      ** If Analytical Accounting is installed, activate ACKEYAA screen                       CAS001
      *                                                                                       CAS001
     C           BGN0ST    IFEQ 'Y'                                                           CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C           TYPE      ANDNE'TB'                                                          CAS001
     C           TYPE      ANDNE'DA'                                                          CAS001
     C           TYPE      ANDNE'TA'                                                          CAS001
     C                     MOVE 'Y'       WKSCAA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CAC001
      **  If Analytical Accounting is installed and fields in ACKEYNA     CAC001
      **  are valid, validate fields in ACKEYAA                           CAC001
      **  ...only if deal is not discounted                               CAC001
      *                                                                   CAC001
     C           WKSCAA    DOWEQ'Y'                                                           CAS001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *IN64     ANDEQ*OFF                                      CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Clear messages from program message queue                       CAC001
      *                                                                   CAC001
     C                     CALL 'Y2CLMSC'                                 CAC001
     C                     PARM SPGMQ     ZAPGM                           CAC001
     C                     PARM '*SAME'   ZAPGRL                          CAC001
      *                                                                   CAC001
      **  Validate until F3 or F12 or new account codes are valid         CAC001
      *                                                                   CAC001
     C           *IN03     DOUEQ*ON                                       CAC001
     C           *IN12     OREQ *ON                                       CAC001
     C           *IN64     OREQ *OFF                                      CAC001
     C                     MOVE *OFF      *IN64                                               CAS001
     C                     WRITE#MSGCTL                                   CAC001
     C                     EXFMTACKEYAA                                   CAC001
     C                     SETOF                     666768               CAC001
     C                     SETOF                     798485               CAC001
      *                                                                   CAC001
      **  Clear messages from program message queue                       CAC001
      *                                                                   CAC001
     C                     CALL 'Y2CLMSC'                                 CAC001
     C                     PARM SPGMQ     ZAPGM                           CAC001
     C                     PARM '*SAME'   ZAPGRL                          CAC001
      *                                                                   CAC001
      **  Validate account codes                                          CAC001
      *                                                                   CAC001
     C           *IN03     IFEQ *OFF                                      CAC001
     C           *IN12     ANDEQ*OFF                                      CAC001
      *                                                                   CAC001
      **  Check SINTL (Internal Loan Account) is valid non-title          CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SINTL     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN66                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SINTL     CHAINSDACODL0             66                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN66     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6664                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SINTD (Internal Deposit Account) is valid non-title       CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SINTD     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN67                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SINTD     CHAINSDACODL0             67                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN67     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6764                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SCOFE (COF Expense Account) is valid non-title            CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SCOFE     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN68                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SCOFE     CHAINSDACODL0             68                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN68     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     6864                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SACOFP (Accrued COF Payable Account) is valid non-title   CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SACOFP    IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN79                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SACOFP    CHAINSDACODL0             79                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN79     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     7964                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SCOFI (COF Income Account) is valid non-title             CAC001
      **  account code                                                    CAC001
      *                                                                   CAC001
     C           SCOFI     IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN84                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SCOFI     CHAINSDACODL0             84                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN84     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     8464                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Check SACOFR (Accrued COF Receivable Account) is valid          CAC001
      **  non-title account code                                          CAC001
      *                                                                   CAC001
     C           SACOFR    IFEQ *BLANKS                                   CAC001
     C                     MOVE '0'       *IN85                           CAC001
     C                     MOVE 'N'       A5TOIN                          CAC001
     C                     ELSE                                           CAC001
     C           SACOFR    CHAINSDACODL0             85                   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C           *IN85     IFEQ '1'                                       CAC001
     C           A5TOIN    OREQ 'Y'                                       CAC001
     C                     SETON                     8564                 CAC001
     C                     MOVEL'USR4230' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  New Funding Account codes must all be entered...                CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           SINTL     WHNE *BLANKS                                   CAC001
     C           SINTD     ANDNE*BLANKS                                   CAC001
     C           SCOFE     ANDNE*BLANKS                                   CAC001
     C           SACOFP    ANDNE*BLANKS                                   CAC001
     C           SCOFI     ANDNE*BLANKS                                   CAC001
     C           SACOFR    ANDNE*BLANKS                                   CAC001
     C                     MOVE 'N'       WBLANK                          CAC001
      *                                                                   CAC001
      **  ...or all be blanks                                             CAC001
      *                                                                   CAC001
     C           SINTL     WHEQ *BLANKS                                   CAC001
     C           SINTD     ANDEQ*BLANKS                                   CAC001
     C           SCOFE     ANDEQ*BLANKS                                   CAC001
     C           SACOFP    ANDEQ*BLANKS                                   CAC001
     C           SCOFI     ANDEQ*BLANKS                                   CAC001
     C           SACOFR    ANDEQ*BLANKS                                   CAC001
     C                     MOVE 'Y'       WBLANK                          CAC001
      *                                                                   CAC001
      **  Otherwise, send an error message                                CAC001
      *                                                                   CAC001
     C                     OTHER                                          CAC001
     C                     SETON                     666768               CAC001
     C                     SETON                     798485               CAC001
     C                     SETON                     64                   CAC001
     C                     MOVEL'USR4273' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     ENDSL                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C                     ENDDO                                          CAC001
      *                                                                                       CAS001
      ** From ACKEYAA screen, if no function key is pressed and no error, proceed to          CAS001
      ** AKEYNPV screen                                                                       CAS001
      *                                                                                       CAS001
     C           *IN12     IFEQ *OFF                                                          CAS001
     C           *IN03     ANDEQ*OFF                                                          CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CAC001
      **  If F12 pressed, set off *IN12 and set on *IN64 for ACKEYNA      CAC001
      **  to be re-displayed                                              CAC001
      *                                                                   CAC001
     C           *IN12     IFEQ *ON                                       CAC001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     MOVE '0'       *IN12                           CAC001
     C                     MOVE '1'       *IN64                           CAC001
      *                                                                   CAC001
      **  If F3 pressed, set on *IN64 to skip a/c key generation          CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
     C           *IN03     IFEQ *ON                                       CAC001
     C                     MOVE ' '       WKSCAA                                              CAS001
     C                     MOVE '1'       *IN64                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                                       CAS001
      ** Call subroutine that displays NPV screen (if CAS001 is installed                     CAS001
      *                                                                                       CAS001
     C                     MOVE 'NAP'     WKSUBR                                              CAS001
     C                     EXSR SRDNPV                                                        CAS001
      *                                                                                       CAS009
      ** Display the Fee amortisation screen if necessary.                                    CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           *IN03     ANDEQ*OFF                                                          CAS009
     C           *IN12     ANDEQ*OFF                                                          CAS009
     C           *IN64     ANDEQ*OFF                                                          CAS009
     C                     EXSR SREFEA                                                        CAS009
      *                                                                                       CAS009
     C           WEFEA     IFEQ 'Y'                                                           CAS009
     C                     EXSR SRDFEA                                                        CAS009
      *                                                                                       CAS009
     C           *IN12     IFEQ *ON                                                           CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
     C                     MOVE *OFF      *IN12                                               CAS009
     C                     MOVE *ON       *IN64                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Skip account key generation on F3.                                                   CAS009
      *                                                                                       CAS009
     C           *IN03     IFEQ *ON                                                           CAS009
     C                     MOVE *ON       *IN64                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS001
      *                                                                                       CAS001
      ** If Analytical accounting is not installed, from ACKEYMM screen, proceed to           CAS001
      ** AKEYNPV screen                                                                       CAS001
      *                                                                                       CAS001
     C           BGN0ST    IFNE 'Y'                                                           CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C           TYPE      OREQ 'TB'                                                          CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C           TYPE      OREQ 'DA'                                                          CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C           TYPE      OREQ 'TA'                                                          CAS001
     C           *IN64     ANDEQ*OFF                                                          CAS001
     C                     MOVE 'NAP'     WKSUBR                                              CAS001
     C                     EXSR SRDNPV                                                        CAS001
     C           *IN12     IFEQ '1'                                                           CAS001
     C                     MOVE *OFF      *IN12                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS009
      ** Display the Fee amortisation screen if necessary.                                    CAS009
      *                                                                                       CAS009
     C           BGN0ST    IFNE 'Y'                                                           CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           *IN03     ANDEQ*OFF                                                          CAS009
     C           *IN12     ANDEQ*OFF                                                          CAS009
     C           *IN64     ANDEQ*OFF                                                          CAS009
     C                     EXSR SREFEA                                                        CAS009
      *                                                                                       CAS009
     C           WEFEA     IFEQ 'Y'                                                           CAS009
     C                     EXSR SRDFEA                                                        CAS009
      *                                                                                       CAS009
     C           *IN12     IFEQ *ON                                                           CAS009
     C                     MOVEASAVIN1    *IN,20                                              CAS009
     C                     MOVE *OFF      *IN12                                               CAS009
     C                     MOVE *ON       *IN62                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Skip account key generation on F3.                                                   CAS009
      *                                                                                       CAS009
     C           *IN03     IFEQ *ON                                                           CAS009
     C                     MOVE *ON       *IN64                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
     C**
     C** Only continue processing if no errors exist
     C**
     C           *IN64     IFEQ '0'
     C**
     C** Set up all fields for output/update of ACKEY
     C**
     C                     MOVE *BLANK    DLKEY
     C                     MOVE TYPE      DTYPD
     C                     MOVE STYP      STYPD
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE *BLANK    FMKEYS
     c**                                                                                      245915
     C           CDL039    IFEQ 'Y'                                                           245915
     C**                                                                                    BUG10281
     C** TRANFER FACE VALUE KEY                                                             BUG10281
     C** Format Key XXTYY....F                                                              BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE 'F'       AMTD                                              BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C* Set up fields                                                                       BUG10281
     C                     MOVE F1        AC1                                               BUG10281
     C*                                                                                     BUG10281
     C** Narrative is 01 for Deal Type C1, and 09 for all other Deal                        BUG10281
     C** Types when Reverse Accounting is not required                                      BUG10281
     C*                                                                                     BUG10281
     C           TYPE      IFEQ 'C1'                                                        BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C           OP1       IFEQ 'N'                                                         BUG10281
     C                     MOVE '09'      PN1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C                     MOVE '3'       PR1                                               BUG10281
     C* Update file                                                                         BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C**                                                                                    BUG10281
     C** TRANFER INTEREST KEY                                                               BUG10281
     C** Format Key XXTYY....I                                                              BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C* Set up fields                                                                       BUG10281
     C           *IN31     IFEQ '1'                        Type 10 or                       BUG10281
     C           *IN32     OREQ '1'                        Type 11                          BUG10281
     C                     MOVE 'I'       AMTD                                              BUG10281
     C           F2        IFEQ *BLANKS                                                     BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE F2        AC1                                               BUG10281
     C                     MOVE F2PREF    PR1                                               BUG10281
     C           F2PREF    IFEQ '1'                                                         BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '26'      PN1                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C** Update file                                                                        BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C*                                                                                     BUG10281
     C                     END                             Type 10/11                       BUG10281
     C**                                                                                    BUG10281
     C** TRANFER DISCOUNT KEY                                                               BUG10281
     C** Format Key XXTYY....D                                                              BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C* Set up fields                                                                       BUG10281
     C           *IN32     IFEQ '1'                        Type 11 or                       BUG10281
     C           *IN33     OREQ '1'                        Type 12                          BUG10281
     C                     MOVE 'D'       AMTD                                              BUG10281
     C           F4        IFEQ *BLANKS                                                     BUG10281
     C           F6        ANDEQ*BLANKS                                                     BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE F4        AC1                                               BUG10281
     C                     MOVE F4PREF    PR1                                               BUG10281
     C           F4PREF    IFEQ '1'                                                         BUG10281
     C                     MOVE '01'      PN1                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '27'      PN1                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C* Update file                                                                         BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C**                                                                                    BUG10281
     C** Format Key XXTYY....C                                                              BUG10281
     C** TRANFER PREMIUM KEY                                                                BUG10281
     C                     MOVE 'T'       EVENTD                                            BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C* Set up fields                                                                       BUG10281
     C           *IN32     IFEQ '1'                        Type 11                          BUG10281
     C                     MOVE 'C'       AMTD                                              BUG10281
     C           F4        IFEQ *BLANKS                                                     BUG10281
     C           F6        ANDEQ*BLANKS                                                     BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE F6        AC4                                               BUG10281
     C                     MOVE F6PREF    PR4                                               BUG10281
     C           F6PREF    IFEQ '1'                                                         BUG10281
     C                     MOVE '01'      PN4                                               BUG10281
     C                     ELSE                                                             BUG10281
     C                     MOVE '27'      PN4                                               BUG10281
     C                     END                                                              BUG10281
     C                     END                                                              BUG10281
     C* Update file                                                                         BUG10281
     C                     EXSR ACUP                                                        BUG10281
     C*                                                                                     BUG10281
     C                     END                             Type 11                          BUG10281
     C                     END                             Type 11/12                       BUG10281
     C                     MOVE *BLANK    FMKEYS                                            BUG10281
     C**                                                                                      245915
     C                     ENDIF                                                              245915
     C**
     C** Deal Date Keys ***
     C**
     C                     MOVE 'D'       EVENTD
     C**
     C** Format Key XXDYY....A             *** Type 11 & 12 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C           *IN33     OREQ '1'                        Type 12
     C                     MOVE 'A'       AMTD
     C                     EXSR ACUP
     C                     END
     C**
     C** Format Key XXDYY....F             *** Type 10,11,12 ***
     C**
     C                     MOVE 'F'       AMTD
     C                     EXSR ACUP
     C**
     C** Value Date Keys
     C**
     C                     MOVE 'V'       EVENTD
     C**
     C** Format Key XXVYY....F             ** Type 10/11/12  **
     C**
     C* Set up fields
     C                     MOVE F1        AC1
     C*
     C** Narrative is 01 for Deal Type C1, and 09 for all other Deal
     C** Types when Reverse Accounting is not required
     C*
     C           TYPE      IFEQ 'C1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C           OP1       IFEQ 'N'
     C                     MOVE '09'      PN1
     C                     ELSE
     C                     MOVE '01'      PN1
     C                     END
     C                     END
     C                     MOVE '3'       PR1
     C*
     C           *IN31     IFEQ '1'                        Type 10
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C                     END                             Type 10
     C* Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXVYY....D                *** Type 11, 12 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11 or
     C           *IN33     OREQ '1'                        Type 12
     C*
     C* Set up fields
     C                     MOVE 'D'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F4        AC4
     C                     MOVE F4PREF    PR4
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN4
     C                     ELSE
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '09'      PN4
     C                     END
     C                     END
     C                     END
     C* Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXVYY....A             *** Type 11, 12 ***
     C**
     C                     MOVE 'A'       AMTD
     C* Set up fields
     C                     MOVE '    '    AC4
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTD     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxVyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTL     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Format Key XXVYY....P             *** Type 11 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C*
     C                     MOVE 'P'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F2        AC1
     C                     MOVE F2PREF    PR1
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '26'      PN1
     C                     END
     C                     END
     C* Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXVYY....C           *** Type 11 ***
     C**
     C                     MOVE 'C'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F6        AC1
     C                     MOVE F6PREF    PR1
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN1
     C                     ELSE
     C           F6PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '09'      PN1
     C                     END
     C                     END
     C                     END
     C*
     C                     EXSR ACUP
     C*
     C                     END                             Type 11
     C                     END                             Type 11/12
     C**
     C** Interest Accrual Keys
     C**
     C                     MOVE 'A'       EVENTD
     C**
     C** Format Key XXAYY....I          *** Type 10, 11 ***
     C**
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C*
     C           *IN31     IFEQ '1'                        Type 10 or
     C           *IN32     OREQ '1'                        Type 11
     C                     MOVE 'I'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F2        AC1
     C                     MOVE F2PREF    PR1
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '26'      PN1
     C                     END
     C                     MOVE F3        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     END
     C** Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxAyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SCOFE     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SACOFP    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxAyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFR    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SCOFI     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C*
     C                     END                             Type 10/11
     C**
     C** Format Key XXAYY....D             *** Type 11, 12 ***
     C**
     C* Set up fields
     C*
     C           *IN32     IFEQ '1'                        Type 11 or
     C           *IN33     OREQ '1'                        Type 12
     C                     MOVE 'D'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F4        AC1
     C                     MOVE F4PREF    PR1
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '27'      PN1
     C                     END
     C                     MOVE F5        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     END
     C* Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXAYY....C             *** Type 11 ***
     C**
     C* Set up fields
     C*
     C           *IN32     IFEQ '1'                        Type 11
     C*
     C                     MOVE 'C'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F7        AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C                     MOVE F6        AC4
     C                     MOVE F6PREF    PR4
     C           F6PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '27'      PN4
     C                     END
     C                     END
     C* Update file
     C                     EXSR ACUP
     C*
     C                     END                             Type 11
     C                     END                             Type 11/12
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxAyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
     C                     MOVE 'A'       AMTD                            CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SCOFE     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SACOFP    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxAyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFR    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     MOVE SCOFI     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Interest Payment Date Keys
     C**
     C           *IN31     IFEQ '1'                        Type 10
     C           *IN32     OREQ '1'                        Type 11
     C**
     C                     MOVE 'I'       EVENTD
     C**
     C** Format Key XXIYY....I              *** Type 10, 11 ***
     C**
     C                     MOVE 'I'       AMTD
     C* Set up fields
     C                     MOVE *BLANK    FMKEYS
     C           F2        IFNE *BLANKS
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     END
     C* Update file
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxIyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**
     C** Format Key XXIYY....R           *** Type 10, 11 ***
     C**
     C                     MOVE 'R'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END
     C                     EXSR ACUP
     C**
     C** Format Key XXIYY....P           *** Type 11 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C                     MOVE 'P'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANKS   FMKEYS
     C                     END
     C                     EXSR ACUP
     C                     END                             Type 11
     C                     END                             Not Type 12
     C**
     C** Maturity Date Keys
     C**
     C                     MOVE 'M'       EVENTD
     C**
     C** Format Key XXMYY....A           *** Type 11, 12 ***
     C**
     C                     MOVE *BLANK    FMKEYS
     C           *IN32     IFEQ '1'                        Type 11
     C           *IN33     OREQ '1'                        Type 12
     C                     MOVE 'A'       AMTD
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     ENDIF                                          CAC001
     C                     END                             Type 11/12
     C**
     C** Format Key XXMYY....B           *** Type 10, 11 ***
     C**
     C           *IN31     IFEQ '1'
     C           *IN32     OREQ '1'
     C*
     C* Set up fields
     C                     MOVE 'B'       AMTD
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C* Update file
     C                     EXSR ACUP
     C*
     C                     END
     C**
     C** Format Key XXMYY....D           *** Type 12 ***
     C**
     C                     MOVE *BLANK    FMKEYS
     C           *IN33     IFEQ '1'                        Type 12
     C                     MOVE 'D'       AMTD
     C                     EXSR ACUP
     C                     END                             Type 12
     C**
     C** Format Key XXMYY....F           *** Type 10, 11, 12  ***
     C**
     C                     MOVE 'F'       AMTD
     C*
     C           *IN33     IFEQ '1'                        Type 12
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     END
     C*
     C                     MOVE F1        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '3'       PR4
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY....P           *** Type 11 ***
     C**
     C           *IN32     IFEQ '1'
     C                     MOVE 'P'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANKS   FMKEYS
     C                     ELSE
     C                     MOVE *BLANKS   FMKEYS
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END
     C                     EXSR ACUP
     C                     END                             Type 11
     C**
     C** Format Key XXMYY....I           *** Type 10, 11 ***
     C**
     C           *IN31     IFEQ '1'
     C           *IN32     OREQ '1'
     C                     MOVE 'I'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANKS   FMKEYS
     C                     ELSE
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxMyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C                     END
     C**
     C** Format Key XXMYY....E           *** Type 11 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C                     MOVE 'E'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C                     EXSR ACUP
     C**
     C** Format Key XXMYY....C           *** Type 11 ***
     C**
     C                     MOVE 'C'       AMTD
     C                     EXSR ACUP
     C                     END                             Type 11
     C**
     C** Premium/Discount Keys
     C**
     C                     MOVE 'R'       EVENTD
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C           *IN33     OREQ '1'                        Type 12
     C**
     C** Format Key XXRYY....C           *** Type 11,12 ***
     C**
     C                     MOVE 'C'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C*
     C** Accounting entries dependant on Deal Type
     C*
     C* If Type 12...
     C*
     C           *IN33     IFEQ '1'
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F4        AC1
     C                     MOVE F4PREF    PR1
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN1
     C                     ELSE
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '10'      PN1
     C                     END
     C                     END
     C                     END
     C                     EXSR ACUP
     C* If Type 11...
     C                     ELSE
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F6        AC4
     C                     MOVE F6PREF    PR4
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN4
     C                     ELSE
     C           F6PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '10'      PN4
     C                     END
     C                     END
     C                     END
     C                     EXSR ACUP
     C**
     C** Format Key XXRYY....D           *** Type 11 ***
     C**
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE 'D'       AMTD
     C           F4        IFEQ *BLANKS
     C           F6        ANDEQ*BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F4        AC1
     C                     MOVE F4PREF    PR1
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN1
     C                     ELSE
     C           F4PREF    IFEQ '1'
     C                     MOVE '01'      PN1
     C                     ELSE
     C                     MOVE '10'      PN1
     C                     END
     C                     END
     C                     END
     C*
     C                     EXSR ACUP
     C*
     C                     END                             Type 12
     C                     END                             Not Type 10
     C**
     C** Sale Date Keys
     C**
     C                     MOVE 'S'       EVENTD
     C**
     C** Format Key XXSYY....A           *** Type 11, 12 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C           *IN33     OREQ '1'                        Type 12
     C                     MOVE 'A'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C                     EXSR ACUP
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxSyyT...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTD     AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxSyyF...A                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SINTL     AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     ENDIF                                          CAC001
     C                     END                             Not Type 10
     C**
     C** Format Key XXSYY....E           *** Type 11 ***
     C**
     C           *IN32     IFEQ '1'                        Type 11
     C                     MOVE 'E'       AMTD
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY....C           *** Type 11 ***
     C**
     C                     MOVE 'C'       AMTD
     C                     EXSR ACUP
     C                     END                             Type 11
     C**
     C** Format Key XXSYY....D           *** Type 12 ***
     C**
     C           *IN33     IFEQ '1'                        Type 12
     C                     MOVE 'D'       AMTD
     C                     EXSR ACUP
     C                     END                             Type 12
     C**
     C** Format Key XXSYY....L           *** Type 10, 11, 12 ***
     C**
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE 'L'       AMTD
     C                     MOVE F9        AC1
     C                     MOVE '01'      PN1
     C                     MOVE '1'       PR1
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY....F           *** Type 10, 11, 12 ***
     C**
     C                     MOVE 'F'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C                     MOVE F1        AC4
     C                     MOVE '3'       PR4
     C*
     C** Narrative is dependant on whether Reverse Accounting is
     C** required
     C*
     C           OP1       IFEQ 'Y'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '10'      PN4
     C                     END
     C*
     C                     EXSR ACUP
     C**
     C** Format Key XXSYY....P           *** Type 11, 12 ***
     C**
     C                     MOVE 'P'       AMTD
     C* Set up fields
     C           *IN33     IFEQ '1'                        Type 12
     C                     MOVE F8        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     END                             Type 12
     C*
     C           *IN32     IFEQ '1'                        Type 11
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END
     C                     END                             Type 11
     C* Update file
     C*
     C           *IN32     IFEQ '1'                        Type 11 or
     C           *IN33     OREQ '1'                        Type 12
     C                     EXSR ACUP
     C                     END
     C**
     C** Format Key XXSYY....I           *** Type 10, 11 ***
     C**
     C           *IN31     IFEQ '1'                        Type 10 or
     C           *IN32     OREQ '1'                        Type 11
     C*
     C                     MOVE 'I'       AMTD
     C           F2        IFEQ *BLANKS
     C                     MOVE *BLANK    FMKEYS
     C                     ELSE
     C                     MOVE F2        AC4
     C                     MOVE F2PREF    PR4
     C*
     C** If Type C1, narrative 4 = 01, otherwise it is dependant on
     C*  F2PREF
     C           *IN31     IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C           F2PREF    IFEQ '1'
     C                     MOVE '01'      PN4
     C                     ELSE
     C                     MOVE '24'      PN4
     C                     END
     C                     END
     C                     END
     C*
     C                     EXSR ACUP
     C**
     C** Format key XXSYY....R           *** Type 10, 11 ***
     C**
     C                     MOVE 'R'       AMTD
     C                     MOVE F8        AC4
     C                     MOVE '01'      PN4
     C                     MOVE '1'       PR4
     C                     EXSR ACUP
     C                     END                             Type 10/11
      *                                                                   CAC001
      **  If Anal Acctg is installed and NA purchased...                  CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           TYPE      ANDNE'TB'                                      CAC001
     C           TYPE      ANDNE'DA'                                      CAC001
     C           TYPE      ANDNE'TA'                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxSyyT...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'T'       PRFCD                           CAC001
     C                     MOVE 'I'       AMTD                            CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFP    AC1                             CAC001
     C                     MOVE '1'       PR1                             CAC001
     C                     MOVE '01'      PN1                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
      *                                                                   CAC001
      **  Set up account key xxSyyF...I                                   CAC001
      *                                                                   CAC001
     C                     MOVE *BLANKS   FMKEYS                          CAC001
     C                     MOVE 'F'       PRFCD                           CAC001
      *                                                                   CAC001
      **  If Funding Account Codes are not blank, set up DR/CR details    CAC001
      *                                                                   CAC001
     C           WBLANK    IFNE 'Y'                                       CAC001
     C                     MOVE SACOFR    AC4                             CAC001
     C                     MOVE '1'       PR4                             CAC001
     C                     MOVE '01'      PN4                             CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR ACUP                                      CAC001
     C                     MOVE *BLANKS   PRFCD                           CAC001
     C                     ENDIF                                          CAC001
     C**
     C** NA Sold Deal/Value Date Keys
     C**
     C** Format Key WWDYY....A(WW=NA Sold Deal Type) **Type 10,11,12**
     C**
     C                     MOVE TABSA     DTYPD
     C                     MOVE 'D'       EVENTD
     C                     MOVE 'A'       AMTD
     C                     MOVE *BLANK    FMKEYS
     C                     EXSR ACUP
     C**
     C** Format Key WWVYY....A           *** Type 10, 11, 12 ***
     C**
     C                     MOVE 'V'       EVENTD
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C                     EXSR ACUP
      *                                                                                       CAS001
      ** If CAS001 is on, generate NPV account keys                                           CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C********** SUPAC     ANDNE*BLANKS                                                CAS001 CAS004
     C                     EXSR SRGNPV                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If CAS004 is on and TYPE is not 'ID' or 'IL', generate                               CAS004
      ** Hedge Accounting Account Keys                                                        CAS004
      *                                                                                       CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           TYPE      ANDNE'ID'                                                          CAS004
     C           TYPE      ANDNE'IL'                                                          CAS004
     C                     EXSR SRGHAC                                                        CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      *                                                                                       CAS009
      ** Generate Fee Amortisation account keys if necessary.                                 CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           WGFLG     ANDEQ'Y'                                                           CAS009
     C                     EXSR SRGFEA                                                        CAS009
     C                     MOVE 'N'       WGFLG                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C**
     C** Reset Deal Type/Sub type to blanks before redisplaying
     C** initial screen.
     C**
     C                     MOVE *BLANKS   TYPE
     C                     MOVE *BLANKS   STYP
     C                     MOVE *BLANKS   CLAS                                                CDL038
     C                     MOVE '1'       *IN07
     C*
     C                     END                             NA scrn in error
     C*
     C                     END                             ICD Ind in error
     C*
     C                     END                             F3/F12 not pressed
     C*
     C                     END                             F3/F12/Errs in scrn
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** NOP - Generate Keys for Nostro Transfer Deal Types
     C**
     C** Called By - MAIN - Main processing
     C**
     C** Calls - ACUP   - Update ZACKEYAL
     C**
     C********************************************************************
     C           NOP       BEGSR
     C*
     C** Display Nostro Transfer screen until F3, F12 or ENTER pressed
     C*
     C           *IN03     DOUEQ'1'
     C           *IN12     OREQ '1'
     C           *IN01     OREQ '0'
     C*
     C                     WRITE#MSGCTL
     C                     EXFMTACKEYNO
     C**
     C** Clear messages from program message queue.
     C**
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGMQ     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C**
     C** If F3 and F12 not pressed, generate keys for Nostro Transfer
     C**
     C           *IN03     IFEQ '0'                        F3 pressed  X scrn
     C           *IN12     ANDEQ'0'                        F12 pressed X scrn
     C**
     C** Initialise fields
     C**
     C                     MOVE *BLANK    DLKEY
     C                     MOVE TYPE      DTYPD
     C                     MOVE STYP      STYPD
     C                     MOVE CLAS      CLASD                                               CDL038
     C                     MOVE *BLANK    FMKEYS
     C**
     C** Value Date Keys
     C**
     C** Format Key XXVYY&&&DB
     C**
     C                     MOVE 'V'       EVENTD
     C                     MOVE 'D'       FBD
     C                     MOVE 'B'       AMTD
     C                     MOVE '01'      PN1
     C                     MOVE '2'       PR1
     C* Update file
     C                     EXSR ACUP
     C**
     C** Format Key XXVYY&&&CB
     C**
     C                     MOVE 'C'       FBD
     C                     MOVE *BLANKS   PN1
     C                     MOVE *BLANKS   PR1
     C                     MOVE '01'      PN4
     C                     MOVE '2'       PR4
     C* Update file
     C                     EXSR ACUP
     C**
     C** Set Deal Type/SubType to blanks before redisplaying initial
     C** screen.
     C**
     C                     MOVE *BLANKS   TYPE
     C                     MOVE *BLANKS   STYP
     C                     MOVE *BLANKS   CLAS                                                CDL038
     C                     MOVE '1'       *IN07
     C*
     C                     END                             F3/F12
     C*
     C                     END                             DOU F3/F12
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** CCYUP - Setup keys which involve a currency code
     C**         Also, DR or CR Trade Equivalent Account Codes are
     C**         moved into corresponding output fields as required
     C**         (Value Date Base Currency Equivalent Postings)
     C**
     C** Called By - FXP - FX screen validation/ key generation
     C**
     C********************************************************************
     C           CCYUP     BEGSR                                       *
     C*
     C                     Z-ADD0         C
     C*
     C           C         DOWLTMAXCCY
     C*
     C           C         ADD  1         C
     C                     MOVE CCYA,C    CYD
     C*
     C           *IN37     IFEQ '1'
     C                     MOVE TAC,C     AC1
      *                                                                                       239089
     C           CYD       IFEQ BJCYCD                                                        239089
     C           BSPAE     ANDEQ*BLANKS                                                       239089
     C                     MOVE AC1       W#AC1  10                                           239089
     C                     MOVE PN1       W#PN1   2                                           239089
     C                     MOVE PR1       W#PR1   1                                           239089
     C                     MOVE *BLANKS   AC1                                                 239089
     C                     MOVE *BLANKS   PN1                                                 239089
     C                     MOVE *BLANKS   PR1                                                 239089
     C                     ENDIF                                                              239089
      *                                                                                       239089
     C                     ELSE
     C           *IN38     IFEQ '1'
     C                     MOVE TAC,C     AC4
      *                                                                                       239089
     C           CYD       IFEQ BJCYCD                                                        239089
     C           BSPAE     ANDEQ*BLANKS                                                       239089
     C                     MOVE AC4       W#AC4  10                                           239089
     C                     MOVE PN4       W#PN4   2                                           239089
     C                     MOVE PR4       W#PR4   1                                           239089
     C                     MOVE *BLANKS   AC4                                                 239089
     C                     MOVE *BLANKS   PN4                                                 239089
     C                     MOVE *BLANKS   PR4                                                 239089
     C                     ENDIF                                                              239089
      *                                                                                       239089
     C                     END
     C                     END
     C**
     C** Update file
     C**
     C** Generation of key 'XXVYYCCY.P' for Deal Type FP & FS is
     C** dependant on Base Ccy for Accounting (from SDBANKPD) and Base
     C** Ccy for Dealing (from SDDEALPD)
     C**
     C           *IN37     IFEQ '1'                        XXVYYCCY.P
     C**
     C** For FP, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for all currencies except Base
     C**
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFNE BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For FP, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for all currencies
     C**
     C                     EXSR ACUP
     C                     END
     C*
     C                     ELSE                            Not FP
     C**
     C** For FS, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for Base currency only
     C**
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For FS, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for both the Base currencies only
     C**
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     ELSE
     C           CYD       IFEQ BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     END
     C*
     C                     END
     C                     ELSE                            FS
     C*
     C* If Deal Type other than FP or FS, generate Key for all
     C* currencies
     C*
     C                     EXSR ACUP
     C*
     C                     END                             FS
     C                     END                             FP
      *                                                                                       239089
     C           CYD       IFEQ BJCYCD                                                        239089
     C           BSPAE     ANDEQ*BLANKS                                                       239089
     C                     MOVE W#AC1     AC1                                                 239089
     C                     MOVE W#PN1     PN1                                                 239089
     C                     MOVE W#PR1     PR1                                                 239089
     C                     ENDIF                                                              239089
      *                                                                                       239089
     C                     END                             XXVYYCCY.P
     C**
     C** Generation of key 'XXVYYCCY.S' for Deal Type FP & FS is
     C** dependant on Base Ccy for Accounting (from SDBANKPD) and Base
     C** Ccy for Dealing (from SDDEALPD)
     C**
     C           *IN38     IFEQ '1'                        XXVYYCCY.S
     C**
     C** For FP, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for the Base Ccy only
     C**
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For FP, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for the both the Base Currencies
     C**
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     ELSE
     C           CYD       IFEQ BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     END
     C*
     C                     END
     C                     ELSE                            FP
     C**
     C** For FS, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for all Currencies except Base
     C**
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFNE BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C                     EXSR ACUP
     C                     END
     C                     ELSE                            FS
     C*
     C* If Deal Type other than FP or FS, generate Key for all
     C* currencies
     C*
     C                     EXSR ACUP
     C*
     C                     END                             FS
     C                     END                             FP
      *                                                                                       239089
     C           CYD       IFEQ BJCYCD                                                        239089
     C           BSPAE     ANDEQ*BLANKS                                                       239089
     C                     MOVE W#AC4     AC4                                                 239089
     C                     MOVE W#PN4     PN4                                                 239089
     C                     MOVE W#PR4     PR4                                                 239089
     C                     ENDIF                                                              239089
      *                                                                                       239089
     C                     END                             *IN38
     C**
     C** Generation of key 'XXDYYCCY.P' for Deal Type FP & FS is
     C** dependant on Base Ccy for Accounting (from SDBANKPD)
     C**
     C           *IN45     IFEQ '1'                        XXDYYCCY.P
     C**
     C** For FP, Key required for every currency except Base Currency
     C**
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFNE BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For FP, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for all currencies
     C**
     C                     EXSR ACUP
     C                     END
     C*
     C                     ELSE                            Not FP
     C**
     C** For FS, Key required for Base Currency only
     C** For FS, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for Base currency only
     C**
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For FS, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for both the Base currencies only
     C**
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     ELSE
     C           CYD       IFEQ BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     END
     C*
     C                     END
     C                     ELSE                            FS
     C**
     C** For Deal Types other than FP and FS, always generate key
     C**
     C                     EXSR ACUP
     C                     END                             FS
     C                     END                             FP
     C                     END                             *IN45
     C**
     C** Generation of key 'XXDYYCCY.S' for Deal Type FP & FS is
     C** dependant on Base Ccy for Accounting (from SDBANKPD)
     C**
     C           *IN46     IFEQ '1'                        XXDYYCCY.S
     C**
     C** For FP, Key required for Base Currency only
     C** For FP, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for the Base Ccy only
     C**
     C           TYPE      IFEQ 'FP'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE                                           144503
     C**
     C** For FP, when Base Ccy for Accounting not equal to Base Ccy for
     C** Dealing the Key is required for the both the Base Currencies
     C**
     C           CYD       IFEQ BJCYCD
     C                     EXSR ACUP
     C                     ELSE
     C           CYD       IFEQ BNCYDL
     C                     EXSR ACUP
     C                     END
     C                     END
     C*
     C                     END
     C                     ELSE                            FP
     C**
     C** For FS, Key required for every currency except Base Currency
     C** For FS, when Base Ccy for Accounting equals Base Ccy for
     C** Dealing the Key is required for all Currencies except Base
     C**
     C           TYPE      IFEQ 'FS'
     C           BJCYCD    IFEQ BNCYDL
     C           CYD       IFNE BJCYCD
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C                     EXSR ACUP
     C                     END
     C                     ELSE
     C**
     C** For Deal Types other than FP and FS, always generate key
     C**
     C                     EXSR ACUP
     C                     END                             FS
     C                     END                             FP
     C                     END                             *IN46
     C**
     C** For all other currency Keys (i.e. XXMYYCCY.P, XXMYYCCY.S,
     C** XXSYYCCY.P & XXSYYCCY.S), generate for all other Deal Types
     C**
     C           *IN37     IFEQ '0'                        XXVYYCCY.P
     C           *IN38     ANDEQ'0'                        XXVYYCCY.S
     C           *IN45     ANDEQ'0'                        XXDYYCCY.P
     C           *IN46     ANDEQ'0'                        XXDYYCCY.S
     C                     EXSR ACUP
     C                     END
     C*
     C                     END                             End DOW
     C**
     C                     ENDSR                                       G *
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  VALDT - Validate initial screen
     C*
     C*  Calls - ZASNMS - Send message to program message queue
     C*
     C*  Called by - MAIN - Main processing
     C*
     C********************************************************************
     C           VALDT     BEGSR
     C*
     C** Set off screen selection indicators
     C*
     C                     SETOF                     415051
     C                     SETOF                     808182
     C                     SETOF                     83
     C                     SETOF                     98                                       CDL038
     C**
     C** Send message if required narratives not all found on SDNARRL1
     C**
     C           *IN11     IFEQ '1'
     C                     MOVEL'USR1776' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETON                     41    Initial scr error
     C                     ELSE
     C**
     C** Send message if Deal Type is blank
     C**
     C           TYPE      IFEQ *BLANKS
     C                     SETON                     50    Deal Type invalid
     C                     MOVEL'USR4217' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE                            Deal Type valid
     C           TYPE      IFEQ 'OT'
     C                     SETON                     41    Initial scr error
     C                     MOVEL'USR4270' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     ELSE
     C           TYPE      LOKUPTABFX                    80
     C*
     C           *IN80     IFEQ '0'                        Not FX Deal Type
     C           TYPE      LOKUPTABMM                    81
     C*
     C           *IN81     IFEQ '0'                        Not MM Deal Type
     C           TYPE      LOKUPTABNA     TABSA          82
     C*
     C           *IN82     IFEQ '0'                        Not NA Deal Type
     C           TYPE      LOKUPTABNO                    83
     C*
     C           *IN83     IFEQ '0'                        Deal Type not found
     C                     SETON                     4150  Deal Type invalid
     C                     MOVEL'USR4217' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             Deal Type not found
     C                     END                             Not NA Deal Type
     C                     END                             Not MM Deal Type
     C                     END                             Not FX Deal Type
     C                     END                             OT entered
     C*
     C                     END                             Valid Deal Type
     C**
     C**   Send message if Deal Sub Type is blank or invalid
     C**
     C           STYP      IFEQ *BLANKS
     C                     SETON                     51    Deal SubType invalid
     C                     ELSE
     C           STYP      CHAINSDDLSTL1             51
     C                     END
     C*
     C           *IN51     IFEQ '1'
     C                     SETON                     41
     C                     MOVEL'USR4218' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C**                                                                                      CDL038
     C**   Send message if Class is invalid                                                   CDL038
     C**                                                                                      CDL038
     C           CDL038    IFEQ 'Y'                                                           CDL038
     C                     CALL 'AOTCLSR0'                                                    CDL038
     C                     PARM *BLANK    P@RTCD  7                                           CDL038
     C                     PARM '*KEY   ' P@OPTN  7                                           CDL038
     C                     PARM CLAS      P@CLAS  4                                           CDL038
     C                     PARM           SDTCLS                                              CDL038
     C           P@RTCD    IFEQ '*NRF   '                                                     CDL038
     C                     SETON                     4198                                     CDL038
     C                     MOVEL'USR5010' ZAMSID           Message id.                        CDL038
     C                     EXSR ZASNMS                     Send message                       CDL038
     C                     ELSE                                                               CDL038
     C                     MOVELTCCLAS    CLAS                                                CDL038
     C                     END                                                                CDL038
     C                     END                                                                CDL038
     C*
     C           *IN41     IFEQ '0'                                       080603
     C           *IN83     ANDEQ'0'                                       187633
     C           DTST      CHAINFDDTSTL1             51                   080603
     C*                                                                   080603
     C           *IN51     IFEQ '1'                                       080603
     C                     SETON                     4150                 080603
     C           CDL038    IFEQ 'Y'                                                           CDL038
     C                     SETON                     98                                       CDL038
     C                     MOVEL'USR5011' ZAMSID           Message id.                        CDL038
     C                     ELSE                                                               CDL038
     C                     MOVEL'USR4219' ZAMSID           Message id.    080603
     C                     ENDIF                                                              CDL038
     C                     EXSR ZASNMS                     Send message   080603
     C                     END                                            080603
     C                     END                                            080603
     C/COPY WNCPYSRC,AK0020C008
     C*                                                                   080603
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C** ACUP - Update ZACKEYAL
     C**
     C** Called By - FXP - Validate FX screen/ Generate FX keys
     C**           - MMP - Validate MM screen/ Generate MM keys
     C**           - NAP - Validate NA screen/ Generate NA keys
     C**           - NOP - Generate Nostro Transfer Keys
     C**           - SRGNPV - Generate NPV unrealised P/L keys             CAS001
     C**           - SRGHAC - Generate Hedge Accounting keys                                  CAS004
     C**
     C** Calls - None
     C**
     C********************************************************************
     C           ACUP      BEGSR
     C*
     C                     MOVE 'D'       RECI
     C                     MOVELDLKEY     AKEY                                                CDL038
     C                     MOVE CLAS      AKEY                                                CDL038
     C*********************MOVE DLKEY     AKEY                                                CDL038
     C**
     C** If Money Market or Negotiable Assets, then re-format output
     C**
     C           *IN81     IFEQ '1'
     C           *IN82     OREQ '1'
     C*
     C** If Liability, reverse positioning of DR/CR
     C*
     C***********EVENTD    IFEQ 'R'                                S01434 080603
     C***********AMTD      OREQ 'B'                                S01434 080603
     C***********AMTD      OREQ 'C'                                S01434 080603
     C***********          MOVE 'Y'       CHECK   1                S01434 080603
     C***********          ELSE                                    S01434 080603
     C***********          MOVE 'N'       CHECK                    S01434 080603
     C***********          ENDIF                                   S01434 080603
     C*                                                            S01434
     C           *IN36     IFEQ '1'
     C***********CHECK     ANDNE'Y'                                S01434 080603
     C*                                                                   CAS001
     C** IF unrealised NPV Profit/Loss a/c keys, do not reverse DR/CR     CAS001
     C           PLFLAG    ANDNE'Y'                                       CAS001
     C**********           MOVE AC1       WAC1    4        Store in work field                CGL029
     C**********           MOVE AC2       WAC2    4        Store in work field                CGL029
     C**********           MOVE AC3       WAC3    4        Store in work field                CGL029
     C**********           MOVE AC4       WAC4    4        Store in work field                CGL029
     C**********           MOVE AC5       WAC5    4        Store in work field                CGL029
     C**********           MOVE AC6       WAC6    4        Store in work field                CGL029
     C                     MOVE AC1       WAC1   10                                           CGL029
     C                     MOVE AC2       WAC2   10                                           CGL029
     C                     MOVE AC3       WAC3   10                                           CGL029
     C                     MOVE AC4       WAC4   10                                           CGL029
     C                     MOVE AC5       WAC5   10                                           CGL029
     C                     MOVE AC6       WAC6   10                                           CGL029
     C                     MOVE PN1       WPN1    2        Store in work field
     C                     MOVE PN2       WPN2    2        Store in work field
     C                     MOVE PN3       WPN3    2        Store in work field
     C                     MOVE PN4       WPN4    2        Store in work field
     C                     MOVE PN5       WPN5    2        Store in work field
     C                     MOVE PN6       WPN6    2        Store in work field
     C                     MOVE PR1       WPR1    1        Store in work field
     C                     MOVE PR2       WPR2    1        Store in work field
     C                     MOVE PR3       WPR3    1        Store in work field
     C                     MOVE PR4       WPR4    1        Store in work field
     C                     MOVE PR5       WPR5    1        Store in work field
     C                     MOVE PR6       WPR6    1        Store in work field
     C*
     C                     MOVE WAC1      ACD4             Move to file fld
     C                     MOVE WAC2      ACD5             Move to file fld
     C                     MOVE WAC3      ACD6             Move to file fld
     C                     MOVE WAC4      ACD1             Move to file fld
     C                     MOVE WAC5      ACD2             Move to file fld
     C                     MOVE WAC6      ACD3             Move to file fld
     C                     MOVE WPN1      NCD4             Move to file fld
     C                     MOVE WPN2      NCD5             Move to file fld
     C                     MOVE WPN3      NCD6             Move to file fld
     C                     MOVE WPN4      NCD1             Move to file fld
     C                     MOVE WPN5      NCD2             Move to file fld
     C                     MOVE WPN6      NCD3             Move to file fld
     C                     MOVE WPR1      PRF4             Move to file fld
     C                     MOVE WPR2      PRF5             Move to file fld
     C                     MOVE WPR3      PRF6             Move to file fld
     C                     MOVE WPR4      PRF1             Move to file fld
     C                     MOVE WPR5      PRF2             Move to file fld
     C                     MOVE WPR6      PRF3             Move to file fld
     C*
     C                     ELSE
     C*
     C* For Asset, do not reverse DR/CR fields
     C*
     C                     MOVE AC1       ACD1             Move to file fld
     C                     MOVE AC2       ACD2             Move to file fld
     C                     MOVE AC3       ACD3             Move to file fld
     C                     MOVE AC4       ACD4             Move to file fld
     C                     MOVE AC5       ACD5             Move to file fld
     C                     MOVE AC6       ACD6             Move to file fld
     C                     MOVE PN1       NCD1             Move to file fld
     C                     MOVE PN2       NCD2             Move to file fld
     C                     MOVE PN3       NCD3             Move to file fld
     C                     MOVE PN4       NCD4             Move to file fld
     C                     MOVE PN5       NCD5             Move to file fld
     C                     MOVE PN6       NCD6             Move to file fld
     C                     MOVE PR1       PRF1             Move to file fld
     C                     MOVE PR2       PRF2             Move to file fld
     C                     MOVE PR3       PRF3             Move to file fld
     C                     MOVE PR4       PRF4             Move to file fld
     C                     MOVE PR5       PRF5             Move to file fld
     C                     MOVE PR6       PRF6             Move to file fld
     C                     END
     C*
     C                     ELSE
     C**
     C** FX Deal Type entered, do not reformat
     C**
     C                     MOVE AC1       ACD1             Move to file fld
     C                     MOVE AC2       ACD2             Move to file fld
     C                     MOVE AC3       ACD3             Move to file fld
     C                     MOVE AC4       ACD4             Move to file fld
     C                     MOVE AC5       ACD5             Move to file fld
     C                     MOVE AC6       ACD6             Move to file fld
     C                     MOVE PN1       NCD1             Move to file fld
     C                     MOVE PN2       NCD2             Move to file fld
     C                     MOVE PN3       NCD3             Move to file fld
     C                     MOVE PN4       NCD4             Move to file fld
     C                     MOVE PN5       NCD5             Move to file fld
     C                     MOVE PN6       NCD6             Move to file fld
     C                     MOVE PR1       PRF1             Move to file fld
     C                     MOVE PR2       PRF2             Move to file fld
     C                     MOVE PR3       PRF3             Move to file fld
     C                     MOVE PR4       PRF4             Move to file fld
     C                     MOVE PR5       PRF5             Move to file fld
     C                     MOVE PR6       PRF6             Move to file fld
     C*
     C                     END
     C                     MOVE 'I'       CHTP                                                CDL038
     C                     Z-ADDBJRDNB    LCD                                                 CDL038
     C**
     C** Write new Account Key and accounting entries to work file
     C**
     C                     WRITEZACKEYAF
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
     C* INIT - Initialise program
     C*
     C* Calls - DBERR - Database error processing
     C*       - AOBANKR0 - SDBANKPD Access Program (external)
     C*       - AOTRADR0 - SDTRADPD Access Program (external)
     C*       - AODEALR0 - SDDEALPD Access Program (external)
     C*       - AOGELRR0 - SDGELRPD Access Program (external)
     C*
     C********************************************************************
     C           INIT      BEGSR
     C*
     C** Define Local Data Area
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C** Define Rundat Data Area
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C*
     C** Clear all fields to send messages to message queue.
     C*
     C                     MOVEL*BLANK    ZAPGM            Program queue
     C                     MOVEL*BLANK    ZAPGRL           Rel queue
     C                     MOVEL*BLANK    ZAMSID           Message Id.
     C                     MOVEL*BLANK    ZAMSGF           Message file.
     C                     MOVEL*BLANK    ZAMSDA           Message data.
     C                     MOVEL*BLANK    ZAMSTP           Message type.
     C*
     C                     MOVE *BLANKS   SPGMQ            Program queue
     C                     MOVEL'AK0020'  SPGMQ            Program queue
     C**
     C** Setup LDA field DBPGM
     C**
     C           *LOCK     IN   LDA                                       S01315
     C                     MOVEL'AK0020'  DBPGM
     C                     OUT  LDA                                       S01315
     C*
     C** Use access program AOBANKR0 to retrieve SDBANKPD Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C** If error in access program, exit via DBERR subroutine
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C                     Z-ADD001       DBASE            **DBERROR 001 *
     C                     EXSR DBERR                      ***************
     C                     END
     C**
     C** Use access program AOTRADR0 to retrieve SDTRADPD Details
     C**
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C**
     C** If error in access program, exit via DBERR subroutine
     C**
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            **DBERROR002  *
     C                     EXSR DBERR                      ***************
     C                     END
     C**
     C** Use access program AODEALR0 to retrieve SDDEALPD Details
     C**
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C**
     C** If error in access program, exit via DBERR subroutine
     C**
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     Z-ADD003       DBASE            **DBERR003**
     C                     EXSR DBERR                      ************
     C                     END
     C*
     C** Use access program AOGELRR0 to retrieve SDGELRPD Details
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
     C** If error in access program, exit via DBERR subroutine
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ***************
     C                     Z-ADD004       DBASE            **DBERROR 004 *
     C                     EXSR DBERR                      ***************
     C                     END
      *                                                                   CAC001
      **  Retrieve SDMMODPD details                                       CAC001
      *                                                                   CAC001
     C                     CALL 'AOMMODR0'                                CAC001
     C                     PARM '*MSG   ' @RTCD   7                       CAC001
     C                     PARM '*FIRST ' @OPTN   7                       CAC001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC001
      *                                                                   CAC001
      **  If error in access program, exit via DBERR subroutine           CAC001
      *                                                                   CAC001
     C           @RTCD     IFNE *BLANKS                                   CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'SDMMODPD'DBFILE           ************   CAC001
     C                     Z-ADD005       DBASE            * DBERR 05 *   CAC001
     C                     EXSR DBERR                      ************   CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  If Analytical Accounting is installed, enable display of new    CAC001
      **  fields                                                          CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE '1'       *IN48                           CAC001
     C                     ENDIF                                          CAC001
      *                                                                                       CGL031
      ** Check if CGL031 is enabled.                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL031'  PSARD                                               CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE '*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     Z-ADD101       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBERR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   CDL006
      ** Access Switchable Feature Details, Check if CDL006 is            CDL006
      ** switch on.                                                       CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   PRTCD   7                       CDL006
     C                     PARM '*VERIFY 'POPTN   7                       CDL006
     C                     PARM 'CDL006'  PSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSSDY                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE *BLANK                                    CDL006
     C           PRTCD     ANDNE'*NRF '                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD006       DBASE            ***************CDL006
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 006*CDL006
     C                     MOVELPSARD     DBKEY            ***************CDL006
     C                     EXSR DBERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           PRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                                       CAS001
      ** Access Switchable Feature Details, Check if CAS001 is installed                      CAS001
      *                                                                                       CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*VERIFY 'POPTN                                               CAS001
     C                     PARM 'CAS001'  PSARD                                               CAS001
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANK                                                        CAS001
     C           PRTCD     ANDNE'*NRF '                                                       CAS001
     C           *LOCK     IN   LDA                                                           CAS001
     C                     Z-ADD007       DBASE                                               CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C                     MOVELPSARD     DBKEY                                               CAS001
     C                     EXSR DBERR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       CAS001  1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       CAS001                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE 'N'       PLFLAG  1                                           CAS001
      *                                                                                       CAS004
      ** Access Switchable Feature Details, Check if CAS004 is installed                      CAS004
      *                                                                                       CAS004
     C                     CALL 'AOSARDR0'                                                    CAS004
     C                     PARM *BLANKS   PRTCD                                               CAS004
     C                     PARM '*VERIFY 'POPTN                                               CAS004
     C                     PARM 'CAS004'  PSARD                                               CAS004
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS004
      *                                                                                       CAS004
     C           PRTCD     IFNE *BLANK                                                        CAS004
     C           PRTCD     ANDNE'*NRF '                                                       CAS004
     C           *LOCK     IN   LDA                                                           CAS004
     C                     Z-ADD008       DBASE                                               CAS004
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS004
     C                     MOVELPSARD     DBKEY                                               CAS004
     C                     EXSR DBERR                                                         CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           PRTCD     IFEQ *BLANKS                                                       CAS004
     C                     MOVE 'Y'       CAS004  1                                           CAS004
     C                     ELSE                                                               CAS004
     C                     MOVE 'N'       CAS004                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Access Switchable Feature Details, Check if CAS005 is installed                      CAS005
      *                                                                                       CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY 'POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE *BLANK                                                        CAS005
     C           PRTCD     ANDNE'*NRF '                                                       CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     Z-ADD009       DBASE                                               CAS005
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS005
     C                     MOVELPSARD     DBKEY                                               CAS005
     C                     EXSR DBERR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVE 'Y'       CAS005  1                                           CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE 'N'       CAS005                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Access Switchable Feature Details, Check if CAS007 is installed                      CAS007
      *                                                                                       CAS007
     C                     CALL 'AOSARDR0'                                                    CAS007
     C                     PARM *BLANKS   PRTCD                                               CAS007
     C                     PARM '*VERIFY 'POPTN                                               CAS007
     C                     PARM 'CAS007'  PSARD                                               CAS007
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS007
      *                                                                                       CAS007
     C           PRTCD     IFNE *BLANK                                                        CAS007
     C           PRTCD     ANDNE'*NRF '                                                       CAS007
     C           *LOCK     IN   LDA                                                           CAS007
     C                     Z-ADD010       DBASE                                               CAS007
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS007
     C                     MOVELPSARD     DBKEY                                               CAS007
     C                     EXSR DBERR                                                         CAS007
     C                     ENDIF                                                              CAS007
      *                                                                                       CAS007
     C           PRTCD     IFEQ *BLANKS                                                       CAS007
     C                     MOVE 'Y'       CAS007  1                                           CAS007
     C                     ELSE                                                               CAS007
     C                     MOVE 'N'       CAS007                                              CAS007
     C                     ENDIF                                                              CAS007
      *                                                                                       CAS009
      ** Access Switchable Feature Details, Check if CAS009 is installed                      CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   PRTCD                                               CAS009
     C                     PARM '*VERIFY 'POPTN                                               CAS009
     C                     PARM 'CAS009'  PSARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS009
      *                                                                                       CAS009
     C           PRTCD     IFNE *BLANK                                                        CAS009
     C           PRTCD     ANDNE'*NRF '                                                       CAS009
     C           *LOCK     IN   LDA                                                           CAS009
     C                     Z-ADD011       DBASE                                               CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     MOVELPSARD     DBKEY                                               CAS009
     C                     EXSR DBERR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
     C**                                                                  S01408
     C/COPY WNCPYSRC,AK0020CCP1                                           S01408
     C**
     C*    CHECK 'WITHOLD TAX' SWITCH ON                                  S01434
     C*                                                                   S01434
     C                     CALL 'AOSARDR0'                                S01460
     C***********          PARM '*MSG   ' @RTCD   7                S01460 080630
     C                     PARM '       ' @RTCD   7                       080630
     C                     PARM '*KEY   ' @OPTN   7                       S01460
     C                     PARM 'S01460'  @SARD   6                       S01460
     C           SCSARD    PARM SCSARD    DSFDY                           S01460
     C*                                                                   S01460
     C           @RTCD     IFEQ *BLANKS                                   S01460
     C                     MOVE 'Y'       S01460  1                       S01460
     C                     MOVE *ON       *IN70                           S01460
     C                     MOVE *ON       *IN71                           080603
     C                     ELSE                                           S01460
     C                     MOVE 'N'       S01460                          S01460
     C                     MOVE *OFF      *IN70                           S01460
     C                     MOVE *OFF      *IN71                           080603
     C                     ENDIF                                          S01460
     C*                                                                   080603
     C**   Check Hong Kong Tax Rate                                       080603
     C*                                                                   080603
     C           BNHKTR    IFNE *ZERO                                     080603
     C                     MOVE *ON       *IN71                           080603
     C                     ENDIF                                          080603
     C*                                                                   080603
     C**   CHECK 'BRT' SWITCH ON                                          080603
     C*                                                                   080603
     C                     CALL 'AOSARDR0'                                080603
     C                     PARM '       ' @RTCD   7                       080603
     C                     PARM '*KEY   ' @OPTN   7                       080603
     C                     PARM 'S01383'  @SARD   6                       080603
     C           SCSARD    PARM SCSARD    DSFDY                           080603
     C*                                                                   080603
     C           @RTCD     IFEQ *BLANKS                                   080603
     C                     MOVE 'Y'       S01383  1                       080603
     C                     MOVE *ON       *IN71                           080603
     C                     MOVE 'D'       BRTKEY  1                       080603
     C           BRTKEY    CHAINSDBRTDD0             11                   080603
     C                     ENDIF                                          080603
     C**                                                                  080603
     C*    CHECK 'ENHANCED ROLLOVERS' SWITCH ON                           080603
     C*                                                                   080603
     C                     CALL 'AOSARDR0'                                080603
     C                     PARM '       ' @RTCD   7                       080603
     C                     PARM '*KEY   ' @OPTN   7                       080603
     C                     PARM 'S01434'  @SARD   6                       080603
     C           SCSARD    PARM SCSARD    DSFDY                           080603
     C*                                                                   080603
     C           @RTCD     IFEQ *BLANKS                                   080603
     C                     MOVE 'Y'       S01434  1                       080603
     C                     ENDIF                                          080603
     C*                                                                   080603
      **  Access SAR details file to check if Enchanced MM Deal           CEU015
      **  Rollover (CEU015) feature is installed.                         CEU015
      *                                                                   CEU015
     C                     CALL 'AOSARDR0'                                CEU015
     C                     PARM '       ' @RTCD                           CEU015
     C                     PARM '*VERIFY' @OPTN                           CEU015
     C                     PARM 'CEU015'  @SARD   6                       CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANK                                    CEU015
     C                     MOVE 'Y'       CEU015  1                       CEU015
     C                     ELSE                                           CEU015
     C                     MOVE 'N'       CEU015                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                                       CDL038
      ** Access Switchable Feature Details, check if CDL038 is installed                      CDL038
      ** (Extended Deal Sub Types)                                                            CDL038
      *                                                                                       CDL038
     C                     CALL 'AOSARDR0'                                                    CDL038
     C                     PARM *BLANKS   PRTCD                                               CDL038
     C                     PARM '*VERIFY 'POPTN                                               CDL038
     C                     PARM 'CDL038'  PSARD                                               CDL038
     C           SCSARD    PARM SCSARD    DSSDY                                               CDL038
      *                                                                                       CDL038
     C           PRTCD     IFEQ *BLANKS                                                       CDL038
     C                     MOVE 'Y'       CDL038  1                                           CDL038
     C                     MOVE *ON       *IN26                                               CDL038
     C                     ELSE                                                               CDL038
     C                     MOVE 'N'       CDL038                                              CDL038
     C                     MOVE *OFF      *IN26                                               CDL038
     C                     ENDIF                                                              CDL038
      *                                                                                       245915
      ** Check if CDL039 is enabled.                                                          245915
      *                                                                                       245915
     C                     CALL 'AOSARDR0'                                                    245915
     C                     PARM *BLANKS   PRTCD                                               245915
     C                     PARM '*VERIFY' POPTN                                               245915
     C                     PARM 'CDL039'  PSARD                                               245915
     C           SCSARD    PARM SCSARD    DSFDY                                               245915
      *                                                                                       245915
     C                     MOVE 'N'       CDL039  1                                           245915
      *                                                                                       245915
     C           PRTCD     IFEQ *BLANKS                                                       245915
     C                     MOVE 'Y'       CDL039                                              245915
     C                     ELSE                                                               245915
      *                                                                                       245915
     C           PRTCD     IFNE '*NRF   '                                                     245915
     C           *LOCK     IN   LDA                                                           245915
     C                     MOVEL'SCSARDPD'DBFILE                                              245915
     C                     MOVEL'CDL039'  DBKEY                                               245915
     C                     Z-ADD103       DBASE                                               245915
     C                     OUT  LDA                                                           245915
     C                     EXSR DBERR                                                         245915
     C                     ENDIF                                                              245915
      *                                                                                       245915
     C                     ENDIF                                                              245915
      *                                                                                       CER048
      ** Check if CER048 is enabled.                                                          CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C                     MOVE 'N'       CER048  1                                           CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048                                              CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE '*NRF   '                                                     CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'SCSARDPD'DBFILE                                              CER048
     C                     MOVEL'CER048'  DBKEY                                               CER048
     C                     Z-ADD104       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR DBERR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
      ** Check if CER054 is enabled.                                                          CER054
      *                                                                                       CER054
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
      *                                                                                       CER054
     C                     MOVE 'N'       CER054  1                                           CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054                                              CER054
     C                     ELSE                                                               CER054
     C                     MOVE 'N'       CER054                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           PRTCD     IFNE *BLANKS                                                       CER054
     C           PRTCD     ANDNE'*NRF   '                                                     CER054
     C           *LOCK     IN   LDA                                                           CER054
     C                     MOVEL'SCSARDPD'DBFILE                                              CER054
     C                     MOVEL'CER054'  DBKEY                                               CER054
     C                     Z-ADD105       DBASE                                               CER054
     C                     OUT  LDA                                                           CER054
     C                     EXSR DBERR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CGL165
      ** Check if CGL165 is enabled.                                                          CGL165
      *                                                                                       CGL165
     C                     CALL 'AOSARDR0'                                                    CGL165
     C                     PARM *BLANKS   PRTCD                                               CGL165
     C                     PARM '*VERIFY' POPTN                                               CGL165
     C                     PARM 'CGL165'  PSARD                                               CGL165
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL165
      *                                                                                       CGL165
     C                     MOVE 'N'       CGL165  1                                           CGL165
      *                                                                                       CGL165
     C           PRTCD     IFEQ *BLANKS                                                       CGL165
     C                     MOVE 'Y'       CGL165                                              CGL165
     C                     MOVE *ON       *IN70                                               CGL165
     C                     MOVE *ON       *IN71                                               CGL165
     C                     ELSE                                                               CGL165
     C                     MOVE 'N'       CGL165                                              CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
     C           PRTCD     IFNE *BLANKS                                                       CGL165
     C           PRTCD     ANDNE'*NRF   '                                                     CGL165
     C           *LOCK     IN   LDA                                                           CGL165
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL165
     C                     MOVEL'CGL165'  DBKEY                                               CGL165
     C                     Z-ADD106       DBASE                                               CGL165
     C                     OUT  LDA                                                           CGL165
     C                     EXSR DBERR                                                         CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                     MD053762
     C                     CALL 'AOSARDR0'                                                  MD053762
     C                     PARM *BLANKS   PRTCD                                             MD053762
     C                     PARM '*VERIFY' POPTN                                             MD053762
     C                     PARM 'CDL013'  PSARD                                             MD053762
     C           SCSARD    PARM SCSARD    DSFDY                                             MD053762
      *                                                                                     MD053762
     C           PRTCD     IFEQ *BLANKS                                                     MD053762
     C                     MOVE 'Y'       CDL013  1                                         MD053762
     C                     ELSE                                                             MD053762
     C                     MOVE 'N'       CDL013                                            MD053762
     C                     ENDIF                                                            MD053762
     C**
     C** Check that all required Narrative Codes are present
     C** on SDNARRPD
     C**
     C***********          Z-ADD0         N       10                      078809
     C                     Z-ADD0         N       20                      078809
     C                     Z-ADD14        MAXN    20                      080603
     C           S01434    IFEQ 'Y'                                       080603
     C                     ADD  2         MAXN                            080603
     C                     ENDIF                                          080603
     C*
     C***********N         DOWLT8                                         078809
     C***********N         DOWLT15                                 078809 080603
     C           N         DOWLTMAXN                                      080603
     C*
     C           N         ADD  1         N
     C********** NR,N      CHAINSDNARRL1             11                                     MD058769
     C                     CALL 'AONARRR0'                                                  MD058769
     C                     PARM *BLANKS   @RTCD                                             MD058769
     C                     PARM '*KEY    '@OPTN                                             MD058769
     C                     PARM NR,N      @NRCD   2                                         MD058769
     C           SDNARR    PARM SDNARR    DSFDY                                             MD058769
     C                     SETOF                     11                                     MD058769
     C           @RTCD     IFNE *BLANKS                                                     MD058769
     C                     SETON                     11                                     MD058769
     C                     ENDIF                                                            MD058769
      *                                                                                     MD058769
     C           *IN11     IFEQ '1'
     C                     MOVE NR,N      PN,N
     C                     END
     C*
     C                     END
     C*
     C***********          MOVEAPN        PNTEST 16                       080603
     C                     MOVEAPN        PNTEST 32                       080603
     C*
     C           PNTEST    IFNE *BLANKS
     C                     SETON                       11
     C                     END
      *                                                                                     MD027308
      ** Access System Values                                                               MD027308
      *                                                                                     MD027308
     C                     CALL 'AOSVALR0'                                                  MD027308
     C                     PARM *BLANKS   PRTCD                                             MD027308
     C                     PARM PSVAL1    P@OP01 20                                         MD027308
     C                     PARM *BLANKS   P@VL01200                                         MD027308
     C                     PARM *BLANKS   P@OP02 20                                         MD027308
     C                     PARM *BLANKS   P@VL02200                                         MD027308
     C                     PARM *BLANKS   P@OP03 20                                         MD027308
     C                     PARM *BLANKS   P@VL03200                                         MD027308
     C                     PARM *BLANKS   P@OP04 20                                         MD027308
     C                     PARM *BLANKS   P@VL04200                                         MD027308
     C                     PARM *BLANKS   P@OP05 20                                         MD027308
     C                     PARM *BLANKS   P@VL05200                                         MD027308
     C                     PARM *BLANKS   P@OP06 20                                         MD027308
     C                     PARM *BLANKS   P@VL06200                                         MD027308
     C                     PARM *BLANKS   P@OP07 20                                         MD027308
     C                     PARM *BLANKS   P@VL07200                                         MD027308
     C                     PARM *BLANKS   P@OP08 20                                         MD027308
     C                     PARM *BLANKS   P@VL08200                                         MD027308
     C                     PARM *BLANKS   P@OP09 20                                         MD027308
     C                     PARM *BLANKS   P@VL09200                                         MD027308
     C                     PARM *BLANKS   P@OP10 20                                         MD027308
     C                     PARM *BLANKS   P@VL10200                                         MD027308
      *                                                                                     MD027308
     C           PRTCD     IFNE *BLANKS                                                     MD027308
     C           *LOCK     IN   LDA                                                         MD027308
     C                     MOVEL'SDSVALPD'DBFILE                                            MD027308
     C                     Z-ADD012       DBASE                                             MD027308
     C                     EXSR DBERR                                                       MD027308
     C                     ENDIF                                                            MD027308
      *                                                                                     MD027308
     C                     MOVELP@VL01    WPIPD   1                                         MD027308
     C*
     C                     SETOF                     020304
     C                     SETOF                     0710
     C                     SETOF                     161718
     C                     SETOF                     192021
     C                     SETOF                     222324
     C                     SETOF                     2530
     C                     SETOF                     313233
     C                     SETOF                     343637
     C                     SETOF                     383941
     C                     SETOF                     505152
     C                     SETOF                     545556
     C                     SETOF                     575859
     C                     SETOF                     606162
     C                     SETOF                     636480
     C                     SETOF                     818283
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
     C*  ZASNMS - Send message to program message queue
     C*
     C*  Calls - Y2SNMGC - Send message to queue (external)
     C*
     C********************************************************************
     C           ZASNMS    BEGSR
     C**
     C** Declare message file name
     C**
     C/COPY WNCPYSRC,AK0020C009
     C                     MOVEL'SDUSRMSG'ZAMSGF
     C/COPY WNCPYSRC,AK0020C010
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM SPGMQ     ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
      *****************************************************************                       CER048
      *                                                               *                       CER048
      * SRGWST - Subroutine to Check if German Witholding Secondary   *                       CER048
      *          Tax Accounting is required.                          *                       CER048
      *                                                               *                       CER048
      * Called by - MMP - Validate Money Market Input & output/update *                       CER048
      *             ACKEK                                             *                       CER048
      *                                                               *                       CER048
      * Calls     : None                                              *                       CER048
      *                                                               *                       CER048
      *****************************************************************                       CER048
      *                                                                                       CER048
     C           SRGWST    BEGSR                                                              CER048
      *                                                                                       CER048
     C                     MOVE 'N'       WGWST   1                                           CER048
     C           TYPE      IFEQ 'TD'                                                          CER048
     C           TYPE      OREQ 'CD'                                                          CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       WGWST                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           CDL006    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C           TYPE      IFEQ 'FT'                                                          CER048
     C           TYPE      OREQ 'DT'                                                          CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       WGWST                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CER048
     C*****************************************************************                       CER054
      /EJECT                                                                                  CER054
      *****************************************************************                       CER054
      *                                                               *                       CER054
      * SRGWTT - Subroutine to Check if German Witholding Third Tax   *                       CER054
      *          Accounting is required.                              *                       CER054
      *                                                               *                       CER054
      * Called by - MMP - Validate Money Market Input & output/update *                       CER054
      *             ACKEK                                             *                       CER054
      *                                                               *                       CER054
      * Calls     : None                                              *                       CER054
      *                                                               *                       CER054
      *****************************************************************                       CER054
      *                                                                                       CER054
     C           SRGWTT    BEGSR                                                              CER054
      *                                                                                       CER054
     C                     MOVE 'N'       WGWTT   1                                           CER054
     C           TYPE      IFEQ 'TD'                                                          CER054
     C           TYPE      OREQ 'CD'                                                          CER054
      *                                                                                       CER054
     C                     MOVE 'Y'       WGWTT                                               CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           CDL006    IFEQ 'Y'                                                           CER054
      *                                                                                       CER054
     C           TYPE      IFEQ 'FT'                                                          CER054
     C           TYPE      OREQ 'DT'                                                          CER054
      *                                                                                       CER054
     C                     MOVE 'Y'       WGWTT                                               CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDSR                                                              CER054
      *****************************************************************                       CER048
      /EJECT                                                                                  CER048
      *****************************************************************                       CER048
      *                                                               *                       CER048
      * SRGSTX - Subroutine to Generate Account Keys for Secondary    *                       CER048
      *          Tax Accounting.                                      *                       CER048
      *                                                               *                       CER048
      * Called by - MMP - Validate Money Market Input & output/update *                       CER048
      *             ACKEK                                             *                       CER048
      *                                                               *                       CER048
      * Calls     : None                                              *                       CER048
      *                                                               *                       CER048
      *****************************************************************                       CER048
      *                                                                                       CER048
     C           SRGSTX    BEGSR                                                              CER048
      *                                                                                       CER048
     C                     SETOF                         36                                   CER048
     C                     MOVE *BLANKS   DLKEY                                               CER048
     C                     MOVE TYPE      DTYPD                                               CER048
     C                     MOVE STYP      STYPD                                               CER048
      *                                                                                       CER048
      ** xxIyybbbSD - Secondary Tax Amount - Spot Trade                                       CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SD'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     MOVE BLSPTA    AC4                                                 CER048
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxIyyzzzSF - Secondary Tax Amount - Spot Trade                                       CER048
      ** Equivalent                                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE 'SF'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C           *LOVAL    SETLLSDCURRL1                                                      CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C           *IN10     DOWEQ*OFF                                                          CER048
      *                                                                                       CER048
     C                     MOVE A6CYCD    CYD                                                 CER048
     C                     MOVE A6SPAE    AC1                                                 CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
      ** xxIyyzzzSG - Secondary Tax Amount - Spot Trade                                       CER048
      ** Equivalent                                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE 'SG'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C           *LOVAL    SETLLSDCURRL1                                                      CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C           *IN10     DOWEQ*OFF                                                          CER048
      *                                                                                       CER048
     C                     MOVE A6CYCD    CYD                                                 CER048
     C                     MOVE A6SPAE    AC4                                                 CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
      ** xxIyybbbSS - Secondary Tax Amount - Spot Trade                                       CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SS'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE BLSPTA    AC1                                                 CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxMyybbbSD - Secondary Tax Amount - Spot Trade                                       CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SD'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     MOVE BLSPTA    AC4                                                 CER048
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxMyyzzzSF - Secondary Tax Amount - Spot Trade                                       CER048
      ** Equivalent                                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE 'SF'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '1'       PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C           *LOVAL    SETLLSDCURRL1                                                      CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C           *IN10     DOWEQ*OFF                                                          CER048
      *                                                                                       CER048
     C                     MOVE A6CYCD    CYD                                                 CER048
     C                     MOVE A6SPAE    AC1                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
      ** xxMyyzzzSG - Secondary Tax Amount - Spot Trade                                       CER048
      ** Equivalent                                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE 'SG'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C           *LOVAL    SETLLSDCURRL1                                                      CER048
     C                     READ SDCURRL1                 10                                   CER048
     C           *IN10     DOWEQ*OFF                                                          CER048
      *                                                                                       CER048
     C                     MOVE A6CYCD    CYD                                                 CER048
     C                     MOVE A6SPAE    AC4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
     C                     READ SDCURRL1                 10                                   CER048
      *                                                                                       CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
      ** xxMyybbbSS - Secondary Tax Amount - Spot Trade                                       CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SS'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE BLSPTA    AC1                                                 CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** Handle German Witholding Tax Countries for Secondary Tax                             CER048
      *                                                                                       CER048
     C                     CLEARWTCA                                                          CER048
     C                     MOVEASWTC      WTCA                                                CER048
     C                     MOVE *IN10     WIN10                                               CER048
     C                     MOVE 'N'       WISAK   1                                           CER048
     C                     MOVE 'N'       WISEK   1                                           CER048
     C                     MOVE 'N'       WMSAK   1                                           CER048
     C                     Z-ADD1         I                                                   CER048
      *                                                                                       CER048
     C           I         DOWLE10                                                            CER048
      *                                                                                       CER048
     C           WTCA,I    IFNE *BLANKS                                                       CER048
      *                                                                                       CER048
     C                     MOVE WTCA,I    KCTRR                                               CER048
     C           KCTRR     CHAINSDCTTXL2             10                                       CER048
      *                                                                                       CER048
     C           *IN10     IFEQ *OFF                                                          CER048
     C                     EXSR SRGAST                                                        CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ADD  1         I                                                   CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
     C                     MOVE WIN10     *IN10                                               CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CER048
      *****************************************************************                       CER054
      /EJECT                                                                                  CER054
      *****************************************************************                       CER054
      *                                                               *                       CER054
      * SRGTTX - Subroutine to Generate Account Keys for Third Tax    *                       CER054
      *          Accounting.                                          *                       CER054
      *                                                               *                       CER054
      * Called by - MMP - Validate Money Market Input & output/update *                       CER054
      *             ACKEK                                             *                       CER054
      *                                                               *                       CER054
      * Calls     : None                                              *                       CER054
      *                                                               *                       CER054
      *****************************************************************                       CER054
      *                                                                                       CER054
     C           SRGTTX    BEGSR                                                              CER054
      *                                                                                       CER054
     C                     SETOF                         36                                   CER054
     C                     MOVE *BLANKS   DLKEY                                               CER054
     C                     MOVE TYPE      DTYPD                                               CER054
     C                     MOVE STYP      STYPD                                               CER054
      *                                                                                       CER054
      ** xxIyybbbTD - Third Tax Amount - Spot Trade                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TD'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE BLSPTA    AC4                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxIyyzzzTF - Third Tax Amount - Spot Trade                                           CER054
      ** Equivalent                                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE 'TF'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE '1'       PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C           *LOVAL    SETLLSDCURRL1                                                      CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C           *IN10     DOWEQ*OFF                                                          CER054
      *                                                                                       CER054
     C                     MOVE A6CYCD    CYD                                                 CER054
     C                     MOVE A6SPAE    AC1                                                 CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C                     ENDDO                                                              CER054
      *                                                                                       CER054
      ** xxIyyzzzTG - Third Tax Amount - Spot Trade                                           CER054
      ** Equivalent                                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE 'TG'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C           *LOVAL    SETLLSDCURRL1                                                      CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C           *IN10     DOWEQ*OFF                                                          CER054
      *                                                                                       CER054
     C                     MOVE A6CYCD    CYD                                                 CER054
     C                     MOVE A6SPAE    AC4                                                 CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C                     ENDDO                                                              CER054
      *                                                                                       CER054
      ** xxIyybbbTS - Third Tax Amount - Spot Trade                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TS'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE BLSPTA    AC1                                                 CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE '1'       PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxMyybbbTD - Third Tax Amount - Spot Trade                                           CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TD'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE BLSPTA    AC4                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxMyyzzzTF - Third Tax Amount - Spot Trade                                           CER054
      ** Equivalent                                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE 'TF'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE '1'       PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C           *LOVAL    SETLLSDCURRL1                                                      CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C           *IN10     DOWEQ*OFF                                                          CER054
      *                                                                                       CER054
     C                     MOVE A6CYCD    CYD                                                 CER054
     C                     MOVE A6SPAE    AC1                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C                     ENDDO                                                              CER054
      *                                                                                       CER054
      ** xxMyyzzzTG - Third Tax Amount - Spot Trade                                           CER054
      ** Equivalent                                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE 'TG'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C           *LOVAL    SETLLSDCURRL1                                                      CER054
     C                     READ SDCURRL1                 10                                   CER054
     C           *IN10     DOWEQ*OFF                                                          CER054
      *                                                                                       CER054
     C                     MOVE A6CYCD    CYD                                                 CER054
     C                     MOVE A6SPAE    AC4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
     C                     READ SDCURRL1                 10                                   CER054
      *                                                                                       CER054
     C                     ENDDO                                                              CER054
      *                                                                                       CER054
      ** xxMyybbbTS - Third Tax Amount - Spot Trade                                           CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TS'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE BLSPTA    AC1                                                 CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** Handle German Witholding Tax Countries for Third Tax                                 CER054
      *                                                                                       CER054
     C                     CLEARWTCA                                                          CER054
     C                     MOVEASWTC      WTCA                                                CER054
     C                     MOVE *IN10     WIN10                                               CER054
     C                     MOVE 'N'       WITAK   1                                           CER054
     C                     MOVE 'N'       WITEK   1                                           CER054
     C                     MOVE 'N'       WMTAK   1                                           CER054
     C                     Z-ADD1         I                                                   CER054
      *                                                                                       CER054
     C           I         DOWLE10                                                            CER054
      *                                                                                       CER054
     C           WTCA,I    IFNE *BLANKS                                                       CER054
      *                                                                                       CER054
     C                     MOVE WTCA,I    KCTRR                                               CER054
     C           KCTRR     CHAINSDCTTXL2             10                                       CER054
      *                                                                                       CER054
     C           *IN10     IFEQ *OFF                                                          CER054
     C                     EXSR SRGATT                                                        CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ADD  1         I                                                   CER054
     C                     ENDDO                                                              CER054
      *                                                                                       CER054
     C                     MOVE WIN10     *IN10                                               CER054
      *                                                                                       CER054
     C                     ENDSR                                                              CER054
      *****************************************************************                       CER048
      /EJECT                                                                                  CER048
      *****************************************************************                       CER048
      *                                                               *                       CER048
      * SRGAST - Generates account keys for a Country of Residence    *                       CER048
      *          for Secondary Tax Accounting                         *                       CER048
      *                                                               *                       CER048
      * Called by - SRGSTX                                            *                       CER048
      *                                                               *                       CER048
      * Calls     : None                                              *                       CER048
      *                                                               *                       CER048
      *****************************************************************                       CER048
      *                                                                                       CER048
     C           SRGAST    BEGSR                                                              CER048
      *                                                                                       CER048
      ** xxIyybbbSA - Secondary Tax Amount                                                    CER048
      *                                                                                       CER048
     C           WISAK     IFNE 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SA'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '2'       PR1                                                 CER048
      *                                                                                       CER048
     C           SIPRT     IFEQ 'Y'                                                           CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       WISAK                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** xxIyybbbSE - Secondary Tax Amount Capitalised                                        CER048
      *                                                                                       CER048
     C           DTYPD     IFEQ 'CD'                                                          CER048
     C           DTYPD     OREQ 'TD'                                                        MD031566
     C           DTYPD     OREQ 'DT'                                                          CER048
     C           CDL006    ANDEQ'Y'                                                           CER048
     C           DTYPD     OREQ 'FT'                                                        MD031566
     C           CDL006    ANDEQ'Y'                                                         MD031566
      *                                                                                       CER048
     C           WISEK     IFNE 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SE'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       WISEK                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** xxIyyccbSS - Secondary Tax Amount                                                    CER048
      *                                                                                       CER048
     C                     MOVE 'I'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVELEWCTRR    CYD                                                 CER048
     C                     MOVE 'SS'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C**********           MOVE EWWTAC    AC4                                        CER048 BUG23114
     C                     MOVE EWSTAC    AC4                                               BUG23114
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxMyybbbSA - Secondary Tax Amount                                                    CER048
      *                                                                                       CER048
     C           WMSAK     IFNE 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SA'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
      *                                                                                       CER048
     C**********           MOVE '01'      PN1                                        CER048 BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN1                                              BUG23884A
     C                     MOVE '2'       PR1                                                 CER048
      *                                                                                       CER048
     C           SIPRT     IFEQ 'Y'                                                           CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZERO     PR1                                                 CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxMyybbbSR - Secondary Tax Amount rolled over                                        CER048
      *                                                                                       CER048
     C           DTYPD     IFEQ 'TD'                                                          CER048
     C           DTYPD     OREQ 'FT'                                                          CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SR'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
      *                                                                                    BUG23692A
     C********** SIPRT     IFNE 'Y'                                               BUG23692A BUG26326
      *                                                                                    BUG23692A
     C**********           MOVE '01'      PN1                                     BUG23692A BUG23884
     C**********           MOVE '38'      PN1                                     BUG23884 BUG23884A
      *                                                                                     BUG26326
      ** the xxMyybbbSR key should never settle                                             BUG26326
     C**********           MOVE '01'      PN1                                     BUG23884A BUG26326
     C**********           MOVE '2'       PR1                                     BUG23692A BUG26326
      *                                                                                    BUG23692A
     C**********           ENDIF                                                  BUG23692A BUG26326
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
      ** xxMyybbbSV - Secondary Tax Amount (spot trade rolled over)                           CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVE 'SV'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C                     MOVE *ZEROS    AC4                                                 CER048
     C                     MOVE *BLANKS   PN4                                                 CER048
     C                     MOVE *ZEROS    PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       WMSAK                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** xxMyyccbSS - Secondary Tax Amount                                                    CER048
      *                                                                                       CER048
     C                     MOVE 'M'       EVENTD                                              CER048
     C                     MOVE *BLANKS   CYD                                                 CER048
     C                     MOVELEWCTRR    CYD                                                 CER048
     C                     MOVE 'SS'      DLKEY                                               CER048
     C                     MOVE *BLANKS   FMKEYS                                              CER048
     C                     MOVE *ZEROS    AC1                                                 CER048
     C                     MOVE *BLANKS   PN1                                                 CER048
     C                     MOVE *ZEROS    PR1                                                 CER048
     C**********           MOVE EWWTAC    AC4                                        CER048 BUG23114
     C                     MOVE EWSTAC    AC4                                               BUG23114
     C**********           MOVE '01'      PN4                                        CER048 BUG23884
     C**********           MOVE '38'      PN4                                     BUG23884 BUG23884A
     C                     MOVE '01'      PN4                                              BUG23884A
     C                     MOVE '1'       PR4                                                 CER048
      *                                                                                       CER048
     C                     EXSR ACUP                                                          CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CER048
      *****************************************************************                       CER054
      /EJECT                                                                                  CER054
      *****************************************************************                       CER054
      *                                                               *                       CER054
      * SRGATT - Generates account keys for a Country of Residence    *                       CER054
      *          for Third Tax Accounting                             *                       CER054
      *                                                               *                       CER054
      * Called by - SRGTTX                                            *                       CER054
      *                                                               *                       CER054
      * Calls     : None                                              *                       CER054
      *                                                               *                       CER054
      *****************************************************************                       CER054
      *                                                                                       CER054
     C           SRGATT    BEGSR                                                              CER054
      *                                                                                       CER054
      ** xxIyybbbTA - Third Tax Amount                                                        CER054
      *                                                                                       CER054
     C           WITAK     IFNE 'Y'                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TA'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE '2'       PR1                                                 CER054
      *                                                                                       CER054
     C           SIPRT     IFEQ 'Y'                                                           CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     MOVE 'Y'       WITAK                                               CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
      ** xxIyybbbTE - Third Tax Amount Capitalised                                            CER054
      *                                                                                       CER054
     C           DTYPD     IFEQ 'CD'                                                          CER054
     C           DTYPD     OREQ 'DT'                                                          CER054
     C           CDL006    ANDEQ'Y'                                                           CER054
      *                                                                                       CER054
     C           WITEK     IFNE 'Y'                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TE'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     MOVE 'Y'       WITEK                                               CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
      ** xxIyyccbTS - Third Tax Amount                                                        CER054
      *                                                                                       CER054
     C                     MOVE 'I'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVELEWCTRR    CYD                                                 CER054
     C                     MOVE 'TS'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE EWTTAC    AC4                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxMyybbbTA - Third Tax Amount                                                        CER054
      *                                                                                       CER054
     C           WMTAK     IFNE 'Y'                                                           CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TA'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
      *                                                                                       CER054
     C                     MOVE '01'      PN1                                                 CER054
     C                     MOVE '2'       PR1                                                 CER054
      *                                                                                       CER054
     C           SIPRT     IFEQ 'Y'                                                           CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZERO     PR1                                                 CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxMyybbbTR - Third Tax Amount rolled over                                            CER054
      *                                                                                       CER054
     C           DTYPD     IFEQ 'TD'                                                          CER054
     C           DTYPD     OREQ 'FT'                                                          CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TR'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
      *                                                                                     BUG25379
      ** the xxMyybbbTR key should never settle                                             BUG26326
     C********** SIPRT     IFNE 'Y'                                                BUG25379 BUG26326
     C**********           MOVE '01'      PN1                                      BUG25379 BUG26326
     C**********           MOVE '2'       PR1                                      BUG25379 BUG26326
     C**********           ENDIF                                                   BUG25379 BUG26326
      *                                                                                     BUG25379
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
      ** xxMyybbbTV - Third Tax Amount (spot trade rolled over)                               CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVE 'TV'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE *ZEROS    AC4                                                 CER054
     C                     MOVE *BLANKS   PN4                                                 CER054
     C                     MOVE *ZEROS    PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     MOVE 'Y'       WMTAK                                               CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
      ** xxMyyccbTS - Third Tax Amount                                                        CER054
      *                                                                                       CER054
     C                     MOVE 'M'       EVENTD                                              CER054
     C                     MOVE *BLANKS   CYD                                                 CER054
     C                     MOVELEWCTRR    CYD                                                 CER054
     C                     MOVE 'TS'      DLKEY                                               CER054
     C                     MOVE *BLANKS   FMKEYS                                              CER054
     C                     MOVE *ZEROS    AC1                                                 CER054
     C                     MOVE *BLANKS   PN1                                                 CER054
     C                     MOVE *ZEROS    PR1                                                 CER054
     C                     MOVE EWTTAC    AC4                                                 CER054
     C                     MOVE '01'      PN4                                                 CER054
     C                     MOVE '1'       PR4                                                 CER054
      *                                                                                       CER054
     C                     EXSR ACUP                                                          CER054
      *                                                                                       CER054
     C                     ENDSR                                                              CER054
      *****************************************************************                       CER048
      /EJECT                                                                                  CER048
     C********************************************************************
     C*
     C* DBERR - Database error processing
     C*
     C* Called by - INIT - Initialise program
     C*
     C* Calls     : None
     C*
     C********************************************************************
     C           DBERR     BEGSR
     C*
     C                     SETON                     U7U8LR
     C*
     C                     DUMP
     C                     OUT  LDA
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C*************************************************************S01460 080603
     C**********                                                   S01460 080603
     C**MMCCY*-*Setup Keys which involve a Currency Code for MM    S01460 080603
     C**********                                                   S01460 080603
     C**Called*by - MMP - Validate Money Market screen/Generate    S01460 080603
     C**********                                                   S01460 080603
     C**Calls***  : None                                           S01460 080603
     C**********                                                   S01460 080603
     C*************************************************************S01460 080603
     C**********                                                   S01460 080603
     C********** MMCCY     BEGSR                                   S01460 080603
     C**********                                                   S01460 080603
     C**********           Z-ADD1         C                        S01460 080603
     C**********                                                   S01460 080603
     C********** C         DOWLEMAXCCY                             S01460 080603
     C**********                                                   S01460 080603
     C**********           MOVE CCYA,C    CYD                      S01460 080603
     C**********                                                   S01460 080603
     C********** CCYA,C    IFEQ BJCYCD                             S01460 080603
     C**********           MOVE F8        AC1                      S01460 080603
     C**********           MOVE '01'      PN1                      S01460 080603
     C**********           MOVE '1'       PR1                      S01460 080603
     C**********           ELSE                                    S01460 080603
     C**********           MOVE BLSPTA    AC1                      S01460 080603
     C**********           MOVE BASETA    AC2                      S01460 080603
     C**********           MOVE F8        AC3                      S01460 080603
     C**********           MOVE BLSPTA    AC4                      S01460 080603
     C**********           MOVE TAC,C     AC5                      S01460 080603
     C**********           MOVE '01'      PN1                      S01460 080603
     C**********           MOVE '01'      PN2                      S01460 080603
     C**********           MOVE '01'      PN3                      S01460 080603
     C**********           MOVE '01'      PN4                      S01460 080603
     C**********           MOVE '01'      PN5                      S01460 080603
     C**********           MOVE '1'       PR1                      S01460 080603
     C**********           MOVE '1'       PR2                      S01460 080603
     C**********           MOVE '1'       PR3                      S01460 080603
     C**********           MOVE '1'       PR4                      S01460 080603
     C**********           MOVE '1'       PR5                      S01460 080603
     C**********           ENDIF                                   S01460 080603
     C**********                                                   S01460 080603
     C**********           EXSR ACUP                               S01460 080603
     C**********                                                   S01460 080603
     C**********           MOVE *BLANKS   CYD                      S01460 080603
     C**********           MOVE *BLANKS   FMKEYS                   S01460 080603
     C**********           ADD  1         C                        S01460 080603
     C**********                                                   S01460 080603
     C**********           ENDDO                                   S01460 080603
     C**********                                                   S01460 080603
     C**********           ENDSR                                   S01460 080603
     C*************************************************************S01460 080603
      */EJECT****                                                  S01460 080603
     C********************************************************************
** TABFX - Foreign Exchange Deal Types
FPFSCXPISIOPSW
** TABMM - Money Market Deal Types                                        S01354
IPITTDTICICDCLILIDFLDPLPFTDTLTDLCF                                              CDL006 CAS001 240339
** TABNA/TABSA - Negotiable Assets Purchased/Sold Deal Types
C1CS
C2CS
BPBS
BDBR
TBTS
TATR
DARA
** TABNO - Nostro Transfer Deal Types
NX
** NR - Required Narrative Codes
01020304050910131521222426271819                                   078809 080603
**  CPY@
(c) Finastra International Limited 2001
