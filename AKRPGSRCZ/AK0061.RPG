     H        1                                                           S01315
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AK A/c key generation - generate keys')
     H********1   DD                                                      S01315
     F*****************************************************************
     F*                                                               *
     F*  Midas - Account Key Generator                            *
     F*                                                               *
     F*  AK0061  -  SE Account Key Generation Main Processing         *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE065             Date 08Nov04               *
      *                 CAS007             Date 26Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 102511             Date 29Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE006             Date 03Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 159026             Date 20Apr99               *
     F*                 CEU017             Date 07Apr98               *
     F*                 CSE007             Date 24Mar98               *
     F*                 CAC002             Date 15SEP96               *
     F*                 100986             Date 16APR96               *
     F*                 S01408             Date 26FEB96               *
     F*                 081884             Date 17JAN95               *
     F*                 066211             DATE 25AUG94               *
     F*                 068174             DATE 25AUG94               *
     F*                 055442             DATE 25APR94               *
     F*                 S01445             DATE 23NOV93               *
     F*                 S01447             DATE 19NOV93               *
     F*                 056357             DATE 19NOV93               *
     F*                 E40664             DATE 12MAY92               *
     F*                 S01315             DATE 28FEB90               *
     F*                 E23650             DATE 04OCT90               *
     F*                 E23516             DATE 07SEP90               *
     F*                 E22490             DATE 12JUL90               *
     F*                 E21451             DATE 20MAR90               *
     F*                 AK0015             DATE 31/01/90              *
     F*                 AK0014             DATE 14/11/89              *
     F*                 AK0013             DATE 24/10/89              *
     F*                 AK0012             DATE 16/10/89              *
     F*                 AK0011             DATE 16/10/89              *
     F*                 AK0010             DATE 16/10/89              *
     F*                 AK0009             DATE 13/10/89              *
     F*                 AK0006             DATE 11/10/89              *
     F*                 AK0004             DATE 10/10/89              *
     F*                 AK0003             DATE 10/10/89              *
     F*                 AK0002             DATE 29/09/89              *
     F*                 AK0001             DATE 11/08/89              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE065 - Const. Yield Amort. on Mortgage backed assets       *
      *  CAS007 - Hedge Accounting Control                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  102511 - Generate a/c keys for Book Transfers.               *
      *  CSE023 - Treaty Withholding Tax                              *
     F*  CSE015 - Forward Valued Depot Movements                      *
     F*  CSE006 - Add the generation of new A/C key as in BRS.        *
     F*  159026 - Corporate Actions. Problems with Account Keys       *
     F*           Generator Program.                                  *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions.                                  *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           Generate new Margin Amount account keys.            *
     F*  100986 - Add book code to template key so that template can  *
     F*           be selected by book.                                *
     F*  S01408 - Addition of core hook AK0061FFP1
     F*           Addition of core hook AK0061CCP1
     F*           Addition of core hook AK0061CCP2
     F*           Addition of core hook AK0061CCP3
     F*           Addition of core hook AK0061CCP4
     F*           Addition of core hook AK0061CCP5
     F*           Addition of core hook AK0061CCP6
     F*           Addition of core hook AK0061CCP7
     F*           Addition of core hook AK0061CCP8
     F*           Addition of core hook AK0061CCP9
     F*           Addition of core hook AK0061CP10
     F*           Addition of core hook AK0061CP11
     F*           Addition of core hook AK0061CP12
     F*  081884 - NARRATIVE CODE IS NOW ALPHA - AMEND PGM AND         *
     F*           RECOMPILE OVER AMENDED FILE                         *
     F*  066211 - Use of dual book code and template caused           *
     F*           PRIMARY BOOK CODES LAST ACCOUNT CODE DETAIL TO      *
     F*           UPDATE THE SECONDARY BOOK CODES' KEY DETAILS.       *
     F*           DATA STRUCTURE RACCTG SHOULD BE CLEARED IF          *
     F*           NO TEMPLATE FOUND AS NO TEMPLATE ACCOUNT CODES      *
     F*           EXIST FOR THE BOOK CODE.                            *
     F*         - RENAME TSEACKD FIELDS, TO PREVENT THEM OVERWRITING  *
     F*           DATA IN XSEACKD.                                    *
     F*  068174 - BLANK OUT DATA STRUCTURE ACCTG AFTER UNSUCCESFUL    *
     F*           CHAIN TO TSEACK, OTHERWISE WILL GET DUPLICATE       *
     F*           ENTRIES. (FROM LBB-LDN, STEVE MILLER.)              *
     F*  055442 - Mort. Repayment Face Value not produced for depot   *
     F*  S01445 - Depot Movement Charges. Generate key for each       *
     F*           charge code.                                        *
     F*  S01447 - Withholding Tax. Generate key for each country      *
     F*           code, and Withholding tax type (WR,WN,WD,WX)        *
     F*  056357 - Pointer not set for location referenced Error       *
     F*  E40664 - Add template investment type for BHF.               *
     F*  S01315 - Upgrade to SD Standards                             *
     F*           Correct Line Overflow                               *
     F*           Program name changed from SE4010 to AK0061.         *
     F*  E23650 - Book code should not be included                    *
     F*           on positional settlement FP/FR/CP/CR account keys.  *
     F*  E23516 - Production of discrepancy keys on trade/value date  *
     F*           should not be conditioned on SDMO and SDMU.         *
     F*  E22490 - As Audit is not being carried out for XSECKD, it    *
     F*           is not necessary to maintain XSECKA.                *
     F*  E21451 - Variable names ITYP,SECD,ETYP,ATYP changed as these *
     F*           fields are already defined in reference file MFRFL  *
     F*           with attributes different from those required.      *
     F*           New field names ITYPA,SECDA,ETYPA,and ATYPA.        *
     F*  AK0015 - Check value of SPIT before producing C/AI & C/PI.   *
     F*  AK0014 - New key on maturity - iiiM-X------mvn---CV.         *
     F*  AK0013 - Should not produce DF,DN keys for schuldschein on   *
     F*           trade date, value date or coupon date.              *
     F*  AK0012 - Fixes for standard depot movement FV keys.          *
     F*  AK0011 - Need classification X on BL,BB,RA,RV,PL & PD keys.  *
     F*  AK0010 - Must blank out accounting entry fields after CHAIN  *
     F*           to live file succeeds otherwise spurious accounting *
     F*           entries appear on subsequently generated keys.      *
     F*  AK0009 - Changes to conditions for production of contingent  *
     F*           liability keys.                                     *
     F*  AK0006 - No PI,AI or DI keys for any processing type if trade*
     F*           basis D. No DF,DN keys on trade, value or coupon    *
     F*           date if trade basis D.                              *
     F*  AK0004 - Allow for SKTD equal to 'N'.                        *
     F*  AK0003 - Write out remaining contents of LIN array during    *
     F*           SR/CLOS so that last line of keys is reported.      *
     F*  AK0002 - Reset changed parameters after contingent liability *
     F*           routine FV05.                                       *
     F*  AK0001 - Generation of DA/PA keys should not be affected     *
     F*           by ICD parameter SKTD.                              *
     F*                                                               *
     F*****************************************************************
     FLINKD   IF  E                    DISK
     FLINKDX1 IF  E                    DISK                               100986
     FINVTP   IF  E           K        DISK
     FSECGT   IF  E           K        DISK
     F*BOOKD   IF  E           K        DISK                              S01315
     FSDBOOKL1IF  E           K        DISK                               S01315
     FSEACKD  IF  E           K        DISK
     FTSEACK  IF  E           K        DISK                               E40664
     F*TABSE   IF  E           K        DISK                              S01315
     F************TABLETAF                          KIGNORE               S01315
     F************TABTB10F                          KIGNORE               S01315
     F************TABTB11F                          KIGNORE               S01315
     F************TABTB40F                          KIGNORE               S01315
     F************TABTE10F                          KIGNORE               S01315
     F************TABTE20F                          KIGNORE               S01315
     F************TABTG10F                          KIGNORE               S01315
     F************TABTG20F                          KIGNORE               S01315
     F************TABLETHF                          KIGNORE               S01315
     F************TABLETJF                          KIGNORE               S01315
     F************TABLETKF                          KIGNORE               S01315
     F************TABLETLF                          KIGNORE               S01315
     F************TABLETNF                          KIGNORE               S01315
     F************TABLETPF                          KIGNORE               S01315
     F************TABLETRF                          KIGNORE               S01315
     F************TABLETXF                          KIGNORE               S01315
     F************TABLET2F                          KIGNORE               S01315
     F************TABLET3F                          KIGNORE               S01315
     F************TABLET5F                          KIGNORE               S01315
     FXSEACKD UF  E           K        DISK                      A
     F            TSEACKDF                          KRENAMEXSEACKDF
     F***XSEACKA UF  E                    DISK                            E22490
     F*SE4010P1O***E***                 PRINTER      KINFDS PRDS          S01315
     FAK0061P1O   E                    PRINTER      KINFDS PRDS           S01315
      *
     F*                         Begin S01408
     F/COPY WNCPYSRC,AK0061FFP1
     F*                         End S01408
      *   INDICATOR USAGE
      *   ---------------
      *
      *   09      Display of Withholding country codes on report          S01447
      *   21      Use Classification array DS1
      *   22      Use Classification array DS2
      *   23      Use Classification array DS3
      *   24      Use Classification array DS4
      *   97      Chain fail/End-of-file                                  E40664
      *   98      Chain fail/End-of-file
      *   99      Chain fail/End-of-file
      *
      *   SUBROUTINE DEFINITIONS
      *   ----------------------
      *
      *   INIT    Initialisation routine
      *   MAIN    Main processing control
      *   CLOS    Closing routine
      ****ZICDSE**Access TABTB36
      *   STINIT  Setup of array STP
      *   CSINIT  Setup of array CST                                      CSE007
      *   MKINIT  Setup of array MRK
      *   BKINIT  Setup of array BKS
      *   CCINIT  Setup of array CCD
      *   AMINIT  Setup of array AMD
      *   DSINIT  Setup of arrays DS1, DS2, DS3 & DS4
      *   CYINIT  Setup of array CTX                                      S01447
      *   SRSWTA  Account setup of EU Withholding Tax a/c keys                                CGL031
      *   FV01    FV keys - trade/value/settlement date
      *   FV02    FV keys - depot movement date
      *   FV02CO  FV keys - depot movement date for Corporate Actions     CSE007
      *   FV03    FV keys - mortgage repayment
      *   FV04    FV keys - maturity
      *   FV05    FV keys - value date client contingent liability
      *   CO01    CO keys - trade/value/settlement date
      *   CO02    CO keys - mortgage repayment/maturity
      *   CV01    CV keys - trade/value/settlement date
      *   CV02    CV keys - maturity
      *   CN01    CN keys - trade/value date
      *   FC01    FP/FR/CP/CR keys - trade/value date
      *   FC02    FP/FR/CP/CR keys - position settlement
      *   FC02CO  FP/FR/CP/CR keys - position settlement for Corp. Act.   CSE007
      *   FC03    FR keys - Depot Movements                               S01445
      *   RERR01  RE/RR keys - trade/value date
      *   PI01    PI keys - trade date
      *   PI02    PI keys - value date
      *   PI03    PI keys - coupon payment date
      *   DSPR01  DS/PR keys - trade/value date
      *   DAPA01  DA/PA keys
      *   RPL01   RP/RL keys
      *   UPL01   UP/UL keys
      *   SA01    SA keys - settlement date/position settlement
      *   SA01CO  SA keys - settlement date/position settl. (Corp Act)    CSE007
      *   DFN01   DF/DN keys - trade/value/settlement date
      *   DFN02   DF/DN keys - coupon due date
      *   AI01    A.I.R. keys - value date
      *   AI02    A.I.R. keys - accrual/coupon date
      *   PP01    PP keys - call date
      *   PP02    PP keys - position settlement
      *   DI01    DI keys - dividend due date
      *   DI01CO  DI keys - dividend due date for Corporate Actions       CSE007
      *   DI02    DI keys - interest/coupon due
      *   DI03    DI keys - position settlement
      *   DI03CO  DI keys - position settlement for Corporate Actions     CSE007
      *   MR01    MR keys - amount due
      *   ZZ01    BL,BB,RA,RV,PL & PD keys - depot movement date
      *   WTAXK   Setup withholding tax keys                              S01447
      *   WTAXCO  Setup withholding tax keys for Corporate Actions        CSE007
      *   MV01    MV keys - margin amount - trades                        CAC002
      *   MA01    MA keys - margin amoutn - position settlements          CAC002
      *   RC01    RC keys - Consideration keys for Reverse Repos,         CSE006
      *           Repos, Bond Lending and Pledge Loans                    CSE006
      *   SRGNET  ET keys - EU Withholding Tax                                                CGL031
      *   SRGNNI  NI keys - Net Interest Due                                                  CGL031
      *   GEN01   Main production loop
      *   GEN02   Main production loop for Corporate Actions              CSE007
      *   SRGN03  Main production loop for EU Withholding Tax accounting                      CGL031
      *   SUBCHK  Check ICD accounting option TSAK
      *   SBCCHK  Check ICD accounting option COTA                        CSE007
      *   NPACHK  Check ICD accounting option NPAC
      *   SNACHK  Check ICD accounting option SNAC
      *   ADCHK   Control suppression/generation of DS/PR/DA/PA keys
      *   UPLCHK  Control suppression/generation of UP/UL keys
      *   OUTPUT  Output to XSEACKD & report
      *
      *   ARRAYS
      *   ------
     E**************      EVT    10  10  1               Event codes      CSE007
     E                    EVT    11  11  1               Event codes      CSE007
     E                    TTP     3   3  1               Trade types
     E                    CVT     2   2  1               Convertible ind.
     E                    NEG     2   2  1               Neg.pos./neg.accr
     E                    DS1         5  1               Classifications 1
     E                    DS2         4  1               Classifications 2
     E                    DS3         3  1               Classifications 3
     E                    DS4         2  1               Classifications 4
     E                    BKS        11  2               Book codes.
     E                    STP         8  2               Subtypes/posting basis
     E                    CST         8  2               Corp Act SubtypesCSE007
     E                    MRK         4  1               Market indicators
     E                    CTY        11  2               Country Codes    S01447
     E                    CCD       100  2               Charge codes
     E                    AMD        11  1               Amortize disc Y/N
     E                    LIN         5 20               Holds a line for report
     E                    WTAA       10  4                                                    CGL031
      ** Withholding Tax Account Codes Array                                                  CGL031
      *                                                                                       CGL031
     E                    WCCA       10  2                                                    CGL031
      ** Withholding Tax Country Codes Array                                                  CGL031
      *                                                                                       CGL031
     E/COPY WNCPYSRC,AK0061E001
      *
      *   Rename 'Include in Account Key' field on S/INVTP
      *   DIND must be renamed as used in AKEY data structure
      *
     IINVTPDF
     I              INAK                            IINAK
     I              DIND                            IDIND
      *
      *   Rename 'Include in Account Key' field on S/BOOKD
      *
     I*BOOKDDF                                                            S01315
     I**************INAK                            BINAK                 S01315
     I@BDREDK                                                             S01315
     I              BDIACK                          BINAK                 S01315
      *
      ****Rename*FC01*&*FC02*from*SECGTD*as*used*as*subroutine*names      S01445
      *  Rename FC01,FC02,FC03 from SECGTD as used as subroutine names    S01445
      *
     ISECGTDF
     I              FC01                            FC01X
     I              FC02                            FC02X
     I              FC03                            FC03X                 S01445
      *                                                                   066211
      *   Rename TSEACKD fields, as same as XSEACKD.                      066211
      *                                                                   066211
     ITSEACKDF                                                            066211
     I              RECI                            TRECI                 066211
     I              ACKE                            TACKE                 066211
     I              ACD1                            TACD1                 066211
     I              ACD2                            TACD2                 066211
     I              ACD3                            TACD3                 066211
     I              ACD4                            TACD4                 066211
     I              ACD5                            TACD5                 066211
     I              ACD6                            TACD6                 066211
     I**************NCD1                            TNCD1           066211081884
     I**************NCD2                            TNCD2           066211081884
     I**************NCD3                            TNCD3           066211081884
     I**************NCD4                            TNCD4           066211081884
     I**************NCD5                            TNCD5           066211081884
     I**************NCD6                            TNCD6           066211081884
     I              NCDA1                           TNCD1                 081884
     I              NCDA2                           TNCD2                 081884
     I              NCDA3                           TNCD3                 081884
     I              NCDA4                           TNCD4                 081884
     I              NCDA5                           TNCD5                 081884
     I              NCDA6                           TNCD6                 081884
     I              PRF1                            TPRF1                 066211
     I              PRF2                            TPRF2                 066211
     I              PRF3                            TPRF3                 066211
     I              PRF4                            TPRF4                 066211
     I              PRF5                            TPRF5                 066211
     I              PRF6                            TPRF6                 066211
     I              LCD                             TLCD                  066211
     I              CHTP                            TCHTP                 066211
     I              TNLU                            TTNLU                 066211
     I              ETYPA                           TETYPA                066211
     I              ATYPA                           TATYPA                066211
      *                                                                   S01315
     I*LDA        UDS                            256                      S01315
     I************                          134 138 DBFILE                S01315
     I************                          139 167 DBKEY                 S01315
     I************                          168 175 DBPGM                 S01315
     I************                          176 1770DBASE                 S01315
     ILDA         DS                            256                       S01315
     I                                      134 141 DBFILE                S01315
     I                                      142 170 DBKEY                 S01315
     I                                      171 180 DBPGM                 S01315
     I                                      181 1830DBASE                 S01315
      *
      *   Local data area.
      *
     IPRDS        DS
     I                                       83  90 SFILE                 S01315
     I                                    B 123 1240SFNUM                 S01315
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
      *
      *   Overflow line number and current print line in file info d.s.
      *
     IEWTA        DS                                                                          CGL031
     I                                        1   4 EWTA1                                     CGL031
     I                                        5   8 EWTA2                                     CGL031
     I                                        9  12 EWTA3                                     CGL031
     I                                       13  16 EWTA4                                     CGL031
     I                                       17  20 EWTA5                                     CGL031
     I                                       21  24 EWTA6                                     CGL031
     I                                       25  28 EWTA7                                     CGL031
     I                                       29  32 EWTA8                                     CGL031
     I                                       33  36 EWTA9                                     CGL031
     I                                       37  40 EWTA10                                    CGL031
      *                                                                                       CGL031
     IEWTC        DS                                                                          CGL031
     I                                        1   2 EWTC1                                     CGL031
     I                                        3   4 EWTC2                                     CGL031
     I                                        5   6 EWTC3                                     CGL031
     I                                        7   8 EWTC4                                     CGL031
     I                                        9  10 EWTC5                                     CGL031
     I                                       11  12 EWTC6                                     CGL031
     I                                       13  14 EWTC7                                     CGL031
     I                                       15  16 EWTC8                                     CGL031
     I                                       17  18 EWTC9                                     CGL031
     I                                       19  20 EWTC10                                    CGL031
      *                                                                                       CGL031
     ISCSARD    E DSSCSARDPD                                                                  CGL031
      ** Switchable Features Data Structure                                                   CGL031
      *                                                                                       CGL031
     ISDSTRD    E DSSDSTRDPD                                              S01315
     I** Securities Trading Data                                          S01315
     I*                                                                   S01315
     ISDBANK    E DSSDBANKPD                                              S01315
     I** Bank Details                                                     S01315
     I*                                                                   S01315
     ISDMMOD    E DSSDMMODPD                                              CAC002
     I**  Modules File Details                                            CAC002
     I*                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 S01315
     I***First*DS*for*Access*Programs,*Full*Data*Structure          056357S01447
     I** First DS for Access Programs, Short Data Structure               S01447
     IDSSDY     E DSDSSDY                                                 056357
     I***First*DS*for*Access*Programs,*Short*Data*Structure         S01315S01447
     I** First DS for Access Programs, Long Data Structure                S01447
     I*                                                                   S01315
     I/COPY WNCPYSRC,AK0061I001
     IAKEY        DS
     I                                        1   3 ITYPA
     I                                        4   4 ETYPA
     I                                        5   5 TTYP
     I                                        6   6 DIND
     I                                        7   8 BOOK
     I                                        9  10 STYP
     I                                        9   9 POST
     I/COPY WNCPYSRC,AK0061I003
     I                                       11  12 CTYP
     I                                       13  13 MARK
     I                                       14  14 CONV
     I                                       15  15 NEGI
     I                                       16  18 BLK3
     I                                       17  18 CTRYCD                S01447
     I                                       19  20 ATYPA
     I/COPY WNCPYSRC,AK0061I002
     ITEMPK       DS                                                      100986
     I                                        1  20 TMPKEY                100986
     I                                        7   8 TMPBOK                100986
     IACCTG       DS                                                      E40664
     I**********                              1   40ACD1                               E40664 CGL029
     I**********                              5   80ACD2                               E40664 CGL029
     I**********                              9  120ACD3                               E40664 CGL029
     I**********                             13  160ACD4                               E40664 CGL029
     I**********                             17  200ACD5                               E40664 CGL029
     I**********                             21  240ACD6                               E40664 CGL029
     I************                           25  260NCD1            E40664081884
     I************                           27  280NCD2            E40664081884
     I************                           29  300NCD3            E40664081884
     I************                           31  320NCD4            E40664081884
     I************                           33  340NCD5            E40664081884
     I************                           35  360NCD6            E40664081884
     I**********                             25  26 NCDA1                              081884 CGL029
     I**********                             27  28 NCDA2                              081884 CGL029
     I**********                             29  30 NCDA3                              081884 CGL029
     I**********                             31  32 NCDA4                              081884 CGL029
     I**********                             33  34 NCDA5                              081884 CGL029
     I**********                             35  36 NCDA6                              081884 CGL029
     I**********                             37  370PRF1                               E40664 CGL029
     I**********                             38  380PRF2                               E40664 CGL029
     I**********                             39  390PRF3                               E40664 CGL029
     I**********                             40  400PRF4                               E40664 CGL029
     I**********                             41  410PRF5                               E40664 CGL029
     I**********                             42  420PRF6                               E40664 CGL029
     I                                        1  100ACD1                                      CGL029
     I                                       11  200ACD2                                      CGL029
     I                                       21  300ACD3                                      CGL029
     I                                       31  400ACD4                                      CGL029
     I                                       41  500ACD5                                      CGL029
     I                                       51  600ACD6                                      CGL029
     I                                       61  62 NCDA1                                     CGL029
     I                                       63  64 NCDA2                                     CGL029
     I                                       65  66 NCDA3                                     CGL029
     I                                       67  68 NCDA4                                     CGL029
     I                                       69  70 NCDA5                                     CGL029
     I                                       71  72 NCDA6                                     CGL029
     I                                       73  730PRF1                                      CGL029
     I                                       74  740PRF2                                      CGL029
     I                                       75  750PRF3                                      CGL029
     I                                       76  760PRF4                                      CGL029
     I                                       77  770PRF5                                      CGL029
     I                                       78  780PRF6                                      CGL029
     IRACCTG      DS                                                      E40664
     I**********                              1   40TACD1                              E40664 CGL029
     I**********                              5   80TACD2                              E40664 CGL029
     I**********                              9  120TACD3                              E40664 CGL029
     I**********                             13  160TACD4                              E40664 CGL029
     I**********                             17  200TACD5                              E40664 CGL029
     I**********                             21  240TACD6                              E40664 CGL029
     I************                           25  260TNCD1           E40664081884
     I************                           27  280TNCD2           E40664081884
     I************                           29  300TNCD3           E40664081884
     I************                           31  320TNCD4           E40664081884
     I************                           33  340TNCD5           E40664081884
     I************                           35  360TNCD6           E40664081884
     I**********                             25  26 TNCD1                              081884 CGL029
     I**********                             27  28 TNCD2                              081884 CGL029
     I**********                             29  30 TNCD3                              081884 CGL029
     I**********                             31  32 TNCD4                              081884 CGL029
     I**********                             33  34 TNCD5                              081884 CGL029
     I**********                             35  36 TNCD6                              081884 CGL029
     I**********                             37  370TPRF1                              E40664 CGL029
     I**********                             38  380TPRF2                              E40664 CGL029
     I**********                             39  390TPRF3                              E40664 CGL029
     I**********                             40  400TPRF4                              E40664 CGL029
     I**********                             41  410TPRF5                              E40664 CGL029
     I**********                             42  420TPRF6                              E40664 CGL029
     I                                        1  100TACD1                                     CGL029
     I                                       11  200TACD2                                     CGL029
     I                                       21  300TACD3                                     CGL029
     I                                       31  400TACD4                                     CGL029
     I                                       41  500TACD5                                     CGL029
     I                                       51  600TACD6                                     CGL029
     I                                       61  62 TNCD1                                     CGL029
     I                                       63  64 TNCD2                                     CGL029
     I                                       65  66 TNCD3                                     CGL029
     I                                       67  68 TNCD4                                     CGL029
     I                                       69  70 TNCD5                                     CGL029
     I                                       71  72 TNCD6                                     CGL029
     I                                       73  730TPRF1                                     CGL029
     I                                       74  740TPRF2                                     CGL029
     I                                       75  750TPRF3                                     CGL029
     I                                       76  760TPRF4                                     CGL029
     I                                       77  770TPRF5                                     CGL029
     I                                       78  780TPRF6                                     CGL029
      ************                                                        S01315
      ***Data*structure for run time field                                S01315
      ************                                                        S01315
     I************DS                                                      S01315
     I************                            1   60RTIME                 S01315
     I************                            1   20RHOUR                 S01315
     I************                            3   40RMIN                  S01315
     I************                            5   60RSEC                  S01315
      *****************************************************************   S01315
      *
      *  Initial processing
      *
     C                     EXSR INIT
      *
      *  Main processing
      *
     C                     EXSR MAIN
      *
      *  Closing routine
      *
     C                     EXSR CLOS
      *
      *****************************************************************
      *
      *  INIT - Accesses SDBANKPD,INVTPD.
      *       - Initialises output record count.
      *       - Sets up execution time arrays according to contents of
      *         SDBANKPD and LINKD.
      *       - Clears out AKEY data structure.
      *       - Writes out report heading.
      *       - Sets up run time field.
      *       - Checks value of CIAK on SDBANKPD & assigns VMIN and
      *         VMAX accordingly.
      *
      *****************************************************************
     C           INIT      BEGSR
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP1
     C*                         End S01408
      *
     C           *NAMVAR   DEFN           LDA                             S01315
     C           *LOCK     IN   LDA                                       S01315
     C                     MOVEL'AK0061'  DBPGM                           S01315
     C                     OUT  LDA                                       S01315
      *                                                                   S01315
     C** Use access program AOBANKR0 to retrieve header details           S01315
     C*                                                                   S01315
     C                     CALL 'AOBANKR0'                                S01315
     C                     PARM '*DBERR ' @RTCD   7                       S01315
     C                     PARM '*FIRST ' @OPTN   7                       S01315
     C           SDBANK    PARM SDBANK    DSFDY                           S01315
     C*                                                                   S01315
     C                     MOVE *BLANKS   AKEY
     C**********           TIME           RTIME                           S01315
     C*                                                                   S01315
     C** Use access program AOSTRDR0 to retrieve SDSTRDPD Details         S01315
     C*                                                                   S01315
     C                     CALL 'AOSTRDR0'                                S01315
     C                     PARM '*DBERR ' @RTCD   7                       S01315
     C                     PARM '*FIRST ' @OPTN   7                       S01315
     C***********SDSTRD    PARM SDSTRD    DSFDY                    S01315 056357
     C           SDSTRD    PARM SDSTRD    DSSDY                           056357
     C*                                                                   S01315
     C**  Ensure report spool file recorded by RCF                        S01315
     C*                                                                   S01315
     C                     Z-ADDSFNUM     ZSNUM   60                      S01315
     C*                                                                   S01315
     C                     CALL 'ZSFILE'                                  S01315
     C                     PARM           SEQ     5                       S01315
     C                     PARM *BLANKS   SENTY   3                       S01315
     C                     PARM           SFILE                           S01315
     C                     PARM           ZSNUM                           S01315
     C                     PARM           ZSERR   1                       S01315
     C*                                                                   S01315
     C           ZSERR     IFEQ 'Y'                                       S01315
     C*                                                                   S01315
     C**  Error during ZSFILE processing, return to calling program       S01315
     C*                                                                   S01315
     C                     SETON                     U7U8LR               S01315
     C                     RETRN                                          S01315
     C                     END                                            S01315
     C*                                                                   S01315
     C******               EXSR ZICDSE                                    S01315
     C******     *IN99     IFEQ '1'                                       S01315
     C******               SETON                         U7U8LR           S01315
     C******               MOVEL'AK0061'  DBPGM            ************   S01315
     C******               MOVEL'ICD'     DBKEY            * DATABASE *   S01315
     C******               MOVE 'TABTB36' DBFILE           * ERROR 01 *   S01315
     C******               Z-ADD01        DBASE            ************   S01315
     C******               ELSE                                           S01315
      *
     C           1         SETLLLINKDF
     C                     READ LINKDF                   99
     C           1         SETLLLINKDXF                                   100986
     C                     READ LINKDXF                  99               100986
     C********   *IN99     IFEQ '1'
     C********             SETON                         U7U8LR           S01315
     C********   *LOCK     IN   LDA                                       S01315
     C********             MOVEL'SE4010'  DBPGM            ************   S01315
     C********             MOVEL' '       DBKEY            * DATABASE *   S01315
     C********             MOVE 'LINKD'   DBFILE           * ERROR 02 *   S01315
     C********             Z-ADD002       DBASE            ************   S01315
     C********             EXSR DBERR                                     S01315
     C**********           ELSE                                           S01315
     C********             END                                            S01315
      *
     C           IKEY      KLIST
     C                     KFLD           CURR
     C                     KFLD           ITYPA
      *
     C           IKEY      CHAININVTPDF              99
     C********** *IN99     IFEQ '1'
     C********** RECI      ORNE 'D'
     C**********           SETON                         U7U8LR           S01315
     C********** *LOCK     IN   LDA                                       S01315
     C**********           MOVEL'SE4010'  DBPGM
     C**********           MOVE ITYPA     KEYI    6
     C**********           MOVELCURR      KEYI             ************
     C**********           MOVELKEYI      DBKEY            * DATABASE *
     C**********           MOVE 'INVTPD'  DBFILE           * ERROR 03 *
     C**********           Z-ADD003       DBASE            ************   S01315
     C**********           EXSR DBERR                                     S01315
     C*********            ELSE                                           S01315
     C*********            END                                            S01315
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP2
     C*                         End S01408
      *
      ***Set*VMAX*for use in GEN01 routine                                CSE007
      *  Set VMAX for use in GEN01 and GEN02 routines                     CSE007
      *
     C***********CIAK      IFEQ 'Y'                                       S01315
     C           BVCIAK    IFEQ 'Y'                                       S01315
     C                     Z-ADD2         VMAX    10
     C                     ELSE
     C                     Z-ADD1         VMAX
     C                     END
      *
      *  Check 'Include in Account Key' field from S/INVTP.
      *
     C           IINAK     IFEQ 'N'
     C                     MOVE *BLANKS   ITYPA
     C                     END
      *
      **  Access SAR details file to see if S01445 SAR is installed.      S01445
      *                                                                   S01445
     C                     CALL 'AOSARDR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*VERIFY' @OPTN                           S01445
     C                     PARM 'S01445'  @SARD   6                       S01445
      *                                                                   S01445
     C           @RTCD     IFEQ *BLANK                                    S01445
     C                     MOVE 'Y'       S01445  1                       S01445
     C                     ELSE                                           S01445
     C                     MOVE 'N'       S01445                          S01445
     C                     END                                            S01445
      *
      **  Access SAR details file to see if S01447 SAR is installed.      S01447
      *                                                                   S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*VERIFY' @OPTN                           S01447
     C                     PARM 'S01447'  @SARD                           S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     MOVE '1'       *IN09                           S01447
     C                     ELSE                                           S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     END                                            S01447
      *                                                                   S01447
      **  Access SAR details file to see if CSE007 SAR is installed.      CSE007
      *                                                                   CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM *BLANKS   @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD                           CSE007
      *                                                                   CSE007
     C                     MOVE '0'       *IN50                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
      *                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVE '1'       *IN50                           CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE 'N'       CSE007                          CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      **  Access SAR details file to see if CEU017 SAR is installed.      CEU017
      *                                                                   CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM *BLANKS   @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
      *                                                                   CEU017
     C                     MOVE '0'       *IN50                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017  1                       CEU017
      *                                                                   CEU017
     C           BVCOTA    IFEQ 'Y'                                       CEU017
     C                     MOVE '1'       *IN50                           CEU017
     C                     END                                            CEU017
      *                                                                   CEU017
     C                     ELSE                                           CEU017
     C                     MOVE 'N'       CEU017                          CEU017
     C                     END                                            CEU017
      *                                                                   CSE015
      **  Access SAR details file to see if CSE015 SAR is installed.      CSE015
      *                                                                   CSE015
     C                     MOVE 'N'       CSE015                          CSE015
     C                     CALL 'AOSARDR0'                                CSE015
     C                     PARM *BLANKS   PRTCD   7                       CSE015
     C                     PARM '*VERIFY' POPTN   7                       CSE015
     C                     PARM 'CSE015'  PSARD   6                       CSE015
      *                                                                   CSE015
     C           PRTCD     IFEQ *BLANK                                    CSE015
     C                     MOVE 'Y'       CSE015  1                       CSE015
     C                     ELSE                                           CSE015
      *                                                                   CSE015
      ** Database Error (return code other than *NRF)                     CSE015
      *                                                                   CSE015
     C           PRTCD     IFNE '*NRF   '                                 CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     MOVEL'SCSARDPD'DBFILE                          CSE015
     C                     MOVEL'CSE015'  DBKEY                           CSE015
     C                     Z-ADD5         DBASE                           CSE015
     C                     OUT  LDA                                       CSE015
     C                     EXSR *PSSR                                     CSE015
     C                     END                                            CSE015
     C                     END                                            CSE015
      *                                                                   CSE006
      **  Access SAR details file to see if CSE006 SAR is installed.      CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD                           CSE006
      *                                                                   CSE006
     C                     MOVE '0'       *IN50                           CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVE 'Y'       CSE006  1                       CSE006
      *                                                                   CSE006
     C           BVCOTA    IFEQ 'Y'                                       CSE006
     C                     MOVE '1'       *IN50                           CSE006
     C                     END                                            CSE006
      *                                                                   CSE006
     C                     ELSE                                           CSE006
     C                     MOVE 'N'       CSE006                          CSE006
     C                     END                                            CSE006
      *                                                                   CSE023
      **  Access SAR details file to see if CSE023 SAR is installed.      CSE023
      *                                                                   CSE023
     C                     MOVE 'N'       CSE023                          CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   PRTCD                           CSE023
     C                     PARM '*VERIFY' POPTN                           CSE023
     C                     PARM 'CSE023'  PSARD                           CSE023
      *                                                                   CSE023
     C           PRTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** Database Error (return code other than *NRF)                     CSE023
      *                                                                   CSE023
     C           PRTCD     IFNE '*NRF   '                                 CSE023
     C           *LOCK     IN   LDA                                       CSE023
     C                     MOVEL'SCSARDPD'DBFILE                          CSE023
     C                     MOVEL'CSE023'  DBKEY                           CSE023
     C                     Z-ADD6         DBASE                           CSE023
     C                     OUT  LDA                                       CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                                       CGL031
      ** Check if CGL031 is enabled.                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL031'  PSARD                                               CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE '*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     Z-ADD101       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CAS006
      **  Access SAR details file to see if CAS006 SAR is installed.                          CAS006
      *                                                                                       CAS006
     C                     MOVE 'N'       CAS006  1                                           CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM '*VERIFY' POPTN                                               CAS006
     C                     PARM 'CAS006'  PSARD                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006                                              CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** Database Error (return code other than *NRF)                                         CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE '*NRF   '                                                     CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
     C                     MOVEL'CAS006'  DBKEY                                               CAS006
     C                     Z-ADD7         DBASE                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS007
      **  Access SAR details file to see if CAS007 SAR is installed.                          CAS007
      *                                                                                       CAS007
     C                     MOVE 'N'       CAS007  1                                           CAS007
     C                     CALL 'AOSARDR0'                                                    CAS007
     C                     PARM *BLANKS   PRTCD                                               CAS007
     C                     PARM '*VERIFY' POPTN                                               CAS007
     C                     PARM 'CAS007'  PSARD                                               CAS007
      *                                                                                       CAS007
     C           PRTCD     IFEQ *BLANK                                                        CAS007
     C                     MOVE 'Y'       CAS007                                              CAS007
     C                     ELSE                                                               CAS007
      *                                                                                       CAS007
      ** Database Error (return code other than *NRF)                                         CAS007
      *                                                                                       CAS007
     C           PRTCD     IFNE '*NRF   '                                                     CAS007
     C           *LOCK     IN   LDA                                                           CAS007
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS007
     C                     MOVEL'CAS007'  DBKEY                                               CAS007
     C                     Z-ADD8         DBASE                                               CAS007
     C                     OUT  LDA                                                           CAS007
     C                     EXSR *PSSR                                                         CAS007
     C                     ENDIF                                                              CAS007
     C                     ENDIF                                                              CAS007
      *                                                                                       CSE065
      ** Access SAR details file to see if CSE065 is installed.                               CSE065
      *                                                                                       CSE065
     C                     MOVE 'N'       CSE065  1                                           CSE065
     C                     CALL 'AOSARDR0'                                                    CSE065
     C                     PARM *BLANKS   @RTCD                                               CSE065
     C                     PARM '*VERIFY' @OPTN                                               CSE065
     C                     PARM 'CSE065'  WSARD   6                                           CSE065
      *                                                                                       CSE065
     C           PRTCD     IFEQ *BLANK                                                        CSE065
     C                     MOVE 'Y'       CSE065                                              CSE065
     C                     ELSE                                                               CSE065
      *                                                                                       CSE065
      ** Database Error (return code other than *NRF)                                         CSE065
      *                                                                                       CSE065
     C           PRTCD     IFNE '*NRF   '                                                     CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE065
     C                     MOVEL'CSE065'  DBKEY                                               CSE065
     C                     Z-ADD9         DBASE                                               CSE065
     C                     OUT  LDA                                                           CSE065
     C                     EXSR *PSSR                                                         CSE065
     C                     ENDIF                                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                   CEU017
      **  Access Module details to see if Analytical Acctg is installed   CAC002
      *                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM '*DBERR ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
      *                                                                   CAC002
      *  Initialise output record count and set up execution time arrays.
      *
     C                     Z-ADD0         OUTREC  60
     C                     Z-ADD0         L       10
     C                     Z-ADD3         RQDLN1  20
     C                     EXSR STINIT
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR CSINIT                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     EXSR MKINIT
     C                     EXSR BKINIT
     C                     EXSR CCINIT
     C                     EXSR AMINIT
     C                     EXSR DSINIT
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C                     EXSR CYINIT                                    S01447
     C                     END                                            S01447
      *
      *  Write report header
      *
     C***********          WRITESE4010HF                                  S01315
     C                     WRITEAK0061HF                                  S01315
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP3
     C*                         End S01408
      *
     C*******              END                                            S01315
     C*******              END                                            S01315
     C*******              END                                            S01315
      *
     C                     ENDSR
      *****************************************************************
      *
      *  MAIN - Sets up a loop to call amount code routines for
      *         each event code held in compile-time array EVT.
      *
      *****************************************************************
     C           MAIN      BEGSR
      *                                                                   S01447
     C                     Z-ADD*ZERO     CYMIN   10                      S01447
     C                     Z-ADD1         CYMAX   20                      S01447
      *                                                                   S01447
     C                     Z-ADD0         X
      *
     C*********  X         DOUEQ10                                        CSE007
     C/COPY WNCPYSRC,AK0061C011
     C           X         DOUEQ11                                        CSE007
      *
     C                     ADD  1         X
     C                     MOVE EVT,X     ETYPA
      *
      *  F V  ( F A C E   V A L U E )  K E Y S
      *
     C                     MOVE 'FV'      ATYPA
      *
      *  Not produced for commodities, shares, or unit trusts on trade date,
      *  value date,settlement date,depot movement date, mortgage repayment
      *  date or maturity date.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C/COPY WNCPYSRC,AK0061C001
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C           ETYPA     OREQ 'S'
     C                     EXSR FV01
     C                     END
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR FV02
      *                                                                   CSE007
      *  If Feature 'CSE007' ON and Trade subtypes in CA Account Keys 'Y' CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           BVCOTA    ANDEQ'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           BVCOTA    ANDEQ'Y'                                       CEU017
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'FV', Event Type 'L', Customer WI/WO                  CSE007
      *                                                                   CSE007
     C                     EXSR FV02CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     ELSE
     C           ETYPA     IFEQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR FV03
     C                     END
     C                     END
      *
     C           ETYPA     IFEQ 'M'
     C                     EXSR FV04
     C                     END
      *
     C                     END
      *
      *  Need to produce a client contingent liabilty face value key on
      *  trade or value date if specified on investment type, and ICD
      *  parameter SKTD set accordingly. Not required for
      *  Commodities, Shares or Unit Trusts.
      *
     C           ETYPA     IFEQ 'T'                                AK0009
     C***********SKTD      ANDNE'T'                                AK0009 S01315
     C           BVSKTV    ANDNE'T'                                       S01315
     C***********ETYPA     IFEQ 'V'                                AK0009 S01315
     C           ETYPA     OREQ 'V'                                       S01315
     C***********SKTD      ANDNE'V'                                AK0009 S01315
     C           BVSKTV    ANDNE'V'                                       S01315
     C***********DCNL      ANDEQ'Y'                                       AK0009
     C           DCNL      IFEQ 'Y'                                       AK0009
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C/COPY WNCPYSRC,AK0061C002
     C                     EXSR FV05
     C                     END
     C                     END                                            AK0009
     C                     END
      *
      *  C O  ( C O N S I D E R A T I O N )  K E Y S
      *
     C                     MOVE 'CO'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C           ETYPA     OREQ 'S'
     C                     EXSR CO01
     C                     ELSE
     C           ETYPA     IFEQ 'R'
     C           PROT      ANDEQ'8'
     C           ETYPA     OREQ 'M'
     C           PROT      ANDNE'2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR CO02
     C                     END
     C                     END
      *
      *  C V  ( C O U N T E R V A L U E - S E T T. C U R R E N C Y )  K E Y S
      *
     C                     MOVE 'CV'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C           ETYPA     OREQ 'S'
     C                     EXSR CV01
     C                     ELSE
     C           ETYPA     IFEQ 'M'
     C           PROT      ANDNE'2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR CV02
     C                     END
     C                     END
      *
      *  C N  ( C O U N T E R V A L U E - N O M. C U R R E N C Y )  K E Y S
      *
     C                     MOVE 'CN'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR CN01
     C                     END
      *
      *  F P  ( C H A R G E S   P A Y A B L E )  K E Y S
      *
     C                     MOVE 'FP'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
      *
      *  Subroutines FC01 & FC02 are used for FP,FR,CP & CR keys as these
      *  keys are all of the same general form.
      *
     C                     EXSR FC01
     C                     ELSE
      *
      *  No Coupon-Date/Maturity keys if Commodities, Shares or Unit
      *  Trusts.
      *
     C           ETYPA     IFEQ 'C'
     C           ETYPA     OREQ 'M'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No Dividend-Date keys if not Shares or Unit Trusts
      *
     C           ETYPA     IFEQ 'H'
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No way of checking for partly-paids, as this is indicated on
      *  individual securities, so produce all keys.
      *
     C           ETYPA     IFEQ 'P'
     C           ETYPA     OREQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR FC02
     C                     END
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'FP', Event Type 'X', Charges Payable                 CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ETYPA     OREQ 'X'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     EXSR FC02CO                                    CSE007
     C                     END                                            CSE007
      *
     C                     END
      *
      *  F R  ( C H A R G E S   R E C E I V A B L E )  K E Y S
      *
     C                     MOVE 'FR'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR FC01
     C                     ELSE
      *
      *  No Coupon-Date/Maturity keys if Commodities, Shares or Unit
      *  Trusts.
      *
     C           ETYPA     IFEQ 'C'
     C           ETYPA     OREQ 'M'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No Dividend-Date keys if not Shares or Unit Trusts
      *
     C           ETYPA     IFEQ 'H'
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No way of checking for partly-paids, as this is indicated on
      *  individual securities, so produce all keys.
      *
     C           ETYPA     IFEQ 'P'
     C           ETYPA     OREQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR FC02
     C                     END
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'FR', Event Type 'X', Charges Receivable              CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ETYPA     OREQ 'X'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     EXSR FC02CO                                    CSE007
     C                     END                                            CSE007
      *
     C                     END
      *                                                                   S01445
      *** Setup Depot Movement account keys  - Charges receivable         S01445
      *                                                                   S01445
     C           S01445    IFEQ 'Y'                                       S01445
     C                     MOVE 'FR'      ATYPA                           S01445
      *                                                                   S01445
     C           ETYPA     IFEQ 'L'                                       S01445
     C                     EXSR FC03                                      S01445
     C                     END                                            S01445
     C                     END                                            S01445
      *
      *  C P  ( C O M M I S S I O N   P A Y A B L E )  K E Y S
      *
     C                     MOVE 'CP'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR FC01
     C                     ELSE
      *
      *  No Coupon-Date/Maturity keys if Commodities, Shares or Unit
      *  Trusts.
      *
     C           ETYPA     IFEQ 'C'
     C           ETYPA     OREQ 'M'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No Dividend-Date keys if not Shares or Unit Trusts
      *
     C           ETYPA     IFEQ 'H'
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No way of checking for partly-paids, as this is indicated on
      *  individual securities, so produce all keys.
      *
     C           ETYPA     IFEQ 'P'
     C           ETYPA     OREQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR FC02
     C                     END
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'CP', Event Type 'X', Commission Payable              CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ETYPA     OREQ 'X'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     EXSR FC02CO                                    CSE007
     C                     END                                            CSE007
      *
     C                     END
      *
      *  C R  ( C O M M I S S I O N   R E C E I V A B L E )  K E Y S
      *
     C                     MOVE 'CR'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR FC01
     C                     ELSE
      *
      *  No Coupon-Date/Maturity keys if Commodities, Shares or Unit
      *  Trusts.
      *
     C           ETYPA     IFEQ 'C'
     C           ETYPA     OREQ 'M'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No Dividend-Date keys if not Shares or Unit Trusts
      *
     C           ETYPA     IFEQ 'H'
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     EXSR FC02
     C                     END
     C                     END
      *
      *  No way of checking for partly-paids, as this is indicated on
      *  individual securities, so produce all keys.
      *
     C           ETYPA     IFEQ 'P'
     C           ETYPA     OREQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR FC02
     C                     END
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'CR', Event Type 'X', Commission Receivable           CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ETYPA     OREQ 'X'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     EXSR FC02CO                                    CSE007
     C                     END                                            CSE007
      *
     C                     END
      *
      *  R E  ( R E A L L O W A N C E   P A Y A B L E )  K E Y S
      *
      *  Both RE & RR keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *
     C                     MOVE 'RE'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR RERR01
     C                     END
      *
      *  R R  ( R E A L L O W A N C E   R E C E I V A B L E )  K E Y S
      *
     C                     MOVE 'RR'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR RERR01
     C                     END
      *
      *  P I  ( P U R C H A S E   I N T E R E S T )  K E Y S
      *
     C                     MOVE 'PI'      ATYPA
      *
      *  Not produced for Commodities, Shares, Schuldschein or
      *  Unit Trusts.
      *  Not produced for any processing type if Discount trade basis.    AK0006
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'7'
      *
     C           ETYPA     IFEQ 'T'
     C                     EXSR PI01
     C                     ELSE
     C           ETYPA     IFEQ 'V'
     C                     EXSR PI02
     C                     ELSE
     C           ETYPA     IFEQ 'C'
     C                     EXSR PI03
     C                     END
     C                     END
     C                     END
      *
     C                     END
      *                                                                   AK0006
     C                     END                                            AK0006
      *
      *  The criteria for producing DS,PR,DA,& PA keys are that none
      *  should be generated for Commodities, Shares or Unit Trusts.
      *  i.e. not for processing types 2,4, or 7.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
      *
      *  D S  ( D I S C O U N T   O N   T R A D E )  K E Y S
      *
      *  Both DS & PR keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *
     C                     MOVE 'DS'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR DSPR01
     C                     END
      *
      *  P R  ( P R E M I U M   O N   T R A D E )  K E Y S
      *
     C                     MOVE 'PR'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR DSPR01
     C                     END
      *
      *  D A  ( A M O R T I Z E D   D I S C O U N T   T O   P O S T )  K E Y S
      *
      *  Both DA & PA keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *
     C                     MOVE 'DA'      ATYPA
      *
     C           ETYPA     IFEQ 'A'
     C                     EXSR DAPA01
     C/COPY WNCPYSRC,AK0061C007
     C                     END
     C/COPY WNCPYSRC,AK0061C005
      *
      *  P A  ( A M O R T I Z E D   P R E M I U M   T O   P O S T )  K E Y S
      *
     C                     MOVE 'PA'      ATYPA
      *
     C           ETYPA     IFEQ 'A'
     C                     EXSR DAPA01
     C/COPY WNCPYSRC,AK0061C008
     C                     END
     C/COPY WNCPYSRC,AK0061C006
      *
     C                     END
      *
      *  R P  ( R E A L I S E D   P R O F I T )  K E Y S
      *
      *  Both RP & RL keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *
     C                     MOVE 'RP'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR RPL01
     C                     END
      *
      *  RP/RL keys on mortgage repayment date only necessary for
      *  processing type 8.
      *
     C           ETYPA     IFEQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR RPL01
     C                     END
      *
      *  R L  ( R E A L I S E D   L O S S )  K E Y S
      *
     C                     MOVE 'RL'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     EXSR RPL01
     C                     END
      *
      *  RP/RL keys on mortgage repayment date only necessary for
      *  processing type 8.
      *
     C           ETYPA     IFEQ 'R'
     C           PROT      ANDEQ'8'
     C                     EXSR RPL01
     C                     END
      *
      *  U P  ( U N R E A L I S E D   P R O F I T )  K E Y S
      *
      *  Both UP & UL keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *
     C                     MOVE 'UP'      ATYPA
      *
     C           ETYPA     IFEQ 'A'
     C                     EXSR UPL01
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           CAS007    ANDEQ'Y'                                                           CAS007
      *                                                                                       CAS006
      ** I P  ( E F F E C T I V E   H E D G E   P R O F I T)  K E Y S                         CAS006
      *                                                                                       CAS006
     C                     MOVE 'IP'      ATYPA                                               CAS006
      *                                                                                       CAS006
     C           ETYPA     IFEQ 'A'                                                           CAS006
     C                     EXSR HPL01                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** X P  ( I N E F F E C T I V E   H E D G E   P R O F I T)  K E Y S                     CAS006
      *                                                                                       CAS006
     C                     MOVE 'XP'      ATYPA                                               CAS006
      *                                                                                       CAS006
     C           ETYPA     IFEQ 'A'                                                           CAS006
     C                     EXSR HPL01                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *
      *  U P  ( U N R E A L I S E D   L O S S )  K E Y S
      *
     C                     MOVE 'UL'      ATYPA
      *
     C           ETYPA     IFEQ 'A'
     C                     EXSR UPL01
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           CAS007    ANDEQ'Y'                                                           CAS007
      *                                                                                       CAS006
      ** I L  ( E F F E C T I V E   H E D G E   L O S S)  K E Y S                             CAS006
      *                                                                                       CAS006
     C                     MOVE 'IL'      ATYPA                                               CAS006
      *                                                                                       CAS006
     C           ETYPA     IFEQ 'A'                                                           CAS006
     C                     EXSR HPL01                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** X L  ( I N E F F E C T I V E   H E D G E   L O S S)  K E Y S                         CAS006
      *                                                                                       CAS006
     C                     MOVE 'XL'      ATYPA                                               CAS006
      *                                                                                       CAS006
     C           ETYPA     IFEQ 'A'                                                           CAS006
     C                     EXSR HPL01                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP4
     C*                         End S01408
      *
      *  S A  ( S E T T L E M E N T   A M O U N T )  K E Y S
      *
     C                     MOVE 'SA'      ATYPA
      *
     C           ETYPA     IFEQ 'S'
     C                     EXSR SA01
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'SA', Event Type 'S', Settlement Amount               CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR SA01CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     END
      *
      *  D F  ( D I S C R E P A N C Y  -  U S E R 'S   F A V O U R )  K E Y S
      *
      *  Both DF & DN keys generated from the same 2nd-level routines
      *  as they are of the same form.
      *
     C                     MOVE 'DF'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
      *
      *  Only required for interest-bearing securities on trade/value date
      *  And not at all on these dates if Discount trade basis.           AK0006
      *  And not at all on these dates if Schuldschein.                   AK0013
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'                                       AK0013
     C           PROT      ANDNE'7'
     C                     EXSR DFN01
     C                     END
     C                     END                                            AK0006
     C                     END
      *
     C           ETYPA     IFEQ 'S'
     C                     EXSR DFN01
     C                     ELSE
     C           ETYPA     IFEQ 'C'
      *
      *  Only required for interest-bearing securities on coupon date.
      *  And not at all on this date if Discount trade basis.             AK0006
      *  And not at all on this date if Schuldschein.                     AK0013
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'                                       AK0013
     C           PROT      ANDNE'7'
      *
     C                     EXSR DFN02
     C                     END
     C                     END                                            AK0006
     C                     END
     C                     END
      *
      *  D N  ( D I S C R E P A N C Y  -  N O T   U S E R'S   F A V O U R )
      *
     C                     MOVE 'DN'      ATYPA
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
      *
      *  Only required for interest-bearing securities on trade/value date
      *  And not at all on these dates if Discount trade basis.           AK0006
      *  And not at all on these dates if Schuldschein.                   AK0013
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'                                       AK0013
     C           PROT      ANDNE'7'
     C                     EXSR DFN01
     C                     END
     C                     END                                            AK0006
     C                     END
      *
     C           ETYPA     IFEQ 'S'
     C                     EXSR DFN01
     C                     ELSE
     C           ETYPA     IFEQ 'C'
      *
      *  Only required for interest-bearing securities on coupon date.
      *  And not at all on this date if Discount trade basis.             AK0006
      *  And not at all on this date if Schuldschein.                     AK0013
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'                                       AK0013
     C           PROT      ANDNE'7'
      *
     C                     EXSR DFN02
     C                     END
     C                     END                                            AK0006
     C                     END
     C                     END
      *
      *  A I  ( A.I.R.  T O   P O S T )  K E Y S
      *
     C                     MOVE 'AI'      ATYPA
      *
      *  Not required for non interest-bearing securities.
      *  And not at all if Discount trade basis.                          AK0006
      *
     C           TRBS      IFNE 'D'                                       AK0006
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
      *
     C           ETYPA     IFEQ 'V'
     C                     EXSR AI01
     C                     ELSE
     C           ETYPA     IFEQ 'A'
     C           ETYPA     OREQ 'C'
     C                     EXSR AI02
     C                     END
     C                     END
      *
     C                     END
     C                     END                                            AK0006
      *
      *  P P  ( P A R T L Y   P A I D   D U E )  K E Y S
      *
     C                     MOVE 'PP'      ATYPA
      *
      *  Not required for Commodities, Schuldschein, Unit Trusts or
      *  Mortgage-Backs. i.e. processing types 2,6,7 & 8.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'7'
     C           PROT      ANDNE'8'
      *
     C           ETYPA     IFEQ 'P'
     C                     EXSR PP01
     C                     ELSE
     C           ETYPA     IFEQ 'S'
     C                     EXSR PP02
     C                     END
     C                     END
      *
     C                     END
      *
      *  D I  ( I N T E R E S T / D I V I D E N D   D U E )  K E Y S
      *
     C                     MOVE 'DI'      ATYPA
      *
      *  Only required for Shares on dividend date, and
      *  only for interest-bearing securities on coupon date.
      *  And not at all if Discount trade basis.                          AK0006
      *
     C           TRBS      IFNE 'D'                                       AK0006
      *
     C           ETYPA     IFEQ 'H'
      *
     C           PROT      IFEQ '4'
     C                     EXSR DI01
     C                     END
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'DI', Event Type 'H', 1. Cash Income Due - User       CSE007
      *                                   2. Cash Income Due - Cust/Depot CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR DI01CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      *
     C                     ELSE
     C           ETYPA     IFEQ 'C'
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR DI02
     C                     END
      *
     C                     ELSE
     C           ETYPA     IFEQ 'S'
     C                     EXSR DI03
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'DI', Event Type 'S', Income Amount Due               CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     EXSR DI03CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     END
     C                     END
     C                     END
      *
     C                     END                                            AK0006
      *                                                                   CSE007
      *  S D  ( C A S H   I N C O M E   D U E  -  U S E R )  K E Y S      CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     MOVE 'SD'      ATYPA                           CSE007
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'SD', Event Type 'H', Stock Income Due - User         CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'H'                                       CSE007
     C                     EXSR DI01CO                                    CSE007
     C                     END                                            CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      *  C D  ( C A S H   A M O U N T   D U E )  K E Y S                  CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     MOVE 'CD'      ATYPA                           CSE007
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'CD', Event Type 'X', 1. Cash Amount Due - User       CSE007
      *                                   2. Cash Amount Due - Cust/Depot CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C                     EXSR DI01CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'CD', Event Type 'S', Cash Amount Due                 CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'S'                                       CSE007
     C                     EXSR DI03CO                                    CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     END                                            CSE007
      *
      *  M R  ( M O R T G A G E   R E P A Y M E N T )  K E Y S
      *
     C                     MOVE 'MR'      ATYPA
      *
      *  Processing type 8 ONLY.
      *
     C           ETYPA     IFEQ 'S'
     C           PROT      ANDEQ'8'
     C                     EXSR MR01
     C                     END
      *
      *  B L  ( B O N D   L E N D I N G )  K E Y S
      *
      *  BL,BB,RA, & RV keys generated from the same 2nd-level routine
      *  as they are of the same form.
      *  These keys are only required for interest-bearing securities.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
      *
     C                     MOVE 'BL'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
      *  B B  ( B O N D   B O R R O W I N G )  K E Y S
      *
     C                     MOVE 'BB'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
      *  R A  ( R E P U R C H A S E   A G R E E M E N T )  K E Y S
      *
     C                     MOVE 'RA'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
      *  R V  ( R E V E R S E   R E P O )  K E Y S
      *
     C                     MOVE 'RV'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
      *  P L  ( P L E D G E   L O A N )  K E Y S
      *
     C                     MOVE 'PL'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
      *  P D  ( P L E D G E   D E P O S I T )  K E Y S
      *
     C                     MOVE 'PD'      ATYPA
      *
     C           ETYPA     IFEQ 'L'
     C                     EXSR ZZ01
     C                     END
      *
     C                     END
      *
      *** If withholding tax SAR installed, then if conditions correct,   S01447
      *** generate tax keys                                               S01447
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C           ETYPA     IFEQ 'C'                                       S01447
     C           PROT      ANDNE'2'                                       S01447
     C           PROT      ANDNE'4'                                       S01447
     C           PROT      ANDNE'7'                                       S01447
     C           ETYPA     OREQ 'H'                                       S01447
     C           PROT      ANDEQ'4'                                       S01447
      *                                                                   S01447
      *** WHT deducted at source - refundable                             S01447
      *                                                                   S01447
     C                     MOVE 'WR'      ATYPA                           S01447
     C                     EXSR WTAXK                                     S01447
      *                                                                   S01447
      *** WHT deducted at source - NOT refundable                         S01447
      *                                                                   S01447
     C                     MOVE 'WN'      ATYPA                           S01447
     C                     EXSR WTAXK                                     S01447
      *                                                                   S01447
      *** WHT deducted by user - NOT refundable                           S01447
      *                                                                   S01447
     C                     MOVE 'WD'      ATYPA                           S01447
     C                     EXSR WTAXK                                     S01447
     C/COPY WNCPYSRC,AK0061C014
      *                                                                   S01447
      *** WHT deducted by user - refundable                               S01447
      *                                                                   S01447
     C                     MOVE 'WX'      ATYPA                           S01447
     C                     EXSR WTAXK                                     S01447
     C                     END                                            S01447
      *                                                                   CSE007
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'WN', 'WR', 'WX' or 'WD'; Event Type 'X'              CSE007
      *                                                                   CSE007
     C           ETYPA     IFEQ 'X'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           ETYPA     OREQ 'X'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
      *                                                                   CSE007
      *** WHT deducted at source - refundable                             CSE007
      *                                                                   CSE007
     C                     MOVE 'WR'      ATYPA                           CSE007
     C                     EXSR WTAXCO                                    CSE007
      *                                                                   CSE007
      *** WHT deducted at source - NOT refundable                         CSE007
      *                                                                   CSE007
     C                     MOVE 'WN'      ATYPA                           CSE007
     C                     EXSR WTAXCO                                    CSE007
      *                                                                   CSE007
      *** WHT deducted by user - NOT refundable                           CSE007
      *                                                                   CSE007
     C                     MOVE 'WD'      ATYPA                           CSE007
     C                     EXSR WTAXCO                                    CSE007
      *                                                                   CSE007
      *** WHT deducted by user - refundable                               CSE007
      *                                                                   CSE007
     C                     MOVE 'WX'      ATYPA                           CSE007
     C                     EXSR WTAXCO                                    CSE007
     C                     END                                            CSE007
     C                     END                                            S01447
      *                                                                                       CGL031
      ** Generate EU Withholding Tax a/c keys if necessary.                                   CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           S01447    ANDEQ'Y'                                                           CGL031
     C           ETYPA     IFEQ 'C'                                                           CGL031
     C           PROT      ANDNE'2'                                                           CGL031
     C           PROT      ANDNE'4'                                                           CGL031
     C           PROT      ANDNE'7'                                                           CGL031
     C           ETYPA     OREQ 'M'                                                           CGL031
     C           PROT      ANDNE'2'                                                           CGL031
     C           PROT      ANDNE'4'                                                           CGL031
     C           PROT      ANDNE'7'                                                           CGL031
     C           ETYPA     OREQ 'H'                                                           CGL031
     C           PROT      ANDEQ'4'                                                           CGL031
     C           ETYPA     OREQ 'H'                                                           CGL031
     C           PROT      ANDEQ'7'                                                           CGL031
     C           ETYPA     OREQ 'R'                                                           CGL031
     C           PROT      ANDEQ'8'                                                           CGL031
      *                                                                                       CGL031
     C                     MOVE ETYPA     WTYPA   1                                           CGL031
     C                     MOVE 'E'       ETYPA                                               CGL031
      *                                                                                       CGL031
      ** European Withholding Tax                                                             CGL031
      *                                                                                       CGL031
     C                     MOVE 'ET'      ATYPA                                               CGL031
     C                     EXSR SRGNET                                                        CGL031
      *                                                                                       CGL031
      ** Net Interest Due                                                                     CGL031
      *                                                                                       CGL031
     C                     MOVE 'NI'      ATYPA                                               CGL031
     C                     EXSR SRGNNI                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE WTYPA     ETYPA                                               CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   CSE023
      **  B W  ( B A C K - U P  W I T H H O L D I N G  T A X )  K E Y S   CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           ETYPA     ANDEQ'T'                                       CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           ETYPA     ANDEQ'V'                                       CSE023
     C                     MOVE 'BW'      ATYPA                           CSE023
     C                     EXSR SRBACK                                    CSE023
     C                     ENDIF                                          CSE023
      *                                                                   S01447
      **  If Analytical Accounting module is installed, generate          CAC002
      **  new Margin Amount account keys                                  CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  M V  ( M A R G I N   A M T  -  T R A D E S )  K E Y S           CAC002
      *                                                                   CAC002
     C                     MOVE 'MV'      ATYPA                           CAC002
     C           ETYPA     IFEQ 'T'                                       CAC002
     C           ETYPA     OREQ 'V'                                       CAC002
     C                     EXSR MV01                                      CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  M A  ( M A R G I N   A M T  -  P O S N  S E T T )  K E Y S      CAC002
      *                                                                   CAC002
     C                     MOVE 'MA'      ATYPA                           CAC002
     C           ETYPA     IFEQ 'S'                                       CAC002
     C                     EXSR MA01                                      CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CSE006
      **  If Switchable feature CSE006 (Repos enhancement) is on          CSE006
      **  then generate the new consideration keys for Repos, bond        CSE006
      **  lending and pledge loans.                                       CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
      *                                                                   CSE006
      **  R C   ( R E V E R S E   R E P O )  K E Y S                      CSE006
      *                                                                   CSE006
     C                     MOVE 'RC'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  P C   ( R E P O )  K E Y S                                      CSE006
      *                                                                   CSE006
     C                     MOVE 'PC'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  L C   ( B O N D  L E N D I N G )  K E Y S                       CSE006
      *                                                                   CSE006
     C                     MOVE 'LC'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  B C   ( B O N D  B O R R O W I N G )  K E Y S                   CSE006
      *                                                                   CSE006
     C                     MOVE 'BC'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  C L   ( P L E D G E  L O A N )  K E Y S                         CSE006
      *                                                                   CSE006
     C                     MOVE 'CL'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  C D   ( P L E D G E  D E P O S I T )  K E Y S                   CSE006
      *                                                                   CSE006
     C                     MOVE 'CD'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  F R   ( C H A R G E S  R E C I E V A B L E)  K E Y S            CSE006
      **  for Bond Lending                                                CSE006
      *                                                                   CSE006
     C                     MOVE 'FR'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  F P   ( C H A R G E S  P A Y A B L E)  K E Y S                  CSE006
      **  for Bond Borrowing                                              CSE006
      *                                                                   CSE006
     C                     MOVE 'FP'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'L'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  Both RP & RL keys generated from the same 2nd-level routine    CSE006
      ***  because they are of the same form.                             CSE006
      *                                                                   CSE006
      **  R P  ( R E A L I S E D   P R O F I T )  K E Y S                 CSE006
      **  for Buy-Sell trades                                             CSE006
      *                                                                   CSE006
     C                     MOVE 'RP'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'A'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      **  R L  ( R E A L I S E D   L O S S)  K E Y S                      CSE006
      **  for Buy-Sell trades                                             CSE006
      *                                                                   CSE006
     C                     MOVE 'RL'      ATYPA                           CSE006
     C           ETYPA     IFEQ 'A'                                       CSE006
     C                     EXSR RC01                                      CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C/COPY WNCPYSRC,AK0061C015
      *                                                                   CAC002
      ** Generate additional Account keys if CSE065 is on and Processing                      CSE065
      ** Type is not 2, 4 & 7.                                                                CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
      *                                                                                       CSE065
     C           ETYPA     IFEQ 'V'                                                           CSE065
     C           PROT      ANDNE'2'                                                           CSE065
     C           PROT      ANDNE'4'                                                           CSE065
     C           PROT      ANDNE'7'                                                           CSE065
      ** Book Cost Increase                                                                   CSE065
     C                     MOVE 'BI'      ATYPA                                               CSE065
     C                     EXSR SRBKEQ                                                        CSE065
      ** Book Cost Decrease                                                                   CSE065
     C                     MOVE 'BD'      ATYPA                                               CSE065
     C                     EXSR SRBKEQ                                                        CSE065
      ** Equity Increase                                                                      CSE065
     C                     MOVE 'EI'      ATYPA                                               CSE065
     C                     EXSR SRBKEQ                                                        CSE065
      ** Equity Decrease                                                                      CSE065
     C                     MOVE 'ED'      ATYPA                                               CSE065
     C                     EXSR SRBKEQ                                                        CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     END
      *  Generate Account Keys for Corporate Actions                      CSE007
      *  Event Code 'MA', Event Type 'S', Margin Amount                   CSE007
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      **  M A  ( M A R G I N   A M T  -  P O S N  S E T T )  K E Y S      CSE007
      *                                                                   CSE007
     C                     MOVE 'MA'      ATYPA                           CSE007
     C           ETYPA     IFEQ 'S'                                       CSE007
     C                     EXSR SA01CO                                    CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C/COPY WNCPYSRC,AK0061C003
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  CLOS - Closing routine.
      ********-*Add*record*count*OUTREC*into*file*control*total           E22490
      **********on*XSEACKA.                                               E22490
      *       - Write end of report details.
      *       - Terminate program with LR.
      *
      *****************************************************************
     C           CLOS      BEGSR
      *
     C*********************READ XSEACKAF                 99               E22490
      *
     C************IN99     IFEQ '0'                                       E22490
     C***********OUTREC    ADD  SINS      SINS                            E22490
     C***********OUTREC    ADD  NORE      NORE                            E22490
     C*********************UPDATXSEACKAF                                  E22490
      *                                                                   AK0003
      *  Write out remaining contents of LIN array at end of program.     AK0003
      *                                                                   AK0003
     C                     MOVE LIN,1     KEY1                            AK0003
     C                     MOVE LIN,2     KEY2                            AK0003
     C                     MOVE LIN,3     KEY3                            AK0003
     C                     MOVE LIN,4     KEY4                            AK0003
     C                     MOVE LIN,5     KEY5                            AK0003
     C           OFLLN1    SUB  PRTLN1    DIFLN1                          AK0003
     C           DIFLN1    IFLE RQDLN1                                    AK0003
     C***********          WRITESE4010HF                            AK0003S01315
     C***********          WRITESE4010DF                            AK0003S01315
     C                     WRITEAK0061HF                                  S01315
     C                     WRITEAK0061DF                                  S01315
     C                     ELSE                                           AK0003
     C***********          WRITESE4010DF                            AK0003S01315
     C                     WRITEAK0061DF                                  S01315
     C                     END                                            AK0003
      *                                                                   AK0003
     C           OUTREC    IFGT 0
     C***********          WRITESE4010HF                                  S01315
     C                     WRITEAK0061HF                                  S01315
     C                     END
     C*
     C***********          WRITESE4010TF                                  S01315
     C                     WRITEAK0061TF                                  S01315
     C                     WRITEENDREP                                    S01315
      *
     C*********************ELSE                                           E22490
      *
     C*********************SETON                         U7U8LR           E22490
     C*********************MOVEL'SE4010'  DBPGM            ************   E22490
     C*********************MOVEL'AUDIT'   DBKEY            * DATABASE *   E22490
     C*********************MOVE 'XSEACKA' DBFILE           * ERROR 04 *   E22490
     C*********************Z-ADD04        DBASE            ************   E22490
     C*********************END                                            E22490
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      *
      *  STINIT - Sets up STP array of posting basis/subtypes using
      *           values of TP1,2,3 etc. read in from PF/LINKD.
      *           Assigns SMAXSV - no. of elements in array saved for
      *           use in later routines.
      *
      *****************************************************************
     C           STINIT    BEGSR
      *
      *  Set up blank 1st element + the two unrealised P/L posting bases.
      *
     C                     MOVE *BLANKS   STP,1
     C                     MOVE 'T '      STP,2
     C                     MOVE 'V '      STP,3
     C                     Z-ADD3         X       20
      *
      *  Only want to perform next part if subtypes required on keys.
      *
     C***********TSAK      IFEQ 'Y'                                       S01315
     C           BVTSAK    IFEQ 'Y'                                       S01315
      *
     C           TP1       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE TP1       STP,X
     C                     END
     C           TP2       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE TP2       STP,X
     C                     END
     C           TP3       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE TP3       STP,X
     C                     END
     C           TP4       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE TP4       STP,X
     C                     END
     C           TP5       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE TP5       STP,X
     C                     END
      *
     C                     END
      *
     C                     Z-ADDX         SMAXSV  20
     C                     ENDSR
      *
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  CSINIT - Sets up CST array of posting basis/subtypes using       CSE007
      *           values of TPCO1,2,3 etc. read in from PF/LINKD.         CSE007
      *           Assigns SMAXSV - no. of elements in array saved for     CSE007
      *           use in later routines.                                  CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           CSINIT    BEGSR                                          CSE007
      *                                                                   CSE007
      *  Set up blank 1st element + the two unrealised P/L posting bases. CSE007
      *                                                                   CSE007
     C                     MOVE *BLANKS   CST,1                           CSE007
     C                     MOVE 'T '      CST,2                           CSE007
     C                     MOVE 'V '      CST,3                           CSE007
     C                     Z-ADD3         X       20                      CSE007
      *                                                                   CSE007
      *  Only want to perform next part if subtypes required on keys.     CSE007
      *                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
      *                                                                   CSE007
     C           TPCO1     IFNE *BLANKS                                   CSE007
     C                     ADD  1         X                               CSE007
     C                     MOVE TPCO1     CST,X                           CSE007
     C                     END                                            CSE007
     C           TPCO2     IFNE *BLANKS                                   CSE007
     C                     ADD  1         X                               CSE007
     C                     MOVE TPCO2     CST,X                           CSE007
     C                     END                                            CSE007
     C           TPCO3     IFNE *BLANKS                                   CSE007
     C                     ADD  1         X                               CSE007
     C                     MOVE TPCO3     CST,X                           CSE007
     C                     END                                            CSE007
     C           TPCO4     IFNE *BLANKS                                   CSE007
     C                     ADD  1         X                               CSE007
     C                     MOVE TPCO4     CST,X                           CSE007
     C                     END                                            CSE007
     C           TPCO5     IFNE *BLANKS                                   CSE007
     C                     ADD  1         X                               CSE007
     C                     MOVE TPCO5     CST,X                           CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     Z-ADDX         COMAXS  20                      CSE007
     C                     ENDSR                                          CSE007
      *                                                                   CSE007
      *****************************************************************
      *
      *  MKINIT - Sets up MRK array of market indicators using the
      *           values of GREY, PRIM & SECDA read in from PF/LINKD.
      *           Assigns MMAXSV - no. of elements in array saved for
      *           use in later routines.
      *
      *****************************************************************
     C           MKINIT    BEGSR
      *
      *  Blank 1st element, then set values to G,P or S as apprpriate.
      *
     C                     MOVE *BLANKS   MRK,1
     C                     Z-ADD1         X
      *
     C           GREY      IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE 'G'       MRK,X
     C                     END
     C           PRIM      IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE 'P'       MRK,X
     C                     END
     C           SECDA     IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE 'S'       MRK,X
     C                     END
      *
     C                     Z-ADDX         MMAXSV  10
     C                     Z-ADD1         MMIN    10
     C                     Z-ADDMMAXSV    MMAX    10
     C                     ENDSR
      *
      *****************************************************************
      *
      *  BKINIT - Sets up BKS array of book codes using the values
      *           of BK1,2,3 etc. read in from PF/LINKD.
      *           Assigns BMAXSV - no. of elements in array saved for
      *           use in later routines.
      *
      *****************************************************************
     C           BKINIT    BEGSR
      *
      *  Blank 1st element, then fill rest of array with all
      *  non-blank book codes.
      *
     C                     MOVE *BLANKS   BKS,1
     C                     Z-ADD1         X
      *
     C           BK1       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK1       BKS,X
     C                     END
     C           BK2       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK2       BKS,X
     C                     END
     C           BK3       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK3       BKS,X
     C                     END
     C           BK4       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK4       BKS,X
     C                     END
     C           BK5       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK5       BKS,X
     C                     END
     C           BK6       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK6       BKS,X
     C                     END
     C           BK7       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK7       BKS,X
     C                     END
     C           BK8       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK8       BKS,X
     C                     END
     C           BK9       IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK9       BKS,X
     C                     END
     C           BK10      IFNE *BLANKS
     C                     ADD  1         X
     C                     MOVE BK10      BKS,X
     C                     END
      *
     C                     Z-ADDX         BMAXSV  20
     C                     ENDSR
      *
      *****************************************************************
      *
      *  CCINIT - Sets up CCD array of charge codes using PF/SECGTD.
      *           For each live record for which the currency matches
      *           that from LINKD, the two-digit code is moved to the
      *           next element in the array.
      *           Assigns CMAXSV - no. of elements in array saved for
      *           use in later routines.
      *
      *****************************************************************
     C           CCINIT    BEGSR
     C                     MOVE *BLANKS   CCD,1
     C                     Z-ADD1         X
      *
     C                     SETOF                     99
     C           *IN99     DOUEQ'1'
     C                     READ SECGTDF                  99
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           CCY       ANDEQCURR
     C                     ADD  1         X
     C                     MOVE CCOM      CCD,X
     C                     END
     C                     END
      *
     C                     Z-ADDX         CMAXSV  20
     C                     ENDSR
      *
      *****************************************************************
      *
      *  AMINIT - Takes the value of BKMAXSV calculated in SR/BKINIT
      *           and builds an array of that length, filling it with
      *           the value of 'ST Amortise Discounts' field from SDBOOKPD
      *           (BDSTAM) for each book code in array BKS.
      *
      *****************************************************************
     C           AMINIT    BEGSR
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP5
     C*                         End S01408
     C                     Z-ADD0         X
      *
     C           X         DOUEQBMAXSV
     C                     ADD  1         X
     C***********BKS,X     CHAINBOOKDDF              99                   S01315
     C           BKS,X     CHAIN@BDREDK              99                   S01315
     C           *IN99     IFNE '1'
     C***********          MOVE STAD      AMD,X                           S01315
     C                     MOVE BDSTAM    AMD,X                           S01315
     C                     END
     C                     END
      *
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP6
     C*                         End S01408
     C                     Z-ADD0         X
     C                     ENDSR
      *
      *****************************************************************
      *
      *  DSINIT - Takes the value of SFDSC from LINKD and builds the 4
      *           arrays of classification values necessary for the
      *           different requirements of various types of key.
      *
      *           DS1:   ' ', 'I', 'X', 'S'(if reqd), 'D'(if reqd)
      *           DS2:   ' ', 'I', 'S'(if reqd), 'D'(if reqd)
      *           DS3:   'X', 'S'(if reqd), 'D'(if reqd)
      *           DS4:   'S'(if reqd), 'D'(if reqd)
      *
      *
      *           SFDSC  'S'  Safe Custody      'S' ' '
      *                  'D'  Discretionary     'D' ' '
      *                  'B'  Both              'S' 'D'
      *                  'N'  Neither           ' ' ' '
      *
      *****************************************************************
     C           DSINIT    BEGSR
      *
     C                     MOVE ' '       DS1,1
     C                     MOVE ' '       DS2,1
     C                     MOVE 'X'       DS3,1
      *
     C                     MOVE 'I'       DS1,2
     C                     MOVE 'I'       DS2,2
      *
     C                     MOVE 'X'       DS1,3
      *
     C           SFDSC     IFEQ 'S'
     C                     MOVE 'S'       DS1,4
     C                     MOVE 'S'       DS2,3
     C                     MOVE 'S'       DS3,2
     C                     MOVE 'S'       DS4,1
     C                     MOVE ' '       DS1,5
     C                     MOVE ' '       DS2,4
     C                     MOVE ' '       DS3,3
     C                     MOVE ' '       DS4,2
     C                     Z-ADD4         D1END   10
     C                     Z-ADD3         D2END   10
     C                     Z-ADD2         D3END   10
     C                     Z-ADD1         D4END   10
     C                     ELSE
      *
     C           SFDSC     IFEQ 'D'
     C                     MOVE 'D'       DS1,4
     C                     MOVE 'D'       DS2,3
     C                     MOVE 'D'       DS3,2
     C                     MOVE 'D'       DS4,1
     C                     MOVE ' '       DS1,5
     C                     MOVE ' '       DS2,4
     C                     MOVE ' '       DS3,3
     C                     MOVE ' '       DS4,2
     C                     Z-ADD4         D1END   10
     C                     Z-ADD3         D2END   10
     C                     Z-ADD2         D3END   10
     C                     Z-ADD1         D4END   10
     C                     ELSE
      *
     C           SFDSC     IFEQ 'B'
     C                     MOVE 'S'       DS1,4
     C                     MOVE 'D'       DS1,5
     C                     MOVE 'S'       DS2,3
     C                     MOVE 'D'       DS2,4
     C                     MOVE 'S'       DS3,2
     C                     MOVE 'D'       DS3,3
     C                     MOVE 'S'       DS4,1
     C                     MOVE 'D'       DS4,2
     C                     Z-ADD5         D1END
     C                     Z-ADD4         D2END
     C                     Z-ADD3         D3END
     C                     Z-ADD2         D4END
     C                     ELSE
      *
     C           SFDSC     IFEQ 'N'
     C                     MOVE ' '       DS1,4
     C                     MOVE ' '       DS1,5
     C                     MOVE ' '       DS2,3
     C                     MOVE ' '       DS2,4
     C                     MOVE ' '       DS3,2
     C                     MOVE ' '       DS3,3
     C                     MOVE ' '       DS4,1
     C                     MOVE ' '       DS4,2
     C                     Z-ADD3         D1END
     C                     Z-ADD2         D2END
     C                     Z-ADD1         D3END
     C                     Z-ADD0         D4END
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************   S01447
      *                                                                   S01447
      *  CYINIT :        Sets up country array                            S01447
      *                                                                   S01447
      *  CALLED BY :     INIT                                             S01447
      *                                                                   S01447
      *  CALLS :         LOADAR                                           S01447
      *                                                                   S01447
      *****************************************************************   S01447
     C           CYINIT    BEGSR                                          S01447
      *                                                                   S01447
      ***  Blank 1st element, then rest of values to contents of          S01447
      ***  country codes values on LINKD.                                 S01447
      *                                                                   S01447
     C                     MOVE *BLANKS   CTY,1                           S01447
     C                     Z-ADD1         X                               S01447
      *                                                                   S01447
     C           CTX1      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX1      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX2      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX2      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX3      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX3      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX4      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX4      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX5      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX5      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX6      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX6      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX7      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX7      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX8      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX8      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX9      IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX9      CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
     C           CTX10     IFNE *BLANKS                                   S01447
     C                     ADD  1         X                               S01447
     C                     MOVE CTX10     CTY,X                           S01447
     C                     END                                            S01447
      *                                                                   S01447
      *                                                                   S01447
      *** Set CYMXSV to last non-blank element in array                   S01447
      *                                                                   S01447
     C                     Z-ADDX         CYMXSV  20       WORK ARY IDX   S01447
      *                                                                   S01447
     C                     ENDSR                                          S01447
      *****************************************************************
      *
      *  FV01  -  FV keys on trade date, value date & settlement date.
      *
      *****************************************************************
     C           FV01      BEGSR
      *
     C                     Z-ADD1         TMIN    10
     C                     Z-ADD3         TMAX    10
     C                     Z-ADD1         BMIN    10
     C                     Z-ADDBMAXSV    BMAX    20
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN    20
     C                     Z-ADD1         CMAX    20
     C                     EXSR NPACHK
     C                     Z-ADDD2END     DMAX    10
      *
     C                     SETON                     22
     C                     EXSR GEN01
     C                     SETOF                     22
      *
     C                     ENDSR
      *****************************************************************
      *
      *  FV02  -  FV keys on depot movement date.
      *
      *****************************************************************
     C           FV02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
      *
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN    10
     C                     Z-ADD1         SMAX    20
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C*********************Z-ADD0         NMIN    10                      AK0012
     C*********************Z-ADD1         NMAX    10                      AK0012
      *                                                                   AK0012
      *  Negative position indicator may be required for these keys.      AK0012
      *                                                                   AK0012
     C                     EXSR NPACHK                                    AK0012
      *
     C*********************Z-ADDD4END     DMAX                            AK0012
     C*********************SETON                     24                   AK0012
     C*********************EXSR GEN01                                     AK0012
     C*********************SETOF                     24                   AK0012
      *
      *  If PNDM (Post No Standard Depot Movements) from TABTB36 = 'N'
      ***then*should*produce*the*standard*depot*movement*key*as*well*:    AK0012
      *  then should produce standard depot movement keys :               AK0012
      *
     C*          PNDM      IFEQ 'N'                                       S01315
     C           BVPSDM    IFEQ 'N'                                       S01315
     C                     Z-ADD1         DMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     Z-ADDD4END     DMAX                            AK0012
     C                     SETON                     24                   AK0012
     C                     EXSR GEN01                                     AK0012
     C                     SETOF                     24                   AK0012
     C                     END
      *
     C                     ENDSR
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  FV02CO - FV keys on depot movement date for Corporate Actions    CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           FV02CO    BEGSR                                          CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
      *                                                                   CSE007
      *** Book Code                                                       CSE007
     C                     Z-ADD1         BMIN                            CSE007
     C                     Z-ADDBMAXSV    BMAX                            CSE007
      *                                                                   CSE007
      *** Charge/Commission Code will always be blanks                    CSE007
     C                     Z-ADD0         CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      *  Negative position indicator may be required for these keys.      CSE007
      *                                                                   CSE007
     C                     EXSR NPACHK                                    CSE007
      *                                                                   CSE007
      *  If PNDM (Post No Standard Depot Movements) from TABTB36 = 'N'    CSE007
      *  then should produce standard depot movement keys :               CSE007
      *                                                                   CSE007
     C           BVPSDM    IFEQ 'N'                                       CSE007
     C                     Z-ADDD1END     DMAX                            CSE007
     C                     SETON                     21                   CSE007
     C                     EXSR GEN02                                     CSE007
     C                     SETOF                     21                   CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *****************************************************************
      *
      *  FV03  -  FV keys on mortgage repayment date.
      *
      *****************************************************************
     C           FV03      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     EXSR NPACHK
      *
      *  FV repaid - customer: discretionary indicators and no book codes.
      *
     C***********          Z-ADDD4END     DMAX                            055442
     C                     Z-ADDD3END     DMAX                            055442
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C***********          SETON                     24                   055442
     C                     SETON                     23                   055442
     C                     EXSR GEN01
     C***********          SETOF                     24                   055442
     C                     SETOF                     23                   055442
      *
      *  FV repaid - user: no discretionary indicator but book codes reqd.
      *
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     ENDSR
      *****************************************************************
      *
      *  FV04  -  FV keys on maturity date.
      *
      *****************************************************************
     C           FV04      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
      *
      *  FV - client: contingent liabilities - no book codes,mkt ind, or neg ind
      *                                                                   AK0009
      *  Only produced if DCNL from investment type set to 'Y'.           AK0009
      *                                                                   AK0009
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         NMIN    10
     C                     Z-ADD1         NMAX    10
     C                     Z-ADD0         MMIN
     C                     Z-ADD1         MMAX
     C                     SETON                     21
     C           DCNL      IFEQ 'Y'                                       AK0009
     C                     EXSR GEN01
     C                     END                                            AK0009
      *
      *  FV maturity - user: book codes reqd.,mkt. inds. reqd.,neg.ind. reqd.
      *
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD1         MMIN
     C                     Z-ADDMMAXSV    MMAX
     C                     EXSR NPACHK
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     ENDSR
      *****************************************************************
      *
      *  FV05  -  FV keys on value date - client contingent liability
      *
      *****************************************************************
     C           FV05      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     Z-ADD0         MMIN
     C                     Z-ADD1         MMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     Z-ADD1         MMIN                            AK0002
     C                     Z-ADDMMAXSV    MMAX                            AK0002
      *                                                                   AK0002
     C                     ENDSR
      *
      *****************************************************************
      *
      *  CO01  -  CO keys on trade/value/settlement date.
      *
      *****************************************************************
     C           CO01      BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADDD2END     DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     22
     C                     EXSR GEN01
     C                     SETOF                     22
      *
     C                     ENDSR
      *****************************************************************
      *
      *  CO02  -  CO keys : mortgage repayment/maturity.
      *
      *****************************************************************
     C           CO02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     ENDSR
      *****************************************************************
      *
      *  CV01  -  CV keys : trade,value & sett. date + safe/disc pos. sett.
      *
      *****************************************************************
     C           CV01      BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADDD2END     DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     ELSE
     C           ETYPA     IFEQ 'S'
     C                     EXSR NPACHK
     C                     END
     C                     END
      *
     C                     SETON                     22
     C                     EXSR GEN01
     C                     SETOF                     22
      *
      *  Produce 'Amount due - Maturity' key for safe custody/discretionary/
      *  depot position settlement.
      *
     C           ETYPA     IFEQ 'S'
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     EXSR NPACHK
     C                     Z-ADDD3END     DMAX
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  CV02  -  CV keys : maturity.
      *
      *****************************************************************
     C           CV02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
      *
      *  Countervalue - user: no discretionary indicators
      *                       book codes required
      *
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
      *  Customer holdings  : discretionary indicators required
      *                       no book codes
      *
      *  New depot key at maturity  : iiiM-X------mvn---CV                AK0014
      *                                                                   AK0014
     C*********************Z-ADDD4END     DMAX                            AK0014
     C                     Z-ADDD3END     DMAX                            AK0014
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C*********************SETON                     24                   AK0014
     C                     SETON                     23                   AK0014
     C                     EXSR GEN01
     C*********************SETOF                     24                   AK0014
     C                     SETOF                     23                   AK0014
      *                                                                   AK0014
     C                     ENDSR
      *****************************************************************
      *
      *  CN01  -  CN keys : trade/value date.
      *
      *****************************************************************
     C           CN01      BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADDD2END     DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     SETON                     22
     C                     EXSR GEN01
     C                     SETOF                     22
      *
     C                     ENDSR
      *****************************************************************
      *
      *  FC01  -  FP/FR/CP/CR keys : trade/value date.
      *
      *****************************************************************
     C           FC01      BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD1         CMIN
     C                     Z-ADDCMAXSV    CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
      *
      *  Check ICD parameter SKTD against value of event code to ensure
      *  correct keys are generated/suppressed.
      *
     C***********SKTD      IFEQ ' '                                       S01315
     C           BVSKTV    IFEQ ' '                                       S01315
     C***********SKTD      OREQ 'N'                                AK0004 S01315
     C           BVSKTV    OREQ 'N'                                       S01315
     C***********SKTD      OREQ 'T'                                       S01315
     C           BVSKTV    OREQ 'T'                                       S01315
     C           ETYPA     ANDEQ'V'
     C***********SKTD      OREQ 'V'                                       S01315
     C           BVSKTV    OREQ 'V'                                       S01315
     C           ETYPA     ANDEQ'T'
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  FC02  -  FP/FR/CP/CR keys : Position settlement related.
      *
      *****************************************************************
     C           FC02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADDD3END     DMAX
     C*********************Z-ADD1         BMIN                            E23650
     C*********************Z-ADDBMAXSV    BMAX                            E23650
     C                     Z-ADD0         BMIN                            E23650
     C                     Z-ADD1         BMAX                            E23650
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD1         CMIN
     C                     Z-ADDCMAXSV    CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  FC02CO - FP/FR/CP/CR keys : Position settlement related.         CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           FC02CO    BEGSR                                          CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
      *                                                                   CSE007
      *** Book Code                                                       CSE007
     C                     Z-ADD1         BMIN                            CSE007
     C                     Z-ADDBMAXSV    BMAX                            CSE007
      *                                                                   CSE007
      *** Charge/Commission Code                                          CSE007
     C                     Z-ADD1         CMIN                            CSE007
     C                     Z-ADDCMAXSV    CMAX                            CSE007
     C                     Z-ADDD1END     DMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      *  Negative position indicator will always be blanks                CSE007
     C                     Z-ADD0         NMIN                            CSE007
     C                     Z-ADD1         NMAX                            CSE007
     C                     SETON                     21                   CSE007
     C                     EXSR GEN02                                     CSE007
     C                     SETOF                     21                   CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *****************************************************************   S01445
      *                                                                   S01445
      *  FC03  -  FR keys : Depot Movements                               S01445
      *                                                                   S01445
      *****************************************************************   S01445
     C           FC03      BEGSR                                          S01445
      *                                                                   S01445
      *** Trade type will always be blank                                 S01445
      *                                                                   S01445
     C                     Z-ADD*ZERO     TMIN                            S01445
     C                     Z-ADD1         TMAX                            S01445
      *                                                                   S01445
      *** This + BMAX means that the trade type will be set to all        S01445
      *** book codes in turn.                                             S01445
      *                                                                   S01445
     C                     Z-ADD1         BMIN                            S01445
     C                     Z-ADDBMAXSV    BMAX                            S01445
      *                                                                   S01445
      *** This + indicator 24 means that keys will be generated for       S01445
      *** safe custody and discretionary customers.                       S01445
      *                                                                   S01445
     C                     Z-ADDD4END     DMAX                            S01445
     C                     MOVE '1'       *IN24                           S01445
      *                                                                   S01445
      *** This + CMAX means that all charge codes will be accomodated     S01445
      *                                                                   S01445
     C                     Z-ADD1         CMIN                            S01445
     C                     Z-ADDCMAXSV    CMAX                            S01445
      *                                                                   S01445
      *** Trade sub-type will always be blank                             S01445
      *                                                                   S01445
     C                     Z-ADD*ZERO     SMIN                            S01445
     C                     Z-ADD1         SMAX                            S01445
      *                                                                   S01445
     C                     EXSR GEN01                                     S01445
      *                                                                   S01445
     C                     MOVE '0'       *IN24            CLR INDS       S01445
      *                                                                   S01445
     C                     ENDSR                                          S01445
      *****************************************************************
      *
      *  RERR01  -  RE/RR keys : Trade/Value date.
      *
      *****************************************************************
     C           RERR01    BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
      *
      *  Check ICD parameter SKTD against value of event code to ensure
      *  correct keys are generated/suppressed.
      *
     C***********SKTD      IFEQ ' '                                       S01315
     C           BVSKTV    IFEQ ' '                                       S01315
     C***********SKTD      OREQ 'N'                                AK0004 S01315
     C           BVSKTV    OREQ 'N'                                       S01315
     C***********SKTD      OREQ 'T'                                       S01315
     C           BVSKTV    OREQ 'T'                                       S01315
     C           ETYPA     ANDEQ'V'
     C***********SKTD      OREQ 'V'                                       S01315
     C           BVSKTV    OREQ 'V'                                       S01315
     C           ETYPA     ANDEQ'T'
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  PI01  -  PI keys : trade date.
      *
      *****************************************************************
     C           PI01      BEGSR
      *
      *  Do not want key if ICD set up to suppress trade date keys.
      *  Do not want key if processing type 2,4,6, or 7 , i.e. shares,
      *  commodities, schuldschein or unit trusts.
      *
     C***********SKTD      IFNE 'T'                                       S01315
     C           BVSKTV    IFNE 'T'                                       S01315
     C           PROT      ANDNE'2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'7'
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  PI02  -  PI keys : value date.
      *
      *****************************************************************
     C           PI02      BEGSR
      *
      *  Do not want key if processing type 2,4,6, or 7 , i.e. shares,
      *  commodities, schuldschein or unit trusts.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'7'
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  PI03  -  PI keys : coupon payment date - not produced for schuldschein.
      *
      *****************************************************************
     C           PI03      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
      *
      *  Note : C/PI key not produced unless SPIT = 'Y'                   AK0015
      *
     C           PROT      IFNE '6'
     C***********SPIT      ANDEQ'Y'                                AK0015 S01315
     C           BVSPIN    ANDEQ'Y'                                       S01315
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  DSPR01  -  DS/PR keys : trade/value date.
      *
      *****************************************************************
     C           DSPR01    BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
      *
      *  Check ICD parameter SKTD against value of event code to ensure
      *  correct keys are generated/suppressed.
      *
     C***********SKTD      IFEQ ' '                                       S01315
     C           BVSKTV    IFEQ ' '                                       S01315
     C***********SKTD      OREQ 'N'                                AK0004 S01315
     C           BVSKTV    OREQ 'N'                                       S01315
     C***********SKTD      OREQ 'T'                                       S01315
     C           BVSKTV    OREQ 'T'                                       S01315
     C           ETYPA     ANDEQ'V'
     C***********SKTD      OREQ 'V'                                       S01315
     C           BVSKTV    OREQ 'V'                                       S01315
     C           ETYPA     ANDEQ'T'
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *
      *  DAPA01  -  DA/PA keys : accrual date.
      *
      *****************************************************************
     C           DAPA01    BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
      *
      ***Check ICD parameter SKTD against value of event code to ensure   AK0001
      ***correct keys are generated/suppressed.                           AK0001
      ***                                                                 AK0001
     C***        SKTD      IFEQ ' '                                       AK0001
     C***        SKTD      OREQ 'T'                                       AK0001
     C***        ETYPA     ANDEQ'V'                                AK0001
     C***        SKTD      OREQ 'V'                                       AK0001
     C***        ETYPA     ANDEQ'T'                                AK0001
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C***                  END                                            AK0001
      *
     C                     ENDSR
      *****************************************************************
      *
      *  RPL01  -  RP/RL keys
      *
      *****************************************************************
     C           RPL01     BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     21
      *
      *  Check ICD parameter SKTD against value of event code to ensure
      *  correct keys are generated/suppressed. Also need to take the
      *  Realised Profit Basis (RPBS) from ICD into account. SKTD will
      *  override RPBS, i.e. if SKTD = T & RPBS = B  only the value date
      *  key will be produced.
      *
     C           ETYPA     IFEQ 'T'
     C***********SKTD      ANDNE'T'                                       S01315
     C           BVSKTV    ANDNE'T'                                       S01315
     C***********RPBS      ANDNE'V'                                       S01315
     C           BVRPB     ANDNE'V'                                       S01315
     C                     EXSR GEN01
      *
     C                     ELSE
      *
     C           ETYPA     IFEQ 'V'
     C***********SKTD      ANDNE'V'                                       S01315
     C           BVSKTV    ANDNE'V'                                       S01315
     C***********RPBS      ANDNE'T'                                       S01315
     C           BVRPB     ANDNE'T'                                       S01315
     C                     EXSR GEN01
      *
     C                     ELSE
      *
     C           ETYPA     IFEQ 'R'
     C                     EXSR GEN01
     C                     END
      *
     C                     END
     C                     END
     C                     SETOF                     21
      *
     C                     ENDSR
      *****************************************************************
      *
      *  UPL01  -  UP/UL keys
      *
      *****************************************************************
     C           UPL01     BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
      *
      *  Must check unrealised profit basis from ICD (UPBS) to determine
      *  the contents of positions 9-10 on the UP/UL keys. The production/
      *  suppression of these keys is controlled by a separate routine which
      *  is accessed in the main production loop routine GEN01.
      *
     C***********UPBS      IFEQ 'T'
     C           BVUPB     IFEQ 'T'                                       S01315
     C                     Z-ADD1         SMIN
     C                     Z-ADD2         SMAX
     C                     ELSE
     C***********UPBS      IFEQ 'V'                                       S01315
     C           BVUPB     IFEQ 'V'                                       S01315
     C                     Z-ADD2         SMIN
     C                     Z-ADD3         SMAX
     C                     ELSE
     C                     Z-ADD1         SMIN
     C                     Z-ADD3         SMAX
     C                     END
     C                     END
      *
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     ENDSR
      *****************************************************************                       CAS006
      *                                                                                       CAS006
      *  HPL01  -  Hedge Profit and Loss account Keys                                         CAS006
      *                                                                                       CAS006
      *****************************************************************                       CAS006
     C           HPL01     BEGSR                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANK    WHDIN   1                                           CAS006
      *                                                                                       CAS006
      ** Generate keys for both Fair Value and Cash Flow Hedge                                CAS006
      *                                                                                       CAS006
     C                     DO   2                                                             CAS006
      *                                                                                       CAS006
     C           WHDIN     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'F'       WHDIN                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'C'       WHDIN                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         TMIN                                                CAS006
     C                     Z-ADD1         TMAX                                                CAS006
     C                     Z-ADD1         DMAX                                                CAS006
     C                     Z-ADD1         BMIN                                                CAS006
     C                     Z-ADDBMAXSV    BMAX                                                CAS006
      *                                                                                       CAS006
      ** Must check unrealised profit basis from ICD (UPBS) to determine                      CAS006
      ** the contents of positions 9-10 on hedge acc keys. The production/                    CAS006
      ** suppression of these keys is controlled by a separate routine which                  CAS006
      ** is accessed in the main production loop routine GEN01.                               CAS006
      *                                                                                       CAS006
     C           BVUPB     IFEQ 'T'                                                           CAS006
     C                     Z-ADD1         SMIN                                                CAS006
     C                     Z-ADD2         SMAX                                                CAS006
     C                     ELSE                                                               CAS006
     C           BVUPB     IFEQ 'V'                                                           CAS006
     C                     Z-ADD2         SMIN                                                CAS006
     C                     Z-ADD3         SMAX                                                CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADD1         SMIN                                                CAS006
     C                     Z-ADD3         SMAX                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         CMIN                                                CAS006
     C                     Z-ADD1         CMAX                                                CAS006
     C                     EXSR NPACHK                                                        CAS006
     C                     MOVE *ON       *IN21                                               CAS006
     C                     EXSR GEN01                                                         CAS006
     C                     MOVE *OFF      *IN21                                               CAS006
      *                                                                                       CAS006
     C                     ENDDO                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************
      *
      *  SA01  -  SA keys : Settlement date/position settlement.
      *
      *****************************************************************
     C           SA01      BEGSR
      *
      *  User:
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C**********           Z-ADD1         DMAX                                                102511
     C                     Z-ADD2         DMAX                                                102511
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
      *  Customer/depot position settlement:
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  SA01CO - SA keys : Settlement date/position settl. (Corp Act)    CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           SA01CO    BEGSR                                          CSE007
      *                                                                   CSE007
     C                     Z-ADDD1END     DMAX                            CSE007
      *                                                                   CSE007
      *** Book Code will always be blanks                                 CSE007
     C                     Z-ADD0         BMIN                            CSE007
     C                     Z-ADD1         BMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      *** Charge/Commission Code will always be blanks                    CSE007
     C                     Z-ADD0         CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
      *                                                                   CSE007
      *  Negative position indicator will always be blanks                CSE007
     C                     Z-ADD0         NMIN                            CSE007
     C                     Z-ADD1         NMAX                            CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD0         CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
     C                     SETON                     21                   CSE007
     C                     EXSR GEN02                                     CSE007
     C                     SETOF                     21                   CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *****************************************************************
      *
      *  DFN01  -  DF/DN keys : trade/value/settlement date.
      *
      *****************************************************************
     C           DFN01     BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
      *
      ***Discretionary*indicators*only*required*on*the*trade/value*date*keE23156
      *  Classification only required on the trade/value date keys.       E23516
      *
     C           ETYPA     IFEQ 'T'
     C           ETYPA     OREQ 'V'
     C                     Z-ADDD2END     DMAX
     C                     ELSE
     C                     Z-ADD1         DMAX
     C                     END
      *
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
      *
      ***Discrepancy*keys*not*required*if*settlement*discrepancy*amounts* E23516
      ***from*ICD*are*zero.********************************************** E23516
      *
     C***********SMDO      IFNE 0                                         E23516
     C***********SMDU      ORNE 0                                         E23516
      *
      *  Must also take account of BVSKTV:
      *
     C***********SKTD      IFEQ ' '                                       S01315
     C           BVSKTV    IFEQ ' '                                       S01315
     C***********SKTD      OREQ 'N'                                AK0004 S01315
     C           BVSKTV    OREQ 'N'                                       S01315
     C***********SKTD      OREQ 'T'                                       S01315
     C           BVSKTV    OREQ 'T'                                       S01315
     C           ETYPA     ANDEQ'V'
     C***********SKTD      OREQ 'V'                                       S01315
     C           BVSKTV    OREQ 'V'                                       S01315
     C           ETYPA     ANDEQ'T'
     C           ETYPA     OREQ 'S'
     C                     SETON                     22
     C                     EXSR GEN01
     C                     SETOF                     22
     C                     END
      *
     C*********************END                                            E23516
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  DFN02  -  DF/DN keys : coupon due date.
      *
      *****************************************************************
     C           DFN02     BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
      *
      *  Discrepancy keys not required if settlement discrepancy amounts
      *  from ICD is zero.
      *
     C***********SMDO      IFNE 0
     C           BVSDOV    IFNE 0                                         S01315
     C***********SMDU      ORNE 0                                         S01315
     C           BVSDUN    ORNE 0                                         S01315
      *
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  AI01  -  A.I.R. keys : value date.
      *
      *****************************************************************
     C           AI01      BEGSR
      *
     C                     Z-ADD1         TMIN
     C                     Z-ADD3         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     EXSR SUBCHK
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
      *
      *  A.I.R. not split from PI key unless BVSPIN (from ICD) is 'Y'.
      *  Also not produced for processing types 2,4,6, or 7.
      *
     C***********SPIT      IFEQ 'Y'                                       S01315
     C           BVSPIN    IFEQ 'Y'                                       S01315
     C           PROT      ANDNE'2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'6'
     C           PROT      ANDNE'7'
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  AI02  -  A.I.R. keys : accrual/coupon due date.
      *
      *****************************************************************
     C           AI02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
      *
      *  A.I.R. keys not produced on coupon date for schuldschein.
      *  Note : C/AI key not produced unless BVSPIN = 'Y'                 AK0015
      *
     C           ETYPA     IFEQ 'C'
     C           PROT      ANDNE'6'
     C***********SPIT      ANDEQ'Y'                                AK0015 S01315
     C           BVSPIN    ANDEQ'Y'                                       S01315
     C           ETYPA     OREQ 'A'
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  PP01  -  Partly Paid Call: call date.
      *
      *****************************************************************
     C           PP01      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
      *
      *  Called amount: user book position.
      *
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
      *  Called amount: customer/depot.
      *
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  PP02  -  Partly Paid Call: position settlement.
      *
      *****************************************************************
     C           PP02      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  DI01  -  Dividend due: dividend date.
      *
      *****************************************************************
     C           DI01      BEGSR
      *
      *  User position:
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     Z-ADD0         NMIN
     C                     Z-ADD1         NMAX
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
      *  Customer/depot position:
      *
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     EXSR SNACHK
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  DI01CO - Dividend due: dividend date.                            CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           DI01CO    BEGSR                                          CSE007
      *                                                                   CSE007
      *  User position:                                                   CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
     C                     Z-ADD1         DMAX                            CSE007
      *                                                                   CSE007
      *** Book Code                                                       CSE007
     C                     Z-ADD1         BMIN                            CSE007
     C                     Z-ADDBMAXSV    BMAX                            CSE007
      *                                                                   CSE007
      *** Charge/Commission Code will always be blanks                    CSE007
     C                     Z-ADD0         CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      ** Negative position indicator may be required for these keys.      CSE007
     C                     EXSR SNACHK                                    CSE007
      *                                                                   159026
     C           ATYPA     IFNE 'DI'                                      159026
     C           ATYPA     ANDNE'CD'                                      159026
     C                     SETON                     21                   CSE007
     C                     ELSE                                           159026
     C                     SETON                     23                   159026
     C                     ENDIF                                          159026
      *                                                                   159026
     C                     EXSR GEN02                                     CSE007
     C                     SETOF                     21                   CSE007
     C                     SETOF                     23                   159026
      *                                                                   CSE007
     C           ATYPA     IFEQ 'DI'                                      CSE007
     C           ATYPA     OREQ 'CD'                                      CSE007
      *                                                                   CSE007
      *  Customer/depot position:                                         CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
     C*****                Z-ADDD1END     DMAX                     CSE007 159026
     C                     Z-ADDD3END     DMAX                            159026
      *                                                                   CSE007
      *** Book Code will always be blanks                                 CSE007
     C                     Z-ADD0         BMIN                            CSE007
     C                     Z-ADD1         BMAX                            CSE007
      *                                                                   CSE007
      *** Charge/Commission Code will always be blanks                    CSE007
     C                     Z-ADD0         CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      ** Negative position indicator may be required for these keys.      CSE007
     C                     EXSR SNACHK                                    CSE007
     C*****                SETON                     21            CSE007 159026
     C                     SETON                     23                   159026
     C                     EXSR GEN02                                     CSE007
     C*****                SETOF                     21            CSE007 159026
     C                     SETOF                     23                   159026
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *                                                                   CSE007
      *****************************************************************
      *
      *  DI02  -  Interest/Coupon Due.
      *
      *****************************************************************
     C           DI02      BEGSR
      *
      *  User's position:
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
      *
      *  Customer holding: keys not produced for non interest-bearing securities
      *
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  DI03  -  Amount Due: coupon/dividend (position settlement)
      *
      *****************************************************************
     C           DI03      BEGSR
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR SNACHK
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     ENDSR
      *
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  DI03CO - Amount Due: coupon/dividend (position settlement)       CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           DI03CO    BEGSR                                          CSE007
      *                                                                   CSE007
      *** Country Code will always be blanks                              CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
      *                                                                   CSE007
      *** Market                                                          CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
     C*****                Z-ADDD1END     DMAX                     CSE007 159026
     C                     Z-ADDD3END     DMAX                            159026
      *                                                                   CSE007
      *** Book Code will always be blanks                                 CSE007
     C                     Z-ADD0         BMIN                            CSE007
     C                     Z-ADD1         BMAX                            CSE007
      *                                                                   CSE007
      *** Charge/Commission Code will always be blanks                    CSE007
     C                     Z-ADD0         CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Trade Subtype                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      ** Negative position indicator may be required for these keys.      CSE007
     C                     EXSR SNACHK                                    CSE007
     C*****                SETON                     21            CSE007 159026
     C                     SETON                     23                   159026
     C                     EXSR GEN02                                     CSE007
     C*****                SETOF                     21            CSE007 159026
     C                     SETOF                     23                   159026
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *                                                                   CSE007
      *****************************************************************
      *
      *  MR01  -  Mortgage Repayment keys: amount due.
      *
      *****************************************************************
     C           MR01      BEGSR
      *
      *  Only for processing type 8.
      *
     C           PROT      IFEQ '8'
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADDD3END     DMAX
     C                     Z-ADD0         BMIN
     C                     Z-ADD1         BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     23
     C                     EXSR GEN01
     C                     SETOF                     23
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  ZZ01  -  BL,BB,RA,RV,PL & PD keys on depot movement date.
      *
      *****************************************************************
     C           ZZ01      BEGSR
      *
      *  Not produced for shares, commodities or unit trusts.
      *
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
      *
     C                     Z-ADD0         TMIN
     C                     Z-ADD1         TMAX
     C                     Z-ADD1         DMAX
     C                     Z-ADD1         BMIN
     C                     Z-ADDBMAXSV    BMAX
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     Z-ADD0         CMIN
     C                     Z-ADD1         CMAX
     C                     EXSR NPACHK
     C                     SETON                     21
     C                     EXSR GEN01
     C                     SETOF                     21
     C*********************Z-ADDD4END     DMAX                            AK0011
     C                     Z-ADDD3END     DMAX                            AK0011
     C*********************SETON                     24                   AK0011
     C                     SETON                     23                   AK0011
     C                     EXSR GEN01
     C*********************SETOF                     24                   AK0011
     C                     SETOF                     23                   AK0011
      *
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************   S01447
      *                                                                   S01447
      *  WTAXK -  Setup Withholding Tax keys                              S01447
      *                                                                   S01447
      *****************************************************************   S01447
     C           WTAXK     BEGSR                                          S01447
      *                                                                   S01447
      *** Trade type will always be blank                                 S01447
      *                                                                   S01447
     C                     Z-ADD*ZERO     TMIN                            S01447
     C                     Z-ADD1         TMAX                            S01447
      *                                                                   S01447
      *** Book code will always be blank                                  S01447
      *                                                                   S01447
     C                     Z-ADD*ZERO     BMIN                            S01447
     C                     Z-ADD1         BMAX                            S01447
      *                                                                   S01447
      *** This + indicator 23 means that keys will be generated for       S01447
      *** Depot, Safe Custody and Discretionary customers.                S01447
      *                                                                   S01447
     C                     Z-ADDD3END     DMAX                            S01447
     C                     MOVE '1'       *IN23                           S01447
      *                                                                   S01447
      *** Charge code will always be blank.                               S01447
      *                                                                   S01447
     C                     Z-ADD*ZERO     CMIN                            S01447
     C                     Z-ADD1         CMAX                            S01447
      *                                                                   S01447
      *** Trade sub-type will always be blank                             S01447
      *                                                                   S01447
     C                     Z-ADD*ZERO     SMIN                            S01447
     C                     Z-ADD1         SMAX                            S01447
      *                                                                   S01447
      *** So that 1st value read is 2nd in array.                         S01447
      *** Saved value from SR/CYINIT.                                     S01447
      *                                                                   S01447
     C                     Z-ADD1         CYMIN                           S01447
     C                     Z-ADDCYMXSV    CYMAX                           S01447
      *                                                                   S01447
     C                     EXSR GEN01                                     S01447
      *                                                                   S01447
      *** Reset values                                                    S01447
      *                                                                   S01447
     C                     Z-ADD*ZERO     CYMIN                           S01447
     C                     Z-ADD1         CYMAX                           S01447
     C                     MOVE '0'       *IN23                           S01447
      *                                                                   S01447
     C                     ENDSR                                          S01447
      *****************************************************************
     C/EJECT                                                              CSE007
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  WTAXCO - Setup Withholding Tax keys for Corporate Actions        CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           WTAXCO    BEGSR                                          CSE007
      *                                                                   CSE007
     C                     Z-ADD1         MMIN                            CSE007
     C                     Z-ADDMMAXSV    MMAX                            CSE007
     C                     Z-ADD0         NMIN                            CSE007
     C                     Z-ADD1         NMAX                            CSE007
      *                                                                   CSE007
      *** Book code will always be blank                                  CSE007
      *                                                                   CSE007
     C                     Z-ADD*ZERO     BMIN                            CSE007
     C                     Z-ADD1         BMAX                            CSE007
      *                                                                   CSE007
     C                     Z-ADDD1END     DMAX                            CSE007
     C                     MOVE '1'       *IN21                           CSE007
      *                                                                   CSE007
      *** Charge code will always be blank.                               CSE007
      *                                                                   CSE007
     C                     Z-ADD*ZERO     CMIN                            CSE007
     C                     Z-ADD1         CMAX                            CSE007
      *                                                                   CSE007
      *** Trade sub-type                                                  CSE007
      *                                                                   CSE007
     C                     EXSR SBCCHK                                    CSE007
      *                                                                   CSE007
      *** So that 1st value read is 2nd in array.                         CSE007
      *** Saved value from SR/CYINIT.                                     CSE007
      *                                                                   CSE007
     C                     Z-ADD1         CYMIN                           CSE007
     C                     Z-ADDCYMXSV    CYMAX                           CSE007
      *                                                                   CSE007
     C                     EXSR GEN02                                     CSE007
      *                                                                   CSE007
      *** Reset values                                                    CSE007
      *                                                                   CSE007
     C                     Z-ADD*ZERO     CYMIN                           CSE007
     C                     Z-ADD1         CYMAX                           CSE007
     C                     MOVE '0'       *IN21                           CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
     C/EJECT                                                              CSE023
      *****************************************************************   CSE023
      *                                                               *   CSE023
      *  Subroutine  :  SRBACK                                        *   CSE023
      *  Function    :  Produce the Backup Withholding Key for Trade  *   CSE023
      *                 Date and Value Date                           *   CSE023
      *                                                               *   CSE023
      *  Called by   :  MAIN - Main Processing                        *   CSE023
      *  Calls       :  GEN01                                         *   CSE023
      *                                                               *   CSE023
      *****************************************************************   CSE023
      *                                                                   CSE023
     C           SRBACK    BEGSR                           ** SRBACK **   CSE023
      *                                                                   CSE023
      ** Trade type will be 'P' or 'S'                                    CSE023
      *                                                                   CSE023
     C                     Z-ADD1         TMIN                            CSE023
     C                     Z-ADD3         TMAX                            CSE023
      *                                                                   CSE023
      ** Classification is always blank                                   CSE023
      *                                                                   CSE023
     C                     Z-ADD1         DMAX                            CSE023
     C                     MOVEA'0000'    *IN,21                          CSE023
     C                     MOVE *BLANKS   DIND                            CSE023
      *                                                                   CSE023
      ** All Book Codes will be used                                      CSE023
      *                                                                   CSE023
     C                     Z-ADD1         BMIN                            CSE023
     C                     Z-ADDBMAXSV    BMAX                            CSE023
      *                                                                   CSE023
      ** All Subtype will be used                                         CSE023
      *                                                                   CSE023
     C                     Z-ADD1         SMIN                            CSE023
     C                     Z-ADDSMAXSV    SMAX                            CSE023
      *                                                                   CSE023
      ** Charge code will always be blank                                 CSE023
      *                                                                   CSE023
     C                     Z-ADD0         CMIN                            CSE023
     C                     Z-ADD1         CMAX                            CSE023
      *                                                                   CSE023
      ** All Market Indicators will be used                               CSE023
      *                                                                   CSE023
     C                     Z-ADD1         MMIN                            CSE023
     C                     Z-ADDMMAXSV    MMAX                            CSE023
      *                                                                   CSE023
      ** Country Code will always be blank                                CSE023
      *                                                                   CSE023
     C                     Z-ADD0         CYMIN                           CSE023
     C                     Z-ADD1         CYMAX                           CSE023
      *                                                                   CSE023
     C                     EXSR GEN01                                     CSE023
      *                                                                   CSE023
     C                     ENDSR                                          CSE023
     C/EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  MV01                                          *   CAC002
      *  Function    :  Produce the Margin amount key for Trade Date  *   CAC002
      *                 and Value Date                                *   CAC002
      *                                                               *   CAC002
      *  Called by   :  MAIN - Main Processing                        *   CAC002
      *  Calls       :  -                                             *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           MV01      BEGSR                           ** MV01   **   CAC002
      *                                                                   CAC002
     C                     Z-ADD1         TMIN                            CAC002
     C                     Z-ADD3         TMAX                            CAC002
     C                     Z-ADD1         BMIN                            CAC002
     C                     Z-ADDBMAXSV    BMAX                            CAC002
     C                     EXSR SUBCHK                                    CAC002
     C                     Z-ADD0         CMIN                            CAC002
     C                     Z-ADD1         CMAX                            CAC002
     C                     Z-ADD0         NMIN                            CAC002
     C                     Z-ADD1         NMAX
     C                     Z-ADDD2END     DMAX                            CAC002
      *                                                                   CAC002
     C                     SETON                     22                   CAC002
     C                     EXSR GEN01                                     CAC002
     C                     SETOF                     22                   CAC002
      *                                                                   CAC002
     C                     ENDSR                                          CAC002
      *                                                                   CAC002
      *****************************************************************   CAC002
     C/EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  MA01                                          *   CAC002
      *  Function    :  Produce the Margin amount key for Position    *   CAC002
      *                 Settlement Date                               *   CAC002
      *                                                               *   CAC002
      *  Called by   :  MAIN - Main Processing                        *   CAC002
      *  Calls       :  -                                             *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           MA01      BEGSR                           ** MA01   **   CAC002
      *                                                                   CAC002
     C                     Z-ADD0         TMIN                            CAC002
     C                     Z-ADD1         TMAX                            CAC002
     C                     Z-ADDD3END     DMAX                            CAC002
     C                     Z-ADD0         BMIN                            CAC002
     C                     Z-ADD1         BMAX                            CAC002
     C                     Z-ADD0         SMIN                            CAC002
     C                     Z-ADD1         SMAX                            CAC002
     C                     Z-ADD0         CMIN                            CAC002
     C                     Z-ADD1         CMAX                            CAC002
     C                     Z-ADD0         NMIN                            CAC002
     C                     Z-ADD1         NMAX                            CAC002
     C                     SETON                     23                   CAC002
     C                     EXSR GEN01                                     CAC002
     C                     SETOF                     23                   CAC002
      *                                                                   CAC002
     C                     ENDSR                                          CAC002
      *                                                                   CAC002
      *****************************************************************   CAC002
     C/EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      *  Subroutine  :  RC01                                          *   CSE006
      *  Function    :  Generate Repos, Bond Lending and Pledge Loans *   CSE006
      *                 Account Keys                                  *   CSE006
      *                                                               *   CSE006
      *  Called by   :  MAIN - Main Processing                        *   CSE006
      *  Calls       :  -                                             *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           RC01      BEGSR                           ** RC01   **   CSE006
      *                                                                   CSE006
     C                     Z-ADD0         TMIN                            CSE006
     C                     Z-ADD1         TMAX                            CSE006
     C                     Z-ADD1         BMIN                            CSE006
     C                     Z-ADDBMAXSV    BMAX                            CSE006
     C                     Z-ADDD3END     DMAX                            CSE006
     C                     EXSR SUBCHK                                    CSE006
      *                                                                   CSE006
     C                     Z-ADD0         CMIN                            CSE006
     C                     Z-ADD1         CMAX                            CSE006
     C                     Z-ADD0         NMIN                            CSE006
     C                     Z-ADD2         NMAX                            CSE006
      *                                                                   CSE006
     C                     SETON                     21                   CSE006
     C                     EXSR GEN01                                     CSE006
     C                     SETOF                     21                   CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
     C/EJECT                                                              CSE006
      *****************************************************************   CSE006
      *
      *  GEN01  -  M A I N   P R O D U C T I O N   L O O P
      *
      *            Called by each of the '2nd level' amount code routines,
      *            this takes the minimum and maximum values of the array
      *            index for each array as assigned in the various routines
      *            and performs an iteration through the selected values
      *            from each array in turn to build up the key field by
      *            field. The suppression check routines ADCHK & UPLCHK
      *            are called at this point.
      *
      *****************************************************************
     C           GEN01     BEGSR
     C                     MOVE 'Y'       GFLAG   1
      *
      *  Trade type
      *  ----------
      *  Use all values of TTP between TMIN & TMAX.
      *
     C                     Z-ADDTMIN      X1      10
     C           X1        DOWLTTMAX
     C                     ADD  1         X1
     C                     MOVE TTP,X1    TTYP
      *
      *  Classification
      *  --------------
      *  Use all values of the appropriate DS- array from 0 to the
      *  corresponding end value D1END, D2END or D3END.
      *
     C                     Z-ADD0         X2      10
     C           X2        DOWLTDMAX
     C                     ADD  1         X2
     C   21                MOVE DS1,X2    DIND
     C   22                MOVE DS2,X2    DIND
     C   23                MOVE DS3,X2    DIND
     C   24                MOVE DS4,X2    DIND
      *
      *  Book code
      *  ---------
      *  Use all values of BKS betweem BMIN & BMAX.
      *
     C                     Z-ADDBMIN      X3      20
     C           X3        DOWLTBMAX
     C                     ADD  1         X3
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP7
     C*                         End S01408
      *
      *  If DS,PR,DA or PA keys, must check ICD for value of GDPK (Generate
      *  Discount/Premium Keys for non-amortizing books), Book Code for value
      *  of BDSTAM (ST amortize discounts) and Investment Type for valueof
      *  TRBS (Trade Basis). If these keys are not to be generated for this
      *  book according to the table below, the next book should be used.
      *  If no further books are found for which keys are to be generated
      *  the routine should be terminated.
      *  Release 3.1: must check value of 'Include in account key' field.
      *  If this set to 'N' then BOOK must be set to blanks for this loop.
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP8
     C*                         End S01408
      *
      *     GDPK       BDSTAM       TRBS      Output y/n
      *     ----        ----        ----      ----------
      *      N           Y            D           Y
      *      N           N        not D           N
      *      N           Y        not D           Y
      *      N           N            D           N
      *      Y           Y            D           Y
      *      Y           N        not D           N
      *      Y           Y        not D           Y
      *      Y           N            D           Y
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CCP9
     C*                         End S01408
      *
      *
     C           ATYPA     IFEQ 'DS'
     C           ATYPA     OREQ 'PR'
     C           ATYPA     OREQ 'DA'
     C           ATYPA     OREQ 'PA'
      *
     C                     EXSR ADCHK
      *
     C                     END
      *
     C***********BKS,X3    CHAINBOOKDDF              99                   S01315
     C           BKS,X3    CHAIN@BDREDK              99                   S01315
     C           BINAK     IFEQ 'N'
     C                     MOVE *BLANKS   BOOK
     C                     ELSE
     C                     MOVE BKS,X3    BOOK
     C                     END
      *
      *  Subtypes/Posting basis
      *  ----------------------
      *  Values of STP between SMIN & SMAX.
      *
     C                     Z-ADDSMIN      X4      20
     C           X4        DOWLTSMAX
     C                     ADD  1         X4
     C                     MOVE STP,X4    STYP
      *
      *  Charge/Commission type
      *  ----------------------
      *  Values of CCD from CMIN to CMAX.
      *
     C                     Z-ADDCMIN      X5      20
     C           X5        DOWLTCMAX
     C                     ADD  1         X5
     C                     MOVE CCD,X5    CTYP
      *
      *  Market Indicator
      *  ----------------
      *  Values of MRK from MMIN to MMAX.
      *
     C                     Z-ADDMMIN      X6      10
     C           X6        DOWLTMMAX
     C                     ADD  1         X6
     C                     MOVE MRK,X6    MARK
      *
      *  Convertible Indicator
      *  ---------------------
      *  Values of CVT from 0 to VMAX.
      *
     C                     Z-ADD0         X7      10
     C           X7        DOWLTVMAX
     C                     ADD  1         X7
     C                     MOVE CVT,X7    CONV
      *
      *  Negative Position/Accrual
      *  -------------------------
      *  Values of NEG from NMIN to NMAX.
      *
     C                     Z-ADDNMIN      X8      10
     C           X8        DOWLTNMAX
     C                     ADD  1         X8
     C                     MOVE NEG,X8    NEGI
     C/COPY WNCPYSRC,AK0061C012
      *
      *  If UP or UL keys, call UPLCHK to determine whether to generate
      *  or suppress them.
      *
     C           ATYPA     IFEQ 'UP'
     C           ATYPA     OREQ 'UL'
      *
     C                     EXSR UPLCHK
      *
     C                     END
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CP10
     C*                         End S01408
      *
      *** Report country codes                                            S01447
      *                                                                   S01447
     C                     Z-ADDCYMIN     X9      20                      S01447
     C           X9        DOWLTCYMAX                                     S01447
     C                     ADD  1         X9                              S01447
     C                     MOVE CTY,X9    CTRYCD                          S01447
      *                                                                   S01447
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           CAS007    ANDEQ'Y'                                                           CAS007
     C           ATYPA     IFEQ 'IP'                                                          CAS006
     C           ATYPA     OREQ 'XP'                                                          CAS006
     C           ATYPA     OREQ 'IL'                                                          CAS006
     C           ATYPA     OREQ 'XL'                                                          CAS006
     C           WHDIN     IFEQ 'F'                                                           CAS006
     C                     MOVE ' F'      CTRYCD                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE ' C'      CTRYCD                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           GFLAG     IFEQ 'Y'
     C/COPY WNCPYSRC,AK0061C009
     C                     EXSR OUTPUT
     C/COPY WNCPYSRC,AK0061C010
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           ETYPA     ANDEQ'L'                                       CSE015
     C           ATYPA     ANDEQ'FV'                                      CSE015
     C                     MOVE 'T'       TTYP                            CSE015
     C                     EXSR OUTPUT                                    CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     END
      *                                                                   S01447
     C                     ENDDO                                          S01447
     C/COPY WNCPYSRC,AK0061C013
      *
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     ENDSR
      *
     C/EJECT                                                              CSE007
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  GEN02  -  M A I N   P R O D U C T I O N   L O O P                CSE007
      *                                                                   CSE007
      *            Called by each of the '2nd level' amount code routines,CSE007
      *            this takes the minimum and maximum values of the array CSE007
      *            index for each array as assigned in the various routineCSE007
      *            and performs an iteration through the selected values  CSE007
      *            from each array in turn to build up the key field by   CSE007
      *            field.                                                 CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           GEN02     BEGSR                                          CSE007
     C                     MOVE 'Y'       GFLAG   1                       CSE007
      *                                                                   CSE007
      *  Trade type                                                       CSE007
      *  ----------                                                       CSE007
     C                     MOVE *BLANKS   TTYP                            CSE007
      *                                                                   CSE007
      *  Classification                                                   CSE007
      *  --------------                                                   CSE007
      *  Use all values of the appropriate DS- array from 0 to the        CSE007
      *  corresponding end value D1END, D2END or D3END.                   CSE007
      *                                                                   CSE007
     C                     Z-ADD0         X2      10                      CSE007
     C           X2        DOWLTDMAX                       B*1            CSE007
     C                     ADD  1         X2                              CSE007
     C   21                MOVE DS1,X2    DIND                            CSE007
     C   22                MOVE DS2,X2    DIND                            CSE007
     C   23                MOVE DS3,X2    DIND                            CSE007
     C   24                MOVE DS4,X2    DIND                            CSE007
      *                                                                   CSE007
      *  Book code                                                        CSE007
      *  ---------                                                        CSE007
      *  Use all values of BKS betweem BMIN & BMAX.                       CSE007
      *                                                                   CSE007
     C                     Z-ADDBMIN      X3      20                      CSE007
     C           X3        DOWLTBMAX                       B*2            CSE007
     C                     ADD  1         X3                              CSE007
      *                                                                   CSE007
     C           BKS,X3    CHAIN@BDREDK              99                   CSE007
     C           BINAK     IFEQ 'N'                        B*3            CSE007
     C                     MOVE *BLANKS   BOOK                            CSE007
     C                     ELSE                            X*3            CSE007
     C                     MOVE BKS,X3    BOOK                            CSE007
     C                     END                             E*3            CSE007
      *                                                                   CSE007
      *  Corporate Action Subtypes                                        CSE007
      *  -------------------------                                        CSE007
      *  Values of CST between COMIN & COMAX.                             CSE007
      *                                                                   CSE007
     C                     Z-ADDCOMIN     X4      20                      CSE007
     C           X4        DOWLTCOMAX                      B*3            CSE007
     C                     ADD  1         X4                              CSE007
     C                     MOVE CST,X4    STYP                            CSE007
      *                                                                   CSE007
      *  Charge/Commission type                                           CSE007
      *  ----------------------                                           CSE007
      *  Values of CCD from CMIN to CMAX.                                 CSE007
      *                                                                   CSE007
     C                     Z-ADDCMIN      X5      20                      CSE007
     C           X5        DOWLTCMAX                       B*4            CSE007
     C                     ADD  1         X5                              CSE007
     C                     MOVE CCD,X5    CTYP                            CSE007
      *                                                                   CSE007
      *  Market Indicator                                                 CSE007
      *  ----------------                                                 CSE007
      *  Values of MRK from MMIN to MMAX.                                 CSE007
      *                                                                   CSE007
     C                     Z-ADDMMIN      X6      10                      CSE007
     C           X6        DOWLTMMAX                       B*5            CSE007
     C                     ADD  1         X6                              CSE007
     C                     MOVE MRK,X6    MARK                            CSE007
      *                                                                   CSE007
      *  Convertible Indicator                                            CSE007
      *  ---------------------                                            CSE007
      *  Values of CVT from 0 to VMAX.                                    CSE007
      *                                                                   CSE007
     C                     Z-ADD0         X7      10                      CSE007
     C           X7        DOWLTVMAX                       B*6            CSE007
     C                     ADD  1         X7                              CSE007
     C                     MOVE CVT,X7    CONV                            CSE007
      *                                                                   CSE007
      *  Negative Position/Accrual                                        CSE007
      *  -------------------------                                        CSE007
      *  Values of NEG from NMIN to NMAX.                                 CSE007
      *                                                                   CSE007
     C                     Z-ADDNMIN      X8      10                      CSE007
     C           X8        DOWLTNMAX                       B*7            CSE007
     C                     ADD  1         X8                              CSE007
     C                     MOVE NEG,X8    NEGI                            CSE007
      *                                                                   CSE007
      *** Report country codes                                            CSE007
      *                                                                   CSE007
     C                     Z-ADDCYMIN     X9      20                      CSE007
     C           X9        DOWLTCYMAX                      B*8            CSE007
     C                     ADD  1         X9                              CSE007
     C                     MOVE CTY,X9    CTRYCD                          CSE007
      *                                                                   CSE007
     C           GFLAG     IFEQ 'Y'                        B*9            CSE007
     C                     EXSR OUTPUT                                    CSE007
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           ETYPA     ANDEQ'L'                                       CSE015
     C           ATYPA     ANDEQ'FV'                                      CSE015
     C                     MOVE 'T'       TTYP                            CSE015
     C                     EXSR OUTPUT                                    CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     ENDIF                           E*9            CSE007
      *                                                                   CSE007
     C                     ENDDO                           E*8            CSE007
     C                     ENDDO                           E*7            CSE007
     C                     ENDDO                           E*6            CSE007
     C                     ENDDO                           E*5            CSE007
     C                     ENDDO                           E*4            CSE007
     C                     ENDDO                           E*3            CSE007
     C                     ENDDO                           E*2            CSE007
     C                     ENDDO                           E*1            CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *                                                                   CSE007
      *****************************************************************
      *
      *  SUBCHK - Looks at value of TSAK ('Trade Subtypes on A/C Keys')
      *           on SDBANKPD and assigns values of SMIN & SMAX, the
      *           iteration parameters for array STP accordingly. i.e.
      *           if trade subtypes are required, then the iteration must
      *           be performed between element no.4 & the value of SMAXSV
      *           calculated in STINIT. If subtypes not required, then it
      *           must be performed only once using the blank 1st element.
      *
      *****************************************************************
     C           SUBCHK    BEGSR
      *
     C***********TSAK      IFEQ 'Y'                                       S01315
     C           BVTSAK    IFEQ 'Y'                                       S01315
     C                     Z-ADD3         SMIN
     C                     Z-ADDSMAXSV    SMAX
     C                     ELSE
     C                     Z-ADD0         SMIN
     C                     Z-ADD1         SMAX
     C                     END
      *
     C                     ENDSR
      *
      *                                                                   CSE007
      *****************************************************************   CSE007
      *                                                                   CSE007
      *  SBCCHK - Looks at value of COTA ('CA Trade Subtypes on A/C Keys')CSE007
      *           on SDSTRDPD and assigns values of COMIN & COMAX, the    CSE007
      *           iteration parameters for array CST accordingly. i.e.    CSE007
      *           if trade subtypes are required, then the iteration must CSE007
      *           be performed between element no.4 & the value of COMAXS CSE007
      *           calculated in CSINIT. If subtypes not required, then it CSE007
      *           must be performed only once using the blank 1st element.CSE007
      *                                                                   CSE007
      *****************************************************************   CSE007
     C           SBCCHK    BEGSR                                          CSE007
      *                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     Z-ADD3         COMIN   10                      CSE007
     C                     Z-ADDCOMAXS    COMAX   20                      CSE007
     C                     ELSE                                           CSE007
     C                     Z-ADD0         COMIN                           CSE007
     C                     Z-ADD1         COMAX                           CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
     C                     ENDSR                                          CSE007
      *****************************************************************
      *
      *  NPACHK - Looks at value of NPAC ('Negative Position on A/C Keys')
      *           on TABTB36 and assigns values of NMIN & NMAX, the
      *           iteration parameters for array NEG accordingly. i.e.
      *           if negative positions are to be accounted for, then both
      *           the elements of the array must be used; if not, then
      *           the blank 1st element only is required.
      *
      *****************************************************************
     C           NPACHK    BEGSR
      *
     C                     Z-ADD0         NMIN
     C***********NPAC      IFEQ 'Y'                                       S01315
     C           BVNPAC    IFEQ 'Y'                                       S01315
     C                     Z-ADD2         NMAX
     C                     ELSE
     C                     Z-ADD1         NMAX
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  SNACHK - Looks at value of SNAC ('Split Negative Accrual')
      *           on SDBANKPD and assigns values of NMIN & NMAX, the
      *           iteration parameters for array NEG accordingly. i.e.
      *           if negative accruals are to be split from positive,
      *           requiring a separate key with an 'N' in position 15,
      *           then both elements of the array must be used.
      *
      *****************************************************************
     C           SNACHK    BEGSR
      *
     C                     Z-ADD0         NMIN
     C***********SNAC      IFEQ 'Y'                                       S01315
     C           BVSNIN    IFEQ 'Y'                                       S01315
     C                     Z-ADD2         NMAX
     C                     ELSE
     C                     Z-ADD1         NMAX
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  ADCHK - For DS,PR,DA & PA keys, this routine looks at the book
      *          code currently in use.
      *          The table below is used to determine the output or
      *          suppression of these keys.
      *
      *     GDPK       BDSTAM       TRBS      Output y/n
      *     ----        ----        ----      ----------
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CP11
     C*                         End S01408
      *      N           Y            D           Y
      *      N           N        not D           N
      *      N           Y        not D           Y
      *      N           N            D           N
      *      Y           Y            D           Y
      *      Y           N        not D           N
      *      Y           Y        not D           Y
      *      Y           N            D           Y
     C*                         Begin S01408
     C/COPY WNCPYSRC,AK0061CP12
     C*                         End S01408
      *
      *****************************************************************
     C           ADCHK     BEGSR
      *
     C***********GDPK      IFEQ 'N'                                       S01315
     C           BVGDPK    IFEQ 'N'                                       S01315
      *
     C           AMD,X3    DOWEQ'N'
      *
     C           X3        IFLT BMAXSV
     C                     ADD  1         X3
     C                     ELSE
     C                     MOVE 'N'       GFLAG
     C           X3        CABEQBMAXSV    AD9999
     C                     END
     C                     END
      *
     C                     ELSE
      *
     C           TRBS      IFNE 'D'
     C           AMD,X3    DOWEQ'N'
     C           X3        IFLT BMAXSV
     C                     ADD  1         X3
     C                     ELSE
     C                     MOVE 'N'       GFLAG
     C           X3        CABEQBMAXSV    AD9999
     C                     END
     C                     END
     C                     END
      *
     C                     END
      *
     C           AD9999    ENDSR
      *
      *****************************************************************
      *
      *  UPLCHK - Uses the value of POST (i.e. T or V) together with the
      *           amount code ATYPA and the ICD parameters SKTD and UPPS
      *           (Suppress Keys on Trade/Value date & Unrealised Profit
      *           Posting) to determine whether UP/UL keys should be output
      *           or suppressed.
      *
      *****************************************************************
     C           UPLCHK    BEGSR
     C                     MOVE 'N'       GFLAG
      *
     C           POST      IFEQ 'T'                        UP/L BASIS = T
      *
     C           ATYPA     IFEQ 'UP'                       UNR'LD PROFIT
     C***********UPPS      IFEQ 'P'                        PROFIT ONLY    S01315
     C           BVUPP     IFEQ 'P'                        PROFIT ONLY    S01315
     C***********UPPS      OREQ 'B'                        BOTH P & L     S01315
     C           BVUPP     OREQ 'B'                        BOTH P & L     S01315
     C***********SKTD      IFNE 'T'                        NO SUPPRESSION S01315
     C           BVSKTV    IFNE 'T'                        NO SUPPRESSION S01315
     C                     MOVE 'Y'       GFLAG
     C                     END
     C                     END
      *
     C                     ELSE                            ELSE UL KEY
      *
     C***********UPPS      IFEQ 'L'                        LOSS ONLY      S01315
     C           BVUPP     IFEQ 'L'                        LOSS ONLY      S01315
     C***********UPPS      OREQ 'B'                        BOTH P & L     S01315
     C           BVUPP     OREQ 'B'                        BOTH P & L     S01315
     C***********SKTD      IFNE 'T'                        NO SUPPRESSION S01315
     C           BVSKTV    IFNE 'T'                        NO SUPPRESSION S01315
     C                     MOVE 'Y'       GFLAG
     C                     END
     C                     END
     C                     END
      *
     C                     ELSE                            UP/L BASIS=V
      *
     C           ATYPA     IFEQ 'UP'                       UNR'LD PROFIT
     C***********UPPS      IFEQ 'P'                        PROFIT ONLY    S01315
     C           BVUPP     IFEQ 'P'                        PROFIT ONLY    S01315
     C***********UPPS      OREQ 'B'                        BOTH P & L     S01315
     C           BVUPP     OREQ 'B'                        BOTH P & L     S01315
     C***********SKTD      IFNE 'V'                        NO SUPPRESSION S01315
     C           BVSKTV    IFNE 'V'                        NO SUPPRESSION S01315
     C                     MOVE 'Y'       GFLAG
     C                     END
     C                     END
      *
     C                     ELSE                            ATYPA=UL
      *
     C***********UPPS      IFEQ 'L'                        LOSS ONLY      S01315
     C           BVUPP     IFEQ 'L'                        LOSS ONLY      S01315
     C***********UPPS      OREQ 'B'                        BOTH P & L     S01315
     C           BVUPP     OREQ 'B'                        BOTH P & L     S01315
     C***********SKTD      IFNE 'V'                        NO SUPPRESSION S01315
     C           BVSKTV    IFNE 'V'                        NO SUPPRESSION S01315
     C                     MOVE 'Y'       GFLAG
     C                     END
     C                     END
      *
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *  OUTPUT - IF key not already on either SEACKD or XSEACKD:
      *                - Output record to XSEACKD.
      *                - Increment output record count.
      *                - Write a record to report.
      *           ELSE                                                    AK0010
      *                - Blank out record to avoid spurious entries.      AK0010
      *           ENDIF
      *
      *****************************************************************
     C           OUTPUT    BEGSR
     C                     SETOF                     9899
      *
      *  Chain to both live and generated files to avoid duplication.
      ***If*not*found*on*either*produce key.                              E40664
      *  If not found on either, check template. If template non blank,   E40664
      *  chain to TSEACK to see if a corresponding template key exists andE40664
      *  if so, retrieve accounting.                                      E40664
      *
     C           AKEY      CHAINSEACKDF              99
     C           AKEY      CHAINXSEACKDF             98
      *
     C           *IN99     IFEQ '1'
     C           *IN98     ANDEQ'1'
      *
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           ATYPA     ANDNE'ET'                                                          CGL031
     C           ATYPA     ANDNE'NI'                                                          CGL031
     C           CGL031    OREQ 'N'                                                           CGL031
     C                     MOVE *BLANKS   ACCTG                           E40664
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TEMP      IFNE *BLANKS                                   E40664
     C***********          MOVE *BLANKS   TMPKEY 20                E40664 100986
     C                     MOVE *BLANKS   TMPKEY                          100986
     C                     MOVE AKEY      TMPKEY                          E40664
     C                     MOVELTEMP      TMPKEY                          E40664
     C           BOOK      IFNE '  '                                      100986
     C           TEMPB     ANDNE'  '                                      100986
     C                     MOVE TEMPB     TMPBOK                          100986
     C                     END                                            100986
     C           TMPKEY    CHAINTSEACK               97                   E40664
     C           *IN97     IFEQ '0'                                       E40664
     C                     MOVE RACCTG    ACCTG                           E40664
     C*                                                                   068174
     C** IF NOT FOUND ON TEMPLATE, DO NOT USE PREVIOUS KEYS' ACCOUNTING   068174
     C** DETAILS. RESET THE DATA STRUCTURES CONTENTS.                     068174
     C*                                                                   068174
     C                     ELSE                                           068174
     C                     CLEARACCTG                                     068174
     C                     CLEARRACCTG                                    066211
     C                     END                                            E40664
     C                     END                                            E40664
      *                                                                   E40664
     C                     MOVE 'D'       RECI
     C                     MOVE AKEY      ACKE
     C                     WRITEXSEACKDF
      *
     C                     ADD  1         OUTREC
      *
      *   If LIN is not full, move a/c key to next element.
      *
     C           L         IFNE 5
      *
      *   Increment LIN index by 1.
      *
     C                     ADD  1         L
     C                     MOVE AKEY      LIN,L
      *
      *   Otherwise do overflow check......
      *
     C                     ELSE
     C           OFLLN1    SUB  PRTLN1    DIFLN1  20
     C           DIFLN1    IFLE RQDLN1
     C***********          WRITESE4010HF                                  S01315
     C                     WRITEAK0061HF                                  S01315
     C                     END
      *
      **********and*if*overflow*not*required**print*a*detail*line*and     S01315
      *   ......and print a detail line and                               S01315
      *   set L to 1. Move next key to LIN,1.
      *
     C***                  ELSE                                           S01315
     C                     MOVE LIN,1     KEY1
     C                     MOVE LIN,2     KEY2
     C                     MOVE LIN,3     KEY3
     C                     MOVE LIN,4     KEY4
     C                     MOVE LIN,5     KEY5
     C***********          WRITESE4010DF                                  S01315
     C                     WRITEAK0061DF                                  S01315
      *                                                                   AK0003
      *  Must blank out array here to prevent duplication on last line.   AK0003
      *                                                                   AK0003
     C                     MOVEA*BLANKS   LIN                             AK0003
     C                     Z-ADD1         L
     C                     MOVE AKEY      LIN,L
     C                     END
     C***                  END                                            S01315
      *                                                                   AK0010
     C                     ELSE                                           AK0010
      *                                                                   AK0010
      *  Else record found on live file...blank out a/c codes, narratives AK0010
      *  posting refs. to prevent spurious entries appearing on next      AK0010
      *  update.                                                          AK0010
      *                                                                   AK0010
     C                     Z-ADD0         ACD1                            AK0010
     C                     Z-ADD0         ACD2                            AK0010
     C                     Z-ADD0         ACD3                            AK0010
     C                     Z-ADD0         ACD4                            AK0010
     C                     Z-ADD0         ACD5                            AK0010
     C                     Z-ADD0         ACD6                            AK0010
     C************         Z-ADD0         NCD1                      AK0010081884
     C************         Z-ADD0         NCD2                      AK0010081884
     C************         Z-ADD0         NCD3                      AK0010081884
     C************         Z-ADD0         NCD4                      AK0010081884
     C************         Z-ADD0         NCD5                      AK0010081884
     C************         Z-ADD0         NCD6                      AK0010081884
     C                     MOVE *BLANKS   NCDA1                           081884
     C                     MOVE *BLANKS   NCDA2                           081884
     C                     MOVE *BLANKS   NCDA3                           081884
     C                     MOVE *BLANKS   NCDA4                           081884
     C                     MOVE *BLANKS   NCDA5                           081884
     C                     MOVE *BLANKS   NCDA6                           081884
     C                     Z-ADD0         PRF1                            AK0010
     C                     Z-ADD0         PRF2                            AK0010
     C                     Z-ADD0         PRF3                            AK0010
     C                     Z-ADD0         PRF4                            AK0010
     C                     Z-ADD0         PRF5                            AK0010
     C                     Z-ADD0         PRF6                            AK0010
     C                     END
      *
     C                     ENDSR
      *****************************************************************                       CSE065
      /EJECT                                                                                  CSE065
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  SRBKEQ - Additional Account Keys be Generated for Books with *                       CSE065
      *           Mark to Market set to 'Y' and Amortise Discounts    *                       CSE065
      *           set either 'Y' or 'C'.                              *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           SRBKEQ    BEGSR                                                              CSE065
      *                                                                                       CSE065
      ** Classification = Blank                                                               CSE065
      *                                                                                       CSE065
     C                     MOVE *ON       *IN21                                               CSE065
     C                     Z-ADD1         DMAX                                                CSE065
      *                                                                                       CSE065
      ** Book Code = all values specified on screen with                                      CSE065
      *                                                                                       CSE065
     C                     Z-ADD1         BMIN                                                CSE065
     C                     Z-ADDBMAXSV    BMAX                                                CSE065
      *                                                                                       CSE065
      ** Posting Basis = Blank                                                                CSE065
      ** CO Sub-type = Blank                                                                  CSE065
      *                                                                                       CSE065
     C                     Z-ADD0         COMIN                                               CSE065
     C                     Z-ADD1         COMAX                                               CSE065
      *                                                                                       CSE065
      ** Charge/Commission Type = Blank                                                       CSE065
      *                                                                                       CSE065
     C                     Z-ADD0         CMIN                                                CSE065
     C                     Z-ADD1         CMAX                                                CSE065
      *                                                                                       CSE065
      ** Market = all specified on the screen                                                 CSE065
      *                                                                                       CSE065
     C                     Z-ADD1         MMIN                                                CSE065
     C                     Z-ADDMMAXSV    MMAX                                                CSE065
      *                                                                                       CSE065
      ** Negative Position = Either 'N' or Blank depends on SE-ICD                            CSE065
      *                                                                                       CSE065
     C                     EXSR NPACHK                                                        CSE065
      *                                                                                       CSE065
      ** Country Code = Blank                                                                 CSE065
      *                                                                                       CSE065
     C                     Z-ADD0         CYMIN                                               CSE065
     C                     Z-ADD1         CYMAX                                               CSE065
      *                                                                                       CSE065
      ** Execute only if Mark to Market = 'Y', Yield Amort = 'Y' or 'C',                      CSE065
      ** and Include In A/C Key = 'Y'                                                         CSE065
      *                                                                                       CSE065
     C           BDSTRM    IFEQ 'Y'                                                           CSE065
     C           BDSTAM    ANDEQ'Y'                                                           CSE065
     C           BDSTRM    OREQ 'Y'                                                           CSE065
     C           BDSTAM    ANDEQ'C'                                                           CSE065
     C                     EXSR GEN02                                                         CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE *OFF      *IN21                                               CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGNET - Generates EU Withholding Tax a/c keys.              *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGNET    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Trade Type will always be blank.                                                     CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TMIN                                                CGL031
     C                     Z-ADD1         TMAX                                                CGL031
      *                                                                                       CGL031
      ** Book Code will always be blank.                                                      CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     BMIN                                                CGL031
     C                     Z-ADD1         BMAX                                                CGL031
      *                                                                                       CGL031
      ** Generate keys for Depot, Safe Custody, & Discretionary customers.                    CGL031
      *                                                                                       CGL031
     C                     Z-ADDD3END     DMAX                                                CGL031
     C                     MOVE *ON       *IN23                                               CGL031
      *                                                                                       CGL031
      ** Charge Code will always be blank.                                                    CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     CMIN                                                CGL031
     C                     Z-ADD1         CMAX                                                CGL031
      *                                                                                       CGL031
      ** Trade Sub-type will always be blank.                                                 CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     SMIN                                                CGL031
     C                     Z-ADD1         SMAX                                                CGL031
      *                                                                                       CGL031
     C                     EXSR SRGN03                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE *OFF      *IN23                                               CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGNNI - Generates Net Interest Due a/c keys.                *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGNNI    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** User Position                                                                        CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TMIN                                                CGL031
     C                     Z-ADD1         TMAX                                                CGL031
     C                     Z-ADD1         DMAX                                                CGL031
     C                     Z-ADD1         BMIN                                                CGL031
     C                     Z-ADDBMAXSV    BMAX                                                CGL031
     C                     Z-ADD*ZERO     SMIN                                                CGL031
     C                     Z-ADD1         SMAX                                                CGL031
     C                     Z-ADD*ZERO     CMIN                                                CGL031
     C                     Z-ADD1         CMAX                                                CGL031
     C                     Z-ADD*ZERO     NMIN                                                CGL031
     C                     Z-ADD1         NMAX                                                CGL031
     C                     MOVE *ON       *IN21                                               CGL031
     C                     EXSR SRGN03                                                        CGL031
     C                     MOVE *OFF      *IN21                                               CGL031
      *                                                                                       CGL031
      ** Customer/Depot Position                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDD3END     DMAX                                                CGL031
     C                     Z-ADD*ZERO     BMIN                                                CGL031
     C                     Z-ADD1         BMAX                                                CGL031
     C                     EXSR SNACHK                                                        CGL031
     C                     MOVE *ON       *IN23                                               CGL031
     C                     EXSR SRGN03                                                        CGL031
     C                     MOVE *OFF      *IN23                                               CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRSWTA - Sets the EU Withholding Tax a/c key values.         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRSWTA    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** EU Withholding Tax                                                                   CGL031
      *                                                                                       CGL031
     C           ATYPA     IFEQ 'ET'                                                          CGL031
     C                     MOVE WCCA,I    CTRYCD                                              CGL031
     C                     Z-ADD*ZERO     ACD1                                                CGL031
     C                     MOVE *BLANKS   NCDA1                                               CGL031
     C                     Z-ADD*ZERO     PRF1                                                CGL031
     C                     MOVE WTAA,I    ACD4                                                CGL031
     C                     MOVE '01'      NCDA4                                               CGL031
     C                     Z-ADD1         PRF4                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Net Interest Due                                                                     CGL031
      *                                                                                       CGL031
     C           ATYPA     IFEQ 'NI'                                                          CGL031
     C                     MOVE *BLANKS   CTRYCD                                              CGL031
     C                     Z-ADD*ZERO     ACD1                                                CGL031
     C                     MOVE *BLANKS   NCDA1                                               CGL031
     C                     Z-ADD*ZERO     PRF1                                                CGL031
     C                     Z-ADD*ZERO     ACD4                                                CGL031
     C                     MOVE *BLANKS   NCDA4                                               CGL031
     C                     Z-ADD*ZERO     PRF4                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGN03 - SR/GEN01 for EU Withholding Tax accounting.         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGN03    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Trade Type                                                                           CGL031
      ** ----------                                                                           CGL031
      ** Use all values of TTP between TMIN & TMAX.                                           CGL031
      *                                                                                       CGL031
     C                     Z-ADDTMIN      X1      10                                          CGL031
     C           X1        DOWLTTMAX                                                          CGL031
     C                     ADD  1         X1                                                  CGL031
     C                     MOVE TTP,X1    TTYP                                                CGL031
      *                                                                                       CGL031
      ** Classification                                                                       CGL031
      ** --------------                                                                       CGL031
      ** Use all values of the appropriate DS- array from 0 to the                            CGL031
      ** corresponding end value D1END, D2END or D3END.                                       CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     X2      10                                          CGL031
     C           X2        DOWLTDMAX                                                          CGL031
     C                     ADD  1         X2                                                  CGL031
      *                                                                                       CGL031
     C           *IN21     IFEQ *ON                                                           CGL031
     C                     MOVE DS1,X2    DIND                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           *IN22     IFEQ *ON                                                           CGL031
     C                     MOVE DS2,X2    DIND                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           *IN23     IFEQ *ON                                                           CGL031
     C                     MOVE DS3,X2    DIND                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           *IN24     IFEQ *ON                                                           CGL031
     C                     MOVE DS4,X2    DIND                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Book Code                                                                            CGL031
      ** ---------                                                                            CGL031
      ** Use all values of BKS betweem BMIN & BMAX.                                           CGL031
      *                                                                                       CGL031
     C                     Z-ADDBMIN      X3      20                                          CGL031
     C           X3        DOWLTBMAX                                                          CGL031
     C                     ADD  1         X3                                                  CGL031
      *                                                                                       CGL031
     C           BKS,X3    CHAIN@BDREDK              99                                       CGL031
     C           BINAK     IFEQ 'N'                                                           CGL031
     C                     MOVE *BLANKS   BOOK                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE BKS,X3    BOOK                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Subtypes/Posting Basis                                                               CGL031
      ** ----------------------                                                               CGL031
      ** Values of STP between SMIN & SMAX.                                                   CGL031
      *                                                                                       CGL031
     C                     Z-ADDSMIN      X4      20                                          CGL031
     C           X4        DOWLTSMAX                                                          CGL031
     C                     ADD  1         X4                                                  CGL031
     C                     MOVE STP,X4    STYP                                                CGL031
      *                                                                                       CGL031
      ** Charge/Commission Type                                                               CGL031
      ** ----------------------                                                               CGL031
      ** Values of CCD from CMIN to CMAX.                                                     CGL031
      *                                                                                       CGL031
     C                     Z-ADDCMIN      X5      20                                          CGL031
     C           X5        DOWLTCMAX                                                          CGL031
     C                     ADD  1         X5                                                  CGL031
     C                     MOVE CCD,X5    CTYP                                                CGL031
      *                                                                                       CGL031
      ** Market Indicator                                                                     CGL031
      ** ----------------                                                                     CGL031
      ** Values of MRK from MMIN to MMAX.                                                     CGL031
      *                                                                                       CGL031
     C                     Z-ADDMMIN      X6      10                                          CGL031
     C           X6        DOWLTMMAX                                                          CGL031
     C                     ADD  1         X6                                                  CGL031
     C                     MOVE MRK,X6    MARK                                                CGL031
      *                                                                                       CGL031
      ** Convertible Indicator                                                                CGL031
      ** ---------------------                                                                CGL031
      ** Values of CVT from 0 to VMAX.                                                        CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     X7      10                                          CGL031
     C           X7        DOWLTVMAX                                                          CGL031
     C                     ADD  1         X7                                                  CGL031
     C                     MOVE CVT,X7    CONV                                                CGL031
      *                                                                                       CGL031
      ** Negative Position/Accrual                                                            CGL031
      ** -------------------------                                                            CGL031
      ** Values of NEG from NMIN to NMAX.                                                     CGL031
      *                                                                                       CGL031
     C                     Z-ADDNMIN      X8      10                                          CGL031
     C           X8        DOWLTNMAX                                                          CGL031
     C                     ADD  1         X8                                                  CGL031
     C                     MOVE NEG,X8    NEGI                                                CGL031
      *                                                                                       CGL031
      ** Report EU Withholding Tax Countries & A/c Codes.                                     CGL031
      *                                                                                       CGL031
     C                     CLEARWTAA                                                          CGL031
     C                     CLEARWCCA                                                          CGL031
     C                     MOVEAEWTA      WTAA                                                CGL031
     C                     MOVEAEWTC      WCCA                                                CGL031
      *                                                                                       CGL031
     C                     DO   10        I       20                                          CGL031
      *                                                                                       CGL031
     C           WCCA,I    IFNE *BLANKS                                                       CGL031
     C                     EXSR SRSWTA                                                        CGL031
     C                     EXSR OUTPUT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************
      /EJECT                                                              CSE015
      *****************************************************************   CSE015
      *                                                               *   CSE015
      *  *PSSR - Subroutine to handle abnormal error conditions       *   CSE015
      *                                                               *   CSE015
      *  Called By: After Abnormal Operation Occurs                   *   CSE015
      *                                                               *   CSE015
      *  Calls    : None                                              *   CSE015
      *                                                               *   CSE015
     C*****************************************************************   CSE015
      *                                                                   CSE015
     C           *PSSR     BEGSR                                          CSE015
      *                                                                   CSE015
     C                     MOVE *ON       *INU7                           CSE015
     C                     MOVE *ON       *INU8                           CSE015
     C                     MOVE *ON       *INLR                           CSE015
      *                                                                   CSE015
     C           @RUN      IFEQ *BLANKS                                   CSE015
     C                     MOVE 'Y'       @RUN    1                       CSE015
     C                     DUMP                                           CSE015
     C                     END                                            CSE015
     C                     ENDSR                                          CSE015
      *                                                                   CSE015
     C********************************************************************CSE015
      /EJECT                                                              CSE015
      *****************************************************************
      *****SUBROUTINE- ZICDSE                                             S01315
      *****ACCESS ICD RECORD FROM TABTB36 FOR SECURITIES TRADING          S01315
      **********                                                          S01315
      ***1.TABTB36 MUST BE DECLARED IN THE PROGRAM                        S01315
      ***2.ON RETURN FROM THIS S/R THE PROGRAM MUST CHECK *IN99 -         S01315
      *****AND IF ON MUST EXECUTE DATABASE ERROR PROCESSING               S01315
      **********                                                          S01315
      ********************************************************************S01315
      **********                                                          S01315
     C********** ZICDSE    BEGSR                           *** ZICDSE *** S01315
      **********                                                          S01315
     C**********           MOVEL'01      'ZTABKY 12                       S01315
     C**********           MOVE '  36'    ZTABKY                          S01315
      **********                                                          S01315
     C********** ZTABKY    CHAINTABTB36F             99                   S01315
      **ERROR*IF NO RECORD FOUND OR IF IT IS DELETED                      S01315
     C********** *IN99     IFNE '1'                                       S01315
     C********** RECI      IFNE 'D'                                       S01315
     C**********           SETON                     99                   S01315
     C**********           END                                            S01315
     C**********           END                                            S01315
     C**********           ENDSR                                          S01315
      **********                                                          S01315
      ********************************************************************S01315
     C/COPY WNCPYSRC,AK0061C004
      /EJECT                                                              S01315
      **   EVT - Add 'X' into the Event Code array                        CSE007
      *
**   EVT - Event codes for use in main processing
TVSPACHLMRX                                                               CSE007
**   TTP - Trade types
 PS
**   CVT - Convertible indicator
 Y
**   NEG - Negative position/Negative accrual indicator
 N
