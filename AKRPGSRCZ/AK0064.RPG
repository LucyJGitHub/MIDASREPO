     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AK SE A/C Key Gen. - Update Audit Rec')
      *****************************************************************
      *                                                               *
      *  Midas - Account Key Generator                                *
      *                                                               *
      *  AK0064 - SE A/c Key Generation - Update Live Audit Record.   *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. BUG12646           Date 14Nov06               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. 081884             Date 17Jan95               *
      *                 S01315             Date 12Dec90               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  BUG12646 - Cater for SEACKA file control length increase     *
      *  081884 - NARRATIVE CODE IS NOW ALPHA - RECOMPILE             *
      *  S01315 - Change to SD standards                              *
      *           Program name changed from SE4040 to AK0064.         *
      *                                                               *
      *****************************************************************
     F*****************************************************************
     FXSEACKD IF  E                    DISK
     FSEACKA  UF  E                    DISK
      *
      *   INDICATOR USAGE
      *   ---------------
      *   10      XSEACKD end-of-file.
      *   20      SEACKA end-of-file.
      *   U8      SEACKA not found - database error.
      *
     E*****************************************************************
     E*                                                                   S01315
     E                    CPY@    1   1 80                                S01315
     E** Copyright array                                                  S01315
     E*                                                                   S01315
      *
      *  LDA for database error
      *
     I*LDA        UDS                            256                      S01315
     I************                          134 177 DBLOT                 S01315
     I************                          134 138 DBFILE                S01315
     I************                          139 167 DBKEY                 S01315
     I************                          168 175 DBPGM                 S01315
     I************                          176 177 DBASE                 S01315
     ILDA         DS                            256                       S01315
     I                                      134 183 DBLOT                 S01315
     I                                      134 141 DBFILE                S01315
     I                                      142 170 DBKEY                 S01315
     I                                      171 180 DBPGM                 S01315
     I                                      181 1830DBASE                 S01315
     I*                                                                   S01315
     ICPYR@#      DS                                                      S01315
     I                                        1  80 CPY@                  S01315
     I                                        1  20 CPY@##                S01315
     I** Data Structure for Compilation  - Copyright Insertion            S01315
     C*****************************************************************
      *
      * Prepare LDA
      *
     C           *NAMVAR   DEFN           LDA
     C                     MOVE *BLANKS   DBLOT
     C***********          MOVEL'SE4040'  DBPGM                           S01315
     C                     MOVEL'AK0064'  DBPGM                           S01315
      *
     C                     Z-ADD0         COUNT
      *
      ** Read through generated a/c keys, selecting out only those
      ** which will have been transferred, i.e. those with RECI = 'D'.
      *
     C           *IN10     DOWEQ'0'
     C************         READ XSEACKDF                 10               081884
     C                     READ TSEACKDF                 10               081884
     C           *IN10     IFEQ '0'
     C           RECI      IFEQ 'D'
     C**********           ADD  1         COUNT   40                                        BUG12646
     C                     ADD  1         COUNT  100                                        BUG12646
     C                     END
     C                     END
     C                     END
      *
      ** Read in SEACKA, & update both the number of insertions and the
      ** total number of records on the file.
      *
     C                     READ SEACKAF                  20
     C           *IN20     IFEQ '0'
     C**********           ADD  COUNT     SINS                                              BUG12646
     C                     ADD  COUNT     SINS10                                            BUG12646
     C**********           ADD  COUNT     NORE                                              BUG12646
     C                     ADD  COUNT     NORE10                                            BUG12646
     C                     UPDATSEACKAF
     C                     SETON                     LR
     C                     ELSE
      *
      ** If SEACKA not present - database error.
      *
     C           *LOCK     IN   LDA                                       S01315
     C                     MOVEL'AK0064'  DBPGM                           S01315
     C***********          MOVE '01'      DBASE             ************  S01315
     C                     Z-ADD001       DBASE             ************  S01315
     C                     MOVEL'SEACKA'  DBFILE            * DATABASE *
     C                     MOVEL'AUDIT'   DBKEY             * ERROR 01 *
     C***********          SETON                     U8LR   ************  S01315
     C                     EXSR DBERR                                     S01315
     C                     END
     C********************************************************************S01315
      /EJECT                                                              S01315
     C********************************************************************S01315
     C*                                                                   S01315
     C* DBERR - Database error processing                                 S01315
     C*                                                                   S01315
     C* Calls     : None                                                  S01315
     C*                                                                   S01315
     C********************************************************************S01315
     C           DBERR     BEGSR                                          S01315
     C*                                                                   S01315
     C                     SETON                     U7U8LR               S01315
     C                     DUMP                                           S01315
     C                     OUT  LDA                                       S01315
     C                     RETRN                                          S01315
     C*                                                                   S01315
     C                     ENDSR                                          S01315
     C********************************************************************S01315
**  CPY@                                                                  S01315
(c) Misys International Banking Systems Ltd. 2001
