/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI *  TEXT('Midas AO AOSPOSU0 wrapper for Standing Orders API')   */
/*********************************************************************/
/*                                                                   */
/*       Midas - Access Objects                                      */
/*                                                                   */
/********AOC000010 - AOSPOSU0 wrapper for Standing Orders API        */                   /*236189*/
/*       AOC000010 - AOSPOSU0 wrapper for Retail module              */                   /*236189*/
/*                                                                   */
/*       (c) Misys International Banking Systems Ltd. 2004           */
/*                                                                   */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/*       Last Amend No. 247922             Date 05Jun07              */
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/*       Prev Amend No. 239164             Date 30Mar06              */
/*                      238797             Date 08Mar06              */
/*                      236189             Date 08Apr05              */
/*                      BUG4606 *CREATE    Date 27Oct04              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       247922 - Applied core fix 239164.                           */
/*       239164 - Added parm to AO000011.                            */
/*       238797 - Create trace data when calling this program from   */
/*                 Java.  Applied fix 236189                         */
/*       236189 - Create trace data when calling this program from   */
/*                 Java.                                             */
/*       BUG4606 - AOSPOSU0 wrapper for RPG processing.              */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&PRTCD &PACTN &PIDTA)
 
             DCL        VAR(&PRTCD) TYPE(*CHAR) LEN(7)
             DCL        VAR(&PACTN) TYPE(*CHAR) LEN(8)
             DCL        VAR(&PIDTA) TYPE(*CHAR) LEN(256)
             DCL        VAR(&ZZDTA) TYPE(*CHAR) LEN(256)                                  /*236189*/
             DCL        VAR(&ARTCD) TYPE(*CHAR) LEN(7)                                    /*236189*/
             DCL        VAR(&BRTCD) TYPE(*CHAR) LEN(7)                                    /*236189*/
             DCL        VAR(&TRANSTYPE) TYPE(*CHAR) LEN(4)                                /*239164*/
             DCL        VAR(&PIGDC) TYPE(*CHAR) LEN(1)                                    /*239164*/
             DCL        VAR(&PJRTC) TYPE(*CHAR) LEN(256)                                  /*239164*/
 
             COPYRIGHT TEXT('(c) Misys International Banking Systems Ltd. +
                          2004')
 
/* Global Monitor Message */
 
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
             CHGJOB     SWS(XXXXXX00)
                                                                                          /*236189*/
/** Set Return Code to *ABNOR* because this program can end unexpectedly        */        /*236189*/
/**    because the ABNOR tag might not be run and the JAVA side doesn't know it */        /*236189*/
                                                                                          /*236189*/
             CHGVAR     VAR(&BRTCD) VALUE(&PRTCD)                                         /*236189*/
             CHGVAR     VAR(&PRTCD) VALUE('*ABNOR*')                                      /*236189*/
             CHGVAR     VAR(&ZZDTA) VALUE(&PIDTA)                                         /*236189*/
                                                                                          /*236189*/
             CHGJOB     LOG(4 00 *MSG) LOGCLPGM(*YES) INQMSGRPY(*DFT)                     /*236189*/
                                                                                          /*236189*/
/** Send status message to message queue */                                               /*236189*/
                                                                                          /*236189*/
             IF         COND(&PACTN *EQ '*UPDATE') THEN( +
                SNDPGMMSG MSG('AOC000010 - Shadow Post Wrapper for +
                          JAVA with action = ' *CAT &PACTN) TOMSGQ(MOPERQ))               /*236189*/
                                                                                          /*236189*/
             ELSE       CMD( +
                SNDPGMMSG  MSG('AOC000010 - Shadow Post Wrapper for +
                           JAVA with action = ' *CAT &PACTN))                             /*236189*/
 
/** Call Trace program to dump parameter from JAVA to PF */                               /*236189*/
                                                                                          /*236189*/
/**********  CALL       PGM(AO000011) PARM(&ARTCD ' ' &BRTCD &PACTN +  */                 /*239164*/
/**********               &PIDTA)                                      */          /*236189 239164*/
             CALL       PGM(AO000011) PARM(&ARTCD ' ' &TRANSTYPE +
                          &BRTCD &PACTN &PIDTA &PJRTC &PIGDC)                             /*239164*/
                                                                                          /*236189*/
             IF         COND(&ARTCD *NE '       ') THEN(DO)                               /*236189*/
                SNDPGMMSG  MSG('AOC000010 - Program AO000011 ended in +
                                error(1st run).  AOSPOSU0 will still be +
                                called') TOMSGQ(MOPERQ) MSGTYPE(*INFO)                    /*236189*/
             ENDDO                                                                        /*236189*/
                                                                                          /*236189*/
             IF         COND(&PACTN *EQ '*UPDATE ') THEN(STRCMTCTL +
                          LCKLVL(*CHG) CMTSCOPE(*JOB))
 
/**********  CALL       PGM(AOSPOSU0) PARM(&PRTCD &PACTN &PIDTA) */                       /*236189*/
/**********                                                      */                       /*236189*/
/**********  IF         COND(&PRTCD *EQ '*ERROR*') THEN(GOTO +   */                       /*236189*/
/**********               CMDLBL(ABNOR))                         */                       /*236189*/
                                                                                          /*236189*/
             CHGVAR     VAR(&ARTCD) VALUE('       ')                                      /*236189*/
                                                                                          /*236189*/
             CALL       PGM(AOSPOSU0) PARM(&ARTCD &PACTN &PIDTA)                          /*236189*/
                                                                                          /*236189*/
             IF         COND(&ARTCD *NE '       ') THEN(DO)                               /*236189*/
                CHGVAR     VAR(&PRTCD) VALUE(&ARTCD)                                      /*236189*/
                GOTO       CMDLBL(ABNOR)                                                  /*236189*/
             ENDDO                                                                        /*236189*/
                                                                                          /*236189*/
/** Call Trace program again if the parameter was changed by AOSPOSU0                     /*236189*/
/** Set 2nd paramter to 'Y' (field AOBUFC)                                                /*236189*/
                                                                                          /*236189*/
             IF         COND(&PIDTA *NE &ZZDTA) THEN(DO)                                  /*236189*/
/**********     CALL       PGM(AO000011) PARM(&ARTCD 'Y' &BRTCD +  */                     /*239164*/
/**********                  '**CHNG*' &PIDTA)                     */              /*236189 239164*/
                CALL       PGM(AO000011) PARM(&ARTCD 'Y' &TRANSTYPE +
                          &BRTCD '**CHNG*' &PIDTA &PJRTC &PIGDC)                          /*239164*/
                IF      COND(&ARTCD *NE '       ') THEN( +
                SNDPGMMSG  MSG('AOC000010 - Program AO000011 ended in +
                                error(2nd run).  AOSPOSU0 will still be +
                                called') TOMSGQ(MOPERQ) MSGTYPE(*INFO))                   /*236189*/
                ENDDO                                                                     /*236189*/
                                                                                          /*236189*/
             CHGVAR     VAR(&PRTCD) VALUE('       ')                                      /*236189*/
 
             GOTO       CMDLBL(END)
 
/* Abnormal Termination */
 
ABNOR:
             CHGJOB     SWS(XXXXXX11)
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000)                                    /*236189*/
             DMPCLPGM
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000)                                    /*236189*/
             SNDPGMMSG MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
                          AOC000010 ended abnormally - see job log') +
                          TOMSGQ(MRUNQ MOPERQ)                                            /*236189*/
/**********               TOMSGQ(MOPERQ) */                                               /*236189*/
             MONMSG     MSGID(CPF0000 MCH0000)
             IF         COND(&PRTCD *EQ '       ') THEN(DO)                               /*236189*/
                CHGVAR     VAR(&PRTCD) VALUE('*ABNOR*')                                   /*236189*/
                MONMSG     MSGID(CPF0000 MCH0000 RPG0000)                                 /*236189*/
             ENDDO                                                                        /*236189*/
 
/* Program End */
 
END:
             ENDPGM
