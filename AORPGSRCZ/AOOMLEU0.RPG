     H        1
     F********************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AO On-line update of LE position files')         *
/*OVRF*: OVRDBF AOLOAN   CLOAN                                      : *   CLE033
      *****************************************************************
      *                                                               *
      *  Midas - Access Objects Module                                *
      *                                                               *
      *  AOOMLEU0 - On-line Update of LE Positions Files              *
      *                                                               *
      *  (c) Finastra International Limited 2002                      *
      *                                                               *
      *  Last Amend No. CER050             Date 16Jun19               *
      *  Prev Amend No. MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *      
      *                 MD047554           Date 11Oct17               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 AR943686           Date 23Sep16               *
      *                 MD035938           Date 08Jan16               *
      *                 CLE154             Date 07Aug12               *
      *                 MD028338           Date 25Nov14               *
      *                 AR868380           Date 18Jun13               *
      *                 AR799918           Date 18Jun13               *
      *                 AR830785           Date 07May13               *
      *                 260891             Date 17Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 264065             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             DATE 23Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247544             Date 16May07               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 224582             Date 06Jun06               *
      *                 CLE042             Date 06Sep05               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8962            Date 13Oct05               *
      *                 CLE106             Date 01Aug04               *
      *                 227696             Date 03Jun04               *
      *                 CLE038             Date 10May04               *
      *                 218984R (reopen)   Date 05Nov03               *
      *                 221505             Date 27Oct03               *
      *                 CIR013             Date 25Apr05               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 30Oct03               *
      *                 218984             Date 14Oct03               *
      *                 220754             Date 02Sep03               *
      *                 220257             Date 31Jul03               *
      *                 218782             Date 23Jun03               *
      *                 CLE034(revision)   Date 19Jun03               *
      *                 CLE034             Date 05May03               *
      *                 CLE033             Date 26Mar03               *
      *                 CLE031             Date 07Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205504             Date 10Jun02               *
      *                 204130             Date 29Apr02               *
      *                 201672  *CREATE    Date 29Apr02               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *      
      *  MD047554 - Create shadow postings of INTEREST and MATURITY   *
      *             with recalculated amount based on newly inserted, *
      *             amended, or reversed MR, RE, PI, SC, or BC.       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *      
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  AR943686 - CLE031. System generating wrong projected move-   *
      *             ments. Populate settlement details field with     *
      *             passed value. (Child: AR943687)                   *
      *           - Applied for MD-40690                              *
      *  MD035938 - Incorrect negative entries to RSACMTPD after      *
      *             changing maturity date of the loan. Move ZIEND    *
      *             to WLICD at the end of SR/SRINCL. It would be     *
      *             executed even when WCUPR or WCURT is zero.        *
      *             Pattern after fix AR1001269.                      *
      *  CLE154 - Loan Repayment Schedule Enhancement                 *
      *  MD028338 - Interest calculation has rounding difference for  *
      *             Rollover of Facility Exchange Rate only. Add new  *
      *             field to flag the rollover as 'FX Rate Change     *
      *             Only'. If this is Y, skip interest calculation.   *
      *           - Skip also SRINCL when AMTPH = LS or MI            *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR799918 - Extend fix AR691432. (Child: AR799919)            *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Extended core fix 263533. (Child: AR830786)       *
      *  260891 - Wrong projection in LOAC. Add LCD as a key.         *
      *           Recompiled due to changes in LF/HISTR.              *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  264065 - Incorrect projection of maturity interest amount    *
      *           when a backvalued MR was inserted.                  *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  224582 - (Reopen) Interest capitalisation was not projected  *
      *           at maturity.                                        *
      *  224582 - Do no generate interest projections for capitalised *
      *           interest.                                           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8962- Wrong posting in LEHOSTPD for Receipt Settlement    *
      *           Method 9                                            *
      *  CLE106 - Syndications Manager.                               *
      *  227696 - Need to reset the saved pay and receive settlement  *
      *           currencies to blank if using settlement allocations *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  218984R- 218984 reopened.                                    *
      *  221505 - Need to ensure the interest has been calculated up  *
      *           to the next interest payment date, if it is a call  *
      *           loan. Interest calculations need to take rollovers  *
      *           into account                                        *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC, ZINTDY, ZDLINT and ZCBDYS.   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Correct parameters on program calls.                *
      *  218984 - Rollovers where there is a repayment or increase    *
      *           need to be processed. These are identified as       *
      *           non-multi currency rollovers where a new facilty    *
      *           exchange rate and a new principal amount have been  *
      *           defined.                                            *
      *  220754 - Multi-currency rollovers need to be processed       *
      *  220257 - Negative amounts should be converted to positive on *
      *           LEHOSTPD and the Pay/Receive indicator changed      *
      *  218782 - Add Program ref, Sequence Number & Status fields to *
      *           LEHOSTPD. Check system value Settlement09Postings to*
      *           decide whether to use Settlement or Transaction Ccy.*
      *  CLE034 - (REVISED) Set up exchange rate from settlement alln *
      *  CLE034 - Lending Enhancements for Phase 1 Priority 1A.       *
      *  CLE033 - Settlement method 09                                *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  205504 - When interest payment date is equal to maturity     *
      *           date and repayment date is equal to maturity date,  *
      *           SRRPAY should not be executed.                      *
      *  204130 - Include the manual interest adjustment amount in    *
      *           the projection.                                     *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  Indicator usage                                              *
      *  ~~~~~~~~~~~~~~~                                              *
      *    34           End of file indicator on LOAMSOM1 file.       *
      *    37           Record found on HISTR file.                   *
      *                                                               *
      *****************************************************************
     FLOAMSOM1IF  E           K        DISK
     F            LOAMSDKF                          KRENAMEOMLOAM
     FHISTR   IF  E           K        DISK
     FLEHOSTPDO   E                    DISK                               CLE033
     F                                              KCOMIT                CLE033
     FAOLOAN  IF  E           K        DISK                           UC  CLE033
     F            CLOANHHF                          KIGNORE               CLE033
     F            CLOANZ1F                          KIGNORE               CLE033
     FLELOANL2IF  E           K        DISK                                                   221505
     F            CLOANCKF                          KRENAMECLOANKF                            221505
     E/SPACE 5
     E*
     E**  Loan processing types
     E**********          ##LDT   2   2  2 0                                                  CLE034
     E                    ##LDT   4   4  2 0                                                  CLE034
     E*
     E**  (Posting) Naratives
     E***************     ##NAR   1   4 30                                                    218984
     E                    ##NAR   1   8 30                                                    218984
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E                    ZF29   14  32  5 0             29TH FEB ARRAY
     E*
     E*  Subroutine stack
     E                    @STK       20 10
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZPOWERZ1                                                                   CLE031
     E*                                                                   CLE033
     E**  System values array                                             CLE033
     E**********          SVAL    1   3 20                                             CLE033 218782
     E                    SVAL    1   4 20                                                    218782
     E*                                                                   CLE033
      *                                                                   CLE033
     E*  Array of QCMDEXC command to edit                                 CLE033
     E                    #CMD    1   1 80                                CLE033
     E                    #CM        80  1                                CLE033
     E*  Amendment types                                                  CLE033
     E                    #AM     1   3 20                                CLE033
      *                                                                   CLE033
     ICLOANCLF                                                            CLE033
      ** Rename loan master file details                                  CLE033
     I              RECI                            RECIX                 CLE033
     I              LNRF                            LNRFX                 CLE033
     I              RCDT                            RCDTX                 CLE033
     I              MRIN                            MRINX                 CLE033
     I              PTYP                            PTYPX                 CLE033
     I              CNUM                            CNUMX                 CLE033
     I              BRCA                            BRCAX                 CLE033
     I              LTYP                            LTYPX                 CLE033
     I              SUTP                            SUTPX                 CLE033
     I              DDAT                            DDATX                 CLE033
     I              VDAT                            VDATX                 CLE033
     I              MDAT                            MDATX                 CLE033
     I              LASQ                            LASQX                 CLE033
     I              FCUS                            FCUSX                 CLE033
     I              FTYP                            FTYPX                 CLE033
     I              FSEQ                            FSEQX                 CLE033
     I              CCY                             CCYX                  CLE033
     I              CPAM                            CPAMX                 CLE033
     I              INTC                            INTCX                 CLE033
     I              INTR                            INTRX                 CLE033
     I              BRTT                            BRTTX                 CLE033
     I              BRTE                            BRTEX                 CLE033
     I              RTSP                            RTSPX                 CLE033
     I              MARG                            MARGX                 CLE033
     I              SPIN                            SPINX                 CLE033
     I              CHIN                            CHINX                 CLE033
     I              WTRT                            WTRTX                 CLE033
     I              WTIN                            WTINX                 CLE033
     I              REPT                            REPTX                 CLE033
     I              RAMT                            RAMTX                 CLE033
     I              NRPD                            NRPDX                 CLE033
     I              RFRQ                            RFRQX                 CLE033
     I              RDYN                            RDYNX                 CLE033
     I              FCCY                            FCCYX                 CLE033
     I              LIND                            LINDX                 CLE033
     I              CRSK                            CRSKX                 CLE033
     I              ACOF                            ACOFX                 CLE033
     I              NACD                            NACDX                 CLE033
     I              RELI                            RELIX                 CLE033
     I              AUTO                            AUTOX                 CLE033
     I              PSAM                            PSAMX                 CLE033
     I              BCXR                            BCXRX                 CLE033
     I              FCXR                            FCXRX                 CLE033
     I              SDST                            SDSTX                 CLE033
     I              OSDA                            OSDAX                 CLE033
     I              TSTN                            TSTNX                 CLE033
     I              MDST                            MDSTX                 CLE033
     I              OMDA                            OMDAX                 CLE033
     I              TMAN                            TMANX                 CLE033
     I              FACO                            FACOX                 CLE033
     I              RLDT                            RLDTX                 CLE033
     I              NROD                            NRODX                 CLE033
     I              RLFQ                            RLFQX                 CLE033
     I              RLDY                            RLDYX                 CLE033
     I              RDFC                            RDFCX                 CLE033
     I              NBRA                            NBRAX                 CLE033
     I              NRTS                            NRTSX                 CLE033
     I              NSIN                            NSINX                 CLE033
     I              NCAS                            NCASX                 CLE033
     I              AWTP                            AWTPX                 CLE033
     I              WTRD                            WTRDX                 CLE033
     I              WTWD                            WTWDX                 CLE033
     I              IWOD                            IWODX                 CLE033
     I              PWOD                            PWODX                 CLE033
     I              BMDI                            BMDIX                 CLE033
     I              FMDI                            FMDIX                 CLE033
     I              PDIN                            PDINX                 CLE033
     I              LSWC                            LSWCX                 CLE033
     I              LSWS                            LSWSX                 CLE033
     I              OSDB                            OSDBX                 CLE033
     I              OMDB                            OMDBX                 CLE033
     I              ORBR                            ORBRX                 CLE033
     I              PRFC                            PRFCX                 CLE033
     I              FCLB                            FCLBX                 CLE033
     I              MLNR                            MLNRX                 CLE033
     I              BTIN                            BTINX                 CLE033
     I              BLDY                            BLDYX                 CLE033
     I              OLNO                            OLNOX                 CLE033
     I              RCSI                            RCSIX                 CLE033
     I              ICBS                            ICBSX                 CLE033
     I              IPFR                            IPFRX                 CLE033
     I              TOTI                            TOTIX                 CLE033
     I              NIDT                            NIDTX                 CLE033
     I              IBDT                            IBDTX                 CLE033
     I              SLID                            SLIDX                 CLE033
     I              AIPD                            AIPDX                 CLE033
     I              DLRC                            DLRCX                 CLE033
     I              IACD                            IACDX                 CLE033
     I              AITC                            AITCX                 CLE033
     I              TFEP                            TFEPX                 CLE033
     I              AIAP                            AIAPX                 CLE033
     I              IPRD                            IPRDX                 CLE033
     I              IPRM                            IPRMX                 CLE033
     I              ICTD                            ICTDX                 CLE033
     I              AIMN                            AIMNX                 CLE033
     I              RBDT                            RBDTX                 CLE033
     I              NOPS                            NOPSX                 CLE033
     I              IFDY                            IFDYX                 CLE033
     I              LONI                            LONIX                 CLE033
     I              CNFI                            CNFIX                 CLE033
     I              ACEI                            ACEIX                 CLE033
     I              TLXI                            TLXIX                 CLE033
     I              CBLI                            CBLIX                 CLE033
     I              ORED                            OREDX                 CLE033
     I              LCD                             LCDX                  CLE033
     I              CHTP                            CHTPX                 CLE033
     I              TNLU                            TNLUX                 CLE033
     I              ADDI                            ADDIX                 CLE033
     I              ORMD                            ORMDX                 CLE033
     I              ORTI                            ORTIX                 CLE033
     I              BOKC                            BOKCX                 CLE033
     I              COCU                            COCUX                 CLE033
     I              RECE                            RECEX                 CLE033
     I              OMDT                            OMDTX                 CLE033
     I              NIPD                            NIPDX                 CLE033
     I              NMDT                            NMDTX                 CLE033
     I              APMI                            APMIX                 CLE033
     I              RSTM                            RSTMX                 CLE033
     I              RONS                            RONSX                 CLE033
     I              RIBN                            RIBNX                 CLE033
     I              RIBA                            RIBAX                 CLE033
     I              ROBN                            ROBNX                 CLE033
     I              ROCN                            ROCNX                 CLE033
     I              PSTM                            PSTMX                 CLE033
     I              PONS                            PONSX                 CLE033
     I              PIBN                            PIBNX                 CLE033
     I              PIBA                            PIBAX                 CLE033
     I              POBN                            POBNX                 CLE033
     I              POCN                            POCNX                 CLE033
     I              RCRN                            RCRNX                 CLE033
     I              RCRA                            RCRAX                 CLE033
     I              RVNO                            RVNOX                 CLE033
     I              AWBN                            AWBNX                 CLE033
     I              AWBA                            AWBAX                 CLE033
     I              BENN                            BENNX                 CLE033
     I              BENA                            BENAX                 CLE033
     I              DTP1                            DTP1X                 CLE033
     I              DTP2                            DTP2X                 CLE033
     I              DTP3                            DTP3X                 CLE033
     I              DTP4                            DTP4X                 CLE033
     I              DCHG                            DCHGX                 CLE033
     I              BTB1                            BTB1X                 CLE033
     I              BTB2                            BTB2X                 CLE033
     I              BTB3                            BTB3X                 CLE033
     I              BTB4                            BTB4X                 CLE033
     I              BTB5                            BTB5X                 CLE033
     I              BTB6                            BTB6X                 CLE033
     I              CVMR                            CVMRX                 CLE033
     I              PTFR                            PTFRX                 CLE033
     I              HLEX                            HLEXX                 CLE033
     I              FSRP                            FSRPX                 CLE033
     I              FSGN                            FSGNX                 CLE033
     I              FPRC                            FPRCX                 CLE033
     I              TCOF                            TCOFX                 CLE033
     I              ACPD                            ACPDX                 CLE033
     I              ACDA                            ACDAX                 CLE033
     I              ACAJ                            ACAJX                 CLE033
     I              ACAP                            ACAPX                 CLE033
     I              COFD                            COFDX                 CLE033
     I              COFM                            COFMX                 CLE033
     I              CFCD                            CFCDX                 CLE033
     I              NFRS                            NFRSX                 CLE033
     I              NFSN                            NFSNX                 CLE033
     I              NFPC                            NFPCX                 CLE033
     I              PDCF                            PDCFX                 CLE033
     I              FCTD                            FCTDX                 CLE033
     I              FWOD                            FWODX                 CLE033
     I              DFTP                            DFTPX                 CLE033
     I              DFST                            DFSTX                 CLE033
     I              MCRA                            MCRAX                 CLE033
     I              FCRA                            FCRAX                 CLE033
     I              PDDI                            PDDIX                 CLE033
     I              PTDI                            PTDIX                 CLE033
     I              GDPR                            GDPRX                 CLE033
     I              GDIN                            GDINX                 CLE033
     I              LNKS                            LNKSX                 CLE033
     I              MNSG                            MNSGX                 CLE033
     I              GASS                            GASSX                 CLE033
     I              GPRT                            GPRTX                 CLE033
     I              TOLN                            TOLNX                 CLE033
     I              LSTS                            LSTSX                 CLE033
     I              IUSR                            IUSRX                 CLE033
     I              AUSR                            AUSRX                 CLE033
     I              XUSR                            XUSRX                 CLE033
     I              RATF                            RATFX                 CLE033
     I              CNCF                            CNCFX                 CLE033
     I              PCRF                            PCRFX                 CLE033
     I              LPFI                            LPFIX                 CLE033
     I              PTFC                            PTFCX                 CLE033
     I              PTFT                            PTFTX                 CLE033
     I              PTFN                            PTFNX                 CLE033
     I              PCOB                            PCOBX                 CLE033
     I              LRLD                            LRLDX                 CLE033
     I              LMCD                            LMCDX                 CLE033
     I              SCCY                            SCCYX                 CLE033
     I              ICCY                            ICCYX                 CLE033
     I              OINR                            OINRX                 CLE033
     I              OIDT                            OIDTX                 CLE033
     I              REPI                            REPIX                 CLE033
     I              RFDY                            RFDYX                 CLE033
     I              RFRI                            RFRIX                 CLE033
     I              RFRT                            RFRTX                 CLE033
     I              RFAR                            RFARX                 CLE033
     I              REXR                            REXRX                 CLE033
     I              REXI                            REXIX                 CLE033
     I              PSCY                            PSCYX                 CLE033
     I              PEXR                            PEXRX                 CLE033
     I              PEXI                            PEXIX                 CLE033
     I              BASR                            BASRX                                     CLE106
     I              NBSR                            NBSRX                                     CLE106
     I              SLTP                            SLTPX                                     CLE106
     I              SLST                            SLSTX                                     CLE106
     I              CLAS                            CLASX                                     CLE042
     I              DFCL                            DFCLX                                     CLE042
     I              SLCL                            SLCLX                                     CLE042
     ICLOANCKF                                                            CLE033
      ** Rename loan master file details                                  CLE033
     I              TNLU                            TNLUY                 CLE033
     ICLOANKF                                                                                 221505
      ** Rename loan master file details                                                      221505
     I              TNLU                            TNLUZ                                     221505
     IOMLOAM
      ** Rename loan amendment fields
     I              RECI                            RECIL
     I              LNRF                            LNRFL
     I              CNUM                            CNUML
     I              VDAT                            VDATL
     I              LASN                            LASNL
     I              AMTP                            AMTPL
     I              RTSP                            RTSPL
     I              CCY                             CCYL
     I              PRAM                            PRAML
     I              INTA                            INTAL
     I              WTXA                            WTXAL
     I              FEAM                            FEAML
     I              TAMT                            TAMTL
     I              BRCA                            BRCAL
     I              REPT                            REPTL
     I              STAI                            STAIL
     I              SETP                            SETPL
     I              BRTE                            BRTEL
     I              SPIN                            SPINL
     I              WTIN                            WTINL                                   MD047554
     I              INTC                            INTCL
     I              ORED                            OREDL
     I              IRCF                            IRCFL
     I              LCD                             LCDL
     I              ROLN                            ROLNL
     I              PDDI                            PDDIL
     I              PTDI                            PTDIL
     I              TNLU                            TNLUL                 CLE033
     I              STAL                            STALL                                     CLE034
      *
     IHISTSHMF
      ** Rename history header fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              CCY                             CCYH
     I              AMTP                            AMTPH
     I              PRAM                            PRAMH
     I              BRTE                            BRTEH
     I              RTSP                            RTSPH
     I              SPIN                            SPINH
     I              REPT                            REPTH
     I              INTC                            INTCH
     I              SUTP                            SUTPH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              WTIN                            WTINH
     I              TOTI                            TOTIH
     I              CALC                            CALCH
     I              CLAS                            CLASH                                     CLE042
      *
     IHISTSHPF
      ** Rename history amount fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              CCY                             CCYH
     I              AMTP                            AMTPH
     I              PRAM                            PRAMH
     I              INTA                            INTAH
     I              WTXA                            WTXAH
     I              FEAM                            FEAMH
     I              WOIN                            WOINH
     I              SUTP                            SUTPH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              MNSG                            MNSGH
     I              GASS                            GASSH
     I              ROLN                            ROLNH
     I              CLAS                            CLASH                                     CLE042
     I              REPT                            REPTH                                     CLE154
      *
     IHISTSHQF
      ** Rename history rate fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              CCY                             CCYH
     I              AMTP                            AMTPH
     I              BRTE                            BRTEH
     I              RTSP                            RTSPH
     I              SPIN                            SPINH
     I              STAI                            STAIH
     I              IRCF                            IRCFH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              MNSG                            MNSGH
     I              RLCY                            RLCYH
     I              CALC                            CALCH
      *                                                                                     MD028338
      ** Reuse filler ZZ001 to serve as FX Rate Change Only Indicator                       MD028338
      *                                                                                     MD028338
     I              ZZ001                           FRCOH                                   MD028338
      *
     I/SPACE 5
     I*
     ISDBANK    E DSSDBANKPD
      ** BANK DETAILS
     I              BJRDNB                          RUND
     I              BJBVPD                          BVLP
     IDSFDY     E DSDSFDY
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*                                                                   CLE033
     I*SDSVAL***E*DSSDSVALPD*                                                          CLE033 222373
      ****EXTERNAL*DS*FOR*SYSTEM*VALUES*                                               CLE033 222373
     I**********                                                                       CLE033 222373
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
     I*
     ILOANCL    E DSCLOANCL
     I*
     I*WSLOAN******DS***************************1375                                   CLE034 CLE106
     IWSLOAN      DS                           1648                                           CLE106
      ** Back up for LOANCL                                                                   CLE034
     ILESTAL    E DSLESTALPD                                                                  CLE034
      ** External DS for Settlement Allocation Details                                        CLE034
     I              RECI                            RECIA                                     CLE034
     I              PCRF                            PCRFA                                     CLE034
     I              LNRF                            LNRFA                                     CLE034
     I              VDAT                            VDATA                                     CLE034
     I              LASQ                            LASQA                                     CLE034
     I              CNUM                            CNUMA                                     CLE034
     I              RSTM                            RSTMA                                     CLE034
     I              RONS                            RONSA                                     CLE034
     I              RONSQQ                          QQRONS                                    CGL029
     I              RIBN                            RIBNA                                     CLE034
     I              RIBA                            RIBAA                                     CLE034
     I              ROBN                            ROBNA                                     CLE034
     I              ROCN                            ROCNA                                     CLE034
     I              ROBR                            ROBRA                                     CLE034
     I              RSCY                            RSCYA                                     CLE034
     I              REXR                            REXRA                                     CLE034
     I              REXI                            REXIA                                     CLE034
     I              PSTM                            PSTMA                                     CLE034
     I              PONS                            PONSA                                     CLE034
     I              PONSQQ                          QQPONS                                    CGL029
     I              PIBN                            PIBNA                                     CLE034
     I              PIBA                            PIBAA                                     CLE034
     I              POBN                            POBNA                                     CLE034
     I              POCN                            POCNA                                     CLE034
     I              RCRN                            RCRNA                                     CLE034
     I              RCRA                            RCRAA                                     CLE034
     I              RVNO                            RVNOA                                     CLE034
     I              AWBN                            AWBNA                                     CLE034
     I              AWBA                            AWBAA                                     CLE034
     I              BENN                            BENNA                                     CLE034
     I              BENA                            BENAA                                     CLE034
     I              DTP1                            DTP1A                                     CLE034
     I              DTP2                            DTP2A                                     CLE034
     I              DTP3                            DTP3A                                     CLE034
     I              DTP4                            DTP4A                                     CLE034
     I              DCHG                            DCHGA                                     CLE034
     I              BTB1                            BTB1A                                     CLE034
     I              BTB2                            BTB2A                                     CLE034
     I              BTB3                            BTB3A                                     CLE034
     I              BTB4                            BTB4A                                     CLE034
     I              BTB5                            BTB5A                                     CLE034
     I              BTB6                            BTB6A                                     CLE034
     I              POBR                            POBRA                                     CLE034
     I              CVMR                            CVMRA                                     CLE034
     I              PSCY                            PSCYA                                     CLE034
     I              PEXR                            PEXRA                                     CLE034
     I              PEXI                            PEXIA                                     CLE034
     I              CCY                             CCYA                                      CLE038
     I              TMST                            PETMST                                    CLE034
      *                                                                                       CLE034
     I##PAYD      DS
     I                                        1   1 ##PAY
     I                                        2   3 ##PAYM
     I**********                              4  15 ##PAYA                                    CGL029
     I**********                             16  18 ##PAYB                                    CGL029
     I                                        4  21 ##PAYA                                    CGL029
     I                                       22  24 ##PAYB                                    CGL029
     I##RECD      DS
     I                                        1   1 ##REC
     I                                        2   3 ##RECM
     I**********                              4  15 ##RECA                                    CGL029
     I**********                             16  18 ##RECB                                    CGL029
     I                                        4  21 ##RECA                                    CGL029
     I                                       22  24 ##RECB                                    CGL029
     I##SETD      DS
      * pay/receive (P/R)
     I                                        1   1 ##PYRC
      * settlement method
     I                                        2   3 ##SETM
      * settlement account
     I**********                              4  15 ##SETA                                    CGL029
     I                                        4  21 ##SETA                                    CGL029
     I                                        4   5 ##NOSN
     I                                        4  13 ##ACNO
     I                                        4   9 ##CNUM
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      * settlement branch
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     IC#DTA       DS                            256
      *  Account type N=nostro nbr F=Full nostro G=General Ledger
      *               P=Partial Ledger R= Retail Number  X= no settlement
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I                                        2  19 C#ACCT
     I**********                              2   70C#CNU1                                    CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1
     I**********                             11  140C#ACO1                                    CGL029
     I                                       15  160C#ACS1
     I                                       17  19 C#BRC1
      *               Nostro number
     I                                        2   30C#NOSN
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               Partial Account - CNUM/ACOD/ACSQ
     I**********                              2   70C#CNUM                                    CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                                    CGL029
     I                                       12  130C#ACSQ
      *               Branch of account if Partial                      '
     I                                       14  16 C#BRCA
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
      *                     ' ' no OLPOS update
     I                                       24  24 C#IO
      *               Currency of transaction
     I                                       25  27 C#CCY
      *               Transaction Type
     I                                       28  29 C#TRYP
      *               Transaction Narrative
     I                                       30  59 C#NARR
      *               Cheque Number
     I                                       60  670C#CHQN
      *               FT transaction reference
     I                                       68  82 C#PREF
      *               DL/LE/GL/RE transaction reference
     I                                       83  88 C#TRN
      *               Movement amount
     I                                    P  89  960C#AMT
      *               Processing indicators Not blank = no update
      *                                     ' ' = Update
      *               Prono update indicator
     I                                       97  97 C#PRON
      *               Olpos update indicator
     I                                       98  98 C#OLPS
      *               Memos update indicator
     I                                       99  99 C#MEMS
      *               Rsacmtpd write indicator
     I                                      100 100 C#RSAC
      *               Module
     I                                      101 102 C#MOD
      *               Olpos record number to update
      *                     '02' for Interest movements
      *                     '03' for loans
     I                                      103 104 C#OLRC
      *               FT Memos ledger balance override
      *                        'Y' update ledger balance irrespective of
      *                        posting date
     I                                      105 105 C#FTOV
      *               Value date and posting date
     I                                    P 106 1080C#VDAT
     I                                    P 109 1110C#PSTD
      *               Override posting date correction
      *                        for forward valued items
      *                        'Y' prevents date being changed
     I                                      112 112 C#PSTO
      *               Indicator to show if removal allowed Y, N or " "
     I                                      113 113 C#RPST
      *               Removal set number
     I                                      114 1160C#RPNB
      *               Removal type "C" = Credit entries
      *                            "D" = Debit entries
     I                                      117 117 C#RTYP
      *               Booking branch
     I                                      118 120 C#BBRN
      *                                                                                       CGL029
      ** Account code for full general ledger                                                 CGL029
      *                                                                                       CGL029
     I                                      121 1300C#ACO1                                    CGL029
      *                                                                                       CGL029
      ** Account code for partial account                                                     CGL029
      *                                                                                       CGL029
     I                                      131 1400C#ACOD                                    CGL029
      *                                                                                       CAP204
      ** Other Transaction Reference                                                          CAP204
      *                                                                                       CAP204
     I                                      141 160 C#OTR1                                    CAP204
      *                                                                                       CAP205
      ** Movement type                                                                        CAP205
      *                                                                                       CAP205
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
      *
     I            DS
     I* Value date and sequence number read from LOAMSDK
     I                                        1   80@@VDSN
     I                                        1   50@@VYMD
     I                                        6   80@@DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to omit
     I                                        1   80$$VDSN
     I                                        1   50$$VYMD
     I                                        6   80$$DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to be read to
     I                                        1   80##VDSN
     I                                        1   50##VYMD
     I                                        6   80##DS38
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     ISDGELR    E DSSDGELRPD
      ** General ledger details
      *
     ISCSARD    E DSSCSARDPD
      *** SAR Details
      *
     I              LCD                             LCDX
      *                                                                                       CLE031
     ISDCURR    E DSSDCURRPD                                                                  CLE031
      ** Currency details                                                                     CLE031
      *                                                                                       CLE031
      /EJECT
      *
      ** Data structure for subroutine ZCBDYS
     I            DS
     I                                        1   80ZZDAT1
     I                                        1   40ZZYYA
     I                                        5   60ZZMMA
     I                                        7   80ZZDDA
      *
     I            DS
     I                                        1   80ZZDAT2
     I                                        1   40ZZYYB
     I                                        5   60ZZMMB
     I                                        7   80ZZDDB
      *
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY ZSRSRC,ZINTDYZ1
      *
     I/COPY ZSRSRC,ZDAT10Z1
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZHOLI
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
      *
     C           *ENTRY    PLIST
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           ##AMTP  2
     C                     PARM           ##OVDT  50
     C                     PARM           ##LASN  30
     C                     PARM           ##PRAM 130
     C                     PARM           ##STAL  1                                           220754
     C***************      PARM           ##TYPE  4                                     220754218984
     C                     PARM           BRLAMT                                              218984
     C                     PARM           ARLAMT                                              218984
     C                     PARM           NCCY                                                218984
     C                     PARM           #OPRAM 130                                        MD047554
     C                     PARM           #ACTN   1                                         MD047554
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      ** Access general ledger details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *................................................................
      *
      **  Initial processing - Once Only
      *
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      ** Main processing
      *
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
      *
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Clear down all shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRCLR
      *
     C                     MOVELZ#BSTS    #BRCID  2
     C                     MOVELZ#ASTS    #ARCID  2
     C                     MOVE *BLANKS   FPASS   1                                         MD047554
      *
      *-------------------------------------------------------------------
      *
      ** GENERATE 'BEFORE STATUS' ACCOUNT MOVEMENTS
      ** (if not insertion, when __RCID will be blank)
      *
     C           #BRCID    IFNE *BLANK
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL'YES'     ##REVI  3
      *
      ** Loans
     C                     MOVELZ#BSTS    LOANCL
     C                     Z-ADDBRLAMT    RLAMT                                               218984
     C                     MOVEL'LOAN'    ##TYPE  4                                           218984
      *                                                                   CLE033
      * TNLU in reversals must be the new one, to match the loan status   CLE033
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           SDST      ANDEQ09                                        CLE033
     C           CLE033    OREQ 'Y'                                       CLE033
     C           MDST      ANDEQ09                                        CLE033
      *                                                                   CLE033
     C                     MOVELZ#ASTS    LOANCL                          CLE033
     C                     Z-ADD0         W0TNLU  50                      CLE033
      *                                                                   CLE033
     C           CHTP      IFEQ 'R'                                       CLE033
     C                     Z-ADDTNLU      W0TNLU                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     MOVELZ#BSTS    LOANCL                          CLE033
      *                                                                   CLE033
     C           W0TNLU    IFNE 0                                         CLE033
     C                     Z-ADDW0TNLU    TNLU                            CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
     C                     EXSR SRLOAN
      *                                                                   CLE033
     C                     MOVE ##SETM    WBSETM  2                       CLE033
     C                     MOVE #BRCID    WBRCID  2                       CLE033
      *                                                                   CLE033
     C                     MOVE *BLANKS   #BRCID
      *
     C                     END                             * Z#BSTS
      *-------------------------------------------------------------------
      *
      ** GENERATE 'AFTER STATUS' ACCOUNT MOVEMENTS
      ** (if not deletion, when __CHTP will be 'R')
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL*BLANK    ##REVI
     C                     MOVEL'Y'       FPASS                                             MD047554
      *
      ** Loans
      *
     C                     MOVELZ#ASTS    LOANCL
     C                     Z-ADDARLAMT    RLAMT                                               218984
     C                     MOVEL'LOAN'    ##TYPE                                              218984
     C           CHTP      IFNE 'R'
     C                     EXSR SRLOAN
     C                     END
      *
      *-------------------------------------------------------------------
      *
      ** Update database with shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRUPD
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRLOAN                                         *
      * Function    :  Loan Processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  AOSPOSU0 - On-line Positions Update            *
      *****************************************************************
     C           SRLOAN    BEGSR
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRLOAN'  @STK,Q
      *
      *................................................................
      *
     C                     MOVE *BLANK    VAL     1
     C           RUND      SUB  BVLP      STARTD  50
     C           #BRCID    IFNE *BLANKS
     C           VDAT      ANDLTSTARTD
     C           VDAT      ANDNE0
     C                     MOVE 'Y'       VAL
     C                     END
      *
      **  Determine whether Participation Sold
      *
     C                     Z-ADD1         #I      20
     C           PTYP      LOKUP##LDT,#I                 99*
     C  N99                MOVEL'L'       ##LOD
     C   99                MOVEL'D'       ##LOD   1
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
      **  For Loans and Part. Purchased
      *
     C           *IN99     IFEQ '0'
     C                     MOVELSDST      ##PAYM           * pay method
     C                     MOVELOSDA      ##PAYA           * pay account
     C                     MOVELOSDB      ##PAYB           * pay branch
     C                     MOVELMDST      ##RECM           * rec method
     C                     MOVELOMDA      ##RECA           * rec account
     C                     MOVELOMDB      ##RECB           * rec branch
     C                     ELSE
      *
      **  For Part. Sold
      *
     C                     MOVELMDST      ##PAYM           * pay method
     C                     MOVELOMDA      ##PAYA           * pay account
     C                     MOVELOMDB      ##PAYB           * pay branch
     C                     MOVELSDST      ##RECM           * rec method
     C                     MOVELOSDA      ##RECA           * rec account
     C                     MOVELOSDB      ##RECB           * rec branch
     C                     END
      *
      **  Store basic loan details
      *
     C**********           Z-ADDLNRF      ##DLNO  60       * loan number                      CLE148
     C                     MOVELLNRF      ##DLNO  6                                           CLE148
     C           CEU004    IFEQ 'Y'
     C           SCCY      ANDNE*BLANK
     C           CLE031    ANDNE'Y'                                                           CLE031
     C                     MOVELSCCY      ##CCY
     C                     ELSE
     C                     MOVELCCY       ##CCY   3        * currency
     C                     ENDIF
      *                                                                                       CLE031
      ** If Lending Enhancements is installed                                                 CLE031
      ** Save receipt & pay settlement details                                                CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C********** SCCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELSCCY      SVSCCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                       CLE031
     C********** PSCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELPSCY      SVPSCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                     AR943686
     C                     Z-ADDREXR      SVREXR 138                                        AR943686
     C                     MOVE REXI      SVREXI  1                                         AR943686
     C                     Z-ADDPEXR      SVPEXR 138                                        AR943686
     C                     MOVE PEXI      SVPEXI  1                                         AR943686
      *                                                                                       CLE031
     C                     ENDIF                           End If CLE031                      CLE031
      *                                                                                       CLE031
     C                     Z-ADDCPAM      ##PCPL 150   99  * principal
     C   99                Z-SUB##PCPL    ##PCPL
     C                     Z-ADDINTR      ##INTR 117       * interest rate
     C                     Z-ADDIACD      ##IACD  50       * int acc ctl DT
     C                     MOVELICBS      ##ICBS  10       * int calc basis
     C                     MOVELLTYP      ##TRYP  2        * loan type
     C                     MOVELLNRF      ##TRN   6        * transact no.
     C                     MOVELBRCA      ##BBRN  3        * booking branch
      *
     C                     MOVE AUTO      ##AUTO  1        * auto-settle
      *
      ** Value date and sequence number on LOAMSDK to be read to
      *
     C                     Z-ADD*ZERO     ##VDSN           * READ TO
      *
      **  Initialize work fields
      *
     C           NMDT      IFNE 0                                                             220754
     C                     Z-ADDMDAT      SVMDAT  50                                          220754
     C                     Z-ADDNMDT      MDAT                                                220754
     C                     ENDIF                                                              220754
     C                     Z-ADD*ZERO     ##AMT  150       * amount
     C                     MOVEL*BLANK    ##NARR 30        * narrative
     C                     EXSR SRINTP
      *                                                                                       224582
     C           INTC      IFNE 'Y'                                                           224582
     C           PTYP      ANDNE63                                                            224582
     C           PTYP      ANDNE65                                                            224582
     C           PTYP      ANDNE67                                                            224582
      *
      **  Generate interest payment date
      **  if amendment date is before next interest payment date                              218984
      *
     C           NIDT      IFNE 0
     C           ##OVDT    ANDLENIDT                                                          218984
     C                     Z-ADDNIDT      ##VDAT  50
     C                     Z-ADDZFIRST    ##AMT
     C                     ADD  AIMN      ##AMT                                               204130
      *                                                                                       CLE034
      ** If CLE034 is on:                                                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C           ##LOD     IFEQ 'L'                                                           CLE034
     C                     MOVE 'R'       WKPYRC  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'P'       WKPYRC                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR SR34A                                                         CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WFLAG   1                                           CLE034
     C                     MOVE '*EOF   ' PRETCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                      BUG8962
     C                     MOVE 'N'       WCRDIF  1                                          BUG8962
      *                                                                                       CLE034
     C           WFLAG     DOWEQ'Y'                                                           CLE034
     C           PRETCD    OREQ *BLANK                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                     MD047554
      ***  If the tax is "gross" of interest, subtract the calculated                       MD047554
      ***  withholding tax from the interest due                                            MD047554
      *                                                                                     MD047554
     C           WTIN      IFEQ 'G'                                                         MD047554
     C           ##AMT     ANDNE0                                                           MD047554
     C           WTIN      OREQ 'R'                                                         MD047554
     C           ##AMT     ANDNE0                                                           MD047554
     C           WTRT      DIV  100       TAXINT 117                                        MD047554
     C           ##AMT     MULT TAXINT    TAXAMT 150H                                       MD047554
     C                     SUB  TAXAMT    ##AMT                                             MD047554
     C                     ENDIF                                                            MD047554
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP  1                                           CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANK    WFLAG                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF
      *                                                                                       218984
      **  Generate rollover entries                                                           218984
      *                                                                                       218984
     C           RLAMT     IFNE 0                                                             218984
     C           ##OVDT    ANDLERLDT                                                          218984
     C                     EXSR SRRLDT                                                        218984
     C                     ENDIF                                                              218984
      *
      **  Generate interest at maturity.
      *
     C                     Z-ADDMDAT      ##VDAT
     C           WCALC     SUB  WINPD     ##AMT
     C********** ##AMT     SUB  ZINTRS    ##AMT                                               221505
     C           ##AMT     SUB  ZFIRST    ##AMT                                               221505
     C           ##AMT     SUB  WTINTA    ##AMT                                               264065
      *                                                                                       204130
     C           NIDT      IFEQ 0                                                             204130
     C                     ADD  AIMN      ##AMT                                               204130
     C                     ENDIF                                                              204130
      *                                                                                       CLE034
      ** If CLE034 is on:                                                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C           ##LOD     IFEQ 'L'                                                           CLE034
     C                     MOVE 'R'       WKPYRC                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'P'       WKPYRC                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR SR34A                                                         CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WFLAG                                               CLE034
     C                     MOVE '*EOF   ' PRETCD                                              218984
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WFLAG     DOWEQ'Y'                                                           CLE034
     C           PRETCD    OREQ *BLANK                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                     MD047554
      ** If the tax is "gross" of interest, subtract the calculated                         MD047554
      ** withholding tax from the interest due                                              MD047554
      *                                                                                     MD047554
     C           WTIN      IFEQ 'G'                                                         MD047554
     C           ##AMT     ANDNE0                                                           MD047554
     C           WTIN      OREQ 'R'                                                         MD047554
     C           ##AMT     ANDNE0                                                           MD047554
     C           WTRT      DIV  100       TAXINT 117                                        MD047554
     C           ##AMT     MULT TAXINT    TAXAMT 150H                                       MD047554
     C                     SUB  TAXAMT    ##AMT                                             MD047554
     C                     ENDIF                                                            MD047554
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANK    WFLAG                                               CLE034
     C                     MOVE '*EOF'    PRETCD                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              224582
      *
     C           RLAMT     IFEQ 0                                                             218984
     C           ##OVDT    ORGT RLDT                                                          218984
     C                     EXSR SRMDAT
     C                     ENDIF                                                              218984
      *................................................................
      *
     C           EXLOAN    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRINTP  - Interest Payment Processing          *
      *                                                               *
      *****************************************************************
      *
     C           SRINTP    BEGSR
      *
     C           NRPD      IFNE 0
     C           AUTO      ANDEQ'Y'
     C           NRPD      ANDNEMDAT                                                          205504
      *                                                                                       CLE134
      ** AUTO = 'C' loan subject to funds check                                               CLE134
      *                                                                                       CLE134
     C           NRPD      ORNE 0                                                             CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           NRPD      ANDNEMDAT                                                          CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     Z-ADDNRPD      WNRPD   50
     C                     ELSE
     C                     Z-ADD99999     WNRPD
     C                     ENDIF
      *
     C           NIDT      IFNE 0
     C           AUTO      ANDEQ'Y'
     C           NIDT      ANDNEMDAT                                                          205504
      *                                                                                       CLE134
      ** AUTO = 'C' loan subject to funds check                                               CLE134
      *                                                                                       CLE134
     C           NIDT      ORNE 0                                                             CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           NIDT      ANDNEMDAT                                                          CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     Z-ADDNIDT      WNIDT   50
     C                     ELSE
     C                     Z-ADD99999     WNIDT
     C                     ENDIF
      *
     C                     MOVE VDAT      WLICD
     C                     MOVE ICBS      WICBS
     C           KEYH      KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           LNRF
      *
     C                     Z-ADD0         WLASD   50
     C                     Z-ADD0         WSVBL  130
     C                     Z-ADD0         WCURT  117
     C                     Z-ADD0         WCUPR  130
     C                     Z-ADD0         WINCA  130
     C                     Z-ADD0         WINPD  130
     C                     Z-ADD0         WCALC
     C                     Z-ADD0         ZINTRS
     C                     MOVEL*BLANKS   ROLLED                                              221505
     C                     Z-ADD0         ZFIRST                                              264065
     C                     Z-ADD0         WTINTA 130                                          264065
      *
     C           KEYH      SETLLHISTR
     C           KEYH      READEHISTR                    37
     C           *IN37     IFEQ '1'
     C                     Z-ADD99999     VDATH
     C                     Z-ADD##PRAM    WCUPR
     C                     Z-ADDINTR      WCURT
     C                     Z-ADDBRTE      WCUBR  117
     C                     Z-ADDRTSP      WCUSP  117
     C                     Z-ADDIACD      WLICD   50
     C                     ENDIF
      *
     C           LNRF      SETLLLOAMSOM1
     C           *IN34     DOUEQ'1'
     C           RECIL     OREQ 'D'
     C           VDATL     ANDLEMDAT
     C           AMTPL     OREQ ##AMTP
     C           LASNL     ANDEQ##LASN
     C           VDATL     ANDEQ##OVDT
     C           RECIL     ANDEQ'R'
     C           VDATL     ANDLEMDAT
     C           LNRF      READELOAMSOM1                 34
     C                     ENDDO
     C           *IN34     IFEQ '1'
     C                     Z-ADD99999     VDATL
     C                     ENDIF
      *
     C           *IN34     IFEQ '0'
     C           *IN37     OREQ '0'
      *
     C           *IN34     DOUEQ'1'
     C           *IN37     ANDEQ'1'
      *
     C           *IN34     IFEQ '0'
     C           #BRCID    ANDNE*BLANKS
     C           AMTPL     ANDEQ##AMTP
     C           LASNL     ANDEQ##LASN
     C           VDATL     ANDEQ##OVDT
     C           RECIL     ANDNE'R'
     C           #BRCID    OREQ *BLANKS
     C           RECIL     ANDEQ'R'
     C                     MOVEL'Y'       WSAME   3
      *                                                                                     MD047554
      ** Process amendment of principal amount in PI, or if                                 MD047554
      ** change of autosettle indicator from Y to N in RE                                   MD047554
      ** (#ACTN=R to process it as reversal).                                               MD047554
      *                                                                                     MD047554
     C           AMTPL     IFEQ 'PI'                                                        MD047554
     C           #OPRAM    ANDNEPRAML                                                       MD047554
     C           RECIL     ANDNE'R'                                                         MD047554
     C           AMTPL     OREQ 'RE'                                                        MD047554
     C           RECIL     ANDNE'R'                                                         MD047554
     C           #ACTN     ANDEQ'R'                                                         MD047554
     C                     MOVEL'N'       WSAME                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ELSE
     C                     MOVEL'N'       WSAME
     C                     ENDIF
     C*                                                                                       221505
     C********** RLDT      IFNE 0                                                    221505 MD047554
     C********** VDATH     ANDGTRLDT                                                 221505 MD047554
     C********** VDATL     ANDGTRLDT                                                 221505 MD047554
     C**********           EXSR SRROLL                                               221505 MD047554
     C**********           ENDIF                                                     221505 MD047554
      *
     C                     SELEC
     C           VDATH     WHLE VDATL
     C                     EXSR SRHIST
     C           VDATL     WHLE VDATH
     C                     EXSR SRLOAM
     C                     ENDSL
     C                     ENDDO
     C*                                                                                       221505
     C           RLDT      IFNE 0                                                             221505
     C           ROLLED    ANDNE'Y'                                                           221505
     C                     EXSR SRROLL                                                        221505
     C                     ENDIF                                                              221505
      *                                                                                       221505
      ** For call loans, need to make sure have processed the next                            221505
      ** interest payment date, so that the interest amount has been                          221505
      ** calculated up to this point.                                                         221505
      *                                                                                       221505
     C           MDAT      IFEQ 0                                                             221505
     C           WNIDT     ANDLENIDT                                                          221505
     C                     Z-ADDNIDT      OMEND   50                                          221505
     C                     EXSR SRRPAY                                                        221505
     C                     ENDIF                                                              221505
      *
     C********** RLDT      IFEQ 0                                                             221505
     C********** MDAT      ANDNE0                                                             221505
     C           MDAT      IFNE 0                                                             221505
     C           RECI      ANDNE'M'
      *
     C                     Z-ADDMDAT      OMEND   50
     C                     EXSR SRRPAY
      *
     C                     Z-ADDMDAT      ZIEND
     C                     EXSR SRINCL
     C                     ADD  ZINTR     WCALC
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRMDAT - maturity prinicipal processing        *
      *                                                               *
      *****************************************************************
      *
     C           SRMDAT    BEGSR
      *
     C                     Z-ADDMDAT      ##VYMD             YYYY/MM/DD
     C                     Z-ADDMDAT      ##VDAT             Midas day no.
      *
      ** If date present (ie not call)
      *
      ** Use the calculated current principal amount of the                                 MD047554
      ** loan based on all movements.                                                       MD047554
      *                                                                                     MD047554
     C**********           Z-ADDCPAM      ##AMT                                             MD047554
     C                     Z-ADDWCUPR     ##AMT                                             MD047554
      *                                                                                       224582
     C           INTC      IFEQ 'Y'                                                           224582
     C                     ADD  WCALC     ##AMT                                               224582
     C                     SUB  WINPD     ##AMT                                               224582
     C                     ENDIF                                                              224582
      *                                                                                       CLE034
      ** If CLE034 is on:                                                                     CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C           ##LOD     IFEQ 'L'                                                           CLE034
     C                     MOVE 'R'       WKPYRC                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'P'       WKPYRC                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR SR34A                                                         CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WFLAG   1                                           CLE034
     C                     MOVE '*EOF   ' PRETCD                                              218984
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WFLAG     DOWEQ'Y'                                                           CLE034
     C           PRETCD    OREQ *BLANK                                                        CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD003       ##RPNB  30       * 3 = maty date
     C                     MOVEL##NAR,4   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANK    WFLAG                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C***********STAL      ANDEQ'Y'                                                     CLE034220754
     C           ##STAL    ANDEQ'Y'                                                           220754
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR
      *****************************************************************                       CLE034
      /SPACE 5                                                                                218984
      *****************************************************************                       218984
      *                                                               *                       218984
      * Subroutine  :  SRRLDT - Rollover date processing              *                       218984
      *                                                               *                       218984
      *****************************************************************                       218984
      *                                                                                       218984
     C           SRRLDT    BEGSR                                                              218984
      *                                                                                       218984
      ** If a multicurrency rollover, need to get original loan                               218984
      ** settlement details. The details in LOANCL have been changed                          218984
      ** by LE2041 to include the rollover details                                            218984
      *                                                                                       218984
     C           NCCY      IFNE *BLANKS                                                       218984
     C           LNRF      CHAINAOLOAN               99                                       218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
      ** If rollover amount is negative, change the amount to positive                        218984
      ** and reverse the pay/receive details by swapping the                                  218984
      ** loan/deposit indicator                                                               218984
      *                                                                                       218984
     C           *LIKE     DEFN ##LOD     SAVLOD                                              218984
     C                     MOVEL*BLANKS   SAVLOD                                              218984
     C           RLAMT     IFLT 0                                                             218984
     C                     Z-SUBRLAMT     RLAMT                                               218984
     C                     MOVEL##LOD     SAVLOD                                              218984
     C           ##LOD     IFEQ 'L'                                                           218984
     C                     MOVEL'D'       ##LOD                                               218984
     C                     ELSE                                                               218984
     C                     MOVEL'L'       ##LOD                                               218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
     C                     Z-ADDRLAMT     ##AMT                                               218984
     C                     Z-ADDRLDT      ##VDAT                                              218984
      *                                                                                       218984
     C                     Z-ADD003       ##RPNB           * 3 = maty date                    218984
     C           NCCY      IFNE *BLANKS                                                       218984
     C                     MOVEL##NAR,6   ##NARR                                              218984
     C                     ELSE                                                               218984
     C           SAVLOD    IFEQ *BLANKS                                                       218984
     C                     MOVEL##NAR,7   ##NARR                                              218984
     C                     ELSE                                                               218984
     C                     MOVEL##NAR,8   ##NARR                                              218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
      ** If CLE034 is on:                                                                     218984
      *                                                                                       218984
     C           CLE034    IFEQ 'Y'                                                           218984
     C           ##STAL    ANDEQ'Y'                                                           218984
     C           ##LOD     IFEQ 'L'                                                           218984
     C                     MOVE 'R'       WKPYRC                                              218984
     C                     ELSE                                                               218984
     C                     MOVE 'P'       WKPYRC                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
     C                     EXSR SR34A                                                         218984
      *                                                                                       218984
     C                     ELSE                                                               218984
     C                     MOVE 'Y'       WFLAG   1                                           218984
     C                     MOVE '*EOF   ' PRETCD                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
     C           WFLAG     DOWEQ'Y'                                                           218984
     C           PRETCD    OREQ *BLANK                                                        218984
      *                                                                                       218984
     C           CLE034    IFEQ 'Y'                                                           218984
     C           ##STAL    ANDEQ'Y'                                                           218984
     C                     EXSR SR34B                                                         218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
      ** Pass movement to write program (with appropriate instructions)                       218984
      *                                                                                       218984
     C           ##LOD     IFEQ 'L'                                                           218984
     C                     MOVEL##RECD    ##SETD           * Rec details                      218984
     C                     ELSE                                                               218984
     C                     MOVEL##PAYD    ##SETD           * Pay details                      218984
     C                     END                                                                218984
      *                                                                                       218984
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE                                                        218984
      *                                                                                       218984
     C           CLE034    IFEQ 'Y'                                                           218984
     C           ##STAL    ANDEQ'Y'                                                           218984
     C                     EXSR SR34C                                                         218984
     C                     ELSE                                                               218984
     C                     MOVE *BLANK    WFLAG                                               218984
     C                     ENDIF                                                              218984
     C                     ENDDO                                                              218984
      *                                                                                       218984
     C           CLE034    IFEQ 'Y'                                                           218984
     C           ##STAL    ANDEQ'Y'                                                           218984
     C                     EXSR SR34E                                                         218984
     C                     ENDIF                                                              218984
     C*                                                                                      218984R
     C** For non-multicurrency rollovers which produce increases                             218984R
     C** set details back again.                                                             218984R
     C*                                                                                      218984R
     C           NCCY      IFEQ *BLANKS                                                      218984R
     C           SAVLOD    ANDNE*BLANKS                                                      218984R
     C                     MOVELSAVLOD    ##LOD                                              218984R
     C                     MOVEL*BLANKS   SAVLOD                                             218984R
     C                     ENDIF                                                             218984R
      *                                                                                       218984
      ** If a multicurrency rollover, need to now get rollover                                218984
      ** settlement details.                                                                  218984
      *                                                                                       218984
     C           NCCY      IFNE *BLANKS                                                       218984
     C           ##REVI    IFEQ 'YES'                                                         218984
     C                     MOVELZ#BSTS    LOANCL                                              218984
     C                     ELSE                                                               218984
     C                     MOVELZ#ASTS    LOANCL                                              218984
     C                     ENDIF                                                              218984
     C                     MOVEL'ROLL'    ##TYPE                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
     C                     ENDSR                                                              218984
      *****************************************************************                       218984
      /SPACE 5                                                                                CLE034
      *****************************************************************                       CLE034
      * Subroutine  :  SR34A                                          *                       CLE034
      * Function    :  Initial set up for CLE034 Processing           *                       CLE034
      *                                                               *                       CLE034
      * Called by   :  SRLOAN, SRMDAT                                 *                       CLE034
      * Calls       :  AOSTALR2                                       *                       CLE034
      *****************************************************************                       CLE034
     C           SR34A     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD##AMT     WSAMT  150                                          CLE034
     C                     MOVE LOANCL    WSLOAN                                              CLE034
     C                     Z-ADD*ZERO     WTOTAL 150                                          CLE034
     C                     Z-ADD*ZERO     WKAMT  150                                          CLE034
     C                     MOVE *BLANKS   WFLAG                                               CLE034
     C                     MOVE ##RECM    WSRECM  2                                           CLE034
     C**********           MOVE ##RECA    WSRECA 12                                    CLE034 CGL029
     C                     MOVE ##RECA    WSRECA 18                                           CGL029
     C                     MOVE ##RECB    WSRECB  3                                           CLE034
     C                     MOVE ##PAYM    WSPAYM  2                                           CLE034
     C**********           MOVE ##PAYA    WSPAYA 12                                    CLE034 CGL029
     C                     MOVE ##PAYA    WSPAYA 18                                           CGL029
     C                     MOVE ##PAYB    WSPAYB  3                                           CLE034
     C                     MOVE ##CCY     WSCCY   3                                           CLE034
     C***********          MOVE ##SCCY    WSSCCY  3                                           CLE034
     C***********          MOVE ##PSCY    WSPSCY  3                                           CLE034
     C**********           MOVE SCCY      WSSCCY  3                                  CLE034 AR943686
     C**********           MOVE PSCY      WSPSCY  3                                  CLE034 AR943686
     C**********           MOVE PEXR      WSPEXR 138                                 CLE034 AR943686
     C**********           MOVE REXR      WSREXR 138                                 CLE034 AR943686
     C**********           MOVE PEXI      WSPEXI  1                                  CLE034 AR943686
     C**********           MOVE REXI      WSREXI  1                                  CLE034 AR943686
     C                     MOVE SVSCCY    W#SVCY  3                                         AR943686
     C                     MOVE SVPSCY    W#PSCY  3                                         AR943686
     C                     Z-ADDSVREXR    W#REXR 138                                        AR943686
     C                     Z-ADDSVPEXR    W#PEXR 138                                        AR943686
     C                     MOVE SVREXI    W#REXI  1                                         AR943686
     C                     MOVE SVPEXI    W#PEXI  1                                         AR943686
     C                     MOVE LNRF      PLNRF                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRETCD  7                                           CLE034
     C                     PARM '*FIRST'  POPTN   7                                           CLE034
     C*************        PARM 'LOAN'    PTYPE   4                                     CLE034220754
     C                     PARM ##TYPE    PTYPE   4                                           220754
     C                     PARM           PLNRF   6                                           CLE034
     C                     PARM *BLANKS   PLAVD   5                                           CLE034
     C                     PARM *BLANKS   PLASQ   3                                           CLE034
     C                     PARM *BLANKS   PCFEE   6                                           CLE034
     C                     PARM *BLANKS   PFFEE   5                                           CLE034
     C                     PARM *BLANKS   PFSEQ   2                                           CLE034
     C                     PARM WKPYRC    PPYRC   1                                           CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRETCD    IFNE *BLANKS                                                       CLE034
     C                     MOVEL'AOOULAUO'W0PGM                                               CLE034
     C                     MOVEL'LESTALPD'W0FILE                                              CLE034
     C                     MOVELLNRF      W0KEY                                               CLE034
     C                     Z-ADD910       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      /SPACE 5                                                                                CLE034
      *****************************************************************                       CLE034
      * Subroutine  :  SR34B                                          *                       CLE034
      * Function    :  Processing to calculate amount for settlement  *                       CLE034
      *                allocation                                     *                       CLE034
      *                                                               *                       CLE034
      * Called by   :  SRLOAN, SRMDAT                                 *                       CLE034
      * Calls       :  None                                           *                       CLE034
      *****************************************************************                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           CLE038    IFEQ 'N'                                                           CLE038
     C           CLE038    OREQ 'Y'                                                           CLE038
     C           WKPYRC    ANDEQ'P'                                                           CLE038
     C           PYBA      ANDNE'A'                                                           CLE038
     C           CLE038    OREQ 'Y'                                                           CLE038
     C           WKPYRC    ANDEQ'R'                                                           CLE038
     C           RCBA      ANDNE'A'                                                           CLE038
      *                                                                                       CLE038
     C                     Z-ADD*ZERO     WKPYPC 139                                          CLE034
     C           WKPYRC    IFEQ 'P'                                                           CLE034
     C           PYPC      DIV  100       WKPYPC                                              CLE034
     C           WSAMT     MULT WKPYPC    WKAMT     H                                         CLE034
     C                     ELSE                                                               CLE034
     C           RCPC      DIV  100       WKPYPC                                              CLE034
     C           WSAMT     MULT WKPYPC    WKAMT     H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ADD  WKAMT     WTOTAL                                              CLE034
      *                                                                                       CLE034
     C           WFLAG     IFEQ 'Y'                                                           CLE034
     C           WTOTAL    ANDNEWSAMT                                                         CLE034
     C           WCRDIF    ANDEQ'N'                                                          BUG8962
     C           WSAMT     SUB  WTOTAL    WDIFF  150                                          CLE034
     C                     ADD  WDIFF     WKAMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
     C           WKPYRC    IFEQ 'P'                                                           CLE038
     C                     Z-ADDPYAM      WKAMT                                               CLE038
     C                     ELSE                                                               CLE038
     C                     Z-ADDRCAM      WKAMT                                               CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     Z-ADDWKAMT     ##AMT                                               CLE034
      *                                                                                       CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      /SPACE 5                                                                                CLE034
      *****************************************************************                       CLE034
      * Subroutine  :  SR34C                                          *                       CLE034
      * Function    :  Processing to get next settlement allocation   *                       CLE034
      *                                                               *                       CLE034
      * Called by   :  SRLOAN, SRMDAT                                 *                       CLE034
      * Calls       :  AOSTALR2                                       *                       CLE034
      *****************************************************************                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WFLAG     IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANK    WFLAG                                               CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE LNRF      PLNRF                                               CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRETCD                                              CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C*************        PARM 'LOAN'    PTYPE                                         CLE034220754
     C                     PARM ##TYPE    PTYPE                                               220754
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM *BLANKS   PCFEE                                               CLE034
     C                     PARM *BLANKS   PFFEE                                               CLE034
     C                     PARM *BLANKS   PFSEQ                                               CLE034
     C                     PARM WKPYRC    PPYRC                                               CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRETCD    IFEQ '*EOF'                                                        CLE034
     C                     MOVE 'Y'       WFLAG                                               CLE034
     C                     ELSE                                                              BUG8962
     C           RSCYA     IFNE *BLANKS                                                      BUG8962
     C           RSCYA     ANDNECCYA                                                         BUG8962
     C                     MOVE 'Y'       WCRDIF                                             BUG8962
     C                     ENDIF                                                             BUG8962
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      /SPACE 5                                                                                CLE034
      *****************************************************************                       CLE034
      * Subroutine  :  SR34D                                          *                       CLE034
      * Function    :  Set up fields from settlement allocation       *                       CLE034
      *                                                               *                       CLE034
      * Called by   :  SRLOAN, SRMDAT                                 *                       CLE034
      * Calls       :  None                                           *                       CLE034
      *****************************************************************                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           ##LOD     IFEQ 'D'                                                           CLE034
     C                     MOVE RSTMA     SDST                                                CLE034
     C                     MOVE RONSA     OSDA                                                CLE034
     C                     MOVE ROBRA     OSDB                                                CLE034
     C                     MOVE PSTMA     MDST                                                CLE034
     C                     MOVE PONSA     OMDA                                                CLE034
     C                     MOVE POBRA     OMDB                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE PSTMA     SDST                                                CLE034
     C                     MOVE PONSA     OSDA                                                CLE034
     C                     MOVE POBRA     OSDB                                                CLE034
     C                     MOVE RSTMA     MDST                                                CLE034
     C                     MOVE RONSA     OMDA                                                CLE034
     C                     MOVE ROBRA     OMDB                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE RSTMA     ##RECM                                              CLE034
     C                     MOVE RONSA     ##RECA                                              CLE034
     C                     MOVE ROBRA     ##RECB                                              CLE034
     C                     MOVE PSTMA     ##PAYM                                              CLE034
     C                     MOVE PONSA     ##PAYA                                              CLE034
     C                     MOVE POBRA     ##PAYB                                              CLE034
     C                     MOVE PSCYA     PSCY                                                CLE034
     C                     MOVE RSCYA     SCCY                                                CLE034
     C                     MOVE PEXRA     PEXR                                                CLE034
     C                     MOVE REXRA     REXR                                                CLE034
     C                     MOVE PEXIA     PEXI                                                CLE034
     C                     MOVE REXIA     REXI                                                CLE034
      *                                                                                       CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           CLE031    ANDNE'Y'                                                           CLE034
     C           SCCY      ANDNE*BLANKS                                                       CLE034
     C                     MOVE SCCY      ##CCY                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE CCY       ##CCY                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE031    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   SVSCCY                                              227696
     C                     MOVE *BLANKS   SVPSCY                                              227696
     C********** SCCY      IFNE *BLANKS                                              CLE034 AR943686
     C                     MOVE SCCY      SVSCCY                                              CLE034
     C**********           ENDIF                                                     CLE034 AR943686
     C********** PSCY      IFNE *BLANKS                                              CLE034 AR943686
     C                     MOVE PSCY      SVPSCY                                              CLE034
     C**********           ENDIF                                                     CLE034 AR943686
      *                                                                                     AR943686
     C                     Z-ADDREXR      SVREXR                                            AR943686
     C                     MOVE REXI      SVREXI                                            AR943686
     C                     Z-ADDPEXR      SVPEXR                                            AR943686
     C                     MOVE PEXI      SVPEXI                                            AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      /SPACE 5                                                                                CLE034
      *****************************************************************                       CLE034
      * Subroutine  :  SR34E                                          *                       CLE034
      * Function    :  Restore saved fields                           *                       CLE034
      *                                                               *                       CLE034
      * Called by   :  SRLOAN, SRMDAT                                 *                       CLE034
      * Calls       :  None                                           *                       CLE034
      *****************************************************************                       CLE034
     C           SR34E     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WSRECM    ##RECM                                              CLE034
     C                     MOVE WSRECA    ##RECA                                              CLE034
     C                     MOVE WSRECB    ##RECB                                              CLE034
     C                     MOVE WSPAYM    ##PAYM                                              CLE034
     C                     MOVE WSPAYA    ##PAYA                                              CLE034
     C                     MOVE WSPAYB    ##PAYB                                              CLE034
     C                     MOVE WSCCY     ##CCY                                               CLE034
     C**********           MOVE WSSCCY    SCCY                                       CLE034 AR943686
     C**********           MOVE WSPSCY    PSCY                                       CLE034 AR943686
     C**********           MOVE WSPEXR    PEXR                                       CLE034 AR943686
     C**********           MOVE WSREXR    REXR                                       CLE034 AR943686
     C**********           MOVE WSPEXI    PEXI                                       CLE034 AR943686
     C**********           MOVE WSREXI    REXI                                       CLE034 AR943686
     C                     MOVE W#SVCY    SVSCCY                                            AR943686
     C                     MOVE W#PSCY    SVPSCY                                            AR943686
     C                     Z-ADDW#REXR    SVREXR                                            AR943686
     C                     Z-ADDW#PEXR    SVPEXR                                            AR943686
     C                     MOVE W#REXI    SVREXI                                            AR943686
     C                     MOVE W#PEXI    SVPEXI                                            AR943686
     C                     MOVE WSLOAN    LOANCL                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRMOVE                                         *
      * Function    :  Pass Movement To Write Program                 *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRMOVE    BEGSR
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if no amount to post
      *
     C           ##AMT     CABEQ*ZERO     EXMOVE
      *
      ** Determine account movement settlement details
      *
      ** If Lending Enhancements is installed                                                 CLE031
      ** Check whether a settlement currency has been used:                                   CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'R'                                                           CLE031
     C           SVSCCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
      * Store receipt settlement details                                                      CLE031
     C                     MOVELSVSCCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVSCCY    SCCY                                              AR943686
     C                     Z-ADDSVREXR    REXR                                              AR943686
     C                     MOVE SVREXI    REXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'P'                                                           CLE031
     C           SVPSCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
      * Store pay settlement details                                                          CLE031
     C                     MOVELSVPSCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVPSCY    PSCY                                              AR943686
     C                     Z-ADDSVPEXR    PEXR                                              AR943686
     C                     MOVE SVPEXI    PEXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CLEARC#DTA
      *
     C           ##SETM    IFEQ '01'
     C           ##SETM    OREQ '02'
     C           ##SETM    OREQ '07'
     C           ##SETM    OREQ '08'
     C           ##SETM    OREQ '12'
     C                     MOVEL'N'       C#ATYP
     C                     MOVEL##NOSN    C#NOSN
     C                     ELSE
     C           ##SETM    IFEQ '14'
     C                     MOVEL'R'       C#ATYP
     C                     MOVEL##ACNO    C#ACNO
     C                     ELSE
     C           ##SETM    IFEQ '04'
     C           ##SETM    OREQ '05'
     C                     MOVEL'P'       C#ATYP
     C                     MOVEL##CNUM    C#CNUM
     C                     MOVEL##ACOD    C#ACOD
     C                     MOVEL##ACSQ    C#ACSQ
     C                     MOVEL##BRCA    C#BRCA
     C                     END
     C                     END
     C                     END
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C                     MOVEL'P'       C#ATYP                          CLE033
     C                     MOVELP@VL01    C#CNUM                          CLE033
     C                     MOVELP@VL02    C#ACOD                          CLE033
     C                     MOVEL'01'      C#ACSQ                          CLE033
     C                     MOVELBRCA      C#BRCA                          CLE033
     C*********************MOVEL##BRCA    C#BRCA                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *
      ** OLPOS Incoming/Outgoing Indicator 'I' or 'O'
      *
     C           ##PYRC    IFEQ 'P'
     C                     MOVEL'O'       C#IO             * outgoing
     C                     ELSE
     C                     MOVEL'I'       C#IO             * incoming
     C                     END
      *
      ** Currency of transaction
      *
     C                     MOVEL##CCY     C#CCY
      *
      ** Transaction type
      *
     C                     MOVEL##TRYP    C#TRYP
      *
      ** Transaction Narrative
      *
     C                     MOVEL##NARR    C#NARR
     C           ##REVI    IFEQ 'YES'
     C                     MOVE '*'       C#NARR
     C                     END
      *
      ** DL/LE/GL/RE transaction reference
      *
     C                     MOVEL##TRN     C#TRN
      *
      ** Movement amount
      *                                                                                       CLE038
     C           CLE038    IFEQ 'N'                                                           CLE038
     C           CLE038    OREQ 'Y'                                                           CLE038
     C           CLE034    ANDEQ'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WKPYRC    ANDEQ'P'                                                           CLE038
     C           PYBA      ANDNE'A'                                                           CLE038
     C           CLE038    OREQ 'Y'                                                           CLE038
     C           CLE034    ANDEQ'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WKPYRC    ANDEQ'R'                                                           CLE038
     C           RCBA      ANDNE'A'                                                           CLE038
     C           CLE038    OREQ 'Y'                                                           CLE038
     C           CLE034    ANDEQ'Y'                                                           CLE038
     C           STAL      ANDEQ'N'                                                           CLE038
      *                                                                                       CLE031
      ** If CLE031 - Lending Enhancements                                                     CLE031
      ** or CEU004 (EMU Settlement Ccy Conversion) is installed,                              CLE031
      ** check for settlement currency.                                                       CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       WRKEMU                                              CLE031
      * If CLE033 is on and settlement method is 09, postings can be                          218782
      * left in transaction ccy instead, if System Value = 'T'.                               218782
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'P'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'R'                                                           218782
      *
     C           CEU004    IFEQ 'Y'
     C           SCCY      ANDNE*BLANK
     C           SCCY      ANDNECCY
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C           SCCY      ANDNE*BLANK                                                        CLE031
     C           SCCY      ANDNECCY                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C           PSCY      ANDNE*BLANK                                                        CLE031
     C           PSCY      ANDNECCY                                                           CLE031
      *                                                                                       CLE031
      * Determine which settlement ccy to use:                                                CLE031
     C           CLE031    IFNE 'Y'                        CEU004 set. ccy                    CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     MOVE SCCY      SETCCY  3                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PSCY      SETCCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * Check if movement currency is 'In' or 'EUR'.                                          CLE031
     C                     MOVELCCY       WCCY    3                                           CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    CCYDP   10                                          CLE031
     C                     Z-ADDA6SPRT    CCYSPT 138                                          CLE031
     C                     MOVE A6MDIN    CCYMDI  1                                           CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU  1                                           CLE031
     C                     ENDIF                                                              CLE031
      * Check if settlement currency is 'In' or 'EUR'.                                        CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C                     MOVE SETCCY    WCCY                                                CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    SETDP   10                                          CLE031
     C                     MOVE A6SPRT    SETSPT 138                                          CLE031
     C                     MOVE A6MDIN    SETMDI  1                                           CLE031
      *                                                                                       CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU                                              CLE031
     C                     ENDIF                                                              CLE031
      * If amount needs to be converted between EUR and                                       CLE031
      * an In currency, use EU0200.                                                           CLE031
     C           WRKEMU    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PRTCD
     C                     Z-ADD##AMT     PFRAM
     C                     MOVE CCY       PFRCY
     C**********           MOVE SCCY      PTOCY                                               CLE031
     C                     MOVE SETCCY    PTOCY                                               CLE031
     C                     Z-ADD0         POUTA
     C                     Z-ADD0         PINTA
     C                     Z-ADD0         PEXRT
     C                     MOVE *BLANK    PMDIN
      *
     C                     CALL 'EU0200'
     C                     PARM           PRTCD   7        Return Code
     C                     PARM           PFRAM  183       From amount
     C                     PARM           PFRCY   3        From Currency
     C                     PARM           PTOCY   3        To Currency
     C                     PARM           POUTA  150       Out amount
     C                     PARM           PINTA  183       In amount
     C                     PARM           PEXRT  159       Exchange Rate
     C                     PARM           PMDIN   1        Mult/Div Ind
      *
     C           PRTCD     IFEQ *BLANK
     C                     Z-ADDPOUTA     ##AMT
     C                     ELSE
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'EU0200  'W0KEY
     C                     Z-ADD904       W0ERNB
     C                     EXSR SRERR
     C                     ENDIF
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      * Else, convert using settlement exchange rate.                                         CLE031
      * Determine which rate to use:                                                          CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     Z-ADDREXR      ZEXCH                                               CLE031
     C                     MOVE REXI      ZMD                                                 CLE031
     C                     ELSE                                                               CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C                     Z-ADDPEXR      ZEXCH                                               CLE031
     C                     MOVE PEXI      ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD##AMT     ZAMTCI                                              CLE031
     C                     MOVE CCY       ZCCYI                                               CLE031
     C                     MOVE SETCCY    ZCCYO                                               CLE031
     C                     Z-ADDCCYDP     ZCDPI                                               CLE031
     C                     Z-ADDSETDP     ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    ##AMT                                               CLE031
     C                     ENDIF                                                              CLE031
      *
     C                     ENDIF
      *
     C                     ENDIF                                                              218782
      *                                                                                       218782
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C           ##PYRC    IFEQ 'P'
     C           ##REVI    ANDNE'YES'
     C           ##PYRC    OREQ 'R'
     C           ##REVI    ANDEQ'YES'
     C                     Z-SUB##AMT     C#AMT            * pay ie credit
     C                     ELSE
     C                     Z-ADD##AMT     C#AMT            * rec ie debit
     C                     END
      *
      ** Module
      *
     C                     MOVEL'LE'      C#MOD
      *
      ** Olpos record number to update
      ** '01' for FX (not used here)
      ** '02' for Interest movements
      ** '03' for Loans and deposits
      *
     C           ##RPNB    IFEQ 2
     C                     MOVE '02'      C#OLRC
     C                     ELSE
     C                     MOVE '03'      C#OLRC
     C                     END
      *
      ** Value date and posting date
      *
     C                     Z-ADD##VDAT    C#VDAT
     C                     Z-ADD##VDAT    C#PSTD
      *
      ** Indicator to show if removal allowed Y, N or " "
      *
     C                     MOVEL'Y'       C#RPST
      *
      ** Removal set number
      *
     C                     Z-ADD##RPNB    C#RPNB
      *
      ** Removal type "C" = Credit entries
      *              "D" = Debit entries
     C                     MOVEL'C'       C#RTYP
      *
      ** Booking branch
      *
     C                     MOVEL##BBRN    C#BBRN
      *
      ** If settlement details are present
      ** AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS
      *
      ** OTHERWISE
      *
      ** If no settlement details are present
      ** AOSPOSU0 will be called to only update OLPOS
      *
     C           C#ATYP    IFEQ *BLANK
      *
      ** Set account type indicator to signify no settlement
      *
     C                     MOVEL'X'       C#ATYP
      *
      ** Set update indicators for no update
      *
     C                     MOVE 'N'       C#PRON
     C                     MOVE 'N'       C#MEMS
     C                     MOVE 'N'       C#RSAC
     C                     END
      *
      ** Do not generate maturity and interest postings if loan
      ** is not auto-settled.
      *
     C           ##RPNB    IFNE 001
     C           ##AUTO    ANDEQ'N'
     C                     MOVE 'N'       C#PRON
     C                     MOVE 'N'       C#MEMS
     C                     MOVE 'N'       C#RSAC
     C                     END
      *                                                                   CLE033
      * CLE033 LEHOSTPD postings                                          CLE033
     C           ##VDAT    IFLT BJDNWD                                    CLE033
     C           CLE033    ANDEQ'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C                     EXSR HPOST                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       CAP205
      ** Set C#MTYP to ##MTYP                                                                 CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL##MTYP    C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   CLE033
      ** Do not update PRONO, MEMOS and RSACMTPD                                           AR799918
      ** if non-auto settle repayment.                                                     AR799918
      *                                                                                    AR799918
     C           AUTO      IFEQ 'N'                                                        AR799918
     C           ##AMTP    ANDEQ'RE'                                                       AR799918
     C                     MOVE 'N'       C#PRON                                           AR799918
     C                     MOVE 'N'       C#MEMS                                           AR799918
     C                     MOVE 'N'       C#RSAC                                           AR799918
     C                     ENDIF                                                           AR799918
      *
      **  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM ##RTCD    O#RTN   7
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     OREQ '*ERROR*'
     C                     MOVEL'*CALL   'W0FILE  8
     C                     MOVEL'AOSPOSU0'W0KEY  29
     C                     Z-ADD902       W0ERNB  30
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXMOVE    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************   CLE033
      *                                                               *   CLE033
      *  HPOST    : Write record to host file                         *   CLE033
      *                                                               *   CLE033
      *  CALLED BY: Various                                           *   CLE033
      *                                                               *   CLE033
      *  CALLS    : N/A                                               *   CLE033
      *                                                               *   CLE033
      *****************************************************************   CLE033
     C           HPOST     BEGSR                                          CLE033
      *                                                                   CLE033
      * Start date                                                        CLE033
     C           ##NARR    IFEQ ##NAR,1                                   CLE033
      * Auto-settlement is on and meaningful value date                   CLE033
     C           ##AUTO    OREQ 'Y'                                       CLE033
     C           ##VDAT    ANDNE0                                         CLE033
      *                                                                                       CLE134
      ** AUTO = 'C' loan subject to funds  check                                              CLE134
      *                                                                                       CLE134
     C           ##AUTO    OREQ 'C'                                                           CLE134
     C           ##VDAT    ANDNE0                                                             CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                   CLE033
     C                     MOVE *IN99     WIN99   1                       CLE033
      *                                                                   CLE033
     C           LNRF      CHAINAOLOAN               99                   CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           CHTPX     WHEQ 'I'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C           CHTPX     OREQ 'A'                                       CLE033
     C           WBSETM    ANDNE'09'                                      CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C           WBRCID    ANDNE*BLANKS                                   CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Insert  'HOACTN                          CLE033
     C           CHTPX     WHEQ 'A'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Amend   'HOACTN                          CLE033
     C           CHTPX     WHEQ 'R'                                       CLE033
     C           ##REVI    OREQ 'YES'                                     CLE033
     C                     MOVEL'Reverse 'HOACTN                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           PTYP      WHEQ 64                                        CLE033
     C           PTYP      OREQ 65                                        CLE033
     C           PTYP      OREQ 68                                        CLE033
     C           PTYP      OREQ 71                                        CLE033
     C                     MOVEA#AM,1     HOTRYP                          CLE033
     C           PTYP      WHEQ 66                                        CLE033
     C           PTYP      OREQ 67                                        CLE033
     C           PTYP      OREQ 69                                        CLE033
     C           PTYP      OREQ 72                                        CLE033
     C                     MOVEA#AM,2     HOTRYP                          CLE033
     C                     OTHER                                          CLE033
     C                     MOVEA#AM,3     HOTRYP                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     MOVEL##NARR    W0NARR  1                       CLE033
     C                     MOVE PTYP      W0PTYP  2                       CLE033
     C           W0PTYP    CAT  W0NARR    HOETYP                          CLE033
     C                     SELEC                                          CLE033
     C           W0NARR    WHEQ 'V'                                       CLE033
     C           PTYP      IFEQ 63                                        CLE033
     C           PTYP      OREQ 65                                        CLE033
     C           PTYP      OREQ 67                                        CLE033
     C                     MOVE 2         HOETYP                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C                     ENDIF                                          CLE033
     C           W0NARR    WHEQ 'I'                                       CLE033
     C                     MOVE 2         HOETYP                          CLE033
     C           W0NARR    WHEQ 'R'                                       CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C           W0NARR    WHEQ 'M'                                       CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     MOVEL##NARR    HOETYD                          CLE033
     C**********           Z-ADDCNUML     HOCNUM                                       CLE033 CSD027
     C                     MOVE CNUML     HOCNUM                                              CSD027
     C**********           Z-ADDLNRFL     HOLNRF                                       CLE033 CLE148
     C                     MOVELLNRFL     HOLNRF                                              CLE148
     C                     Z-ADDLASNL     HOLASN                          CLE033
     C                     Z-ADDFTYPX     HOFTYP                          CLE033
     C                     Z-ADDFSEQX     HOFSEQ                          CLE033
     C                     Z-ADD0         HOFESQ                          CLE033
     C                     MOVE BRCAL     HOBRCA                          CLE033
     C                     MOVE LTYPX     HOLTYP                          CLE033
     C                     MOVE SUTPX     HOSUTP                          CLE033
     C                     MOVE CLASX     HOCLAS                          CLE042
     C                     Z-ADDRUND      HOPSTD                          CLE033
     C                     Z-ADD##VDAT    HOVALD                          CLE033
     C                     MOVE CCYL      HOCCY                           CLE033
     C                     Z-ADD##AMT     HOPSTA                          CLE033
      *                                                                   CLE033
     C                     MOVE *BLANKS   W0PNA1  5                       CLE033
     C                     MOVELLTYP      W0PNA1                          CLE033
     C                     MOVE LNRF      W0PNA2  6                       CLE033
     C           W0PNA1    CAT  W0PNA2    HOPNAR                          CLE033
      *                                                                   CLE033
     C                     MOVE AUTOX     HOAUTO                          CLE033
      *                                                                   CLE033
     C           ##REVI    IFEQ 'YES'                                     CLE033
     C           ##PYRC    IFEQ 'P'                                       CLE033
     C                     MOVE 'R'       HOTLXY                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 'P'       HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE ##PYRC    HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       220257
      * If posting amount is negative, convert to a positive amount                           220257
      * and change the debit/credit indicator                                                 220257
      *                                                                                       220257
     C           ##AMT     IFLT 0                                                             220257
     C                     Z-SUB##AMT     HOPSTA                                              220257
     C           HOTLXY    IFEQ 'P'                                                           220257
     C                     MOVE 'R'       HOTLXY                                              220257
     C                     ELSE                                                               220257
     C                     MOVE 'P'       HOTLXY                                              220257
     C                     ENDIF                                                              220257
     C                     ENDIF                                                              220257
      *                                                                   CLE033
     C                     Z-ADDINTRX     HOINTR                          CLE033
     C                     MOVE BRTTX     HOBRTT                          CLE033
     C                     Z-ADDBRTEL     HOBRTE                          CLE033
     C                     Z-ADDRTSPL     HORTSP                          CLE033
     C                     MOVE SPINL     HOSPIN                          CLE033
     C                     Z-ADDMARGX     HOMARG                          CLE033
     C                     MOVE SCCYX     HOSCCY                          CLE033
     C                     Z-ADDREXRX     HOREXR                          CLE033
     C                     MOVE REXIX     HOREXI                          CLE033
     C                     MOVE ##RECB    HORHBR                          CLE033
     C                     MOVE ##RECA    HORHAC                          CLE033
     C**********           Z-ADDROBNX     HOROBN                                       CLE033 CSD027
     C**********           Z-ADDROCNX     HOROCN                                       CLE033 CSD027
     C                     MOVE ROBNX     HOROBN                                              CSD027
     C                     MOVE ROCNX     HOROCN                                              CSD027
     C                     MOVE RIBNX     HORIBN                          CLE033
     C                     MOVE RIBAX     HORIBA                          CLE033
     C                     MOVE PSCYX     HOPSCY                          CLE033
     C                     Z-ADDPEXRX     HOPEXR                          CLE033
     C                     MOVE PEXIX     HOPEXI                          CLE033
     C                     MOVE ##PAYB    HOPHBR                          CLE033
     C                     MOVE ##PAYA    HOPHAC                          CLE033
     C**********           Z-ADDPOBNX     HOPOBN                                       CLE033 CSD027
     C**********           Z-ADDPOCNX     HOPOCN                                       CLE033 CSD027
     C                     MOVE POBNX     HOPOBN                                              CSD027
     C                     MOVE POCNX     HOPOCN                                              CSD027
     C                     MOVE PIBAX     HOPIBA                          CLE033
     C                     MOVE RVNOX     HORVNO                          CLE033
     C                     MOVE CVMRX     HOCVMR                          CLE033
     C                     MOVE RCRNX     HORCRN                          CLE033
     C                     MOVE RCRAX     HORCRA                          CLE033
     C                     MOVE AWBNX     HOAWBN                          CLE033
     C                     MOVE AWBAX     HOAWBA                          CLE033
     C                     MOVE BENNX     HOBENN                          CLE033
     C                     MOVE BENAX     HOBENA                          CLE033
     C                     MOVE DTP1X     HODTP1                          CLE033
     C                     MOVE DTP2X     HODTP2                          CLE033
     C                     MOVE DTP3X     HODTP3                          CLE033
     C                     MOVE DTP4X     HODTP4                          CLE033
     C                     MOVE DCHGX     HODCHG                          CLE033
     C                     MOVE BTB1X     HOBTB1                          CLE033
     C                     MOVE BTB2X     HOBTB2                          CLE033
     C                     MOVE BTB3X     HOBTB3                          CLE033
     C                     MOVE BTB4X     HOBTB4                          CLE033
     C                     MOVE BTB5X     HOBTB5                          CLE033
     C                     MOVE BTB6X     HOBTB6                          CLE033
     C                     Z-ADDTNLU      HOTNLU                          CLE033
     C                     MOVEL'AOOMLEU0'HOPROG                                              218782
     C                     Z-ADD0         HOSEQN                                              218782
     C                     MOVE *BLANKS   HOSTAT                                              218782
      *                                                                   CLE033
     C                     WRITELEHOSTD0                                  CLE033
      *                                                                   CLE033
     C           P@VL03    IFNE *BLANKS                                   CLE033
     C                     CALL P@VL03                                    CLE033
     C/COPY WNCPYSRC,AOOMLEUC09                                           CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     MOVE WIN99     *IN99                           CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDSR                                          CLE033
      *****************************************************************   CLE033
     C/SPACE 5                                                            CLE033
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow postings in store     *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRUPD     BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *................................................................
      *
      ** Call AOSPOSU0 to update database
      *
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM ##RTCD    O#RTN   7
     C                     PARM '*UPDATE 'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     OREQ '*ERROR*'
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD903       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      ** Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all postings in store                       *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRCLR     BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *................................................................
      *
      ** Clear arrays in AOSPOSU0
      *
     C                     CLEARC#DTA
     C                     CALL 'AOSPOSU0'             9090
     C           R#RTN     PARM ##RTCD    O#RTN   7
     C                     PARM '*CLEAR  'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     OREQ '*ERROR*'
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD901       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      ** Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRERR    : Report error and close down program               *
      *                                                               *
      *  CALLED BY: Various                                           *
      *  CALLS    : *NONE                                             *
      *                                                               *
      *****************************************************************
     C           SRERR     BEGSR
      *
      ** Dump program
      *
     C           O#RTN     IFEQ '*RECLCK'                                                   AR868380
     C           R#RTN     OREQ '*RECLCK'                                                   AR868380
     C                     ROLBK                                                            AR868380
     C                     SETON                     LR                                     AR868380
     C                     MOVEL'*RECLCK' ##RTCD                                            AR868380
     C                     ELSE                                                             AR868380
     C                     DUMP
     C           ##RTCD    IFNE '*LEBTCH'
     C                     ROLBK
     C                     ENDIF
      *
      ** Close down program
      *
     C                     SETON                     LR
     C                     MOVEL'*ERROR*' ##RTCD
      *                                                                                     AR868380
     C                     ENDIF                                                            AR868380
      *                                                                                     AR868380
     C                     RETRN
      *
     C           EXERR     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      ** ACCESS BANK DETAILS
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  Initialise work fields
      *
     C                     MOVEL'P'       ##PAY
     C                     MOVEL'R'       ##REC
     C                     MOVEL*BLANKS   R#RTN   7
     C                     MOVE '0'       *IN98
     C           *LIKE     DEFN CPAM      RLAMT                                               218984
     C           *LIKE     DEFN CPAM      BRLAMT                                              218984
     C           *LIKE     DEFN CPAM      ARLAMT                                              218984
      *
      **  Check if LE Settlement Currency Enhancement - CEU004
      *   is installed
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*VERIFY' @OPTN   7
     C                     PARM 'CEU004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** If feature is on, set up SAR work flag
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CEU004
     C                     ELSE
      *
      ** else, database error (return code other than *NRF)
      *
     C                     MOVE 'N'       CEU004  1
     C           @RTCD     IFNE '*NRF   '
     C                     MOVEL'AOOULAUO'W0PGM   8
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'*VERIFY' W0KEY
     C                     Z-ADD905       W0ERNB
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                       CLE031
      **  Check if CLE031 - Lending Enhancements                                              CLE031
      *   is installed                                                                        CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD   7                                           CLE031
     C                     PARM '*VERIFY' @OPTN   7                                           CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
      ** If feature is on, set up SAR work flag                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** else, database error if return code other than *NRF.                                 CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C           @RTCD     IFNE '*NRF   '                                                     CLE031
     C                     MOVEL'AOOULAUO'W0PGM   8                                           CLE031
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE031
     C                     MOVEL'*VERIFY' W0KEY                                               CLE031
     C                     Z-ADD906       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   CLE033
     C**  Read switchable features file SCSARDPD using access object      CLE033
     C**  to determine if switchable feature (CLE033) is switched ON      CLE033
     C*                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
     C*                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD  7                       CLE033
     C                     PARM '*VERIFY' W0OPTN  7                       CLE033
     C                     PARM 'CLE033'  W0SARD  6                       CLE033
     C           SCSARD    PARM SCSARD    DSFDY                           CLE033
     C*                                                                   CLE033
     C**  If feature is on, set up CLE033 variable                        CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFEQ *BLANKS                                   CLE033
      *                                                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
     C                     CALL 'AOSVALR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD                          CLE033
     C                     PARM SVAL,1    P@OP01 20                       CLE033
     C                     PARM *BLANKS   P@VL01200                       CLE033
     C                     PARM SVAL,2    P@OP02 20                       CLE033
     C                     PARM *BLANKS   P@VL02200                       CLE033
     C                     PARM SVAL,3    P@OP03 20                       CLE033
     C                     PARM *BLANKS   P@VL03200                       CLE033
     C**********           PARM *BLANKS   P@OP04 20                                    CLE033 218782
     C                     PARM SVAL,4    P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                       CLE033
     C                     PARM *BLANKS   P@OP05 20                       CLE033
     C                     PARM *BLANKS   P@VL05200                       CLE033
     C                     PARM *BLANKS   P@OP06 20                       CLE033
     C                     PARM *BLANKS   P@VL06200                       CLE033
     C                     PARM *BLANKS   P@OP07 20                       CLE033
     C                     PARM *BLANKS   P@VL07200                       CLE033
     C                     PARM *BLANKS   P@OP08 20                       CLE033
     C                     PARM *BLANKS   P@VL08200                       CLE033
     C                     PARM *BLANKS   P@OP09 20                       CLE033
     C                     PARM *BLANKS   P@VL09200                       CLE033
     C                     PARM *BLANKS   P@OP10 20                       CLE033
     C                     PARM *BLANKS   P@VL10200                       CLE033
     C***********SDSVAL    PARM SDSVAL    DSSDY                                        CLE033 222373
      *                                                                   CLE033
     C           W0RTCD    IFNE *BLANKS                                   CLE033
     C                     MOVEL'AOOMLEUO'W0PGM   8                       CLE033
     C                     MOVEL'SDSVALPD'W0FILE                          CLE033
     C                     MOVEL'*KEY   ' W0KEY                           CLE033
     C                     Z-ADD911       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL04    SET09   1                                           218782
      *                                                                   CLE033
      * Override CLOAN to ensure compatibility with LExxxx PGMs           CLE033
      *                                                                   CLE033
     C                     MOVEA#CMD,1    #CM                             CLE033
     C                     MOVEL'CLOAN  ' U#FILE 10                       CLE033
     C                     MOVEAU#FILE    #CM,32                          CLE033
     C                     MOVEA#CM       OVRDBF 80                       CLE033
     C                     Z-ADD80        CMDLEN 155                      CLE033
     C                     CALL 'QCMDEXC'              9090               CLE033
     C                     PARM           OVRDBF                          CLE033
     C                     PARM           CMDLEN                          CLE033
      *                                                                   CLE033
     C           *IN90     IFEQ *ON                                       CLE033
     C                     MOVEL'*CALL  ' W0FILE                          CLE033
     C                     MOVEL'QCMDEXC' W0KEY                           CLE033
     C                     Z-ADD909       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     END                                            CLE033
      *                                                                   CLE033
     C                     OPEN AOLOAN                                    CLE033
      *                                                                   CLE033
     C                     ELSE                                           CLE033
     C*                                                                   CLE033
     C** else, database error (return code other than *NRF)               CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFNE '*NRF   '                                 CLE033
     C                     MOVEL'AOOMLEUO'W0PGM                           CLE033
     C                     MOVEL'SCSARDPD'W0FILE                          CLE033
     C                     MOVEL'*VERIFY' W0KEY                           CLE033
     C                     Z-ADD912       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
      **  Check if CLE034 - Lending Enhancements Phase 1                                      CLE034
      **  Priority 1A is installed.                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   @RTCD                                               CLE034
     C                     PARM '*VERIFY' @OPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C           @RTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** else, database error (return code other than *NRF)                                   CLE034
      *                                                                                       CLE034
     C           @RTCD     IFNE '*NRF   '                                                     CLE034
     C                     MOVEL'AOOMLEUO'W0PGM                                               CLE034
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE034
     C                     MOVEL'CLE034 ' W0KEY                                               CLE034
     C                     Z-ADD908       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE038
      ** Determine if CLE038 installed                                                        CLE038
      *                                                                                       CLE038
     C                     MOVE 'N'       CLE038  1                                           CLE038
      *                                                                                       CLE038
     C                     CALL 'AOSARDR0'                                                    CLE038
     C                     PARM *BLANKS   @RTCD                                               CLE038
     C                     PARM '*VERIFY' @OPTN                                               CLE038
     C                     PARM 'CLE038'  PSARD                                               CLE038
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE038
      *                                                                                       CLE038
     C           @RTCD     IFEQ *BLANKS                                                       CLE038
     C                     MOVE 'Y'       CLE038                                              CLE038
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
      ** else, database error (return code other than *NRF)                                   CLE038
      *                                                                                       CLE038
     C           @RTCD     IFNE '*NRF   '                                                     CLE038
     C                     MOVEL'AOOMLEUO'W0PGM                                               CLE038
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE038
     C                     MOVEL'CLE038 ' W0KEY                                               CLE038
     C                     Z-ADD911       W0ERNB                                              CLE038
     C                     EXSR SRERR                                                         CLE038
     C                     ENDIF                                                              CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CAP205
      **  Check if CAP205 is installed                                                        CAP205
      *                                                                                       CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
      ** If feature is on, set up SAR work flag                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
      *                                                                                       CAP205
      ** else, database error if return code other than *NRF.                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C           @RTCD     IFNE '*NRF   '                                                     CAP205
     C                     MOVEL'AOOMLEU0'W0PGM                                               CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD913       W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CLE134
      ** Check if CLE134 - Past Due Call Loans                                                CLE134
      ** Priority 1A is installed.                                                            CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       CLE134  1                                           CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   @RTCD                                               CLE134
     C                     PARM '*VERIFY' @OPTN                                               CLE134
     C                     PARM 'CLE134'  PSARD                                               CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           @RTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD                                            MD035545
     C                     PARM           P@OP01                                            MD035545
     C                     PARM           P@VL01                                            MD035545
     C                     PARM           P@OP02                                            MD035545
     C                     PARM           P@VL02                                            MD035545
     C                     PARM           P@OP03                                            MD035545
     C                     PARM           P@VL03                                            MD035545
     C                     PARM           P@OP04                                            MD035545
     C                     PARM           P@VL04                                            MD035545
     C                     PARM           P@OP05                                            MD035545
     C                     PARM           P@VL05                                            MD035545
     C                     PARM           P@OP06                                            MD035545
     C                     PARM           P@VL06                                            MD035545
     C                     PARM           P@OP07                                            MD035545
     C                     PARM           P@VL07                                            MD035545
     C                     PARM           P@OP08                                            MD035545
     C                     PARM           P@VL08                                            MD035545
     C                     PARM           P@OP09                                            MD035545
     C                     PARM           P@VL09                                            MD035545
     C                     PARM           P@OP10                                            MD035545
     C                     PARM           P@VL10                                            MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *
      **  Copyright
      *
     C                     MOVEA##CPY     ##BIS  80
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/EJECT
     C           XCAMT     BEGSR
      *===================================================================
      * XCAMT: Convert Amount.
      *
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q                Add Index
     C                     MOVEL'XCAMT '  @STK,Q    P      Set Stack Name
      *
      ** Convert Transaction Amount into Settlement Amount.
      *
     C                     CALL 'EU0200'               90  Cvt Amount
     C                     PARM *BLANKS   P@RTCD  7        -O:Return Code
     C                     PARM           P@FRAM 183       -I:From Ccy Amt
     C                     PARM           P@FRCY  3        -I:From Crency
     C                     PARM           P@TOCY  3        -I:To Currency
     C                     PARM           P@OUTA 150       -O:Outright Amt
     C                     PARM           P@INTA 183       -O:Interim Amt
     C                     PARM           P@EXRT 159       -O:Exchange Rat
     C                     PARM           P@MDIN  1        -O:Mult/Div Ind
      *
     C           *IN90     IFEQ *ON                        If Err On Call
     C           P@RTCD    ORNE *BLANKS                    Or Err In Pgm
     C                     MOVEL'*CALL   'W0FILE            Set File Field
     C                     MOVEL'AOSARDR0'W0KEY             Set Key Field
     C                     Z-ADD905       W0ERNB            Set Error No
     C                     EXSR SRERR                       Proc Error
     C                     ENDIF                           End If
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q           Clr Stack Name
     C                     SUB  1         Q                Decr Index
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRHIST - history events                        *
      *                                                               *
      *****************************************************************
     C           SRHIST    BEGSR
      *                                                                                     MD047554
      ** Process rollover date                                                              MD047554
      *                                                                                     MD047554
     C           RLDT      IFGT 0                                                           MD047554
     C           RLDT      ANDLEVDATH                                                       MD047554
     C           NCCY      ANDEQ*BLANKS                                                     MD047554
     C                     EXSR SRROLL                                                      MD047554
     C                     ENDIF                                                            MD047554
      *
     C                     Z-ADDVDATH     OMEND
     C                     EXSR SRRPAY
      *                                                                                     MD028338
     C                     MOVE 'N'       WFXCHG  1                                         MD028338
     C           AMTPH     IFEQ 'RO'                                                        MD028338
     C           FRCOH     ANDEQ'Y'                                                         MD028338
     C                     MOVE 'Y'       WFXCHG                                            MD028338
     C                     ENDIF                                                            MD028338
      *
      ** Retain calculation basis
      *
     C           AMTPH     IFEQ 'ST'
     C           AMTPH     OREQ 'RO'
     C           AMTPH     OREQ 'MC'
     C                     MOVE CALCH     WICBS   10
     C                     ENDIF
      *
     C           WLICD     IFNE VDATH
     C           VDATH     ANDNE*ZEROS
     C           WLICD     ANDNE*ZEROS
     C           AMTPH     ANDNE'ST'
     C           AMTPH     ANDNE'MI'                                                        MD028338
     C           AMTPH     ANDNE'LS'                                                        MD028338
     C           WFXCHG    ANDNE'Y'                                                         MD028338
     C                     Z-ADDVDATH     ZIEND
     C                     EXSR SRINCL
     C                     Z-ADDVDATH     ZIBEG
     C                     ADD  ZINTR     WCALC  152
     C                     ENDIF
      *
      ** Retain current principal, rate and interest paid
      *
     C                     SELEC
     C           AMTPH     WHEQ 'ST'
     C           AMTPH     OREQ 'MC'
     C           AMTPH     IFEQ 'ST'
     C                     Z-ADDPRAMH     WCUPR
     C                     ELSE
     C                     Z-ADDCPAMH     WCUPR
     C                     ENDIF
     C                     Z-ADDBRTEH     WCUBR
     C                     Z-ADDRTSPH     WCUSP
     C                     Z-ADDINTRH     WCURT
     C                     Z-ADDVDATH     WLICD
      *
     C           AMTPH     WHEQ 'IN'
     C                     ADD  INTAH     WINPD
      *                                                                                     MD047554
      ** Include withholding tax in interest paid like IPRD.                                MD047554
      *                                                                                     MD047554
     C           WTXAH     IFNE 0                                                           MD047554
     C           WTIN      ANDEQ'G'                                                         MD047554
     C                     ADD  WTXAH     WINPD                                             MD047554
     C                     ENDIF                                                            MD047554
     C           INTC      IFEQ 'Y'
     C                     ADD  INTAH     WCUPR
     C                     ENDIF
      *
     C           AMTPH     WHEQ 'RO'
     C           PRINRO    IFNE 0
     C                     Z-ADDPRINRO    WCUPR
     C                     ENDIF
     C                     Z-ADDBRTEH     WCUBR
     C                     Z-ADDRTSPH     WCUSP
     C                     Z-ADDINTRH     WCURT
     C           WFXCHG    IFNE 'Y'                                                         MD028338
     C                     Z-ADDVDATH     WLICD
     C                     ENDIF                                                            MD028338
      *
     C           AMTPH     WHEQ 'PT'
     C           AMTPH     OREQ 'PI'
     C                     ADD  PRAMH     WCUPR
      *
     C           AMTPH     WHEQ 'PF'
     C                     SUB  PRAMH     WCUPR
      *
     C           AMTPH     WHEQ 'MR'
     C           AMTPH     OREQ 'RE'
     C           AMTPH     OREQ 'MA'
     C           VDATH     IFEQ NIDT
     C                     SUB  INTAH     ZFIRST
     C                     ELSE
     C                     ADD  INTAH     WINPD
     C                     ENDIF
     C                     SUB  PRAMH     WCUPR
      *
     C           AMTPH     WHEQ 'BR'
     C           AMTPH     OREQ 'BC'
     C                     Z-ADDBRTEH     WCUBR
     C                     EXSR SRNEWI
      *
     C           AMTPH     WHEQ 'SC'
     C                     Z-ADDRTSPH     WCUSP
     C                     EXSR SRNEWI
      *
     C           AMTPH     WHEQ 'MI'
     C                     ADD  INTAH     WINCA
     C                     ADD  INTAH     WCALC
      *
     C           AMTPH     WHEQ 'SA'
     C           STAIH     IFEQ *BLANK
     C                     Z-ADDVDATH     WLICD
     C                     ENDIF
     C                     ENDSL
      *
     C           *IN37     IFEQ '0'
     C           KEYH      READEHISTR                    37
     C           *IN37     IFEQ '1'
     C                     Z-ADD99999     VDATH
     C                     ENDIF
     C                     ENDIF
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRINCL - calculate interest                    *
      *                                                               *
      *****************************************************************
     C           SRINCL    BEGSR
     C           WCUPR     IFLE *ZEROS
     C                     Z-ADD*ZEROS    ZINTR
     C                     ELSE
     C                     Z-ADDWLICD     ZIBEG
     C                     MOVE WICBS     ZICALC
     C                     Z-ADDWCUPR     ZIAMT
     C                     Z-ADDWCURT     ZIRATE
     C                     EXSR GLINTC
      *
      ** Round down interest if required
      *
     C           RDFC      IFEQ 'Y'
     C                     Z-ADDZINTR     RDWORK 130
     C                     Z-ADDRDWORK    ZINTR
     C                     ELSE
     C                     Z-ADDZINTR     RUWORK 130H
     C                     Z-ADDRUWORK    ZINTR
     C                     ENDIF
     C**********           Z-ADDZIEND     WLICD                                             MD035938
     C                     ENDIF
     C                     Z-ADDZIEND     WLICD                                             MD035938
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRLOAM - future valued events                  *
      *                                                               *
      *****************************************************************
     C           SRLOAM    BEGSR
      *                                                                                     MD047554
      ** Process Rollover Date                                                              MD047554
      *                                                                                     MD047554
     C           RLDT      IFGT 0                                                           MD047554
     C           RLDT      ANDLEVDATL                                                       MD047554
     C           NCCY      ANDEQ*BLANKS                                                     MD047554
     C                     EXSR SRROLL                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C           WSAME     IFEQ 'Y'
     C                     GOTO PARES
     C                     ENDIF
      *
     C                     Z-ADDVDATL     OMEND
     C                     EXSR SRRPAY
      *
     C           WLICD     IFNE VDATL
     C           VDATL     ANDNE*ZEROS
     C                     Z-ADDVDATL     ZIEND
     C                     EXSR SRINCL
     C                     Z-ADDVDATL     ZIBEG
     C                     ADD  ZINTR     WCALC
     C                     ENDIF
      *
      ** Maintain current principal, rate and interest paid
      *
     C                     SELEC
     C           AMTPL     WHEQ 'PT'
     C           AMTPL     OREQ 'PI'
      *                                                                                     MD047554
     C           FPASS     IFNE 'Y'                                                         MD047554
      *                                                                                     MD047554
      ** During before status (FPASS=' '), use previous principal increase                  MD047554
      ** amount if the record is equal to the PI being amended, else use                    MD047554
      ** current value for reversal, and for live PIs.                                      MD047554
      *                                                                                     MD047554
     C           VDATL     IFEQ ##OVDT                                                      MD047554
     C           LASNL     ANDEQ##LASN                                                      MD047554
     C           AMTPL     ANDEQ'PI'                                                        MD047554
      *                                                                                     MD047554
      ** If PI amount was changed, update WCUPR with the old amount                         MD047554
      ** (#OPRAM).                                                                          MD047554
      *                                                                                     MD047554
     C           #ACTN     IFEQ 'A'                                                         MD047554
     C                     ADD  #OPRAM    WCUPR                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
      ** If actual reversal of PI, still include old PI amount for                          MD047554
      ** the recalculation of interest for reversal posting.                                MD047554
      *                                                                                     MD047554
     C           RECIL     IFEQ 'R'                                                         MD047554
     C           #ACTN     ANDEQ'R'                                                         MD047554
     C                     ADD  PRAML     WCUPR                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
      ** If a different PI record.                                                          MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
     C                     ADD  PRAML     WCUPR                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
      *                                                                                     MD047554
      ** During after status (FPASS='Y'), process live PIs only.                            MD047554
      *                                                                                     MD047554
     C           RECIL     IFNE 'R'                                                         MD047554
     C                     ADD  PRAML     WCUPR
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ENDIF                                                            MD047554
      *
     C           AMTPL     WHEQ 'PF'
     C                     SUB  PRAML     WCUPR
      *
     C           AMTPL     WHEQ 'RE'
     C           REPTL     ANDEQ2
     C                     Z-ADDPRAML     WPRAML
     C           CCY       IFNE FCCY
     C           CCYL      ANDEQFCCY
     C           FMDI      IFEQ 'M'
     C           PRAML     DIV  FCXR      WPRAML 130
     C                     ELSE
     C           PRAML     MULT FCXR      WPRAML
     C                     ENDIF
     C                     ENDIF
      *                                                                                     MD047554
     C           FPASS     IFNE 'Y'                                                         MD047554
      *
     C                     SUB  WPRAML    WCUPR                                             MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
     C                     SUB  WPRAML    WCUPR
      *                                                                                     MD047554
      ** If Autosettle indicator has been changed from Y to N,                              MD047554
      ** treat the repayment as reversal, return the amount.                                MD047554
      ** (If auto ind was changed, #ACTN is 'R')                                            MD047554
      *                                                                                     MD047554
     C           VDATL     IFEQ ##OVDT                                                      MD047554
     C           LASNL     ANDEQ##LASN                                                      MD047554
     C           #ACTN     ANDEQ'R'                                                         MD047554
     C           RECIL     ANDNE'R'                                                         MD047554
     C                     ADD  WPRAML    WCUPR                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ENDIF                                                            MD047554
      *
     C           AMTPL     WHEQ 'MR'
     C           VDATL     IFEQ NIDT
     C                     SUB  INTAL     ZFIRST
     C                     ADD  INTAL     WTINTA                                              264065
     C                     ELSE
     C                     ADD  INTAL     WINPD
     C                     ENDIF
     C                     SUB  PRAML     WCUPR
      *
      ** For repayment types 1 and 3, compute for the separate
      ** principal and interest repayments from the repayment made
      *
     C           AMTPL     WHEQ 'RE'
      *
     C                     Z-ADDTAMTL     WTAMTL
     C                     Z-ADDPRAML     WPRAML
     C           CCY       IFNE FCCY
     C           CCYL      ANDEQFCCY
     C           FMDI      IFEQ 'M'
     C           TAMTL     DIV  FCXR      WTAMTL 130H
     C           PRAML     DIV  FCXR      WPRAML
     C                     ELSE
     C           TAMTL     MULT FCXR      WTAMTL
     C           PRAML     MULT FCXR      WPRAML
     C                     ENDIF
     C                     ENDIF
      *
     C           REPTL     IFEQ 3
     C           ZINTR     IFLE WTAMTL
     C           WTAMTL    SUB  ZINTR     WPRAM  130H
     C                     Z-ADDZINTR     WINTA  130
     C                     ELSE
     C                     Z-ADD*ZEROS    WPRAM
     C                     Z-ADDWTAMTL    WINTA
     C                     ENDIF
     C                     ELSE
     C                     Z-ADDWPRAML    WPRAM
     C                     Z-ADDZINTR     WINTA
     C                     ENDIF
      *                                                                                     MD047554
     C           FPASS     IFNE 'Y'                                                         MD047554
      *                                                                                     MD047554
     C                     SUB  WPRAM     WCUPR
     C           VDATL     IFEQ NIDT
     C                     SUB  WINTA     ZFIRST
     C                     ELSE
     C                     ADD  WINTA     WINPD
     C                     ENDIF
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
      *                                                                                     MD047554
     C                     SUB  WPRAM     WCUPR                                             MD047554
     C           VDATL     IFEQ NIDT                                                        MD047554
     C                     SUB  WINTA     ZFIRST                                            MD047554
     C                     ELSE                                                             MD047554
     C                     ADD  WINTA     WINPD                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
      ** If Autosettle indicator has been changed from Y to N,                              MD047554
      ** treat the repayment as reversal. (#ACTN is 'R' if there                            MD047554
      ** is a change in auto ind.)                                                          MD047554
      *                                                                                     MD047554
     C           VDATL     IFEQ ##OVDT                                                      MD047554
     C           LASNL     ANDEQ##LASN                                                      MD047554
     C           #ACTN     ANDEQ'R'                                                         MD047554
     C           RECIL     ANDNE'R'                                                         MD047554
     C                     ADD  WPRAM     WCUPR                                             MD047554
     C           VDATL     IFEQ NIDT                                                        MD047554
     C                     ADD  WINTA     ZFIRST                                            MD047554
     C                     ELSE                                                             MD047554
     C                     SUB  WINTA     WINPD                                             MD047554
     C                     ENDIF                                                            MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ENDIF                                                            MD047554
      *
     C           AMTPL     WHEQ 'BC'
      *                                                                                     MD047554
     C           FPASS     IFNE 'Y'                                                         MD047554
      *                                                                                     MD047554
      ** During Insert of BC and record was read.                                           MD047554
      *                                                                                     MD047554
     C           #ACTN     IFNE 'R'                                                         MD047554
     C           ##OVDT    ANDEQVDATL                                                       MD047554
     C           ##LASN    ANDEQLASNL                                                       MD047554
      *                                                                                     MD047554
      ** Do nothing, use the old base rate code                                             MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
     C                     Z-ADDBRTEL     WCUBR                                             MD047554
     C                     EXSR SRNEWI                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
      ** FPASS is 'Y', process live BC.                                                     MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
     C           RECIL     IFEQ 'D'                                                         MD047554
     C                     Z-ADDBRTEL     WCUBR
     C                     EXSR SRNEWI
     C                     ENDIF                                                            MD047554
     C                     ENDIF                                                            MD047554
      *
     C           AMTPL     WHEQ 'SC'
      *                                                                                     MD047554
      ** If newly inserted SC, use the old rate on first pass.                              MD047554
      ** Use the new rate on the calculation for the after status.                          MD047554
      *                                                                                     MD047554
     C           FPASS     IFNE 'Y'                                                         MD047554
      *                                                                                     MD047554
     C           #ACTN     IFNE 'R'                                                         MD047554
     C           ##OVDT    ANDEQVDATL                                                       MD047554
     C           ##LASN    ANDEQLASNL                                                       MD047554
      *                                                                                     MD047554
      ** Do not use new rate when calculating the amount to                                 MD047554
      ** be reversed.                                                                       MD047554
      *                                                                                     MD047554
     C                     ELSE                                                             MD047554
     C                     Z-ADDRTSPL     WCUSP                                             MD047554
     C                     EXSR SRNEWI                                                      MD047554
     C                     ENDIF                                                            MD047554
      * FPASS is 'Y'                                                                        MD047554
     C                     ELSE                                                             MD047554
     C           RECIL     IFEQ 'D'                                                         MD047554
     C                     Z-ADDRTSPL     WCUSP
     C                     EXSR SRNEWI
     C                     ENDIF                                                            MD047554
     C                     ENDIF                                                            MD047554
      *
     C           AMTPL     WHEQ 'SA'
     C           STAIH     IFEQ *BLANK
     C                     Z-ADDVDATL     WLICD
     C                     ENDIF
      *
     C           AMTPL     WHEQ 'PD'
     C           INTAL     IFNE *ZEROS
     C                     ADD  INTAL     WINPD
     C                     ENDIF
      *
      ** Add past due amount to running balance.
      *
     C           RATF      IFEQ 'Y'
     C                     ADD  PRAML     WCUPR
     C                     ENDIF
      *
     C                     ENDSL
      *
     C           PARES     TAG
     C           *IN34     IFEQ '0'
     C           *IN34     DOUEQ'1'
     C           RECIL     OREQ 'D'
     C           VDATL     ANDLEMDAT
     C           AMTPL     OREQ ##AMTP
     C           LASNL     ANDEQ##LASN
     C           VDATL     ANDEQ##OVDT
     C           RECIL     ANDEQ'R'
     C           VDATL     ANDLEMDAT
     C           LNRF      READELOAMSOM1                 34
     C                     ENDDO
     C           *IN34     IFEQ '1'
     C                     Z-ADD99999     VDATL
     C                     ENDIF
     C                     ENDIF
     C                     ENDSR
      /EJECT
      *****************************************************************
      * Subroutine : SRNEWI - apply new interest rate                 *
      *                                                               *
      *****************************************************************
     C           SRNEWI    BEGSR
      *
      ** Reflect spread to effective interest
      *
     C                     SELEC
     C           SPIN      WHEQ 'A'
     C           WCUBR     ADD  WCUSP     WCURT
     C           SPIN      WHEQ 'S'
     C           WCUBR     SUB  WCUSP     WCURT
     C           SPIN      WHEQ 'P'
     C           WCUSP     DIV  100       WWORK  119
     C           WCUBR     MULT WWORK     WCURT
     C                     ENDSL
      *
     C                     ENDSR
      ********************************************************************
      * Subroutine : SRRPAY - interest payment and repayment          *
      *                       frequency                               *
      *                                                               *
      ********************************************************************
     C           SRRPAY    BEGSR
      *
     C           WNRPD     DOWLEOMEND
     C           WNRPD     ANDGENRPD                                                        AR830785
     C           MDAT      ANDNEWNRPD                                                         205504
     C           WNIDT     ORLE OMEND
     C           WNIDT     ANDGENIDT                                                        AR830785
     C           MDAT      ANDNEWNIDT                                                         205504
      *
      **  Process Repayment frequency.
      *
     C           WNRPD     DOWLEOMEND
     C           WNRPD     ANDGENRPD                                                        AR830785
     C           WNRPD     ANDLTWNIDT
      *
     C           WLICD     IFNE WNRPD
     C           WNRPD     ANDNE0
     C                     Z-ADDWNRPD     ZIEND
     C                     EXSR SRINCL
     C                     Z-ADDWNRPD     ZIBEG
     C                     ADD  ZINTR     WCALC
     C                     ENDIF
      *
     C           WCUPR     SUB  RAMT      WCUPR
     C           RFRQ      IFNE *BLANKS
     C                     MOVELRFRQ      ZFREQ
     C                     Z-ADDWNRPD     ZDAYNO
     C                     MOVELCCY       ZCCY
     C                     EXSR ZFRQB3
     C                     Z-ADDZDAYNO    WNRPD
     C                     ELSE
     C                     Z-ADD99999     WNRPD
     C                     ENDIF
     C                     ENDDO
      *
      **  Next Interest Payment Date.
      *
     C           WNIDT     DOWLEOMEND
     C           WNIDT     ANDLEWNRPD
      *
     C           WLICD     IFNE WNIDT
     C********** WNRPD     ANDNE0                                                             221505
     C           WNIDT     ANDNE0                                                             221505
     C                     Z-ADDWNIDT     ZIEND
     C                     EXSR SRINCL
     C                     Z-ADDWNIDT     ZIBEG
     C                     ADD  ZINTR     WCALC
     C                     Z-ADDWCALC     ZINTRS 152
     C                     SUB  WINPD     ZINTRS                                              205504
     C           WNIDT     IFEQ NIDT
     C                     Z-ADDWCALC     ZFIRST 152
     C                     SUB  WINPD     ZFIRST                                              205504
     C                     ENDIF
     C                     ENDIF
      *
     C           IPFR      IFNE *BLANKS
     C                     MOVELIPFR      ZFREQ
     C                     Z-ADDWNIDT     ZDAYNO
     C                     MOVELCCY       ZCCY
     C                     EXSR ZFRQB3
     C                     Z-ADDZDAYNO    WNIDT
     C                     ELSE
     C                     Z-ADD99999     WNIDT
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDDO
     C                     ENDSR
      *****************************************************************                       221505
      * Subroutine  :  SRROLL - Rollover date processing for interest *                       221505
      *                                                               *                       221505
      *****************************************************************                       221505
     C           SRROLL    BEGSR                                                              221505
      *                                                                                       221505
     C                     Z-ADDRLDT      OMEND                                               221505
     C                     EXSR SRRPAY                                                        221505
      *                                                                                       221505
     C           WLICD     IFNE RLDT                                                          221505
     C                     Z-ADDRLDT      ZIEND                                               221505
     C                     EXSR SRINCL                                                        221505
     C                     Z-ADDRLDT      ZIBEG                                               221505
     C                     ADD  ZINTR     WCALC  152                                          221505
     C                     ENDIF                                                              221505
     C*                                                                                       221505
     C           LNRF      CHAINLELOANL2             88                                       221505
     C           NCCY      IFEQ *BLANKS                                                       221505
     C           NFCE      ANDNE*ZEROS                                                        221505
     C           NPRAM     IFNE *ZEROS                                                        221505
     C                     Z-ADDNPRAM     WCUPR                                               221505
     C                     ENDIF                                                              221505
     C*                                                                                       221505
     C                     Z-ADDNFCE      FCXR                                                221505
     C                     MOVELNFMD      FMDI                                                221505
     C                     ENDIF                                                              221505
     C*                                                                                       221505
     C           NCCY      IFNE *BLANKS                                                       221505
     C                     Z-ADDNCPA      WCUPR                                               221505
     C                     MOVELNCCY      CCY                                                 221505
     C                     Z-ADDNLRA      RAMT                                                221505
     C                     Z-ADDNFCE      FCXR                                                221505
     C                     MOVELNFMD      FMDI                                                221505
     C                     ELSE                                                             MD047554
     C           NRTS      IFGT 0                                                           MD047554
     C           NBRA      ORGT 0                                                           MD047554
     C                     Z-ADDNRTS      WCUSP                                             MD047554
     C                     Z-ADDNBRA      WCUBR                                             MD047554
     C                     MOVELNSIN      SPIN                                              MD047554
     C                     EXSR SRNEWI                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     ENDIF                                                              221505
     C*                                                                                       221505
     C                     MOVEL'Y'       ROLLED  1                                           221505
      *                                                                                       221505
     C                     ENDSR                                                              221505
      ********************************************************************
      ** Subroutine  :  SRCURR                                        *                       CLE031
      ** Function    :  Check currency details                        *                       CLE031
      ** Calls       :  AOCURRR0                                      *                       CLE031
      **                                                              *                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           SRCURR    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOCURRR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD                                               CLE031
     C                     PARM '*KEY    '@OPTN                                               CLE031
     C                     PARM WCCY      @CURR   3                                           CLE031
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE031
      *                                                                                       CLE031
      ** Handle Database Error.                                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFNE *BLANKS                                                       CLE031
     C                     MOVEL'AOCURRR0'W0PGM   8                                           CLE031
     C                     MOVEL'SDCURRPD'W0FILE                                              CLE031
     C                     MOVEL'WCCY   ' W0KEY                                               CLE031
     C                     Z-ADD907       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C/SPACE 5
      /EJECT
     C/COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDLINTZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZCBDYSZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZINTDYZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE9Z3
      /EJECT
     C/COPY ZSRSRC,ZFRQB3
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
      /TITLE SR/ZCONV                                                                         CLE031
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE031
      /EJECT                                                                                  CLE031
** ##LDT  **      Loan Processing Types
66676972                                                                                      CLE034
** ##NAR  **      NARRATIVES
VALUE
INTEREST
REPAYMENT
MATURITY
ROLLOVER NEW CCY                                                                      220754  218984
REPAY OLD CCY                                                                                 218984
ROLLOVER REPAYMENT                                                                            218984
ROLLOVER INCREASE                                                                             218984
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2002
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           CLE031
0000001                                                                                       CLE031
0000010                                                                                       CLE031
0000100                                                                                       CLE031
0001000                                                                                       CLE031
0010000                                                                                       CLE031
0100000                                                                                       CLE031
1000000                                                                                       CLE031
**   SVAL  -  SYSTEM VALUES ARRAY                                                             CLE033
Settlement09Customer                                                                          CLE033
Settlement09AccCode                                                                           CLE033
Settlement09Hostpgm                                                                           CLE033
Settlement09Postings                                                                          218782
**   #CMD                                                                                     CLE033
OVRDBF     FILE(AOLOAN) TOFILE(XXXXXXXXXX) SHARE(*NO) SECURE(*YES)                            CLE033
**   #AM   -  AMENDMENT TYPE                                                                  CLE033
Participation P.                                                                              CLE033
Participation S.                                                                              CLE033
Loan                                                                                          CLE033
