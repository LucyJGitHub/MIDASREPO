000100200528     H        1
000200200528      *****************************************************************
000300200528/*STD *  RPGBASE                                                      *
000400200528/*EXI *  TEXT('Midas AO On-line update of FX position files')         *
000500200528     F********************************************************************
000600200528     F*                                                                  *
000700200528     F*  Midas - Access Objects Module                                   *
000800200528     F*                                                                  *
000900200528     F*     AOOUFXU0 - On-line Update of FX Positions files              *
001000200528     F*                                                                  *
001100200528      *  (c) Finastra International Limited 2001                         *
001200200528     F*                                                                  *
001300200604      *  Last Amend No. 251029             Date 22May20               *
001400200528      *  Prev Amend No. MD046248           Date 27Oct17               *
001500200528      *                 CDL099             Date 06Oct17               *
001600200528      *                 CLE134             Date 01Aug12               *
001700200528      *                 CSW212             Date 03May12               *
001800200528      *                 CRE075             Date 06Dec10               *
001900200528      *                 CER059             Date 19Jul10               *
002000200528      *                 BUG25226A          Date 08Sep09               *
002100200528      *                 CER047             Date 19May08               *
002200200528      * Bank Fusion Midas 1.4 Base -----------------------------------*
002300200528      *                 CAP205             Date 19Feb10               *
002400200528      *                 CAP204             Date 09Feb10               *
002500200528      * Midas Plus 1.4 Base 04 ---------------------------------------*
002600200528      * Midas Plus 1.4 Base ------------------------------------------*
002700200528      * Midas Plus 1.3 ----------- Base ------------------------------*
002800200528      *                 241166             Date 17Jul06               *
002900200528      *                 CDL049             Date 04Jul06               *
003000200528      *                 CSD027             Date 09Dec05               *
003100200528      *                 CLE025             Date 20Oct03               *
003200200528      *                 CSC022             Date 24Feb04               *
003300200528      *                 CGL029             Date 01Sep03               *
003400200528      * Midas Release 4 --------------- Base -------------------------*
003500200528      * Midas DBA 3.04 -----------------------------------------------*
003600200528      *                 CDL008             Date 02May00               *
003700200528      * Midas DBA 3.00 ---------------- Base -------------------------*
003800200528      *                 154448             DATE 13Oct98               *
003900200528     F*                 141213             DATE 23Aug98               *
004000200528     F*                 121483             Date 09Jun98               *
004100200528     F*                 136436             Date 10Jun98               *
004200200528     F*                 CEU003             Date 08Jan98               *
004300200528     F*                 082738             Date 03Feb95               *
004400200528     F*                                                               *
004500200528     F*                                                                  *
004600200528     F*------------------------------------------------------------------*
004700200528     F*                                                                  *
004800200528      *  251029 - Applied fix 231306.                                 *
004900200528      *  231306 - Handle file locking properly.                       *
005000200528      *  MD046248 - Finastra Rebranding                               *
005100200528      *  CDL099 - Split Value Date                                    *
005200200528      *  CLE134 - Past Due Call Loan Processing                       *
005300200528      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
005400200528      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
005500200528      *  CER059 - German Feature Upgrade to Delhi                     *
005600200528      *  BUG25226A - Field 61 on MT942 is not showing correct data    *
005700200528      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
005800200528      *           (recompiled)                                        *
005900200528      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
006000200528      *           (Recompile)                                         *
006100200528      *  CAP205 - Teller Related APIs - Account Balance Check         *
006200200528      *  CAP204 - Teller Related APIs - Account Transfer              *
006300200528      *  241166 - Modify certain shadow posting narrative to include  *
006400200528      *         - transaction ref if SdwPstIncTransRef = 'Y'          *
006500200528      *  CDL049 - Addition of a Reference Rate field (recompile)      *
006600200528      *  CSD027 - Conversion Of Customer Number to Alpha              *
006700200528      *  CLE025 - Credit Lines (Recompile)                            *
006800200528      *  CSC022 - Commitment Control Changes for MidasPlus            *
006900200528      *  CGL029 - Increase Account Code to 10 digits                  *
007000200528      *  CDL008 - Continuous Linked Settlement                        *
007100200528     F*  154448 - Correct update of online position file for swap deals  *
007200200528     F*  141213 - Fix 121483 causes update errors in AOSPOSU0.           *
007300200528     F*  121483 - Applied fix 105483:                                 *
007400200528     F*         - If account type is equal to 'N' or 'F', program     *
007500200528     F*           will not call AOSPOSU0.                             *
007600200528     F*         - The parameters being passed by the calling program *
007700200528     F*           (AOOUFXU0 or AOOUMMU0) does not match the parame-  *
007800200528     F*           ters being received by the calling pgm (AONOSTR0). *
007900200528     F*         - Program AOSPOSU0 ended in error when tried to      *
008000200528     F*           amend settlement instruction.                      *
008100200528     F*         - Renamed the field LCD in a new DS SDACNT to NLCD   *
008200200528     F*           since it's been already defined in DS SCSARD       *
008300200528     F* 136436 - Deletion of authorized deals does not reverse a/c moves *
008400200528     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
008500200528     F* 082738 - New program for redesign of update to PRONO, MEMOS,     *
008600200528     F*          OLPOS & RSACMTPD.                                       *
008700200528     F*                                                                  *
008800200528     F********************************************************************
008900200528     F/COPY WNCPYSRC,AOOUFXU0F1
009000200528     F*                                                               *
009100200528     F*  Indicator usage                                              *
009200200528     F*  ~~~~~~~~~~~~~~~                                              *
009300200528     F*                                                               *
009400200528     F*****************************************************************
009500200528     E/SPACE 5
009600200528     E*
009700200528     E**  (Posting) Naratives
009800200528     E                    ##NAR   1   2 30
009900200528     E/COPY ZSRSRC,ZDATE9Z1
010000200528     E*
010100200528     E*  Subroutine stack
010200200528     E                    @STK       20 10
010300200528     E/COPY WNCPYSRC,AOH00037
010400200528     E*
010500200528     E**  Copyright array.
010600200528     E                    ##CPY   1   1 80
010700200528      ** Array of Commitment Job Names                                                        CSC022
010800200528     E                    CMTJOB     10 10                                                    CSC022
010900200528     E/COPY WNCPYSRC,AOH00038
011000200528     I/SPACE 5
011100200528     IZ#BSTS    E DSZ#BST
011200200528     IZ#ASTS    E DSZ#AST
011300200528     IZ#WSTS    E DSZ#WST
011400200528     IZ#XSTS    E DSZ#XST                                                 154448
011500200528     I*
011600200528     IFXDEAL    E DSFXDEALPP
011700200528     I##PAYD      DS
011800200528     I                                        1   1 ##PAY
011900200528     I                                        2   3 ##PAYM
012000200528     I**********                              4  15 ##PAYA                                    CGL029
012100200528     I**********                             16  18 ##PAYB                                    CGL029
012200200528     I                                        4  21 ##PAYA                                    CGL029
012300200528     I                                       22  24 ##PAYB                                    CGL029
012400200528     I##RECD      DS
012500200528     I                                        1   1 ##REC
012600200528     I                                        2   3 ##RECM
012700200528     I**********                              4  15 ##RECA                                    CGL029
012800200528     I**********                             16  18 ##RECB                                    CGL029
012900200528     I                                        4  21 ##RECA                                    CGL029
013000200528     I                                       22  24 ##RECB                                    CGL029
013100200528     I##SETD      DS
013200200528      * pay/receive (P/R)
013300200528     I                                        1   1 ##PYRC
013400200528      * settlement method
013500200528     I                                        2   3 ##SETM
013600200528      * settlement account
013700200528     I**********                              4  15 ##SETA                                    CGL029
013800200528     I                                        4  21 ##SETA                                    CGL029
013900200528     I                                        4   5 ##NOSN
014000200528     I                                        4  13 ##ACNO
014100200528     I                                        4   9 ##CNUM
014200200528     I**********                             10  13 ##ACOD                                    CGL029
014300200528     I**********                             14  15 ##ACSQ                                    CGL029
014400200528     I                                       10  19 ##ACOD                                    CGL029
014500200528     I                                       20  21 ##ACSQ                                    CGL029
014600200528      * settlement branch
014700200528     I**********                             16  18 ##BRCA                                    CGL029
014800200528     I                                       22  24 ##BRCA                                    CGL029
014900200528      *
015000200528      *  Calling parameter data structure for AOSPOSU0
015100200528      *
015200200528     IC#DTA       DS                            256
015300200528      *  Account type N=nostro nbr F=Full nostro G=General Ledger
015400200528      ****************P=Partial Ledger R= Retail Number                   082738
015500200528      *               P=Partial Ledger R= Retail Number  X= no settlement 082738
015600200528     I                                        1   1 C#ATYP
015700200528      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
015800200528     I                                        2  19 C#ACCT
015900200528     I**********                              2   70C#CNU1                                    CSD027
016000200528     I                                        2   7 C#CNU1                                    CSD027
016100200528     I                                        8  10 C#CCY1
016200200528     I**********                             11  140C#ACO1                                    CGL029
016300200528     I                                       15  160C#ACS1
016400200528     I                                       17  19 C#BRC1
016500200528      *               Nostro number
016600200528     I                                        2   30C#NOSN
016700200528      *               Full Nostro - CCY/NOSN
016800200528     I                                        2   6 C#NOS
016900200528      *               Retail Number
017000200528     I                                        2  110C#ACNO
017100200528      *               Partial Account - CNUM/ACOD/ACSQ
017200200528     I**********                              2   70C#CNUM                                    CSD027
017300200528     I                                        2   7 C#CNUM                                    CSD027
017400200528     I**********                              8  110C#ACOD                                    CGL029
017500200528     I                                       12  130C#ACSQ
017600200528      *               Branch of account if Partial                      '
017700200528     I                                       14  16 C#BRCA
017800200528      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
017900200528      *                     ' ' no OLPOS update
018000200528     I                                       24  24 C#IO
018100200528      *               Currency of transaction
018200200528     I                                       25  27 C#CCY
018300200528      *               Transaction Type
018400200528     I                                       28  29 C#TRYP
018500200528      *               Transaction Narrative
018600200528     I                                       30  59 C#NARR
018700200528      *               Cheque Number
018800200528     I                                       60  670C#CHQN
018900200528      *               FT transaction reference
019000200528     I                                       68  82 C#PREF
019100200528      *               DL/LE/GL/RE transaction reference
019200200528     I                                       83  88 C#TRN
019300200528      *               Movement amount
019400200528     I                                    P  89  960C#AMT
019500200528      *               Processing indicators Not blank = no update
019600200528      *                                     ' ' = Update
019700200528      *               Prono update indicator
019800200528     I                                       97  97 C#PRON
019900200528      *               Olpos update indicator
020000200528     I                                       98  98 C#OLPS
020100200528      *               Memos update indicator
020200200528     I                                       99  99 C#MEMS
020300200528      *               Rsacmtpd write indicator
020400200528     I                                      100 100 C#RSAC
020500200528      *               Module
020600200528     I                                      101 102 C#MOD
020700200528      *               Olpos record number to update
020800200528      *                     '01' for FX
020900200528      *                     '02' for Interest movements
021000200528      *                     '03' for MM loans and deposits
021100200528     I                                      103 104 C#OLRC
021200200528      *               FT Memos ledger balance override
021300200528      *                        'Y' update ledger balance irrespective of
021400200528      *                        posting date
021500200528     I                                      105 105 C#FTOV
021600200528      *               Value date and posting date
021700200528     I                                    P 106 1080C#VDAT
021800200528     I                                    P 109 1110C#PSTD
021900200528      *               Override posting date correction
022000200528      *                        for forward valued items
022100200528      *                        'Y' prevents date being changed
022200200528     I                                      112 112 C#PSTO
022300200528      *               Indicator to show if removal allowed Y, N or " "
022400200528     I                                      113 113 C#RPST
022500200528      *               Removal set number
022600200528     I                                      114 1160C#RPNB
022700200528      *               Removal type "C" = Credit entries
022800200528      *                            "D" = Debit entries
022900200528     I                                      117 117 C#RTYP
023000200528      *               Booking branch                                      082738
023100200528     I                                      118 120 C#BBRN                082738
023200200528      *                                                                                       CGL029
023300200528      ** Account code for full general ledger                                                 CGL029
023400200528      *                                                                                       CGL029
023500200528     I                                      121 1300C#ACO1                                    CGL029
023600200528      *                                                                                       CGL029
023700200528      ** Account code for partial account                                                     CGL029
023800200528      *                                                                                       CGL029
023900200528     I                                      131 1400C#ACOD                                    CGL029
024000200528      *                                                                                       CAP204
024100200528      ** Other Transaction Reference                                                          CAP204
024200200528      *                                                                                       CAP204
024300200528     I                                      141 160 C#OTR1                                    CAP204
024400200528      *                                                                                       CAP205
024500200528      ** Movement Type                                                                        CAP205
024600200528      *                                                                                       CAP205
024700200528     I                                      161 161 C#MTYP                                    CAP205
024800200528      *                                                                                       CLE134
024900200528      ** Exception Reference Id/Number                                                        CLE134
025000200528      *                                                                                       CLE134
025100200528     I                                      162 164 C#XRFI                                    CLE134
025200200528     I                                      165 1740C#XRFN                                    CLE134
025300200528     I**                                                                                      241166
025400200528     I* Data structure for more detailed description                                          241166
025500200528     I            DS                                                                          241166
025600200528     I                                        1  15 D#WORK                                    241166
025700200528     I                                        1   6 D#TRN                                     241166
025800200528     I                                        9  10 D#TYP                                     241166
025900200528      *                                                                                       CAP205
026000200528     ISDBANK    E DSSDBANKPD                                                                  CAP205
026100200528      ** Bank Details File                                                                    CAP205
026200200528      *                                                                   CEU003
026300200528     ISCSARD    E DSSCSARDPD                                              CEU003
026400200528      ** Switchable Features File                                         CEU003
026500200528      *                                                                   CEU003
026600200528     IDSFDY     E DSDSFDY                                                 CEU003
026700200528      * First DS for Access programs, Short Data Structure                CEU003
026800200528      *                                                                   CEU003
026900200528     ICPYR        DS
027000200528     I**  Data Structure for Compilation - Copyright Insertion
027100200528     I                                        1  80 ##CPY
027200200528     I/COPY ZSRSRC,ZDAT10Z1
027300200528     ISDACNT    E DSACCNTAB                                               121483
027400200528     I*                                                                   121483
027500200528     I** EXTERNAL DS FOR ACCOUNT DETAILS                                  121483
027600200528     I*                                                                   121483
027700200528     I              RECI                            NRECI                 121483
027800200528     I              CNUM                            NCNUM                 121483
027900200528     I              CCY                             NCCY                  121483
028000200528     I              BRCA                            NBRCA                 121483
028100200528     I              PRFC                            NPRFC                 121483
028200200528     I              ORED                            NORED                 121483
028300200528     I              FACT                            NFACT                 121483
028400200528     I              FCNO                            NFCNO                 121483
028500200528     I              CHTP                            NCHTP                 121483
028600200528     I              TNLU                            NTNLU                 121483
028700200528     I              NACSG                           NNACSG                121483
028800200528     I              LCD                             NLCD                  121483
028900200528     I*                                                                   121483
029000200528     ISDNOST    E DSSDNOSTPD                                              121483
029100200528     I** EXTERNAL DS FOR NOSTRO DETAILS                                   121483
029200200528     I*                                                                   121483
029300200528     ISDCUST    E DSSDCUSTPD                                                               BUG25226A
029400200528      * Customer Details Accessed via Access program                                       BUG25226A
029500200528     I              QQDFAC                          QQDFA1                                 BUG25226A
029600200528      *                                                                                    BUG25226A
029700200528     IDSSDY     E DSDSSDY                                                 121483
029800200528     I*                                                                   121483
029900200528     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                121483
030000200528     IDSLDY     E DSDSLDY                                                                  BUG25226A
030100200528      *  Third DS for Access programs, Very Long Data Structure                            BUG25226A
030200200528      *                                                                                    BUG25226A
030300200528     I*                                                                   121483
030400200528     ICONV        DS                                                      121483
030500200528     I                                        1   2 D#ACSQ                121483
030600200528     I* DATA STRUCTURE THAT CONVERTS NUMERIC ACSQ TO CHARACTER            121483
030700200528     I*                                                                   121483
030800200528     I/COPY WNCPYSRC,AOH00039
030900200528      *                                                                                       CSC022
031000200528     ISCCMT       DS                            256                                           CSC022
031100200528     I                                        1   30CMTNUM                                    CSC022
031200200528     I                                        4 103 CMTARR                                    CSC022
031300200528      *                                                                                       CSC022
031400200528      *  Program data structure                                                               CSC022
031500200528      *                                                                                       CSC022
031600200528     IDSPGM     ESDSY2PGDSP                                                                   CSC022
031700200528      *                                                                                       CSC022
031800200528     ISVAL1       DS                            200                                           241166
031900200528     I                                        1   1 SVAL11                                    241166
032000200528      ** DS for AOSVALR0                                                                      241166
032100200528      *                                                                                       241166
032200200528     I              'SdwPstIncTransRef   'C         SVALKK                                    241166
032300200528     C/SPACE 5
032400200528      *****************************************************************
032500200528      * Process     :  MAINLINE                                       *
032600200528      * Function    :  Mainline processing                            *
032700200528      *                                                               *
032800200528      * Called by   :  None                                           *
032900200528      * Calls       :  SRINIT - Initial Processing - On First Call    *
033000200528      *                SRMAIN - Main Processing                       *
033100200528      *****************************************************************
033200200528      *
033300200528      **  Parameter list for current program invocation.
033400200528     C           *ENTRY    PLIST
033500200528     C                     PARM           ##RTCD  7
033600200528     C                     PARM           Z#BSTS
033700200528     C                     PARM           Z#ASTS
033800200528     C                     PARM           Z#WSTS
033900200528     C                     PARM           Z#XSTS                          154448
034000200528      *
034100200528      **  Set up subroutine stack name
034200200528     C                     ADD  1         Q
034300200528     C                     MOVEL'MAIN'    @STK,Q
034400200528      *
034500200528      *................................................................
034600200528      *
034700200528      **  Initial processing - Once Only
034800200528     C           ##INIT    IFEQ *BLANK
034900200528     C                     EXSR SRINIT
035000200528     C                     MOVE 'Y'       ##INIT  1
035100200528     C                     ENDIF
035200200528      *
035300200528      *  Main processing
035400200528     C                     EXSR SRMAIN
035500200528      *
035600200528      *................................................................
035700200528      *
035800200528      **  Unwind subroutine stack name
035900200528     C                     MOVEA*BLANKS   @STK,Q
036000200528     C                     SUB  1         Q
036100200528      *
036200200528      **  Terminate program
036300200528     C                     RETRN
036400200528      *****************************************************************
036500200528     C/SPACE 5
036600200528      *****************************************************************
036700200528      * Subroutine  :  SRMAIN                                         *
036800200528      * Function    :  Main processing                                *
036900200528      *                                                               *
037000200528      * Called by   :  Mainline                                       *
037100200528      * Calls       :                                                 *
037200200528      *****************************************************************
037300200528     C           SRMAIN    BEGSR
037400200528      *
037500200528      **  Set up subroutine stack name
037600200528     C                     ADD  1         Q       50
037700200528     C                     MOVEL'SRMAIN'  @STK,Q
037800200528      *
037900200528      *................................................................
038000200528      *
038100200528      ** Clear down all shadow postings in store (within AOSPOSU0)
038200200528      *
038300200528     C                     EXSR SRCLR
038400200528      *
038500200528     C                     MOVELZ#BSTS    #BRCID  2
038600200528     C                     MOVELZ#ASTS    #ARCID  2
038700200528     C                     MOVELZ#WSTS    #WRCID  2
038800200528     C                     MOVELZ#XSTS    #XRCID  2                       154448
038900200528      *                                                                   154448
039000200528      ** Generate 'BEFORE STATUS' account movements                       154448
039100200528      ** (if not insertion, when #BRCID will be blank)                    154448
039200200528      *                                                                   154448
039300200528     C           #BRCID    IFNE *BLANK                                    154448
039400200528      *                                                                   154448
039500200528     C                     MOVEL'YES'     ##REVI  3                       154448
039600200528      *                                                                   154448
039700200528      ** Set up FX deal data structure.                                   154448
039800200528     C                     MOVELZ#BSTS    FXDEAL                          154448
039900200528     C                     EXSR SRFXDL                                    154448
040000200528      *                                                                   154448
040100200528     C                     END                             * #BRCID       154448
040200200528      *                                                                   154448
040300200528      ** Generate 'BEFORE STATUS' account movements                       154448
040400200528      ** for associated deal if present (option or other leg of swap)     154448
040500200528      *                                                                   154448
040600200528     C           #WRCID    IFNE *BLANK                                    154448
040700200528      *                                                                   154448
040800200528     C                     MOVEL'YES'     ##REVI                          154448
040900200528      *                                                                   154448
041000200528      ** Set up FX deal data structure.                                   154448
041100200528     C                     MOVELZ#WSTS    FXDEAL                          154448
041200200528     C                     EXSR SRFXDL                                    154448
041300200528      *                                                                   154448
041400200528      ** FX swap - 'BEFORE STATUS' extra processing                       154448
041500200528      *                                                                   154448
041600200528     C           #BRCID    IFNE *BLANK                                    154448
041700200528     C           FHTYPE    ANDEQ'SW'                                      154448
041800200528     C                     EXSR SRFXSW                                    154448
041900200528     C                     END                                            154448
042000200528      *                                                                   154448
042100200528     C                     END                             * #WRCID       154448
042200200528      *                                                                   154448
042300200528      ** Generate 'AFTER STATUS' account movements                        154448
042400200528      ** (if not deletion, when FHCHTP will be 'D')                       154448
042500200528      *                                                                   154448
042600200528     C                     MOVEL*BLANK    ##REVI                          154448
042700200528      *                                                                   154448
042800200528      ** Set up FX deal data structure.                                   154448
042900200528     C                     MOVELZ#ASTS    FXDEAL                          154448
043000200528     C           FHCHTP    IFNE 'D'                                       154448
043100200528     C           FHLACT    ANDNE'D'                                       154448
043200200528     C                     EXSR SRFXDL                                    154448
043300200528     C                     END                                            154448
043400200528      *                                                                   154448
043500200528      ** Generate 'AFTER STATUS' account movements                        154448
043600200528      ** for associated deal if present (option or other leg of swap)     154448
043700200528      *                                                                   154448
043800200528     C           #XRCID    IFNE *BLANK                                    154448
043900200528      *                                                                   154448
044000200528      ** Set up FX deal data structure.                                   154448
044100200528     C                     MOVELZ#XSTS    FXDEAL                          154448
044200200528     C           FHCHTP    IFNE 'D'                                       154448
044300200528     C           FHLACT    ANDNE'D'                                       154448
044400200528     C                     EXSR SRFXDL                                    154448
044500200528     C                     END                                            154448
044600200528      *                                                                   154448
044700200528      ** FX swap - 'AFTER STATUS' extra processing                        154448
044800200528      *                                                                   154448
044900200528     C           FHCHTP    IFNE 'D'                                       154448
045000200528     C           FHLACT    ANDNE'D'                                       154448
045100200528     C           FHTYPE    ANDEQ'SW'                                      154448
045200200528     C                     EXSR SRFXSW                                    154448
045300200528     C                     END                                            154448
045400200528      *                                                                   154448
045500200528     C                     END                             * #XRCID       154448
045600200528      ***********                                                         154448
045700200528      ***Generate 'BEFORE STATUS' account movements                       154448
045800200528      ***(if*not insertion, when #BRCID will be blank)                    154448
045900200528      ***********                                                         154448
046000200528     C***********#BRCID    IFNE *BLANK                                    154448
046100200528      ***********                                                         154448
046200200528     C***********          MOVEL'YES'     ##REVI  3                       154448
046300200528      ***********                                                         154448
046400200528      ***Set*up*FX deal data structure.                                   154448
046500200528     C***********          MOVELZ#BSTS    FXDEAL                          154448
046600200528     C***********FHTYPE    IFNE 'OP'                                      154448
046700200528     C***********          EXSR SRFXDL                                    154448
046800200528     C***********          END                                            154448
046900200528      ***********                                                         154448
047000200528     C***********          END                             * Z#BSTS       154448
047100200528      ***********                                                         154448
047200200528      ***Generate 'AFTER STATUS' account movements                        154448
047300200528      ***(if*not*deletion,*when*FHCHTP*will*be*'D')********************   136436
047400200528      ***(if*not*deletion,*when*FHCHTP*or*FHLACT*will be 'D')      136436 154448
047500200528      ***********                                                         154448
047600200528     C***********          MOVEL*BLANK    ##REVI                          154448
047700200528      ***********                                                         154448
047800200528      ***Set*up*FX deal data structure.                                   154448
047900200528     C***********          MOVELZ#ASTS    FXDEAL                          154448
048000200528     C***********FHCHTP    IFNE 'D'                                       154448
048100200528     C***********FHLACT    ANDNE'D'                                136436 154448
048200200528     C***********FHTYPE    ANDNE'OP'                                      154448
048300200528     C***********          EXSR SRFXDL                                    154448
048400200528     C***********          END                                            154448
048500200528      ***********                                                         154448
048600200528      ***Generate*'WORK*STATUS' account movements for SWAP REVERSAL.      154448
048700200528      ***(for*swap*reversal #WRCID will NOT be blank)                     154448
048800200528      ***********                                                         154448
048900200528     C***********#WRCID    IFNE *BLANK                                    154448
049000200528      ***********                                                         154448
049100200528     C***********          MOVEL'YES'     ##REVI  3                       154448
049200200528      ***********                                                         154448
049300200528      ***Set*up*FX deal data structure.                                   154448
049400200528     C***********          MOVELZ#WSTS    FXDEAL                          154448
049500200528     C***********          EXSR SRFXDL                                    154448
049600200528      ***********                                                         154448
049700200528     C***********          END                             * Z#BSTS       154448
049800200528      *
049900200528      ** Update database with shadow postings in store (within AOSPOSU0)
050000200528      *
050100200528     C                     EXSR SRUPD
050200200528      *
050300200528      *................................................................
050400200528      *
050500200528     C           EXMAIN    TAG
050600200528      *
050700200528      **  Unwind subroutine stack name
050800200528     C                     MOVEA*BLANKS   @STK,Q
050900200528     C                     SUB  1         Q
051000200528      *
051100200528     C                     ENDSR
051200200528     C*****************************************************************
051300200528     C/SPACE 5
051400200528      *****************************************************************
051500200528      * Subroutine  :  SRFXDL                                         *
051600200528      * Function    :  FX Deal Processing                             *
051700200528      *                                                               *
051800200528      * Called by   :  Mainline                                       *
051900200528      * Calls       :  AOSPOSU0 - On-line Positions Update            *
052000200528      *****************************************************************
052100200528     C           SRFXDL    BEGSR
052200200528      *
052300200528      **  Set up subroutine stack name
052400200528     C                     ADD  1         Q       50
052500200528     C                     MOVEL'SRFXDL'  @STK,Q
052600200528      *
052700200528      *................................................................
052800200528      *
052900200528      **  Initialize work fields
053000200528      *
053100200528     C                     Z-ADD*ZERO     ##VDAT  50       * event val dte
053200200528     C                     Z-ADD*ZERO     ##DDAT  50       * deal date                        CAP205
053300200528     C                     MOVEL*BLANK    ##NARR 30        * narrative
053400200528      *
053500200528      **  Store pay and receive settlement methods, accounts & branches
053600200528      *
053700200528     C                     MOVELFHMOPM    ##PAYM           * pay method
053800200528     C                     MOVELFHMOPI    ##PAYA           * pay account
053900200528     C                     MOVELFHPOBR    ##PAYB           * pay branch
054000200528     C                     MOVELFHORCM    ##RECM           * rec method
054100200528     C                     MOVELFHMORI    ##RECA           * rec account
054200200528     C                     MOVELFHROBR    ##RECB           * rec branch
054300200528      *
054400200528      **  Store basic deal details
054500200528      *
054600200528     C                     MOVELFHTYPE    ##TRYP  2        * deal type
054700200528     C                     MOVELFHDN38    ##TRN   6        * transact no.
054800200528     C                     MOVELFHDBRC    ##BBRN  3        * booking branc082738
054900200528      *
055000200528      **  Negative amount is sell amount
055100200528     C           FHDAM1    IFLT 0
055200200528     C                     Z-SUBFHDAM1    ##SAMT 150       * sell amount
055300200528     C                     MOVELFHCCY1    ##SCCY  3        * sell ccy
055400200528     C                     Z-ADDFHDAM2    ##BAMT 150       * buy amount
055500200528     C                     MOVELFHCCY2    ##BCCY  3        * buy ccy
055600200528     C                     ELSE
055700200528     C                     Z-ADDFHDAM1    ##BAMT           * buy amount
055800200528     C                     MOVELFHCCY1    ##BCCY           * buy ccy
055900200528     C                     Z-SUBFHDAM2    ##SAMT           * sell amount
056000200528     C                     MOVELFHCCY2    ##SCCY           * sell ccy
056100200528     C                     END
056200200528      *
056300200528     C           FHTYPE    IFNE 'OP'                                      154448
056400200528     C                     Z-ADDFHVDYY    ZWYYYY           ¦
056500200528     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date
056600200528     C                     Z-ADDFHVDDD    ZWDAY            ¦
056700200528     C                     ELSE                                           154448
056800200528     C                     Z-ADDFHDOEY    ZWYYYY           ¦              154448
056900200528     C                     Z-ADDFHDOEM    ZWMTH            ¦ option to    154448
057000200528     C                     Z-ADDFHDOED    ZWDAY            ¦ date         154448
057100200528     C                     END                                            154448
057200200528      *                                                                   154448
057300200528     C                     EXSR ZDAT10
057400200528     C                     Z-ADDZZMDNO    ##VDAT
057500200528      *                                                                   CEU003
057600200528      ** Settlement currency                                              CEU003
057700200528      *                                                                   CEU003
057800200528     C                     MOVELFHRSCY    ##RSCY  3                       CEU003
057900200528     C                     MOVELFHPSCY    ##PSCY  3                       CEU003
058000200528      *                                                                   CEU003
058100200528      ** If CEU003 is ON, convert the amounts from transaction currency   CEU003
058200200528      ** to settlement currency.                                          CEU003
058300200528      *                                                                   CEU003
058400200528     C           CEU003    IFEQ 'Y'                                       CEU003
058500200528      *                                                                   CEU003
058600200528      ** Receive settlement currency.                                     CEU003
058700200528      *                                                                   CEU003
058800200528     C           ##RSCY    IFNE *BLANKS                                   CEU003
058900200528      *                                                                   CEU003
059000200528     C                     CALL 'EU0200'               90                 CEU003
059100200528     C                     PARM *BLANKS   P#RTCD  7                       CEU003
059200200528     C                     PARM ##BAMT    P#FRAM 183                      CEU003
059300200528     C                     PARM ##BCCY    P#FRCY  3                       CEU003
059400200528     C                     PARM ##RSCY    P#TOCY  3                       CEU003
059500200528     C                     PARM           P#OUTA 150                      CEU003
059600200528     C                     PARM           P#INTA 183                      CEU003
059700200528     C                     PARM           P#EXRT 159                      CEU003
059800200528     C                     PARM           P#MDIN  1                       CEU003
059900200528      *                                                                   CEU003
060000200528     C           *IN90     IFEQ '1'                                       CEU003
060100200528     C           P#RTCD    ORNE *BLANKS                                   CEU003
060200200528     C                     MOVEL'*CALL   'W0FILE  8                       CEU003
060300200528     C                     MOVEL'EU0200  'W0KEY  29                       CEU003
060400200528     C                     Z-ADD904       W0ERNB  30                      CEU003
060500200528     C                     EXSR SRERR                                     CEU003
060600200528      *                                                                   CEU003
060700200528     C                     ELSE                                           CEU003
060800200528      *                                                                   CEU003
060900200528     C                     MOVE P#OUTA    ##BAMT                          CEU003
061000200528     C                     MOVE ##RSCY    ##BCCY                          CEU003
061100200528     C                     ENDIF                                          CEU003
061200200528     C                     ENDIF                                          CEU003
061300200528      *                                                                   CEU003
061400200528      ** Receive settlement currency.                                     CEU003
061500200528      *                                                                   CEU003
061600200528     C           ##PSCY    IFNE *BLANKS                                   CEU003
061700200528      *                                                                   CEU003
061800200528     C                     CALL 'EU0200'               90                 CEU003
061900200528     C                     PARM *BLANKS   P#RTCD  7                       CEU003
062000200528     C                     PARM ##SAMT    P#FRAM 183                      CEU003
062100200528     C                     PARM ##SCCY    P#FRCY  3                       CEU003
062200200528     C                     PARM ##PSCY    P#TOCY  3                       CEU003
062300200528     C                     PARM           P#OUTA 150                      CEU003
062400200528     C                     PARM           P#INTA 183                      CEU003
062500200528     C                     PARM           P#EXRT 159                      CEU003
062600200528     C                     PARM           P#MDIN  1                       CEU003
062700200528      *                                                                   CEU003
062800200528     C           *IN90     IFEQ '1'                                       CEU003
062900200528     C           P#RTCD    ORNE *BLANKS                                   CEU003
063000200528     C                     MOVEL'*CALL   'W0FILE  8                       CEU003
063100200528     C                     MOVEL'EU0200  'W0KEY  29                       CEU003
063200200528     C                     Z-ADD904       W0ERNB  30                      CEU003
063300200528     C                     EXSR SRERR                                     CEU003
063400200528      *                                                                   CEU003
063500200528     C                     ELSE                                           CEU003
063600200528      *                                                                   CEU003
063700200528     C                     MOVE P#OUTA    ##SAMT                          CEU003
063800200528     C                     MOVE ##PSCY    ##SCCY                          CEU003
063900200528     C                     ENDIF                                          CEU003
064000200528     C                     ENDIF                                          CEU003
064100200528     C                     ENDIF                                          CEU003
064200200528      *
064300200528      ** Generate BUY (Receive) account movement
064400200528      ** =======================================
064500200528      *
064600200528      ** Pass movement to write program (with appropriate instructions)
064700200528      *
064800200528     C                     MOVEL##RECD    ##SETD           * Rec details
064900200528     C                     Z-ADD##BAMT    ##AMT  150       * buy amount
065000200528     C                     MOVEL##BCCY    ##CCY   3        * buy ccy
065100200528      *
065200200528     C                     Z-ADD001       ##RPNB  30       * 1=Receive
065300200528     C                     MOVEL##NAR,1   ##NARR
065400200528     C                     MOVELFHRSTM    ##RSTM  2                                           CAP205
065500200528      *                                                                                       CAP205
065600200528     C           CAP205    IFEQ 'Y'                                                           CAP205
065700200528      *                                                                                       CAP205
065800200528      ** Check if purchase currency is settled through a nostro                               CAP205
065900200528      *                                                                                       CAP205
066000200528     C           ##RSTM    IFEQ '01'                                                          CAP205
066100200528     C           ##RSTM    OREQ '07'                                                          CAP205
066200200528     C           ##RSTM    OREQ '08'                                                          CAP205
066300200528     C                     MOVEL##BCCY    ##DCCY  3                                           CAP205
066400200528     C                     ELSE                                                               CAP205
066500200528     C                     MOVELBJLCCY    ##DCCY                                              CAP205
066600200528     C                     ENDIF                                                              CAP205
066700200528      *                                                                                       CAP205
066800200528      ** Calculate date (deal date + 2 working days) BUY                                      CAP205
066900200528      *                                                                                       CAP205
067000200528     C                     CALL 'ZFWDT'                                                       CAP205
067100200528     C                     PARM FHDDDN    ZDAYNO  50                                          CAP205
067200200528     C                     PARM 2         ZNRDYS  20                                          CAP205
067300200528     C                     PARM *ZERO     ZDYNBR  50                                          CAP205
067400200528     C                     PARM ##DCCY    ZCCY    3                                           CAP205
067500200528     C                     PARM *BLANK    ZLOC    3                                           CAP205
067600200528      *                                                                                       CAP205
067700200528     C                     Z-ADDZDYNBR    ##DDAT  50                                          CAP205
067800200528     C           FHVDDN    IFGT ##DDAT                                                        CAP205
067900200528     C                     MOVE 'F'       ##MTYP  1                                           CAP205
068000200528     C                     ELSE                                                               CAP205
068100200528     C                     MOVE 'S'       ##MTYP                                              CAP205
068200200528     C                     ENDIF                                                              CAP205
068300200528     C                     ENDIF                                                              CAP205
068400200528      *
068500200528     C                     EXSR SRMOVE
068600200528      *
068700200528      ** Generate SELL (Pay) account movement
068800200528      ** ====================================
068900200528      *
069000200528      ** Pass movement to write program (with appropriate instructions)
069100200528      *
069200200528     C                     MOVEL##PAYD    ##SETD           * Pay details
069300200528     C                     Z-ADD##SAMT    ##AMT  150       * sell amount
069400200528     C                     MOVEL##SCCY    ##CCY   3        * sell ccy
069500200528      *
069600200528     C                     Z-ADD002       ##RPNB  30       * 2=Pay
069700200528     C                     MOVEL##NAR,2   ##NARR
069800200528     C                     MOVELFHPSTM    ##PSTM  2                                           CAP205
069900200528      *                                                                                       CAP205
070000200528     C           CAP205    IFEQ 'Y'                                                           CAP205
070100200528      *                                                                                       CAP205
070200200528      ** Check if purchase currency is settled through a nostro                               CAP205
070300200528      *                                                                                       CAP205
070400200528     C           ##PSTM    IFEQ '01'                                                          CAP205
070500200528     C           ##PSTM    OREQ '07'                                                          CAP205
070600200528     C           ##PSTM    OREQ '08'                                                          CAP205
070700200528     C                     MOVEL##SCCY    ##DCCY                                              CAP205
070800200528     C                     ELSE                                                               CAP205
070900200528     C                     MOVELBJLCCY    ##DCCY                                              CAP205
071000200528     C                     ENDIF                                                              CAP205
071100200528      *                                                                                       CAP205
071200200528      ** Calculate date (deal date + 2 working days) SELL                                     CAP205
071300200528      *                                                                                       CAP205
071400200528     C                     CALL 'ZFWDT'                                                       CAP205
071500200528     C                     PARM FHDDDN    ZDAYNO                                              CAP205
071600200528     C                     PARM 2         ZNRDYS                                              CAP205
071700200528     C                     PARM *ZERO     ZDYNBR                                              CAP205
071800200528     C                     PARM ##DCCY    ZCCY                                                CAP205
071900200528     C                     PARM *BLANK    ZLOC                                                CAP205
072000200528      *                                                                                       CAP205
072100200528     C                     Z-ADDZDYNBR    ##DDAT                                              CAP205
072200200528     C           FHVDDN    IFGT ##DDAT                                                        CAP205
072300200528     C                     MOVE 'F'       ##MTYP                                              CAP205
072400200528     C                     ELSE                                                               CAP205
072500200528     C                     MOVE 'S'       ##MTYP                                              CAP205
072600200528     C                     ENDIF                                                              CAP205
072700200528     C                     ENDIF                                                              CAP205
072800200528      *
072900200528     C                     EXSR SRMOVE
073000200528      *
073100200528      *................................................................
073200200528      *
073300200528     C           EXFXDL    TAG
073400200528      *
073500200528      **  Unwind subroutine stack name
073600200528     C                     MOVEA*BLANKS   @STK,Q
073700200528     C                     SUB  1         Q
073800200528      *
073900200528     C                     ENDSR
074000200528     C*****************************************************************
074100200528      /SPACE 5
074200200528      *****************************************************************
074300200528      * Subroutine  :  SRMOVE                                         *
074400200528      * Function    :  Pass Movement To Write Program                 *
074500200528      *                                                               *
074600200528      * Called by   :  Various                                        *
074700200528      * Calls       :  None                                           *
074800200528      *****************************************************************
074900200528     C           SRMOVE    BEGSR
075000200528      *
075100200528      **  Set up subroutine stack name
075200200528     C                     ADD  1         Q
075300200528     C                     MOVEL'SRMOVE'  @STK,Q
075400200528      *
075500200528      *................................................................
075600200528      *
075700200528      ** Bypass if no amount to post
075800200528      *
075900200528     C           ##AMT     CABEQ*ZERO     EXMOVE
076000200528      *
076100200528      ** Determine account movement settlement details
076200200528      *
076300200528     C                     CLEARC#DTA
076400200528      *
076500200528     C           ##SETM    IFEQ '01'
076600200528     C           ##SETM    OREQ '02'
076700200528     C           ##SETM    OREQ '07'
076800200528     C           ##SETM    OREQ '08'
076900200528     C           ##SETM    OREQ '12'
077000200528     C                     MOVEL'N'       C#ATYP
077100200528     C                     MOVEL##NOSN    C#NOSN
077200200528     C                     ELSE
077300200528     C           ##SETM    IFEQ '14'
077400200528     C                     MOVEL'R'       C#ATYP
077500200528     C                     MOVEL##ACNO    C#ACNO
077600200528     C                     ELSE
077700200528     C           ##SETM    IFEQ '04'
077800200528     C           ##SETM    OREQ '05'
077900200528     C                     MOVEL'P'       C#ATYP
078000200528     C                     MOVEL##CNUM    C#CNUM
078100200528     C                     MOVEL##ACOD    C#ACOD
078200200528     C                     MOVEL##ACSQ    C#ACSQ
078300200528     C                     MOVEL##BRCA    C#BRCA
078400200528     C                     END
078500200528     C                     END
078600200528     C                     END
078700200528      *                                                                   082738
078800200528      * OLPOS Incoming/Outgoing Indicator 'I' or 'O'                      082738
078900200528     C           ##PYRC    IFEQ 'P'                                       082738
079000200528     C                     MOVEL'O'       C#IO             * outgoing     082738
079100200528     C                     ELSE                                           082738
079200200528     C                     MOVEL'I'       C#IO             * incoming     082738
079300200528     C                     END                                            082738
079400200528      *********************                                               082738
079500200528      ***Bypass*if*no*settlement or internal settlement                   082738
079600200528      *********************                                               082738
079700200528     C***********C#ATYP****CABEQ*BLANK    EXMOVE                          082738
079800200528      *
079900200528      * Currency of transaction
080000200528     C                     MOVEL##CCY     C#CCY
080100200528      *
080200200528      * Transaction type
080300200528     C                     MOVEL##TRYP    C#TRYP
080400200528      * Transaction Narrative
080500200528     C/COPY WNCPYSRC,AOH00040
080600200528     C                     MOVEL##NARR    C#NARR
080700200528     C/COPY WNCPYSRC,AOH00041
080800200528      *                                                                                       241166
080900200528      * Include transaction number and type                                                   241166
081000200528     C           TRSNAR    IFEQ 'Y'                                                           241166
081100200528     C**********           MOVE *BLANK    D#WORK                                    241166 BUG25226A
081200200528     C**********           MOVE ##TRN     D#TRN                                     241166 BUG25226A
081300200528     C**********           MOVE ##TRYP    D#TYP                                     241166 BUG25226A
081400200528     C**********           MOVE D#WORK    C#NARR                                    241166 BUG25226A
081500200528      *                                                                                    BUG25226A
081600200528     C                     MOVE *BLANKS   C#NARR                                           BUG25226A
081700200528     C                     MOVELFHDCNO    @KEY1                                            BUG25226A
081800200528     C                     CALL 'AOCUSTR1'                                                 BUG25226A
081900200528     C                     PARM '*MSG   ' @RTCD                                            BUG25226A
082000200528     C                     PARM '*KEY   ' @OPTN                                            BUG25226A
082100200528     C                     PARM           @KEY1  10                                        BUG25226A
082200200528     C                     PARM *BLANKS   @KYST   7                                        BUG25226A
082300200528     C           SDCUST    PARM SDCUST    DSLDY                                            BUG25226A
082400200528      *                                                                                    BUG25226A
082500200528     C           @RTCD     IFEQ *BLANK                                                     BUG25226A
082600200528     C           ##TRN     CAT  BBCRNM:1  C#NARR                                           BUG25226A
082700200528     C                     ENDIF                                                           BUG25226A
082800200528      *                                                                                    BUG25226A
082900200528     C                     ENDIF                                                              241166
083000200528      *                                                                                       241166
083100200528     C           ##REVI    IFEQ 'YES'
083200200528     C                     MOVE '*'       C#NARR
083300200528     C                     END
083400200528      *
083500200528      * DL/LE/GL/RE transaction reference
083600200528     C                     MOVEL##TRN     C#TRN
083700200528      *
083800200528      * Movement amount
083900200528     C           ##PYRC    IFEQ 'P'
084000200528     C           ##REVI    ANDNE'YES'
084100200528     C           ##PYRC    OREQ 'R'
084200200528     C           ##REVI    ANDEQ'YES'
084300200528     C                     Z-SUB##AMT     C#AMT            * pay ie credit
084400200528     C                     ELSE
084500200528     C                     Z-ADD##AMT     C#AMT            * rec ie debit
084600200528     C                     END
084700200528      *
084800200528      **Olpos*update*indicator                                            082738
084900200528     C*********************MOVEL'N'       C#OLPS                          082738
085000200528      *                                                                   154448
085100200528      * Olpos update indicator                                            154448
085200200528     C           ##TRYP    IFEQ 'SW'                                      154448
085300200528     C                     MOVEL'N'       C#OLPS                          154448
085400200528     C                     END                                            154448
085500200528      *
085600200528      * Module
085700200528     C                     MOVEL'DL'      C#MOD
085800200528      *                                                                   082738
085900200528      * Olpos record number to update                                     082738
086000200528      * '01' for FX                                                       082738
086100200528      * '02' for Interest movements                                       082738
086200200528      * '03' for MM loans and deposits                                    082738
086300200528     C                     MOVE '01'      C#OLRC                          082738
086400200528      *
086500200528      * Value date and posting date
086600200528     C                     Z-ADD##VDAT    C#VDAT
086700200528      *                                                                                       CDL099
086800200528     C           CDL099    IFEQ 'Y'                                                           CDL099
086900200528      *                                                                                       CDL099
087000200528      ** If a payment update is to be generated                                               CDL099
087100200528     C           ##PYRC    IFEQ 'P'                                                           CDL099
087200200528     C                     Z-ADDFHVS2Y    ZWYYYY                                              CDL099
087300200528     C                     Z-ADDFHVS2M    ZWMTH                                               CDL099
087400200528     C                     Z-ADDFHVS2D    ZWDAY                                               CDL099
087500200528     C                     EXSR ZDAT10                                                        CDL099
087600200528     C                     Z-ADDZZMDNO    C#VDAT                                              CDL099
087700200528     C                     ENDIF                                                              CDL099
087800200528      *                                                                                       CDL099
087900200528     C                     ENDIF                                                              CDL099
088000200528     C/COPY WNCPYSRC,AOOUFXU0C1
088100200528     C                     Z-ADD##VDAT    C#PSTD
088200200528      *
088300200528      * Indicator to show if removal allowed Y, N or " "
088400200528     C                     MOVEL'Y'       C#RPST
088500200528      *
088600200528      * Removal set number
088700200528     C                     Z-ADD##RPNB    C#RPNB
088800200528      *
088900200528      * Removal type "C" = Credit entries
089000200528      *              "D" = Debit entries
089100200528     C                     MOVEL'C'       C#RTYP
089200200528      *                                                                   082738
089300200528      * Booking branch                                                    082738
089400200528     C                     MOVEL##BBRN    C#BBRN                          082738
089500200528      *                                                                   082738
089600200528      *  If settlement details are present                                082738
089700200528      *  AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS  082738
089800200528      *                                                                   082738
089900200528      *  OTHERWISE                                                        082738
090000200528      *                                                                   082738
090100200528      *  If no settlement details are present                             082738
090200200528      *  AOSPOSU0 will be called to only update OLPOS                     082738
090300200528      *                                                                   082738
090400200528     C           C#ATYP    IFEQ *BLANK                                    082738
090500200528      *                                                                   082738
090600200528      * Set account type indicator to signify no settlement               082738
090700200528     C                     MOVEL'X'       C#ATYP                          082738
090800200528      *                                                                   082738
090900200528      * Set update indicators for no update                               082738
091000200528     C                     MOVE 'N'       C#PRON                          082738
091100200528     C                     MOVE 'N'       C#MEMS                          082738
091200200528     C                     MOVE 'N'       C#RSAC                          082738
091300200528     C                     END                                            082738
091400200528      *                                                                                       CAP205
091500200528      ** Set value for Movement Type field                                                    CAP205
091600200528      *                                                                                       CAP205
091700200528     C           CAP205    IFEQ 'Y'                                                           CAP205
091800200528     C                     MOVE ##MTYP    C#MTYP                                              CAP205
091900200528     C                     ENDIF                                                              CAP205
092000200528      *
092100200528      ***Call*AOSPOSU0************************************************    141213
092200200528      ***********                                                         141213
092300200528     C***********          CALL 'AOSPOSU0'             9090               121483
092400200528     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
092500200528     C***********          PARM '*ADD    'W0ACT   8                       121483
092600200528     C***********          PARM C#DTA     O#DTA 256                       121483
092700200528      *                                                                   121483
092800200528     C************IN90     IFEQ '1'                                       121483
092900200528     C***********R#RTN     ORNE *BLANKS                                   121483
093000200528     C***********          MOVEL'*CALL   'W0FILE  8                       121483
093100200528     C***********          MOVEL'AOSPOSU0'W0KEY  29                       121483
093200200528     C***********          Z-ADD902       W0ERNB  30                      121483
093300200528     C***********          EXSR SRERR                                     121483
093400200528     C***********          END                                            121483
093500200528     C***********          MOVE '*ADD    'D#ACT   8                121483 141213
093600200528      *                                                                   141213
093700200528      *  Check if account is open if account posting                      141213
093800200528      *                                                                   141213
093900200528     C           C#ATYP    IFNE 'X'                                       141213
094000200528     C                     EXSR CHKACT                                    121483
094100200528     C                     END                                            141213
094200200528      *                                                                   141213
094300200528      *  If account posting and account is open,                          141213
094400200528      *  or if not account posting                                        141213
094500200528      *    Call AOSPOSU0                                                  141213
094600200528      *                                                                   141213
094700200528     C           C#ATYP    IFNE 'X'                                       141213
094800200528     C           NRECI     ANDEQ'D'                                       141213
094900200528     C           C#ATYP    OREQ 'X'                                       141213
095000200528     C                     CALL 'AOSPOSU0'             9090               141213
095100200528     C                     PARM *BLANKS   O#RTN   7                       141213
095200200528     C                     PARM '*ADD    'W0ACT   8                       141213
095300200528     C                     PARM C#DTA     O#DTA 256                       141213
095400200528      *                                                                   141213
095500200528     C           *IN90     IFEQ '1'                                       141213
095600200528     C           O#RTN     ORNE *BLANKS                                   141213
095700200528     C                     MOVEL'*CALL   'W0FILE  8                       141213
095800200528     C                     MOVEL'AOSPOSU0'W0KEY  29                       141213
095900200528     C                     Z-ADD902       W0ERNB  30                      141213
096000200528     C                     EXSR SRERR                                     141213
096100200528     C                     END                                            141213
096200200528     C                     END                                            141213
096300200528      *
096400200528      *................................................................
096500200528      *
096600200528     C           EXMOVE    TAG
096700200528      *
096800200528      **  Unwind subroutine stack name
096900200528     C                     MOVEA*BLANKS   @STK,Q
097000200528     C                     SUB  1         Q
097100200528      *
097200200528     C                     ENDSR
097300200528      *****************************************************************
097400200528     C/SPACE 5                                                            154448
097500200528      *****************************************************************   154448
097600200528      * Subroutine  :  SRFXSW                                         *   154448
097700200528      * Function    :  FX Swap - Extra Processing                     *   154448
097800200528      *                                                               *   154448
097900200528      * Called by   :  Mainline                                       *   154448
098000200528      * Calls       :  AOSPOSU0 - On-line Positions Update            *   154448
098100200528      *****************************************************************   154448
098200200528     C           SRFXSW    BEGSR                                          154448
098300200528      *                                                                   154448
098400200528      **  Set up subroutine stack name                                    154448
098500200528     C                     ADD  1         Q       50                      154448
098600200528     C                     MOVEL'SRFXSW'  @STK,Q                          154448
098700200528      *                                                                   154448
098800200528      *................................................................   154448
098900200528      *                                                                   154448
099000200528      * One swap leg                                                      154448
099100200528      *                                                                   154448
099200200528     C           ##REVI    IFEQ 'YES'                                     154448
099300200528     C                     MOVELZ#BSTS    FXDEAL                          154448
099400200528     C                     ELSE                                           154448
099500200528     C                     MOVELZ#ASTS    FXDEAL                          154448
099600200528     C                     END                                            154448
099700200528      *                                                                   154448
099800200528      **  Negative amount is sell amount                                  154448
099900200528      *                                                                   154448
100000200528     C           FHDAM1    IFLT 0                                         154448
100100200528     C                     Z-SUBFHDAM1    ##SAM1 150       * sell amount  154448
100200200528     C                     MOVELFHCCY1    ##SCY1  3        * sell ccy     154448
100300200528     C                     Z-ADDFHDAM2    ##BAM1 150       * buy amount   154448
100400200528     C                     MOVELFHCCY2    ##BCY1  3        * buy ccy      154448
100500200528     C                     ELSE                                           154448
100600200528     C                     Z-ADDFHDAM1    ##BAM1           * buy amount   154448
100700200528     C                     MOVELFHCCY1    ##BCY1           * buy ccy      154448
100800200528     C                     Z-SUBFHDAM2    ##SAM1           * sell amount  154448
100900200528     C                     MOVELFHCCY2    ##SCY1           * sell ccy     154448
101000200528     C                     END                                            154448
101100200528      *                                                                   154448
101200200528     C                     Z-ADDFHVDYY    ZWYYYY           ¦              154448
101300200528     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date   154448
101400200528     C                     Z-ADDFHVDDD    ZWDAY            ¦              154448
101500200528     C                     EXSR ZDAT10                                    154448
101600200528     C                     Z-ADDZZMDNO    ##VDT1  50                      154448
101700200528      *                                                                   154448
101800200528      * Other swap leg                                                    154448
101900200528      *                                                                   154448
102000200528     C           ##REVI    IFEQ 'YES'                                     154448
102100200528     C                     MOVELZ#WSTS    FXDEAL                          154448
102200200528     C                     ELSE                                           154448
102300200528     C                     MOVELZ#XSTS    FXDEAL                          154448
102400200528     C                     END                                            154448
102500200528      *                                                                   154448
102600200528      **  Negative amount is sell amount                                  154448
102700200528      *                                                                   154448
102800200528     C           FHDAM1    IFLT 0                                         154448
102900200528     C                     Z-SUBFHDAM1    ##SAM2 150       * sell amount  154448
103000200528     C                     MOVELFHCCY1    ##SCY2  3        * sell ccy     154448
103100200528     C                     Z-ADDFHDAM2    ##BAM2 150       * buy amount   154448
103200200528     C                     MOVELFHCCY2    ##BCY2  3        * buy ccy      154448
103300200528     C                     ELSE                                           154448
103400200528     C                     Z-ADDFHDAM1    ##BAM2           * buy amount   154448
103500200528     C                     MOVELFHCCY1    ##BCY2           * buy ccy      154448
103600200528     C                     Z-SUBFHDAM2    ##SAM2           * sell amount  154448
103700200528     C                     MOVELFHCCY2    ##SCY2           * sell ccy     154448
103800200528     C                     END                                            154448
103900200528      *                                                                   154448
104000200528     C                     Z-ADDFHVDYY    ZWYYYY           ¦              154448
104100200528     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date   154448
104200200528     C                     Z-ADDFHVDDD    ZWDAY            ¦              154448
104300200528     C                     EXSR ZDAT10                                    154448
104400200528     C                     Z-ADDZZMDNO    ##VDT2  50                      154448
104500200528      *                                                                   154448
104600200528      * Determine value date of 2nd leg                                   154448
104700200528      *                                                                   154448
104800200528     C           ##VDT2    IFGT ##VDT1                                    154448
104900200528     C                     Z-ADD##VDT2    ##VDAT                          154448
105000200528     C                     ELSE                                           154448
105100200528     C                     Z-ADD##VDT1    ##VDAT                          154448
105200200528     C                     END                                            154448
105300200528      *                                                                   154448
105400200528      ** Calculate swap profit/loss & currency                            154448
105500200528      *                                                                   154448
105600200528     C           ##BAM1    IFEQ ##SAM2                                    154448
105700200528     C           ##BAM2    SUB  ##SAM1    ##AMT                           154448
105800200528     C                     MOVEL##BCY2    ##CCY                           154448
105900200528     C                     ELSE                                           154448
106000200528     C           ##BAM1    SUB  ##SAM2    ##AMT                           154448
106100200528     C                     MOVEL##BCY1    ##CCY                           154448
106200200528     C                     END                                            154448
106300200528      *                                                                   154448
106400200528      ** Bypass if no amount to post                                      154448
106500200528      *                                                                   154448
106600200528     C           ##AMT     CABEQ*ZERO     EXFXSW                          154448
106700200528      *                                                                   154448
106800200528      ** Clear movement                                                   154448
106900200528      *                                                                   154448
107000200528     C                     CLEARC#DTA                                     154448
107100200528      *                                                                   154448
107200200528      ** Profit or loss?                                                  154448
107300200528      ** OLPOS Incoming/Outgoing Indicator 'I' or 'O'                     154448
107400200528      *                                                                   154448
107500200528     C           ##AMT     IFLT *ZERO                                     154448
107600200528     C                     MOVEL'O'       C#IO             * outgoing     154448
107700200528     C                     ELSE                                           154448
107800200528     C                     MOVEL'I'       C#IO             * incoming     154448
107900200528     C                     END                                            154448
108000200528      *                                                                   154448
108100200528      * Currency of transaction                                           154448
108200200528     C                     MOVEL##CCY     C#CCY                           154448
108300200528      *                                                                   154448
108400200528      * Movement amount                                                   154448
108500200528     C           ##REVI    IFEQ 'YES'                                     154448
108600200528     C                     Z-SUB##AMT     C#AMT            * pay ie credit154448
108700200528     C                     ELSE                                           154448
108800200528     C                     Z-ADD##AMT     C#AMT            * rec ie debit 154448
108900200528     C                     END                                            154448
109000200528      *                                                                   154448
109100200528      * Olpos record number to update                                     154448
109200200528      * '01' for FX                                                       154448
109300200528      * '02' for Interest movements                                       154448
109400200528      * '03' for MM loans and deposits                                    154448
109500200528     C                     MOVE '02'      C#OLRC                          154448
109600200528      *                                                                   154448
109700200528      * Value date and posting date                                       154448
109800200528      *                                                                   154448
109900200528     C                     Z-ADD##VDAT    C#VDAT                          154448
110000200528     C                     Z-ADD##VDAT    C#PSTD                          154448
110100200528      *                                                                   154448
110200200528      * Removal set number                                                154448
110300200528     C                     Z-ADD003       C#RPNB                          154448
110400200528      *                                                                   154448
110500200528      * Booking branch                                                    154448
110600200528     C                     MOVELFHDBRC    C#BBRN                          154448
110700200528      *                                                                   154448
110800200528      *  AOSPOSU0 will be called to only update OLPOS                     154448
110900200528      *                                                                   154448
111000200528      * Set account type indicator to signify no settlement               154448
111100200528     C                     MOVEL'X'       C#ATYP                          154448
111200200528      *                                                                   154448
111300200528      * Set update indicators for no update                               154448
111400200528     C                     MOVE 'N'       C#PRON                          154448
111500200528     C                     MOVE 'N'       C#MEMS                          154448
111600200528     C                     MOVE 'N'       C#RSAC                          154448
111700200528      *                                                                   154448
111800200528      *  Call AOSPOSU0                                                    154448
111900200528      *                                                                   154448
112000200528     C                     CALL 'AOSPOSU0'             9090               154448
112100200528     C           R#RTN     PARM *BLANKS   O#RTN   7                       154448
112200200528     C                     PARM '*ADD    'W0ACT   8                       154448
112300200528     C                     PARM C#DTA     O#DTA 256                       154448
112400200528      *                                                                   154448
112500200528     C           *IN90     IFEQ '1'                                       154448
112600200528     C           R#RTN     ORNE *BLANKS                                   154448
112700200528     C                     MOVEL'*CALL   'W0FILE  8                       154448
112800200528     C                     MOVEL'AOSPOSU0'W0KEY  29                       154448
112900200528     C                     Z-ADD902       W0ERNB  30                      154448
113000200528     C                     EXSR SRERR                                     154448
113100200528     C                     END                                            154448
113200200528      *                                                                   154448
113300200528      *................................................................   154448
113400200528      *                                                                   154448
113500200528     C           EXFXSW    TAG                                            154448
113600200528      *                                                                   154448
113700200528      **  Unwind subroutine stack name                                    154448
113800200528     C                     MOVEA*BLANKS   @STK,Q                          154448
113900200528     C                     SUB  1         Q                               154448
114000200528      *                                                                   154448
114100200528     C                     ENDSR                                          154448
114200200528     C*****************************************************************   154448
114300200528     C/SPACE 5
114400200528      *****************************************************************
114500200528      *                                                               *
114600200528      *  SRUPD    : Update database with shadow postings in store     *
114700200528      *                                                               *
114800200528      *  CALLED BY: Various                                           *
114900200528      *                                                               *
115000200528      *  CALLS    : SRERR - Report errors                             *
115100200528      *                                                               *
115200200528      *****************************************************************
115300200528     C           SRUPD     BEGSR
115400200528      *
115500200528      *  Set up subroutine stack name
115600200528      *
115700200528     C                     ADD  1         Q
115800200528     C                     MOVEL'SRUPD'   @STK,Q
115900200528      *
116000200528      *................................................................
116100200528      *
116200200528      *  Call AOSPOSU0 to update database
116300200528      *                                                                   141213
116400200528     C                     CALL 'AOSPOSU0'             9090               141213
116500200528     C                     PARM *BLANKS   O#RTN   7                       141213
116600200528     C                     PARM '*UPDATE 'W0ACT   8                       141213
116700200528     C                     PARM C#DTA     O#DTA 256                       141213
116800200528      *                                                                   141213
116900200528     C           *IN90     IFEQ '1'                                       141213
117000200528     C           O#RTN     ORNE *BLANKS                                   141213
117100200528     C                     MOVEL'*CALL   'W0FILE                          141213
117200200528     C                     MOVEL'AOSPOSU0'W0KEY                           141213
117300200528     C                     Z-ADD903       W0ERNB                          141213
117400200528     C                     EXSR SRERR                                     141213
117500200528     C                     END                                            141213
117600200528      *
117700200528     C***********          CALL 'AOSPOSU0'             9090               121483
117800200528     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
117900200528     C***********          PARM '*UPDATE 'W0ACT   8                       121483
118000200528     C***********          PARM C#DTA     O#DTA 256                       121483
118100200528      *                                                                   121483
118200200528     C************IN90     IFEQ '1'                                       121483
118300200528     C***********R#RTN     ORNE *BLANKS                                   121483
118400200528     C***********          MOVEL'*CALL   'W0FILE                          121483
118500200528     C***********          MOVEL'AOSPOSU0'W0KEY                           121483
118600200528     C***********          Z-ADD903       W0ERNB                          121483
118700200528     C***********          EXSR SRERR                                     121483
118800200528     C***********          END                                            121483
118900200528     C***********          MOVE '*UPDATE 'D#ACT                    121483 141213
119000200528     C***********          EXSR CHKACT                             121483 141213
119100200528      *
119200200528      *................................................................
119300200528      *
119400200528      *  Unwind subroutine stack name
119500200528      *
119600200528     C           EXUPD     TAG
119700200528     C                     MOVEA*BLANKS   @STK,Q
119800200528     C                     SUB  1         Q
119900200528      *
120000200528     C                     ENDSR
120100200528      *****************************************************************
120200200528     C/SPACE 5
120300200528      *****************************************************************
120400200528      *                                                               *
120500200528      *  SRCLR    : Clear all postings in store                       *
120600200528      *                                                               *
120700200528      *  CALLED BY: UPDATE - Update database                          *
120800200528      *                                                               *
120900200528      *  CALLS    : SRERR - Report errors                             *
121000200528      *                                                               *
121100200528      *****************************************************************
121200200528     C           SRCLR     BEGSR
121300200528      *
121400200528      *  Set up subroutine stack name
121500200528      *
121600200528     C                     ADD  1         Q
121700200528     C                     MOVEL'SRCLR'   @STK,Q
121800200528      *
121900200528      *................................................................
122000200528      *
122100200528      *  Clear arrays in AOSPOSU0
122200200528      *
122300200528     C                     CLEARC#DTA
122400200528     C                     CALL 'AOSPOSU0'             9090               141213
122500200528     C                     PARM *BLANKS   O#RTN   7                       141213
122600200528     C                     PARM '*CLEAR  'W0ACT   8                       141213
122700200528     C                     PARM C#DTA     O#DTA 256                       141213
122800200528      *                                                                   141213
122900200528     C           *IN90     IFEQ '1'                                       141213
123000200528     C           O#RTN     ORNE *BLANKS                                   141213
123100200528     C                     MOVEL'*CALL   'W0FILE                          141213
123200200528     C                     MOVEL'AOSPOSU0'W0KEY                           141213
123300200528     C                     Z-ADD901       W0ERNB                          141213
123400200528     C                     EXSR SRERR                                     141213
123500200528     C                     END                                            141213
123600200528      *                                                                   141213
123700200528     C***********          CALL 'AOSPOSU0'             9090               121483
123800200528     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
123900200528     C***********          PARM '*CLEAR  'W0ACT   8                       121483
124000200528     C***********          PARM C#DTA     O#DTA 256                       121483
124100200528      *                                                                   121483
124200200528     C************IN90     IFEQ '1'                                       121483
124300200528     C***********R#RTN     ORNE *BLANKS                                   121483
124400200528     C***********          MOVEL'*CALL   'W0FILE                          121483
124500200528     C***********          MOVEL'AOSPOSU0'W0KEY                           121483
124600200528     C***********          Z-ADD901       W0ERNB                          121483
124700200528     C***********          EXSR SRERR                                     121483
124800200528     C***********          END                                            121483
124900200528     C***********          MOVE '*CLEAR  'D#ACT                    121483 141213
125000200528     C***********          EXSR CHKACT                             121483 141213
125100200528      *
125200200528      *................................................................
125300200528      *
125400200528      *  Unwind subroutine stack name
125500200528      *
125600200528     C           EXCLR     TAG
125700200528     C                     MOVEA*BLANKS   @STK,Q
125800200528     C                     SUB  1         Q
125900200528      *
126000200528     C                     ENDSR
126100200528      *****************************************************************
126200200528     C/SPACE 5
126300200528      *****************************************************************
126400200528      *                                                               *
126500200528      *  SRERR    : Report error and close down program               *
126600200528      *                                                               *
126700200528      *  CALLED BY: Various                                           *
126800200528      *  CALLS    : *NONE                                             *
126900200528      *                                                               *
127000200528      *****************************************************************
127100200528     C           SRERR     BEGSR
127200200528      *
127300200528      *  Dump program
127400200528      *
127500200528     C           O#RTN     IFEQ '*RECLCK'                                                     231306
127600200528     C           R#RTN     OREQ '*RECLCK'                                                     231306
127700200528     C                     ROLBK                                                              231306
127800200528     C                     SETON                     LR                                       231306
127900200528     C                     MOVEL'*RECLCK' ##RTCD                                              231306
128000200528     C                     ELSE                                                               231306
128100200528     C                     DUMP
128200200528     C           CSC022    IFNE 'Y'                                                           CSC022
128300200528     C                     ROLBK
128400200528     C                     ELSE                                                               CSC022
128500200528     C           CMTSKP    IFNE 'Y'                                                           CSC022
128600200528     C                     ROLBK                                                              CSC022
128700200528     C                     ELSE                                                               CSC022
128800200528     C                     SETON                     U7U8                                     CSC022
128900200528     C                     ENDIF                                                              CSC022
129000200528     C                     ENDIF                                                              CSC022
129100200528      *
129200200528      *  Close down program
129300200528      *
129400200528     C                     SETON                     LR
129500200528     C                     MOVEL'*ERROR*' ##RTCD
129600200528      *                                                                                       231306
129700200528     C                     ENDIF                                                              231306
129800200528      *                                                                                       231306
129900200528     C                     RETRN
130000200528      *
130100200528     C           EXERR     ENDSR
130200200528      *****************************************************************
130300200528      /SPACE 5
130400200528      *****************************************************************
130500200528      * Subroutine  :  SRINIT                                         *
130600200528      * Function    :  Initial processing - First Call Only           *
130700200528      *                                                               *
130800200528      * Called by   :  Mainline                                       *
130900200528      * Calls       :  None                                           *
131000200528      *****************************************************************
131100200528     C           SRINIT    BEGSR
131200200528      *
131300200528      **  Set up subroutine stack name
131400200528     C                     ADD  1         Q
131500200528     C                     MOVEL'SRINIT'  @STK,Q
131600200528      *
131700200528      *................................................................
131800200528      *
131900200528      **  Initialise work fields
132000200528     C                     MOVEL'P'       ##PAY
132100200528     C                     MOVEL'R'       ##REC
132200200528     C                     MOVEL*BLANKS   R#RTN   7
132300200528      *
132400200528      **  Copyright
132500200528     C                     MOVEA##CPY     ##BIS  80
132600200528      *
132700200528      *................................................................
132800200528      *
132900200528      ** Access the Bank Details                                                              CAP205
133000200528      *                                                                                       CAP205
133100200528     C                     CALL 'AOBANKR0'                                                    CAP205
133200200528     C                     PARM *BLANKS   @RTCD                                               CAP205
133300200528     C                     PARM '*FIRST ' @OPTN                                               CAP205
133400200528     C           SDBANK    PARM SDBANK    DSFDY                                               CAP205
133500200528     C           @RTCD     IFNE *BLANKS                                                       CAP205
133600200528     C                     MOVEL'SDBANKPD'W0FILE                                              CAP205
133700200528     C                     MOVEL'*FIRST'  W0KEY                                               CAP205
133800200528     C                     Z-ADD7         W0ERNB                                              CAP205
133900200528     C                     EXSR SRERR                                                         CAP205
134000200528     C                     ENDIF                                                              CAP205
134100200528      *                                                                   CEU003
134200200528      ** Check if CEU003 is switched *ON.                                 CEU003
134300200528      *                                                                   CEU003
134400200528     C                     CALL 'AOSARDR0'                                CEU003
134500200528     C                     PARM *BLANKS   @RTCD   7                       CEU003
134600200528     C                     PARM '*VERIFY' @OPTN   7                       CEU003
134700200528     C                     PARM 'CEU003'  @SARD   6                       CEU003
134800200528     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
134900200528      *                                                                   CEU003
135000200528     C           @RTCD     IFEQ *BLANKS                                   CEU003
135100200528     C                     MOVE 'Y'       CEU003  1                       CEU003
135200200528     C                     ELSE                                           CEU003
135300200528     C                     MOVE 'N'       CEU003                          CEU003
135400200528     C                     ENDIF                                          CEU003
135500200528      *                                                                   CEU003
135600200528      *                                                                                       CSC022
135700200528      ** Check if CSC022 is switched *ON.                                                     CSC022
135800200528      *                                                                                       CSC022
135900200528     C                     CALL 'AOSARDR0'                                                    CSC022
136000200528     C                     PARM *BLANKS   @RTCD                                               CSC022
136100200528     C                     PARM '*VERIFY' @OPTN                                               CSC022
136200200528     C                     PARM 'CSC022'  @SARD                                               CSC022
136300200528     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
136400200528      *                                                                                       CSC022
136500200528     C           @RTCD     IFEQ *BLANKS                                                       CSC022
136600200528     C                     MOVE 'Y'       CSC022  1                                           CSC022
136700200528     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
136800200528     C                     IN   SCCMT                                                         CSC022
136900200528     C                     Z-ADD1         C       30                                          CSC022
137000200528     C                     MOVEL*BLANKS   CMTSKP  1                                           CSC022
137100200528     C                     MOVEACMTARR    CMTJOB                                              CSC022
137200200528     C           CMTNUM    IFGT 0                                                             CSC022
137300200528     C           C         DOWLECMTNUM                                                        CSC022
137400200528     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
137500200528     C                     MOVEL'Y'       CMTSKP                                              CSC022
137600200528     C                     ENDIF                                                              CSC022
137700200528     C                     ADD  1         C                                                   CSC022
137800200528     C                     ENDDO                                                              CSC022
137900200528     C                     ENDIF                                                              CSC022
138000200528     C                     ELSE                                                               CSC022
138100200528     C                     MOVE 'N'       CSC022                                              CSC022
138200200528     C                     ENDIF                                                              CSC022
138300200528      *                                                                                       CAP205
138400200528      ** Check if CAP205 is switched *ON.                                                     CAP205
138500200528      *                                                                                       CAP205
138600200528     C                     MOVE 'N'       CAP205                                              CAP205
138700200528     C                     CALL 'AOSARDR0'                                                    CAP205
138800200528     C                     PARM *BLANKS   @RTCD                                               CAP205
138900200528     C                     PARM '*VERIFY' @OPTN                                               CAP205
139000200528     C                     PARM 'CAP205'  @SARD                                               CAP205
139100200528     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
139200200528      *                                                                                       CAP205
139300200528     C           @RTCD     IFEQ *BLANKS                                                       CAP205
139400200528     C                     MOVE 'Y'       CAP205  1                                           CAP205
139500200528     C                     ELSE                                                               CAP205
139600200528     C           @RTCD     IFNE '*NRF   '                                                     CAP205
139700200528     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
139800200528     C                     MOVEL'CAP205'  W0KEY                                               CAP205
139900200528     C                     Z-ADD6         W0ERNB                                              CAP205
140000200528     C                     EXSR SRERR                                                         CAP205
140100200528     C                     ENDIF                                                              CAP205
140200200528     C                     ENDIF                                                              CAP205
140300200528      *                                                                                       CAP205
140400200528      ** Check if CDL099 is switched *ON.                                                     CDL099
140500200528     C                     MOVE 'N'       CDL099                                              CDL099
140600200528     C                     CALL 'AOSARDR0'                                                    CDL099
140700200528     C                     PARM *BLANKS   @RTCD                                               CDL099
140800200528     C                     PARM '*VERIFY' @OPTN                                               CDL099
140900200528     C                     PARM 'CDL099'  @SARD                                               CDL099
141000200528     C           SCSARD    PARM SCSARD    DSFDY                                               CDL099
141100200528      *                                                                                       CDL099
141200200528     C           @RTCD     IFEQ *BLANKS                                                       CDL099
141300200528     C                     MOVE 'Y'       CDL099  1                                           CDL099
141400200528     C                     ELSE                                                               CDL099
141500200528     C           @RTCD     IFNE '*NRF   '                                                     CDL099
141600200528     C                     MOVEL'SCSARDPD'W0FILE                                              CDL099
141700200528     C                     MOVEL'CDL099'  W0KEY                                               CDL099
141800200528     C                     Z-ADD7         W0ERNB                                              CDL099
141900200528     C                     EXSR SRERR                                                         CDL099
142000200528     C                     ENDIF                                                              CDL099
142100200528     C                     ENDIF                                                              CDL099
142200200528      *                                                                                       CDL099
142300200528      * Check system values                                                                   241166
142400200528     C                     CALL 'AOSVALR0'                                                    241166
142500200528     C                     PARM *BLANKS   @RTCD                                               241166
142600200528     C                     PARM SVALKK    SVALK1 20                                           241166
142700200528     C                     PARM           SVAL1 200                                           241166
142800200528     C                     PARM *BLANK    SVALK2 20                                           241166
142900200528     C                     PARM           SVAL2 200                                           241166
143000200528     C                     PARM *BLANK    SVALK3 20                                           241166
143100200528     C                     PARM           SVAL3 200                                           241166
143200200528     C                     PARM *BLANK    SVALK4 20                                           241166
143300200528     C                     PARM           SVAL4 200                                           241166
143400200528     C                     PARM *BLANK    SVALK5 20                                           241166
143500200528     C                     PARM           SVAL5 200                                           241166
143600200528     C                     PARM *BLANK    SVALK6 20                                           241166
143700200528     C                     PARM           SVAL6 200                                           241166
143800200528     C                     PARM *BLANK    SVALK7 20                                           241166
143900200528     C                     PARM           SVAL7 200                                           241166
144000200528     C                     PARM *BLANK    SVALK8 20                                           241166
144100200528     C                     PARM           SVAL8 200                                           241166
144200200528     C                     PARM *BLANK    SVALK9 20                                           241166
144300200528     C                     PARM           SVAL9 200                                           241166
144400200528     C                     PARM *BLANK    SVALK0 20                                           241166
144500200528     C                     PARM           SVAL10200                                           241166
144600200528      *                                                                                       241166
144700200528     C           @RTCD     IFNE *BLANK                                                        241166
144800200528     C                     MOVEL'SDSVALPD'W0FILE                                              241166
144900200528     C                     MOVEL'*KEY '   W0KEY                                               241166
145000200528     C                     Z-ADD6         W0ERNB                                              241166
145100200528     C                     EXSR SRERR                                                         241166
145200200528     C                     ENDIF                                                              241166
145300200528     C                     MOVE SVAL11    TRSNAR  1                                           241166
145400200528     C/COPY WNCPYSRC,AOH00042
145500200528     C           EXINIT    TAG
145600200528      *
145700200528      **  Unwind subroutine stack name
145800200528     C                     MOVEA*BLANKS   @STK,Q
145900200528     C                     SUB  1         Q
146000200528     C/COPY WNCPYSRC,AOOUFXU0C2
146100200528      *
146200200528     C                     ENDSR
146300200528      *****************************************************************   121483
146400200528      * Subroutine  :  CHKACT                                         *   121483
146500200528      * Function    :  To check for live account before calling       *   121483
146600200528      *                AOSPOSU0                                       *   121483
146700200528      *                                                               *   121483
146800200528      * Called by   :  Various subroutines                            *   121483
146900200528      * Calls       :  None                                           *   121483
147000200528      *****************************************************************   121483
147100200528     C           CHKACT    BEGSR                                          121483
147200200528     C           C#ATYP    IFEQ 'N'                                       121483
147300200528     C           C#ATYP    OREQ 'F'                                       121483
147400200528     C                     CALL 'AONOSTR0'                                121483
147500200528     C                     PARM '*DBERR  '@RTCD   7                       121483
147600200528     C                     PARM '*KEY    '@OPTN   7                       121483
147700200528     C                     PARM *BLANKS   @KEYA   6                       121483
147800200528     C                     PARM C#CCY     @KEYB   3                       121483
147900200528     C**********           PARM *BLANKS   @KEYC   4                                    121483 CGL029
148000200528     C                     PARM *BLANKS   @KEYC  10                                           CGL029
148100200528     C                     PARM *BLANKS   @KEYD   2                       121483
148200200528     C                     PARM ##NOSN    @KEYE   2                       121483
148300200528     C                     PARM *BLANKS   @KEYF   3                       121483
148400200528     C                     PARM *BLANKS   @KEYG  10                       121483
148500200528     C                     PARM *BLANKS   @KEYH   1                       121483
148600200528     C           SDNOST    PARM SDNOST    DSFDY                           121483
148700200528     C*                                                                   121483
148800200528     C** Move accounts detail                                             121483
148900200528     C*                                                                   121483
149000200528     C                     MOVE A7CYCD    D#CCY   3                       121483
149100200528     C**********           MOVE A7ACCD    D#ACOD  4                                    121483 CGL029
149200200528     C                     MOVE A7ACCD    D#ACOD 10                                           CGL029
149300200528     C                     MOVE A7CUST    D#CNUM  6                       121483
149400200528     C                     MOVE A7ACSN    D#ACSQ                          121483
149500200528     C                     MOVE A7BRCD    D#BRCA  3                       121483
149600200528     C                     ENDIF                                          121483
149700200528     C*                                                                   121483
149800200528     C           C#ATYP    IFEQ 'R'                                       121483
149900200528     C                     MOVE C#ACNO    D#RTL  10                       121483
150000200528     C                     MOVE *BLANKS   D#CCY                           121483
150100200528     C                     MOVE *BLANKS   D#ACOD                          121483
150200200528     C                     MOVE *BLANKS   D#CNUM                          121483
150300200528     C                     MOVE *BLANKS   D#ACSQ                          121483
150400200528     C                     MOVE *BLANKS   D#BRCA                          121483
150500200528     C                     ENDIF                                          121483
150600200528      *                                                                   121483
150700200528     C           C#ATYP    IFNE 'N'                                       121483
150800200528     C           C#ATYP    ANDNE'F'                                       121483
150900200528     C           C#ATYP    ANDNE'R'                                       121483
151000200528     C                     MOVE *BLANKS   D#RTL                           121483
151100200528     C                     MOVE C#CCY     D#CCY                           121483
151200200528     C                     MOVE ##ACOD    D#ACOD                          121483
151300200528     C                     MOVE ##CNUM    D#CNUM                          121483
151400200528     C                     MOVE ##ACSQ    D#ACSQ                          121483
151500200528     C                     MOVE ##BRCA    D#BRCA                          121483
151600200528     C                     ENDIF                                          121483
151700200528     C*                                                                   121483
151800200528     C** Calls AOACCTR0 to check for live account                         121483
151900200528     C*                                                                   121483
152000200528     C                     MOVE *BLANKS   NRECI                           121483
152100200528     C                     CALL 'AOACCTR0'                                121483
152200200528     C                     PARM *BLANKS   @RTCD   7                       121483
152300200528     C                     PARM '*KEY   ' @OPTN   7                       121483
152400200528     C                     PARM D#RTL     @RETL  10                       121483
152500200528     C                     PARM D#CNUM    @CNUM   6                       121483
152600200528     C                     PARM D#CCY     @CYCD   3                       121483
152700200528     C**********           PARM D#ACOD    @ACCD   4                                    121483 CGL029
152800200528     C                     PARM D#ACOD    @ACCD  10                                           CGL029
152900200528     C                     PARM D#ACSQ    @ACSN   2                       121483
153000200528     C                     PARM D#BRCA    @DSNB   3                       121483
153100200528     C           SDACNT    PARM SDACNT    DSSDY                           121483
153200200528     C***********                                                  121483 141213
153300200528     C***Calls*AOSPOSU0*if*account*is*live.*********************** 121483 141213
153400200528     C***********                                                  121483 141213
153500200528     C***********NRECI     IFEQ 'D'                                121483 141213
153600200528     C***********C#ATYP    OREQ 'X'                                121483 141213
153700200528     C***********@RTCD     IFNE '*KEY   '                          121483 141213
153800200528     C***********          CALL 'AOSPOSU0'             9090        121483 141213
153900200528     C***********R#RTN     PARM *BLANKS   O#RTN   7                121483 141213
154000200528     C***********          PARM D#ACT     W0ACT   8                121483 141213
154100200528     C***********          PARM C#DTA     O#DTA 256                121483 141213
154200200528     C***********          END                                     121483 141213
154300200528      ***********                                                  121483 141213
154400200528     C************IN90     IFEQ '1'                                121483 141213
154500200528     C***********R#RTN     ORNE *BLANKS                            121483 141213
154600200528     C***********          MOVEL'*CALL   'W0FILE  8                121483 141213
154700200528     C***********          MOVEL'AOSPOSU0'W0KEY  29                121483 141213
154800200528     C***********          Z-ADD903       W0ERNB  30               121483 141213
154900200528     C***********          EXSR SRERR                              121483 141213
155000200528     C***********          END                                     121483 141213
155100200528     C***********          ENDIF                                   121483 141213
155200200528     C                     ENDSR                                          121483
155300200528      *****************************************************************
155400200528     C/SPACE 5
155500200528     C/COPY ZSRSRC,ZDAT10Z2
155600200528** ##NAR  **      NARRATIVES
155700200528BUY CCY
155800200528SELL CCY
155900200528** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
15600020052800366007310109601461
156100200528** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
15620020052800000000310005900090001200015100181002120024300273003040033400365
156300200528** ##CPY  **      OBJECT COPYRIGHT
156400200528(c) Finastra International Limited 2001
