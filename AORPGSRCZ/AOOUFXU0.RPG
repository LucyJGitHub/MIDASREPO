     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AO On-line update of FX position files')         *
     F********************************************************************
     F*                                                                  *
     F*  Midas - Access Objects Module                                   *
     F*                                                                  *
     F*     AOOUFXU0 - On-line Update of FX Positions files              *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                         *
     F*                                                                  *
      *  Last Amend No. 251029             Date 22May20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CLE134             Date 01Aug12               *
      *                 CSW212             Date 03May12               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG25226A          Date 08Sep09               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 19Feb10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 241166             Date 17Jul06               *
      *                 CDL049             Date 04Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154448             DATE 13Oct98               *
     F*                 141213             DATE 23Aug98               *
     F*                 121483             Date 09Jun98               *
     F*                 136436             Date 10Jun98               *
     F*                 CEU003             Date 08Jan98               *
     F*                 082738             Date 03Feb95               *
     F*                                                               *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  251029 - Applied fix 231306.                                 *
      *  231306 - Handle file locking properly.                       *
      *  MD046248 - Finastra Rebranding                               *     
      *  CDL099 - Split Value Date                                    *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG25226A - Field 61 on MT942 is not showing correct data    *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (recompiled)                                        *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  241166 - Modify certain shadow posting narrative to include  *
      *         - transaction ref if SdwPstIncTransRef = 'Y'          *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CDL008 - Continuous Linked Settlement                        *
     F*  154448 - Correct update of online position file for swap deals  *
     F*  141213 - Fix 121483 causes update errors in AOSPOSU0.           *
     F*  121483 - Applied fix 105483:                                 *
     F*         - If account type is equal to 'N' or 'F', program     *
     F*           will not call AOSPOSU0.                             *
     F*         - The parameters being passed by the calling program *
     F*           (AOOUFXU0 or AOOUMMU0) does not match the parame-  *
     F*           ters being received by the calling pgm (AONOSTR0). *
     F*         - Program AOSPOSU0 ended in error when tried to      *
     F*           amend settlement instruction.                      *
     F*         - Renamed the field LCD in a new DS SDACNT to NLCD   *
     F*           since it's been already defined in DS SCSARD       *
     F* 136436 - Deletion of authorized deals does not reverse a/c moves *
     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
     F* 082738 - New program for redesign of update to PRONO, MEMOS,     *
     F*          OLPOS & RSACMTPD.                                       *
     F*                                                                  *
     F********************************************************************
     F/COPY WNCPYSRC,AOOUFXU0F1
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*****************************************************************
     E/SPACE 5
     E*
     E**  (Posting) Naratives
     E                    ##NAR   1   2 30
     E/COPY ZSRSRC,ZDATE9Z1
     E*
     E*  Subroutine stack
     E                    @STK       20 10
     E/COPY WNCPYSRC,AOH00037
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
      ** Array of Commitment Job Names                                                        CSC022
     E                    CMTJOB     10 10                                                    CSC022
     E/COPY WNCPYSRC,AOH00038
     I/SPACE 5
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
     IZ#XSTS    E DSZ#XST                                                 154448
     I*
     IFXDEAL    E DSFXDEALPP
     I##PAYD      DS
     I                                        1   1 ##PAY
     I                                        2   3 ##PAYM
     I**********                              4  15 ##PAYA                                    CGL029
     I**********                             16  18 ##PAYB                                    CGL029
     I                                        4  21 ##PAYA                                    CGL029
     I                                       22  24 ##PAYB                                    CGL029
     I##RECD      DS
     I                                        1   1 ##REC
     I                                        2   3 ##RECM
     I**********                              4  15 ##RECA                                    CGL029
     I**********                             16  18 ##RECB                                    CGL029
     I                                        4  21 ##RECA                                    CGL029
     I                                       22  24 ##RECB                                    CGL029
     I##SETD      DS
      * pay/receive (P/R)
     I                                        1   1 ##PYRC
      * settlement method
     I                                        2   3 ##SETM
      * settlement account
     I**********                              4  15 ##SETA                                    CGL029
     I                                        4  21 ##SETA                                    CGL029
     I                                        4   5 ##NOSN
     I                                        4  13 ##ACNO
     I                                        4   9 ##CNUM
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      * settlement branch
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     IC#DTA       DS                            256
      *  Account type N=nostro nbr F=Full nostro G=General Ledger
      ****************P=Partial Ledger R= Retail Number                   082738
      *               P=Partial Ledger R= Retail Number  X= no settlement 082738
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I                                        2  19 C#ACCT
     I**********                              2   70C#CNU1                                    CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1
     I**********                             11  140C#ACO1                                    CGL029
     I                                       15  160C#ACS1
     I                                       17  19 C#BRC1
      *               Nostro number
     I                                        2   30C#NOSN
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               Partial Account - CNUM/ACOD/ACSQ
     I**********                              2   70C#CNUM                                    CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                                    CGL029
     I                                       12  130C#ACSQ
      *               Branch of account if Partial                      '
     I                                       14  16 C#BRCA
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
      *                     ' ' no OLPOS update
     I                                       24  24 C#IO
      *               Currency of transaction
     I                                       25  27 C#CCY
      *               Transaction Type
     I                                       28  29 C#TRYP
      *               Transaction Narrative
     I                                       30  59 C#NARR
      *               Cheque Number
     I                                       60  670C#CHQN
      *               FT transaction reference
     I                                       68  82 C#PREF
      *               DL/LE/GL/RE transaction reference
     I                                       83  88 C#TRN
      *               Movement amount
     I                                    P  89  960C#AMT
      *               Processing indicators Not blank = no update
      *                                     ' ' = Update
      *               Prono update indicator
     I                                       97  97 C#PRON
      *               Olpos update indicator
     I                                       98  98 C#OLPS
      *               Memos update indicator
     I                                       99  99 C#MEMS
      *               Rsacmtpd write indicator
     I                                      100 100 C#RSAC
      *               Module
     I                                      101 102 C#MOD
      *               Olpos record number to update
      *                     '01' for FX
      *                     '02' for Interest movements
      *                     '03' for MM loans and deposits
     I                                      103 104 C#OLRC
      *               FT Memos ledger balance override
      *                        'Y' update ledger balance irrespective of
      *                        posting date
     I                                      105 105 C#FTOV
      *               Value date and posting date
     I                                    P 106 1080C#VDAT
     I                                    P 109 1110C#PSTD
      *               Override posting date correction
      *                        for forward valued items
      *                        'Y' prevents date being changed
     I                                      112 112 C#PSTO
      *               Indicator to show if removal allowed Y, N or " "
     I                                      113 113 C#RPST
      *               Removal set number
     I                                      114 1160C#RPNB
      *               Removal type "C" = Credit entries
      *                            "D" = Debit entries
     I                                      117 117 C#RTYP
      *               Booking branch                                      082738
     I                                      118 120 C#BBRN                082738
      *                                                                                       CGL029
      ** Account code for full general ledger                                                 CGL029
      *                                                                                       CGL029
     I                                      121 1300C#ACO1                                    CGL029
      *                                                                                       CGL029
      ** Account code for partial account                                                     CGL029
      *                                                                                       CGL029
     I                                      131 1400C#ACOD                                    CGL029
      *                                                                                       CAP204
      ** Other Transaction Reference                                                          CAP204
      *                                                                                       CAP204
     I                                      141 160 C#OTR1                                    CAP204
      *                                                                                       CAP205
      ** Movement Type                                                                        CAP205
      *                                                                                       CAP205
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
     I**                                                                                      241166
     I* Data structure for more detailed description                                          241166
     I            DS                                                                          241166
     I                                        1  15 D#WORK                                    241166
     I                                        1   6 D#TRN                                     241166
     I                                        9  10 D#TYP                                     241166
      *                                                                                       CAP205
     ISDBANK    E DSSDBANKPD                                                                  CAP205
      ** Bank Details File                                                                    CAP205
      *                                                                   CEU003
     ISCSARD    E DSSCSARDPD                                              CEU003
      ** Switchable Features File                                         CEU003
      *                                                                   CEU003
     IDSFDY     E DSDSFDY                                                 CEU003
      * First DS for Access programs, Short Data Structure                CEU003
      *                                                                   CEU003
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
     I/COPY ZSRSRC,ZDAT10Z1
     ISDACNT    E DSACCNTAB                                               121483
     I*                                                                   121483
     I** EXTERNAL DS FOR ACCOUNT DETAILS                                  121483
     I*                                                                   121483
     I              RECI                            NRECI                 121483
     I              CNUM                            NCNUM                 121483
     I              CCY                             NCCY                  121483
     I              BRCA                            NBRCA                 121483
     I              PRFC                            NPRFC                 121483
     I              ORED                            NORED                 121483
     I              FACT                            NFACT                 121483
     I              FCNO                            NFCNO                 121483
     I              CHTP                            NCHTP                 121483
     I              TNLU                            NTNLU                 121483
     I              NACSG                           NNACSG                121483
     I              LCD                             NLCD                  121483
     I*                                                                   121483
     ISDNOST    E DSSDNOSTPD                                              121483
     I** EXTERNAL DS FOR NOSTRO DETAILS                                   121483
     I*                                                                   121483
     ISDCUST    E DSSDCUSTPD                                                               BUG25226A
      * Customer Details Accessed via Access program                                       BUG25226A
     I              QQDFAC                          QQDFA1                                 BUG25226A
      *                                                                                    BUG25226A
     IDSSDY     E DSDSSDY                                                 121483
     I*                                                                   121483
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                121483
     IDSLDY     E DSDSLDY                                                                  BUG25226A
      *  Third DS for Access programs, Very Long Data Structure                            BUG25226A
      *                                                                                    BUG25226A
     I*                                                                   121483
     ICONV        DS                                                      121483
     I                                        1   2 D#ACSQ                121483
     I* DATA STRUCTURE THAT CONVERTS NUMERIC ACSQ TO CHARACTER            121483
     I*                                                                   121483
     I/COPY WNCPYSRC,AOH00039
      *                                                                                       CSC022
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      *                                                                                       CSC022
      *  Program data structure                                                               CSC022
      *                                                                                       CSC022
     IDSPGM     ESDSY2PGDSP                                                                   CSC022
      *                                                                                       CSC022
     ISVAL1       DS                            200                                           241166
     I                                        1   1 SVAL11                                    241166
      ** DS for AOSVALR0                                                                      241166
      *                                                                                       241166
     I              'SdwPstIncTransRef   'C         SVALKK                                    241166
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           Z#XSTS                          154448
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      *  Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Clear down all shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRCLR
      *
     C                     MOVELZ#BSTS    #BRCID  2
     C                     MOVELZ#ASTS    #ARCID  2
     C                     MOVELZ#WSTS    #WRCID  2
     C                     MOVELZ#XSTS    #XRCID  2                       154448
      *                                                                   154448
      ** Generate 'BEFORE STATUS' account movements                       154448
      ** (if not insertion, when #BRCID will be blank)                    154448
      *                                                                   154448
     C           #BRCID    IFNE *BLANK                                    154448
      *                                                                   154448
     C                     MOVEL'YES'     ##REVI  3                       154448
      *                                                                   154448
      ** Set up FX deal data structure.                                   154448
     C                     MOVELZ#BSTS    FXDEAL                          154448
     C                     EXSR SRFXDL                                    154448
      *                                                                   154448
     C                     END                             * #BRCID       154448
      *                                                                   154448
      ** Generate 'BEFORE STATUS' account movements                       154448
      ** for associated deal if present (option or other leg of swap)     154448
      *                                                                   154448
     C           #WRCID    IFNE *BLANK                                    154448
      *                                                                   154448
     C                     MOVEL'YES'     ##REVI                          154448
      *                                                                   154448
      ** Set up FX deal data structure.                                   154448
     C                     MOVELZ#WSTS    FXDEAL                          154448
     C                     EXSR SRFXDL                                    154448
      *                                                                   154448
      ** FX swap - 'BEFORE STATUS' extra processing                       154448
      *                                                                   154448
     C           #BRCID    IFNE *BLANK                                    154448
     C           FHTYPE    ANDEQ'SW'                                      154448
     C                     EXSR SRFXSW                                    154448
     C                     END                                            154448
      *                                                                   154448
     C                     END                             * #WRCID       154448
      *                                                                   154448
      ** Generate 'AFTER STATUS' account movements                        154448
      ** (if not deletion, when FHCHTP will be 'D')                       154448
      *                                                                   154448
     C                     MOVEL*BLANK    ##REVI                          154448
      *                                                                   154448
      ** Set up FX deal data structure.                                   154448
     C                     MOVELZ#ASTS    FXDEAL                          154448
     C           FHCHTP    IFNE 'D'                                       154448
     C           FHLACT    ANDNE'D'                                       154448
     C                     EXSR SRFXDL                                    154448
     C                     END                                            154448
      *                                                                   154448
      ** Generate 'AFTER STATUS' account movements                        154448
      ** for associated deal if present (option or other leg of swap)     154448
      *                                                                   154448
     C           #XRCID    IFNE *BLANK                                    154448
      *                                                                   154448
      ** Set up FX deal data structure.                                   154448
     C                     MOVELZ#XSTS    FXDEAL                          154448
     C           FHCHTP    IFNE 'D'                                       154448
     C           FHLACT    ANDNE'D'                                       154448
     C                     EXSR SRFXDL                                    154448
     C                     END                                            154448
      *                                                                   154448
      ** FX swap - 'AFTER STATUS' extra processing                        154448
      *                                                                   154448
     C           FHCHTP    IFNE 'D'                                       154448
     C           FHLACT    ANDNE'D'                                       154448
     C           FHTYPE    ANDEQ'SW'                                      154448
     C                     EXSR SRFXSW                                    154448
     C                     END                                            154448
      *                                                                   154448
     C                     END                             * #XRCID       154448
      ***********                                                         154448
      ***Generate 'BEFORE STATUS' account movements                       154448
      ***(if*not insertion, when #BRCID will be blank)                    154448
      ***********                                                         154448
     C***********#BRCID    IFNE *BLANK                                    154448
      ***********                                                         154448
     C***********          MOVEL'YES'     ##REVI  3                       154448
      ***********                                                         154448
      ***Set*up*FX deal data structure.                                   154448
     C***********          MOVELZ#BSTS    FXDEAL                          154448
     C***********FHTYPE    IFNE 'OP'                                      154448
     C***********          EXSR SRFXDL                                    154448
     C***********          END                                            154448
      ***********                                                         154448
     C***********          END                             * Z#BSTS       154448
      ***********                                                         154448
      ***Generate 'AFTER STATUS' account movements                        154448
      ***(if*not*deletion,*when*FHCHTP*will*be*'D')********************   136436
      ***(if*not*deletion,*when*FHCHTP*or*FHLACT*will be 'D')      136436 154448
      ***********                                                         154448
     C***********          MOVEL*BLANK    ##REVI                          154448
      ***********                                                         154448
      ***Set*up*FX deal data structure.                                   154448
     C***********          MOVELZ#ASTS    FXDEAL                          154448
     C***********FHCHTP    IFNE 'D'                                       154448
     C***********FHLACT    ANDNE'D'                                136436 154448
     C***********FHTYPE    ANDNE'OP'                                      154448
     C***********          EXSR SRFXDL                                    154448
     C***********          END                                            154448
      ***********                                                         154448
      ***Generate*'WORK*STATUS' account movements for SWAP REVERSAL.      154448
      ***(for*swap*reversal #WRCID will NOT be blank)                     154448
      ***********                                                         154448
     C***********#WRCID    IFNE *BLANK                                    154448
      ***********                                                         154448
     C***********          MOVEL'YES'     ##REVI  3                       154448
      ***********                                                         154448
      ***Set*up*FX deal data structure.                                   154448
     C***********          MOVELZ#WSTS    FXDEAL                          154448
     C***********          EXSR SRFXDL                                    154448
      ***********                                                         154448
     C***********          END                             * Z#BSTS       154448
      *
      ** Update database with shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRUPD
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRFXDL                                         *
      * Function    :  FX Deal Processing                             *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  AOSPOSU0 - On-line Positions Update            *
      *****************************************************************
     C           SRFXDL    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRFXDL'  @STK,Q
      *
      *................................................................
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT  50       * event val dte
     C                     Z-ADD*ZERO     ##DDAT  50       * deal date                        CAP205
     C                     MOVEL*BLANK    ##NARR 30        * narrative
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
     C                     MOVELFHMOPM    ##PAYM           * pay method
     C                     MOVELFHMOPI    ##PAYA           * pay account
     C                     MOVELFHPOBR    ##PAYB           * pay branch
     C                     MOVELFHORCM    ##RECM           * rec method
     C                     MOVELFHMORI    ##RECA           * rec account
     C                     MOVELFHROBR    ##RECB           * rec branch
      *
      **  Store basic deal details
      *
     C                     MOVELFHTYPE    ##TRYP  2        * deal type
     C                     MOVELFHDN38    ##TRN   6        * transact no.
     C                     MOVELFHDBRC    ##BBRN  3        * booking branc082738
      *
      **  Negative amount is sell amount
     C           FHDAM1    IFLT 0
     C                     Z-SUBFHDAM1    ##SAMT 150       * sell amount
     C                     MOVELFHCCY1    ##SCCY  3        * sell ccy
     C                     Z-ADDFHDAM2    ##BAMT 150       * buy amount
     C                     MOVELFHCCY2    ##BCCY  3        * buy ccy
     C                     ELSE
     C                     Z-ADDFHDAM1    ##BAMT           * buy amount
     C                     MOVELFHCCY1    ##BCCY           * buy ccy
     C                     Z-SUBFHDAM2    ##SAMT           * sell amount
     C                     MOVELFHCCY2    ##SCCY           * sell ccy
     C                     END
      *
     C           FHTYPE    IFNE 'OP'                                      154448
     C                     Z-ADDFHVDYY    ZWYYYY           ¦
     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date
     C                     Z-ADDFHVDDD    ZWDAY            ¦
     C                     ELSE                                           154448
     C                     Z-ADDFHDOEY    ZWYYYY           ¦              154448
     C                     Z-ADDFHDOEM    ZWMTH            ¦ option to    154448
     C                     Z-ADDFHDOED    ZWDAY            ¦ date         154448
     C                     END                                            154448
      *                                                                   154448
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ##VDAT
      *                                                                   CEU003
      ** Settlement currency                                              CEU003
      *                                                                   CEU003
     C                     MOVELFHRSCY    ##RSCY  3                       CEU003
     C                     MOVELFHPSCY    ##PSCY  3                       CEU003
      *                                                                   CEU003
      ** If CEU003 is ON, convert the amounts from transaction currency   CEU003
      ** to settlement currency.                                          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *                                                                   CEU003
      ** Receive settlement currency.                                     CEU003
      *                                                                   CEU003
     C           ##RSCY    IFNE *BLANKS                                   CEU003
      *                                                                   CEU003
     C                     CALL 'EU0200'               90                 CEU003
     C                     PARM *BLANKS   P#RTCD  7                       CEU003
     C                     PARM ##BAMT    P#FRAM 183                      CEU003
     C                     PARM ##BCCY    P#FRCY  3                       CEU003
     C                     PARM ##RSCY    P#TOCY  3                       CEU003
     C                     PARM           P#OUTA 150                      CEU003
     C                     PARM           P#INTA 183                      CEU003
     C                     PARM           P#EXRT 159                      CEU003
     C                     PARM           P#MDIN  1                       CEU003
      *                                                                   CEU003
     C           *IN90     IFEQ '1'                                       CEU003
     C           P#RTCD    ORNE *BLANKS                                   CEU003
     C                     MOVEL'*CALL   'W0FILE  8                       CEU003
     C                     MOVEL'EU0200  'W0KEY  29                       CEU003
     C                     Z-ADD904       W0ERNB  30                      CEU003
     C                     EXSR SRERR                                     CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVE P#OUTA    ##BAMT                          CEU003
     C                     MOVE ##RSCY    ##BCCY                          CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Receive settlement currency.                                     CEU003
      *                                                                   CEU003
     C           ##PSCY    IFNE *BLANKS                                   CEU003
      *                                                                   CEU003
     C                     CALL 'EU0200'               90                 CEU003
     C                     PARM *BLANKS   P#RTCD  7                       CEU003
     C                     PARM ##SAMT    P#FRAM 183                      CEU003
     C                     PARM ##SCCY    P#FRCY  3                       CEU003
     C                     PARM ##PSCY    P#TOCY  3                       CEU003
     C                     PARM           P#OUTA 150                      CEU003
     C                     PARM           P#INTA 183                      CEU003
     C                     PARM           P#EXRT 159                      CEU003
     C                     PARM           P#MDIN  1                       CEU003
      *                                                                   CEU003
     C           *IN90     IFEQ '1'                                       CEU003
     C           P#RTCD    ORNE *BLANKS                                   CEU003
     C                     MOVEL'*CALL   'W0FILE  8                       CEU003
     C                     MOVEL'EU0200  'W0KEY  29                       CEU003
     C                     Z-ADD904       W0ERNB  30                      CEU003
     C                     EXSR SRERR                                     CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVE P#OUTA    ##SAMT                          CEU003
     C                     MOVE ##PSCY    ##SCCY                          CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *
      ** Generate BUY (Receive) account movement
      ** =======================================
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     Z-ADD##BAMT    ##AMT  150       * buy amount
     C                     MOVEL##BCCY    ##CCY   3        * buy ccy
      *
     C                     Z-ADD001       ##RPNB  30       * 1=Receive
     C                     MOVEL##NAR,1   ##NARR
     C                     MOVELFHRSTM    ##RSTM  2                                           CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
      *                                                                                       CAP205
      ** Check if purchase currency is settled through a nostro                               CAP205
      *                                                                                       CAP205
     C           ##RSTM    IFEQ '01'                                                          CAP205
     C           ##RSTM    OREQ '07'                                                          CAP205
     C           ##RSTM    OREQ '08'                                                          CAP205
     C                     MOVEL##BCCY    ##DCCY  3                                           CAP205
     C                     ELSE                                                               CAP205
     C                     MOVELBJLCCY    ##DCCY                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
      ** Calculate date (deal date + 2 working days) BUY                                      CAP205
      *                                                                                       CAP205
     C                     CALL 'ZFWDT'                                                       CAP205
     C                     PARM FHDDDN    ZDAYNO  50                                          CAP205
     C                     PARM 2         ZNRDYS  20                                          CAP205
     C                     PARM *ZERO     ZDYNBR  50                                          CAP205
     C                     PARM ##DCCY    ZCCY    3                                           CAP205
     C                     PARM *BLANK    ZLOC    3                                           CAP205
      *                                                                                       CAP205
     C                     Z-ADDZDYNBR    ##DDAT  50                                          CAP205
     C           FHVDDN    IFGT ##DDAT                                                        CAP205
     C                     MOVE 'F'       ##MTYP  1                                           CAP205
     C                     ELSE                                                               CAP205
     C                     MOVE 'S'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *
      ** Generate SELL (Pay) account movement
      ** ====================================
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     Z-ADD##SAMT    ##AMT  150       * sell amount
     C                     MOVEL##SCCY    ##CCY   3        * sell ccy
      *
     C                     Z-ADD002       ##RPNB  30       * 2=Pay
     C                     MOVEL##NAR,2   ##NARR
     C                     MOVELFHPSTM    ##PSTM  2                                           CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
      *                                                                                       CAP205
      ** Check if purchase currency is settled through a nostro                               CAP205
      *                                                                                       CAP205
     C           ##PSTM    IFEQ '01'                                                          CAP205
     C           ##PSTM    OREQ '07'                                                          CAP205
     C           ##PSTM    OREQ '08'                                                          CAP205
     C                     MOVEL##SCCY    ##DCCY                                              CAP205
     C                     ELSE                                                               CAP205
     C                     MOVELBJLCCY    ##DCCY                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
      ** Calculate date (deal date + 2 working days) SELL                                     CAP205
      *                                                                                       CAP205
     C                     CALL 'ZFWDT'                                                       CAP205
     C                     PARM FHDDDN    ZDAYNO                                              CAP205
     C                     PARM 2         ZNRDYS                                              CAP205
     C                     PARM *ZERO     ZDYNBR                                              CAP205
     C                     PARM ##DCCY    ZCCY                                                CAP205
     C                     PARM *BLANK    ZLOC                                                CAP205
      *                                                                                       CAP205
     C                     Z-ADDZDYNBR    ##DDAT                                              CAP205
     C           FHVDDN    IFGT ##DDAT                                                        CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ELSE                                                               CAP205
     C                     MOVE 'S'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *
      *................................................................
      *
     C           EXFXDL    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRMOVE                                         *
      * Function    :  Pass Movement To Write Program                 *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRMOVE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if no amount to post
      *
     C           ##AMT     CABEQ*ZERO     EXMOVE
      *
      ** Determine account movement settlement details
      *
     C                     CLEARC#DTA
      *
     C           ##SETM    IFEQ '01'
     C           ##SETM    OREQ '02'
     C           ##SETM    OREQ '07'
     C           ##SETM    OREQ '08'
     C           ##SETM    OREQ '12'
     C                     MOVEL'N'       C#ATYP
     C                     MOVEL##NOSN    C#NOSN
     C                     ELSE
     C           ##SETM    IFEQ '14'
     C                     MOVEL'R'       C#ATYP
     C                     MOVEL##ACNO    C#ACNO
     C                     ELSE
     C           ##SETM    IFEQ '04'
     C           ##SETM    OREQ '05'
     C                     MOVEL'P'       C#ATYP
     C                     MOVEL##CNUM    C#CNUM
     C                     MOVEL##ACOD    C#ACOD
     C                     MOVEL##ACSQ    C#ACSQ
     C                     MOVEL##BRCA    C#BRCA
     C                     END
     C                     END
     C                     END
      *                                                                   082738
      * OLPOS Incoming/Outgoing Indicator 'I' or 'O'                      082738
     C           ##PYRC    IFEQ 'P'                                       082738
     C                     MOVEL'O'       C#IO             * outgoing     082738
     C                     ELSE                                           082738
     C                     MOVEL'I'       C#IO             * incoming     082738
     C                     END                                            082738
      *********************                                               082738
      ***Bypass*if*no*settlement or internal settlement                   082738
      *********************                                               082738
     C***********C#ATYP****CABEQ*BLANK    EXMOVE                          082738
      *
      * Currency of transaction
     C                     MOVEL##CCY     C#CCY
      *
      * Transaction type
     C                     MOVEL##TRYP    C#TRYP
      * Transaction Narrative
     C/COPY WNCPYSRC,AOH00040
     C                     MOVEL##NARR    C#NARR
     C/COPY WNCPYSRC,AOH00041
      *                                                                                       241166
      * Include transaction number and type                                                   241166
     C           TRSNAR    IFEQ 'Y'                                                           241166
     C**********           MOVE *BLANK    D#WORK                                    241166 BUG25226A
     C**********           MOVE ##TRN     D#TRN                                     241166 BUG25226A
     C**********           MOVE ##TRYP    D#TYP                                     241166 BUG25226A
     C**********           MOVE D#WORK    C#NARR                                    241166 BUG25226A
      *                                                                                    BUG25226A
     C                     MOVE *BLANKS   C#NARR                                           BUG25226A
     C                     MOVELFHDCNO    @KEY1                                            BUG25226A
     C                     CALL 'AOCUSTR1'                                                 BUG25226A
     C                     PARM '*MSG   ' @RTCD                                            BUG25226A
     C                     PARM '*KEY   ' @OPTN                                            BUG25226A
     C                     PARM           @KEY1  10                                        BUG25226A
     C                     PARM *BLANKS   @KYST   7                                        BUG25226A
     C           SDCUST    PARM SDCUST    DSLDY                                            BUG25226A
      *                                                                                    BUG25226A
     C           @RTCD     IFEQ *BLANK                                                     BUG25226A
     C           ##TRN     CAT  BBCRNM:1  C#NARR                                           BUG25226A
     C                     ENDIF                                                           BUG25226A
      *                                                                                    BUG25226A
     C                     ENDIF                                                              241166
      *                                                                                       241166
     C           ##REVI    IFEQ 'YES'
     C                     MOVE '*'       C#NARR
     C                     END
      *
      * DL/LE/GL/RE transaction reference
     C                     MOVEL##TRN     C#TRN
      *
      * Movement amount
     C           ##PYRC    IFEQ 'P'
     C           ##REVI    ANDNE'YES'
     C           ##PYRC    OREQ 'R'
     C           ##REVI    ANDEQ'YES'
     C                     Z-SUB##AMT     C#AMT            * pay ie credit
     C                     ELSE
     C                     Z-ADD##AMT     C#AMT            * rec ie debit
     C                     END
      *
      **Olpos*update*indicator                                            082738
     C*********************MOVEL'N'       C#OLPS                          082738
      *                                                                   154448
      * Olpos update indicator                                            154448
     C           ##TRYP    IFEQ 'SW'                                      154448
     C                     MOVEL'N'       C#OLPS                          154448
     C                     END                                            154448
      *
      * Module
     C                     MOVEL'DL'      C#MOD
      *                                                                   082738
      * Olpos record number to update                                     082738
      * '01' for FX                                                       082738
      * '02' for Interest movements                                       082738
      * '03' for MM loans and deposits                                    082738
     C                     MOVE '01'      C#OLRC                          082738
      *
      * Value date and posting date
     C                     Z-ADD##VDAT    C#VDAT
      *                                                                                       CDL099
     C           CDL099    IFEQ 'Y'                                                           CDL099
      *                                                                                       CDL099
      ** If a payment update is to be generated                                               CDL099
     C           ##PYRC    IFEQ 'P'                                                           CDL099
     C                     Z-ADDFHVS2Y    ZWYYYY                                              CDL099
     C                     Z-ADDFHVS2M    ZWMTH                                               CDL099
     C                     Z-ADDFHVS2D    ZWDAY                                               CDL099
     C                     EXSR ZDAT10                                                        CDL099
     C                     Z-ADDZZMDNO    C#VDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     ENDIF                                                              CDL099
     C/COPY WNCPYSRC,AOOUFXU0C1
     C                     Z-ADD##VDAT    C#PSTD
      *
      * Indicator to show if removal allowed Y, N or " "
     C                     MOVEL'Y'       C#RPST
      *
      * Removal set number
     C                     Z-ADD##RPNB    C#RPNB
      *
      * Removal type "C" = Credit entries
      *              "D" = Debit entries
     C                     MOVEL'C'       C#RTYP
      *                                                                   082738
      * Booking branch                                                    082738
     C                     MOVEL##BBRN    C#BBRN                          082738
      *                                                                   082738
      *  If settlement details are present                                082738
      *  AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS  082738
      *                                                                   082738
      *  OTHERWISE                                                        082738
      *                                                                   082738
      *  If no settlement details are present                             082738
      *  AOSPOSU0 will be called to only update OLPOS                     082738
      *                                                                   082738
     C           C#ATYP    IFEQ *BLANK                                    082738
      *                                                                   082738
      * Set account type indicator to signify no settlement               082738
     C                     MOVEL'X'       C#ATYP                          082738
      *                                                                   082738
      * Set update indicators for no update                               082738
     C                     MOVE 'N'       C#PRON                          082738
     C                     MOVE 'N'       C#MEMS                          082738
     C                     MOVE 'N'       C#RSAC                          082738
     C                     END                                            082738
      *                                                                                       CAP205
      ** Set value for Movement Type field                                                    CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE ##MTYP    C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      ***Call*AOSPOSU0************************************************    141213
      ***********                                                         141213
     C***********          CALL 'AOSPOSU0'             9090               121483
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
     C***********          PARM '*ADD    'W0ACT   8                       121483
     C***********          PARM C#DTA     O#DTA 256                       121483
      *                                                                   121483
     C************IN90     IFEQ '1'                                       121483
     C***********R#RTN     ORNE *BLANKS                                   121483
     C***********          MOVEL'*CALL   'W0FILE  8                       121483
     C***********          MOVEL'AOSPOSU0'W0KEY  29                       121483
     C***********          Z-ADD902       W0ERNB  30                      121483
     C***********          EXSR SRERR                                     121483
     C***********          END                                            121483
     C***********          MOVE '*ADD    'D#ACT   8                121483 141213
      *                                                                   141213
      *  Check if account is open if account posting                      141213
      *                                                                   141213
     C           C#ATYP    IFNE 'X'                                       141213
     C                     EXSR CHKACT                                    121483
     C                     END                                            141213
      *                                                                   141213
      *  If account posting and account is open,                          141213
      *  or if not account posting                                        141213
      *    Call AOSPOSU0                                                  141213
      *                                                                   141213
     C           C#ATYP    IFNE 'X'                                       141213
     C           NRECI     ANDEQ'D'                                       141213
     C           C#ATYP    OREQ 'X'                                       141213
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*ADD    'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE  8                       141213
     C                     MOVEL'AOSPOSU0'W0KEY  29                       141213
     C                     Z-ADD902       W0ERNB  30                      141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
     C                     END                                            141213
      *
      *................................................................
      *
     C           EXMOVE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5                                                            154448
      *****************************************************************   154448
      * Subroutine  :  SRFXSW                                         *   154448
      * Function    :  FX Swap - Extra Processing                     *   154448
      *                                                               *   154448
      * Called by   :  Mainline                                       *   154448
      * Calls       :  AOSPOSU0 - On-line Positions Update            *   154448
      *****************************************************************   154448
     C           SRFXSW    BEGSR                                          154448
      *                                                                   154448
      **  Set up subroutine stack name                                    154448
     C                     ADD  1         Q       50                      154448
     C                     MOVEL'SRFXSW'  @STK,Q                          154448
      *                                                                   154448
      *................................................................   154448
      *                                                                   154448
      * One swap leg                                                      154448
      *                                                                   154448
     C           ##REVI    IFEQ 'YES'                                     154448
     C                     MOVELZ#BSTS    FXDEAL                          154448
     C                     ELSE                                           154448
     C                     MOVELZ#ASTS    FXDEAL                          154448
     C                     END                                            154448
      *                                                                   154448
      **  Negative amount is sell amount                                  154448
      *                                                                   154448
     C           FHDAM1    IFLT 0                                         154448
     C                     Z-SUBFHDAM1    ##SAM1 150       * sell amount  154448
     C                     MOVELFHCCY1    ##SCY1  3        * sell ccy     154448
     C                     Z-ADDFHDAM2    ##BAM1 150       * buy amount   154448
     C                     MOVELFHCCY2    ##BCY1  3        * buy ccy      154448
     C                     ELSE                                           154448
     C                     Z-ADDFHDAM1    ##BAM1           * buy amount   154448
     C                     MOVELFHCCY1    ##BCY1           * buy ccy      154448
     C                     Z-SUBFHDAM2    ##SAM1           * sell amount  154448
     C                     MOVELFHCCY2    ##SCY1           * sell ccy     154448
     C                     END                                            154448
      *                                                                   154448
     C                     Z-ADDFHVDYY    ZWYYYY           ¦              154448
     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date   154448
     C                     Z-ADDFHVDDD    ZWDAY            ¦              154448
     C                     EXSR ZDAT10                                    154448
     C                     Z-ADDZZMDNO    ##VDT1  50                      154448
      *                                                                   154448
      * Other swap leg                                                    154448
      *                                                                   154448
     C           ##REVI    IFEQ 'YES'                                     154448
     C                     MOVELZ#WSTS    FXDEAL                          154448
     C                     ELSE                                           154448
     C                     MOVELZ#XSTS    FXDEAL                          154448
     C                     END                                            154448
      *                                                                   154448
      **  Negative amount is sell amount                                  154448
      *                                                                   154448
     C           FHDAM1    IFLT 0                                         154448
     C                     Z-SUBFHDAM1    ##SAM2 150       * sell amount  154448
     C                     MOVELFHCCY1    ##SCY2  3        * sell ccy     154448
     C                     Z-ADDFHDAM2    ##BAM2 150       * buy amount   154448
     C                     MOVELFHCCY2    ##BCY2  3        * buy ccy      154448
     C                     ELSE                                           154448
     C                     Z-ADDFHDAM1    ##BAM2           * buy amount   154448
     C                     MOVELFHCCY1    ##BCY2           * buy ccy      154448
     C                     Z-SUBFHDAM2    ##SAM2           * sell amount  154448
     C                     MOVELFHCCY2    ##SCY2           * sell ccy     154448
     C                     END                                            154448
      *                                                                   154448
     C                     Z-ADDFHVDYY    ZWYYYY           ¦              154448
     C                     Z-ADDFHVDMM    ZWMTH            ¦ value date   154448
     C                     Z-ADDFHVDDD    ZWDAY            ¦              154448
     C                     EXSR ZDAT10                                    154448
     C                     Z-ADDZZMDNO    ##VDT2  50                      154448
      *                                                                   154448
      * Determine value date of 2nd leg                                   154448
      *                                                                   154448
     C           ##VDT2    IFGT ##VDT1                                    154448
     C                     Z-ADD##VDT2    ##VDAT                          154448
     C                     ELSE                                           154448
     C                     Z-ADD##VDT1    ##VDAT                          154448
     C                     END                                            154448
      *                                                                   154448
      ** Calculate swap profit/loss & currency                            154448
      *                                                                   154448
     C           ##BAM1    IFEQ ##SAM2                                    154448
     C           ##BAM2    SUB  ##SAM1    ##AMT                           154448
     C                     MOVEL##BCY2    ##CCY                           154448
     C                     ELSE                                           154448
     C           ##BAM1    SUB  ##SAM2    ##AMT                           154448
     C                     MOVEL##BCY1    ##CCY                           154448
     C                     END                                            154448
      *                                                                   154448
      ** Bypass if no amount to post                                      154448
      *                                                                   154448
     C           ##AMT     CABEQ*ZERO     EXFXSW                          154448
      *                                                                   154448
      ** Clear movement                                                   154448
      *                                                                   154448
     C                     CLEARC#DTA                                     154448
      *                                                                   154448
      ** Profit or loss?                                                  154448
      ** OLPOS Incoming/Outgoing Indicator 'I' or 'O'                     154448
      *                                                                   154448
     C           ##AMT     IFLT *ZERO                                     154448
     C                     MOVEL'O'       C#IO             * outgoing     154448
     C                     ELSE                                           154448
     C                     MOVEL'I'       C#IO             * incoming     154448
     C                     END                                            154448
      *                                                                   154448
      * Currency of transaction                                           154448
     C                     MOVEL##CCY     C#CCY                           154448
      *                                                                   154448
      * Movement amount                                                   154448
     C           ##REVI    IFEQ 'YES'                                     154448
     C                     Z-SUB##AMT     C#AMT            * pay ie credit154448
     C                     ELSE                                           154448
     C                     Z-ADD##AMT     C#AMT            * rec ie debit 154448
     C                     END                                            154448
      *                                                                   154448
      * Olpos record number to update                                     154448
      * '01' for FX                                                       154448
      * '02' for Interest movements                                       154448
      * '03' for MM loans and deposits                                    154448
     C                     MOVE '02'      C#OLRC                          154448
      *                                                                   154448
      * Value date and posting date                                       154448
      *                                                                   154448
     C                     Z-ADD##VDAT    C#VDAT                          154448
     C                     Z-ADD##VDAT    C#PSTD                          154448
      *                                                                   154448
      * Removal set number                                                154448
     C                     Z-ADD003       C#RPNB                          154448
      *                                                                   154448
      * Booking branch                                                    154448
     C                     MOVELFHDBRC    C#BBRN                          154448
      *                                                                   154448
      *  AOSPOSU0 will be called to only update OLPOS                     154448
      *                                                                   154448
      * Set account type indicator to signify no settlement               154448
     C                     MOVEL'X'       C#ATYP                          154448
      *                                                                   154448
      * Set update indicators for no update                               154448
     C                     MOVE 'N'       C#PRON                          154448
     C                     MOVE 'N'       C#MEMS                          154448
     C                     MOVE 'N'       C#RSAC                          154448
      *                                                                   154448
      *  Call AOSPOSU0                                                    154448
      *                                                                   154448
     C                     CALL 'AOSPOSU0'             9090               154448
     C           R#RTN     PARM *BLANKS   O#RTN   7                       154448
     C                     PARM '*ADD    'W0ACT   8                       154448
     C                     PARM C#DTA     O#DTA 256                       154448
      *                                                                   154448
     C           *IN90     IFEQ '1'                                       154448
     C           R#RTN     ORNE *BLANKS                                   154448
     C                     MOVEL'*CALL   'W0FILE  8                       154448
     C                     MOVEL'AOSPOSU0'W0KEY  29                       154448
     C                     Z-ADD902       W0ERNB  30                      154448
     C                     EXSR SRERR                                     154448
     C                     END                                            154448
      *                                                                   154448
      *................................................................   154448
      *                                                                   154448
     C           EXFXSW    TAG                                            154448
      *                                                                   154448
      **  Unwind subroutine stack name                                    154448
     C                     MOVEA*BLANKS   @STK,Q                          154448
     C                     SUB  1         Q                               154448
      *                                                                   154448
     C                     ENDSR                                          154448
     C*****************************************************************   154448
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow postings in store     *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *................................................................
      *
      *  Call AOSPOSU0 to update database
      *                                                                   141213
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*UPDATE 'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE                          141213
     C                     MOVEL'AOSPOSU0'W0KEY                           141213
     C                     Z-ADD903       W0ERNB                          141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
      *
     C***********          CALL 'AOSPOSU0'             9090               121483
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
     C***********          PARM '*UPDATE 'W0ACT   8                       121483
     C***********          PARM C#DTA     O#DTA 256                       121483
      *                                                                   121483
     C************IN90     IFEQ '1'                                       121483
     C***********R#RTN     ORNE *BLANKS                                   121483
     C***********          MOVEL'*CALL   'W0FILE                          121483
     C***********          MOVEL'AOSPOSU0'W0KEY                           121483
     C***********          Z-ADD903       W0ERNB                          121483
     C***********          EXSR SRERR                                     121483
     C***********          END                                            121483
     C***********          MOVE '*UPDATE 'D#ACT                    121483 141213
     C***********          EXSR CHKACT                             121483 141213
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all postings in store                       *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *................................................................
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARC#DTA
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*CLEAR  'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE                          141213
     C                     MOVEL'AOSPOSU0'W0KEY                           141213
     C                     Z-ADD901       W0ERNB                          141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
      *                                                                   141213
     C***********          CALL 'AOSPOSU0'             9090               121483
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       121483
     C***********          PARM '*CLEAR  'W0ACT   8                       121483
     C***********          PARM C#DTA     O#DTA 256                       121483
      *                                                                   121483
     C************IN90     IFEQ '1'                                       121483
     C***********R#RTN     ORNE *BLANKS                                   121483
     C***********          MOVEL'*CALL   'W0FILE                          121483
     C***********          MOVEL'AOSPOSU0'W0KEY                           121483
     C***********          Z-ADD901       W0ERNB                          121483
     C***********          EXSR SRERR                                     121483
     C***********          END                                            121483
     C***********          MOVE '*CLEAR  'D#ACT                    121483 141213
     C***********          EXSR CHKACT                             121483 141213
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRERR    : Report error and close down program               *
      *                                                               *
      *  CALLED BY: Various                                           *
      *  CALLS    : *NONE                                             *
      *                                                               *
      *****************************************************************
     C           SRERR     BEGSR
      *
      *  Dump program
      *
     C           O#RTN     IFEQ '*RECLCK'                                                     231306
     C           R#RTN     OREQ '*RECLCK'                                                     231306
     C                     ROLBK                                                              231306
     C                     SETON                     LR                                       231306
     C                     MOVEL'*RECLCK' ##RTCD                                              231306
     C                     ELSE                                                               231306
     C                     DUMP
     C           CSC022    IFNE 'Y'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFNE 'Y'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      *  Close down program
      *
     C                     SETON                     LR
     C                     MOVEL'*ERROR*' ##RTCD
      *                                                                                       231306
     C                     ENDIF                                                              231306
      *                                                                                       231306
     C                     RETRN
      *
     C           EXERR     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     MOVEL'P'       ##PAY
     C                     MOVEL'R'       ##REC
     C                     MOVEL*BLANKS   R#RTN   7
      *
      **  Copyright
     C                     MOVEA##CPY     ##BIS  80
      *
      *................................................................
      *
      ** Access the Bank Details                                                              CAP205
      *                                                                                       CAP205
     C                     CALL 'AOBANKR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*FIRST ' @OPTN                                               CAP205
     C           SDBANK    PARM SDBANK    DSFDY                                               CAP205
     C           @RTCD     IFNE *BLANKS                                                       CAP205
     C                     MOVEL'SDBANKPD'W0FILE                                              CAP205
     C                     MOVEL'*FIRST'  W0KEY                                               CAP205
     C                     Z-ADD7         W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   CEU003
      ** Check if CEU003 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *                                                                                       CSC022
      ** Check if CSC022 is switched *ON.                                                     CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD                                               CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL*BLANKS   CMTSKP  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CAP205
      ** Check if CAP205 is switched *ON.                                                     CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205                                              CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205  1                                           CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE '*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD6         W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
      ** Check if CDL099 is switched *ON.                                                     CDL099
     C                     MOVE 'N'       CDL099                                              CDL099
     C                     CALL 'AOSARDR0'                                                    CDL099
     C                     PARM *BLANKS   @RTCD                                               CDL099
     C                     PARM '*VERIFY' @OPTN                                               CDL099
     C                     PARM 'CDL099'  @SARD                                               CDL099
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL099
      *                                                                                       CDL099
     C           @RTCD     IFEQ *BLANKS                                                       CDL099
     C                     MOVE 'Y'       CDL099  1                                           CDL099
     C                     ELSE                                                               CDL099
     C           @RTCD     IFNE '*NRF   '                                                     CDL099
     C                     MOVEL'SCSARDPD'W0FILE                                              CDL099
     C                     MOVEL'CDL099'  W0KEY                                               CDL099
     C                     Z-ADD7         W0ERNB                                              CDL099
     C                     EXSR SRERR                                                         CDL099
     C                     ENDIF                                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
      * Check system values                                                                   241166
     C                     CALL 'AOSVALR0'                                                    241166
     C                     PARM *BLANKS   @RTCD                                               241166
     C                     PARM SVALKK    SVALK1 20                                           241166
     C                     PARM           SVAL1 200                                           241166
     C                     PARM *BLANK    SVALK2 20                                           241166
     C                     PARM           SVAL2 200                                           241166
     C                     PARM *BLANK    SVALK3 20                                           241166
     C                     PARM           SVAL3 200                                           241166
     C                     PARM *BLANK    SVALK4 20                                           241166
     C                     PARM           SVAL4 200                                           241166
     C                     PARM *BLANK    SVALK5 20                                           241166
     C                     PARM           SVAL5 200                                           241166
     C                     PARM *BLANK    SVALK6 20                                           241166
     C                     PARM           SVAL6 200                                           241166
     C                     PARM *BLANK    SVALK7 20                                           241166
     C                     PARM           SVAL7 200                                           241166
     C                     PARM *BLANK    SVALK8 20                                           241166
     C                     PARM           SVAL8 200                                           241166
     C                     PARM *BLANK    SVALK9 20                                           241166
     C                     PARM           SVAL9 200                                           241166
     C                     PARM *BLANK    SVALK0 20                                           241166
     C                     PARM           SVAL10200                                           241166
      *                                                                                       241166
     C           @RTCD     IFNE *BLANK                                                        241166
     C                     MOVEL'SDSVALPD'W0FILE                                              241166
     C                     MOVEL'*KEY '   W0KEY                                               241166
     C                     Z-ADD6         W0ERNB                                              241166
     C                     EXSR SRERR                                                         241166
     C                     ENDIF                                                              241166
     C                     MOVE SVAL11    TRSNAR  1                                           241166
     C/COPY WNCPYSRC,AOH00042
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C/COPY WNCPYSRC,AOOUFXU0C2
      *
     C                     ENDSR
      *****************************************************************   121483
      * Subroutine  :  CHKACT                                         *   121483
      * Function    :  To check for live account before calling       *   121483
      *                AOSPOSU0                                       *   121483
      *                                                               *   121483
      * Called by   :  Various subroutines                            *   121483
      * Calls       :  None                                           *   121483
      *****************************************************************   121483
     C           CHKACT    BEGSR                                          121483
     C           C#ATYP    IFEQ 'N'                                       121483
     C           C#ATYP    OREQ 'F'                                       121483
     C                     CALL 'AONOSTR0'                                121483
     C                     PARM '*DBERR  '@RTCD   7                       121483
     C                     PARM '*KEY    '@OPTN   7                       121483
     C                     PARM *BLANKS   @KEYA   6                       121483
     C                     PARM C#CCY     @KEYB   3                       121483
     C**********           PARM *BLANKS   @KEYC   4                                    121483 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       121483
     C                     PARM ##NOSN    @KEYE   2                       121483
     C                     PARM *BLANKS   @KEYF   3                       121483
     C                     PARM *BLANKS   @KEYG  10                       121483
     C                     PARM *BLANKS   @KEYH   1                       121483
     C           SDNOST    PARM SDNOST    DSFDY                           121483
     C*                                                                   121483
     C** Move accounts detail                                             121483
     C*                                                                   121483
     C                     MOVE A7CYCD    D#CCY   3                       121483
     C**********           MOVE A7ACCD    D#ACOD  4                                    121483 CGL029
     C                     MOVE A7ACCD    D#ACOD 10                                           CGL029
     C                     MOVE A7CUST    D#CNUM  6                       121483
     C                     MOVE A7ACSN    D#ACSQ                          121483
     C                     MOVE A7BRCD    D#BRCA  3                       121483
     C                     ENDIF                                          121483
     C*                                                                   121483
     C           C#ATYP    IFEQ 'R'                                       121483
     C                     MOVE C#ACNO    D#RTL  10                       121483
     C                     MOVE *BLANKS   D#CCY                           121483
     C                     MOVE *BLANKS   D#ACOD                          121483
     C                     MOVE *BLANKS   D#CNUM                          121483
     C                     MOVE *BLANKS   D#ACSQ                          121483
     C                     MOVE *BLANKS   D#BRCA                          121483
     C                     ENDIF                                          121483
      *                                                                   121483
     C           C#ATYP    IFNE 'N'                                       121483
     C           C#ATYP    ANDNE'F'                                       121483
     C           C#ATYP    ANDNE'R'                                       121483
     C                     MOVE *BLANKS   D#RTL                           121483
     C                     MOVE C#CCY     D#CCY                           121483
     C                     MOVE ##ACOD    D#ACOD                          121483
     C                     MOVE ##CNUM    D#CNUM                          121483
     C                     MOVE ##ACSQ    D#ACSQ                          121483
     C                     MOVE ##BRCA    D#BRCA                          121483
     C                     ENDIF                                          121483
     C*                                                                   121483
     C** Calls AOACCTR0 to check for live account                         121483
     C*                                                                   121483
     C                     MOVE *BLANKS   NRECI                           121483
     C                     CALL 'AOACCTR0'                                121483
     C                     PARM *BLANKS   @RTCD   7                       121483
     C                     PARM '*KEY   ' @OPTN   7                       121483
     C                     PARM D#RTL     @RETL  10                       121483
     C                     PARM D#CNUM    @CNUM   6                       121483
     C                     PARM D#CCY     @CYCD   3                       121483
     C**********           PARM D#ACOD    @ACCD   4                                    121483 CGL029
     C                     PARM D#ACOD    @ACCD  10                                           CGL029
     C                     PARM D#ACSQ    @ACSN   2                       121483
     C                     PARM D#BRCA    @DSNB   3                       121483
     C           SDACNT    PARM SDACNT    DSSDY                           121483
     C***********                                                  121483 141213
     C***Calls*AOSPOSU0*if*account*is*live.*********************** 121483 141213
     C***********                                                  121483 141213
     C***********NRECI     IFEQ 'D'                                121483 141213
     C***********C#ATYP    OREQ 'X'                                121483 141213
     C***********@RTCD     IFNE '*KEY   '                          121483 141213
     C***********          CALL 'AOSPOSU0'             9090        121483 141213
     C***********R#RTN     PARM *BLANKS   O#RTN   7                121483 141213
     C***********          PARM D#ACT     W0ACT   8                121483 141213
     C***********          PARM C#DTA     O#DTA 256                121483 141213
     C***********          END                                     121483 141213
      ***********                                                  121483 141213
     C************IN90     IFEQ '1'                                121483 141213
     C***********R#RTN     ORNE *BLANKS                            121483 141213
     C***********          MOVEL'*CALL   'W0FILE  8                121483 141213
     C***********          MOVEL'AOSPOSU0'W0KEY  29                121483 141213
     C***********          Z-ADD903       W0ERNB  30               121483 141213
     C***********          EXSR SRERR                              121483 141213
     C***********          END                                     121483 141213
     C***********          ENDIF                                   121483 141213
     C                     ENDSR                                          121483
      *****************************************************************
     C/SPACE 5
     C/COPY ZSRSRC,ZDAT10Z2
** ##NAR  **      NARRATIVES
BUY CCY
SELL CCY
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
