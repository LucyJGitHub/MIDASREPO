     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AO On-line updt of LE posns (loan amendment)')   *
/*OVRF*: OVRDBF AOLOAN   CLOAN                                      : *   CLE033
      *****************************************************************
      *                                                               *
      *  Midas - Access Objects Module                                *
      *                                                               *
      *    AOOULAU0 - On-line Update of LE Positions (LOAN AMENDMENTS)*
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *      
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD040030           Date 13Sep16               *
      *                 AR943686           Date 23Sep16               *
      *                 MD023787           Date 29Apr14               *
      *                 AR868380           Date 10Jun13               *
      *                 AR691432           Date 20Oct12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             DATE 23Jul12               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247544             Date 16May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 05May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8962            Date 17Oct05               *
      *                 BUG8924            Date 26Sep05               *
      *                 BUG8333            Date 29Aug05               *
      *                 CLE106             Date 01Aug04               *
      *                 227696             Date 03Jun04               *
      *                 CLE038             Date 11May04               *
      *                 226542             Date 21Apr04               *
      *                 CIR013             Date 25Apr05               *
      *                 BUG5323            Date 20Jan05               *
      *                 BUG4577            Date 30Nov04               *
      *                 BUG3056            Date 06Jul04               *
      *                 CRE020             Date 20Jan04               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 30Oct03               *
      *                 CAP079             Date 08Aug02               *
      *                 CAP075             Date 08Aug02               *
      *                 220257             Date 31Jul03               *
      *                 219608             Date 16Jul03               *
      *                 218782             Date 23Jun03               *
      *                 CLE034             Date 22May03               *
      *                 CLE033             Date 26Mar03               *
      *                 CLE031             Date 05Feb03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 193676             Date 11Jul01               *
      *                 182370             Date 05Jun01               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 175450             Date 09Mar00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 148591             Date 03Mar99               *
      *                 CEU004             Date 02Feb98               *
     F*                 122960             Date 15Sep97               *  *
     F*                 122601             Date 04Sep97               *  *
     F*                  082738             DATE  20JUN96                *
     F*                                                                  *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data   *
      *  MD046248 - Finastra Rebranding                               *      
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD040030 - Addition to MD-23787. Put '*' on the narrative    *
      *             of auto-generated DR/CR manual repayment posting. *
      *  AR943686 - CLE031. System generating wrong projected move-   *
      *             ments. Populate settlement details field with     *
      *             passed value. (Child: AR943687)                   *
      *           - Applied for MD-40690                              *
      *  MD023787 - Posting for PDCL's PI and MR.                     *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR691432 - Repayment Schedule with auto-settle ='N' created  *
      *             a projected account movement. If transaction is   *
      *             non-autosettle, do not generate projected account *
      *             movement. Apply GEMS fix 254077 (Child: AR691433) *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER049 - Stamp Tax                                           *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8962- Wrong postings for Allocations by Amount that use   *
      *           Settlement currencies. Extra 'difference' posting   *
      *           is only required for Allocations by Percentage.     *
      *  BUG8924- Incorrect postings for Settlement Allocation when   *
      *           amount is used. Use very long Dummy DS.             *
      *  BUG8333- Shadow postings not generated for repayment type 3  *
      *  CLE106 - Syndications Manager.                               *
      *  227696 - Need to reset the saved pay and receive settlement  *
      *           currencies to blank if using settlement allocations *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  226542 - If the event amount is negative, need to swap the   *
      *           pay and receive settlement instructions on          *
      *           LEHOSTPD as well as the pay/receive indicator       *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZDLINT and ZCBDYS.                   *
      *  BUG5323 - Account code truncated in RSACMTPD for 'MR' and    *
      *            'PI'. Reversed out fixes BUG4577 and BUG3056 codes.*
      *  BUG4577 - CLBLN not updated in memos upon complete.          *
      *  BUG3056 - Properly setup parameters in calling AOSPOSU0 to   *
      *            update RSACMTPD. Same fix as BUG3055.             *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Correct parameters on program calls                 *
      *  CAP079 - Lending API enhancements - Repayments schedule.     *
      *  CAP075 - Lending API enhancements - Loan Amendment.          *
      *           (amendment in common with CAP079)                   *
      *  220257 - Negative amounts should be converted to positive on *
      *           LEHOSTPD and the Pay/Receive indicator changed      *
      *  219608 - Amendment of Settlement Allocations needs a 'Before'*
      *           image to ensure the right allocations are reversed. *
      *  218782 - Add Program ref, Sequence Number & Status fields to *
      *           LEHOSTPD. Check system value Settlement09Postings to*
      *           decide whether to use Settlement or Transaction Ccy.*
      *  CLE034 - Lending Enhancements for Phase 1 Priority 1A.       *
      *           - Set up exchange rate from settlement alln         *
      *  CLE033 - Settlement method 09                                *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  193676 - Projected Nostros are not updated for a part sold   *
      *           manual repayment.                                   *
      *  182370 - Incorrect calculation of number of days for calcu-  *
      *           lation basis 6. Amended /COPY such that for calcu-  *
      *           lation basis 6, the number of days per year is      *
      *           equal to 366 when the year in question is a leap    *
      *           year, and 365 days/year for non-leap years. Calcu-  *
      *           lation was made so that processing would be in-line *
      *           with that of /COPY ZINTDY.                          *
      *  175450 - Shadow postings for Manual Repayments for Risk loan *
      *           should only include interest payment.               *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to ZCBDYS changes                    *
      * 148591 - Shadow postings for Manual Repayments do not include
      *          interest and penalties.
     F*  CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0    *
     F* 122960 - Do not rollback lending updates in batch mode.          *
     F* 122601 - Schedule repayment did not update retail projected      *
     F*          movement.                                               *
     F* 082738 - New program for redesign of update to PRONO, MEMOS,     *
     F*          OLPOS & RSACMTPD.                                       *
     F*                                                                  *
     F********************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*****************************************************************
     FLEHOSTPDO   E                    DISK                               CLE033
     F                                              KCOMIT                CLE033
     FAOLOAN  IF  E           K        DISK                           UC  CLE033
     F            CLOANHHF                          KIGNORE               CLE033
     F            CLOANZ1F                          KIGNORE               CLE033
     FCLONCLL1IF  E           K        DISK                                                   CER049
     F/COPY WNCPYSRC,AOOULAU0F1
     E/SPACE 5
     E*
     E**  Loan processing types
     E********************##LDT   2   2  2 0                              CLE034
     E                    ##LDT   4   4  2 0                              CLE034
     E*
     E**  (Posting) Naratives
     E                    ##NAR   1   4 30
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E                    ZF29   14  32  5 0             29TH FEB ARRAY
     E*
     E*  Subroutine stack
     E                    @STK       20 10
     E/COPY WNCPYSRC,AOH00043
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY ZSRSRC,ZPOWERZ1                                                                   CLE031
      *                                                                   CLE033
     E**  System values array                                             CLE033
     E**********          SVAL    1   3 20                                             CLE033 218782
     E                    SVAL    1   4 20                                                    218782
      *                                                                   CLE033
     E*  Array of QCMDEXC command to edit                                 CLE033
     E                    #CMD    1   1 80                                CLE033
     E                    #CM        80  1                                CLE033
     E*  Amendment types                                                  CLE033
     E                    #AM     1   5 20                                CLE033
      ** Array of Commitment Job Names                                                        CSC022
     E                    CMTJOB     10 10                                                    CSC022
      *                                                                   CLE033
     ICLOANCLF                                                            CLE033
      ** Rename loan master file details                                  CLE033
     I              RECI                            RECIX                 CLE033
     I              LNRF                            LNRFX                 CLE033
     I              RCDT                            RCDTX                 CLE033
     I              MRIN                            MRINX                 CLE033
     I              PTYP                            PTYPX                 CLE033
     I              CNUM                            CNUMX                 CLE033
     I              BRCA                            BRCAX                 CLE033
     I              LTYP                            LTYPX                 CLE033
     I              SUTP                            SUTPX                 CLE033
     I              DDAT                            DDATX                 CLE033
     I              VDAT                            VDATX                 CLE033
     I              MDAT                            MDATX                 CLE033
     I              LASQ                            LASQX                 CLE033
     I              FCUS                            FCUSX                 CLE033
     I              FTYP                            FTYPX                 CLE033
     I              FSEQ                            FSEQX                 CLE033
     I              CCY                             CCYX                  CLE033
     I              CPAM                            CPAMX                 CLE033
     I              INTC                            INTCX                 CLE033
     I              INTR                            INTRX                 CLE033
     I              BRTT                            BRTTX                 CLE033
     I              BRTE                            BRTEX                 CLE033
     I              RTSP                            RTSPX                 CLE033
     I              MARG                            MARGX                 CLE033
     I              SPIN                            SPINX                 CLE033
     I              CHIN                            CHINX                 CLE033
     I              WTRT                            WTRTX                 CLE033
     I              WTIN                            WTINX                 CLE033
     I              REPT                            REPTX                 CLE033
     I              RAMT                            RAMTX                 CLE033
     I              NRPD                            NRPDX                 CLE033
     I              RFRQ                            RFRQX                 CLE033
     I              RDYN                            RDYNX                 CLE033
     I              FCCY                            FCCYX                 CLE033
     I              LIND                            LINDX                 CLE033
     I              CRSK                            CRSKX                 CLE033
     I              ACOF                            ACOFX                 CLE033
     I              NACD                            NACDX                 CLE033
     I              RELI                            RELIX                 CLE033
     I              AUTO                            AUTOX                 CLE033
     I              PSAM                            PSAMX                 CLE033
     I              BCXR                            BCXRX                 CLE033
     I              FCXR                            FCXRX                 CLE033
     I              SDST                            SDSTX                 CLE033
     I              OSDA                            OSDAX                 CLE033
     I              TSTN                            TSTNX                 CLE033
     I              MDST                            MDSTX                 CLE033
     I              OMDA                            OMDAX                 CLE033
     I              TMAN                            TMANX                 CLE033
     I              FACO                            FACOX                 CLE033
     I              RLDT                            RLDTX                 CLE033
     I              NROD                            NRODX                 CLE033
     I              RLFQ                            RLFQX                 CLE033
     I              RLDY                            RLDYX                 CLE033
     I              RDFC                            RDFCX                 CLE033
     I              NBRA                            NBRAX                 CLE033
     I              NRTS                            NRTSX                 CLE033
     I              NSIN                            NSINX                 CLE033
     I              NCAS                            NCASX                 CLE033
     I              AWTP                            AWTPX                 CLE033
     I              WTRD                            WTRDX                 CLE033
     I              WTWD                            WTWDX                 CLE033
     I              IWOD                            IWODX                 CLE033
     I              PWOD                            PWODX                 CLE033
     I              BMDI                            BMDIX                 CLE033
     I              FMDI                            FMDIX                 CLE033
     I              PDIN                            PDINX                 CLE033
     I              LSWC                            LSWCX                 CLE033
     I              LSWS                            LSWSX                 CLE033
     I              OSDB                            OSDBX                 CLE033
     I              OMDB                            OMDBX                 CLE033
     I              ORBR                            ORBRX                 CLE033
     I              PRFC                            PRFCX                 CLE033
     I              FCLB                            FCLBX                 CLE033
     I              MLNR                            MLNRX                 CLE033
     I              BTIN                            BTINX                 CLE033
     I              BLDY                            BLDYX                 CLE033
     I              OLNO                            OLNOX                 CLE033
     I              RCSI                            RCSIX                 CLE033
     I              ICBS                            ICBSX                 CLE033
     I              IPFR                            IPFRX                 CLE033
     I              TOTI                            TOTIX                 CLE033
     I              NIDT                            NIDTX                 CLE033
     I              IBDT                            IBDTX                 CLE033
     I              SLID                            SLIDX                 CLE033
     I              AIPD                            AIPDX                 CLE033
     I              DLRC                            DLRCX                 CLE033
     I              IACD                            IACDX                 CLE033
     I              AITC                            AITCX                 CLE033
     I              TFEP                            TFEPX                 CLE033
     I              AIAP                            AIAPX                 CLE033
     I              IPRD                            IPRDX                 CLE033
     I              IPRM                            IPRMX                 CLE033
     I              ICTD                            ICTDX                 CLE033
     I              AIMN                            AIMNX                 CLE033
     I              RBDT                            RBDTX                 CLE033
     I              NOPS                            NOPSX                 CLE033
     I              IFDY                            IFDYX                 CLE033
     I              LONI                            LONIX                 CLE033
     I              CNFI                            CNFIX                 CLE033
     I              ACEI                            ACEIX                 CLE033
     I              TLXI                            TLXIX                 CLE033
     I              CBLI                            CBLIX                 CLE033
     I              ORED                            OREDX                 CLE033
     I              LCD                             LCDX                  CLE033
     I              CHTP                            CHTPX                 CLE033
     I              TNLU                            TNLUX                 CLE033
     I              ADDI                            ADDIX                 CLE033
     I              ORMD                            ORMDX                 CLE033
     I              ORTI                            ORTIX                 CLE033
     I              BOKC                            BOKCX                 CLE033
     I              COCU                            COCUX                 CLE033
     I              RECE                            RECEX                 CLE033
     I              OMDT                            OMDTX                 CLE033
     I              NIPD                            NIPDX                 CLE033
     I              NMDT                            NMDTX                 CLE033
     I              APMI                            APMIX                 CLE033
     I              RSTM                            RSTMX                 CLE033
     I              RONS                            RONSX                 CLE033
     I              RIBN                            RIBNX                 CLE033
     I              RIBA                            RIBAX                 CLE033
     I              ROBN                            ROBNX                 CLE033
     I              ROCN                            ROCNX                 CLE033
     I              PSTM                            PSTMX                 CLE033
     I              PONS                            PONSX                 CLE033
     I              PIBN                            PIBNX                 CLE033
     I              PIBA                            PIBAX                 CLE033
     I              POBN                            POBNX                 CLE033
     I              POCN                            POCNX                 CLE033
     I              RCRN                            RCRNX                 CLE033
     I              RCRA                            RCRAX                 CLE033
     I              RVNO                            RVNOX                 CLE033
     I              AWBN                            AWBNX                 CLE033
     I              AWBA                            AWBAX                 CLE033
     I              BENN                            BENNX                 CLE033
     I              BENA                            BENAX                 CLE033
     I              DTP1                            DTP1X                 CLE033
     I              DTP2                            DTP2X                 CLE033
     I              DTP3                            DTP3X                 CLE033
     I              DTP4                            DTP4X                 CLE033
     I              DCHG                            DCHGX                 CLE033
     I              BTB1                            BTB1X                 CLE033
     I              BTB2                            BTB2X                 CLE033
     I              BTB3                            BTB3X                 CLE033
     I              BTB4                            BTB4X                 CLE033
     I              BTB5                            BTB5X                 CLE033
     I              BTB6                            BTB6X                 CLE033
     I              CVMR                            CVMRX                 CLE033
     I              PTFR                            PTFRX                 CLE033
     I              HLEX                            HLEXX                 CLE033
     I              FSRP                            FSRPX                 CLE033
     I              FSGN                            FSGNX                 CLE033
     I              FPRC                            FPRCX                 CLE033
     I              TCOF                            TCOFX                 CLE033
     I              ACPD                            ACPDX                 CLE033
     I              ACDA                            ACDAX                 CLE033
     I              ACAJ                            ACAJX                 CLE033
     I              ACAP                            ACAPX                 CLE033
     I              COFD                            COFDX                 CLE033
     I              COFM                            COFMX                 CLE033
     I              CFCD                            CFCDX                 CLE033
     I              NFRS                            NFRSX                 CLE033
     I              NFSN                            NFSNX                 CLE033
     I              NFPC                            NFPCX                 CLE033
     I              PDCF                            PDCFX                 CLE033
     I              FCTD                            FCTDX                 CLE033
     I              FWOD                            FWODX                 CLE033
     I              DFTP                            DFTPX                 CLE033
     I              DFST                            DFSTX                 CLE033
     I              MCRA                            MCRAX                 CLE033
     I              FCRA                            FCRAX                 CLE033
     I              PDDI                            PDDIX                 CLE033
     I              PTDI                            PTDIX                 CLE033
     I              GDPR                            GDPRX                 CLE033
     I              GDIN                            GDINX                 CLE033
     I              LNKS                            LNKSX                 CLE033
     I              MNSG                            MNSGX                 CLE033
     I              GASS                            GASSX                 CLE033
     I              GPRT                            GPRTX                 CLE033
     I              TOLN                            TOLNX                 CLE033
     I              LSTS                            LSTSX                 CLE033
     I              IUSR                            IUSRX                 CLE033
     I              AUSR                            AUSRX                 CLE033
     I              XUSR                            XUSRX                 CLE033
     I              RATF                            RATFX                 CLE033
     I              CNCF                            CNCFX                 CLE033
     I              PCRF                            PCRFX                 CLE033
     I              LPFI                            LPFIX                 CLE033
     I              PTFC                            PTFCX                 CLE033
     I              PTFT                            PTFTX                 CLE033
     I              PTFN                            PTFNX                 CLE033
     I              PCOB                            PCOBX                 CLE033
     I              LRLD                            LRLDX                 CLE033
     I              LMCD                            LMCDX                 CLE033
     I              SCCY                            SCCYX                 CLE033
     I              ICCY                            ICCYX                 CLE033
     I              OINR                            OINRX                 CLE033
     I              OIDT                            OIDTX                 CLE033
     I              REPI                            REPIX                 CLE033
     I              RFDY                            RFDYX                 CLE033
     I              RFRI                            RFRIX                 CLE033
     I              RFRT                            RFRTX                 CLE033
     I              RFAR                            RFARX                 CLE033
     I              REXR                            REXRX                 CLE033
     I              REXI                            REXIX                 CLE033
     I              PSCY                            PSCYX                 CLE033
     I              PEXR                            PEXRX                 CLE033
     I              PEXI                            PEXIX                 CLE033
     I              STAL                            STALX                                     CLE034
     I              BASR                            BASRX                                     CLE106
     I              NBSR                            NBSRX                                     CLE106
     I              SLTP                            SLTPX                                     CLE106
     I              SLST                            SLSTX                                     CLE106
     I              CLAS                            CLASX                                     CLE042
     I              DFCL                            DFCLX                                     CLE042
     I              SLCL                            SLCLX                                     CLE042
      *                                                                   CLE033
     ICLOANCKF                                                            CLE033
     I              TNLU                            TNLUY                 CLE033
      *                                                                                       CLE031
     IDSSDY     E DSDSSDY                                                                     CLE031
      ** Second DS for access programs, long data structure                                   CLE031
      *                                                                                       CLE031
     IDSLDY     E DSDSLDY                                                                    BUG8924
      ** Second DS for access programs, very long data structure                             BUG8924
      *                                                                                      BUG8924
     I/SPACE 5
     I*                                                                   CLE033
     I*SDSVAL***E*DSSDSVALPD*                                                          CLE033 222373
      ****EXTERNAL*DS*FOR*SYSTEM*VALUES*                                               CLE033 222373
     I**********                                                                       CLE033 222373
     ISDBANK    E DSSDBANKPD                                              CLE033
      **  EXTERNAL DS FOR BANK DETAILS                                    CLE033
     I*
     IZ#BSTS    E DSZ#BST
     I                                       82  820WREPTB                                   BUG8333
     I                                       87 104 WOSACB                                   BUG5323
     I                                      105 114 WTSENB                                   BUG5323
     I                                      115 124 WFACOB                                   BUG5323
      *                                                                                       CLE134
     I                                     17931795 WXRFIB                                    CLE134
     I                                     179618050WXRFNB                                    CLE134
      *                                                                                       CLE134
     IZ#ASTS    E DSZ#AST
     I                                       82  820WREPTA                                   BUG8333
     I                                       87 104 WOSACA                                   BUG5323
     I                                      105 114 WTSENA                                   BUG5323
     I                                      115 124 WFACOA                                   BUG5323
      *                                                                                       CLE134
     I                                     17931795 WXRFIA                                    CLE134
     I                                     179618050WXRFNA                                    CLE134
      *                                                                                       CLE134
     I            DS                                                                          CLE134
     I                                        1   3 XRFI                                      CLE134
     I                                        4  130XRFN                                      CLE134
      *                                                                                       CLE134
     IZ#WSTS    E DSZ#WST
     ILOAMDK    E DSLOAMSDK
     I/COPY WNCPYSRC,AOH00044
     I*SVLOAN******DS***************************1088                                   CLE034 CLE106
     ISVLOAN      DS                           1278                                           CLE106
     ILESTAL    E DSLESTALPD                                              CLE034
     I              RECI                            LSRECI                CLE034
     I              TYPE                            LSTYPE                CLE034
     I              TMST                            LSTMST                CLE034
     I              PCRF                            LSPCRF                CLE034
     I              LNRF                            LSLNRF                CLE034
     I              VDAT                            LSVDAT                CLE034
     I              LASQ                            LSLASQ                CLE034
     I              CNUM                            LSCNUM                CLE034
     I              FACL                            LSFACL                CLE034
     I              FESQ                            LSFESQ                CLE034
     I              SEQ                             LSSEQ                 CLE034
     I              RCPC                            LSRCPC                CLE034
     I              RSTM                            LSRSTM                CLE034
     I              RONS                            LSRONS                CLE034
     I              RONSQQ                          QQRONS                                    CGL029
     I              RIBN                            LSRIBN                CLE034
     I              RIBA                            LSRIBA                CLE034
     I              ROBN                            LSROBN                CLE034
     I              ROCN                            LSROCN                CLE034
     I              ROBR                            LSROBR                CLE034
     I              RSCY                            LSRSCY                CLE034
     I              REXR                            LSREXR                CLE034
     I              REXI                            LSREXI                CLE034
     I              PYPC                            LSPYPC                CLE034
     I              PSTM                            LSPSTM                CLE034
     I              PONS                            LSPONS                CLE034
     I              PONSQQ                          QQPONS                                    CGL029
     I              PIBN                            LSPIBN                CLE034
     I              PIBA                            LSPIBA                CLE034
     I              POBN                            LSPOBN                CLE034
     I              POCN                            LSPOCN                CLE034
     I              RCRN                            LSRCRN                CLE034
     I              RCRA                            LSRCRA                CLE034
     I              RVNO                            LSRVNO                CLE034
     I              AWBN                            LSAWBN                CLE034
     I              AWBA                            LSAWBA                CLE034
     I              BENN                            LSBENN                CLE034
     I              BENA                            LSBENA                CLE034
     I              DTP1                            LSDTP1                CLE034
     I              DTP2                            LSDTP2                CLE034
     I              DTP3                            LSDTP3                CLE034
     I              DTP4                            LSDTP4                CLE034
     I              DCHG                            LSDCHG                CLE034
     I              BTB1                            LSBTB1                CLE034
     I              BTB2                            LSBTB2                CLE034
     I              BTB3                            LSBTB3                CLE034
     I              BTB4                            LSBTB4                CLE034
     I              BTB5                            LSBTB5                CLE034
     I              BTB6                            LSBTB6                CLE034
     I              POBR                            LSPOBR                CLE034
     I              CVMR                            LSCVMR                CLE034
     I              PSCY                            LSPSCY                CLE034
     I              IC72                            LSIC72                CLE034
     I              PEXR                            LSPEXR                CLE034
     I              PEXI                            LSPEXI                CLE034
     I              PTRF                            LSPTRF                CLE034
     I              PYBA                            LSPYBA                                    CLE038
     I              PYAM                            LSPYAM                                    CLE038
     I              RCBA                            LSRCBA                                    CLE038
     I              RCAM                            LSRCAM                                    CLE038
     I              CCY                             LSCCY                                     CLE038
      *                                                                   CLE034
     I*
     I##PAYD      DS
     I                                        1   1 ##PAY
     I                                        2   3 ##PAYM
     I**********                              4  15 ##PAYA                                    CGL029
     I**********                             16  18 ##PAYB                                    CGL029
     I                                        4  21 ##PAYA                                    CGL029
     I                                       22  24 ##PAYB                                    CGL029
     I##RECD      DS
     I                                        1   1 ##REC
     I                                        2   3 ##RECM
     I**********                              4  15 ##RECA                                    CGL029
     I**********                             16  18 ##RECB                                    CGL029
     I                                        4  21 ##RECA                                    CGL029
     I                                       22  24 ##RECB                                    CGL029
     I##INTS      DS
     I                                        1   1 ##INPR
     I                                        2   3 ##INTM
     I**********                              4  15 ##INTA                                    CGL029
     I**********                             16  18 ##INTB                                    CGL029
     I                                        4  21 ##INTA                                    CGL029
     I                                       22  24 ##INTB                                    CGL029
     I##SETD      DS
      * pay/receive (P/R)
     I                                        1   1 ##PYRC
      * settlement method
     I                                        2   3 ##SETM
      * settlement account
     I**********                              4  15 ##SETA                                    CGL029
     I                                        4  21 ##SETA                                    CGL029
     I                                        4   5 ##NOSN
     I                                        4  13 ##ACNO
     I                                        4   9 ##CNUM
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      * settlement branch
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     IC#DTA       DS                            256
      *  Account type N=nostro nbr F=Full nostro G=General Ledger
      *               P=Partial Ledger R= Retail Number  X= no settlement
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I                                        2  19 C#ACCT
     I**********                              2   70C#CNU1                                    CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1
     I**********                             11  140C#ACO1                                    CGL029
     I                                       15  160C#ACS1
     I                                       17  19 C#BRC1
      *               Nostro number
     I                                        2   30C#NOSN
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               Partial Account - CNUM/ACOD/ACSQ
     I**********                              2   70C#CNUM                                    CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                                    CGL029
     I                                       12  130C#ACSQ
      *               Branch of account if Partial
     I                                       14  16 C#BRCA
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
      *                     ' ' no OLPOS update
     I                                       24  24 C#IO
      *               Currency of transaction
     I                                       25  27 C#CCY
      *               Transaction Type
     I                                       28  29 C#TRYP
      *               Transaction Narrative
     I                                       30  59 C#NARR
      *               Cheque Number
     I                                       60  670C#CHQN
      *               FT transaction reference
     I                                       68  82 C#PREF
      *               DL/LE/GL/RE transaction reference
     I                                       83  88 C#TRN
      *               Movement amount
     I                                    P  89  960C#AMT
      *               Processing indicators Not blank = no update
      *                                     ' ' = Update
      *               Prono update indicator
     I                                       97  97 C#PRON
      *               Olpos update indicator
     I                                       98  98 C#OLPS
      *               Memos update indicator
     I                                       99  99 C#MEMS
      *               Rsacmtpd write indicator
     I                                      100 100 C#RSAC
      *               Module
     I                                      101 102 C#MOD
      *               Olpos record number to update
      *                     '02' for Interest movements
      *                     '03' for loans
     I                                      103 104 C#OLRC
      *               FT Memos ledger balance override
      *                        'Y' update ledger balance irrespective of
      *                        posting date
     I                                      105 105 C#FTOV
      *               Value date and posting date
     I                                    P 106 1080C#VDAT
     I                                    P 109 1110C#PSTD
      *               Override posting date correction
      *                        for forward valued items
      *                        'Y' prevents date being changed
     I                                      112 112 C#PSTO
      *               Indicator to show if removal allowed Y, N or " "
     I                                      113 113 C#RPST
      *               Removal set number
     I                                      114 1160C#RPNB
      *               Removal type "C" = Credit entries
      *                            "D" = Debit entries
     I                                      117 117 C#RTYP
      *               Booking branch
     I                                      118 120 C#BBRN
      *                                                                                       CGL029
      ** Account code for full general ledger                                                 CGL029
      *                                                                                       CGL029
     I                                      121 1300C#ACO1                                    CGL029
      *                                                                                       CGL029
      ** Account code for partial account                                                     CGL029
      *                                                                                       CGL029
     I                                      131 1400C#ACOD                                    CGL029
      *                                                                                       CAP204
      ** Other Transaction Reference                                                          CAP204
      *                                                                                       CAP204
     I                                      141 160 C#OTR1                                    CAP204
      *                                                                                       CAP205
      ** Movement type                                                                        CAP205
      *                                                                                       CAP205
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
     I/COPY WNCPYSRC,AOH00004
      *
     I            DS
     I* Value date and sequence number read from LOAMSDK
     I                                        1   80@@VDSN
     I                                        1   50@@VYMD
     I                                        6   80@@DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to omit
     I                                        1   80$$VDSN
     I                                        1   50$$VYMD
     I                                        6   80$$DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to be read to
     I                                        1   80##VDSN
     I                                        1   50##VYMD
     I                                        6   80##DS38
      *                                                                   182370
      ** Data structure for subroutine ZCBDYS                             182370
     I            DS                                                      182370
     I                                        1   80ZZDAT1                182370
     I                                        1   40ZZYYA                 182370
     I                                        5   60ZZMMA                 182370
     I                                        7   80ZZDDA                 182370
      *                                                                   182370
     I            DS                                                      182370
     I                                        1   80ZZDAT2                182370
     I                                        1   40ZZYYB                 182370
     I                                        5   60ZZMMB                 182370
     I                                        7   80ZZDDB                 182370
      *                                                                   182370
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
     I/COPY WNCPYSRC,AOOULAU0I1
      *                                                                   CEU004
      *** SAR Details                                                     CEU004
      *                                                                   CEU004
     ISCSARD    E DSSCSARDPD                                              CEU004
     I              LCD                             LLCD                  CEU004
      *                                                                   CEU004
     IDSFDY     E DSDSFDY                                                 CEU004
      ** Short data structure for access object                           CEU004
      *                                                                   CEU004
     ISDCURR    E DSSDCURRPD                                                                  CLE031
      ** Currency details                                                                     CLE031
      *                                                                                       CLE031
     ISDSTPD    E DSSDSTPDPD                                                                  CER049
      *                                                                                       CER049
     ISDACCT    E DSACCNTAB                                                                   CER049
     I              RECI                            ACRECI                                    CER049
     I              CNUM                            ACCNUM                                    CER049
     I              CCY                             ACCCY                                     CER049
     I              BRCA                            ACBRCA                                    CER049
     I              LCD                             ACLCD                                     CER049
     I              CHTP                            ACCHTP                                    CER049
     I              FRNT                            ACFRNT                                    CER049
     I              AFRT                            ACAFRT                                    CER049
     I              REPA                            ACREPA                                    CER049
     I              TNLU                            ACTNLU                                    CER049
     I              TMST                            ACTMST                                    CER049
     I              REPI                            ACREPI                                    CER049
     I              AUTH                            ACAUTH                                    CER049
     I              ORED                            ACORED                                    CER049
      *                                                                                       CER049
     I/COPY ZSRSRC,ZDAT10Z1
     I/COPY ZSRSRC,ZDATE9Z2                                               182370
      *                                                                                       CSC022
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      *                                                                                       CSC022
      *  Program data structure                                                               CSC022
      *                                                                                       CSC022
     IDSPGM     ESDSY2PGDSP                                                                   CSC022
      *                                                                                       CSC022
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
      ***General*ledger*details****************************************            MD035545 MD047993
      *                                                                                     MD035545
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           PDCLI   1                                         MD023787
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      *  Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C/COPY WNCPYSRC,AOOULAU0C4
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Clear down all shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRCLR
      *
     C                     MOVELZ#BSTS    #BRCID  2
     C                     MOVELZ#ASTS    #ARCID  2
      *
      *-------------------------------------------------------------------
      *
      ** GENERATE 'BEFORE STATUS' ACCOUNT MOVEMENTS
      ** (if not insertion, when __RCID will be blank)
      *
     C           #BRCID    IFNE *BLANK
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL'YES'     ##REVI  3
      *
      ** Loan Amendments
     C                     MOVELZ#BSTS    LOAMDK
     C                     Z-ADDWREPTB    REPT                                               BUG8333
     C                     MOVE WOSACB    OSAC                                               BUG5323
     C                     MOVE WTSENB    TSEN                                               BUG5323
     C                     MOVE WFACOB    FACO                                               BUG5323
     C                     MOVE WXRFIB    XRFI                                                CLE134
     C                     MOVE WXRFNB    XRFN                                                CLE134
      *                                                                   CLE033
      * TNLU in reversals must be the new one, to match the loan status   CLE033
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
      *                                                                   CLE033
     C                     MOVELZ#ASTS    LOAMDK                          CLE033
     C                     Z-ADDWREPTA    REPT                                               BUG8333
     C                     MOVE WOSACA    OSAC                                               BUG5323
     C                     MOVE WTSENA    TSEN                                               BUG5323
     C                     MOVE WFACOA    FACO                                               BUG5323
     C                     MOVE WXRFIA    XRFI                                                CLE134
     C                     MOVE WXRFNA    XRFN                                                CLE134
     C                     Z-ADD0         W0TNLU  50                      CLE033
      *                                                                   CLE033
     C           CHTP      IFEQ 'R'                                       CLE033
     C                     Z-ADDTNLU      W0TNLU                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     MOVELZ#BSTS    LOAMDK                          CLE033
     C                     Z-ADDWREPTB    REPT                                               BUG8333
     C                     MOVE WOSACB    OSAC                                               BUG5323
     C                     MOVE WTSENB    TSEN                                               BUG5323
     C                     MOVE WFACOB    FACO                                               BUG5323
     C                     MOVE WXRFIB    XRFI                                                CLE134
     C                     MOVE WXRFNB    XRFN                                                CLE134
      *                                                                   CLE033
     C           W0TNLU    IFNE 0                                         CLE033
     C                     Z-ADDW0TNLU    TNLU                            CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
     C                     EXSR SRLOAM
      *                                                                   CLE033
     C                     MOVE ##SETM    WBSETM  2                       CLE033
      *
     C                     END                             * Z#BSTS
      *-------------------------------------------------------------------
      *
      ** GENERATE 'AFTER STATUS' ACCOUNT MOVEMENTS
      ** (if not deletion, when __CHTP will be 'R')
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL*BLANK    ##REVI
      *
      ** Loan Amendments
     C                     MOVELZ#ASTS    LOAMDK
     C                     Z-ADDWREPTA    REPT                                               BUG8333
     C                     MOVE WOSACA    OSAC                                               BUG5323
     C                     MOVE WTSENA    TSEN                                               BUG5323
     C                     MOVE WFACOA    FACO                                               BUG5323
     C                     MOVE WXRFIA    XRFI                                                CLE134
     C                     MOVE WXRFNA    XRFN                                                CLE134
     C           CHTP      IFNE 'R'
     C                     EXSR SRLOAM
     C                     END
      *
      *-------------------------------------------------------------------
      *
      ** Update database with shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRUPD
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRLOAM                                         *
      * Function    :  Loan Amendment Processing                      *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRLOAM    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRLOAM'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if loan amendment type involves no settlement
      *
     C           AMTP      CABEQ'SC'      EXLOAM
     C           AMTP      CABEQ'BC'      EXLOAM
     C           AMTP      CABEQ'SA'      EXLOAM
     C           AMTP      CABEQ'LS'      EXLOAM
      *
      **  Determine whether associated loan is a loan or deposit
      *
     C                     Z-ADD1         #I      20
     C           PTYP      LOKUP##LDT,#I                 99*
     C  N99                MOVEL'L'       ##LOD   1
     C   99                MOVEL'D'       ##LOD
      *                                                                                     MD023787
     C           PDCLI     IFEQ 'Y'                                                         MD023787
     C           AMTP      ANDEQ'PI'                                                        MD023787
     C                     MOVE 'D'       ##LOD                                             MD023787
     C                     ENDIF                                                            MD023787
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
      **  For Loans and Part. Purchased
      *
     C           ##LOD     IFEQ 'L'
      *                                                                   122601
     C           AMTP      IFEQ 'PT'                                      122601
     C           AMTP      OREQ 'PI'                                      122601
     C                     MOVELSETP      ##PAYM           * pay method
     C**********           MOVELOSAC      ##PAYA           * pay account                     BUG4577
     C**********           MOVELOSACQQ    ##PAYA           * pay account             BUG4577 BUG5323
     C                     MOVELOSAC      ##PAYA           * pay account                     BUG5323
     C                     MOVELOSBR      ##PAYB           * pay branch
     C                     MOVEL*BLANKS   ##RECM           * rec method
     C                     MOVEL*BLANKS   ##RECA           * rec account
     C                     MOVEL*BLANKS   ##RECB           * rec branch
     C                     ENDIF                                          122601
      *                                                                   122601
     C           AMTP      IFEQ 'PF'                                      122601
     C           AMTP      OREQ 'MR'                                      122601
     C           AMTP      OREQ 'RE'                                      122601
     C                     MOVELSETP      ##RECM                          122601
     C**********           MOVELOSAC      ##RECA                                      122601 BUG3056
     C**********           MOVELOSACQQ    ##RECA                                     BUG3056 BUG5323
     C                     MOVELOSAC      ##RECA                                             BUG5323
     C                     MOVELOSBR      ##RECB                          122601
     C                     MOVEL*BLANKS   ##PAYM                          122601
     C                     MOVEL*BLANKS   ##PAYA                          122601
     C                     MOVEL*BLANKS   ##PAYB                          122601
     C                     ENDIF                                          122601
      *                                                                   122601
     C                     ELSE
      **  For Part. Sold
     C           AMTP      IFEQ 'PT'                                      122601
     C           AMTP      OREQ 'PI'                                      122601
     C                     MOVEL*BLANKS   ##PAYM           * pay method
     C                     MOVEL*BLANKS   ##PAYA           * pay account
     C                     MOVEL*BLANKS   ##PAYB           * pay branch
     C                     MOVELSETP      ##RECM           * rec method
     C**********           MOVELOSAC      ##RECA           * rec account                     BUG4577
     C**********           MOVELOSACQQ    ##RECA           * rec account             BUG4577 BUG5323
     C                     MOVELOSAC      ##RECA           * rec account                     BUG5323
     C                     MOVELOSBR      ##RECB           * rec branch
     C                     ENDIF                                          122601
      *                                                                   122601
     C           AMTP      IFEQ 'PF'                                      122601
     C           AMTP      OREQ 'MR'                                      122601
     C           AMTP      OREQ 'RE'                                      122601
     C                     MOVELSETP      ##PAYM           * pay method   122601
     C**********           MOVELOSAC      ##PAYA           * pay account              122601 BUG3056
     C**********           MOVELOSACQQ    ##PAYA                                     BUG3056 BUG5323
     C                     MOVELOSAC      ##PAYA                                             BUG5323
     C                     MOVELOSBR      ##PAYB           * pay branch   122601
     C                     MOVEL*BLANKS   ##RECM           * rec method   122601
     C                     MOVEL*BLANKS   ##RECA           * rec account  122601
     C                     MOVEL*BLANKS   ##RECB           * rec branch   122601
     C                     ENDIF                                          122601
     C                     END
      *
      **  Store basic loan amendment details
      *
     C**********           Z-ADDLNRF      ##DLNO  60       * loan number                      CLE148
     C                     MOVELLNRF      ##DLNO  6                                           CLE148
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           SCCY      ANDNE*BLANK                                    CEU004
     C                     MOVELSCCY      ##CCY                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVELCCY       ##CCY   3        * currency
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      ** If Lending Enhancements is on.                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
      * Store receipt settlement currency                                                     CLE031
     C********** SCCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELSCCY      SVSCCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                       CLE031
      * Store pay settlement currency                                                         CLE031
     C********** PSCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELPSCY      SVPSCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                       CLE031
     C                     Z-ADDREXR      SVREXR 138                                        AR943686
     C                     MOVE REXI      SVREXI  1                                         AR943686
     C                     Z-ADDPEXR      SVPEXR 138                                        AR943686
     C                     MOVE PEXI      SVPEXI  1                                         AR943686
      *                                                                                     AR943686
     C                     ENDIF                           End If CLE031                      CLE031
      *                                                                                       CLE031
     C***********          Z-ADDPRAM      ##PCPL 150   99  * loan amd prin148591
      *                                                                   175450
      ** Update on shadow posting should only include interest payment    175450
      ** if Risk loan for Manual Repayment.                               175450
      *                                                                   175450
     C           AMTP      IFEQ 'MR'                                      148591
      *                                                                   175450
     C           PTYP      IFEQ 70                                        175450
     C           PTYP      OREQ 71                                        175450
     C           PTYP      OREQ 72                                        175450
     C                     Z-ADDINTA      ##PCPL                          175450
     C                     ELSE                                           175450
     C                     Z-ADDTAMT      ##PCPL 150       * total amount 148591
     C                     ADD  PNAM      ##PCPL           * penalty      148591
     C                     ENDIF                                          175450
      *                                                                   175450
     C                     ELSE                                           148591
     C           REPT      IFEQ 3                                                            BUG8333
     C                     Z-ADDTAMT      ##PCPL                                             BUG8333
     C                     ELSE                                                              BUG8333
     C                     Z-ADDPRAM      ##PCPL 150       * loan amd prin148591
     C                     ENDIF                                                             BUG8333
     C                     ENDIF                                          148591
     C***99******          Z-SUB##PCPL    ##PCPL                          148591
     C                     MOVELAMTP      ##TRYP  2        * loan amend type
     C                     MOVELLNRF      ##TRN   6        * transact no.
     C                     MOVELBRCA      ##BBRN  3        * booking branch
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT  50       * event value dte
     C                     Z-ADD*ZERO     ##AMT  150       * amount
     C                     MOVEL*BLANK    ##NARR 30        * narrative
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
     C                     Z-ADDVDAT      ##VYMD
     C                     Z-ADDVDAT      ##VDAT             Midas day no.
      *
     C                     Z-ADD##PCPL    ##AMT            * loan amd princl
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C           ##TRYP    ANDEQ'PI'                                      CLE034
     C           ##LOD     OREQ 'L'                                       CLE034
     C           ##TRYP    ANDEQ'PT'                                      CLE034
     C           ##LOD     OREQ 'D'                                       CLE034
     C           ##TRYP    ANDEQ'PF'                                      CLE034
     C           ##LOD     OREQ 'D'                                       CLE034
     C           ##TRYP    ANDEQ'MR'                                      CLE034
     C           ##LOD     OREQ 'D'                                       CLE034
     C           ##TRYP    ANDEQ'RE'                                      CLE034
     C                     MOVE 'P'       WPAYRC  1                       CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'                        * loan
     C           ##TRYP    ANDEQ'PI'                       * + princl inc.
     C           ##LOD     OREQ 'D'                        * part sold                        193676
     C           ##TRYP    ANDEQ'PF'                       * + princl trf.                    193676
     C           ##LOD     OREQ 'D'                        * part sold                        193676
     C           ##TRYP    ANDEQ'MR'                       * + manual rep.                    193676
     C           ##LOD     OREQ 'D'                        * part sold                        193676
     C           ##TRYP    ANDEQ'RE'                       * + repay                          193676
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     ELSE
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     END
      *
     C                     Z-ADD001       ##RPNB  30       * 1=value date
     C                     MOVEL##NAR,1   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C           AMTP      IFEQ 'PI'                                                          CAP205
     C           AMTP      OREQ 'PT'                                                          CAP205
     C           AMTP      OREQ 'PF'                                                          CAP205
     C           AMTP      OREQ 'MR'                                                          CAP205
     C                     MOVEL'S'       ##MTYP  1                                           CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *................................................................
      *
     C           EXLOAM    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRMOVE                                         *
      * Function    :  Pass Movement To Write Program                 *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRMOVE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if no amount to post
      *
     C           ##AMT     CABEQ*ZERO     EXMOVE
      *
      ** Determine account movement settlement details
      *
      ** If Lending Enhancements is on.                                                       CLE031
      ** Check whether a settlement currency has been used:                                   CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'R'                                                           CLE031
     C           SVSCCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
      * Store receipt settlement details                                                      CLE031
     C                     MOVELSVSCCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVSCCY    SCCY                                              AR943686
     C                     Z-ADDSVREXR    REXR                                              AR943686
     C                     MOVE SVREXI    REXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'P'                                                           CLE031
     C           SVPSCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
      * Store pay settlement details                                                          CLE031
     C                     MOVELSVPSCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVPSCY    PSCY                                              AR943686
     C                     Z-ADDSVPEXR    PEXR                                              AR943686
     C                     MOVE SVPEXI    PEXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CLEARC#DTA
     C/COPY WNCPYSRC,AOOULAU0C2
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C                     MOVE 'P'       C#ATYP                          CLE033
     C                     MOVELP@VL01    C#CNUM                          CLE033
     C                     MOVELP@VL02    C#ACOD                          CLE033
     C                     MOVEL'01'      C#ACSQ                          CLE033
     C                     MOVELBRCA      C#BRCA                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *
     C           ##SETM    IFEQ '01'
     C           ##SETM    OREQ '02'
     C           ##SETM    OREQ '07'
     C           ##SETM    OREQ '08'
     C           ##SETM    OREQ '12'
     C                     MOVEL'N'       C#ATYP
     C                     MOVEL##NOSN    C#NOSN
     C                     ELSE
     C           ##SETM    IFEQ '14'
     C                     MOVEL'R'       C#ATYP
     C                     MOVEL##ACNO    C#ACNO
     C                     ELSE
     C           ##SETM    IFEQ '04'
     C           ##SETM    OREQ '05'
     C                     MOVEL'P'       C#ATYP
     C                     MOVEL##CNUM    C#CNUM
     C                     MOVEL##ACOD    C#ACOD
     C                     MOVEL##ACSQ    C#ACSQ
     C                     MOVEL##BRCA    C#BRCA
     C                     END
     C                     END
     C                     END
      *
      * OLPOS Incoming/Outgoing Indicator 'I' or 'O'
     C           ##PYRC    IFEQ 'P'
     C                     MOVEL'O'       C#IO             * outgoing
     C                     ELSE
     C                     MOVEL'I'       C#IO             * incoming
     C                     END
      *
      * Currency of transaction
     C                     MOVEL##CCY     C#CCY
      *
      * Transaction type
     C                     MOVEL##TRYP    C#TRYP
      * Transaction Narrative
     C/COPY WNCPYSRC,AOH00045
     C                     MOVEL##NARR    C#NARR
     C/COPY WNCPYSRC,AOH00046
     C           ##REVI    IFEQ 'YES'
     C                     MOVE '*'       C#NARR
     C                     END
      *
      * DL/LE/GL/RE transaction reference
     C                     MOVEL##TRN     C#TRN
     C/COPY WNCPYSRC,AOH00005
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELLASN      C#PREF                                              CRE020
     C                     ENDIF                                                              CRE020
      *
      * Movement amount
      *                                                                                       CLE031
      ** If CLE031 - Lending Enhancements                                                     CLE031
      ** or CEU004 (EMU Settlement Ccy Conversion) is installed,                              CLE031
      ** check for settlement currency.                                                       CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WPAYRC    ANDEQ'P'                                                           CLE038
     C           LSPYBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE034    OREQ 'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WPAYRC    ANDEQ'R'                                                           CLE038
     C           LSRCBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE034    OREQ 'Y'                                                           CLE038
     C           STAL      ANDNE'Y'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE038    ORNE 'Y'                                                           CLE038
      *                                                                                       CLE038
     C                     MOVE 'N'       WRKEMU                                              CLE031
      * If CLE033 is on and settlement method is 09, postings can be                          218782
      * left in transaction ccy instead, if System Value = 'T'.                               218782
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'P'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'R'                                                           218782
      *                                                                   CEU004
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCY      ANDNE*BLANK                                    CEU004
     C           SCCY      ANDNECCY                                       CEU004
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C           SCCY      ANDNE*BLANK                                                        CLE031
     C           SCCY      ANDNECCY                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C           PSCY      ANDNE*BLANK                                                        CLE031
     C           PSCY      ANDNECCY                                                           CLE031
      *                                                                                       CLE031
      * Determine which settlement ccy to use:                                                CLE031
     C           CLE031    IFNE 'Y'                        CEU004 set. ccy                    CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     MOVE SCCY      SETCCY  3                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PSCY      SETCCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * Check if movement currency is 'In' or 'EUR'.                                          CLE031
     C                     MOVELCCY       WCCY    3                                           CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    CCYDP   10                                          CLE031
     C                     Z-ADDA6SPRT    CCYSPT 138                                          CLE031
     C                     MOVE A6MDIN    CCYMDI  1                                           CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU  1                                           CLE031
     C                     ENDIF                                                              CLE031
      * Check if settlement currency is 'In' or 'EUR'.                                        CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C                     MOVE SETCCY    WCCY                                                CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    SETDP   10                                          CLE031
     C                     MOVE A6SPRT    SETSPT 138                                          CLE031
     C                     MOVE A6MDIN    SETMDI  1                                           CLE031
      *                                                                                       CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU                                              CLE031
     C                     ENDIF                                                              CLE031
      * If amount needs to be converted between EUR and                                       CLE031
      * an In currency, use EU0200.                                                           CLE031
     C           WRKEMU    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PRTCD                           CEU004
     C                     Z-ADD##AMT     PFRAM                           CEU004
     C                     MOVE CCY       PFRCY                           CEU004
     C**********           MOVE SCCY      PTOCY                                        CEU004 CLE031
     C                     MOVE SETCCY    PTOCY                                               CLE031
     C                     Z-ADD0         POUTA                           CEU004
     C                     Z-ADD0         PINTA                           CEU004
     C                     Z-ADD0         PEXRT                           CEU004
     C                     MOVE *BLANK    PMDIN                           CEU004
      *                                                                   CEU004
     C                     CALL 'EU0200'                                  CEU004
     C                     PARM           PRTCD   7        Return Code    CEU004
     C                     PARM           PFRAM  183       From amount    CEU004
     C                     PARM           PFRCY   3        From Currency  CEU004
     C                     PARM           PTOCY   3        To Currency    CEU004
     C                     PARM           POUTA  150       Out amount     CEU004
     C                     PARM           PINTA  183       In amount      CEU004
     C                     PARM           PEXRT  159       Exchange Rate  CEU004
     C                     PARM           PMDIN   1        Mult/Div Ind   CEU004
      *                                                                   CEU004
     C           PRTCD     IFEQ *BLANK                                    CEU004
     C                     Z-ADDPOUTA     ##AMT                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'*CALL   'W0FILE                          CEU004
     C                     MOVEL'EU0200  'W0KEY                           CEU004
     C                     Z-ADD904       W0ERNB                          CEU004
     C                     EXSR SRERR                                     CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      * Else, convert using settlement exchange rate.                                         CLE031
      * Determine which rate to use:                                                          CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     Z-ADDREXR      ZEXCH                                               CLE031
     C                     MOVE REXI      ZMD                                                 CLE031
     C                     ELSE                                                               CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C                     Z-ADDPEXR      ZEXCH                                               CLE031
     C                     MOVE PEXI      ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD##AMT     ZAMTCI                                              CLE031
     C                     MOVE CCY       ZCCYI                                               CLE031
     C                     MOVE SETCCY    ZCCYO                                               CLE031
     C                     Z-ADDCCYDP     ZCDPI                                               CLE031
     C                     Z-ADDSETDP     ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    ##AMT                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                                              218782
      *                                                                                       218782
     C                     ELSE                                                               CLE038
      ** Do nothing as amount is in correct currency                                          CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C           ##PYRC    IFEQ 'P'
     C           ##REVI    ANDNE'YES'
     C           ##PYRC    OREQ 'R'
     C           ##REVI    ANDEQ'YES'
      *                                                                                     MD023787
     C           PDCLI     IFEQ 'Y'                                                         MD023787
     C           AMTP      ANDEQ'MR'                                                        MD023787
     C                     Z-ADD##AMT     C#AMT            * rec ie debit                   MD023787
     C                     ELSE                                                             MD023787
     C                     Z-SUB##AMT     C#AMT            * pay ie credit
     C                     ENDIF                                                            MD023787
     C                     ELSE
      *                                                                                     MD023787
     C           PDCLI     IFEQ 'Y'                                                         MD023787
     C           AMTP      ANDEQ'MR'                                                        MD023787
     C                     Z-SUB##AMT     C#AMT            * rec ie credit                  MD023787
     C                     ELSE                                                             MD023787
     C                     Z-ADD##AMT     C#AMT            * rec ie debit
     C                     ENDIF                                                            MD023787
     C                     END
      *                                                                                     MD040030
     C           ##PYRC    IFEQ 'R'                                                         MD040030
     C           PDCLI     ANDEQ'Y'                                                         MD040030
     C           AMTP      ANDEQ'MR'                                                        MD040030
     C           ##AMT     ANDGT0                                                           MD040030
     C           ##REVI    IFEQ 'YES'                                                       MD040030
     C                     MOVE ' '       C#NARR                                            MD040030
     C                     ELSE                                                             MD040030
     C                     MOVE '*'       C#NARR                                            MD040030
     C                     ENDIF                                                            MD040030
     C                     ENDIF                                                            MD040030
      *
      * Module
     C                     MOVEL'LE'      C#MOD
      *
      * Olpos record number to update
      * '01' for FX (not used here)
      * '02' for Interest movements
      * '03' for Loans and deposits
     C           ##RPNB    IFEQ 2
     C                     MOVE '02'      C#OLRC
     C                     ELSE
     C                     MOVE '03'      C#OLRC
     C                     END
      *
      * Value date and posting date
     C                     Z-ADD##VDAT    C#VDAT
     C                     Z-ADD##VDAT    C#PSTD
      *
      * Indicator to show if removal allowed Y, N or " "
     C                     MOVEL'Y'       C#RPST
      *
      * Removal set number
     C                     Z-ADD##RPNB    C#RPNB
      *
      * Removal type "C" = Credit entries
      *              "D" = Debit entries
     C                     MOVEL'C'       C#RTYP
      *
      * Booking branch
     C                     MOVEL##BBRN    C#BBRN
      *                                                                                       CLE134
      ** Extension Reference Id/Number.                                                       CLE134
      *                                                                                       CLE134
     C                     MOVELXRFI      C#XRFI                                              CLE134
     C                     MOVELXRFN      C#XRFN                                              CLE134
      *
      *  If settlement details are present
      *  AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS
      *
      *  OTHERWISE
      *
      *  If no settlement details are present
      *  AOSPOSU0 will be called to only update OLPOS
      *
     C           C#ATYP    IFEQ *BLANK
      *
      * Set account type indicator to signify no settlement
     C                     MOVEL'X'       C#ATYP
      *
      * Set update indicators for no update
     C                     MOVE 'N'       C#PRON
     C                     MOVE 'N'       C#MEMS
     C                     MOVE 'N'       C#RSAC
     C                     END
      *                                                                   CLE033
      * CLE033 LEHOSTPD postings                                          CLE033
     C           ##VDAT    IFLT BJDNWD                                    CLE033
     C           CLE033    ANDEQ'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C                     EXSR HPOST                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       CAP205
      ** Set C#MTYP to ##MTYP                                                                 CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL##MTYP    C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   CLE033
      ** Do not update PRONO, MEMOS and RSACMTPD                                            AR691432
      ** if non-auto settle repayment.                                                      AR691432
      *                                                                                     AR691432
     C           AUTO      IFEQ 'N'                                                         AR691432
     C           AMTP      ANDEQ'RE'                                                        AR691432
     C                     MOVE 'N'       C#PRON                                            AR691432
     C                     MOVE 'N'       C#MEMS                                            AR691432
     C                     MOVE 'N'       C#RSAC                                            AR691432
     C                     ENDIF                                                            AR691432
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE  8
     C                     MOVEL'AOSPOSU0'W0KEY  29
     C                     Z-ADD902       W0ERNB  30
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXMOVE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************   CLE033
      *                                                               *   CLE033
      *  HPOST    : Write record to host file                         *   CLE033
      *                                                               *   CLE033
      *  CALLED BY: Various                                           *   CLE033
      *                                                               *   CLE033
      *  CALLS    : N/A                                               *   CLE033
      *                                                               *   CLE033
      *****************************************************************   CLE033
     C           HPOST     BEGSR                                          CLE033
      *                                                                   CLE033
     C                     MOVE *IN99     WIN99   1                       CLE033
      *                                                                   CLE033
     C           LNRF      CHAINAOLOAN               99                   CLE033
      *                                                                   CLE033
      * Conditions                                                        CLE033
      *                                                                   CLE033
     C           AMTP      IFEQ 'RE'                                      CLE033
     C           AUTO      ANDNE'Y'                                       CLE033
     C           CLE134    ANDEQ'N'                                                           CLE134
      *                                                                                       CLE134
     C           AMTP      OREQ 'RE'                                                          CLE134
     C           AUTO      ANDNE'Y'                                                           CLE134
     C           AUTO      ANDNE'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C           LWOI      OREQ 'Y'                                       CLE033
     C           AMTP      ANDEQ'MR'                                      CLE033
     C                     ELSE                                           CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           CHTP      WHEQ 'I'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C           AMTP      OREQ 'MR'                                      CLE033
     C           CHTP      ANDEQ'A'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C           CHTP      OREQ 'A'                                       CLE033
     C           WBSETM    ANDNE'09'                                      CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C           #BRCID    ANDNE*BLANKS                                   CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Insert  'HOACTN                          CLE033
     C           CHTP      WHEQ 'A'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Amend   'HOACTN                          CLE033
     C           CHTP      WHEQ 'R'                                       CLE033
     C           ##REVI    OREQ 'YES'                                     CLE033
     C                     MOVEL'Reverse 'HOACTN                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           AMTP      WHEQ 'MR'                                      CLE033
     C                     MOVEA#AM,1     HOTRYP                          CLE033
     C           PRAM      IFEQ 0                                         CLE033
     C           PNAM      ANDEQ0                                         CLE033
     C                     MOVE 'R2'      HOETYP                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 'R1'      HOETYP                          CLE033
     C                     ENDIF                                          CLE033
     C           AMTP      WHEQ 'RE'                                      CLE033
     C                     MOVEA#AM,2     HOTRYP                          CLE033
     C                     MOVE 'R1'      HOETYP                          CLE033
     C           AMTP      WHEQ 'PI'                                      CLE033
     C                     MOVEA#AM,3     HOTRYP                          CLE033
     C                     MOVE 'V3'      HOETYP                          CLE033
     C           AMTP      WHEQ 'PF'                                      CLE033
     C                     MOVEA#AM,4     HOTRYP                          CLE033
     C           AMTP      WHEQ 'PT'                                      CLE033
     C                     MOVEA#AM,5     HOTRYP                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     MOVELPTYP      HOETYP                          CLE033
      *                                                                   CLE033
     C                     MOVEL##NARR    HOETYD                          CLE033
     C**********           Z-ADDCNUMX     HOCNUM                                       CLE033 CSD027
     C                     MOVE CNUMX     HOCNUM                                              CSD027
     C**********           Z-ADDLNRF      HOLNRF                                       CLE033 CLE148
     C                     MOVELLNRF      HOLNRF                                              CLE148
     C                     Z-ADDLASN      HOLASN                          CLE033
     C                     Z-ADD0         HOFTYP                          CLE033
     C                     Z-ADD0         HOFSEQ                          CLE033
     C                     Z-ADD0         HOFESQ                          CLE033
     C                     MOVE BRCA      HOBRCA                          CLE033
     C                     MOVE LTYPX     HOLTYP                          CLE033
     C                     MOVE SUTPX     HOSUTP                          CLE033
     C                     MOVE CLASX     HOCLAS                          CLE042
     C                     Z-ADDBJRDNB    HOPSTD                          CLE033
     C                     Z-ADD##VDAT    HOVALD                          CLE033
     C                     MOVE CCY       HOCCY                           CLE033
      *                                                                   CLE033
     C                     Z-ADD##AMT     HOPSTA                          CLE033
      *                                                                   CLE033
     C                     MOVE *BLANKS   W0PNA1  5                       CLE033
     C                     MOVELLTYPX     W0PNA1                          CLE033
     C                     MOVE LNRF      W0PNA2  6                       CLE033
     C           W0PNA1    CAT  W0PNA2    HOPNAR                          CLE033
      *                                                                   CLE033
     C                     MOVE AUTO      HOAUTO                          CLE033
     C           ##REVI    IFEQ 'YES'                                     CLE033
     C           ##PYRC    IFEQ 'P'                                       CLE033
     C                     MOVE 'R'       HOTLXY                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 'P'       HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE ##PYRC    HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       220257
      * If posting amount is negative, convert to a positive amount                           220257
      * and change the debit/credit indicator                                                 220257
      *                                                                                       220257
     C           ##AMT     IFLT 0                                                             220257
     C                     Z-SUB##AMT     HOPSTA                                              220257
     C           HOTLXY    IFEQ 'P'                                                           220257
     C                     MOVE 'R'       HOTLXY                                              220257
     C                     ELSE                                                               220257
     C                     MOVE 'P'       HOTLXY                                              220257
     C                     ENDIF                                                              220257
     C                     ENDIF                                                              220257
      *                                                                   CLE033
     C                     Z-ADD0         HOINTR                          CLE033
     C                     MOVE BRTT      HOBRTT                          CLE033
     C                     Z-ADDBRTE      HOBRTE                          CLE033
     C                     Z-ADDRTSP      HORTSP                          CLE033
     C                     MOVE SPIN      HOSPIN                          CLE033
     C                     Z-ADD0         HOMARG                          CLE033
     C           ##AMT     IFGE 0                                                             226542
     C                     MOVE SCCY      HOSCCY                          CLE033
     C                     Z-ADDREXR      HOREXR                          CLE033
     C                     MOVE REXI      HOREXI                          CLE033
     C                     MOVE ##RECB    HORHBR                          CLE033
     C                     MOVE ##RECA    HORHAC                          CLE033
     C**********           Z-ADDROBN      HOROBN                                       CLE033 CSD027
     C**********           Z-ADDROCN      HOROCN                                       CLE033 CSD027
     C                     MOVE ROBN      HOROBN                                              CSD027
     C                     MOVE ROCN      HOROCN                                              CSD027
     C                     MOVE RIBN      HORIBN                          CLE033
     C                     MOVE RIBA      HORIBA                          CLE033
     C                     MOVE PSCY      HOPSCY                          CLE033
     C                     Z-ADDPEXR      HOPEXR                          CLE033
     C                     MOVE PEXI      HOPEXI                          CLE033
     C                     MOVE ##PAYB    HOPHBR                          CLE033
     C                     MOVE ##PAYA    HOPHAC                          CLE033
     C**********           Z-ADDPOBN      HOPOBN                                       CLE033 CSD027
     C**********           Z-ADDPOCN      HOPOCN                                       CLE033 CSD027
     C                     MOVE POBN      HOPOBN                                              CSD027
     C                     MOVE POCN      HOPOCN                                              CSD027
     C                     MOVE PIBA      HOPIBA                          CLE033
     C                     ELSE                                                               226542
     C                     MOVE PSCY      HOSCCY                                              226542
     C                     Z-ADDPEXR      HOREXR                                              226542
     C                     MOVE PEXI      HOREXI                                              226542
     C                     MOVE ##PAYB    HORHBR                                              226542
     C                     MOVE ##PAYA    HORHAC                                              226542
     C**********           Z-ADDPOBN      HOROBN                                      226542 CSD027A
     C**********           Z-ADDPOCN      HOROCN                                      226542 CSD027A
     C                     MOVE POBN      HOROBN                                             CSD027A
     C                     MOVE POCN      HOROCN                                             CSD027A
     C                     MOVE PIBN      HORIBN                                              226542
     C                     MOVE PIBA      HORIBA                                              226542
     C                     MOVE SCCY      HOPSCY                                              226542
     C                     Z-ADDREXR      HOPEXR                                              226542
     C                     MOVE REXI      HOPEXI                                              226542
     C                     MOVE ##RECB    HOPHBR                                              226542
     C                     MOVE ##RECA    HOPHAC                                              226542
     C**********           Z-ADDROBN      HOPOBN                                      226542 CSD027A
     C**********           Z-ADDROCN      HOPOCN                                      226542 CSD027A
     C                     MOVE ROBN      HOPOBN                                             CSD027A
     C                     MOVE ROCN      HOPOCN                                             CSD027A
     C                     MOVE RIBA      HOPIBA                                              226542
     C                     ENDIF                                                              226542
     C                     MOVE RVNO      HORVNO                          CLE033
     C                     MOVE CVMR      HOCVMR                          CLE033
     C                     MOVE RCRN      HORCRN                          CLE033
     C                     MOVE RCRA      HORCRA                          CLE033
     C                     MOVE AWBN      HOAWBN                          CLE033
     C                     MOVE AWBA      HOAWBA                          CLE033
     C                     MOVE BENN      HOBENN                          CLE033
     C                     MOVE BENA      HOBENA                          CLE033
     C                     MOVE DTP1      HODTP1                          CLE033
     C                     MOVE DTP2      HODTP2                          CLE033
     C                     MOVE DTP3      HODTP3                          CLE033
     C                     MOVE DTP4      HODTP4                          CLE033
     C                     MOVE DCHG      HODCHG                          CLE033
     C                     MOVE BTB1      HOBTB1                          CLE033
     C                     MOVE BTB2      HOBTB2                          CLE033
     C                     MOVE BTB3      HOBTB3                          CLE033
     C                     MOVE BTB4      HOBTB4                          CLE033
     C                     MOVE BTB5      HOBTB5                          CLE033
     C                     MOVE BTB6      HOBTB6                          CLE033
     C                     Z-ADDTNLU      HOTNLU                          CLE033
     C                     MOVE *BLANKS   HOPROG                                              218782
     C                     MOVEL'AOOULAU0'HOPROG                                              218782
     C                     Z-ADD0         HOSEQN                                              218782
     C                     MOVE *BLANKS   HOSTAT                                              218782
      *                                                                   CLE033
     C                     WRITELEHOSTD0                                  CLE033
      *                                                                   CLE033
     C           P@VL03    IFNE *BLANKS                                   CLE033
     C                     CALL P@VL03                                    CLE033
     C/COPY WNCPYSRC,AOOULAU0C9                                           CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     MOVE WIN99     *IN99                           CLE033
      *                                                                   CLE033
     C                     ENDSR                                          CLE033
      *****************************************************************   CLE033
     C/SPACE 5                                                            CLE033
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow postings in store     *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *................................................................
      *
      *  Call AOSPOSU0 to update database
      *
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*UPDATE 'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD903       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all postings in store                       *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *................................................................
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARC#DTA
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*CLEAR  'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD901       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRERR    : Report error and close down program               *
      *                                                               *
      *  CALLED BY: Various                                           *
      *  CALLS    : *NONE                                             *
      *                                                               *
      *****************************************************************
     C           SRERR     BEGSR
      *
      *  Dump program
      *
     C           O#RTN     IFEQ '*RECLCK'                                                   AR868380
     C           R#RTN     OREQ '*RECLCK'                                                   AR868380
     C                     ROLBK                                                            AR868380
     C                     SETON                     LR                                     AR868380
     C                     MOVEL'*RECLCK' ##RTCD                                            AR868380
     C                     ELSE                                                             AR868380
     C                     DUMP
     C           ##RTCD    IFNE '*LEBTCH'                                 122960
     C           CSC022    IFNE 'Y'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           WCMTSK    IFNE 'Y'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                          122960
      *
      *  Close down program
      *
     C                     SETON                     LR
     C                     MOVEL'*ERROR*' ##RTCD
      *                                                                                     AR868380
     C                     ENDIF                                                            AR868380
      *                                                                                     AR868380
     C                     RETRN
      *
     C           EXERR     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     MOVEL'P'       ##PAY
     C                     MOVEL'R'       ##REC
     C                     MOVEL*BLANKS   R#RTN   7
     C                     MOVE '0'       *IN98
      *                                                                   CEU004
      **  Check if LE Settlement Currency Enhancement - CEU004            CEU004
      *   is installed                                                    CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANKS   @RTCD   7                       CEU004
     C                     PARM '*VERIFY' @OPTN   7                       CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
     C                     MOVE 'N'       CEU004  1                       CEU004
      *                                                                   CEU004
      ** If feature is on, set up SAR work flag                           CEU004
      *                                                                   CEU004
     C           @RTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004                          CEU004
     C                     ELSE                                           CEU004
      *                                                                   CEU004
      ** else, database error (return code other than *NRF)               CEU004
      *                                                                   CEU004
     C           @RTCD     IFNE '*NRF   '                                 CEU004
     C                     MOVEL'AOOULAUO'W0PGM   8                       CEU004
     C                     MOVEL'SCSARDPD'W0FILE                          CEU004
     C                     MOVEL'*VERIFY' W0KEY                           CEU004
     C                     Z-ADD905       W0ERNB                          CEU004
     C                     EXSR SRERR                                     CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      **  Check if CLE031 - Lending Enhancements is on.                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD   7                                           CLE031
     C                     PARM '*VERIFY' @OPTN   7                                           CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
      ** If feature is on, set up SAR work flag                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** else, database error if return code other than *NRF.                                 CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C           @RTCD     IFNE '*NRF   '                                                     CLE031
     C                     MOVEL'AOOULAUO'W0PGM   8                                           CLE031
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE031
     C                     MOVEL'*VERIFY' W0KEY                                               CLE031
     C                     Z-ADD906       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   CLE033
     C**  Read switchable features file SCSARDPD using access object      CLE033
     C**  to determine if switchable feature (CLE033) is switched ON      CLE033
     C*                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
     C*                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD  7                       CLE033
     C                     PARM '*VERIFY' W0OPTN  7                       CLE033
     C                     PARM 'CLE033'  W0SARD  6                       CLE033
     C           SCSARD    PARM SCSARD    DSFDY                           CLE033
     C*                                                                   CLE033
     C**  If feature is on, set up CLE033 variable                        CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFEQ *BLANKS                                   CLE033
      *                                                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
      * System values                                                     CLE033
     C                     CALL 'AOSVALR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD                          CLE033
     C                     PARM SVAL,1    P@OP01 20                       CLE033
     C                     PARM *BLANKS   P@VL01200                       CLE033
     C                     PARM SVAL,2    P@OP02 20                       CLE033
     C                     PARM *BLANKS   P@VL02200                       CLE033
     C                     PARM SVAL,3    P@OP03 20                       CLE033
     C                     PARM *BLANKS   P@VL03200                       CLE033
     C**********           PARM *BLANKS   P@OP04 20                                    CLE033 218782
     C                     PARM SVAL,4    P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                       CLE033
     C                     PARM *BLANKS   P@OP05 20                       CLE033
     C                     PARM *BLANKS   P@VL05200                       CLE033
     C                     PARM *BLANKS   P@OP06 20                       CLE033
     C                     PARM *BLANKS   P@VL06200                       CLE033
     C                     PARM *BLANKS   P@OP07 20                       CLE033
     C                     PARM *BLANKS   P@VL07200                       CLE033
     C                     PARM *BLANKS   P@OP08 20                       CLE033
     C                     PARM *BLANKS   P@VL08200                       CLE033
     C                     PARM *BLANKS   P@OP09 20                       CLE033
     C                     PARM *BLANKS   P@VL09200                       CLE033
     C                     PARM *BLANKS   P@OP10 20                       CLE033
     C                     PARM *BLANKS   P@VL10200                       CLE033
     C***********SDSVAL    PARM SDSVAL    DSSDY                           CLE033              222373
      *                                                                   CLE033
     C           W0RTCD    IFNE *BLANKS                                   CLE033
     C                     MOVEL'AOOULAUO'W0PGM                           CLE033
     C                     MOVEL'SDSVALPD'W0FILE                          CLE033
     C                     MOVEL'*KEY   ' W0KEY                           CLE033
     C                     Z-ADD913       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL04    SET09   1                                           218782
      *                                                                   CLE033
     C                     CALL 'AOBANKR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD                          CLE033
     C                     PARM '*KEY  '  W0OPTN                          CLE033
     C           SDBANK    PARM SDBANK    DSSDY                           CLE033
      *                                                                   CLE033
     C           W0RTCD    IFNE *BLANKS                                   CLE033
     C                     MOVEL'AOOULAUO'W0PGM                           CLE033
     C                     MOVEL'SDBANKPD'W0FILE                          CLE033
     C                     MOVEL'*KEY   ' W0KEY                           CLE033
     C                     Z-ADD908       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
      * Override CLOAN to ensure compatibility with LExxxx PGMs           CLE033
      *                                                                   CLE033
     C                     MOVEA#CMD,1    #CM                             CLE033
     C                     MOVEL'CLOAN  ' U#FILE 10                       CLE033
     C                     MOVEAU#FILE    #CM,32                          CLE033
     C                     MOVEA#CM       OVRDBF 80                       CLE033
     C                     Z-ADD80        CMDLEN 155                      CLE033
     C                     CALL 'QCMDEXC'              9090               CLE033
     C                     PARM           OVRDBF                          CLE033
     C                     PARM           CMDLEN                          CLE033
      *                                                                   CLE033
     C           *IN90     IFEQ *ON                                       CLE033
     C                     MOVEL'*CALL  ' W0FILE                          CLE033
     C                     MOVEL'QCMDEXC' W0KEY                           CLE033
     C                     Z-ADD909       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     END                                            CLE033
      *                                                                   CLE033
     C                     OPEN AOLOAN                                    CLE033
      *                                                                   CLE033
     C                     ELSE                                           CLE033
     C*                                                                   CLE033
     C** else, database error (return code other than *NRF)               CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFNE '*NRF   '                                 CLE033
     C                     MOVEL'AOOULAUO'W0PGM                           CLE033
     C                     MOVEL'SCSARDPD'W0FILE                          CLE033
     C                     MOVEL'*VERIFY' W0KEY                           CLE033
     C                     Z-ADD914       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
      *                                                                                       CLE034
      **  Check if CLE034 is installed                                                        CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   @RTCD                                               CLE034
     C                     PARM '*VERIFY' @OPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
      ** If feature is on, set up SAR work flag                                               CLE034
      *                                                                                       CLE034
     C           @RTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** else, database error if return code other than *NRF.                                 CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
     C           @RTCD     IFNE '*NRF   '                                                     CLE034
     C                     MOVEL'AOOULAUO'W0PGM                                               CLE034
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE034
     C                     MOVEL'*VERIFY' W0KEY                                               CLE034
     C                     Z-ADD911       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   @RTCD   7                                           CRE020
     C                     PARM '*VERIFY' @OPTN   7                                           CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           @RTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CLE038
      **  Check if CLE038 is installed                                                        CLE038
      *                                                                                       CLE038
     C                     CALL 'AOSARDR0'                                                    CLE038
     C                     PARM *BLANKS   @RTCD                                               CLE038
     C                     PARM '*VERIFY' @OPTN                                               CLE038
     C                     PARM 'CLE038'  PSARD                                               CLE038
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE038
      *                                                                                       CLE038
      ** If feature is on, set up SAR work flag                                               CLE038
      *                                                                                       CLE038
     C           @RTCD     IFEQ *BLANKS                                                       CLE038
     C                     MOVE 'Y'       CLE038                                              CLE038
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
      ** else, database error if return code other than *NRF.                                 CLE038
      *                                                                                       CLE038
     C                     MOVE 'N'       CLE038  1                                           CLE038
     C           @RTCD     IFNE '*NRF   '                                                     CLE038
     C                     MOVEL'AOOULAUO'W0PGM                                               CLE038
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE038
     C                     MOVEL'*VERIFY' W0KEY                                               CLE038
     C                     Z-ADD913       W0ERNB                                              CLE038
     C                     EXSR SRERR                                                         CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CAP205
      **  Check if CAP205 is installed                                                        CAP205
      *                                                                                       CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
      ** If feature is on, set up SAR work flag                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
      ** else, database error if return code other than *NRF.                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C           @RTCD     IFNE '*NRF   '                                                     CAP205
     C                     MOVEL'AOOULAUO'W0PGM                                               CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD915       W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
      ** Past Due Call Loans                                                                  CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   @RTCD   7                                           CLE134
     C                     PARM '*VERIFY' @OPTN   7                                           CLE134
     C                     PARM 'CLE134'  PSARD   6                                           CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
     C                     MOVE 'N'       CLE134  1                                           CLE134
      *                                                                                       CLE134
      ** If feature is on, set up SAR work flag                                               CLE134
      *                                                                                       CLE134
     C           @RTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,AOOULAU0C3
      *
      **  Copyright
     C                     MOVEA##CPY     ##BIS  80
      *
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *                                                                                       CSC022
      ** Check if CSC022 is switched *ON.                                                     CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD                                               CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL*BLANKS   WCMTSK  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       WCMTSK                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CER049
      ** Determine if CER049 enhancement is installed                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  @SARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
      ** If feature is on, set up SAR work flag                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     ENDIF                                                              CER049
      *****************************************************************            MD035545 MD047993
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD                                            MD035545
     C                     PARM           P@OP01                                            MD035545
     C                     PARM           P@VL01                                            MD035545
     C                     PARM           P@OP02                                            MD035545
     C                     PARM           P@VL02                                            MD035545
     C                     PARM           P@OP03                                            MD035545
     C                     PARM           P@VL03                                            MD035545
     C                     PARM           P@OP04                                            MD035545
     C                     PARM           P@VL04                                            MD035545
     C                     PARM           P@OP05                                            MD035545
     C                     PARM           P@VL05                                            MD035545
     C                     PARM           P@OP06                                            MD035545
     C                     PARM           P@VL06                                            MD035545
     C                     PARM           P@OP07                                            MD035545
     C                     PARM           P@VL07                                            MD035545
     C                     PARM           P@OP08                                            MD035545
     C                     PARM           P@VL08                                            MD035545
     C                     PARM           P@OP09                                            MD035545
     C                     PARM           P@VL09                                            MD035545
     C                     PARM           P@OP10                                            MD035545
     C                     PARM           P@VL10                                            MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C/COPY WNCPYSRC,AOH00006
      *
     C                     ENDSR
      *****************************************************************
      ** Subroutine  :  SRCURR                                        *                       CLE031
      ** Function    :  Check currency details                        *                       CLE031
      ** Calls       :  AOCURRR0                                      *                       CLE031
      **                                                              *                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           SRCURR    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOCURRR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD                                               CLE031
     C                     PARM '*KEY    '@OPTN                                               CLE031
     C                     PARM WCCY      @CURR   3                                           CLE031
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE031
      *                                                                                       CLE031
      ** Handle Database Error.                                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFNE *BLANKS                                                       CLE031
     C                     MOVEL'AOCURRR0'W0PGM   8                                           CLE031
     C                     MOVEL'SDCURRPD'W0FILE                                              CLE031
     C                     MOVEL'WCCY   ' W0KEY                                               CLE031
     C                     Z-ADD907       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34A                                         *                       CLE034
      ** Function    :  Initial set up for CLE034 processing          *                       CLE034
      ** Calls       :  AOSTALR2 AOBSTLR0                             *                       219608
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                                                              CLE034
     C                     Z-ADD##AMT     SVAMT  150                                          CLE034
     C                     MOVE LOAMDK    SVLOAN                                              CLE034
     C                     Z-ADD0         WTOTAM 150                                          CLE034
     C                     Z-ADD0         WAMT   150                                          CLE034
     C                     MOVE *BLANKS   WRKFLD  1                                           CLE034
     C                     MOVE ##RECM    SVRECM  2                                           CLE034
     C                     MOVE ##RECA    SVRECA 12                                           CLE034
     C                     MOVE ##RECB    SVRECB  3                                           CLE034
     C                     MOVE ##PAYM    SVPAYM  2                                           CLE034
     C                     MOVE ##PAYA    SVPAYA 12                                           CLE034
     C                     MOVE ##PAYB    SVPAYB  3                                           CLE034
     C                     MOVE ##CCY     SVCCY   3                                           CLE034
     C                     MOVE SVSCCY    S#SCCY  3                                           CLE034
     C                     MOVE SVPSCY    S#PSCY  3                                           CLE034
     C**********           MOVE PEXR      SVPEXR 138                                 CLE034 AR943686
     C**********           MOVE REXR      SVREXR 138                                 CLE034 AR943686
     C**********           MOVE PEXI      SVPEXI  1                                  CLE034 AR943686
     C**********           MOVE REXI      SVREXI  1                                  CLE034 AR943686
     C                     Z-ADDSVREXR    W#REXR 138                                        AR943686
     C                     Z-ADDSVPEXR    W#PEXR 138                                        AR943686
     C                     MOVE SVREXI    W#REXI  1                                         AR943686
     C                     MOVE SVPEXI    W#PEXI  1                                         AR943686
     C                     MOVE LNRF      WLNRF                                               CLE034
     C                     MOVE VDAT      WVDAT                                               CLE034
     C                     MOVE LASN      WLSEQ                                               CLE034
     C                     MOVE AMTP      WTYPE   4                                           CLE034
     C                     MOVEL'LA'      WTYPE                                               CLE034
      *                                                                                       CLE034
      ** If reversing existing allocations, call AOBSTLR0 to                                  219608
      ** access the 'before' image from LEBSTLPD:                                             219608
     C           ##REVI    IFEQ 'YES'                                                         219608
     C                     CALL 'AOBSTLR0'                                                    219608
     C                     PARM *BLANKS   WRTCD   7                                           219608
     C                     PARM '*FIRST ' WOPTN   7                                           219608
     C                     PARM           WTYPE   4                                           219608
     C                     PARM           WLNRF   6                                           219608
     C                     PARM           WVDAT   5                                           219608
     C                     PARM           WLSEQ   3                                           219608
     C                     PARM *BLANKS   WCFEE   6                                           219608
     C                     PARM *BLANKS   WFFEE   5                                           219608
     C                     PARM *BLANKS   WFSEQ   2                                           219608
     C                     PARM WPAYRC    WPAYR   1                                           219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
     C                     MOVEL*BLANKS   BEFORE  1                                           219608
      *                                                                                       219608
     C           WRTCD     IFNE *BLANK                                                        219608
      ** If could not find any, use the normal AOSTALR2 to                                    219608
      ** access the existing image                                                            219608
     C                     MOVEL'N'       BEFORE  1                                           219608
     C                     CALL 'AOSTALR2'                                                    219608
     C                     PARM *BLANKS   WRTCD                                               219608
     C                     PARM '*FIRST ' WOPTN                                               219608
     C                     PARM           WTYPE                                               219608
     C                     PARM           WLNRF                                               219608
     C                     PARM           WVDAT                                               219608
     C                     PARM           WLSEQ                                               219608
     C                     PARM *ZEROS    WCFEE                                               219608
     C                     PARM *ZEROS    WFFEE                                               219608
     C                     PARM *ZEROS    WFSEQ                                               219608
     C                     PARM WPAYRC    WPAYR                                               219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
     C           WRTCD     IFNE *BLANK                                                        219608
     C                     MOVEL'AOOULAU0'W0PGM                                               219608
     C                     MOVEL'LEBSTLPD'W0FILE                                              219608
     C                     MOVEL'AOBSTLR0'W0KEY                                               219608
     C                     MOVELWLNRF     W0KEY                                               219608
     C                     Z-ADD912       W0ERNB                                              219608
     C                     EXSR SRERR                                                         219608
     C                     ENDIF                                                              219608
     C                     ENDIF                                                              219608
      ** Else, inserting new allocations, so call AOSTALR2                                    219608
      ** to access the 'after' image of LESTALPD:                                             219608
     C                     ELSE                            ##REVI not YES                     219608
      *                                                                                       219608
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   WRTCD   7                                           CLE034
     C                     PARM '*FIRST ' WOPTN   7                                           CLE034
     C                     PARM           WTYPE   4                                           CLE034
     C                     PARM           WLNRF   6                                           CLE034
     C                     PARM           WVDAT   5                                           CLE034
     C                     PARM           WLSEQ   3                                           CLE034
     C                     PARM *ZEROS    WCFEE   6                                           CLE034
     C                     PARM *ZEROS    WFFEE   5                                           CLE034
     C                     PARM *ZEROS    WFSEQ   2                                           CLE034
     C                     PARM WPAYRC    WPAYR   1                                           CLE034
     C********** LESTAL    PARM LESTAL    DSSDY                                       CLE034 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       CLE034
     C           WRTCD     IFNE *BLANK                                                        CLE034
     C                     MOVEL'*CALL   'W0FILE                                              CLE034
     C                     MOVEL'AOSTALR2'W0KEY                                               CLE034
     C                     Z-ADD910       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       219608
     C                     ENDIF                           End ##REVI chk                     219608
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34B                                         *                       CLE034
      ** Function    :  Processing to calculate amount for settlement *                       CLE034
      **                allocation                                    *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
      ** If Allocations are by Percentage:                                                   BUG8962
     C           WPAYRC    IFEQ 'P'                                                           CLE038
     C           LSPYBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           WPAYRC    OREQ 'R'                                                           CLE038
     C           LSRCBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE038    ORNE 'Y'                                                           CLE038
      *                                                                                       CLE038
     C           WPAYRC    IFEQ 'P'                                                           CLE034
     C           SVAMT     MULT LSPYPC    WRK1   150H                                         CLE034
     C           WRK1      DIV  100       WAMT      H                                         CLE034
     C                     ELSE                                                               CLE034
     C           SVAMT     MULT LSRCPC    WRK1      H                                         CLE034
     C           WRK1      DIV  100       WAMT      H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE038
     C**********           ELSE                                                       CLE038 BUG8962
      **********                                                                      CLE038 BUG8962
     C********** WPAYRC    IFEQ 'P'                                                   CLE038 BUG8962
     C**********           Z-ADDLSPYAM    WAMT                                        CLE038 BUG8962
     C**********           ELSE                                                       CLE038 BUG8962
     C**********           Z-ADDLSRCAM    WAMT                                        CLE038 BUG8962
     C**********           ENDIF                                                      CLE038 BUG8962
      **********                                                                      CLE038 BUG8962
     C**********           ENDIF                                                      CLE038 BUG8962
      *                                                                                       CLE034
     C                     ADD  WAMT      WTOTAM                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C           WTOTAM    ANDNESVAMT                                                         CLE034
     C           SVAMT     SUB  WTOTAM    WDIFF  150                                          CLE034
     C                     ADD  WDIFF     WAMT                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDWAMT      ##AMT                                               CLE034
      *                                                                                      BUG8962
     C                     ELSE                                                              BUG8962
      ** Else, Allocations are by Amount:                                                    BUG8962
      *                                                                                      BUG8962
      ** If WRKFLD not 'Y', place Allocation Amount in WAMT field.                           BUG8962
     C           WRKFLD    IFNE 'Y'                                                          BUG8962
     C           WPAYRC    IFEQ 'P'                                                          BUG8962
     C                     Z-ADDLSPYAM    WAMT                                               BUG8962
     C                     ELSE                                                              BUG8962
     C                     Z-ADDLSRCAM    WAMT                                               BUG8962
     C                     ENDIF                                                             BUG8962
     C                     ELSE                                                              BUG8962
      ** Else, no more allocations to be processed:                                          BUG8962
     C                     Z-ADD0         WAMT                                               BUG8962
     C                     ENDIF                                                             BUG8962
      *                                                                                      BUG8962
     C                     Z-ADDWAMT      ##AMT                                              BUG8962
     C                     ENDIF                                                             BUG8962
      *                                                                                       CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34C                                         *                       CLE034
      ** Function    :  Processing to get next settlement allocation  *                       CLE034
      ** Calls       :  AOSTALR2 AOBSTLR0                             *                       219608
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE LNRF      WLNRF                                               CLE034
     C                     MOVE VDAT      WVDAT                                               CLE034
     C                     MOVE LASN      WLSEQ                                               CLE034
     C                     MOVE AMTP      WTYPE   4                                           CLE034
     C                     MOVEL'LA'      WTYPE                                               CLE034
      *                                                                                       CLE034
      ** If reversing existing allocations, call AOBSTLR0 to                                  219608
      ** access the 'before' image from LEBSTLPD:                                             219608
     C           ##REVI    IFEQ 'YES'                                                         219608
     C           BEFORE    ANDEQ*BLANKS                                                       219608
     C                     CALL 'AOBSTLR0'                                                    219608
     C                     PARM *BLANKS   WRTCD   7                                           219608
     C                     PARM '*NEXT '  WOPTN   7                                           219608
     C                     PARM           WTYPE   4                                           219608
     C                     PARM           WLNRF   6                                           219608
     C                     PARM           WVDAT   5                                           219608
     C                     PARM           WLSEQ   3                                           219608
     C                     PARM *BLANKS   WCFEE   6                                           219608
     C                     PARM *BLANKS   WFFEE   5                                           219608
     C                     PARM *BLANKS   WFSEQ   2                                           219608
     C                     PARM WPAYRC    WPAYR   1                                           219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
      ** Else, inserting new allocations, so call AOSTALR2                                    219608
      ** to access the 'after' image of LESTALPD:                                             219608
     C                     ELSE                            ##REVI not YES                     219608
      *                                                                                       219608
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   WRTCD                                               CLE034
     C                     PARM '*NEXT  ' WOPTN                                               CLE034
     C                     PARM           WTYPE                                               CLE034
     C                     PARM           WLNRF                                               CLE034
     C                     PARM           WVDAT                                               CLE034
     C                     PARM           WLSEQ                                               CLE034
     C                     PARM *ZEROS    WCFEE                                               CLE034
     C                     PARM *ZEROS    WFFEE                                               CLE034
     C                     PARM *ZEROS    WFSEQ                                               CLE034
     C                     PARM WPAYRC    WPAYR                                               CLE034
     C********** LESTAL    PARM LESTAL    DSSDY                                       CLE034 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
     C                     ENDIF                           End ##REVI chk                     219608
      *                                                                                       CLE034
     C           WRTCD     IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WRKFLD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34D                                         *                       CLE034
      ** Function    :  Set up fields from settlement allocation      *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WPAYRC    IFEQ 'P'                                                           CLE034
     C                     MOVE LSPSTM    SETP                                                CLE034
     C                     MOVE LSPONS    OSAC                                                CLE034
     C                     MOVE LSPOBR    OSBR                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE LSRSTM    SETP                                                CLE034
     C                     MOVE LSRONS    OSAC                                                CLE034
     C                     MOVE LSROBR    OSBR                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE LSRSTM    ##RECM                                              CLE034
     C                     MOVE LSRONS    ##RECA                                              CLE034
     C                     MOVE LSROBR    ##RECB                                              CLE034
     C                     MOVE LSPSTM    ##PAYM                                              CLE034
     C                     MOVE LSPONS    ##PAYA                                              CLE034
     C                     MOVE LSPOBR    ##PAYB                                              CLE034
     C                     MOVE LSPSCY    PSCY                                                CLE034
     C                     MOVE LSRSCY    SCCY                                                CLE034
     C                     MOVE LSPEXR    PEXR                                                CLE034
     C                     MOVE LSREXR    REXR                                                CLE034
     C                     MOVE LSPEXI    PEXI                                                CLE034
     C                     MOVE LSREXI    REXI                                                CLE034
      *                                                                                       CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           CLE031    ANDEQ'N'                                                           CLE034
     C           SCCY      ANDNE*BLANKS                                                       CLE034
     C                     MOVE SCCY      ##CCY                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE CCY       ##CCY                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE031    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   SVSCCY                                              227696
     C                     MOVE *BLANKS   SVPSCY                                              227696
     C           SCCY      IFNE *BLANKS                                                       CLE034
     C                     MOVE SCCY      SVSCCY                                              CLE034
     C                     ENDIF                                                              CLE034
     C           PSCY      IFNE *BLANKS                                                       CLE034
     C                     MOVE PSCY      SVPSCY                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                     AR943686
     C                     Z-ADDREXR      SVREXR                                            AR943686
     C                     MOVE REXI      SVREXI                                            AR943686
     C                     Z-ADDPEXR      SVPEXR                                            AR943686
     C                     MOVE PEXI      SVPEXI                                            AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34E                                         *                       CLE034
      ** Function    :                                                *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                                                              CLE034
     C                     MOVE SVLOAN    LOAMDK                                              CLE034
     C                     MOVE SVRECM    ##RECM                                              CLE034
     C                     MOVE SVRECA    ##RECA                                              CLE034
     C                     MOVE SVRECB    ##RECB                                              CLE034
     C                     MOVE SVPAYM    ##PAYM                                              CLE034
     C                     MOVE SVPAYA    ##PAYA                                              CLE034
     C                     MOVE SVPAYB    ##PAYB                                              CLE034
     C                     MOVE SVCCY     ##CCY                                               CLE034
     C                     MOVE S#SCCY    SVSCCY                                              CLE034
     C                     MOVE S#PSCY    SVPSCY                                              CLE034
     C**********           MOVE SVPEXR    PEXR                                       CLE034 AR943686
     C**********           MOVE SVREXR    REXR                                       CLE034 AR943686
     C**********           MOVE SVPEXI    PEXI                                       CLE034 AR943686
     C**********           MOVE SVREXI    REXI                                       CLE034 AR943686
     C                     Z-ADDW#REXR    SVREXR                                            AR943686
     C                     Z-ADDW#PEXR    SVPEXR                                            AR943686
     C                     MOVE W#REXI    SVREXI                                            AR943686
     C                     MOVE W#PEXI    SVPEXI                                            AR943686
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE031
      *                                                                                       CLE031
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SRSTAX - Generate Stamp tax shadow posting                   *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C           PTYP      IFEQ 61                                                            CER049
     C           PTYP      OREQ 62                                                            CER049
     C           PTYP      OREQ 63                                                            CER049
     C           PTYP      OREQ 64                                                            CER049
     C           PTYP      OREQ 65                                                            CER049
     C           PTYP      OREQ 68                                                            CER049
     C           PTYP      OREQ 70                                                            CER049
     C           PTYP      OREQ 71                                                            CER049
     C           PTYP      OREQ 80                                                            CER049
      *                                                                                       CER049
      ** Access loan extension file                                                           CER049
      *                                                                                       CER049
     C           LNRF      CHAINCLONCLL1             50                                       CER049
     C           *IN50     IFEQ *ON                                                           CER049
     C                     MOVEL'CLONCLL1'W0FILE                                              CER049
     C                     MOVELLNRF      W0KEY                                               CER049
     C                     Z-ADD902       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C** Check for retail account                                                             CER049
      *                                                                                       CER049
     C                     MOVE LQDCST    KDCST                                               CER049
     C                     MOVE LQDCCY    KDCCY                                               CER049
     C                     MOVE LQDACD    KDACD                                               CER049
     C                     MOVE LQDASC    KDASC                                               CER049
     C                     MOVE LQDBRC    KDBRC                                               CER049
     C                     CALL 'AOACCTR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM *ZEROS    LQRETL 100                                          CER049
     C                     PARM           KDCST   6                                           CER049
     C                     PARM           KDCCY   3                                           CER049
     C                     PARM           KDACD  10                                           CER049
     C                     PARM           KDASC   2                                           CER049
     C                     PARM           KDBRC   3                                           CER049
     C           SDACCT    PARM SDACCT    DSSDY                                               CER049
      ** If error occured, terminate the program                                              CER049
     C           @RTCD     IFNE *BLANKS                                                       CER049
     C           @RTCD     ANDNE'*NRF   '                                                     CER049
     C                     MOVEL'ACCNTAB 'W0FILE                                              CER049
     C                     MOVEL@OPTN     W0KEY                                               CER049
     C                     Z-ADD904       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           LQTAX     IFEQ 'Y'                                                           CER049
     C           RECI      ANDEQ'D'                                                           CER049
     C           ATYP      ANDEQ'R'                                                           CER049
     C           AMTP      ANDEQ'PI'                                                          CER049
      *                                                                                       CER049
     C                     MOVE ACNO      C#ACNO                                              CER049
     C                     MOVE 'R'       C#ATYP                                              CER049
     C                     MOVE *BLANKS   C#MEMS                                              CER049
     C                     MOVE *BLANKS   C#RSAC                                              CER049
     C                     MOVE ##AMT     WSTAX  150                                          CER049
      *                                                                                       CER049
     C** Get Stamp tax rate                                                                   CER049
      *                                                                                       CER049
     C                     MOVE LTYP      ##TYPE                                              CER049
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM VDATX     U#DATE  50                                          CER049
     C                     PARM 'LOAN'    U#ORGN 10                                           CER049
     C                     PARM           ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C           PTYP      IFEQ 62                                                            CER049
     C           PTYP      OREQ 63                                                            CER049
     C           PTYP      OREQ 70                                                            CER049
     C                     CALL 'SD008142'                                                    CER049
     C                     PARM           PVALD   60                                          CER049
     C                     PARM           PMATD   60                                          CER049
     C                     PARM           SDSTPD                                              CER049
     C                     PARM           U#TAXR                                              CER049
     C                     PARM *BLANKS   U#PERD  1                                           CER049
     C                     PARM 0         U#TXBR 138                                          CER049
     C                     PARM 0         U#MNTH  70                                          CER049
     C                     PARM           VDATX                                               CER049
     C                     PARM           MDATX                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           CCY       IFNE LQDCCY                                                        CER049
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C                     MOVE LQDCCY    WCCY                                                CER049
     C                     EXSR SRCURR                                                        CER049
     C                     MOVE A6NBDP    NDP     10                                          CER049
     C                     MOVELA6SPRT    ZRATE1 138                                          CER049
     C                     MOVELA6MDIN    ZMDI1   1                                           CER049
      *                                                                                       CER049
      ** Access transaction currency for decimal places                                       CER049
      *                                                                                       CER049
     C                     MOVE CCY       WCCY                                                CER049
     C                     EXSR SRCURR                                                        CER049
     C                     MOVELA6SPRT    ZRATE2 138                                          CER049
     C                     MOVELA6MDIN    ZMDI2   1                                           CER049
      *                                                                                       CER049
      ** Get exchange rate                                                                    CER049
      *                                                                                       CER049
     C                     EXSR RTZXRT                                                        CER049
      *                                                                                       CER049
     C                     Z-ADDZRATEX    ZEXCH                                               CER049
     C                     MOVE ZMDI1     ZMD                                                 CER049
     C                     Z-ADDWSTAX     ZAMTCI                                              CER049
     C                     Z-ADDA6NBDP    ZCDPI                                               CER049
     C                     Z-ADDNDP       ZCDPO                                               CER049
     C                     EXSR ZCONV                                                         CER049
     C                     Z-ADDZAMTCO    WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           WSTAX     MULT U#TAXR    C#AMT                                               CER049
      *                                                                                       CER049
     C           C#AMT     IFLT 0                                                             CER049
     C                     MULT -1        C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           ##REVI    IFNE *BLANKS                                                       CER049
     C                     Z-SUBC#AMT     C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     MOVE LQDCCY    C#CCY                                               CER049
      *                                                                                       CER049
     C                     CALL 'AOSPOSU0'             9090                                   CER049
     C           R#RTN     PARM ##RTCD    O#RTN                                               CER049
     C                     PARM '*ADD    'W0ACT                                               CER049
     C                     PARM C#DTA     O#DTA                                               CER049
      *                                                                                       CER049
     C           *IN90     IFEQ '1'                                                           CER049
     C           R#RTN     OREQ '*ERROR*'                                                     CER049
     C                     MOVEL'*CALL   'W0FILE                                              CER049
     C                     MOVEL'AOSPOSU0'W0KEY                                               CER049
     C                     Z-ADD905       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
     C/COPY WNCPYSRC,AOOULAU0C1
     C/SPACE 5
     C/COPY ZSRSRC,ZDAT10Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDLINTZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZCBDYSZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE9Z3                                               182370
     C/SPACE 5                                                            182370
      /TITLE SR/ZCONV                                                                         CLE031
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE031
     C/SPACE 5                                                                                CLE031
     C/COPY ZSRSRC,RTZXRTC1                                                                   CER049
** ##LDT  **      Loan Processing Types                                                       CLE034
66676972
** ##NAR  **      NARRATIVES
VALUE
INTEREST
REPAYMENT
MATURITY
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           CLE031
0000001                                                                                       CLE031
0000010                                                                                       CLE031
0000100                                                                                       CLE031
0001000                                                                                       CLE031
0010000                                                                                       CLE031
0100000                                                                                       CLE031
1000000                                                                                       CLE031
**   SVAL  -  SYSTEM VALUES ARRAY                                                             CLE033
Settlement09Customer                                                                          CLE033
Settlement09AccCode                                                                           CLE033
Settlement09Hostpgm                                                                           CLE033
Settlement09Postings                                                                          218782
**   #CMD  -  OVERRIDE COMMAND                                                                CLE033
OVRDBF     FILE(AOLOAN) TOFILE(XXXXXXXXXX) SHARE(*NO) SECURE(*YES)                            CLE033
**   #AM   -  AMENDMENT TYPE                                                                  CLE033
Manual Repayment                                                                              CLE033
Repayment Schedule                                                                            CLE033
Principal Increase                                                                            CLE033
Transfer From                                                                                 CLE033
Transfer To                                                                                   CLE033
