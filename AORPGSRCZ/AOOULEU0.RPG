     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AO On-line update of LE position files')         *
      *****************************************************************
      *                                                               *
      *  Midas - Access Objects Module                                *
      *                                                               *
      *     AOOULEU0 - On-line Update of LE Positions files           *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. AR845759           Date 12Oct23               *
      *  Prev Amend No. MD037299           Date 11Jul23               *
      *                 249385             Date 01Aug22               *
      *                 MD059570           Date 15Mar21               *
      *                 MD058815           Date 28Sep21               *
      *                 MD058984           Date 19Oct21               *
      *                 CLE172             Date 01Oct20               *
      *                 CSD103             Date 10Aug20               *
      *                 MD055733           Date 03Jul20               *
      *                 CER050             Date 16Jun19               *
      *                 MD053295           Date 13Apr19               *
      *                 233920             Date 12Jul17               *
      *                 MD050139           Date 23Mar18               *
      *                 MD047554           Date 11Oct17               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD030939           Date 12Jul17               *
      *                 MD021236           Date 12Jul17               *
      *                 AR792284           Date 12Jul17               *
      *                 MD035919A          Date 07Jul17               *
      *                 MD033759           Date 14Apr15               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 AR943686           Date 23Sep16               *
      *                 MD006755           Date 25Sep14               *
      *                 AR1001269          Date 17Dec15               *
      *                 CLE154             Date 07Aug12               *
      *                 MD028338           Date 25Nov14               *
      *                 MD025243           Date 10May14               *
      *                 MD024998A          Date 08May14               *
      *                 MD024998           Date 08May14               *
      *                 MD021689B          Date 10Sep13               *
      *                 MD021689A          Date 27Aug13               *
      *                 MD021689           Date 12Aug13               *
      *                 AR868380           Date 10Jun13               *
      *                 AR830785           Date 07May13               *
      *                 262642             Date 09Jan13               *
      *                 260891             Date 17Dec12               *
      *                 AR1072392          Date 26Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR317587           Date 19Aug11               *
      *                 AR819068           Date 23Aug11               *
      *                 CER049             Date 06Dec10               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG25226A          Date 08Sep08               *
      *                 CER016A            Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      *                 252039             Date 11Jan08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247544             Date 16May07               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 26Sep06               *
      *                 241166             Date 17Jul06               *
      *                 228871             Date 06Jun06               *
      *                 225849             Date 06Jun06               *
      *                 223739             Date 06Jun06               *
      *                 224582             Date 06Jun06               *
      *                 238838 (Re-open)   Date 29May06               *
      *                 237596             Date 29Apr06               *
      *                 238838             Date 05Apr06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8962            Date 13Oct05               *
      *                 BUG8713            Date 27Sep05               *
      *                 BUG8924            Date 26Sep05               *
      *                 BUG8747            Date 26Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE036             Date 22Sep03               *
      *                 227696             Date 03Jun04               *
      *                 CLE038             Date 11May04               *
      *                 223582             Date 10Dec03               *
      *                 223592             Date 05Dec03               *
      *                 223581             Date 04Dec03               *
      *                 218984R            Date 04Nov03               *
      *                 221505R            Date 27Oct03               *
      *                 CIR013             Date 25Apr05               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 CPK018             Date 15Nov03               *
      *                 222373             Date 30Oct03               *
      *                 221505             Date 17Oct03               *
      *                 218984             Date 14Oct03               *
      *                 221936             Date 09Oct03               *
      *                 220754             Date 02Sep03               *
      *                 CAP074             Date 08Aug02               *
      *                 220257             Date 31Jul03               *
      *                 219608             Date 14Jul03               *
      *                 218782             Date 18Jun03               *
      *                 CLE034             Date 22May03               *
      *                 217270             Date 20May03               *
      *                 216999             Date 15Apr03               *
      *                 CLE033             Date 26Mar03               *
      *                 CLE031             Date 28Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 207497             Date 16Jul02               *
      *                 205504             Date 10Jun02               *
      *                 204130             Date 29Apr02               *
      *                 201672             Date 29Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 191051             Date 04Sep01               *
      *                 168750             Date 26Jul01               *
      *                 168066             Date 26Jul01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 182370             Date 05Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 182725             Date 19Feb01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 173122             Date 23Mar00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 175450             Date 09Mar00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 146556             Date 10NOV98               *
      *                 137130             Date 25SEP98               *
     F*                      134761             DATE  06MAY98         *
     F*                      CEU004             DATE  28MAR98         *
     F*                      125373             DATE  18FEB98         *
     F*                      122960             DATE 15SEP97          *
     F*                      082738             DATE 20JUN96          *
     F*                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR845759 - Extend the fix AR819282 to maturity interest.     *
      *             (Child: AR845760)                                 *
      *  MD037299 - Looping encountered when loan's maturity date is  *
      *             31st December 2071. Based on MD-24938/AR830785.   *
      *  249385 - Ensure input fields ZDAYNO keeps original value     *
      *            (Recompiled due to changes in ZBKDT)               *
      *  MD059570 - Shadow posting for reversed Participation sold    *
      *             shows as Debit rather than credit. Add checking   *
      *             to ##LOD and pass correct value befor call to     *
      *             SRREVS.                                           *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Based from MD052690 (Recompile)                   *
      *  MD058984 - Unable to complete rollover input due to database *
      *             error 917. Call AOBSRTR0 in SR/SRROLL only if     *
      *             NBRA is not blank.                                *
      *  CLE172 - LIBOR Deregulation - Lending                        *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  233920 - LE Wrong Shadow post.                               *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD047554 - Create shadow postings of INTEREST and MATURITY   *
      *             with recalculated amount based on New Spread Rate,*
      *             New Base Rate, New Interest Calculation Basis,    *
      *             or New Maturity Date brought by Rollover.         *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD030939 - REVERSE 252039. MATURITY PRINCIPAL PROJECTION     *
      *             will cover all unpaid principal amount.           *
      *           - Applied for MD-36113.                             *
      *  MD021236 - WRONG REPAYMENT AMOUNT REVERSAL POSTING. ONLY     *
      *             override posting amount if RAMT > CPAM (-AR792284)*
      *           - Applied for MD-36113.                             *
      *  AR792284 - When amendment to repayment type 3 loan with RAMT *
      *             greater than CPAM is allowed, posting imbalance   *
      *             occurs. Amended program to ensure that calculated *
      *             interest for specific period + CPAM is considered *
      *             for posting when amendment is made.               *
      *           - Applied for MD-36113.                             *
      *  MD035919A - No PAMV generated for LOAM/BC                    *
      *             Reversal posting generated when a back valued base*
      *             rate change is issued to a PDCL interest when     *
      *             there is only the maturity posting to be reversed *
      *  MD033759 - Incorrect projected movements due to wrong rate   *
      *             used when calculating interest. Recompile due to  *
      *             changed LF/HISTO.                                 *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  AR943686 - CLE031. System generating wrong projected move-   *
      *             ments. Populate settlement details field with     *
      *             passed value. (Child: AR943687)                   *
      *           - Applied for MD-40690                              *
      *  MD006755 - Interest postings not generated after changing    *
      *             NIDT due to incorrect value of AUTO and incorrect *
      *             calculation of principal amount after changing    *
      *             MDAT, both due to the MR record in PF/LOAMSDK.    *
      *  AR1001269 - Incorrect negative entries to RSACMTPD after     *
      *              changing maturity date of the loan. Move ZIEND   *
      *              to WLICD at the end of SR/SRINCL. It would be    *
      *              executed even when WCUPR or WCURT is zero.       *
      *              (Child: AR1001271)                               *
      *            - Applied for MD035938                             *
      *  CLE154 - Loan Repayment Schedule Enhancement                 *
      *  MD028338 - Interest calculation has rounding difference for  *
      *             Rollover of Facility Exchange Rate only. Add new  *
      *             field to flag the rollover as 'FX Rate Change     *
      *             Only'. If this is Y, skip interest calculation.   *
      *           - Skip also SRINCL when AMTPH = LS or MI            *
      *  MD025243 - Do not use the absolute value of a negative CPAM  *
      *             for ##LPCP to consider an overpaid loan in the    *
      *             calculation.                                      *
      *  MD024998A - Projected account movements incorrect for accrued*
      *             interest adjustment                               *
      *  MD024998 - Projected account movements incorrect for accrued *
      *             interest adjustment                               *
      *  MD021689B - Wrong projected account movements after loan     *
      *              reversal                                         *
      *  MD021689A - System generated a projected credit entry of     *
      *              principal amount on client's account upon        *
      *              loan reversal                                    *
      *  MD021689 - Wrong projected account movements after loan      *
      *             reversal                                          *
      *  AR868380 - APISERVER on LCKW status. Return *RECLCK to       *
      *             calling program if file locking occurred on       *
      *             online position files. (Child: AR868381)          *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Enhanced core fix 263533. (Child: AR830786)       *
      *  262642 - Debit movement generated for a loan where value date*
      *           equals start date and amount equals the principal   *
      *           amount after amendment of loan. Fix ensures that no *
      *           value date posting is generated after the loan has  *
      *           started. Applied fix 252764A and part of 253815.    *
      *  260891 - Wrong projection in LOAC. Add LCD as a key.         *
      *           Recompiled due to changes in LF/HISTR.              *
      *  AR1072392 - Principal amort due with Auto Settle "C"         *
      *              not shown in the Projected Account Movements     *
      *              Enquiry                                          *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR317587 - Matured Loan can't be recovered using maturity    *
      *             date as the value date of the manual repayment.   *
      *             Amended program to allow value date of MR greater *
      *             than Maturity date for past due loans.            *
      *             (Child: AR810533)                                 *
      *  AR819068 - Serious Midas Error in CLIP                       *
      *  CER049 - Stamp Tax                                           *
      *  CRE073 - Interest Rate Rounding                              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG25226A - Field 61 on MT942 is not showing correct data    *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  252039 - Allow to project the Repayment if Maturity is equals*
      *           to Repayment date.                                  *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  241166 - Modify certain shadow posting narrative to include  *
      *         - transaction ref if SdwPstIncTransRef = 'Y'          *
      *  228871 - Interest posting was generated with zero value date.*
      *  225849 - Incorrect projection of interest. Interest past     *
      *           due should not be deducted from maturity interest.  *
      *           Applied fix 223981.                                 *
      *  223739 - Input of various loan actions causes errors in      *
      *           Projected Account Movements.                        *
      *  224582 - Capitalised interest should be projected on         *
      *           maturity date.                                      *
      *  238838 - (Re-open) Consider PDDI when computing for the next *
      *           interest and repayment date.                        *
      *           Applied fix 239146 as a preventative fix to correct *
      *           projection of interest when a loan is amended.      *
      *  237596 - Reversal of loan do not generate reversal of        *
      *           interest. This fix has already been done by fixes   *
      *           221505R and 218984R.                                *
      *  238838 - Projected maturity amount incorrect. Initialise     *
      *           current principal correctly.                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8962- Wrong postings for Allocations by Amount that use   *
      *           Settlement currencies. Extra 'difference' posting   *
      *           is only required for Allocations by Percentage.     *
      *  BUG8713- HOBENN (Benefeciary No) field on LEHOSTPD is not    *
      *           populated                                           *
      *  BUG8924- Incorrect postings for Settlement Allocation when   *
      *           amount is used. Use very long Dummy DS.             *
      *  BUG8747 - Compute for the interest and generate shadow       *
      *           postings for interest for loans with repayment type *
      *           equal to 1.                                         *
      *  CLE106 - Syndications Manager.                               *
      *  CLE036 - Lending Enhancements for Nordea Phase 1 Priority 2  *
      *           (Recompile)                                         *
      *  227696 - Need to reset the saved pay and receive settlement  *
      *           currencies to blank if using settlement allocations *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  223582 - Need to ensure that the interest for the first      *
      *           period, ZFIRST, is zeroised each time.              *
      *  223592 - When working out principal at maturity, need to     *
      *           process principal transfers as well as PI, MR and RE*
      *  223581 - When a loan is amended and have passed value date   *
      *           and value date is in the past, do not generate      *
      *           LEHOSTPD records for value date.                    *
      *  218984R- The repayment date needs to be reset after a        *
      *           rollover where there is a repayment or increase or  *
      *           a multi currency rollover. Repayment date which is  *
      *           the same as the rollover, should be projected.      *
      *           Next Interest Payment Date should only be projected *
      *           once if there is a rollover.                        *
      *  221505R- Need to ensure the interest has been calculated up  *
      *           to the next interest payment date, if it is a call  *
      *           loan. Interest amount at maturity should take off   *
      *           the amount of interest at next interest date, not   *
      *           the amount of interest at last interest date        *
      *           before maturity.                                    *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC, ZINTDY, ZDLINT and ZCBDYS.   *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CPK018 - MidasPlus additional packaging.                     *
      *  222373 - Correct parameters on program calls.                *
      *  221505 - When a loan is reversed, need to project the        *
      *           reversing of the interest paid to date as well as   *
      *           the principal.                                      *
      *  218984 - Rollovers where there is a repayment or increase    *
      *           need to be processed. These are identified as       *
      *           non-multi currency rollovers where a new facilty    *
      *           exchange rate and a new principal amount have been  *
      *           defined.                                            *
      *           Also reversing part of 182725. This should not have *
      *           been including loan amendments in the value date    *
      *           movement                                            *
      *  221936 - Ensure Settlement Allocation field is not overridden*
      *  220754 - (Supplemental Change).  Extra Repayment posting in  *
      *           new ccy appeared after MC rollover. All the MC RO   *
      *           postings on LEHOSTPD had a 'Reverse' action and the *
      *           two rollover events just had a type of 'ROLLOVER'.  *
      *           Calculate maturity interest from MC RO date.        *
      *         - Multi-currency rollovers need to be processed.      *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  220257 - Negative amounts should be converted to positive on *
      *           LEHOSTPD and the Pay/Receive indicator changed      *
      *  219608 - Amendment of Settlement Allocations needs a 'Before'*
      *           image to ensure the right allocations are reversed. *
      *  218782 - Add Program ref, Sequence Number & Status fields to *
      *           LEHOSTPD. Check system value Settlement09Postings to*
      *           decide whether to use Settlement or Transaction Ccy.*
      *  CLE034 - Lending Enhancements for Phase 1 Priority 1A.       *
      *  217270 - Amending loan on loan manager produces duplicate    *
      *           records on LEHOSTPD                                 *
      *  216999 - Maturity records generated on RSACMTPD when maturity*
      *           date is blank                                       *
      *  CLE033 - Settlement method 09                                *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  207497 - Access SDMMODPD to check if Retail is installed,    *
      *           and only call AORETLR0 if it is.                    *
      *  205504 - When interest payment date is equal to maturity     *
      *           date and repayment date is equal to maturity date,  *
      *           SRRPAY should not be executed.                      *
      *  204130 - Include manual interest adjustment in the           *
      *           projection.                                         *
      *  201672 - Calculate projected interest and principal on       *
      *           maturity.                                           *
      *  191051 - Ensure that when changing settlement account details*
      *           and new account is in Euro, reverse proj movement   *
      *           for old settlement ('In' ccy) account.              *
      *  168750 - In Insert mode, default BRCA to Branch Settlement   *
      *           if it is BLANK.                                     *
      *  168066 - Program crashed when settlement type 04 used,       *
      *           since it uses the "partial ledger" account type     *
      *           but these details are not passed from LE2030.       *
      *  182370 - Incorrect calculation of number of days for calcu-  *
      *           lation basis 6. Amended /COPY such that for calcu-  *
      *           lation basis 6, the number of days per year is      *
      *           equal to 366 when the year in question is a leap    *
      *           year, and 365 days/year for non-leap years. Calcu-  *
      *           lation was made so that processing would be in-line *
      *           with that of /COPY ZINTDY.                          *
      *  182725 - Manual Repayments and Repayment schedules are not   *
      *           taken into consideration when processing shadow     *
      *           postings.                                           *
      * 173122 - Amend this processing to include the manual adjustment  *
      *          to interest outstanding and posted in the computation   *
      *          of interest in order to reflect the correct interest    *
      *          due in Projected A/C Movements.                         *
      *  175450 - Generate only Interest Payment Date Account         *
      *           Movement for Guarantee loan.                        *
      * CIR004 - Dealing Calculation Method Change.                   *
      *        - Recompiled due to ZCBDYS changes                     *
     F* 146556 - Fixed PI and Interest being converted twice.            *
     F* 137130 - Do not generate repayment postings if                   *
     F*          auto-settled and next repay date = maturity date        *
     F*          Do not generate postings if loan is not set to          *
     F*          auto-settle.  Applied fixes 130226 and 125753.          *
     F* CEU004 - LE Settlement Ccy Conversion Upgrade to DBA R2.0        *
     F* 134761 - Remove duplicate AOSARDR0 call for CEU004.              *
     F* 125373 - START SETTLEMENTS SHOULD NOT BE VALIDATED WHEN AMENDING *
     F*          LOAN                                                    *
     F* 122960 - Do not rollback lending updates in batch mode.          *
     F* 082738 - New program for redesign of update to PRONO, MEMOS,     *
     F*          OLPOS & RSACMTPD.                                       *
     F*                                                                  *
     F********************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*****************************************************************
     FLOAMSOM2IF  E           K        DISK                                                   201672
     FLOAMSOM1IF  E           K        DISK                                                   201672
     F            LOAMSDKF                          KRENAMEOMLOAM                             201672
     F***HISTR** IF  E           K        DISK                                         201672 238838
     FHISTO   IF  E           K        DISK                                                   238838
     F*CLOAN   IF  E           K        DISK
     F*           CLOANHHF                          KIGNORE
     F*           CLOANZ1F                          KIGNORE
     F*LOAMS***IF**E           K        DISK                                                  201672
     F**********  LOAMSZ1F                          KIGNORE                                   201672
     FACNUM   IF  E           K        DISK                                                   191051
     FLEHOSTPDO   E                    DISK                               CLE033
     F                                              KCOMIT                CLE033
     FLEHISTHPIF  E           K        DISK                                                 MD021689
     F            HISTSHPF                          KRENAMEHISTSHPP                         MD021689
     FLEADINL1IF  E           K        DISK                                                 MD024998
     F/COPY WNCPYSRC,AOOULEU0F1
     E/SPACE 5
     E*
     E**  Loan processing types
     E********************##LDT   2   2  2 0                              CLE034
     E                    ##LDT   4   4  2 0                              CLE034
     E*
     E**  (Posting) Naratives
     E***************     ##NAR   1   4 30                                                    220754
     E***************     ##NAR   1   6 30                                             220754 218984
     E                    ##NAR   1   8 30                                                    218984
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E                    ZF29   14  32  5 0             29TH FEB ARRAY
     E*
     E*  Subroutine stack
     E                    @STK       20 10
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY ZSRSRC,ZFREQBZ1                                                                   201672
     E/COPY ZSRSRC,ZHOLE                                                                      201672
     E/COPY ZSRSRC,ZPOWERZ1                                                                   CLE031
     E/COPY WNCPYSRC,AOH00047
      *                                                                   CLE033
     E**  System values array                                             CLE033
     E**********          SVAL    1   3 20                                             CLE033 218782
     E**********          SVAL    1   4 20                                             218782 241166
     E**********          SVAL    1   5 20                                           241166 MD035545
     E                    SVAL    1   6 20                                                  MD035545
      *                                                                   CLE033
     E*  Amendment types                                                  CLE033
     E                    #AM     1   3 20                                CLE033
      *                                                                                       CSC022
      ** Array for job name                                                                   CSC022
      *                                                                                       CSC022
     E                    JBNAM      10 10                                                    CSC022
      /EJECT                                                                                  201672
     IOMLOAM                                                                                  201672
      ** Rename loan amendment fields                                                         201672
     I              RECI                            RECIL                                     201672
     I              LNRF                            LNRFL                                     201672
     I              CNUM                            CNUML                                     201672
     I              VDAT                            VDATL                                     201672
     I              LASN                            LASNL                                     201672
     I              AMTP                            AMTPL                                     201672
     I              RTSP                            RTSPL                                     201672
     I              CCY                             CCYL                                      201672
     I              PRAM                            PRAML                                     201672
     I              INTA                            INTAL                                     201672
     I              WTXA                            WTXAL                                     201672
     I              FEAM                            FEAML                                     201672
     I              TAMT                            TAMTL                                     201672
     I              BRCA                            BRCAL                                     201672
     I              REPT                            REPTL                                     201672
     I              AUTO                            AUTOL                                   MD006755
     I              STAI                            STAIL                                     201672
     I              SETP                            SETPL                                     201672
     I              BRTE                            BRTEL                                     201672
     I              SPIN                            SPINL                                     201672
     I              WTIN                            WTINL                                   MD047554
     I              INTC                            INTCL                                     201672
     I              ORED                            OREDL                                     201672
     I              IRCF                            IRCFL                                     201672
     I              LCD                             LCDL                                      201672
     I              ROLN                            ROLNL                                     201672
     I              PDDI                            PDDIL                                     201672
     I              PTDI                            PTDIL                                     201672
     I              TNLU                            TNLUL                                     CLE033
     I              STAL                            STALL                                     221936
      *                                                                                       201672
     IHISTSHMF                                                                                201672
      ** Rename history header fields                                                         201672
     I              BRCA                            BRCAH                                     201672
     I              CNUM                            CNUMH                                     201672
     I              LNRF                            LNRFH                                     201672
     I              VDAT                            VDATH                                     201672
     I              CCY                             CCYH                                      201672
     I              AMTP                            AMTPH                                     201672
     I              PRAM                            PRAMH                                     201672
     I              BRTE                            BRTEH                                     201672
     I              RTSP                            RTSPH                                     201672
     I              SPIN                            SPINH                                     201672
     I              REPT                            REPTH                                     201672
     I              INTC                            INTCH                                     201672
     I              SUTP                            SUTPH                                     201672
     I              LCD                             LCDH                                      201672
     I              CPAM                            CPAMH                                     201672
     I              AITC                            AITCH                                     201672
     I              INTR                            INTRH                                     201672
     I              AIAP                            AIAPH                                     201672
     I              IPRD                            IPRDH                                     201672
     I              WTIN                            WTINH                                     201672
     I              TOTI                            TOTIH                                     201672
     I              CALC                            CALCH                                     201672
     I              CLAS                            CLASH                                     CLE042
      *                                                                                       201672
     IHISTSHPF                                                                                201672
      ** Rename history amount fields                                                         201672
     I              BRCA                            BRCAH                                     201672
     I              CNUM                            CNUMH                                     201672
     I              LNRF                            LNRFH                                     201672
     I              VDAT                            VDATH                                     201672
     I              CCY                             CCYH                                      201672
     I              AMTP                            AMTPH                                     201672
     I              PRAM                            PRAMH                                     201672
     I              INTA                            INTAH                                     201672
     I              WTXA                            WTXAH                                     201672
     I              FEAM                            FEAMH                                     201672
     I              WOIN                            WOINH                                     201672
     I              SUTP                            SUTPH                                     201672
     I              LCD                             LCDH                                      201672
     I              CPAM                            CPAMH                                     201672
     I              AITC                            AITCH                                     201672
     I              INTR                            INTRH                                     201672
     I              AIAP                            AIAPH                                     201672
     I              IPRD                            IPRDH                                     201672
     I              MNSG                            MNSGH                                     201672
     I              GASS                            GASSH                                     201672
     I              ROLN                            ROLNH                                     201672
     I              CLAS                            CLASH                                     CLE042
     I              REPT                            REPTH                                     CLE154
      *                                                                                       201672
     IHISTSHQF                                                                                201672
      ** Rename history rate fields                                                           201672
     I              BRCA                            BRCAH                                     201672
     I              CNUM                            CNUMH                                     201672
     I              LNRF                            LNRFH                                     201672
     I              VDAT                            VDATH                                     201672
     I              CCY                             CCYH                                      201672
     I              AMTP                            AMTPH                                     201672
     I              BRTE                            BRTEH                                     201672
     I              RTSP                            RTSPH                                     201672
     I              SPIN                            SPINH                                     201672
     I              STAI                            STAIH                                     201672
     I              IRCF                            IRCFH                                     201672
     I              LCD                             LCDH                                      201672
     I              CPAM                            CPAMH                                     201672
     I              AITC                            AITCH                                     201672
     I              INTR                            INTRH                                     201672
     I              AIAP                            AIAPH                                     201672
     I              IPRD                            IPRDH                                     201672
     I              MNSG                            MNSGH                                     201672
     I              RLCY                            RLCYH                                     201672
     I              CALC                            CALCH                                     201672
      *                                                                                     MD028338
      ** Reuse filler ZZ001 to serve as FX Rate Change Only Indicator                       MD028338
      *                                                                                     MD028338
     I              ZZ001                           FRCOH                                   MD028338
     I/SPACE 5
     I*
     I** Rename fields on LOAMSDK
     I*
     ILOAMSDKF
     I              RECI                            LARECI
     I              LNRF                            LALNRF
     I              VDAT                            LAVDAT
     I              PTYP                            LAPTYP
     I              RTSP                            LARTSP
     I              CCY                             LACCY
     I              BRCA                            LABRCA
     I              REPT                            LAREPT
     I              AUTO                            LAAUTO                                  MD006755
     I              INTC                            LAINTC
     I              CHTP                            LACHTP
     I              TNLU                            LATNLU                                    CLE033
     I              STAL                            LASTAL                                    221936
     I              WTIN                            LAWTIN                                  MD047554
     I*                                                                                       CLE033
     ILOAMSDHF                                                                                CLE033
     I              TNLU                            LHTNLU                                    CLE033
     I*
     IACCNTABF                                                                                191051
     I              RECI                            ACRECI                                    191051
     I              CNUM                            ACCNUM                                    191051
     I              CCY                             ACCCY                                     191051
     I              ACOD                            ACACOD                                    191051
     I              ACSQ                            ACACSQ                                    191051
     I              BRCA                            ACBRCA                                    191051
     I              TNLU                            ACTNLU                                    CLE033
     I*                                                                   CLE033
     I*SDSVAL***E*DSSDSVALPD*                                                          CLE033 222373
      ****EXTERNAL*DS*FOR*SYSTEM*VALUES*                                               CLE033 222373
     IHISTSHPP                                                                              MD021689
      ** Rename history amount fields                                                       MD021689
     I              BRCA                            BRCAP                                   MD021689
     I              CNUM                            CNUMP                                   MD021689
     I              LNRF                            LNRFP                                   MD021689
     I              VDAT                            VDATP                                   MD021689
     I              CCY                             CCYP                                    MD021689
     I              AMTP                            AMTPP                                   MD021689
     I              PRAM                            PRAMP                                   MD021689
     I              INTA                            INTAP                                   MD021689
     I              WTXA                            WTXAP                                   MD021689
     I              FEAM                            FEAMP                                   MD021689
     I              WOIN                            WOINP                                   MD021689
     I              SUTP                            SUTPP                                   MD021689
     I              LCD                             LCDP                                    MD021689
     I              CPAM                            CPAMP                                   MD021689
     I              AITC                            AITCP                                   MD021689
     I              INTR                            INTRP                                   MD021689
     I              AIAP                            AIAPP                                   MD021689
     I              IPRD                            IPRDP                                   MD021689
     I              MNSG                            MNSGP                                   MD021689
     I              GASS                            GASSP                                   MD021689
     I              ROLN                            ROLNP                                   MD021689
     I              CLAS                            CLASP                                   MD021689
      *                                                                                     MD024998
     ILEADINP0                                                                              MD024998
     I              RECI                            AIRECI                                  MD024998
     I              LNRF                            AILNRF                                  MD024998
     I              CNUM                            AICNUM                                  MD024998
     I              CCY                             AICCY                                   MD024998
     I              BRCA                            AIBRCA                                  MD024998
     I              FCUS                            AIFCUS                                  MD024998
     I              FTYP                            AIFTYP                                  MD024998
     I              FSEQ                            AIFSEQ                                  MD024998
     I              TNLU                            AITNLU                                  MD024998
     I              ACAJ                            AIACAJ                                  MD024998
     I              PCRF                            AIPCRF                                  MD024998
     I              ASTS                            AIASTS                                  MD024998
     I              CHTP                            AICHTP                                  MD024998
     I              AMTP                            AIAMTP                                  MD024998
     I              IUSR                            AIIUSR                                  MD024998
     I              AUSR                            AIAUSR                                  MD024998
     I              XUSR                            AIXUSR                                  MD024998
      *                                                                                       191051
     ISDMMOD    E DSSDMMODPD                                                                  207497
      ** Midas modules details                                                                207497
      *                                                                                       207497
     ISDBSRT    E DSSDBSRTPD                                                                  CLE172
      **  EXTERNAL DS FOR BASE RATE DETAILS                                                   CLE172
     ISDBANK    E DSSDBANKPD                                              125373
      ** BANK DETAILS                                                     125373
     I              BJRDNB                          RUND                  125373
     I              BJBVPD                          BVLP                  125373
      *                                                                                       191051
     ISDGELR    E DSSDGELRPD                                                                  191051
      *                                                                                       191051
     ISDCUST    E DSSDCUSTPD                                                               BUG25226A
      * Customer Details Accessed via Access program                                       BUG25226A
     I              QQDFAC                          QQDFA1                                 BUG25226A
      *                                                                                    BUG25226A
     IPSDS       SDS                                                                          CSC022
     I                                     *PROGRAM WDSPGM                                    CSC022
     I                                      244 253 WDSJOB                                    CSC022
     IDSFDY     E DSDSFDY                                                 125373
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                125373
     I/COPY WNCPYSRC,AOOULEU0I1
      *                                                                   168066
      * external data structure - retail ICD                              168066
     ISDRETL    E DSSDRETLPD                                              168066
     I              QQACCD                          QQACCX                                    CGL029
      *                                                                                       CER049
     ICLONQD    E DSLESTMP2PD                                                                 CER049
      *                                                                                       CER049
     ISDSTPD    E DSSDSTPDPD                                                                  CER049
      *                                                                                       CER049
     ISDACCT    E DSACCNTAB                                                                   CER049
     I              RECI                            A1RECI                                    CER049
     I              CNUM                            A1CNUM                                    CER049
     I              CCY                             A1CCY                                     CER049
     I              ACOD                            A1ACOD                                    CER049
     I              ACSQ                            A1ACSQ                                    CER049
     I              BRCA                            A1BRCA                                    CER049
     I              TNLU                            A1TNLU                                    CER049
     I              PRFC                            A1PRFC                                    CER049
     I              ORED                            A1ORED                                    CER049
     I              LCD                             A1LCD                                     CER049
     I              CHTP                            A1CHTP                                    CER049
     I              PTFR                            A1PTFR                                    CER049
     I              HLEX                            A1HLEX                                    CER049
     I              REPI                            A1REPI                                    CER049
     I              FRNT                            A1FRNT                                    CER049
     I              AFRT                            A1AFRT                                    CER049
     I              REPA                            A1REPA                                    CER049
     I              TMST                            A1TMST                                    CER049
     I              AUTH                            A1AUTH                                    CER049
     I              ZZ004                           A1ZZ04                                    CER049
      *                                                                                       CER049
      *                                                                                       201672
     IDSSDY     E DSDSSDY                                                                     201672
      ** Second DS for access programs, long data structure                                   201672
     IDSLDY     E DSDSLDY                                                                    BUG8924
      ** Third DS for access programs, very long data structure                              BUG8924
     ILDA       E DSLDA                                                                       CSC022
     I*** Local data area for database error details                                          CSC022
      *                                                                                       201672
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
     IZ#BSTK      DS                           2048                                           220754
     IZ#ASTK      DS                           2048                                           220754
     I*
     ILOANCL    E DSCLOANCL
     ILOANCK    E DSCLOANCK                                                                   220754
     I              RECI                            KRECI                                     220754
     I              LNRF                            KLNRF                                     220754
     I              RCDT                            KRCDT                                     220754
     I              MRIN                            KMRIN                                     220754
     I              ORED                            KORED                                     220754
     I              LCD                             KLCD                                      220754
     I              CHTP                            KCHTP                                     220754
     I              TNLU                            KTNLU                                     220754
     I              FRNT                            KFRNT                                     CPK018
     I              AFRT                            KAFRT                                     CPK018
     I              REPA                            KREPA                                     CPK018
     I              TMST                            KTMST                                     CPK018
     I*SVLOAN******DS***************************1375                                   CLE034 CLE106
     ISVLOAN      DS                           1648                                           CLE106
     ILESTAL    E DSLESTALPD                                              CLE034
     I              RECI                            LSRECI                CLE034
     I              TYPE                            LSTYPE                CLE034
     I              TMST                            LSTMST                CLE034
     I              PCRF                            LSPCRF                CLE034
     I              LNRF                            LSLNRF                CLE034
     I              VDAT                            LSVDAT                CLE034
     I              LASQ                            LSLASQ                CLE034
     I              CNUM                            LSCNUM                CLE034
     I              FACL                            LSFACL                CLE034
     I              FESQ                            LSFESQ                CLE034
     I              SEQ                             LSSEQ                 CLE034
     I              RCPC                            LSRCPC                CLE034
     I              RSTM                            LSRSTM                CLE034
     I              RONS                            LSRONS                CLE034
     I              RONSQQ                          QQRONS                                    CGL029
     I              RIBN                            LSRIBN                CLE034
     I              RIBA                            LSRIBA                CLE034
     I              ROBN                            LSROBN                CLE034
     I              ROCN                            LSROCN                CLE034
     I              ROBR                            LSROBR                CLE034
     I              RSCY                            LSRSCY                CLE034
     I              REXR                            LSREXR                CLE034
     I              REXI                            LSREXI                CLE034
     I              PYPC                            LSPYPC                CLE034
     I              PSTM                            LSPSTM                CLE034
     I              PONS                            LSPONS                CLE034
     I              PONSQQ                          QQPONS                                    CGL029
     I              PIBN                            LSPIBN                CLE034
     I              PIBA                            LSPIBA                CLE034
     I              POBN                            LSPOBN                CLE034
     I              POCN                            LSPOCN                CLE034
     I              RCRN                            LSRCRN                CLE034
     I              RCRA                            LSRCRA                CLE034
     I              RVNO                            LSRVNO                CLE034
     I              AWBN                            LSAWBN                CLE034
     I              AWBA                            LSAWBA                CLE034
     I              BENN                            LSBENN                CLE034
     I              BENA                            LSBENA                CLE034
     I              DTP1                            LSDTP1                CLE034
     I              DTP2                            LSDTP2                CLE034
     I              DTP3                            LSDTP3                CLE034
     I              DTP4                            LSDTP4                CLE034
     I              DCHG                            LSDCHG                CLE034
     I              BTB1                            LSBTB1                CLE034
     I              BTB2                            LSBTB2                CLE034
     I              BTB3                            LSBTB3                CLE034
     I              BTB4                            LSBTB4                CLE034
     I              BTB5                            LSBTB5                CLE034
     I              BTB6                            LSBTB6                CLE034
     I              POBR                            LSPOBR                CLE034
     I              CVMR                            LSCVMR                CLE034
     I              PSCY                            LSPSCY                CLE034
     I              IC72                            LSIC72                CLE034
     I              PEXR                            LSPEXR                CLE034
     I              PEXI                            LSPEXI                CLE034
     I              PTRF                            LSPTRF                CLE034
     I              PYBA                            LSPYBA                                    CLE038
     I              PYAM                            LSPYAM                                    CLE038
     I              RCBA                            LSRCBA                                    CLE038
     I              RCAM                            LSRCAM                                    CLE038
     I              CCY                             LSCCY                                     CLE038
      *                                                                   CLE034
     I/COPY WNCPYSRC,AOOULEU0I2
     I*
     I##PAYD      DS
     I                                        1   1 ##PAY
     I                                        2   3 ##PAYM
     I**********                              4  15 ##PAYA                                    CGL029
     I**********                             16  18 ##PAYB                                    CGL029
     I                                        4  21 ##PAYA                                    CGL029
     I                                       22  24 ##PAYB                                    CGL029
     I##RECD      DS
     I                                        1   1 ##REC
     I                                        2   3 ##RECM
     I**********                              4  15 ##RECA                                    CGL029
     I**********                             16  18 ##RECB                                    CGL029
     I                                        4  21 ##RECA                                    CGL029
     I                                       22  24 ##RECB                                    CGL029
     I##INTS      DS
     I                                        1   1 ##INPR
     I                                        2   3 ##INTM
     I**********                              4  15 ##INTA                                    CGL029
     I**********                             16  18 ##INTB                                    CGL029
     I                                        4  21 ##INTA                                    CGL029
     I                                       22  24 ##INTB                                    CGL029
     I##SETD      DS
      * pay/receive (P/R)
     I                                        1   1 ##PYRC
      * settlement method
     I                                        2   3 ##SETM
      * settlement account
     I**********                              4  15 ##SETA                                    CGL029
     I                                        4  21 ##SETA                                    CGL029
     I                                        4   5 ##NOSN
     I                                        4  13 ##ACNO
     I                                        4   9 ##CNUM
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      * settlement branch
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     IC#DTA       DS                            256
      *  Account type N=nostro nbr F=Full nostro G=General Ledger
      *               P=Partial Ledger R= Retail Number  X= no settlement
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I                                        2  19 C#ACCT
     I**********                              2   70C#CNU1                                    CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1
     I**********                             11  140C#ACO1                                    CGL029
     I                                       15  160C#ACS1
     I                                       17  19 C#BRC1
      *               Nostro number
     I                                        2   30C#NOSN
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               Partial Account - CNUM/ACOD/ACSQ
     I**********                              2   70C#CNUM                                    CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                                    CGL029
     I                                       12  130C#ACSQ
      *               Branch of account if Partial                      '
     I                                       14  16 C#BRCA
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
      *                     ' ' no OLPOS update
     I                                       24  24 C#IO
      *               Currency of transaction
     I                                       25  27 C#CCY
      *               Transaction Type
     I                                       28  29 C#TRYP
      *               Transaction Narrative
     I                                       30  59 C#NARR
      *               Cheque Number
     I                                       60  670C#CHQN
      *               FT transaction reference
     I                                       68  82 C#PREF
      *               DL/LE/GL/RE transaction reference
     I                                       83  88 C#TRN
      *               Movement amount
     I                                    P  89  960C#AMT
      *               Processing indicators Not blank = no update
      *                                     ' ' = Update
      *               Prono update indicator
     I                                       97  97 C#PRON
      *               Olpos update indicator
     I                                       98  98 C#OLPS
      *               Memos update indicator
     I                                       99  99 C#MEMS
      *               Rsacmtpd write indicator
     I                                      100 100 C#RSAC
      *               Module
     I                                      101 102 C#MOD
      *               Olpos record number to update
      *                     '02' for Interest movements
      *                     '03' for loans
     I                                      103 104 C#OLRC
      *               FT Memos ledger balance override
      *                        'Y' update ledger balance irrespective of
      *                        posting date
     I                                      105 105 C#FTOV
      *               Value date and posting date
     I                                    P 106 1080C#VDAT
     I                                    P 109 1110C#PSTD
      *               Override posting date correction
      *                        for forward valued items
      *                        'Y' prevents date being changed
     I                                      112 112 C#PSTO
      *               Indicator to show if removal allowed Y, N or " "
     I                                      113 113 C#RPST
      *               Removal set number
     I                                      114 1160C#RPNB
      *               Removal type "C" = Credit entries
      *                            "D" = Debit entries
     I                                      117 117 C#RTYP
      *               Booking branch
     I                                      118 120 C#BBRN
      *                                                                                       CGL029
      ** Account code for full general ledger                                                 CGL029
      *                                                                                       CGL029
     I                                      121 1300C#ACO1                                    CGL029
      *                                                                                       CGL029
      ** Account code for partial account                                                     CGL029
      *                                                                                       CGL029
     I                                      131 1400C#ACOD                                    CGL029
      *                                                                                       CAP204
      ** Other Transaction Reference                                                          CAP204
      *                                                                                       CAP204
     I                                      141 160 C#OTR1                                    CAP204
      *                                                                                       CAP205
      ** Movement type                                                                        CAP205
      *                                                                                       CAP205
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
      *                                                                                       241166
     I* Data structure for more detailed description                                          241166
     I            DS                                                                          241166
     I                                        1  15 D#WORK                                    241166
     I                                        1   6 D#TRN                                     241166
     I                                        9  10 D#TYP                                     241166
      *
     I            DS
     I* Value date and sequence number read from LOAMSDK
     I                                        1   80@@VDSN
     I                                        1   50@@VYMD
     I                                        6   80@@DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to omit
     I                                        1   80$$VDSN
     I                                        1   50$$VYMD
     I                                        6   80$$DS38
     I            DS
     I* Value date and sequence number on LOAMSDK to be read to
     I                                        1   80##VDSN
     I                                        1   50##VYMD
     I                                        6   80##DS38
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
      *                                                                   CEU004
      *** SAR Details                                                     CEU004
      *                                                                   CEU004
     ISCSARD    E DSSCSARDPD                                              CEU004
     I***********   LCD                             LLCD                  CEU004
     I              LCD                             LCDX                  CEU004
     IWDSJB       DS                            256                                           CSC022
     I                                        1   30COMMTN                                    CSC022
     I                                        4 103 COMMTJ                                    CSC022
      ** Commitment Control dataarea                                                          CSC022
      *                                                                                       CSC022
      *                                                                   CEU004
      ** Data structure for subroutine ZCBDYS                             182370
     I            DS                                                      182370
     I                                        1   80ZZDAT1                182370
     I                                        1   40ZZYYA                 182370
     I                                        5   60ZZMMA                 182370
     I                                        7   80ZZDDA                 182370
      *                                                                   182370
     I            DS                                                      182370
     I                                        1   80ZZDAT2                182370
     I                                        1   40ZZYYB                 182370
     I                                        5   60ZZMMB                 182370
     I                                        7   80ZZDDB                 182370
      *                                                                   182370
     I/COPY WNCPYSRC,AOH00048
     ISDCURR    E DSSDCURRPD                                                                  CLE031
      ** Currency details                                                                     CLE031
      *                                                                                       CLE031
     I/COPY ZSRSRC,ZDAT10Z1
     I/COPY ZSRSRC,ZHOLI                                                                      201672
     I/COPY ZSRSRC,ZINTDYZ1                                                                   201672
     I/COPY ZSRSRC,ZDATE9Z2                                               182370
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           Z#BSTK                                              220754
     C                     PARM           Z#ASTK                                              220754
     C                     PARM           CLONQD                                              CER049
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      *  Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C/COPY WNCPYSRC,AOOULEU0C4
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Clear down all shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRCLR
      *
     C                     MOVELZ#BSTS    #BRCID  2
     C                     MOVELZ#ASTS    #ARCID  2
      *
      *-------------------------------------------------------------------
      *
      ** GENERATE 'BEFORE STATUS' ACCOUNT MOVEMENTS
      ** (if not insertion, when __RCID will be blank)
      *
     C           #BRCID    IFNE *BLANK
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL'YES'     ##REVI  3
     C                     MOVEL*BLANKS   W#REVI                                              221505
      *
      ** Loans
     C                     MOVELZ#BSTS    LOANCL
     C                     MOVELZ#BSTK    LOANCK                                              220754
      *                                                                   CLE033
      * TNLU in reversals must be the new one, to match the loan status   CLE033
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           SDST      ANDEQ09                                        CLE033
     C           CLE033    OREQ 'Y'                                       CLE033
     C           MDST      ANDEQ09                                        CLE033
      *                                                                   CLE033
     C                     MOVELZ#ASTS    LOANCL                          CLE033
     C                     Z-ADD0         W0TNLU  50                      CLE033
      *                                                                   CLE033
     C           CHTP      IFEQ 'R'                                       CLE033
     C                     MOVEL'Y'       W#REVI  1                                           221505
     C                     Z-ADDTNLU      W0TNLU                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     MOVELZ#BSTS    LOANCL                          CLE033
      *                                                                   CLE033
     C           W0TNLU    IFNE 0                                         CLE033
     C                     Z-ADDW0TNLU    TNLU                            CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ELSE                                                               221505
     C                     MOVELZ#ASTS    LOANCL                                              221505
     C           CHTP      IFEQ 'R'                                                           221505
     C                     MOVEL'Y'       W#REVI                                              221505
     C                     ENDIF                                                              221505
     C                     MOVELZ#BSTS    LOANCL                                              221505
     C                     Z-ADDRAMT      #RAMT3 130                                        MD021236
      *                                                                                       221505
     C                     ENDIF                                          CLE033
      *                                                                                       191051
      ** Re-define account settle details - applicable when retail                            191051
      ** 'In' ccy account is converted to Euro                                                191051
      *                                                                                       191051
     C           CEU004    IFEQ 'Y'                                                           191051
     C           SDST      IFEQ 14                                                            191051
     C                     MOVELOSDA      ACNO                                                191051
     C           ACNO      CHAINACCNTABF             70                                       191051
     C           *IN70     IFEQ '0'                                                           191051
     C           SCCY      ANDEQ*BLANK                                                        191051
     C           CCY       ANDNEBKEURO                                                        191051
     C           ACCCY     ANDEQBKEURO                                                        191051
     C                     MOVEL'05'      SDST                                                191051
     C                     MOVELACCNUM    ##CNUM                                              191051
     C                     MOVELACACOD    ##ACOD                                              191051
     C                     MOVELACACSQ    ##ACSQ                                              191051
     C                     MOVEL##SETA    OSDA                                                191051
     C                     ENDIF                                                              191051
      *                                                                                       191051
     C                     ENDIF                                                              191051
      *                                                                                       191051
     C           MDST      IFEQ 14                                                            191051
     C                     MOVELOMDA      ACNO                                                191051
     C           ACNO      CHAINACCNTABF             70                                       191051
     C           *IN70     IFEQ '0'                                                           191051
     C           SCCY      ANDEQ*BLANK                                                        191051
     C           CCY       ANDNEBKEURO                                                        191051
     C           ACCCY     ANDEQBKEURO                                                        191051
     C                     MOVEL'05'      MDST                                                191051
     C                     MOVELACCNUM    ##CNUM                                              191051
     C                     MOVELACACOD    ##ACOD                                              191051
     C                     MOVELACACSQ    ##ACSQ                                              191051
     C                     MOVEL##SETA    OMDA                                                191051
     C                     ENDIF                                                              191051
      *                                                                                       191051
     C                     ENDIF                                                              191051
      *                                                                                       191051
     C                     ENDIF                                                              191051
      *********                                                           217270
     C*********  CLE033    IFEQ 'Y'                                 CLE033217270
     C*********  SDST      ANDEQ09                                  CLE033217270
     C*********            MOVELP@VL01    ##CNUM                    CLE033217270
     C*********            MOVELP@VL02    ##ACOD                    CLE033217270
     C*********            MOVEL'01'      ##ACSQ                    CLE033217270
     C*********            MOVEL##SETA    OSDA                      CLE033217270
     C*********            ENDIF                                    CLE033217270
      *********                                                     CLE033217270
     C*********  CLE033    IFEQ 'Y'                                 CLE033217270
     C*********  MDST      ANDEQ09                                  CLE033217270
     C*********            MOVELP@VL01    ##CNUM                    CLE033217270
     C*********            MOVELP@VL02    ##ACOD                    CLE033217270
     C*********            MOVEL'01'      ##ACSQ                    CLE033217270
     C*********            MOVEL##SETA    OMDA                      CLE033217270
     C*********            ENDIF                                    CLE033217270
      *                                                                   CLE033
     C                     EXSR SRLOAN
      *                                                                   CLE033
     C                     MOVE ##SETM    WBSETM  2                       CLE033
      *
     C                     END                             * Z#BSTS
      *-------------------------------------------------------------------
      *
      ** GENERATE 'AFTER STATUS' ACCOUNT MOVEMENTS
      ** (if not deletion, when __CHTP will be 'R')
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO LOAM OMIT
     C                     MOVEL*BLANK    ##REVI
     C                     MOVEL*BLANKS   W#REVI                                              221505
      *
      ** Loans
     C                     MOVELZ#ASTS    LOANCL
     C                     MOVELZ#ASTK    LOANCK                                              220754
     C                     Z-ADDRAMT      #RAMT3                                            MD021236
     C           CHTP      IFNE 'R'
     C                     EXSR SRLOAN
     C                     END
      *
      *-------------------------------------------------------------------
      *
      *-------------------------------------------------------------------
      *
      *-------------------------------------------------------------------
      *
      ** Update database with shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRUPD
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRLOAN                                         *
      * Function    :  Loan Processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  AOSPOSU0 - On-line Positions Update            *
      *****************************************************************
     C           SRLOAN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRLOAN'  @STK,Q
      *
      *                                                                                       201672
     C           NMDT      IFNE 0                                                             201672
     C                     Z-ADDNMDT      OMMAT   50                                          201672
     C                     ELSE                                                               201672
     C                     Z-ADDMDAT      OMMAT                                               201672
     C                     ENDIF                                                              201672
     C                     MOVEL'LOAN'    WTYPE                                               220754
      *................................................................
      *
     C                     MOVE *BLANK    VAL     1                       125373
     C           RUND      SUB  BVLP      STARTD  50                      125373
     C           #BRCID    IFNE *BLANKS                                   125373
     C           VDAT      ANDLTSTARTD                                    125373
     C           VDAT      ANDNE0                                         125373
     C           #BRCID    ORNE *BLANKS                                                     AR317587
     C           VDAT      ANDLTRUND                                                        AR317587
     C           ORED      ANDLTRUND                                                        AR317587
     C                     MOVE 'Y'       VAL                             125373
     C                     END                                            125373
      **  Determine whether Participation Sold
      *
     C                     Z-ADD1         #I      20
     C           PTYP      LOKUP##LDT,#I                 99*
     C  N99                MOVEL'L'       ##LOD
     C   99                MOVEL'D'       ##LOD   1
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
      **  For Loans and Part. Purchased
     C           *IN99     IFEQ '0'
     C                     MOVELSDST      ##PAYM           * pay method
     C                     MOVELOSDA      ##PAYA           * pay account
     C                     MOVELOSDB      ##PAYB           * pay branch
     C                     MOVELMDST      ##RECM           * rec method
     C                     MOVELOMDA      ##RECA           * rec account
     C                     MOVELOMDB      ##RECB           * rec branch
     C                     ELSE
      **  For Part. Sold
     C                     MOVELMDST      ##PAYM           * pay method
     C                     MOVELOMDA      ##PAYA           * pay account
     C                     MOVELOMDB      ##PAYB           * pay branch
     C                     MOVELSDST      ##RECM           * rec method
     C                     MOVELOSDA      ##RECA           * rec account
     C                     MOVELOSDB      ##RECB           * rec branch
     C                     END
      *
      **  Store basic loan details
      *
     C********             Z-ADDLNRF      ##DLNO  60       * loan number                      CLE148
     C                     MOVELLNRF      ##DLNO  6                                           CLE148
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           SCCY      ANDNE*BLANK                                    CEU004
     C                     MOVELSCCY      ##CCY                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVELCCY       ##CCY   3        * currency
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      ** If Lending Enhancements is on.                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      * Save receipt & pay settlement details                                                 CLE031
      *                                                                                       CLE031
     C********** SCCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELSCCY      SVSCCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                       CLE031
     C********** PSCY      IFNE *BLANK                                               CLE031 AR943686
     C                     MOVELPSCY      SVPSCY  3                                           CLE031
     C**********           ENDIF                                                     CLE031 AR943686
      *                                                                                       CLE031
     C                     Z-ADDREXR      SVREXR 138                                        AR943686
     C                     MOVE REXI      SVREXI  1                                         AR943686
     C                     Z-ADDPEXR      SVPEXR 138                                        AR943686
     C                     MOVE PEXI      SVPEXI  1                                         AR943686
      *                                                                                     AR943686
     C                     ENDIF                           End If CLE031                      CLE031
      *                                                                                       CLE031
     C                     Z-ADDCPAM      ##PCPL 150   99  * principal
     C   99                Z-SUB##PCPL    ##PCPL
     C                     Z-ADDINTR      ##INTR 117       * interest rate
     C                     Z-ADDIACD      ##IACD  50       * int acc ctl DT
     C                     MOVELICBS      ##ICBS  10       * int calc basis
     C                     MOVELLTYP      ##TRYP  2        * loan type
     C                     MOVELLNRF      ##TRN   6        * transact no.
     C                     MOVELBRCA      ##BBRN  3        * booking branch
      *                                                                   137130
     C                     MOVE AUTO      ##AUTO  1        * auto-settle  137130
      *
      * Value date and sequence number on LOAMSDK to be read to
      *
     C                     Z-ADD*ZERO     ##VDSN           * READ TO
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT  50       * event value dte
     C                     Z-ADD*ZERO     ##AMT  150       * amount
     C                     MOVEL*BLANK    ##NARR 30        * narrative
     C                     Z-ADD*ZERO     OVDAT   50                                          218984
     C                     Z-ADD*ZERO     ORLDT   50                                         221505R
     C                     Z-ADD0         WCALC                                              221505R
     C                     Z-ADD0         ZINTRS                                             221505R
     C                     Z-ADD0         ZFIRST                                             221505R
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
      ** If not Risk loan                                                 175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
      *                                                                   175450
     C           #BRCID    IFEQ *BLANKS                                   125373
     C           VAL       ORNE 'Y'                                       125373
     C                     Z-ADDVDAT      ##VYMD
     C                     Z-ADDVDAT      ##VDAT             Midas day no.
      *
     C           PTYP      IFEQ 63                         DISC LOAN
     C           PTYP      OREQ 65                         DISC PART PUR
     C           PTYP      OREQ 67                         DISC PART SLD
     C           ##PCPL    SUB  TOTI      ##AMT            * loan principal
     C                     ELSE
      *                                                                   182725
     C                     MOVE 'Y'       VALUE   1                       182725
     C***********          EXSR SRDCPI                                                 182725 218984
      *                                                                   182725
     C                     Z-ADD##PCPL    ##AMT            * loan principal
     C                     END
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C                     MOVE 'P'       WPAYRC  1                       CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     ELSE
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     END
      *
     C                     Z-ADD001       ##RPNB  30       * 1=value date
     C                     MOVEL##NAR,1   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'S'       ##MTYP  1                                           CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
      *                                                                                       CER049
      ** Calculate stamp tax when CER049 is ON                                                CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C           DDTAX     ANDEQ'Y'                                                         AR819068
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *
     C                     MOVE 'N'       VALUE                           182725
      *                                                                   182725
     C                     END                                            125373
     C                     ENDIF                                          175450
      *                                                                                       220754
      * If multi-currency rollover, need to do additional processing                          220754
      * or a rollover producing a repayment or increase.                                      218984
     C           RLDT      IFNE 0                                                             220754
     C           NCCY      ANDNE*BLANKS                                                       220754
     C           RLDT      ORNE 0                                                             218984
     C           NCCY      ANDEQ*BLANKS                                                       218984
     C           NFCE      ANDNE*ZEROS                                                        218984
     C           NPRAM     ANDNE*ZEROS                                                        218984
      *                                                                                       220754
     C                     MOVEL'Y'       ROLL    1                                           220754
     C                     Z-ADDRLDT      OMMAT                                               220754
     C                     EXSR SRPROC                                                        220754
      *                                                                                       220754
      * Change to be using the rollover details.                                              220754
     C                     Z-ADDRLDT      WLICD                                               220754
     C                     MOVEL*BLANKS   ROLL                                                220754
     C                     Z-ADDRLDT      OVDAT                                               218984
      *                                                                                       218984
      * If not multi-currency, do not replace the settlement details                          218984
      * and use the new principal amount rather than the new currency                         218984
      * principal amount                                                                      218984
     C           NCCY      IFEQ *BLANKS                                                       218984
     C                     Z-ADDNPRAM     ##PCPL                                              218984
     C                     Z-ADDNPRAM     CPAM                                                218984
     C                     ELSE                                                               218984
     C                     Z-ADDNCPA      ##PCPL                                              220754
     C                     Z-ADDNCPA      CPAM                                                220754
     C                     Z-ADDNLRA      RAMT                                                220754
     C                     MOVELNCCY      CCY                                                 220754
     C                     MOVELNCCY      ##CCY                                               220754
     C                     MOVELRPST      ##PAYM                                              220754
     C                     MOVELRPON      ##PAYA                                              220754
     C                     MOVELRLSB      ##PAYB                                              220754
     C                     MOVELRRST      ##RECM                                              220754
     C                     MOVELRRON      ##RECA                                              220754
     C                     MOVELRLBR      ##RECB                                              220754
     C                     MOVELRRSC      SCCY                                                220754
     C                     Z-ADDRRSR      REXR                                                220754
     C                     MOVELRRSI      REXI                                                220754
     C                     MOVELRPSC      PSCY                                                220754
     C                     Z-ADDRPSR      PEXR                                                220754
     C                     MOVELRPSI      PEXI                                                220754
     C                     MOVE SCCY      SVSCCY                                            AR943686
     C                     Z-ADDREXR      SVREXR                                            AR943686
     C                     MOVE REXI      SVREXI                                            AR943686
     C                     MOVE PSCY      SVPSCY                                            AR943686
     C                     Z-ADDPEXR      SVPEXR                                            AR943686
     C                     MOVE PEXI      SVPEXI                                            AR943686
     C                     MOVELRSTA      STAL                                                220754
     C                     MOVEL'ROLL'    WTYPE                                               220754
     C                     ENDIF                                                              218984
      *                                                                                       220754
     C           NMDT      IFNE 0                                                             220754
     C                     Z-ADDNMDT      OMMAT                                               220754
     C                     ELSE                                                               220754
     C                     Z-ADDMDAT      OMMAT                                               220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C           NIDT      IFLE RLDT                                                          220754
     C           NIDT      ANDNE0                                                            221505R
     C**********           Z-ADDOMMAT     NIDT                                        220754 221505R
     C                     Z-ADDRLDT      ORLDT                                              221505R
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C********** NRPD      IFLE RLDT                                                  220754 221505R
     C**********           Z-ADDOMMAT     NRPD                                        220754 221505R
      *                                                                                      218984R
     C           NRPD      IFLE RLDT                                                         218984R
     C           RFRQ      IFNE *BLANKS                                                      218984R
      *                                                                                      218984R
      ** Move the repayment date past the rollover date                                      218984R
      *                                                                                      218984R
     C                     Z-ADDNRPD      WNRPD   50                                         218984R
     C           WNRPD     DOWLERLDT                                                         218984R
     C           WNRPD     ANDGENRPD                                                        AR830785
     C                     MOVELRFRQ      ZFREQ                                              218984R
     C                     MOVELCCY       ZCCY                                               218984R
     C                     Z-ADDWNRPD     ZDAYNO                                             218984R
     C                     EXSR ZFRQB3                                                       218984R
     C                     Z-ADDZDAYNO    WNRPD   50                                         218984R
     C                     ENDDO                                                             218984R
     C                     ELSE                                                              218984R
      *                                                                                      218984R
      ** Move the repayment date to maturity date so no more repayments                      218984R
      ** happen                                                                              218984R
      *                                                                                      218984R
     C                     Z-ADDOMMAT     NRPD                                               218984R
     C                     ENDIF                                                             218984R
     C                     ENDIF                                                             218984R
     C**********           ENDIF                                                      220754 221505R
      *                                                                                       220754
      ** Generate Rollover DATE account movement                                              220754
      ** =======================================                                              220754
      ** only if a multicurrency rollover                                                     218984
      ** this is the start of the rollover with the whole of the                              218984
      ** new currency principal amount in the new currency                                    218984
      *                                                                                       220754
      ** If not Risk loan                                                                     220754
     C           NCCY      IFNE *BLANKS                                                       218984
     C           PTYP      IFNE 70                                                            220754
     C           PTYP      ANDNE71                                                            220754
     C           PTYP      ANDNE72                                                            220754
      *                                                                                       220754
     C                     Z-ADDRLDT      ##VYMD                                              220754
     C                     Z-ADDRLDT      ##VDAT             Midas day no.                    220754
      *                                                                                       220754
     C                     Z-ADDNCPA      ##AMT            * loan principal                   220754
      *                                                                                       220754
     C           CLE034    IFEQ 'Y'                                                           220754
     C           STAL      ANDEQ'Y'                                                           220754
      *                                                                                       220754
     C           ##LOD     IFEQ 'L'                                                           220754
     C                     MOVE 'P'       WPAYRC  1                                           220754
     C                     ELSE                                                               220754
     C                     MOVE 'R'       WPAYRC                                              220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C                     EXSR SR34A                                                         220754
     C                     ELSE                                                               220754
     C                     MOVE 'Y'       WRKFLD                                              220754
     C                     MOVE '*EOF   ' WRTCD                                               220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C           WRKFLD    DOWEQ'Y'                                                           220754
     C           WRTCD     OREQ *BLANKS                                                       220754
      *                                                                                       220754
     C           CLE034    IFEQ 'Y'                                                           220754
     C           STAL      ANDEQ'Y'                                                           220754
     C                     EXSR SR34B                                                         220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
      * Pass movement to write program (with appropriate instructions).                       220754
     C           ##LOD     IFEQ 'L'                                                           220754
     C                     MOVEL##PAYD    ##SETD           * Pay details                      220754
     C                     ELSE                                                               220754
     C                     MOVEL##RECD    ##SETD           * Rec details                      220754
     C                     END                                                                220754
      *                                                                                       220754
     C                     Z-ADD001       ##RPNB  30       * 1=value date                     220754
     C                     MOVEL##NAR,5   ##NARR                                              220754
      *                                                                                       220754
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE                                                        220754
      *                                                                                       220754
     C           CLE034    IFEQ 'Y'                                                           220754
     C           STAL      ANDEQ'Y'                                                           220754
     C                     EXSR SR34C                                                         220754
     C                     ELSE                                                               220754
     C                     MOVE *BLANKS   WRKFLD                                              220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C                     ENDDO                                                              220754
      *                                                                                       220754
     C           CLE034    IFEQ 'Y'                                                           220754
     C           STAL      ANDEQ'Y'                                                           220754
     C                     EXSR SR34E                                                         220754
     C                     ENDIF                                                              220754
      *                                                                                       220754
     C                     ENDIF                                                              220754
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              220754
      *                                                                                       220754
      * Process Interest Date, Repayment Date and Maturity Date.                              220754
     C                     EXSR SRPROC                                                        220754
      *................................................................                       220754
      *                                                                                       220754
     C           EXLOAN    TAG                                                                220754
      *                                                                                       220754
      **  Unwind subroutine stack name                                                        220754
     C                     MOVEA*BLANKS   @STK,Q                                              220754
     C                     SUB  1         Q                                                   220754
      *                                                                                       220754
     C                     ENDSR                                                              220754
      *****************************************************************                       220754
     C/SPACE 5                                                                                220754
      *****************************************************************                       220754
      * Subroutine  :  SRPROC                                         *                       220754
      * Function    :  Processing of interest date, repayment date    *                       220754
      *             :  and maturity date                              *                       220754
      *                                                               *                       220754
      * Called by   :  Mainline                                       *                       220754
      * Calls       :  AOSPOSU0 - On-line Positions Update            *                       220754
      *****************************************************************                       220754
     C           SRPROC    BEGSR                                                              220754
      *                                                                                       220754
      **  Set up subroutine stack name                                                        220754
     C                     ADD  1         Q       50                                          220754
     C                     MOVEL'SRPROC'  @STK,Q                                              220754
      *                                                                                       220754
      ***Reverse*starting*principal*when*loan*is*being*reversed********           MD021689 MD021689A
      *                                                                                     MD021689
     C           ##REVI    IFEQ 'YES'                                                       MD021689
     C           W#REVI    ANDEQ'Y'                                                         MD021689
      *                                                                                     MD021689
     C**********           MOVE 'N'       WPRIN                                   MD021689 MD021689A
     C********** KEYH      SETLLHISTO                                             MD021689 MD021689A
     C********** KEYH      READEHISTO                    64                       MD021689 MD021689A
     C********** *IN64     IFEQ '0'                                               MD021689 MD021689A
     C********** AMTPH     ANDEQ'ST'                                              MD021689 MD021689A
     C**********           MOVE 'Y'       WPRIN                                   MD021689 MD021689A
     C**********           Z-ADDVDATH     ##VDAT                                  MD021689 MD021689A
     C**********           Z-ADDPRAMH     ##AMT                                   MD021689 MD021689A
     C**********           Z-ADD001       ##RPNB                                  MD021689 MD021689A
     C**********           MOVEL##NAR,1   ##NARR                                  MD021689 MD021689A
     C**********           EXSR SRREVS                                            MD021689 MD021689A
     C**********           ENDIF                                                  MD021689 MD021689A
     C                     MOVE 'N'       WPRIN                                            MD021689B
     C           KEYH      SETLLHISTO                                                      MD021689B
     C           KEYH      READEHISTO                    64                                MD021689B
     C           *IN64     IFEQ '0'                                                        MD021689B
     C           AMTPH     ANDEQ'ST'                                                       MD021689B
     C                     MOVE 'Y'       WPRIN                                            MD021689B
     C                     Z-ADDVDATH     ##VDAT                                           MD021689B
     C                     Z-ADDPRAMH     ##AMT                                            MD021689B
     C                     Z-ADD001       ##RPNB                                           MD021689B
     C                     MOVEL##NAR,1   ##NARR                                           MD021689B
     C                     MOVE ##LOD     W#LOD   1                                        MD021689B
     C           ##LOD     IFEQ 'L'                                                         MD059570
     C                     MOVE 'D'       ##LOD                                            MD021689B
     C                     ELSE                                                             MD059570
     C                     MOVE 'L'       ##LOD                                             MD059570
     C                     ENDIF                                                            MD059570
     C                     EXSR SRREVS                                                     MD021689B
     C                     MOVE W#LOD     ##LOD                                            MD021689B
     C                     ENDIF                                                           MD021689B
      *                                                                                     MD021689
      ** Reverse repayments when loan is being reversed                                     MD021689
      *                                                                                     MD021689
     C                     MOVE 'N'       WPRIN                                             MD021689
     C                     Z-ADD0         ##AMT                                             MD021689
     C           KEYH      SETLLLEHISTHP                                                    MD021689
     C           KEYH      READELEHISTHP                 65                                 MD021689
     C           *IN65     DOWEQ'0'                                                         MD021689
     C           VDATP     IFLT RUND                                                        MD021689
     C           AMTPP     IFEQ 'MR'                                                        MD021689
     C           AMTPP     OREQ 'RE'                                                        MD021689
     C                     Z-ADDVDATP     ##VDAT                                            MD021689
     C           PRAMP     ADD  ##AMT     ##AMT                                             MD021689
     C                     MOVE 'Y'       WPRIN   1                                         MD021689
     C                     ENDIF                                                            MD021689
     C                     ENDIF                                                            MD021689
     C           KEYH      READELEHISTHP                 65                                 MD021689
     C                     ENDDO                                                            MD021689
      *                                                                                     MD021689
     C           WPRIN     IFEQ 'Y'                                                         MD021689
     C                     Z-ADD002       ##RPNB                                            MD021689
     C                     MOVEL##NAR,3   ##NARR                                            MD021689
     C                     EXSR SRREVS                                                      MD021689
     C                     ENDIF                                                            MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
      ** Generate INTEREST PAYMENT DATE account movement
      ** ===============================================
      *
      * (if interest not capitalized
      *  and if loan not discounted)
      *
     C********** INTC      IFNE 'Y'                                                           224582
     C********** PTYP      ANDNE63                         DISC LOAN                          224582
     C           PTYP      IFNE 63                         DISC LOAN                          224582
     C           PTYP      ANDNE65                         DISC PART PUR
     C           PTYP      ANDNE67                         DISC PART SLD
      *                                                                                       224582
     C           INTC      IFNE 'Y'                                                           224582
      *                                                                                       221505
      **  Generate last interest payment date if interest has been paid                       221505
      **  and the loan is being reversed.                                                     221505
      *                                                                                       221505
     C           IPRD      IFNE 0                                                             221505
     C           ##REVI    ANDEQ'YES'                                                         221505
     C           W#REVI    ANDEQ'Y'                                                           221505
     C                     Z-ADDSLID      ##VDAT                                              221505
     C                     Z-ADDIPRD      ##AMT                                               221505
      *                                                                                       221505
     C           CLE034    IFEQ 'Y'                                                           221505
     C           STAL      ANDEQ'Y'                                                           221505
      *                                                                                       221505
     C           ##LOD     IFEQ 'L'                                                           221505
     C                     MOVE 'R'       WPAYRC                                              221505
     C                     ELSE                                                               221505
     C                     MOVE 'P'       WPAYRC                                              221505
     C                     ENDIF                                                              221505
      *                                                                                       221505
     C                     EXSR SR34A                                                         221505
     C                     ELSE                                                               221505
     C                     MOVE 'Y'       WRKFLD                                              221505
     C                     MOVE '*EOF   ' WRTCD                                               221505
     C                     ENDIF                                                              221505
      *                                                                                       221505
     C           WRKFLD    DOWEQ'Y'                                                           221505
     C           WRTCD     OREQ *BLANKS                                                       221505
      *                                                                                       221505
     C           CLE034    IFEQ 'Y'                                                           221505
     C           STAL      ANDEQ'Y'                                                           221505
     C                     EXSR SR34B                                                         221505
     C                     ENDIF                                                              221505
      *                                                                                       221505
      ** Pass movement to write program (with appropriate instructions)                       221505
      *                                                                                       221505
     C           ##LOD     IFEQ 'L'                                                           221505
     C                     MOVEL##RECD    ##SETD           * Rec details                      221505
     C                     ELSE                                                               221505
     C                     MOVEL##PAYD    ##SETD           * Pay details                      221505
     C                     END                                                                221505
      *                                                                                       221505
     C                     Z-ADD002       ##RPNB           * 2 = int. date                    221505
     C                     MOVEL##NAR,2   ##NARR                                              221505
      *                                                                                       221505
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE                                                        221505
      *                                                                                       221505
     C           CLE034    IFEQ 'Y'                                                           221505
     C           STAL      ANDEQ'Y'                                                           221505
     C                     EXSR SR34C                                                         221505
     C                     ELSE                                                               221505
     C                     MOVE *BLANKS   WRKFLD                                              221505
     C                     ENDIF                                                              221505
      *                                                                                       221505
     C                     ENDDO                                                              221505
      *                                                                                       221505
     C           CLE034    IFEQ 'Y'                                                           221505
     C           STAL      ANDEQ'Y'                                                           221505
     C                     EXSR SR34E                                                         221505
     C                     ENDIF                                                              221505
      *                                                                                       CER049
      ** Calculate stamp tax when CER049 is ON                                                CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C           DDTAX     ANDEQ'Y'                                                         AR819068
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
     C                     END                                                                221505
      *                                                                                      221505R
      ****Generate*last*interest*payment*date*if*interest*has*been*paid             221505R MD021689
      ****and*the*loan*is*being*reversed.******************************             221505R MD021689
      *****************************************************************             221505R MD021689
     C********** IPRD      IFNE 0                                                   221505R MD021689
     C********** ##REVI    ANDEQ'YES'                                               221505R MD021689
     C********** W#REVI    ANDEQ'Y'                                                 221505R MD021689
     C**********           Z-ADDSLID      ##VDAT                                    221505R MD021689
     C**********           Z-ADDIPRD      ##AMT                                     221505R MD021689
      *****************************************************************             221505R MD021689
     C********** CLE034    IFEQ 'Y'                                                 221505R MD021689
     C********** STAL      ANDEQ'Y'                                                 221505R MD021689
      *****************************************************************             221505R MD021689
     C********** ##LOD     IFEQ 'L'                                                 221505R MD021689
     C**********           MOVE 'R'       WPAYRC                                    221505R MD021689
     C**********           ELSE                                                     221505R MD021689
     C**********           MOVE 'P'       WPAYRC                                    221505R MD021689
     C**********           ENDIF                                                    221505R MD021689
      *****************************************************************             221505R MD021689
     C**********           EXSR SR34A                                               221505R MD021689
     C**********           ELSE                                                     221505R MD021689
     C**********           MOVE 'Y'       WRKFLD                                    221505R MD021689
     C**********           MOVE '*EOF   ' WRTCD                                     221505R MD021689
     C**********           ENDIF                                                    221505R MD021689
      *****************************************************************             221505R MD021689
     C********** WRKFLD    DOWEQ'Y'                                                 221505R MD021689
     C********** WRTCD     OREQ *BLANKS                                             221505R MD021689
      *****************************************************************             221505R MD021689
     C********** CLE034    IFEQ 'Y'                                                 221505R MD021689
     C********** STAL      ANDEQ'Y'                                                 221505R MD021689
     C**********           EXSR SR34B                                               221505R MD021689
     C**********           ENDIF                                                    221505R MD021689
      *****************************************************************             221505R MD021689
      ***Pass*movement*to*write*program*(with*appropriate*instructions)             221505R MD021689
      *****************************************************************             221505R MD021689
     C********** ##LOD     IFEQ 'L'                                                 221505R MD021689
     C**********           MOVEL##RECD    ##SETD           * Rec details            221505R MD021689
     C**********           ELSE                                                     221505R MD021689
     C**********           MOVEL##PAYD    ##SETD           * Pay details            221505R MD021689
     C**********           END                                                      221505R MD021689
      *****************************************************************             221505R MD021689
     C**********           Z-ADD002       ##RPNB           * 2 = int. date          221505R MD021689
     C**********           MOVEL##NAR,2   ##NARR                                    221505R MD021689
      *****************************************************************             221505R MD021689
     C********** CAP205    IFEQ 'Y'                                                  CAP205 MD021689
     C**********           MOVEL'F'       ##MTYP                                     CAP205 MD021689
     C**********           ENDIF                                                     CAP205 MD021689
     C**********           EXSR SRMOVE                                              221505R MD021689
      *****************************************************************             221505R MD021689
     C********** CLE034    IFEQ 'Y'                                                 221505R MD021689
     C********** STAL      ANDEQ'Y'                                                 221505R MD021689
     C**********           EXSR SR34C                                               221505R MD021689
     C**********           ELSE                                                     221505R MD021689
     C**********           MOVE *BLANKS   WRKFLD                                    221505R MD021689
     C**********           ENDIF                                                    221505R MD021689
      *****************************************************************             221505R MD021689
     C**********           ENDDO                                                    221505R MD021689
      *****************************************************************             221505R MD021689
     C********** CLE034    IFEQ 'Y'                                                 221505R MD021689
     C********** STAL      ANDEQ'Y'                                                 221505R MD021689
     C**********           EXSR SR34E                                               221505R MD021689
     C**********           ENDIF                                                    221505R MD021689
      *****************************************************************              CER049 MD021689
      ***Calculate*stamp*tax*when*CER049*is*ON*************************              CER049 MD021689
      *****************************************************************              CER049 MD021689
     C********** CER049    IFEQ 'Y'                                                  CER049 MD021689
     C********** ##AMT     ANDNE*ZEROS                                               CER049 MD021689
     C********** DDTAX     ANDEQ'Y'                                                AR819068 MD021689
     C**********           EXSR SRSTAX                                               CER049 MD021689
     C**********           ENDIF                                                     CER049 MD021689
      *****************************************************************              CER049 MD021689
     C**********           END                                                      221505R MD021689
      *                                                                                       224582
     C                     ENDIF                                                              224582
     C**********           Z-ADDNIDT      ##VYMD                                              201672
     C**********           Z-ADDNIDT      ##VDAT             Midas day no.                    201672
      *
      ** If no date present use maturity date (which may be zero if call)
      *
     C********** ##VDAT    IFEQ *ZERO                                                         201672
     C**********           Z-ADDMDAT      ##VYMD                                              201672
     C**********           Z-ADDMDAT      ##VDAT             Midas day no.                    201672
     C**********           END                                                                201672
      *
      ** If next interest payment date present
      *
     C********** ##VDAT    IFNE *ZERO                                                         201672
      *
      ** Determine interest due at next interest payment date
      ** (this will be put into field ##INTD)
      *
     C**********           EXSR SRDCPI                                                        201672
      *
     C**********           Z-ADD##INTD    ##AMT                                               201672
      *                                                                                       201672
      **  As NIDT is zero for repayment type 1, use NRPD instead.                            BUG8747
      *                                                                                      BUG8747
     C           REPT      IFEQ 1                                                            BUG8747
     C           NIDT      ANDEQ0                                                            BUG8747
     C                     Z-ADDNRPD      NIDT                                               BUG8747
     C                     MOVE RFRQ      IPFR                                               BUG8747
     C                     Z-ADD1         W1      10                                         BUG8747
     C                     ENDIF                                                             BUG8747
      *                                                                                      BUG8747
     C                     EXSR SRINTP                                                        201672
      *                                                                                       224582
     C           INTC      IFNE 'Y'                                                           224582
      *                                                                                       201672
      **  Generate interest payment date                                                      201672
      *                                                                                       201672
     C           NIDT      IFNE 0                                                             201672
     C           NIDT      ANDLTOMMAT                                                        221505R
     C           OMMAT     ANDNE0                                                            221505R
     C           NIDT      ANDGTOVDAT                                                        221505R
     C           NIDT      ORNE 0                                                            221505R
     C           NIDT      ANDEQOMMAT                                                        221505R
     C           RLDT      ANDEQOMMAT                                                        221505R
     C           OMMAT     ANDNE0                                                            221505R
     C           NIDT      ORNE 0                                                            221505R
     C           OMMAT     ANDEQ0                                                            221505R
     C           NIDT      ANDGTOVDAT                                                        218984R
     C                     Z-ADDNIDT      ##VDAT                                              201672
     C                     Z-ADDZFIRST    ##AMT                                               201672
     C                     ADD  AIMN      ##AMT                                               204130
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'P'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
      *                                                                                       CER049
      ** Calculate stamp tax when CER049 is ON                                                CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C           DDTAX     ANDEQ'Y'                                                         AR819068
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     END                             ** ##VDAT
      *                                                                                       201672
      **  Generate interest at maturity.                                                      201672
     C**  but not interest at rollover date. If interest is wanted on                         218984
     C**  rollover date, then the next interest payment date needs to                         218984
     C**  be set.                                                                             218984
      *                                                                                       201672
     C           ROLL      IFNE 'Y'                                                           218984
     C                     Z-ADDOMMAT     ##VDAT                                              201672
     C           ##VDAT    IFNE 0                                                             228871
      *                                                                                     MD024998
      ** For accrued interest adjustment, get outstanding interest                          MD024998
      *                                                                                     MD024998
     C           WAIAJ     IFEQ 'Y'                                                         MD024998
     C           WCALC     ADD  AITC      ##AMT                                             MD024998
     C                     ADD  AIAP      ##AMT                                             MD024998
     C           CLE028    IFEQ 'N'                                                         MD024998
     C           CLE028    OREQ 'Y'                                                         MD024998
     C           PTYP      ANDNE80                                                          MD024998
     C           CLE028    OREQ 'Y'                                                         MD024998
     C           PTYP      ANDEQ80                                                          MD024998
     C           ADIF      ANDNE'Y'                                                         MD024998
     C                     SUB  IPRD      ##AMT                                             MD024998
     C                     ENDIF                                                            MD024998
     C                     SUB  ICTD      ##AMT                                             MD024998
     C                     SUB  IWOD      ##AMT                                             MD024998
     C                     ELSE                                                             MD024998
      *                                                                                     MD024998
     C           WCALC     SUB  WINPD     ##AMT                                               201672
     C********** ##AMT     SUB  ZINTRS    ##AMT                                       201672 221505R
     C           ##AMT     SUB  ZFIRST    ##AMT                                              221505R
     C           ##AMT     ADD  IPDUE     ##AMT                                               225849
     C                     ENDIF                                                            MD024998
      *                                                                                       204130
     C           NIDT      IFEQ 0                                                             204130
     C                     ADD  AIMN      ##AMT                                               204130
     C                     ENDIF                                                              204130
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'P'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *                                                                                     AR845759
      ** If the tax is "gross" of interest, subtract the calculated                         AR845759
      ** withholding tax from the interest due                                              AR845759
      *                                                                                     AR845759
     C           WTIN      IFEQ 'G'                                                         AR845759
     C           ##AMT     ANDNE0                                                           AR845759
     C********** ##REVI    ANDNE'YES'                                              AR845759 AR937078
     C           WTIN      OREQ 'R'                                                         AR845759
     C           ##AMT     ANDNE0                                                           AR845759
     C********** ##REVI    ANDNE'YES'                                              AR845759 AR937078
     C           WTRT      DIV  100       TAXINT 117                                        AR845759
     C           ##AMT     MULT TAXINT    TAXAMT 150H                                       AR845759
     C                     SUB  TAXAMT    ##AMT                                             AR845759
     C                     ENDIF                                                            AR845759
      *                                                                                       201672
      ** Pass movement to write program (with appropriate instructions)                       201672
      *                                                                                       201672
     C           ##LOD     IFEQ 'L'                                                           201672
     C                     MOVEL##RECD    ##SETD                                              201672
     C                     ELSE                                                               201672
     C                     MOVEL##PAYD    ##SETD                                              201672
     C                     END                                                                201672
      *                                                                                       201672
     C                     Z-ADD002       ##RPNB                                              201672
     C                     MOVEL##NAR,2   ##NARR                                              201672
      *                                                                                       201672
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE                                                        201672
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
      *                                                                                       CER049
      ** Calculate stamp tax when CER049 is ON                                                CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C           DDTAX     ANDEQ'Y'                                                         AR819068
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDIF                                                              228871
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              224582
     C                     END                             ** INTC
      *                                                                                      BUG8747
     C           REPT      IFEQ 1                                                            BUG8747
     C           W1        ANDEQ1                                                            BUG8747
     C                     Z-ADD0         NIDT                                               BUG8747
     C                     MOVE *BLANKS   IPFR                                               BUG8747
     C                     Z-ADD0         W1                                                 BUG8747
     C                     ENDIF                                                             BUG8747
      *
      ** Generate REPAYMENT DATE account movement
      ** ========================================
     C/COPY WNCPYSRC,AOOULEU0C1
      *
      ** If not Risk loan                                                 175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
      *                                                                   175450
     C           RAMT      IFNE *ZERO                        REPAYMENT AMT
     C           CPAM      ANDNE*ZERO                                     233920
      *                                                                   137130
      ** Do not generate movement if maturity date = next repay date      137130
      ** for autosettle 'Y'                                               137130
      *                                                                   137130
     C********** NRPD      IFNE MDAT                                      137130              201672
     C********** NRPD      IFNE OMMAT                                                  201672 252039
     C********** ##AUTO    OREQ 'N'                                                    137130 252039
     C********** ##AUTO    IFEQ 'Y'                                                  252039 MD030939
     C           NRPD      IFNE OMMAT                                                       MD030939
     C           ##AUTO    OREQ 'N'                                                         MD030939
     C           ##AUTO    OREQ 'C'                                                        AR1072392
     C           CLE134    ANDEQ'Y'                                                        AR1072392
     C           NRPD      OREQ OMMAT                                                        218984R
     C           RLDT      ANDEQOMMAT                                                        218984R
     C           OMMAT     ANDNE0                                                            218984R
      *                                                                   137130
     C                     Z-ADDRAMT      ##AMT
      *                                                                                     AR792284
     C           REPT      IFEQ 3                                                           AR792284
     C           #RAMT3    ANDGTCPAM                                                        MD021236
     C           PWCALC    SUB  WINPD     PZINTR 130                                        AR792284
     C           RAMT      SUB  PZINTR    RAMTP  130                                        AR792284
     C           RAMTP     IFGT CPAM                                                        AR792284
     C           CPAM      ADD  PZINTR    ##AMT                                             AR792284
     C                     ENDIF                                                            AR792284
     C                     Z-ADD0         PWCALC                                            AR792284
     C                     Z-ADD0         PZINTR                                            AR792284
     C                     Z-ADD0         RAMTP                                             AR792284
     C                     ENDIF                                                            AR792284
      *                                                                                     AR792284
     C           RAMT      IFGT CPAM                                                        AR792284
     C           REPT      ANDNE3                                                           AR792284
     C                     Z-ADDCPAM      ##AMT                                             AR792284
     C                     ENDIF                                                            AR792284
      *                                                                                     AR792284
     C                     Z-ADDNRPD      ##VYMD             NEXT REP DATE
     C                     Z-ADDNRPD      ##VDAT             Midas day no.
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'P'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,3   ##NARR
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
      *
     C                     END                                            137130
      *                                                                   137130
     C                     END
     C                     ENDIF                                          175450
      *
      ** Generate MATURITY DATE account movement
      ** =======================================
      ** for multicurrency rollover this is the repayment of the whole                        218984
      ** principal in the old currency                                                        218984
      ** for non-multicurrency rollover this is the repayment or                              218984
      ** increase when the rollover occurs                                                    218984
      *
      ** If not Risk loan                                                 175450
      *                                                                   175450
     C           PTYP      IFNE 70                                        175450
     C           PTYP      ANDNE71                                        175450
     C           PTYP      ANDNE72                                        175450
      *                                                                   175450
     C**********           Z-ADDMDAT      ##VYMD             YYYY/MM/DD                       201672
     C**********           Z-ADDMDAT      ##VDAT             Midas day no.                    201672
     C                     Z-ADDOMMAT     ##VYMD             YYYY/MM/DD                       201672
     C                     Z-ADDOMMAT     ##VDAT             Midas day no.                    201672
     C                     Z-ADD0         ##KIMI                                              201672
      *
      ** If date present (ie not call)
      *
     C********** ##VDAT    IFNE *ZERO                                                         201672
     C           ##VDAT    IFNE *ZERO                                                         216999
     C                     MOVE 'Y'       VALUE                                               223739
      *
      ** Determine expected principal at maturity date
      ** (this will be put into field ##LPCP)
      *
     C**********           EXSR SRDCPI                                                        238838
     C                     Z-ADDCPAM      ##LPCP       99                                     238838
     C********** *IN99     IFEQ '1'                                                  238838 MD025243
     C**********           Z-SUB##LPCP    ##LPCP                                     238838 MD025243
     C**********           ENDIF                                                     238838 MD025243
     C                     MOVE 'N'       VALUE                                               223739
      *                                                                                       201672
     C           NRPD      IFNE 0                                                             201672
     C           RAMT      ANDNE0                                                             201672
     C           NRPD      IFNE OMMAT                                                        218984R
     C           NRPD      OREQ OMMAT                                                        218984R
     C           RLDT      ANDEQOMMAT                                                        218984R
     C                     Z-ADDNRPD      WNRPD   50                                          201672
     C           RFRQ      IFNE *BLANKS                                                       201672
      *                                                                                       201672
     C********** WNRPD     DOWLEOMMAT                                                  201672 238838
     C           WNRPD     DOWLTOMMAT                                                         238838
     C           WNRPD     ANDGENRPD                                                        AR830785
     C           ##KIMI    ANDLTCPAM                                                          238838
     C                     ADD  RAMT      ##KIMI 150                                          201672
     C                     MOVELRFRQ      ZFREQ                                               201672
     C                     MOVELCCY       ZCCY                                                201672
     C                     Z-ADDWNRPD     ZDAYNO                                              201672
     C                     EXSR ZFRQB3                                                        201672
     C                     Z-ADDZDAYNO    WNRPD   50                                          201672
     C                     ENDDO                                                              201672
     C                     ELSE                                                               201672
     C                     ADD  RAMT      ##KIMI 150                                          201672
      *                                                                                       201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                             218984R
     C                     ENDIF                                                              201672
      *
     C                     Z-ADD##LPCP    ##AMT
     C                     SUB  ##KIMI    ##AMT                                               201672
     C           INTC      IFEQ 'Y'                                                           224582
     C                     ADD  WCALC     ##AMT                                               224582
     C                     SUB  WINPD     ##AMT                                               224582
     C                     ENDIF                                                              224582
      *                                                                                       201672
     C           LNRF      SETLLLOAMSOM1                                                      201672
     C           LNRF      READELOAMSOM1                 98                                   201672
      *                                                                                       201672
     C           *IN98     DOWEQ'0'                                                           201672
     C           RECIL     IFEQ 'D'                                                           201672
     C           VDATL     ANDLEOMMAT                                                         201672
     C           VDATL     ANDGTOVDAT                                                         218984
      *                                                                                       201672
     C           AMTPL     IFEQ 'MR'                                                          201672
     C           AMTPL     OREQ 'RE'                                                          201672
     C           AMTPL     OREQ 'PF'                                                          223592
     C           ##AMT     SUB  PRAML     ##AMT                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           AMTPL     IFEQ 'PI'                                                          201672
     C           AMTPL     OREQ 'PT'                                                          223592
     C           ##AMT     ADD  PRAML     ##AMT                                               201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
      *                                                                                     AR317587
      ** For MR with VDAT > Loan Maturity Date                                              AR317587
      *                                                                                     AR317587
     C           RECIL     IFEQ 'D'                                                         AR317587
     C           VDATL     ANDGTOMMAT                                                       AR317587
     C           AMTPL     ANDEQ'MR'                                                        AR317587
     C           ##AMT     SUB  PRAML     ##AMT                                             AR317587
     C                     ENDIF                                                            AR317587
      *                                                                                       201672
     C           LNRF      READELOAMSOM1                 98                                   201672
     C                     ENDDO                                                              201672
     C*                                                                                       218984
     C** For non-multicurrency rollovers, the amount is the difference                        218984
     C** between the expected principal and the new principal amount.                         218984
     C*                                                                                       218984
     C           ROLL      IFEQ 'Y'                                                           218984
     C           NCCY      ANDEQ*BLANKS                                                       218984
     C           *LIKE     DEFN ##AMT     SAVAMT                                              218984
     C           *LIKE     DEFN ##LOD     SAVLOD                                              218984
     C                     Z-ADD##AMT     SAVAMT                                              218984
     C                     MOVEL*BLANKS   SAVLOD                                              218984
     C           ##AMT     SUB  NPRAM     ##AMT                                               218984
     C           ##AMT     IFLT 0                                                             218984
     C                     Z-SUB##AMT     ##AMT                                               218984
     C                     MOVEL##LOD     SAVLOD                                              218984
     C           ##LOD     IFEQ 'L'                                                           218984
     C                     MOVEL'D'       ##LOD                                               218984
     C                     ELSE                                                               218984
     C                     MOVEL'L'       ##LOD                                               218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
      *                                                                   CLE034
     C           ##LOD     IFEQ 'L'                                       CLE034
     C                     MOVE 'R'       WPAYRC                          CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'P'       WPAYRC                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     EXSR SR34A                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE 'Y'       WRKFLD                          CLE034
     C                     MOVE '*EOF   ' WRTCD                           CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C           WRKFLD    DOWEQ'Y'                                       CLE034
     C           WRTCD     OREQ *BLANKS                                   CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34B                                     CLE034
     C                     ENDIF                                          CLE034
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
      *
     C                     Z-ADD003       ##RPNB           * 3 = maty date
     C                     MOVEL##NAR,4   ##NARR
     C           ROLL      IFEQ 'Y'                                                           220754
     C           NCCY      IFNE *BLANKS                                                       218984
     C                     MOVEL##NAR,6   ##NARR                                              220754
     C                     ELSE                                                               218984
     C           SAVLOD    IFEQ *BLANKS                                                       218984
     C                     MOVEL##NAR,7   ##NARR                                              218984
     C                     ELSE                                                               218984
     C                     MOVEL##NAR,8   ##NARR                                              218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              220754
      *
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     EXSR SRMOVE
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34C                                     CLE034
     C                     ELSE                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                          CLE034
     C                     ENDIF                                          CLE034
      *                                                                   CLE034
     C                     ENDDO                                          CLE034
      *                                                                   CLE034
     C           CLE034    IFEQ 'Y'                                       CLE034
     C           STAL      ANDEQ'Y'                                       CLE034
     C                     EXSR SR34E                                     CLE034
     C                     ENDIF                                          CLE034
     C*                                                                                       218984
     C** For non-multicurrency rollovers which produce increases                              218984
     C** set details back again.                                                              218984
     C*                                                                                       218984
     C           ROLL      IFEQ 'Y'                                                           218984
     C           NCCY      ANDEQ*BLANKS                                                       218984
     C           SAVLOD    IFNE *BLANKS                                                       218984
     C                     MOVELSAVLOD    ##LOD                                               218984
     C                     MOVEL*BLANKS   SAVLOD                                              218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
     C**********           END                             ** ##VDAT                          201672
     C                     ENDIF                           ** ##VDAT                          216999
     C                     ENDIF                                          175450
      *................................................................
      *
     C***********EXLOAN    TAG                                                                220754
     C           EXPROC    TAG                                                                220754
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRMOVE                                         *
      * Function    :  Pass Movement To Write Program                 *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRMOVE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if no amount to post
      *
     C           ##AMT     CABEQ*ZERO     EXMOVE
      *                                                                                       262642
     C           VALUE     IFEQ 'Y'                                                           262642
     C           VDAT      ANDNE0                                                             262642
     C           VDAT      ANDLTRUND                                                          262642
     C           ORED      ANDLTRUND                                                          262642
     C           W#REVI    ANDNE'Y'                                                           262642
     C                     GOTO EXMOVE                                                        262642
     C                     ENDIF                                                              262642
      *
      ** Determine account movement settlement details
      *
      ** If Lending Enhancements is on.                                                       CLE031
      ** Check whether a settlement currency has been used:                                   CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'R'                                                           CLE031
     C           SVSCCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
      * Store receipt settlement details                                                      CLE031
     C                     MOVELSVSCCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVSCCY    SCCY                                              AR943686
     C                     Z-ADDSVREXR    REXR                                              AR943686
     C                     MOVE SVREXI    REXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           ##PYRC    IFEQ 'P'                                                           CLE031
     C           SVPSCY    ANDNE*BLANK                                                        CLE031
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
      * Store pay settlement details                                                          CLE031
     C                     MOVELSVPSCY    ##CCY   3                                           CLE031
     C                     ENDIF                                                              218782
      *                                                                                     AR943686
     C                     MOVE SVPSCY    PSCY                                              AR943686
     C                     Z-ADDSVPEXR    PEXR                                              AR943686
     C                     MOVE SVPEXI    PEXI                                              AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     CLEARC#DTA
     C/COPY WNCPYSRC,AOOULEU0C3
      *
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
      *                                                                   CLE033
     C                     MOVE 'P'       C#ATYP                          CLE033
     C                     MOVELP@VL01    C#CNUM                          CLE033
     C                     MOVELP@VL02    C#ACOD                          CLE033
     C                     MOVEL'01'      C#ACSQ                          CLE033
     C                     MOVELBRCA      C#BRCA                          CLE033
     C*********************MOVEL##BRCA    C#BRCA                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C           ##SETM    IFEQ '01'
     C           ##SETM    OREQ '02'
     C           ##SETM    OREQ '07'
     C           ##SETM    OREQ '08'
     C           ##SETM    OREQ '12'
     C                     MOVEL'N'       C#ATYP
     C                     MOVEL##NOSN    C#NOSN
     C                     ELSE
     C           ##SETM    IFEQ '14'
     C                     MOVEL'R'       C#ATYP
     C                     MOVEL##ACNO    C#ACNO
     C                     ELSE
     C           ##SETM    IFEQ '04'
     C           ##SETM    OREQ '05'
     C                     MOVEL'P'       C#ATYP
      *                                                                   168066
      * For settlement type '04', must use fields from loan plus          168066
      * prime retail account number from Retail ICD. Note that the        168066
      * account sequence number is defaulted to '01' as this seems        168066
      * to be assumed everywhere else.                                    168066
     C           ##SETM    IFEQ '04'                                      168066
     C                     MOVEL##CNUM    C#CNUM                          168750
     C                     MOVE BMACCD    C#ACOD                          168066
     C                     MOVE '01'      C#ACSQ                          168066
     C                     MOVEL##BRCA    C#BRCA                          168750
     C                     ELSE                                           168066
     C                     MOVEL##CNUM    C#CNUM
     C                     MOVEL##ACOD    C#ACOD
     C                     MOVEL##ACSQ    C#ACSQ
     C                     MOVEL##BRCA    C#BRCA
     C                     END                                            168066
     C                     END
     C                     END
     C                     END
      *
      * OLPOS Incoming/Outgoing Indicator 'I' or 'O'
     C           ##PYRC    IFEQ 'P'
     C                     MOVEL'O'       C#IO             * outgoing
     C                     ELSE
     C                     MOVEL'I'       C#IO             * incoming
     C                     END
      *
      * Currency of transaction
     C                     MOVEL##CCY     C#CCY
      *
      * Transaction type
     C                     MOVEL##TRYP    C#TRYP
      * Transaction Narrative
     C/COPY WNCPYSRC,AOH00049
     C                     MOVEL##NARR    C#NARR
     C/COPY WNCPYSRC,AOH00050
      *                                                                                       241166
      * Include transaction details                                                           241166
     C           TRSNAR    IFEQ 'Y'                                                           241166
     C                     MOVE *BLANK    D#WORK                                              241166
     C                     MOVE ##TRN     D#TRN                                               241166
     C                     MOVE ##TRYP    D#TYP                                               241166
     C                     MOVE D#WORK    C#NARR                                              241166
      *                                                                                    BUG25226A
     C           ##RPNB    IFEQ 1                                                          BUG25226A
      *                                                                                    BUG25226A
     C                     MOVE *BLANKS   C#NARR                                           BUG25226A
     C                     MOVELCNUM      @KEY1  10                                        BUG25226A
     C                     CALL 'AOCUSTR1'                                                 BUG25226A
     C                     PARM '*MSG   ' @RTCD                                            BUG25226A
     C                     PARM '*KEY   ' @OPTN                                            BUG25226A
     C                     PARM           @KEY1  10                                        BUG25226A
     C                     PARM *BLANKS   @KYST   7                                        BUG25226A
     C           SDCUST    PARM SDCUST    DSLDY                                            BUG25226A
      *                                                                                    BUG25226A
     C           @RTCD     IFEQ *BLANK                                                     BUG25226A
     C           ##TRN     CAT  BBCRNM:1  C#NARR                                           BUG25226A
     C                     ENDIF                                                           BUG25226A
      *                                                                                    BUG25226A
     C                     ENDIF                                                           BUG25226A
     C                     ENDIF                                                              241166
      *                                                                                       241166
     C           ##REVI    IFEQ 'YES'
     C                     MOVE '*'       C#NARR
     C                     END
      *
      * DL/LE/GL/RE transaction reference
     C                     MOVEL##TRN     C#TRN
     C           WPRIN     IFEQ 'Y'                                                         MD021689
     C                     MOVE 'N'       WPRIN                                             MD021689
     C                     GOTO NOCNV                                                       MD021689
     C                     ENDIF                                                            MD021689
      *
      * Movement amount
      *                                                                                       CLE031
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVE ##AMT     WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If CLE031 - Lending Enhancements                                                     CLE031
      ** or CEU004 (EMU Settlement Ccy Conversion) is installed,                              CLE031
      ** check for settlement currency.                                                       CLE031
      *                                                                                       CLE031
     C           CLE034    IFEQ 'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WPAYRC    ANDEQ'P'                                                           CLE038
     C           LSPYBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE034    OREQ 'Y'                                                           CLE038
     C           STAL      ANDEQ'Y'                                                           CLE038
     C           WPAYRC    ANDEQ'R'                                                           CLE038
     C           LSRCBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE034    OREQ 'Y'                                                           CLE038
     C           STAL      ANDNE'Y'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE038    ORNE 'Y'                                                           CLE038
      *                                                                                       CLE038
     C                     MOVE 'N'       WRKEMU                                              CLE031
      * If CLE033 is on and settlement method is 09, postings can be                          218782
      * left in transaction ccy instead, if System Value = 'T'.                               218782
      *                                                                                       218782
     C           CLE033    IFNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
     C           ##PAYM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'P'                                                           218782
     C           ##RECM    ORNE '09'                                                          218782
     C           ##PYRC    ANDEQ'R'                                                           218782
      *                                                                                       CLE031
     C           CEU004    IFEQ 'Y'                                       CEU004
     C           SCCY      ANDNE*BLANK                                    CEU004
     C           SCCY      ANDNECCY                                       CEU004
     C           CLE031    ANDNE'Y'                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C           SCCY      ANDNE*BLANK                                                        CLE031
     C           SCCY      ANDNECCY                                                           CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C           PSCY      ANDNE*BLANK                                                        CLE031
     C           PSCY      ANDNECCY                                                           CLE031
      *                                                                                       CLE031
      * Determine which settlement ccy to use:                                                CLE031
     C           CLE031    IFNE 'Y'                        CEU004 set. ccy                    CLE031
     C           CLE031    OREQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     MOVE SCCY      SETCCY  3                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE PSCY      SETCCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * Check if movement currency is 'In' or 'EUR'.                                          CLE031
     C                     MOVELCCY       WCCY    3                                           CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    CCYDP   10                                          CLE031
     C                     Z-ADDA6SPRT    CCYSPT 138                                          CLE031
     C                     MOVE A6MDIN    CCYMDI  1                                           CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU  1                                           CLE031
     C                     ENDIF                                                              CLE031
      * Check if settlement currency is 'In' or 'EUR'.                                        CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C                     MOVE SETCCY    WCCY                                                CLE031
     C                     EXSR SRCURR                                                        CLE031
     C                     MOVE A6NBDP    SETDP   10                                          CLE031
     C                     MOVE A6SPRT    SETSPT 138                                          CLE031
     C                     MOVE A6MDIN    SETMDI  1                                           CLE031
      *                                                                                       CLE031
      * If EUR movement, settled in an 'In' ccy, use EU0200.                                  CLE031
     C           A6INCY    IFEQ 'Y'                                                           CLE031
     C                     MOVE 'Y'       WRKEMU                                              CLE031
     C                     ENDIF                                                              CLE031
      * If amount needs to be converted between EUR and                                       CLE031
      * an In currency, use EU0200.                                                           CLE031
     C           WRKEMU    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANKS   PRTCD                           CEU004
     C                     Z-ADD##AMT     PFRAM                           CEU004
     C                     MOVE CCY       PFRCY                           CEU004
     C**********           MOVE SCCY      PTOCY                                        CEU004 CLE031
     C                     MOVE SETCCY    PTOCY                                               CLE031
     C                     Z-ADD0         POUTA                           CEU004
     C                     Z-ADD0         PINTA                           CEU004
     C                     Z-ADD0         PEXRT                           CEU004
     C                     MOVE *BLANK    PMDIN                           CEU004
      *                                                                   CEU004
     C                     CALL 'EU0200'                                  CEU004
     C                     PARM           PRTCD   7        Return Code    CEU004
     C                     PARM           PFRAM  183       From amount    CEU004
     C                     PARM           PFRCY   3        From Currency  CEU004
     C                     PARM           PTOCY   3        To Currency    CEU004
     C                     PARM           POUTA  150       Out amount     CEU004
     C                     PARM           PINTA  183       In amount      CEU004
     C                     PARM           PEXRT  159       Exchange Rate  CEU004
     C                     PARM           PMDIN   1        Mult/Div Ind   CEU004
      *                                                                   CEU004
     C           PRTCD     IFEQ *BLANK                                    CEU004
     C                     Z-ADDPOUTA     ##AMT                           CEU004
     C                     ELSE                                           CEU004
     C                     MOVEL'*CALL   'W0FILE                          CEU004
     C                     MOVEL'EU0200  'W0KEY                           CEU004
     C                     Z-ADD904       W0ERNB                          CEU004
     C                     EXSR SRERR                                     CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      * Else, convert using settlement exchange rate.                                         CLE031
      * Determine which rate to use:                                                          CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'R'                                                           CLE031
     C                     Z-ADDREXR      ZEXCH                                               CLE031
     C                     MOVE REXI      ZMD                                                 CLE031
     C                     ELSE                                                               CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           ##PYRC    ANDEQ'P'                                                           CLE031
     C                     Z-ADDPEXR      ZEXCH                                               CLE031
     C                     MOVE PEXI      ZMD                                                 CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD##AMT     ZAMTCI                                              CLE031
     C                     MOVE CCY       ZCCYI                                               CLE031
     C                     MOVE SETCCY    ZCCYO                                               CLE031
     C                     Z-ADDCCYDP     ZCDPI                                               CLE031
     C                     Z-ADDSETDP     ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    ##AMT                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                                              218782
      *                                                                                       218782
     C                     ELSE                                                               CLE038
      ** Do nothing as amount is in correct currency                                          CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C           NOCNV     TAG                                                              MD021689
     C           ##PYRC    IFEQ 'P'
     C           ##REVI    ANDNE'YES'
     C           ##PYRC    OREQ 'R'
     C           ##REVI    ANDEQ'YES'
     C                     Z-SUB##AMT     C#AMT            * pay ie credit
     C                     ELSE
     C                     Z-ADD##AMT     C#AMT            * rec ie debit
     C                     END
      *
      * Module
     C                     MOVEL'LE'      C#MOD
      *
      * Olpos record number to update
      * '01' for FX (not used here)
      * '02' for Interest movements
      * '03' for Loans and deposits
     C           ##RPNB    IFEQ 2
     C                     MOVE '02'      C#OLRC
     C                     ELSE
     C                     MOVE '03'      C#OLRC
     C                     END
      *
      * Value date and posting date
     C                     Z-ADD##VDAT    C#VDAT
     C                     Z-ADD##VDAT    C#PSTD
      *
      * Indicator to show if removal allowed Y, N or " "
     C                     MOVEL'Y'       C#RPST
      *
      * Removal set number
     C                     Z-ADD##RPNB    C#RPNB
      *
      * Removal type "C" = Credit entries
      *              "D" = Debit entries
     C                     MOVEL'C'       C#RTYP
      *
      * Booking branch
     C                     MOVEL##BBRN    C#BBRN
      *                                                                                       CLE134
      ** Extension Reference Id/Number.                                                       CLE134
      *                                                                                       CLE134
     C                     MOVELXRFI      C#XRFI                                              CLE134
     C                     MOVELXRFN      C#XRFN                                              CLE134
      *
      *  If settlement details are present
      *  AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS
      *
      *  OTHERWISE
      *
      *  If no settlement details are present
      *  AOSPOSU0 will be called to only update OLPOS
      *
     C           C#ATYP    IFEQ *BLANK
      *
      * Set account type indicator to signify no settlement
     C                     MOVEL'X'       C#ATYP
      *
      * Set update indicators for no update
     C                     MOVE 'N'       C#PRON
     C                     MOVE 'N'       C#MEMS
     C                     MOVE 'N'       C#RSAC
     C                     END
      *                                                                   CEU004
      ** Do not generate maturity and interest postings if loan           137130
      ** is not auto-settled.                                             137130
      *                                                                   137130
     C           ##RPNB    IFNE 001                                       137130
     C           ##AUTO    ANDEQ'N'                                       137130
     C                     MOVE 'N'       C#PRON                          137130
     C                     MOVE 'N'       C#MEMS                          137130
     C                     MOVE 'N'       C#RSAC                          137130
     C                     END                                            137130
      *                                                                   137130
      ** If EMU feature (SAR CEU004) is on, then if the                   CEU004
      ** Settlement currency *NE transaction Ccy, convert amount.         CEU004
      *                                                                   CEU004
     C***********CEU004    IFEQ 'Y'                        If EMU         CEU004 146556
     C***********SCCY      IFNE *BLANKS                     If SetCCyExistCEU004 146556
     C***********SCCY      ANDNECCY                         And Ccys # EqlCEU004 146556
      *                                                                   CEU004 146556
     C***********          MOVE C#AMT     P@FRAM             Set Amnt ParmCEU004 146556
     C***********          MOVE CCY       P@FRCY             Set FrCcy PrmCEU004 146556
     C***********          MOVE SCCY      P@TOCY             Set ToCcy PrmCEU004 146556
      *                                                                   CEU004 146556
     C***********          EXSR XCAMT                        Cnv Amount   CEU004 146556
     C***********          MOVE P@OUTA    C#AMT              Set Cvrt Amt CEU004 146556
     C***********          MOVE SCCY      CCY                Set Cvrt Ccy CEU004 146556
     C***********          ENDIF                            End If        CEU004 146556
     C***********          ENDIF                           End If         CEU004 146556
      *                                                                   CLE033
      * CLE033 LEHOSTPD postings                                          CLE033
     C           ##VDAT    IFLT BJDNWD                                    CLE033
     C           CLE033    ANDEQ'Y'                                       CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C*                                                                                       223581
     C** Ignore value date entries in the past when loan is just amended                      223581
     C*                                                                                       223581
     C           ##RPNB    IFEQ 1                                                             223581
     C           ##VDAT    ANDEQVDAT                                                          223581
     C           VDAT      ANDLTRUND                                                          223581
     C           ORED      ANDNERUND                                                          223581
     C           ##REVI    IFEQ 'YES'                                                         223581
     C           W#REVI    ANDEQ'Y'                                                           223581
     C           ##REVI    OREQ 'YES'                                                         223581
     C           CHTP      ANDEQ'R'                                                           223581
     C                     EXSR HPOST                                                         223581
     C                     ELSE                                                               223581
     C*       Ignore                                                                          223581
     C                     ENDIF                                                              223581
     C                     ELSE                                                               223581
     C                     EXSR HPOST                                     CLE033
     C                     ENDIF                                                              223581
     C                     ENDIF                                          CLE033
      *                                                                                       CAP205
      ** Set C#MTYP to ##MTYP                                                                 CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL##MTYP    C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      *  Call AOSPOSU0
      *
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*ADD    'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE  8
     C                     MOVEL'AOSPOSU0'W0KEY  29
     C                     Z-ADD902       W0ERNB  30
     C                     EXSR SRERR
     C                     END
      *                                                                                       CER049
      *
      *................................................................
      *
     C           EXMOVE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************   CLE033
      *                                                               *   CLE033
      *  HPOST    : Write record to host file                         *   CLE033
      *                                                               *   CLE033
      *  CALLED BY: Various                                           *   CLE033
      *                                                               *   CLE033
      *  CALLS    : N/A                                               *   CLE033
      *                                                               *   CLE033
      *****************************************************************   CLE033
     C           HPOST     BEGSR                                          CLE033
      *                                                                   CLE033
      * Conditions                                                        CLE033
      *                                                                   CLE033
      * Start date                                                        CLE033
     C           ##NARR    IFEQ ##NAR,1                                   CLE033
      * Auto-settlement is on and meaningful value date                   CLE033
     C           ##AUTO    OREQ 'Y'                                       CLE033
     C           ##VDAT    ANDNE0                                         CLE033
      *                                                                                       CLE134
      ** AUTO = 'C' Loan is subjec to funds pre-check                                         CLE134
      *                                                                                       CLE134
     C           ##AUTO    OREQ 'C'                                                           CLE134
     C           ##VDAT    ANDNE0                                                             CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                   CLE033
      * Filling the fields                                                CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           CHTP      WHEQ 'I'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C           CHTP      OREQ 'A'                                       CLE033
     C           WBSETM    ANDNE'09'                                      CLE033
     C           ##SETM    ANDEQ'09'                                      CLE033
     C           #BRCID    ANDNE*BLANKS                                   CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Insert  'HOACTN                          CLE033
     C           CHTP      WHEQ 'A'                                       CLE033
     C           ##REVI    ANDNE'YES'                                     CLE033
     C                     MOVEL'Amend   'HOACTN                          CLE033
     C           CHTP      WHEQ 'R'                                       CLE033
     C           ##REVI    OREQ 'YES'                                     CLE033
     C                     MOVEL'Reverse 'HOACTN                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     SELEC                                          CLE033
     C           PTYP      WHEQ 64                                        CLE033
     C           PTYP      OREQ 65                                        CLE033
     C           PTYP      OREQ 68                                        CLE033
     C           PTYP      OREQ 71                                        CLE033
     C                     MOVEA#AM,1     HOTRYP                          CLE033
     C           PTYP      WHEQ 66                                        CLE033
     C           PTYP      OREQ 67                                        CLE033
     C           PTYP      OREQ 69                                        CLE033
     C           PTYP      OREQ 72                                        CLE033
     C                     MOVEA#AM,2     HOTRYP                          CLE033
     C                     OTHER                                          CLE033
     C                     MOVEA#AM,3     HOTRYP                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     MOVEL##NARR    W0NARR  1                       CLE033
     C                     MOVELPTYP      W0PTYP  2                       CLE033
     C           W0PTYP    CAT  W0NARR    HOETYP                          CLE033
     C                     SELEC                                          CLE033
     C           W0NARR    WHEQ 'V'                                       CLE033
     C           PTYP      IFEQ 63                                        CLE033
     C           PTYP      OREQ 65                                        CLE033
     C           PTYP      OREQ 67                                        CLE033
     C                     MOVE 2         HOETYP                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C                     ENDIF                                          CLE033
     C           W0NARR    WHEQ 'I'                                       CLE033
     C                     MOVE 2         HOETYP                          CLE033
     C           W0NARR    WHEQ 'R'                                       CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C           W0NARR    WHEQ 'M'                                       CLE033
     C                     MOVE 1         HOETYP                          CLE033
     C                     ENDSL                                          CLE033
      *                                                                   CLE033
     C                     MOVEL##NARR    HOETYD                          CLE033
     C**********           Z-ADDCNUM      HOCNUM                                       CLE033 CSD027
     C                     MOVE CNUM      HOCNUM                                              CSD027
     C**********           Z-ADDLNRF      HOLNRF                                       CLE033 CLE148
     C                     MOVELLNRF      HOLNRF                                              CLE148
     C                     Z-ADD0         HOLASN                          CLE033
     C                     Z-ADDFTYP      HOFTYP                          CLE033
     C                     Z-ADDFSEQ      HOFSEQ                          CLE033
     C                     Z-ADD0         HOFESQ                          CLE033
     C                     MOVE BRCA      HOBRCA                          CLE033
     C                     MOVE LTYP      HOLTYP                          CLE033
     C                     MOVE SUTP      HOSUTP                          CLE033
     C                     MOVE CLAS      HOCLAS                          CLE042
     C                     Z-ADDRUND      HOPSTD                          CLE033
     C                     Z-ADD##VDAT    HOVALD                          CLE033
     C                     MOVE CCY       HOCCY                           CLE033
     C                     Z-ADD##AMT     HOPSTA                          CLE033
      *                                                                   CLE033
     C                     MOVE *BLANKS   W0PNA1  5                       CLE033
     C                     MOVELLTYP      W0PNA1                          CLE033
     C                     MOVE LNRF      W0PNA2  6                       CLE033
     C           W0PNA1    CAT  W0PNA2    HOPNAR                          CLE033
      *                                                                   CLE033
     C                     MOVE ##AUTO    HOAUTO                          CLE033
      *                                                                   CLE033
     C           ##REVI    IFEQ 'YES'                                     CLE033
     C           ##PYRC    IFEQ 'P'                                       CLE033
     C                     MOVE 'R'       HOTLXY                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE 'P'       HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
     C                     ELSE                                           CLE033
     C                     MOVE ##PYRC    HOTLXY                          CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       220257
      * If posting amount is negative, convert to a positive amount                           220257
      * and change the debit/credit indicator                                                 220257
      *                                                                                       220257
     C           ##AMT     IFLT 0                                                             220257
     C                     Z-SUB##AMT     HOPSTA                                              220257
     C           HOTLXY    IFEQ 'P'                                                           220257
     C                     MOVE 'R'       HOTLXY                                              220257
     C                     ELSE                                                               220257
     C                     MOVE 'P'       HOTLXY                                              220257
     C                     ENDIF                                                              220257
     C                     ENDIF                                                              220257
      *                                                                   CLE033
     C                     Z-ADDINTR      HOINTR                          CLE033
     C                     MOVE BRTT      HOBRTT                          CLE033
     C                     Z-ADDBRTE      HOBRTE                          CLE033
     C                     Z-ADDRTSP      HORTSP                          CLE033
     C                     MOVE SPIN      HOSPIN                          CLE033
     C                     Z-ADDMARG      HOMARG                          CLE033
     C                     MOVE SCCY      HOSCCY                          CLE033
     C                     Z-ADDREXR      HOREXR                          CLE033
     C                     MOVE REXI      HOREXI                          CLE033
     C*********************MOVE OSDB      HORHBR                          CLE033
     C                     MOVE ##RECB    HORHBR                          CLE033
     C*********************MOVE RONS      HORHAC                          CLE033
     C                     MOVE ##RECA    HORHAC                          CLE033
     C**********           Z-ADDROBN      HOROBN                          CLE033       CLE033 CSD027
     C**********           Z-ADDROCN      HOROCN                          CLE033       CLE033 CSD027
     C                     MOVE ROBN      HOROBN                                              CSD027
     C                     MOVE ROCN      HOROCN                                              CSD027
     C                     MOVE RIBN      HORIBN                          CLE033
     C                     MOVE RIBA      HORIBA                          CLE033
     C                     MOVE PSCY      HOPSCY                          CLE033
     C                     Z-ADDPEXR      HOPEXR                          CLE033
     C                     MOVE PEXI      HOPEXI                          CLE033
     C                     MOVE ##PAYB    HOPHBR                          CLE033
     C                     MOVE ##PAYA    HOPHAC                          CLE033
     C**********           Z-ADDPOBN      HOPOBN                          CLE033       CLE033 CSD027
     C**********           Z-ADDPOCN      HOPOCN                          CLE033       CLE033 CSD027
     C                     MOVE POBN      HOPOBN                                              CSD027
     C                     MOVE POCN      HOPOCN                                              CSD027
     C                     MOVE PIBA      HOPIBA                          CLE033
     C                     MOVE RVNO      HORVNO                          CLE033
     C                     MOVE CVMR      HOCVMR                          CLE033
     C                     MOVE RCRN      HORCRN                          CLE033
     C                     MOVE RCRA      HORCRA                          CLE033
     C                     MOVE AWBN      HOAWBN                          CLE033
     C                     MOVE AWBA      HOAWBA                          CLE033
     C                     MOVE BENN      HOBENN                          CLE033
     C                     MOVE BENA      HOBENA                          CLE033
     C                     MOVE DTP1      HODTP1                          CLE033
     C                     MOVE DTP2      HODTP2                          CLE033
     C                     MOVE DTP3      HODTP3                          CLE033
     C                     MOVE DTP4      HODTP4                          CLE033
     C                     MOVE DCHG      HODCHG                          CLE033
     C                     MOVE BTB1      HOBTB1                          CLE033
     C                     MOVE BTB2      HOBTB2                          CLE033
     C                     MOVE BTB3      HOBTB3                          CLE033
     C                     MOVE BTB4      HOBTB4                          CLE033
     C                     MOVE BTB5      HOBTB5                          CLE033
     C                     MOVE BTB6      HOBTB6                          CLE033
     C                     Z-ADDTNLU      HOTNLU                          CLE033
     C                     MOVE *BLANKS   HOPROG                                              218782
     C                     MOVEL'AOOULEU0'HOPROG                                              218782
     C                     Z-ADD0         HOSEQN                                              218782
     C                     MOVE *BLANKS   HOSTAT                                              218782
      *                                                                   CLE033
     C                     WRITELEHOSTD0                                  CLE033
      *                                                                   CLE033
     C           P@VL03    IFNE *BLANKS                                   CLE033
     C                     CALL P@VL03                                    CLE033
     C/COPY WNCPYSRC,AOOULEU0C9                                           CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE033
     C                     ENDSR                                          CLE033
      *****************************************************************   CLE033
     C/SPACE 5                                                            CLE033
      *****************************************************************
      *                                                               *
      *  SRDCPI   : Determine principal & interest at defined date    *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRDCPI    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDCPI'  @STK,Q
      *
      *................................................................
      *
      * loan accrued interest to control date, interest paid/received
      * to date and interest capitalized to date (from CLOAN file)
     C*
     C                     Z-ADDAITC      ##AITC 130
     C                     Z-ADDIPRD      ##IPRD 130
     C                     Z-ADDICTD      ##ICTD 130
     C                     Z-ADDAIMN      ##AIMN 130                      173122
     C                     Z-ADDAIAP      ##AIAP 130                      173122
      *
      * (Latest) loan principal
     C                     Z-ADD##PCPL    ##LPCP 130
      *
      * (Latest) loan interest rate
     C                     Z-ADD##INTR    ##LINT 117
      *
      * loan interest calculation basis
     C                     MOVEL##ICBS    ZCBCBS  10
      *
     C                     Z-ADDIACD      ##IACD  50         Midas day no.
      *
      * OMIT    value date and sequence number on LOAMSDK
     C                     Z-ADD$$VDSN    $$VDSN
      *
      * READ TO value date and sequence number on LOAMSDK
     C                     Z-ADD##VDSN    ##VDSN
     C*
     C           MLOAMK    KLIST
     C                     KFLD           ##DLNO
     C                     KFLD           ##IACD
     C*
     C           MLOAMK    SETLLLOAMSDKF
     C           ##DLNO    READELOAMSDKF                 99*
      *
      * Omit loan amendment?
     C                     Z-ADDLAVDAT    @@VYMD           * Loam value date
     C                     Z-ADDLASN      @@DS38           * Loam seq.number
     C           @@VDSN    IFEQ $$VDSN
     C           ##DLNO    READELOAMSDKF                 99*
     C                     Z-ADDLAVDAT    @@VYMD           * Loam value date
     C                     Z-ADDLASN      @@DS38           * Loam seq.number
     C                     END
      *
      * Whilst loan amendments can be found, apply the changes
      *
     C           *IN99     DOWEQ'0'
     C********** @@VDSN    ANDLT##VDSN                                                        223739
     C********** *IN99     OREQ '0'                                                    182725 223739
     C********** @@VDSN    ANDGE##VDAT                                                 182725 223739
      *****************************************************************                182725 223739
      ***Check*if*future*valued*'PI',*'MR'*or*'RE'*was*considered******                182725 223739
      *****************************************************************                182725 223739
     C********** ##REVI    IFEQ 'YES'                                                  182725 223739
     C********** @@VDSN    ANDGE##VDAT                                                 182725 223739
     C           ##REVI    IFEQ 'YES'                                                         223739
     C           @@VDSN    ANDLE##VDSN                                                        223739
      *                                                                   182725
     C           PRAM      IFLT 0                                         182775
     C                     Z-SUBPRAM      PRAM                            182725
     C                     ELSE                                           182725
     C                     Z-ADDPRAM      PRAM                            182725
     C                     END                                            182725
      *                                                                   182725
      ** Principal increase, add loan amendment amount to principal       182725
      *                                                                   182725
     C           VALUE     IFEQ 'Y'                                       182725
      *                                                                   182725
     C           AMTP      IFEQ 'PI'                                      182725
     C           AMTP      OREQ 'PT'                                                          223592
     C                     ADD  PRAM      ##PCPL                          182725
     C                     END                                            182725
      *                                                                   182725
      ** Manual Repayment and Repayment Schedule                          182725
      *                                                                   182725
     C           AMTP      IFEQ 'MR'                                      182725
     C           AMTP      OREQ 'RE'                                      182725
     C********** AUTO      ANDEQ'Y'                                                  182725 MD006755
     C           LAAUTO    ANDEQ'Y'                                                         MD006755
      *                                                                                       CLE134
     C           AMTP      OREQ 'RE'                                                          CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C           AMTP      OREQ 'PF'                                                          223592
     C                     SUB  PRAM      ##PCPL                          182725
     C                     END                                            182725
      *                                                                   182725
     C                     END                                            182725
      *                                                                   182725
     C                     ELSE                                           182725
      *
      * Calculate the interest between the current interest accrual
      * control date and the the value date of the loan amendment
      *
     C           @@VDSN    IFLT ##VDSN                                                        223739
     C                     Z-ADD##IACD    ZCBSDT
     C                     Z-ADDLAVDAT    ZCBEDT
     C           ZCBEDT    IFGT ZCBSDT
     C                     Z-ADD##LPCP    ZDLAMT 130
     C                     Z-ADD##LINT    ZDLRAT
     C                     EXSR ZDLINT
     C                     ADD  ZDLOUT    ##AITC
     C                     Z-ADDZCBEDT    ##IACD
     C                     END
      *
     C                     Z-ADDPRAM      PRAM         99  *
     C   99                Z-SUBPRAM      PRAM
      **********                                                          182725
      **Principal*increase,*add*loan*amendment*amount*to*principal*****   182725
     C********** AMTP      IFEQ 'PI'                                      182725
     C**********           ADD  PRAM      ##LPCP                          182725
     C**********           END                                            182725
      *
      * If the loan amendment is a rate change, change the interest rate
      *
     C           AMTP      IFEQ 'SC'
     C                     Z-ADDLARTSP    ##LINT
     C                     END
      *                                                                   182725
     C                     END                                                                223739
      *                                                                                       223739
     C           @@VDSN    IFLT ##VDSN                                                        223739
     C           @@VYMD    ORLE ##VYMD                                                        223739
     C           VALUE     ANDEQ'Y'                                                           223739
     C           PRAM      IFLT 0                                                             223739
     C                     Z-SUBPRAM      PRAM                                                223739
     C                     ELSE                                                               223739
     C                     Z-ADDPRAM      PRAM                                                223739
     C                     END                                                                223739
      *                                                                                       223739
      ** Principal increase, add loan amendment amount to principal                           223739
      *                                                                                       223739
     C           AMTP      IFEQ 'PI'                                                          223739
     C                     ADD  PRAM      ##PCPL                                              223739
     C                     END                                                                223739
      *                                                                                       223739
      ** Manual Repayment and Repayment Schedule                                              223739
      *                                                                                       223739
     C           AMTP      IFEQ 'MR'                                                          223739
     C           AMTP      OREQ 'RE'                                                          223739
     C********** AUTO      ANDEQ'Y'                                                  223739 MD006755
     C           LAAUTO    ANDEQ'Y'                                                         MD006755
      *                                                                                       CLE134
     C           AMTP      OREQ 'RE'                                                          CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C           AMTP      OREQ 'PF'                                                          223739
     C                     SUB  PRAM      ##PCPL                                              223739
     C                     END                                                                223739
     C                     END                                                                223739
     C                     END                                            182725
      *
      * Read next record
      *
     C           ##DLNO    READELOAMSDKF                 99*
      *
      * Omit loan amendment?
     C                     Z-ADDLAVDAT    @@VYMD           * Loam value date
     C                     Z-ADDLASN      @@DS38           * Loam seq.number
     C           @@VDSN    IFEQ $$VDSN
     C           ##DLNO    READELOAMSDKF                 99*
     C                     Z-ADDLAVDAT    @@VYMD           * Loam value date
     C                     Z-ADDLASN      @@DS38           * Loam seq.number
     C                     END
      *
     C                     END                             * IN99DOWEQ'0'
      *
      * Calculate the interest between the control date and
      * the event date
      *
     C           ##VDAT    IFGT ##IACD
     C                     Z-ADD##IACD    ZCBSDT
     C                     Z-ADD##VDAT    ZCBEDT
     C                     Z-ADD##LPCP    ZDLAMT
     C                     Z-ADD##LINT    ZDLRAT
     C                     EXSR ZDLINT
     C                     ADD  ZDLOUT    ##AITC
     C                     Z-ADD##VDAT    ##IACD
     C                     END
      *
      * The interest due at the event date is the interest to the event date
      * minus the interest paid/received and capitalized to date
      *
     C                     Z-ADD##AITC    ##INTD 130
     C                     ADD  ##AIMN    ##INTD                          173122
     C                     ADD  ##AIAP    ##INTD                          173122
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C                     SUB  ##IPRD    ##INTD
     C                     ENDIF                                                              CLE028
     C                     SUB  ##ICTD    ##INTD           * interest due
      *
      *................................................................
      *  Unwind subroutine stack name
      *
     C           EXDCPI    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow postings in store     *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *................................................................
      *
      *  Call AOSPOSU0 to update database
      *
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*UPDATE 'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD903       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all postings in store                       *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *................................................................
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARC#DTA
     C                     Z-ADD0         W1                                                 BUG8747
     C                     CALL 'AOSPOSU0'             9090
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       122960
     C           R#RTN     PARM ##RTCD    O#RTN   7                       122960
     C                     PARM '*CLEAR  'W0ACT   8
     C                     PARM C#DTA     O#DTA 256
      *
     C           *IN90     IFEQ '1'
     C***********R#RTN     ORNE *BLANKS                                   122960
     C           R#RTN     OREQ '*ERROR*'                                 122960
     C                     MOVEL'*CALL   'W0FILE
     C                     MOVEL'AOSPOSU0'W0KEY
     C                     Z-ADD901       W0ERNB
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *................................................................                       CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
      *                                                                                       CSC022
      ** Access SAR details file to determine if CSC022 switchable feature                    CSC022
      ** is switched on                                                                       CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD   7                                           CSC022
     C                     PARM '*VERIFY' @OPTN   7                                           CSC022
     C                     PARM 'CSC022'  @SARD                                               CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C                     MOVE 'N'       WCMT01  1                                           CSC022
      *                                                                                       CSC022
      * SCCMTJOB data area                                                                    CSC022
     C           *NAMVAR   DEFN SCCMTJOB  WDSJB                                               CSC022
     C                     IN   WDSJB                                                         CSC022
      *                                                                                       CSC022
      * Move data area to commitment array                                                    CSC022
     C           COMMTN    IFGT 0                                                             CSC022
     C                     MOVEACOMMTJ    JBNAM                                               CSC022
     C                     Z-ADD1         WCNT@@  20                                          CSC022
      *                                                                                       CSC022
     C           WDSJOB    LOKUPJBNAM                    17                                   CSC022
     C           *IN17     IFEQ *ON                                                           CSC022
     C                     MOVE 'Y'       WCMT01                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CSC022
     C                     ELSE                                                               CSC022
      * @rtcd not found                                                                       CSC022
     C           @RTCD     IFNE '*NRF'                                                        CSC022
     C           *NAMVAR   DEFN           LDA                                                 CSC022
     C           *LOCK     IN   LDA                                                           CSC022
     C                     MOVEL'CSC022'  DBKEY                                               CSC022
     C                     MOVEL'AOOULEU0'DBFILE                                              CSC022
     C                     MOVEL'SCSARDPD'DBFILE                                              CSC022
     C                     Z-ADD905       DBASE                                               CSC022
     C                     OUT  LDA                                                           CSC022
     C                     EXSR SRERR                                                         CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CSC022
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRERR    : Report error and close down program               *
      *                                                               *
      *  CALLED BY: Various                                           *
      *  CALLS    : *NONE                                             *
      *                                                               *
      *****************************************************************
     C           SRERR     BEGSR
      *
      *  Dump program
      *
     C           O#RTN     IFEQ '*RECLCK'                                                   AR868380
     C           R#RTN     OREQ '*RECLCK'                                                   AR868380
     C                     ROLBK                                                            AR868380
     C                     SETON                     LR                                     AR868380
     C                     MOVEL'*RECLCK' ##RTCD                                            AR868380
     C                     ELSE                                                             AR868380
     C                     DUMP
     C           ##RTCD    IFNE '*LEBTCH'                                 122960
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           WCMT01    IFNE 'Y'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                       U7U8                                   CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                          122960
      *
      *  Close down program
      *
     C                     SETON                     LR
     C                     MOVEL'*ERROR*' ##RTCD
      *                                                                                     AR868380
     C                     ENDIF                                                            AR868380
      *                                                                                     AR868380
     C                     RETRN
      *
     C           EXERR     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *                                                                                       219608
     C                     MOVEL'AOOULEU0'W0PGM   8                                           219608
     C                     MOVE *BLANKS   W0FILE                                              219608
     C                     MOVE *BLANKS   W0KEY                                               219608
     C                     Z-ADD0         W0ERNB                                              219608
      *                                                                                       207497
      ** Retrieve midas module details                                                        207497
      *                                                                                       207497
     C                     CALL 'AOMMODR0'                                                    207497
     C                     PARM *BLANKS   @RTCD                                               207497
     C                     PARM '*FIRST ' @OPTN                                               207497
     C           SDMMOD    PARM SDMMOD    DSFDY                                               207497
      *................................................................                       207497
      *
      ** Access general ledger details                                                        201672
      *                                                                                       201672
     C**********           CALL 'AOGELRR0'                                             201672 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                                               201672
     C                     PARM '*FIRST ' @OPTN                                               201672
     C********** SDGELR    PARM SDGELR    DSFDY                                        201672 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *................................................................
      *
      ** ACCESS BANK DETAILS                                              125373
     C                     CALL 'AOBANKR0'                                125373
     C                     PARM '*DBERR ' @RTCD   7                       125373
     C                     PARM '*FIRST ' @OPTN   7                       125373
     C           SDBANK    PARM SDBANK    DSFDY                           125373
      *                                                                                       191051
      ** Access GL ICD details                                                                191051
      *                                                                                       191051
     C**********           CALL 'AOGELRR0'                                             191051 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                                           191051
     C                     PARM '*FIRST ' @OPTN   7                                           191051
     C********** SDGELR    PARM SDGELR    DSFDY                                        191051 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   168066
      * Retrieve Retail ICD (used for settlement type 04)                 168066
      * But only if Retail is installed.                                                      207497
     C           BGRTBN    IFEQ 'Y'                                                           207497
     C           BGNXST    ANDEQ'Y'                                                           207497
     C                     CALL 'AORETLR0'                                168066
     C                     PARM '*DBERR ' @RTCD   7                       168066
     C                     PARM '*FIRST ' @OPTN   7                       168066
     C           SDRETL    PARM SDRETL    DSFDY                           168066
      *                                                                   168066
     C                     ENDIF                                                              207497
      *                                                                                       207497
      **  Initialise work fields
     C                     MOVEL'P'       ##PAY
     C                     MOVEL'R'       ##REC
     C                     MOVEL*BLANKS   R#RTN   7
     C                     MOVE '0'       *IN98
      *                                                                   CEU004
      **  Check if LE Settlement Currency Enhancement - CEU004            CEU004
      *   is installed                                                    CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANKS   @RTCD   7                       CEU004
     C                     PARM '*VERIFY' @OPTN   7                       CEU004
     C                     PARM 'CEU004'  PSARD   6                       CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
      *                                                                   CEU004
      ** If feature is on, set up SAR work flag                           CEU004
      *                                                                   CEU004
     C           @RTCD     IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004                          CEU004
     C                     ELSE                                           CEU004
      *                                                                   CEU004
      ** else, database error (return code other than *NRF)               CEU004
      *                                                                   CEU004
     C                     MOVE 'N'       CEU004  1                       CEU004
     C           @RTCD     IFNE '*NRF   '                                 CEU004
     C                     MOVEL'AOOULAUO'W0PGM   8                       CEU004
     C                     MOVEL'SCSARDPD'W0FILE                          CEU004
     C                     MOVEL'*VERIFY' W0KEY                           CEU004
     C                     Z-ADD905       W0ERNB                          CEU004
     C                     EXSR SRERR                                     CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                                       CLE031
      **  Check if CLE031 - Lending Enhancements is on.                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD   7                                           CLE031
     C                     PARM '*VERIFY' @OPTN   7                                           CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
      ** If feature is on, set up SAR work flag                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** else, database error if return code other than *NRF.                                 CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C           @RTCD     IFNE '*NRF   '                                                     CLE031
     C                     MOVEL'AOOULAUO'W0PGM   8                                           CLE031
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE031
     C                     MOVEL'*VERIFY' W0KEY                                               CLE031
     C                     Z-ADD906       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   CLE033
     C**  Read switchable features file SCSARDPD using access object      CLE033
     C**  to determine if switchable feature (CLE033) is switched ON      CLE033
     C*                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
     C*                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD  7                       CLE033
     C                     PARM '*VERIFY' W0OPTN  7                       CLE033
     C                     PARM 'CLE033'  W0SARD  6                       CLE033
     C           SCSARD    PARM SCSARD    DSFDY                           CLE033
     C*                                                                   CLE033
     C**  If feature is on, set up CLE033 variable                        CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFEQ *BLANKS                                   CLE033
      *                                                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
     C                     CALL 'AOSVALR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD                          CLE033
     C                     PARM SVAL,1    P@OP01 20                       CLE033
     C                     PARM *BLANKS   P@VL01200                       CLE033
     C                     PARM SVAL,2    P@OP02 20                       CLE033
     C                     PARM *BLANKS   P@VL02200                       CLE033
     C                     PARM SVAL,3    P@OP03 20                       CLE033
     C                     PARM *BLANKS   P@VL03200                       CLE033
     C**********           PARM *BLANKS   P@OP04 20                                    CLE033 218782
     C                     PARM SVAL,4    P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                       CLE033
     C**********           PARM *BLANKS   P@OP05 20                       CLE033              241166
     C                     PARM SVAL,5    P@OP05 20                                           241166
     C                     PARM *BLANKS   P@VL05200                       CLE033
     C**********           PARM *BLANKS   P@OP06 20                                  CLE033 MD035545
     C                     PARM SVAL,6    P@OP06 20                                         MD035545
     C                     PARM *BLANKS   P@VL06200                       CLE033
     C                     PARM *BLANKS   P@OP07 20                       CLE033
     C                     PARM *BLANKS   P@VL07200                       CLE033
     C                     PARM *BLANKS   P@OP08 20                       CLE033
     C                     PARM *BLANKS   P@VL08200                       CLE033
     C                     PARM *BLANKS   P@OP09 20                       CLE033
     C                     PARM *BLANKS   P@VL09200                       CLE033
     C                     PARM *BLANKS   P@OP10 20                       CLE033
     C                     PARM *BLANKS   P@VL10200                       CLE033
     C***********SDSVAL    PARM SDSVAL    DSSDY                           CLE033              222373
      *                                                                   CLE033
     C           W0RTCD    IFNE *BLANKS                                   CLE033
     C                     MOVEL'AOOULEU0'W0PGM   8                       CLE033
     C                     MOVEL'SDSVALPD'W0FILE                          CLE033
     C                     MOVEL'*KEY   ' W0KEY                           CLE033
     C                     Z-ADD906       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL04    SET09   1                                           218782
      * Save value of SdwPstIncTransRef in a one character field                              241166
     C                     MOVELP@VL05    TRSNAR  1                                           241166
     C                     MOVELP@VL06    WCALC6                                            MD035545
      *                                                                   CLE033
     C                     ELSE                                           CLE033
     C*                                                                   CLE033
     C** else, database error (return code other than *NRF)               CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFNE '*NRF   '                                 CLE033
     C                     MOVEL'AOOULEU0'W0PGM   8                       CLE033
     C                     MOVEL'SCSARDPD'W0FILE                          CLE033
     C                     MOVEL'*VERIFY' W0KEY                           CLE033
     C                     Z-ADD907       W0ERNB                          CLE033
     C                     EXSR SRERR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                    BUG25226A
     C                     CALL 'AOSVALR0'                                                 BUG25226A
     C                     PARM *BLANKS   W0RTCD                                           BUG25226A
     C                     PARM SVAL,5    P@OP01 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL01200                                        BUG25226A
     C**********           PARM *BLANKS   P@OP02 20                                         MD035545
     C                     PARM SVAL,6    P@OP02 20                                         MD035545
     C                     PARM *BLANKS   P@VL02200                                        BUG25226A
     C                     PARM *BLANKS   P@OP03 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL03200                                        BUG25226A
     C                     PARM *BLANKS   P@OP04 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL04200                                        BUG25226A
     C                     PARM *BLANKS   P@OP05 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL05200                                        BUG25226A
     C                     PARM *BLANKS   P@OP06 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL06200                                        BUG25226A
     C                     PARM *BLANKS   P@OP07 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL07200                                        BUG25226A
     C                     PARM *BLANKS   P@OP08 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL08200                                        BUG25226A
     C                     PARM *BLANKS   P@OP09 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL09200                                        BUG25226A
     C                     PARM *BLANKS   P@OP10 20                                        BUG25226A
     C                     PARM *BLANKS   P@VL10200                                        BUG25226A
      *                                                                                    BUG25226A
     C           W0RTCD    IFNE *BLANKS                                                    BUG25226A
     C                     MOVEL'AOOULEU0'W0PGM   8                                        BUG25226A
     C                     MOVEL'SDSVALPD'W0FILE                                           BUG25226A
     C                     MOVEL'*KEY   ' W0KEY                                            BUG25226A
     C                     Z-ADD906       W0ERNB                                           BUG25226A
     C                     EXSR SRERR                                                      BUG25226A
     C                     ENDIF                                                           BUG25226A
      * Save value of SdwPstIncTransRef in a one character field                           BUG25226A
     C                     MOVELP@VL01    TRSNAR  1                                        BUG25226A
     C                     MOVELP@VL02    WCALC6                                            MD035545
      *                                                                                    BUG25226A
     C*                                                                   CLE033
     C                     ENDIF                                          CLE033
      *                                                                                     MD035545
     C           WCALC6    IFEQ 'Y'                                                         MD035545
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C                     MOVE 'Y'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ENDIF                                                            MD035545
      *                                                                                       CLE034
      **  Check if CLE034 is installed                                                        CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   @RTCD                                               CLE034
     C                     PARM '*VERIFY' @OPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
      ** If feature is on, set up SAR work flag                                               CLE034
      *                                                                                       CLE034
     C           @RTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** else, database error if return code other than *NRF.                                 CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
     C           @RTCD     IFNE '*NRF   '                                                     CLE034
     C                     MOVEL'AOOULEUO'W0PGM                                               CLE034
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE034
     C                     MOVEL'*VERIFY' W0KEY                                               CLE034
     C                     Z-ADD909       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   CLE033
      *                                                                                       CLE028
      ** Check whether SAR CLE028 is installed                                                CLE028
      *                                                                                       CLE028
     C                     MOVE 'N'       CLE028  1                                           CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   PRTCD   7                                           CLE028
     C                     PARM '*VERIFY' POPTN   7                                           CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANK                                                        CLE028
     C                     MOVE 'Y'       CLE028                                              CLE028
     C                     ELSE                                                               CLE028
     C           PRTCD     IFNE '*NRF   '                                                     CLE028
     C                     MOVEL'AOOULEU0'W0PGM                                               CLE028
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE028
     C                     MOVEL'CLE028 ' W0KEY                                               CLE028
     C                     Z-ADD906       W0ERNB                                              CLE028
     C                     EXSR SRERR                                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE038
      **  Check if CLE038 is installed                                                        CLE038
      *                                                                                       CLE038
     C                     CALL 'AOSARDR0'                                                    CLE038
     C                     PARM *BLANKS   @RTCD                                               CLE038
     C                     PARM '*VERIFY' @OPTN                                               CLE038
     C                     PARM 'CLE038'  PSARD                                               CLE038
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE038
      *                                                                                       CLE038
      ** If feature is on, set up SAR work flag                                               CLE038
      *                                                                                       CLE038
     C           @RTCD     IFEQ *BLANKS                                                       CLE038
     C                     MOVE 'Y'       CLE038                                              CLE038
     C                     ELSE                                                               CLE038
      *                                                                                       CLE038
      ** else, database error if return code other than *NRF.                                 CLE038
      *                                                                                       CLE038
     C                     MOVE 'N'       CLE038  1                                           CLE038
     C           @RTCD     IFNE '*NRF   '                                                     CLE038
     C                     MOVEL'AOOULEUO'W0PGM                                               CLE038
     C                     MOVEL'SCSARDPD'W0FILE                                              CLE038
     C                     MOVEL'*VERIFY' W0KEY                                               CLE038
     C                     Z-ADD911       W0ERNB                                              CLE038
     C                     EXSR SRERR                                                         CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CLE038
     C                     ENDIF                                                              CLE038
      *                                                                                       CAP205
      **  Check if CAP205 is installed                                                        CAP205
      *                                                                                       CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
      ** If feature is on, set up SAR work flag                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
      *                                                                                       CAP205
      ** else, database error if return code other than *NRF.                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C           @RTCD     IFNE '*NRF   '                                                     CAP205
     C                     MOVEL'AOOULEUO'W0PGM                                               CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD912       W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CRE073
      ** Determine if CRE073 is installed                                                     CRE073
      *                                                                                       CRE073
     C                     MOVE 'N'       CRE073  1                                           CRE073
     C                     CALL 'AOSARDR0'                                                    CRE073
     C                     PARM *BLANKS   @RTCD                                               CRE073
     C                     PARM '*VERIFY' @OPTN                                               CRE073
     C                     PARM 'CRE073'  PSARD                                               CRE073
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE073
      *                                                                                       CRE073
     C           @RTCD     IFEQ *BLANKS                                                       CRE073
     C                     MOVE 'Y'       CRE073                                              CRE073
     C                     ELSE                                                               CRE073
      *                                                                                       CRE073
      ** else, database error if return code other than *NRF.                                 CRE073
      *                                                                                       CRE073
     C           @RTCD     IFNE '*NRF   '                                                     CRE073
     C                     MOVEL'AOOULEUO'W0PGM                                               CRE073
     C                     MOVEL'SCSARDPD'W0FILE                                              CRE073
     C                     MOVEL'CRE073'  W0KEY                                               CRE073
     C                     Z-ADD913       W0ERNB                                              CRE073
     C                     EXSR SRERR                                                         CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                       CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                       CRE073
      *                                                                                       CER049
      ** Determine if CER049 enhancement is installed                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  PSARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
      ** If feature is on, set up SAR work flag                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CLE134
      ** Past Due Call Loan                                                                   CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       CLE134  1                                           CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   @RTCD   7                                           CLE134
     C                     PARM '*VERIFY' @OPTN   7                                           CLE134
     C                     PARM 'CLE134'  PSARD   6                                           CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
      ** If feature is on, set up SAR work flag                                               CLE134
      *                                                                                       CLE134
     C           @RTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,AOOULEU0C2
      *
      **  Copyright
     C                     MOVEA##CPY     ##BIS  80
      **********                                                          134761
      ***Check*if*EMU*Lending*(Settlement*Currency)*Feature*is*switcCEU004134761
      **********                                                    CEU004134761
     C**********           CALL 'AOSARDR0'             9090Rtv SAR DCEU004134761
     C**********           PARM *BLANKS   @RTCD   7        -O:ReturnCEU004134761
     C**********           PARM '*VERIFY' @OPTN   7        -I:OptionCEU004134761
     C**********           PARM 'CEU004'  @SARD   6        -I:FeaturCEU004134761
     C********** SCSARD    PARM *BLANKS   DSFDY            -O:FormatCEU004134761
      **********                                                    CEU004134761
     C********** @RTCD     IFEQ *BLANKS                    If FeaturCEU004134761
     C**********           MOVE 'Y'       CEU004  1         Set SAR CEU004134761
      **********                                                    CEU004134761
     C**********           ELSE                            Else     CEU004134761
     C**********           MOVE 'N'       CEU004            Set SAR CEU004134761
      **********                                                    CEU004134761
     C********** *IN90     IFEQ *ON                         If Err OCEU004134761
     C********** @RTCD     ORNE *BLANKS                     Or ErrorCEU004134761
     C**********           MOVEL'*CALL   'W0FILE             Set ErrCEU004134761
     C**********           MOVEL'AOSARDR0'W0KEY              Set ErrCEU004134761
     C**********           Z-ADD904       W0ERNB             Set ErrCEU004134761
     C**********           EXSR SRERR                        Proc ErCEU004134761
     C**********           ENDIF                            End If  CEU004134761
     C**********           ENDIF                           End If   CEU004134761
      **********                                                    CEU004134761
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/EJECT                                                              CEU004
     C           XCAMT     BEGSR                                          CEU004
      *===================================================================CEU004
      * XCAMT: Convert Amount.                                            CEU004
      *                                                                   CEU004
      *                                                                   CEU004
      ** Set up subroutine stack name                                     CEU004
      *                                                                   CEU004
     C                     ADD  1         Q                Add Index      CEU004
     C                     MOVEL'XCAMT '  @STK,Q    P      Set Stack Name CEU004
      *                                                                   CEU004
      ** Convert Transaction Amount into Settlement Amount.               CEU004
      *                                                                   CEU004
     C                     CALL 'EU0200'               90  Cvt Amount     CEU004
     C                     PARM *BLANKS   P@RTCD  7        -O:Return Code CEU004
     C                     PARM           P@FRAM 183       -I:From Ccy AmtCEU004
     C                     PARM           P@FRCY  3        -I:From Crency CEU004
     C                     PARM           P@TOCY  3        -I:To Currency CEU004
     C                     PARM           P@OUTA 150       -O:Outright AmtCEU004
     C                     PARM           P@INTA 183       -O:Interim Amt CEU004
     C                     PARM           P@EXRT 159       -O:Exchange RatCEU004
     C                     PARM           P@MDIN  1        -O:Mult/Div IndCEU004
      *                                                                   CEU004
     C           *IN90     IFEQ *ON                        If Err On Call CEU004
     C           P@RTCD    ORNE *BLANKS                    Or Err In Pgm  CEU004
     C                     MOVEL'*CALL   'W0FILE            Set File FieldCEU004
     C                     MOVEL'AOSARDR0'W0KEY             Set Key Field CEU004
     C                     Z-ADD905       W0ERNB            Set Error No  CEU004
     C                     EXSR SRERR                       Proc Error    CEU004
     C                     ENDIF                           End If         CEU004
      *                                                                   CEU004
      ** Unwind subroutine stack name                                     CEU004
      *                                                                   CEU004
     C                     MOVEA*BLANKS   @STK,Q           Clr Stack Name CEU004
     C                     SUB  1         Q                Decr Index     CEU004
      *                                                                   CEU004
     C                     ENDSR                                          CEU004
      *****************************************************************                       201672
      * Subroutine  :  SRINTP                                         *                       201672
      * Function    :  Calculate interest                             *                       201672
      *                                                               *                       201672
      * Called by   :  SRLOAN                                         *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRINTP    BEGSR                                                              201672
      *                                                                                       201672
     C           NRPD      IFNE 0                                                             201672
     C           AUTO      ANDEQ'Y'                                                           201672
     C           NRPD      ANDNEOMMAT                                                         205504
      *                                                                                       CLE134
     C           NRPD      ORNE 0                                                             CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           NRPD      ANDNEOMMAT                                                         CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     Z-ADDNRPD      WNRPD                                               201672
     C                     ELSE                                                               201672
     C                     Z-ADD99999     WNRPD                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           NIDT      IFNE 0                                                             201672
     C           AUTO      ANDEQ'Y'                                                           201672
     C           NIDT      ANDNEOMMAT                                                         205504
      *                                                                                       CLE134
     C           NIDT      ORNE 0                                                             CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           NIDT      ANDNEOMMAT                                                         CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C           NIDT      ORNE 0                                                            221505R
     C           AUTO      ANDEQ'Y'                                                          221505R
     C           NIDT      ANDEQOMMAT                                                        221505R
     C           RLDT      ANDEQOMMAT                                                        221505R
      *                                                                                       CLE134
     C           NIDT      ORNE 0                                                             CLE134
     C           AUTO      ANDEQ'C'                                                           CLE134
     C           NIDT      ANDEQOMMAT                                                         CLE134
     C           RLDT      ANDEQOMMAT                                                         CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     Z-ADDNIDT      WNIDT   50                                          201672
     C           ORLDT     IFNE 0                                                            221505R
     C                     Z-ADDORLDT     WNIDT                                              221505R
     C                     ENDIF                                                             221505R
     C                     ELSE                                                               201672
     C                     Z-ADD99999     WNIDT                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     MOVE VDAT      WLICD                                               201672
     C           OVDAT     IFNE 0                                                            221505R
     C                     MOVE OVDAT     WLICD                                              221505R
     C                     ENDIF                                                             221505R
     C                     MOVE ICBS      WICBS                                               201672
     C           KEYH      KLIST                                                              201672
     C                     KFLD           BRCA                                                201672
     C                     KFLD           CNUM                                                201672
     C                     KFLD           LNRF                                                201672
      *                                                                                       201672
     C                     Z-ADD0         WLASD   50                                          201672
     C                     Z-ADD0         WSVBL  130                                          201672
     C                     Z-ADD0         WCURT  117                                          201672
     C                     Z-ADD0         WCUPR  130                                          201672
     C                     Z-ADD0         WINCA  130                                          201672
     C                     Z-ADD0         WINPD  130                                          201672
     C**********           Z-ADD0         WCALC                                       201672 221505R
     C**********           Z-ADD0         ZINTRS                                      201672 221505R
     C                     Z-ADD0         IPDUE  130                                          225849
     C                     MOVE ' '       WAIAJ   1                                         MD024998
     C                     MOVEL'N'       ROLLED  1                                         MD047554
      *                                                                                     MD024998
     C           RUND      IFEQ OMMAT                                                       MD024998
     C           NRPD      ANDEQ0                                                           MD024998
     C           NIDT      ANDEQ0                                                           MD024998
     C           LNRF      CHAINLEADINL1             75                                     MD024998
     C           *IN75     IFEQ '0'                                                         MD024998
     C                     Z-ADDCPAM      WCUPR                                             MD024998
     C                     Z-ADDINTR      WCURT                                             MD024998
     C                     Z-ADDBRTE      WCUBR                                             MD024998
     C                     Z-ADDRTSP      WCUSP                                             MD024998
     C                     Z-ADDIACD      WLICD                                             MD024998
     C                     MOVE 'Y'       WAIAJ                                             MD024998
     C                     GOTO PARES                                                       MD024998
     C                     ENDIF                                                            MD024998
     C                     ENDIF                                                            MD024998
      *                                                                                       201672
     C********** KEYH      SETLLHISTR                                                  201672 238838
     C********** KEYH      READEHISTR                    37                            201672 238838
     C           KEYH      SETLLHISTO                                                         238838
     C           KEYH      READEHISTO                    37                                   238838
     C           *IN37     IFEQ '1'                                                           201672
     C                     Z-ADD99999     VDATH                                               201672
     C                     Z-ADDCPAM      WCUPR                                               201672
     C                     Z-ADDINTR      WCURT                                               201672
     C                     Z-ADDBRTE      WCUBR  117                                          201672
     C                     Z-ADDRTSP      WCUSP  117                                          201672
     C                     Z-ADDIACD      WLICD   50                                          201672
     C           OVDAT     IFNE 0                                                            221505R
     C           OVDAT     ANDGTIACD                                                         221505R
     C                     MOVE OVDAT     WLICD                                              221505R
     C                     ENDIF                                                             221505R
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           LNRF      SETLLLOAMSOM1                                                      201672
     C           *IN34     DOUEQ'1'                                                           201672
     C           RECIL     OREQ 'D'                                                           201672
     C           VDATL     ANDLEOMMAT                                                         201672
     C           VDATL     ANDGTOVDAT                                                         218984
     C           RECIL     OREQ 'D'                                                         AR317587
     C           VDATL     ANDGTOMMAT                                                       AR317587
     C           AMTPL     ANDEQ'MR'                                                        AR317587
     C           LNRF      READELOAMSOM1                 34                                   201672
     C                     ENDDO                                                              201672
     C           *IN34     IFEQ '1'                                                           201672
     C                     Z-ADD99999     VDATL                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           *IN34     IFEQ '1'                                                           201672
     C           *IN37     ANDEQ'1'                                                           201672
     C                     GOTO PARES                                                         201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           *IN34     DOUEQ'1'                                                           201672
     C           *IN37     ANDEQ'1'                                                           201672
      *                                                                                       201672
     C                     SELEC                                                              201672
     C           VDATH     WHLE VDATL                                                         201672
     C                     EXSR SRHIST                                                        201672
     C           VDATL     WHLE VDATH                                                         201672
     C                     EXSR SRLOAM                                                        201672
     C                     ENDSL                                                              201672
     C                     ENDDO                                                              201672
      *                                                                                       201672
     C           PARES     TAG                                                                201672
      *                                                                                     MD047554
      ** For newly inserted loan with rollover details amendment                            MD047554
      ** or for loan with historic records and loan amendments                              MD047554
      ** earlier than rollover date.                                                        MD047554
      *                                                                                     MD047554
     C           RLDT      IFGT 0                                                           MD047554
     C           CLE031    ANDNE'Y'                                                         MD047554
     C           NCCY      ANDEQ*BLANKS                                                     MD047554
     C           ROLLED    ANDEQ'N'                                                         MD047554
     C                     EXSR SRROLL                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                      221505R
      ** For call loans, need to make sure have processed the next                           221505R
      ** interest payment date, so that the interest amount has been                         221505R
      ** calculated up to this point.                                                        221505R
      *                                                                                      221505R
     C           OMMAT     IFEQ 0                                                            221505R
     C           WNIDT     ANDLENIDT                                                         221505R
     C                     Z-ADDNIDT      OMEND   50                                         221505R
     C                     EXSR SRRPAY                                                       221505R
     C                     ENDIF                                                             221505R
      *                                                                                       201672
     C           OMMAT     IFNE 0                                                             201672
     C           RECI      ANDNE'M'                                                           201672
      *                                                                                       201672
     C                     Z-ADDOMMAT     OMEND   50                                          201672
     C                     EXSR SRRPAY                                                        201672
      *                                                                                       201672
     C                     Z-ADDOMMAT     ZIEND                                               201672
     C                     EXSR SRINCL                                                        201672
     C                     ADD  ZINTR     WCALC                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     ENDSR                                                              201672
      *****************************************************************                       201672
      * Subroutine  :  SRHIST                                         *                       201672
      * Function    :  Calculate interest (history events)            *                       201672
      *                                                               *                       201672
      * Called by   :  SRINTP                                         *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRHIST    BEGSR                                                              201672
      *                                                                                       201672
      ** PROCESS ROLLOVER DATE                                                              MD047554
      *                                                                                     MD047554
     C           RLDT      IFGT 0                                                           MD047554
     C           RLDT      ANDLEVDATH                                                       MD047554
     C           NCCY      ANDEQ*BLANKS                                                     MD047554
     C                     EXSR SRROLL                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     Z-ADDVDATH     OMEND                                               201672
     C                     EXSR SRRPAY                                                        201672
      *                                                                                     MD028338
     C                     MOVE 'N'       WFXCHG  1                                         MD028338
     C           AMTPH     IFEQ 'RO'                                                        MD028338
     C           FRCOH     ANDEQ'Y'                                                         MD028338
     C                     MOVE 'Y'       WFXCHG                                            MD028338
     C                     ENDIF                                                            MD028338
      *                                                                                       201672
      ** Retain calculation basis                                                             201672
      *                                                                                       201672
     C           AMTPH     IFEQ 'ST'                                                          201672
     C           AMTPH     OREQ 'RO'                                                          201672
     C           AMTPH     OREQ 'MC'                                                          201672
     C                     MOVE CALCH     WICBS   10                                          201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           WLICD     IFNE VDATH                                                         201672
     C           VDATH     ANDNE*ZEROS                                                        201672
     C           WLICD     ANDNE*ZEROS                                                        201672
     C           AMTPH     ANDNE'ST'                                                          201672
     C           AMTPH     ANDNE'MI'                                                        MD028338
     C           AMTPH     ANDNE'LS'                                                        MD028338
     C           WFXCHG    ANDNE'Y'                                                         MD028338
     C                     Z-ADDVDATH     ZIEND                                               201672
     C                     EXSR SRINCL                                                        201672
     C                     Z-ADDVDATH     ZIBEG                                               201672
     C                     ADD  ZINTR     WCALC  152                                          201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
      ** Retain current principal, rate and interest paid                                     201672
      *                                                                                       201672
     C                     SELEC                                                              201672
     C           AMTPH     WHEQ 'ST'                                                          201672
     C           AMTPH     OREQ 'MC'                                                          201672
     C           AMTPH     IFEQ 'ST'                                                          201672
     C                     Z-ADDPRAMH     WCUPR                                               201672
     C                     MOVELSPINH     SPINP   1                                         AR317587
     C                     ELSE                                                               201672
     C                     Z-ADDCPAMH     WCUPR                                               201672
     C                     ENDIF                                                              201672
     C                     Z-ADDBRTEH     WCUBR                                               201672
     C                     Z-ADDRTSPH     WCUSP                                               201672
     C                     Z-ADDINTRH     WCURT                                               201672
     C                     Z-ADDVDATH     WLICD                                               201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'IN'                                                          201672
     C                     ADD  INTAH     WINPD                                               201672
      *                                                                                     MD047554
      ** Include withholding tax in interest paid like IPRD.                                MD047554
      *                                                                                     MD047554
     C           WTXAH     IFNE 0                                                           MD047554
     C           WTIN      ANDEQ'G'                                                         MD047554
     C                     ADD  WTXAH     WINPD                                             MD047554
     C                     ENDIF                                                            MD047554
     C           INTC      IFEQ 'Y'                                                           201672
     C                     ADD  INTAH     WCUPR                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'RO'                                                          201672
     C           PRINRO    IFNE 0                                                             201672
     C                     Z-ADDPRINRO    WCUPR                                               201672
     C                     ENDIF                                                              201672
     C                     Z-ADDBRTEH     WCUBR                                               201672
     C                     Z-ADDRTSPH     WCUSP                                               201672
     C                     Z-ADDINTRH     WCURT                                               201672
     C           WFXCHG    IFNE 'Y'                                                         MD028338
     C                     Z-ADDVDATH     WLICD                                               201672
     C                     ENDIF                                                            MD028338
      *                                                                                     AR317587
     C           SPINH     IFNE *BLANKS                                                     AR317587
     C                     MOVELSPINH     SPINP                                             AR317587
     C                     ENDIF                                                            AR317587
      *                                                                                       201672
     C           AMTPH     WHEQ 'PT'                                                          201672
     C           AMTPH     OREQ 'PI'                                                          201672
     C                     ADD  PRAMH     WCUPR                                               201672
     C                     Z-ADDVDATH     WLICD                                            MD024998A
      *                                                                                       201672
     C           AMTPH     WHEQ 'PF'                                                          201672
     C                     SUB  PRAMH     WCUPR                                               201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'MR'                                                          201672
     C           AMTPH     OREQ 'RE'                                                          201672
     C           AMTPH     OREQ 'MA'                                                          201672
     C           VDATH     IFEQ NIDT                                                          201672
     C                     SUB  INTAH     ZFIRST                                              201672
     C                     ELSE                                                               201672
     C                     ADD  INTAH     WINPD                                               201672
     C                     ENDIF                                                              201672
     C                     SUB  PRAMH     WCUPR                                               201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'BR'                                                          201672
     C           AMTPH     OREQ 'BC'                                                          201672
     C                     Z-ADDBRTEH     WCUBR                                               201672
     C                     EXSR SRNSPR                                                        CRE073
     C                     EXSR SRNEWI                                                        201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'SC'                                                          201672
     C                     Z-ADDRTSPH     WCUSP                                               201672
     C                     EXSR SRNEWI                                                        201672
      *                                                                                       201672
     C           AMTPH     WHEQ 'MI'                                                          201672
     C                     ADD  INTAH     WINCA                                               201672
     C                     ADD  INTAH     WCALC                                               201672
      *                                                                                     AR792284
     C           VDATH     IFLE NRPD                                                        AR792284
     C                     ADD  INTAH     PWCALC                                            AR792284
     C                     ENDIF                                                            AR792284
      *                                                                                       201672
     C           AMTPH     WHEQ 'SA'                                                          201672
     C           STAIH     IFEQ *BLANK                                                        201672
     C                     Z-ADDVDATH     WLICD                                               201672
     C                     ENDIF                                                              201672
     C                     ENDSL                                                              201672
      *                                                                                       201672
     C           *IN37     IFEQ '0'                                                           201672
     C********** KEYH      READEHISTR                    37                            201672 238838
     C           KEYH      READEHISTO                    37                                   238838
     C           *IN37     IFEQ '1'                                                           201672
     C                     Z-ADD99999     VDATH                                               201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
     C                     ENDSR                                                              201672
      *****************************************************************                       201672
      * Subroutine  :  SRLOAM                                         *                       201672
      * Function    :  Calculate interest (future valued events)      *                       201672
      *                                                               *                       201672
      * Called by   :  SRINTP                                         *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRLOAM    BEGSR                                                              201672
      *                                                                                       201672
     C           RLDT      IFGT 0                                                           MD047554
     C           RLDT      ANDLEVDATL                                                       MD047554
     C           NCCY      ANDEQ*BLANKS                                                     MD047554
     C                     EXSR SRROLL                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     Z-ADDVDATL     OMEND                                               201672
     C                     EXSR SRRPAY                                                        201672
      *                                                                                       201672
     C           WLICD     IFNE VDATL                                                         201672
     C           VDATL     ANDNE*ZEROS                                                        201672
     C           VDATL     ANDLEOMMAT                                                       AR317587
     C                     Z-ADDVDATL     ZIEND                                               201672
     C                     EXSR SRINCL                                                        201672
     C                     Z-ADDVDATL     ZIBEG                                               201672
     C                     ADD  ZINTR     WCALC                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
      ** Maintain current principal, rate and interest paid                                   201672
      *                                                                                       201672
     C                     SELEC                                                              201672
     C           AMTPL     WHEQ 'PT'                                                          201672
     C           AMTPL     OREQ 'PI'                                                          201672
     C                     ADD  PRAML     WCUPR                                               201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'PF'                                                          201672
     C                     SUB  PRAML     WCUPR                                               201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'RE'                                                          201672
     C           REPTL     ANDEQ2                                                             201672
     C                     Z-ADDPRAML     WPRAML                                              201672
     C           CCY       IFNE FCCY                                                          201672
     C           CCYL      ANDEQFCCY                                                          201672
     C           FMDI      IFEQ 'M'                                                           201672
     C           PRAML     DIV  FCXR      WPRAML 130                                          201672
     C                     ELSE                                                               201672
     C           PRAML     MULT FCXR      WPRAML                                              201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     SUB  WPRAML    WCUPR                                               201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'MR'                                                          201672
     C           VDATL     IFEQ NIDT                                                          201672
     C                     SUB  INTAL     ZFIRST                                              201672
     C                     ELSE                                                               201672
     C                     ADD  INTAL     WINPD                                               201672
     C                     ENDIF                                                              201672
      *                                                                                     AR317587
     C           VDATL     IFLE OMMAT                                                       AR317587
     C                     SUB  PRAML     WCUPR                                               201672
     C                     ENDIF                                                            AR317587
      *                                                                                       201672
      ** For repayment types 1 and 3, compute for the separate                                201672
      ** principal and interest repayments from the repayment made                            201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'RE'                                                          201672
      *                                                                                       201672
     C                     Z-ADDTAMTL     WTAMTL                                              201672
     C                     Z-ADDPRAML     WPRAML                                              201672
     C           CCY       IFNE FCCY                                                          201672
     C           CCYL      ANDEQFCCY                                                          201672
     C           FMDI      IFEQ 'M'                                                           201672
     C           TAMTL     DIV  FCXR      WTAMTL 130H                                         201672
     C           PRAML     DIV  FCXR      WPRAML                                              201672
     C                     ELSE                                                               201672
     C           TAMTL     MULT FCXR      WTAMTL                                              201672
     C           PRAML     MULT FCXR      WPRAML                                              201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           REPTL     IFEQ 3                                                             201672
     C           ZINTR     IFLE WTAMTL                                                        201672
     C           WTAMTL    SUB  ZINTR     WPRAM  130H                                         201672
     C                     Z-ADDZINTR     WINTA  130                                          201672
     C                     ELSE                                                               201672
     C                     Z-ADD*ZEROS    WPRAM                                               201672
     C                     Z-ADDWTAMTL    WINTA                                               201672
     C                     ENDIF                                                              201672
     C                     ELSE                                                               201672
     C                     Z-ADDWPRAML    WPRAM                                               201672
     C                     Z-ADDZINTR     WINTA                                               201672
     C                     ENDIF                                                              201672
     C                     SUB  WPRAM     WCUPR                                               201672
     C           VDATL     IFEQ NIDT                                                          201672
     C                     SUB  WINTA     ZFIRST                                              201672
     C                     ELSE                                                               201672
     C                     ADD  WINTA     WINPD                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
      ** Check if the Base rate Code change is back valued                                 MD035919A
      *                                                                                    MD035919A
     C           VDATL     IFLE RUND                                                       MD035919A
     C                     MOVE 'Y'       BCKVL   1                                        MD035919A
     C                     ELSE                                                            MD035919A
     C                     MOVE 'N'       BCKVL                                            MD035919A
     C                     ENDIF                                                           MD035919A
      *                                                                                    MD035919A
     C           AMTPL     WHEQ 'BC'                                                          201672
     C           BCKVL     ANDEQ'N'                                                        MD035919A
     C                     Z-ADDBRTEL     WCUBR                                               201672
     C                     EXSR SRNSPR                                                        CRE073
     C                     EXSR SRNEWI                                                        201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'SC'                                                          201672
     C                     Z-ADDRTSPL     WCUSP                                               201672
     C                     EXSR SRNEWI                                                        201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'SA'                                                          201672
     C           STAIH     IFEQ *BLANK                                                        201672
     C                     Z-ADDVDATL     WLICD                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           AMTPL     WHEQ 'PD'                                                          201672
     C********** INTAL     IFNE *ZEROS                                                 201672 238838
     C**********           ADD  INTAL     WINPD                                        201672 238838
     C                     ADD  INTAL     IPDUE                                               225849
     C**********           ENDIF                                                       201672 238838
      *                                                                                       201672
      ** Add past due amount to running balance.                                              201672
     C           RATF      IFEQ 'Y'                                                           201672
     C                     ADD  PRAML     WCUPR                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     ENDSL                                                              201672
      *                                                                                       201672
     C           *IN34     IFEQ '0'                                                           201672
     C           *IN34     DOUEQ'1'                                                           201672
     C           RECIL     OREQ 'D'                                                           201672
     C           VDATL     ANDLEOMMAT                                                         201672
     C           RECIL     OREQ 'D'                                                         AR317587
     C           VDATL     ANDGTOMMAT                                                       AR317587
     C           AMTPL     ANDEQ'MR'                                                        AR317587
     C           LNRF      READELOAMSOM1                 34                                   201672
     C                     ENDDO                                                              201672
     C           *IN34     IFEQ '1'                                                           201672
     C                     Z-ADD99999     VDATL                                               201672
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
     C                     ENDSR                                                              201672
      *****************************************************************                       201672
      * Subroutine  :  SRINCL                                         *                       201672
      * Function    :  Calculate interest between event dates.        *                       201672
      *                                                               *                       201672
      * Called by   :  SRINTP                                         *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRINCL    BEGSR                                                              201672
     C           WCUPR     IFLE *ZEROS                                                        201672
     C                     Z-ADD*ZEROS    ZINTR                                               201672
     C                     ELSE                                                               201672
     C                     Z-ADDWLICD     ZIBEG                                               201672
     C                     MOVE WICBS     ZICALC                                              201672
     C                     Z-ADDWCUPR     ZIAMT                                               201672
     C                     Z-ADDWCURT     ZIRATE                                              201672
     C                     EXSR GLINTC                                                        201672
      *                                                                                       201672
      ** Round down interest if required                                                      201672
      *                                                                                       201672
     C           RDFC      IFEQ 'Y'                                                           201672
     C                     Z-ADDZINTR     RDWORK 130                                          201672
     C                     Z-ADDRDWORK    ZINTR                                               201672
     C                     ELSE                                                               201672
     C                     Z-ADDZINTR     RUWORK 130H                                         201672
     C                     Z-ADDRUWORK    ZINTR                                               201672
     C                     ENDIF                                                              201672
     C**********           Z-ADDZIEND     WLICD                                     201672 AR1001269
     C                     ENDIF                                                              201672
     C                     Z-ADDZIEND     WLICD                                            AR1001269
      *                                                                                     AR792284
     C           ZIEND     IFLE NRPD                                                        AR792284
     C           PWCALC    ADD  ZINTR     PWCALC 130                                        AR792284
     C                     ENDIF                                                            AR792284
      *                                                                                     AR792284
     C                     ENDSR                                                              201672
      *****************************************************************                       201672
      * Subroutine  :  SRNEWI                                         *                       201672
      * Function    :  Process changes in rates.                      *                       201672
      *                                                               *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRNEWI    BEGSR                                                              201672
      *                                                                                       201672
      ** Reflect spread to effective interest                                                 201672
      *                                                                                       201672
     C           SPINH     IFEQ *BLANKS                                                     AR317587
     C                     MOVELSPINP     SPINH                                             AR317587
     C                     ELSE                                                             AR317587
     C                     MOVELSPINH     SPINP                                             AR317587
     C                     ENDIF                                                            AR317587
      *                                                                                     AR317587
     C                     SELEC                                                              201672
     C********** SPIN      WHEQ 'A'                                                  201672 AR317587
     C           SPINH     WHEQ 'A'                                                         AR317587
     C           WCUBR     ADD  WCUSP     WCURT                                               201672
     C********** SPIN      WHEQ 'S'                                                  201672 AR317587
     C           SPINH     WHEQ 'S'                                                         AR317587
     C           WCUBR     SUB  WCUSP     WCURT                                               201672
     C********** SPIN      WHEQ 'P'                                                  201672 AR317587
     C           SPINH     WHEQ 'P'                                                         AR317587
     C           WCUSP     DIV  100       WWORK  119                                          201672
     C           WCUBR     MULT WWORK     WCURT                                               201672
     C                     ENDSL                                                              201672
      *                                                                                       201672
     C                     ENDSR                                                              201672
      *                                                                                       201672
      *****************************************************************                       201672
      * Subroutine  :  SRNEWI                                         *                       201672
      * Function    :  Process repayment and interest payment         *                       201672
      *                frequency.                                     *                       201672
      *                                                               *                       201672
      *****************************************************************                       201672
      *                                                                                       201672
     C           SRRPAY    BEGSR                                                              201672
      *                                                                                       201672
     C                     Z-ADD0         FWNIDT                                            MD037299
      *                                                                                     MD037299
     C           WNRPD     DOWLEOMEND                                                         201672
     C           WNRPD     ANDGENRPD                                                        AR830785
     C           OMMAT     ANDNEWNRPD                                                         205504
     C           WNIDT     ORLE OMEND                                                         201672
     C           WNIDT     ANDGENIDT                                                        AR830785
     C           OMMAT     ANDNEWNIDT                                                         205504
     C           WNIDT     ORLE OMEND                                                        221505R
     C           WNIDT     ANDGENIDT                                                        AR830785
     C           WNIDT     ANDEQRLDT                                                         221505R
      *                                                                                       201672
      **  Process Repayment frequency.                                                        201672
      *                                                                                       201672
     C           WNRPD     DOWLEOMEND                                                         201672
     C           WNRPD     ANDGENRPD                                                        AR830785
     C           WNRPD     ANDLTWNIDT                                                         201672
      *                                                                                     MD037299
     C           WNRPD     ORLE OMEND                                                       MD037299
     C           WNRPD     ANDGENRPD                                                        MD037299
     C           WNRPD     ANDLEFWNIDT                                                      MD037299
      *                                                                                       201672
     C           WLICD     IFNE WNRPD                                                         201672
     C           WNRPD     ANDNE0                                                             201672
     C                     Z-ADDWNRPD     ZIEND                                               201672
     C                     EXSR SRINCL                                                        201672
     C                     Z-ADDWNRPD     ZIBEG                                               201672
     C                     ADD  ZINTR     WCALC                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           WCUPR     SUB  RAMT      WCUPR                                               201672
     C           RFRQ      IFNE *BLANKS                                                       201672
     C                     MOVELRFRQ      ZFREQ                                               201672
     C                     Z-ADDWNRPD     ZDAYNO                                              201672
     C                     MOVELCCY       ZCCY                                                201672
     C                     EXSR ZFRQB3                                                        201672
     C                     Z-ADD*ZEROS    ZNRDYS                                              238838
     C                     SELEC                                                              238838
     C           PDDI      WHEQ 'P'                                                           238838
     C                     EXSR ZBKDT                                                         238838
     C           PDDI      WHEQ 'N'                                                           238838
     C           PDDI      OREQ *BLANK                                                        238838
     C                     EXSR ZFWDT                                                         238838
     C           PDDI      WHEQ 'A'                                                           238838
     C                     Z-ADDZDAYNO    ZDYNBR                                              238838
     C           PDDI      WHEQ 'M'                                                           238838
     C                     Z-ADDZDAYNO    @DAYNO  50                                          238838
     C                     EXSR ZFWDT                                                         238838
     C                     Z-ADDZDYNBR    ZDAYNO                                              238838
     C                     ENDSL                                                              238838
     C                     Z-ADDZDAYNO    WNRPD                                               201672
     C                     ELSE                                                               201672
     C                     Z-ADD99999     WNRPD                                               201672
     C                     ENDIF                                                              201672
     C                     ENDDO                                                              201672
      *                                                                                       201672
      **  Next Interest Payment Date.                                                         201672
      *                                                                                       201672
     C           WNIDT     DOWLEOMEND                                                         201672
     C           WNIDT     ANDGENIDT                                                        AR830785
     C           WNIDT     ANDLEWNRPD                                                         201672
      *                                                                                     MD037299
     C           WNIDT     ORLE OMEND                                                       MD037299
     C           WNIDT     ANDGENIDT                                                        MD037299
     C           WNIDT     ANDGTWNRPD                                                       MD037299
     C           WNRPD     ANDLTNRPD                                                        MD037299
      *                                                                                       201672
     C           WLICD     IFNE WNIDT                                                         201672
     C********** WNRPD     ANDNE0                                                     201672 221505R
     C           WNIDT     ANDNE0                                                            221505R
     C                     Z-ADDWNIDT     ZIEND                                               201672
     C                     EXSR SRINCL                                                        201672
     C                     Z-ADDWNIDT     ZIBEG                                               201672
     C                     ADD  ZINTR     WCALC                                               201672
     C                     Z-ADDWCALC     ZINTRS 152                                          201672
     C                     SUB  WINPD     ZINTRS                                              205504
     C           WNIDT     IFEQ NIDT                                                          201672
     C                     Z-ADDWCALC     ZFIRST 152                                          201672
     C                     SUB  WINPD     ZFIRST                                              205504
     C                     ENDIF                                                              201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C           IPFR      IFNE *BLANKS                                                       201672
     C                     MOVELIPFR      ZFREQ                                               201672
     C                     Z-ADDWNIDT     ZDAYNO                                              201672
     C                     MOVELCCY       ZCCY                                                201672
     C                     EXSR ZFRQB3                                                        201672
     C                     Z-ADD*ZEROS    ZNRDYS                                              238838
     C                     SELEC                                                              238838
     C           PDDI      WHEQ 'P'                                                           238838
     C                     EXSR ZBKDT                                                         238838
     C           PDDI      WHEQ 'N'                                                           238838
     C           PDDI      OREQ *BLANK                                                        238838
     C                     EXSR ZFWDT                                                         238838
     C           PDDI      WHEQ 'A'                                                           238838
     C                     Z-ADDZDAYNO    ZDYNBR                                              238838
     C           PDDI      WHEQ 'M'                                                           238838
     C                     Z-ADDZDAYNO    @DAYNO  50                                          238838
     C                     EXSR ZFWDT                                                         238838
     C                     Z-ADDZDYNBR    ZDAYNO                                              238838
     C                     ENDSL                                                              238838
     C                     Z-ADDZDAYNO    WNIDT                                               201672
      *                                                                                     MD037299
      ** Save final valid value of WNIDT, use it to exit WNRPD loop                         MD037299
      *                                                                                     MD037299
     C           WNIDT     IFLE OMEND                                                       MD037299
     C           WNIDT     ANDGENIDT                                                        MD037299
     C                     Z-ADDWNIDT     FWNIDT  50                                        MD037299
     C                     ENDIF                                                            MD037299
      *                                                                                     MD037299
     C                     ELSE                                                               201672
     C                     Z-ADD99999     WNIDT                                               201672
     C                     ENDIF                                                              201672
      *                                                                                       201672
     C                     ENDDO                                                              201672
     C                     ENDDO                                                              201672
     C                     ENDSR                                                              201672
      *****************************************************************                     MD047554
      * Subroutine  :  SRROLL - Rollover date processing for interest *                     MD047554
      *                         calculation.                          *                     MD047554
      *****************************************************************                     MD047554
     C           SRROLL    BEGSR                                                            MD047554
      *                                                                                     MD047554
     C                     Z-ADDRLDT      OMEND                                             MD047554
     C                     EXSR SRRPAY                                                      MD047554
      *                                                                                     MD047554
     C           WLICD     IFNE RLDT                                                        MD047554
     C                     Z-ADDRLDT      ZIEND                                             MD047554
     C                     EXSR SRINCL                                                      MD047554
     C                     Z-ADDRLDT      ZIBEG                                             MD047554
     C                     ADD  ZINTR     WCALC                                             MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C           NRTS      IFGT 0                                                           MD047554
     C********** NBRA      ORGT 0                                                    MD047554 CSD103
     C           NBRA      ORNE *BLANKS                                                       CSD103
     C                     Z-ADDNRTS      WCUSP                                             MD047554
     C**********           Z-ADDNBRA      WCUBR                                      MD047554 CSD103
      *                                                                                       CLE172
     C           NBRA      IFNE *BLANKS                                                     MD058984
     C                     MOVELCCY       PKEY1                                               CLE172
     C                     MOVELNBRA      PKEY2                                               CLE172
      *                                                                                       CLE172
     C                     CALL 'AOBSRTR0'                                                    CLE172
     C                     PARM *BLANKS   @RTCD                                               CLE172
     C                     PARM '*KEY   ' @OPTN                                               CLE172
     C                     PARM           PKEY1   3                                           CLE172
     C                     PARM           PKEY2   2                                           CLE172
     C           SDBSRT    PARM SDBSRT    DSSDY                                               CLE172
      *                                                                                       CLE172
      ** Handle Database Error.                                                               CLE172
      *                                                                                       CLE172
     C           @RTCD     IFNE *BLANKS                                                       CLE172
     C                     MOVEL'SDBSRTR0'W0PGM   8                                           CLE172
     C                     MOVEL'SDBSRTPD'W0FILE                                              CLE172
     C                     MOVELPKEY2     W0KEY                                               CLE172
     C                     Z-ADD917       W0ERNB                                              CLE172
     C                     EXSR SRERR                                                         CLE172
     C                     ENDIF                                                              CLE172
      *                                                                                       CLE172
     C           RLDT      IFGE BAVDNR                                                        CLE172
     C                     Z-ADDBANBRT    WCUBR                                               CLE172
     C                     ELSE                                                               CLE172
     C                     Z-ADDBACBSR    WCUBR                                               CLE172
     C                     ENDIF                                                              CLE172
     C                     ENDIF                                                            MD058984
     C                     MOVELNSIN      SPIN                                              MD047554
     C                     EXSR SRNEWI                                                      MD047554
     C                     ENDIF                                                            MD047554
      *                                                                                     MD047554
     C                     MOVEL'Y'       ROLLED                                            MD047554
      *                                                                                     MD047554
     C                     ENDSR                                                            MD047554
      *****************************************************************                       201672
      ** Subroutine  :  SRCURR                                        *                       CLE031
      ** Function    :  Check currency details                        *                       CLE031
      ** Calls       :  AOCURRR0                                      *                       CLE031
      **                                                              *                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           SRCURR    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOCURRR0'                                                    CLE031
     C                     PARM *BLANKS   @RTCD                                               CLE031
     C                     PARM '*KEY    '@OPTN                                               CLE031
     C                     PARM WCCY      @CURR   3                                           CLE031
     C           SDCURR    PARM SDCURR    DSSDY                                               CLE031
      *                                                                                       CLE031
      ** Handle Database Error.                                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFNE *BLANKS                                                       CLE031
     C                     MOVEL'AOCURRR0'W0PGM   8                                           CLE031
     C                     MOVEL'SDCURRPD'W0FILE                                              CLE031
     C                     MOVEL'WCCY   ' W0KEY                                               CLE031
     C                     Z-ADD907       W0ERNB                                              CLE031
     C                     EXSR SRERR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34A                                         *                       CLE034
      ** Function    :  Initial set up for CLE034 processing          *                       CLE034
      ** Calls       :  AOSTALR2 AOBSTLR0                             *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                                                              CLE034
     C                     Z-ADD##AMT     SVAMT  150                                          CLE034
     C                     MOVE LOANCL    SVLOAN                                              CLE034
     C                     Z-ADD0         WTOTAM 150                                          CLE034
     C                     Z-ADD0         WAMT   150                                          CLE034
     C                     MOVE *BLANKS   WRKFLD  1                                           CLE034
     C                     MOVE ##RECM    SVRECM  2                                           CLE034
     C                     MOVE ##RECA    SVRECA 12                                           CLE034
     C                     MOVE ##RECB    SVRECB  3                                           CLE034
     C                     MOVE ##PAYM    SVPAYM  2                                           CLE034
     C                     MOVE ##PAYA    SVPAYA 12                                           CLE034
     C                     MOVE ##PAYB    SVPAYB  3                                           CLE034
     C                     MOVE ##CCY     SVCCY   3                                           CLE034
     C                     MOVE SVSCCY    S#SCCY  3                                           CLE034
     C                     MOVE SVPSCY    S#PSCY  3                                           CLE034
     C**********           MOVE PEXR      SVPEXR 138                                 CLE034 AR943686
     C**********           MOVE REXR      SVREXR 138                                 CLE034 AR943686
     C**********           MOVE PEXI      SVPEXI  1                                  CLE034 AR943686
     C**********           MOVE REXI      SVREXI  1                                  CLE034 AR943686
     C                     Z-ADDSVREXR    W#REXR 138                                        AR943686
     C                     Z-ADDSVPEXR    W#PEXR 138                                        AR943686
     C                     MOVE SVREXI    W#REXI  1                                         AR943686
     C                     MOVE SVPEXI    W#PEXI  1                                         AR943686
     C                     MOVE LNRF      WLNRF                                               CLE034
      *                                                                                       CLE034
      ** If reversing existing allocations, call AOBSTLR0 to                                  219608
      ** access the 'before' image from LEBSTLPD:                                             219608
     C           ##REVI    IFEQ 'YES'                                                         219608
     C                     CALL 'AOBSTLR0'                                                    219608
     C                     PARM *BLANKS   WRTCD   7                                           219608
     C                     PARM '*FIRST ' WOPTN   7                                           219608
     C***********          PARM 'LOAN'    WTYPE   4                                    219608 220754
     C                     PARM           WTYPE   4                                           220754
     C                     PARM           WLNRF   6                                           219608
     C                     PARM *BLANKS   WVDAT   5                                           219608
     C                     PARM *BLANKS   WLSEQ   3                                           219608
     C                     PARM *BLANKS   WCFEE   6                                           219608
     C                     PARM *BLANKS   WFFEE   5                                           219608
     C                     PARM *BLANKS   WFSEQ   2                                           219608
     C                     PARM WPAYRC    WPAYR   1                                           219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
     C                     MOVEL*BLANKS   BEFORE  1                                           219608
      *                                                                                       219608
     C           WRTCD     IFNE *BLANK                                                        219608
      ** If could not find any, use the normal AOSTALR2 to                                    219608
      ** access the existing image                                                            219608
     C                     MOVEL'N'       BEFORE  1                                           219608
     C                     CALL 'AOSTALR2'                                                    219608
     C                     PARM *BLANKS   WRTCD                                               219608
     C                     PARM '*FIRST ' WOPTN                                               219608
     C***********          PARM 'LOAN'    WTYPE                                        219608 220754
     C                     PARM           WTYPE                                               220754
     C                     PARM           WLNRF                                               219608
     C                     PARM *BLANKS   WVDAT                                               219608
     C                     PARM *BLANKS   WLSEQ                                               219608
     C                     PARM *BLANKS   WCFEE                                               219608
     C                     PARM *BLANKS   WFFEE                                               219608
     C                     PARM *BLANKS   WFSEQ                                               219608
     C                     PARM WPAYRC    WPAYR                                               219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
     C           WRTCD     IFNE *BLANK                                                        219608
     C                     MOVEL'AOOULEU0'W0PGM                                               219608
     C                     MOVEL'LEBSTLPD'W0FILE                                              219608
     C                     MOVELWLNRF     W0KEY                                               219608
     C                     Z-ADD910       W0ERNB                                              219608
     C                     EXSR SRERR                                                         219608
     C                     ENDIF                                                              219608
     C                     ENDIF                                                              219608
      ** Else, inserting new allocations, so call AOSTALR2                                    219608
      ** to access the 'after' image of LESTALPD:                                             219608
     C                     ELSE                            ##REVI not YES                     219608
      *                                                                                       219608
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   WRTCD   7                                           CLE034
     C                     PARM '*FIRST ' WOPTN   7                                           CLE034
     C***********          PARM 'LOAN'    WTYPE   4                                    CLE034 220754
     C                     PARM           WTYPE   4                                           220754
     C                     PARM           WLNRF   6                                           CLE034
     C                     PARM *BLANKS   WVDAT   5                                           CLE034
     C                     PARM *BLANKS   WLSEQ   3                                           CLE034
     C                     PARM *BLANKS   WCFEE   6                                           CLE034
     C                     PARM *BLANKS   WFFEE   5                                           CLE034
     C                     PARM *BLANKS   WFSEQ   2                                           CLE034
     C                     PARM WPAYRC    WPAYR   1                                           CLE034
     C********** LESTAL    PARM LESTAL    DSSDY                                       CLE034 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       CLE034
     C           WRTCD     IFNE *BLANK                                                        CLE034
     C                     MOVEL'*CALL   'W0FILE                                              CLE034
     C                     MOVEL'AOSTALR2'W0KEY                                               CLE034
     C                     Z-ADD908       W0ERNB                                              CLE034
     C                     EXSR SRERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       219608
     C                     ENDIF                           End ##REVI chk                     219608
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34B                                         *                       CLE034
      ** Function    :  Processing to calculate amount for settlement *                       CLE034
      **                allocation                                    *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
      ** If Allocations are by Percentage:                                                   BUG8962
     C           WPAYRC    IFEQ 'P'                                                           CLE038
     C           LSPYBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           WPAYRC    OREQ 'R'                                                           CLE038
     C           LSRCBA    ANDNE'A'                                                           CLE038
     C           CLE038    ANDEQ'Y'                                                           CLE038
     C           CLE038    ORNE 'Y'                                                           CLE038
      *                                                                                       CLE038
     C           WPAYRC    IFEQ 'P'                                                           CLE034
     C           SVAMT     MULT LSPYPC    WRK1   150H                                         CLE034
     C           WRK1      DIV  100       WAMT      H                                         CLE034
     C                     ELSE                                                               CLE034
     C           SVAMT     MULT LSRCPC    WRK1      H                                         CLE034
     C           WRK1      DIV  100       WAMT      H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE038
     C***********          ELSE                                                       CLE038 BUG8962
      ***********                                                                     CLE038 BUG8962
     C***********WPAYRC    IFEQ 'P'                                                   CLE038 BUG8962
     C***********          Z-ADDLSPYAM    WAMT                                        CLE038 BUG8962
     C***********          ELSE                                                       CLE038 BUG8962
     C***********          Z-ADDLSRCAM    WAMT                                        CLE038 BUG8962
     C***********          ENDIF                                                      CLE038 BUG8962
      ***********                                                                     CLE038 BUG8962
     C***********          ENDIF                                                      CLE038 BUG8962
      *                                                                                       CLE034
     C                     ADD  WAMT      WTOTAM                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C           WTOTAM    ANDNESVAMT                                                         CLE034
     C           SVAMT     SUB  WTOTAM    WDIFF  150                                          CLE034
     C                     ADD  WDIFF     WAMT                                                CLE034
     C                     ENDIF                                                              CLE034
     C                     Z-ADDWAMT      ##AMT                                              BUG8962
      *                                                                                      BUG8962
     C                     ELSE                                                              BUG8962
      ** Else, Allocations are by Amount:                                                    BUG8962
      *                                                                                       CLE034
      ** If WRKFLD not 'Y', place Allocation Amount in WAMT field.                           BUG8962
     C           WRKFLD    IFNE 'Y'                                                          BUG8962
     C           WPAYRC    IFEQ 'P'                                                          BUG8962
     C                     Z-ADDLSPYAM    WAMT                                               BUG8962
     C                     ELSE                                                              BUG8962
     C                     Z-ADDLSRCAM    WAMT                                               BUG8962
     C                     ENDIF                                                             BUG8962
     C                     ELSE                                                              BUG8962
      ** Else, no more allocations to be processed:                                          BUG8962
     C                     Z-ADD0         WAMT                                               BUG8962
     C                     ENDIF                                                             BUG8962
      *                                                                                      BUG8962
     C                     Z-ADDWAMT      ##AMT                                               CLE034
     C                     ENDIF                                                             BUG8962
      *                                                                                       CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34C                                         *                       CLE034
      ** Function    :  Processing to get next settlement allocation  *                       CLE034
      ** Calls       : AOSTALR2 AOBSTLR0                              *                       219608
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE LNRF      WLNRF                                               CLE034
      *                                                                                       CLE034
      ** If reversing existing allocations, call AOBSTLR0 to                                  219608
      ** access the 'before' image from LEBSTLPD:                                             219608
     C           ##REVI    IFEQ 'YES'                                                         219608
     C           BEFORE    ANDEQ*BLANKS                                                       219608
     C                     CALL 'AOBSTLR0'                                                    219608
     C                     PARM *BLANKS   WRTCD   7                                           219608
     C                     PARM '*NEXT '  WOPTN   7                                           219608
     C***********          PARM 'LOAN'    WTYPE   4                                    219608 220754
     C                     PARM           WTYPE   4                                           220754
     C                     PARM           WLNRF   6                                           219608
     C                     PARM *BLANKS   WVDAT   5                                           219608
     C                     PARM *BLANKS   WLSEQ   3                                           219608
     C                     PARM *BLANKS   WCFEE   6                                           219608
     C                     PARM *BLANKS   WFFEE   5                                           219608
     C                     PARM *BLANKS   WFSEQ   2                                           219608
     C                     PARM WPAYRC    WPAYR   1                                           219608
     C********** LESTAL    PARM LESTAL    DSSDY                                       219608 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
      ** Else, inserting new allocations, so call AOSTALR2                                    219608
      ** to access the 'after' image of LESTALPD:                                             219608
     C                     ELSE                            ##REVI not YES                     219608
      *                                                                                       219608
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   WRTCD                                               CLE034
     C                     PARM '*NEXT  ' WOPTN                                               CLE034
     C***********          PARM 'LOAN'    WTYPE                                        CLE034 220754
     C                     PARM           WTYPE                                               220754
     C                     PARM           WLNRF                                               CLE034
     C                     PARM *BLANKS   WVDAT                                               CLE034
     C                     PARM *BLANKS   WLSEQ                                               CLE034
     C                     PARM *BLANKS   WCFEE                                               CLE034
     C                     PARM *BLANKS   WFFEE                                               CLE034
     C                     PARM *BLANKS   WFSEQ                                               CLE034
     C                     PARM WPAYRC    WPAYR                                               CLE034
     C********** LESTAL    PARM LESTAL    DSSDY                                       CLE034 BUG8924
     C           LESTAL    PARM LESTAL    DSLDY                                              BUG8924
      *                                                                                       219608
     C                     ENDIF                           End ##REVI chk                     219608
      *                                                                                       CLE034
     C           WRTCD     IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WRKFLD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34D                                         *                       CLE034
      ** Function    :  Set up fields from settlement allocation      *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           ##LOD     IFEQ 'D'                                                           CLE034
     C                     MOVE LSRSTM    SDST                                                CLE034
     C                     MOVE LSRONS    OSDA                                                CLE034
     C                     MOVE LSROBR    OSDB                                                CLE034
     C                     MOVE LSPSTM    MDST                                                CLE034
     C                     MOVE LSPONS    OMDA                                                CLE034
     C                     MOVE LSPOBR    OMDB                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE LSPSTM    SDST                                                CLE034
     C                     MOVE LSPONS    OSDA                                                CLE034
     C                     MOVE LSPOBR    OSDB                                                CLE034
     C                     MOVE LSRSTM    MDST                                                CLE034
     C                     MOVE LSRONS    OMDA                                                CLE034
     C                     MOVE LSROBR    OMDB                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE LSRSTM    ##RECM                                              CLE034
     C                     MOVE LSRONS    ##RECA                                              CLE034
     C                     MOVE LSROBR    ##RECB                                              CLE034
     C                     MOVE LSPSTM    ##PAYM                                              CLE034
     C                     MOVE LSPONS    ##PAYA                                              CLE034
     C                     MOVE LSPOBR    ##PAYB                                              CLE034
     C                     MOVE LSPSCY    PSCY                                                CLE034
     C                     MOVE LSRSCY    SCCY                                                CLE034
     C                     MOVE LSPEXR    PEXR                                                CLE034
     C                     MOVE LSREXR    REXR                                                CLE034
     C                     MOVE LSPEXI    PEXI                                                CLE034
     C                     MOVE LSREXI    REXI                                                CLE034
     C                     MOVE LSROBN    ROBN                                               BUG8713
     C                     MOVE LSROCN    ROCN                                               BUG8713
     C                     MOVE LSRIBN    RIBN                                               BUG8713
     C                     MOVE LSRIBA    RIBA                                               BUG8713
     C                     MOVE LSPOBN    POBN                                               BUG8713
     C                     MOVE LSPOCN    POCN                                               BUG8713
     C                     MOVE LSPIBA    PIBA                                               BUG8713
     C                     MOVE LSRVNO    RVNO                                               BUG8713
     C                     MOVE LSCVMR    CVMR                                               BUG8713
     C                     MOVE LSRCRN    RCRN                                               BUG8713
     C                     MOVE LSRCRA    RCRA                                               BUG8713
     C                     MOVE LSAWBN    AWBN                                               BUG8713
     C                     MOVE LSAWBA    AWBA                                               BUG8713
     C                     MOVE LSBENN    BENN                                               BUG8713
     C                     MOVE LSBENA    BENA                                               BUG8713
     C                     MOVE LSDTP1    DTP1                                               BUG8713
     C                     MOVE LSDTP2    DTP2                                               BUG8713
     C                     MOVE LSDTP3    DTP3                                               BUG8713
     C                     MOVE LSDTP4    DTP4                                               BUG8713
     C                     MOVE LSDCHG    DCHG                                               BUG8713
     C                     MOVE LSBTB1    BTB1                                               BUG8713
     C                     MOVE LSBTB2    BTB2                                               BUG8713
     C                     MOVE LSBTB3    BTB3                                               BUG8713
     C                     MOVE LSBTB4    BTB4                                               BUG8713
     C                     MOVE LSBTB5    BTB5                                               BUG8713
     C                     MOVE LSBTB6    BTB6                                               BUG8713
      *                                                                                       CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           CLE031    ANDEQ'N'                                                           CLE034
     C           SCCY      ANDNE*BLANKS                                                       CLE034
     C                     MOVE SCCY      ##CCY                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE CCY       ##CCY                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE031    IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   SVSCCY                                              227696
     C                     MOVE *BLANKS   SVPSCY                                              227696
     C********** SCCY      IFNE *BLANKS                                              CLE034 AR943686
     C                     MOVE SCCY      SVSCCY                                              CLE034
     C**********           ENDIF                                                     CLE034 AR943686
     C********** PSCY      IFNE *BLANKS                                              CLE034 AR943686
     C                     MOVE PSCY      SVPSCY                                              CLE034
     C**********           ENDIF                                                     CLE034 AR943686
      *                                                                                     AR943686
     C                     Z-ADDREXR      SVREXR                                            AR943686
     C                     MOVE REXI      SVREXI                                            AR943686
     C                     Z-ADDPEXR      SVPEXR                                            AR943686
     C                     MOVE PEXI      SVPEXI                                            AR943686
      *                                                                                     AR943686
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CLE034
      ** Subroutine  :  SR34E                                         *                       CLE034
      ** Function    :                                                *                       CLE034
      ** Calls       :                                                *                       CLE034
      **                                                              *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                                                              CLE034
     C                     MOVE SVLOAN    LOANCL                                              CLE034
     C                     MOVE SVRECM    ##RECM                                              CLE034
     C                     MOVE SVRECA    ##RECA                                              CLE034
     C                     MOVE SVRECB    ##RECB                                              CLE034
     C                     MOVE SVPAYM    ##PAYM                                              CLE034
     C                     MOVE SVPAYA    ##PAYA                                              CLE034
     C                     MOVE SVPAYB    ##PAYB                                              CLE034
     C                     MOVE SVCCY     ##CCY                                               CLE034
     C                     MOVE S#SCCY    SVSCCY                                              CLE034
     C                     MOVE S#PSCY    SVPSCY                                              CLE034
     C**********           MOVE SVPEXR    PEXR                                       CLE034 AR943686
     C**********           MOVE SVREXR    REXR                                       CLE034 AR943686
     C**********           MOVE SVPEXI    PEXI                                       CLE034 AR943686
     C**********           MOVE SVREXI    REXI                                       CLE034 AR943686
     C                     Z-ADDW#REXR    SVREXR                                            AR943686
     C                     Z-ADDW#PEXR    SVPEXR                                            AR943686
     C                     MOVE W#REXI    SVREXI                                            AR943686
     C                     MOVE W#PEXI    SVPEXI                                            AR943686
     C                     ENDSR                                                              CLE034
      *****************************************************************                       CRE073
      * Subroutine  :  SRNSPR                                         *                       CRE073
      * Function    :  Process to calculate new spread rate           *                       CRE073
      *                                                               *                       CRE073
      *****************************************************************                       CRE073
      *                                                                                       CRE073
     C           SRNSPR    BEGSR                                                              CRE073
      *                                                                                       CRE073
     C           CRE073    IFEQ 'Y'                                                           CRE073
      *                                                                                       CRE073
     C                     MOVEL'ZACALCSP'PROG   10                                           CRE073
     C                     MOVE 'RT'      PROG                                                CRE073
     C                     CALL PROG                                                          CRE073
     C                     PARM *BLANKS   WRTCD                                               CRE073
     C                     PARM           WCUBR                                               CRE073
     C                     PARM           CNSP                                                CRE073
     C                     PARM           CNSG                                                CRE073
     C                     PARM           RDMT                                                CRE073
     C                     PARM           RDFD                                                CRE073
     C                     PARM *ZERO     NSRTX  117                                          CRE073
      *                                                                                       CRE073
     C                     Z-ADDNSRTX     WCUSP                                               CRE073
      *                                                                                       CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                       CRE073
     C                     ENDSR                                                              CRE073
      *****************************************************************                       CLE031
      *                                                                                       CLE031
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SRSTAX - Generate Stamp tax shadow posting                   *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C           PTYP      IFEQ 61                                                            CER049
     C           PTYP      OREQ 62                                                            CER049
     C           PTYP      OREQ 63                                                            CER049
     C           PTYP      OREQ 64                                                            CER049
     C           PTYP      OREQ 65                                                            CER049
     C           PTYP      OREQ 68                                                            CER049
     C           PTYP      OREQ 70                                                            CER049
     C           PTYP      OREQ 71                                                            CER049
     C           PTYP      OREQ 80                                                            CER049
      *                                                                                       CER049
      ** Check for retail account                                                             CER049
      *                                                                                       CER049
     C                     MOVE DDDCST    KDCST                                               CER049
     C                     MOVE DDDCCY    KDCCY                                               CER049
     C                     MOVE DDDACD    KDACD                                               CER049
     C                     MOVE DDDASC    KDASC                                               CER049
     C                     MOVE DDDBRC    KDBRC                                               CER049
     C                     CALL 'AOACCTR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM *BLANKS   KRETL  10                                           CER049
     C                     PARM           KDCST   6                                           CER049
     C                     PARM           KDCCY   3                                           CER049
     C                     PARM           KDACD  10                                           CER049
     C                     PARM           KDASC   2                                           CER049
     C                     PARM           KDBRC   3                                           CER049
     C           SDACCT    PARM SDACCT    DSSDY                                               CER049
      ** If error occured, terminate the program                                              CER049
     C           @RTCD     IFNE *BLANKS                                                       CER049
     C           @RTCD     ANDNE'*NRF   '                                                     CER049
     C                     MOVEL'ACCNTAB 'W0FILE                                              CER049
     C                     MOVEL@OPTN     W0KEY                                               CER049
     C                     Z-ADD904       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           DDTAX     IFEQ 'Y'                                                           CER049
     C           RECI      ANDEQ'D'                                                           CER049
     C           ATYP      ANDEQ'R'                                                           CER049
      *                                                                                       CER049
     C                     MOVE ACNO      C#ACNO                                              CER049
     C                     MOVE 'R'       C#ATYP                                              CER049
     C                     MOVE *BLANKS   C#MEMS                                              CER049
     C                     MOVE *BLANKS   C#RSAC                                              CER049
     C                     MOVE DDDCCY    C#CCY                                               CER049
     C                     MOVE ##AMT     WSTAX  150                                          CER049
      *                                                                                       CER049
     C** Get Stamp tax rate                                                                   CER049
      *                                                                                       CER049
     C                     MOVE LTYP      ##TYPE                                              CER049
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM VDAT      U#DATE  50                                          CER049
     C                     PARM 'LOAN'    U#ORGN 10                                           CER049
     C                     PARM           ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C           PTYP      IFEQ 62                                                            CER049
     C           PTYP      OREQ 63                                                            CER049
     C           PTYP      OREQ 70                                                            CER049
     C                     CALL 'SD008142'                                                    CER049
     C                     PARM *ZEROS    PVALD   60                                          CER049
     C                     PARM *ZEROS    PMATD   60                                          CER049
     C                     PARM           SDSTPD                                              CER049
     C                     PARM           U#TAXR                                              CER049
     C                     PARM *BLANKS   U#PERD  1                                           CER049
     C                     PARM 0         U#TXBR 138                                          CER049
     C                     PARM 0         U#MNTH  70                                          CER049
     C                     PARM           VDAT                                                CER049
     C                     PARM           MDAT                                                CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           CCY       IFNE DDDCCY                                                        CER049
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C                     MOVE DDDCCY    WCCY                                                CER049
     C                     EXSR SRCURR                                                        CER049
     C                     MOVE A6NBDP    NDP     10                                          CER049
     C                     MOVELA6SPRT    ZRATE1 138                                          CER049
     C                     MOVELA6MDIN    ZMDI1   1                                           CER049
      *                                                                                       CER049
      ** Access transaction currency for decimal places                                       CER049
      *                                                                                       CER049
     C                     MOVE CCY       WCCY                                                CER049
     C                     EXSR SRCURR                                                        CER049
     C                     MOVELA6SPRT    ZRATE2 138                                          CER049
     C                     MOVELA6MDIN    ZMDI2   1                                           CER049
      *                                                                                       CER049
      ** Get exchange rate                                                                    CER049
      *                                                                                       CER049
     C                     EXSR RTZXRT                                                        CER049
      *                                                                                       CER049
     C                     Z-ADDZRATEX    ZEXCH                                               CER049
     C                     MOVE ZMDI1     ZMD                                                 CER049
     C                     Z-ADDWSTAX     ZAMTCI                                              CER049
     C                     Z-ADDA6NBDP    ZCDPI                                               CER049
     C                     Z-ADDNDP       ZCDPO                                               CER049
     C                     EXSR ZCONV                                                         CER049
     C                     Z-ADDZAMTCO    WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           WSTAX     MULT U#TAXR    C#AMT                                               CER049
      *                                                                                       CER049
     C           C#AMT     IFLT 0                                                             CER049
     C                     MULT -1        C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           ##REVI    IFNE *BLANKS                                                       CER049
     C                     Z-SUBC#AMT     C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     CALL 'AOSPOSU0'             9090                                   CER049
     C           R#RTN     PARM ##RTCD    O#RTN                                               CER049
     C                     PARM '*ADD    'W0ACT                                               CER049
     C                     PARM C#DTA     O#DTA                                               CER049
      *                                                                                       CER049
     C           *IN90     IFEQ '1'                                                           CER049
     C           R#RTN     OREQ '*ERROR*'                                                     CER049
     C                     MOVEL'*CALL   'W0FILE                                              CER049
     C                     MOVEL'AOSPOSU0'W0KEY                                               CER049
     C                     Z-ADD905       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      ** Subroutine  :  SRREVS                                        *                     MD021689
      ** Function    :  Reverse Principal and Repayment               *                     MD021689
      ** Calls       :  SRPROC                                        *                     MD021689
      **                                                              *                     MD021689
      *****************************************************************                     MD021689
      *                                                                                     MD021689
     C           SRREVS    BEGSR                                                            MD021689
      *                                                                                     MD021689
     C           CLE034    IFEQ 'Y'                                                         MD021689
     C           STAL      ANDEQ'Y'                                                         MD021689
      *                                                                                     MD021689
     C           ##LOD     IFEQ 'L'                                                         MD021689
     C                     MOVE 'R'       WPAYRC                                            MD021689
     C                     ELSE                                                             MD021689
     C                     MOVE 'P'       WPAYRC                                            MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
     C                     EXSR SR34A                                                       MD021689
     C                     ELSE                                                             MD021689
     C                     MOVE 'Y'       WRKFLD                                            MD021689
     C                     MOVE '*EOF   ' WRTCD                                             MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
     C           WRKFLD    DOWEQ'Y'                                                         MD021689
     C           WRTCD     OREQ *BLANKS                                                     MD021689
      *                                                                                     MD021689
     C           CLE034    IFEQ 'Y'                                                         MD021689
     C           STAL      ANDEQ'Y'                                                         MD021689
     C                     EXSR SR34B                                                       MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
      ** Pass movement to write program (with appropriate instructions)                     MD021689
      *                                                                                     MD021689
     C           ##LOD     IFEQ 'L'                                                         MD021689
     C                     MOVEL##RECD    ##SETD           * Rec details                    MD021689
     C                     ELSE                                                             MD021689
     C                     MOVEL##PAYD    ##SETD           * Pay details                    MD021689
     C                     END                                                              MD021689
      *                                                                                     MD021689
     C           CAP205    IFEQ 'Y'                                                         MD021689
     C                     MOVEL'F'       ##MTYP                                            MD021689
     C                     ENDIF                                                            MD021689
     C                     EXSR SRMOVE                                                      MD021689
      *                                                                                     MD021689
     C           CLE034    IFEQ 'Y'                                                         MD021689
     C           STAL      ANDEQ'Y'                                                         MD021689
     C                     EXSR SR34C                                                       MD021689
     C                     ELSE                                                             MD021689
     C                     MOVE *BLANKS   WRKFLD                                            MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
     C                     ENDDO                                                            MD021689
      *                                                                                     MD021689
     C           CLE034    IFEQ 'Y'                                                         MD021689
     C           STAL      ANDEQ'Y'                                                         MD021689
     C                     EXSR SR34E                                                       MD021689
     C                     ENDIF                                                            MD021689
      *                                                                                     MD021689
     C                     ENDSR                                                            MD021689
      *****************************************************************                     MD021689
     C/COPY WNCPYSRC,AOH00051
     C/SPACE 5
      /EJECT                                                                                  201672
     C/COPY ZSRSRC,GLINTCZ1                                                                   201672
     C/COPY ZSRSRC,ZDAT10Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDLINTZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZCBDYSZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE9Z3                                               182370
     C/SPACE 5                                                            182370
     C/COPY ZSRSRC,ZDATE1Z2                                                                   201672
      /EJECT                                                                                  201672
     C/COPY ZSRSRC,ZCHKH                                                                      201672
      /EJECT                                                                                  201672
     C/COPY ZSRSRC,ZACCH                                                                      201672
      /EJECT                                                                                  201672
     C/COPY ZSRSRC,ZFWDT                                                                      238838
      /EJECT                                                                                  238838
     C/COPY ZSRSRC,ZBKDT                                                                      238838
      /EJECT                                                                                  238838
     C/COPY ZSRSRC,ZFRQB3                                                                     201672
      /EJECT                                                                                  201672
     C/COPY ZSRSRC,ZINTDYZ2                                                                   201672
      /EJECT                                                                                  201672
      /TITLE SR/ZCONV                                                                         CLE031
     C/COPY ZSRSRC,ZCONVZ1                                                                    CLE031
     C/COPY ZSRSRC,RTZXRTC1                                                                   CER049
** ##LDT  **      Loan Processing Types
66676972                                                                                      CLE034
** ##NAR  **      NARRATIVES
VALUE
INTEREST
REPAYMENT
MATURITY
ROLLOVER NEW CCY                                                                              220754
REPAY OLD CCY                                                                                 220754
ROLLOVER REPAYMENT                                                                            218984
ROLLOVER INCREASE                                                                             218984
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     201672
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           CLE031
0000001                                                                                       CLE031
0000010                                                                                       CLE031
0000100                                                                                       CLE031
0001000                                                                                       CLE031
0010000                                                                                       CLE031
0100000                                                                                       CLE031
1000000                                                                                       CLE031
**   SVAL  -  SYSTEM VALUES ARRAY                                                             CLE033
Settlement09Customer                                                                          CLE033
Settlement09AccCode                                                                           CLE033
Settlement09Hostpgm                                                                           CLE033
Settlement09Postings                                                                          218782
SdwPstIncTransRef                                                                             241166
LECalcBasis6LeapYear                                                                        MD035545
**   #AM   -  AMENDMENT TYPE                                                                  CLE033
Participation P.                                                                              CLE033
Participation S.                                                                              CLE033
Loan                                                                                          CLE033
