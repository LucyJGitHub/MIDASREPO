     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AO On-line update of MM position files')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Access Objects Module                                *
     F*                                                               *
     F*     AOOUMMU0 - On-line Update of MM Positions files           *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD055446           Date 04Apr20               *
      *                 MD055501           Date 29Apr20               *
      *                 CER050             Date 16Jun19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD047607           Date 29Nov17               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD021669           Date 21Jun17               *
      *                 MD031115           Date 23Jun15               *
      *                 CGL165             Date 23Feb15               *
      *                 MD031062A          Date 16Feb15               *
      *                 MD031797           Date 15Jan15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 MD025410           Date 10May14               *
      *                 CDL093             Date 12May14               *
      *                 MD022399B          Date 13Dec13               *
      *                 MD023776           Date 26Nov13               *
      *                 MD023401           Date 20Nov13               *
      *                 MD023265           Date 20Nov13               *
      *                 AR1044820          Date 17Jul13               *
      *                 MD021458           Date 29Jul13               *
      *                 AR1063117          Date 09May13               *
      *                 260517B            Date 26Nov12               *
      *                 262823             Date 26Nov12               *
      *                 260517             Date 26Nov12               *
      *                 AR996895           Date 06Jul12               *
      *                 CLE134             Date 01Aug12               *
      *                 CSF011A            Date 28Nov11               *
      *                 AR821086           Date 30Aug11               *
      *                 CER049             Date 06Dec10               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 260863             Date 01Jul09               *
      *                 CER059             Date 19Jul10               *
      *                 BUG25226A          Date 08Sep09               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 19Feb10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 256960             Date 08Oct08               *
      *                 247555             Date 30May07               *
      *                 237472             Date 25May07               *
      *                 247544             Date 16May07               *
      *                 246141             Date 26Mar07               *
      *                 249910             Date 27Sep07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12795A          Date 11Dec06               *
      *                 BUG12795           Date 04Dec06               *
      *                 242286             Date 25Sep06               *
      *                 241166             Date 17Jul06               *
      *                 240855             Date 14Jul06               *
      *                 CDL049             Date 04Jul06               *
      *                 237416             Date 28Jun06               *
      *                 CSD027             Date 09Dec05               *
      *                 220013             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 238009             Date 16Feb06               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL033             Date 10Feb05               *
      *                 BUG5514            Date 26Jan05               *
      *                 CDL028             Date 07Feb05               *
      *                 BUG4613            Date 27Oct04               *
      *                 BUG3045            Date 01Jun04               *
      *                 BG2922             Date 28May04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL018             Date 08Apr04               *
      *                 TDA107             Date 31Mar04               *
      *                 CRE020             Date 20Jan04               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 191128             Date 14Aug01               *
      *                 182370             Date 05Jun01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 169288             Date 04Jul00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154863             Date  4Feb99               *
      *                 147424             Date 11Nov98               *
     F*                 141213             DATE 23Aug98               *
     F*                 106780             DATE 09Jun98               *
     F*                 136436             Date 10Jun98               *
     F*                 CEU003             Date 27Mar98               *
     F*                 125895             DATE 02Mar98               *
     F*                 101001             DATE 02Mar98               *
     F*                 110036             DATE 02Mar98               *
     F*                 124927             DATE 10DEC97               *
     F*                 CAC001             Date 01FEB96               *
     F*                 101523             Date 23APR96               *
     F*                 082738             Date 03FEB95               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD055446 - There are parties and fields missing from the BRT *
      *             details tab in Customer Input plus date of birth  *
      *             issues.                                           *
      *           - Recompile over changes in SDCBRTPD.               *
      *  MD055501 -  In Projected account movement Enquiry,           *
      *              Withholding Tax amount round down for a TD Deal  *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD047607 - Capitalize interest should not be projected.      *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD021669 - Incorrect total interest (based on the deal rate).*
      *             Use the interest accrual control date field when  *
      *             the accrued interest to control date is non-zero. *
      *           - Applied for MD-30199.                             *
      *  MD031115 - Proj. A/C Movements wrong DR/CR indicator in case *
      *             of interest due posting amount is negative. For   *
      *             SI deal amendments, negate sign of amount if deal *
      *             has negative interest rate.                       *
      *  CGL165 - Dual Withholding Tax                                *
      *  MD031062A - Missing German Tax projections.                  *
      *  MD031797 - Use the amendment settlement method of EM instead *
      *             of the TD setllement for the projection.          *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions (recompile) *
      *  MD025410 - STORNO projected movement generated after         *
      *             changing frequency                                *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  MD022399B - Incorrect amount in projected account movements  *
      *              for Early Maturity amendment                     *
      *            - Applied for MD024110                             *
      *  MD023776 - Incorrect tax computation for CDL013 on maturity  *
      *  MD023401 - Missing Tax projections for further settlement    *
      *             details                                           *
      *  MD023265 - Missing Tax projections for CDL013                *
      *  AR1044820 - Incorrect projected movements for Adjustment to  *
      *              Accrued Interest. Include AIAN in the Interest   *
      *              computation, and added parameters BEDEDC, AFDEDC,*
      *              and CALLER in the PLIST. (Child: AR1044821)      *
      *  MD021458 - Early maturity does not recalculate interest      *
      *             amount                                            *
      *  AR1063117 - The Last Interest Payment was re-posted after    *
      *              Early Maturity.  Fix is to make sure that the    *
      *              Deal amendment fields are always re-initialized. *
      *              (Child: AR1063118)                               *
      *  260517B - Process Accrual Interest when HKCPTI = 'Y'.        *
      *  262823 - Duplicate interest adjusment postings.              *
      *           Reversed original fixed of 260517.                  *
      *  260517 - Separate Interest adjustment not posted on the      *
      *           Projected Account Movements.                        *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CSF011A - CCR015: Display Order in Confirmation Pages        *
      *            (Recompile)                                        *
      *  AR821086 - No stamp tax shadow posting generated for LDNI    *
      *             and DEAM                                          *
      *  CER049 - Stamp Tax                                           *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  260863 - DBERR due to AONOSTR0 hard coded Return Code.       *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG25226A - Field 61 on MT942 is not showing correct data    *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  256960 - Show Interest Adjustment on Projected Acct Movement *
      *  247555 - Include maturity interests for inserted deals when  *
      *           an interim payment exists.                          *
      *  237472 - Interest amount is not shown after deal reversal.   *
      *           Partially apply fix 231264 to project interest paid/*
      *           received to date with correct value date and        *
      *           correct projection.                                 *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  249910 - Generate on-line postings for EM amendment type.    *
      *         - Amend not to include rejected or reversed amendments*
      *           in calculation of interest and maturity amounts.    *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  BUG12795A - Reverse BUG12795                                 *
      *  BUG12795 - Narrative of interbranch settlements not explicit *
      *             enough.                                           *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  241166 - Modify certain shadow posting narrative to include  *
      *         - transaction ref if SdwPstIncTransRef = 'Y'          *
      *  240855 - Reversal shadow postings appear on the Euro account *
      *           after an 'in' ccy retail account is converted.      *
      *           Amount is in 'in' ccy, not in Euro.  This happens   *
      *           when the 10-digit retail account number is retained.*
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  237416 - Generate tax entry for taxable deal.                *
      *           Fix already catered by fix 220013.                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  220013 - Generate movements for tax deductions at maturity   *
      *           where S01383 and S01460 is on.                      *
      *         - If S01383 is switched on, ensure correct customer   *
      *           field is used to retrieve customer details, so that *
      *           correct tax setting is used for the transaction.    *
      *         - Also ensure tax amount field is initialised and HK  *
      *           tax rate is obtained from Dealing ICD.  This will   *
      *           ensure tax to be calculated correctly if S01383 is  *
      *           switched off.                                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  238009 - LDNI Further Settlements Both & Amount posted twice *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC, ZINTDY, ZDLINT and ZCBDYS.   *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  BUG5514- PAMV does not show interest if Int. Paid Separately *
      *           is 'Y'. Use the settlement a/c if the Int. Sett.    *
      *           method is not specified. (applied 224043)           *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  BUG4613- The split between the multiple accounts not working.*
      *           Check to see if CDL018 is ON is in the wrong place. *
      *  BUG3045- Amend shadow on-line positions update for           *
      *           new deal amendment type 'EM'.                       *
      *           Database error occurs when inserting a deal         *
      *           amendment for a deal with muktiple settlement       *
      *           accounts.                                           *
      *  BG2922 - Movements are being updated twice.                  *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL018 - Multiple Settlement Accounts                        *
      *  TDA107 - If deal amendments done against NAs puchased        *
      *           AOOUMMU0 crashes with array index error on @MD,ZWMTH*
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in MMDEAMPP.*
      *  191128 - If the account is physically non-existing in        *
      *           ACCNTAB, do not call AOSPOSU0 as this will end in   *
      *           DBERROR.                                            *
      *  182370 - Incorrect calculation of number of days for calcu-  *
      *           lation basis 6. Amended /COPY such that for calcu-  *
      *           lation basis 6, the number of days per year is      *
      *           equal to 366 when the year in question is a leap    *
      *           year, and 365 days/year for non-leap years. Calcu-  *
      *           lation was made so that processing would be in-line *
      *           with that of /COPY ZINTDY.                          *
     F*  169288 - Internal Funding deal type 'IL' is being considered *
     F*           incorrectly resulting in incorrect update of online *
     F*           positions file.                                     *
      *  CDL006 - Dealing Fiduciary.                                  *
     F*  154863 - No reveral of value date loan/deposit movements     *
     F*  147424 - 110036 causes no updates for nostro settlement      *
     F*  141213 - Fix 125895 causes update errors in AOSPOSU0.        *
     F*  136436 - Deletion of authorized deals does not rev a/c moves *
     F*  106780 - Program does not process Front-Up interest.         *  *
     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
     F*  125895 - APPLY FIX 110036 AND 101001
     F*  101001 - Add missing parameter to AONOSTR0.                  *
     F*  110036 - Program AOSPOSU0 ended in error when tried to       *
     F*           delete a deal with the settlement account that was  *
     F*           previously closed.                                  *
     F*           DS DSFDY is removed from fix 110036 as it is still  *
     F*           existing in the fix 124927.
     F* 124927 - If interest paid separately and Interest Settlement  *
     F*          is 04 (Prime Retail), access Prime account code and  *
     F*          get the Prime Retail Account for processing in       *
     F*          AOSPOSU0.                                            *
     F* CAC001 - Profit Centre Accounting Development:                *
     F*          Recompiled only.                                     *
     F* 101523 - For Settlement Interest event for a deposit, use     *
     F*          receive instructions instead of pay instructions if  *
     F*          negative interest flag is 'Y'.                       *
     F* 082738 - New program for redesign of update to PRONO, MEMOS,  *
     F*          OLPOS & RSACMTPD.                                    *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F/COPY WNCPYSRC,AOOUMMU0F2
      *                                                               *                       CDL033
     F*       16      Work indicator                                  *                       CDL033
      *                                                               *                       CDL033
     F*       31      Negative Interest Indicator is on.              *   101523
     F*                                                               *
     F*****************************************************************
     FDEALS   IF  E           K        DISK
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F            DEALSDGF                          KIGNORE
     FMMDEAMLLIF  E           K        DISK
     FDLCCGDL0IF  E           K        DISK                           UC  CDL006
     FDLFSACL0IF  E           K        DISK                                                   CDL018
     FSDBRTDL1IF  E           K        DISK                                                   220013
     FSDCBRTL1IF  E           K        DISK                                                   220013
     FDLDEALL5IF  E           K        DISK                                                   CER049
     FSDSTAAL1IF  E           K        DISK                                                 MD023265
     FSDJACCLBIF  E           K        DISK         KINFSR SRERR                           MD031062A
      ** Midas SD Joint A/c Member Details by Joint A/c No./Customer No.                   MD031062A
      *                                                                                    MD031062A
     F/COPY WNCPYSRC,AOOUMMU0F1
     E/SPACE 5
     E                    ##AC       12 21                                                    CDL018
     E                    ##AL       12  1                                                    CDL018
     E                    ##PC       12  6 3                                                  CDL018
     E                    ##AM       12 13 0                                                  CDL018
     E*
     E**  Loan Deal types
     E**********          ##LDT   9   9  2                                169288
     E                    ##LDT  10  10  2                                169288
     E*
     E**  (Posting) Naratives
     E**********          ##NAR   1   3 30                                                    220013
     E                    ##NAR   1   4 30                                                    220013
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E                    ZF29   14  32  5 0             29TH FEB ARRAY
     E*
     E*  Subroutine stack
     E                    @STK       20 10
     E/COPY WNCPYSRC,AOH00052
      *                                                                   CDL006
      ** Arrays used to retrieve percentage of current range for          CDL006
      ** Deal Principal Amount.                                           CDL006
      *                                                                   CDL006
     E                    ZRA        14 15 0A                             CDL006
     E                    ZPE        15  7 0                              CDL006
      *                                                                   CDL006
      ** Array used in subroutine ZCONVN for currency conversion.         CDL006
      *                                                                   CDL006
     E                    POWER   1   7  7 3                              CDL006
      *                                                                   CDL006
     E/COPY WNCPYSRC,AOOUMMU0E1
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
      ** Array of Commitment Job Names                                                        CSC022
     E                    CMTJOB     10 10                                                    CSC022
      *                                                                                    AR1044820
      ** Calling Program                                                                   AR1044820
      *                                                                                    AR1044820
     E                    CALPGM  1   1 10                                                 AR1044820
     E/COPY WNCPYSRC,AOH00053
     I/SPACE 5
     IZ#BSTS    E DSZ#BST
     IZ#ASTS    E DSZ#AST
     IZ#WSTS    E DSZ#WST
      *                                                                   CDL006
     ISDCURR    E DSSDCURRPD                                              CDL006
      ** Externally described data-structure for Currency details file.   CDL006
      *                                                                   CDL006
     I/COPY ZSRSRC,ZINTDYZ1                                               CDL006
      ** Data-structures used in subroutine ZINTDY.                       CDL006
      *                                                                   CDL006
     I/COPY ZSRSRC,ZDATE9Z2                                               CDL006
      ** Data-structures used in subroutine ZDATE9.                       CDL006
      *                                                                   CDL006
     I          E DSDLCCGDPD                                              CDL006
      ** Data-structure used to set up arrays ZRA and ZPE from            CDL006
      ** FID Deposit Commission/Charges type details file                 CDL006
      ** DLCCGDPD, to locate the highest range for Principal amount.      CDL006
      *                                                                   CDL006
     I                                    P  31 1420ZRA                   CDL006
     I                                    P 143 2020ZPE                   CDL006
      *                                                                   CDL006
     IWUKEY       DS                             29                       CDL006
      ** Data-structure used to set up field W0KEY.                       CDL006
      *                                                                   CDL006
     I                                        1   6 W1T6                  CDL006
     I                                        7  10 W7T10                 CDL006
     I                                       11  12 W11T12                CDL006
     I                                       13  14 W13T14                CDL006
     I                                       15  17 W15T17                CDL006
      *                                                                   CDL006
     ILDA       E DSLDA                         256                       CDL006
      *                                                                   CDL006
      ** Local data area for database error details                       CDL006
      ** *LOCK IN LDA immediately before and OUT LDA immediately          CDL006
      ** after each database error handling.                              CDL006
      **                                                                  CDL006
      **                                    134 141 DBFILE                CDL006
      **       Defines:                     142 170 DBKEY                 CDL006
      **                                    171 180 DBPGM                 CDL006
      **                                    181 1830DBASE                 CDL006
      *                                                                   CDL006
     I/COPY WNCPYSRC,AOOUMMU0I1
      *                                                                                       CDL033
      ** DS for FRCD Issued Extension details                                                 CDL033
      *                                                                                       CDL033
     IDSFRCD      DS                                                                          CDL033
     I                                        1   60XKDLNO                                    CDL033
     I                                        7  110XKRCDT                                    CDL033
     I                                       12  12 XKRCFR                                    CDL033
     I                                       13  140XKRCDM                                    CDL033
     I                                       15  15 XKSTRF                                    CDL033
     I                                       16  267XKSTRT                                    CDL033
     I                                       27  390XKAILC                                    CDL033
     I                                       40  520XKACDA                                    CDL033
     I                                       53  53 XKSTVF                                    CDL033
     I                                       54  54 XKBSVF                                    CDL033
     I                                       55  560XKFXDM                                    CDL033
     I                                       57  610XKINFD                                    CDL033
     I                                       62  62 XKINFF                                    CDL033
     I                                       63  737XKBSRF                                    CDL033
     I                                       74  74 XKFRCI                                    CDL033
     I                                       75  79 XKFYLD                                    CDL033
      *                                                                                       CSC022
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      *                                                                                       CSC022
      *  Program data structure                                                               CSC022
      *                                                                                       CSC022
     IDSPGM     ESDSY2PGDSP                                                                   CSC022
      *                                                                                       CSC022
     I*
     IMMDELD    E DSMMDELDPP
     IMMDENB    E DSMMDENBPP
     I              DORIQQ                          QQDORX                                    CGL029
     I              MORIQQ                          QQMORX                                    CGL029
     I              DOPIQQ                          QQDOPX                                    CGL029
     I              MOPIQQ                          QQMOPX                                    CGL029
     I              RONSQQ                          QQRONX                                    CGL029
     I              PONSQQ                          QQPONX                                    CGL029
     IMMDENS    E DSMMDENSPP
     I              DORIQQ                          QQDORY                                    CGL029
     I              MORIQQ                          QQMORY                                    CGL029
     I              RONSQQ                          QQRONY                                    CGL029
     I              PONSQQ                          QQPONY                                    CGL029
     IMMDEAM    E DSMMDEAMPP
     I              QQDORI                          QQDORZ                                    CGL029
     I              QQMORI                          QQMORZ                                    CGL029
     I              QQDOPI                          QQDOPZ                                    CGL029
     I              QQMOPI                          QQMOPZ                                    CGL029
     I              QQRONS                          QQRONZ                                    CGL029
     I              QQPONS                          QQPONZ                                    CGL029
     I                                       49  560HNVYMD
     I*                                                                   124927
     ISDRETL    E DSSDRETLPD                                              124927
     I*                                                                   124927
     IDSFDY     E DSDSFDY                                                 124927
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                124927
     I##PAYD      DS
     I                                        1   1 ##PAY
     I                                        2   3 ##PAYM
     I**********                              4  15 ##PAYA                                    CGL029
     I**********                             16  18 ##PAYB                                    CGL029
     I                                        4  21 ##PAYA                                    CGL029
     I                                       22  24 ##PAYB                                    CGL029
     I##RECD      DS
     I                                        1   1 ##REC
     I                                        2   3 ##RECM
     I**********                              4  15 ##RECA                                    CGL029
     I**********                             16  18 ##RECB                                    CGL029
     I                                        4  21 ##RECA                                    CGL029
     I                                       22  24 ##RECB                                    CGL029
     I##INTS      DS
     I                                        1   1 ##INPR
     I                                        2   3 ##INTM
     I**********                              4  15 ##INTA                                    CGL029
     I**********                             16  18 ##INTB                                    CGL029
     I                                        4  21 ##INTA                                    CGL029
     I                                       22  24 ##INTB                                    CGL029
     I##SETD      DS
      * pay/receive (P/R)
     I                                        1   1 ##PYRC
      * settlement method
     I                                        2   3 ##SETM
      * settlement account
     I**********                              4  15 ##SETA                                    CGL029
     I                                        4  21 ##SETA                                    CGL029
     I                                        4   5 ##NOSN
     I                                        4  13 ##ACNO
     I                                        4   9 ##CNUM
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      * settlement branch
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
     I#FPAYF    E DSSDFSFPPD                                                                  CDL018
      ** File - Payment Further Settlement Instructions                                       CDL018
      *                                                                                       CDL018
     I#FRECF    E DSSDFSFRPD                                                                  CDL018
      ** File - Receive Further Settlement Instructions                                       CDL018
      *                                                                                       CDL018
      **  Multiple Account Details                                                            CDL018
     I##MLAD      DS                                                                          CDL018
      *                                                                                       CDL018
     I                                        1 252 ##ACDT                                    CDL018
     I                                        1  21 ##AC01                                    CDL018
     I                                       22  42 ##AC02                                    CDL018
     I                                       43  63 ##AC03                                    CDL018
     I                                       64  84 ##AC04                                    CDL018
     I                                       85 105 ##AC05                                    CDL018
     I                                      106 126 ##AC06                                    CDL018
     I                                      127 147 ##AC07                                    CDL018
     I                                      148 168 ##AC08                                    CDL018
     I                                      169 189 ##AC09                                    CDL018
     I                                      190 210 ##AC10                                    CDL018
     I                                      211 231 ##AC11                                    CDL018
     I                                      232 252 ##AC12                                    CDL018
      *                                                                                       CDL018
     I                                      253 273 ##UNAC                                    CDL018
      *                                                                                       CDL018
     I                                      301 312 ##ALDT                                    CDL018
     I                                      301 301 ##AL01                                    CDL018
     I                                      302 302 ##AL02                                    CDL018
     I                                      303 303 ##AL03                                    CDL018
     I                                      304 304 ##AL04                                    CDL018
     I                                      305 305 ##AL05                                    CDL018
     I                                      306 306 ##AL06                                    CDL018
     I                                      307 307 ##AL07                                    CDL018
     I                                      308 308 ##AL08                                    CDL018
     I                                      309 309 ##AL09                                    CDL018
     I                                      310 310 ##AL10                                    CDL018
     I                                      311 311 ##AL11                                    CDL018
     I                                      312 312 ##AL12                                    CDL018
      *                                                                                       CDL018
     I                                      401 448 ##PCDT                                    CDL018
     I                                    P 401 4043##PC01                                    CDL018
     I                                    P 405 4083##PC02                                    CDL018
     I                                    P 409 4123##PC03                                    CDL018
     I                                    P 413 4163##PC04                                    CDL018
     I                                    P 417 4203##PC05                                    CDL018
     I                                    P 421 4243##PC06                                    CDL018
     I                                    P 425 4283##PC07                                    CDL018
     I                                    P 429 4323##PC08                                    CDL018
     I                                    P 433 4363##PC09                                    CDL018
     I                                    P 437 4403##PC10                                    CDL018
     I                                    P 441 4443##PC11                                    CDL018
     I                                    P 445 4483##PC12                                    CDL018
      *                                                                                       CDL018
     I                                      501 584 ##AMDT                                    CDL018
     I                                    P 501 5070##AM01                                    CDL018
     I                                    P 508 5140##AM02                                    CDL018
     I                                    P 515 5210##AM03                                    CDL018
     I                                    P 522 5280##AM04                                    CDL018
     I                                    P 529 5350##AM05                                    CDL018
     I                                    P 536 5420##AM06                                    CDL018
     I                                    P 543 5490##AM07                                    CDL018
     I                                    P 550 5560##AM08                                    CDL018
     I                                    P 557 5630##AM09                                    CDL018
     I                                    P 564 5700##AM10                                    CDL018
     I                                    P 571 5770##AM11                                    CDL018
     I                                    P 578 5840##AM12                                    CDL018
      *                                                                                       CDL018
      **  Multiple Account Details - Receipt Instructions                                     CDL018
     I##MLRD      DS                                                                          CDL018
      *                                                                                       CDL018
     I                                        1  21 RAC01                                     CDL018
     I                                       22  42 RAC02                                     CDL018
     I                                       43  63 RAC03                                     CDL018
     I                                       64  84 RAC04                                     CDL018
     I                                       85 105 RAC05                                     CDL018
     I                                      106 126 RAC06                                     CDL018
     I                                      127 147 RAC07                                     CDL018
     I                                      148 168 RAC08                                     CDL018
     I                                      169 189 RAC09                                     CDL018
     I                                      190 210 RAC10                                     CDL018
     I                                      211 231 RAC11                                     CDL018
     I                                      232 252 RAC12                                     CDL018
      *                                                                                       CDL018
     I                                      253 273 RUAC                                      CDL018
      *                                                                                       CDL018
     I                                      301 301 RAL01                                     CDL018
     I                                      302 302 RAL02                                     CDL018
     I                                      303 303 RAL03                                     CDL018
     I                                      304 304 RAL04                                     CDL018
     I                                      305 305 RAL05                                     CDL018
     I                                      306 306 RAL06                                     CDL018
     I                                      307 307 RAL07                                     CDL018
     I                                      308 308 RAL08                                     CDL018
     I                                      309 309 RAL09                                     CDL018
     I                                      310 310 RAL10                                     CDL018
     I                                      311 311 RAL11                                     CDL018
     I                                      312 312 RAL12                                     CDL018
      *                                                                                       CDL018
     I                                    P 401 4043RPC01                                     CDL018
     I                                    P 405 4083RPC02                                     CDL018
     I                                    P 409 4123RPC03                                     CDL018
     I                                    P 413 4163RPC04                                     CDL018
     I                                    P 417 4203RPC05                                     CDL018
     I                                    P 421 4243RPC06                                     CDL018
     I                                    P 425 4283RPC07                                     CDL018
     I                                    P 429 4323RPC08                                     CDL018
     I                                    P 433 4363RPC09                                     CDL018
     I                                    P 437 4403RPC10                                     CDL018
     I                                    P 441 4443RPC11                                     CDL018
     I                                    P 445 4483RPC12                                     CDL018
      *                                                                                       CDL018
     I                                    P 501 5070RAM01                                     CDL018
     I                                    P 508 5140RAM02                                     CDL018
     I                                    P 515 5210RAM03                                     CDL018
     I                                    P 522 5280RAM04                                     CDL018
     I                                    P 529 5350RAM05                                     CDL018
     I                                    P 536 5420RAM06                                     CDL018
     I                                    P 543 5490RAM07                                     CDL018
     I                                    P 550 5560RAM08                                     CDL018
     I                                    P 557 5630RAM09                                     CDL018
     I                                    P 564 5700RAM10                                     CDL018
     I                                    P 571 5770RAM11                                     CDL018
     I                                    P 578 5840RAM12                                     CDL018
      *                                                                                       CDL018
      **  Multiple Account Details - Pay Instructions                                         CDL018
     I##MLPD      DS                                                                          CDL018
      *                                                                                       CDL018
     I                                        1  21 PAC01                                     CDL018
     I                                       22  42 PAC02                                     CDL018
     I                                       43  63 PAC03                                     CDL018
     I                                       64  84 PAC04                                     CDL018
     I                                       85 105 PAC05                                     CDL018
     I                                      106 126 PAC06                                     CDL018
     I                                      127 147 PAC07                                     CDL018
     I                                      148 168 PAC08                                     CDL018
     I                                      169 189 PAC09                                     CDL018
     I                                      190 210 PAC10                                     CDL018
     I                                      211 231 PAC11                                     CDL018
     I                                      232 252 PAC12                                     CDL018
      *                                                                                       CDL018
     I                                      253 273 PUAC                                      CDL018
      *                                                                                       CDL018
     I                                      301 301 PAL01                                     CDL018
     I                                      302 302 PAL02                                     CDL018
     I                                      303 303 PAL03                                     CDL018
     I                                      304 304 PAL04                                     CDL018
     I                                      305 305 PAL05                                     CDL018
     I                                      306 306 PAL06                                     CDL018
     I                                      307 307 PAL07                                     CDL018
     I                                      308 308 PAL08                                     CDL018
     I                                      309 309 PAL09                                     CDL018
     I                                      310 310 PAL10                                     CDL018
     I                                      311 311 PAL11                                     CDL018
     I                                      312 312 PAL12                                     CDL018
      *                                                                                       CDL018
     I                                    P 401 4043PPC01                                     CDL018
     I                                    P 405 4083PPC02                                     CDL018
     I                                    P 409 4123PPC03                                     CDL018
     I                                    P 413 4163PPC04                                     CDL018
     I                                    P 417 4203PPC05                                     CDL018
     I                                    P 421 4243PPC06                                     CDL018
     I                                    P 425 4283PPC07                                     CDL018
     I                                    P 429 4323PPC08                                     CDL018
     I                                    P 433 4363PPC09                                     CDL018
     I                                    P 437 4403PPC10                                     CDL018
     I                                    P 441 4443PPC11                                     CDL018
     I                                    P 445 4483PPC12                                     CDL018
      *                                                                                       CDL018
     I                                    P 501 5070PAM01                                     CDL018
     I                                    P 508 5140PAM02                                     CDL018
     I                                    P 515 5210PAM03                                     CDL018
     I                                    P 522 5280PAM04                                     CDL018
     I                                    P 529 5350PAM05                                     CDL018
     I                                    P 536 5420PAM06                                     CDL018
     I                                    P 543 5490PAM07                                     CDL018
     I                                    P 550 5560PAM08                                     CDL018
     I                                    P 557 5630PAM09                                     CDL018
     I                                    P 564 5700PAM10                                     CDL018
     I                                    P 571 5770PAM11                                     CDL018
     I                                    P 578 5840PAM12                                     CDL018
      *
      *  Calling parameter data structure for AOSPOSU0
      *
     IC#DTA       DS                            256
      *  Account type N=nostro nbr F=Full nostro G=General Ledger
      *               P=Partial Ledger R= Retail Number  X= no settlement
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I                                        2  19 C#ACCT
     I**********                              2   70C#CNU1                                    CSD027
     I                                        2   7 C#CNU1                                    CSD027
     I                                        8  10 C#CCY1
     I**********                             11  140C#ACO1                                    CGL029
     I                                       11  140QQACO1                                    CGL029
     I                                       15  160C#ACS1
     I                                       17  19 C#BRC1
      *               Nostro number
     I                                        2   30C#NOSN
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               Partial Account - CNUM/ACOD/ACSQ
     I**********                              2   70C#CNUM                                    CSD027
     I                                        2   7 C#CNUM                                    CSD027
     I**********                              8  110C#ACOD                                    CGL029
     I                                        8  110QQACOD                                    CGL029
     I                                       12  130C#ACSQ
      *               Branch of account if Partial                      '
     I                                       14  16 C#BRCA
      *               OLPOS Incoming/Outgoing Indicator 'I' or 'O' or ' '
      *                     ' ' no OLPOS update
     I                                       24  24 C#IO
      *               Currency of transaction
     I                                       25  27 C#CCY
      *               Transaction Type
     I                                       28  29 C#TRYP
      *               Transaction Narrative
     I                                       30  59 C#NARR
      *               Cheque Number
     I                                       60  670C#CHQN
      *               FT transaction reference
     I                                       68  82 C#PREF
      *               DL/LE/GL/RE transaction reference
     I                                       83  88 C#TRN
      *               Movement amount
     I                                    P  89  960C#AMT
      *               Processing indicators Not blank = no update
      *                                     ' ' = Update
      *               Prono update indicator
     I                                       97  97 C#PRON
      *               Olpos update indicator
     I                                       98  98 C#OLPS
      *               Memos update indicator
     I                                       99  99 C#MEMS
      *               Rsacmtpd write indicator
     I                                      100 100 C#RSAC
      *               Module
     I                                      101 102 C#MOD
      *               Olpos record number to update
      *                     '01' for FX
      *                     '02' for Interest movements
      *                     '03' for MM loans and deposits
     I                                      103 104 C#OLRC
      *               FT Memos ledger balance override
      *                        'Y' update ledger balance irrespective of
      *                        posting date
     I                                      105 105 C#FTOV
      *               Value date and posting date
     I                                    P 106 1080C#VDAT
     I                                    P 109 1110C#PSTD
      *               Override posting date correction
      *                        for forward valued items
      *                        'Y' prevents date being changed
     I                                      112 112 C#PSTO
      *               Indicator to show if removal allowed Y, N or " "
     I                                      113 113 C#RPST
      *               Removal set number
     I                                      114 1160C#RPNB
      *               Removal type "C" = Credit entries
      *                            "D" = Debit entries
     I                                      117 117 C#RTYP
      *               Booking branch
     I                                      118 120 C#BBRN
      *                                                                                       CGL029
      ** Account code for full general ledger                                                 CGL029
      *                                                                                       CGL029
     I                                      121 1300C#ACO1                                    CGL029
      *                                                                                       CGL029
      ** Account code for partial account                                                     CGL029
      *                                                                                       CGL029
     I                                      131 1400C#ACOD                                    CGL029
      *                                                                                       CAP204
      ** Other Transaction Reference                                                          CAP204
      *                                                                                       CAP204
     I                                      141 160 C#OTR1                                    CAP204
      *                                                                                       CAP205
      ** Movement Type                                                                        CAP205
      *                                                                                       CAP205
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
     I**                                                                                      241166
     I* Data structure for more detailed description                                          241166
     I            DS                                                                          241166
     I                                        1  15 D#WORK                                    241166
     I                                        1   6 D#TRN                                     241166
     I                                        9  10 D#TYP                                     241166
      *
     I            DS
     I* Value date (YYYYMMDD) and sequence number read from MMDEAMPP
     I                                        1  110@@VDSN
     I                                        1   80@@VYMD
     I                                        9  110@@DS38
     I            DS
     I* Value date (YYYYMMDD) and sequence number on MMDEAMPP to omit
     I                                        1  110$$VDSN
     I                                        1   80$$VYMD
     I                                        9  110$$DS38
     I            DS
     I* Value date (YYYYMMDD) and sequence number on MMDEAMPP to be read to
     I                                        1  110##VDSN
     I                                        1   80##VYMD
     I                                        9  110##DS38
     I            DS                                                                          249910
     I* Value date (YYYYMMDD) and sequence number read from MMDEAMPP and current deleted      249910
     I                                        1  110CDVDSN                                    249910
     I                                        1   80CDVYMD                                    249910
     I                                        9  110CDDS38                                    249910
     I/COPY WNCPYSRC,AOOUMMU0I2
      *                                                                   CEU003
     ISCSARD    E DSSCSARDPD                                              CEU003
     I              LCD                             SCLCD                 CEU003
      ** Switchable Features File                                         CEU003
      *                                                                   CEU003
     ISDTXPA    E DSSDTXPAPD                                                               MD031062A
      ** Data structure for Tax Parameter File                                             MD031062A
      *                                                                                    MD031062A
     ISDBRCH    E DSSDBRCHPD                                                               MD031062A
      ** External DS for Branch Details                                                    MD031062A
      *                                                                                    MD031062A
     ISDCTTX    E DSSDCTTXPD                                                               MD031062A
      ** External DS for Country of Tax Details                                            MD031062A
      *                                                                                    MD031062A
     ISDLOCN    E DSSDLOCNPD                                                               MD031062A
      ** External DS for Location Details                                                  MD031062A
      *                                                                                    MD031062A
     ISDBANK    E DSSDBANKPD                                              CEU003
      ** Bank Details File                                                CEU003
      *                                                                   CEU003
     ISDDEAL    E DSSDDEALPD                                              CDL006
     I              QQACCD                          QQACC1                                    CGL029
      ** Dealing ICD file                                                 CDL006
      *                                                                   CDL006
     ISDCUST    E DSSDCUSTPD                                                               BUG25226A
      * Customer Details Accessed via Access program                                       BUG25226A
     I              QQDFAC                          QQDFA1                                 BUG25226A
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
     I/COPY ZSRSRC,ZDAT10Z1
     ISDACNT    E DSACCNTAB                                               110036
      *                                                                   110036
      ** External DS for Account details.                                 110036
      *                                                                   110036
     I              RECI                            NRECI                 110036
     I              CNUM                            NCNUM                 110036
     I              CCY                             NCCY                  110036
     I              BRCA                            NBRCA                 110036
     I              PRFC                            NPRFC                 110036
     I              ORED                            NORED                 110036
     I              FACT                            NFACT                 110036
     I              FCNO                            NFCNO                 110036
     I              CHTP                            NCHTP                 110036
     I              TNLU                            NTNLU                 110036
     I              NACSG                           NNACSG                110036
     ISDNOST    E DSSDNOSTPD                                              110036
     I              QQACCD                          QQACC2                                    CGL029
      *                                                                   110036
      ** External DS for Nostro Details.                                  110036
      *                                                                   110036
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     IDSSDY     E DSDSSDY                                                 110036
      *                                                                   110036
      ** Second DS for access programs, long data structure.              110036
      *                                                                                    BUG25226A
     ISDSTPD    E DSSDSTPDPD                                                                  CER049
      *                                                                                       CER049
     IDLDLQD    E DSDLSTMPPD                                                                  CER049
      *                                                                                       CER049
     IDSLDY     E DSDSLDY                                                                  BUG25226A
      *  Third DS for access programs, very long date structure                            BUG25226A
      *                                                                   110036
     ICONV        DS                                                      110036
     I                                        1   2 D#ACSQ                110036
      *                                                                   110036
      ** Data structure that converts numeric ACSQ to character.          110036
      *                                                                   110036
      ** Data structure for subroutine ZCBDYS                             182370
     I            DS                                                      182370
     I                                        1   80ZZDAT1                182370
     I                                        1   40ZZYYA                 182370
     I                                        5   60ZZMMA                 182370
     I                                        7   80ZZDDA                 182370
      *                                                                   182370
     I            DS                                                      182370
     I                                        1   80ZZDAT2                182370
     I                                        1   40ZZYYB                 182370
     I                                        5   60ZZMMB                 182370
     I                                        7   80ZZDDB                 182370
      *                                                                   182370
     ISVAL1       DS                            200                                           241166
     I                                        1   1 SVAL11                                    241166
      ** DS for AOSVALR0                                                                      241166
      *                                                                                       241166
     I              'SdwPstIncTransRef   'C         SVALKK                                    241166
     I**********  DS                                                              BUG12795 BUG12795A
     I**********                              1  22 INTERB                        BUG12795 BUG12795A
     I*I********    'Originating Branch '     1  19 IPFRBP                        BUG12795 BUG12795A
     I**********                             20  22 IPFRBB                        BUG12795 BUG12795A
     I            DS                                                                          237472
     I                                        1   80W#SLID                                    237472
     I                                        1   40W#SLYY                                    237472
     I                                        5   60W#SLMM                                    237472
     I                                        7   80W#SLDD                                    237472
     I            DS                                                                          237472
     I                                        1   80W#VDAT                                    237472
     I                                        1   40W#VDYY                                    237472
     I                                        5   60W#VDMM                                    237472
     I                                        7   80W#VDDD                                    237472
      *                                                                                       237472
      ** DS for DEALSDC - Before being updated by a program.                               AR1044820
      *                                                                                    AR1044820
     IBEDEDC      DS                           2139                                        AR1044820
     I                                    P 250 2560BEAIAN                                 AR1044820
      *                                                                                    AR1044820
      ** DS for DEALSDC - After being updated by a program.                                AR1044820
      *                                                                                    AR1044820
     IAFDEDC      DS                           2139                                        AR1044820
     I                                    P 250 2560AFAIAN                                 AR1044820
      *                                                                                       CDL093
      ** DS for DEALSDC - After being updated by a program.                                   CDL093
      *                                                                                       CDL093
     IWDATE9      DS                                                                          CDL093
     I                                        1   20WDD9                                      CDL093
     I                                        3   40WMM9                                      CDL093
     I                                        5   60WYY9                                      CDL093
      *                                                                                    MD031062A
     I              'UseDealCustforEuTax' C         WUSEDL                                 MD031062A
      *                                                                                    MD031062A
     I              'PostNetInterest   '  C         PSNET                                  MD031062A
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I              'BasCcyTaxRoundDown'  C         C#BASE                                  MD055501
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                  MD055501
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           ##RTCD  7
     C                     PARM           Z#BSTS
     C                     PARM           Z#ASTS
     C                     PARM           Z#WSTS
     C                     PARM           @@AURO  1
     C                     PARM           #FPAYF                                              CDL018
     C                     PARM           #FRECF                                              CDL018
     C**********           PARM           DLDLQD                                     CER049 AR821086
     C/COPY WNCPYSRC,AOOUMMU0M2
      *                                                                                       CDL033
      ** FRCD Issued Extension details before update                                          CDL033
      *                                                                                       CDL033
     C                     PARM           PBFRCD100                                           CDL033
      *                                                                                       CDL033
      ** FRCD Issued Extension details after update                                           CDL033
      *                                                                                       CDL033
     C                     PARM           PAFRCD100                                           CDL033
      *                                                                                       CDL033
     C                     PARM           DLDLQD                                            AR821086
     C                     PARM           BEDEDC                                           AR1044820
     C                     PARM           AFDEDC                                           AR1044820
     C                     PARM           CALLER 10                                        AR1044820
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      *  Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Clear down all shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRCLR
      *
     C                     MOVELZ#BSTS    #BRCID  2
     C                     MOVELZ#ASTS    #ARCID  2
      *
     C                     Z-ADD*ZERO     CDVDSN           Currently deleted DEAM             249910
     C                     MOVEL*BLANKS   WLACT                                            AR1063117
      *
      *-------------------------------------------------------------------
      *
      ** GENERATE 'BEFORE STATUS' ACCOUNT MOVEMENTS
      ** (if not insertion, when __RCID will be blank)
      ** (also could be updating auto rollover)
      *
     C           #BRCID    IFNE *BLANK
     C           @@AURO    ANDNE'R'
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO DEAM OMIT
     C                     MOVEL'YES'     ##REVI  3
      *
      ** Loans/Deposits
     C           #ARCID    IFEQ 'HK'
     C                     MOVELZ#ASTS    MMDELD                          CEU003
     C                     MOVELHKCHTP    WCHTP   1                       CEU003
     C                     MOVELHKLACT    WLACT   1                       154863
     C                     MOVELZ#BSTS    MMDELD
     C                     MOVEL*BLANKS   MMDEAM                                           AR1063117
      *                                                                                       CDL018
      **  Get multiple settlement account details for deal if required                        CDL018
     C           CDL018    IFEQ 'Y'                                                           CDL018
      *                                                                                       CDL018
      ** Multiple accounts have been set up for either pay or recieve                         CDL018
     C           HKRMAC    IFEQ 'Y'                                                           CDL018
     C           HKPMAC    OREQ 'Y'                                                           CDL018
     C           HKDN38    CHAINDLFSACL0             90                                       CDL018
     C           *IN90     IFEQ *ON                                                           CDL018
     C                     CLEAR##MLPD                                                        CDL018
     C                     CLEAR##MLRD                                                        CDL018
     C                     ENDIF                                                              CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
     C/COPY WNCPYSRC,AOOUMMU0N6
      *                                                                                       CDL033
      ** For CF deals, load FRCD issued extension details                                     CDL033
      ** before update to DS.                                                                 CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           HKMTYP    ANDEQ'CF'                                                          CDL033
     C                     MOVELPBFRCD    DSFRCD                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     Z-ADD0         WKAIAN 130                                       AR1044820
     C           CALLER    IFEQ CALPGM,1                                                   AR1044820
     C                     Z-ADDBEAIAN    WKAIAN                                           AR1044820
     C                     ENDIF                                                           AR1044820
      *                                                                                    AR1044820
     C                     EXSR SRDELD
     C                     END
      *
      ** NA's Bought
     C           #ARCID    IFEQ 'HL'
     C                     MOVELZ#ASTS    MMDENB                          CEU003
     C                     MOVELHLCHTP    WCHTP                           CEU003
     C                     MOVELHLLACT    WLACT                           154863
     C                     MOVELZ#BSTS    MMDENB
     C                     EXSR SRDENB
     C                     END
      *
      ** NA's Sold
     C           #ARCID    IFEQ 'HM'
     C                     MOVELZ#BSTS    MMDENS
     C                     MOVELZ#WSTS    MMDENB
     C                     EXSR SRDENS
     C                     END
      *
      ** Deal Amendments
     C           #ARCID    IFEQ 'HN'
     C                     MOVELZ#BSTS    MMDEAM
     C                     EXSR SRDEAM
     C                     END
      *
     C                     END                             * Z#BSTS
      *-------------------------------------------------------------------
      *
      ** GENERATE 'AFTER STATUS' ACCOUNT MOVEMENTS
      ***(if*not*deletion,*when __CHTP*will*be*'D')********************   136436
      ** (if not deletion, when __CHTP & __LACT will be 'D')              136436
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO DEAM OMIT
     C                     MOVEL*BLANK    ##REVI
      *
      ** Loans/Deposits
     C           #ARCID    IFEQ 'HK'
     C                     MOVELZ#ASTS    MMDELD
     C                     MOVELHKMTYP    WDTYP   2                                         AR821086
     C                     MOVELHKCCY     WCCY2   3                                         AR821086
     C                     MOVEL*BLANKS   MMDEAM                                           AR1063117
      *                                                                                       CDL018
      **  Format incoming details to format of DLFSACPD                                       CDL018
     C           CDL018    IFEQ 'Y'                                                           CDL018
     C                     EXSR SRFSAC                                                        CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
     C           HKCHTP    IFNE 'D'
     C           HKLACT    ANDNE'D'                                       136436
     C/COPY WNCPYSRC,AOOUMMU0N7
      *                                                                                       CDL033
      ** For CF deals, load FRCD issued extension details                                     CDL033
      ** after update to DS.                                                                  CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           HKMTYP    ANDEQ'CF'                                                          CDL033
     C                     MOVELPAFRCD    DSFRCD                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     Z-ADD0         WKAIAN                                           AR1044820
     C           CALLER    IFEQ CALPGM,1                                                   AR1044820
     C                     Z-ADDAFAIAN    WKAIAN                                           AR1044820
     C                     ENDIF                                                           AR1044820
      *                                                                                    AR1044820
     C                     EXSR SRDELD
     C                     END
     C                     END
      *
      ** NA's Bought
     C           #ARCID    IFEQ 'HL'
     C                     MOVELZ#ASTS    MMDENB
     C           HLCHTP    IFNE 'D'
     C           HLLACT    ANDNE'D'                                       136436
     C                     EXSR SRDENB
     C                     END
     C                     END
      *
      ** NA's Sold
     C           #ARCID    IFEQ 'HM'
     C                     MOVELZ#ASTS    MMDENS
     C                     MOVELZ#WSTS    MMDENB
     C           HMCHTP    IFNE 'D'
     C           HMLACT    ANDNE'D'                                       136436
     C                     EXSR SRDENS
     C                     END
     C                     END
     C/COPY WNCPYSRC,AOOUMMU0N5
      *
      ** Deal Amendments
     C           #ARCID    IFEQ 'HN'
     C                     MOVELZ#ASTS    MMDEAM
     C                     MOVELHNMTYP    WDTYP                                             AR821086
     C                     MOVELHNCCY     WCCY2                                             AR821086
     C           HNCHTP    IFNE 'D'
     C           HNLACT    ANDNE'D'                                       136436
     C                     EXSR SRDEAM
     C                     END
     C                     END
      *-------------------------------------------------------------------
      *
      ** APPLY DEAL UPDATES DUE TO EFFECT
      ** OF DEAL AMENDMENT INSERTION
      *
     C           #ARCID    IFEQ 'HN'
     C           #BRCID    ANDEQ*BLANK
      *
     C                     MOVELZ#ASTS    MMDEAM
     C                     MOVELZ#WSTS    MMDELD
     C           HKRCID    IFEQ 'HK'                                                          TDA107
      *                                                                                      BUG3045
      **  Get multiple settlement account details for deal if required                       BUG3045
     C           CDL018    IFEQ 'Y'                                                          BUG3045
      *                                                                                      BUG3045
      ** Multiple accounts have been set up for either pay or recieve                        BUG3045
     C           HKRMAC    IFEQ 'Y'                                                          BUG3045
     C           HKPMAC    OREQ 'Y'                                                          BUG3045
     C           HKDN38    CHAINDLFSACL0             90                                      BUG3045
     C           *IN90     IFEQ *ON                                                          BUG3045
     C                     CLEAR##MLPD                                                       BUG3045
     C                     CLEAR##MLRD                                                       BUG3045
     C                     ENDIF                                                             BUG3045
     C                     ENDIF                                                             BUG3045
      *                                                                                      BUG3045
     C                     ENDIF                                                             BUG3045
      *
      * Value date (YYYYMMDD) and sequence number on MMDEAMPP to omit
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
      *
      * Reverse with deal amendment omitted from calculation of interest
      * due at next int. payment date and principal outstanding at maturity
      *
     C                     Z-ADD@@VDSN    $$VDSN           * DEAM OMIT
     C                     MOVEL'YES'     ##REVI
     C                     EXSR SRDELD
      *
      * Apply with deal amendment included in calculation of interest
      * due at next int. payment date and principal outstanding at maturity
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO DEAM OMIT
     C                     MOVEL*BLANK    ##REVI
     C                     EXSR SRDELD
      *
     C                     END                                                                TDA107
     C                     END                             * #ARCID = 'HN'
      *-------------------------------------------------------------------
      *
      ** APPLY DEAL UPDATES DUE TO EFFECT
      ** OF DEAL AMENDMENT DELETION
      *
     C                     MOVELZ#ASTS    MMDEAM
     C           #ARCID    IFEQ 'HN'
     C           HNCHTP    ANDEQ'D'
     C           #ARCID    OREQ 'HN'                                      136436
     C           HNLACT    ANDEQ'D'                                       136436
      *
     C                     MOVELZ#WSTS    MMDELD
     C           HKRCID    IFEQ 'HK'                                                          TDA107
      *                                                                                      BUG3045
      **  Get multiple settlement account details for deal if required                       BUG3045
     C           CDL018    IFEQ 'Y'                                                          BUG3045
      *                                                                                      BUG3045
      ** Multiple accounts have been set up for either pay or recieve                        BUG3045
     C           HKRMAC    IFEQ 'Y'                                                          BUG3045
     C           HKPMAC    OREQ 'Y'                                                          BUG3045
     C           HKDN38    CHAINDLFSACL0             90                                      BUG3045
     C           *IN90     IFEQ *ON                                                          BUG3045
     C                     CLEAR##MLPD                                                       BUG3045
     C                     CLEAR##MLRD                                                       BUG3045
     C                     ENDIF                                                             BUG3045
     C                     ENDIF                                                             BUG3045
      *                                                                                      BUG3045
     C                     ENDIF                                                             BUG3045
      *
      * Value date (YYYYMMDD) and sequence number on MMDEAMPP to omit
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
      *
     C                     Z-ADD@@VDSN    CDVDSN           * Current deleted DEAM             249910
      *
      * Apply with deal amendment omitted from calculation of interest
      * due at next int. payment date and principal outstanding at maturity
      *
     C                     Z-ADD@@VDSN    $$VDSN           * DEAM OMIT
     C                     MOVEL*BLANK    ##REVI
     C                     EXSR SRDELD
      *
      * Reverse with deal amendment included in calculation of interest
      * due at next int. payment date and principal outstanding at maturity
      *
     C                     Z-ADD*ZERO     $$VDSN           * NO DEAM OMIT
     C                     MOVEL'YES'     ##REVI
     C                     EXSR SRDELD
      *
     C                     END                                                                TDA107
     C                     END                             * #ARCID = 'HN'
      *
      *-------------------------------------------------------------------
      *
      ** Update database with shadow postings in store (within AOSPOSU0)
      *
     C                     EXSR SRUPD
      *
      *................................................................
      *
     C           EXMAIN    TAG
     C/COPY WNCPYSRC,AOOUMMU0N4
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDELD                                         *
      * Function    :  Loan & Deposit Processing                      *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  AOSPOSU0 - On-line Positions Update            *
      *                SRCOMC   - Computation of accrued commission   *   CDL006
      *****************************************************************
     C           SRDELD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRDELD'  @STK,Q
      *
      *................................................................
      *
      **  Determine whether loan or deposit
      *
     C                     Z-ADD1         #I      20
     C           HKMTYP    LOKUP##LDT,#I                 99*
     C   99                MOVEL'L'       ##LOD
     C  N99                MOVEL'D'       ##LOD   1
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
     C           HNMTYP    IFEQ 'EM'                                                        MD031797
     C                     MOVELHNPSTM    ##PAYM           * PAY METHOD                     MD031797
     C                     MOVELHNPONS    ##PAYA           * PAY ACCOUNT                    MD031797
     C                     MOVELHNOSBR    ##PAYB           * PAY BRANCH                     MD031797
     C                     MOVELHNRSTM    ##RECM           * REC METHOD                     MD031797
     C                     MOVELHNRONS    ##RECA           * REC ACCOUNT                    MD031797
     C                     MOVELHNOSBR    ##RECB           * REC BRANCH                     MD031797
     C                     MOVELHNSTCY    ##STCY           * Setllmt CCY                    MD031797
     C                     ELSE                                                             MD031797
     C                     MOVELHKMOPM    ##PAYM           * pay method
     C                     MOVELHKMOPI    ##PAYA           * pay account
     C                     MOVELHKPOBR    ##PAYB           * pay branch
     C                     MOVELHKORCM    ##RECM           * rec method
     C                     MOVELHKMORI    ##RECA           * rec account
     C                     MOVELHKROBR    ##RECB           * rec branch
     C                     ENDIF                                                            MD031797
      *
      **  Store basic deal details
      * Need to process Front-Up interest. HKMTTI & HKAMNP always have    106780
      * the opposite sign so the following add will reduce the            106780
      * absolute value of HKAMNP.                                         106780
     C           HKFUID    IFEQ 'Y'                                       106780
     C                     ADD  HKMTTI    HKAMNP                          106780
     C                     ENDIF                                          106780
      *
     C                     Z-ADDHKDN38    ##DLNO  60       * deal number
     C                     MOVELHKCCY     ##CCY   3        * currency
     C                     Z-ADDHKAMNP    ##PCPL 150   99  * principal
     C   99                Z-SUB##PCPL    ##PCPL
     C                     Z-ADDHKINTR    ##INTR 117       * interest rate
     C                     Z-ADDHKIAYY    ##IAYY  40       * int acc ctl yr
     C                     Z-ADDHKIAMM    ##IAMM  20       * int acc ctl mn
     C                     Z-ADDHKIADD    ##IADD  20       * int acc ctl dy
     C                     MOVELHKICMT    ##ICBS  10       * int calc basis
     C                     MOVELHKMTYP    ##TRYP  2        * deal type
     C                     MOVELHKDN38    ##TRN   6        * transact no.
     C                     MOVELHKBRCA    ##BBRN  3        * booking branch
      *
      * Value date (YYYYMMDD) and sequence number on MMDEAMPP to be read to
      *
     C                     Z-ADD*ZERO     ##VDSN           * READ TO
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT  50       * event value dte
     C                     Z-ADD*ZERO     ##AMT  150       * amount
     C                     MOVEL*BLANK    ##NARR 30        * narrative
     C********** *LIKE     DEFN HKORBR    ##ORBR                                  BUG12795 BUG12795A
     C**********           MOVE HKORBR    ##ORBR                                  BUG12795 BUG12795A
      *                                                                   CDL006
      ** If feature CDL006 installed, add fiduciary processing            CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Charges or commission.                                        CDL006
      *                                                                   CDL006
     C           WUCHCO    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Fixed Term Deposit or Call/Notice Deposit.                    CDL006
      *                                                                   CDL006
     C           HKMTYP    IFEQ 'FT'                                      CDL006
     C           HKMTYP    OREQ 'DT'                                      CDL006
     C           HKMTYP    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** If Commission taken and Commission code not blank.               CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKFCMC    ANDNE*BLANKS                                   CDL006
      *                                                                   CDL006
      ** Key list to access FID Charges/Commission types                  CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN HKCCY     KCYCD                           CDL006
      *                                                                   CDL006
     C           KDLCCG    KLIST                                          CDL006
     C                     KFLD           KCYCD                           CDL006
     C                     KFLD           HKFCMC                          CDL006
      *                                                                   CDL006
      ** If Commission tables in Base currency, access to Charge          CDL006
      ** Types record with base currency.                                 CDL006
      *                                                                   CDL006
     C                     MOVE HKCCY     KCYCD                           CDL006
      *                                                                   CDL006
     C           BNCTBC    IFEQ 'Y'                                       CDL006
     C                     MOVE BJCYCD    KCYCD                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Access FID Charges/Comm.Types logical file DLCCGDL0 to ret -     CDL006
      ** trive range upper limits and percentages for commission          CDL006
      ** calculation.                                                     CDL006
      *                                                                   CDL006
     C           WUSECG    IFEQ *BLANK                                    CDL006
     C                     OPEN DLCCGDL0                                  CDL006
     C                     MOVE 'Y'       WUSECG  1                       CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     Z-ADD0         ZRA                             CDL006
     C                     Z-ADD0         ZPE                             CDL006
     C           KDLCCG    CHAINDLCCGDL0             99                   CDL006
      *                                                                   CDL006
      ** If Commission code doesn't exist for Base currency.              CDL006
      *                                                                   CDL006
     C           *IN99     IFEQ *ON                                       CDL006
     C           KCYCD     ANDEQBJCYCD                                    CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL'DLCCGDL0'DBFILE                          CDL006
     C                     MOVELKCYCD     WDBKEY  5                       CDL006
     C                     MOVE HKFCMC    WDBKEY                          CDL006
     C                     MOVELWDBKEY    DBKEY            *************  CDL006
     C                     Z-ADD906       DBASE            * DBERR 906 *  CDL006
     C                     MOVEL'AOOUMMU0'DBPGM            *************  CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR SRERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If Commission tables in Base currency.                           CDL006
      *                                                                   CDL006
     C           BNCTBC    IFEQ 'Y'                                       CDL006
     C           HKCCY     ANDNEBJCYCD                                    CDL006
      *                                                                   CDL006
      ** Access SD Currency details to retrieve Spot rate, number of      CDL006
      ** decimal places and mult/div indicator for Deal currency          CDL006
      *                                                                   CDL006
     C                     CALL 'AOCURRR0'                                CDL006
     C                     PARM '*MSG    'WRTCD                           CDL006
     C                     PARM '*KEY    'WOPTN                           CDL006
     C                     PARM HKCCY     WCCY                            CDL006
     C           SDCURR    PARM SDCURR    DSSDY                           CDL006
      *                                                                   CDL006
      ** If Deal currency doesn't exist.                                  CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANK                                    CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL'SDCURRPD'DBFILE                          CDL006
     C                     MOVELHKCCY     DBKEY            *************  CDL006
     C                     Z-ADD907       DBASE            * DBERR 907 *  CDL006
     C                     MOVEL'AOOUMMU0'DBPGM            *************  CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR SRERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Save Deal currency Spot rate, Number of decimal places           CDL006
      ** and Multiply/divide indicator.                                   CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN A6SPRT    WUDCSR                          CDL006
     C           *LIKE     DEFN A6NBDP    WUDCDP                          CDL006
     C           *LIKE     DEFN A6MDIN    WUDCMD                          CDL006
     C                     Z-ADDA6SPRT    WUDCSR                          CDL006
     C                     Z-ADDA6NBDP    WUDCDP                          CDL006
     C                     MOVE A6MDIN    WUDCMD                          CDL006
      *                                                                   CDL006
      ** Convert the range limits amounts from Base currency to           CDL006
      ** Deal currency.                                                   CDL006
      *                                                                   CDL006
     C                     EXSR SRLCVT                                    CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C1
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
     C                     Z-ADDHKVDYY    ZWYYYY           ¦
     C                     Z-ADDHKVDMM    ZWMTH            ¦ value date
     C                     Z-ADDHKVDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *                                                                   CDL006
      ** Save value date to be use in commission computation in sub       CDL006
      ** routine SRCOMC                                                   CDL006
      *                                                                   CDL006
     C                     Z-ADD##VDAT    WVDAT   50                      CDL006
     C*                                                                   CEU003
     C                     Z-ADDHKDTYY    ZWYYYY                          CEU003
     C                     Z-ADDHKDTMM    ZWMTH                           CEU003
     C                     Z-ADDHKDTDD    ZWDAY                           CEU003
     C                     EXSR ZDAT10                                    CEU003
     C                     Z-ADDZZMDNO    WWORED                          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           #BRCID    ANDNE*BLANK                                    CEU003
     C           #ARCID    ANDNE*BLANK                                    CEU003
     C           WCHTP     ANDNE'D'                                       CEU003
     C           WLACT     ANDNE'D'                                       154863
     C           BJRDNB    ANDGT##VDAT                                    CEU003
     C           BJRDNB    ANDNEWWORED                                    CEU003
     C                     ELSE                                           CEU003
      *
     C                     Z-ADD##PCPL    ##AMT            * deal principal
      *                                                                   CDL006
      ** If dealing fiduciary is installed.                               CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If charge due on Fiduciary Call or Time deposits.                CDL006
      *                                                                   CDL006
     C           BNCHTK    IFEQ 'Y'                                       CDL006
     C           HKFCGC    ANDNE*BLANKS                                   CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
     C           HKTYPE    OREQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
     C                     ADD  HKFCGA    ##AMT                           CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C2
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     MOVEL##MLPD    ##MLAD                                              CDL018
     C                     MOVE HKPMAC    ##MLAC  1                                           CDL018
     C                     ELSE
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     MOVEL##MLRD    ##MLAD                                              CDL018
     C                     MOVE HKRMAC    ##MLAC  1                                           CDL018
     C                     END
     C                     MOVELHKSTCY    ##STCY  3                       CEU003
      *
     C                     Z-ADD001       ##RPNB  30       * 1=value date
     C                     MOVEL##NAR,1   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'S'       ##MTYP  1                                           CAP205
     C                     ENDIF                                                              CAP205
     C********** ##TRYP    IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE ##ORBR    IPFRBB                                  BUG12795 BUG12795A
     C**********           MOVE INTERB    ##NARR                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
      *                                                                                       CDL018
      **  Multiple account details exist                                                      CDL018
     C           CDL018    IFEQ 'Y'                                                           CDL018
     C           ##MLAC    ANDEQ'Y'                                                           CDL018
     C                     MOVE 'P'       ##PIID  1                                           CDL018
     C                     EXSR SRMLAD                                                        CDL018
     C                     ELSE                                                               CDL018
     C                     EXSR SRMOVE
     C                     ENDIF                                                              CDL018
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *
     C******               EXSR SRMOVE                                                        BG2922
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      ** Generate INTEREST PAYMENT DATE account movement
      ** ===============================================
      *
     C                     MOVE *BLANK    MATINT  1                                        AR1063117
     C                     MOVE HKSLYY    W#SLYY                                              237472
     C                     MOVE HKSLMM    W#SLMM                                              237472
     C                     MOVE HKSLDD    W#SLDD                                              237472
     C                     MOVE HKVDYY    W#VDYY                                              237472
     C                     MOVE HKVDMM    W#VDMM                                              237472
     C                     MOVE HKVDDD    W#VDDD                                              237472
      *                                                                                       237472
      **(if*interest*not*capitalized)**********************************                      260517B
     C********** HKCPTI    IFNE 'Y'                                                          260517B
      **(and*not*Front-Up*interest)************************************               106780 260517B
     C********** HKFUID    ANDNE'Y'                                                   106780 260517B
     C           HKFUID    IFNE 'Y'                                                          260517B
     C/COPY WNCPYSRC,AOOUMMU0M5
     C           WLACT     IFEQ 'D'                                                           237472
     C           W#SLID    ANDNEW#VDAT                                                        237472
     C                     Z-ADDHKSLYY    ZWYYYY                                              237472
     C                     Z-ADDHKSLMM    ZWMTH                                               237472
     C                     Z-ADDHKSLDD    ZWDAY                                               237472
     C                     EXSR ZDAT10                                                        237472
     C                     Z-ADDZZDTIN    ##VYMD                                              237472
     C                     Z-ADDZZMDNO    ##VDAT                                              237472
     C                     ELSE                                                               237472
     C                     Z-ADDHKNIYY    ZWYYYY           ¦
     C                     Z-ADDHKNIMM    ZWMTH            ¦ next int date
     C                     Z-ADDHKNIDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
     C                     ENDIF                                                              237472
     C                     MOVE 'I'       ##MIID  1          Mat/Int ind.                     CDL018
      *
      ** If Early maturity deal amendment and not omitting this deal amendment                249910
     C           HNMTYP    IFEQ 'EM'                                                          249910
     C           $$VDSN    ANDEQ0                                                             249910
     C********** HNINTR    IFNE *ZEROS                                            MD021458 MD022399B
     C**********           Z-ADDHNINTR    ##INTR                                  MD021458 MD022399B
     C**********           ENDIF                                                  MD021458 MD022399B
      *                                                                                       249910
      ** If next interest date is zero or greater than early maturity date, use early         249910
      ** maturity date from MMDEAMPP.                                                         249910
     C           ##VDAT    IFEQ *ZERO                                                         249910
     C           ##VDAT    ORGT HNEMDT                                                        249910
     C                     Z-ADDHNEMDT    ##VDAT                                              249910
     C                     Z-ADDHNEMDT    @@DAYN  50                                          249910
     C                     EXSR ZDATE9                                                        249910
     C                     Z-ADD@@VDT     ##VYMD                                              249910
     C**********           END                                                      249910 AR1063117
      *                                                                                       249910
     C                     Z-ADD##VDAT    WMDAT   50                                          249910
     C                     MOVE 'M'       ##MIID  1          Mat/Int ind.                     249910
      *                                                                                    AR1063117
     C                     ELSE                                                            AR1063117
     C                     MOVE 'Y'       MATINT                                           AR1063117
     C                     ENDIF                                                           AR1063117
      *                                                                                       249910
     C                     ELSE                                                               249910
      *                                                                                       249910
      ** If no date present use maturity date (which may be zero if call)
      *
     C**********           MOVE ' '       MATINT  1                                 247555 AR1063117
      *                                                                                       247555
     C           ##VDAT    IFEQ *ZERO
      *
     C                     Z-ADDHKMDYY    ZWYYYY           ¦
     C                     Z-ADDHKMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHKMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *                                                                   CDL006
      ** Save maturity date to be use in commission computation in sub    CDL006
      ** routine SRCOMC                                                   CDL006
      *                                                                   CDL006
     C                     Z-ADD##VDAT    WMDAT   50                      CDL006
     C                     MOVE 'M'       ##MIID  1          Mat/Int ind.                     CDL018
     C                     ELSE                                                               247555
     C                     MOVE 'Y'       MATINT  1                                           247555
     C                     END
      *                                                                                       249910
     C                     ENDIF                           EndIF HNMTYP = 'EM'                249910
      *
     C/COPY WNCPYSRC,AOOUMMU0M6
      *                                                                                     MD025410
      ** On amend, do not process accrual interest                                          MD025410
      ** for Int. Cap. Indicator ='Y' and not maturity interest                             MD025410
      *                                                                                     MD025410
     C********** #BRCID    IFNE ' '                                                MD025410 MD047607
     C********** BJRDNB    ANDNEWWORED                                             MD025410 MD047607
     C********** HKCPTI    ANDEQ'Y'                                                MD025410 MD047607
     C           HKCPTI    IFEQ 'Y'                                                         MD047607
     C           ##MIID    ANDNE'M'                                                         MD025410
     C                     Z-ADD0         ##VDAT                                            MD025410
     C                     ENDIF                                                            MD025410
      *                                                                                     MD025410
      ** If next interest payment date present
      *
     C           ##VDAT    IFNE *ZERO
      *
      ** Determine interest due at next interest payment date
      ** (this will be put into field ##INTD)
      *
     C                     EXSR SRDCPI
      *
     C           WLACT     IFEQ 'D'                                                           237472
     C           ##IPRD    ANDNE0                                                             237472
     C                     Z-ADD##IPRD    ##AMT                                               237472
     C                     ELSE                                                               237472
     C                     Z-ADD##INTD    ##AMT
      *                                                                                       247555
     C           MATINT    IFEQ 'Y'                                                           247555
     C                     Z-ADD##INTD    WKINT  150                                          247555
     C                     ENDIF                                                              247555
      *                                                                                       247555
     C                     ENDIF                                                              237472
      *                                                                                       220013
      ** Validate for need to calculate tax                                                   220013
      *                                                                                       220013
     C                     Z-ADD0         TAXA                                                220013
     C           HKMTAX    IFEQ 'Y'                                                           220013
     C           ##LOD     ANDEQ'D'                                                           220013
      *                                                                                       220013
     C                     Z-ADD##INTD    WINTD  150                                          220013
     C/COPY WNCPYSRC,AOH00067
      *                                                                                       220013
     C           S01383    IFEQ 'Y'                                                           220013
      *                                                                                       220013
     C                     Z-ADD##VDAT    WKMDAT  50                                          220013
     C                     EXSR CALTAX                                                        220013
      *                                                                                       220013
     C                     ELSE                                                               220013
      *                                                                                       220013
      * If Dual Withholding Tax feature is ON                                                 CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
      *                                                                                       CGL165
     C                     Z-ADD0         TAXA                                                CGL165
     C                     Z-ADDWINTD     PINTA                                               CGL165
     C                     CALL 'GL024000'                                                    CGL165
     C                     PARM           PRCOD1  1                                           CGL165
     C                     PARM 'AOOUMM'  PCPGM   6                                           CGL165
     C                     PARM *BLANKS   PBRCA   3                                           CGL165
     C                     PARM *BLANKS   PCNUM1  6                                           CGL165
     C                     PARM *BLANKS   PACNO  10                                           CGL165
     C                     PARM CCY       PCCY    3                                           CGL165
     C                     PARM           PINTA  150                                          CGL165
     C                     PARM HKTAX1    PTXC1   2                                           CGL165
     C                     PARM HKTAX2    PTXC2   2                                           CGL165
     C                     PARM *ZEROS    PCPDT   50                                          CGL165
     C                     PARM *ZEROS    PVDAT   50                                          CGL165
     C                     PARM *ZEROS    PMDAT   50                                          CGL165
     C                     PARM *ZEROS    PINTR  117                                          CGL165
     C                     PARM *BLANKS   PDTYP   2                                           CGL165
     C                     PARM *ZEROS    PPCPL  150                                          CGL165
     C                     PARM *BLANKS   PACOD  10                                           CGL165
     C                     PARM *ZEROS    PACSQ   20                                          CGL165
     C                     PARM           PWTXA  150                                          CGL165
     C                     PARM           PSTXA  150                                          CGL165
      *                                                                                       CGL165
     C           PWTXA     ADD  PSTXA     TAXA                                                CGL165
      *                                                                                       CGL165
     C                     ELSE                                                               CGL165
     C           WINTD     MULT BNHKTR    TAXA   130H                                         220013
     C           TAXA      DIV  100       TAXA      H                                         220013
     C                     ENDIF                                                              CGL165
      *                                                                                       220013
     C                     END                                                                220013
      *                                                                                     MD023265
     C                     ELSE                                                             MD023265
     C           CDL013    IFEQ 'Y'                                                         MD023265
     C           ##LOD     ANDEQ'D'                                                         MD023776
     C           HKMTAX    ANDNE'Y'                                                         MD023265
     C           HKMTAX    ANDNE'N'                                                         MD023265
     C           HKMTAX    ANDNE*BLANKS                                                     MD023265
      *                                                                                     MD023265
     C                     Z-ADD##INTD    WINTD  150                                        MD023265
      *                                                                                     MD023265
     C                     EXSR CALWTX                                                      MD023265
     C                     ENDIF                                                            MD023265
     C/COPY WNCPYSRC,AOH00069
     C                     END                                                                220013
      *                                                                                    MD031062A
     C           CGL031    IFEQ 'Y'                                                        MD031062A
     C           DTYP      IFEQ 'CD'                                                       MD031062A
     C           DTYP      OREQ 'TD'                                                       MD031062A
     C           DTYP      OREQ 'DT'                                                       MD031062A
     C           CDL006    ANDEQ'Y'                                                        MD031062A
     C           DTYP      OREQ 'FT'                                                       MD031062A
     C           CDL006    ANDEQ'Y'                                                        MD031062A
      *                                                                                    MD031062A
     C           VDAT      IFGE BJRDNB                                                     MD031062A
     C           NOTD      IFEQ 0                                                          MD031062A
     C           VDAT      ADD  1         WKMDAT  50                                       MD031062A
     C                     ELSE                                                            MD031062A
     C           NOTD      ADD  VDAT      WKMDAT                                           MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           VDAT      IFLT BJRDNB                                                     MD031062A
     C           NOTD      IFEQ 0                                                          MD031062A
     C           BJRDNB    ADD  1         WKMDAT                                           MD031062A
     C                     ELSE                                                            MD031062A
     C           NOTD      ADD  BJRDNB    WKMDAT                                           MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Else, Fixed Term Deposits                                                         MD031062A
      *                                                                                    MD031062A
     C           DTYP      IFEQ 'TD'                                                       MD031062A
     C                     Z-ADDMDAT      WKMDAT                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     Z-ADD##VDAT    WKMDAT  50                                       MD031062A
     C                     EXSR SRCHKD                                                     MD031062A
      *                                                                                    MD031062A
     C           WSKIP     IFEQ 'N'                                                        MD031062A
     C                     Z-ADD##INTD    WINTD  150                                       MD031062A
     C                     EXSR SRCEUT                                                     MD031062A
     C                     ELSE                                                            MD031062A
     C                     Z-ADD*ZEROS    TAXA                                             MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                   CDL006
      ** If dealing fiduciary is installed.                               CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If commission due on Fiduciary Call or Time deposits.            CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKFCMC    ANDNE*BLANKS                                   CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
     C           HKTYPE    OREQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Initialize Commission and Tax on commission used to              CDL006
      ** calculate Net amount to be settled.                              CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN HKFCMA    WUCOAM                          CDL006
     C                     Z-ADD0         WUCOAM                          CDL006
      *                                                                   CDL006
      ** Calculate Commission amount due.                                 CDL006
      **                                                                  CDL006
      **     Amount                                                       CDL006
      ** (------------) x (Part period) x ¢(% current range)!             CDL006
      **  Full period                                                     CDL006
      **                                                                  CDL006
      **                 + Accrued commission to control date             CDL006
      **                 - Commission paid/received to date.              CDL006
      **                                                                  CDL006
      **  Amount      = Principal  if Call deposit                        CDL006
      **                Commission if Time deposit.                       CDL006
      **  Full period = number of days in a year if Call deposit          CDL006
      **                (Maturity date - Value date) if Time deposit.     CDL006
      **  Part period = next interest payment date - Interest accrual     CDL006
      **                                             control date.        CDL006
      **  (% current range) only used if Call deposit.                    CDL006
      *                                                                   CDL006
     C           WIACD     IFNE 0                                         CDL006
     C                     Z-ADDWIACD     WUDBEG                          CDL006
     C                     MOVE *ZEROS    WIACD                           CDL006
     C                     ELSE                                           CDL006
     C                     Z-ADD##IACD    WUDBEG                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If Fixed term deposit, use WUSVCD (Interest accrual control      CDL006
      ** date from Deal file record) for Commission calculation           CDL006
      ** because Amount (=Total commission) hasn't been changed.          CDL006
      *                                                                   CDL006
     C           ##TRYP    IFEQ 'FT'                                      CDL006
     C                     Z-ADDWUSVCD    WUDBEG                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     Z-ADD##VDAT    WUDEND                          CDL006
     C                     EXSR SRCOMC                                    CDL006
     C           WUACSC    ADD  FACTC     WUCOAM                          CDL006
     C                     SUB  FACPD     WUCOAM                          CDL006
      *                                                                   CDL006
      ** Net amount = Interest amount - Commission                        CDL006
      *                                                                   CDL006
     C           WLACT     IFEQ 'D'                                                           237472
     C           FCPRD     ANDNE0                                                             237472
     C                     SUB  FCPRD     ##AMT                                               237472
     C                     ELSE                                                               237472
     C                     SUB  WUCOAM    ##AMT                           CDL006
     C                     ENDIF                                                              237472
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C3
      *
      ** If interest is paid separately set up interest instructions
      *
     C           HKIPDS    IFEQ 'Y'
     C           HKIMET    ANDNE' '                                                          BUG5514
     C           HKIMET    ANDNE'00'                                                        MD023265
     C           ##LOD     IFEQ 'L'
     C                     MOVE 'R'       ##INPR           * Receive for loan
     C                     ELSE
     C                     MOVE 'P'       ##INPR           * Pay for deposit
     C                     END
     C                     MOVE HKIMET    ##INTM
      *                                                                   124927
     C           ##INTM    IFEQ '04'                                      124927
     C                     CALL 'AORETLR0'                                124927
     C                     PARM '*DBERR ' @RTCD   7                       124927
     C                     PARM '*FIRST ' @OPTN   7                       124927
     C           SDRETL    PARM SDRETL    DSFDY                           124927
      *                                                                   124927
     C                     MOVELHKCNUM    @@ACNT                          124927
     C**********           MOVE BMACCD    @@ACNT 10                                    124927 CGL029
     C                     MOVE BMACCD    @@ACNT 16                                           CGL029
     C                     MOVEL@@ACNT    ##INTA                          124927
     C                     MOVE HKACSQ    ##INTA                          124927
     C                     MOVE *BLANKS   ##INTB                          124927
     C                     ELSE                                           124927
     C                     MOVELHKINSA    ##INTA           * settle A/C
     C                     MOVE HKINSA    ##INTB           * settle branch
     C                     END                                            124927
      *                                                                   124927
     C           ##INTB    IFEQ *BLANKS
     C           ##INPR    IFEQ 'R'
     C                     MOVELHKROBR    ##INTB           * rec branch
     C                     ELSE
     C                     MOVELHKPOBR    ##INTB           * pay branch
     C                     END
     C                     END
     C                     MOVEL##INTS    ##SETD           Separate interest
     C                     MOVELHKISCY    ##STCY                          CEU003
      *
     C                     ELSE                            ** HKIPDS
      *
      ** If interest is not paid separately use maturity details
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     MOVEL##MLRD    ##MLAD                                              CDL018
     C                     MOVE HKRMAC    ##MLAC  1                                           CDL018
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     MOVEL##MLPD    ##MLAD                                              CDL018
     C                     MOVE HKPMAC    ##MLAC  1                                           CDL018
     C                     END
     C                     MOVELHKSTCY    ##STCY                          CEU003
      *
     C                     END                             ** HKIPDS
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
      *
      **  Multiple account details exist                                                      CDL018
     C           CDL018    IFEQ 'Y'                                                           CDL018
     C           ##MLAC    ANDEQ'Y'                                                           CDL018
     C                     MOVE 'I'       ##PIID  1                                           CDL018
     C                     EXSR SRMLAD                                                        CDL018
     C                     ELSE                                                               CDL018
      *
     C                     EXSR SRMOVE
     C                     ENDIF                                                              CDL018
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       220013
     C           TAXA      IFNE 0                                                             220013
      *                                                                                       220013
     C**********           Z-ADDTAXA      ##AMT                                      220013 MD023265
     C                     Z-SUBTAXA      ##AMT                                             MD023265
      *                                                                                       220013
     C           HKIPDS    IFEQ 'Y'                                                           220013
     C           HKIMET    ANDNE'00'                                                        MD023265
     C           HKIMET    ANDNE*BLANKS                                                     MD023265
      *                                                                                       220013
     C           ##LOD     IFEQ 'D'                                                           220013
     C**********           MOVE 'R'       ##INPR                                     220013 MD023265
     C                     MOVE 'P'       ##INPR                                            MD023265
     C                     ELSE                                                               220013
     C                     MOVE *BLANKS   ##INPR                                              220013
     C                     END                                                                220013
      *                                                                                       220013
     C                     MOVE HKIMET    ##INTM                                              220013
      *                                                                                       220013
     C           ##INTM    IFEQ '04'                                                          220013
     C                     CALL 'AORETLR0'                                                    220013
     C                     PARM '*DBERR ' @RTCD   7                                           220013
     C                     PARM '*FIRST ' @OPTN   7                                           220013
     C           SDRETL    PARM SDRETL    DSFDY                                               220013
      *                                                                                       220013
     C                     MOVELHKCNUM    @@ACNT                                              220013
     C                     MOVE BMACCD    @@ACNT                                              220013
     C                     MOVEL@@ACNT    ##INTA                                              220013
     C                     MOVE HKACSQ    ##INTA                                              220013
     C                     MOVE *BLANKS   ##INTB                                              220013
     C                     ELSE                                                               220013
     C                     MOVELHKINSA    ##INTA           * settle A/C                       220013
     C                     MOVE HKINSA    ##INTB           * settle branch                    220013
     C                     END                                                                220013
      *                                                                                       220013
     C           ##INTB    IFEQ *BLANKS                                                       220013
     C********** ##INPR    IFEQ 'R'                                                  220013 MD023265
     C           ##INPR    IFEQ 'P'                                                         MD023265
     C                     MOVELHKROBR    ##INTB           * rec branch                       220013
     C                     END                                                                220013
     C                     END                                                                220013
      *                                                                                       220013
     C                     MOVEL##INTS    ##SETD           Separate interest                  220013
     C                     MOVELHKISCY    ##STCY                                              220013
      *                                                                                       220013
     C                     ELSE                            ** HKIPDS                          220013
      *                                                                                       220013
      ** If interest is not paid separately use maturity details                              220013
      ** Pass movement to write program (with appropriate instructions)                       220013
      *                                                                                       220013
     C           ##LOD     IFEQ 'D'                                                           220013
     C**********           MOVEL##RECD    ##SETD           * Rec details             220013 MD023265
     C                     MOVE 'P'       ##PYRC                                            MD023265
     C                     ELSE                                                               220013
     C                     MOVE *BLANKS   ##SETD           * Pay details                      220013
     C                     END                                                                220013
     C                     MOVELHKSTCY    ##STCY                                              220013
      *                                                                                       220013
     C                     END                             ** HKIPDS                          220013
      *                                                                                       220013
     C                     Z-ADD004       ##RPNB           * 2 = int. date                    220013
     C                     MOVEL##NAR,4   ##NARR                                              220013
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       220013
      * If Dual Withholding Tax feature On, generate movement first                           CGL165
      * for the Main tax                                                                      CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-SUBPWTXA     ##AMT                                               CGL165
     C                     ENDIF                                                              CGL165
      **  Multiple account details exist                                                      220013
     C           CDL018    IFEQ 'Y'                                                           220013
     C           ##MLAC    ANDEQ'Y'                                                           220013
     C                     MOVE 'I'       ##PIID  1                                           220013
     C                     EXSR SRMLAD                                                        220013
     C                     ELSE                                                               220013
     C                     EXSR SRMOVE                                                        220013
     C                     END                                                                220013
      *                                                                                       220013
      * If Dual Withholding Tax feature On, generate movement                                 CGL165
      * for the Secondary Tax                                                                 CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           PSTXA     ANDNE0                                                             CGL165
     C                     Z-SUBPSTXA     ##AMT                                               CGL165
     C           CDL018    IFEQ 'Y'                                                           CGL165
     C           ##MLAC    ANDEQ'Y'                                                           CGL165
     C                     MOVE 'I'       ##PIID  1                                           CGL165
     C                     EXSR SRMLAD                                                        CGL165
     C                     ELSE                                                               CGL165
     C                     EXSR SRMOVE                                                        CGL165
     C                     END                                                                CGL165
     C                     ENDIF                                                              CGL165
      *
     C                     END
      *
     C/COPY WNCPYSRC,AOOUMMU0M7
     C                     END                             ** ##VDAT
     C                     END                             ** HKCPTI
      *
      ** Generate MATURITY DATE account movement
      ** =======================================
      *
      ** If Early maturity deal amendment, use the Early maturity date from MMDEAMPP.         249910
     C           HNMTYP    IFEQ 'EM'                                                          249910
     C           $$VDSN    ANDEQ0                                                             249910
     C                     Z-ADDHNEMDT    ##VDAT                                              249910
     C                     Z-ADDHNEMDT    @@DAYN  50                                          249910
     C                     EXSR ZDATE9                                                        249910
     C                     Z-ADD@@VDT     ##VYMD                                              249910
     C           HNINTR    IFNE *ZEROS                                                      MD021458
     C                     Z-ADDHNINTR    ##INTR                                            MD021458
     C                     ENDIF                                                            MD021458
     C                     ELSE                                                               249910
      *                                                                                       249910
     C                     Z-ADDHKMDYY    ZWYYYY           ¦
     C                     Z-ADDHKMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHKMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
     C                     ENDIF                           EndIF HNMTYP = 'EM'                249910
      *                                                                   CDL006
      ** Save maturity date to be use in commission computation in sub    CDL006
      ** routine SRCOMC                                                   CDL006
      *                                                                   CDL006
     C                     Z-ADD##VDAT    WMDAT                           CDL006
      *
      ** If date present (ie not call)
      *
     C           ##VDAT    IFNE *ZERO
     C/COPY WNCPYSRC,AOOUMMU0N8
      *                                                                                       CDL033
      ** For CF deals, post the current principal as there                                    CDL033
      ** will be no changes to this amount anyway.                                            CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           HKMTYP    ANDEQ'CF'                                                          CDL033
      *                                                                                       CDL033
     C                     Z-ADD##PCPL    ##AMT                                               CDL033
      *                                                                                       CDL033
     C                     ELSE                                                               CDL033
      *
      ** Determine expected principal at maturity date
      ** (this will be put into field ##LPCP)
      *
     C                     EXSR SRDCPI
      *                                                                                       247555
     C           MATINT    IFEQ 'Y'                                                           247555
      *                                                                                       247555
     C                     Z-ADD0         ##AMT                                               247555
     C********** ZDLOUT    SUB  WKINT     ##AMT                                     247555 AR1063117
     C           ##INTD    SUB  WKINT     ##AMT                                            AR1063117
     C           *LIKE     DEFN ##AMT     #MTINT                                            MD023265
     C                     Z-ADD##AMT     #MTINT                                            MD023265
      *                                                                                       247555
     C           HKIPDS    IFEQ 'Y'                                                           247555
     C           HKIMET    ANDNE' '                                                           247555
     C           HKIMET    ANDNE'00'                                                        MD023265
     C           ##LOD     IFEQ 'L'                                                           247555
     C                     MOVE 'R'       ##INPR           * Receive for loan                 247555
     C                     ELSE                                                               247555
     C                     MOVE 'P'       ##INPR           * Pay for deposit                  247555
     C                     END                                                                247555
     C                     MOVE HKIMET    ##INTM                                              247555
      *                                                                                       247555
     C           ##INTM    IFEQ '04'                                                          247555
     C                     CALL 'AORETLR0'                                                    247555
     C                     PARM '*DBERR ' @RTCD   7                                           247555
     C                     PARM '*FIRST ' @OPTN   7                                           247555
     C           SDRETL    PARM SDRETL    DSFDY                                               247555
      *                                                                                       247555
     C                     MOVELHKCNUM    @@ACNT                                              247555
     C                     MOVE BMACCD    @@ACNT 16                                           247555
     C                     MOVEL@@ACNT    ##INTA                                              247555
     C                     MOVE HKACSQ    ##INTA                                              247555
     C                     MOVE *BLANKS   ##INTB                                              247555
     C                     ELSE                                                               247555
     C                     MOVELHKINSA    ##INTA           * settle A/C                       247555
     C                     MOVE HKINSA    ##INTB           * settle branch                    247555
     C                     END                                                                247555
      *                                                                                       247555
     C           ##INTB    IFEQ *BLANKS                                                       247555
     C           ##INPR    IFEQ 'R'                                                           247555
     C                     MOVELHKROBR    ##INTB           * rec branch                       247555
     C                     ELSE                                                               247555
     C                     MOVELHKPOBR    ##INTB           * pay branch                       247555
     C                     END                                                                247555
     C                     END                                                                247555
     C                     MOVEL##INTS    ##SETD           Separate interest                  247555
     C                     MOVELHKISCY    ##STCY                                              247555
      *                                                                                       247555
     C                     ELSE                            ** HKIPDS                          247555
      *                                                                                       247555
      ** If interest is not paid separately use maturity details                              247555
      ** Pass movement to write program (with appropriate instructions)                       247555
      *                                                                                       247555
     C           ##LOD     IFEQ 'L'                                                           247555
     C                     MOVEL##RECD    ##SETD           * Rec details                      247555
     C                     MOVEL##MLRD    ##MLAD                                              247555
     C                     MOVE HKRMAC    ##MLAC  1                                           247555
     C                     ELSE                                                               247555
     C                     MOVEL##PAYD    ##SETD           * Pay details                      247555
     C                     MOVEL##MLPD    ##MLAD                                              247555
     C                     MOVE HKPMAC    ##MLAC  1                                           247555
     C                     END                                                                247555
     C                     MOVELHKSTCY    ##STCY                                              247555
      *                                                                                       247555
     C                     END                             ** HKIPDS                          247555
      *                                                                                       247555
     C                     Z-ADD002       ##RPNB           * 2 = int. date                    247555
     C                     MOVEL##NAR,2   ##NARR                                              247555
      *                                                                                     MD023401
      **  Multiple account details exist                                                    MD023401
      *                                                                                     MD023401
     C           CDL018    IFEQ 'Y'                                                         MD023401
     C           ##MLAC    ANDEQ'Y'                                                         MD023401
     C                     MOVE 'I'       ##PIID  1                                         MD023401
     C                     EXSR SRMLAD                                                      MD023401
     C                     ELSE                                                             MD023401
     C                     EXSR SRMOVE                                                        247555
     C                     ENDIF                                                            MD023401
      *                                                                                     MD023401
     C                     EXSR CALTXM                                                      MD023401
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       247555
     C                     END                                                                247555
      *
     C                     Z-ADD##LPCP    ##AMT
     C/COPY WNCPYSRC,AOOUMMU0N9
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *                                                                   CDL006
      ** If dealing fiduciary is installed.                               CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If commission due on Fiduciary Call or Time deposits.            CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKFCMC    ANDNE*BLANKS                                   CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
     C           HKTYPE    OREQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Initialize Commission  on commission used to                     CDL006
      ** calculate Net amount to be settled.                              CDL006
      *                                                                   CDL006
     C                     Z-ADD0         WUCOAM                          CDL006
      *                                                                   CDL006
      ** Calculate Commission amount due.                                 CDL006
      **                                                                  CDL006
      ** If Call deposits.                                                CDL006
      *                                                                   CDL006
     C           HKTYPE    IFEQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      **   Principal                                                      CDL006
      ** (------------) x (Part period) x (% current range)               CDL006
      **  Full period                                                     CDL006
      **                                                                  CDL006
      **                + Accrued commission to control date              CDL006
      **                - Commission paid/received to date.               CDL006
      **                                                                  CDL006
      ** Full period = number of days in a year                           CDL006
      ** Part period = Maturity date - Interest accrual control date.     CDL006
      *                                                                   CDL006
     C           WIACD     IFNE 0                                         CDL006
     C                     Z-ADDWIACD     WUDBEG                          CDL006
     C                     MOVE *ZEROS    WIACD                           CDL006
     C                     ELSE                                           CDL006
     C                     Z-ADD##IACD    WUDBEG                          CDL006
     C                     ENDIF                                          CDL006
     C                     Z-ADD##VDAT    WUDEND                          CDL006
     C                     EXSR SRCOMC                                    CDL006
     C           WUACSC    ADD  FACTC     WUCOAM                          CDL006
     C                     SUB  FACPD     WUCOAM                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If Fixed term deposits.                                          CDL006
      *                                                                   CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
      *                                                                   CDL006
      ** Total commission due - Commission paid/received to date.         CDL006
      *                                                                   CDL006
     C           HKFCMA    SUB  FACPD     WUCOAM                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Net amount = Principal amount - Commission                       CDL006
      *                                                                   CDL006
     C                     SUB  WUCOAM    ##AMT                           CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C4
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     ELSE
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     END
     C                     MOVELHKSTCY    ##STCY                          CEU003
      *
     C                     Z-ADD003       ##RPNB           * 3 = maty date
     C                     MOVEL##NAR,3   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      **  Multiple account details exist                                                      CDL018
     C           CDL018    IFEQ 'Y'                                                           CDL018
     C           ##MLAC    ANDEQ'Y'                                                           CDL018
     C                     MOVE 'P'       ##PIID  1                                           CDL018
     C                     EXSR SRMLAD                                                        CDL018
     C                     ELSE                                                               CDL018
     C                     EXSR SRMOVE
     C                     ENDIF                                                              CDL018
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CDL018
     C                     END                             ** ##VDAT
      *................................................................
      *
     C           EXDELD    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRDENB                                         *
      * Function    :  NA Bought Processing                           *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRDENB    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDENB'  @STK,Q
      *
      *................................................................
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
     C                     MOVELHLMOPM    ##PAYM           * pay method
     C                     MOVELHLMOPI    ##PAYA           * pay account
     C                     MOVELHLPOBR    ##PAYB           * pay branch
     C                     MOVELHLORCM    ##RECM           * rec method
     C                     MOVELHLMORI    ##RECA           * rec account
     C                     MOVELHLROBR    ##RECB           * rec branch
     C                     MOVELHLSTCY    ##STCY                          CEU003
      *
      **  Store basic deal details
      *
     C                     Z-ADDHLDN38    ##DLNO           * deal number
     C                     MOVELHLCCY     ##CCY            * currency
     C                     Z-ADDHLAMNP    ##PCPL       99  * purch price
     C   99                Z-SUB##PCPL    ##PCPL
     C                     Z-ADDHLFVAL    ##FVAL 150   99  * face value
     C   99                Z-SUB##FVAL    ##FVAL
     C                     Z-ADDHLFRAT    ##INTR           * face rate
     C                     Z-ADDHLLIYY    ##IAYY           * int acc ctl yr
     C                     Z-ADDHLLIMM    ##IAMM           * int acc ctl mn
     C                     Z-ADDHLLIDD    ##IADD           * int acc ctl dy
     C                     MOVELHLICMT    ##ICBS           * int calc basis
     C                     MOVELHLMTYP    ##TRYP           * deal type
     C                     MOVELHLDN38    ##TRN            * transact no.
     C                     MOVELHLBRCA    ##BBRN           * booking branch
      *
      * Value date (YYYYMMDD) and sequence number on MMDEAMPP to be read to
      *
     C                     Z-ADD*ZERO     ##VDSN           * READ TO
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT           * event value dte
     C                     Z-ADD*ZERO     ##AMT            * amount
     C                     MOVEL*BLANK    ##NARR           * narrative
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
     C                     Z-ADDHLVDYY    ZWYYYY           ¦
     C                     Z-ADDHLVDMM    ZWMTH            ¦ value date
     C                     Z-ADDHLVDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
     C                     Z-ADDHLDTYY    ZWYYYY                          CEU003
     C                     Z-ADDHLDTMM    ZWMTH                           CEU003
     C                     Z-ADDHLDTDD    ZWDAY                           CEU003
     C                     EXSR ZDAT10                                    CEU003
     C                     Z-ADDZZMDNO    WWORED  50                      CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           #BRCID    ANDNE*BLANK                                    CEU003
     C           #ARCID    ANDNE*BLANK                                    CEU003
     C           WCHTP     ANDNE'D'                                       CEU003
     C           WLACT     ANDNE'D'                                       154863
     C           BJRDNB    ANDGT##VDAT                                    CEU003
     C           WWORED    ANDNEBJRDNB                                    CEU003
     C                     ELSE                                           CEU003
     C                     Z-ADD##PCPL    ##AMT            * purch price
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##PAYD    ##SETD           * Pay details
      *
     C                     Z-ADD001       ##RPNB           * 1=value date
     C                     MOVEL##NAR,1   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'S'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
     C*                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      ** Generate INTEREST PAYMENT DATE account movement
      ** ===============================================
      *
      ** Only interest bearing types ('C1' 'C2' 'BP' 'BD').
     C           ##INTR    IFNE *ZERO
     C                     Z-ADDHLNIYY    ZWYYYY           ¦
     C                     Z-ADDHLNIMM    ZWMTH            ¦ next int date
     C                     Z-ADDHLNIDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
      ** If no date present use maturity date
      *
     C           ##VDAT    IFEQ *ZERO
     C                     Z-ADDHLMDYY    ZWYYYY           ¦
     C                     Z-ADDHLMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHLMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
     C                     END
      *
      ** Determine interest due at next interest payment date
      ** (this will be put into field ##INTD)
      *
     C                     Z-ADD##FVAL    ##PCPL
     C                     EXSR SRDCPI
      *
     C                     Z-ADD##INTD    ##AMT
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##RECD    ##SETD           * Rec details
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
     C                     END                             *##INTR
      *
      ** Generate MATURITY DATE account movement
      ** =======================================
      *
     C                     Z-ADDHLMDYY    ZWYYYY           ¦
     C                     Z-ADDHLMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHLMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
     C                     Z-ADD##FVAL    ##AMT
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##RECD    ##SETD           * Rec details
      *
     C                     Z-ADD003       ##RPNB           * 3 = maty date
     C                     MOVEL##NAR,3   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *................................................................
      *
     C           EXDENB    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRDENS                                         *
      * Function    :  NA Sold Processing                             *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRDENS    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDENS'  @STK,Q
      *
      *................................................................
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
     C                     MOVELHMORCM    ##RECM           * rec method
     C                     MOVELHMMORI    ##RECA           * rec account
     C                     MOVELHMROBR    ##RECB           * rec branch
      *
      **  pay details for related purchase to adjust interest & maturity
     C                     MOVELHLORCM    ##PAYM           * pay method
     C                     MOVELHLMORI    ##PAYA           * pay account
     C                     MOVELHLROBR    ##PAYB           * pay branch
      **  Store basic deal details
      *
     C                     Z-ADDHMDN38    ##DLNO           * deal number
     C                     MOVELHMCCY     ##CCY            * currency
     C                     Z-ADDHMAMNP    ##PCPL       99  * sale price
     C   99                Z-SUB##PCPL    ##PCPL
     C                     Z-ADDHMFVAL    ##FVAL       99  * face value
     C   99                Z-SUB##FVAL    ##FVAL
     C                     Z-ADDHMFRAT    ##INTR           * face rate
     C                     Z-ADDHMLIYY    ##IAYY           * int acc ctl yr
     C                     Z-ADDHMLIMM    ##IAMM           * int acc ctl mn
     C                     Z-ADDHMLIDD    ##IADD           * int acc ctl dy
     C                     MOVELHMICMT    ##ICBS           * int calc basis
     C                     MOVELHMMTYP    ##TRYP           * deal type
     C                     MOVELHMDN38    ##TRN            * transact no.
     C                     MOVELHMBRCA    ##BBRN           * booking branch
      *
      * Value date (YYYYMMDD) and sequence number on MMDEAMPP to be read to
      *
     C                     Z-ADD*ZERO     ##VDSN           * READ TO
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT           * event value dte
     C                     Z-ADD*ZERO     ##AMT            * amount
     C                     MOVEL*BLANK    ##NARR           * narrative
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
     C                     Z-ADDHMVDYY    ZWYYYY           ¦
     C                     Z-ADDHMVDMM    ZWMTH            ¦ value date
     C                     Z-ADDHMVDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
     C                     Z-ADD##PCPL    ##AMT            * sale price
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     MOVELHMSTCY    ##STCY                          CEU003
      *
     C                     Z-ADD001       ##RPNB           * 1=value date
     C                     MOVEL##NAR,1   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'S'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *
      ** Generate INTEREST PAYMENT DATE account movement
      ** ===============================================
      *
      ** Only interest bearing types ('C1' 'C2' 'BP' 'BD').
     C           ##INTR    IFNE *ZERO
     C                     Z-ADDHMNIYY    ZWYYYY           ¦
     C                     Z-ADDHMNIMM    ZWMTH            ¦ next int date
     C                     Z-ADDHMNIDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
      ** If no date present use maturity date
      *
     C           ##VDAT    IFEQ *ZERO
     C                     Z-ADDHMMDYY    ZWYYYY           ¦
     C                     Z-ADDHMMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHMMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
     C                     END
      *
      ** Determine interest due at next interest payment date
      ** (this will be put into field ##INTD)
      *
     C                     Z-ADD##FVAL    ##PCPL
     C                     EXSR SRDCPI
      *
     C                     Z-ADD##INTD    ##AMT
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     MOVELHLSTCY    ##STCY                          CEU003
      *
     C                     Z-ADD002       ##RPNB           * 2 = int. date
     C                     MOVEL##NAR,2   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
     C                     END                             *##INTR
      *
      ** Generate MATURITY DATE account movement
      ** =======================================
      *
     C                     Z-ADDHMMDYY    ZWYYYY           ¦
     C                     Z-ADDHMMDMM    ZWMTH            ¦ maturity date
     C                     Z-ADDHMMDDD    ZWDAY            ¦
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
     C                     Z-ADD##FVAL    ##AMT
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     MOVELHLSTCY    ##STCY                          CEU003
      *
     C                     Z-ADD003       ##RPNB           * 3 = maty date
     C                     MOVEL##NAR,3   ##NARR
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *................................................................
      *
     C           EXDENS    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRDEAM                                         *
      * Function    :  Deal Amendment Processing                      *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRDEAM    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDEAM'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if deal amendment type involves no settlement
      *
     C           HNMTYP    CABEQ'SC'      EXDEAM
     C           HNMTYP    CABEQ'CI'      EXDEAM
     C           HNMTYP    CABEQ'BC'      EXDEAM                          BUG3045
      *                                                                   BUG3045
     C           HNMTYP    IFEQ 'EM'                                      BUG3045
     C           HNAMNP    ANDEQ0                                         BUG3045
     C                     GOTO EXDEAM                                    BUG3045
     C                     ENDIF
      *
      **  Determine whether associated deal is a loan or deposit
      *
     C                     Z-ADD1         #I
     C           HNOMDT    LOKUP##LDT,#I                 99*
     C   99                MOVEL'L'       ##LOD
     C  N99                MOVEL'D'       ##LOD
      *
      **  Store pay and receive settlement methods, accounts & branches
      *
     C                     MOVELHNMOPM    ##PAYM           * pay method
     C                     MOVELHNMOPI    ##PAYA           * pay account
     C                     MOVELHNOSBR    ##PAYB           * pay branch
     C                     MOVELHNORCM    ##RECM           * rec method
     C                     MOVELHNMORI    ##RECA           * rec account
     C                     MOVELHNOSBR    ##RECB           * rec branch
     C                     MOVELHNSTCY    ##STCY                          CEU003
      *
      **  Store basic deal amendment details
      *
     C                     Z-ADDHNDA38    ##DLNO           * deal number
     C                     MOVELHNCCY     ##CCY            * currency
     C                     Z-ADDHNAMNP    ##PCPL       99  * deal amd princl
     C   99                Z-SUB##PCPL    ##PCPL
     C                     MOVELHNMTYP    ##TRYP           * deal amend type
     C                     MOVELHNDA38    ##TRN            * transact no.
     C                     MOVELHNBRCA    ##BBRN           * booking branch
      *
      **  Initialize work fields
      *
     C                     Z-ADD*ZERO     ##VDAT           * event value dte
     C                     Z-ADD*ZERO     ##AMT            * amount
     C                     MOVEL*BLANK    ##NARR           * narrative
      *
      ** Generate VALUE DATE account movement
      ** ====================================
      *
     C                     Z-ADDHNVDYY    ZWYYYY           ¦
     C                     Z-ADDHNVDMM    ZWMTH            ¦ value date of
     C                     Z-ADDHNVDDD    ZWDAY            ¦ deal amend
     C                     EXSR ZDAT10
     C                     Z-ADDZZDTIN    ##VYMD             YYYY/MM/DD
     C                     Z-ADDZZMDNO    ##VDAT             Midas day no.
      *
     C                     Z-ADD##PCPL    ##AMT            * deal amd princl
      *                                                                   CDL006
      ** If CDL006 installed.                                             CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Charges on Principal Changes for Fiduciary Call deposits.     CDL006
      *                                                                   CDL006
     C           BNCHPC    IFEQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'DT'                                      CDL006
     C           BNCHPC    OREQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'LT'                                      CDL006
      *                                                                   CDL006
      ** If Principal increase or Principal decrease.                     CDL006
      *                                                                   CDL006
     C           ##TRYP    IFEQ 'PI'                                      CDL006
     C           ##TRYP    OREQ 'PD'                                      CDL006
      *                                                                   CDL006
      ** If charge due on the amendment.                                  CDL006
      *                                                                   CDL006
     C           HKFCGC    IFNE *BLANKS                                   CDL006
      *                                                                   CDL006
      ** If Principal increase.                                           CDL006
      *                                                                   CDL006
     C           ##TRYP    IFEQ 'PI'                                      CDL006
      *                                                                   CDL006
      ** Net amount = Deal amendment amount + charge                      CDL006
      *                                                                   CDL006
     C                     ADD  FXGA      ##AMT                           CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If Principal decrease.                                           CDL006
      *                                                                   CDL006
     C           ##TRYP    IFEQ 'PD'                                      CDL006
      *                                                                   CDL006
      ** Net amount = Deal amendment amount - charge                      CDL006
      *                                                                   CDL006
     C                     SUB  FXGA      ##AMT                           CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C5
      *                                                                   101523
      ** For deal amendment type 'SI', check if Negative Int. ind.=Y      101523
      *                                                                   101523
     C                     MOVE *OFF      *IN31                           101523
     C           ##TRYP    IFEQ 'SI'                                      101523
     C           ##DLNO    CHAINDEALSDCF             99                   101523
     C           *IN99     IFEQ *OFF                                      101523
     C           INTR      ANDLT0                                                           MD031115
     C                     Z-SUB##AMT     ##AMT                                             MD031115
     C**********           TESTB'1'       DSTI           31                          101523 MD031115
     C                     ENDIF                                          101523
     C/COPY WNCPYSRC,AOOUMMU0K9
     C                     ENDIF                                          101523
      *
      ** Pass movement to write program (with appropriate instructions)
      *
     C           ##LOD     IFEQ 'L'                        * loan
     C           ##TRYP    ANDEQ'PI'                       * + princl inc.
     C           ##LOD     OREQ 'D'                        * deposit
     C           ##TRYP    ANDEQ'PD'                       * + princl dec.
     C           ##LOD     OREQ 'D'                        * deposit
     C           ##TRYP    ANDEQ'SI'                       * + settle int.
     C********** *IN31     ANDEQ'0'                        * + Non-neg               101523 MD031115
     C           HNPENP    OREQ 'P'                        * pay penalty  BUG3045
     C           ##TRYP    ANDEQ'EM'                       * + Early mat. BUG3045
     C                     MOVEL##PAYD    ##SETD           * Pay details
     C                     ELSE
     C                     MOVEL##RECD    ##SETD           * Rec details
     C                     END
      *
     C                     Z-ADD001       ##RPNB           * 1=value date
     C                     MOVEL##NAR,1   ##NARR
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C           ##TRYP    IFEQ 'PI'                                                          CAP205
     C           ##TRYP    OREQ 'PD'                                                          CAP205
     C                     MOVE 'S'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C           ##TRYP    IFEQ 'SI'                                                          CAP205
     C           ##TRYP    OREQ 'EM'                                                          CAP205
     C                     MOVE 'F'       ##MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *
     C                     EXSR SRMOVE
      *                                                                                       CER049
      ** Call AOSPOSU0 when CER049 is ON                                                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           ##AMT     ANDNE*ZEROS                                                        CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *................................................................
      *
     C           EXDEAM    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRMOVE                                         *
      * Function    :  Pass Movement To Write Program                 *
      *                                                               *
      * Called by   :  Various                                        *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRMOVE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRMOVE'  @STK,Q
      *
      *................................................................
      *
      ** Bypass if no amount to post
      *
     C           ##AMT     CABEQ*ZERO     EXMOVE
      *
      ** Determine account movement settlement details
      *
     C                     CLEARC#DTA
      *
     C           ##SETM    IFEQ '01'
     C           ##SETM    OREQ '02'
     C           ##SETM    OREQ '07'
     C           ##SETM    OREQ '08'
     C           ##SETM    OREQ '12'
     C                     MOVEL'N'       C#ATYP
     C                     MOVEL##NOSN    C#NOSN
     C                     ELSE
     C           ##SETM    IFEQ '14'
     C                     MOVEL'R'       C#ATYP
     C                     MOVEL##ACNO    C#ACNO
     C                     ELSE
     C           ##SETM    IFEQ '04'
     C           ##SETM    OREQ '05'
     C                     MOVEL'P'       C#ATYP
     C                     MOVEL##CNUM    C#CNUM
     C                     MOVEL##ACOD    C#ACOD
     C                     MOVEL##ACSQ    C#ACSQ
     C                     MOVEL##BRCA    C#BRCA
     C                     END
     C                     END
     C                     END
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVE ##AMT     WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                   CEU003
      ** If CEU003 is ON, convert the corresponding movement amount       CEU003
      **    to settlement currency equivalent.                            CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           ##STCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     CALL 'EU0200'               90                 CEU003
     C                     PARM *BLANKS   P#RTCD  7                       CEU003
     C                     PARM ##AMT     P#FRAM 183                      CEU003
     C                     PARM ##CCY     P#FRCY  3                       CEU003
     C                     PARM ##STCY    P#TOCY  3                       CEU003
     C                     PARM           P#OUTA 150                      CEU003
     C                     PARM           P#INTA 183                      CEU003
     C                     PARM           P#EXRT 159                      CEU003
     C                     PARM           P#MDIN  1                       CEU003
      *                                                                   CEU003
     C           *IN90     IFEQ '1'                                       CEU003
     C           P#RTCD    ORNE *BLANKS                                   CEU003
     C                     MOVEL'*CALL   'W0FILE  8                       CEU003
     C                     MOVEL'EU0200  'W0KEY  29                       CEU003
     C                     Z-ADD904       W0ERNB  30                      CEU003
     C                     EXSR SRERR                                     CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     Z-ADDP#OUTA    ##AMT                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      * OLPOS Incoming/Outgoing Indicator 'I' or 'O'
     C           ##PYRC    IFEQ 'P'
     C                     MOVEL'O'       C#IO             * outgoing
     C                     ELSE
     C                     MOVEL'I'       C#IO             * incoming
     C                     END
      *
      * Currency of transaction
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           ##STCY    ANDNE*BLANKS                                   CEU003
     C                     MOVEL##STCY    C#CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVEL##CCY     C#CCY
     C                     ENDIF                                          CEU003
      *
      * Transaction type
     C                     MOVEL##TRYP    C#TRYP
      * Transaction Narrative
     C/COPY WNCPYSRC,AOH00054
     C                     MOVEL##NARR    C#NARR
     C/COPY WNCPYSRC,AOH00055
      *                                                                                       241166
      * Include transaction number and type                                                   241166
     C           TRSNAR    IFEQ 'Y'                                                           241166
     C                     MOVE *BLANK    D#WORK                                              241166
     C                     MOVE ##TRN     D#TRN                                               241166
     C                     MOVE ##TRYP    D#TYP                                               241166
     C                     MOVE D#WORK    C#NARR                                              241166
      *                                                                                    BUG25226A
     C           ##RPNB    IFEQ 1                                                          BUG25226A
      *                                                                                    BUG25226A
     C                     MOVE *BLANKS   C#NARR                                           BUG25226A
     C                     MOVELHKCNUM    @KEY1  10                                        BUG25226A
     C                     CALL 'AOCUSTR1'                                                 BUG25226A
     C                     PARM '*MSG   ' @RTCD                                            BUG25226A
     C                     PARM '*KEY   ' @OPTN                                            BUG25226A
     C                     PARM           @KEY1  10                                        BUG25226A
     C                     PARM *BLANKS   @KYST   7                                        BUG25226A
     C           SDCUST    PARM SDCUST    DSLDY                                            BUG25226A
      *                                                                                    BUG25226A
     C           @RTCD     IFEQ *BLANK                                                     BUG25226A
     C           ##TRN     CAT  BBCRNM:1  C#NARR                                           BUG25226A
     C                     ENDIF                                                           BUG25226A
      *                                                                                    BUG25226A
     C                     ENDIF                                                           BUG25226A
     C                     ENDIF                                                              241166
      *                                                                                       241166
     C           ##REVI    IFEQ 'YES'
     C                     MOVE '*'       C#NARR
     C                     END
      *
     C/COPY WNCPYSRC,AOOUMMU0M8
      * DL/LE/GL/RE transaction reference
     C                     MOVEL##TRN     C#TRN
      *
      * Movement amount
     C           ##PYRC    IFEQ 'P'
     C           ##REVI    ANDNE'YES'
     C           ##PYRC    OREQ 'R'
     C           ##REVI    ANDEQ'YES'
     C                     Z-SUB##AMT     C#AMT            * pay ie credit
     C                     ELSE
     C                     Z-ADD##AMT     C#AMT            * rec ie debit
     C                     END
      *
      * Module
     C                     MOVEL'DL'      C#MOD
      *
      * Olpos record number to update
      * '01' for FX
      * '02' for Interest movements
      * '03' for MM loans and deposits
     C           ##RPNB    IFEQ 2
     C                     MOVE '02'      C#OLRC
     C                     ELSE
     C                     MOVE '03'      C#OLRC
     C                     END
      *
      * Value date and posting date
     C                     Z-ADD##VDAT    C#VDAT
     C                     Z-ADD##VDAT    C#PSTD
      *
      * Indicator to show if removal allowed Y, N or " "
     C                     MOVEL'Y'       C#RPST
      *
      * Removal set number
     C                     Z-ADD##RPNB    C#RPNB
      *
      * Removal type "C" = Credit entries
      *              "D" = Debit entries
     C                     MOVEL'C'       C#RTYP
      *
      * Booking branch
     C                     MOVEL##BBRN    C#BBRN
      *
      *  If settlement details are present
      *  AOSPOSU0 will be called to update PRONO, MEMOS, RSACMTPD, OLPOS
      *
      *  OTHERWISE
      *
      *  If no settlement details are present
      *  AOSPOSU0 will be called to only update OLPOS
      *
     C           C#ATYP    IFEQ *BLANK
      *
      * Set account type indicator to signify no settlement
     C                     MOVEL'X'       C#ATYP
      *
      * Set update indicators for no update
     C                     MOVE 'N'       C#PRON
     C                     MOVE 'N'       C#MEMS
     C                     MOVE 'N'       C#RSAC
     C                     END
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           #ARCID    ANDEQ'HN'                                                          CRE020
     C                     MOVE HNDS38    WSEQN   3                                           CRE020
     C                     MOVELWSEQN     C#PREF                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CAP205
      ** Set value for Movement Type field                                                    CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE ##MTYP    C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      ***Call*AOSPOSU0*************************************************   141213
      ***********                                                         141213
     C***********          CALL 'AOSPOSU0'             9090               110036
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       110036
     C***********          PARM '*ADD    'W0ACT   8                       110036
     C***********          PARM C#DTA     O#DTA 256                       110036
      ***********                                                         110036
     C************IN90     IFEQ '1'                                       110036
     C***********R#RTN     ORNE *BLANKS                                   110036
     C***********          MOVEL'*CALL   'W0FILE  8                       110036
     C***********          MOVEL'AOSPOSU0'W0KEY  29                       110036
     C***********          Z-ADD902       W0ERNB  30                      110036
     C***********          EXSR SRERR                                     110036
     C***********          END                                            110036
     C***********          MOVE '*ADD    'D#ACT   8                110036 141213
      *                                                                   141213
      *  Check if account is open if account posting                      141213
      *                                                                   141213
     C           C#ATYP    IFNE 'X'                                       141213
     C                     EXSR CHKACT                                    110036
     C                     END                                            141213
      *                                                                   141213
      *  If account posting and account is open,                          141213
      *  and deal currency is the same as account currency                                    240855
      *  or if not account posting                                        141213
      *    Call AOSPOSU0                                                  141213
      *                                                                   141213
     C           C#ATYP    IFNE 'X'                                       141213
     C           NRECI     ANDEQ'D'                                       141213
     C           @RTCD     ANDEQ*BLANKS                                   191128
     C           C#CCY     ANDEQNCCY                                                          240855
     C           C#ATYP    OREQ 'X'                                       141213
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*ADD    'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE  8                       141213
     C                     MOVEL'AOSPOSU0'W0KEY  29                       141213
     C                     Z-ADD902       W0ERNB  30                      141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
     C                     END                                            141213
      *
      *................................................................
      *
     C           EXMOVE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRDCPI   : Determine principal & interest at defined date    *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *             SRCOMC- Computation of accrued commission         *   CDL006
      *                                                               *
      *****************************************************************
     C           SRDCPI    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDCPI'  @STK,Q
     C/COPY WNCPYSRC,AOOUMMU0M9
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C                     MOVE *BLANK    WNOREC  1                                           CDL033
     C                     ENDIF                                                              CDL033
      *
      *................................................................
      *
      * Deal number
      * Interest details only needed from Loans/Deposits(DEALSDC)
      *
     C                     Z-ADD##DLNO    ##DLNO  60
     C           ##DLNO    CHAINDEALSDCF             99    *
      *                                                                                       256960
      * Check rundate is in between 5 days before maturity.                                   256960
      *                                                                                       256960
     C                     MOVEL*BLANKS   P1OPTN  6                                           256960
     C**********           MOVE *BLANKS   P1KEY1  20                                   256960 260517
     C                     MOVEL*BLANKS   P1KEY1 20 P                                         260517
     C                     MOVE *BLANK    P1SIGN  1                                           256960
     C                     MOVE *ZEROS    P1AMNT 130                                          256960
     C                     MOVE *BLANKS   P1CCY   3                                           256960
     C                     MOVE ##VDAT    P1MDT5  50                                          256960
      *                                                                                       256960
     C                     CALL 'MM0100'                                                      256960
     C                     PARM           P1OPTN           In                                 256960
     C                     PARM           P1KEY1                                              256960
     C                     PARM           P1SIGN                                              256960
     C                     PARM           P1AMNT                                              256960
     C                     PARM           P1CCY                                               256960
     C                     PARM           P1MDT5           Out                                256960
      *
      * Deal accrued interest to control date, interest paid/received
      * to date and interest capitalized to date (from DEALS file)
     C           *IN99     IFEQ '0'
     C                     Z-ADDAITC      ##AITC 130
     C                     Z-ADDIPRD      ##IPRD 130
     C                     Z-ADDICTD      ##ICTD 130
     C           BJRDNB    IFLE ##VDAT                                                        256960
     C           BJRDNB    ANDGEP1MDT5                                                        256960
     C                     Z-ADDAIAP      ##AIAP 130                                          256960
     C**********           Z-ADDAIAN      ##AIAN 130                                   256960 260517
     C                     Z-ADDAIAN      ##AIAN 130                                          262823
      *                                                                                    AR1044820
     C           CALLER    IFEQ CALPGM,1                                                   AR1044820
     C                     Z-ADDWKAIAN    ##AIAN                                           AR1044820
     C                     ENDIF                                                           AR1044820
      *                                                                                    AR1044820
     C                     ENDIF                                                              256960
     C                     ELSE
     C                     Z-ADD0         ##AITC
     C                     Z-ADD0         ##IPRD
     C                     Z-ADD0         ##ICTD
     C                     Z-ADD0         ##AIAP 130                                          256960
     C                     Z-ADD0         ##AIAN 130                                          256960
     C/COPY WNCPYSRC,AOOUMMU0N0
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C                     MOVE 'Y'       WNOREC                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     END
     C/COPY WNCPYSRC,AOOUMMU0K3
      *
      * (Latest) Deal principal
     C                     Z-ADD##PCPL    ##LPCP 130
      *
      * (Latest) Deal interest rate
     C                     Z-ADD##INTR    ##LINT 117
      *
      * Deal interest calculation basis
     C                     MOVEL##ICBS    ZCBCBS  10
      *
      * READ FROM interest accrual control date in YYYYMMDD format
     C                     Z-ADD##IAYY    ZWYYYY           ¦ interest
     C                     Z-ADD##IAMM    ZWMTH            ¦ accrual
     C                     Z-ADD##IADD    ZWDAY            ¦ control date
     C                     EXSR ZDAT10
     C                     Z-ADDZZMDNO    ##IACD  50         Midas day no.
      *                                                                                     MD021669
     C           WNOREC    IFNE 'Y'                                                         MD021669
     C           SLID      ANDNEIACD                                                        MD021669
     C           AITC      ANDNE0                                                           MD021669
     C                     Z-ADDIACD      ##IACD                                            MD021669
     C                     ENDIF                                                            MD021669
      *                                                                                     MD021669
     C/COPY WNCPYSRC,AOOUMMU0R1
      *                                                                                       CDL033
      ** For CF deals, calculate interest differently.                                        CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           HKMTYP    ANDEQ'CF'                                                          CDL033
      *                                                                                       CDL033
      ** If deal has no record yet in DEALS file, initialise                                  CDL033
      ** interest accrual control date to be used in this                                     CDL033
      ** program and DEALS file fields.                                                       CDL033
      *                                                                                       CDL033
     C           WNOREC    IFEQ 'Y'                                                           CDL033
      *                                                                                       CDL033
     C                     Z-ADDWVDAT     ##IACD                                              CDL033
     C                     Z-ADD*ZERO     AIAP                                                CDL033
     C                     Z-ADD*ZERO     AIAN                                                CDL033
      *                                                                                       CDL033
      ** Else, initialise interest accrual control date                                       CDL033
      ** with date from DEALS file.                                                           CDL033
      *                                                                                       CDL033
     C                     ELSE                                                               CDL033
      *                                                                                       CDL033
     C                     Z-ADDIACD      ##IACD                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     EXSR SRFRC1                                                        CDL033
      *                                                                                       CDL033
     C                     ELSE                                                               CDL033
      *                                                                   CDL006
      ** If dealing fiduciary is installed.                               CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Commission taken on Fiduciary Call or Time deposits.          CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
     C           HKTYPE    OREQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Save Deal Interest accrued control date.                         CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN ##IACD    WUSVCD                          CDL006
     C                     Z-ADD##IACD    WUSVCD                          CDL006
      *                                                                   CDL006
      ** If Fiduciary Call Deposit.                                       CDL006
      *                                                                   CDL006
     C           HKTYPE    IFEQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Save Last Interest accrued control date before change.           CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN ##IACD    WUIACD                          CDL006
     C                     Z-ADD##IACD    WUIACD                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C6
      *
      * OMIT    value date and sequence number on MMDEAMPP
     C                     Z-ADD$$VDSN    $$VDSN
      *
      * READ TO value date and sequence number on MMDEAMPP
     C                     Z-ADD##VDSN    ##VDSN
     C*
     C           MDEAMK    KLIST
     C                     KFLD           ##DLNO
     C                     KFLD           ##IAYY
     C                     KFLD           ##IAMM
     C                     KFLD           ##IADD
     C*
     C           MDEAMK    SETLLMMDEAMP0
     C           ##DLNO    READEMMDEAMP0                 99*
      *
      * Omit deal amendment?
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
      *                                                                                       249910
      * omit deleted amendments but not the currently deleted amendment.                      249910
     C           HNLACT    DOWEQ'D'                        Last action = 'D'                  249910
     C           *IN99     ANDNE'1'                                                           249910
     C           @@VDSN    ANDNECDVDSN                                                        249910
      *                                                                                       249910
     C           ##DLNO    READEMMDEAMP0                 99*                                  249910
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date                  249910
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number                  249910
     C                     ENDDO                           EndDow HNLACT                      249910
      *                                                                                       249910
     C           *IN99     IFNE '1'                        If DEAM exist                      249910
     C           @@VDSN    IFEQ $$VDSN
      *                                                                                       249910
      * If it is the omit amendment, get next live amendment.
     C           HNLACT    DOUNE'D'                        Last action = 'D'                  249910
     C           *IN99     OREQ '1'                                                           249910
     C           ##DLNO    READEMMDEAMP0                 99*
     C                     ENDDO                           EndDOU HNLACT                      249910
      *                                                                                       249910
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
     C                     END
     C                     END                             EndIF *IN99 <>1                    249910
     C/COPY WNCPYSRC,AOOUMMU0K7
      *
      * Whilst deal amendments can be found, apply the changes
      *
     C           *IN99     DOWEQ'0'
     C           @@VDSN    ANDLT##VDSN
     C/COPY WNCPYSRC,AOOUMMU0K8
      *
      * Convert value date of deal amendment to Midas day number
      *
     C                     Z-ADDHNVDYY    ZWYYYY           ¦
     C                     Z-ADDHNVDMM    ZWMTH            ¦ value date of
     C                     Z-ADDHNVDDD    ZWDAY            ¦ deal amendment
     C                     EXSR ZDAT10
      *
      * Calculate the interest between the current interest accrual
      * control date and the the value date of the deal amendment
      *
     C                     Z-ADD##IACD    ZCBSDT
     C                     Z-ADDZZMDNO    ZCBEDT
     C           ZCBEDT    IFGT ZCBSDT
     C                     Z-ADD##LPCP    ZDLAMT 130
     C                     Z-ADD##LINT    ZDLRAT
     C                     EXSR ZDLINT
     C                     ADD  ZDLOUT    ##AITC
     C                     Z-ADDZCBEDT    ##IACD
      *                                                                   CDL006
      ** If CDL006 is installed.                                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Commission taken on Fiduciary Call deposits.                  CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'DT'                                      CDL006
     C           BNCOTK    OREQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'LT'                                      CDL006
      *                                                                   CDL006
      ** If Principal Increase or Principal Decrease.                     CDL006
      *                                                                   CDL006
     C           HNMTYP    IFEQ 'PI'                                      CDL006
     C           HNMTYP    OREQ 'PD'                                      CDL006
      *                                                                   CDL006
      ** As the commission calculation is based on the Interest           CDL006
      ** accrual control date (IACD) and the Deal principal amount        CDL006
      ** (only for Call/notice deposits), Commission amount must          CDL006
      ** be calculated each time the Interest Accrual Control date is     CDL006
      ** updated; the result must be added to the field Accrued           CDL006
      ** commission to control date FACTC .                               CDL006
      *                                                                   CDL006
     C                     Z-ADDWUIACD    WUDBEG                          CDL006
     C                     Z-ADD##IACD    WUDEND                          CDL006
     C                     EXSR SRCOMC                                    CDL006
     C                     ADD  WUACSC    FACTC                           CDL006
     C                     Z-ADD##IACD    WUIACD                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C7
     C                     END
      *
     C                     Z-ADDHNAMNP    HNAMNP       99  *
     C   99                Z-SUBHNAMNP    HNAMNP
      *
      * Principal increase, add deal amendment amount to principal
      *
     C           HNMTYP    IFEQ 'PI'
     C                     ADD  HNAMNP    ##LPCP
     C/COPY WNCPYSRC,AOOUMMU0K4
     C                     END
      *
      * Principal decrease, sub deal amendment amount from principal
      *
     C           HNMTYP    IFEQ 'PD'
     C                     SUB  HNAMNP    ##LPCP
     C                     END
      *
      * If the deal amendment is a rate change, change the interest rate
      *
     C           HNMTYP    IFEQ 'SC'
     C                     Z-ADDHNINTR    ##LINT
     C                     END
      *                                                                                       249910
      * If the deal amendment is Early Maturity,                                              249910
      *  interest rate or base rate is entered, change the interest rate.                     249910
      *                                                                                       249910
     C           HNMTYP    IFEQ 'EM'                                                          249910
     C           HNINTR    IFNE 0                                                             249910
     C           HNBRTE    ORNE 0                                                             249910
     C           HNINTR    ADD  HNBRTE    ##LINT                                              249910
     C                     END                                                                249910
     C                     END                                                                249910
      *                                                                                       249910
      *                                                                                       249910
      * If the deal amendment is Early Maturity and next interest date is greater             249910
      * than the earty maturity date, use early maturity date as next interest date.          249910
     C           HNMTYP    IFEQ 'EM'                                                          249910
     C           ##VDAT    ANDGTHNEMDT                                                        249910
     C                     Z-ADDHNEMDT    ##VDAT                                              249910
     C                     Z-ADDHNEMDT    @@DAYN  50                                          249910
     C                     EXSR ZDATE9                                                        249910
     C                     Z-ADD@@VDT     ##VYMD                                              249910
     C           HNINTR    IFNE *ZEROS                                                      MD021458
     C                     Z-ADDHNINTR    ##INTR                                            MD021458
     C                     ENDIF                                                            MD021458
      *                                                                                       249910
     C                     Z-ADD##VDAT    WMDAT   50                                          249910
     C                     MOVE 'M'       ##MIID  1          Mat/Int ind.                     249910
     C                     END                                                                249910
      *                                                                                       249910
      *
      * If the deal amendment is settle interest
      *
     C           HNMTYP    IFEQ 'SI'
     C                     Z-ADD##AITC    ##INTD 130
     C                     SUB  ##IPRD    ##INTD
     C                     SUB  ##ICTD    ##INTD           * interest due
     C           BJRDNB    IFLE ##VDAT                                                        256960
     C           BJRDNB    ANDGEP1MDT5                                                        256960
     C                     ADD  ##AIAP    ##INTD                                              256960
     C**********           ADD  ##AIAN    ##INTD                                       256960 260517
     C                     ADD  ##AIAN    ##INTD                                              262823
     C                     ENDIF                                                              256960
     C/COPY WNCPYSRC,AOOUMMU0M1
      *
     C                     ADD  ##INTD    ##IPRD
     C                     END
      *
      * If the deal amendment is capitalize interest
      *
     C           HNMTYP    IFEQ 'CI'
     C                     Z-ADD##AITC    ##INTD
     C                     SUB  ##IPRD    ##INTD
     C                     SUB  ##ICTD    ##INTD           * interest due
      *
     C           BJRDNB    IFLE ##VDAT                                                        256960
     C           BJRDNB    ANDGEP1MDT5                                                        256960
     C                     ADD  ##AIAP    ##INTD                                              256960
     C**********           ADD  ##AIAN    ##INTD                                       256960 260517
     C                     ADD  ##AIAN    ##INTD                                              262823
     C                     ENDIF                                                              256960
      *                                                                                       256960
     C                     ADD  ##INTD    ##ICTD
     C                     ADD  ##INTD    ##LPCP
     C                     END
     C/COPY WNCPYSRC,AOOUMMU0N1
      *
      * Read next record
      *
     C           ##DLNO    READEMMDEAMP0                 99*
      *
      * Omit deal amendment?
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
      *                                                                                       249910
      * omit deleted amendments but not currently deleted DEAM.                               249910
     C           HNLACT    DOWEQ'D'                                                           249910
     C           *IN99     ANDNE'1'                                                           249910
     C           @@VDSN    ANDNECDVDSN                                                        249910
      *                                                                                       249910
     C           ##DLNO    READEMMDEAMP0                 99*                                  249910
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date                  249910
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number                  249910
     C                     ENDDO                             EndDow HNDDLT                    249910
      *                                                                                       249910
     C           *IN99     IFNE '1'                        If DEAM exist                      249910
     C           @@VDSN    IFEQ $$VDSN
      *                                                                                       249910
      * If it is the omit amendment, get next live amendment.
     C           HNLACT    DOUNE'D'                        Last action = 'D'                  249910
     C           *IN99     OREQ '1'                                                           249910
     C           ##DLNO    READEMMDEAMP0                 99*
     C                     ENDDO                           EndDOU HNLACT                      249910
      *                                                                                       249910
     C                     Z-ADDHNVYMD    @@VYMD           * Deam value date
     C                     Z-ADDHNDS38    @@DS38           * Deam seq.number
     C                     END
     C                     END                             EndIF *IN99 <>1                    249910
      *
     C                     END                             * IN99DOWEQ'0'
     C/COPY WNCPYSRC,AOOUMMU0K2
      *
      * Calculate the interest between the control date and
      * the event date
      *
     C           ##VDAT    IFGT ##IACD
      *                                                                                       CDL093
     C                     MOVE 'N'       FEBPRC                                              CDL093
     C           ##ICBS    IFEQ 9                                                             CDL093
     C           HKNIPD    ANDNE0                                                             CDL093
     C           HKNIPD    ANDNE##VDAT                                                        CDL093
     C           HKMTYP    IFEQ 'IP'                                                          CDL093
     C           HKMTYP    OREQ 'IT'                                                          CDL093
     C           HKMTYP    OREQ 'TD'                                                          CDL093
     C           HKMTYP    OREQ 'TI'                                                          CDL093
      ** Check if there is a Feb29 between Start and End Dates                                CDL093
     C                     EXSR CHKFEB                                                        CDL093
     C                     ENDIF                                                              CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
      ** Perform Interest Calculation 9 processing when there is Feb29                        CDL093
     C           FEBPRC    IFEQ 'Y'                                                           CDL093
     C                     Z-ADD*ZEROS    WTOTI9 150                                          CDL033
     C                     Z-ADD##LPCP    @@AMT  150                                          CDL093
     C                     Z-ADD##LINT    @@RAT  117                                          CDL093
     C                     MOVE HKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ##IACD                                              CDL093
     C                     PARM           WMDAT                                               CDL093
     C                     PARM           HKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           HKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RAT                                               CDL093
     C                     PARM           HKRDFC                                              CDL093
     C                     PARM           HKFLID                                              CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WTOTI9                                              CDL093
     C                     Z-ADD##IACD    ZCBSDT                                              CDL093
     C                     Z-ADD##VDAT    ZCBEDT                                              CDL093
     C                     Z-ADD##LPCP    ZDLAMT                                              CDL033
     C                     Z-ADD##LINT    ZDLRAT                                              CDL033
     C                     ADD  WTOTI9    ##AITC                                              CDL093
     C                     ELSE                                                               CDL093
     C                     Z-ADD##IACD    WIACD   50                      CDL006
     C                     Z-ADD##IACD    ZCBSDT
     C                     Z-ADD##VDAT    ZCBEDT
     C                     Z-ADD##LPCP    ZDLAMT
     C                     Z-ADD##LINT    ZDLRAT
     C                     EXSR ZDLINT
     C/COPY WNCPYSRC,AOOUMMU0N3
     C                     ADD  ZDLOUT    ##AITC
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     Z-ADD##VDAT    ##IACD
      *                                                                   CDL006
      ** If CDL006 is installed.                                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** If Commission taken on Fiduciary Call/notice Deposits.           CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'DT'                                      CDL006
     C           BNCOTK    OREQ 'Y'                                       CDL006
     C           HKTYPE    ANDEQ'LT'                                      CDL006
      *                                                                   CDL006
      ** If Principal Increase or Principal Decrease.                     CDL006
      *                                                                   CDL006
     C           HNMTYP    IFEQ 'PI'                                      CDL006
     C           HNMTYP    OREQ 'PD'                                      CDL006
      *                                                                   CDL006
      ** As the commission calculation is based on the Interest           CDL006
      ** accrual control date (IACD) and the Deal principal amount        CDL006
      ** (only for Call/notice deposits), Commission amount must          CDL006
      ** be calculated each time the Interest Accrual Control date is     CDL006
      ** updated; the result must be added to the field Accrued           CDL006
      ** commission to control date FACTC .                               CDL006
      *                                                                   CDL006
     C                     Z-ADDWUIACD    WUDBEG                          CDL006
     C                     Z-ADD##IACD    WUDEND                          CDL006
     C                     EXSR SRCOMC                                    CDL006
     C                     ADD  WUACSC    FACTC                           CDL006
     C                     Z-ADD##IACD    WUIACD                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,AOOUMMU0C8
     C                     END
     C/COPY WNCPYSRC,AOOUMMU0R2
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *
      * The interest due at the event date is the interest to the event date
      * minus the interest paid/received and capitalized to date
      *
     C                     Z-ADD##AITC    ##INTD
     C/COPY WNCPYSRC,AOOUMMU0R3
      *                                                                                       CDL033
      ** For CF deals, calculate interest differently.                                        CDL033
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           HKMTYP    ANDEQ'CF'                                                          CDL033
      *                                                                                       CDL033
      ** Add accrued interest adjustment posted and not yet                                   CDL033
      ** posted to interest due.                                                              CDL033
      *                                                                                       CDL033
     C                     ADD  AIAP      ##INTD                                              CDL033
     C                     ADD  AIAN      ##INTD                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C                     SUB  ##IPRD    ##INTD
     C                     SUB  ##ICTD    ##INTD           * interest due
      *
     C           BJRDNB    IFLE ##VDAT                                                        256960
     C           BJRDNB    ANDGEP1MDT5                                                        256960
     C                     ADD  ##AIAP    ##INTD                                              256960
     C**********           ADD  ##AIAN    ##INTD                                       256960 260517
     C                     ADD  ##AIAN    ##INTD                                              262823
     C                     ENDIF                                                              256960
     C/COPY WNCPYSRC,AOOUMMU0K5
      *
      *................................................................
      *  Unwind subroutine stack name
      *
     C           EXDCPI    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRUPD    : Update database with shadow postings in store     *
      *                                                               *
      *  CALLED BY: Various                                           *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRUPD     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRUPD'   @STK,Q
      *
      *................................................................
      *
      *  Call AOSPOSU0 to update database
      *                                                                   141213
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*UPDATE 'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE                          141213
     C                     MOVEL'AOSPOSU0'W0KEY                           141213
     C                     Z-ADD903       W0ERNB                          141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
      *                                                                   141213
     C***********          CALL 'AOSPOSU0'             9090               110036
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       110036
     C***********          PARM '*UPDATE 'W0ACT   8                       110036
     C***********          PARM C#DTA     O#DTA 256                       110036
      ***********                                                         110036
     C************IN90     IFEQ '1'                                       110036
     C***********R#RTN     ORNE *BLANKS                                   110036
     C***********          MOVEL'*CALL   'W0FILE                          110036
     C***********          MOVEL'AOSPOSU0'W0KEY                           110036
     C***********          Z-ADD903       W0ERNB                          110036
     C***********          EXSR SRERR                                     110036
     C***********          END                                            110036
     C***********          MOVE '*UPDATE 'D#ACT                    110036 141213
     C***********          EXSR CHKACT                             110036 141213
      *
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXUPD     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRCLR    : Clear all postings in store                       *
      *                                                               *
      *  CALLED BY: UPDATE - Update database                          *
      *                                                               *
      *  CALLS    : SRERR - Report errors                             *
      *                                                               *
      *****************************************************************
     C           SRCLR     BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRCLR'   @STK,Q
      *
      *................................................................
      *
      *  Clear arrays in AOSPOSU0
      *
     C                     CLEARC#DTA
     C                     CALL 'AOSPOSU0'             9090               141213
     C                     PARM *BLANKS   O#RTN   7                       141213
     C                     PARM '*CLEAR  'W0ACT   8                       141213
     C                     PARM C#DTA     O#DTA 256                       141213
      *                                                                   141213
     C           *IN90     IFEQ '1'                                       141213
     C           O#RTN     ORNE *BLANKS                                   141213
     C                     MOVEL'*CALL   'W0FILE                          141213
     C                     MOVEL'AOSPOSU0'W0KEY                           141213
     C                     Z-ADD901       W0ERNB                          141213
     C                     EXSR SRERR                                     141213
     C                     END                                            141213
      *                                                                   141213
     C***********          CALL 'AOSPOSU0'             9090               110036
     C***********R#RTN     PARM *BLANKS   O#RTN   7                       110036
     C***********          PARM '*CLEAR  'W0ACT   8                       110036
     C***********          PARM C#DTA     O#DTA 256                       110036
      ***********                                                         110036
     C************IN90     IFEQ '1'                                       110036
     C***********R#RTN     ORNE *BLANKS                                   110036
     C***********          MOVEL'*CALL   'W0FILE                          110036
     C***********          MOVEL'AOSPOSU0'W0KEY                           110036
     C***********          Z-ADD901       W0ERNB                          110036
     C***********          EXSR SRERR                                     110036
     C***********          END                                            110036
     C***********          MOVE '*CLEAR  'D#ACT                    110036 141213
     C************         EXSR CHKACT                             110036 141213
      *
      *................................................................
      *
      *  Unwind subroutine stack name
      *
     C           EXCLR     TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *  SRERR    : Report error and close down program               *
      *                                                               *
      *  CALLED BY: Various                                           *
      *  CALLS    : *NONE                                             *
      *                                                               *
      *****************************************************************
     C           SRERR     BEGSR
      *
      *  Dump program
      *
     C                     DUMP
     C           CSC022    IFNE 'Y'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFNE 'Y'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      *  Close down program
      *
     C                     SETON                     LR
     C                     MOVEL'*ERROR*' ##RTCD
     C                     RETRN
      *
     C           EXERR     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     MOVEL'P'       ##PAY
     C                     MOVEL'R'       ##REC
     C                     MOVEL*BLANKS   R#RTN   7
     C                     MOVE '0'       *IN98
     C/COPY WNCPYSRC,AOOUMMU0K6
      *
      **  Copyright
     C                     MOVEA##CPY     ##BIS  80
      *                                                                                    MD031062A
      ** Check if CGL031 (Taxation of Savings Income) is enabled.                          MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOSARDR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM '*VERIFY' POPTN                                            MD031062A
     C                     PARM 'CGL031'  PSARD                                            MD031062A
     C           SCSARD    PARM SCSARD    DSFDY                                            MD031062A
      *                                                                                    MD031062A
     C                     MOVE 'N'       CGL031  1                                        MD031062A
     C                     MOVE *OFF      *IN96                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFEQ *BLANKS                                                    MD031062A
     C                     MOVE 'Y'       CGL031                                           MD031062A
     C                     MOVE *ON       *IN96                                            MD031062A
     C                     ELSE                                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE '*NRF   '                                                  MD031062A
     C           *LOCK     IN   LDA                                                        MD031062A
     C                     MOVEL'SCSARDPD'DBFILE                                           MD031062A
     C                     MOVEL'CGL031 ' DBKEY                                            MD031062A
     C                     Z-ADD101       DBASE                                            MD031062A
     C                     OUT  LDA                                                        MD031062A
     C                     EXSR SRERR                                                      MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Access System Values                                                              MD031062A
      *                                                                                    MD031062A
     C           CGL031    IFEQ 'Y'                                                        MD031062A
     C                     CALL 'AOSVALR0'                                                 MD031062A
     C                     PARM *BLANKS   P@RTCD  7                                        MD031062A
     C                     PARM WUSEDL    P@OP01 20                                        MD031062A
     C                     PARM           P@VL01200                                        MD031062A
     C                     PARM *BLANK    P@OP02 20                                        MD031062A
     C                     PARM           P@VL02200                                        MD031062A
     C                     PARM *BLANK    P@OP03 20                                        MD031062A
     C                     PARM           P@VL03200                                        MD031062A
     C                     PARM *BLANK    P@OP04 20                                        MD031062A
     C                     PARM           P@VL04200                                        MD031062A
     C                     PARM *BLANK    P@OP05 20                                        MD031062A
     C                     PARM           P@VL05200                                        MD031062A
     C                     PARM *BLANK    P@OP06 20                                        MD031062A
     C                     PARM           P@VL06200                                        MD031062A
     C                     PARM *BLANK    P@OP07 20                                        MD031062A
     C                     PARM           P@VL07200                                        MD031062A
     C                     PARM *BLANK    P@OP08 20                                        MD031062A
     C                     PARM           P@VL08200                                        MD031062A
     C                     PARM *BLANK    P@OP09 20                                        MD031062A
     C                     PARM           P@VL09200                                        MD031062A
     C                     PARM *BLANK    P@OP10 20                                        MD031062A
     C                     PARM           P@VL10200                                        MD031062A
      *                                                                                    MD031062A
     C           P@RTCD    IFNE *BLANKS                                                    MD031062A
     C                     MOVEL'SDSVALPD'DBFILE           ****************                MD031062A
     C                     MOVEL'*CALL'   DBKEY            * DB ERROR 112 *                MD031062A
     C                     Z-ADD112       DBASE            ****************                MD031062A
     C                     EXSR SRERR                                                      MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     MOVELP@VL01    WDLCUS  1                                        MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                       220013
      *................................................................                       220013
      *                                                                                       220013
      *................................................................                       220013
      ** Determine if CGL165 enhancement is installed                                         CGL165
     C                     CALL 'AOSARDR0'                                                    CGL165
     C                     PARM *BLANKS   @RTCD                                               CGL165
     C                     PARM '*VERIFY' @OPTN                                               CGL165
     C                     PARM 'CGL165'  @SARD                                               CGL165
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL165
      *                                                                                       CGL165
     C                     MOVE 'N'       CGL165  1                                           CGL165
     C           @RTCD     IFEQ *BLANKS                                                       CGL165
     C                     MOVE 'Y'       CGL165                                              CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
      *                                                                                       220013
      ** Check if S01383 is switched *ON.                                                     220013
      *                                                                                       220013
     C                     CALL 'AOSARDR0'                                                    220013
     C                     PARM *BLANKS   @RTCD   7                                           220013
     C                     PARM '*VERIFY' @OPTN   7                                           220013
     C                     PARM 'S01383'  @SARD   6                                           220013
     C           SCSARD    PARM SCSARD    DSFDY                                               220013
      *                                                                                       220013
     C           @RTCD     IFEQ *BLANKS                                                       220013
     C                     MOVE 'Y'       S01383  1                                           220013
     C                     ELSE                                                               220013
     C                     MOVE 'N'       S01383                                              220013
     C                     ENDIF                                                              220013
      *                                                                                       220013
      ** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA                           220013
      *                                                                                       220013
     C           S01383    IFEQ 'Y'                                                           220013
     C                     MOVE 'D'       KRECI   1                                           220013
     C           KRECI     CHAINSDBRTDD0             60                                       220013
     C           *IN60     IFEQ '1'                                                           220013
     C                     MOVEL'SDBRTDPD'DBFILE            *************                     220013
     C                     MOVEL'915'     DBASE             * DBERR 915 *                     220013
     C                     EXSR SRERR                       *************                     220013
     C                     END                                                                220013
      *                                                                                       220013
      ** SET UP WORK FIELDS TO HOLD HALF THE BRT RATES                                        220013
      *                                                                                       220013
     C           BRTR      DIV  2         WBRTR   75H      CURRENT RATE                       220013
     C           PBRTR     DIV  2         WPBRTR  75H      PREVIOUS RATE                      220013
     C                     END                                                                220013
      *                                                                                       241166
      * Check system values                                                                   241166
     C                     CALL 'AOSVALR0'                                                    241166
     C                     PARM *BLANKS   @RTCD                                               241166
     C                     PARM SVALKK    SVALK1 20                                           241166
     C                     PARM           SVAL1 200                                           241166
     C                     PARM *BLANK    SVALK2 20                                           241166
     C                     PARM           SVAL2 200                                           241166
     C                     PARM *BLANK    SVALK3 20                                           241166
     C                     PARM           SVAL3 200                                           241166
     C                     PARM *BLANK    SVALK4 20                                           241166
     C                     PARM           SVAL4 200                                           241166
     C                     PARM *BLANK    SVALK5 20                                           241166
     C                     PARM           SVAL5 200                                           241166
     C                     PARM *BLANK    SVALK6 20                                           241166
     C                     PARM           SVAL6 200                                           241166
     C                     PARM *BLANK    SVALK7 20                                           241166
     C                     PARM           SVAL7 200                                           241166
     C                     PARM *BLANK    SVALK8 20                                           241166
     C                     PARM           SVAL8 200                                           241166
     C                     PARM *BLANK    SVALK9 20                                           241166
     C                     PARM           SVAL9 200                                           241166
     C                     PARM *BLANK    SVALK0 20                                           241166
     C                     PARM           SVAL10200                                           241166
      *                                                                                       241166
     C           @RTCD     IFNE *BLANK                                                        241166
     C           *LOCK     IN   LDA                                                           241166
     C                     Z-ADD911       DBASE             *************                     241166
     C                     MOVEL'SDSVALPD'DBFILE            * DBERR 911 *                     241166
     C                     MOVEL'*KEY   ' DBKEY             *************                     241166
     C                     OUT  LDA                                                           241166
     C                     EXSR SRERR                                                         241166
     C                     ENDIF                                                              241166
     C                     MOVE SVAL11    TRSNAR  1                                           241166
      *
      *................................................................
      *
      ** Check if CEU003 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                                       CSC022
      ** Check if CSC022 is switched *ON.                                                     CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD                                               CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL*BLANKS   CMTSKP  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   @RTCD                                               CRE020
     C                     PARM '*VERIFY' @OPTN                                               CRE020
     C                     PARM 'CRE020'  @SARD                                               CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           @RTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                      BUG4613
      ** Check if feature CDL018 is switched on                                              BUG4613
      *                                                                                      BUG4613
     C                     CALL 'AOSARDR0'                                                   BUG4613
     C                     PARM *BLANKS   @RTCD                                              BUG4613
     C                     PARM '*VERIFY' @OPTN                                              BUG4613
     C                     PARM 'CDL018'  @SARD                                              BUG4613
     C           SCSARD    PARM SCSARD    DSFDY                                              BUG4613
      *                                                                                      BUG4613
     C                     MOVE 'N'       CDL018  1                                          BUG4613
     C           @RTCD     IFEQ *BLANKS                                                      BUG4613
     C                     MOVE 'Y'       CDL018                                             BUG4613
     C                     ENDIF                                                             BUG4613
     C*                                                                   CEU003
     C***  Access Bank Details File                                       CEU003
     C*                                                                   CEU003
     C                     CALL 'AOBANKR0'                                CEU003
     C                     PARM '*DBERR  'PRTCD   7                       CEU003
     C                     PARM '*FIRST  'POPTN   7                       CEU003
     C           SDBANK    PARM SDBANK    DSFDY                           CEU003
      *                                                                   CEU003
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *                                                                   CDL006
      ** Access Switchable Features file to check if Dealing Fiducia      CDL006
      ** ry is installed.                                                 CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANKS                                   CDL006
     C           WRTCD     ANDNE'*NRF   '                                 CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD912       DBASE             ************* CDL006
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 912 * CDL006
     C                     MOVELWRTCD     DBKEY             ************* CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR SRERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           WRTCD     IFEQ *BLANK                                    CDL006
     C                     MOVEL'Y'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Access Dealing ICD                                               CDL006
      *                                                                   CDL006
     C********** CDL006    IFEQ 'Y'                                                    CDL006 220013
     C**********           CALL 'AODEALR0'                                CDL006              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD                           CDL006
     C                     PARM '*FIRST ' WOPTN                           CDL006
     C********** SDDEAL    PARM SDDEAL    DSFDY                           CDL006              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
      *                                                                   CDL006
      ** Handle Database Error.                                           CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANKS                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVE 'SDDEALPD'DBFILE                          CDL006
     C                     MOVELWOPTN     DBKEY            *************  CDL006
     C                     Z-ADD913       DBASE            * DBERR 913 *  CDL006
     C                     MOVEL'AOOUMMU0'DBPGM            *************  CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR SRERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ***Check*if*feature*CDL018*is*switched*on                                        CDL018BUG4613
     C**********           CALL 'AOSARDR0'                                             CDL018BUG4613
     C**********           PARM *BLANKS   WRTCD                                        CDL018BUG4613
     C**********           PARM '*VERIFY' WOPTN                                        CDL018BUG4613
     C**********           PARM 'CDL018'  WSARD                                        CDL018BUG4613
     C********** SCSARD    PARM SCSARD    DSFDY                                        CDL018BUG4613
      *                                                                                CDL018BUG4613
     C********** WRTCD     IFEQ *BLANK                                                 CDL018BUG4613
     C**********           MOVEL'Y'       CDL018  1                                    CDL018BUG4613
     C**********           ELSE                                                        CDL018BUG4613
     C**********           MOVE 'N'       CDL018                                       CDL018BUG4613
     C**********           ENDIF                                                       CDL018BUG4613
      ** LDA                                                              CDL006
      *                                                                   CDL006
     C           *NAMVAR   DEFN           LDA                             CDL006
      *                                                                   CDL006
      ** If dealing fiduciary is installed.                               CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN BNCHTK    WUCHCO                          CDL006
     C                     MOVE 'N'       WUCHCO                          CDL006
      *                                                                   CDL006
      ** If Charges or commission taken.                                  CDL006
      *                                                                   CDL006
     C           BNCHTK    IFEQ 'Y'                                       CDL006
     C           BNCOTK    OREQ 'Y'                                       CDL006
     C                     MOVE 'Y'       WUCHCO                          CDL006
      *                                                                   CDL006
      ** If Commission taken.                                             CDL006
      *                                                                   CDL006
     C           BNCOTK    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** Access SD Currency details to retrieve Number of decimal         CDL006
      ** places for Base currency.                                        CDL006
      *                                                                   CDL006
     C                     CALL 'AOCURRR0'                                CDL006
     C                     PARM '*MSG    'WRTCD                           CDL006
     C                     PARM '*KEY    'WOPTN                           CDL006
     C                     PARM BJCYCD    WCCY    3                       CDL006
     C           SDCURR    PARM SDCURR    DSSDY                           CDL006
      *                                                                   CDL006
      ** If Base currency doesn't exist.                                  CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANK                                    CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL'SDCURRL1'DBFILE                          CDL006
     C                     MOVELBJCYCD    DBKEY                           CDL006
     C                     Z-ADD914       DBASE                           CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR SRERR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Save Base currency number of decimal places.                     CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN A6NBDP    WUBCDP                          CDL006
     C                     Z-ADDA6NBDP    WUBCDP                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C**********           ENDIF                                                       CDL006 220013
     C/COPY WNCPYSRC,AOOUMMU0C9
      *                                                                                       CDL033
      ** Determine if Floating Rate CD Issued feature is                                      CDL033
      ** switched on.                                                                         CDL033
      *                                                                                       CDL033
     C                     MOVE *BLANK    CDL033  1                                           CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD                                               CDL033
     C                     PARM '*VERIFY' POPTN                                               CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     ELSE                                                               CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C           *LOCK     IN   LDA                                                           CDL033
     C                     MOVE '908'     DBASE                                               CDL033
     C                     MOVEL'CDL033'  DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     OUT  LDA                                                           CDL033
     C                     EXSR SRERR                                                         CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CAP205
      ** Check if CAP205 is switched *ON.                                                     CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE '*NRF   '                                                     CAP205
     C           *LOCK     IN   LDA                                                           CAP205
     C                     MOVE '918'     DBASE                                               CAP205
     C                     MOVEL'CAP205'  DBKEY                                               CAP205
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP205
     C                     OUT  LDA                                                           CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CRE073
      *** Determine if CGL031 enhancement is installed                                     MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOSARDR0'                                                 MD031062A
     C                     PARM *BLANKS   @RTCD                                            MD031062A
     C                     PARM '*VERIFY' @OPTN                                            MD031062A
     C                     PARM 'CGL031'  @SARD                                            MD031062A
     C           SCSARD    PARM SCSARD    DSFDY                                            MD031062A
      *                                                                                    MD031062A
      ** If feature is on, set up SAR work flag                                            MD031062A
      *                                                                                    MD031062A
     C           @RTCD     IFEQ *BLANKS                                                    MD031062A
     C                     MOVE 'Y'       CGL031                                           MD031062A
     C                     ELSE                                                            MD031062A
     C                     MOVE 'N'       CGL031  1                                        MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Determine if CER048 enhancement is installed                                      MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOSARDR0'                                                 MD031062A
     C                     PARM *BLANKS   @RTCD                                            MD031062A
     C                     PARM '*VERIFY' @OPTN                                            MD031062A
     C                     PARM 'CER048'  @SARD                                            MD031062A
     C           SCSARD    PARM SCSARD    DSFDY                                            MD031062A
      *                                                                                    MD031062A
      ** If feature is on, set up SAR work flag                                            MD031062A
      *                                                                                    MD031062A
     C           @RTCD     IFEQ *BLANKS                                                    MD031062A
     C                     MOVE 'Y'       CER048                                           MD031062A
     C                     ELSE                                                            MD031062A
     C                     MOVE 'N'       CER048  1                                        MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Determine if CER054 enhancement is installed                                      MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOSARDR0'                                                 MD031062A
     C                     PARM *BLANKS   @RTCD                                            MD031062A
     C                     PARM '*VERIFY' @OPTN                                            MD031062A
     C                     PARM 'CER054'  @SARD                                            MD031062A
     C           SCSARD    PARM SCSARD    DSFDY                                            MD031062A
      *                                                                                    MD031062A
      ** If feature is on, set up SAR work flag                                            MD031062A
      *                                                                                    MD031062A
     C           @RTCD     IFEQ *BLANKS                                                    MD031062A
     C                     MOVE 'Y'       CER054                                           MD031062A
     C                     ELSE                                                            MD031062A
     C                     MOVE 'N'       CER054  1                                        MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     MOVE 'N'       WSV01   1                                        MD031062A
      *                                                                                    MD031062A
      ** Check if Net Interest is to be posted for German Taxes                            MD031062A
      ** Check if Net Interest is to be posted for German Taxes                            MD031062A
      *                                                                                    MD031062A
      *                                                                                    MD031062A
     C           CER048    IFEQ 'Y'                                                        MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOSVALR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM PSNET     PSV01  20                                        MD031062A
     C                     PARM           PCS01 200                                        MD031062A
     C                     PARM           PSV02  20                                        MD031062A
     C                     PARM           PCS02 200                                        MD031062A
     C                     PARM           PSV03  20                                        MD031062A
     C                     PARM           PCS03 200                                        MD031062A
     C                     PARM           PSV04  20                                        MD031062A
     C                     PARM           PCS04 200                                        MD031062A
     C                     PARM           PSV05  20                                        MD031062A
     C                     PARM           PCS05 200                                        MD031062A
     C                     PARM           PSV06  20                                        MD031062A
     C                     PARM           PCS06 200                                        MD031062A
     C                     PARM           PSV07  20                                        MD031062A
     C                     PARM           PCS07 200                                        MD031062A
     C                     PARM           PSV08  20                                        MD031062A
     C                     PARM           PCS08 200                                        MD031062A
     C                     PARM           PSV09  20                                        MD031062A
     C                     PARM           PCS09 200                                        MD031062A
     C                     PARM           PSV10  20                                        MD031062A
     C                     PARM           PCS10 200                                        MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFEQ *BLANKS                                                    MD031062A
     C                     MOVELPCS01     WSV01                                            MD031062A
     C                     ELSE                                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE '*NRF'                                                     MD031062A
     C           *LOCK     IN   LDA                                                        MD031062A
     C                     MOVEL'SDSVALPD'DBFILE                                           MD031062A
     C                     MOVELPSV01     DBKEY                                            MD031062A
     C                     Z-ADD144       DBASE                                            MD031062A
     C                     OUT  LDA                                                        MD031062A
     C                     EXSR SRERR                                                      MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Determine if CER049 enhancement is installed                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*VERIFY' @OPTN                                               CER049
     C                     PARM 'CER049'  @SARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
      ** If feature is on, set up SAR work flag                                               CER049
      *                                                                                       CER049
     C           @RTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     ENDIF                                                              CER049
      *                                                                                     MD023265
      ** Determine if CDL013 enhancement is installed                                       MD023265
      *                                                                                     MD023265
     C                     CALL 'AOSARDR0'                                                  MD023265
     C                     PARM *BLANKS   @RTCD                                             MD023265
     C                     PARM '*VERIFY' @OPTN                                             MD023265
     C                     PARM 'CDL013'  @SARD                                             MD023265
     C           SCSARD    PARM SCSARD    DSFDY                                             MD023265
      *                                                                                     MD023265
     C           @RTCD     IFEQ *BLANKS                                                     MD023265
     C                     MOVE 'Y'       CDL013                                            MD023265
     C                     MOVEL'RETAIL'  WTYPE  10                                         MD023265
      *                                                                                     MD023265
      ** Access Withholding Tax file to retrieve WHT rate                                   MD023265
      *                                                                                     MD023265
     C           WTYPE     CHAINSDSTAAL1             70                                     MD023265
     C           *IN70     IFEQ '1'                                                         MD023265
     C                     EXSR SRERR                                                       MD023265
     C                     ENDIF                                                            MD023265
     C                     ELSE                                                             MD023265
     C                     MOVE 'N'       CDL013  1                                         MD023265
     C                     ENDIF                                                            MD023265
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR SRERR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
      *
      ** CHECK IF CDL081 IS INSTALLED                                                       MD055501
      *                                                                                     MD055501
     C                     MOVE 'N'       CDL081  1                                         MD055501
     C                     MOVEL' '       W#NBSR  1                                         MD055501
     C                     MOVEL' '       W#BSRD  1                                         MD055501
     C                     CALL 'AOSARDR0'                                                  MD055501
     C                     PARM *BLANKS   PRTCD   7                                         MD055501
     C                     PARM '*VERIFY' POPTN   7                                         MD055501
     C                     PARM 'CDL081'  PSARD   6                                         MD055501
     C           SCSARD    PARM SCSARD    DSFDY                                             MD055501
      *                                                                                     MD055501
     C           PRTCD     IFNE *BLANKS                                                     MD055501
     C           PRTCD     ANDNE'*NRF   '                                                   MD055501
     C           *LOCK     IN   LDA                                                         MD055501
     C                     MOVEL'075'     DBASE                                             MD055501
     C                     MOVEL'SCSARDPD'DBFILE                                            MD055501
     C                     MOVEL'CDL081'  DBKEY                                             MD055501
     C                     OUT  LDA                                                         MD055501
     C                     EXSR SRERR                                                       MD055501
     C                     END                                                              MD055501
      *                                                                                     MD055501
     C           PRTCD     IFEQ *BLANKS                                                     MD055501
     C                     MOVE 'Y'       CDL081                                            MD055501
     C                     ENDIF                                                            MD055501
      *                                                                                     MD055501
      ** Access withholding tax round down system values if CDL081 is on                    MD055501
      *                                                                                     MD055501
     C           CDL081    IFEQ 'Y'                                                         MD055501
     C                     CALL 'AOSVALR0'                                                  MD055501
     C                     PARM *BLANKS   PRTCD                                             MD055501
     C                     PARM C#BASE    SVALK1 20                                         MD055501
     C                     PARM           SVAL1 200                                         MD055501
     C                     PARM *BLANK    SVALK2 20                                         MD055501
     C                     PARM           SVAL2 200                                         MD055501
     C                     PARM *BLANK    SVALK3 20                                         MD055501
     C                     PARM           SVAL3 200                                         MD055501
     C                     PARM *BLANK    SVALK4 20                                         MD055501
     C                     PARM           SVAL4 200                                         MD055501
     C                     PARM *BLANK    SVALK5 20                                         MD055501
     C                     PARM           SVAL5 200                                         MD055501
     C                     PARM *BLANK    SVALK6 20                                         MD055501
     C                     PARM           SVAL6 200                                         MD055501
     C                     PARM *BLANK    SVALK7 20                                         MD055501
     C                     PARM           SVAL7 200                                         MD055501
     C                     PARM *BLANK    SVALK8 20                                         MD055501
     C                     PARM           SVAL8 200                                         MD055501
     C                     PARM *BLANK    SVALK9 20                                         MD055501
     C                     PARM           SVAL9 200                                         MD055501
     C                     PARM *BLANK    SVALK0 20                                         MD055501
     C                     PARM           SVAL10200                                         MD055501
      *                                                                                     MD055501
     C           PRTCD     IFNE *BLANKS                                                     MD055501
     C           *LOCK     IN   LDA                                                         MD055501
     C                     MOVEL'076'     DBASE                                             MD055501
     C                     MOVEL'SDSVALPD'DBFILE                                            MD055501
     C                     MOVELSVALK1    DBKEY                                             MD055501
     C                     OUT  LDA                                                         MD055501
     C                     EXSR SRERR                                                       MD055501
     C                     ENDIF                                                            MD055501
     C                     MOVELSVAL1     W#BSRD                                            MD055501
      *                                                                                     MD055501
     C                     CALL 'AOSVALR0'                                                  MD055501
     C                     PARM *BLANKS   PRTCD                                             MD055501
     C                     PARM C#NBAS    SVALK1 20                                         MD055501
     C                     PARM           SVAL1 200                                         MD055501
     C                     PARM *BLANK    SVALK2 20                                         MD055501
     C                     PARM           SVAL2 200                                         MD055501
     C                     PARM *BLANK    SVALK3 20                                         MD055501
     C                     PARM           SVAL3 200                                         MD055501
     C                     PARM *BLANK    SVALK4 20                                         MD055501
     C                     PARM           SVAL4 200                                         MD055501
     C                     PARM *BLANK    SVALK5 20                                         MD055501
     C                     PARM           SVAL5 200                                         MD055501
     C                     PARM *BLANK    SVALK6 20                                         MD055501
     C                     PARM           SVAL6 200                                         MD055501
     C                     PARM *BLANK    SVALK7 20                                         MD055501
     C                     PARM           SVAL7 200                                         MD055501
     C                     PARM *BLANK    SVALK8 20                                         MD055501
     C                     PARM           SVAL8 200                                         MD055501
     C                     PARM *BLANK    SVALK9 20                                         MD055501
     C                     PARM           SVAL9 200                                         MD055501
     C                     PARM *BLANK    SVALK0 20                                         MD055501
     C                     PARM           SVAL10200                                         MD055501
      *                                                                                     MD055501
     C           PRTCD     IFNE *BLANKS                                                     MD055501
     C           *LOCK     IN   LDA                                                         MD055501
     C                     MOVEL'076'     DBASE                                             MD055501
     C                     MOVEL'SDSVALPD'DBFILE                                            MD055501
     C                     MOVELSVALK1    DBKEY                                             MD055501
     C                     OUT  LDA                                                         MD055501
     C                     EXSR SRERR                                                       MD055501
     C                     ENDIF                                                            MD055501
     C                     MOVELSVAL1     W#NBSR                                            MD055501
      *                                                                                     MD055501
      ** Setup tax amount rounding down indicators                                          MD055501
      *                                                                                     MD055501
     C                     ENDIF                                                            MD055501
     C/COPY WNCPYSRC,AOH00068
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5                                                            110036
      *****************************************************************   110036
      * Subroutine  :  CHKACT                                         *   110036
      * Function    :  To check for live account before calling       *   110036
      *                AOSPOSU0                                       *   110036
      *                                                               *   110036
      * Called by   :  Various subroutines                            *   110036
      * Calls       :  None                                           *   110036
      *****************************************************************   110036
     C           CHKACT    BEGSR                                          110036
     C           C#ATYP    IFEQ 'N'                                       110036
     C           C#ATYP    OREQ 'F'                                       110036
     C                     CALL 'AONOSTR0'                                110036
     C**********           PARM '*DBERR  '@RTCD   7                                    110036 260863
     C                     PARM *BLANKS   @RTCD   7                                           260863
     C                     PARM '*KEY    '@OPTN   7                       110036
     C                     PARM *BLANKS   @KEYA   6                       110036
     C                     PARM C#CCY     @KEYB   3                       110036
     C**********           PARM *BLANKS   @KEYC   4                       110036       110036 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       110036
     C                     PARM ##NOSN    @KEYE   2                       110036
     C                     PARM *BLANKS   @KEYF   3                       110036
     C                     PARM *BLANKS   @KEYG  10                       101001
     C                     PARM *BLANKS   @KEYH   1                       110036
     C           SDNOST    PARM SDNOST    DSFDY                           110036
      *                                                                   110036
      ** Move account details.                                            110036
      *                                                                   110036
     C                     MOVE A7CYCD    D#CCY   3                       110036
     C**********           MOVE A7ACCD    D#ACOD  4                                    110036 CGL029
     C                     MOVE A7ACCD    D#ACOD 10                                           CGL029
     C                     MOVE A7CUST    D#CNUM  6                       110036
     C                     MOVE A7ACSN    D#ACSQ                          110036
     C                     MOVE A7BRCD    D#BRCA  3                       110036
     C                     ENDIF                                          110036
      *                                                                   110036
     C           C#ATYP    IFEQ 'R'                                       110036
     C                     MOVE C#ACNO    D#RTL  10                       110036
     C                     MOVE *BLANKS   D#CCY                           110036
     C                     MOVE *BLANKS   D#ACOD                          110036
     C                     MOVE *BLANKS   D#CNUM                          110036
     C                     MOVE *BLANKS   D#ACSQ                          110036
     C                     MOVE *BLANKS   D#BRCA                          110036
     C*********************ELSE                                    110036 147424
     C                     ENDIF                                          147424
      *                                                                   147424
     C           C#ATYP    IFNE 'N'                                       147424
     C           C#ATYP    ANDNE'F'                                       147424
     C           C#ATYP    ANDNE'R'                                       147424
     C                     MOVE *BLANKS   D#RTL                           110036
     C                     MOVE C#CCY     D#CCY                           110036
     C                     MOVE ##ACOD    D#ACOD                          110036
     C                     MOVE ##CNUM    D#CNUM                          110036
     C                     MOVE ##ACSQ    D#ACSQ                          110036
     C                     MOVE ##BRCA    D#BRCA                          110036
     C                     ENDIF                                          110036
      *                                                                   110036
      ** Call AOACCTR0 to retrieve the account record.                    110036
      *                                                                   110036
     C                     MOVE *BLANKS   NRECI                           110036
     C                     CALL 'AOACCTR0'                                110036
     C                     PARM *BLANKS   @RTCD                           110036
     C                     PARM '*KEY   ' @OPTN                           110036
     C                     PARM D#RTL     @RETL  10                       110036
     C                     PARM D#CNUM    @CNUM   6                       110036
     C                     PARM D#CCY     @CYCD   3                       110036
     C**********           PARM D#ACOD    @ACCD   4                                    110036 CGL029
     C                     PARM D#ACOD    @ACCD  10                                           CGL029
     C                     PARM D#ACSQ    @ACSN   2                       110036
     C                     PARM D#BRCA    @DSNB   3                       110036
     C           SDACNT    PARM SDACNT    DSSDY                           110036
      ***********                                                  110036 141213
      ***Call*AOSPOSU0*if*account*is*live.************************ 110036 141213
      ***********                                                  110036 141213
     C***********NRECI     IFEQ 'D'                                110036 141213
     C***********C#ATYP    OREQ 'X'                                110036 141213
     C/COPY WNCPYSRC,AOOUMMU0M3
     C***********          CALL 'AOSPOSU0'             9090        110036 141213
     C***********R#RTN     PARM *BLANKS   O#RTN   7                110036 141213
     C***********          PARM D#ACT     W0ACT   8                110036 141213
     C***********          PARM C#DTA     O#DTA 256                110036 141213
     C/COPY WNCPYSRC,AOOUMMU0M4
      ***********                                                  110036 141213
     C************IN90     IFEQ '1'                                110036 141213
     C***********R#RTN     ORNE *BLANKS                            110036 141213
     C***********          MOVEL'*CALL   'W0FILE  8                110036 141213
     C***********          MOVEL'AOSPOSU0'W0KEY  29                110036 141213
     C***********          Z-ADD903       W0ERNB  30               110036 141213
     C***********          EXSR SRERR                              110036 141213
     C***********          END                                     110036 141213
     C***********          ENDIF                                   110036 141213
     C                     ENDSR                                          110036
      *****************************************************************   110036
      /EJECT                                                              CDL006
      *****************************************************************   CDL006
      *                                                               *   CDL006
      *  SRLCVT - Subroutine to convert range limits amounts held on  *   CDL006
      *           FID charges/comm. types, from base currency to deal *   CDL006
      *           currency, if Commission tables in base currency.    *   CDL006
      *                                                               *   CDL006
      *  Called By : Main processing                                  *   CDL006
      *                                                               *   CDL006
      *  Calls:                                                       *   CDL006
      *  ZCONVN  - Converts amount                                    *   CDL006
      *                                                               *   CDL006
      *****************************************************************   CDL006
      *                                                                   CDL006
     C           SRLCVT    BEGSR                                          CDL006
      *                                                                   CDL006
     C                     Z-ADDWUDCSR    ZEXCH                           CDL006
      *                                                                   CDL006
     C           WUDCMD    IFEQ 'M'                                       CDL006
     C                     MOVE 'D'       ZMD                             CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'M'       ZMD                             CDL006
     C                     ENDIF                                          CDL006
     C                     Z-ADDWUBCDP    ZCDPI                           CDL006
     C                     Z-ADDWUDCDP    ZCDPO                           CDL006
      *                                                                   CDL006
      ** Process all array entries.                                       CDL006
      *                                                                   CDL006
     C           1         DO   14        I       20                      CDL006
     C                     Z-ADDZRA,I     ZAMTCI                          CDL006
      *                                                                   CDL006
      ** Convert range limit amount from Base currency to Deal currency.  CDL006
      *                                                                   CDL006
     C                     EXSR ZCONVN                                    CDL006
      *                                                                   CDL006
     C                     Z-ADDZAMTCO    ZRA,I                           CDL006
      *                                                                   CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C                     ENDSR                                          CDL006
      *                                                                   CDL006
      *****************************************************************   CDL006
      /EJECT                                                              CDL006
      *****************************************************************   CDL006
      *                                                               *   CDL006
      *  SRCOMC - Subroutine to calculate accrued commission due      *   CDL006
      *           to work date since interest accrual control date.   *   CDL006
      *                                                               *   CDL006
      *  Called By : SRDELD and SRDCPI subroutines                    *   CDL006
      *                                                               *   CDL006
      *  Calls:                                                       *   CDL006
      *  GLINTC   - Interest calculation                              *   CDL006
      *  ZINTDY   - Calculate number or interest days                 *   CDL006
      *                                                               *   CDL006
      *  Input     : - WUDBEG (5 0) : start date of period.           *   CDL006
      *              - WUDEND (5 0) : end date of period.             *   CDL006
      *              - ZICALC (1 0) : interest calculation basis      *   CDL006
      *              - ZIAMT (15 0) : deal principal amount.          *   CDL006
      *                                                               *   CDL006
      *  Output    : - WUACSC       : commission amount.              *   CDL006
      *                                                               *   CDL006
      *****************************************************************   CDL006
      *                                                                   CDL006
     C           SRCOMC    BEGSR                                          CDL006
      *                                                                   CDL006
      ** Work fields definition.                                          CDL006
      *                                                                   CDL006
     C           *LIKE     DEFN PCPL      WUACSC                          CDL006
     C           *LIKE     DEFN IACD      WUDBEG                          CDL006
     C           *LIKE     DEFN IACD      WUDEND                          CDL006
     C           *LIKE     DEFN ZZINDY    ZFULPD                          CDL006
     C           *LIKE     DEFN ZZINDY    ZPARPD                          CDL006
      *                                                                   CDL006
      ** Initialize accrued commission amount.                            CDL006
      *                                                                   CDL006
     C                     Z-ADD0         WUACSC                          CDL006
      *                                                                   CDL006
      ** If Call Deposits.                                                CDL006
      *                                                                   CDL006
     C           HKTYPE    IFEQ 'DT'                                      CDL006
     C           HKTYPE    OREQ 'LT'                                      CDL006
      *                                                                   CDL006
      ** Commission amount calculation :                                  CDL006
      **                                                                  CDL006
      **   Principal                                                      CDL006
      ** (------------) x (WUDEND - WUDBEG) x (% current range)           CDL006
      **  Days of year                                                    CDL006
      **                                                                  CDL006
      ** Retrieve percentage of current range.                            CDL006
      *                                                                   CDL006
     C                     Z-ADD##PCPL    ZIAMT                           CDL006
     C                     Z-ADD1         I                               CDL006
     C           ZIAMT     LOKUPZRA,I                53  53               CDL006
      *                                                                   CDL006
     C           *IN53     IFEQ *OFF                                      CDL006
     C           ZIAMT     LOKUPZRA,I                  53                 CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     Z-ADDWUDBEG    ZIBEG                           CDL006
     C                     Z-ADDWUDEND    ZIEND                           CDL006
     C                     Z-ADDZCBCBS    ZICALC                          CDL006
     C                     MOVE ZPE,I     WUPERC  74                      CDL006
     C                     Z-ADDWUPERC    ZIRATE                          CDL006
      *                                                                   CDL006
     C                     EXSR GLINTC                                    CDL006
      *                                                                   CDL006
     C                     Z-ADDZINTR     WUACSC                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If Fixed Term deposit.                                           CDL006
      *                                                                   CDL006
     C           HKTYPE    IFEQ 'FT'                                      CDL006
      *                                                                   CDL006
      **     HKFCMA                                                       CDL006
      ** (-----------)  x  (WUDEND - WUDBEG)                              CDL006
      **  WMDAT - WVDAT                                                   CDL006
      **                                                                  CDL006
      ** To determine number of days between Value date and               CDL006
      ** Maturity date.                                                   CDL006
      *                                                                   CDL006
     C                     Z-ADDWVDAT     ZZBEG                           CDL006
     C                     Z-ADDWMDAT     ZZEND                           CDL006
     C                     EXSR ZINTDY                                    CDL006
     C                     Z-ADDZZINDY    ZFULPD                          CDL006
      *                                                                   CDL006
      ** To determine number of days between Interest Accrual             CDL006
      ** control date and Next interest date.                             CDL006
      *                                                                   CDL006
     C                     Z-ADDWUDBEG    ZZBEG                           CDL006
     C                     Z-ADDWUDEND    ZZEND                           CDL006
     C                     MOVE ##ICBS    ZZCALC                          CDL006
     C                     EXSR ZINTDY                                    CDL006
     C                     Z-ADDZZINDY    ZPARPD                          CDL006
      *                                                                   CDL006
     C           ZFULPD    IFNE 0                                         CDL006
     C           HKFCMA    MULT ZPARPD    WU18@0 180                      CDL006
     C           WU18@0    DIV  ZFULPD    WUACSC                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDSR                                          CDL006
      *                                                                   CDL006
      *****************************************************************   CDL006
      /EJECT                                                                                  CDL018
      *****************************************************************                       CDL018
      *                                                               *                       CDL018
      *  SRFSAC - Move incoming detaisl into layout of DLFSACPD       *                       CDL018
      *                                                               *                       CDL018
      *****************************************************************                       CDL018
     C           SRFSAC    BEGSR                                                              CDL018
      *                                                                                       CDL018
      **  Move receipt instructions from #FRECF                                               CDL018
     C                     MOVE FRUAC     RUAC                                                CDL018
     C                     MOVE FRAC01    RAC01                                               CDL018
     C                     MOVE FRAL01    RAL01                                               CDL018
     C                     MOVE FRPC01    RPC01                                               CDL018
     C                     MOVE FRAM01    RAM01                                               CDL018
     C                     MOVE FRAC02    RAC02                                               CDL018
     C                     MOVE FRAL02    RAL02                                               CDL018
     C                     MOVE FRPC02    RPC02                                               CDL018
     C                     MOVE FRAM02    RAM02                                               CDL018
     C                     MOVE FRAC03    RAC03                                               CDL018
     C                     MOVE FRAL03    RAL03                                               CDL018
     C                     MOVE FRPC03    RPC03                                               CDL018
     C                     MOVE FRAM03    RAM03                                               CDL018
     C                     MOVE FRAC04    RAC04                                               CDL018
     C                     MOVE FRAL04    RAL04                                               CDL018
     C                     MOVE FRPC04    RPC04                                               CDL018
     C                     MOVE FRAM04    RAM04                                               CDL018
     C                     MOVE FRAC05    RAC05                                               CDL018
     C                     MOVE FRAL05    RAL05                                               CDL018
     C                     MOVE FRPC05    RPC05                                               CDL018
     C                     MOVE FRAM05    RAM05                                               CDL018
     C                     MOVE FRAC06    RAC06                                               CDL018
     C                     MOVE FRAL06    RAL06                                               CDL018
     C                     MOVE FRPC06    RPC06                                               CDL018
     C                     MOVE FRAM06    RAM06                                               CDL018
     C                     MOVE FRAC07    RAC07                                               CDL018
     C                     MOVE FRAL07    RAL07                                               CDL018
     C                     MOVE FRPC07    RPC07                                               CDL018
     C                     MOVE FRAM07    RAM07                                               CDL018
     C                     MOVE FRAC08    RAC08                                               CDL018
     C                     MOVE FRAL08    RAL08                                               CDL018
     C                     MOVE FRPC08    RPC08                                               CDL018
     C                     MOVE FRAM08    RAM08                                               CDL018
     C                     MOVE FRAC09    RAC09                                               CDL018
     C                     MOVE FRAL09    RAL09                                               CDL018
     C                     MOVE FRPC09    RPC09                                               CDL018
     C                     MOVE FRAM09    RAM09                                               CDL018
     C                     MOVE FRAC10    RAC10                                               CDL018
     C                     MOVE FRAL10    RAL10                                               CDL018
     C                     MOVE FRPC10    RPC10                                               CDL018
     C                     MOVE FRAM10    RAM10                                               CDL018
     C                     MOVE FRAC11    RAC11                                               CDL018
     C                     MOVE FRAL11    RAL11                                               CDL018
     C                     MOVE FRPC11    RPC11                                               CDL018
     C                     MOVE FRAM11    RAM11                                               CDL018
     C                     MOVE FRAC12    RAC12                                               CDL018
     C                     MOVE FRAL12    RAL12                                               CDL018
     C                     MOVE FRPC12    RPC12                                               CDL018
     C                     MOVE FRAM12    RAM12                                               CDL018
      *                                                                                       CDL018
      **  Move pay instructions from #FPAYF                                                   CDL018
     C                     MOVE FPUAC     PUAC                                                CDL018
     C                     MOVE FPAC01    PAC01                                               CDL018
     C                     MOVE FPAL01    PAL01                                               CDL018
     C                     MOVE FPPC01    PPC01                                               CDL018
     C                     MOVE FPAM01    PAM01                                               CDL018
     C                     MOVE FPAC02    PAC02                                               CDL018
     C                     MOVE FPAL02    PAL02                                               CDL018
     C                     MOVE FPPC02    PPC02                                               CDL018
     C                     MOVE FPAM02    PAM02                                               CDL018
     C                     MOVE FPAC03    PAC03                                               CDL018
     C                     MOVE FPAL03    PAL03                                               CDL018
     C                     MOVE FPPC03    PPC03                                               CDL018
     C                     MOVE FPAM03    PAM03                                               CDL018
     C                     MOVE FPAC04    PAC04                                               CDL018
     C                     MOVE FPAL04    PAL04                                               CDL018
     C                     MOVE FPPC04    PPC04                                               CDL018
     C                     MOVE FPAM04    PAM04                                               CDL018
     C                     MOVE FPAC05    PAC05                                               CDL018
     C                     MOVE FPAL05    PAL05                                               CDL018
     C                     MOVE FPPC05    PPC05                                               CDL018
     C                     MOVE FPAM05    PAM05                                               CDL018
     C                     MOVE FPAC06    PAC06                                               CDL018
     C                     MOVE FPAL06    PAL06                                               CDL018
     C                     MOVE FPPC06    PPC06                                               CDL018
     C                     MOVE FPAM06    PAM06                                               CDL018
     C                     MOVE FPAC07    PAC07                                               CDL018
     C                     MOVE FPAL07    PAL07                                               CDL018
     C                     MOVE FPPC07    PPC07                                               CDL018
     C                     MOVE FPAM07    PAM07                                               CDL018
     C                     MOVE FPAC08    PAC08                                               CDL018
     C                     MOVE FPAL08    PAL08                                               CDL018
     C                     MOVE FPPC08    PPC08                                               CDL018
     C                     MOVE FPAM08    PAM08                                               CDL018
     C                     MOVE FPAC09    PAC09                                               CDL018
     C                     MOVE FPAL09    PAL09                                               CDL018
     C                     MOVE FPPC09    PPC09                                               CDL018
     C                     MOVE FPAM09    PAM09                                               CDL018
     C                     MOVE FPAC10    PAC10                                               CDL018
     C                     MOVE FPAL10    PAL10                                               CDL018
     C                     MOVE FPPC10    PPC10                                               CDL018
     C                     MOVE FPAM10    PAM10                                               CDL018
     C                     MOVE FPAC11    PAC11                                               CDL018
     C                     MOVE FPAL11    PAL11                                               CDL018
     C                     MOVE FPPC11    PPC11                                               CDL018
     C                     MOVE FPAM11    PAM11                                               CDL018
     C                     MOVE FPAC12    PAC12                                               CDL018
     C                     MOVE FPAL12    PAL12                                               CDL018
     C                     MOVE FPPC12    PPC12                                               CDL018
     C                     MOVE FPAM12    PAM12                                               CDL018
      *                                                                                       CDL018
     C                     ENDSR                                                              CDL018
      *****************************************************************                       CDL018
      /EJECT                                                                                  CDL018
      *****************************************************************                       CDL018
      *                                                               *                       CDL018
      *  SRMLAD - Proces Multiple Account Details                     *                       CDL018
      *                                                               *                       CDL018
      *****************************************************************                       CDL018
     C           SRMLAD    BEGSR                                                              CDL018
      *                                                                                       CDL018
      **  Move account details into arrays                                                    CDL018
     C                     MOVEA##ACDT    ##AC             Account                            CDL018
     C                     MOVEA##ALDT    ##AL             Allocation                         CDL018
     C                     Z-ADD##PC01    ##PC,1           Percentage                         CDL018
     C                     Z-ADD##PC02    ##PC,2                                              CDL018
     C                     Z-ADD##PC03    ##PC,3                                              CDL018
     C                     Z-ADD##PC04    ##PC,4                                              CDL018
     C                     Z-ADD##PC05    ##PC,5                                              CDL018
     C                     Z-ADD##PC06    ##PC,6                                              CDL018
     C                     Z-ADD##PC07    ##PC,7                                              CDL018
     C                     Z-ADD##PC08    ##PC,8                                              CDL018
     C                     Z-ADD##PC09    ##PC,9                                              CDL018
     C                     Z-ADD10        X                                                   CDL018
     C                     Z-ADD##PC10    ##PC,X                                              CDL018
     C                     Z-ADD11        X                                                   CDL018
     C                     Z-ADD##PC11    ##PC,X                                              CDL018
     C                     Z-ADD12        X                                                   CDL018
     C                     Z-ADD##PC12    ##PC,X                                              CDL018
     C                     Z-ADD##AM01    ##AM,1           Amount                             CDL018
     C                     Z-ADD##AM02    ##AM,2                                              CDL018
     C                     Z-ADD##AM03    ##AM,3                                              CDL018
     C                     Z-ADD##AM04    ##AM,4                                              CDL018
     C                     Z-ADD##AM05    ##AM,5                                              CDL018
     C                     Z-ADD##AM06    ##AM,6                                              CDL018
     C                     Z-ADD##AM07    ##AM,7                                              CDL018
     C                     Z-ADD##AM08    ##AM,8                                              CDL018
     C                     Z-ADD##AM09    ##AM,9                                              CDL018
     C                     Z-ADD10        X                                                   CDL018
     C                     Z-ADD##AM10    ##AM,X                                              CDL018
     C                     Z-ADD11        X                                                   CDL018
     C                     Z-ADD##AM11    ##AM,X                                              CDL018
     C                     Z-ADD12        X                                                   CDL018
     C                     Z-ADD##AM12    ##AM,X                                              CDL018
      *                                                                                       CDL018
      **  Reset work fields                                                                   CDL018
     C                     Z-ADD0         ##AMTA 130                                          CDL018
     C                     Z-ADD0         ##AMTB 193                                          CDL018
     C                     Z-ADD0         ##TOTE 130                                          CDL018
     C                     Z-ADD0         X                                                   CDL018
      *                                                                                       CDL018
      **  Save amount for update of on-line positions                                         CDL018
     C                     Z-ADD##AMT     ##WAMT 130                                          CDL018
      *                                                                                       CDL018
      **  Read multiple account details                                                       CDL018
     C           X         DOUGE12                                                            CDL018
     C                     ADD  1         X       30                                          CDL018
     C           ##AC,X    IFNE *BLANKS                                                       CDL018
     C                     EXSR SRMLAC                                                        CDL018
     C                     ENDIF                                                              CDL018
     C                     ENDDO                                                              CDL018
      *                                                                                       CDL018
      **  Determine difference in amount posted to original amount                            CDL018
     C           ##WAMT    SUB  ##TOTE    ##DIFF 130                                          CDL018
      *                                                                                       CDL018
      **  If any differenes then post to unallocated account                                  CDL018
     C           ##DIFF    IFNE 0                                                             CDL018
     C                     EXSR SRDIFF                                                        CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      *                                                                                       CDL018
     C                     ENDSR                                                              CDL018
      *****************************************************************                       CDL018
      /EJECT                                                                                  CDL018
      *****************************************************************                       CDL018
      *                                                               *                       CDL018
      *  SRMLAC - Process Multiple Account Details                    *                       CDL018
      *                                                               *                       CDL018
      *****************************************************************                       CDL018
     C           SRMLAC    BEGSR                                                              CDL018
      *                                                                                       CDL018
      **  Reset work fields                                                                   CDL018
     C                     Z-ADD0         ##AMTA 130                                          CDL018
     C                     Z-ADD0         ##AMTB 193                                          CDL018
      *                                                                                       CDL018
      ** Set settlement account and branch if settlement type 14                              CDL018
     C           ##SETM    IFEQ '14'                                                          CDL018
     C                     MOVEL##AC,X    ##ACNO                                              CDL018
      *                                                                                       CDL018
      ** Access the Account Details using the Retail account key.                             CDL018
     C                     MOVEL##ACNO    @RETL                                               CDL018
     C                     CALL 'AOACCTR0'                                                    CDL018
     C                     PARM *BLANKS   @RTCD                                               CDL018
     C                     PARM '*KEY   ' @OPTN                                               CDL018
     C                     PARM           @RETL                                               CDL018
     C                     PARM *BLANKS   @CNUM                                               CDL018
     C                     PARM *BLANKS   @CYCD                                               CDL018
     C                     PARM *BLANKS   @ACCD                                               CDL018
     C                     PARM *BLANKS   @ACSN                                               CDL018
     C                     PARM *BLANKS   @DSNB                                               CDL018
     C           SDACNT    PARM SDACNT    DSSDY                                               CDL018
      *                                                                                       CDL018
      **  Database error if account not found                                                 CDL018
     C           @RTCD     IFNE *BLANKS                                                       CDL018
     C           *LOCK     IN   LDA                                                           CDL018
     C                     MOVE 'ACCNTAB 'DBFILE           *************                      CDL018
     C                     MOVEL'916'     DBASE            *DBERROR 916*                      CDL018
     C                     MOVEL##AC,X    DBKEY            *************                      CDL018
     C                     OUT  LDA                                                           CDL018
     C                     EXSR SRERR                                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      **  Set branch code for retail account number                                           CDL018
     C                     MOVE NBRCA     ##BRCA                                              CDL018
      *                                                                                       CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      ** Set settlement account and branch if settlement type 05                              CDL018
     C           ##SETM    IFEQ '05'                                                          CDL018
     C                     MOVEL##AC,X    ##BRCA                                              CDL018
     C                     MOVE ##AC,X    #WRK18 18                                           CDL018
     C                     MOVEL#WRK18    ##SETA                                              CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      *                                                                                       CDL018
      **  Process details according to amount allocation                                      CDL018
     C                     SELEC                                                              CDL018
      *                                                                                       CDL018
      **  Intrest allocation and amount to be posted is interest                              CDL018
     C           ##AL,X    WHEQ 'I'                                                           CDL018
     C           ##PIID    ANDEQ'I'                                                           CDL018
      *                                                                                       CDL018
      **    Amount allocation                                                                 CDL018
     C           ##AM,X    IFNE 0                                                             CDL018
      *                                                                                       CDL018
      **    If interest to maturity then post full amount                                     CDL018
     C           ##MIID    IFEQ 'M'                                                           CDL018
     C                     Z-ADD##AM,X    ##AMTA                                              CDL018
     C                     ELSE                                                               CDL018
      *                                                                                       CDL018
      **    If interest is to interim interest date then calculate                            CDL018
      **    amount to post to account using a percentage                                      CDL018
     C           ##AM,X    DIV  HKMTTI    ##PCTG 126H                                         CDL018
     C           ##PCTG    DIV  100       ##PC,X    H                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      **    Percentage allocation                                                             CDL018
     C           ##PC,X    IFNE 0                                                             CDL018
     C           ##WAMT    MULT ##PC,X    ##AMTB    H                                         CDL018
     C           ##AMTB    DIV  100       ##AMTA    H                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      *                                                                                       CDL018
      **  Principal Allocation and amount is principal                                        CDL018
     C           ##AL,X    WHEQ 'P'                                                           CDL018
     C           ##PIID    ANDEQ'P'                                                           CDL018
      *                                                                                       CDL018
      **    If amount allocation then post amount                                             CDL018
     C           ##AM,X    IFNE 0                                                             CDL018
     C                     Z-ADD##AM,X    ##AMTA                                              CDL018
     C                     ELSE                                                               CDL018
      *                                                                                       CDL018
      **    Otherwise percentage allocation                                                   CDL018
     C           ##WAMT    MULT ##PC,X    ##AMTB    H                                         CDL018
     C           ##AMTB    DIV  100       ##AMTA    H                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      *                                                                                       CDL018
      **  Interest & Principal Allocation and amount is interest                              CDL018
     C           ##AL,X    WHEQ 'B'                                                           CDL018
     C           ##PIID    ANDEQ'I'                                                           CDL018
      *                                                                                       CDL018
      **    Amount allocation                                                                 CDL018
     C           ##AM,X    IFNE 0                                                             CDL018
      *                                                                                       CDL018
      *     Calculate Amount allocation as a percentage of the total amount                   238009
      *                                                                                       238009
      ******If*interest to maturity then post full amount                              CDL018 238009
     C********** ##MIID    IFEQ 'M'                                                    CDL018 238009
     C**********           Z-ADD##AM,X    ##AMTA                                       CDL018 238009
     C**********           ELSE                                                        CDL018 238009
      *                                                                                       CDL018
      ******If*interest is to interim interest date then calculate                     CDL018 238009
      ******amount to post to account using a percentage                               CDL018 238009
      *     HKMTTI is opposite sign to HKAMNP so subtract to get total                        238009
     C********** HKAMNP    ADD  HKMTTI    ##TOTL 150                                   CDL018 238009
     C           HKAMNP    SUB  HKMTTI    ##TOTL 150                                          238009
     C           ##AM,X    DIV  ##TOTL    ##PCTG    H                                         CDL018
      *     ##PCTG is always less than 1 so multiply to get percentage                        238009
     C********** ##PCTG    DIV  100       ##PC,X    H                                  CDL018 238009
     C           ##PCTG    MULT 100       ##PC,X    H                                         238009
     C**********           ENDIF                                                       CDL018 238009
      *                                                                                       CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      **    Percentage allocation                                                             CDL018
     C           ##PC,X    IFNE 0                                                             CDL018
     C           ##WAMT    MULT ##PC,X    ##AMTB                                              CDL018
     C           ##AMTB    DIV  100       ##AMTA    H                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      *                                                                                       CDL018
      **  Interest & Principal Allocation and amount is principal                             CDL018
     C           ##AL,X    WHEQ 'B'                                                           CDL018
     C           ##PIID    ANDEQ'P'                                                           CDL018
      *                                                                                       CDL018
      **    If amount allocation then post amount                                             CDL018
     C           ##AM,X    IFNE 0                                                             CDL018
      *                                                                                       238009
      *     Calculate Amount allocation as a percentage of the total amount                   238009
      *                                                                                       238009
     C**********           Z-ADD##AM,X    ##AMTA                                       CDL018 238009
     C           HKAMNP    SUB  HKMTTI    ##TOTL 150                                          238009
     C           ##AM,X    DIV  ##TOTL    ##PCTG    H                                         238009
     C           ##PCTG    MULT 100       ##PC,X    H                                         238009
     C**********           ELSE                                                        CDL018 238009
     C                     ENDIF                                                              238009
      *                                                                                       CDL018
      **    Otherwise percentage allocation                                                   CDL018
     C           ##PC,X    IFNE 0                                                             238009
     C           ##WAMT    MULT ##PC,X    ##AMTB    H                                         CDL018
     C           ##AMTB    DIV  100       ##AMTA    H                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
     C                     ENDSL                                                              CDL018
      *                                                                                       CDL018
      **    Accumulate total amount for shadow posting                                        CDL018
     C                     ADD  ##AMTA    ##TOTE                                              CDL018
      *                                                                                       CDL018
      **    Update on line positions                                                          CDL018
     C                     Z-ADD##AMTA    ##AMT                                               CDL018
     C                     EXSR SRMOVE                                                        CDL018
      *                                                                                       CDL018
     C                     ENDSR                                                              CDL018
      *****************************************************************                       CDL018
      /EJECT                                                                                  CDL018
      *****************************************************************                       CDL018
      *                                                               *                       CDL018
      *  SRDIFF - Post any differences in original amount and         *                       CDL018
      *           total amount posted to multiple accounts            *                       CDL018
      *                                                               *                       CDL018
      *****************************************************************                       CDL018
     C           SRDIFF    BEGSR                                                              CDL018
      *                                                                                       CDL018
      ** Set settlement account and branch if settlement type 14                              CDL018
     C           ##SETM    IFEQ '14'                                                          CDL018
     C                     MOVEL##UNAC    ##ACNO                                              CDL018
      *                                                                                       CDL018
      ** Access the Account Details using the Retail account key.                             CDL018
     C                     MOVEL##ACNO    @RETL                                               CDL018
     C                     CALL 'AOACCTR0'                                                    CDL018
     C                     PARM *BLANKS   @RTCD                                               CDL018
     C                     PARM '*KEY   ' @OPTN                                               CDL018
     C                     PARM           @RETL                                               CDL018
     C                     PARM *BLANKS   @CNUM                                               CDL018
     C                     PARM *BLANKS   @CYCD                                               CDL018
     C                     PARM *BLANKS   @ACCD                                               CDL018
     C                     PARM *BLANKS   @ACSN                                               CDL018
     C                     PARM *BLANKS   @DSNB                                               CDL018
     C           SDACNT    PARM SDACNT    DSSDY                                               CDL018
      *                                                                                       CDL018
      **  Database error if account not found                                                 CDL018
     C           @RTCD     IFNE *BLANKS                                                       CDL018
     C           *LOCK     IN   LDA                                                           CDL018
     C                     MOVE 'ACCNTAB 'DBFILE           *************                      CDL018
     C                     MOVEL'917'     DBASE            *DBERROR 917*                      CDL018
     C                     MOVEL##AC,X    DBKEY            *************                      CDL018
     C                     OUT  LDA                                                           CDL018
     C                     EXSR SRERR                                                         CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      **  Set branch code for retail account number                                           CDL018
     C                     MOVE NBRCA     ##BRCA                                              CDL018
      *                                                                                       CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      ** Set settlement account and branch if settlement type 05                              CDL018
     C           ##SETM    IFEQ '05'                                                          CDL018
     C                     MOVEL##UNAC    ##BRCA                                              CDL018
     C                     MOVE ##UNAC    #WRK18 18                                           CDL018
     C                     MOVEL#WRK18    ##SETA                                              CDL018
     C                     ENDIF                                                              CDL018
      *                                                                                       CDL018
      **    Update on line positions                                                          CDL018
     C                     Z-ADD##DIFF    ##AMT                                               CDL018
     C                     EXSR SRMOVE                                                        CDL018
      *                                                                                       CDL018
     C                     ENDSR                                                              CDL018
      *****************************************************************                       CDL018
      /EJECT                                                                                  CDL018
     C/COPY WNCPYSRC,AOOUMMU0R4
      *****************************************************************                       CDL033
      /EJECT                                                                                  CDL033
      *****************************************************************                       CDL033
      *                                                               *                       CDL033
      *  SRFRC1 - Processing #1 for CF deals                          *                       CDL033
      *         - Value date processing                               *                       CDL033
      *         - Next interest date / maturity date processing       *                       CDL033
      *                                                               *                       CDL033
      *****************************************************************                       CDL033
      *                                                                                       CDL033
     C           SRFRC1    BEGSR                                                              CDL033
      *                                                                                       CDL033
      ** Reset processing flag to blank.                                                      CDL033
      *                                                                                       CDL033
     C                     MOVE *BLANK    WCFLAG  1                                           CDL033
      *                                                                                       CDL033
      ** Value date processing.                                                               CDL033
      *                                                                                       CDL033
      ** Set up effective rate for value date if this rate                                    CDL033
      ** has to be set to the fixed base rate.                                                CDL033
      *                                                                                       CDL033
     C                     EXSR SRFRC3                                                        CDL033
      *                                                                                       CDL033
      ** Process rate change date.                                                            CDL033
      *                                                                                       CDL033
     C           XKRCDT    IFLE WVDAT                                                         CDL033
     C                     EXSR SRFRC2                                                        CDL033
     C                     MOVE 'Y'       WCFLAG                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Interest date processing.                                                            CDL033
      *                                                                                       CDL033
      ** Process rate change date if it is not yet processed                                  CDL033
      ** before.                                                                              CDL033
      *                                                                                       CDL033
     C           XKRCDT    IFLE ##VDAT                                                        CDL033
     C           WCFLAG    ANDEQ*BLANK                                                        CDL033
     C                     EXSR SRFRC2                                                        CDL033
     C                     MOVE 'Y'       WCFLAG                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Update accrued interest to control date.                                             CDL033
      *                                                                                       CDL033
     C           ##VDAT    IFGT ##IACD                                                        CDL033
      *                                                                                       CDL033
     C                     Z-ADD##IACD    ZCBSDT                                              CDL033
     C                     Z-ADD##VDAT    ZCBEDT                                              CDL033
     C                     Z-ADD##LPCP    ZDLAMT                                              CDL033
     C                     Z-ADD##LINT    ZDLRAT                                              CDL033
     C                     EXSR ZDLINT                                                        CDL033
      *                                                                                       CDL033
     C           ##AITC    ADD  ZDLOUT    ##AITC                                              CDL033
      *                                                                                       CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C           EFRC1     ENDSR                                                              CDL033
      *                                                                                       CDL033
      *****************************************************************                       CDL093
      /EJECT                                                                                  CDL093
      *****************************************************************                       CDL093
      *                                                               *                       CDL093
      *  CHKFEB - Check if there is Feb29 within the Start & End dates*                       CDL093
      *                                                               *                       CDL093
      *****************************************************************                       CDL093
      *                                                                                       CDL093
     C           CHKFEB    BEGSR                                                              CDL093
      *                                                                                       CDL093
     C                     Z-ADD*ZEROS    PSTART  50                                          CDL093
     C                     Z-ADD*ZEROS    PEND    50                                          CDL093
     C                     MOVE *BLANKS   FEBPRC  1                                           CDL093
      *                                                                                       CDL093
     C                     Z-ADD##IACD    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZSDATE  80                                          CDL093
      *                                                                                       CDL093
     C                     Z-ADD##VDAT    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZEDATE  80                                          CDL093
      *                                                                                       CDL093
     C                     Z-ADDZSDATE    ZZDATA                                              CDL093
     C                     Z-ADDZEDATE    ZZDATB                                              CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C           #29FEB    IFEQ 'Y'                                                           CDL093
     C                     MOVE 'Y'       FEBPRC                                              CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     ENDSR                                                              CDL093
      *                                                                                       CDL093
      *****************************************************************                    MD031062A
      *                                                               *                    MD031062A
      *  SRCEUT - Calculate EU Tax Amount                             *                    MD031062A
      *                                                               *                    MD031062A
      *****************************************************************                    MD031062A
     C           SRCEUT    BEGSR                                                           MD031062A
      *                                                                                    MD031062A
     C                     Z-ADD*ZEROS    TAXA                                             MD031062A
      *                                                                                    MD031062A
      ** Calculate taxable interest amount                                                 MD031062A
      *                                                                                    MD031062A
     C           EWTRT1    IFEQ '1'                                                        MD031062A
     C           @@STRD    ANDLTEWEDT1                                                     MD031062A
     C           @@ENDD    SUB  @@STRD    WDY1    50                                       MD031062A
     C           @@ENDD    SUB  EWEDT1    WDY2    50                                       MD031062A
     C           WINTD     MULT WDY2      @@TOTI    H                                      MD031062A
     C                     DIV  WDY1      @@TOTI    H                                      MD031062A
      *                                                                                    MD031062A
     C           @@ENDD    IFLT EWEDT1                                                     MD031062A
     C                     Z-ADD*ZERO     @@TOTI                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ELSE                                                            MD031062A
     C                     Z-ADDWINTD     @@TOTI                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     MOVE CNUM      WCNUM   6                                        MD031062A
     C                     MOVE DLNO      WDLNO   6                                        MD031062A
      *                                                                                    MD031062A
      ** Call EU Tax Calculation for Private Individual.                                   MD031062A
      *                                                                                    MD031062A
     C                     CALL 'ZATXCLPI'                                                 MD031062A
      *                                                                                    MD031062A
     C                     PARM 'D'       @@MODI  1                                        MD031062A
     C                     PARM WDLNO     @@TRRF 18                                        MD031062A
     C                     PARM BRCA      @@BRCA  3                                        MD031062A
     C                     PARM WCNUM     @@CUST  6                                        MD031062A
     C                     PARM           @@STRD  50                                       MD031062A
     C                     PARM           @@ENDD  50                                       MD031062A
     C                     PARM           @@TOTI 150                                       MD031062A
     C                     PARM *ZERO     @@TAXR  64                                       MD031062A
     C                     PARM CCY       @@OCCY  3                                        MD031062A
     C                     PARM           PINTH   1                                        MD031062A
      *                                                                                    MD031062A
      ** Output Parameters                                                                 MD031062A
      *                                                                                    MD031062A
     C                     PARM           @@IAED 150                                       MD031062A
     C                     PARM           @@TAXA 150                                       MD031062A
     C                     PARM           @@TOTO 150                                       MD031062A
     C                     PARM           @@TXCY  3                                        MD031062A
     C                     PARM           @@CTAX  2                                        MD031062A
     C                     PARM           @@TXBS  2                                        MD031062A
     C                     PARM           @@WTAC 100                                       MD031062A
     C                     PARM           @@COLC  2                                        MD031062A
     C                     PARM           @@STAT  5                                        MD031062A
     C                     PARM           @@TRTE  1                                        MD031062A
     C                     PARM           @@TXR1  64                                       MD031062A
     C                     PARM           @@KEY  10                                        MD031062A
     C                     PARM           @@FILE 10                                        MD031062A
     C                     PARM           @@RTRN  7                                        MD031062A
     C           SDTXPA    PARM SDTXPA    DSSDY                                            MD031062A
      *                                                                                    MD031062A
     C                     SELEC                                                           MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    WHEQ 'ERROR'                                                    MD031062A
     C           *LOCK     IN   LDA                                                        MD031062A
     C                     MOVEL@@FILE    DBFILE                                           MD031062A
     C                     MOVEL@@KEY     DBKEY                                            MD031062A
     C                     Z-ADD107       DBASE                                            MD031062A
     C                     OUT  LDA                                                        MD031062A
     C                     EXSR SRERR                                                      MD031062A
     C                     GOTO ECEUT                                                      MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    WHNE 'JOINT'                                                    MD031062A
     C           @@TOTO    IFNE *ZERO                                                      MD031062A
     C           @@STAT    IFEQ 'TAXAB'                                                    MD031062A
     C           @@STAT    OREQ 'DISCL'                                                    MD031062A
     C           @@STAT    OREQ 'SELF '                                                    MD031062A
     C                     Z-ADD@@TAXA    TAXA                                             MD031062A
     C           CER048    IFEQ 'Y'                                                        MD031062A
     C                     ADD  PSTXA     TAXA                                             MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Add Third Tax if CER054 is switched ON.                                           MD031062A
      *                                                                                    MD031062A
     C           CER054    IFEQ 'Y'                                                        MD031062A
     C                     ADD  PTTXA     TAXA                                             MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    WHEQ 'JOINT'                                                    MD031062A
     C                     EXSR SRCALJ                                                     MD031062A
     C                     ENDSL                                                           MD031062A
      *                                                                                    MD031062A
     C*                    ENDIF                                                           MD031062A
     C*                    ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      *                                                                                    MD031062A
     C           ECEUT     ENDSR                                                           MD031062A
      *****************************************************************                    MD031062A
      /EJECT                                                                               MD031062A
      *****************************************************************                    MD031062A
      *                                                               *                    MD031062A
      *  SRCALJ - Calculate EU Tax Amount for Joint A/c Members.      *                    MD031062A
      *                                                               *                    MD031062A
      *****************************************************************                    MD031062A
     C           SRCALJ    BEGSR                                                           MD031062A
      *                                                                                    MD031062A
     C                     MOVE *IN21     WIN21   1                                        MD031062A
      *                                                                                    MD031062A
     C           WCNUM     SETLLSDJACCLB                                                   MD031062A
     C           WCNUM     READESDJACCLB                 21                                MD031062A
      *                                                                                    MD031062A
     C                     Z-ADD*ZERO     WTAXA                                            MD031062A
      *                                                                                    MD031062A
     C           *IN21     DOUEQ*ON                                                        MD031062A
      *                                                                                    MD031062A
     C           *IN21     IFEQ *ON                                                        MD031062A
     C                     MOVELWCNUM     JCCUST                                           MD031062A
     C                     MOVE *BLANKS   JCNAHO                                           MD031062A
     C                     MOVEL'1/1'     JCINVP                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     EXSR SRCZJA                                                     MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    IFEQ 'ERROR'                                                    MD031062A
     C           *LOCK     IN   LDA                                                        MD031062A
     C                     MOVEL@@FILE    DBFILE                                           MD031062A
     C                     MOVEL@@KEY     DBKEY                                            MD031062A
     C                     Z-ADD108       DBASE                                            MD031062A
     C                     OUT  LDA                                                        MD031062A
     C                     EXSR SRERR                                                      MD031062A
     C                     MOVE WIN21     *IN21                                            MD031062A
     C                     GOTO ECALJ                                                      MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           @@TOTO    IFNE *ZERO                                                      MD031062A
     C           @@STAT    IFEQ 'TAXAB'                                                    MD031062A
     C           @@STAT    OREQ 'DISCL'                                                    MD031062A
     C           @@STAT    OREQ 'SELF '                                                    MD031062A
     C                     ADD  @@TAXA    WTAXA  150                                       MD031062A
     C           CER048    IFEQ 'Y'                                                        MD031062A
     C           WELGTX    ANDEQ'L'                                                        MD031062A
     C                     ADD  PSTXA     WTAXA                                            MD031062A
     C           CER054    IFEQ 'Y'                                                        MD031062A
     C                     ADD  PTTXA     WTAXA                                            MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    IFEQ 'NOTAX'                                                    MD031062A
     C           @@RTRN    OREQ 'TAXAB'                                                    MD031062A
     C           WCNUM     READESDJACCLB                 21                                MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           @@RTRN    IFEQ 'LAST '                                                    MD031062A
     C                     MOVE *ON       *IN21                                            MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDDO                                                           MD031062A
      *                                                                                    MD031062A
     C                     MOVE WIN21     *IN21                                            MD031062A
      *                                                                                    MD031062A
     C                     ADD  WTAXA     TAXA                                             MD031062A
      *                                                                                    MD031062A
     C           ECALJ     ENDSR                                                           MD031062A
      *****************************************************************                    MD031062A
      /EJECT                                                                               MD031062A
      *****************************************************************                    MD031062A
      *                                                               *                    MD031062A
      *  SRCZJA - Calls EU Tax Calculation for Joint Accounts.        *                    MD031062A
      *                                                               *                    MD031062A
      *****************************************************************                    MD031062A
     C           SRCZJA    BEGSR                                                           MD031062A
      *                                                                                    MD031062A
     C                     CALL 'ZATXCLJA'                                                 MD031062A
      *                                                                                    MD031062A
     C                     PARM 'D'       @@MODI                                           MD031062A
     C                     PARM WDLNO     @@TRRF                                           MD031062A
     C                     PARM BRCA      @@BRCA                                           MD031062A
     C                     PARM WCNUM     @@JANO  6                                        MD031062A
     C                     PARM JCCUST    @@CUST                                           MD031062A
     C                     PARM JCNAHO    @@NARF 10                                        MD031062A
     C                     PARM JCINVP    @@INVP 10                                        MD031062A
     C                     PARM JCPAHT    PPAHT   1                                        MD031062A
     C                     PARM           @@STRD                                           MD031062A
     C                     PARM           @@ENDD                                           MD031062A
     C                     PARM           @@TOTI                                           MD031062A
     C                     PARM *ZERO     @@TAXR                                           MD031062A
     C                     PARM CCY       @@OCCY                                           MD031062A
     C                     PARM           PINTH   1                                        MD031062A
      *                                                                                    MD031062A
      ** Output Parameters                                                                 MD031062A
      *                                                                                    MD031062A
     C                     PARM           @@IAED                                           MD031062A
     C                     PARM           @@TAXA                                           MD031062A
     C                     PARM           @@TOTO                                           MD031062A
     C                     PARM           @@TXCY                                           MD031062A
     C                     PARM           @@CTAX                                           MD031062A
     C                     PARM           @@TXBS                                           MD031062A
     C                     PARM           @@WTAC                                           MD031062A
     C                     PARM           @@COLC                                           MD031062A
     C                     PARM           @@STAT                                           MD031062A
     C                     PARM           @@TRTE                                           MD031062A
     C                     PARM           @@TXR1                                           MD031062A
     C                     PARM           @@JAMG  1                                        MD031062A
     C                     PARM           @@KEY                                            MD031062A
     C                     PARM           @@FILE                                           MD031062A
     C                     PARM           @@RTRN                                           MD031062A
     C           SDTXPA    PARM SDTXPA    DSSDY                                            MD031062A
      *                                                                                    MD031062A
     C                     ENDSR                                                           MD031062A
      *****************************************************************                    MD031062A
      *                                                               *                    MD031062A
      *  SRCHKD - Subroutine to check the effectivity date            *                    MD031062A
      *                                                               *                    MD031062A
      *****************************************************************                    MD031062A
     C           SRCHKD    BEGSR                                                           MD031062A
      *                                                                                    MD031062A
      ** Access the Branch details to get location code                                    MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOBRCHR0'                                                 MD031062A
     C                     PARM '*MSG    'PRTCD                                            MD031062A
     C                     PARM '*KEY    'POPTN                                            MD031062A
     C                     PARM BRCA      PDSNB   3                                        MD031062A
     C           SDBRCH    PARM SDBRCH    DSFDY                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE *BLANKS                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Access the Country of Tax using the branch's location code                        MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOLOCNR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM '*KEY   ' POPTN                                            MD031062A
     C                     PARM A8LCCD    PLOCN   3                                        MD031062A
     C           SDLOCN    PARM SDLOCN    DSFDY                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE *BLANKS                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Retreive the country of residence of the customer                                 MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOCUSTR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM '*KEY   ' POPTN                                            MD031062A
     C                     PARM WCNUM     PCNUM  10                                        MD031062A
     C                     PARM           PKEYS   7                                        MD031062A
     C           SDCUST    PARM SDCUST    DSSDY                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE *BLANKS                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Retrieve effective date                                                           MD031062A
      *                                                                                    MD031062A
     C                     CALL 'AOCTTXR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM '*KEY   ' POPTN                                            MD031062A
     C                     PARM DVCNCD    PCTRT   2                                        MD031062A
     C                     PARM BBCOLC    PCTRR   2                                        MD031062A
     C           SDCTTX    PARM SDCTTX    DSFDY                                            MD031062A
      *                                                                                    MD031062A
      ** If no record is found, access with country of tax only                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE *BLANKS                                                    MD031062A
     C                     CALL 'AOCTTXR0'                                                 MD031062A
     C                     PARM *BLANKS   PRTCD                                            MD031062A
     C                     PARM '*KEY   ' POPTN                                            MD031062A
     C                     PARM DVCNCD    PCTRT                                            MD031062A
     C                     PARM *BLANKS   PCTRR                                            MD031062A
     C           SDCTTX    PARM SDCTTX    DSFDY                                            MD031062A
      *                                                                                    MD031062A
     C           PRTCD     IFNE *BLANKS                                                    MD031062A
     C                     ENDIF                                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
      ** Set Flag EU, Local or German                                                      MD031062A
      *                                                                                    MD031062A
     C           BBCOLC    IFNE EWCTRT                                                     MD031062A
     C                     MOVE 'E'       WELGTX  1                                        MD031062A
     C                     ELSE                                                            MD031062A
      *                                                                                    MD031062A
     C           CER048    IFEQ 'Y'                                                        MD031062A
      *                                                                                    MD031062A
     C           BBCOLC    IFEQ EWCTRT                                                     MD031062A
     C           EWTHMD    ANDEQ'Y'                                                        MD031062A
     C                     MOVE 'G'       WELGTX                                           MD031062A
     C                     ELSE                                                            MD031062A
     C                     MOVE 'L'       WELGTX                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ELSE                                                            MD031062A
      *                                                                                    MD031062A
     C                     MOVE 'G'       WELGTX                                           MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C           WKMDAT    IFLT EWEDT1                                                     MD031062A
     C           WELGTX    OREQ 'E'                                                        MD031062A
     C           TAXI      OREQ 'N'                                                        MD031062A
     C                     MOVE 'Y'       WSKIP   1                                        MD031062A
     C                     ELSE                                                            MD031062A
     C                     MOVE 'N'       WSKIP                                            MD031062A
     C                     ENDIF                                                           MD031062A
      *                                                                                    MD031062A
     C                     ENDSR                                                           MD031062A
      *****************************************************************                    MD031062A
      *****************************************************************                       CDL033
      /EJECT                                                                                  CDL033
      *****************************************************************                       CDL033
      *                                                               *                       CDL033
      *  SRFRC2 - Processing #2 for CF deals                          *                       CDL033
      *         - Rate change processing:                             *                       CDL033
      *           (1) update accrued interest to control date         *                       CDL033
      *           (2) set effective rate to fixed base rate           *                       CDL033
      *                                                               *                       CDL033
      *****************************************************************                       CDL033
      *                                                                                       CDL033
     C           SRFRC2    BEGSR                                                              CDL033
      *                                                                                       CDL033
      ** Bypass processing in this subroutine if rate change                                  CDL033
      ** date is zero.                                                                        CDL033
      *                                                                                       CDL033
     C           XKRCDT    IFEQ *ZERO                                                         CDL033
     C                     GOTO EFRC2                                                         CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Update accrued interest to control date.                                             CDL033
      *                                                                                       CDL033
     C                     Z-ADD##IACD    ZCBSDT                                              CDL033
     C                     Z-ADDXKRCDT    ZCBEDT                                              CDL033
     C                     Z-ADD##LPCP    ZDLAMT                                              CDL033
     C                     Z-ADD##LINT    ZDLRAT                                              CDL033
     C                     EXSR ZDLINT                                                        CDL033
      *                                                                                       CDL033
     C           ##AITC    ADD  ZDLOUT    ##AITC                                              CDL033
      *                                                                                       CDL033
      ** Reset interest accrual control date to rate change                                   CDL033
      ** date.                                                                                CDL033
      *                                                                                       CDL033
     C                     Z-ADDXKRCDT    ##IACD                                              CDL033
      *                                                                                       CDL033
      ** Update effective rate only if base rate has been                                     CDL033
      ** fixed.                                                                               CDL033
      *                                                                                       CDL033
     C           XKINFF    IFEQ 'Y'                                                           CDL033
     C           XKBSRF    ADD  HKSPRD    ##LINT                                              CDL033
     C           ##LINT    IFLT *ZERO                                                         CDL033
     C                     Z-ADD*ZERO     ##LINT                                              CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
     C           EFRC2     ENDSR                                                              CDL033
      *                                                                                       CDL033
      *****************************************************************                       CDL033
      /EJECT                                                                                  CDL033
      *****************************************************************                       CDL033
      *                                                               *                       CDL033
      *  SRFRC3 - Processing #3 for CF deals                          *                       CDL033
      *         - Value date processing:                              *                       CDL033
      *           (1) set effective rate to fixed base rate           *                       CDL033
      *                                                               *                       CDL033
      *****************************************************************                       CDL033
      *                                                                                       CDL033
     C           SRFRC3    BEGSR                                                              CDL033
      *                                                                                       CDL033
      ** Bypass processing if rate for value date has been                                    CDL033
      ** set already.                                                                         CDL033
      *                                                                                       CDL033
     C           XKBSVF    IFEQ 'Y'                                                           CDL033
     C                     GOTO EFRC3                                                         CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Update effective rate only if base rate has been                                     CDL033
      ** fixed.                                                                               CDL033
      *                                                                                       CDL033
     C           XKINFF    IFEQ 'Y'                                                           CDL033
     C           XKBSRF    ADD  HKSPRD    ##LINT                                              CDL033
     C           ##LINT    IFLT *ZERO                                                         CDL033
     C                     Z-ADD*ZERO     ##LINT                                              CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Reset the rate fix date flag.                                                        CDL033
      *                                                                                       CDL033
     C                     MOVE *BLANK    XKINFF                                              CDL033
      *                                                                                       CDL033
     C           EFRC3     ENDSR                                                              CDL033
      *                                                                                       CDL033
      *****************************************************************                       CDL033
      *                                                                                       CDL033
      /EJECT                                                                                  220013
      *****************************************************************                       220013
      *                                                                                       220013
      *  CALTAX - CALCULATE BRT TAX AMOUNT                                                    220013
      *                                                                                       220013
      ********************************************************************                    220013
      *                                                                                       220013
     C           CALTAX    BEGSR                                                              220013
      *                                                                                       220013
      ** CALCULATE TAX AMOUNT USING BRT RATES                                                 220013
      *                                                                                       220013
      ** CHAIN TO SDCBRTL1 FOR TAX INDICATOR                                                  220013
      *                                                                                       220013
     C********** CNUM      CHAINSDCBRTL1             18                                220013 220013
     C           HKCNUM    CHAINSDCBRTL1             18                                       220013
     C           *IN18     IFEQ '1'                                                           220013
     C                     MOVEL'SDCBRTPD'DBFILE            *************                     220013
     C                     MOVEL'916'     DBASE             * DBERR 916 *                     220013
     C                     EXSR SRERR                       *************                     220013
     C                     END                                                                220013
      *                                                                                       220013
      ** IF THE EVENT DATE IS GREATER THAN OR EQUAL TO THE EFFECTIVE DATE,                    220013
      ** USE THE BRT RATE ELSE USE THE PREVIOUS RATE                                          220013
      *                                                                                       220013
     C           WKMDAT    IFGE DEFF                                                          220013
     C           TAXIND    ANDEQ'L'                                                           220013
     C           WINTD     MULT BRTR      TAXA      H                                         220013
     C           TAXA      DIV  100       TAXA      H                                         220013
     C                     END                                                                220013
      *                                                                                       220013
     C           WKMDAT    IFGE DEFF                                                          220013
     C           TAXIND    ANDEQ'P'                                                           220013
     C           WINTD     MULT WBRTR     TAXA      H                                         220013
     C           TAXA      DIV  100       TAXA      H                                         220013
     C                     END                                                                220013
      *                                                                                       220013
     C           WKMDAT    IFLT DEFF                                                          220013
     C           TAXIND    ANDEQ'L'                                                           220013
     C           WINTD     MULT PBRTR     TAXA      H                                         220013
     C           TAXA      DIV  100       TAXA      H                                         220013
     C                     END                                                                220013
      *                                                                                       220013
     C           WKMDAT    IFLT DEFF                                                          220013
     C           TAXIND    ANDEQ'P'                                                           220013
     C           WINTD     MULT WPBRTR    TAXA      H                                         220013
     C           TAXA      DIV  100       TAXA      H                                         220013
     C                     END                                                                220013
      *                                                                                       220013
     C                     ENDSR                                                              220013
      *****************************************************************                       220013
      *                                                               *                       CER049
      *  SRSTAX - Generate Stamp tax shadow posting                   *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C********** DTYP      IFEQ 'IP'                                                 CER049 AR821086
     C********** DTYP      OREQ 'TI'                                                 CER049 AR821086
     C********** DTYP      OREQ 'CD'                                                 CER049 AR821086
     C********** DTYP      OREQ 'CL'                                                 CER049 AR821086
     C           WDTYP     IFEQ 'IP'                                                        AR821086
     C           WDTYP     OREQ 'TI'                                                        AR821086
     C           WDTYP     OREQ 'CD'                                                        AR821086
     C           WDTYP     OREQ 'CL'                                                        AR821086
     C           HNMTYP    OREQ 'PI'                                                          CER049
      *                                                                                       CER049
      ** Access deal extension file                                                           CER049
      *                                                                                       CER049
     C           #ARCID    IFEQ 'HN'                                                          CER049
     C           HNMTYP    ANDEQ'PI'                                                          CER049
     C                     MOVEL##DLNO    KDLNO   6                                           CER049
     C           KDLNO     CHAINDLDEALL5             50                                       CER049
     C           *IN50     IFEQ *ON                                                           CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'DLDEALL5'DBFILE                                              CER049
     C                     MOVELDLNO      DBKEY                                               CER049
     C                     Z-ADD902       DBASE                                               CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVE F1DCST    DDDCST                                              CER049
     C                     MOVE F1DCCY    DDDCCY                                              CER049
     C                     MOVE F1DACD    DDDACD                                              CER049
     C                     MOVE F1DASC    DDDASC                                              CER049
     C                     MOVE F1DBRC    DDDBRC                                              CER049
     C                     MOVE F1TAX     DDTAX                                               CER049
     C                     ENDIF                                                              CER049
     C           DDTAX     IFEQ 'Y'                                                           CER049
      *                                                                                       CER049
     C** Check for retail account                                                             CER049
      *                                                                                       CER049
     C                     MOVE DDDCST    KDCST                                               CER049
     C                     MOVE DDDCCY    KDCCY                                               CER049
     C                     MOVE DDDACD    KDACD                                               CER049
     C                     MOVE DDDASC    KDASC                                               CER049
     C                     MOVE DDDBRC    KDBRC                                               CER049
     C                     CALL 'AOACCTR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM *ZEROS    F1RETL 100                                          CER049
     C                     PARM           KDCST   6                                           CER049
     C                     PARM           KDCCY   3                                           CER049
     C                     PARM           KDACD  10                                           CER049
     C                     PARM           KDASC   2                                           CER049
     C                     PARM           KDBRC   3                                           CER049
     C           SDACNT    PARM SDACNT    DSSDY                                               CER049
      ** If error occured, terminate the program                                              CER049
     C           @RTCD     IFNE *BLANKS                                                       CER049
     C           @RTCD     ANDNE'*NRF   '                                                     CER049
     C                     MOVEL'ACCNTAB 'DBFILE                                              CER049
     C                     MOVEL@OPTN     DBKEY                                               CER049
     C                     Z-ADD904       DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C********** RECI      IFEQ 'D'                                                  CER049 AR821086
     C           NRECI     IFEQ 'D'                                                         AR821086
     C           ATYP      ANDEQ'R'                                                           CER049
      *                                                                                       CER049
     C                     MOVE ACNO      C#ACNO                                              CER049
     C                     MOVE 'R'       C#ATYP                                              CER049
     C                     MOVE *BLANKS   C#MEMS                                              CER049
     C                     MOVE *BLANKS   C#RSAC                                              CER049
     C                     MOVE DDDCCY    C#CCY                                               CER049
     C                     MOVE ##AMT     WSTAX  150                                          CER049
      *                                                                                       CER049
     C** Get Stamp tax rate                                                                   CER049
      *                                                                                       CER049
     C**********           MOVE DTYP      ##TYPE                                     CER049 AR821086
     C                     MOVE WDTYP     ##TYPE                                            AR821086
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM WVDAT     U#DATE  50                                          CER049
     C                     PARM 'DEAL'    U#ORGN 10                                           CER049
     C                     PARM           ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C********** DTYP      IFEQ 'IP'                                                 CER049 AR821086
     C********** DTYP      OREQ 'TI'                                                 CER049 AR821086
     C           WDTYP     IFEQ 'IP'                                                        AR821086
     C           WDTYP     OREQ 'TI'                                                        AR821086
     C                     CALL 'SD008142'                                                    CER049
     C                     PARM           PVALD   60                                          CER049
     C                     PARM           PMATD   60                                          CER049
     C                     PARM           SDSTPD                                              CER049
     C                     PARM           U#TAXR                                              CER049
     C                     PARM *BLANKS   U#PERD  1                                           CER049
     C                     PARM 0         U#TXBR 138                                          CER049
     C                     PARM 0         U#MNTH  70                                          CER049
     C                     PARM           WVDAT                                               CER049
     C                     PARM           WMDAT                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C********** CCY       IFNE DDDCCY                                               CER049 AR821086
     C           WCCY2     IFNE DDDCCY                                                      AR821086
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOCURRR0'                                                    CER049
     C                     PARM '*MSG    'WRTCD                                               CER049
     C                     PARM '*KEY    'WOPTN                                               CER049
     C                     PARM DDDCCY    WCCY                                                CER049
     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
      *                                                                                       CER049
     C           WRTCD     IFNE *BLANK                                                        CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'SDCURRPD'DBFILE                                              CER049
     C                     MOVELHKCCY     DBKEY                                               CER049
     C                     Z-ADD905       DBASE                                               CER049
     C                     MOVEL'AOOUMMU0'DBPGM                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     MOVE A6NBDP    NDP     10                                          CER049
     C                     MOVELA6SPRT    ZRATE1 138                                          CER049
     C                     MOVELA6MDIN    ZMDI1   1                                           CER049
      *                                                                                       CER049
      ** Access transaction currency for decimal places                                       CER049
      *                                                                                       CER049
     C                     CALL 'AOCURRR0'                                                    CER049
     C                     PARM '*MSG    'WRTCD                                               CER049
     C                     PARM '*KEY    'WOPTN                                               CER049
     C**********           PARM CCY       WCCY                                       CER049 AR821068
     C                     PARM WCCY      WCCY                                              AR821068
     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
      *                                                                                       CER049
     C           WRTCD     IFNE *BLANK                                                        CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'SDCURRPD'DBFILE                                              CER049
     C                     MOVELHKCCY     DBKEY                                               CER049
     C                     Z-ADD906       DBASE                                               CER049
     C                     MOVEL'AOOUMMU0'DBPGM                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVELA6SPRT    ZRATE2 138                                          CER049
     C                     MOVELA6MDIN    ZMDI2   1                                           CER049
      *                                                                                       CER049
      ** Get exchange rate                                                                    CER049
      *                                                                                       CER049
     C                     EXSR RTZXRT                                                        CER049
      *                                                                                       CER049
     C                     Z-ADDZRATEX    ZEXCH                                               CER049
     C                     MOVE ZMDI1     ZMD                                                 CER049
     C                     Z-ADDWSTAX     ZAMTCI                                              CER049
     C                     Z-ADDA6NBDP    ZCDPI                                               CER049
     C                     Z-ADDNDP       ZCDPO                                               CER049
     C                     EXSR ZCONVN                                                        CER049
     C                     Z-ADDZAMTCO    WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           WSTAX     MULT U#TAXR    C#AMT                                               CER049
      *                                                                                       CER049
     C           C#AMT     IFLT 0                                                             CER049
     C                     MULT -1        C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           ##REVI    IFNE *BLANKS                                                       CER049
     C                     Z-SUBC#AMT     C#AMT                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     CALL 'AOSPOSU0'             9090                                   CER049
     C           R#RTN     PARM ##RTCD    O#RTN                                               CER049
     C                     PARM '*ADD    'W0ACT                                               CER049
     C                     PARM C#DTA     O#DTA                                               CER049
      *                                                                                       CER049
     C           *IN90     IFEQ '1'                                                           CER049
     C           R#RTN     OREQ '*ERROR*'                                                     CER049
     C                     MOVEL'*CALL   'W0FILE                                              CER049
     C                     MOVEL'AOSPOSU0'W0KEY                                               CER049
     C                     Z-ADD907       W0ERNB                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      *                                                               *                     MD023265
      *  CALWTX - Calculate witholding tax                            *                     MD023265
      *                                                               *                     MD023265
      *  Called By  : Various                                         *                     MD023265
      *                                                               *                     MD023265
      *  Calls      : *NONE                                           *                     MD023265
      *                                                               *                     MD023265
      *****************************************************************                     MD023265
     C           CALWTX    BEGSR                                                            MD023265
      *                                                                                     MD023265
      ** If Tax indicator is ZERO set WHT rate to ZERO.                                     MD023265
      *                                                                                     MD023265
     C           HKMTAX    IFEQ '0'                                                         MD023265
     C                     Z-ADD0         ULWHTR  52                                        MD023265
     C                     ELSE                                                             MD023265
      * Set Witholding Tax rate.                                                            MD023265
     C                     SELEC                                                            MD023265
     C           HKMTAX    WHEQ '1'                                                         MD023265
     C                     Z-ADDETXR1     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '2'                                                         MD023265
     C                     Z-ADDETXR2     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '3'                                                         MD023265
     C                     Z-ADDETXR3     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '4'                                                         MD023265
     C                     Z-ADDETXR4     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '5'                                                         MD023265
     C                     Z-ADDETXR5     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '6'                                                         MD023265
     C                     Z-ADDETXR6     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '7'                                                         MD023265
     C                     Z-ADDETXR7     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '8'                                                         MD023265
     C                     Z-ADDETXR8     ULWHTR                                            MD023265
     C           HKMTAX    WHEQ '9'                                                         MD023265
     C                     Z-ADDETXR9     ULWHTR                                            MD023265
     C                     ENDSL                                                            MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                     MD023265
     C           ULWHTR    IFEQ *ZERO                                                       MD023265
     C                     Z-ADD0         TAXA                                              MD023265
      *                                                                                     MD023265
      ** Otherwise calculate tax amount                                                     MD023265
      *                                                                                     MD023265
     C                     ELSE                                                             MD023265
      *                                                                                     MD023265
      ** If Deal Ccy is equal to Base Ccy round down Interest Amount.                       MD023265
      *                                                                                     MD023265
     C********** HKCCY     IFEQ BJCYCD                                             MD023265 MD055501
      *                                                                                     MD023265
      ** Set work adjustment field according to decimal places.                             MD023265
      *                                                                                     MD023265
     C                     SELEC                                                            MD023265
     C           HKCYDP    WHEQ 1                                                           MD023265
     C                     Z-ADD10        ULWKAD  40                                        MD023265
     C           HKCYDP    WHEQ 2                                                           MD023265
     C                     Z-ADD100       ULWKAD                                            MD023265
     C           HKCYDP    WHEQ 3                                                           MD023265
     C                     Z-ADD1000      ULWKAD                                            MD023265
     C           HKCYDP    WHEQ 0                                                           MD023265
     C                     Z-ADD1         ULWKAD                                            MD023265
     C                     ENDSL                                                            MD023265
      *                                                                                     MD023265
      ** Calculate and then round down Tax Amount.                                          MD023265
      *                                                                                     MD023265
     C           CDL081    IFEQ 'Y'                                                         MD055501
     C           W#BSRD    ANDEQ'Y'                                                         MD055501
     C           CDL081    OREQ 'Y'                                                         MD055501
     C           W#NBSR    ANDEQ'Y'                                                         MD055501
     C           WINTD     DIV  ULWKAD    ULTINT 150                                        MD023265
     C                     MULT ULWKAD    ULTINT                                            MD023265
     C           ULTINT    MULT ULWHTR    TAXA                                              MD023265
     C                     DIV  100       TAXA                                              MD023265
     C           TAXA      DIV  ULWKAD    ULTXAM 150                                        MD023265
     C           ULTXAM    MULT ULWKAD    TAXA                                              MD023265
      *                                                                                     MD023265
      ** Otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                           MD023265
      ** without rounding down.                                                             MD023265
      *                                                                                     MD023265
     C**********           ELSE                                                    MD023265 MD055501
     C                     END                                                              MD055501
     C           W#BSRD    IFEQ 'N'                                                         MD055501
     C           W#BSRD    OREQ *BLANKS                                                     MD055501
     C           W#NBSR    OREQ 'N'                                                         MD055501
     C           W#NBSR    OREQ *BLANKS                                                     MD055501
     C           WINTD     MULT ULWHTR    TAXA                                              MD023265
     C                     DIV  100       TAXA      H                                       MD023265
     C**********           ENDIF                                                   MD023265 MD055501
     C                     ENDIF                                                            MD055501
     C                     ENDIF                                                            MD023265
     C                     ENDSR                                                            MD023265
      *****************************************************************                     MD023265
      *                                                               *                     MD023265
      *  CALTXM - Calculate BRT Tax Amount at Maturity                *                     MD023265
      *                                                               *                     MD023265
      *  Called By  : Various                                         *                     MD023265
      *                                                               *                     MD023265
      *  Calls      : *NONE                                           *                     MD023265
      *                                                               *                     MD023265
      *****************************************************************                     MD023265
     C           CALTXM    BEGSR                                                            MD023265
      *                                                                                     MD023265
      ** Validate for need to calculate tax                                                 MD023265
      *                                                                                     MD023265
     C                     Z-ADD0         TAXA                                              MD023265
     C           HKMTAX    IFEQ 'Y'                                                         MD023265
     C           ##LOD     ANDEQ'D'                                                         MD023265
      *                                                                                     MD023265
     C                     Z-ADD#MTINT    WINTD                                             MD023265
     C           S01383    IFEQ 'Y'                                                         MD023265
      *                                                                                     MD023265
     C                     Z-ADD##VDAT    WKMDAT  50                                        MD023265
     C                     EXSR CALTAX                                                      MD023265
      *                                                                                     MD023265
     C                     ELSE                                                             MD023265
      * If Dual Withholding Tax feature is ON                                                 CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
      *                                                                                       CGL165
     C                     Z-ADD0         TAXA                                                CGL165
     C                     Z-ADDWINTD     PINTA                                               CGL165
     C                     CALL 'GL024000'                                                    CGL165
     C                     PARM           PRCOD1  1                                           CGL165
     C                     PARM 'AOOUMM'  PCPGM   6                                           CGL165
     C                     PARM *BLANKS   PBRCA   3                                           CGL165
     C                     PARM *BLANKS   PCNUM1  6                                           CGL165
     C                     PARM *BLANKS   PACNO  10                                           CGL165
     C                     PARM CCY       PCCY    3                                           CGL165
     C                     PARM           PINTA  150                                          CGL165
     C                     PARM HKTAX1    PTXC1   2                                           CGL165
     C                     PARM HKTAX2    PTXC2   2                                           CGL165
     C                     PARM *ZEROS    PCPDT   50                                          CGL165
     C                     PARM *ZEROS    PVDAT   50                                          CGL165
     C                     PARM *ZEROS    PMDAT   50                                          CGL165
     C                     PARM *ZEROS    PINTR  117                                          CGL165
     C                     PARM *BLANKS   PDTYP   2                                           CGL165
     C                     PARM *ZEROS    PPCPL  150                                          CGL165
     C                     PARM *BLANKS   PACOD  10                                           CGL165
     C                     PARM *ZEROS    PACSQ   20                                          CGL165
     C                     PARM           PWTXA  150                                          CGL165
     C                     PARM           PSTXA  150                                          CGL165
      *                                                                                       CGL165
     C           PWTXA     ADD  PSTXA     TAXA                                                CGL165
      *                                                                                       CGL165
     C                     ELSE                                                               CGL165
      *                                                                                     MD023265
     C           WINTD     MULT BNHKTR    TAXA   130H                                       MD023265
     C           TAXA      DIV  100       TAXA      H                                       MD023265
     C                     ENDIF                                                              CGL165
      *                                                                                     MD023265
     C                     END                                                              MD023265
      *                                                                                     MD023265
     C                     ELSE                                                             MD023265
     C           CDL013    IFEQ 'Y'                                                         MD023265
     C           ##LOD     ANDEQ'D'                                                         MD023776
     C           HKMTAX    ANDNE'Y'                                                         MD023265
     C           HKMTAX    ANDNE'N'                                                         MD023265
     C           HKMTAX    ANDNE*BLANKS                                                     MD023265
      *                                                                                     MD023776
     C                     Z-ADD#MTINT    WINTD                                             MD023776
      *                                                                                     MD023776
     C                     EXSR CALWTX                                                      MD023265
     C                     ENDIF                                                            MD023265
     C                     END                                                              MD023265
      *                                                                                     MD023265
      ** Validate if Tax Amount is present                                                  MD023265
      *                                                                                     MD023265
     C           TAXA      IFNE 0                                                           MD023265
      *                                                                                     MD023265
     C                     Z-SUBTAXA      ##AMT                                             MD023265
      *                                                                                     MD023265
     C           HKIPDS    IFEQ 'Y'                                                         MD023265
     C           HKIMET    ANDNE'00'                                                        MD023265
     C           HKIMET    ANDNE' '                                                         MD023265
      *                                                                                     MD023265
     C           ##LOD     IFEQ 'D'                                                         MD023265
     C                     MOVE 'P'       ##INPR                                            MD023265
     C                     ELSE                                                             MD023265
     C                     MOVE *BLANKS   ##INPR                                            MD023265
     C                     ENDIF                                                            MD023265
     C                     MOVE HKIMET    ##INTM                                            MD023265
      *                                                                                     MD023265
     C           ##INTM    IFEQ '04'                                                        MD023265
     C                     CALL 'AORETLR0'                                                  MD023265
     C                     PARM '*DBERR ' @RTCD   7                                         MD023265
     C                     PARM '*FIRST ' @OPTN   7                                         MD023265
     C           SDRETL    PARM SDRETL    DSFDY                                             MD023265
      *                                                                                     MD023265
     C                     MOVELHKCNUM    @@ACNT                                            MD023265
     C                     MOVE BMACCD    @@ACNT                                            MD023265
     C                     MOVEL@@ACNT    ##INTA                                            MD023265
     C                     MOVE HKACSQ    ##INTA                                            MD023265
     C                     MOVE *BLANKS   ##INTB                                            MD023265
     C                     ELSE                                                             MD023265
      *                                                                                     MD023265
      ** Settle A/C                                                                         MD023265
      *                                                                                     MD023265
     C                     MOVELHKINSA    ##INTA                                            MD023265
      *                                                                                     MD023265
      ** Settle branch                                                                      MD023265
      *                                                                                     MD023265
     C                     MOVE HKINSA    ##INTB                                            MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                     MD023265
     C           ##INTB    IFEQ *BLANKS                                                     MD023265
     C           ##INPR    IFEQ 'P'                                                         MD023265
      *                                                                                     MD023265
      ** Rec branch                                                                         MD023265
      *                                                                                     MD023265
     C                     MOVELHKPOBR    ##INTB                                            MD023265
     C                     ENDIF                                                            MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                     MD023265
      ** Separate interest                                                                  MD023265
      *                                                                                     MD023265
     C                     MOVEL##INTS    ##SETD                                            MD023265
     C                     MOVELHKISCY    ##STCY                                            MD023265
      *                                                                                     MD023265
      ** HKIPDS                                                                             MD023265
      *                                                                                     MD023265
     C                     ELSE                                                             MD023265
      *                                                                                     MD023265
      ** If interest is not paid separately use maturity details                            MD023265
      ** Pass movement to write program (with appropriate instructions)                     MD023265
      *                                                                                     MD023265
     C           ##LOD     IFEQ 'D'                                                         MD023265
     C                     MOVE 'P'       ##PYRC                                            MD023265
     C                     ELSE                                                             MD023265
      *                                                                                     MD023265
      ** Pay details                                                                        MD023265
      *                                                                                     MD023265
     C                     MOVE *BLANKS   ##SETD                                            MD023265
     C                     END                                                              MD023265
     C                     MOVELHKSTCY    ##STCY                                            MD023265
      *                                                                                     MD023265
      ** HKIPDS                                                                             MD023265
      *                                                                                     MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                     MD023265
      ** 2 = int. date                                                                      MD023265
      *                                                                                     MD023265
     C                     Z-ADD004       ##RPNB                                            MD023265
     C                     MOVEL##NAR,4   ##NARR                                            MD023265
      *                                                                                       220013
      * If Dual Withholding Tax feature On, generate movement first                           CGL165
      * for the Main tax                                                                      CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-SUBPWTXA     ##AMT                                               CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                     MD023265
      ** Multiple account details exist                                                     MD023265
      *                                                                                     MD023265
     C           CDL018    IFEQ 'Y'                                                         MD023265
     C           ##MLAC    ANDEQ'Y'                                                         MD023265
     C                     MOVE 'I'       ##PIID  1                                         MD023265
     C                     EXSR SRMLAD                                                      MD023265
     C                     ELSE                                                             MD023265
     C                     EXSR SRMOVE                                                      MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                       CGL165
      * If Dual Withholding Tax feature On, generate movement                                 CGL165
      * for the Secondary Tax                                                                 CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           PSTXA     ANDNE0                                                             CGL165
     C                     Z-SUBPSTXA     ##AMT                                               CGL165
     C           CDL018    IFEQ 'Y'                                                           CGL165
     C           ##MLAC    ANDEQ'Y'                                                           CGL165
     C                     MOVE 'I'       ##PIID  1                                           CGL165
     C                     EXSR SRMLAD                                                        CGL165
     C                     ELSE                                                               CGL165
     C                     EXSR SRMOVE                                                        CGL165
     C                     END                                                                CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                     MD023265
     C                     ENDIF                                                            MD023265
      *                                                                                     MD023265
     C                     MOVE *BLANK    MATINT                                            MD023265
     C                     ENDSR                                                            MD023265
     ******************************************************************                     MD023265
     C/COPY WNCPYSRC,AOH00056
      /EJECT                                                              CDL006
     C/COPY ZSRSRC,ZCONVNZ1                                               CDL006
      /EJECT                                                              CDL006
     C/COPY ZSRSRC,GLINTCZ1                                               CDL006
      /EJECT                                                              CDL006
     C/COPY ZSRSRC,ZINTDYZ2                                               CDL006
      /EJECT                                                              CDL006
     C/COPY ZSRSRC,ZDATE9Z3                                               CDL006
     C/COPY WNCPYSRC,AOOUMMU0K1
     C/SPACE 5
     C/COPY ZSRSRC,ZDAT10Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDLINTZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZCBDYSZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
     C/SPACE 5
     C/COPY WNCPYSRC,AOOUMMU0N2
     C/COPY ZSRSRC,RTZXRTC1                                                                   CER049
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
** ##LDT  **      LOAN DEAL TYPES & INTEREST BEARING NEG. ASSETS
IPTICLLNDLC1C2BPBDIL
** ##NAR  **      NARRATIVES
VALUE
INTEREST
MATURITY
TAX                                                                                           220013
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** POWER - Array used in subroutine ZCONVN for currency conversion.       CDL006
0000001                                                                   CDL006
0000010                                                                   CDL006
0000100                                                                   CDL006
0001000                                                                   CDL006
0010000                                                                   CDL006
0100000                                                                   CDL006
1000000                                                                   CDL006
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** CALPGM - Calling Program                                                                AR1044820
DLDLAAUPD                                                                                  AR1044820
