      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas BU Region Codes BackGnd Upd')
     F********************************************************************
     F*                                                                  *
     F*  Midas  STANDING DATA MODULE
     F*                                                                  *
     F*     TABLETI - BACKGROUND UPDATE OF TABLETI FILE                  *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
     F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. S01117             Date 14/02/90              *
      *                 S01230             Date 07/11/89              *
     F*                   S01229              DATE 20/10/89              *S01229
     F*                                                                  *
     F********************************************************************S01229
      *  MD046248 - Finastra Rebranding                               *
     F*     S01117 - RELEASE 10 CHANGES                                  *S01117
     F*     S01230 - STANDARDISE PROGRAM                    S01229 S01230 S01117
     F*     S01229 - SYNON FIELD NAME CHANGES                      S01229 S01230
     F********************************************************************
     F*                                                                  *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*                                                                  *
     F*       30      CHAIN TABLETI FAILED/ERROR                         *
     F*       31      ERROR ON TABLETI FILE                              *
     F*       32      CHAIN TABLETX FAILED/ERROR                         *
     F*                                                                  *
     F********************************************************************
     FTABLETI UF  E           K        DISK                      A
     F                                              KCOMIT
     FTABLETA UF  E           K        DISK
     F                                              KCOMIT
     FTABLETXLUF  E           K        DISK
     F                                              KCOMIT
      /EJECT
     E* Description     : Copyright notice for inclusion in all progra    S01230
     E*                                                                   S01230
     E********************************************************************S01230
     E                    CPY@    1   1 80               Copyright     arrS01230
     E********************************************************************S01230
      /EJECT                                                              S01230
     I*
     I* RENAME RECORD ID ON HEADER FILE TO AVOID OVERWRITING
     I*
     ITABLETAF
     I              RECT                            RECTA
     I*                                                                   S01230
     I* Description     : Copyright notice for inclusion in all programs  S01230
     I*                                                                   S01230
     IA@CPY       DS                                                      S01230
     I* Copyright array                                                   S01230
     I                                        1  80 CPY@                  S01230
     I********************************************************************S01230
      /EJECT
     C*
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7        RETURN CODE
     C*********************PARM           WREGC   2        REGION CODE    S01229
     C*********************PARM           WDEPT   3        DEP. LIMIT TYPES01229
     C*********************PARM           WFRXT   3        FOREX LMT.TYPE S01229
     C*********************PARM           WREGN  30        REGION NAME    S01229
     C*********************PARM           WDEPX   50       DEP.LMT.EXP.DTES01229
     C*********************PARM           WFRXX   50       FOR.LMT.EXP.DTES01229
     C*********************PARM           WDEPA   90       DEP. LIMIT AMT.S01229
     C*********************PARM           WFRXA   90       FOREX LMT.AMT. S01229
     C*********************PARM           WDEPF   1        DEP.LMT.FREQ.  S01229
     C*********************PARM           WFRXF   1        FOREX LMT.FREQ.S01229
     C*********************PARM           WDEPR   50       DEP.LMT.REV.DTES01229
     C*********************PARM           WDLRD   20       DEP.LMT.REV.DAYS01229
     C*********************PARM           WFRXR   50       FOR.LMT.REV.DTES01229
     C*********************PARM           WFLRD   20       FOR.LMT.REV.DAYS01229
     C*********************PARM           WFRAX   50       FRA LMT EXPY DTS01229
     C*********************PARM           WFRAA   90       FRA LIMIT AMOUNS01229
     C*********************PARM           WFRAF   1        FRA LMT REV AMNS01229
     C*********************PARM           WFRAR   50       FRA LMT REV DTES01229
     C*********************PARM           WIRSX   50       IRS LMT EXPY DTS01229
     C*********************PARM           WIRSA   90       IRS LMT AMOUNT S01229
     C*********************PARM           WIRSF   1        IRS LMT REV FQCS01229
     C*********************PARM           WIRSR   50       IRS LMT REV DTES01229
     C*********************PARM           WCHTP   1        LAST CHANGE TYPS01229
     C                     PARM           WRGCD   2        REGION CS01229 S01117
     C*********************PARM           WDLTY   3        DEP. LIMS01229 S01117
     C*********************PARM           WFLTY   3        FOREX LMS01229 S01117
     C                     PARM           WRGNM  30        REGION NAME    S01229
     C*********************PARM           WDLED   50       DEP.LMT.S01229 S01117
     C*********************PARM           WFLED   50       FOR.LMT.S01229 S01117
     C*********************PARM           WDLAM   90       DEP. LIMS01229 S01117
     C*********************PARM           WFLAM   90       FOREX LMS01229 S01117
     C*********************PARM           WDLFQ   1        DEP.LMT.S01229 S01117
     C*********************PARM           WFLFQ   1        FOREX LMS01229 S01117
     C*********************PARM           WDRDT   50       DEP.LMT.S01229 S01117
     C*********************PARM           WDRDN   20       DEP.LMT.S01229 S01117
     C*********************PARM           WFRDT   50       FOR.LMT.S01229 S01117
     C*********************PARM           WFRDN   20       FOR.LMT.S01229 S01117
     C*********************PARM           WFRED   50       FRA LMT S01229 S01117
     C*********************PARM           WFRLA   90       FRA LIMIS01229 S01117
     C*********************PARM           WFRFQ   1        FRA LMT S01229 S01117
     C*********************PARM           WFRRD   50       FRA LMT S01229 S01117
     C*********************PARM           WIRED   50       IRS LMT S01229 S01117
     C*********************PARM           WIRLM   90       IRS LMT S01229 S01117
     C*********************PARM           WIRFQ   1        IRS LMT S01229 S01117
     C*********************PARM           WIRDT   50       IRS LMT S01229 S01117
     C                     PARM           WTYLC   1        LAST CHANGE TYPS01229
     C                     PARM           WLCD    50       LAST CHANGE DATE
     C*
      /EJECT
     C****************************************************************
     C*
     C*   M A I N L I N E   P R O G R A M
     C*
     C****************************************************************
     C*
     C* IF RECORD HAS BEEN INSERTED, CHAIN TO TABLETI TO CHECK THAT
     C* RECORD DOES NOT ALREADY EXIST ON THIS FILE
     C*
     C***********WCHTP     IFEQ 'I'                                       S01229
     C           WTYLC     IFEQ 'I'                                       S01229
     C***********WREGC     CHAINTABLETI              30    CHAIN FAILED   S01229
     C           WRGCD     CHAINTABLETI              30    CHAIN FAILED   S01229
     C*
     C* IF RECORD DOES NOT EXIST
     C* THEN MOVE PARAMETERS RECIEVED INTO FILE FIELDS AND WRITE
     C* A NEW RECORD
     C*
     C           *IN30     IFEQ '1'
     C*
     C*  IF IT DOES EXIST AS DELETED (RECI *)
     C*  THEN MOVE PARAMETERS RECEIVED INTO FILE FIELDS AND UPDATE
     C*  OLD RECORD
     C*
     C           *IN30     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE 'D'       RECI
     C                     Z-ADD51        RECT
     C*********************MOVE WREGC     REGC                            S01229
     C*********************MOVE WDEPT     DEPT                            S01229
     C*********************MOVE WFRXT     FRXT                            S01229
     C                     MOVE WRGCD     REGC                            S01229
     C*********************MOVE WDLTY     DEPT                     S01229 S01117
     C*********************MOVE WFLTY     FRXT                     S01229 S01117
     C                     Z-ADDWLCD      LCD
     C*********************MOVE WCHTP     CHTP                            S01229
     C*********************MOVE WREGN     REGN                            S01229
     C*********************Z-ADDWDEPX     DEPX                            S01229
     C*********************Z-ADDWFRXX     FRXX                            S01229
     C*********************Z-ADDWDEPA     DEPA                            S01229
     C*********************Z-ADDWFRXA     FRXA                            S01229
     C*********************MOVE WDEPF     DEPF                            S01229
     C*********************MOVE WFRXF     FRXF                            S01229
     C*********************Z-ADDWDEPR     DEPR                            S01229
     C*********************Z-ADDWDLRD     DLRD                            S01229
     C*********************Z-ADDWFRXR     FRXR                            S01229
     C*********************Z-ADDWFLRD     FLRD                            S01229
     C*********************Z-ADDWFRAX     FRAX                            S01229
     C*********************Z-ADDWFRAA     FRAA                            S01229
     C*********************MOVE WFRAF     FRAF                            S01229
     C*********************Z-ADDWFRAR     FRAR                            S01229
     C*********************Z-ADDWIRSX     IRSX                            S01229
     C*********************Z-ADDWIRSA     IRSA                            S01229
     C*********************MOVE WIRSF     IRSF                            S01229
     C*********************Z-ADDWIRSR     IRSR                            S01229
     C                     MOVE WTYLC     CHTP                            S01229
     C                     MOVE WRGNM     REGN                            S01229
     C*********************Z-ADDWDLED     DEPX                     S01229 S01117
     C*********************Z-ADDWFLED     FRXX                     S01229 S01117
     C*********************Z-ADDWDLAM     DEPA                     S01229 S01117
     C*********************Z-ADDWFLAM     FRXA                     S01229 S01117
     C*********************MOVE WDLFQ     DEPF                     S01229 S01117
     C*********************MOVE WFLFQ     FRXF                     S01229 S01117
     C*********************Z-ADDWDRDT     DEPR                     S01229 S01117
     C*********************Z-ADDWDRDN     DLRD                     S01229 S01117
     C*********************Z-ADDWFRDT     FRXR                     S01229 S01117
     C*********************Z-ADDWFRDN     FLRD                     S01229 S01117
     C*********************Z-ADDWFRED     FRAX                     S01229 S01117
     C*********************Z-ADDWFRLA     FRAA                     S01229 S01117
     C*********************MOVE WFRFQ     FRAF                     S01229 S01117
     C*********************Z-ADDWFRRD     FRAR                     S01229 S01117
     C*********************Z-ADDWIRED     IRSX                     S01229 S01117
     C*********************Z-ADDWIRLM     IRSA                     S01229 S01117
     C*********************MOVE WIRFQ     IRSF                     S01229 S01117
     C*********************Z-ADDWIRDT     IRSR                     S01229 S01117
     C*
     C* IF RECORD FOUND ON FILE AND IS NOT A DELETED RECORD SET ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     31
     C                     END
     C*
     C           *IN30     IFEQ '1'
     C                     WRITETABLETIF               31  ERROR
     C                     END
     C*
     C           *IN30     IFEQ '0'
     C           *IN31     ANDEQ'0'
     C                     UPDATTABLETIF               31  ERROR
     C                     END
     C*
     C           *IN31     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C* RECORD IS NOT AN INSERT
     C*
     C                     END
     C*
     C* IF RECORD HAS BEEN CHANGED, RETRIEVE RECORD FROM FILE
     C*
     C***********WCHTP     IFEQ 'A'                                       S01229
     C           WTYLC     IFEQ 'A'                                       S01229
     C***********WREGC     CHAINTABLETIF             30    CHAIN FAILED   S01229
     C           WRGCD     CHAINTABLETIF             30    CHAIN FAILED   S01229
     C*
     C* IF RECORD FOUND, MOVE RECEIVED PARAMETERS INTO FILE FIELDS
     C* AND UPDATE
     C*
     C           *IN30     IFEQ '0'
     C*********************MOVE WREGC     REGC                            S01229
     C*********************MOVE WDEPT     DEPT                            S01229
     C*********************MOVE WFRXT     FRXT                            S01229
     C                     MOVE WRGCD     REGC                            S01229
     C*********************MOVE WDLTY     DEPT                     S01229 S01117
     C*********************MOVE WFLTY     FRXT                     S01229 S01117
     C                     Z-ADDWLCD      LCD
     C*********************MOVE WCHTP     CHTP                            S01229
     C*********************MOVE WREGN     REGN                            S01229
     C*********************Z-ADDWDEPX     DEPX                            S01229
     C*********************Z-ADDWFRXX     FRXX                            S01229
     C*********************Z-ADDWDEPA     DEPA                            S01229
     C*********************Z-ADDWFRXA     FRXA                            S01229
     C*********************MOVE WDEPF     DEPF                            S01229
     C*********************MOVE WFRXF     FRXF                            S01229
     C*********************Z-ADDWDEPR     DEPR                            S01229
     C*********************Z-ADDWDLRD     DLRD                            S01229
     C*********************Z-ADDWFRXR     FRXR                            S01229
     C*********************Z-ADDWFLRD     FLRD                            S01229
     C*********************Z-ADDWFRAX     FRAX                            S01229
     C*********************Z-ADDWFRAA     FRAA                            S01229
     C*********************MOVE WFRAF     FRAF                            S01229
     C*********************Z-ADDWFRAR     FRAR                            S01229
     C*********************Z-ADDWIRSX     IRSX                            S01229
     C*********************Z-ADDWIRSA     IRSA                            S01229
     C*********************MOVE WIRSF     IRSF                            S01229
     C*********************Z-ADDWIRSR     IRSR                            S01229
     C                     MOVE WTYLC     CHTP                            S01229
     C                     MOVE WRGNM     REGN                            S01229
     C*********************Z-ADDWDLED     DEPX                     S01229 S01117
     C*********************Z-ADDWFLED     FRXX                     S01229 S01117
     C*********************Z-ADDWDLAM     DEPA                     S01229 S01117
     C*********************Z-ADDWFLAM     FRXA                     S01229 S01117
     C*********************MOVE WDLFQ     DEPF                     S01229 S01117
     C*********************MOVE WFLFQ     FRXF                     S01229 S01117
     C*********************Z-ADDWDRDT     DEPR                     S01229 S01117
     C*********************Z-ADDWDRDN     DLRD                     S01229 S01117
     C*********************Z-ADDWFRDT     FRXR                     S01229 S01117
     C*********************Z-ADDWFRDN     FLRD                     S01229 S01117
     C*********************Z-ADDWFRED     FRAX                     S01229 S01117
     C*********************Z-ADDWFRLA     FRAA                     S01229 S01117
     C*********************MOVE WFRFQ     FRAF                     S01229 S01117
     C*********************Z-ADDWFRRD     FRAR                     S01229 S01117
     C*********************Z-ADDWIRED     IRSX                     S01229 S01117
     C*********************Z-ADDWIRLM     IRSA                     S01229 S01117
     C*********************MOVE WIRFQ     IRSF                     S01229 S01117
     C*********************Z-ADDWIRDT     IRSR                     S01229 S01117
     C                     UPDATTABLETIF               30  ERROR
     C                     END
     C*
     C* IF RECORD NOT FOUND OR ERROR OCCURRED ON UPDATE SET ERROR
     C* PARAMETER
     C*
     C           *IN30     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C* RECORD IS NOT A CHANGED RECORD
     C*
     C                     END
     C*
     C* IF RECORD HAS BEEN DELETED FROM THE NEW FILE, RETRIEVE IT
     C* FROM TABLETI
     C*
     C***********WCHTP     IFEQ 'D'                                       S01229
     C           WTYLC     IFEQ 'D'                                       S01229
     C***********WREGC     CHAINTABLETIF             30    CHAIN FAILED   S01229
     C           WRGCD     CHAINTABLETIF             30    CHAIN FAILED   S01229
     C*
     C* IF RECORD FOUND, UPDATE RELEVANT FIELDS (WE DON'T ACTUALLY
     C* DELETE ANY RECORDS FROM THE OLD FILES)
     C*
     C           *IN30     IFEQ '0'
     C                     MOVE '*'       RECI
     C*********************MOVE WCHTP     CHTP                            S01229
     C                     MOVE WTYLC     CHTP                            S01229
     C                     Z-ADDWLCD      LCD
     C                     UPDATTABLETIF               30  ERROR
     C                     END
     C*
     C* IF RECORD NOT FOUND OR ERROR OCCURRED ON UPDATE SET ERROR
     C* PARAMETER
     C*
     C           *IN30     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C                     END
     C*
     C* IF NO ERRORS HAVE OCCURRED ON TABLETI UPDATE
     C*
     C           P0RTN     IFEQ *BLANKS
     C*
     C* RETRIEVE OLD TRAILER FILE RECORD
     C*
     C           '51'      CHAINTABLETXF             32    CHAIN FAILED
     C*
     C* IF CHAIN TO FILE SUCCESSFUL
     C*
     C           *IN32     IFEQ '0'
     C*
     C* IF FIRST ACCESS TO THE FILE THEN GET HEADER RECORD
     C*
     C           NINS      ANDEQ0
     C           NAMD      ANDEQ0
     C           NDEL      ANDEQ0
     C*
     C                     READ TABLETAF                 32  EOF
     C*
     C* IF HEADER RECORD FOUND THEN SET PRINT INDICATOR AND UPDATE
     C*
     C           *IN32     IFEQ '0'
     C                     ADD  1         IRGC
     C                     UPDATTABLETAF               32    ERROR
     C                     END
     C*
     C                     END
     C*
     C* IF NO ERRORS
     C*
     C           *IN32     IFEQ '0'
     C*
     C* UPDATE AS APPROPRIATE THE NUMBER OF INSERTS,AMENDS OR DELETES
     C* ON THE TRAILER FILE
     C*
     C***********WCHTP     IFEQ 'I'                                       S01229
     C           WTYLC     IFEQ 'I'                                       S01229
     C                     ADD  1         NINS
     C                     END
     C*
     C***********WCHTP     IFEQ 'A'                                       S01229
     C           WTYLC     IFEQ 'A'                                       S01229
     C                     ADD  1         NAMD
     C                     END
     C*
     C***********WCHTP     IFEQ 'D'                                       S01229
     C           WTYLC     IFEQ 'D'                                       S01229
     C                     ADD  1         NDEL
     C                     END
     C*
     C                     UPDATTABLETXF               32    ERROR
     C*
     C                     END
     C*
     C* CHECK FOR ANY ERRORS AND SET ERROR PARAMETER FOR RETURN TO
     C* NEW FILE MAINTENANCE PROGRAM
     C*
     C           *IN32     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C                     END
     C*
     C                     SETON                     LR
     C                     RETRN
     C*
** CPY@     : Copyright notice for inclusion in all programs           graS01230
(c) Finastra International Limited 2001
