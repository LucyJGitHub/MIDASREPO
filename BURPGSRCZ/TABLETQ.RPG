      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas BU Facty Types BackGnd Upd')
     F********************************************************************
     F*                                                                  *
     F*  Midas     STANDING DATA MODULE
     F*                                                                  *
     F*     TABLETQ - BACKGROUND UPDATE OF TABLETQ FILE                  *
     F*                                                                  *
     F*  (c) Finastra International Limited 2001                         *
     F*                                                                  *
      *     Last Amend No. MD060092           Date 01Aug22               *
      *     Prev Amend No. CLE138             Date 02Nov21               *
      *                    MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                    S01230             DATE 07/11/89              *
     F*                    S01229             DATE 19/10/89              *
     F*                    E17596             DATE 20/03/89              *
     F*                                                                  *
     F********************************************************************
      *     MD060092 - Revert CLE138 changes in SDFACTPD, AOFACTR0 and   *
      *                SD Facility Type Maintenance.                     *
      *              - Apply CLE138 original design of SDFACTX0 to store *
      *                facility classes.                                 *
     F*     CLE138 - Class Codes for Facilities                          *
     F*     MD046248 - Finastra Rebranding                               *
     F*     S01230  - STANDARDISE PROGRAMS                               *S01230
     F*     E17596  - RECOMPILED FOR NEW VERSION OF TABLETXL             *
     F*     S01229  - SYNON FIELD NAME CHANGES                           *S01229
     F********************************************************************
     F*                                                                  *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F*                                                                  *
     F*       30      CHAIN TABLETQ FAILED/ERROR                         *
     F*       31      ERROR ON TABLETQ FILE                              *
     F*       32      CHAIN TABLETX FAILED/ERROR                         *
     F*                                                                  *
     F********************************************************************
     FTABLETQ UF  E           K        DISK                      A
     F                                              KCOMIT
     FTABLETA UF  E           K        DISK
     F                                              KCOMIT
     FTABLETXLUF  E           K        DISK
     F                                              KCOMIT
      /EJECT
     E* Description     : Copyright notice for inclusion in all progra    S01230
     E*                                                                   S01230
     E********************************************************************S01230
     E                    CPY@    1   1 80               Copyright     arrS01230
      /EJECT                                                              S01230
     I*
     I* RENAME RECORD ID ON HEADER FILE TO AVOID OVERWRITING
     I*
     ITABLETAF
     I              RECT                            RECTA
     I*                                                                   S01230
     I* Description     : Copyright notice for inclusion in all programs  S01230
     I*                                                                   S01230
     IA@CPY       DS                                                      S01230
     I* Copyright array                                                   S01230
     I                                        1  80 CPY@                  S01230
     I***SCSARD*   E DSSCSARDPD                                                      CLE138 MD060092
      ****Switchable*Features*File                                                   CLE138 MD060092
      **********                                                                     CLE138 MD060092
     I**DSFDY***  E DSDSFDY                                                          CLE138 MD060092
      ***Short*data*structure*for*access*objects                                     CLE138 MD060092
      **********                                                                     CLE138 MD060092
     I***LDA****    UDS                            256                               CLE138 MD060092
      ***Local*database*data*area                                                    CLE138 MD060092
     I**********                            134 141 DBFILE                           CLE138 MD060092
     I**********                            142 170 DBKEY                            CLE138 MD060092
     I**********                            171 180 DBPGM                            CLE138 MD060092
     I**********                            181 1830DBASE                            CLE138 MD060092
     I**********                            251 2560ZFSIZE                           CLE138 MD060092
      **********                                                                     CLE138 MD060092
      /EJECT
     C*
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7        RETURN CODE
     C*********************PARM           WFACT   3        FACILITY TYPE  S01229
     C                     PARM           WFCTY   3        FACILITY TYPE  S01229
     C**********           PARM           WFCLS   4        Facility Class            CLE138 MD060092
     C*********************PARM           WFACN  30        FACILITY NAME  S01229
     C                     PARM           WFCNM  30        FACILITY NAME  S01229
     C*********************PARM           WCHTP   1        LAST CHANGE TYPS01229
     C                     PARM           WTYLC   1        LAST CHANGE TYPS01229
     C                     PARM           WLCD    50       LAST CHANGE DATE
     C           *LIKE     DEFN FACT      KFACT
     C********** *LIKE     DEFN FCLS      KFCLS                                      CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C********** KFCLTY    KLIST                                                     CLE138 MD060092
     C**********           KFLD           KFACT                                      CLE138 MD060092
     C**********           KFLD           KFCLS                                      CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C********** *NAMVAR   DEFN           LDA                                        CLE138 MD060092
      **********                                                                     CLE138 MD060092
      ***Check*if*CLE138*is*switched*on                                              CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C**********           MOVE 'N'       CLE138  1                                  CLE138 MD060092
     C**********           CALL 'AOSARDR0'                                           CLE138 MD060092
     C**********           PARM *BLANKS   @RTCD   7                                  CLE138 MD060092
     C**********           PARM '*VERIFY' @OPTN   7                                  CLE138 MD060092
     C**********           PARM 'CLE138'  @SARD   6                                  CLE138 MD060092
     C********** SCSARD    PARM SCSARD    DSFDY                                      CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C********** @RTCD     IFEQ *BLANKS                                              CLE138 MD060092
     C**********           MOVE 'Y'       CLE138                                     CLE138 MD060092
     C**********           ENDIF                                                     CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C********** @RTCD     IFNE *BLANKS                                              CLE138 MD060092
     C********** @RTCD     ANDNE'*NRF   '                                            CLE138 MD060092
      **********                                                                     CLE138 MD060092
      ***Call*to*program*ended*in*error                                              CLE138 MD060092
      **********                                                                     CLE138 MD060092
     C********** *LOCK     IN   LDA                                                  CLE138 MD060092
     C**********           MOVEL'CLE138'  DBKEY                                      CLE138 MD060092
     C**********           MOVE 'SCSARDPD'DBFILE                                     CLE138 MD060092
     C**********           Z-ADD1         DBASE                                      CLE138 MD060092
     C**********           MOVEL'TABLETQ' DBPGM                                      CLE138 MD060092
     C**********           OUT  LDA                                                  CLE138 MD060092
     C**********           SETON                     U7U8LR                          CLE138 MD060092
     C**********           EXSR *PSSR                                                CLE138 MD060092
     C**********           ENDIF                                                     CLE138 MD060092
     C*
      /EJECT
     C****************************************************************
     C*
     C*   M A I N L I N E   P R O G R A M
     C*
     C****************************************************************
     C*
     C* IF RECORD HAS BEEN INSERTED, CHAIN TO TABLETQ TO CHECK THAT
     C* RECORD DOES NOT ALREADY EXIST ON THIS FILE
     C*
     C***********WCHTP     IFEQ 'I'                                       S01229
     C           WTYLC     IFEQ 'I'                                       S01229
     C*********************MOVE WFACT     KFACT                           S01229
     C                     MOVE WFCTY     KFACT                           S01229
     C**********           MOVE WFCLS     KFCLS                                               CLE138
     C********** KFACT     CHAINTABLETQ              30    CHAIN FAILED                       CLE138
     C********** KFCLTY    CHAINTABLETQ              30    CHAIN FAILED              CLE138 MD060092
     C           KFACT     CHAINTABLETQ              30    CHAIN FAILED                     MD060092
     C*
     C* IF RECORD DOES NOT EXIST
     C* THEN MOVE PARAMETERS RECIEVED INTO FILE FIELDS AND WRITE
     C* A NEW RECORD
     C*
     C           *IN30     IFEQ '1'
     C*
     C* IF IT DOES EXIST AS DELETED(RECI *)
     C* THEN MOVE PARAMETERS RECIEVED INTO FILE FIELDS AND UPDATE
     C* OLD RECORD
     C*
     C           *IN30     OREQ '0'
     C           RECI      ANDEQ'*'
     C                     MOVE 'D'       RECI
     C                     Z-ADD46        RECT
     C*********************MOVE WFACT     FACT                            S01229
     C                     MOVE WFCTY     FACT                            S01229
     C********** CLE138    IFEQ 'Y'                                                  CLE138 MD060092
     C**********           MOVE WFCLS     FCLS                                       CLE138 MD060092
     C**********           ENDIF                                                     CLE138 MD060092
     C*********************MOVE WFACN     FACN                            S01229
     C                     MOVE WFCNM     FACN
     C*********************MOVE WCHTP     CHTP                            S01229
     C                     MOVE WTYLC     CHTP                            S01229
     C                     Z-ADDWLCD      LCD
     C*
     C* IF RECORD FOUND ON FILE AND IS NOT A DELETED RECORD SET ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     31
     C                     END
     C*
     C           *IN30     IFEQ '1'
     C                     WRITETABLETQF               31   ERROR
     C                     END
     C*
     C           *IN30     IFEQ '0'
     C           *IN31     ANDEQ'0'
     C                     UPDATTABLETQF               31   ERROR
     C                     END
     C*
     C           *IN31     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C* RECORD IS NOT AN INSERT
     C*
     C                     END
     C*
     C* IF RECORD HAS BEEN CHANGED, RETRIEVE RECORD FROM FILE
     C*
     C***********WCHTP     IFEQ 'A'                                       S01229
     C           WTYLC     IFEQ 'A'                                       S01229
     C*********************MOVE WFACT     KFACT                           S01229
     C                     MOVE WFCTY     KFACT                           S01229
     C**********           MOVE WFCLS     KFCLS                                      CLE138 MD060092
     C********** KFACT     CHAINTABLETQF             30    CHAIN FAILED                       CLE138
     C********** KFCLTY    CHAINTABLETQF             30    CHAIN FAILED              CLE138 MD060092
     C           KFACT     CHAINTABLETQF             30    CHAIN FAILED                     MD060092
     C*
     C* IF RECORD FOUND, MOVE RECEIVED PARAMETERS INTO FILE FIELDS
     C* AND UPDATE
     C*
     C           *IN30     IFEQ '0'
     C*********************MOVE WFACT     FACT                            S01229
     C                     MOVE WFCTY     FACT                            S01229
     C********** CLE138    IFEQ 'Y'                                                  CLE138 MD060092
     C**********           MOVE WFCLS     FCLS                                       CLE138 MD060092
     C**********           ENDIF                                                     CLE138 MD060092
     C*********************MOVE WFACN     FACN                            S01229
     C                     MOVE WFCNM     FACN                            S01229
     C*********************MOVE WCHTP     CHTP
     C                     MOVE WTYLC     CHTP
     C                     Z-ADDWLCD      LCD
     C                     UPDATTABLETQF               30  ERROR
     C                     END
     C*
     C* IF RECORD NOT FOUND OR ERROR OCCURRED ON UPDATE SET ERROR
     C* PARAMETER
     C*
     C           *IN30     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C* RECORD IS NOT A CHANGED RECORD
     C*
     C                     END
     C*
     C* IF RECORD HAS BEEN DELETED FROM THE NEW FILE, RETRIEVE IT
     C* FROM TABLETQ
     C*
     C***********WCHTP     IFEQ 'D'                                       S01229
     C           WTYLC     IFEQ 'D'                                       S01229
     C*********************MOVE WFACT     KFACT                           S01229
     C                     MOVE WFCTY     KFACT                           S01229
     C**********           MOVE WFCLS     KFCLS                                      CLE138 MD060092
     C********** KFACT     CHAINTABLETQF             30    CHAIN FAILED                       CLE138
     C********** KFCLTY    CHAINTABLETQF             30    CHAIN FAILED              CLE138 MD060092
     C           KFACT     CHAINTABLETQF             30    CHAIN FAILED                     MD060092
     C*
     C* IF RECORD FOUND, UPDATE RELEVANT FIELDS (WE DON'T ACTUALLY
     C* DELETE ANY RECORDS FROM THE OLD FILES)
     C*
     C           *IN30     IFEQ '0'
     C                     MOVE '*'       RECI
     C*********************MOVE WCHTP     CHTP                            S01229
     C                     MOVE WTYLC     CHTP                            S01229
     C                     Z-ADDWLCD      LCD
     C                     UPDATTABLETQF               30  ERROR
     C                     END
     C*
     C* IF RECORD NOT FOUND OR ERROR OCCURRED ON UPDATE SET ERROR
     C* PARAMETER
     C*
     C           *IN30     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C                     END
     C*
     C* IF NO ERRORS HAVE OCCURRED ON TABLETQ UPDATE
     C*
     C           P0RTN     IFEQ *BLANKS
     C*
     C* RETRIEVE OLD TRAILER FILE RECORD
     C*
     C           '46'      CHAINTABLETXF             32    CHAIN FAILED
     C*
     C* IF CHAIN TO FILE SUCCESSFUL
     C*
     C           *IN32     IFEQ '0'
     C*
     C* IF FIRST ACCESS TO THE FILE THEN GET HEADER RECORD
     C*
     C           NINS      ANDEQ0
     C           NAMD      ANDEQ0
     C           NDEL      ANDEQ0
     C*
     C                     READ TABLETAF                 32  EOF
     C*
     C* IF HEADER RECORD FOUND THEN SET PRINT INDICATOR AND UPDATE
     C*
     C           *IN32     IFEQ '0'
     C                     ADD  1         IFCT
     C                     UPDATTABLETAF               32    ERROR
     C                     END
     C*
     C                     END
     C*
     C* IF NO ERRORS
     C*
     C           *IN32     IFEQ '0'
     C*
     C* UPDATE AS APPROPRIATE THE NUMBER OF INSERTS,AMENDS OR DELETES
     C* ON THE TRAILER FILE
     C*
     C***********WCHTP     IFEQ 'I'                                       S01229
     C           WTYLC     IFEQ 'I'                                       S01229
     C                     ADD  1         NINS
     C                     END
     C*
     C***********WCHTP     IFEQ 'A'                                       S01229
     C           WTYLC     IFEQ 'A'                                       S01229
     C                     ADD  1         NAMD
     C                     END
     C*
     C***********WCHTP     IFEQ 'D'                                       S01229
     C           WTYLC     IFEQ 'D'                                       S01229
     C                     ADD  1         NDEL
     C                     END
     C*
     C                     UPDATTABLETXF               32    ERROR
     C*
     C                     END
     C*
     C* CHECK FOR ANY ERRORS AND SET ERROR PARAMETER FOR RETURN TO
     C* NEW FILE MAINTENANCE PROGRAM
     C*
     C           *IN32     IFEQ '1'
     C                     MOVE '*ERROR*' P0RTN
     C                     END
     C*
     C                     END
     C*
     C                     SETON                     LR
     C                     RETRN
      ****************************************************************                        CLE138
      *                                                              *                        CLE138
      ***PSSR**-*Subroutine*to*handle*abnormal*error*conditions*******               CLE138 MD060092
      *                                                              *                        CLE138
      ****************************************************************                        CLE138
      *                                                                                       CLE138
     C********** *PSSR     BEGSR                                                     CLE138 MD060092
      *                                                                                       CLE138
     C********** WRUN      IFEQ *BLANKS                                              CLE138 MD060092
     C**********           MOVE 'Y'       WRUN    1                                  CLE138 MD060092
     C**********           DUMP                                                      CLE138 MD060092
     C**********           END                                                       CLE138 MD060092
      *                                                                                       CLE138
     C                     ENDSR                                                     CLE138 MD060092
      ****************************************************************                        CLE138
     C*
** CPY@     : Copyright notice for inclusion in all programs           graS01230
(c) Finastra International Limited 2001
