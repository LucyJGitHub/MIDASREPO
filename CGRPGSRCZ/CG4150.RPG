     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CG PM Valuation Statement: driver')              *
/*OVRF*: OVRDBF (PMPTDVXX) (PMPTDVPD)                               : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - User Defined Correspondence                          *
     F*                                                               *
     F*  CG4150 - PORTFOLIO VALUATION STATEMENT                       *
     F*                                                               *
     F*  Function:  This program xxxxxxxxxxxxxxxxxxxxxxxxxxxx         *
     F*  (phase(s))                                                   *
     F*                                                               *
     F*  Called By: mmCnnnn - (program name)                          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR1075401          Date 01Jun20               *     
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE148             Date 23Jul12               *
      *                 CCB020             Date 06Aug12               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 15May09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 13Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 23Jul96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 S71062             DATE 29JAN96               *
     F*                 CCG009             DATE 01JUN95               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR1075401 - Increase QFOAMT length in PMHOLDPD. Recompiled.  *
      *              (Child: AR1075402)                               *     
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CCB020 - COB Restructure - Secondary COB Infrastructure      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  S71062 - FF/PM Interface (Just recompiled)                   *
     F*  CCG009 - Private Banking UDC                                 *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*  60   -    End of file                                        *
     F*                                                               *
     F*  70   -    End of file                                        *
     F*  75   -    Record found                                       *
     F*                                                               *
     F*  99   -    General work indicator                             *
     F*                                                               *
     F*****************************************************************
     F*
     F** Portfolios requiring valuation statements   PREFIX -QN
     FPMPTDVPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Portfolios requiring valuation statements   PREFIX -QN
     FPMPTDVXXUF  E           K        DISK         KINFSR *PSSR
     F            PMPTDVP0                          KRENAMEPMPTDVP1
     F*
     F** Portfolio Details                           PREFIX - PN
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Holdings for Trade Date Positions           Prefix -QF
     FPMHOLDL4IF  E           K        DISK         KINFSR *PSSR
     F            PMHOLDP0                          KRENAMEPMHOLDD1
     F*
     F***Holdings*for*Value*Date*Positions           Prefix -QF           CPM005
     F***PMHOLDL5IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***         PMHOLDP0                          KRENAMEPMHOLDD2       CPM005
     F*                                                                   CPM005
     F**   Portfolio Totals                          Prefix -QC           CPM005
     FPMPOTTPDIF  E           K        DISK         KINFSR *PSSR          CPM005
     F*
     F** Instrument Type Totals                      Prefix -QE
     FPMISTTPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Currency Totals                             Prefix -QG
     FPMCCYTPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Industry Totals                             Prefix -QI
     FPMINDTPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Country Totals                              Prefix -QH
     FPMCNTTPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Cashflow Day Totals                         Prefix -QK
     FPMCFDYPDIF  E           K        DISK         KINFSR *PSSR
     F*
     F** Cashflow Month and Year Totals              Prefix -QL
     FPMCFMYPDIF  E           K        DISK         KINFSR *PSSR
     F*                                                                   CPM005
     F** Portfolio Performance Details             Prefix -PM             CPM005
     FPMPSPOQ0IF  E           K        DISK         KINFSR *PSSR          CPM005
     F/COPY WNCPYSRC,CG4150F001
     E/SPACE 5
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY CGCPYSRC,SRERRE
     I/SPACE 5
     I*
     I** Event control date from data area PMSTAT
     IPMSTAT      DS                            256
     I                                        1   50DAECD
     I                                       29  330DALXTR
     I*
     IDSPARM    E DSPMUDCEXT
     I**  External DS for parameter passed to called programs
     I*
     ICPYR        DS
     I**  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
     I*
     I***MPHAS*******DS                              1                                        CCB020
     I***                                     1   1 W@PHAS                                    CCB020
     I*
     IW0FMT     E DSCGUDTAPD
     I**  Record format of PF/CGUDTAPD for use as a parameter
     I/COPY CGCPYSRC,CGAUDTI
     I/COPY CGCPYSRC,SRERRI
     I/COPY WNCPYSRC,CG4150I001
     ISDBANK    E DSSDBANKPD
     I** DUMMY RECORD FORMAT FOR BANK DETAILS
     I*
     ISDMMOD    E DSSDMMODPD                                              CPB001
     I** DUMMY RECORD FORMAT FOR MODULE DETAILS                           CPB001
     I*                                                                   CPB001
     ISDPORT    E DSSDPORTPD
     I** DUMMY RECORD FORMAT FOR PORTFOLIO MANAGEMENT ICD DETAILS
     I*
     ISDCUST    E DSSDCUSTPD
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS
     I*
     ISDPLCS    E DSSDPLCSPD
     I** DUMMY RECORD FORMAT FOR PORTFOLIO MANAGEMENT CUSTOMER DETAILS
     I*
     ISDACOF    E DSSDACOFPD
     I** DUMMY RECORD FORMAT FOR ACCOUNT OFFICER DETAILS
     I*
     ISDBRCH    E DSSDBRCHPD
     I** DUMMY RECORD FORMAT FOR BRANCH DETAILS
     I              QQDFAC                          #DFAC1                                    CGL029
     I*
     ISDALTN    E DSSDALTNPD
     I** DUMMY RECORD FORMAT FOR ALTERNATIVE NAMES AND ADDRESSES
     I*
     IDSFDY     E DSDSFDY
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*
     IDSSDY     E DSDSSDY
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
     I*
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRINZ  - Initialise Fields on Each Invocation  *
      *                SRMAIN - Main Processing                       *
      *                SRAUDT - Audit Report Processing               *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           W0RTN
     C                     PARM           W0CMT   3
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      **  Initialisation processing
     C                     EXSR SRINZ
      *
      **  Main processing
     C                     EXSR SRMAIN
      *
      **  Audit Processing
     C                     EXSR SRAUDT
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** READ DETAILS OF ALL PORTFOLIOS REQUIRING VALUATION STATEMENTS
      *
     C                     READ PMPTDVPD                 60
     C           *IN60     DOWEQ'0'
     C           QNVLSR    ANDNE'Y'
     C                     READ PMPTDVPD                 60
     C                     END
      *
     C           *IN60     DOWEQ'0'                        B1
      *
      ** ON CHANGE OF CUSTOMER OBTAIN CUSTOMER DETAILS
      *
     C           QNCNUM    IFNE WWCNUM                     B2
     C                     EXSR SRCUST
     C                     END                             E2
      *
      ** IF ADDRESS CODE PRESENT
      ** ACCESS THE ALTERNATIVE NAME AND ADDRESS
      *
     C           QNADCD    IFNE *BLANKS                    B2
      *
     C                     EXSR SRALTN
      *
     C                     MOVE BCCNA1    WWCNA1
     C                     MOVE BCCNA2    WWCNA2
     C                     MOVE BCCNA3    WWCNA3
     C                     MOVE BCCNA4    WWCNA4
      *
      ** OTHERWISE USE NAME AND ADDRESS FROM SDPLCSPD
      *
     C                     ELSE                            X2
     C                     MOVE BBCNA1    WWCNA1
     C                     MOVE BBCNA2    WWCNA2
     C                     MOVE BBCNA3    WWCNA3
     C                     MOVE BBCNA4    WWCNA4
     C                     END                             E2
     C/COPY WNCPYSRC,CG4150C001
      *
      ** DO WHILE SAME CUSTOMER AND ADDRESS CODE
      *
     C**********           Z-ADDQNCNUM    WWCNUM                                              CSD027
     C                     MOVE QNCNUM    WWCNUM                                              CSD027
     C                     MOVE QNADCD    WWADCD
     C           *IN60     DOWEQ'0'                        B2
     C           QNCNUM    ANDEQWWCNUM
     C           QNADCD    ANDEQWWADCD
      *
      ** OUTPUT SUMMARY PAGE
      *
     C                     MOVE QNHLDM    WWHLDM
     C                     MOVE QNXTRS    WWXTRS
     C                     MOVE QNVLNT    WWVLNT
     C                     MOVE QNUSER    WWUSER
     C                     MOVE QNLANG    WWLANG
     C                     Z-ADDQNRQNO    WWRQNO
     C                     EXSR SRSUMM
     C                     MOVE 'Y'       WFIRST  1                       CPM005
      *
      ** WHILE SAME REQUEST
      ** WRITE DETAILS FOR ALL REQUESTED PORTFOLIOS
      *
     C           *IN60     DOWEQ'0'                        B3
     C           QNRQNO    ANDEQWWRQNO
      *
      ** INCREMENT THE COUNT OF RECORDS READ
      *
     C                     ADD  1         ##DREC  50
      *
      ** SET UP REMAINING PARAMETERS TO BE PASSED
      *
     C                     MOVE QNS3VR    WWS3VR
     C                     MOVE QNS4VR    WWS4VR
     C                     MOVE QNS5VR    WWS5VR
     C                     MOVE QNADPP    WWADPP
     C                     MOVE QNPMNG    WWPMNG
      *
      ** SET UP PORTFOLIO DETAILS. DETAILS SHOULD BE SET TO DETAILS
      ** FROM PMPORTPD EXCEPT FOR '9997' '9998' AND '9999' PORTFOLIOS
      ** WHEN SHOULD CONTAIN INFORMATION FROM SDPLCSPD
      *
     C           QNPTFR    IFNE '9997'                     B4
     C           QNPTFR    ANDNE'9998'
     C           QNPTFR    ANDNE'9999'
     C           QNPTFR    OREQ '9997'                                    CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           QNPTFR    OREQ '9999'                                    CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
      *
      ** Access Portfolio Details
      *
     C                     EXSR SRPORT
     C*
     C                     MOVE PNPTFR    WWPTFR
     C                     MOVE PNPTFR    WWPTFF
     C                     MOVE PNPTFN    WWPTFN
     C                     MOVE PNPTCY    WWPTCY
     C                     Z-ADDPNPCDP    WWPCDP
     C*
     C** OTHERWISE USE DETAILS FROM SDPLCSPD
     C                     ELSE                            X4
     C*
     C           QNPTFR    IFEQ '9997'                     B5
     C                     MOVE FCR997    WWPTFR
     C                     MOVE FCN997    WWPTFN
     C                     END                             E5
     C*
     C           QNPTFR    IFEQ '9998'                     B5
     C                     MOVE FCR998    WWPTFR
     C                     MOVE FCN998    WWPTFN
     C                     END                             E5
     C*
     C           QNPTFR    IFEQ '9999'                     B5
     C                     MOVE FCR999    WWPTFR
     C                     MOVE FCN999    WWPTFN
     C                     END                             E5
     C*
     C                     MOVE QNPTFR    WWPTFF
     C                     MOVE WWCSBY    WWPTCY
     C                     Z-ADDWWBYDP    WWPCDP
     C                     END                             E4
      *
      ** OUTPUT DETAIL SECTIONS REQUIRED
      *
     C                     EXSR SRDETL
     C                     MOVE 'N'       WFIRST                          CPM005
      *
      ** IF USER DEFINED CORRESPONDENCE GENERATED
      ** MARK PMPTDVPD RECORD AS EXTRACTED BY UDC
      ** (THIS IS TO PREVENT LATER PRINTING BY PM0950 OR PM9950)
      *
     C           ##COPD    IFEQ 'Y'
     C           PTDVK     KLIST
     C                     KFLD           QNCNUM
     C                     KFLD           QNPTFR
     C                     KFLD           QNRQNO
     C           PTDVK     CHAINPMPTDVP1             99
     C           *IN99     IFEQ *OFF
     C                     MOVEL'Y'       QNEUDC
     C                     EXCPTPMPTDV
     C                     ENDIF
     C                     ENDIF
      *
     C                     READ PMPTDVPD                 60
     C           *IN60     DOWEQ'0'
     C           QNVLSR    ANDNE'Y'
     C                     READ PMPTDVPD                 60
     C                     END
      *
     C                     END                             E3
     C                     END                             E2
     C                     END                             E1
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRCUST                                         *
      * Function    :  Access Customer Details                        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRCUST    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRCUST'  @STK,Q
      *
      *................................................................
      *
      ** Access SD Customer Details
      *
     C                     MOVELQNCNUM    KEYCN
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY'    OPTN
     C                     PARM           KEYCN  10
     C                     PARM *BLANKS   KEYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDCUSTPD'W0FILE           ***************
     C                     MOVELKEYCN     W0KEY            * DB ERROR 10 *
     C                     Z-ADD10        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Access PM Customer Details
      *
     C                     CALL 'AOPLCSR0'
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY'    OPTN
     C                     PARM           KEYCN
     C           SDPLCS    PARM SDPLCS    DSFDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDPLCSPD'W0FILE           ***************
     C                     MOVELKEYCN     W0KEY            * DB ERROR 11 *
     C                     Z-ADD11        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** SET UP PARAMETERS ASSOCIATED WITH CUSTOMER
      *
     C                     MOVE BBBRCD    WWCBRC
     C                     MOVE BBCRNM    WWCRNM
     C                     MOVE BBCRTN    WWCTWN
     C                     MOVE QBCSBY    WWCSBY
     C                     Z-ADDQBBYDP    WWBYDP
      *
      ** Access Account officer Details
      *
     C           BBACOC    IFNE WSACOC                     B1
     C                     MOVE BBACOC    WSACOC  2
      *
     C                     CALL 'AOACOFR0'
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY'    OPTN
     C                     PARM           WSACOC
     C           SDACOF    PARM SDACOF    DSFDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDACOFPD'W0FILE           ***************
     C                     MOVELWSACOC    W0KEY            * DB ERROR 12 *
     C                     Z-ADD12        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *
      ** SET UP PARAMETERS ASSOCIATED WITH A/C OFFICER
      *
     C                     MOVE AZACOC    WWACOC
     C                     MOVE AZDPCD    WWDPCD
     C                     MOVE AZACON    WWACON
     C                     MOVE AZAPHN    WWAPHN
     C                     MOVE AZAEXT    WWAEXT
      *
      ** Access Branch Details
      *
     C           BBBRCD    IFNE WSBRCD                     B1
     C                     MOVE BBBRCD    WSBRCD  3
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY'    OPTN
     C                     PARM           WSBRCD
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDBRCHPD'W0FILE           ***************
     C                     MOVELWSBRCD    W0KEY            * DB ERROR 13 *
     C                     Z-ADD13        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *
      ** SET UP PARAMETERS ASSOCIATED WITH BRANCH
      *
     C                     MOVE A8BTWN    WWBMSN
      *
      *................................................................
      *
     C           EXCUST    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRALTN                                         *
      * Function    :  Access Alternative Name and Address Details    *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRALTN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRALTN'  @STK,Q
      *
      *................................................................
      *
      ** Access Alternative Name and Address Details
      *
     C                     MOVELQNCNUM    KEYCU
     C                     CALL 'AOALTNR0'
     C                     PARM *BLANKS   RTCD
     C                     PARM '*KEY'    OPTN
     C                     PARM           KEYCU   6
     C                     PARM QNADCD    KEYA    1
     C           SDALTN    PARM SDALTN    DSFDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDALTNPD'W0FILE           ***************
     C                     MOVELKEYCU     W0KEY            * DB ERROR 14 *
     C                     Z-ADD14        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXALTN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRPORT                                         *
      * Function    :  Access Portfolio Details                       *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRPORT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRPORT'  @STK,Q
      *
      *................................................................
      *
     C           PORTKY    KLIST
     C                     KFLD           QNCNUM
     C                     KFLD           QNPTFR
     C           PORTKY    CHAINPMPORTPD             99
      *
      ** Database error
      *
     C           *IN99     IFEQ '1'
     C                     EXSR SRAUDT
     C                     MOVEL'PMPORTPD'W0FILE           ***************
     C                     MOVELQNCNUM    W0KEY            * DB ERROR 15 *
     C                     Z-ADD15        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *................................................................
      *
     C           EXPORT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRSUMM                                         *
      * Function    :  Process Portfolio Summary                      *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRSUMM    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRSUMM'  @STK,Q
      *                                                                   CPM005
     C                     EXSR SRPARM                                    CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WWCOUN  30                      CPM005
     C**********           Z-ADDQNCNUM    W2CNUM                                       CPM005 CSD027
     C                     MOVE QNCNUM    W2CNUM                                              CSD027
     C                     MOVEL*BLANKS   W2PTFR                          CPM005
      *                                                                   CPM005
      ** Key List for PMPORTPD & PMPOTTPD                                 CPM005
     C           PMPORT    KLIST                                          CPM005
     C**********           KFLD           W2CNUM  60                                   CPM005 CSD027
     C                     KFLD           W2CNUM  6                                           CSD027
     C                     KFLD           W2PTFR  4                       CPM005
      *                                                                   CPM005
      ** ||| PMPORTPD = Merge of PMPORTPD and PMCNSDPD (Consolidated)     CPM005
     C           PMPORT    SETLLPMPORTPD                                  CPM005
     C                     READ PMPORTPD                 62               CPM005
      *                                                                   CPM005
      ** Save Customer                                                    CPM005
     C**********           Z-ADDQNCNUM    WSCNUM  60                                   CPM005 CSD027
     C                     MOVE QNCNUM    WSCNUM  6                                           CSD027
      *                                                                   CPM005
     C           *IN62     DOWEQ'0'                        BW1            CPM005
     C           PNCNUM    ANDEQWSCNUM                                    CPM005
      *                                                                   CPM005
     C           PNRECI    IFEQ 'D'                        B1             CPM005
     C           PNPTFR    ANDNE'9997'                                    CPM005
     C           PNPTFR    ANDNE'9998'                                    CPM005
     C           PNPTFR    ANDNE'9999'                                    CPM005
     C**********           Z-ADDPNCNUM    W2CNUM                                       CPM005 CSD027
     C                     MOVE PNCNUM    W2CNUM                                              CSD027
     C                     MOVELPNPTFR    W2PTFR                          CPM005
      *                                                                   CPM005
     C           PMPORT    CHAINPMPOTTPD             61                   CPM005
      *                                                                   CPM005
     C           *IN61     IFEQ '0'                        B2             CPM005
      *                                                                   CPM005
      ** Calculate Portfolio Total                                        CPM005
     C                     EXSR SRTOT                                     CPM005
      *                                                                   CPM005
     C           WWPTTA    IFNE *ZEROS                     B3             CPM005
     C                     ADD  1         WWCOUN                          CPM005
     C                     END                             E3             CPM005
      *                                                                   CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     END                             E1             CPM005
     C                     READ PMPORTPD                 62               CPM005
     C                     ENDDO                           EW1            CPM005
      *                                                                   CPM005
      ** "Display non Portfolio Picture" from SDPORTPD                    CPM005
     C           FCDP97    IFEQ 'Y'                        B1             CPM005
     C**********           Z-ADDQNCNUM    W2CNUM                                       CPM005 CSD027
     C                     MOVE QNCNUM    W2CNUM                                              CSD027
     C                     MOVEL'9997'    W2PTFR                          CPM005
      *                                                                   CPM005
     C           PMPORT    CHAINPMPOTTPD             61                   CPM005
      *                                                                   CPM005
     C           *IN61     IFEQ '0'                        B2             CPM005
      *                                                                   CPM005
      ** Calculate Portfolio Total                                        CPM005
     C                     EXSR SRTOT                                     CPM005
      *                                                                   CPM005
     C           WWPTTA    IFNE *ZEROS                     B3             CPM005
     C                     ADD  1         WWCOUN                          CPM005
     C                     END                             E3             CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
     C           WWCOUN    IFGT 1                          B1             CPM005
      *
      *................................................................
      *
     C                     CALL 'CG4151'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM W0CMT     ##CMT   3
     C                     PARM *BLANK    ##COPD  1
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4151  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 51 *
     C                     Z-ADD51        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *................................................................
      *                                                                   CPM005
      ** Display Instrument Summary                                       CPM005
     C           QNS9VR    IFEQ 'Y'                        B2             CPM005
     C                     CALL 'CG4160'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4160  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 60 *CPM005
     C                     Z-ADD60        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
      ** Display Currency Summary                                         CPM005
     C           QNS0VR    IFEQ 'Y'                        B2             CPM005
     C                     CALL 'CG4161'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4161  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 61 *CPM005
     C                     Z-ADD61        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     ELSE                            X1             CPM005
      *                                                                   CPM005
      ** Display Instrument Summary is 'Y'                                CPM005
     C                     SELEC                                          CPM005
      *                                                                   CPM005
     C           QNS9VR    WHEQ 'Y'                                       CPM005
     C                     Z-ADD0         WWPNBR  30                      CPM005
     C                     CALL 'CG4160'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4160  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 62 *CPM005
     C                     Z-ADD62        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
     C           QNS0VR    IFEQ 'Y'                        B2             CPM005
     C                     CALL 'CG4161'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4161  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 63 *CPM005
     C                     Z-ADD63        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C           QNS9VR    WHEQ 'N'                                       CPM005
      *                                                                   CPM005
     C           QNS0VR    IFEQ 'Y'                        B2             CPM005
     C                     Z-ADD0         WWPNBR  30                      CPM005
     C                     CALL 'CG4161'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4161  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 64 *CPM005
     C                     Z-ADD64        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
     C                     ELSE                            X2             CPM005
     C                     Z-ADD0         WWPNBR  30                      CPM005
     C                     CALL 'CG4151'                                  CPM005
     C                     PARM *BLANKS   ##RTCD                          CPM005
     C                     PARM W0CMT     ##CMT                           CPM005
     C                     PARM *BLANK    ##COPD                          CPM005
     C                     PARM           DSPARM                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     ENDSL                                          CPM005
      *                                                                   CPM005
     C                     END                             E1             CPM005
      *
     C           EXSUMM    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5                                                            CPM005
      *****************************************************************   CPM005
      * Subroutine  :  SRPARM                                         *   CPM005
      * Function    :  Output Parameters                              *   CPM005
      *                                                               *   CPM005
      * Called by   :  Mainline                                       *   CPM005
      * Calls       :                                                 *   CPM005
      *****************************************************************   CPM005
     C           SRPARM    BEGSR                                          CPM005
      *                                                                   CPM005
      **  Set up subroutine stack name                                    CPM005
     C                     ADD  1         Q       50                      CPM005
     C                     MOVEL'SRPARM'  @STK,Q                          CPM005
      *                                                                   CPM005
      ** Set up Portfolio details. Details should be set to details       CPM005
      ** from PMPORTPD except for '9997' '9998' and '9999' Portfolios     CPM005
      ** when should contain information from SDPLCSPD                    CPM005
     C           QNPTFR    IFNE '9997'                     B1             CPM005
     C           QNPTFR    ANDNE'9998'                                    CPM005
     C           QNPTFR    ANDNE'9999'                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRPORT                                    CPM005
      *                                                                   CPM005
     C                     MOVE PNPTFR    WWPTFR                          CPM005
     C                     MOVE PNPTFR    WWPTFF                          CPM005
     C                     MOVE PNPTFN    WWPTFN                          CPM005
     C                     MOVE PNPTCY    WWPTCY                          CPM005
     C                     Z-ADDPNPCDP    WWPCDP                          CPM005
      *                                                                   CPM005
      ** Otherwise use details from SDPLCSPD                              CPM005
     C                     ELSE                            X1             CPM005
      *                                                                   CPM005
     C           QNPTFR    IFEQ '9997'                     B2             CPM005
     C                     MOVE WWR997    WWPTFR                          CPM005
     C                     MOVE WWN997    WWPTFN                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C           QNPTFR    IFEQ '9998'                     B2             CPM005
     C                     MOVE FCR998    WWPTFR                          CPM005
     C                     MOVE FCN998    WWPTFN                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C           QNPTFR    IFEQ '9999'                     B2             CPM005
     C                     MOVE FCR999    WWPTFR                          CPM005
     C                     MOVE FCN999    WWPTFN                          CPM005
     C                     END                             E2             CPM005
      *                                                                   CPM005
     C                     MOVE QNPTFR    WWPTFF                          CPM005
     C                     MOVE WWCSBY    WWPTCY                          CPM005
     C                     Z-ADDWWBYDP    WWPCDP                          CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
      **  Unwind subroutine stack name                                    CPM005
     C                     MOVEA*BLANKS   @STK,Q                          CPM005
     C                     SUB  1         Q                               CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      *****************************************************************   CPM005
     C/SPACE 5                                                            CPM005
      *****************************************************************   CPM005
      * Subroutine  :  SRTOT                                          *   CPM005
      * Function    :  Calculate Portfolio Total                      *   CPM005
      *                                                               *   CPM005
      * Called by   :  Mainline                                       *   CPM005
      * Calls       :                                                 *   CPM005
      *****************************************************************   CPM005
     C           SRTOT     BEGSR                                          CPM005
      *                                                                   CPM005
      **  Set up subroutine stack name                                    CPM005
     C                     ADD  1         Q       50                      CPM005
     C                     MOVEL'SRTOT'   @STK,Q                          CPM005
      *                                                                   CPM005
     C                     Z-ADD*ZEROS    WWPTTA 150                      CPM005
     C                     Z-ADD*ZEROS    WWWORK 150                      CPM005
      *                                                                   CPM005
      ** If Trade Value Date position is 'T'                              CPM005
     C           WWTVPS    IFEQ 'T'                        B1             CPM005
     C           QCPTPA    SUB  QCPTNA    WWPTTA                          CPM005
     C           QCPTMV    ADD  QCPTAI    WWWORK                          CPM005
     C           WWPTTA    SUB  WWWORK    WWPTTA                          CPM005
     C                     ELSE                            X1             CPM005
     C           QCPVPA    SUB  QCPVNA    WWPTTA                          CPM005
     C           QCPTMV    ADD  QCPTAI    WWWORK                          CPM005
     C           WWPTTA    SUB  WWWORK    WWPTTA                          CPM005
     C                     END                             E1             CPM005
      *                                                                   CPM005
      **  Unwind subroutine stack name                                    CPM005
     C                     MOVEA*BLANKS   @STK,Q                          CPM005
     C                     SUB  1         Q                               CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      *****************************************************************   CPM005
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDETL                                         *
      * Function    :  Process Portfolio Details                      *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDETL    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRDETL'  @STK,Q
      *
      *................................................................
      *                                                                   CPM005
     C           WFIRST    IFNE 'Y'                        B1             CPM005
     C           QNS9VR    IFEQ 'Y'                        B2             CPM005
     C                     CALL 'CG4160'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4160  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 65 *CPM005
     C                     Z-ADD65        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
     C                     END                             E2             CPM005
     C*                                                                   CPM005
     C           QNS0VR    IFEQ 'Y'                        B2             CPM005
     C                     CALL 'CG4161'                                  CPM005
     C                     PARM *BLANKS   ##RTCD  7                       CPM005
     C                     PARM W0CMT     ##CMT   3                       CPM005
     C                     PARM *BLANK    ##COPD  1                       CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4161  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 66 *CPM005
     C                     Z-ADD66        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
     C                     END                             E2             CPM005
     C                     END                             E1             CPM005
      *
      ** OUTPUT HOLDINGS LIST IF REQUIRED
      *
     C           QNS1VR    IFEQ 'Y'                        B1
     C                     EXSR SRHLG
     C                     END                             E1
      *
      ** OUTPUT SECTOR BREAKDOWNS IF REQUIRED
      *
     C           QNS2VR    IFEQ 'Y'                        B1
     C                     EXSR SRINS
     C                     EXSR SRCCY
     C                     EXSR SRIND
     C                     EXSR SRCNT
     C                     END                             E1
     C*                                                                   CPM005
     C** OUTPUT PERFORMANCE STATISTICS IF REQUIRED                        CPM005
     C           QNS3VR    IFEQ 'Y'                        B1             CPM005
     C           QNS4VR    OREQ 'Y'                                       CPM005
     C           QNS5VR    OREQ 'Y'                                       CPM005
     C                     EXSR SRPER                                     CPM005
     C                     END                             E1             CPM005
      *
      ** OUTPUT DAILY CASHFLOWS IF REQUIRED
      *
     C           QNS6VR    IFEQ 'Y'                        B1
     C                     EXSR SRDCF
     C                     END                             E1
      *
      ** OUTPUT MONTHLY CASHFLOWS IF REQUIRED
      *
     C           QNS7VR    IFEQ 'Y'                        B1
     C                     EXSR SRMCF
     C                     END                             E1
      *
      ** OUTPUT YEARLY CASHFLOWS IF REQUIRED
      *
     C           QNS8VR    IFEQ 'Y'                        B1
     C                     EXSR SRYCF
     C                     END                             E1
      *................................................................
      *
     C           EXDETL    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRHLG                                          *
      * Function    :  Process Holdings List                          *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRHLG     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRHLG '  @STK,Q
      *
      *................................................................
      *
      ** Check if holdings are present for this portfolio
      *
      ** Trade Date Details
      *
     C********** FCTVPS    IFEQ 'T'                        B1             CPM005
     C           PORTK     SETLLPMHOLDL4
     C           PORTK     READEPMHOLDL4                 70*
     C                     MOVE '0'       *IN75
      *
     C           *IN70     DOWEQ'0'                        B2
     C           *IN75     ANDEQ'0'
     C           QFMVPC    IFNE 0                          B3
     C           QFAIPC    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C           PORTK     READEPMHOLDL4                 70*
     C                     END                             E2
     C**********           END                             E1             CPM005
      **********                                                          CPM005
      ***Value*Date Details                                               CPM005
      **********                                                          CPM005
     C********** FCTVPS    IFNE 'T'                        B1             CPM005
     C********** PORTK     SETLLPMHOLDL5                                  CPM005
     C********** PORTK     READEPMHOLDL5                 70*              CPM005
     C**********           MOVE '0'       *IN75                           CPM005
      **********                                                          CPM005
     C********** *IN70     DOWEQ'0'                        B2             CPM005
     C********** *IN75     ANDEQ'0'                                       CPM005
     C********** QFMVPC    IFNE 0                          B3             CPM005
     C********** QFAIPC    ORNE 0                                         CPM005
     C**********           MOVE '1'       *IN75                           CPM005
     C**********           END                             E3             CPM005
     C********** PORTK     READEPMHOLDL5                 70*              CPM005
     C**********           END                             E2             CPM005
     C**********           END                             E1             CPM005
      *
      *
      ** If holdings are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4152'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4152  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 52 *
     C                     Z-ADD52        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXHLG     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINS                                          *
      * Function    :  Process Instrument Breakdown                   *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRINS     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRINS '  @STK,Q
      *
      *................................................................
      *
     C           PORTK     KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWPTFF
      *
      ** Check if instrument details are present for this portfolio
      *
     C           PORTK     SETLLPMISTTPD
     C           PORTK     READEPMISTTPD                 70*
     C                     MOVE '0'       *IN75
      *
     C           *IN70     DOWEQ'0'                        B1
     C           *IN75     ANDEQ'0'
      *
      ** Trade or Value Date Details
     C           FCTVPS    IFEQ 'T'                        B2
     C           QEPTPA    IFNE 0                          B3
     C           QEPTNA    ORNE 0
     C           QEPTMV    ORNE 0
     C           QEPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C                     ELSE                            X2
     C           QEPVPA    IFNE 0                          B3
     C           QEPVNA    ORNE 0
     C           QEPVMV    ORNE 0
     C           QEPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C                     END                             E2
      *
     C           PORTK     READEPMISTTPD                 70*
     C                     END                             E1
      *
      ** If instrument details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4153'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4153  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 53 *
     C                     Z-ADD53        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXINS     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRCCY                                          *
      * Function    :  Process Currency Breakdown                     *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRCCY     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRCCY '  @STK,Q
      *
      *................................................................
      *
      ** Check if currency details are present for this portfolio
      *
     C           PORTK     SETLLPMCCYTPD
     C           PORTK     READEPMCCYTPD                 70*
     C                     MOVE '0'       *IN75
      *
     C           *IN70     DOWEQ'0'                        B1
     C           *IN75     ANDEQ'0'
      *
      ** Trade or Value Date Details
     C           FCTVPS    IFEQ 'T'                        B2
     C           QGPTPA    IFNE 0                          B3
     C           QGPTNA    ORNE 0
     C           QGPTMV    ORNE 0
     C           QGPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C                     ELSE                            X2
     C           QGPVPA    IFNE 0                          B3
     C           QGPVNA    ORNE 0
     C           QGPVMV    ORNE 0
     C           QGPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E3
     C                     END                             E2
      *
     C           PORTK     READEPMCCYTPD                 70*
     C                     END                             E1
      *
      ** If currency details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4154'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4154  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 54 *
     C                     Z-ADD54        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXCCY     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRIND                                          *
      * Function    :  Process Industry Breakdown                     *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRIND     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRIND '  @STK,Q
      *
      *................................................................
      *
      ** Check if industry details are present for this portfolio
      *
     C           PORTK     SETLLPMINDTPD
     C           PORTK     READEPMINDTPD                 70*
     C                     MOVE '0'       *IN75
      *
     C           *IN70     DOWEQ'0'                        B1
     C           *IN75     ANDEQ'0'
      *
      ** Trade or Value Date Details
     C********** QILIND    IFNE 0                          B2                               BUG23967
     C           QILOIC    IFNE ' '                        B2                               BUG23967
     C           FCTVPS    IFEQ 'T'                        B3
     C           QIPTPA    IFNE 0                          B4
     C           QIPTNA    ORNE 0
     C           QIPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E4
     C                     ELSE                            X3
     C           QIPVPA    IFNE 0                          B4
     C           QIPVNA    ORNE 0
     C           QIPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
      *
     C           PORTK     READEPMINDTPD                 70*
     C                     END                             E1
      *
      ** If industry details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4155'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4155  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 55 *
     C                     Z-ADD55        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXIND     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRCNT                                          *
      * Function    :  Process Country Breakdown                      *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRCNT     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRCNT '  @STK,Q
      *
      *................................................................
      *
      ** Check if country details are present for this portfolio
      *
     C           PORTK     SETLLPMCNTTPD
     C           PORTK     READEPMCNTTPD                 70*
     C                     MOVE '0'       *IN75
      *
     C           *IN70     DOWEQ'0'                        B1
     C           *IN75     ANDEQ'0'
      *
      ** Trade or Value Date Details
     C           QHCNTR    IFNE *BLANKS                    B2
     C           FCTVPS    IFEQ 'T'                        B3
     C           QHPTPA    IFNE 0                          B4
     C           QHPTNA    ORNE 0
     C           QHPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E4
     C                     ELSE                            X3
     C           QHPVPA    IFNE 0                          B4
     C           QHPVNA    ORNE 0
     C           QHPTAI    ORNE 0
     C                     MOVE '1'       *IN75
     C                     END                             E4
     C                     END                             E3
     C                     END                             E2
      *
     C           PORTK     READEPMCNTTPD                 70*
     C                     END                             E1
      *
      ** If country details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4156'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4156  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 56 *
     C                     Z-ADD56        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXCNT     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5                                                            CPM005
      *****************************************************************   CPM005
      * Subroutine  :  SRPER                                          *   CPM005
      * Function    :  Process Performance Breakdown                  *   CPM005
      *                                                               *   CPM005
      * Called by   :  Mainline                                       *   CPM005
      * Calls       :                                                 *   CPM005
      *****************************************************************   CPM005
     C           SRPER     BEGSR                                          CPM005
      *                                                                   CPM005
      **  Set up subroutine stack name                                    CPM005
     C                     ADD  1         Q                               CPM005
     C                     MOVEL'SRPER '  @STK,Q                          CPM005
      *                                                                   CPM005
      *................................................................   CPM005
      *                                                                   CPM005
      ** If Performance amount is different than 0 for an item, then      CPM005
      ** print Portfolio Performance Summary                              CPM005
     C           PORTKY    SETLLPMPSPOQ0                                  CPM005
     C                     READ PMPSPOQ0                 71               CPM005
      *                                                                   CPM005
     C           *IN71     IFEQ '0'                                       CPM005
     C           QVPFMA    ANDNE0                                         CPM005
     C                     GOTO PERF                                      CPM005
     C                     ELSE                                           CPM005
     C                     GOTO NOPERF                                    CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           PERF      TAG                                            CPM005
      *                                                                   CPM005
     C                     CALL 'CG4162'                                  CPM005
     C                     PARM *BLANKS   ##RTCD                          CPM005
     C                     PARM W0CMT     ##CMT                           CPM005
     C                     PARM *BLANK    ##COPD                          CPM005
     C                     PARM           DSPARM                          CPM005
      *                                                                   CPM005
      **  Error in called program.                                        CPM005
     C           ##RTCD    IFNE *BLANK                                    CPM005
      *                                                                   CPM005
     C                     EXSR SRAUDT                                    CPM005
      *                                                                   CPM005
      ** Database error                                                   CPM005
     C                     MOVEL'CG4162  'W0FILE           ***************CPM005
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 67 *CPM005
     C                     Z-ADD67        W0ERNB           ***************CPM005
     C                     MOVEL'MEM5003' W0MSGD                          CPM005
     C                     MOVEL'MIDAS  ' W0MSGF                          CPM005
     C                     EXSR SRERR                                     CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C           NOPERF    TAG                                            CPM005
      *................................................................   CPM005
      *                                                                   CPM005
     C           EXPER     TAG                                            CPM005
      *                                                                   CPM005
      **  Unwind subroutine stack name                                    CPM005
     C                     MOVEA*BLANKS   @STK,Q                          CPM005
     C                     SUB  1         Q                               CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      *****************************************************************   CPM005
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDCF                                          *
      * Function    :  Process Daily Cash Flow Summary                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDCF     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRDCF '  @STK,Q
      *
      *................................................................
      *
      ** Check if daily cashflow details are present for this portfolio
      *
     C           PORTK     SETLLPMCFDYPD
     C           PORTK     READEPMCFDYPD                 70*
     C                     MOVE '0'       *IN75
     C           *IN70     IFEQ '0'                        B1
     C                     MOVE '1'       *IN75
     C                     END                             E1
      *
      ** If daily cashflow details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4157'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4157  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 57 *
     C                     Z-ADD57        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXDCF     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMCF                                          *
      * Function    :  Process Monthly Cash Flow                      *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMCF     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMCF '  @STK,Q
      *
      *................................................................
      *
      ** KEY LIST FOR PMCFMYPD
      *
     C           CFMYK     KLIST
     C                     KFLD           QLCNUM
     C                     KFLD           QLPTFR
     C                     KFLD           QLMYIN
      *
      ** Check if monthly cashflow details are present for this portfolio
      *
     C                     MOVE WWCNUM    QLCNUM
     C                     MOVE WWPTFF    QLPTFR
     C                     MOVE 'M'       QLMYIN
     C           CFMYK     SETLLPMCFMYPD
     C           CFMYK     READEPMCFMYPD                 70*
     C                     MOVE '0'       *IN75
     C           *IN70     IFEQ '0'                        B1
     C                     MOVE '1'       *IN75
     C                     END                             E1
      *
      ** If monthly cashflow details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4158'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4158  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 58 *
     C                     Z-ADD58        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXMCF     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRYCF                                          *
      * Function    :  Process Yearly Cash Flow                       *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRYCF     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRYCF '  @STK,Q
      *
      *................................................................
      *
      ** Check if yearly cashflow details are present for this portfolio
      *
     C                     MOVE WWCNUM    QLCNUM
     C                     MOVE WWPTFF    QLPTFR
     C                     MOVE 'Y'       QLMYIN
     C           CFMYK     SETLLPMCFMYPD
     C           CFMYK     READEPMCFMYPD                 70*
     C                     MOVE '0'       *IN75
     C           *IN70     IFEQ '0'                        B1
     C                     MOVE '1'       *IN75
     C                     END                             E1
      *
      ** If yearly cashflow details are present, extract them
      *
     C           *IN75     IFEQ '1'                        B1
     C                     CALL 'CG4159'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM W0CMT     ##CMT
     C                     PARM *BLANK    ##COPD
     C                     PARM           DSPARM
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     EXSR SRAUDT
      *
      ** Database error
     C                     MOVEL'CG4159  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 59 *
     C                     Z-ADD59        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END                             E1
      *................................................................
      *
     C           EXYCF     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINZ                                          *
      * Function    :  Initialise Fields on Program Invocation        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  CGZAUDIT - Audit Processing                    *
      *****************************************************************
     C           SRINZ     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      *................................................................
      *
      **  Open the Audit Print File.
     C                     CLEARI#DTA
     C                     MOVEL'CG4150AU'I#SPLN
     C                     MOVEL'CG4150  'I#REF
     C                     MOVE 'CGD1903' I#TITL
     C                     MOVE 'CGD1904' I#TUL
     C                     MOVEL'CGUSRMSG'I#FILE
     C*
     C                     CALL 'CGZAUDIT'
     C                     PARM *BLANKS   W0RTN   7
     C                     PARM '*OPEN   'W0ACT   8
     C                     PARM           I#DTA
     C                     PARM           W0RSQN  5
      *
      *................................................................
      *
     C           EXINZ     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     Z-ADD*ZEROS    ##DREC
     C                     CLEARDSPARM
      *
      **  Copyright
     C                     MOVEA##CPY     ##CPY2 80
     C/COPY WNCPYSRC,CG4150C002
      *
      ** OBTAIN THE BANK ICD
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG  '  RTCD
     C                     PARM '*FIRST'  OPTN
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDBANKPD'W0FILE           ***************
     C                     MOVEL'*FIRST'  W0KEY            * DB ERROR 01 *
     C                     Z-ADD01        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *                                                                   CPB001
      ** OBTAIN MODULE DETAILS                                            CPB001
      *                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM '*MSG  '  RTCD                            CPB001
     C                     PARM '*FIRST'  OPTN                            CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
      *                                                                   CPB001
      ** Database error                                                   CPB001
      *                                                                   CPB001
     C           RTCD      IFNE *BLANKS                                   CPB001
     C                     EXSR SRAUDT                                    CPB001
     C                     MOVEL'SDMMODPD'W0FILE           ***************CPB001
     C                     MOVEL'*FIRST'  W0KEY            * DB ERROR 16 *CPB001
     C                     Z-ADD16        W0ERNB           ***************CPB001
     C                     MOVEL'MEM5004' W0MSGD                          CPB001
     C                     MOVEL'MIDAS  ' W0MSGF                          CPB001
     C                     EXSR SRERR                                     CPB001
     C                     ENDIF                                          CPB001
      *
      ** OBTAIN THE PM ICD
      *
     C                     CALL 'AOPORTR0'
     C                     PARM '*MSG  '  RTCD    7
     C                     PARM '*FIRST'  OPTN    7
     C           SDPORT    PARM SDPORT    DSFDY
      *
      ** Database error
      *
     C           RTCD      IFNE *BLANKS
     C                     EXSR SRAUDT
     C                     MOVEL'SDPORTPD'W0FILE           ***************
     C                     MOVEL'*FIRST'  W0KEY            * DB ERROR 02 *
     C                     Z-ADD02        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** OBTAIN THE PM EVENT CONTROL AND LAST EXTRACT DATE
      *
     C           *NAMVAR   DEFN           PMSTAT
     C                     IN   PMSTAT
      *
      ** SET UP ICD PARAMETERS TO BE PASSED TO CALLED PROGRAMS
      *
      ** Trade/Value Date Positions
     C                     MOVE FCTVPS    WWTVPS
     C*
      ** Display Non Portfolio Picture
     C                     MOVE FCDP97    WWDP97
      *
      ** 9997 Reference
     C                     MOVE FCR997    WWR997
      *
      ** 9997 Narrative
     C                     MOVE FCN997    WWN997
      *
      ** Event Control Date
     C                     Z-ADDDAECD     WWECD
      *
      ** Date of FX Rates
      ** (In input cycle details reported are from last night.
      **  In COB the current FX rates are used).
      *
     C********** W@PHAS    IFEQ 'A'                                                           CCB020
     C********** BJRDNB    SUB  1         WWFXDT                                              CCB020
     C**********           ELSE                                                               CCB020
     C**********           Z-ADDBJRDNB    WWFXDT                                              CCB020
     C**********           END                                                                CCB020
      *                                                                                       CCB020
     C                     MOVEL'CBC00100'WWPGNM  9                                           CCB020
     C                     MOVE '1'       WWPGNM                                              CCB020
     C                     CALL WWPGNM                                                        CCB020
     C                     PARM           COBST   4                                           CCB020
     C           COBST     IFEQ '*NO'                                                         CCB020
     C           BJRDNB    SUB  1         WWFXDT                                              CCB020
     C                     ELSE                                                               CCB020
     C                     Z-ADDBJRDNB    WWFXDT                                              CCB020
     C                     ENDIF                                                              CCB020
      *
      ** Last Extract Date
     C                     Z-ADDDALXTR    WWLXDT
      *
      ** Show Fees & Charges
     C                     MOVE FCSHFC    WWSHFC
      *
      ** Show Capital Change Charges
     C                     MOVE FCSHCC    WWSHCC
      *                                                                   CPM005
      ** Percentage Calculation Method                                    CPM005
     C                     MOVE FCPCAM    WWPCAM                          CPM005
      *
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRAUDT                                         *
      * Function    :  Audit Report Processing                        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  CGZAUDIT - Audit Processing                    *
      *                CG9020   - Write Data to UDC Data Files - Audit*
      *****************************************************************
     C           SRAUDT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRAUDT'  @STK,Q
      *
      *................................................................
      *
      **  Output the Count of records read
     C                     CLEARI#DTA
     C                     MOVEL'CG4150  'I#REF
     C                     MOVE 'CGD1903' I#TITL
     C                     MOVE 'CGD1904' I#TUL
     C                     MOVEL'CGUSRMSG'I#FILE
     C                     MOVE '*LINE   'W1ACT
     C                     MOVE *BLANKS   I#SUB
     C                     MOVEL'PMPTDVPD'I#SUB
     C                     MOVEL'CAD1021' I#TEXT
     C                     Z-ADD##DREC    I#QTY
     C                     Z-ADD*ZERO     I#DECS
     C                     MOVE '1'       I#EDIT
     C*
     C                     CALL 'CGZAUDIT'
     C                     PARM           W1RTN   7
     C                     PARM           W1ACT   8
     C                     PARM           I#DTA
     C                     PARM           W1RSQN  5
      *
      **  Skip a line.
     C                     MOVE '*SKIP   'W1ACT
     C*
     C                     CALL 'CGZAUDIT'
     C                     PARM           W1RTN   7
     C                     PARM           W1ACT   8
     C                     PARM           I#DTA
     C                     PARM           W1RSQN  5
      *
      **  Produce the Audit Report.
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*AUDIT  'W0ACT
     C                     PARM *BLANKS   W0PATH256
     C                     PARM           W0FMT
     C                     PARM 'CGD1903' W0TITL  7
     C                     PARM 'CGD1904' W0ULIN  7
     C                     PARM           W0CMT
      *
      **  Close the Audit Print File.
     C                     CLEARI#DTA
     C                     MOVEL'CG4150  'I#REF
     C                     MOVE 'CGD1903' I#TITL
     C                     MOVE 'CGD1904' I#TUL
     C                     MOVEL'CGUSRMSG'I#FILE
      *
     C                     CALL 'CGZAUDIT'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*CLOSE  'W0ACT   8
     C                     PARM           I#DTA
     C                     PARM           W0RSQN  5
      *
      *................................................................
      *
     C           EXAUDT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRPSSR
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRC
     O/SPACE 5
     OPMPTDVP1E                PMPTDV
     O                         QNEUDC
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
