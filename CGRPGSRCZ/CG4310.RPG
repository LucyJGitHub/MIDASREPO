     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CG Securities depot movement confs')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - User Defined Correspondence                          *
     F*                                                               *
     F*  CG4310 - Securities Depot Movement Confirmations             *
     F*                                                               *
     F*  Function:  This program xxxxxxxxxxxxxxxxxxxxxxxxxxxx         *
     F*  (phase(s))                                                   *
     F*                                                               *
     F*  Called By: CG4300  - SE Depot Movement Confirmations - Driver*
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 AR1086147B         Date 21Mar13               *
      *                 AR1086147A         Date 12Feb13               *
      *                 243124             Date 06Feb13               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243124A            Date 28Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG11112           Date 07Jun06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9603            Date 13Dec05               *
      *                 237063             Date 20Nov05               *
      *                 236024             Date 23Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 CDL038             Date 10May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 BUG7326            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 214731             Date 27May03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 170783             Date 09Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 196380             Date 15May02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 207006             Date 18Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CCG015             Date 09Aug01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 191550             Date 16May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *
     F*                 CEU014             Date 17Jun98               *
     F*                 116840             Date 30May97               *
     F*                 119143             DATE 30May97               *
     F*                 089776             DATE 17APR96               *
     F*                 089693             DATE 16APR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 094586             DATE 28JUN95               *
     F*                 088832             DATE 08JUN95               *
     F*                 087972             DATE 18MAY95               *
     F*                 086962             DATE 03MAY95               *
     F*                 086918             DATE 02MAY95               *
     F*                 086780             DATE 01MAY95               *
     F*                 086864             DATE 01MAY95               *
     F*                 UBL009             DATE 10NOV94               *
     F*                 082060             DATE 24JAN95               *
     F*                 081961             DATE 12JAN95               *
     F*                 S01522             DATE 22NOV94               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  AR1086147B - Removed PROCES flag and ##COPD to 'B' introduced*
      *               by 243124 and 243124A.                          *
      *  AR1086147A - Removed PROCES flag and ##COPD to 'B' introduced*
      *               by 243124 and 243124A.                          *
      *  243124  - Amended the program to complete fix 243124.        *
      *            Applied for AR1086147                              *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  243124A - DBase error caused by REPO with deal not yet       *
      *            authorised.                                        *
      *  BUG11112 - Correspondence Manager changes for CDL033         *
      *             enhancement.                                      *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9603 - Changes in CGPACKE caused some programs not to     *
      *            compile.                                           *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  236024 - Extract original purchase date, original purchase   *
      *           interest and average fiscal price.                  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  BUG7326 - General ledger account incomplete in element       *
      *            <SaleReceiveOurXGeneralLedger> and <SalePayOur     *
      *            XGeneralLedger>. This is due to field ##OGA        *
      *            still 20-char long and not expanded to 24 chars    *
      *            (missed out by CGL029). Also note length of RDEs   *
      *            S_RECOURXG and S_PAYOURXG was increased from 20    *
      *            to 24.                                             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  214731 - Add Portfolio Reference and Investment Name in      *
      *           Securities modules extracts.                        *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  170783 - Recompile over changed ZLCDZ1.                      *
      *  196380 - COB Error in SEC05.  Deal associated to a Depot     *
      *           Movement is not in DEALSDC, but in DLCHISPD. Fix is *
      *           to search DLCHISPD if deal is not found in DEALSDC. *
      *  207006 - Add Counterparty & Market Centre to SSI (Recompile) *
      *  CCG015 - Correspondence Manager Phase 1                      *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  191550 - Extract IN date or OUT date for walk-in/walk-out    *
      *           and also the portfolio reference. Rename field      *
      *           PTFR of deals file to DLPTFR.                       *
      *  CSD006 - Recompiled over changed SDCURRPD.                   *
      *  CSE015 - Forward Valued Depot Movement (Recompile)           *
     F*  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
     F*  CSE012 - SE Depot Movement Narratives                        *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  CEU014 - EMU User Defined Correspondence Enhancement.        *
     F*  116840 - C.D. Reference not available on all                 *
     F*           occurences of D_LAD                                 *
     F*  119143 - Add fix 089649 to Depot Movements extract program   *
     F*  089776 - Add 'Account officer' details                       *
     F*  089693 - Add 'ISIN/COMMON CODE' to group set T_SECD          *
     F*  092961 - Recompile over ZDAYSZ2 for 086491                   *
     F*           Wrong number of days calculated for day basis 1     *
     F*           when start or end day is last day of February.      *
     F*  094586 - Print last confirmation                             *
     F*  088832 - If charge amount zero fill the RDE with zeros not   *
     F*           blanks.                                             *
     F*  087972 - Place Midas derived sec. desc always in line 3      *
     F*  UBL009 - SE Charge and Commission Enhancements -             *
     F*  086962 - Add 'Start or Last Interest date' to group set D_LAD*
     F*  086918 - Add customer town RDE to Group set CUST.            *
     F*  086780 - Add currencies descriptions.                        *
     F*  086864 - Add interest paid seperately and Special Instructions
     F*  082060 - Redefine Binary fields as Decimal (9,0 Packed)      *
     F*  081961 - User Defined Correspondence - Additions             *
     F*  S01522 - User Defined Correspondence                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*  02   -    Deal read from DEALSDC                             *
     F*                                                               *
     F*  99   -    General work indicator                             *
     F*                                                               *
     F*****************************************************************
     FSECTY   IF  E           K        DISK
     F                                              KINFSR SRFILE
     FINVTP   IF  E           K        DISK
     F                                              KINFSR SRFILE
     FSECGT   IF  E           K        DISK
     F                                              KINFSR SRFILE
     FDPTMVDY1IF  E           K        DISK
     F                                              KINFSR SRFILE
     FDEALS   IF  E           K        DISK
     F                                              KINFSR SRFILE
     FDEALSALLIF  E           K        DISK                                                   196380
     F            DEALSDBF                          KIGNORE                                   196380
     F            DEALSDCF                          KIGNORE                                   196380
     F            DEALSDDF                          KIGNORE                                   196380
     F            DEALSDEF                          KIGNORE                                   196380
     F            DEALSDGF                          KIGNORE                                   196380
     F**********  MMDELDP0                          KIGNORE                           196380 243124A
     F            MMDENBP0                          KIGNORE                                   196380
     F            MMDENSP0                          KIGNORE                                   196380
     F            FXDEALP0                          KIGNORE                                   196380
     F            DLBHISD0                          KIGNORE                                   196380
     F            DLDHISD0                          KIGNORE                                   196380
     F            DLEHISD0                          KIGNORE                                   196380
     F            DLGHISD0                          KIGNORE                                   196380
     FSDBRTDL1IF  E           K        DISK
     F                                              KINFSR SRFILE
     FSDCBRTL1IF  E           K        DISK
     F                                              KINFSR SRFILE
     F/COPY WNCPYSRC,CG4310FRPG                                           UBL009
     FDPTMV   IF  E           K        DISK                               CSE012
     F                                              KINFSR SRFILE         CSE012
     F**  Define Depot Movements Commission File                          UBL009
     F*                                                                   UBL009
     F/SPACE 5
     E/COPY CGCPYSRC,CGPACKE
     E/COPY CGCPYSRC,SRERRE
     E**  Number Arrays
     E                    ##W        20  1
     E                    ##NUMA     29  1
     E*
     E* ##GRP = Group/RDE Number               ##RDEA = RDE + Attributes
     E*
     E********************##GRP   1  85 10   ##RDEA 22                    086864
     E********************##GRP   1  89 10   ##RDEA 22              086864086918
     E********************##GRP   1  90 10   ##RDEA 22              086918086962
     E************        ##GRP   1  91 10   ##RDEA 22              086962089693
     E/COPY WNCPYSRC,CG4310E001
     E************        ##GRP   1  92 10   ##RDEA 22              089693119143
     E************        ##GRP   1  93 10   ##RDEA 22              119143116840
     E************        ##GRP   1  94 10   ##RDEA 22              116840CEU014
     E***********         ##GRP   1 104 10   ##RDEA 22              CEU014CSE012
     E**********          ##GRP   1 110 10   ##RDEA 22              CSE012191550
     E**********          ##GRP   1 112 10   ##RDEA 22                                  191550214731
     E**********          ##GRP   1 114 10   ##RDEA 22                                 214731 236024
     E**********          ##GRP   1 117 10   ##RDEA 22                               236024 BUG11112
     E                    ##GRP   1 135 10   ##RDEA 22                                      BUG11112
     E/COPY WNCPYSRC,CG4310E002
     E*
     E**  Array of Currencies accessed by program
     E                    ##CY      100  3
     E*
     E**  Arrays of Proc. Type (PROT) and the associated print item sub-type
     E                    ##PT    1   9  1   ##PS   10
     E*
     E**  Loan Deal Types.
     E                    #LN     7   7  2
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZSDESCZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDAYSZ1
     IDEALSDCF    02
     I              PTFR                            DLPTFR                191550
     IDEALSDBF                                                            191550
     I              PTFR                            DLPTFR                191550
     ISDCBRTD0
     I              H2TITL                          X2TITL
     I*
     I*********** DS                                                      082060
     I***********                         B   1   20##OSEQ                082060
     I****Convert Output Sequence between Numeric and Binary              082060
     I*
     I            DS
     I                                        1  10 ##GRPX
     I                                        1   6 ##GRPS
     I                                        7  100##RDEN
     I**  Look-up string for RDE definition Array
     I*
     I##SDS       DS
     I**********                              15120 ##S                                      BUG9603
     I                                        15632 ##S                                      BUG9603
     I**  Packed data string.
     I*
     I            DS
     I                                        1  20 ##W
     I                                        1  200##WNUM
     I**  Number Field
     I*
     I            DS
     I                                        1   8 ##ITMA
     I                                        1   80##ITEM
     I** Used to convert item reference from character to numeric
     I*
     I            DS
     I                                        1   6 ##NCIT
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I            DS
     I                                        1   5 ##CCCC
     I                                        1   3 ##CCY
     I                                        4   5 ##CCD
     I/COPY WNCPYSRC,CG4310I001
     I**  For error reporting
     I*
     I*---------------------------------------------------------------------
     I* Named constants
     I*
     I              'DEPOTM_   '          C         W#PTYP
     I*---------------------------------------------------------------------
     I##UDCR    E DSCGUDCRPD
      ** External DS for incomplete reference
      *
     ISDBANK    E DSSDBANKPD
      **  External DS for Bank details
      *
     ISDGELR    E DSSDGELRPD
      **  External DS for General Ledger details
      *
     ISDMMOD    E DSSDMMODPD
      **  External DS for Module details
      *
     ISDSTRD    E DSSDSTRDPD
      **  External DS for Securities Trading Module details
      *
     ISDTRAD    E DSSDTRADPD
      **  External DS for Trading Module details
     I              QQACCD                          QQACC1                                    CGL029
      *
     ISDDEAL    E DSSDDEALPD
      **  External DS for Dealing Module details
     I              QQACCD                          QQACC2                                    CGL029
      *
     ISDRETL    E DSSDRETLPD
      **  External DS for Retail details
     I              QQACCD                          QQACC3                                    CGL029
      *
     ISDMGME    E DSSDMGMEPD
      **  External DS for Message Management details
      *
     ISDBRCH    E DSSDBRCHPD
      **  External DS for branch details
      *
     ISDBROK    E DSSDBROKPD
      **  External DS for broker details
      *
     ISDCUST    E DSSDCUSTPD
      **  External DS for customer details
     I              QQDFAC                          QQDFA1                                    CGL029
      *
     ISDSECS    E DSSDSECSPD
      **  External DS for securities trading customer details
     I              QQACCD                          QQACC4                                    CGL029
      *
     ISDCURR    E DSSDCURRPD                101
      **  External DS for currency details
      *                                                                                       CCG015
     ISCSARD    E DSSCSARDPD                                                                  CCG015
      ** External DS for SAR details                                                          CCG015
     I              LCD                             XXLCD                                     CCG015
      *                                                                                     BUG11112
     ISDBSRT    E DSSDBSRTPD                                                                BUG11112
      **  External DS for base rate details                                                 BUG11112
      *
     IDSFDY     E DSDSFDY
      **  First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      **  Second DS for access programs, long data structure
      *
     IDSPARM    E DSDPTMVD
     I              CHTP                            DPCHTP
      **  External DS for parameters based on PF/DPTMVD
      *
     IW0FMT     E DSCGUDTAPD
      **  Record format of PF/CGUDTAPD for use as a parameter
      *
     I##SRDT      DS                         20
      **  DS to store subroutine specific data.
      **  - Saved Path
     I                                        1  70 ##SPAT
     I/COPY CGCPYSRC,CGPACKI
      *
     ICPYR        DS
      **  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
      *                                                                   089776
      ** Parameters for call to CG4976.                                   089776
      **                                                                  089776
     IP5PARM      DS                            256                       089776
      * Output Sequence                                                   089776
     I                                        1   90R1OSEQ                089776
      * UDC item number                                                   089776
     I                                       10  170R1ITEM                089776
      * This bind level                                                   089776
     I                                       18  250R1TBIN                089776
      * Previous bind level                                               089776
     I                                       26  330R1PBIN                089776
     IP7PARM      DS                            256                       089776
      * Account Officer                                                   089776
     I                                        1   2 P1ACOF                089776
     I/COPY CGCPYSRC,SRERRI
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZSDESCZ2
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRINZ  - Initialise Fields on Each Invocation  *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           W0RTN
     C                     PARM           W0CMT   3
     C                     PARM           ##COPD  1
     C                     PARM           ##AUTO  1
     C                     PARM           DSPARM
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      ** Initialisation processing
     C                     EXSR SRINZ
      *
      ** Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
      ** Access Security (and investment type) details
      ** (Set event control date to run date)
      *
     C                     Z-ADDBJRDNB    ECD     50
     C                     Z-ADDBJRDNB    ZECD    50
     C                     EXSR SRSECT
      *
      **  Generate reference number by writing to PF/CGUDCRPD
      **  If no confirmation to be produced, then bypass
      *
     C           *LIKE     DEFN PROT      ##PROT
     C                     MOVELPROT      ##PROT
     C                     MOVE 'N'       ##COPD
      *                                                                                   AR1086147B
      ** Check first if REPO is authorised before generating UDCR record                  AR1086147B
      *                                                                                   AR1086147B
     C           DPMV      IFEQ 'PD'                                                      AR1086147B
     C           DPMV      OREQ 'PL'                                                      AR1086147B
     C           DPMV      OREQ 'RP'                                                      AR1086147B
     C           DPMV      OREQ 'RR'                                                      AR1086147B
     C                     Z-ADDDPAD      DLNO                                            AR1086147B
     C                     EXSR SRDEAL                                                    AR1086147B
     C                     ENDIF                                                          AR1086147B
     C           ##COPD    CABEQ'B'       EXMAIN                                          AR1086147B
      *                                                                                   AR1086147B
     C                     EXSR SRGENR
      **********                                                                  243124A AR1086147A
      ***Check*if REPO is authorised                                              243124A AR1086147A
      **********                                                                  243124A AR1086147A
     C********** DPMV      IFEQ 'PD'                                              243124A AR1086147A
     C********** DPMV      OREQ 'PL'                                              243124A AR1086147A
     C********** DPMV      OREQ 'RP'                                              243124A AR1086147A
     C********** DPMV      OREQ 'RR'                                              243124A AR1086147A
      **********                                                                  243124A AR1086147A
     C**********           Z-ADDDPAD      DLNO                                    243124A AR1086147A
     C**********           EXSR SRDEAL                                            243124A AR1086147A
     C**********           ENDIF                                                  243124A AR1086147A
      **********                                                                  243124A AR1086147A
     C********** ##COPD    CABEQ'B'       EXMAIN                                  243124A AR1086147A
     C           ##COPD    CABEQ'N'       EXMAIN
      *
      ** Extract Depot Movements
      *
     C/COPY WNCPYSRC,CG4310C001
      *                                                                   CSE012
      ** If CSE012 is installed, access Depot Movement Extension File     CSE012
      *                                                                   CSE012
     C           CSE012    IFEQ 'Y'                                       CSE012
      *                                                                   CSE012
     C                     MOVELDPSS      WDPSS2                          CSE012
     C                     MOVELDPRN      WDPRN2                          CSE012
     C           KCSE12    CHAINDPTMV                99                   CSE012
     C                     MOVEL*IN99     WIN99   1                       CSE012
     C                     ENDIF                                          CSE012
      *                                                                   CSE012
      ** Walk ins/Walk outs.
     C           DPMV      IFEQ 'WI'
     C           DPMV      OREQ 'WO'
     C                     EXSR T02WIO
     C                     ELSE
      *
      ** Depot transfers.
     C           DPMV      IFEQ 'DT'
     C                     EXSR T03DPT
     C                     ELSE
      *
      ** Bond borrowings/bond lendings.
     C           DPMV      IFEQ 'BB'
     C           DPMV      OREQ 'BL'
     C                     EXSR T04BOB
     C                     ELSE
      *
      ** Pledged Deposits/Loans and Repos/Reverse Repos.
     C           DPMV      IFEQ 'PD'
     C           DPMV      OREQ 'PL'
     C           DPMV      OREQ 'RP'
     C           DPMV      OREQ 'RR'
      *
      ** Access Deal
     C                     Z-ADDDPAD      DLNO
     C                     EXSR SRDEAL
     C           *LIKE     DEFN DTYP      ##DTYP
     C                     MOVELDTYP      ##DTYP
      *
     C********** PROCES    IFEQ 'Y'                                                243124 AR1086147A
     C                     EXSR T05PLD
     C**********           ENDIF                                                   243124 AR1086147A
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T02WIO                                         *
      * Function    :  Extract Walk Ins/Walk Outs                     *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T02WIO    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL't02WIO'  @STK,Q
      *
      *................................................................
      *
      **  Set up Path.
     C                     MOVEL'\t02WIO' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
      *
      ** Branch Details
     C                     EXSR BRANCH
      *
      ** Security Details
     C                     EXSR T@SECD
      *
      ** Depot Movement Base Details
     C                     EXSR T@DMBD
      *
      ** Depot Movement Walk In/Walk Out Details
     C                     EXSR T@DMIO
      *
      ** Customer Details
     C                     EXSR CUST
      *                                                                   089776
      ** Counterparty Account Officer Details                             089776
     C                     EXSR ACOF                                      089776
      *
      ** Other Depot Movement Details
     C                     EXSR T@OTHD
     C/COPY WNCPYSRC,CG4310C012
      *
      *................................................................
      *
     C           EX2WIO    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T03DPT                                         *
      * Function    :  Extract Depot Transfers                        *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T03DPT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL't03DPT'  @STK,Q
      *
      *................................................................
      *
      **  Set up Path.
     C                     MOVEL'\t03DPT' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
      *
      ** Branch Details
     C                     EXSR BRANCH
      *
      ** Security Details
     C                     EXSR T@SECD
      *
      ** Depot Movement Base Details
     C                     EXSR T@DMBD
      *
      ** Depot Movement Depot Transfer Details
     C                     EXSR T@DMDT
      *
      ** Customer Details
     C                     EXSR CUST
      *                                                                   089776
      ** Counterparty Account Officer Details                             089776
     C                     EXSR ACOF                                      089776
      *
      ** Other Depot Movement Details
     C                     EXSR T@OTHD
     C/COPY WNCPYSRC,CG4310C022
      *
      *................................................................
      *
     C           EX3DPT    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T04BOB                                         *
      * Function    :  Extract Bond Borrowings/Lendings               *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T04BOB    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL't04BOB'  @STK,Q
      *
      *................................................................
      *
      **  Set up Path.
     C                     MOVEL'\t04BOB' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
      *
      ** Branch Details
     C                     EXSR BRANCH
      *
      ** Security Details
     C                     EXSR T@SECD
      *
      ** Depot Movement Base Details
     C                     EXSR T@DMBD
      *
      ** Depot Movement Bond Borrowing/Lending Details
     C                     EXSR T@DMBO
      *
      ** Customer Details
     C                     EXSR CUST
      *                                                                   089776
      ** Counterparty Account Officer Details                             089776
     C                     EXSR ACOF                                      089776
      *
      ** Other Depot Movement Details
     C                     EXSR T@OTHD
      *
      *................................................................
      *
     C           EX4BOB    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T05PLD                                         *
      * Function    :  Extract Pledged Deposits/Loans & Repos/Rev.Repos*
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T05PLD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL't05PLD'  @STK,Q
      *
      *................................................................
      *
      **  Set up Path.
     C                     MOVEL'\t05PLD' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
      *
      ** Branch Details
     C                     EXSR BRANCH
      *
      ** Broker Details
     C                     EXSR BROKER
      *
      ** Security Details
     C                     EXSR T@SECD
      *
      ** Depot Movement Base Details
     C                     EXSR T@DMBD
      *
      ** Depot Movement Bond Borrowing/Lending Details
     C                     EXSR T@DMBO
      *
      ** Base Deal Details
     C                     EXSR D@BASE
      *
      ** Maturity Date
     C                     EXSR MATURD
      *
      ** Loan & Deposit Details
     C                     EXSR D@LAD
      *
      ** Receive Settlement Ins
     C                     MOVELCCY       ##CCY
     C                     EXSR D@RECS
      *
      ** Payment Settlement Ins
     C                     MOVELCCY       ##CCY
     C                     EXSR D@PAYS
      *
      ** Customer Details
     C                     EXSR CUST
      *                                                                   089776
      ** Counterparty Account Officer Details                             089776
     C                     EXSR ACOF                                      089776
      *
      ** Other Depot Movement Details
     C                     EXSR T@OTHD
      *                                                                                     BUG11112
      **  Floating Rate CD Issued Details                                                   BUG11112
      *                                                                                     BUG11112
     C           DTYP      IFEQ 'CF'                                                        BUG11112
     C           DTYP      OREQ 'TD'                                                        BUG11112
     C           XKRCDT    ANDGT0                                                           BUG11112
     C           DTYP      OREQ 'TI'                                                        BUG11112
     C           XKRCDT    ANDGT0                                                           BUG11112
     C           DTYP      OREQ 'IT'                                                        BUG11112
     C           XKRCDT    ANDGT0                                                           BUG11112
     C           DTYP      OREQ 'IP'                                                        BUG11112
     C           XKRCDT    ANDGT0                                                           BUG11112
     C           DTYP      OREQ 'CI'                                                        BUG11112
     C           XKRCDT    ANDGT0                                                           BUG11112
     C           CDL033    IFEQ 'Y'                                                         BUG11112
     C                     EXSR SRFRCD                                                      BUG11112
     C                     ENDIF                                                            BUG11112
     C                     ENDIF                                                            BUG11112
      *
      *................................................................
      *
     C           EX5PLD    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  BRANCH                                         *
      * Function    :  Branch Details                                 *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           BRANCH    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'BRANCH'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\BRANCH' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Get Branch Details
      *
     C           DPBA      IFNE ##BRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG    '##RTCD
     C                     PARM '*KEY    '##OPTN
     C                     PARM DPBA      ##BRCD  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELDPBA      W0KEY            ***************
     C                     Z-ADD1         W0ERNB           * DB ERROR 01 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Get Customer Details for Branch Internal Customer
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM A8BICN    ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELA8BICN    W0KEY            ***************
     C                     Z-ADD2         W0ERNB           * DB ERROR 02 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Store Booking Branch and Branch Internal Customer Number
      *
     C           *LIKE     DEFN DPBA      BBBRCA
     C                     MOVELDPBA      BBBRCA
     C           *LIKE     DEFN BBCUST    BBBICN
     C                     MOVELBBCUST    BBBICN
     C                     END
      *
      ** Branch
     C                     MOVELA8BRCD    ##D,1
      *
      ** Branch Name
     C                     MOVELA8BRNM    ##D,2
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXBRCH    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  BROKER                                         *
      * Function    :  Broker Details                                 *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           BROKER    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'BROKER'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\BROKER' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Get Broker Details
      *
     C           BRKC      IFNE ##BROK
      *
     C           BRKC      IFNE 'TELX'
     C           BRKC      ANDNE'PHON'
     C           BRKC      ANDNE'MAIL'
     C           BRKC      ANDNE'SWAP'
     C                     CALL 'AOBROKR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM BRKC      ##BROK  4
     C           SDBROK    PARM SDBROK    DSFDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBROKPD'W0FILE           ***************
     C                     MOVELBRKC      W0KEY            * DB ERROR 03 *
     C                     Z-ADD3         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     ELSE
     C                     MOVELBRKC      A9BROK
     C                     MOVEL*BLANK    A9BKNM
     C                     MOVEL*BLANK    A9BRTN
     C                     END
     C                     END
      *
      ** Broker
     C                     MOVELA9BROK    ##D,1
      *
      ** Broker Name
     C                     MOVELA9BKNM    ##D,2
      *
      ** Broker Town
     C                     MOVELA9BRTN    ##D,3
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXBROK    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  CUST                                           *
      * Function    :  Customer Details                               *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           CUST      BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CUST  '  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\CUST  ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Get Customer Details
      *
     C                     MOVELDPBN      ##KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1
     C                     PARM *BLANKS   ##KYST
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE           ***************
     C                     MOVELDPBN      W0KEY            * DB ERROR 04 *
     C                     Z-ADD4         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Get Securities trading customer details
      *
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY    '##OPTN
     C                     PARM BBCUST    ##CUST
     C           SDSECS    PARM SDSECS    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDSECSPD'W0FILE           ***************
     C                     MOVELBBCUST    W0KEY            * DB ERROR 05 *
     C                     Z-ADD5         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      ***********                                                         081961
      ***Store*Customer Number and Name                                   081961
      ***********                                                         081961
     C************LIKE     DEFN BBCUST    CPCUST                          081961
     C***********          MOVELBBCUST    CPCUST                          081961
      *
      ** Customer
     C                     MOVELBBCUST    ##D,1
      *
      ** Customer Name
     C                     MOVELBBCRNM    ##D,2
      *
      ** Customer Address Line 1
     C                     MOVELBBCNA1    ##D,3
      *
      ** Customer Address Line 2
     C                     MOVELBBCNA2    ##D,4
      *
      ** Customer Address Line 3
     C                     MOVELBBCNA3    ##D,5
      *
      ** Customer Address Line 4
     C                     MOVELBBCNA4    ##D,6
      *                                                                   086918
      ** Customer Town                                                    086918
     C                     MOVELBBCRTN    ##D,7                           086918
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXCUST    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5                                                            089776
      *****************************************************************   089776
      * Subroutine  :  ACOF                                           *   089776
      * Function    :  Account Officer Details                        *   089776
      *                                                               *   089776
      * Called by   :                                                 *   089776
      * Calls       :                                                 *   089776
      *****************************************************************   089776
     C           ACOF      BEGSR                                          089776
      *                                                                   089776
      **  Set up subroutine stack name                                    089776
     C                     ADD  1         Q                               089776
     C                     MOVEL'ACOF  '  @STK,Q                          089776
      *                                                                   089776
      *................................................................   089776
      *                                                                   089776
      **  Retrieve subroutine specific data.                              089776
     C           1         OCUR ##SRDT                                    089776
     C                     MOVEL##SPAT    S#PATH                          089776
      *                                                                   089776
      **  Set up data.                                                    089776
     C                     CLEARP7PARM                                    089776
     C                     MOVELBBACOC    P1ACOF                          089776
      *                                                                   089776
     C                     CLEARP4PARM                                    089776
     C                     MOVELS#PATH    P4PARM                          089776
      *                                                                   089776
     C                     CLEARP5PARM                                    089776
     C                     Z-ADD##OSEQ    R1OSEQ                          089776
     C                     Z-ADD##ITEM    R1ITEM                          089776
     C                     Z-ADDDETBIN    R1TBIN                          089776
     C                     Z-ADDDEPBIN    R1PBIN                          089776
      *                                                                   089776
     C                     CALL 'CG4976'                                  089776
     C                     PARM *BLANKS   W0RTN   7                       089776
     C                     PARM           P7PARM                          089776
     C                     PARM           P4PARM140        Path           089776
     C                     PARM           W0CMT   3                       089776
     C                     PARM           P5PARM                          089776
     C                     PARM           ##REFR                                              CCG015
     C                     PARM           P@ICR                                               CCG015
     C                     PARM 'N'       ##MAST                                              CCG015
      *                                                                   089776
      **  Reset Sequence number.                                          089776
     C                     Z-ADDR1OSEQ    ##OSEQ                          089776
     C                     Z-ADDR1TBIN    DETBIN                          089776
     C                     Z-ADDR1PBIN    DEPBIN                          089776
      *                                                                   089776
      *                                                                   089776
      *                                                                   089776
      *................................................................   089776
      *                                                                   089776
     C           EXACOF    TAG                                            089776
      *                                                                   089776
      **  Unwind subroutine stack name                                    089776
     C                     MOVEA*BLANKS   @STK,Q                          089776
     C                     SUB  1         Q                               089776
      *                                                                   089776
     C                     ENDSR                                          089776
     C*****************************************************************   089776
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  D@BASE                                         *
      * Function    :  Base Deal Details                              *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           D@BASE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'D_BASE'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\D_BASE' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Deal Number
     C                     MOVELDLNO      ##D,1
      *
      ** Deal Date
     C                     MOVELDDAT      ##D,2
      *
      ** Value Date
     C                     MOVELVDAT      ##D,3
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXBASE    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  D@LAD                                          *
      * Function    :  Loan & Deposit Details                         *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           D@LAD     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'D_LAD '  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\D_LAD ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Currency
     C                     MOVELCCY       ##D,1
      *
      ** Principal
     C/COPY WNCPYSRC,CG4310C003
     C                     MOVELPCPL      ##D,2
     C                     MOVELCCY       ##CCY
     C                     EXSR SRDCDT
     C                     MOVE A6NBDP    ##D,2
     C/COPY WNCPYSRC,CG4310C004
      *
      ** Interest Rate
     C                     MOVELINTR      ##D,3
     C/COPY WNCPYSRC,CG4310C009
      *
      ** IF TOTAL INTEREST OVERRIDE, INTEREST AMOUNT IS ZERO (IE UNKNOWN)
     C                     TESTB'2'       DNSI           99*
     C   99                Z-ADD0         TOTI
     C/COPY WNCPYSRC,CG4310C010
      *
      ** Gross Interest
     C                     MOVELTOTI      ##D,4
     C                     MOVE A6NBDP    ##D,4
     C/COPY WNCPYSRC,CG4310C017
      *
      ** DETERMINE TAX AMOUNT
     C           *LIKE     DEFN TOTI      ##TAXA
     C                     Z-ADD*ZERO     ##TAXA
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'CD'
     C           DTYP      OREQ 'TD'
     C           TAXI      IFEQ 'Y'
     C                     EXSR SRDTAX
     C                     END
     C                     END
      *
      ** Net Interest
     C           *LIKE     DEFN TOTI      ##NETA
     C           TOTI      SUB  ##TAXA    ##NETA
     C                     MOVEL##NETA    ##D,5
     C                     MOVE A6NBDP    ##D,5
     C/COPY WNCPYSRC,CG4310C018
      *
      ** Tax
     C                     MOVEL##TAXA    ##D,6
     C                     MOVE A6NBDP    ##D,6
     C/COPY WNCPYSRC,CG4310C019
      *
      ** Tax Indicator
     C                     MOVELTAXI      ##D,7
      *
      ** Net total (principal + net interest if interest not up-front, else
      **            principal - net interest)
      *
     C           *LIKE     DEFN PCPL      ##NETT
     C           FUID      IFNE 'Y'
     C           PCPL      ADD  ##NETA    ##NETT
     C                     ELSE
     C           PCPL      SUB  ##NETA    ##NETT
     C                     END
     C                     MOVEL##NETT    ##D,8
     C                     MOVE A6NBDP    ##D,8
     C/COPY WNCPYSRC,CG4310C020
      *
      ** Total Interest Override
     C                     TESTB'2'       DNSI           99*
     C           *IN99     IFEQ '1'
     C                     MOVEL'Y'       ##D,9
     C                     ELSE
     C                     MOVEL'N'       ##D,9
     C                     END
      *
      ** Loan/Deposit Indicator
     C                     Z-ADD1         #1
     C           ##DTYP    LOKUP#LN,#1                   99*
     C           *IN99     IFEQ '1'
     C                     MOVEL'L'       ##D,10
     C                     ELSE
     C                     MOVEL'D'       ##D,10
     C                     END
      *                                                                   086780
      ** Currency Description                                             086780
     C                     MOVELA6CYNM    ##D,11                          086780
      *                                                                   086780
      ** Precious Metal Indicator                                         086780
     C                     MOVELA6PMRT    ##D,12                          086780
      *                                                                   086864
      ** Interest paid seperately                                         086864
     C                     MOVELIPDS      ##D,13                          086864
      *                                                                   086962
      ** Start or last interest date.                                     086962
     C                     MOVELSLID      ##D,14                          086962
      *                                                                   119143
      ** Conf. narrative                                                  119143
     C                     MOVELCNNA      ##D,15                          119143
      *
      ** C. D. reference                                                  116840
     C                     MOVELRNNA      ##D,16                          116840
     C*                                                                   CEU014
     C** If EMU UDC Enhancement is switched on then extract EMU           CEU014
     C** equivalent amounts.                                              CEU014
     C*                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C*                                                                   CEU014
     C**  first determine the equivalent currency EQCY                    CEU014
     C*                                                                   CEU014
     C                     MOVE *BLANKS   EQCY    3                       CEU014
     C                     MOVE CCY       ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C           A6INCY    IFEQ 'Y'                                       CEU014
     C                     MOVE BKEURO    EQCY                            CEU014
     C                     ENDIF                                          CEU014
     C           CCY       IFEQ BKEURO                                    CEU014
     C                     MOVELDPBN      ##KEY1                          CEU014
     C                     CALL 'AOCUSTR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD                          CEU014
     C                     PARM '*KEY   ' ##OPTN                          CEU014
     C                     PARM           ##KEY1                          CEU014
     C                     PARM *BLANKS   ##KYST                          CEU014
     C           SDCUST    PARM SDCUST    DSSDY                           CEU014
     C*                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCUSTPD'W0FILE                          CEU014
     C                     MOVELDPBN      W0KEY            ************   CEU014
     C                     Z-ADD27        W0ERNB           * DBERR 27 *   CEU014
     C                     MOVEL'MEM5004' W0MSGD           ************   CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C                     MOVE BBDINC    EQCY                            CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C           EQCY      IFNE *BLANKS                                   CEU014
     C*                                                                   CEU014
     C** Principal in Equivalent Currency                                 CEU014
     C*                                                                   CEU014
     C                     MOVE EQCY      ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C                     Z-ADDPCPL      P@FRAM                          CEU014
     C                     MOVE CCY       P@FRCY                          CEU014
     C                     MOVE EQCY      P@TOCY                          CEU014
     C                     EXSR T@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,17                          CEU014
     C                     MOVE A6NBDP    ##D,17                          CEU014
     C*                                                                   CEU014
     C** Gross Interest in Equivalent Currency                            CEU014
     C*                                                                   CEU014
     C                     Z-ADDTOTI      P@FRAM                          CEU014
     C                     MOVE CCY       P@FRCY                          CEU014
     C                     MOVE EQCY      P@TOCY                          CEU014
     C                     EXSR T@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,18                          CEU014
     C                     MOVE A6NBDP    ##D,18                          CEU014
     C*                                                                   CEU014
     C** Equivalent Currency                                              CEU014
     C                     MOVELEQCY      ##D,19                          CEU014
     C*                                                                   CEU014
     C** Equivalent Currency Description                                  CEU014
     C                     MOVELA6CYNM    ##D,20                          CEU014
     C*                                                                   CEU014
     C                     ENDIF                                          CEU014
     C                     ENDIF                                          CEU014
      *                                                                   116840
     C/COPY WNCPYSRC,CG4310C015
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXLAD     TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  D@PAYS                                         *
      * Function    :  Payment Settlement Instructions                *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           D@PAYS    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'D_PAYS'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\D_PAYS' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** DETERMINE SETTLEMENT INSTRUCTION FIELDS
      *
     C                     MOVEL'P'       ##PYRC           *Pay/Receive
     C                     MOVEL##CCY     ##CCY            *Settlemt currncy
     C                     MOVEL'N'       ##ROLL           *Rollover
      *
     C                     MOVELPSTM      ##SETP           *Settlemt type
     C                     MOVELPOBR      ##STBR           *Settlemt branch
     C                     MOVELPONS      ##OURN           *Our nostro/ A/C
     C           RVNO      IFNE *BLANK                     * RECEIVING MT100
     C           RCRN      IFNE *BLANK                     * RECEIVER CORRES
     C                     MOVELRCRN      ##THRN           *Their nostro
     C                     ELSE
     C                     MOVEL*HIVAL    ##THRN           *Their nostro
     C                     END                              = OUR NOSTRO
     C                     ELSE
     C                     MOVELAWBN      ##THRN           *Their nostro
     C                     END
     C                     MOVELBENN      ##FACO           *For account of
     C                     EXSR SRDSET
      *
      **  Payment - Our A/C - Line 1
     C                     MOVEL##OAC1    ##D,1
      *
      **  Payment - Our A/C - Line 2
     C                     MOVEL##OAC2    ##D,2
      *
      **  Payment - Our Nostro Name
     C                     MOVEL##ONN     ##D,3
      *
      **  Payment - Our Nostro Town
     C                     MOVEL##ONT     ##D,4
      *
      **  Payment - Our A/C (Gen.Led.)
     C                     MOVEL##OGA     ##D,5
      *
      **  Payment - Our A/C (Retail)
     C                     MOVEL##ORA     ##D,6
      *
      **  Payment - Their A/C - Line 1
     C                     MOVEL##TAC1    ##D,7
      *
      **  Payment - Their A/C - Line 2
     C                     MOVEL##TAC2    ##D,8
      *
      **  Payment - Their Nostro Name
     C                     MOVEL##TNN     ##D,9
      *
      **  Payment - Their Nostro Town
     C                     MOVEL##TNT     ##D,10
      *
      **  Payment - For A/C Of - Line 1
     C                     MOVEL##FAL1    ##D,11
      *
      **  Payment - For A/C Of - Line 2
     C                     MOVEL##FAL2    ##D,12
      *
      **  Payment - For A/C Of Name
     C                     MOVEL##FAN     ##D,13
      *
      **  Payment - For A/C Of Town
     C                     MOVEL##FAT     ##D,14
      *                                                                   086864
      **  Special Instructions                                            086864
     C                     MOVELSPI       ##D,15                          086864
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXPAYS    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  D@RECS                                         *
      * Function    :  Receive Settlement Instructions                *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           D@RECS    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'D_RECS'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\D_RECS' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** DETERMINE SETTLEMENT INSTRUCTION FIELDS
      *
     C                     MOVEL'R'       ##PYRC           *Pay/Receive
     C                     MOVEL##CCY     ##CCY            *Settlemt currncy
     C                     MOVEL'N'       ##ROLL           *Rollover
      *
     C                     MOVELRSTM      ##SETP           *Settlemt type
     C                     MOVELROBR      ##STBR           *Settlemt branch
     C                     MOVELRONS      ##OURN           *Our nostro/ A/C
     C                     MOVELRIBN      ##THRN           *Their nostro
     C                     MOVEL*BLANK    ##FACO           *For account of
     C                     EXSR SRDSET
      *
      **  Receive - Our A/C - Line 1
     C                     MOVEL##OAC1    ##D,1
      *
      **  Receive - Our A/C - Line 2
     C                     MOVEL##OAC2    ##D,2
      *
      **  Receive - Our Nostro Name
     C                     MOVEL##ONN     ##D,3
      *
      **  Receive - Our Nostro Town
     C                     MOVEL##ONT     ##D,4
      *
      **  Receive - Our A/C (Gen.Led.)
     C                     MOVEL##OGA     ##D,5
      *
      **  Receive - Our A/C (Retail)
     C                     MOVEL##ORA     ##D,6
      *
      **  Receive - Their A/C - Line 1
     C                     MOVEL##TAC1    ##D,7
      *
      **  Receive - Their A/C - Line 2
     C                     MOVEL##TAC2    ##D,8
      *
      **  Receive - Their Nostro Name
     C                     MOVEL##TNN     ##D,9
      *
      **  Receive - Their Nostro Town
     C                     MOVEL##TNT     ##D,10
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXRECS    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  MATURD                                         *
      * Function    :  Maturity Date                                  *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           MATURD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MATURD'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\MATURD' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Maturity Date
     C                     MOVELMDAT      ##D,1
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXMATU    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@DMBD                                         *
      * Function    :  Depot Movement Base Details                    *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@DMBD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_DMBD'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_DMBD' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Run Date
     C                     MOVELBJRDNB    ##D,1
      *
      ** Depot Movement Reference
     C                     MOVELDPRN      ##D,2
      *
      ** Nominal amount
     C/COPY WNCPYSRC,CG4310C005
     C                     MOVELDPNA      ##D,3
     C                     MOVE NMDP      ##D,3
     C/COPY WNCPYSRC,CG4310C006
      *
      ** Depot Movement Narrative
     C                     MOVELDPNR      ##D,4
      *
      ** Depot Movement (Market) Price
     C                     MOVELMKTP      ##D,5
     C*                                                                   CEU014
     C** If EMU UDC Enhancement is switched on then extract EMU           CEU014
     C** equivalent amounts.                                              CEU014
     C*                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C*                                                                   CEU014
     C**  first determine the nominal equivalent currency NEQCY           CEU014
     C*                                                                   CEU014
     C                     MOVE *BLANKS   NEQCY   3                       CEU014
     C                     MOVE NMCY      ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C           A6INCY    IFEQ 'Y'                                       CEU014
     C                     MOVE BKEURO    NEQCY                           CEU014
     C                     ENDIF                                          CEU014
     C           NMCY      IFEQ BKEURO                                    CEU014
     C                     MOVELDPBN      ##KEY1                          CEU014
     C                     CALL 'AOCUSTR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD                          CEU014
     C                     PARM '*KEY   ' ##OPTN                          CEU014
     C                     PARM           ##KEY1                          CEU014
     C                     PARM *BLANKS   ##KYST                          CEU014
     C           SDCUST    PARM SDCUST    DSSDY                           CEU014
     C*                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCUSTPD'W0FILE                          CEU014
     C                     MOVELDPBN      W0KEY            ************   CEU014
     C                     Z-ADD28        W0ERNB           * DBERR 28 *   CEU014
     C                     MOVEL'MEM5004' W0MSGD           ************   CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C                     MOVE BBDINC    NEQCY                           CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C           NEQCY     IFNE *BLANKS                                   CEU014
     C*                                                                   CEU014
     C** Nominal Amount in Nominal Equivalent Currency                    CEU014
     C*                                                                   CEU014
     C**   NB. convert DPNA from an outright amount for NMDP decimals     CEU014
     C**   to an outright amount for the number of decimals for NMCY      CEU014
     C**   before calling EU0200.                                         CEU014
     C*                                                                   CEU014
     C                     Z-ADD0         P@FRAM                          CEU014
     C                     Z-ADD0         ##DPNA 184                      CEU014
     C                     SELEC                                          CEU014
     C           NMDP      WHEQ 0                                         CEU014
     C           DPNA      DIV  1         ##DPNA                          CEU014
     C           NMDP      WHEQ 1                                         CEU014
     C           DPNA      DIV  10        ##DPNA                          CEU014
     C           NMDP      WHEQ 2                                         CEU014
     C           DPNA      DIV  100       ##DPNA                          CEU014
     C           NMDP      WHEQ 3                                         CEU014
     C           DPNA      DIV  1000      ##DPNA                          CEU014
     C           NMDP      WHEQ 4                                         CEU014
     C           DPNA      DIV  10000     ##DPNA                          CEU014
     C                     ENDSL                                          CEU014
     C                     SELEC                                          CEU014
     C           A6NBDP    WHEQ 0                                         CEU014
     C                     MULT 1         ##DPNA                          CEU014
     C           A6NBDP    WHEQ 1                                         CEU014
     C                     MULT 10        ##DPNA                          CEU014
     C           A6NBDP    WHEQ 2                                         CEU014
     C                     MULT 100       ##DPNA                          CEU014
     C           A6NBDP    WHEQ 3                                         CEU014
     C                     MULT 1000      ##DPNA                          CEU014
     C                     ENDSL                                          CEU014
     C                     Z-ADD##DPNA    P@FRAM                          CEU014
     C*                                                                   CEU014
     C                     MOVE NEQCY     ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C                     MOVE NMCY      P@FRCY                          CEU014
     C                     MOVE NEQCY     P@TOCY                          CEU014
     C                     EXSR T@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,6                           CEU014
     C                     MOVE A6NBDP    ##D,6                           CEU014
     C*                                                                   CEU014
     C** Nominal Equivalent Currency                                      CEU014
     C                     MOVELNEQCY     ##D,7                           CEU014
     C*                                                                   CEU014
     C** Nominal Equivalent Currency Description                          CEU014
     C                     MOVELA6CYNM    ##D,8                           CEU014
     C*                                                                   CEU014
     C                     ENDIF                                          CEU014
     C                     ENDIF                                          CEU014
      *
     C/COPY WNCPYSRC,CG4310C002
      *                                                                   CSE012
      ** If CSE012 is installed                                           CSE012
      *                                                                   CSE012
     C           CSE012    IFEQ 'Y'                                       CSE012
      *                                                                   CSE012
     C           WIN99     IFEQ '0'                                       CSE012
      *                                                                   CSE012
      **  Setup the new RDE's                                             CSE012
      *                                                                   CSE012
     C                     MOVELDPNR2     ##D,9                           CSE012
     C                     MOVELDPNR3     ##D,10                          CSE012
     C                     MOVELDPNR4     ##D,11                          CSE012
     C                     MOVELDPNR5     ##D,12                          CSE012
      *                                                                   CSE012
     C                     ELSE                                           CSE012
     C                     MOVEL*BLANKS   ##D,9                           CSE012
     C                     MOVEL*BLANKS   ##D,10                          CSE012
     C                     MOVEL*BLANKS   ##D,11                          CSE012
     C                     MOVEL*BLANKS   ##D,12                          CSE012
     C                     ENDIF                                          CSE012
      *                                                                   CSE012
     C                     ENDIF                                          CSE012
      *                                                                   CSE012
      **  Portfolio Reference                                                                 214731
     C                     MOVELPTFR      ##D,13                                              214731
      *                                                                                       214731
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXDMBD    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@DMBO                                         *
      * Function    :  Depot Movement Bond Borrowing/Lending Details  *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@DMBO    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_DMBO'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_DMBO' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Start date.
     C           DPMD      IFLT DPDO
     C                     MOVELDPMD      ##D,1
     C                     ELSE
     C                     MOVELDPDO      ##D,1
     C                     ENDIF
      *
      **  End date.
     C           DPMD      IFGT DPDO
     C           DPMD      IFNE 99999
     C                     MOVELDPMD      ##D,2
     C                     ENDIF
     C                     ELSE
     C           DPDO      IFNE 99999
     C                     MOVELDPDO      ##D,2
     C                     ENDIF
     C                     ENDIF
      *
      ** Our Depot Name and Town.
     C********** DPID      IFNE *ZERO                                                         CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C                     MOVEL*BLANK    ##KEY1
     C                     MOVELDPID      ##KEY1
     C                     EXSR SRDEPT
     C                     MOVELBBCRNM    ##D,3
     C                     MOVELBBCRTN    ##D,4
     C                     ENDIF
      *
      ** Their Depot Name and Town.
     C********** DPOD      IFNE *ZERO                                                         CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVEL*BLANK    ##KEY1
     C                     MOVELDPOD      ##KEY1
     C                     EXSR SRDEPT
     C                     MOVELBBCRNM    ##D,5
     C                     MOVELBBCRTN    ##D,6
     C                     ENDIF
     C/COPY WNCPYSRC,CG4310C011
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXDMBO    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@DMDT                                         *
      * Function    :  Depot Movement Depot Transfer Details          *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@DMDT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_DMDT'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_DMDT' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** From Depot Name and Town.
     C********** DPOD      IFNE *ZERO                                                         CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVEL*BLANK    ##KEY1
     C                     MOVELDPOD      ##KEY1
     C                     EXSR SRDEPT
     C                     MOVELBBCRNM    ##D,1
     C                     MOVELBBCRTN    ##D,2
     C                     ENDIF
      *
      ** To Depot Name and Town.
     C********** DPID      IFNE *ZERO                                                         CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C                     MOVEL*BLANK    ##KEY1
     C                     MOVELDPID      ##KEY1
     C                     EXSR SRDEPT
     C                     MOVELBBCRNM    ##D,3
     C                     MOVELBBCRTN    ##D,4
     C                     ENDIF
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXDMDT    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@DMIO                                         *
      * Function    :  Depot Movement Walk In/Walk Out Details        *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@DMIO    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_DMIO'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_DMIO' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Depot Name and Town.
     C                     MOVEL*BLANK    ##KEY1
     C********** DPOD      IFNE *ZERO                                                         CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPOD      ##KEY1
     C                     ELSE
     C                     MOVELDPID      ##KEY1
     C                     ENDIF
     C                     EXSR SRDEPT
     C                     MOVELBBCRNM    ##D,1
     C                     MOVELBBCRTN    ##D,2
      *
      ** Charge narrative
     C           DCCE      IFNE *BLANK
     C                     MOVELDCCE      ##CCY
     C                     MOVELDCHC      ##CCD
     C                     EXSR SRCHCM
     C                     MOVELCHNR      ##D,3
      *
      ** Charge currency
     C                     MOVELDCCE      ##D,4
      *
      ** Charge amount
     C                     MOVELDCCE      ##CCY
     C                     EXSR SRDCDT
     C                     MOVELDCHA      ##D,5
     C                     MOVE A6NBDP    ##D,5
     C                     ELSE                                           088832
     C                     Z-ADD*ZEROS    ##Z150 150                      088832
     C                     MOVEL##Z150    ##D,5                           088832
     C                     MOVE A6NBDP    ##D,5                           088832
     C                     ENDIF
     C/COPY WNCPYSRC,CG4310C021
     C*                                                                   CEU014
     C** If EMU UDC Enhancement is switched on then extract EMU           CEU014
     C** equivalent amounts.                                              CEU014
     C*                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C*                                                                   CEU014
     C**  first determine the charge equivalent currency CEQCY            CEU014
     C*                                                                   CEU014
     C                     MOVE *BLANKS   CEQCY   3                       CEU014
     C                     MOVE DCCE      ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C           A6INCY    IFEQ 'Y'                                       CEU014
     C                     MOVE BKEURO    CEQCY                           CEU014
     C                     ENDIF                                          CEU014
     C           DCCE      IFEQ BKEURO                                    CEU014
     C                     MOVELDPBN      ##KEY1                          CEU014
     C                     CALL 'AOCUSTR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD                          CEU014
     C                     PARM '*KEY   ' ##OPTN                          CEU014
     C                     PARM           ##KEY1                          CEU014
     C                     PARM *BLANKS   ##KYST                          CEU014
     C           SDCUST    PARM SDCUST    DSSDY                           CEU014
     C*                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCUSTPD'W0FILE                          CEU014
     C                     MOVELDPBN      W0KEY            ************   CEU014
     C                     Z-ADD29        W0ERNB           * DBERR 29 *   CEU014
     C                     MOVEL'MEM5004' W0MSGD           ************   CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C                     MOVE BBDINC    CEQCY                           CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C           CEQCY     IFNE *BLANKS                                   CEU014
     C*                                                                   CEU014
     C** Charge Amount in Charge Equivalent Currency                      CEU014
     C*                                                                   CEU014
     C                     MOVE CEQCY     ##CCY                           CEU014
     C                     EXSR SRDCDT                                    CEU014
     C                     Z-ADDDCHA      P@FRAM                          CEU014
     C                     MOVE DCCE      P@FRCY                          CEU014
     C                     MOVE CEQCY     P@TOCY                          CEU014
     C                     EXSR T@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,6                           CEU014
     C                     MOVE A6NBDP    ##D,6                           CEU014
     C*                                                                   CEU014
     C** Charge Equivalent Currency                                       CEU014
     C                     MOVELCEQCY     ##D,7                           CEU014
     C*                                                                   CEU014
     C** Charge Equivalent Currency Description                           CEU014
     C                     MOVELA6CYNM    ##D,8                           CEU014
     C*                                                                   CEU014
     C                     ENDIF                                          CEU014
     C                     ENDIF                                          CEU014
      *                                                                   191550
      ** Date IN or OUT according to DPMV.                                191550
      *                                                                   191550
     C           DPMV      IFEQ 'WI'                                      191550
     C                     MOVELDPMD      ##D,9                           191550
     C                     ELSE                                           191550
     C                     MOVELDPDO      ##D,9                           191550
     C                     ENDIF                                          191550
      *                                                                   191550
      ** Portfolio reference based from transaction details               191550
      *                                                                   191550
     C                     MOVELPTFR      ##D,10                          191550
      *                                                                                       236024
     C           CGL031    IFEQ 'Y'                                                           236024
      *                                                                                       236024
      ** Original Purchase Date                                                               236024
      *                                                                                       236024
     C                     MOVELOPDT      ##D,11                                              236024
      *                                                                                       236024
      ** Original Purchase Interest                                                           236024
      *                                                                                       236024
     C                     MOVELOPIN      ##D,12                                              236024
     C                     MOVE NOMCDP    ##D,12                                              236024
      *                                                                                       236024
      ** Fiscal Price                                                                         236024
      *                                                                                       236024
     C                     MOVELFSPR      ##D,13                                              236024
     C                     MOVE 8         ##D,13                                              236024
      *                                                                                       236024
     C                     ENDIF                                                              236024
     C*                                                                   UBL009
     C** If SE Charge and Commission switchable feature is                UBL009
     C** switched ON, access extension file and process                   UBL009
     C** commission details.                                              UBL009
     C*                                                                   UBL009
     C/COPY WNCPYSRC,CG4310DMIO                                           UBL009
     C*                                                                   UBL009
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXDMIO    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@OTHD                                         *
      * Function    :  Other Depot Movement Details                   *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@OTHD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_OTHD'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_OTHD' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Cancel/Amend.
      ** Test that bit 0 of message indicator is on.
     C                     TESTB'0'       DPMS           99*
     C           *IN99     IFEQ '1'
     C           DPCHTP    IFEQ 'A'
     C                     MOVEL'A'       ##D,1
     C                     ELSE
     C           DPCHTP    IFEQ 'D'
     C                     MOVEL'C'       ##D,1
     C                     END
     C                     END
     C                     END
      *
      ** Auto-transmission
     C                     EXSR SRDAUT
     C                     MOVEL##AUTO    ##D,2
      *
      ** Depot movement type
     C                     MOVELDPMV      ##D,3
     C/COPY WNCPYSRC,CG4310C014
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXOTHD    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  T@SECD                                         *
      * Function    :  Security Details                               *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           T@SECD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'T_SECD'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\T_SECD' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Security shortname
     C                     MOVELSESN      ##D,1
      *
      ** Processing type
     C                     MOVELPROT      ##D,2
      *
      ** Nominal currency
     C                     MOVELNMCY      ##D,3
      *
      ** Security investment type
     C                     MOVELSITP      ##D,4
      *
      ** Security descriptions
     C                     MOVE SFN1      ZSFN1
     C                     MOVE SFN2      ZSFN2
     C                     MOVE BVROSD    ZRSFD
     C                     EXSR ZSDESC
      *                                                                   087972
      * Place derived description always in line 3                        087972
      *                                                                   087972
     C                     SELEC                                          087972
     C           SFN1      WHNE *BLANKS                                   087972
     C           SFN2      ANDNE*BLANKS                                   087972
     C                     MOVELZFNM1     ##D,5
     C                     MOVELZFNM2     ##D,6
     C                     MOVELZFNM3     ##D,7
     C           SFN1      WHNE *BLANKS                                   087972
     C           SFN2      ANDEQ*BLANKS                                   087972
     C                     MOVELZFNM1     ##D,5                           087972
     C                     MOVELZFNM2     ##D,7                           087972
     C           SFN1      WHEQ *BLANKS                                   087972
     C           SFN2      ANDEQ*BLANKS                                   087972
     C                     MOVELZFNM1     ##D,7                           087972
     C                     ENDSL                                          087972
      *
      ** Next coupon date
     C                     MOVEL##NCD     ##D,8
      *
      ** Last coupon date
     C                     MOVEL##LCD     ##D,9
      *
      ** Coupon rate
     C                     MOVELCPNR      ##D,10
      *
      ** Security maturity date
     C                     MOVELMATY      ##D,11
      *
      ** Security initial date
     C                     MOVELITLD      ##D,12
      *
      ** Security issue date
     C                     MOVELISSD      ##D,13
      *                                                                   089693
      ** Security ISIN/COMMON Code                                        089693
     C                     MOVELISIN      ##D,14                          089693
      *                                                                                       214731
      ** Security Investment Name                                                             214731
     C                     MOVELINAM      ##D,15                                              214731
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSECD    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDAUT                                         *
      * Function    :  Determine if Auto-Transmission of Confirmation *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDAUT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDAUT'  @STK,Q
      *
      *................................................................
      *
     C                     MOVEL'N'       ##AUTO  1
      *
      ***  If S.W.I.F.T. confirmation message generated = 'Y'
      ***  then auto transmission of confirmation
      *
     C           S01401    IFEQ 'Y'
     C           DPTMVK    KLIST
     C                     KFLD           ##DPSS 10
     C                     KFLD           ##DPRN  6
     C                     MOVELDPSS      ##DPSS
     C                     MOVELDPRN      ##DPRN
     C           DPTMVK    CHAINDPTMVDY1             99
     C           *IN99     IFEQ '0'
     C           DPGMEC    ANDEQ'Y'
     C                     MOVEL'Y'       ##AUTO
     C                     ENDIF
     C                     ENDIF
      *
      *................................................................
      *
     C           EXDAUT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDTAX                                         *
      * Function    :  Determine Tax Amount                           *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDTAX    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDTAX'  @STK,Q
      *
      *................................................................
      *
      ** IF BASIC RATE TAX
      *
     C           S01383    IFEQ 'Y'
      *
      ** CALL DEPOSITS
      *
     C           DTYP      IFEQ 'CD'
     C           MDAT      ANDEQ0
     C*
     C           VDAT      IFGE BJRDNB
     C           NOTD      IFEQ 0
     C           *LIKE     DEFN MDAT      ##WMDT
     C           VDAT      ADD  1         ##WMDT
     C                     ELSE
     C           NOTD      ADD  VDAT      ##WMDT
     C                     END
     C                     END
     C*
     C           VDAT      IFLT BJRDNB
     C           NOTD      IFEQ 0
     C           BJRDNB    ADD  1         ##WMDT
     C                     ELSE
     C           NOTD      ADD  BJRDNB    ##WMDT
     C                     END
     C                     END
      *
      ** ELSE, FIXED TERM DEPOSITS
      *
     C                     ELSE
     C                     Z-ADDMDAT      ##WMDT
     C                     END
      *
      * USE RELEVANT RATE ACCORDING TO TAX EFFECTIVE DATE
      *
     C           ##WMDT    IFGE DEFF
     C                     Z-ADDBRTR      BNHKTR
     C                     END
     C*
     C           ##WMDT    IFLT DEFF
     C                     Z-ADDPBRTR     BNHKTR
     C                     END
      *
      ** GET CUSTOMER BRT DETAILS
      *
     C           CNUM      CHAINSDCBRTL1             99
     C           *IN99     IFEQ '1'
     C           XRECI     ORNE 'D'
     C                     MOVEL'SDCBRTPD'W0FILE           ***************
     C                     MOVELCNUM      W0KEY            * DB ERROR 06 *
     C                     Z-ADD6         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** FULLY LIABLE
      *
     C           TAXIND    IFEQ 'L'
     C           TOTI      MULT BNHKTR    ##WTAX 155
     C           ##WTAX    DIV  100       ##TAXA
     C                     END
      *
      ** HALF LIABLE
      *
     C           TAXIND    IFEQ 'P'
     C           BNHKTR    MULT 0.5       ##WTXR 155
     C           TOTI      MULT ##WTXR    ##WTAX 155
     C           ##WTAX    DIV  100       ##TAXA
     C                     END
     C*
     C                     ELSE
      *
      ** IF HONG KONG INTEREST TAX
      *
     C           BNHKTR    IFNE *ZERO
      *
      ** ROUND DOWN INTEREST TAX AMOUNT IF RDFC = Y
      *
     C           JRDFC     IFEQ 'Y'
     C           TOTI      MULT BNHKTR    ##TAXA
     C                     DIV  100       ##TAXA
     C                     ELSE
     C           TOTI      MULT BNHKTR    ##TAXA
     C                     DIV  100       ##TAXA    H
     C                     END
      *
     C                     END
     C                     END
      *
      *................................................................
      *
     C           EXDTAX    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDSET                                         *
      * Function    :  Determine Settlement Instruction Fields        *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDSET    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDSET'  @STK,Q
      *
      *................................................................
      *
     C                     CALL 'CG99DSET'             99  *
      *
     C** In
      *
     C                     PARM           ##PYRC  1        *Pay/Receive
     C                     PARM           ##CCY   3        *Settlemt currncy
     C                     PARM           ##ROLL  1        *Rollover
     C                     PARM           ##SETP  2        *Settlemt type
     C                     PARM           ##STBR  3        *Settlemt branch
     C**********           PARM           ##OURN 12        *Our nostro/ A/C                   CGL029
     C                     PARM           ##OURN 18                                           CGL029
     C                     PARM           ##THRN  8        *Their nostro
     C                     PARM           ##FACO  8        *For account of
     C                     PARM BBBRCA    ##BKBR  3        *Booking  branch
     C                     PARM BBBICN    ##BKBB  6        *Booking  br BICN
     C*********************PARM CPCUST    ##CNTP  6        *Customer      081961
     C                     PARM ##CUST    ##CNTP  6        *Customer      081961
     C**********           PARM BNACCD    ##CSAC  4        *Compen.Susp. A/C                  CGL029
     C**********           PARM BMACCD    ##CADC  4        *Current A/C dflt                  CGL029
     C**********           PARM BKACCD    ##COMS  4        *Computer Sus A/C                  CGL029
     C**********           PARM BLACCD    ##DEFA  4        *Tradng Dflt A/C                   CGL029
     C                     PARM BNACCD    ##CSAC 10                                           CGL029
     C                     PARM BMACCD    ##CADC 10                                           CGL029
     C                     PARM BKACCD    ##COMS 10                                           CGL029
     C                     PARM BLACCD    ##DEFA 10                                           CGL029
     C                     PARM BJLCCY    ##LOCY  3        *Local Currency
     C                     PARM BLONOC    ##ONOC  1        *Ourselves/Nostro
      *
      ** Out
      *
     C                     PARM *BLANKS   ##OAC1  3        *Our Line 1
     C                     PARM *BLANKS   ##OAC2  3        *Our Line 2
     C                     PARM *BLANKS   ##ONN  30        *Our Nostro Name
     C                     PARM *BLANKS   ##ONT  20        *Our Nostro Town
     C*********************PARM *BLANKS   ##OGA  20        *Our GL A/C                       BUG7326
     C                     PARM *BLANKS   ##OGA  24        *Our GL A/C                       BUG7326
     C                     PARM *BLANKS   ##ORA  20        *Our RE a/C
     C                     PARM *BLANKS   ##TAC1  3        *Thr Line 1
     C                     PARM *BLANKS   ##TAC2  3        *Thr Line 2
     C                     PARM *BLANKS   ##TNN  30        *Thr Nostro Name
     C                     PARM *BLANKS   ##TNT  20        *Thr Nostro Town
     C                     PARM *BLANKS   ##FAL1  3        *FACO Line 1
     C                     PARM *BLANKS   ##FAL2  3        *FACO Line 2
     C                     PARM *BLANKS   ##FAN  30        *FACO Name
     C                     PARM *BLANKS   ##FAT  20        *FACO Town
     C                     PARM *BLANKS   ##RTCD  7        *Return Code
     C/COPY WNCPYSRC,CG4310C023
      *
     C           *IN99     IFEQ '1'
     C           ##RTCD    ORNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'CG99DSET'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 07 *
     C                     Z-ADD7         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXDSET    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRSECT                                         *
      * Function    :  Access security details                        *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRSECT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRSECT'  @STK,Q
      *
      *................................................................
      *
      ** Access the security
      *
     C           DPSS      CHAINSECTYDF              99
      *
      ** DATABASE ERROR
      *
     C           *IN99     IFEQ '1'
     C                     MOVEL'SECTY   'W0FILE           ***************
     C                     MOVELDPSS      W0KEY            * DB ERROR 08 *
     C                     Z-ADD8         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Determine nominal currency decimal places.
      *
     C                     MOVELNMCY      ##CCY
     C                     EXSR SRDCDT
     C                     Z-ADDA6NBDP    NOMCDP  10
      *
      **  If the security is interest bearing
      **  Determine the next and last coupon date
      **  (relative to the event control date)
      *
     C                     Z-ADD*ZERO     ##NCD   50
     C                     Z-ADD*ZERO     ##LCD   50
     C           CD01      IFGT 0
     C                     EXSR ZNCD
     C                     Z-ADDNCD       ##NCD            *next coupon date
     C                     EXSR ZLCD
     C                     Z-ADDZZLCD     ##LCD            *last coupon date
     C                     ENDIF
      *
      ** Access the investment type
      *
     C           INVTPK    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C           INVTPK    CHAININVTPDF              99
      *
      ** DATABASE ERROR
      *
     C           *IN99     IFEQ '1'
     C                     MOVEL'INVTP   'W0FILE           ***************
     C                     MOVEL##NCIT    W0KEY            * DB ERROR 09 *
     C                     Z-ADD9         W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXSECT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDEAL                                         *
      * Function    :  Access Deal                                    *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDEAL    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDEAL'  @STK,Q
      *                                                                                       243124
     C**********           MOVE 'Y'       PROCES                                   243124 AR1086147A
      *
      *................................................................
      *
     C                     MOVEA'00000'   *IN,01
     C           DLNO      CHAINDEALS                99
      *
      ** IF DEAL NOT FOUND, OR INVALID FORMAT ACCESSED
      *
     C           *IN99     IFEQ '1'
     C**********           MOVE 'N'       PROCES  1                                243124 AR1086147A
     C**********           MOVE 'B'       ##COPD                                  243124A AR1086147A
      *                                                                                       196380
     C           DLNO      CHAINDLCHISD0             99                                       196380
      *                                                                                      243124A
     C           *IN99     IFEQ '1'                                                          243124A
     C                     MOVE 'B'       ##COPD                                          AR1086147B
     C           DLNO      CHAINMMDELDP0             99                                      243124A
      *                                                                                       196380
     C           *IN99     IFEQ '1'                                                           196380
     C********** *IN02     ORNE '1'                                                          243124A
      *
      ** DATABASE ERROR
      *
     C**********           MOVEL'DEALS   'W0FILE           ***************                    196380
     C                     MOVEL'DEALSALL'W0FILE           ***************                    196380
     C                     MOVELDLNO      W0KEY            * DB ERROR 10 *
     C                     Z-ADD10        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     ENDIF                                                             243124A
      *
     C                     END                                                                196380
      *................................................................
      *
     C           EXDEAL    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDEPT                                         *
      * Function    :  Access depot details                           *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDEPT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDEPT'  @STK,Q
      *
      *................................................................
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1
     C                     PARM *BLANKS   ##KYST
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVEL##KEY1    W0KEY            ***************
     C                     Z-ADD11        W0ERNB           * DB ERROR 11 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXDEPT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRCHCM                                         *
      * Function    :  Access charge & commission details             *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRCHCM    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRCHCM'  @STK,Q
      *
      *................................................................
      *
     C           SECGTK    KLIST
     C                     KFLD           ##CCY
     C                     KFLD           ##CCD
     C           SECGTK    CHAINSECGTDF              99
      *
      ** DATABASE ERROR
      *
     C           *IN99     IFEQ '1'
     C                     MOVEL'SECGT   'W0FILE           ***************
     C                     MOVEL##CCCC    W0KEY            * DB ERROR 12 *
     C                     Z-ADD12        W0ERNB           ***************
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      *................................................................
      *
     C           EXCHCM    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRGENR                                         *
      * Function    :  Generate reference number                      *
      *                by writing to PF/CGUDCRPD                      *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :  CG9010 - Create reference record               *
      *****************************************************************
     C           SRGENR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRGENR'  @STK,Q
      *
      *................................................................
      *
      **  Generate reference number and check if further processing
      **  required. Set up all available information in the record
      **  format before calling.
      *
     C                     MOVELDPBA      DRBRCA
     C                     MOVELORBR      DRORBR
     C                     MOVEL'SE'      DRMODI
     C                     MOVELDPRN      DRMTRN
     C                     MOVEL*BLANK    DRMACT
     C                     MOVELDPSS      DRFREF                          094586
      *
     C                     MOVELW#PTYP    DRPTYP           * print type
     C           DPMV      IFEQ 'WI'
     C           DPMV      OREQ 'WO'
     C                     MOVE 'WIO'     DRPTYP
     C                     ELSE
     C           DPMV      IFEQ 'DT'
     C                     MOVE 'DT '     DRPTYP
     C                     ELSE
     C           DPMV      IFEQ 'BB'
     C           DPMV      OREQ 'BL'
     C                     MOVE 'BBL'     DRPTYP
     C                     ELSE
     C                     MOVE 'PR '     DRPTYP
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     Z-ADD1         #1
     C           ##PROT    LOKUP##PT,#1                  99*
     C                     MOVEL##PS,#1   DRPSTP           * print s/type
     C                     MOVEL'N'       DRATRM
      *
     C                     MOVELDPBN      ##CUST
      *
     C                     CALL 'CG9010'
     C                     PARM           ##RTCD  7
     C                     PARM '*GEN'    ##MODE 10
     C                     PARM W0CMT     ##CMT   3
     C                     PARM           ##CUST  6
     C                     PARM           ##UDCR
     C                     PARM           ##ITMA  8
      *
      **  Blank return code implies generate correspondence.
      **  CGD1270 => no error, but suppress output for this transaction.
      *
     C           ##RTCD    IFEQ *BLANK
      *
     C                     MOVE 'Y'       ##COPD
      *                                                                                       CCG015
      ** Pass reference as printtype:subtype                                                  CCG015
      *                                                                                       CCG015
     C           DRPTYP    CAT  ':':0     COLON  11 P                                         CCG015
     C           COLON     CAT  DRPSTP:0  ##REFR    P                                         CCG015
     C                     EXSR WRAPRF                                                        CCG015
      *
     C                     ELSE
      *
     C           ##RTCD    IFNE 'CGD1270'
     C                     MOVEL'CG9010  'W0FILE
     C                     MOVEL##RTCD    W0KEY            ***************
     C                     Z-ADD13        W0ERNB           * DB ERROR 13 *
     C                     MOVEL'CGD1286' W0MSGD           ***************
     C                     MOVEL'CGUSRMSG'W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      *................................................................
      *
     C           EXGENR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRRDE                                         *
      * Function    :  Retrieve RDE information for RDEs in group set *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  -                                              *
      *****************************************************************
     C           SRRRDE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRRDE'  @STK,Q
      *
      *................................................................
      *
      **  Reset
     C                     MOVEL*BLANK    ##R
     C                     MOVEL*BLANK    ##D
     C                     MOVEL*BLANK    ##S
      *
      **  Get information about next 20 RDEs in group set from compile
      **  time arrays
     C                     Z-ADD0         #1
     C           *IN99     DOUEQ'0'
     C           #1        OREQ 20
     C                     Z-ADD1         #2
     C           ##GRPX    LOKUP##GRP,#2                 99*
     C           *IN99     IFEQ '1'
     C                     ADD  1         #1
     C                     MOVEL##RDEA,#2 ##R,#1
     C                     ADD  1         ##RDEN
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRRDE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRADTA                                         *
      * Function    :  Accumulate RDEs and associated data for output *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG3999 - Format and Pack Data                  *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRADTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRADTA'  @STK,Q
      *
      *................................................................
      *
      **  Reformat RDE data
      *
     C                     EXSR SRRFMN
      *
      **  Pack RDEs and associated data into data string
     C                     CLEAR##SDS
      *                                                                                       CCG015
      ** Set-up Action Code parameter W0ACT                                                   CCG015
      *                                                                                       CCG015
     C           CCG015    IFEQ 'Y'                                                           CCG015
     C                     MOVEL'*NEWARR 'W0ACT                                               CCG015
     C                     MOVELS#PATH    W0SPAT                                              CCG015
     C                     ELSE                                                               CCG015
     C                     MOVEL'*PACK   'W0ACT                                               CCG015
     C                     MOVEL*BLANKS   W0SPAT                                              CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       CCG015
     C                     CALL 'CG3999'
     C                     PARM *BLANK    ##RTCD
     C**********           PARM '*PACK   'W0ACT                                               CCG015
     C                     PARM           W0ACT                                               CCG015
     C                     PARM           ##R
     C                     PARM           ##D
     C                     PARM           ##S
     C                     PARM           W0SPAT 70                                           CCG015
     C                     PARM           ##RN                                                CCG015
     C                     PARM           ##DN                                                CCG015
     C                     PARM           ##FM                                                CCG015
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG3999  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 14 *
     C                     Z-ADD14        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *                                                                                       CCG015
      ** Write a XML record for RDE                                                           CCG015
      *                                                                                       CCG015
     C                     EXSR WRTRDE                                                        CCG015
      *
      **  Initialise Write Format Parameter.
     C                     CLEARW0FMT
      *
      **  Set up Control Information.
     C                     Z-ADD##ITEM    DEITEM
     C                     ADD  1         ##OSEQ
     C                     Z-ADD##OSEQ    DEOSEQ
     C                     Z-ADD1         DEPBIN
     C                     Z-ADD1         DETBIN
     C                     MOVE 'FR'      DEFSLI
     C                     MOVE *BLANKS   W0PATH
     C                     MOVELS#PATH    W0PATH
      *
      **  Append Data from pack routine.
     C           W0FMT     CAT  ##SDS:0   W0FMT
      *
      *................................................................
      *
     C           EXADTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRFMN                                         *
      * Function    :  Reformat RDE data                              *
      *                                                               *
      * Called by   :  SRADTA                                         *
      * Calls       :                                                 *
      *****************************************************************
     C           SRRFMN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRFMN'  @STK,Q
      *
      *................................................................
      *
      ** Loop through RDE's and data
      *
     C                     Z-ADD0         #1
     C           #1        DOUEQ20
     C                     ADD  1         #1
     C                     MOVEL##R,#1    R#DEFN
     C                     MOVEL##D,#1    R#DATA
      *
      ** If data present and RDE is edited
      *
     C           R#DATA    IFNE *BLANK
     C           ##RDEC    ANDNE*BLANK
      *
      * Reformat Amount
     C                     Z-ADD1         #2
     C           *BLANK    LOKUP##NUMA,#2                99*
     C                     Z-ADD20        #3
     C                     Z-ADD0         ##WNUM
     C           #2        DOWGT1
     C           #2        ANDLE20
     C           #3        ANDGT1
     C                     SUB  1         #2
     C                     MOVEL##NUMA,#2 ##W,#3
     C                     SUB  1         #3
     C                     ENDDO
      *
      * Sign the amount
     C           ##SIGN    IFEQ '-'
     C                     Z-SUB##WNUM    ##NUMB
     C                     ELSE
     C                     Z-ADD##WNUM    ##NUMB
     C                     END
      *
      * Default Edit Type
     C           ##EDTT    IFEQ *BLANK
     C                     MOVEL##RDET    ##EDTT
     C                     END
      *
      * Default Decimal Places
     C           ##DCPA    IFEQ *BLANK
     C                     MOVEL##RDED    ##DCPA
     C                     END
      * New RDE data
     C                     MOVELR#DATA    ##D,#1
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRFMN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRODTA                                         *
      * Function    :  Output Accumulated data to PF/CGUDTAPD         *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG9020 - Output Data to CGUDTAPD               *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRODTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRODTA'  @STK,Q
      *
      *................................................................
      *
      **  Output PF/CGUDTAPD Record.
     C           CCG015    IFEQ 'N'                                                           CCG015
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*WRITE  'W0ACT
     C                     PARM           W0PATH256
     C                     PARM           W0FMT
     C                     PARM *BLANK    W0TITL  7
     C                     PARM *BLANK    W0ULIN  7
     C                     PARM           W0CMT
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG9020  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 15 *
     C                     Z-ADD15        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF                                                              CCG015
      *
      *................................................................
      *
     C           EXODTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDCDT                                         *
      * Function    :  Determine Currency Details                     *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDCDT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDCDT'  @STK,Q
      *
      *................................................................
      *
      **  Access array of Currency Details already loaded
     C                     Z-ADD1         C       30
     C           ##CCY     LOKUP##CY,C                   99
      *
      **  If no match is found determine the next free space in the
      **  loaded currency array.
     C           *IN99     IFEQ *OFF
     C                     Z-ADD1         C
     C           *BLANK    LOKUP##CY,C                   99
      *
      **  If no space is left, set the Currency Data data structure to
      **  the 101st occurrence so that when the new details are
      **  retrieved no existing details are overwritten.
     C           *IN99     IFEQ *OFF
     C           101       OCUR SDCURR
      *
      **  If a space is found, set up the new currency into the array
      **  and position the Currency Data data structure on the
      **  occurrence matching the array index.
     C                     ELSE
     C                     MOVE ##CCY     ##CY,C
     C           C         OCUR SDCURR
     C                     ENDIF
      *
      **  Retrieve the currency details.
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   ##RTCD           B:Return Cd
     C                     PARM '*KEY'    ##OPTN           I:Option
     C                     PARM ##CCY     ##CCYP  3        I:Currency Code
     C           SDCURR    PARM *BLANK    DSSDY            O:Format
      *
      **  Database Error
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVEL##CCY     W0KEY            ***************
     C                     Z-ADD16        W0ERNB           * DB ERROR 16 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      **  If the currency has been retrieved earlier, position the
      **  Currency Data data structure on the relevant occurrence.
     C                     ELSE
     C           C         OCUR SDCURR
     C                     ENDIF
     C/COPY WNCPYSRC,CG4310C007
     C*
     C           EXDCDT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5                                                            CEU014
      *****************************************************************   CEU014
      * Subroutine  :  T@EURO                                         *   CEU014
      * Function    :  EURO Currency Conversion:                      *   CEU014
      * Converts amount P@FRAM in P@FRCY to amount ##OUTA in P@TOCY   *   CEU014
      * Called by   :  T@DMBD, T@DMIO, T@LAD                          *   CEU014
      *                                                               *   CEU014
      * Calls       :  EU0200                                         *   CEU014
      *                SRERR                                          *   CEU014
      *****************************************************************   CEU014
     C           T@EURO    BEGSR                                          CEU014
      *                                                                   CEU014
     C                     Z-ADD0         ##OUTA 150                      CEU014
     C                     CALL 'EU0200'                                  CEU014
     C                     PARM *BLANKS   P@RTCD  7        Return Code    CEU014
     C                     PARM           P@FRAM 183       FROM Ccy AmountCEU014
     C                     PARM           P@FRCY  3        FROM Currency  CEU014
     C                     PARM           P@TOCY  3        TO Currency    CEU014
     C                     PARM 0         P@OUTA 150       Outright AmountCEU014
     C                     PARM 0         P@INTA 183       Interim Amount CEU014
     C                     PARM 0         P@EXRT 159       Exchange Rate  CEU014
     C                     PARM *BLANK    P@MDIN  1        Mult/Div Ind.  CEU014
      *                                                                   CEU014
      ** Database error handling:                                         CEU014
      *                                                                   CEU014
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU014
     C                     MOVEL'EU0200  'W0FILE                          CEU014
     C                     MOVEL'*CALL   'W0KEY            ***************CEU014
     C                     Z-ADD31        W0ERNB           * DB ERROR 31 *CEU014
     C                     MOVEL'MEM5003' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
      *                                                                   CEU014
      ** Otherwise, store amount in settlement currency as ##OUTA         CEU014
      *                                                                   CEU014
     C                     ELSE                                           CEU014
     C                     MOVE P@OUTA    ##OUTA                          CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
     C                     ENDSR                                          CEU014
      *****************************************************************   CEU014
     C/COPY WNCPYSRC,CG4310C013
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
     C/COPY WNCPYSRC,CG4310C008
      *
      *................................................................
      *
      ** CALL ACCESS PROGRAM FOR BANK DETAILS
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM '*FIRST  '##OPTN  7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD17        W0ERNB           * DB ERROR 17 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON
     C*
     C**   DETERMINE NUMBER OF DECIMAL PLACES - BASE CURRENCY
     C*
     C                     MOVELBJCYCD    ##CCY
     C                     EXSR SRDCDT
     C                     Z-ADDA6NBDP    BASCDP  10
      *
      ** CALL ACCESS PROGRAM FOR GENERAL LEDGER DETAILS
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOGELRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD18        W0ERNB           * DB ERROR 18 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** CALL ACCESS PROGRAM FOR MIDAS MODULES DETAILS
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOMMODR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD19        W0ERNB           * DB ERROR 19 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C** CALL ACCESS PROGRAM FOR SECURITIES TRADING DATA DETAILS
     C*
     C                     CALL 'AOSTRDR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDSTRD    PARM SDSTRD    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOSTRDR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD20        W0ERNB           * DB ERROR 20 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C** CALL ACCESS PROGRAM FOR TRADING DATA DETAILS
     C*
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOTRADR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD21        W0ERNB           * DB ERROR 21 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C** CALL ACCESS PROGRAM FOR DEALING DATA DETAILS
     C*
     C           BGDLMM    IFEQ 'Y'
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AODEALR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD22        W0ERNB           * DB ERROR 22 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
     C*
     C** CALL ACCESS PROGRAM FOR RETAIL DETAILS
     C*
     C           BGRTBN    IFEQ 'Y'
     C           BGIOAC    OREQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDRETL    PARM SDRETL    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AORETLR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD23        W0ERNB           * DB ERROR 23 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
     C*
     C** CALL ACCESS PROGRAM FOR MESSAGE DETAILS
     C*
     C           BGSWST    IFEQ 'Y'
     C                     CALL 'AOMGMER0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDMGME    PARM SDMGME    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOMGMER0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD24        W0ERNB           * DB ERROR 24 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
     C*
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF MT5XX FEATURE IS INSTALLED
     C*
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'S01401'  ##SARD  6
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C           ##RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 25 *
     C                     Z-ADD25        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C           ##RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       S01401  1
     C                     END
     C*
     C** Access switchable features file to determine whether             CEU014
     C** CEU014 - EMU UDC Enhancement - is switched on.                   CEU014
     C*                                                                   CEU014
     C                     CALL 'AOSARDR0'                                CEU014
     C                     PARM '       ' ##RTCD                          CEU014
     C                     PARM '*VERIFY' ##OPTN                          CEU014
     C                     PARM 'CEU014'  ##SARD  6                       CEU014
      *                                                                   CEU014
      ** Database error                                                   CEU014
      *                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C           ##RTCD    ANDNE'*NRF   '                                 CEU014
     C                     MOVEL'SCSARDPD'W0FILE           ***************CEU014
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 30 *CEU014
     C                     Z-ADD30        W0ERNB           ***************CEU014
     C                     MOVEL'MEM5003' W0MSGD                          CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     END                                            CEU014
     C*                                                                   CEU014
     C           ##RTCD    IFEQ *BLANK                                    CEU014
     C                     MOVE 'Y'       CEU014  1                       CEU014
     C                     ENDIF                                          CEU014
     C*                                                                   CEU014
     C/COPY WNCPYSRC,CG4310C016
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED
     C*
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'S01383'  ##SARD
     C*
     C           ##RTCD    IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C*
     C** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA
     C*
     C           S01383    IFEQ 'Y'
     C                     MOVE 'D'       KRECI   1
     C           KRECI     CHAINSDBRTDD0             99
     C           *IN99     IFEQ '1'
     C                     MOVEL'SDBRTDPD'W0FILE           ***************
     C                     MOVEL'D    '   W0KEY            * DB ERROR 26 *
     C                     Z-ADD26        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
     C*                                                                   UBL009
     C** Check if SE Charge and Commission switchable feature is          UBL009
     C** switched ON                                                      UBL009
     C*                                                                   UBL009
     C/COPY WNCPYSRC,CG4310CRPG                                           UBL009
      *                                                                   CSE012
      ***  Access switchable SAR CSE012                                   CSE012
      *                                                                   CSE012
     C                     MOVE 'N'       CSE012  1                       CSE012
     C                     CALL 'AOSARDR0'                                CSE012
     C                     PARM '       ' PRTCD   7                       CSE012
     C                     PARM '*VERIFY' POPTN   7                       CSE012
     C                     PARM 'CSE012'  PSARD   6                       CSE012
      *                                                                   CSE012
     C           PRTCD     IFEQ *BLANK                                    CSE012
     C                     MOVE 'Y'       CSE012                          CSE012
     C                     ELSE                                           CSE012
      *                                                                   CSE012
     C           PRTCD     IFNE '*NRF   '                                 CSE012
     C                     MOVEL'SCSARDPD'W0FILE           ************   CSE012
     C                     MOVEL'CSE012'  W0KEY            * DBERR  32*   CSE012
     C                     Z-ADD32        W0ERNB           ************   CSE012
     C                     MOVEL'MEM5003' W0MSGD                          CSE012
     C                     MOVEL'MIDAS  ' W0MSGF                          CSE012
     C                     MOVE *ON       *INU7                           CSE012
     C                     MOVE *ON       *INU8                           CSE012
     C                     MOVE *ON       *INLR                           CSE012
     C                     EXSR SRERR                                     CSE012
     C                     ENDIF                                          CSE012
      *                                                                   CSE012
     C                     ENDIF                                          CSE012
      *                                                                                       CCG015
      ** Access Switchable Features file and check if CCG015 is                               CCG015
      ** installed                                                                            CCG015
      *                                                                                       CCG015
     C                     CALL 'AOSARDR0'                                                    CCG015
     C                     PARM *BLANKS   PRTCD                                               CCG015
     C                     PARM '*VERIFY' POPTN                                               CCG015
     C                     PARM 'CCG015'  PSARD                                               CCG015
     C           SCSARD    PARM SCSARD    DSFDY                                               CCG015
      *                                                                                       CCG015
     C           PRTCD     IFEQ *BLANK                                                        CCG015
      *                                                                                       CCG015
     C                     MOVE 'Y'       CCG015  1                                           CCG015
      *                                                                                       CCG015
     C                     ELSE                                                               CCG015
      *                                                                                       CCG015
     C                     MOVE 'N'       CCG015                                              CCG015
     C           PRTCD     IFNE '*NRF   '                                                     CCG015
     C                     MOVEL'SCSARDPD'W0FILE                                              CCG015
     C                     MOVEL'*CALL'   W0KEY                                               CCG015
     C                     Z-ADD33        W0ERNB                                              CCG015
     C                     MOVEL'MEM5003' W0MSGD                                              CCG015
     C                     MOVEL'MIDAS  ' W0MSGF                                              CCG015
     C                     EXSR SRERR                                                         CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       236024
      ** Access Switchable Features file and check if CGL031 is                               236024
      ** installed                                                                            236024
      *                                                                                       236024
     C                     CALL 'AOSARDR0'                                                    236024
     C                     PARM *BLANKS   PRTCD                                               236024
     C                     PARM '*VERIFY' POPTN                                               236024
     C                     PARM 'CGL031'  PSARD                                               236024
     C           SCSARD    PARM SCSARD    DSFDY                                               236024
      *                                                                                       236024
     C           PRTCD     IFEQ *BLANK                                                        236024
      *                                                                                       236024
     C                     MOVE 'Y'       CGL031  1                                           236024
      *                                                                                       236024
     C                     ELSE                                                               236024
      *                                                                                       236024
     C                     MOVE 'N'       CGL031                                              236024
     C           PRTCD     IFNE '*NRF   '                                                     236024
     C                     MOVEL'SCSARDPD'W0FILE                                              236024
     C                     MOVEL'*CALL'   W0KEY                                               236024
     C                     Z-ADD34        W0ERNB                                              236024
     C                     MOVEL'MEM5003' W0MSGD                                              236024
     C                     MOVEL'MIDAS  ' W0MSGF                                              236024
     C                     EXSR SRERR                                                         236024
     C                     ENDIF                                                              236024
      *                                                                                       236024
     C                     ENDIF                                                              236024
      *                                                                                     BUG11112
      ** Access SAR details file to determine if CDL033 is installed.                       BUG11112
      *                                                                                     BUG11112
     C                     CALL 'AOSARDR0'                                                  BUG11112
     C                     PARM '       ' ##RTCD                                            BUG11112
     C                     PARM '*VERIFY' ##OPTN                                            BUG11112
     C                     PARM 'CDL033'  ##SARD                                            BUG11112
      *                                                                                     BUG11112
      ** Database Error                                                                     BUG11112
      *                                                                                     BUG11112
     C           ##RTCD    IFNE *BLANK                                                      BUG11112
     C           ##RTCD    ANDNE'*NRF   '                                                   BUG11112
     C                     MOVEL'SCSARDPD'W0FILE                                            BUG11112
     C                     MOVEL'*CALL'   W0KEY                                             BUG11112
     C                     Z-ADD35        W0ERNB                                            BUG11112
     C                     MOVEL'MEM5003' W0MSGD                                            BUG11112
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG11112
     C                     EXSR SRERR                                                       BUG11112
     C                     END                                                              BUG11112
     C*                                                                                     BUG11112
     C           ##RTCD    IFEQ *BLANK                                                      BUG11112
     C                     MOVEL'Y'       CDL033  1                                         BUG11112
     C                     ELSE                                                             BUG11112
     C                     MOVEL'N'       CDL033                                            BUG11112
     C                     END                                                              BUG11112
      *                                                                   CSE012
     C           KCSE12    KLIST                                          CSE012
     C                     KFLD           WDPSS2 10                       CSE012
     C                     KFLD           WDPRN2  6                       CSE012
     C*                                                                   UBL009
      *
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINZ                                          *
      * Function    :  Initialise Fields on Program Invocation        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRINZ     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     Z-ADD*ZEROS    ##W050  50
     C                     Z-ADD*ZEROS    ##W150 150
     C                     Z-ADD*ZEROS    #1      60
     C                     Z-ADD*ZEROS    #2      60
     C                     Z-ADD*ZEROS    #3      60
     C                     MOVE *BLANKS   S#PATH256
     C           *LIKE     DEFN DEOSEQ    ##OSEQ                          082060
      *
      **  Initialise output sequence (to CGUDTAPD)
     C                     Z-ADD*ZEROS    ##OSEQ
      *                                                                                       CCG015
      ** Initialise XML increment                                                             CCG015
      *                                                                                       CCG015
     C                     EXSR INIXML                                                        CCG015
      *
     C           EXINZ     TAG
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5                                                                              BUG11112
      *****************************************************************                     BUG11112
      * Subroutine  :  SRFRCD                                         *                     BUG11112
      * Function    :  Floating Rate CD Issued Details (Deal Date     *                     BUG11112
      *                Conf)                                          *                     BUG11112
      *                                                               *                     BUG11112
      * Called by   :  T05PLD                                         *                     BUG11112
      * Calls       :                                                 *                     BUG11112
      *****************************************************************                     BUG11112
     C           SRFRCD    BEGSR                                                            BUG11112
      *                                                                                     BUG11112
      **  Set up subroutine stack name                                                      BUG11112
      *                                                                                     BUG11112
     C                     ADD  1         Q                                                 BUG11112
     C                     MOVEL'FRCD  '  @STK,Q                                            BUG11112
      *                                                                                     BUG11112
      **  Retrieve subroutine specific data.                                                BUG11112
      *                                                                                     BUG11112
     C           1         OCUR ##SRDT                                                      BUG11112
     C                     MOVEL##SPAT    S#PATH                                            BUG11112
      *                                                                                     BUG11112
      **  Set up Path.                                                                      BUG11112
      *                                                                                     BUG11112
     C                     MOVEL'\FRCD  ' ##PNAM                                            BUG11112
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                            BUG11112
     C                     EXSR PSHGRS                                                      BUG11112
      *                                                                                     BUG11112
      **  Retrieve RDE information for RDEs in group set                                    BUG11112
      *                                                                                     BUG11112
     C                     MOVEL@STK,Q    ##GRPS                                            BUG11112
     C                     Z-ADD1         ##RDEN                                            BUG11112
     C                     EXSR SRRRDE                                                      BUG11112
      *                                                                                     BUG11112
      **  Rate Change Date                                                                  BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKRCDT    ##D,1                                             BUG11112
      *                                                                                     BUG11112
      **  Rate Change Frequency                                                             BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKRCFR    ##D,2                                             BUG11112
      *                                                                                     BUG11112
      **  Rate Change Days                                                                  BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKRCDM    ##D,3                                             BUG11112
      *                                                                                     BUG11112
      **  Short Term Rate Flag                                                              BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKSTRF    ##D,4                                             BUG11112
      *                                                                                     BUG11112
      **  Short Term Rate                                                                   BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKSTRT    ##D,5                                             BUG11112
      *                                                                                     BUG11112
      **  Accrued Interest as of Last Int Paymnt/Change Date                                BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKAILC    ##D,6                                             BUG11112
     C                     MOVE A6NBDP    ##D,6                                             BUG11112
      *                                                                                     BUG11112
      **  Accrued COF as of Last Int Paymnt/Change Date                                     BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKACDA    ##D,7                                             BUG11112
     C                     MOVE A6NBDP    ##D,7                                             BUG11112
      *                                                                                     BUG11112
      **  Short Term Rate on Value Date Flag                                                BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKSTVF    ##D,8                                             BUG11112
      *                                                                                     BUG11112
      **  Fixed Base Rate Applied on Value Date Flag                                        BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKBSVF    ##D,9                                             BUG11112
      *                                                                                     BUG11112
      **  Rate Fix Days                                                                     BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKFXDM    ##D,10                                            BUG11112
      *                                                                                     BUG11112
      **  Rate Fix Date                                                                     BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKINFD    ##D,11                                            BUG11112
      *                                                                                     BUG11112
      **  Rate Fix Date Processed Flag                                                      BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKINFF    ##D,12                                            BUG11112
      *                                                                                     BUG11112
      **  Fixed Base Rate                                                                   BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKBSRF    ##D,13                                            BUG11112
      *                                                                                     BUG11112
      **  Forward Yield Curve                                                               BUG11112
      *                                                                                     BUG11112
     C                     MOVELXKFYLD    ##D,14                                            BUG11112
      *                                                                                     BUG11112
      ** Base Rate                                                                          BUG11112
     C                     MOVELCCY       ##CYCD                                            BUG11112
     C                     MOVELBRTT      ##BSRC                                            BUG11112
     C                     MOVEL##BSRC    ##D,15                                            BUG11112
      *                                                                                     BUG11112
      ** Base Rate Name                                                                     BUG11112
     C                     CALL 'AOBSRTR0'                                                  BUG11112
     C                     PARM *BLANKS   ##RTCD                                            BUG11112
     C                     PARM '*KEY   ' ##OPTN                                            BUG11112
     C                     PARM           ##CYCD  3                                         BUG11112
     C                     PARM           ##BSRC  2                                         BUG11112
     C           SDBSRT    PARM SDBSRT    DSSDY                                             BUG11112
      *                                                                                     BUG11112
      ** DATABASE ERROR                                                                     BUG11112
      *                                                                                     BUG11112
     C           ##RTCD    IFNE *BLANK                                                      BUG11112
     C                     MOVEL'SDBSRTPD'W0FILE           ***************                  BUG11112
     C                     MOVEL##BSRC    W0KEY            * DB ERROR 36 *                  BUG11112
     C                     Z-ADD36        W0ERNB           ***************                  BUG11112
     C                     MOVEL'MEM5004' W0MSGD                                            BUG11112
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG11112
     C                     EXSR SRERR                                                       BUG11112
     C                     END                                                              BUG11112
      *                                                                                     BUG11112
     C                     MOVELBABSRN    ##D,16                                            BUG11112
      *                                                                                     BUG11112
      ** Spread Rate                                                                        BUG11112
     C                     MOVEL*BLANKS   R#DATA                                            BUG11112
     C                     MOVELRTSP      R#DATA                                            BUG11112
     C                     MOVELR#DATA    ##D,17                                            BUG11112
     C                     MOVEL*BLANKS   R#DATA                                            BUG11112
      *                                                                                     BUG11112
      ** Interest Calculation Basis                                                         BUG11112
     C                     MOVELICBS      ##D,18                                            BUG11112
      *                                                                                     BUG11112
      **  Accumulate RDE's and associated data and output to                                BUG11112
      **  PF/CGUDTAPD.                                                                      BUG11112
     C                     EXSR SRADTA                                                      BUG11112
     C                     EXSR SRODTA                                                      BUG11112
      *                                                                                     BUG11112
     C           EXFRCD    TAG                                                              BUG11112
      *                                                                                     BUG11112
      **  Unwind subroutine stack name                                                      BUG11112
      *                                                                                     BUG11112
     C                     EXSR POPGRS                                                      BUG11112
     C                     MOVEA*BLANKS   @STK,Q                                            BUG11112
     C                     SUB  1         Q                                                 BUG11112
      *                                                                                     BUG11112
     C                     ENDSR                                                            BUG11112
      *****************************************************************                     BUG11112
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRPSSR
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRC
     C/SPACE 5
     C/COPY ZSRSRC,ZNCDZ3
     C/SPACE 5
     C/COPY ZSRSRC,ZLCDZ1
     C/SPACE 5
     C/COPY ZSRSRC,ZSDESCZ3
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE1Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
     C/SPACE 5
     C/COPY ZSRSRC,ZDAYSZ2
     C/SPACE 5                                                                                CCG015
     C/COPY CGCPYSRC,CGNWEX                                                                   CCG015
** ##GRP/##RDEA
BRANCH0001 BRANCH
BRANCH0002 BRANCH NAM
BROKER0001 BROKER
BROKER0002 BROKER NAM
BROKER0003 BROKER TWN
CUST  0001 CUSTOMER
CUST  0002 CUST_NAME
CUST  0003 CUST_ADR1
CUST  0004 CUST_ADR2
CUST  0005 CUST_ADR3
CUST  0006 CUST_ADR4
CUST  0007 CUST_TOWN                                                      086918
D_BASE0001 DEALNUMBER
D_BASE0002 DEAL DATE  Date
D_BASE0003 VALUE DATE Date
D_LAD 0001 CURRENCY
D_LAD 0002 PRINCIPAL  AmountL
D_LAD 0003 INT RATE   Rate  L7
D_LAD 0004 GRS INTRST AmountL
D_LAD 0005 NET INTRST AmountL
D_LAD 0006 TAX        AmountL
D_LAD 0007 TAXI
D_LAD 0008 NET TOTAL  AmountL
D_LAD 0009 TOTINTOVR
D_LAD 0010 LOAN/DEPOS
D_LAD 0011 CCY_DESC                                                       086780
D_LAD 0012 PREC_METIN                                                     086780
D_LAD 0013 INTPAY_SEP                                                     086864
D_LAD 0014 LST IPDATE Date                                                086962
D_LAD 0015 CONFNARR                                                       119143
D_LAD 0016 C.D. REF                                                       116840
D_LAD 0017 PRNC_EQCY  AmountL                                             CEU014
D_LAD 0018 G_INT_EQCY AmountL                                             CEU014
D_LAD 0019 EQUIV_CCY                                                      CEU014
D_LAD 0020 EQUIV_CCYD                                                     CEU014
D_PAYS0001 S_PAYOURA1
D_PAYS0002 S_PAYOURA2
D_PAYS0003 S_PAYOURNN
D_PAYS0004 S_PAYOURNT
D_PAYS0005 S_PAYOURXG
D_PAYS0006 S_PAYOURXR
D_PAYS0007 S_PAYTHRA1
D_PAYS0008 S_PAYTHRA2
D_PAYS0009 S_PAYTHRNN
D_PAYS0010 S_PAYTHRNT
D_PAYS0011 S_PAYZFAL1
D_PAYS0012 S_PAYZFAL2
D_PAYS0013 S_PAYZFAON
D_PAYS0014 S_PAYZFAOT
D_PAYS0015 S_SPEC_INS                                                     086864
D_RECS0001 S_RECOURA1
D_RECS0002 S_RECOURA2
D_RECS0003 S_RECOURNN
D_RECS0004 S_RECOURNT
D_RECS0005 S_RECOURXG
D_RECS0006 S_RECOURXR
D_RECS0007 S_RECTHRA1
D_RECS0008 S_RECTHRA2
D_RECS0009 S_RECTHRNN
D_RECS0010 S_RECTHRNT
MATURD0001 MATUR DATE Date
T_DMBD0001 RUNDAT     Date
T_DMBD0002 DEPOTM_REF
T_DMBD0003 NOMINAL    AmountL
T_DMBD0004 DEPOTM_NAR
T_DMBD0005 DEPOTM_PRC Rate  L8
T_DMBD0006 NOMNL_EQCY AmountL                                             CEU014
T_DMBD0007 N_EQV_CCY                                                      CEU014
T_DMBD0008 N_EQV_CCYD                                                     CEU014
T_DMBD0009 NARRAT_1                                                       CSE012
T_DMBD0010 NARRAT_2                                                       CSE012
T_DMBD0011 NARRAT_3                                                       CSE012
T_DMBD0012 NARRAT_4                                                       CSE012
T_DMBD0013 PORT_REF                                                                           214731
     X/COPY WNCPYSRC,CG4310X001
T_DMBO0001 START_DATE Date
T_DMBO0002 END_DATE   Date
T_DMBO0003 OUR_DEPNAM
T_DMBO0004 OUR_DEPTWN
T_DMBO0005 THR_DEPNAM
T_DMBO0006 THR_DEPTWN
T_DMDT0001 FRM_DEPNAM
T_DMDT0002 FRM_DEPTWN
T_DMDT0003 TO_DEPNAM
T_DMDT0004 TO_DEPTWN
T_DMIO0001 OUR_DEPNAM
T_DMIO0002 OUR_DEPTWN
T_DMIO0003 CHARGE_NAR
T_DMIO0004 CHARGE_CCY
T_DMIO0005 CHARGE_AMT AmountL
T_DMIO0006 CHARG_EQCY AmountL                                             CEU014
T_DMIO0007 C_EQV_CCY                                                      CEU014
T_DMIO0008 C_EQV_CCYD                                                     CEU014
T_DMIO0009 DAT_IN_OUT Date                                                191550
T_DMIO0010 PORT_REF                                                       191550
T_DMIO0011 ORG_PDATE  Date                                                                    236024
T_DMIO0012 ORG_PINT   AmountL                                                                 236024
T_DMIO0013 AVE_FISPRI AmountL                                                                 236024
T_OTHD0001 CANC/AMEND
T_OTHD0002 AUTO-TRAN
T_OTHD0003 DEPOTM_TYP
T_SECD0001 SEC_SHTNAM
T_SECD0002 PROC_TYPE
T_SECD0003 SEC_NOMCCY
T_SECD0004 SEC_INVTYP
T_SECD0005 SEC_DESCP1
T_SECD0006 SEC_DESCP2
T_SECD0007 SEC_DESCP3
T_SECD0008 SEC_NXTCDT Date
T_SECD0009 SEC_LSTCDT Date
T_SECD0010 SEC_COUPRT Rate  L7
T_SECD0011 SEC_MATUDT Date
T_SECD0012 SEC_INITDT Date
T_SECD0013 SEC_ISSUDT Date
T_SECD0014 SEC_ISIN                                                       089693
T_SECD0015 SEC_INVNAM                                                                         214731
FRCD  0001 RT CHG DAT Date                                                                  BUG11112
FRCD  0002 RT CHG FRQ                                                                       BUG11112
FRCD  0003 RT CHG DAY                                                                       BUG11112
FRCD  0004 SH RATE FL                                                                       BUG11112
FRCD  0005 SH RATE    Rate  L7                                                              BUG11112
FRCD  0006 ACC INTRST AmountL                                                               BUG11112
FRCD  0007 ACC COF    AmountL                                                               BUG11112
FRCD  0008 SH RATE VA Rate  L7                                                              BUG11112
FRCD  0009 FX RATE VA Rate  L7                                                              BUG11112
FRCD  0010 RT FIX DAY                                                                       BUG11112
FRCD  0011 RT FIX DATEDate                                                                  BUG11112
FRCD  0012 RT FIX PRFL                                                                      BUG11112
FRCD  0013 FIX BASE RTRate  L7                                                              BUG11112
FRCD  0014 FWD YLD CUR                                                                      BUG11112
FRCD  0015 BASERTCOD                                                                        BUG11112
FRCD  0016 BASERTNAM                                                                        BUG11112
FRCD  0017 SPREADRAT  Rate  L7                                                              BUG11112
FRCD  0018 CALCBASIS                                                                        BUG11112
**  Table of Proc. Type vs related Print Item Sub Type
1FIXED_INT
2COMMODITY
3FRN
4SHARE
5YEN_BOND
6SCHULDSCH
7UNIT_TRUST
8MORTGAGE
9COMM_PAPER
** Loan Deal Types
IPTICLLNDLILPL
** ##CPY  **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
