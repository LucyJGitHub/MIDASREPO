     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CG General ledger statements')                   *
/*OVRF*  OVRDBF FILE(GLAPSGL0) TOFILE(GLAPSGAL0)                      *
      *****************************************************************
      *                                                               *
      *  Midas - User Defined Correspondence                          *
      *                                                               *
      *  CG4520 - General Ledger statements                           *
      *                                                               *
      *  NOTE: This program is duplicated from CG4510. Any            *
      *        changes done on CG4510 should also be done             *
      *        to this program.                                       *
      *                                                               *
      *  Function:  This program, given a full Account Identifier,    *
      *             extracts all the data required to construct the   *
      *             relevant statement.                               *
      *                                                               *
      *  Called By: GLC0064 - Statement of A/c Extract Ctl Program    *
      *                                                               *
      *  (c) Finastra International Limited 2003                      *
      *                                                               *
      *  Last Amend No. MD056576           Date 21Sep20               *
      *  Prev Amend No. MD054681           Date 01Jun20               *
      *                 261705             Date 08Oct19               *
      *                 259159             Date 22Jan18               *
      *                 MD046248           Date 27Oct17               *
      *                 AR1049758          Date 07Feb13               *
      *                 CRE073             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 CRE075             Date 06Dec10               *
      *                 AR676213           Date 19Nov10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG25261           Date 31Jul09               *
      *                 BUG24460           Date 19Jun09               *
      *                 BUG23984           Date 11May09               *
      *                 BUG23445A          Date 19Apr09               *
      *                 BUG23277A          Date 20Apr09               *
      *                 BUG23277           Date 07Apr09               *
      *                 BUG23572           Date 27Mar09               *
      *                 BUG23445           Date 19Mar09               *
      *                 BUG23216           Date 04Mar09               *
      *                 BUG23197           Date 03Mar09               *
      *                 CER038             Date 19May08               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP204             Date 11Jan10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9646            Date 20Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL025   *CREATE   Date 28Aug03               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD056576 - Increase field length for account balances        *
      *  MD054681 - Wrong values on account statement.                *
      *           - ##VAEC and ##VAED result fields lenght was        *
      *             patterned to SDCFSB (15P) istead of PSTA (13P).   *
      *  261705 - Add extracts for Start and End Dates. Apply 258051. *
      *         - GLStatementNormal dat file does not contain         *
      *           destination address lines. Apply 257834.            *
      *         - Applied for MD054159.                               *
      *  259159 - Extract postings from GLACPHPD too.                 *
      *         - Applied for MD-46416.                               *
      *  MD046248 - Finastra Rebranding                               *
      *  AR1049758 - Statement was generated for SYSTEM. Pass correct *
      *              parameter to CG9010 (Child:AR1049759)            *
      *  CRE073 - Portuguese Feature - Interest Rate Rounding         *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,CGH00002                                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  AR676213 - Incorrect definition of CLGLAI field (Recompile)  *
      *           (Child: AR676229)                                   *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG25261 - DL and LE transactions have Posting Narratives    *
      *  BUG24460 - Batch with MTcash Narrative22x35 input are missing*
      *  BUG23984 - Account Statement Correspondence has wrong Branch *
      *             Internal Customer details (Recompile)             *
      *  BUG23445A - Paper statements were not reformatted based on   *
      *              network *PAPER                                   *
      *  BUG23277A - Populate Posting Narrative in g_SPS3 Subroutine  *
      *  BUG23277 - Populate Posting Narrative in g_SPS3 Subroutine   *
      *  BUG23572 - CHIPSABA Not Accept '0' on screen, so that populat*
      *             with blanks when '0' values in database(Recompile)*
      *  BUG23445 - Format network according to network Paper if      *
      *             Account is linked                                 *
      *  BUG23216 - Populate Actual Customer Detail in Customer       *
      *             information instead of Branch internal Customer   *
      *             (Recompile)                                       *
      *  BUG23197 - Pass blank parameter to the MG001900(Output       *
      *             parameter)                                        *
      *  CER038 - Additional fields added to Correspondence           *
      *           (Includes CER031-Multi-narrative Enhancement)       *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAP204 - Retail Account Transfer                             *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9646- Changes in CGPACKE causes programs not to compile   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL025 - Statement of Account for a Specified Period.        *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  Indicator usage                                              *
      *  ~~~~~~~~~~~~~~~                                              *
      *                                                               *
      *  51   -    No Record found on LF/REIAC                        *
      *  52   -    No Record found on PF/GLAPSTPD                     *
      *  55   -    End of File/No Record Found on LF/APOST            *
      *  60   -    Successful Look-Up Indicator                       *
      *  70   -    Test Bit Indicator                                 *
      *  90   -    ROLBK indicator                                    *
      *                                                               *
      *  99   -    General work indicator                             *
      *                                                               *
      *****************************************************************
     F/COPY WNCPYSRC,CG4510F001
      *                                                                                       CER038
      ** Correspondent file by customer number                                                CER038
      *                                                                                       CER038
     FCGCORRL4IF  E           K        DISK                           UC                      CER038
      *                                                                                       CER038
     FCGSTMTL1IF  E           K        DISK
     F            @STMTL1                           KRENAMESTMTL1
     F                                              KINFSR SRFILE
     FREIAC   IF  E           K        DISK
     F                                              KINFSR SRFILE
     F/COPY WNCPYSRC,CG4510F004
     F***GLSTMTP IF  E           K        DISK                                                259159
     FGLSTMTP2IF  E           K        DISK                                                   259159
     F                                              KINFSR SRFILE
     FGLSTMTR IF  E           K        DISK
     F                                              KINFSR SRFILE
     F/COPY WNCPYSRC,CG4510F002
     FSDACOFL0IF  E           K        DISK         KINFSR SRFILE
     FGLAPSTPDIF  E           K        DISK
     F                                              KINFSR SRFILE
     FGLAPSGL0IF  E           K        DISK
     FSDCMANL0IF  E           K        DISK
     FREGAHLJ2IF  E           K        DISK
      *                                                                                     BUG23445
      ** Midas GL Network accounts - MT94x - retrieval                                      BUG23445
      *                                                                                     BUG23445
     F*GLNW94L1IF  E           K        DISK                                      BUG23445 BUG23445A
     FGLNWACL1IF  E           K        DISK                                                BUG23445A
      *                                                                                     BUG23445
      ** GL MultiCash Narratives File                                                       BUG24460
      *                                                                                     BUG24460
     FGLMNARL1IF  E           K        DISK                                                 BUG24460
      *                                                                                     BUG24460
     F/COPY WNCPYSRC,CG4510F003
     F/SPACE 5
     F/COPY WNCPYSRC,CG4510F005
     E/COPY CGCPYSRC,CGPACKE
     E/COPY WNCPYSRC,CG4510E006
     E/COPY CGCPYSRC,SRERRE
     E/COPY WNCPYSRC,CG4510E003
     E**  Number Arrays
     E                    ##W        20  1
     E/COPY WNCPYSRC,CG4510E005
     E                    ##NUMA     29  1
     E*
     E**  ##GRP = Group/RDE Number             ##RDEA = RDE + Attributes
     E*
     E/COPY WNCPYSRC,CG4510E001
     E**********          ##GRP   1  75 10   ##RDEA 22                                        CER038
     E**********          ##GRP   1  95 10   ##RDEA 22                               CER038 BUG24460
     E**********          ##GRP   1  97 10   ##RDEA 22                               BUG24460 CRE073
     E**********          ##GRP   1 106 10   ##RDEA 22                                 CRE073 261705
     E                    ##GRP   1 108 10   ##RDEA 22                                        261705
     E/COPY WNCPYSRC,CG4510E002
     E*
     E**  Array of Currencies accessed by program
     E                    ##CY      100  3
     E*
     E**  Arrays of Generated Entry Type (GETP) and the associated
     E**  module. (As used on APOST).
     E**********          ##GE    1  20  1   ##MD    2                                        CAP204
     E                    ##GE    1  21  1   ##MD    2                                        CAP204
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
      *                                                                                       CER038
      ** Array for 22 * 35                                                                  BUG24460
      *                                                                                     BUG24460
     E                    EXT        22 35                                                  BUG24460
      *                                                                                     BUG24460
     E                    FLDNAM     40 10                                                    CER038
     E                    MSGID      40  7                                                    CER038
     E                    MSGDTA     40 45                                                    CER038
     E                    WFLDNM     40 10                                                    CER038
     E                    WMGID      40  7                                                    CER038
     E                    WMGDTA     40 45                                                    CER038
      *                                                                                       CER038
     E/COPY WNCPYSRC,CG4510E004
     I/SPACE 5
     I/COPY WNCPYSRC,CG4510I002
     I*
     I*
     I            DS
     I                                        1  10 ##GRPX
     I                                        1   6 ##GRPS
     I                                        7  100##RDEN
     I**  Look-up string for RDE definition Array
     I*
     I##SDS       DS
     I/COPY WNCPYSRC,CG4510I006
     I**********                              15120 ##S                                      BUG9646
     I                                        15632 ##S                                      BUG9646
     I/COPY WNCPYSRC,CG4510I007
     I**  Packed data string.
     I*
     I            DS
     I/COPY WNCPYSRC,CG4510I008
     I                                        1  20 ##W
     I                                        1  200##WNUM
     I/COPY WNCPYSRC,CG4510I009
     I**  Number Field
     I*
     I            DS
     I                                        1   8 ##ITMA
     I                                        1   80##ITEM
     I** Used to convert item reference from character to numeric
     I*
     I            DS
     I                                        1  34 SRCGL
     I                                        1   3 AGSBRC
     I**********                              4   90AGSCUS                                    CSD027
     I                                        4   9 AGSCUS                                    CSD027
     I                                       10  12 AGSCCY
     I                                       13  220AGSACD
     I                                       23  240AGSASN
     I                                       25  340AGSRNO
     I                                       25  34 SRCRET
     I            DS
     I                                        1 200 CMTXTG
     I                                        1  65 WCMTX1
     I                                       66 130 WCMTX2
     I                                      131 195 WCMTX3
     I                                      196 260 WCMTX4
     I*
     I##UDCR    E DSCGUDCRPD
      ** External DS for incomplete reference
      *
     ISDBANK    E DSSDBANKPD
      **  External DS for bank details
      *
     ISDBRCH    E DSSDBRCHPD
      **  External DS for branch details
      *
     ISDACCT    E DSACCNTAB
      **  External DS for account details
     I              LSTD                            LSTDAB
     I              NSTD                            NSTDAB
     I              LSTP                            LSTPAB
     I              CFSB                            CFSBAB
     I              YTDB                            YTDBAB
     I              GLBT                            GLBTAB
      *
     ISDCURR    E DSSDCURRPD                101
      **  External DS for currency details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          QQDFA1
      **  External DS for Customer details
      *
     ISDGELR    E DSSDGELRPD
      **  External DS for General Ledger Details
     I              QQACCD                          QQACCX                                  BUG23445
     ISCSARD    E DSSCSARDPD
      ** MIDAS Switchable Features Accessed Via Access Program
      *
     I              LCD                             LCX
     I/COPY WNCPYSRC,CG4510I003
      *
     IDSFDY     E DSDSFDY
      **  First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      **  Second DS for access programs, long data structure
      *
      *
     IDSPARM      DS
     I                                        1  30 ##ACI2
     I**********                              1   60##CNUM                                    CSD027
     I                                        1   6 ##CNUM                                    CSD027
     I                                        7   9 ##CCY
     I                                       10  190##ACOD
     I                                       20  210##ACSQ
     I                                       22  24 ##BRCA
     I                                       25  30 ##CNMA
     I/COPY WNCPYSRC,CG4510I005
      *
     IW0FMT     E DSCGUDTAPD
      **  Record format of PF/CGUDTAPD for use as a parameter
      *
     I            DS
      **  DS to obtain Transaction Ref from DLREF
     I                                        1   8 DLREF                 N/Used
     I                                        2   7 ##TREF                N/Used
      *
     I            DS
      **  DS to obtain Batch Number and Batch Item Number
     I                                        1   7 SPOS                  N/Used
     I                                        1   3 ##BANO                N/Used
     I                                        4   6 ##BITM                N/Used
      *
     I##SRDT      DS                         20
      **  DS to store subroutine specific data.
      **  - Previous Bind
      **  - This Bind
      **  - Saved Path
     I                                    P   1   50##PBIN                082060
     I                                    P   6  100##TBIN
     I                                       11  80 ##SPAT
      /COPY CGCPYSRC,CGPACKI
      *
      **  Define constant fields
     I              'STATEMENT '          C         C#STMT
     I              'NORMAL    '          C         C#NORM
     I              'TURNOVER  '          C         C#TURN
     I/COPY WNCPYSRC,CG4510I004
      *
     ICPYR        DS
      **  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
      *                                                                                       CER038
     I            DS                                                                          CER038
     I                                        1  100PACCD                                     CER038
      *                                                                                       CER038
     I                                       11  120PACSQ                                     CER038
     I/COPY CGCPYSRC,SRERRI
      *
     I/COPY WNCPYSRC,CG4510I001
     C/SPACE 5
      *****************************************************************
      *                                                               *
      *   Index to subroutines                                        *
      *   --------------------                                        *
      *                                                               *
      *   G#STMT - Main processing - top level group set              *
      *   G#SHDR - Header (simple)                                    *
      *   BRANCH - Branch Details (Simple)                            *
      *   ACCNT  - Account Details (Simple)                           *
      *   CUST   - Customer Details (Simple)                          *
      *   CCYGS  - Currency Details (Simple)                          *
      *   G#SPS1 - Posting group set 1 (complex)                      *
      *   G#SRC1 - Debit Rate change group set 1 (complex)            *
      *   G#SCC1 - Credit Rate change group set 1 (complex)           *
      *   G#SFTR - Footer (simple)                                    *
      *   SRNSTD - Calculate Next Statement Date                      *
      *   G#SOPB - Opening balance (simple)                           *
      *   G#SPS2 - Posting group set 2 (complex)                      *
      *   SRFLDT - Find First and Last Posting Date                   *
      *   SRCCLR - Calculate Clearing Amounts                         *
      *   G#SCLR - Cleared Balances Open/Closing (simple)             *
      *   G#SCLB - Closing balance (simple)                           *
      *   G#SBRK - Item/Value Breakdown (simple)                      *
      *   G#SRC2 - Debit Rate change group set 2 (simple)             *
      *   G#SCC2 - Credit Rate change group set 2 (simple)            *
      *   G#SPS3 - Posting group set 3 (simple)                       *
      *   SRGENR - Generate reference record                          *
      *   SRRRDE - Retrieve RDE information for RDE in group set      *
      *   SRADTA - Accumulate RDEs & associated data for Output       *
      *   SRRFMN - Reformat RDE data                                  *
      *   SRODTA - Output Accumulated Data to PF/CGUDTAPD             *
      *   SRDCDT - Determine Currency Details                         *
      *   SRINIT - Initial processing - On First Call                 *
      *   SRINZ  - Initialise Fields on Each Invocation               *
      *   *PSSR  - Exception/Error Handling                           *
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRINZ  - Initialise Fields on Each Invocation  *
      *                G#STMT - Main Processing - Top Level Group Set *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           W0RTN
     C                     PARM           W0CMT   3
     C                     PARM           SDAT    50                                          261705
     C                     PARM           EDAT    50                                          261705
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      ** Read account details
     C                     READ CGSTMTL1                 75
     C           *IN75     IFEQ *OFF
     C                     MOVE SDCNUM    ##CNUM
     C                     MOVE SDCCY     ##CCY
     C                     MOVE SDACOD    ##ACOD
     C                     MOVE SDACSQ    ##ACSQ
     C                     MOVE SDBRCA    ##BRCA
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      **  Initialisation processing
     C                     EXSR SRINZ
      *
      **  Main processing - top level group set
     C                     EXSR G#STMT
      *
     C                     ENDIF
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#STMT                                         *
      * Function    :  Main processing - top level group set          *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  SRGENR - Generate reference record             *
      *                G#SHDR - Header (simple)                       *
      *                BRANCH - Branch Details (simple)               *
      *                ACCNT  - Account Details (simple)              *
      *                CUST   - Customer Details (simple)             *
      *                CCYGS  - Currency Details (simple)             *
      *                G#SPS1 - Posting group set 1 (complex)         *
      *                G#SRC1 - Rate change group set 1 (complex)     *
      *                G#SFTR - Footer (simple)                       *
      *                SRNSTD - Calculate Next Statement Date         *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#STMT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'g_STMT'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_STMT' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Determine whether the Statement is due...
     C                     MOVE *BLANK    ##PROC  1
     C                     MOVE *BLANK    ##DEMA  1
     C                     MOVE *BLANK    ##MANA  1
     C                     MOVE *BLANK    SDMSFL
      *
      **  ... If the Next Statement Date is before the Date of Next
      **      Working Day.
     C           SDNSTD    IFLT BJDNWD
     C                     MOVE 'Y'       ##PROC
     C                     ENDIF
      *
      **  ... If a Demand Statement has been requested.
     C           ##PROC    IFNE 'Y'
     C                     MOVE *OFF      *IN70
     C                     TESTB'1'       SDGLBT         70
     C           *IN70     IFEQ *ON
     C                     MOVE 'Y'       ##DEMA
     C                     MOVE 'D'       SDMSFL
     C                     MOVE 'Y'       ##PROC
     C                     ENDIF
     C                     ENDIF
      *
      **  ... If a Management Statement has been requested.
     C           ##PROC    IFNE 'Y'
     C                     MOVE *OFF      *IN70
     C                     TESTB'0'       SDGLBT         70
     C           *IN70     IFEQ *ON
     C                     MOVE 'Y'       ##MANA
     C                     MOVE 'M'       SDMSFL
     C                     MOVE 'Y'       ##PROC
     C                     ENDIF
     C                     ENDIF
      *
      **  If the Statement is due, continue processing
     C           ##PROC    IFEQ 'Y'
      *
      **  Generate reference number by writing to PF/CGUDCRPD
      **  If the statement is to be produced, then produce it
      *
     C                     EXSR SRGENR
     C           ##PROC    IFEQ 'Y'
     C                     EXSR PSHGRS
      *
      **  Header (simple)
     C                     EXSR G#SHDR
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Branch Details (simple)
     C                     EXSR BRANCH
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Account Details (simple)
     C                     EXSR ACCNT
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Customer Details (simple)
     C                     EXSR CUST
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
     C/COPY WNCPYSRC,CG4510C024
      *
      ** Counterparty Account Officer Details
     C                     EXSR ACOF
     C           1         OCUR ##SRDT                      1
     C                     MOVEL##SPAT    S#PATH            1
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Currency Details (simple)
     C                     EXSR CCYGS
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C/COPY WNCPYSRC,CGH00007
     C                     Z-ADD##TBIN    S#TBIN
      *
     C/COPY WNCPYSRC,CG4510C003
      *                                                                                       CER038
      ** If CER038 is installed                                                               CER038
      *                                                                                       CER038
     C           CER038    IFEQ 'Y'                                                           CER038
      *                                                                                       CER038
      ** Open Correspondent file                                                              CER038
      *                                                                                       CER038
     C                     OPEN CGCORRL4                                                      CER038
     C                     MOVE BRCA      WBRNCH                                              CER038
      *                                                                                       CER038
      ** Extract new Fields                                                                   CER038
      *                                                                                       CER038
     C                     EXSR CGACBR                                                        CER038
     C           1         OCUR ##SRDT                                                        CER038
     C                     MOVEL##SPAT    S#PATH                                              CER038
     C                     Z-ADD##PBIN    S#PBIN                                              CER038
     C                     Z-ADD##TBIN    S#TBIN                                              CER038
      *                                                                                       CER038
      ** Close Correspondent file                                                             CER038
      *                                                                                       CER038
     C                     CLOSECGCORRL4                                                      CER038
      *                                                                                       CER038
     C                     ENDIF                                                              CER038
      *                                                                                       CER038
     C********** CER031    IFEQ 'Y'                                                  CER038 BUG23277
     C**********           EXSR PSNARR                                               CER038 BUG23277
     C********** 1         OCUR ##SRDT                                               CER038 BUG23277
     C**********           MOVEL##SPAT    S#PATH                                     CER038 BUG23277
     C**********           MOVEL##PBIN    S#PBIN                                     CER038 BUG23277
     C**********           MOVEL##TBIN    S#TBIN                                     CER038 BUG23277
     C**********           ENDIF                                                     CER038 BUG23277
      *                                                                                       CER038
      **  Posting Group Set 1 (complex)
      *
      **  Increment Bind Levels for Complex Set only
     C                     Z-ADD##TBIN    S#PBIN
     C                     ADD  1         ##BNDC
     C                     Z-ADD##BNDC    S#TBIN
     C                     EXSR G#SPS1
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Debit Rate Change Group Set 1 (complex)
     C/COPY WNCPYSRC,CG4510C033
     C                     EXSR G#SRC1
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Credit Rate Change Group Set 1 (complex)
     C                     EXSR G#SCC1
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
     C/COPY WNCPYSRC,CG4510C034
      *
      **  Footer (simple)
     C                     EXSR G#SFTR
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Set up return parameters according to Statement Mode ...
      **  ... Initialise with input values.
     C                     Z-ADDSDLSTD    SDULSD
     C                     Z-ADDSDNSTD    SDUNXD
     C                     Z-ADDSDLSTP    SDULSP
     C                     Z-ADDSDCFSB    SDUCFB
     C                     Z-ADDSDYTDB    SDUYTD
     C                     MOVE SDGLBT    SDUGLB
      *
      **  ... Normal Mode - Next Statement Date before Date of Next
      **      Working Day.
      **  ... Demand Mode
      **  ... (Management Mode or no statement - no update)
     C           ##PROC    IFEQ 'Y'
     C           SDMSFL    ANDNE'M'
      *
      **  Set up Last Statement Date.
     C                     Z-ADDBJRDNB    SDULSD
      *
      **  Set up Next Statement Date (Only for 'Normal' Mode)
     C           SDMSFL    IFEQ *BLANK
     C                     EXSR SRNSTD
     C                     Z-ADD##NSTD    SDUNXD
     C                     ENDIF
      *
      **  Set up Last Page Number
     C                     Z-ADD##LSTT    SDULSP
      *
      **  Set up Carried Forward Statement Balance
     C                     Z-ADD##CFB     SDUCFB
      *
      **  Set up Carried Forward Cleared Balance
     C                     Z-ADD##CFCB    SDUYTD
      *
     C                     EXSR POPGRS
     C                     ENDIF
      *
      **  Reset the Management and Demand Statement Bits in all cases.
     C                     BITOF'01'      SDUGLB
      *
      *................................................................
      *
     C           EXSTMT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SHDR                                         *
      * Function    :  Header (simple)                                *
      *                 - Extract RDEs for statement header           *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                AOACCTR0 - Obtain Account Details              *
      *****************************************************************
     C           G#SHDR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SHDR'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           2         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SHDR' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDEs in group set
     C                     MOVEL'g_SHDR'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Access account details (LF/ACCNT)
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY    '##OPTN
     C                     PARM *BLANKS   ##RETL 10
     C                     PARM SDCNUM    ##CNUM
     C                     PARM SDCCY     ##CCY
     C                     PARM SDACOD    ##ACOD
     C                     PARM SDACSQ    ##ACSQ
     C                     PARM SDBRCA    ##BRCA
     C           SDACCT    PARM SDACCT    DSSDY
      *
      **  If account master record not found, database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'AOACCTR0'W0FILE
     C                     MOVEL##ACI2    ##WK18 24
     C                     MOVE ##BRCA    ##WK18
     C                     MOVEL##WK18    W0KEY            ***************
     C                     Z-ADD1         W0ERNB           * DB ERROR 01 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      **  Set up Statement Date
     C                     MOVELBJRDNB    ##D,1
      *
      **  Set up Last Statement Date
     C                     MOVELLSTDAB    ##D,2
      *
      **  Set up Statement Number
     C           SDLSTP    ADD  1         ##LSTT
     C                     MOVEL##LSTT    ##D,3
     C                     MOVE '0'       ##D,3
      *
      **  Set up Demand Statement Indicator
     C                     MOVEL##DEMA    ##D,4
      *
      **  Set up Management Statement Indicator
     C                     MOVEL##MANA    ##D,5
      *                                                                                       261705
      ** Set up Requested Start Date                                                          261705
      *                                                                                       261705
     C                     MOVELSDAT      ##D,6                                               261705
      *                                                                                       261705
      ** Set up Requested End Date                                                            261705
      *                                                                                       261705
     C                     MOVELEDAT      ##D,7                                               261705
      *                                                                                       261705
     C/COPY WNCPYSRC,CG4510C025
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSHDR    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/COPY WNCPYSRC,CG4510C001
     C/COPY CGCPYSRC,CGACBR                                                                   CER038
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  BRANCH                                         *
      * Function    :  Branch Details (Simple)                        *
      *                - Obtain Branch Details                        *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                AOBRCHR0 - Obtain Branch Details               *
      *****************************************************************
     C           BRANCH    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'BRANCH'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           3         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\BRANCH' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'BRANCH'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Get Branch Details if the Branch has changed
     C           SDBRCA    IFNE ##BRCD
     C                     CALL 'AOBRCHR1'
     C                     PARM '*MSG    '##RTCD
     C                     PARM '*KEY    '##OPTN
     C                     PARM SDBRCA    ##BRCD
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      **  Database Error
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELSDBRCA    W0KEY            ***************
     C                     Z-ADD2         W0ERNB           * DB ERROR 02 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C/COPY WNCPYSRC,CG4510C014
     C                     ENDIF
      *
      **  Set up Branch Code
     C                     MOVELA8BRCD    ##D,1
      *
      **  Set up Branch Name
     C                     MOVELA8BRNM    ##D,2
     C/COPY WNCPYSRC,CG4510C015
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXBRCH    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  ACCNT                                          *
      * Function    :  Account Details (Simple)                       *
      *                - Obtain Account Details                       *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           ACCNT     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'ACCNT '  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           4         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\ACCNT ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'ACCNT '  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  If the Account is Retail, access the Retail Interest and
      **  Charges on Accounts file, LF/REIACD
     C                     MOVEL##ACI2    ##ACID 24
     C                     MOVE ##BRCA    ##ACID
     C           SDATYP    IFEQ 'R'
     C           ##REKY    CHAINREIAC                51
      *
      **  If record not found, database error
     C           *IN51     IFEQ *ON
     C                     MOVEL'REIAC   'W0FILE
     C                     MOVEL##ACID    W0KEY            ***************
     C                     Z-ADD3         W0ERNB           * DB ERROR 03 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      **  Set up Account Identifier
     C                     MOVEL##ACID    ##D,1
      *
      **  Set up Retail Account Number
     C           ACNO      IFNE *ZEROS
     C                     MOVELACNO      ##D,2
     C                     ENDIF
      *
      **  Set up Account Name
     C                     MOVELANAM      ##D,3
      *
      **  Set up Account Type
     C                     MOVELSDATYP    ##D,4
     C/COPY WNCPYSRC,CG4510C027
      *
     C           CEU013    IFEQ 'Y'
      **  Set up Statement Balances in Euros Indicator
     C                     MOVELEUSB      ##D,5
     C                     ENDIF
      *
      ** Set up International Bank Account Number (IBAN)
      *
     C           CFT004    IFEQ 'Y'
     C                     MOVE *BLANKS   PIWITH
     C           IBAN      IFNE *BLANKS
     C                     CALL 'AOIBANR3'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM IBAN      PIBAN  47
     C                     PARM           PIWITH 47
     C                     PARM *BLANKS   PINOBL 34
     C                     ENDIF
     C                     MOVELPIWITH    ##D,6
     C                     ENDIF
     C/COPY WNCPYSRC,CG4510C009
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXACCN    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  CUST                                           *
      * Function    :  Customer Details (Simple)                      *
      *                - Obtain Customer Details                      *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *                AOCUSTR0 - Obtain Customer Details             *
      *****************************************************************
     C           CUST      BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CUST  '  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           5         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\CUST  ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'CUST  '  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Access Customer Details if the Customer has changed.
      **  (LF/SDCUSTL1)
     C********** ##CNMA    IFNE BBCUST                                                     AR1049758
     C           ##CNUM    IFNE BBCUST                                                     AR1049758
     C                     MOVE *BLANKS   ##KEY1
     C                     MOVE SDCNUM    ##KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  If not found, Database Error.
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELSDCNUM    W0KEY            ***************
     C                     Z-ADD4         W0ERNB           * DB ERROR 04 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      **  Set up Customer Number
     C                     MOVELBBCUST    ##D,1
      *
      **  Set up Customer Name
     C                     MOVELBBCRNM    ##D,2
      *
      **  Set up Customer Address Line 1
     C                     MOVELBBCNA1    ##D,3
      *
      **  Set up Customer Address Line 2
     C                     MOVELBBCNA2    ##D,4
      *
      **  Set up Customer Address Line 3
     C                     MOVELBBCNA3    ##D,5
      *
      **  Set up Customer Address Line 4
     C                     MOVELBBCNA4    ##D,6
      *
      ** Customer Town
     C                     MOVELBBCRTN    ##D,7
      *
     C/COPY WNCPYSRC,CG4510C016
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXCUST    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      * Subroutine  :  ACOF                                           *
      * Function    :  Account Officer Details                        *
      *                                                               *
      * Called by   :  SRRMDR - Common Group Set Routine              *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           ACOF      BEGSR
      *
      **  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'ACOF  '  @STK,Q
      *
      **  Retrieve subroutine specific data.
      *
     C           20        OCUR ##SRDT
      *
      **  Set up Path.
      *
     C                     MOVEL'\ACOF  ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
      *
     C                     MOVEL'ACOF  '  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Do not process if Account Officer blank.
     C           BBACOC    IFEQ *BLANKS
     C                     GOTO EXACOF
     C                     ENDIF
      *
      **  Account Officer details
     C           BBACOC    CHAINSDACOFL0             50
      *
      **  Account Officer details not found
     C           *IN50     IFEQ '1'
     C                     GOTO EXACOF
     C                     END
      *
      **  Account Officer Code
     C                     MOVELAZACOC    ##D,1
      *
      **  Account Officer Dept
     C                     MOVELAZDPCD    ##D,2
      *
      **  Account Officer Name
     C                     MOVELAZACON    ##D,3
      *
      **  Account Officer Telephone Number
     C                     MOVELAZAPHN    ##D,4
      *
      **  Account Officer Telephone Extension
     C                     MOVELAZAEXT    ##D,5
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
      **  Unwind subroutine stack name
      *
     C           EXACOF    TAG
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  CCYGS                                          *
      * Function    :  Currency Details (Simple)                      *
      *                - Obtain Customer Details                      *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRDCDT - Determine Currency Details            *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           CCYGS     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CCYGS '  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           6         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\CCY   ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'CCY   '  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Determine Currency Details
     C                     MOVE ##CCY     CCYDS   3
     C                     EXSR SRDCDT
      *
      **  Set up Currency Code
     C                     MOVELA6CYCD    ##D,1
      *
      **  Set up Currency Description
     C                     MOVELA6CYNM    ##D,2
      *
      **  Set up Precious metal indicator
     C                     MOVELA6PMRT    ##D,3
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXCCY     TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SPS1                                         *
      * Function    :  Posting group set 1 (complex)                  *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  G#SOPB - Opening balance (simple)              *
      *                G#SPS2 - Posting group set 2 (complex)         *
      *                G#SCLR - Cleared Balances Open/Closing (simple)*
      *                G#SCLB - Closing balance (simple)              *
      *                G#SBRK - Item/Value Breakdown (simple)         *
      *****************************************************************
     C           G#SPS1    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SPS1'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           7         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SPS1' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Call subroutine for Opening Balance (simple)
     C                     EXSR G#SOPB
     C           7         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Call subroutine for Posting Group Set 2 (complex)
     C                     EXSR G#SPS2
     C           7         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Call subroutine for Cleared Balances Open/Closing (simple)
     C                     EXSR G#SCLR
     C           7         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Call subroutine for Closing Balance (simple)
     C                     EXSR G#SCLB
     C           7         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      **  Call subroutine for Item/Val. Breakdown (simple)
     C                     EXSR G#SBRK
     C           7         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
      *................................................................
      *
     C           EXSPS1    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SRC1                                         *
      * Function    :  Debit Rate change group set 1 (complex)        *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  G#SRC2 - Debit Rate Change Group Set 2 (simple)*
      *****************************************************************
     C           G#SRC1    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SRC1'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           8         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SRC1' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Initialise the First/Last/Subsequent Flag.
     C                     MOVE 'FR'      ##FSLI
      *
      **  Position the Postings file before the first posting for this
      **  Account, starting on the Last Statement Date, and find the
      **  first record with matching key.
      **  (NOTE: not Account Postings)
     C                     Z-ADDSDLSTD    ##PSTD
     C           ##ACDK    SETGTAPOSTRAF
     C           ##ACKY    READEAPOSTRAF                 55
      *
      **  For each posting...
     C           *IN55     DOWEQ*OFF
      *
      **  If the Posting Date is between the Last Statement Date and
      **  the Current Statement Date and is a Debit Change ...
      *
      **  Or if the Posting Date is on the Last Statement Date and the
      **  Last Statement Date matches the Date Account Opened and the
      **  Last Page Number is zero (ie Posting not processed) and is
      **  a Debit Change ...
      *
      **  ... process the posting further.
     C           PSTD      IFGT SDLSTD
     C           PSTD      ANDLEBJRDNB
     C           DRCR      ANDEQ*ZEROS
      *
     C           PSTD      OREQ SDLSTD
     C           DACO      ANDEQSDLSTD
     C           SDLSTP    ANDEQ*ZEROS
     C           DRCR      ANDEQ*ZEROS
      *
      **  If the Debit Interest Calculation Type is '00' ...
      *
      **  ... Process Posting Group Set 3 (simple)
     C           DICT      IFEQ *ZEROS
      *
      **  If data has been formatted but not written, process it.
      **  (Note that this will not execute on first pass through SR and
      **   that data relates to previous record to be extracted read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
      **  Set the First/Last/Subsequent Flag for Subsequent runs.
     C                     MOVE 'SU'      ##FSLI
      *
     C                     ENDIF
      *
      **  Increment Bind Levels.
     C                     Z-ADD##TBIN    S#PBIN
     C                     ADD  1         ##BNDC
     C                     Z-ADD##BNDC    S#TBIN
      *
     C                     EXSR G#SRC2
      *
     C           8         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
     C                     ENDIF
     C                     ENDIF
      *
      **  Read next posting for account
     C           ##ACKY    READEAPOSTRAF                 55
      *
     C                     ENDDO
      *
      **  If data has been formatted but not written, process it.
      **  (Note that data relates to previous read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  The last record has been processed - set the First/Last/Subs
      **  Flag accordingly.
     C                     MOVE 'LA'      DEFSLI
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
     C                     ENDIF
      *
      *................................................................
      *
     C           EXSRC1    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SCC1                                         *
      * Function    :  Credit Rate change group set 1 (complex)       *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  G#SCC2 - Credit Rate Change Grp Set 2 (simple) *
      *****************************************************************
     C           G#SCC1    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SCC1'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           9         OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SCC1' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Initialise the First/Last/Subsequent Flag.
     C                     MOVE 'FR'      ##FSLI
      *
      **  Position the Postings file before the first posting for this
      **  Account, starting on the Last Statement Date, and find the
      **  first record with matching key.
      **  (NOTE: not Account Postings)
     C                     Z-ADDSDLSTD    ##PSTD
     C           ##ACDK    SETGTAPOSTRAF
     C           ##ACKY    READEAPOSTRAF                 55
      *
      **  For each posting...
     C           *IN55     DOWEQ*OFF
      *
      **  If the Posting Date is between the Last Statement Date and
      **  the Current Statement Date and is a Credit Change ...
      *
      **  Or if the Posting Date is on the Last Statement Date and the
      **  Last Statement Date matches the Date Account Opened and the
      **  Last Page Number is zero (ie Posting not processed) and is
      **  a Credit Change ...
      *
      **  ... process the posting further.
     C           PSTD      IFGT SDLSTD
     C           PSTD      ANDLEBJRDNB
     C           DRCR      ANDEQ1
      *
     C           PSTD      OREQ SDLSTD
     C           DACO      ANDEQSDLSTD
     C           SDLSTP    ANDEQ*ZEROS
     C           DRCR      ANDEQ1
      *
      **  If the Credit Interest Calculation Type is '00' ...
      *
      **  ... Process Posting Group Set 3 (simple)
     C           CICT      IFEQ *ZEROS
      *
      **  If data has been formatted but not written, process it.
      **  (Note that this will not execute on first pass through SR and
      **   that data relates to previous record to be extracted read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
      **  Set the First/Last/Subsequent Flag for Subsequent runs.
     C                     MOVE 'SU'      ##FSLI
      *
     C                     ENDIF
      *
      **  Increment Bind Levels.
     C                     Z-ADD##TBIN    S#PBIN
     C                     ADD  1         ##BNDC
     C                     Z-ADD##BNDC    S#TBIN
      *
     C                     EXSR G#SCC2
      *
     C           9         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
      *
     C                     ENDIF
     C                     ENDIF
      *
      **  Read next posting for account
     C           ##ACKY    READEAPOSTRAF                 55
      *
     C                     ENDDO
      *
      **  If data has been formatted but not written, process it.
      **  (Note that data relates to previous read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  The last record has been processed - set the First/Last/Subs
      **  Flag accordingly.
     C                     MOVE 'LA'      DEFSLI
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
     C                     ENDIF
      *
      *................................................................
      *
     C           EXSCC1    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SFTR                                         *
      * Function    :  Footer (simple)                                *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  -                                              *
      *****************************************************************
     C           G#SFTR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SFTR'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           10        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SFTR' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
     C/COPY WNCPYSRC,CG4510C017
      *
      *................................................................
      *
      ** Extract RDEs for footer
      *
      **  Retrieve RDE information for RDEs in group set
     C                     MOVEL'g_SFTR'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
     C*  Check if part of group account hierarchy
      *
     C           CRE008    IFEQ 'Y'
     C           ##REKY    CHAINREGAHLJ2             80
     C           *IN80     IFEQ '1'
     C                     MOVELWCMTX1    ##D,1
     C                     MOVELWCMTX2    ##D,2
     C                     MOVELWCMTX3    ##D,3
     C                     MOVELWCMTX4    ##D,4
     C                     ENDIF
     C                     ENDIF
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *................................................................
      *
     C           EXSFTR    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRNSTD                                         *
      * Function    :  Calculate Next Statement Date                  *
      *                                                               *
      * Called by   :  G#STMT - Top level group set                   *
      * Calls       :  SRERR  - Database Error                        *
      *                CG99FREQ - Frequency Processing                *
      *****************************************************************
     C           SRNSTD    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRNSTD'  @STK,Q
      *
      *................................................................
      *
      **  If the Statement Frequency is 'E' - Turnover - set up the
      **  data according to whether the extract is for 'Turnover' or
      **  'Normal' mode.
     C           STFQ      IFEQ 'E'
     C           SDPSTP    IFEQ C#NORM
     C                     MOVE 'M'       STFQ
     C                     ELSE
     C                     MOVE 'D'       STFQ
     C                     Z-ADDBJRDNB    SDNSTD
     C                     ENDIF
     C                     ENDIF
      *
      **  If the Statement Frequency is 'Z' - On Demand - set the
      **  Next Statement Date to zero.
     C           STFQ      IFEQ 'Z'
     C                     Z-ADD*ZEROS    ##NSTD
      *
      **  If the Statement Frequency is any other value, calculate the
      **  Next Statement Date.
     C                     ELSE
      *
      **  If the Statement Frequency is 'A' - Accrual Profit/End of
      **  Period, set the Next Statement Date to the current value
      **  of the Accrual/Profit Date.
     C           STFQ      IFEQ 'A'
     C                     Z-ADDBKAPDT    ##NSTD
     C                     MOVELBKAPFQ    W0FREQ
     C                     Z-ADDBKAPFD    W0MDAY
      *
      **  Otherwise initialise the Next Statement Date to the Current
      **  value.
     C                     ELSE
     C                     Z-ADDSDNSTD    ##NSTD
     C                     MOVELSTFQ      W0FREQ
     C                     Z-ADDSTDY      W0MDAY
     C/COPY WNCPYSRC,CG4510C078
     C                     ENDIF
      *
      **  Set up static parameters.
     C                     MOVE BJLCCY    W0CCY
     C                     MOVE BJSLCD    W0LOC
      *
      **  Keep calculating the Next Statement Date until a value
      **  not less than the Date of Next Working Day is found.
     C           ##NSTD    DOWLTBJDNWD
     C                     Z-ADD##NSTD    W0RDNB
      *
     C                     CALL 'CG99FREQ'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*NEWDATE'W0ACT   8
     C                     PARM           W0FREQ 10
     C                     PARM           W0RDNB  50
     C                     PARM           W0MDAY  20
     C                     PARM           W0CCY   3
     C                     PARM           W0LOC   3
     C                     PARM           W0EXT 256
      *
      **  Error in called program.
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG99FREQ'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 05 *
     C                     Z-ADD5         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADDW0RDNB    ##NSTD
      *
     C                     ENDDO
      *
     C                     ENDIF
      *
      *................................................................
      *
     C           EXNSTD    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SOPB                                         *
      * Function    :  Opening balance (simple)                       *
      *                                                               *
      * Called by   :  G#SPS1 - Posting group set 1                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
      *
     C           G#SOPB    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SOPB'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           11        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SOPB' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SOPB'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
      **  Set up B/Fwd Balance
     C/COPY WNCPYSRC,CG4510C048
     C                     MOVELSDCFSB    ##D,1
     C/COPY WNCPYSRC,CG4510C049
     C                     MOVE A6NBDP    ##D,1
      *
      **  Set up B/Fwd Cleared Balance
     C/COPY WNCPYSRC,CG4510C050
     C                     MOVELSDYTDB    ##D,2
     C/COPY WNCPYSRC,CG4510C051
     C                     MOVE A6NBDP    ##D,2
      *
     C           CEU013    IFEQ 'Y'
     C           A6INCY    ANDEQ'Y'
     C           BJRDNB    ANDGEA6TPSD
     C           BKEURO    ANDNE*BLANKS
      **  Set up B/Fwd Balance (Euros)
     C                     Z-ADDSDCFSB    P@FRAM
     C                     MOVE A6CYCD    P@FRCY
     C                     MOVE BKEURO    P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,3
     C                     MOVE W#NBDP    ##D,3
      *
      **  Set up B/Fwd Cleared Balance (Euros)
     C                     Z-ADDSDYTDB    P@FRAM
     C                     MOVE A6CYCD    P@FRCY
     C                     MOVE BKEURO    P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,4
     C                     MOVE W#NBDP    ##D,4
     C                     ELSE
     C           CEU014    IFEQ 'Y'
     C                     MOVE *BLANKS   EQCY
     C           ##CCY     IFEQ BKEURO
      *
      ** Get Customer Details
      *
     C                     MOVELCNUM      ##KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCNUM      W0KEY            ***************
     C                     Z-ADD11        W0ERNB           * DB ERROR 11 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     MOVE BBDINC    EQCY
     C                     ENDIF
     C           EQCY      IFNE *BLANKS
      *
      ** Access Equivalent Currency Details
     C                     MOVE EQCY      CCYDS
     C                     EXSR SRDCDT
      *
     C                     Z-ADDSDCFSB    P@FRAM
     C                     MOVE ##CCY     P@FRCY
     C                     MOVE EQCY      P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,3
     C                     MOVE A6NBDP    ##D,3
      *
     C                     Z-ADDSDYTDB    P@FRAM
     C                     MOVE ##CCY     P@FRCY
     C                     MOVE EQCY      P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,4
     C                     MOVE A6NBDP    ##D,4
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,CG4510C012
      **  Initialise Account Balance
     C                     Z-ADDSDCFSB    ##ACBL
      *
      **  Initialise Cleared Balance
     C                     Z-ADDSDYTDB    ##CLBL
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSOPB    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SPS2                                         *
      * Function    :  Posting group set 2 (complex)                  *
      *                 - Read all postings for a/c and call          *
      *                   appropriate formatting subroutine           *
      *                                                               *
      * Called by   :  G#SPS1 - Posting group set 1                   *
      * Calls       :  G#SPS3 - Posting group set 3 (simple)          *
      *                SRCCLR - Calculate Cleared Amounts             *
      *****************************************************************
     C           G#SPS2    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SPS2'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           12        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SPS2' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Initialise the First/Last/Subsequent Flag.
     C                     MOVE 'FR'      ##FSLI
      *
      **  Find the Posting Date of the First and Last Posting for this
      **  Statement.
     C                     EXSR SRFLDT
      *
      **  Position the Postings file before the first posting for this
      **  Account, and find the first record with matching key.
      **  (NOTE: not Rate Change Postings)
     C/COPY WNCPYSRC,CG4510C035
     C********** ##ACKY    SETLLAPOSTPDF                                                      259159
     C********** ##ACKY    READEAPOSTPDF                 55                                   259159
     C           ##ACKY    SETLLGLSTMTP2                                                      259159
     C           ##ACKY    READEGLSTMTP2                 55                                   259159
     C/COPY WNCPYSRC,CG4510C028
      *
      **  For each posting...
     C           *IN55     DOWEQ*OFF
      *
      **  Calculate Cleared Amounts.
     C                     EXSR SRCCLR
      *
      **  If the Posting Date is between the Last Statement Date and
      **  the Current Statement Date ...
      *
      **  Or if the Posting Date is on the Last Statement Date and the
      **  Last Statement Date matches the Date Account Opened and the
      **  Last Page Number is zero ...
      *
      **  ... Posting Group Set 3 (simple)
     C           PSTD      IFGT SDLSTD
     C           PSTD      ANDLESDUNXD
      *
     C           PSTD      OREQ SDLSTD
     C           DACO      ANDEQSDLSTD
     C           SDLSTP    ANDEQ*ZEROS
      *
      **  If data has been formatted but not written, process it.
      **  (Note that this will not execute on first pass through SR and
      **   that data relates to previous record to be extracted read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
      **  Set the First/Last/Subsequent Flag for Subsequent runs.
     C                     MOVE 'SU'      ##FSLI
      *
     C                     ENDIF
      *
      **  Increment Bind Levels.
     C                     Z-ADD##TBIN    S#PBIN
     C                     ADD  1         ##BNDC
     C                     Z-ADD##BNDC    S#TBIN
     C/COPY WNCPYSRC,CG4510C004
      *
     C                     EXSR G#SPS3
      *
     C           12        OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C                     Z-ADD##PBIN    S#PBIN
     C                     Z-ADD##TBIN    S#TBIN
     C/COPY WNCPYSRC,CG4510C002
     C                     ENDIF
      *
      **  Read next posting for account
     C/COPY WNCPYSRC,CG4510C036
     C********** ##ACKY    READEAPOSTPDF                 55                                   259159
     C           ##ACKY    READEGLSTMTP2                 55                                   259159
     C/COPY WNCPYSRC,CG4510C029
      *
     C                     ENDDO
      *
      **  If data has been formatted but not written, process it.
      **  (Note that data relates to previous read.)
     C           ##RFMT    IFEQ 'Y'
      *
      **  The last record has been processed - set the First/Last/Subs
      **  Flag accordingly.
     C                     MOVE 'LA'      DEFSLI
      *
      **  Output the Data.
     C                     EXSR SRODTA
      *
     C                     ENDIF
      *
      *................................................................
      *
     C           EXSPS2    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRFLDT                                         *
      * Function    :  First and Last Posting Date                    *
      *                 - Obtain Posting Date of First and Last       *
      *                   Posting for Statement.                      *
      *                                                               *
      * Called by   :  G#SPS2 - Posting group set 2                   *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRFLDT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRFLDT'  @STK,Q
      *
      *................................................................
      *
      **  Initialise the First and Last Posting Dates to the Run Date
      **  in case no postings are to be output.
     C                     Z-ADDBJRDNB    ##FPDT
     C                     Z-ADDBJRDNB    ##LPDT
      *
      **  Position the Postings file before the first posting for this
      **  Account after the Last Statement Date, and find the first
      **  Posting to appear on the Statement.
      **  (NOTE: not Rate Change Postings)
     C                     Z-ADDSDLSTD    ##PSTD
     C********** ##ACDK    SETGTAPOSTPDF                                                      259159
     C********** ##ACKY    READEAPOSTPDF                 55                                   259159
     C           ##ACDK    SETGTGLSTMTP2                                                      259159
     C           ##ACKY    READEGLSTMTP2                 55                                   259159
     C/COPY WNCPYSRC,CG4510C030
      *
      **  If a record is found and the Posting will be included ...
      *
      **  ... save Posting Date.
     C           *IN55     IFEQ *OFF
     C           PSTD      ANDLEBJRDNB
     C                     Z-ADDPSTD      ##FPDT
     C                     ENDIF
     C                     Z-ADDSDUNXD    ##LPDT
      *
      **  Position the Postings file after the last posting for this
      **  Account to be included on the Statement and access that
      **  Posting.
      **  (NOTE: not Rate Change Postings)
     C                     Z-ADDBJRDNB    ##PSTD
     C********** ##ACDK    SETGTAPOSTPDF                                                      259159
     C********** ##ACKY    REDPEAPOSTPDF                 55                                   259159
     C           ##ACDK    SETGTGLSTMTP2                                                      259159
     C           ##ACKY    REDPEGLSTMTP2                 55                                   259159
     C/COPY WNCPYSRC,CG4510C031
      *
      **  If a record is found and the Posting will be included ...
      *
      **  ... save Posting Date.
     C           *IN55     IFEQ *OFF
     C           PSTD      ANDGTSDLSTD
     C                     Z-ADDPSTD      ##LPDT
     C                     ENDIF
      *
      *................................................................
      *
     C           EXFLDT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRCCLR                                         *
      * Function    :  Calculate Clearing Amounts                     *
      *                 - Find Amounts Clearing Before and After      *
      *                   extracted Posting                           *
      *                                                               *
      * Called by   :  G#SPS2 - Posting group set 2 (Complex)         *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRCCLR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRCCLR'  @STK,Q
      *
      *................................................................
      *
      **  If the Account is not Retail by-pass Cleared Balance Process.
     C           SDATYP    IFNE 'R'
     C                     GOTO EXCCLR
     C                     ENDIF
      *
      **  Find Amounts Clearing before the first posting but since the
      **  Last Statement Date.
      *
      **  If the Posting Date is not after the Last Statement Date and
      **     the Value Date is after the Last Statement Date but before
      **     the first Posting Date ...
     C           PSTD      IFLE SDLSTD
     C           VALD      ANDGTSDLSTD
     C           VALD      ANDLT##FPDT
      *
      **  ... total the Clearing Amounts.
     C           DRCR      IFEQ *ZEROS
     C                     ADD  PSTA      ##OCLD
     C                     ELSE
     C                     SUB  PSTA      ##OCLC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Find Amounts Clearing during the period for which postings
      **  exist.
      *
      **  If the Value Date is between the First Statement Date and the
      **  Last and the Posting is dated before Run Date...
     C           VALD      IFGE ##FPDT
     C           VALD      ANDLE##LPDT
     C           PSTD      ANDLEBJRDNB
      *
      **  ... total the Clearing Amounts.
     C           DRCR      IFEQ *ZEROS
     C                     ADD  PSTA      ##DCLD
     C                     ELSE
     C                     SUB  PSTA      ##DCLC
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Find Amounts Clearing after the period for which postings
      **  exist.
      *
      **  If the Value Date is after the Last Posting Date but before
      **     the Run Date, and the value Date is after the Posting Date
     C           VALD      IFGT ##LPDT
     C           VALD      ANDLEBJRDNB
     C           VALD      ANDGTPSTD
      *
      **  ... total the Clearing Amounts.
     C           DRCR      IFEQ *ZEROS
     C                     ADD  PSTA      ##CCLD
     C                     ELSE
     C                     SUB  PSTA      ##CCLC
     C                     ENDIF
      *
     C                     ENDIF
      *
      *................................................................
      *
     C           EXCCLR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SCLR                                         *
      * Function    :  Cleared Balances Open/Closing (simple)         *
      *                                                               *
      * Called by   :  G#SPS1 - Posting group set 1                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#SCLR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SCLR'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           13        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SCLR' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SCLR'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Set up Opening Cleared Amount - Credit
     C/COPY WNCPYSRC,CG4510C052
     C                     MOVEL##OCLC    ##D,1
     C/COPY WNCPYSRC,CG4510C053
     C                     MOVE A6NBDP    ##D,1
      *
      **  Set up Opening Cleared Amount - Debit
     C/COPY WNCPYSRC,CG4510C054
     C                     MOVEL##OCLD    ##D,2
     C/COPY WNCPYSRC,CG4510C055
     C                     MOVE A6NBDP    ##D,2
      *
      **  Set up Cleared Balance Before First Posting
     C           SDYTDB    ADD  ##OCLC    ##CFCB
     C                     ADD  ##OCLD    ##CFCB
     C/COPY WNCPYSRC,CG4510C056
     C                     MOVEL##CFCB    ##D,3
     C/COPY WNCPYSRC,CG4510C057
     C                     MOVE A6NBDP    ##D,3
      *
      **  Set up Cleared After Balance Last Posting
     C                     ADD  ##DCLC    ##CFCB
     C                     ADD  ##DCLD    ##CFCB
     C/COPY WNCPYSRC,CG4510C058
     C                     MOVEL##CFCB    ##D,4
     C/COPY WNCPYSRC,CG4510C059
     C                     MOVE A6NBDP    ##D,4
      *
      **  Set up Closing Cleared Amount - Credit
     C/COPY WNCPYSRC,CG4510C060
     C                     MOVEL##CCLC    ##D,5
     C/COPY WNCPYSRC,CG4510C061
     C                     MOVE A6NBDP    ##D,5
      *
      **  Set up Closing Cleared Amount - Debit
     C/COPY WNCPYSRC,CG4510C062
     C                     MOVEL##CCLD    ##D,6
     C/COPY WNCPYSRC,CG4510C063
     C                     MOVE A6NBDP    ##D,6
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSCLR    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SCLB                                         *
      * Function    :  Closing balance (simple)                       *
      *                                                               *
      * Called by   :  G#SPS1 - Posting group set 1                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#SCLB    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SCLB'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           15        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SCLB' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SCLB'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
      **  Set up C/Fwd Balance
     C                     Z-ADD##ACBL    ##CFB
     C/COPY WNCPYSRC,CG4510C064
     C                     MOVEL##CFB     ##D,1
     C/COPY WNCPYSRC,CG4510C065
     C                     MOVE A6NBDP    ##D,1
      *
      **  Set up C/Fwd Cleared Balance
     C                     ADD  ##CCLC    ##CFCB
     C                     ADD  ##CCLD    ##CFCB
     C/COPY WNCPYSRC,CG4510C066
     C                     MOVEL##CFCB    ##D,2
     C/COPY WNCPYSRC,CG4510C067
     C                     MOVE A6NBDP    ##D,2
      *
      ** If Currency is 'In', Date is within the transition period
      ** and Ccy code for Euro is not blank then set up B/Fwd Balances
      ** (Euros)
     C           CEU013    IFEQ 'Y'
     C           A6INCY    ANDEQ'Y'
     C           BJRDNB    ANDGEA6TPSD
     C           BKEURO    ANDNE*BLANKS
      **  Set up B/Fwd Balance (Euros)
     C                     Z-ADD##CFB     P@FRAM
     C                     MOVE A6CYCD    P@FRCY
     C                     MOVE BKEURO    P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,3
     C                     MOVE W#NBDP    ##D,3
      *
      **  Set up B/Fwd Cleared Balance (Euros)
     C                     Z-ADD##CFCB    P@FRAM
     C                     MOVE A6CYCD    P@FRCY
     C                     MOVE BKEURO    P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,4
     C                     MOVE W#NBDP    ##D,4
      *
     C                     ELSE
     C           CEU014    IFEQ 'Y'
     C                     MOVE *BLANKS   EQCY
     C           ##CCY     IFEQ BKEURO
      *
      ** Get Customer Details
      *
     C                     MOVELCNUM      ##KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCNUM      W0KEY            ***************
     C                     Z-ADD11        W0ERNB           * DB ERROR 11 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     MOVE BBDINC    EQCY
     C                     ENDIF
     C           EQCY      IFNE *BLANKS
      *
      ** Access Equivalent Currency Details
     C                     MOVE EQCY      CCYDS
     C                     EXSR SRDCDT
      *
     C                     Z-ADD##CFB     P@FRAM
     C                     MOVE ##CCY     P@FRCY
     C                     MOVE EQCY      P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,3
     C                     MOVE A6NBDP    ##D,3
      *
     C                     Z-ADD##CFCB    P@FRAM
     C                     MOVE ##CCY     P@FRCY
     C                     MOVE EQCY      P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,4
     C                     MOVE A6NBDP    ##D,4
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,CG4510C013
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSCLB    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SBRK                                         *
      * Function    :  Item/Value Breakdown (Simple)                  *
      *                                                               *
      * Called by   :  G#SPS1 - Posting group set 1                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#SBRK    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SBRK'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           15        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SBRK' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SBRK'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Set up Number of Entries - Credit
     C                     MOVEL##NOEC    ##D,1
     C                     MOVE '0'       ##D,1
      *
      **  Set up Value of Entries - Credit
     C/COPY WNCPYSRC,CG4510C068
     C                     MOVEL##VAEC    ##D,2
     C/COPY WNCPYSRC,CG4510C069
     C                     MOVE A6NBDP    ##D,2
      *
      **  Set up Number of Entries - Debit
     C                     MOVEL##NOED    ##D,3
     C                     MOVE '0'       ##D,3
      *
      **  Set up Value of Entries - Debit
     C/COPY WNCPYSRC,CG4510C070
     C                     MOVEL##VAED    ##D,4
     C/COPY WNCPYSRC,CG4510C071
     C                     MOVE A6NBDP    ##D,4
      *
      **  Set up First/Subsequent/Last Indicator
     C                     MOVE 'FR'      ##FSLI
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXSBRK    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SRC2                                         *
      * Function    :  Debit Rate change group set 2 (simple)         *
      *                                                               *
      * Called by   :  G#SRC1 - Debit Rate change group set 1         *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#SRC2    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SRC2'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           16        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SRC2' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SRC2'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Set up Posting Date
     C                     MOVELPSTD      ##D,1
      *
      **  Set up Value Date
     C                     MOVELVALD      ##D,2
      *
      **  Set up Rate Change - Rate
     C                     MOVELINRT      ##D,3
      *
      **  Set up Debit/Credit Flag
     C                     MOVEL'D'       ##D,4
      *                                                                                       CRE073
      ** Set up Debit Interest Rate Rounding                                                  CRE073
      *                                                                                       CRE073
     C           CRE073    IFEQ 'Y'                                                           CRE073
      *                                                                                       CRE073
      ** Set up Debit Contractual Spread                                                      CRE073
      *                                                                                       CRE073
     C                     MOVELDCSP      ##D,5                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Contractual Spread Sign                                                 CRE073
      *                                                                                       CRE073
     C                     MOVELDCSG      ##D,6                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Rounding Method                                                         CRE073
      *                                                                                       CRE073
     C                     MOVELDRMT      ##D,7                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Rounding Fraction/Decimal                                               CRE073
      *                                                                                       CRE073
     C                     MOVELDRFD      ##D,8                                               CRE073
      *                                                                                       CRE073
     C                     ENDIF                                                              CRE073
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
      *
      *................................................................
      *
     C           EXSRC2    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SCC2                                         *
      * Function    :  Credit Rate change group set 2 (simple)        *
      *                                                               *
      * Called by   :  G#SRC1 - Credit Rate change group set 1        *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           G#SCC2    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SCC2'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           17        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SCC2' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SCC2'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      **  Set up Posting Date
     C                     MOVELPSTD      ##D,1
      *
      **  Set up Value Date
     C                     MOVELVALD      ##D,2
      *
      **  Set up Rate Change - Rate
     C                     MOVELINRT      ##D,3
      *
      **  Set up Debit/Credit Flag
     C                     MOVEL'C'       ##D,4
      *                                                                                       CRE073
      ** Set up Credit Interest Rate Rounding                                                 CRE073
      *                                                                                       CRE073
     C           CRE073    IFEQ 'Y'                                                           CRE073
      *                                                                                       CRE073
      ** Set up Debit Contractual Spread                                                      CRE073
      *                                                                                       CRE073
     C                     MOVELCCSP      ##D,5                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Contractual Spread Sign                                                 CRE073
      *                                                                                       CRE073
     C                     MOVELCCSG      ##D,6                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Rounding Method                                                         CRE073
      *                                                                                       CRE073
     C                     MOVELCRMT      ##D,7                                               CRE073
      *                                                                                       CRE073
      ** Set up Debit Rounding Fraction/Decimal                                               CRE073
      *                                                                                       CRE073
     C                     MOVELCRFD      ##D,8                                               CRE073
      *                                                                                       CRE073
     C                     ENDIF                                                              CRE073
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
      *
      *................................................................
      *
     C           EXSCC2    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  G#SPS3                                         *
      * Function    :  Posting group set 3 (simple)                   *
      *                                                               *
      * Called by   :  G#SPS2 - Posting group set 2                   *
      * Calls       :  SRRRDE - Retrieve RDE Information              *
      *                SRADTA - Format Extract Data                   *
      *                SRODTA - Output Extract Data                   *
      *                SRERR  - Database Error                        *
      *****************************************************************
      *
     C           G#SPS3    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'g_SPS3'  @STK,Q
      *
      **  Retrieve subroutine specific data.
     C           18        OCUR ##SRDT
      *
      **  Set up Path.
     C                     MOVEL'\g_SPS3' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
     C                     MOVELS#PATH    ##SPAT
      *
      **  Set up Binds from passed in values.
     C                     Z-ADDS#PBIN    ##PBIN
     C                     Z-ADDS#TBIN    ##TBIN
      *
      *................................................................
      *
      **  Retrieve RDE information for RDE's in Group Set
     C                     MOVEL'g_SPS3'  ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
     C/COPY WNCPYSRC,CG4510C010
      **  Update Account Ledger balance for Posting
     C           DRCR      IFEQ *ZEROS
     C                     ADD  PSTA      ##ACBL
     C                     ELSE
     C                     SUB  PSTA      ##ACBL
     C                     ENDIF
      *
      **  Update Item/Value Breakdown figures for Posting
     C           DRCR      IFEQ *ZEROS
     C                     ADD  1         ##NOED
     C                     ADD  PSTA      ##VAED
     C                     ELSE
     C                     ADD  1         ##NOEC
     C                     SUB  PSTA      ##VAEC
     C                     ENDIF
     C/COPY WNCPYSRC,CG4510C011
      *
      ** Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
      **  Set up Posting Date
     C                     MOVELPSTD      ##D,1
      *
      **  Set up Value Date
     C                     MOVELVALD      ##D,2
     C/COPY WNCPYSRC,CG4510C018
      *
      **  Set up Cheque Number
     C           CHQN      IFNE *ZEROS
     C                     MOVELCHQN      ##D,3
     C                     ENDIF
      *
      **  Set up Posting Narrative
     C/COPY WNCPYSRC,CG4510C019
     C                     MOVELPNAR      ##D,4
     C/COPY WNCPYSRC,CG4510C020
      *
      **  Set up Posting Amount
     C           DRCR      IFNE *ZEROS
     C                     Z-SUBPSTA      PSTA
     C                     ENDIF
     C                     Z-ADDPSTA      PSTAX
      *
     C/COPY WNCPYSRC,CG4510C072
     C                     MOVELPSTA      ##D,5
     C/COPY WNCPYSRC,CG4510C073
     C                     MOVE A6NBDP    ##D,5
      *
      **  Set up Posting - Generation Type
     C                     MOVELGETP      ##D,6
      *
      **  Set up Posting - Module ...
      **  ... use the Generation Type to retrieve the Module ID.
     C                     Z-ADD1         G       30
     C           GETP      LOKUP##GE,G                   60
     C           *IN60     IFEQ *OFF
     C                     MOVEL'  '      ##D,7
     C                     ELSE
     C                     MOVEL##MD,G    ##D,7
     C                     ENDIF
      *
      **  Set up Posting transaction Number ...
      **  ...If the Module is Dealing or Lending obtain the Transaction
      **     Number from DLREF.
     C           ##MD,G    IFEQ 'DL'
     C           *IN60     ANDEQ*ON
     C           ##MD,G    OREQ 'LE'
     C           *IN60     ANDEQ*ON
     C                     MOVEL##TREF    ##D,8
     C                     ENDIF
      *
      **  ... If the Module is Funds Transfer obtain the Transaction
      **      Number from PREF.
     C           ##MD,G    IFEQ 'FT'
     C           *IN60     ANDEQ*ON
     C                     MOVELPREF      ##D,8
     C                     ENDIF
      *
      **  ... If the Module is Securities obtain the Transaction
      **      Number from OTRF.
      *
     C           ##MD,G    IFEQ 'SE'
     C           *IN60     ANDEQ*ON
     C                     MOVELOTRF      ##D,8
     C                     ENDIF
      *                                                                                       CAP204
      **  ... If the Module is General Ledger obtain the Transaction                          CAP204
      **      Number from OTRF.                                                               CAP204
      *                                                                                       CAP204
     C           ##MD,G    IFEQ 'GL'                                                          CAP204
     C           GETP      ANDEQ'L'                                                           CAP204
     C           CAP204    ANDEQ'Y'                                                           CAP204
     C           *IN60     ANDEQ*ON                                                           CAP204
     C                     MOVELOTRF      ##D,8                                               CAP204
     C                     ENDIF                                                              CAP204
      *
      **  Set up Posting - Batch Number and Batch Item Number ...
      **  ... If Generated Entry Type blank, Posting relates to a Batch
     C           GETP      IFEQ *BLANK
     C                     MOVEL##BANO    ##D,9
     C                     MOVEL##BITM    ##D,10
     C                     ENDIF
      *
      **  Set up Account Balance
     C/COPY WNCPYSRC,CG4510C074
     C                     MOVEL##ACBL    ##D,11
     C/COPY WNCPYSRC,CG4510C075
     C                     MOVE A6NBDP    ##D,11
      *
     C/COPY WNCPYSRC,CG4510C026
     C           CEU013    IFEQ 'Y'
      **  Access the Account Postins Extension file. If a record is found
      **  set up elements 12 and 13 of group set g_SPS3.
     C           ##POST    CHAINGLAPSTPF             52
      *
     C           *IN52     IFEQ '0'
     C                     MOVELOCCY      ##D,12
      *reverse sign for credit
     C           DRCR      IFNE *ZEROS
     C                     Z-SUBOAMT      OAMT
     C                     ENDIF
     C                     MOVELOAMT      ##D,13
     C                     MOVELOAMT      ##D,13
      *
      ** Access Original Currency Details
     C                     MOVE OCCY      CCYDS
     C                     EXSR SRDCDT
     C/COPY WNCPYSRC,CG4510C076
      *
     C                     MOVE A6NBDP    ##D,13
      *
      **  Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
     C                     ENDIF
     C                     ENDIF
      *
     C/COPY WNCPYSRC,CG4510C037
     C           CEU014    IFEQ 'Y'
      *
      **  Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
     C                     MOVE *BLANKS   EQCY
     C           A6INCY    IFEQ 'Y'
     C                     MOVE BKEURO    EQCY
     C                     ENDIF
     C           ##CCY     IFEQ BKEURO
      *
      ** Get Customer Details
      *
     C                     MOVELCNUM      ##KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM           ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCNUM      W0KEY            ***************
     C                     Z-ADD11        W0ERNB           * DB ERROR 11 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     MOVE BBDINC    EQCY
     C                     ENDIF
     C           EQCY      IFNE *BLANKS
      *
      *
      *
      **  Access Equivalent Currency Details
     C                     MOVE EQCY      CCYDS
     C                     EXSR SRDCDT
      *
      **  Convert posting amt.into eq.ccy only if this information is not
      **  already available as original ccy.In that case,it can be
      **  retrieved from file GLAPSTP.
     C                     MOVEL*BLANKS   ##D,14
     C           EQCY      IFEQ OCCY
     C           OAMT      ANDNE0
     C           CEU013    ANDEQ'Y'
     C           ##POST    CHAINGLAPSTPF             52
     C           *IN52     IFEQ '0'
      *
      **  Reverse sign for credit
     C           DRCR      IFNE *ZEROS
     C                     Z-SUBOAMT      OAMT
     C                     ENDIF
      *
     C                     MOVELOAMT      ##D,14           ORIG.CCY AMNT
     C                     MOVE A6NBDP    ##D,14
     C                     ENDIF                           *IN52
     C                     ENDIF                           EQCY...
      *
      **  RDE POST_EQCY is still empty, then convert posting amount
     C           ##D,14    IFEQ *BLANKS
     C                     Z-ADDPSTAX     P@FRAM
     C                     MOVE ##CCY     P@FRCY
     C                     MOVE EQCY      P@TOCY
     C                     EXSR R@EURO
     C                     MOVEL##OUTA    ##D,14
     C                     MOVE A6NBDP    ##D,14
     C                     ENDIF
     C*
     C                     MOVELEQCY      ##D,15
     C                     MOVELA6CYNM    ##D,16
     C                     ENDIF
      *
      **  Access Posting Currency Details
     C                     MOVE ##CCY     CCYDS
     C                     EXSR SRDCDT
      *
     C                     ENDIF
     C*
     C*  Extract Originating Account if posting is GA replicated
     C           CRE008    IFEQ 'Y'
     C           XRFI      IFNE *BLANKS
     C           XRFN      ANDNE*ZERO
     C           ##POST    CHAINGLAPSGL0             80
     C           *IN80     IFEQ '0'
     C           AGSRNO    IFGT 0
     C                     MOVELSRCRET    ##D,17
     C                     ELSE
     C                     MOVELSRCGL     ##D,17
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C*
      **  Accumulate RDE's and associated data and output to                               BUG23277A
      **  PF/CGUDTAPD.                                                                     BUG23277A
     C                     EXSR SRADTA                                                     BUG23277A
      *                                                                                    BUG23277A
     C           CER031    IFEQ 'Y'                                                         BUG23277
     C           CER030    OREQ 'Y'                                                         BUG24460
     C                     EXSR PSNARR                                                      BUG23277
     C/COPY WNCPYSRC,CGH00012
     C           18        OCUR ##SRDT                                                      BUG23277
     C                     MOVEL##SPAT    S#PATH                                            BUG23277
     C                     MOVEL##PBIN    S#PBIN                                            BUG23277
     C                     MOVEL##TBIN    S#TBIN                                            BUG23277
     C                     ENDIF                                                            BUG23277
      *                                                                                     BUG23277
     C/COPY WNCPYSRC,CG4510C005
      **********                                                                           BUG23277A
      ****Accumulate RDE's and associated data and output to                               BUG23277A
      ****PF/CGUDTAPD.                                                                     BUG23277A
     C**********           EXSR SRADTA                                                     BUG23277A
      **********                                                                           BUG23277A
     C/COPY WNCPYSRC,CGH00002
      *................................................................
      *
     C           EXSPS3    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  R@EURO                                         *
      * Function    :  EURO Currency Conversion:                      *
      *                Converts P@FRAM in P@FRCY to ##OUTA in P@TOCY  *
      * Called by   :  G#SPS3                                         *
      *                                                               *
      * Calls       :  EU0200                                         *
      *                SRERR                                          *
      *****************************************************************
     C           R@EURO    BEGSR
      *
     C                     Z-ADD0         ##OUTA 130
     C                     CALL 'EU0200'
     C                     PARM *BLANKS   P@RTCD  7        Return Code
     C                     PARM           P@FRAM 183       FROM Ccy Amount
     C                     PARM           P@FRCY  3        FROM Currency
     C                     PARM           P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
      *
      ** Database error handling:
      *
     C           P@RTCD    IFEQ '*ERROR*'
     C                     MOVEL'EU0200  'W0FILE
     C                     MOVEL'*CALL   'W0KEY            ***************
     C                     Z-ADD12        W0ERNB           * DB ERROR 12 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
      *
      ** Otherwise, store amount in settlement currency as ##OUTA
      *
     C                     ELSE
     C                     MOVE P@OUTA    ##OUTA
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
     C/EJECT
      *****************************************************************
      * Subroutine  :  SRGENR                                         *
      * Function    :  Generate reference number                      *
      *                by writing to PF/CGUDCRPD                      *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :  CG9010 - Create reference record               *
      *****************************************************************
     C           SRGENR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRGENR'  @STK,Q
      *
      *................................................................
      *
      **  Generate reference number and check if further processing
      **  required. Set up all available information in the record
      **  format before calling.
      *
     C                     MOVELSDBRCA    DRBRCA
     C                     MOVELSDBRCA    DRORBR
     C                     MOVEL'GL'      DRMODI
     C                     CLEARDRMTRN
     C                     MOVEL##ACI2    DRMACT
     C                     MOVE ##BRCA    DRMACT
     C                     MOVELSDPTYP    DRPTYP
     C                     MOVELSDPSTP    DRPSTP
     C                     MOVEL'N'       DRATRM
     C/COPY WNCPYSRC,CG4510C023
      *
     C                     CALL 'CG9010'
     C                     PARM           ##RTCD  7
     C                     PARM '*GEN'    ##MODE 10
     C                     PARM W0CMT     ##CMT   3
     C**********           PARM ##CNMA    ##CUST  6                                        AR1049758
     C                     PARM ##CNUM    ##CUST  6                                        AR1049758
     C                     PARM           ##UDCR
     C                     PARM           ##ITMA  8
      *
      **  Blank return code implies generate correspondence.
      **  CGD1270 => no error, but suppress output for this transaction.
      *
     C           ##RTCD    IFNE *BLANK
      *
     C           ##RTCD    IFEQ 'CGD1270'
     C                     MOVE 'N'       ##PROC
     C                     ELSE
      *
     C                     MOVEL'CG9010  'W0FILE
     C                     MOVEL##RTCD    W0KEY            ***************
     C                     Z-ADD6         W0ERNB           * DB ERROR 06 *
     C                     MOVEL'CGD1286' W0MSGD           ***************
     C                     MOVEL'CGUSRMSG'W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ELSE
      *
      ** If CCG015 is on, wrap the extraction
      *
      ** Pass reference as printtype:subtype
      *
     C           DRPTYP    CAT  ':':0     COLON  11 P
     C           COLON     CAT  DRPSTP:0  ##REFR    P
     C                     EXSR WRAPRF
     C                     ENDIF
      *
      *................................................................
      *
     C           EXGENR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRRRDE                                         *
      * Function    :  Retrieve RDE information for RDEs in group set *
      *                                                               *
      * Called by   :  simple group set subroutines                   *
      * Calls       :  -                                              *
      *****************************************************************
     C           SRRRDE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRRDE'  @STK,Q
      *
      *................................................................
      *
      **  Reset
     C                     MOVEL*BLANK    ##R
     C                     MOVEL*BLANK    ##D
     C                     MOVEL*BLANK    ##S
      *
      **  Get information about next 20 RDEs in group set from compile
      **  time arrays
     C                     Z-ADD0         #1
     C           *IN99     DOUEQ'0'
     C/COPY WNCPYSRC,CG4510C038
     C           #1        OREQ 20
     C/COPY WNCPYSRC,CG4510C039
     C                     Z-ADD1         #2
     C           ##GRPX    LOKUP##GRP,#2                 99*
     C           *IN99     IFEQ '1'
     C                     ADD  1         #1
     C                     MOVEL##RDEA,#2 ##R,#1
     C                     ADD  1         ##RDEN
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRRDE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRADTA                                         *
      * Function    :  Accumulate RDEs and associated data for output *
      *                                                               *
      * Called by   :  simple group set subroutines                   *
      * Calls       :  CG3999 - Format and Pack Data                  *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRADTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRADTA'  @STK,Q
      *
      *................................................................
      *
      **  Reformat RDE data
      *
     C                     EXSR SRRFMN
      *
      **  Pack RDEs and associated data into data string
     C                     CLEAR##SDS
      *
     C           CCG015    IFEQ 'Y'
     C                     MOVE '*NEWARR 'W0ACT
     C                     MOVELS#PATH    W0SPAT
     C                     ELSE
     C                     MOVE '*PACK   'W0ACT
     C                     MOVEL*BLANKS   W0SPAT
     C                     ENDIF
      *
     C/COPY WNCPYSRC,CG4510C040
     C                     CALL 'CG3999'
     C/COPY WNCPYSRC,CG4510C041
     C                     PARM *BLANK    ##RTCD
     C                     PARM           W0ACT
     C                     PARM           ##R
     C                     PARM           ##D
     C                     PARM           ##S
     C                     PARM           W0SPAT 70
     C                     PARM           ##RN
     C                     PARM           ##DN
     C                     PARM           ##FM
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG3999  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 07 *
     C                     Z-ADD7         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Write a XML record for RDE
      *
     C                     EXSR WRTRDE
      *
      **  Initialise Write Format Parameter.
     C                     CLEARW0FMT
      *
      **  Set up Control Information.
     C                     Z-ADD##ITEM    DEITEM
     C                     ADD  1         ##OSEQ
     C                     Z-ADD##OSEQ    DEOSEQ
     C                     Z-ADD##PBIN    DEPBIN
     C                     Z-ADD##TBIN    DETBIN
     C                     MOVE ##FSLI    DEFSLI
     C                     MOVE *BLANKS   W0PATH
     C                     MOVELS#PATH    W0PATH
      *
      **  Append Data from pack routine.
     C           W0FMT     CAT  ##SDS:0   W0FMT
      *
      **  Set Flag to show record formatted
     C                     MOVE 'Y'       ##RFMT  1
      *
      *................................................................
      *
     C           EXADTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRFMN                                         *
      * Function    :  Reformat RDE data                              *
      *                                                               *
      * Called by   :  SRADTA                                         *
      * Calls       :                                                 *
      *****************************************************************
     C           SRRFMN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRFMN'  @STK,Q
      *
      *................................................................
      *
      ** Loop through RDE's and data
      *
     C                     Z-ADD0         #1
     C/COPY WNCPYSRC,CG4510C042
     C           #1        DOUEQ20
     C/COPY WNCPYSRC,CG4510C043
     C                     ADD  1         #1
     C                     MOVEL##R,#1    R#DEFN
     C                     MOVEL##D,#1    R#DATA
      *
      ** If data present and RDE is edited
      *
     C           R#DATA    IFNE *BLANK
     C           ##RDEC    ANDNE*BLANK
      *
      * Reformat Amount
     C                     Z-ADD1         #2
     C           *BLANK    LOKUP##NUMA,#2                99*
     C/COPY WNCPYSRC,CG4510C044
     C                     Z-ADD20        #3
     C/COPY WNCPYSRC,CG4510C045
     C                     Z-ADD0         ##WNUM
     C/COPY WNCPYSRC,CG4510C046
     C           #2        DOWGT1
     C           #2        ANDLE20
     C           #3        ANDGT1
     C/COPY WNCPYSRC,CG4510C047
     C                     SUB  1         #2
     C                     MOVEL##NUMA,#2 ##W,#3
     C                     SUB  1         #3
     C                     ENDDO
      *
      * Sign the amount
     C           ##SIGN    IFEQ '-'
     C                     Z-SUB##WNUM    ##NUMB
     C                     ELSE
     C                     Z-ADD##WNUM    ##NUMB
     C                     END
      *
      * Default Edit Type
     C           ##EDTT    IFEQ *BLANK
     C                     MOVEL##RDET    ##EDTT
     C                     END
      *
      * Default Decimal Places
     C           ##DCPA    IFEQ *BLANK
     C                     MOVEL##RDED    ##DCPA
     C                     END
      * New RDE data
     C                     MOVELR#DATA    ##D,#1
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRFMN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRODTA                                         *
      * Function    :  Output Accumulated data to PF/CGUDTAPD         *
      *                                                               *
      * Called by   :  simple group set subroutines                   *
      * Calls       :  CG9020 - Output Data to CGUDTAPD               *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRODTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRODTA'  @STK,Q
      *
      *................................................................
      *
      **  Output PF/CGUDTAPD Record.
      **  ONLY IF CCG015 IS OFF
     C           CCG015    IFEQ 'N'
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*WRITE  'W0ACT
     C                     PARM           W0PATH256
     C                     PARM           W0FMT
     C                     PARM *BLANK    W0TITL  7
     C                     PARM *BLANK    W0ULIN  7
     C                     PARM           W0CMT
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG9020  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 08 *
     C                     Z-ADD8         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      **  Reset Flag to show formatted data output.
     C                     MOVE *BLANKS   ##RFMT
      *
      *................................................................
      *
     C           EXODTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRDCDT                                         *
      * Function    :  Determine Currency Details                     *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           SRDCDT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRDCDT'  @STK,Q
      *
      *................................................................
      *
      **  Access array of Currency Details already loaded
     C                     Z-ADD1         C       30
     C           CCYDS     LOKUP##CY,C                   99
      *
      **  If no match is found determine the next free space in the
      **  loaded currency array.
     C           *IN99     IFEQ *OFF
     C                     Z-ADD1         C
     C           *BLANK    LOKUP##CY,C                   99
      *
      **  If no space is left, set the Currency Data data structure to
      **  the 101st occurrence so that when the new details are
      **  retrieved no existing details are overwritten.
     C           *IN99     IFEQ *OFF
     C           101       OCUR SDCURR
      *
      **  If a space is found, set up the new currency into the array
      **  and position the Currency Data data structure on the
      **  occurrence matching the array index.
     C                     ELSE
     C                     MOVE CCYDS     ##CY,C
     C           C         OCUR SDCURR
     C                     ENDIF
      *
      **  Retrieve the currency details.
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   ##RTCD           B:Return Cd
     C                     PARM '*KEY'    ##OPTN           I:Option
     C                     PARM CCYDS     ##CCYP           I:Currency Code
     C           SDCURR    PARM *BLANK    DSSDY            O:Format
      *
      **  Database Error
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVELCCYDS     W0KEY            ***************
     C                     Z-ADD9         W0ERNB           * DB ERROR 09 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C/COPY WNCPYSRC,CG4510C007
      *
      **  If the currency has been retrieved earlier, position the
      **  Currency Data data structure on the relevant occurrence.
     C                     ELSE
     C           C         OCUR SDCURR
     C/COPY WNCPYSRC,CG4510C077
     C                     ENDIF
     C*
     C           EXDCDP    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  AOBANKR0 - Obtain Bank details                 *
      *                AOGELRR0 - Obtain General Ledger Details       *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      **  Define Fields
     C           *LIKE     DEFN SDLSTD    ##LSTD
     C           *LIKE     DEFN SDNSTD    ##NSTD
     C           *LIKE     DEFN SDLSTP    ##LSTP
     C           *LIKE     DEFN SDCFSB    ##CFSB
     C           *LIKE     DEFN SDYTDB    ##YTDB
      *
     C           *LIKE     DEFN PSTA      PSTAX
      *
     C           *LIKE     DEFN CCY       ##CCYB
     C           *LIKE     DEFN CCY       ##CCYP
     C           *LIKE     DEFN BRCA      ##BRCD
     C           *LIKE     DEFN PSTD      ##PSTD
     C           *LIKE     DEFN PSTD      ##FPDT
     C           *LIKE     DEFN PSTD      ##LPDT
     C           *LIKE     DEFN SDLSTP    ##LSTT
     C********** *LIKE     DEFN PSTA      ##OCLC                                            MD056576
     C********** *LIKE     DEFN PSTA      ##OCLD                                            MD056576
     C********** *LIKE     DEFN PSTA      ##CCLC                                            MD056576
     C********** *LIKE     DEFN PSTA      ##CCLD                                            MD056576
     C********** *LIKE     DEFN PSTA      ##DCLC                                            MD056576
     C********** *LIKE     DEFN PSTA      ##DCLD                                            MD056576
     C********** *LIKE     DEFN PSTA      ##CFB                                             MD056576
     C********** *LIKE     DEFN PSTA      ##CFCB                                            MD056576
     C********** *LIKE     DEFN PSTA      ##NOEC                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##OCLC                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##OCLD                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##CCLC                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##CCLD                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##DCLC                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##DCLD                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##CFB                                             MD056576
     C           *LIKE     DEFN SDCFSB    ##CFCB                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##NOEC                                            MD056576
     C********** *LIKE     DEFN PSTA      ##VAEC                                            MD054681
     C           *LIKE     DEFN SDCFSB    ##VAEC                                            MD054681
     C********** *LIKE     DEFN PSTA      ##NOED                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##NOED                                            MD056576
     C********** *LIKE     DEFN PSTA      ##VAED                                            MD054681
     C           *LIKE     DEFN SDCFSB    ##VAED                                            MD054681
     C********** *LIKE     DEFN PSTA      ##ACBL                                            MD056576
     C********** *LIKE     DEFN PSTA      ##CLBL                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##ACBL                                            MD056576
     C           *LIKE     DEFN SDCFSB    ##CLBL                                            MD056576
     C           *LIKE     DEFN DERPTH    ##RPTH
     C           *LIKE     DEFN DENPTH    ##NPTH
     C           *LIKE     DEFN DEFSLI    ##FSLI
     C                     MOVE *BLANKS   S#PATH256
     C           *LIKE     DEFN DEPBIN    ##BNDC
     C           *LIKE     DEFN DEPBIN    S#PBIN
     C           *LIKE     DEFN DETBIN    S#TBIN
     C           *LIKE     DEFN DEOSEQ    ##OSEQ
     C           *LIKE     DEFN CCY       W#CCY
     C           *LIKE     DEFN SDCFSB    W#EBAL
     C           *LIKE     DEFN A6NBDP    W#NBDP
     C           *LIKE     DEFN SDLSTP    W#BITM                                            BUG24460
     C*
     C**  Define Equivalent Currency
     C           *LIKE     DEFN CCY       EQCY
      *
      **  Key list for full Account plus Posting Date
     C           ##ACDK    KLIST
     C                     KFLD           ##BRCA
     C                     KFLD           ##CNUM
     C                     KFLD           ##CCY
     C                     KFLD           ##ACOD
     C                     KFLD           ##ACSQ
     C                     KFLD           ##PSTD
      *
      **  Key list for full Account
     C           ##ACKY    KLIST
     C                     KFLD           ##BRCA
     C                     KFLD           ##CNUM
     C                     KFLD           ##CCY
     C                     KFLD           ##ACOD
     C                     KFLD           ##ACSQ
      *
      **  Key list for LF/REIACD
     C           ##REKY    KLIST
     C                     KFLD           ##CNUM
     C                     KFLD           ##CCY
     C                     KFLD           ##ACOD
     C                     KFLD           ##ACSQ
     C                     KFLD           ##BRCA
      *
      **  Key list for PF/GLAPSTPD
     C           ##POST    KLIST
     C                     KFLD           XRFI
     C                     KFLD           XRFN
     C/COPY WNCPYSRC,CG4510C032
      *
      **  Call access program for Bank details
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM '*FIRST  '##OPTN  7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD10        W0ERNB           * DB ERROR 10 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      **  Call access program for General Ledger details
     C                     CALL 'AOGELRR1'
     C                     PARM '*MSG   ' ##RTCD
     C                     PARM '*FIRST ' ##OPTN
     C           SDGELR    PARM SDGELR    DSSDY
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'AOGELRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD11        W0ERNB           * DB ERROR 11 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** Access SAR details file to determine if CEU013 is installed.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'CEU013'  ##SARD  6
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C           ##RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 12 *
     C                     Z-ADD12        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C           ##RTCD    IFEQ *BLANK
     C                     MOVEL'Y'       CEU013  1
     C                     ELSE
     C                     MOVEL'N'       CEU013
     C                     END
      *
      **  Retrieve the Euro currency details for later use.
      *
     C           CEU013    IFEQ 'Y'
     C           BKEURO    ANDNE*BLANKS
     C                     MOVE BKEURO    W#CCY
      *
      **  Access the Euro currency details for later use
      *
     C                     MOVE W#CCY     CCYDS
     C                     EXSR SRDCDT
      *
     C                     Z-ADDA6NBDP    W#NBDP
     C                     ENDIF
      *
      *
      ** Access SAR details file to determine if CEU014 is installed.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'CEU014'  ##SARD  6
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C           ##RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 09 *
     C                     Z-ADD09        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C*
     C           ##RTCD    IFEQ *BLANK
     C                     MOVEL'Y'       CEU014  1
     C                     ELSE
     C                     MOVEL'N'       CEU014
     C                     END
      *
      ** Access SAR details file to determine if CFT004 is installed.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*VERIFY' POPTN   7
     C                     PARM 'CFT004'  PSARD   6
     C           SCSARD    PARM SCSARD    DSSDY
      *
      ** Database Error
      *
     C           PRTCD     IFNE *BLANK
     C           PRTCD     ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ************
     C                     MOVEL'*CALL'   W0KEY            * DBERR 18 *
     C                     Z-ADD18        W0ERNB           ************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVEL'N'       CFT004
     C           PRTCD     IFEQ *BLANK
     C                     MOVEL'Y'       CFT004  1
     C                     ENDIF
      *
      ** Access SAR details file to determine if CCG015 is installed.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*VERIFY' POPTN   7
     C                     PARM 'CCG015'  PSARD   6
     C           SCSARD    PARM SCSARD    DSSDY
      *
      ** Database Error
      *
     C           PRTCD     IFNE *BLANK
     C           PRTCD     ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ************
     C                     MOVEL'*CALL'   W0KEY            * DBERR 19 *
     C                     Z-ADD19        W0ERNB           ************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVEL'N'       CCG015
     C           PRTCD     IFEQ *BLANK
     C                     MOVEL'Y'       CCG015  1
     C                     ENDIF
     C*
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*VERIFY' POPTN   7
     C                     PARM 'CRE008'  PSARD   6
     C           SCSARD    PARM SCSARD    DSSDY
      *
      ** Database Error
      *
     C           PRTCD     IFNE *BLANK
     C           PRTCD     ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE           ************
     C                     MOVEL'*CALL'   W0KEY            * DBERR 30 *
     C                     Z-ADD30        W0ERNB           ************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVEL'N'       CRE008
     C           PRTCD     IFEQ *BLANK
     C                     MOVEL'Y'       CRE008  1
     C           *LOVAL    SETLLSDCMANL0
     C                     READ SDCMANL0                 80
     C           *IN80     IFEQ *ON
     C                     MOVEL'SDCMANL0'W0FILE           ************
     C                     MOVEL'*FIRST'  W0KEY            * DBERR 31 *
     C                     Z-ADD31        W0ERNB           ************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     ENDIF
      *                                                                                       CAP204
      ** Access SAR details file to determine if CAP204 is installed.                         CAP204
      *                                                                                       CAP204
     C                     CALL 'AOSARDR0'                                                    CAP204
     C                     PARM *BLANKS   PRTCD   7                                           CAP204
     C                     PARM '*VERIFY' POPTN   7                                           CAP204
     C                     PARM 'CAP204'  PSARD   6                                           CAP204
     C           SCSARD    PARM SCSARD    DSSDY                                               CAP204
      *                                                                                       CAP204
      ** Database Error                                                                       CAP204
      *                                                                                       CAP204
     C           PRTCD     IFNE *BLANK                                                        CAP204
     C           PRTCD     ANDNE'*NRF   '                                                     CAP204
     C                     MOVEL'SCSARDPD'W0FILE           ************                       CAP204
     C                     MOVEL'*CALL'   W0KEY            * DBERR 20 *                       CAP204
     C                     Z-ADD20        W0ERNB           ************                       CAP204
     C                     MOVEL'MEM5003' W0MSGD                                              CAP204
     C                     MOVEL'MIDAS  ' W0MSGF                                              CAP204
     C                     EXSR SRERR                                                         CAP204
     C                     END                                                                CAP204
      *                                                                                       CAP204
     C                     MOVEL'N'       CAP204                                              CAP204
     C           PRTCD     IFEQ *BLANK                                                        CAP204
     C                     MOVEL'Y'       CAP204  1                                           CAP204
     C                     ENDIF                                                              CAP204
      *
     C                     CALL 'AOSARDR0'                                                    CER038
     C                     PARM *BLANKS   PRTCD                                               CER038
     C                     PARM '*VERIFY' POPTN                                               CER038
     C                     PARM 'CER038'  PSARD                                               CER038
     C           SCSARD    PARM SCSARD    DSFDY                                               CER038
      *                                                                                       CER038
     C           PRTCD     IFNE *BLANKS                                                       CER038
     C           PRTCD     ANDNE'*NRF    '                                                    CER038
     C                     MOVEL'SCSARDPD'W0FILE                                              CER038
     C                     MOVEL'CER038'  W0KEY                                               CER038
     C                     Z-ADD32        W0ERNB                                              CER038
     C                     MOVEL'MEM5003' W0MSGD                                              CER038
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER038
     C                     EXSR SRERR                                                         CER038
     C                     ENDIF                                                              CER038
      *                                                                                       CER038
     C           PRTCD     IFEQ *BLANKS                                                       CER038
     C                     MOVE 'Y'       CER038  1                                           CER038
     C                     ELSE                                                               CER038
      *                                                                                       CER038
     C                     MOVE 'N'       CER038                                              CER038
     C                     ENDIF                                                              CER038
      *                                                                                       CER038
     C                     CALL 'AOSARDR0'                                                    CER038
     C                     PARM *BLANKS   PRTCD                                               CER038
     C                     PARM '*VERIFY' POPTN                                               CER038
     C                     PARM 'CER031'  PSARD                                               CER038
     C           SCSARD    PARM SCSARD    DSFDY                                               CER038
      *                                                                                       CER038
     C           PRTCD     IFNE *BLANKS                                                       CER038
     C           PRTCD     ANDNE'*NRF    '                                                    CER038
     C                     MOVEL'SCSARDPD'W0FILE                                              CER038
     C                     MOVEL'CER031'  W0KEY                                               CER038
     C                     Z-ADD33        W0ERNB                                              CER038
     C                     MOVEL'MEM5003' W0MSGD                                              CER038
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER038
     C                     EXSR SRERR                                                         CER038
     C                     ENDIF                                                              CER038
      *                                                                                       CER038
     C           PRTCD     IFEQ *BLANKS                                                       CER038
     C                     MOVE 'Y'       CER031  1                                           CER038
     C                     ELSE                                                               CER038
      *                                                                                       CER038
     C                     MOVE 'N'       CER031                                              CER038
     C                     ENDIF                                                              CER038
      *                                                                                       CER038
      ** Access Switchable Features file and check if CCG015 is                             BUG23445
      ** installed                                                                          BUG23445
      *                                                                                     BUG23445
     C                     CALL 'AOSARDR0'                                                  BUG23445
     C                     PARM *BLANKS   PRTCD                                             BUG23445
     C                     PARM '*VERIFY' POPTN                                             BUG23445
     C                     PARM 'CGL013'  PSARD                                             BUG23445
      *                                                                                     BUG23445
     C           PRTCD     IFEQ *BLANK                                                      BUG23445
     C                     MOVE 'Y'       CGL013  1                                         BUG23445
     C                     ELSE                                                             BUG23445
     C                     MOVE 'N'       CGL013                                            BUG23445
     C           PRTCD     IFNE '*NRF   '                                                   BUG23445
     C                     MOVEL'SCSARDPD'W0FILE                                            BUG23445
     C                     MOVEL'*CALL'   W0KEY                                             BUG23445
     C                     Z-ADD34        W0ERNB                                            BUG23445
     C                     MOVEL'MEM5003' W0MSGD                                            BUG23445
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23445
     C                     EXSR SRERR                                                       BUG23445
     C                     ENDIF                                                            BUG23445
     C                     ENDIF                                                            BUG23445
      *                                                                                     BUG24460
      ** Access Switchable Features file and check if CER030 is                             BUG24460
      ** installed                                                                          BUG24460
      *                                                                                     BUG24460
     C                     CALL 'AOSARDR0'                                                  BUG24460
     C                     PARM *BLANKS   PRTCD                                             BUG24460
     C                     PARM '*VERIFY' POPTN                                             BUG24460
     C                     PARM 'CER030'  PSARD                                             BUG24460
      *                                                                                     BUG24460
     C           PRTCD     IFEQ *BLANK                                                      BUG24460
     C                     MOVE 'Y'       CER030  1                                         BUG24460
     C                     ELSE                                                             BUG24460
     C                     MOVE 'N'       CER030                                            BUG24460
     C           PRTCD     IFNE '*NRF   '                                                   BUG24460
     C                     MOVEL'SCSARDPD'W0FILE                                            BUG24460
     C                     MOVEL'*CALL'   W0KEY                                             BUG24460
     C                     Z-ADD35        W0ERNB                                            BUG24460
     C                     MOVEL'MEM5003' W0MSGD                                            BUG24460
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG24460
     C                     EXSR SRERR                                                       BUG24460
     C                     ENDIF                                                            BUG24460
     C                     ENDIF                                                            BUG24460
      *                                                                                       CRE073
      ** Access Switchable Features file and check if CRE073 is                               CRE073
      ** installed                                                                            CRE073
      *                                                                                       CRE073
     C                     CALL 'AOSARDR0'                                                    CRE073
     C                     PARM *BLANKS   PRTCD                                               CRE073
     C                     PARM '*VERIFY' POPTN                                               CRE073
     C                     PARM 'CRE073'  PSARD                                               CRE073
      *                                                                                       CRE073
     C           PRTCD     IFEQ *BLANK                                                        CRE073
     C                     MOVE 'Y'       CRE073  1                                           CRE073
     C                     ELSE                                                               CRE073
     C                     MOVE 'N'       CRE073                                              CRE073
     C           PRTCD     IFNE '*NRF   '                                                     CRE073
     C                     MOVEL'SCSARDPD'W0FILE                                              CRE073
     C                     MOVEL'*CALL'   W0KEY                                               CRE073
     C                     Z-ADD37        W0ERNB                                              CRE073
     C                     MOVEL'MEM5003' W0MSGD                                              CRE073
     C                     MOVEL'MIDAS  ' W0MSGF                                              CRE073
     C                     EXSR SRERR                                                         CRE073
     C                     ENDIF                                                              CRE073
     C                     ENDIF                                                              CRE073
      *                                                                                     BUG23445
      ***Keylist*for*file**GLNW94L1                                               BUG23445 BUG23445A
      ** Keylist for file  GLNWACL1                                                        BUG23445A
      *                                                                                     BUG23445
     C           KACCT     KLIST                                                            BUG23445
     C                     KFLD           KNWRK                                             BUG23445
     C                     KFLD           PBRCA                                             BUG23445
     C                     KFLD           PCUSNO                                            BUG23445
     C                     KFLD           PCUCD                                             BUG23445
     C                     KFLD           KACCD                                             BUG23445
     C                     KFLD           KACSQ                                             BUG23445
      *                                                                                     BUG23445
      ** Keylist for file GLMNARL1                                                          BUG24460
      *                                                                                     BUG24460
     C           KLNAR     KLIST                                                            BUG24460
     C                     KFLD           PSTD                                              BUG24460
     C                     KFLD           ##BANO                                            BUG24460
     C                     KFLD           W#BITM                                            BUG24460
      *                                                                                     BUG24460
     C/COPY WNCPYSRC,CG4510C008
      *
      **  Copyright
     C                     MOVEA##CPY     ##BIS  80
     C/COPY WNCPYSRC,CG4510C006
      *
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINZ                                          *
      * Function    :  Initialise Fields on Program Invocation        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINZ     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     Z-ADD*ZEROS    #1      60
     C                     Z-ADD*ZEROS    #2      60
     C                     Z-ADD*ZEROS    #3      60
     C                     MOVE *BLANKS   S#PATH
      *
     C                     Z-ADD*ZEROS    ##OSEQ
      *
     C                     Z-ADD*ZEROS    ##LSTD
     C                     Z-ADD*ZEROS    ##NSTD
     C                     Z-ADD*ZEROS    ##LSTP                          Output
     C                     Z-ADD*ZEROS    ##CFSB                          Output
     C                     Z-ADD*ZEROS    ##YTDB                          Output
      *
     C                     Z-ADD*ZEROS    ##ACBL                          Output
     C                     Z-ADD*ZEROS    ##CCLC                          Output
     C                     Z-ADD*ZEROS    ##CCLD                          Output
     C                     Z-ADD*ZEROS    ##DCLC                          Output
     C                     Z-ADD*ZEROS    ##DCLD                          Output
     C                     Z-ADD*ZEROS    ##CFB                           Output
     C                     Z-ADD*ZEROS    ##CFCB                          Output
     C                     Z-ADD*ZEROS    ##NOED                          Output
     C                     Z-ADD*ZEROS    ##NOEC                          Output
     C                     Z-ADD*ZEROS    ##VAED                          Output
     C                     Z-ADD*ZEROS    ##VAEC                          Output
     C                     Z-ADD*ZEROS    ##OCLC                          Output
     C                     Z-ADD*ZEROS    ##OCLD                          Output
     C/COPY WNCPYSRC,CG4510C021
      *
      **  Initialise Binds.
     C                     Z-ADD1         S#PBIN
     C                     Z-ADD1         S#TBIN
     C                     Z-ADD1         ##BNDC
      *
      **  Initialise XML increment
     C                     EXSR INIXML
      *
     C           EXINZ     TAG
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5                                                                                CER038
      *****************************************************************                       CER038
      * Subroutine  :  PSNARR                                         *                       CER038
      * Function    :  Extract Posting Narratives                     *                       CER038
      *                                                               *                       CER038
      *                                                               *                       CER038
      * Called by   :  G#STMT - Top level group set                   *                       CER038
      * Calls       :  SRRRDE - Retrieve RDE Information              *                       CER038
      *                SRADTA - Format Extract Data                   *                       CER038
      *                SRODTA - Output Extract Data                   *                       CER038
      *                SRERR  - Database Error                        *                       CER038
      *****************************************************************                       CER038
      *                                                                                       CER038
     C           PSNARR    BEGSR                                                              CER038
      *                                                                                       CER038
      ** Set up subroutine stack name                                                         CER038
      *                                                                                       CER038
     C                     ADD  1         Q                                                   CER038
     C                     MOVEL'PSNARR'  @STK,Q                                              CER038
      *                                                                                       CER038
      ** Retrieve subroutine specific data                                                    CER038
      *                                                                                       CER038
     C           14        OCUR ##SRDT                                                        CER038
      *                                                                                       CER038
      ** Setup path                                                                           CER038
      *                                                                                       CER038
     C                     MOVEL'\PSNARR' ##PNAM                                              CER038
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                              CER038
     C                     EXSR PSHGRS                                                        CER038
     C                     MOVELS#PATH    ##SPAT                                              CER038
      *                                                                                       CER038
      ** Set up Binds from passed in values.                                                  CER038
      *                                                                                       CER038
     C                     MOVELS#PBIN    ##PBIN                                              CER038
     C                     MOVELS#TBIN    ##TBIN                                              CER038
      *                                                                                       CER038
      ** Retrieve RDE info                                                                    CER038
      *                                                                                       CER038
     C                     MOVEL'PSNARR'  ##GRPS                                              CER038
     C                     Z-ADD1         ##RDEN                                              CER038
     C                     EXSR SRRRDE                                                        CER038
      *                                                                                     BUG25261
      ** Clear parameters                                                                   BUG25261
      *                                                                                     BUG25261
     C                     MOVE *BLANKS   PNAR1                                             BUG25261
     C                     MOVE *BLANKS   PNAR2                                             BUG25261
     C                     MOVE *BLANKS   PNAR3                                             BUG25261
     C                     MOVE *BLANKS   PNAR4                                             BUG25261
     C                     MOVE *BLANKS   PNAR5                                             BUG25261
     C                     MOVE *BLANKS   PNAR6                                             BUG25261
      *                                                                                       CER038
      ** Retrieve posting narratives from GLAPSTPD                                            CER038
      *                                                                                       CER038
     C********** ##ACKY    CHAINAPOSTPDF             55                              CER038 BUG23277
     C********** *IN55     IFEQ *OFF                                                 CER038 BUG23277
     C********** ##POST    CHAINGLAPSTPF             52                              CER038 BUG23277
     C********** *IN52     IFEQ *OFF                                                 CER038 BUG23277
      *                                                                                       CER038
      ** Setup Narratives                                                                     CER038
      *                                                                                       CER038
     C           *IN52     IFEQ *OFF                                                        BUG24460
     C           CER031    ANDEQ'Y'                                                         BUG24460
     C                     MOVELPSNAR1    PNAR1                                               CER038
     C                     MOVELPSNAR2    PNAR2                                               CER038
     C                     MOVELPSNAR3    PNAR3                                               CER038
     C                     MOVELPSNAR4    PNAR4                                               CER038
     C                     MOVELPSNAR5    PNAR5                                               CER038
     C                     MOVELPSNAR6    PNAR6                                               CER038
      *                                                                                     BUG24460
     C                     ELSE                                                             BUG24460
      *                                                                                     BUG24460
     C                     MOVEL##BITM    W#BITM                                            BUG24460
      *                                                                                     BUG24460
     C           KLNAR     CHAINGLMNARL1             97                                     BUG24460
     C           *IN97     IFEQ *OFF                                                        BUG24460
     C           CER030    ANDEQ'Y'                                                         BUG24460
     C                     EXSR SREVNA                                                      BUG24460
     C                     MOVEL'Y'       WMT22   1                                         BUG24460
     C                     ENDIF                                                            BUG24460
      *                                                                                     BUG24460
     C                     ENDIF                                                            BUG24460
      *                                                                                       CER038
      ** Setup Account information fields                                                     CER038
      *                                                                                       CER038
     C                     MOVEL##BRCA    PBRCA                                               CER038
     C                     MOVEL##CNUM    PCUSNO                                              CER038
     C                     MOVEL##CCY     PCUCD                                               CER038
     C                     MOVEL##ACOD    PACCD                                               CER038
     C                     MOVEL##ACSQ    PACSQ                                               CER038
     C                     MOVEL'*FORMAT' POPTN                                               CER038
      *                                                                                     BUG23445
      ** Format according to network Paper if Account is linked                             BUG23445
      *                                                                                     BUG23445
     C                     MOVEL*BLANKS   PNTWK                                             BUG23445
     C           CGL013    IFEQ 'Y'                                                         BUG23445
     C                     MOVEL'PAPER'   KNWRK   6                                         BUG23445
     C                     MOVE PACCD     KACCD  100                                        BUG23445
     C                     MOVE PACSQ     KACSQ   20                                        BUG23445
     C********** KACCT     CHAINGLNW94L1             95                           BUG23445 BUG23445A
     C           KACCT     CHAINGLNWACL1             95                                    BUG23445A
     C           *IN95     IFEQ *OFF                                                        BUG23445
     C**********           MOVELN4NWRK    PNTWK                                   BUG23445 BUG23445A
     C                     MOVELNANWRK    PNTWK                                            BUG23445A
     C                     ENDIF                                                            BUG23445
     C                     ENDIF                                                            BUG23445
      *                                                                                     BUG24460
      ** Set Flag for Accumulate RDE's and data when RDE's > than 21                        BUG24460
      *                                                                                     BUG24460
     C                     MOVEL*BLANKS   WACUM   1                                         BUG24460
      *                                                                                     BUG24460
     C           WMT22     IFEQ 'Y'                                                         BUG24460
     C                     MOVEL'Y'       WACUM                                             BUG24460
      *                                                                                     BUG24460
      ** Call the MG001901 access object to format the extended                             BUG24460
      ** narratives                                                                         BUG24460
      *                                                                                     BUG24460
     C                     CALL 'MG001901'                                                  BUG24460
     C                     PARM *BLANKS   PRTCD2                                            BUG24460
     C                     PARM           POPTN                                             BUG24460
     C                     PARM           PNTWK                                             BUG24460
     C                     PARM           PMGTYP                                            BUG24460
     C                     PARM           PBRCA                                             BUG24460
     C                     PARM           PCUSNO                                            BUG24460
     C                     PARM           PCUCD                                             BUG24460
     C                     PARM           PACCD                                             BUG24460
     C                     PARM           PACSQ                                             BUG24460
     C                     PARM           PDCIN                                             BUG24460
     C                     PARM           PTRTP                                             BUG24460
      *                                                                                     BUG24460
      ** Extended Narratives of length 22 * 35                                              BUG24460
      *                                                                                     BUG24460
     C                     PARM           EXT                                               BUG24460
      *                                                                                     BUG24460
     C                     PARM *BLANKS   PRTF1                                             BUG24460
     C                     PARM *BLANKS   PRTF2                                             BUG24460
     C                     PARM *BLANKS   PRTF3                                             BUG24460
     C                     PARM *BLANKS   PRTF4                                             BUG24460
     C                     PARM *BLANKS   PRTF5                                             BUG24460
     C                     PARM *BLANKS   PRTF6                                             BUG24460
     C                     PARM *BLANKS   PRTF7                                             BUG24460
     C                     PARM *BLANKS   PRTF8                                             BUG24460
     C                     PARM *BLANKS   PRTF9                                             BUG24460
     C                     PARM *BLANKS   PRTF10                                            BUG24460
     C                     PARM *BLANKS   PRTF11                                            BUG24460
     C                     PARM *BLANKS   PRTF12                                            BUG24460
     C                     PARM *BLANKS   PRTF13                                            BUG24460
     C                     PARM *BLANKS   PRTF14                                            BUG24460
     C                     PARM *BLANKS   PRTF15                                            BUG24460
     C                     PARM *BLANKS   PRTF16                                            BUG24460
     C                     PARM *BLANKS   PRTF17                                            BUG24460
     C                     PARM *BLANKS   PRTF18                                            BUG24460
     C                     PARM *BLANKS   PRTF19                                            BUG24460
     C                     PARM *BLANKS   PRTF20                                            BUG24460
     C                     PARM *BLANKS   PRTF21 70                                         BUG24460
     C                     PARM *BLANKS   PRTF22 70                                         BUG24460
     C                     PARM           IDX                                               BUG24460
     C                     PARM           FLDNAM                                            BUG24460
     C                     PARM           MSGID                                             BUG24460
     C                     PARM           MSGDTA                                            BUG24460
     C                     PARM           WFLDNM                                            BUG24460
     C                     PARM           WMGID                                             BUG24460
     C                     PARM           WMGDTA                                            BUG24460
      *                                                                                     BUG24460
     C           PRTCD2    IFEQ *BLANKS                                                     BUG24460
     C           PRTCD2    OREQ '*FORMAT'                                                   BUG24460
      *                                                                                     BUG24460
     C                     MOVELPRTF1     ##D,1                                             BUG24460
     C                     MOVELPRTF2     ##D,2                                             BUG24460
     C                     MOVELPRTF3     ##D,3                                             BUG24460
     C                     MOVELPRTF4     ##D,4                                             BUG24460
     C                     MOVELPRTF5     ##D,5                                             BUG24460
     C                     MOVELPRTF6     ##D,6                                             BUG24460
     C                     MOVELPRTF7     ##D,7                                             BUG24460
     C                     MOVELPRTF8     ##D,8                                             BUG24460
     C                     MOVELPRTF9     ##D,9                                             BUG24460
     C                     MOVELPRTF10    ##D,10                                            BUG24460
     C                     MOVELPRTF11    ##D,11                                            BUG24460
     C                     MOVELPRTF12    ##D,12                                            BUG24460
     C                     MOVELPRTF13    ##D,13                                            BUG24460
     C                     MOVELPRTF14    ##D,14                                            BUG24460
     C                     MOVELPRTF15    ##D,15                                            BUG24460
     C                     MOVELPRTF16    ##D,16                                            BUG24460
     C                     MOVELPRTF17    ##D,17                                            BUG24460
     C                     MOVELPRTF18    ##D,18                                            BUG24460
     C                     MOVELPRTF19    ##D,19                                            BUG24460
     C                     MOVELPRTF20    ##D,20                                            BUG24460
      *                                                                                     BUG24460
     C                     ELSE                                                             BUG24460
      *                                                                                     BUG24460
     C                     MOVEL'MG001901'W0FILE                                            BUG24460
     C                     MOVELEXT,1     W0KEY                                             BUG24460
     C                     Z-ADD36        W0ERNB                                            BUG24460
     C                     MOVEL'MEM5003' W0MSGD                                            BUG24460
     C                     MOVEL'MIDAS'   W0MSGF                                            BUG24460
     C                     EXSR SRERR                                                       BUG24460
     C                     ENDIF                                                            BUG24460
      *                                                                                     BUG24460
     C                     ELSE                                                             BUG24460
      *                                                                                       CER038
     C                     CALL 'MG001900'                                                    CER038
     C                     PARM           PRTCD2 10                                           CER038
     C                     PARM           POPTN   7                                           CER038
     C                     PARM           PNTWK   6                                           CER038
     C                     PARM           PMGTYP  3                                           CER038
     C                     PARM           PBRCA   3                                           CER038
     C**********           PARM           PCUSNO  60                                   CER038 CER059
     C                     PARM           PCUSNO  6                                           CER059
     C                     PARM           PCUCD   3                                           CER038
     C                     PARM           PACCD                                               CER038
     C                     PARM           PACSQ                                               CER038
     C                     PARM           PDCIN   1                                           CER038
     C                     PARM           PTRTP   5                                           CER038
     C                     PARM           PNAR1  65                                           CER038
     C                     PARM           PNAR2  65                                           CER038
     C                     PARM           PNAR3  65                                           CER038
     C                     PARM           PNAR4  65                                           CER038
     C                     PARM           PNAR5  65                                           CER038
     C                     PARM           PNAR6  65                                           CER038
     C**********           PARM           PRTF1  70                                  CER038 BUG23197
     C**********           PARM           PRTF2  70                                  CER038 BUG23197
     C**********           PARM           PRTF3  70                                  CER038 BUG23197
     C**********           PARM           PRTF4  70                                  CER038 BUG23197
     C**********           PARM           PRTF5  70                                  CER038 BUG23197
     C**********           PARM           PRTF6  70                                  CER038 BUG23197
     C**********           PARM           PRTF7  70                                  CER038 BUG23197
     C**********           PARM           PRTF8  70                                  CER038 BUG23197
     C**********           PARM           PRTF9  70                                  CER038 BUG23197
     C**********           PARM           PRTF10 70                                  CER038 BUG23197
     C**********           PARM           PRTF11 70                                  CER038 BUG23197
     C**********           PARM           PRTF12 70                                  CER038 BUG23197
     C**********           PARM           PRTF13 70                                  CER038 BUG23197
     C**********           PARM           PRTF14 70                                  CER038 BUG23197
     C**********           PARM           PRTF15 70                                  CER038 BUG23197
     C**********           PARM           PRTF16 70                                  CER038 BUG23197
     C**********           PARM           PRTF17 70                                  CER038 BUG23197
     C**********           PARM           PRTF18 70                                  CER038 BUG23197
     C**********           PARM           PRTF19 70                                  CER038 BUG23197
     C**********           PARM           PRTF20 70                                  CER038 BUG23197
     C                     PARM *BLANKS   PRTF1  70                                         BUG23197
     C                     PARM *BLANKS   PRTF2  70                                         BUG23197
     C                     PARM *BLANKS   PRTF3  70                                         BUG23197
     C                     PARM *BLANKS   PRTF4  70                                         BUG23197
     C                     PARM *BLANKS   PRTF5  70                                         BUG23197
     C                     PARM *BLANKS   PRTF6  70                                         BUG23197
     C                     PARM *BLANKS   PRTF7  70                                         BUG23197
     C                     PARM *BLANKS   PRTF8  70                                         BUG23197
     C                     PARM *BLANKS   PRTF9  70                                         BUG23197
     C                     PARM *BLANKS   PRTF10 70                                         BUG23197
     C                     PARM *BLANKS   PRTF11 70                                         BUG23197
     C                     PARM *BLANKS   PRTF12 70                                         BUG23197
     C                     PARM *BLANKS   PRTF13 70                                         BUG23197
     C                     PARM *BLANKS   PRTF14 70                                         BUG23197
     C                     PARM *BLANKS   PRTF15 70                                         BUG23197
     C                     PARM *BLANKS   PRTF16 70                                         BUG23197
     C                     PARM *BLANKS   PRTF17 70                                         BUG23197
     C                     PARM *BLANKS   PRTF18 70                                         BUG23197
     C                     PARM *BLANKS   PRTF19 70                                         BUG23197
     C                     PARM *BLANKS   PRTF20 70                                         BUG23197
     C                     PARM           IDX     30                                          CER038
     C                     PARM           FLDNAM                                              CER038
     C                     PARM           MSGID                                               CER038
     C                     PARM           MSGDTA                                              CER038
     C                     PARM           WFLDNM                                              CER038
     C                     PARM           WMGID                                               CER038
     C                     PARM           WMGDTA                                              CER038
      *                                                                                       CER038
     C           PRTCD2    IFEQ ' '                                                           CER038
     C           PRTCD2    OREQ '*FORMAT'                                                     CER038
     C                     MOVELPRTF1     ##D,1                                               CER038
     C                     MOVELPRTF2     ##D,2                                               CER038
     C                     MOVELPRTF3     ##D,3                                               CER038
     C                     MOVELPRTF4     ##D,4                                               CER038
     C                     MOVELPRTF5     ##D,5                                               CER038
     C                     MOVELPRTF6     ##D,6                                               CER038
     C                     MOVELPRTF7     ##D,7                                               CER038
     C                     MOVELPRTF8     ##D,8                                               CER038
     C                     MOVELPRTF9     ##D,9                                               CER038
     C                     MOVELPRTF10    ##D,10                                              CER038
     C                     MOVELPRTF11    ##D,11                                              CER038
     C                     MOVELPRTF12    ##D,12                                              CER038
     C                     MOVELPRTF13    ##D,13                                              CER038
     C                     MOVELPRTF14    ##D,14                                              CER038
     C                     MOVELPRTF15    ##D,15                                              CER038
     C                     MOVELPRTF16    ##D,16                                              CER038
     C                     MOVELPRTF17    ##D,17                                              CER038
     C                     MOVELPRTF18    ##D,18                                              CER038
     C                     MOVELPRTF19    ##D,19                                              CER038
     C                     MOVELPRTF20    ##D,20                                              CER038
      *                                                                                       CER038
     C                     ELSE                                                               CER038
     C                     MOVEL'MG001900'W0FILE                                              CER038
     C                     MOVELPNAR1     W0KEY                                               CER038
     C                     Z-ADD31        W0ERNB                                              CER038
     C                     MOVEL'MEM5003' W0MSGD                                              CER038
     C                     MOVEL'MIDAS'   W0MSGF                                              CER038
     C                     EXSR SRERR                                                         CER038
     C                     ENDIF                                                              CER038
     C                     ENDIF                                                            BUG24460
     C**********           ENDIF                                                     CER038 BUG23277
     C**********           ENDIF                                                     CER038 BUG23277
      *                                                                                       CER038
      ** Accumulate RDEs and associated data and output to                                    CER038
      ** PF/ CGUDTAPD                                                                         CER038
      *                                                                                       CER038
     C                     EXSR SRADTA                                                        CER038
      *                                                                                     BUG24460
     C           WACUM     IFEQ 'Y'                                                         BUG24460
      *                                                                                     BUG24460
      ** Retrieve RDE information for RDEs in group set                                     BUG24460
      *                                                                                     BUG24460
     C                     MOVEL@STK,Q    ##GRPS                                            BUG24460
     C                     Z-ADD21        ##RDEN                                            BUG24460
     C                     EXSR SRRRDE                                                      BUG24460
      *                                                                                     BUG24460
     C                     MOVELPRTF21    ##D,1                                             BUG24460
     C                     MOVELPRTF22    ##D,2                                             BUG24460
      *                                                                                     BUG24460
     C                     EXSR SRADTA                                                      BUG24460
      *                                                                                     BUG24460
     C                     MOVEL*BLANKS   EXT                                               BUG24460
     C                     MOVEL*BLANKS   WACUM                                             BUG24460
      *                                                                                     BUG24460
     C                     ENDIF                                                            BUG24460
      *                                                                                     BUG24460
     C                     EXSR SRODTA                                                        CER038
      *                                                                                       CER038
     C           EXNARR    TAG                                                                CER038
      *                                                                                       CER038
      ** Unwind subroutine stack name                                                         CER038
      *                                                                                       CER038
     C                     EXSR POPGRS                                                        CER038
     C                     MOVEA' '       @STK,Q                                              CER038
     C                     SUB  1         Q                                                   CER038
      *                                                                                       CER038
     C                     ENDSR                                                              CER038
      *****************************************************************                     BUG24460
      /EJECT                                                                                BUG24460
      *****************************************************************                     BUG24460
      *                                                               *                     BUG24460
      *  SREVNA   - Evaluate Additional Narrative Details             *                     BUG24460
      *                                                               *                     BUG24460
      *  Called by: PSNARR                                            *                     BUG24460
      *                                                               *                     BUG24460
      *  Calls: None                                                  *                     BUG24460
      *                                                               *                     BUG24460
      *****************************************************************                     BUG24460
     C           SREVNA    BEGSR                                                            BUG24460
      *                                                                                     BUG24460
     C                     MOVELBAEX1     EXT,1                                             BUG24460
     C                     MOVELBAEX2     EXT,2                                             BUG24460
     C                     MOVELBAEX3     EXT,3                                             BUG24460
     C                     MOVELBAEX4     EXT,4                                             BUG24460
     C                     MOVELBAEX5     EXT,5                                             BUG24460
     C                     MOVELBAEX6     EXT,6                                             BUG24460
     C                     MOVELBAEX7     EXT,7                                             BUG24460
     C                     MOVELBAEX8     EXT,8                                             BUG24460
     C                     MOVELBAEX9     EXT,9                                             BUG24460
     C                     MOVELBAEX10    EXT,10                                            BUG24460
     C                     MOVELBAEX11    EXT,11                                            BUG24460
     C                     MOVELBAEX12    EXT,12                                            BUG24460
     C                     MOVELBAEX13    EXT,13                                            BUG24460
     C                     MOVELBAEX14    EXT,14                                            BUG24460
     C                     MOVELBAEX15    EXT,15                                            BUG24460
     C                     MOVELBAEX16    EXT,16                                            BUG24460
     C                     MOVELBAEX17    EXT,17                                            BUG24460
     C                     MOVELBAEX18    EXT,18                                            BUG24460
     C                     MOVELBAEX19    EXT,19                                            BUG24460
     C                     MOVELBAEX20    EXT,20                                            BUG24460
     C                     MOVELBAEX21    EXT,21                                            BUG24460
     C                     MOVELBAEX22    EXT,22                                            BUG24460
      *                                                                                     BUG24460
     C                     ENDSR                                                            BUG24460
      *****************************************************************                       CER038
     C/COPY WNCPYSRC,CG4510C022
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRPSSR
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRC
     O/SPACE 5
     O/COPY WNCPYSRC,CG4510O001
     O/SPACE 5
     O/COPY CGCPYSRC,CGNWEX
** ##GRP/##RDEA
g_SHDR0001 STMT_DATE  Date
g_SHDR0002 STMT_LSD   Date
g_SHDR0003 STMT_NUMBR AmountL
g_SHDR0004 STMT_DEMAN
g_SHDR0005 STMT_MANAG
g_SHDR0006 SDAT       Date                                                                    261705
g_SHDR0007 EDAT       Date                                                                    261705
BRANCH0001 BRANCH
BRANCH0002 BRANCH NAM
ACCNT 0001 ACCOUNT
ACCNT 0002 RETL_ACNO
ACCNT 0003 ACC_NAME
ACCNT 0004 ACC_TYPE
ACCNT 0005 BAL_EURO
ACCNT 0006 IBAN
ACCNT 0007 CRE073F                                                                            CRE073
CUST  0001 CUSTOMER
CUST  0002 CUST_NAME
CUST  0003 CUST_ADR1
CUST  0004 CUST_ADR2
CUST  0005 CUST_ADR3
CUST  0006 CUST_ADR4
CUST  0007 CUST_TOWN
ACOF  0001 ACOF_CODE                     Account Officer Code
ACOF  0002 ACOF_DEPT                     Account Officer Dept
ACOF  0003 ACOF_NAME                     Account Officer Name
ACOF  0004 ACOF_TELP                     Account Officer Telephone Num.
ACOF  0005 ACOF_TELX                     Account Officer Telephone Ext.
CCY   0001 CURRENCY
CCY   0002 CCY_DESC
CCY   0003 PREC_METIN
g_SOPB0001 STMT_BFBAL AmountL
g_SOPB0002 STMT_BFCBL AmountL
g_SOPB0003 EURO_BFBAL AmountL
g_SOPB0004 EURO_BFCBL AmountL
g_SPS30001 POST_DATE  Date
g_SPS30002 VALUE DATE Date
g_SPS30003 CHQ_NUMBER
g_SPS30004 POST_NARR
g_SPS30005 POST_AMT   AmountL
g_SPS30006 POST_GETP
g_SPS30007 POST_MODUL
g_SPS30008 POST_TNUM
g_SPS30009 POST_BCHN
g_SPS30010 POST_BITEM
g_SPS30011 STMT_ACBL  AmountL
g_SPS30012 ORIG_CCY
g_SPS30013 ORIG_AMNT  AmountL
g_SPS30014 POST_EQCY  AmountL
g_SPS30015 EQUIV_CCY
g_SPS30016 EQUIV_CCYD
g_SPS30017 ORIG_ACCT
g_SCLR0001 HDR_CRCLR  AmountL
g_SCLR0002 HDR_DRCLR  AmountL
g_SCLR0003 START_CLR  AmountL
g_SCLR0004 END_CLR    AmountL
g_SCLR0005 TOT_CRCLR  AmountL
g_SCLR0006 TOT_DRCLR  AmountL
g_SCLB0001 STMT_CFBAL AmountL
g_SCLB0002 STMT_CFCBL AmountL
g_SCLB0003 EURO_CFBAL AmountL
g_SCLB0004 EURO_CFCBL AmountL
g_SBRK0001 TOT_CRENT  AmountL
g_SBRK0002 TOT_CRVAL  AmountL
g_SBRK0003 TOT_DRENT  AmountL
g_SBRK0004 TOT_DRVAL  AmountL
g_SRC20001 POST_DATE  Date
g_SRC20002 VALUE DATE Date
g_SRC20003 POST_RATE  Rate  L7
g_SRC20004 DR/CR
g_SRC20005 DCONTRSPR  Rate  L7                                                                CRE073
g_SRC20006 DSPRSIGN                                                                           CRE073
g_SRC20007 DRNDMTD                                                                            CRE073
g_SRC20008 DRNDFRAC                                                                           CRE073
g_SCC20001 POST_DATE  Date
g_SCC20002 VALUE DATE Date
g_SCC20003 POST_RATE  Rate  L7
g_SCC20004 DR/CR
g_SCC20005 CCONTRSPR  Rate  L7                                                                CRE073
g_SCC20006 CSPRSIGN                                                                           CRE073
g_SCC20007 CRNDMTD                                                                            CRE073
g_SCC20008 CRNDFRAC                                                                           CRE073
g_SFTR0001 CMGA_TXT1
g_SFTR0002 CMGA_TXT2
g_SFTR0003 CMGA_TXT3
g_SFTR0004 CMGA_TXT4
     X/COPY WNCPYSRC,CG4510X001
PSNARR0001 PSNARR01                      Posting Narrative 1                                  CER038
PSNARR0002 PSNARR02                      Posting Narrative 2                                  CER038
PSNARR0003 PSNARR03                      Posting Narrative 3                                  CER038
PSNARR0004 PSNARR04                      Posting Narrative 4                                  CER038
PSNARR0005 PSNARR05                      Posting Narrative 5                                  CER038
PSNARR0006 PSNARR06                      Posting Narrative 6                                  CER038
PSNARR0007 PSNARR07                      Posting Narrative 7                                  CER038
PSNARR0008 PSNARR08                      Posting Narrative 8                                  CER038
PSNARR0009 PSNARR09                      Posting Narrative 9                                  CER038
PSNARR0010 PSNARR10                      Posting Narrative 10                                 CER038
PSNARR0011 PSNARR11                      Posting Narrative 11                                 CER038
PSNARR0012 PSNARR12                      Posting Narrative 12                                 CER038
PSNARR0013 PSNARR13                      Posting Narrative 13                                 CER038
PSNARR0014 PSNARR14                      Posting Narrative 14                                 CER038
PSNARR0015 PSNARR15                      Posting Narrative 15                                 CER038
PSNARR0016 PSNARR16                      Posting Narrative 16                                 CER038
PSNARR0017 PSNARR17                      Posting Narrative 17                                 CER038
PSNARR0018 PSNARR18                      Posting Narrative 18                                 CER038
PSNARR0019 PSNARR19                      Posting Narrative 19                                 CER038
PSNARR0020 PSNARR20                      Posting Narrative 20                                 CER038
PSNARR0021 PSNARR21                      Posting Narrative 21                               BUG24460
PSNARR0022 PSNARR22                      Posting Narrative 22                               BUG24460
**  Table of Generated Entry Type vs Related Module
AGL
CRE
DDL
ERE
FGL
GFT
HGL
IGL
JGL
KGL
MGL
ORE
PRE
QRE
RGL
SSE
TFO
ULE
XGL
YGL
LGL                                                                                           CAP204
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2003
     X/COPY WNCPYSRC,CG4510X002
