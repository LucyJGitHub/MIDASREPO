     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CG COB int capitalisation + trans charges')      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - User Defined Correspondence                          *
     F*                                                               *
     F*  CG4820 - COB Interest capitalisation and transaction charges *
     F*                                                               *
     F*  Function:  This program xxxxxxxxxxxxxxxxxxxxxxxxxxxx         *
     F*  (phase(s))                                                   *
     F*                                                               *
     F*  Called By: mmCnnnn - (program name)                          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. CER050             Date 16Jun19               *
      *  Prev Amend No. MD049504           Date 02Feb18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CER069             Date 03Jul14               *
      *                 AR1029309          Date 20Dec12               *
      *                 CER049             Date 06Dec10               *
      *                 CER055             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG24190           Date 04Jun09               *
      *                 BUG23986A          Date 29May09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23986           Date 13May09               *
      *                 BUG23515           Date 02Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 06May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9603            Date 13Dec05               *
      *                 234799             Date 14Jul05               *
      *                 233429             Date 10May05               *
      *                 CGL035             Date 01Mar05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CCG015             Date 09Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT004             Date 04Aug99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130468             Date 28Apr99               *
      *                 CEU014             Date 02Jun98               *
     F*                 113415             Date 01May97               *
     F*                 103216             DATE 23May96               *
     F*                 089776             DATE 17APR96               *
     F*                 086918             DATE 02MAY95               *
     F*                 S01522             DATE 15DEC94               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CER050 - Annualised Percentage Rate                          *
      *  MD049504 - (1) Add extract of Posting Narrative.             *
      *             (2) Review sequence of fields in array.           *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CER069 - German Tax Enhancement                              *
      *  AR1029309 - REInterestCapitalisationAdvice has not been      *
      *              generated because PNAR value is 'Interest'. Add  *
      *              condition for 'Interest'. (Child: AR1029311)     *
      *              Initial fix was coming from WES1_H01LN but this  *
      *              fix was extended to CER049.                      *
      *  CER049 - Stamp Tax (Portuguese Features Upgrade)             *
      *  CER055 - Penalty Interest on Exceeding Overdraft Limit       *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG24190 - Incorrect computation of Portion of Threshold used*
      *  BUG23986A - Taxable Int In Tax Curr not populates correctly  *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23986 - Seconday Tax Rate & Secondary Tax Account code not*
      *             populates correctly                               *
      *  BUG23515 - Dealing Confirmations missing for new fields      *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  CER048 - German Features - Taxes                             *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha (recompile) *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9603 - Changes in CGPACKE caused some programs not to     *
      *            compile.                                           *
      *  234799 - No data being output for R02DTL due to erroneous    *
      *           handling of group set greater than 20.  Applied     *
      *           core fix 087328.                                    *
      *  233429 - CGC2050 Failed Component                            *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  CGL031 - Taxation on Savings Income                          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CCG015 - Correspondence Manager Phase 1                      *
     F*  CSD006 - Recompiled over changed SDCURRPD.                   *
     F*  CFT004 - Straight Through Processing Phase 2                 *
     F*           International Bank Account Numbers (IBAN)           *
     F*  CGL007 - Account Postings Enquiry (Recompile)                *
     F*  130468 - BRT not deducted from CR interest adjustments.      *
     F*           BRT is no longer deducted from the CR interest but  *
     F*           is posted as a debit. Calculate BRT and net         *
     F*           interest from the gross interest posting.           *
     F*  CEU014 - EMU User Defined Correspondence Changes             *
     F*  113415 - Add the setup of customer nbr and report name       *
     F*  103216 - Correct exit from SRMAIN                            *
     F*  089776 - Add 'Account officer' details                       *
     F*  086918 - Add customer town RDE to Group set CUST.            *
     F*  S01522 - User Defined Correspondence                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  Indicator usage                                              *
     F*  ~~~~~~~~~~~~~~~                                              *
     F*                                                               *
     F*                                                               *
     F*  99   -    General work indicator                             *
     F*                                                               *
     F*****************************************************************
     F/SPACE 5
     F***ACCNT***IF  F     402 18AI     2 DISK                            CFT004
     F***ACCNT** IF  F     485 18AI     2 DISK                                         CFT004 CGL029
     FACCNT   IF  F     573 24AI     2 DISK                                                   CGL029
     FACNUM   IF  F     107 10AI     2 DISK
     FCLINT   IF  E           K        DISK
     FSDBRTDL1IF  E           K        DISK
     FSDCSINL7IF  E           K        DISK                                                   CGL031
     FACCNTBJ0IF  E           K        DISK                                                 BUG23986
     F/COPY WNCPYSRC,CG4820F001
      *                                                                                       CER050
     FACCNTBY0IF  E           K        DISK                                                   CER050
     F            ACCNTBD0                          KRENAMEACCNTBDY                           CER050
      *                                                                                       CER050
     FREAPRHI0IF  E           K        DISK                                                   CER050
      *                                                                                       CER050
     FREAPRHI1IF  E           K        DISK                                                   CER050
     F            REAPRHD0                          KRENAMEREAPRHD1                           CER050
      *                                                                                       CER050
     E/COPY CGCPYSRC,CGPACKE
     E/COPY CGCPYSRC,SRERRE
     E**  Number Arrays
     E                    ##W        20  1
     E                    ##NUMA     29  1
     E*
     E* ##GRP = Group/RDE Number               ##RDEA = RDE + Attributes
     E*
     E********************##GRP   1  23 10   ##RDEA 22                    086918
     E***********         ##GRP   1  24 10   ##RDEA 22              086918CEU014
     E/COPY WNCPYSRC,CG4820E001
     E***********         ##GRP   1  28 10   ##RDEA 22             CEU014 CFT004
     E**********          ##GRP   1  29 10   ##RDEA 22                                 CFT004 CGL031
     E**********          ##GRP   1  33 10   ##RDEA 22                                 CGL031 CER048
     E**********          ##GRP   1  37 10   ##RDEA 22                               CER048 BUG23515
     E**********          ##GRP   1  49 10   ##RDEA 22                               BUG23515 CER054
     E**********          ##GRP   1  56 10   ##RDEA 22                                 CER054 CER055
     E**********          ##GRP   1  67 10   ##RDEA 22                                 CER055 CER049
     E**********          ##GRP   1  69 10   ##RDEA 22                               CER049 MD049504
     E                    ##GRP   1  73 10   ##RDEA 22                                      MD049504
     E/COPY WNCPYSRC,CG4820E002
     E*
     E**  Array of Currencies accessed by program
     E                    ##CY      100  3
     E*
     E**  Copyright array.
     E                    ##CPY   1   1 80
     E/COPY ZSRSRC,ZPOWERZ1                                                                 BUG23986
     I*    ACCOUNT MASTER FILE
     I*
     IACCNT   NS
     I**********                              2   70CNUM1                                     CSD027
     I                                        2   7 CNUM1                                     CSD027
     I                                        8  10 CCY1
     I**********                             11  140ACOD1                                     CGL029
     I                                       11  140QQACO1                                    CGL029
     I                                       15  160ACSQ1
     I                                      190 1990ACNO1
     I                                      401 401 BRTCA
     I                                      449 482 IBAN                  CFT004
     I                                      554 5630ACOD1                                     CGL029
     I*
     IACNUM   NS
     I                                        2  110ACNO1
     I**********                             12  170CNUM1                                     CSD027
     I                                       12  17 CNUM1                                     CSD027
     I                                       18  20 CCY1
     I**********                             21  240ACOD1                                     CGL029
     I**********                             25  260ACSQ1                                     CGL029
     I                                       21  300ACOD1                                     CGL029
     I                                       31  320ACSQ1                                     CGL029
     I*                                                                   050974
     I** BRT ICD                                                          050974
     I*                                                                   050974
     ISDBRTDD0                                                            050974
     I              ACOD                            ACODXX                050974
     I*
     I            DS
     I                                    B   1   20##OSEQ
     I**  Convert Ouput Sequence between Numeric and Binary
     I*
     I            DS
     I                                        1  10 ##GRPX
     I                                        1   6 ##GRPS
     I                                        7  100##RDEN
     IAKEY        DS
     I**********                              1   60##CNUM                                    CSD027
     I                                        1   6 ##CNUM                                    CSD027
     I                                        7   9 ##CCY
     I**********                             10  130##ACOD                                    CGL029
     I**********                             14  150##ACSQ                                    CGL029
     I                                       10  190##ACOD                                    CGL029
     I                                       20  210##ACSQ                                    CGL029
     I**  Look-up string for RDE definition Array
     I*
     I##SDS       DS
     I**********                              15120 ##S                                      BUG9603
     I                                        15632 ##S                                      BUG9603
     I##ADS       DS                           5120                                           234799
     I**  Packed data string.
     I*
     I            DS
     I                                        1  20 ##W
     I                                        1  200##WNUM
     I**  Number Field
     I*
     I            DS
     I                                        1   8 ##ITMA
     I                                        1   80##ITEM
     I*
     I            DS
     I**********                             13  30 ##CAP                                     CGL029
     I                                        7  30 ##CAP                                     CGL029
     I                                        1  30 ##NAR
     I*
     I            DS
     I**********                             13  18 CUSX                                      CGL029
     I**********                             20  22 CCYX                                      CGL029
     I**********                             24  27 ACOX                                      CGL029
     I                                        7  12 CUSX                                      CGL029
     I                                       14  16 CCYX                                      CGL029
     I                                       18  27 ACOX                                      CGL029
     I                                       29  30 SEQX
     I                                        1  30 ##NAR1
     ICAPAC2      DS
     I                                        1   6 CUSX1
     I                                        7   9 CCYX1
     I**********                             10  13 ACOX1                                     CGL029
     I**********                             14  15 SEQX1                                     CGL029
     I**********                             16  18 BRCA1                                     CGL029
     I                                       10  19 ACOX1                                     CGL029
     I                                       20  21 SEQX1                                     CGL029
     I                                       22  24 BRCA1                                     CGL029
      **                                                                                      CGL031
     IDSCSIN      DS                                                                          CGL031
     I                                        1   50WRUND                                     CGL031
     I                                        6   6 WMODI                                     CGL031
     I                                        7  12 WCNUM                                     CGL031
     I                                       13  15 WCCY                                      CGL031
     I**********                             16  190WACOD                              CGL031 CGL035
     I**********                             20  210WACSQ                              CGL031 CGL035
     I**********                             22  24 WBRCA                              CGL031 CGL035
     I                                       16  250WACOD                                     CGL035
     I                                       26  270WACSQ                                     CGL035
     I                                       28  30 WBRCA                                     CGL035
      *                                                                                       CGL031
     I@@PNAR      DS                                                                          CER050
     I                                        8  15 @@W8                                      CER050
     I** Used to convert item reference from character to numeric
     I*
     ISDCURR    E DSSDCURRPD                101
      **  External DS for currency details
      *
     IDSSDY     E DSDSSDY
      **  Second DS for access programs, long data structure
      *
     ISDBRCH    E DSSDBRCHPD
      **  External DS for branch details
      *
     IDSFDY     E DSDSFDY
      **  First DS for access programs, short data structure
      *
     ISDBANK    E DSSDBANKPD
      **  External DS for Bank details
      *
     I##UDCR    E DSCGUDCRPD
      ** External DS for incomplete reference
     IDSPARM    E DSEODPOPD
      *                                                                   CEU014
     ISCSARD    E DSSCSARDPD                                              CEU014
      ** SAR Details Accessed via access program                          CEU014
      *                                                                   CEU014
     ISDGELR    E DSSDGELRPD                                              CEU014
      ** General Ledger Details Accessed Via Access Program               CEU014
      *                                                                   CEU014
     ISDCUST    E DSSDCUSTPD                                              CEU014
     I              QQDFAC                          QQDFA1                                    CGL029
      ** Customer Details Accessed Via Access Program                     CEU014
      *                                                                   CEU014
     ISDCTTX    E DSSDCTTXPD                                                                BUG23515
      *                                                                                     BUG23515
      ** External DS for Country of Tax Codes                                               BUG23515
      *                                                                                     BUG23515
     ISDLOCN    E DSSDLOCNPD                                                                BUG23515
      *                                                                                     BUG23515
      ** External DS for Location Code                                                      BUG23515
      *                                                                                     BUG23515
     ISDACTX    E DSSDACTXPD                                                                  CER069
      *                                                                                       CER069
      ** External DS for Customer Details by Country of Tax                                   CER069
      *                                                                                       CER069
     I##SRDT      DS                         20
      **  DS to store subroutine specific data.
      **  - Saved Path
     I                                        1  70 ##SPAT
     I/COPY CGCPYSRC,CGPACKI
      *
     ICPYR        DS
      **  Data Structure for Compilation - Copyright Insertion
     I                                        1  80 ##CPY
     I            DS
     I**********                              1  15 REIKEY                                    CGL029
     I                                        1  21 REIKEY                                    CGL029
     I**********                              1   60#CNUM                                     CSD027
     I                                        1   6 #CNUM                                     CSD027
     I                                        7   9 #CCY
     I**********                             10  130#ACOD                                     CGL029
     I**********                             14  150#ACSQ                                     CGL029
     I                                       10  190#ACOD                                     CGL029
     I                                       20  210#ACSQ                                     CGL029
      *
      *    STANDARD LOCAL DATA AREA FIELDS
      *
     IRUNDT       DS
      *  DATA AREA RUNDAT
      *
      *
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     IW0FMT     E DSCGUDTAPD
      **  Record format of PF/CGUDTAPD for use as a parameter
      *
     I*---------------------------------------------------------------------
     I* Named constants
     I              'INT_CAP   '          C         #TEXT1
     I              'TRN_CHRG  '          C         #TEXT2
     I              'BASIC     '          C         #TEXT3
      *                                                                   089776
      ** Parameters for call to CG4976.                                   089776
      **                                                                  089776
     IP5PARM      DS                            256                       089776
      * Output Sequence                                                   089776
     I                                        1   90R1OSEQ                089776
      * UDC item number                                                   089776
     I                                       10  170R1ITEM                089776
      * This bind level                                                   089776
     I                                       18  250R1TBIN                089776
      * Previous bind level                                               089776
     I                                       26  330R1PBIN                089776
     IP7PARM      DS                            256                       089776
      * Account Officer                                                   089776
     I                                        1   2 P1ACOF                089776
     I/COPY CGCPYSRC,SRERRI
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  SRINIT - Initial Processing - On First Call    *
      *                SRINZ  - Initialise Fields on Each Invocation  *
      *                SRMAIN - Main Processing                       *
      *****************************************************************
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           W0RTN   7
     C                     PARM           W0CMT   3
     C                     PARM           DSPARM
     C                     PARM           STAX    1                                           CER049
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *................................................................
      *
      **  Initial processing - Once Only
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      **  Initialisation processing
     C                     EXSR SRINZ
      *
      **  Main processing
     C                     EXSR SRMAIN
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRMAIN                                         *
      * Function    :  Main processing                                *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *................................................................
      *
     C                     EXSR SRGENR
      *
     C           ##RTCD    IFEQ 'CGD1270'
     C***********          RETRN                                          103216
     C                     GOTO EXMAIN                                    103216
     C                     ENDIF
      *
     C                     EXSR R02CIC
      *
      *................................................................
      *
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  R02CIC                                         *
      * Function    :  Extract Retail int capitalisation trans charges*
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :                                                 *
      *****************************************************************
     C           R02CIC    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'r02CIC'  @STK,Q
      *
      *................................................................
      *
      **  Set up Path.
     C                     MOVEL'\r02CIC' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
      *                                                                                       CCG015
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
      *
      **  Branch Details
     C                     EXSR BRANCH
      *
      **  Common Details
     C                     EXSR DETL
      *
      **  COB Retail capitalisation int/transaction charges details
     C                     EXSR R02DTL
      *                                                                                       CER048
      ** Secondary Tax                                                                        CER048
      *                                                                                       CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     EXSR CGSTAX                                                        CER048
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     EXSR CGTTAX                                                        CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      **  Customer Details
     C                     EXSR CUST
      *                                                                                       CER055
      **  Overdraft Details                                                                   CER055
      *                                                                                       CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C                     EXSR ODACCT                                                        CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER049
      ** Stamp Tax                                                                            CER049
      *                                                                                       CER049
     C           STAX      IFEQ 'Y'                                                           CER049
     C                     EXSR CHSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                   089776
      ** Counterparty Account Officer Details                             089776
     C                     EXSR ACOF                                      089776
      *
     C/COPY WNCPYSRC,CG4820C003
      *................................................................
      *
     C           EX2CIC    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  BRANCH                                         *
      * Function    :  Branch Details                                 *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           BRANCH    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'BRANCH'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\BRANCH' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
      *                                                                                       CCG015
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Get Branch Details
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG    '##RTCD
     C                     PARM '*KEY    '##OPTN
     C                     PARM BRCA      ##BRCD  3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELBRCA      W0KEY            ***************
     C                     Z-ADD1         W0ERNB           * DB ERROR 01 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Branch
     C                     MOVELA8BRCD    ##D,1
      *
      ** Branch Name
     C                     MOVELA8BRNM    ##D,2
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXBRCH    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  DETL                                           *
      * Function    :  Common Details                                 *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           DETL      BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'DETL  '  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\DETL  ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
      *                                                                                       CCG015
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Run date
     C                     MOVELBJRDNB    ##D,1
      *
      ** Value date
     C                     MOVELVALD      ##D,2
      *
      ** DR/CR Indicator
     C                     MOVELDRCR      ##D,3
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXTL      TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  R02DTL                                         *
      * Function    :  Capitalisation interest/Transaction charges    *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           R02DTL    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'R02DTL'  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
     C           *LIKE     DEFN ##OSEQ    WOSEQ                                               234799
     C                     Z-ADD##OSEQ    WOSEQ                                               234799
      *
      **  Set up Path.
     C                     MOVEL'\R02DTL' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
      *                                                                                       CCG015
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Retail Account Number
     C           ACNO      IFNE *ZEROS
     C                     MOVELACNO      ##D,1
     C                     MOVE *BLANKS   ##D,2
     C                     ELSE
     C**********           Z-ADDCNUM      #CNUM                                               CSD027
     C                     MOVE CNUM      #CNUM                                               CSD027
     C                     MOVELCCY       #CCY
     C                     Z-ADDACOD      #ACOD
     C                     Z-ADDACSQ      #ACSQ
     C                     MOVELREIKEY    ##D,2
     C                     MOVE *BLANKS   ##D,1
     C                     ENDIF
      *
     C                     MOVE *BLANKS   ##NAR
     C                     MOVELPNAR      ##NAR
     C                     MOVELPNAR      @@PNAR                                              CER050
      *
      **  Alternative Retail account number/Alternative account.
     C           ##CAP     IFNE *BLANKS
     C           ##CAP     CHAINACCNT                73
      *
     C           *IN73     IFEQ *ON
      *
     C                     MOVELCUSX      CUSX1
     C                     MOVELCCYX      CCYX1
     C                     MOVELACOX      ACOX1
     C                     MOVELSEQX      SEQX1
     C                     MOVELBRCA      BRCA1
      *
     C           CAPAC2    CHAINACCNT                73
     C                     ENDIF
      *
     C           *IN73     IFEQ *ON
     C                     MOVE PNAR      ACNOX  10
     C           ACNOX     CHAINACNUM                73
     C                     ENDIF
      *
      ** Alternative retail account number
     C                     MOVELACNO1     ##D,3
      *
     C           ACNO1     IFEQ *ZEROS
      *                                                                                     BUG23986
      ** Use current record Values                                                          BUG23986
      *                                                                                     BUG23986
     C**********           Z-ADDCNUM      CNUM1                                      BUG23986 CER059
     C                     MOVE CNUM      CNUM1                                               CER059
     C                     MOVELCCY       CCY1                                              BUG23986
     C                     Z-ADDACOD      ACOD1                                             BUG23986
     C                     Z-ADDACSQ      ACSQ1                                             BUG23986
      *
      ** Alternative account number
     C                     CLEARREIKEY
     C**********           Z-ADDCNUM1     #CNUM                                               CSD027
     C                     MOVE CNUM1     #CNUM                                               CSD027
     C                     MOVELCCY1      #CCY
     C                     Z-ADDACOD1     #ACOD
     C                     Z-ADDACSQ1     #ACSQ
     C                     MOVELREIKEY    ##D,4
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Interest capitalised or transaction charge.
     C                     MOVELPNAR      #W8     8
     C                     MOVELPNAR      @@PNAR                                              CER050
     C           #W8       IFEQ 'INTEREST'
     C           #W8       OREQ 'Interest'                                                 AR1029309
      *                                                                                       CER050
      **      Instead of testing PNAR narrative which may be in any                           CER050
      **      language, test for transaction type.                                            CER050
      *                                                                                       CER050
     C           TRAT      OREQ 91061                                                         CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C           TRAT      OREQ 91062                                                         CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C           @@W8      OREQ 'Interest'                                                    CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C                     MOVEL'I'       ##D,5
     C                     ELSE
     C                     MOVEL'T'       ##D,5
     C                     ENDIF
      *
      ** Capitalised to alternate account.
     C                     MOVEL##CAP     ##D,6
      *
      ** Currency
     C                     MOVELCCY       ##D,7
      *
      **  Retrieve the currency details.
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   ##RTCD           B:Return Cd
     C                     PARM '*KEY'    ##OPTN           I:Option
     C                     PARM CCY       ##CCYP  3        I:Currency Code
     C           SDCURR    PARM *BLANK    DSSDY            O:Format
      *
      **  Database Error
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVEL##CCYP    W0KEY            ***************
     C                     Z-ADD6         W0ERNB           * DB ERROR 06 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C/COPY WNCPYSRC,CG4820C001
      *
      ** Posting Amount
     C                     MOVELPSTA      ##D,8
     C/COPY WNCPYSRC,CG4820C008
     C                     MOVE A6NBDP    ##D,8
      *                                                                   CEU014
      ** If CEU014 is on, defined ##POST and ##INT.                       CEU014
      *                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C           *LIKE     DEFN PSTA      ##POST                          CEU014
     C           *LIKE     DEFN PSTA      ##INT                           CEU014
      *                                                                   CEU014
     C                     Z-ADDPSTA      ##POST                          CEU014
     C                     Z-ADD0         ##INT                           CEU014
     C                     ENDIF                                          CEU014
     C*
     C** If BRT SAR installed
     C** and if Credit Interest Capitalisation
     C*
     C           S01383    IFEQ 'Y'                        B001
     C           DRCR      ANDEQ1
     C*
     C** Access LF/ACCNT for BRT category
     C*
     C**********           Z-ADDCNUM      ##CNUM                                              CSD027
     C                     MOVE CNUM      ##CNUM                                              CSD027
     C                     MOVELCCY       ##CCY
     C                     Z-ADDACOD      ##ACOD
     C                     Z-ADDACSQ      ##ACSQ
     C**********           MOVELAKEY      ACCNTK 18                                           CGL029
     C                     MOVELAKEY      ACCNTK 24                                           CGL029
     C                     MOVE BRCA      ACCNTK
     C           ACCNTK    CHAINACCNT                73
     C*
     C** Chain failure
     C*
     C           *IN73     IFEQ '1'                        B002
     C                     MOVEL'ACCNT   'W0FILE
     C                     MOVELACCNTK    W0KEY            ***************
     C                     Z-ADD2         W0ERNB           * DB ERROR 02 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END                             E002
     C*
     C** If BRT is liable calculate BRT and set indicator
     C*
     C           BRTCA     IFEQ 'L'                        B002
     C           BRTCA     OREQ 'P'
     C*
     C** If Interest Payment Date is prior to Date Effective From
     C** use previous BRT rate, else use current BRT rate
     C*
     C           VALD      IFLT DEFF                       B003
     C                     Z-ADDPBRTR     BRTRT   75
     C                     ELSE                            X003
     C                     Z-ADDBRTR      BRTRT
     C                     END                             E003
     C*
     C***Calculate*Gross*Interest Amount from Posting (Net) Amount        130468
     C******Gross = NET / (1 - Rate/100)                                  130468
      ** Calculate BRT & Net Interest from Gross Amount                   130468
     C*
     C           BRTCA     IFEQ 'P'                        B003
     C           BRTRT     MULT 0.5       WKRATE 135
     C                     ELSE                            X003
     C                     Z-ADDBRTRT     WKRATE
     C                     END                             E003
     C*
     C           WKRATE    DIV  100       WKRATE
     C********** 1         SUB  WKRATE    WKFLD  135                      130468
     C********** PSTA      DIV  WKFLD     GROSI  130H                     130468
     C*
     C***Calculate*Tax = Gross - Net                                      130468
     C*
     C********** GROSI     SUB  PSTA      BRTA   130                      130468
     C           PSTA      MULT WKRATE    BRTA   130H                     130468
     C           PSTA      SUB  BRTA      NETI   130                      130468
      *
      ** Gross Interest
     C**********           MOVELGROSI     ##D,9                           130468
     C/COPY WNCPYSRC,CG4820C009
     C                     MOVELPSTA      ##D,9                           130468
     C/COPY WNCPYSRC,CG4820C010
     C                     MOVE A6NBDP    ##D,9
      *
      ** Less BRT
     C/COPY WNCPYSRC,CG4820C011
     C                     MOVELBRTA      ##D,10
     C/COPY WNCPYSRC,CG4820C012
     C                     MOVE A6NBDP    ##D,10
      *
      ** Net Interest
     C**********           MOVELPSTA      ##D,11                          130468
     C/COPY WNCPYSRC,CG4820C013
     C                     MOVELNETI      ##D,11                          130468
     C/COPY WNCPYSRC,CG4820C014
     C                     MOVE A6NBDP    ##D,11
      *                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C                     Z-ADDPSTA      ##INT                           CEU014
     C                     ENDIF                                          CEU014
      *
      ** BRT Installed
     C                     MOVELS01383    ##D,12
     C                     END                             E002
     C                     END                             E001
      *                                                                   CEU014
      ** CEU014 changes.                                                  CEU014
      *                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
     C                     MOVE *BLANKS   EQCY    3                       CEU014
      *                                                                   CEU014
      **  Retrieve the currency details.                                  CEU014
     C                     CALL 'AOCURRR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD           B:Return Cd    CEU014
     C                     PARM '*KEY'    ##OPTN           I:Option       CEU014
     C                     PARM CCY       ##CCYP  3        I:Currency CodeCEU014
     C           SDCURR    PARM *BLANK    DSSDY            O:Format       CEU014
      *                                                                   CEU014
      **  Database Error                                                  CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCURRPD'W0FILE                          CEU014
     C                     MOVEL##CCYP    W0KEY            ***************CEU014
     C                     Z-ADD22        W0ERNB           * DB ERROR 22 *CEU014
     C                     MOVEL'MEM5004' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** If CCY is 'IN'.                                                  CEU014
     C           A6INCY    IFEQ 'Y'                                       CEU014
     C                     MOVE BKEURO    EQCY                            CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** If CCY is BKEURO.                                                CEU014
     C           CCY       IFEQ BKEURO                                    CEU014
      *                                                                   CEU014
     C** Call Access Program for Customer Details using the Customer      CEU014
     C** No. or the Customer Shortname.                                   CEU014
      *                                                                   CEU014
     C                     MOVELCNUM      WWCNUM 10                       CEU014
     C                     CALL 'AOCUSTR0'                                CEU014
     C                     PARM '*BLANKS' ##RTCD                          CEU014
     C                     PARM '*KEY   ' ##OPTN                          CEU014
     C                     PARM WWCNUM    @KEY1  10                       CEU014
     C                     PARM *BLANKS   @KYST   7                       CEU014
     C           SDCUST    PARM SDCUST    DSSDY                           CEU014
      *                                                                   CEU014
      ** If Customer No./Customer Shortname does not exist...             CEU014
      *                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCUSTPD'W0FILE                          CEU014
     C                     MOVEL@KEY1     W0KEY            ***************CEU014
     C                     Z-ADD17        W0ERNB           * DB ERROR 17 *CEU014
     C                     MOVEL'MEM5004' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** Set Equivalent currency to Designated In ccy.                    CEU014
     C                     MOVE BBDINC    EQCY                            CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** Check if Equivalent currency is not blank.                       CEU014
     C           EQCY      IFNE *BLANKS                                   CEU014
      *                                                                   CEU014
      **  Retrieve the currency details.                                  CEU014
     C                     CALL 'AOCURRR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD           B:Return Cd    CEU014
     C                     PARM '*KEY'    ##OPTN           I:Option       CEU014
     C                     PARM EQCY      ##CCYP  3        I:Currency CodeCEU014
     C           SDCURR    PARM *BLANK    DSSDY            O:Format       CEU014
      *                                                                   CEU014
      **  Database Error                                                  CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
     C                     MOVEL'SDCURRPD'W0FILE                          CEU014
     C                     MOVEL##CCYP    W0KEY            ***************CEU014
     C                     Z-ADD18        W0ERNB           * DB ERROR 18 *CEU014
     C                     MOVEL'MEM5004' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** Convert Posting Amount from CCY to its equivalent ccy.           CEU014
     C                     Z-ADD##POST    P@FRAM                          CEU014
     C                     MOVE CCY       P@FRCY                          CEU014
     C                     MOVE EQCY      P@TOCY                          CEU014
     C                     EXSR R@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,13                          CEU014
     C                     MOVE A6NBDP    ##D,13                          CEU014
      *                                                                   CEU014
      ** Convert Interest amount from CCY to its equivalent ccy.          CEU014
     C                     Z-ADD##INT     P@FRAM                          CEU014
     C                     MOVE CCY       P@FRCY                          CEU014
     C                     MOVE EQCY      P@TOCY                          CEU014
     C                     EXSR R@EURO                                    CEU014
     C                     MOVEL##OUTA    ##D,14                          CEU014
     C                     MOVE A6NBDP    ##D,14                          CEU014
     C                     MOVELEQCY      ##D,15                          CEU014
     C                     MOVELA6CYNM    ##D,16                          CEU014
     C                     ENDIF                                          CEU014
     C/COPY WNCPYSRC,CG4820C006
      *                                                                   CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CFT004
      ** Set up International Bank Account Number (IBAN)                  CFT004
      *                                                                   CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C**********           Z-ADDCNUM      ##CNUM                                       CFT004 CSD027
     C                     MOVE CNUM      ##CNUM                                              CSD027
     C                     MOVELCCY       ##CCY                           CFT004
     C                     Z-ADDACOD      ##ACOD                          CFT004
     C                     Z-ADDACSQ      ##ACSQ                          CFT004
     C**********           MOVELAKEY      KACNM  18                                    CFT004 CGL029
     C                     MOVELAKEY      KACNM  24                                           CGL029
     C                     MOVE BRCA      KACNM                           CFT004
     C           KACNM     CHAINACCNT                22                   CFT004
     C                     MOVE *BLANKS   PIWITH                          CFT004
     C           IBAN      IFNE *BLANKS                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM IBAN      PIBAN  47                       CFT004
     C                     PARM           PIWITH 47                       CFT004
     C                     PARM *BLANKS   PINOBL 34                       CFT004
     C                     ENDIF                                          CFT004
     C                     MOVELPIWITH    ##D,17                          CFT004
     C                     ENDIF                                          CFT004
     C                     EXSR SRADTA                                                        234799
      *                                                                                       234799
      ** Retrieve RDE information for RDEs in group set                                       234799
      *                                                                                       234799
     C                     MOVEL@STK,Q    ##GRPS                                              234799
     C                     Z-ADD21        ##RDEN                                              234799
     C                     EXSR SRRRDE                                                        234799
      *                                                                                       CGL031
      ** CGL031 is installed                                                                  CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     Z-ADDBJRDNB    WRUND                                               CGL031
     C                     MOVE 'G'       WMODI                                               CGL031
     C                     MOVE CNUM      WCNUM                                               CGL031
     C                     MOVE CCY       WCCY                                                CGL031
     C                     Z-ADDACOD      WACOD                                               CGL031
     C                     Z-ADDACSQ      WACSQ                                               CGL031
     C                     MOVE BRCA      WBRCA                                               CGL031
      *                                                                                       CGL031
     C           KCSIN1    CHAINSDCSINL7             25                                       CGL031
      *                                                                                       CGL031
     C********** *IN25     IFEQ *ON                                                    CGL031 233429
     C**********           MOVEL'SDCSINPD'W0FILE                                       CGL031 233429
     C**********           MOVELDSCSIN    W0KEY                                        CGL031 233429
     C**********           Z-ADD26        W0ERNB                                       CGL031 233429
     C**********           MOVEL'MEM5004' W0MSGD                                       CGL031 233429
     C**********           MOVEL'MIDAS  ' W0MSGF                                       CGL031 233429
     C**********           EXSR SRERR                                                  CGL031 233429
     C**********           ENDIF                                                       CGL031 233429
      *                                                                                       CGL031
     C           *IN25     IFEQ *OFF                                                          233429
     C           TSSTAT    IFEQ 'T'                                                           CGL031
      *                                                                                       CGL031
     C                     Z-ADD0         WGINT  180                                          CGL031
     C                     Z-ADD0         WTXSR  180                                          CGL031
     C                     Z-ADD0         WNINT  180                                          CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADD0         WSTXA  180                                          CER048
     C                     Z-ADD0         WGINC  180                                        BUG23986
     C                     Z-ADD0         WPTHU  180                                        BUG23986
     C                     Z-ADD0         WPTUT  180                                        BUG23986
     C                     Z-ADD0         WTXSC  180                                        BUG23986
     C                     Z-ADD0         WSTDT  180                                        BUG23986
     C                     Z-ADD0         WNINC  180                                        BUG23986
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADD0         WTTAXO 180                                          CER054
     C                     Z-ADD0         WTTAXT 180                                          CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
      ** Retrieve original currency details                                                   CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY'    POPTN                                               CGL031
     C                     PARM TSOCCY    PCCY    3                                           CGL031
     C           SDCURR    PARM *BLANK    DSSDY                                               CGL031
      *                                                                                       CGL031
      **  Database Error                                                                      CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANK                                                        CGL031
     C                     MOVEL'SDCURRPD'W0FILE                                              CGL031
     C                     MOVELPCCY      W0KEY                                               CGL031
     C                     Z-ADD27        W0ERNB                                              CGL031
     C                     MOVEL'MEM5004' W0MSGD                                              CGL031
     C                     MOVEL'MIDAS  ' W0MSGF                                              CGL031
     C                     EXSR SRERR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           KCSIN1    SETLLSDCSINL7                                                      CGL031
     C           KCSIN1    READESDCSINL7                 26                                   CGL031
      *                                                                                       CGL031
     C           *IN26     DOWEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     ADD  TSGINT    WGINT                                               CGL031
     C                     ADD  TSTXSR    WTXSR                                               CGL031
     C                     ADD  TSNINT    WNINT                                               CGL031
      *                                                                                       CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           WSTXA     ADD  TSSTDO    WSTXA                                               CER048
     C           WGINC     ADD  TSGINC    WGINC                                             BUG23986
     C           WPTHU     ADD  TSPTHU    WPTHU                                             BUG23986
     C           WPTUT     ADD  TSPTUT    WPTUT                                             BUG23986
     C           WTXSC     ADD  TSTXSC    WTXSC                                             BUG23986
     C           WSTDT     ADD  TSSTDT    WSTDT                                             BUG23986
     C           WNINC     ADD  TSNINC    WNINC                                             BUG23986
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           KCSIN1    READESDCSINL7                 26                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C***********          MOVELWGINT     ##D,18                                       CGL031 234799
     C***********          MOVE A6NBDP    ##D,18                                       CGL031 234799
     C***********          MOVELWTXSR     ##D,19                                       CGL031 234799
     C***********          MOVE A6NBDP    ##D,19                                       CGL031 234799
     C***********          MOVELWNINT     ##D,20                                       CGL031 234799
     C***********          MOVE A6NBDP    ##D,20                                       CGL031 234799
     C                     MOVELWGINT     ##D,1                                               234799
     C                     MOVE A6NBDP    ##D,1                                               234799
     C                     MOVELWTXSR     ##D,2                                               234799
     C                     MOVE A6NBDP    ##D,2                                               234799
     C                     MOVELWNINT     ##D,3                                               234799
     C                     MOVE A6NBDP    ##D,3                                               234799
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              233429
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C/COPY WNCPYSRC,CG4820C004
      *                                                                                       CER050
     C           CER050    IFEQ 'Y'                                                           CER050
     C                     EXSR ZI@APR                                                        CER050
     C                     ENDIF                                                              CER050
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C**********           EXSR SRADTA                                                        234799
     C**********           EXSR SRODTA                                                        CGL031
     C                     MOVEL##SDS     ##ADS                                               234799
      *                                                                                       CGL031
      ** Retrieve RDE information for RDEs in group set                                       CGL031
      *                                                                                       CGL031
     C**********           MOVEL@STK,Q    ##GRPS                                              234799
     C**********           Z-ADD21        ##RDEN                                              234799
     C**********           EXSR SRRRDE                                                        234799
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C**********           MOVEL'CGL031'  ##D,1                                        CGL031 234799
     C                     MOVEL'Y'       ##D,4                                               234799
     C                     ENDIF                                                              CGL031
      *                                                                                       CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C                     MOVEL'Y'       ##D,5                                               CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CGL031
      ** Extract Posting Narrative                                                          MD049504
     C                     MOVELPNAR      ##D,6                                             MD049504
      *                                                                                     MD049504
      ** Accumulate RDE's and associated data and output to                                   CGL031
      ** OF/CGUDTAPD.                                                                         CGL031
     C                     EXSR SRADTA                                                        CGL031
     C                     EXSR SRODTA                                                        CGL031
     C                     MOVE *ZEROS    ACNO1                                             BUG23986
      *
      *................................................................
      *
     C           EX2DTL    TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  CUST                                           *
      * Function    :  Customer Details                               *
      *                                                               *
      * Called by   :                                                 *
      * Calls       :                                                 *
      *****************************************************************
     C           CUST      BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CUST  '  @STK,Q
      *
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\CUST  ' ##PNAM
     C           S#PATH    CAT  ##PNAM:0  S#PATH
      *                                                                                       CCG015
     C                     EXSR PSHGRS                                                        CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** Set up key for client file
     C                     MOVE 'B'       CLKEY   1
     C           KKEY01    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CLKEY
      *
     C           KKEY01    CHAINCLINT                23
      *                                                                   113415
     C           *IN23     IFEQ *OFF                                      113415
     C                     MOVE 'A'       CLKEY   1                       113415
     C           KKEY01    CHAINCLINT                23                   113415
     C                     ENDIF                                          113415
      *
      **  Database Error
     C           *IN23     IFEQ *ON
     C                     MOVEL'CLINT   'W0FILE
     C                     MOVELCNUM      W0KEY            ***************
     C                     Z-ADD7         W0ERNB           * DB ERROR 07 *
     C                     MOVEL'MEM5004' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *                                                                   113415
      ** Customer number                                                  113415
     C                     MOVELCNUM      ##D,1                           113415
      *                                                                   113415
      ** Customer report name                                             113415
     C                     MOVELCRNM      ##D,2                           113415
      *
      ** Customer name and address line 1
     C                     MOVELCNA1      ##D,3
      *
      ** Customer name and address line 2
     C                     MOVELCNA2      ##D,4
      *
      ** Customer name and address line 3
     C                     MOVELCNA3      ##D,5
      *
      ** Customer name and address line 4
     C                     MOVELCNA4      ##D,6
      *                                                                   086918
      ** Customer Town                                                    086918
     C                     MOVELCTWN      ##D,7                           086918
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *................................................................
      *
     C           EXST      TAG
      *
      **  Unwind subroutine stack name
      *                                                                                       CCG015
     C                     EXSR POPGRS                                                        CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************                       CER055
     C/SPACE 5                                                                                CER055
      *****************************************************************                       CER055
      * Subroutine  :  ODACCT                                         *                       CER055
      * Function    :  Overdraft Details                              *                       CER055
      *                                                               *                       CER055
      * Called by   :                                                 *                       CER055
      * Calls       :                                                 *                       CER055
      *****************************************************************                       CER055
     C           ODACCT    BEGSR                                                              CER055
      *                                                                                       CER055
      **  Set up subroutine stack name                                                        CER055
      *                                                                                       CER055
     C                     ADD  1         Q                                                   CER055
     C                     MOVEL'ODACCT'  @STK,Q                                              CER055
      *                                                                                       CER055
      *................................................................                       CER055
      *                                                                                       CER055
      **  Retrieve subroutine specific data.                                                  CER055
      *                                                                                       CER055
     C           1         OCUR ##SRDT                                                        CER055
     C                     MOVEL##SPAT    S#PATH                                              CER055
      *                                                                                       CER055
      **  Set up Path.                                                                        CER055
      *                                                                                       CER055
     C                     MOVEL'\ODACCT' ##PNAM                                              CER055
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                              CER055
      *                                                                                       CER055
     C                     EXSR PSHGRS                                                        CER055
      *                                                                                       CER055
      **  Retrieve RDE information for RDEs in group set                                      CER055
      *                                                                                       CER055
     C                     MOVEL@STK,Q    ##GRPS                                              CER055
     C                     Z-ADD1         ##RDEN                                              CER055
     C                     EXSR SRRRDE                                                        CER055
      *                                                                                       CER055
     C           KACKEY    KLIST                                                              CER055
     C                     KFLD           CNUM                                                CER055
     C                     KFLD           CCY                                                 CER055
     C                     KFLD           ACOD                                                CER055
     C                     KFLD           ACSQ                                                CER055
     C                     KFLD           BRCA                                                CER055
     C           KACKEY    CHAINACCNTBJ0             67                                       CER055
     C           CFT004    IFEQ 'Y'                                                           CER055
     C           IBAN      ANDNE*BLANKS                                                       CER055
     C                     MOVELIBAN      ##D,1                                               CER055
     C                     ELSE                                                               CER055
     C                     MOVELACNO      ##D,1                                               CER055
     C                     ENDIF                                                              CER055
     C                     MOVELCCY       ##D,2                                               CER055
     C                     MOVELCLBL      ##D,3                                               CER055
     C                     MOVELLDBL      ##D,4                                               CER055
     C                     MOVELODLN      ##D,5                                               CER055
     C                     MOVELODED      ##D,6                                               CER055
     C                     MOVELDRIS      ##D,7                                               CER055
     C                     MOVELATAODR    ##D,8                                               CER055
     C                     MOVELATDOBE    ##D,9                                               CER055
     C                     MOVELATNDYE    ##D,10                                              CER055
      *                                                                                       CER055
      **  Accumulate RDE's and associated data and output to                                  CER055
      **  PF/CGUDTAPD.                                                                        CER055
     C                     EXSR SRADTA                                                        CER055
     C                     EXSR SRODTA                                                        CER055
      *                                                                                       CER055
      *................................................................                       CER055
      *                                                                                       CER055
     C           EXODAC    TAG                                                                CER055
      *                                                                                       CER055
      **  Unwind subroutine stack name                                                        CER055
      *                                                                                       CER055
     C                     EXSR POPGRS                                                        CER055
     C                     MOVEA*BLANKS   @STK,Q                                              CER055
     C                     SUB  1         Q                                                   CER055
      *                                                                                       CER055
     C                     ENDSR                                                              CER055
      *****************************************************************                       CER049
      /SPACE 5                                                                                CER049
      *****************************************************************                       CER049
      * Subroutine  :  CHSTAX                                         *                       CER049
      * Function    :  Stamp Tax Details                              *                       CER049
      *                                                               *                       CER049
      * Called by   :                                                 *                       CER049
      * Calls       :                                                 *                       CER049
      *****************************************************************                       CER049
     C           CHSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
      **  Set up subroutine stack name                                                        CER049
      *                                                                                       CER049
     C                     ADD  1         Q                                                   CER049
     C                     MOVEL'CHSTAX'  @STK,Q                                              CER049
      *                                                                                       CER049
      *................................................................                       CER049
      *                                                                                       CER049
      **  Retrieve subroutine specific data.                                                  CER049
      *                                                                                       CER049
     C           1         OCUR ##SRDT                                                        CER049
     C                     MOVEL##SPAT    S#PATH                                              CER049
      *                                                                                       CER049
      **  Set up Path.                                                                        CER049
      *                                                                                       CER049
     C                     MOVEL'\CHSTAX' ##PNAM                                              CER049
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                              CER049
      *                                                                                       CER049
     C                     EXSR PSHGRS                                                        CER049
      *                                                                                       CER049
      **  Retrieve RDE information for RDEs in group set                                      CER049
      *                                                                                       CER049
     C                     MOVEL@STK,Q    ##GRPS                                              CER049
     C                     Z-ADD1         ##RDEN                                              CER049
     C                     EXSR SRRRDE                                                        CER049
      *                                                                                       CER049
      ** Stamp Tax Liable Flag                                                                CER049
      *                                                                                       CER049
     C                     MOVELSTAX      ##D,1                                               CER049
      *                                                                                       CER049
      ** Stamp Tax Amount                                                                     CER049
      *                                                                                       CER049
      ** Retrieve stamp tax currency for the correct decimal places                           CER049
      *                                                                                       CER049
     C                     MOVE ACOD      U#TYPE                                              CER049
     C                     Z-ADDPSTD      U#DATE                                              CER049
     C                     MOVEL'RETAIL'  U#ORGN    P                                         CER049
      *                                                                                       CER049
     C                     CALL 'SD008140'                                                    CER049
     C                     PARM           U#DATE  50                                          CER049
     C                     PARM           U#ORGN 10                                           CER049
     C                     PARM           U#TYPE 10                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
     C                     MOVE U#MTAX    U#STAX 138                                          CER049
     C                     ELSE                                                               CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     MOVE U#CTAX    U#STAX                                              CER049
     C                     ENDIF                                                              CER049
     C                     Z-ADDPSTA      WSTAX  130                                          CER049
      *                                                                                       CER049
     C                     MOVELPNAR      #W8                                                 CER049
     C                     MOVELPNAR      @@PNAR                                              CER050
     C           #W8       IFEQ 'INTEREST'                                                    CER049
     C           DRCR      ANDEQ1                                                             CER049
     C           #W8       OREQ 'Interest'                                                 AR1029309
     C           DRCR      ANDEQ1                                                          AR1029309
     C                     MOVEL'N'       ##D,1                                               CER049
     C                     ELSE                                                               CER049
     C                     MULT U#STAX    WSTAX                                               CER049
     C                     MOVELWSTAX     ##D,2                                               CER049
      *                                                                                       CER049
     C                     CALL 'AOCURRR0'                                                    CER049
     C                     PARM *BLANKS   PRTCD                                               CER049
     C                     PARM '*KEY   ' POPTN                                               CER049
     C                     PARM U#SCCY    ZCCY                                                CER049
     C           SDCURR    PARM SDCURR    DSSDY                                               CER049
      *                                                                                       CER049
      **  Database Error                                                                      CER049
      *                                                                                       CER049
     C           PRTCD     IFNE *BLANK                                                        CER049
     C                     MOVEL'SDCURRPD'W0FILE                                              CER049
     C                     MOVELU#SCCY    W0KEY            ***************                    CER049
     C                     Z-ADD29        W0ERNB           * DB ERROR 15 *                    CER049
     C                     MOVEL'MEM5004' W0MSGD           ***************                    CER049
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER049
     C                     EXSR SRERR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVE A6NBDP    ##D,2                                               CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      **  Accumulate RDE's and associated data and output to                                  CER049
      **  PF/CGUDTAPD.                                                                        CER049
      *                                                                                       CER049
     C                     EXSR SRADTA                                                        CER049
     C                     EXSR SRODTA                                                        CER049
      *                                                                                       CER049
      **...............................................................                       CER049
      **  Unwind subroutine stack name                                                        CER049
      *                                                                                       CER049
     C                     EXSR POPGRS                                                        CER049
     C                     MOVEA*BLANKS   @STK,Q                                              CER049
     C                     SUB  1         Q                                                   CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************
     C/SPACE 5                                                            089776
      *****************************************************************   089776
      * Subroutine  :  ACOF                                           *   089776
      * Function    :  Account Officer Details                        *   089776
      *                                                               *   089776
      * Called by   :                                                 *   089776
      * Calls       :                                                 *   089776
      *****************************************************************   089776
     C           ACOF      BEGSR                                          089776
      *                                                                   089776
      **  Set up subroutine stack name                                    089776
     C                     ADD  1         Q                               089776
     C                     MOVEL'ACOF  '  @STK,Q                          089776
      *                                                                   089776
      *................................................................   089776
      *                                                                   089776
      **  Retrieve subroutine specific data.                              089776
     C           1         OCUR ##SRDT                                    089776
     C                     MOVEL##SPAT    S#PATH                          089776
      *                                                                   089776
      **  Set up data.                                                    089776
     C                     CLEARP7PARM                                    089776
     C                     MOVELACOC      P1ACOF                          089776
      *                                                                   089776
     C                     CLEARP4PARM                                    089776
     C                     MOVELS#PATH    P4PARM                          089776
      *                                                                   089776
     C                     CLEARP5PARM                                    089776
     C                     Z-ADD##OSEQ    R1OSEQ                          089776
     C                     Z-ADD##ITEM    R1ITEM                          089776
     C                     Z-ADDDETBIN    R1TBIN                          089776
     C                     Z-ADDDEPBIN    R1PBIN                          089776
      *                                                                   089776
     C                     CALL 'CG4976'                                  089776
     C                     PARM *BLANKS   W0RTN   7                       089776
     C                     PARM           P7PARM                          089776
     C                     PARM           P4PARM140        Path           089776
     C                     PARM           W0CMT   3                       089776
     C                     PARM           P5PARM                          089776
     C                     PARM           ##REFR                                              CCG015
     C                     PARM           P@ICR                                               CCG015
     C                     PARM 'N'       ##MAST                                              CCG015
      *                                                                   089776
      **  Reset Sequence number.                                          089776
     C                     Z-ADDR1OSEQ    ##OSEQ                          089776
     C                     Z-ADDR1TBIN    DETBIN                          089776
     C                     Z-ADDR1PBIN    DEPBIN                          089776
      *                                                                   089776
      *                                                                   089776
      *                                                                   089776
      *................................................................   089776
      *                                                                   089776
     C           EXACOF    TAG                                            089776
      *                                                                   089776
      **  Unwind subroutine stack name                                    089776
     C                     MOVEA*BLANKS   @STK,Q                          089776
     C                     SUB  1         Q                               089776
      *                                                                   089776
     C                     ENDSR                                          089776
     C*****************************************************************   089776
     C/COPY WNCPYSRC,CG4820C007
      *****************************************************************                       CER050
      * Subroutine  :  ZI@APR                                         *                       CER050
      * Function    :  Extract - Annualised Percentage Rate (APR)     *                       CER050
      *                                                               *                       CER050
      * Called by   :                                                 *                       CER050
      * Calls       :                                                 *                       CER050
      *****************************************************************                       CER050
      *                                                                                       CER050
     C           ZI@APR    BEGSR                                                              CER050
      *                                                                                       CER050
     C           KACKEY    CHAINACCNTBY0             89                                       CER050
      *                                                                                       CER050
     C           *IN89     IFEQ *ON                                                           CER050
     C                     MOVE CNUM      #CNUM                                               CER050
     C                     MOVELCCY       #CCY                                                CER050
     C                     Z-ADDACOD      #ACOD                                               CER050
     C                     Z-ADDACSQ      #ACSQ                                               CER050
     C                     MOVEL'ACCNTBY0'W0FILE                                              CER050
     C                     MOVELREIKEY    ##WK24 24                                           CER050
     C                     MOVE BRCA      ##WK24                                              CER050
     C                     MOVEL##WK24    W0KEY            ***************                    CER050
     C                     Z-ADD900       W0ERNB           * DB ERROR 900*                    CER050
     C                     MOVEL'MEM5004' W0MSGD           ***************                    CER050
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER050
     C                     EXSR SRERR                                                         CER050
     C                     ENDIF                                                              CER050
      *                                                                                       CER050
      *       Instead of testing PNAR narrative which may be in any                           CER050
      *       langauge, test for transaction type.                                            CER050
      *                                                                                       CER050
     C           TRAT      IFEQ 91061                                                         CER050
     C           #W8       ANDNE'Retenci'                                                     CER050
     C           TRAT      OREQ 91062                                                         CER050
     C           #W8       ANDNE'Retenci'                                                     CER050
     C           TRAT      OREQ 91061                                                         CER050
     C           #W8       ANDNE'Withhol'                                                     CER050
     C           TRAT      OREQ 91062                                                         CER050
     C           #W8       ANDNE'Withhol'                                                     CER050
     C           #W8       OREQ 'INTEREST'                                                    CER050
     C           #W8       OREQ 'Interest'                                                    CER050
     C           @@W8      OREQ 'Interest'                                                    CER050
     C           ATAPRC    IFEQ 'Y'                        B002                               CER050
      *                                                                                       CER050
     C           DRCR      IFEQ 0                          B003                               CER050
     C           ACNO      CHAINREAPRHI0             89                                       CER050
     C                     ELSE                            X003                               CER050
     C           ACNO      CHAINREAPRHI1             89                                       CER050
     C                     ENDIF                           E003                               CER050
      *                                                                                       CER050
      * LOOK FOR THE FIRST ELEMENT IN BLANK IN SERIE                                          CER050
     C                     Z-ADD1         R1      20                                          CER050
     C           ##R,R1    DOUEQ*BLANKS                                                       CER050
     C           R1        OREQ 20                                                            CER050
     C                     ADD  1         R1                                                  CER050
     C                     ENDDO                                                              CER050
      *                                                                                       CER050
     C                     CLEARR#DATA                                                        CER050
     C                     CLEARR#DEFN                                                        CER050
     C                     CLEAR#@RDE                                                         CER050
     C                     MOVEL'ZI_AAPR '#@RDE  10                                           CER050
     C           ##RDE     CAT  #@RDE:1   ##RDE                                               CER050
     C                     MOVELIAPRR     R#DATA                                              CER050
     C                     MOVELIAPRR     ##DATA                                              CER050
     C                     MOVEL'Rate  '  ##RDEC                                              CER050
     C                     MOVEL'L'       ##RDET                                              CER050
     C                     MOVEL'2'       ##DCPA                                              CER050
     C                     MOVELR#DATA    ##D,R1                                              CER050
     C                     MOVELR#DEFN    ##R,R1                                              CER050
      *                                                                                       CER050
     C                     END                             E002                               CER050
     C                     END                             E001                               CER050
      *                                                                                       CER050
     C                     ENDSR                                                              CER050
      *****************************************************************                       CER050
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRRDE                                         *
      * Function    :  Retrieve RDE information for RDEs in group set *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  -                                              *
      *****************************************************************
     C           SRRRDE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRRDE'  @STK,Q
      *
      *................................................................
      *
      **  Reset
     C                     MOVEL*BLANK    ##R
     C                     MOVEL*BLANK    ##D
     C                     MOVEL*BLANK    ##S
      *
      **  Get information about next 20 RDEs in group set from compile
      **  time arrays
     C                     Z-ADD0         #1
     C           *IN99     DOUEQ'0'
     C           #1        OREQ 20
     C                     Z-ADD1         #2
     C           ##GRPX    LOKUP##GRP,#2                 99*
     C           *IN99     IFEQ '1'
     C                     ADD  1         #1
     C                     MOVEL##RDEA,#2 ##R,#1
     C                     ADD  1         ##RDEN
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRRDE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRADTA                                         *
      * Function    :  Accumulate RDEs and associated data for output *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG3999 - Format and Pack Data                  *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRADTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRADTA'  @STK,Q
      *
      *................................................................
      *
      **  Reformat RDE data
      *
     C                     EXSR SRRFMN
      *
      **  Pack RDEs and associated data into data string
     C                     CLEAR##SDS
      *                                                                                       CCG015
     C           CCG015    IFEQ 'Y'                                                           CCG015
     C                     MOVEL'*NEWARR 'W0ACT                                               CCG015
     C                     MOVELS#PATH    W0SPAT                                              CCG015
     C                     ELSE                                                               CCG015
     C                     MOVEL'*PACK   'W0ACT                                               CCG015
     C                     MOVEL*BLANK    W0SPAT                                              CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       CCG015
     C                     CALL 'CG3999'
     C                     PARM *BLANK    ##RTCD
     C**********           PARM '*PACK   'W0ACT                                               CCG015
     C                     PARM           W0ACT                                               CCG015
     C                     PARM           ##R
     C                     PARM           ##D
     C                     PARM           ##S
     C                     PARM           W0SPAT 70                                           CCG015
     C                     PARM           ##RN                                                CCG015
     C                     PARM           ##DN                                                CCG015
     C                     PARM           ##FM                                                CCG015
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG3999  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 15 *
     C                     Z-ADD15        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *                                                                                       CCG015
     C                     EXSR WRTRDE                                                        CCG015
      *
      **  Initialise Write Format Parameter.
     C                     CLEARW0FMT
      *
      **  Set up Control Information.
     C                     Z-ADD##ITEM    DEITEM
     C                     ADD  1         ##OSEQ
     C                     Z-ADD##OSEQ    DEOSEQ
     C                     Z-ADD1         DEPBIN
     C                     Z-ADD1         DETBIN
     C                     MOVE 'FR'      DEFSLI
     C                     MOVE *BLANKS   W0PATH
     C                     MOVELS#PATH    W0PATH
      *
      **  Append Data from pack routine.
     C           W0FMT     CAT  ##SDS:0   W0FMT
      *
      *................................................................
      *
     C           EXADTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRFMN                                         *
      * Function    :  Reformat RDE data                              *
      *                                                               *
      * Called by   :  SRADTA                                         *
      * Calls       :                                                 *
      *****************************************************************
     C           SRRFMN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRFMN'  @STK,Q
      *
      *................................................................
      *
      ** Loop through RDE's and data
      *
     C                     Z-ADD0         #1
     C           #1        DOUEQ20
     C                     ADD  1         #1
     C                     MOVEL##R,#1    R#DEFN
     C                     MOVEL##D,#1    R#DATA
      *
      ** If data present and RDE is edited
      *
     C           R#DATA    IFNE *BLANK
     C           ##RDEC    ANDNE*BLANK
      *
      * Reformat Amount
     C                     Z-ADD1         #2
     C           *BLANK    LOKUP##NUMA,#2                99*
     C                     Z-ADD20        #3
     C                     Z-ADD0         ##WNUM
     C           #2        DOWGT1
     C           #2        ANDLE20
     C           #3        ANDGT1
     C                     SUB  1         #2
     C                     MOVEL##NUMA,#2 ##W,#3
     C                     SUB  1         #3
     C                     ENDDO
      *
      * Sign the amount
     C           ##SIGN    IFEQ '-'
     C                     Z-SUB##WNUM    ##NUMB
     C                     ELSE
     C                     Z-ADD##WNUM    ##NUMB
     C                     END
      *
      * Default Edit Type
     C           ##EDTT    IFEQ *BLANK
     C                     MOVEL##RDET    ##EDTT
     C                     END
      *
      * Default Decimal Places
     C           ##DCPA    IFEQ *BLANK
     C                     MOVEL##RDED    ##DCPA
     C                     END
      * New RDE data
     C                     MOVELR#DATA    ##D,#1
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
      *
     C           EXRFMN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRODTA                                         *
      * Function    :  Output Accumulated data to PF/CGUDTAPD         *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG9020 - Output Data to CGUDTAPD               *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRODTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRODTA'  @STK,Q
      *
      *................................................................
      *
      **  Output PF/CGUDTAPD Record.
     C           CCG015    IFEQ 'N'                                                           CCG015
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*WRITE  'W0ACT
     C                     PARM           W0PATH256
     C                     PARM           W0FMT
     C                     PARM *BLANK    W0TITL  7
     C                     PARM *BLANK    W0ULIN  7
     C                     PARM           W0CMT
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG9020  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 16 *
     C                     Z-ADD16        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF                                                              CCG015
      *
      *................................................................
      *
     C           EXODTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRGENR                                         *
      * Function    :  Generate reference number                      *
      *                by writing to PF/CGUDCRPD                      *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :  CG9010 - Create reference record               *
      *****************************************************************
     C           SRGENR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRGENR'  @STK,Q
      *
      *................................................................
      *
      **  Generate reference number and check if further processing
      **  required. Set up all available information in the record
      **  format before calling.
      *
     C                     MOVELBRCA      DRBRCA
     C                     MOVEL'RE'      DRMODI
     C                     MOVELRINO      DRMTRN
     C           ACNO      IFNE *ZEROS
     C                     MOVELACNO      DRMACT
     C                     ELSE
     C**********           Z-ADDCNUM      #CNUM                                               CSD027
     C                     MOVE CNUM      #CNUM                                               CSD027
     C                     MOVELCCY       #CCY
     C                     Z-ADDACOD      #ACOD
     C                     Z-ADDACSQ      #ACSQ
     C                     MOVELREIKEY    DRMACT
     C                     ENDIF
     C                     MOVEL'N'       DRATRM
      *
     C                     MOVELPNAR      #W8     8
     C                     MOVELPNAR      @@PNAR                                              CER050
     C           #W8       IFEQ 'INTEREST'
     C           #W8       OREQ 'Interest'                                                 AR1029309
      *                                                                                       CER050
      **      Instead of testing PNAR narrative which may be in any                           CER050
      **      language, test for transaction type.                                            CER050
      *                                                                                       CER050
     C           TRAT      OREQ 91061                                                         CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C           TRAT      OREQ 91062                                                         CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C           @@W8      OREQ 'INTEREST'                                                    CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C           @@W8      OREQ 'Interest'                                                    CER050
     C           CER050    ANDEQ'Y'                                                           CER050
     C                     MOVEL#TEXT1    DRPTYP
     C                     ELSE
     C                     MOVEL#TEXT2    DRPTYP
     C                     ENDIF
      *
     C                     MOVEL#TEXT3    DRPSTP
      *
     C                     MOVELCNUM      ##CUST
      *
     C                     CALL 'CG9010'
     C                     PARM           ##RTCD  7
     C                     PARM '*GEN'    ##MODE 10
     C                     PARM W0CMT     ##CMT   3
     C                     PARM           ##CUST  6
     C                     PARM           ##UDCR
     C                     PARM           ##ITMA  8
      *
      **  Blank return code implies generate correspondence.
      **  CGD1270 => no error, but suppress output for this transaction.
      *
     C           ##RTCD    IFEQ *BLANK
      *                                                                                       CCG015
      ** Pass reference as printtype:subtype                                                  CCG015
      *                                                                                       CCG015
     C           DRPTYP    CAT  ':':0     COLON  11 P                                         CCG015
     C           COLON     CAT  DRPSTP:0  ##REFR    P                                         CCG015
     C                     EXSR WRAPRF                                                        CCG015
      *
     C                     ELSE
      *
     C           ##RTCD    IFNE 'CGD1270'
     C                     MOVEL'CG9010  'W0FILE
     C                     MOVEL##RTCD    W0KEY            ***************
     C                     Z-ADD5         W0ERNB           * DB ERROR 05 *
     C                     MOVEL'CGD1286' W0MSGD           ***************
     C                     MOVEL'CGUSRMSG'W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      *................................................................
      *
     C           EXGENR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINIT                                         *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  None                                           *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      *................................................................
      *
      ** CALL ACCESS PROGRAM FOR BANK DETAILS
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM '*FIRST  '##OPTN  7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           ##RTCD    IFNE *BLANK
      *
      ** DATABASE ERROR
      *
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD4         W0ERNB           * DB ERROR 04 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      **         IN THE DATAAREA RUNDAT
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C*
     C*
     C** Access SAR details file to determine if BRT SAR is installed
     C*
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'S01383'  @SARD   6
     C           ##RTCD    IFNE *BLANK
     C           ##RTCD    ANDNE'*NRF   '
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD3         W0ERNB           * DB ERROR 03 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C           ##RTCD    IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C*
     C** If BRT SAR installed
     C*
     C           S01383    IFEQ 'Y'                        B001
     C*
     C** Access LF/SDBRTDL1 for BRT RATE and Date Effective From
     C*
     C                     MOVE 'D'       KRECI   1
     C           KRECI     CHAINSDBRTDD0             49
     C           *IN49     IFEQ '1'                        B002
     C                     MOVEL'SDBRTDPD'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD8         W0ERNB           * DB ERROR 08 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END                             E002
     C                     END                             E001
      *                                                                   CEU014
      ** Check if CEU014 (EMU - UDC changes) is on.                       CEU014
      *                                                                   CEU014
     C                     CALL 'AOSARDR0'                                CEU014
     C                     PARM *BLANKS   ##RTCD                          CEU014
     C                     PARM '*VERIFY '##OPTN                          CEU014
     C                     PARM 'CEU014'  @SARD   6                       CEU014
     C           SCSARD    PARM SCSARD    DSFDY                           CEU014
      *                                                                   CEU014
     C           ##RTCD    IFEQ *BLANKS                                   CEU014
     C                     MOVE 'Y'       CEU014  1                       CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** Database Error                                                   CEU014
      *                                                                   CEU014
     C           ##RTCD    IFNE *BLANKS                                   CEU014
     C           ##RTCD    ANDNE'*NRF   '                                 CEU014
      *                                                                   CEU014
     C                     MOVEL'SCSARDPD'W0FILE                          CEU014
     C                     MOVEL'CEU014'  W0KEY            ***************CEU014
     C                     Z-ADD19        W0ERNB           * DB ERROR 19 *CEU014
     C                     MOVEL'MEM5004' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
      ** Call Access Program for General Ledger ICD details               CEU014
      *                                                                   CEU014
     C           CEU014    IFEQ 'Y'                                       CEU014
      *                                                                   CEU014
     C**********           CALL 'AOGELRR0'                                CEU014              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   ##RTCD  7                       CEU014
     C                     PARM '*FIRST  '##OPTN  7                       CEU014
     C********** SDGELR    PARM SDGELR    DSFDY                           CEU014              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   CEU014
     C           ##RTCD    IFNE *BLANK                                    CEU014
      *                                                                   CEU014
      ** Database Error                                                   CEU014
      *                                                                   CEU014
     C                     MOVEL'SDGELRPD'W0FILE                          CEU014
     C                     MOVEL'*CALL'   W0KEY            ***************CEU014
     C                     Z-ADD20        W0ERNB           * DB ERROR 20 *CEU014
     C                     MOVEL'MEM5003' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CFT004
      ** Access SAR details file to determine if CFT004 is installed.     CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM '*VERIFY' POPTN   7                       CFT004
     C                     PARM 'CFT004'  PSARD   6                       CFT004
     C           SCSARD    PARM SCSARD    DSSDY                           CFT004
      *                                                                   CFT004
      ** Database Error                                                   CFT004
      *                                                                   CFT004
     C           PRTCD     IFNE *BLANK                                    CFT004
     C           PRTCD     ANDNE'*NRF   '                                 CFT004
     C                     MOVEL'SCSARDPD'W0FILE           ************   CFT004
     C                     MOVEL'*CALL'   W0KEY            * DBERR 23 *   CFT004
     C                     Z-ADD23        W0ERNB           ************   CFT004
     C                     MOVEL'MEM5003' W0MSGD                          CFT004
     C                     MOVEL'MIDAS  ' W0MSGF                          CFT004
     C                     EXSR SRERR                                     CFT004
     C                     END                                            CFT004
      *                                                                   CFT004
     C                     MOVEL'N'       CFT004                          CFT004
     C           PRTCD     IFEQ *BLANK                                    CFT004
     C                     MOVEL'Y'       CFT004  1                       CFT004
     C                     ENDIF                                          CFT004
      *                                                                                       CCG015
      ** Access SAR details file to determine if CCG015 is installed.                         CCG015
      *                                                                                       CCG015
     C                     CALL 'AOSARDR0'                                                    CCG015
     C                     PARM *BLANKS   PRTCD                                               CCG015
     C                     PARM '*VERIFY' POPTN                                               CCG015
     C                     PARM 'CCG015'  PSARD                                               CCG015
     C           SCSARD    PARM SCSARD    DSFDY                                               CCG015
      *                                                                                       CCG015
      ** Database Error                                                                       CCG015
      *                                                                                       CCG015
     C           PRTCD     IFNE *BLANK                                                        CCG015
     C           PRTCD     ANDNE'*NRF   '                                                     CCG015
     C                     MOVEL'SCSARDPD'W0FILE                                              CCG015
     C                     MOVEL'*CALL'   W0KEY                                               CCG015
     C                     Z-ADD24        W0ERNB                                              CCG015
     C                     MOVEL'MEM5003' W0MSGD                                              CCG015
     C                     MOVEL'MIDAS  ' W0MSGF                                              CCG015
     C                     EXSR SRERR                                                         CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       CCG015
     C           PRTCD     IFEQ *BLANKS                                                       CCG015
     C                     MOVE 'Y'       CCG015  1                                           CCG015
     C                     ELSE                                                               CCG015
     C                     MOVE 'N'       CCG015                                              CCG015
     C                     ENDIF                                                              CCG015
      *                                                                                       CGL031
      ** Access SAR details file to determine if CGL031 is installed.                         CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL031'  PSARD                                               CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANK                                                        CGL031
     C           PRTCD     ANDNE'*NRF   '                                                     CGL031
     C                     MOVEL'SCSARDPD'W0FILE                                              CGL031
     C                     MOVEL'*CALL'   W0KEY                                               CGL031
     C                     Z-ADD25        W0ERNB                                              CGL031
     C                     MOVEL'MEM5003' W0MSGD                                              CGL031
     C                     MOVEL'MIDAS  ' W0MSGF                                              CGL031
     C                     EXSR SRERR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      *                                                                                       CER048
      ** Check if CER048 is installed.                                                        CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANK                                                        CER048
     C           PRTCD     ANDNE'*NRF   '                                                     CER048
     C                     MOVEL'SCSARDPD'W0FILE                                              CER048
     C                     MOVEL'*CALL'   W0KEY                                               CER048
     C                     Z-ADD26        W0ERNB                                              CER048
     C                     MOVEL'MEM5003' W0MSGD                                              CER048
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER048
     C                     EXSR SRERR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048  1                                           CER048
     C                     ELSE                                                               CER048
     C                     MOVE 'N'       CER048                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Check if CER054 is installed.                                                        CER054
      *                                                                                       CER054
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
      *                                                                                       CER054
     C           PRTCD     IFNE *BLANK                                                        CER054
     C           PRTCD     ANDNE'*NRF   '                                                     CER054
     C                     MOVEL'SCSARDPD'W0FILE                                              CER054
     C                     MOVEL'*CALL'   W0KEY                                               CER054
     C                     Z-ADD28        W0ERNB                                              CER054
     C                     MOVEL'MEM5003' W0MSGD                                              CER054
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER054
     C                     EXSR SRERR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     MOVE 'N'       CER054                                              CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054  1                                           CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER055
      ** Check if CER055 is installed.                                                        CER055
      *                                                                                       CER055
     C                     CALL 'AOSARDR0'                                                    CER055
     C                     PARM *BLANKS   PRTCD                                               CER055
     C                     PARM '*VERIFY' POPTN                                               CER055
     C                     PARM 'CER055'  PSARD                                               CER055
     C           SCSARD    PARM SCSARD    DSFDY                                               CER055
      *                                                                                       CER055
     C           PRTCD     IFNE *BLANK                                                        CER055
     C           PRTCD     ANDNE'*NRF   '                                                     CER055
     C                     MOVEL'SCSARDPD'W0FILE                                              CER055
     C                     MOVEL'*CALL'   W0KEY                                               CER055
     C                     Z-ADD28        W0ERNB                                              CER055
     C                     MOVEL'MEM5003' W0MSGD                                              CER055
     C                     MOVEL'MIDAS  ' W0MSGF                                              CER055
     C                     EXSR SRERR                                                         CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C                     MOVE 'N'       CER055                                              CER055
      *                                                                                       CER055
     C           PRTCD     IFEQ *BLANKS                                                       CER055
     C                     MOVE 'Y'       CER055  1                                           CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER054
     C           KCSIN1    KLIST                                                              CGL031
     C                     KFLD           WRUND   50                                          CGL031
     C                     KFLD           WMODI   1                                           CGL031
     C                     KFLD           WCNUM   6                                           CGL031
     C                     KFLD           WCCY    3                                           CGL031
     C**********           KFLD           WACOD   40                                   CGL031 CGL035
     C                     KFLD           WACOD  100                                          CGL035
     C                     KFLD           WACSQ   20                                          CGL031
     C                     KFLD           WBRCA   3                                           CGL031
      *                                                                   CFT004
      *                                                                                       CER050
      ** Access SAR details file to determine if CER050 is installed.                         CER050
      *                                                                                       CER050
     C                     CALL 'AOSARDR0'                                                    CER050
     C                     PARM '       ' ##RTCD                                              CER050
     C                     PARM '*VERIFY' ##OPTN                                              CER050
     C                     PARM 'CER050'  ##SARD  6                                           CER050
      *                                                                                       CER050
     C           ##RTCD    IFEQ *BLANK                                                        CER050
     C                     MOVEL'Y'       CER050  1                                           CER050
     C                     ELSE                                                               CER050
     C                     MOVEL'N'       CER050                                              CER050
     C                     ENDIF                                                              CER050
     C/COPY WNCPYSRC,CG4820C002
      *
      *................................................................
      *
     C           EXINIT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR
     C*****************************************************************   CEU014
     C/SPACE 5                                                            CEU014
      *****************************************************************   CEU014
      * Subroutine  :  R@EURO                                         *   CEU014
      * Function    :  EURO Currency Conversion:                      *   CEU014
      *                Converts P@FRAM in P@FRCY to ##OUTA in P@TOCY. *   CEU014
      * Called by   :  R02DTL                                         *   CEU014
      *                                                               *   CEU014
      * Calls       :  EU0200                                         *   CEU014
      *                SRERR                                          *   CEU014
      *****************************************************************   CEU014
     C           R@EURO    BEGSR                                          CEU014
      *                                                                   CEU014
     C                     Z-ADD0         ##OUTA 130                      CEU014
     C                     CALL 'EU0200'                                  CEU014
     C                     PARM *BLANKS   P@RTCD  7        Return Code    CEU014
     C                     PARM           P@FRAM 183       FROM Ccy AmountCEU014
     C                     PARM           P@FRCY  3        FROM Currency  CEU014
     C                     PARM           P@TOCY  3        TO Currency    CEU014
     C                     PARM           P@OUTA 150       Outright AmountCEU014
     C                     PARM           P@INTA 183       Interim Amount CEU014
     C                     PARM           P@EXRT 159       Exchange Rate  CEU014
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU014
      *                                                                   CEU014
      ** Database error handling:                                         CEU014
      *                                                                   CEU014
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU014
     C                     MOVEL'EU0200  'W0FILE                          CEU014
     C                     MOVEL'*CALL   'W0KEY            ***************CEU014
     C                     Z-ADD21        W0ERNB           * DB ERROR 21 *CEU014
     C                     MOVEL'MEM5003' W0MSGD           ***************CEU014
     C                     MOVEL'MIDAS  ' W0MSGF                          CEU014
     C                     EXSR SRERR                                     CEU014
      *                                                                   CEU014
      ** Otherwise, store amount in settlement currency as ##OUTA         CEU014
      *                                                                   CEU014
     C                     ELSE                                           CEU014
     C                     MOVE P@OUTA    ##OUTA                          CEU014
     C                     ENDIF                                          CEU014
      *                                                                   CEU014
     C                     ENDSR                                          CEU014
     C/COPY WNCPYSRC,CG4820C005
     C*****************************************************************
     C/SPACE 5
      *****************************************************************
      * Subroutine  :  SRINZ                                          *
      * Function    :  Initialise Fields on Program Invocation        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRINZ     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      *................................................................
      *
      **  Initialise work fields
     C                     Z-ADD*ZEROS    ##W050  50
     C                     Z-ADD*ZEROS    ##W150 150
     C                     Z-ADD*ZEROS    #1      60
     C                     Z-ADD*ZEROS    #2      60
     C                     Z-ADD*ZEROS    #3      60
     C                     MOVE *BLANKS   S#PATH256
      *
      **  Initialise output sequence (to CGUDTAPD)
     C                     Z-ADD*ZEROS    ##OSEQ
      *                                                                                       CCG015
      ** Initialise XML increment                                                             CCG015
      *                                                                                       CCG015
     C                     EXSR INIXML                                                        CCG015
      *
     C           EXINZ     TAG
      *
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  CGSTAX                                         *                       CER048
      * Function    :  Secondary tax Details                          *                       CER048
      *                                                               *                       CER048
      * Called by   :  R02CIC                                         *                       CER048
      * Calls       :                                                 *                       CER048
      *****************************************************************                       CER048
      *                                                                                       CER048
     C           CGSTAX    BEGSR                                                              CER048
      *                                                                                       CER048
      ** Set up subroutine stack name                                                         CER048
      *                                                                                       CER048
     C                     ADD  1         Q                                                   CER048
     C                     MOVEL'CGSTAX'  @STK,Q                                              CER048
      *                                                                                       CER048
      ** Retrieve subroutine specific data.                                                   CER048
      *                                                                                       CER048
     C           1         OCUR ##SRDT                                                        CER048
     C                     MOVEL##SPAT    S#PATH                                              CER048
     C                     Z-ADD##OSEQ    WOSEQ                                               CER048
      *                                                                                       CER048
      ** Set up Path.                                                                         CER048
      *                                                                                       CER048
     C                     MOVEL'\CGSTAX' ##PNAM                                              CER048
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                              CER048
      *                                                                                       CER048
     C                     EXSR PSHGRS                                                        CER048
      *                                                                                       CER048
      **  Retrieve RDE information for RDEs in group set                                      CER048
      *                                                                                       CER048
     C                     MOVEL@STK,Q    ##GRPS                                              CER048
     C                     Z-ADD1         ##RDEN                                              CER048
     C                     EXSR SRRRDE                                                        CER048
      *                                                                                     BUG23515
      ** Retrieve Location Code                                                             BUG23515
      *                                                                                     BUG23515
     C                     CALL 'AOLOCNR0'                                                  BUG23515
     C                     PARM *BLANKS   PRTCD                                             BUG23515
     C                     PARM '*KEY   ' POPTN                                             BUG23515
     C                     PARM A8LCCD    PLOCN   3                                         BUG23515
     C           SDLOCN    PARM SDLOCN    DSFDY                                             BUG23515
      *                                                                                     BUG23515
     C           PRTCD     IFNE *BLANKS                                                     BUG23515
     C           ##RTCD    ANDNE'*NRF   '                                                   BUG23515
     C                     MOVEL'SCCTTXPD'W0FILE                                            BUG23515
     C                     MOVEL'*CALL'   W0KEY                                             BUG23515
     C                     Z-ADD30        W0ERNB                                            BUG23515
     C                     MOVEL'MEM5003' W0MSGD                                            BUG23515
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23515
     C                     EXSR SRERR                                                       BUG23515
     C                     END                                                              BUG23515
      *                                                                                     BUG23515
      ** Retrieve Threshold Method                                                          BUG23515
      *                                                                                     BUG23515
     C                     CALL 'AOCTTXR0'                                                  BUG23515
     C                     PARM *BLANKS   PRTCD                                             BUG23515
     C                     PARM '*KEY   ' POPTN                                             BUG23515
     C                     PARM DVCNCD    PCTRT   2                                         BUG23515
     C                     PARM BBCOLC    PCTRR   2                                         BUG23515
     C           SDCTTX    PARM SDCTTX    DSFDY                                             BUG23515
      *                                                                                     BUG23515
     C           PRTCD     IFEQ '*NRF   '                                                   BUG23515
     C                     CALL 'AOCTTXR0'                                                  BUG23515
     C                     PARM *BLANKS   PRTCD                                             BUG23515
     C                     PARM '*KEY   ' POPTN                                             BUG23515
     C                     PARM DVCNCD    PCTRT                                             BUG23515
     C                     PARM *BLANKS   PCTRR                                             BUG23515
     C           SDCTTX    PARM SDCTTX    DSFDY                                             BUG23515
      *                                                                                     BUG23515
     C           PRTCD     IFNE *BLANKS                                                     BUG23515
     C           ##RTCD    ANDNE'*NRF   '                                                   BUG23515
     C                     MOVEL'SCCTTXPD'W0FILE                                            BUG23515
     C                     MOVEL'*CALL'   W0KEY                                             BUG23515
     C                     Z-ADD31        W0ERNB                                            BUG23515
     C                     MOVEL'MEM5003' W0MSGD                                            BUG23515
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23515
     C                     EXSR SRERR                                                       BUG23515
     C                     END                                                              BUG23515
     C                     END                                                              BUG23515
      *                                                                                       CER048
      ** Secondary Tax Amount                                                                 CER048
      *                                                                                       CER048
     C                     MOVELWSTXA     ##D,1                                               CER048
     C**********           MOVE A6NBDP    ##D,1                                      CER048 BUG23986
     C                     MOVE TSOCDP    ##D,1                                             BUG23986
      *                                                                                       CER048
      ** Secondary Tax Basket                                                                 CER048
      *                                                                                       CER048
     C                     MOVELTSSTXB    ##D,2                                               CER048
      *                                                                                       CER048
      ** Secondary Tax Amount Code                                                            CER048
      *                                                                                       CER048
     C                     MOVELTSSTAC    ##D,3                                               CER048
      *                                                                                       CER048
      ** Secondary Tax Rate                                                                   CER048
      *                                                                                       CER048
     C                     MOVELTSSTRA    ##D,4                                               CER048
      *                                                                                     BUG23515
      ** German Features - Taxes                                                            BUG23515
      *                                                                                     BUG23515
     C                     MOVELCER048    ##D,5                                             BUG23515
      *                                                                                     BUG23515
      ** Threshold Method                                                                   BUG23515
      *                                                                                     BUG23515
     C                     MOVELEWTHMD    ##D,6                                             BUG23515
      *                                                                                     BUG23515
      ** Set up Gross Interest in Deal Currency                                             BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSGINT    ##D,7                                    BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,7                                    BUG23515 BUG23986
     C                     MOVELWGINT     ##D,7                                             BUG23986
     C                     MOVE TSOCDP    ##D,7                                             BUG23986
      *                                                                                     BUG23515
      ** Set up Gross Interest in Tax Currency                                              BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSGINC    ##D,8                                    BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,8                                    BUG23515 BUG23986
     C                     MOVELWGINC     ##D,8                                             BUG23986
     C                     MOVE TSTCDP    ##D,8                                             BUG23986
      *                                                                                     BUG23986
      ** Key for reading per deal/account                                                   BUG23986
      *                                                                                     BUG23986
     C**********           MOVELTSCUST    W0CUST  60                                 BUG23986 CER059
     C                     MOVELTSCUST    W0CUST  6                                         BUG23986
     C           ACNTKY    KLIST                                                            BUG23986
     C                     KFLD           W0CUST                                            BUG23986
     C                     KFLD           TSOCCY                                            BUG23986
     C                     KFLD           TSACOD                                            BUG23986
     C                     KFLD           TSACSQ                                            BUG23986
     C                     KFLD           TSBRCA                                            BUG23986
     C           ACNTKY    CHAINACCNTBJ0             67                                     BUG23986
      *                                                                                     BUG23986
     C                     MOVE *BLANKS   WCONV                                             BUG23986
     C                     Z-ADD0         FPTHU  150                                        BUG24190
     C                     Z-ADD0         FPTUT  150                                        BUG24190
      *                                                                                     BUG23986
      * If Tax value at Account level is 'A', this means the EU Tax                           CER069
      * indicator at Customer level should be used to determine whether                       CER069
      * the account is taxable.                                                               CER069
     C           *IN67     IFEQ '0'                                                           CER069
     C           ATITAX    ANDEQ'A'                                                           CER069
      *                                                                                       CER069
     C                     CALL 'AOACTXR0'                                                    CER069
     C                     PARM *BLANKS   ##RTCD                                              CER069
     C                     PARM '*KEY   ' ##OPTN                                              CER069
     C                     PARM CNUM      ##CUST  6                                           CER069
     C                     PARM BRCA      ##BRCD  3                                           CER069
     C           SDACTX    PARM SDACTX    DSSDY                                               CER069
      *                                                                                       CER069
     C           ##RTCD    IFNE *BLANKS                                                       CER069
     C           ##RTCD    OREQ *BLANKS                                                       CER069
     C           AXETXS    ANDEQ'S'                                                           CER069
     C           ##RTCD    OREQ *BLANKS                                                       CER069
     C           AXETXS    ANDEQ'D'                                                           CER069
     C           ##RTCD    OREQ *BLANKS                                                       CER069
     C           AXETXS    ANDEQ'E'                                                           CER069
     C           ##RTCD    OREQ *BLANKS                                                       CER069
     C           AXETXS    ANDEQ' '                                                           CER069
     C                     MOVE 'N'       ATITAX                                              CER069
     C                     ELSE                                                               CER069
     C                     MOVE AXETXS    ATITAX                                              CER069
     C                     ENDIF                                                              CER069
      *                                                                                       CER069
     C                     ENDIF                                                              CER069
      *                                                                                       CER069
      ** Taxable interest in Deal & Tax CCY                                                 BUG23986
      *                                                                                     BUG23986
     C                     SELEC                                                            BUG23986
      *                                                                                     BUG23986
     C           ATITAX    WHEQ 'N'                                                         BUG23986
     C**********           Z-ADD0         WPTHU                                    BUG23986 BUG24190
     C**********           Z-ADD0         WPTUT                                    BUG23986 BUG24190
     C                     Z-ADD0         FPTHU                                             BUG24190
     C                     Z-ADD0         FPTUT                                             BUG24190
      *                                                                                     BUG23986
     C           ATITAX    WHEQ 'Y'                                                         BUG23986
     C**********           Z-ADDWGINT     WPTHU                                    BUG23986 BUG24190
     C**********           Z-ADDWGINC     WPTUT                                    BUG23986 BUG24190
     C                     Z-ADDWGINT     FPTHU                                             BUG24190
     C                     Z-ADDWGINC     FPTUT                                             BUG24190
      *                                                                                     BUG23986
     C           ATITAX    WHEQ 'T'                                                         BUG23986
     C********** TSPTHU    IFGE *ZERO                                              BUG23986 BUG24190
     C**********           Z-ADD0         WPTHU                                    BUG23986 BUG24190
     C**********           Z-ADD0         WPTUT                                    BUG23986 BUG24190
      **********                                                                   BUG23986 BUG24190
     C**********           ELSE                                                    BUG23986 BUG24190
      **********                                                                   BUG23986 BUG24190
     C**********           Z-SUBWPTHU     WPTHU                                    BUG23986 BUG24190
     C**********           Z-SUBWPTUT     WPTUT                                    BUG23986 BUG24190
     C                     MOVE 'Y'       WCONV   1                                         BUG23986
      *                                                                                     BUG24190
     C           TSOCCY    IFEQ BJCYCD                                                      BUG24190
     C           WGINT     SUB  WPTHU     FPTHU                                             BUG24190
     C           WGINC     SUB  WPTUT     FPTUT                                             BUG24190
      *                                                                                     BUG23986
     C                     ENDIF                                                            BUG23986
      *                                                                                     BUG23986
     C                     ENDSL                                                            BUG23986
      *                                                                                     BUG23986
     C           WCONV     IFEQ 'Y'                                                         BUG23986
      *                                                                                     BUG23986
     C           TSOCCY    ANDNEBJCYCD                                                      BUG23986
      *                                                                                     BUG23986
     C                     MOVE BJCYCD    ZCCY                                              BUG23986
      *                                                                                     BUG23986
     C                     CALL 'AOCURRR0'                                                  BUG23986
     C                     PARM *BLANKS   PRTCD                                             BUG23986
     C                     PARM '*KEY   ' POPTN                                             BUG23986
     C                     PARM           ZCCY    3                                         BUG23986
     C           SDCURR    PARM SDCURR    DSSDY                                             BUG23986
      *                                                                                     BUG23986
     C           A6MDIN    IFEQ 'D'                                                         BUG23986
     C                     Z-ADDA6SPRT    ZRATE1 138                                        BUG23986
     C                     ELSE                                                             BUG23986
     C           A6SPRT    SUB  A6TCMP    WSPRT  138                                        BUG23986
     C           1         DIV  WSPRT     ZRATE1    H                                       BUG23986
     C                     ENDIF                                                            BUG23986
      *                                                                                     BUG23986
     C                     MOVE 'D'       ZMDI1   1                                         BUG23986
     C                     Z-ADDA6NBDP    ZCDPI   10                                        BUG23986
      *                                                                                     BUG23986
     C                     MOVE TSOCCY    ZCCY                                              BUG23986
      *                                                                                     BUG23986
     C                     CALL 'AOCURRR0'                                                  BUG23986
     C                     PARM *BLANKS   PRTCD                                             BUG23986
     C                     PARM '*KEY   ' POPTN                                             BUG23986
     C                     PARM           ZCCY    3                                         BUG23986
     C           SDCURR    PARM SDCURR    DSSDY                                             BUG23986
      *                                                                                     BUG23986
      ** Get Rate for conversion from Base - Deal Ccy                                       BUG23986
      *                                                                                     BUG23986
     C           A6MDIN    IFEQ 'D'                                                         BUG23986
     C                     Z-ADDA6SPRT    ZRATE2 138                                        BUG23986
     C                     ELSE                                                             BUG23986
     C           A6SPRT    SUB  A6TCMP    WSPRT  138                                        BUG23986
     C********** 1         DIV  WSPRT     ZRATE1    H                             BUG23986 BUG23986A
     C           1         DIV  WSPRT     ZRATE2    H                                      BUG23986A
     C                     ENDIF                                                            BUG23986
      *                                                                                     BUG23986
     C                     MOVE 'D'       ZMDI2   1                                         BUG23986
     C                     Z-ADDA6NBDP    ZCDPO   10                                        BUG23986
      *                                                                                     BUG23986
     C                     EXSR ZXRATE                                                      BUG23986
      *                                                                                     BUG23986
     C                     Z-ADDZRATEX    ZCRSRT                                            BUG23986
     C                     MOVE ZMDI1     ZCRSMD                                            BUG23986
     C                     Z-ADDZCDPI     ZCDPF                                             BUG23986
     C                     Z-ADDZCDPO     ZCDPT                                             BUG23986
      *                                                                                     BUG23986
      ** Convert to Taxable Interest into Deal Ccy                                          BUG23986
      *                                                                                     BUG23986
     C                     Z-ADD0         ZAMTT                                             BUG23986
     C                     Z-ADDWPTHU     ZAMTF                                             BUG23986
     C                     EXSR ZCCYXR                                                      BUG23986
     C**********           MOVELZAMTT     WPTHU                                   BUG23986 BUG23986A
     C                     MOVE ZAMTT     WPTHU                                            BUG23986A
      *                                                                                     BUG24190
     C           WGINT     SUB  WPTHU     FPTHU                                             BUG24190
     C           WGINC     SUB  WPTUT     FPTUT                                             BUG24190
     C                     ENDIF                                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Taxable Interest in Deal Currency                                           BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSPTHU    ##D,9                                    BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,9                                    BUG23515 BUG23986
     C**********           MOVELWPTHU     ##D,9                                    BUG23986 BUG24190
     C                     MOVELFPTHU     ##D,9                                             BUG24190
     C                     MOVE TSOCDP    ##D,9                                             BUG23986
      *                                                                                     BUG23515
      ** Set up Taxable Interest in Tax Currency                                            BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSPTUT    ##D,10                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,10                                   BUG23515 BUG23986
     C**********           MOVELWPTUT     ##D,10                                   BUG23986 BUG24190
     C                     MOVELFPTUT     ##D,10                                            BUG24190
     C                     MOVE TSTCDP    ##D,10                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Withholding Tax in Deal Currency                                            BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSTXSR    ##D,11                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,11                                   BUG23515 BUG23986
     C                     MOVELWTXSR     ##D,11                                            BUG23986
     C                     MOVE TSOCDP    ##D,11                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Withholding Tax in Tax Currency                                             BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSTXSC    ##D,12                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,12                                   BUG23515 BUG23986
     C                     MOVELWTXSC     ##D,12                                            BUG23986
     C                     MOVE TSTCDP    ##D,12                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Secondary Tax in Deal Currency                                              BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSSTDO    ##D,13                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,13                                   BUG23515 BUG23986
     C                     MOVELWSTXA     ##D,13                                            BUG23986
     C                     MOVE TSOCDP    ##D,13                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Secondary Tax in Tax Currency                                               BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSSTDT    ##D,14                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,14                                   BUG23515 BUG23986
     C                     MOVELWSTDT     ##D,14                                            BUG23986
     C                     MOVE TSTCDP    ##D,14                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Net Interest in Deal Currency                                               BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSNINT    ##D,15                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,15                                   BUG23515 BUG23986
     C                     MOVELWNINT     ##D,15                                            BUG23986
     C                     MOVE TSOCDP    ##D,15                                            BUG23986
      *                                                                                     BUG23515
      ** Set up Net Interest in Tax Currency                                                BUG23515
      *                                                                                     BUG23515
     C**********           MOVELTSNINC    ##D,16                                   BUG23515 BUG23986
     C**********           MOVE A6NBDP    ##D,16                                   BUG23515 BUG23986
     C                     MOVELWNINC     ##D,16                                            BUG23986
     C                     MOVE TSTCDP    ##D,16                                            BUG23986
      *                                                                                       CER048
      ** Accumulate RDE's and associated data and output to                                   CER048
      ** PF/CGUDTAPD.                                                                         CER048
      *                                                                                       CER048
     C                     EXSR SRADTA                                                        CER048
     C                     EXSR SRODTA                                                        CER048
      *                                                                                    BUG23986A
      ** Remove Current customer detail                                                    BUG23986A
      *                                                                                    BUG23986A
     C                     CLEARTSCUST                                                     BUG23986A
     C                     CLEARWSTXA                                                      BUG23986A
     C                     CLEARTSSTXB                                                     BUG23986A
     C                     CLEARTSSTAC                                                     BUG23986A
     C                     CLEARTSSTRA                                                     BUG23986A
     C                     CLEARWGINT                                                      BUG23986A
     C                     CLEARWGINC                                                      BUG23986A
     C                     CLEARWPTHU                                                      BUG23986A
     C                     CLEARWPTUT                                                      BUG23986A
     C                     CLEARWTXSR                                                      BUG23986A
     C                     CLEARWTXSC                                                      BUG23986A
     C                     CLEARWSTDT                                                      BUG23986A
     C                     CLEARWNINT                                                      BUG23986A
     C                     CLEARWNINC                                                      BUG23986A
      *                                                                                       CER048
     C           EXSTAX    TAG                                                                CER048
      *                                                                                       CER048
      ** Unwind subroutine stack name                                                         CER048
      *                                                                                       CER048
     C                     EXSR POPGRS                                                        CER048
     C                     MOVEA*BLANKS   @STK,Q                                              CER048
     C                     SUB  1         Q                                                   CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CER048
      *                                                                                       CER048
      *****************************************************************
      * Subroutine  :  CGTTAX                                         *                       CER054
      * Function    :  Third Tax Details                              *                       CER054
      *                                                               *                       CER054
      * Called by   :  R02CIC                                         *                       CER054
      * Calls       :                                                 *                       CER054
      *****************************************************************                       CER054
     C           CGTTAX    BEGSR                                                              CER054
      *                                                                                       CER054
      **  Set up subroutine stack name                                                        CER054
      *                                                                                       CER054
     C                     ADD  1         Q                                                   CER054
     C                     MOVEL'CGTTAX'  @STK,Q                                              CER054
      *                                                                                       CER054
      **  Retrieve subroutine specific data.                                                  CER054
      *                                                                                       CER054
     C           1         OCUR ##SRDT                                                        CER054
     C                     MOVEL##SPAT    S#PATH                                              CER054
      *                                                                                       CER054
      ** Set up Path.                                                                         CER054
      *                                                                                       CER054
     C                     MOVEL'\CGTTAX' ##PNAM                                              CER054
     C           S#PATH    CAT  ##PNAM:0  S#PATH                                              CER054
     C                     EXSR PSHGRS                                                        CER054
      *                                                                                       CER054
      ** Retrieve RDE information for RDEs in group set                                       CER054
      *                                                                                       CER054
     C                     MOVEL@STK,Q    ##GRPS                                              CER054
     C                     Z-ADD1         ##RDEN                                              CER054
     C                     EXSR SRRRDE                                                        CER054
      *                                                                                       CER054
      *                                                                                       CER054
      ** Third tax amount in deal currency                                                    CER054
      *                                                                                       CER054
     C                     MOVELWTTAXO    ##D,1                                               CER054
     C                     MOVE A6NBDP    ##D,1                                               CER054
      *                                                                                       CER054
      ** Third tax amount in tax currency                                                     CER054
      *                                                                                       CER054
     C                     MOVELWTTAXT    ##D,2                                               CER054
     C                     MOVE TSTXCY    ##D,2                                               CER054
      *                                                                                       CER054
      ** Third tax rate                                                                       CER054
      *                                                                                       CER054
     C                     MOVELTSTTRA    ##D,3                                               CER054
      *                                                                                       CER054
      ** Third tax basket                                                                     CER054
      *                                                                                       CER054
     C                     MOVELTSTTXB    ##D,4                                               CER054
      *                                                                                       CER054
      ** Third tax account code                                                               CER054
      *                                                                                       CER054
     C                     MOVELTSTTAC    ##D,5                                               CER054
      *                                                                                       CER054
      ** State Code                                                                           CER054
      *                                                                                       CER054
     C                     MOVELTSSTCD    ##D,6                                               CER054
      *                                                                                       CER054
      ** Religious affiliation code                                                           CER054
      *                                                                                       CER054
     C                     MOVELTSRLAF    ##D,7                                               CER054
      *                                                                                       CER054
      ** Unwind subroutine stack name                                                         CER054
      *                                                                                       CER054
     C                     EXSR POPGRS                                                        CER054
     C                     MOVEA*BLANKS   @STK,Q                                              CER054
     C                     SUB  1         Q                                                   CER054
      *                                                                                       CER054
     C                     ENDSR                                                              CER054
      *****************************************************************                       CER054
     **********R02DTL0021 EUTAX INST                                                   CGL031 234799
     C/COPY ZSRSRC,ZXRATEZ1                                                                 BUG23986
     C/COPY ZSRSRC,ZCCYXR                                                                   BUG23986
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRPSSR
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRC
     C/SPACE 5                                                                                CCG015
     C/COPY CGCPYSRC,CGNWEX                                                                   CCG015
      *R02DTL0024 EUTAX INST                                                           CGL031 234799
** ##GRP/##RDE
BRANCH0001 BRANCH
BRANCH0002 BRANCH NAM
DETL  0001 RUNDAT     Date
DETL  0002 VALUE DATE Date
DETL  0003 DR/CRIND
R02DTL0001 RETL_ACNO
R02DTL0002 ACCOUNT
R02DTL0003 ARETL_ACNO
R02DTL0004 ALTACCOUNT
R02DTL0005 INTC/TRNC
R02DTL0006 CAPTO_ALTA
R02DTL0007 CURRENCY
R02DTL0008 POST_AMT   AmountL
R02DTL0009 GRS INTRST AmountL
R02DTL0010 LESS BRT   AmountL
R02DTL0011 NET INTRST AmountL
R02DTL0012 BRT INSTAL
R02DTL0013 POST_EQCY  AmountL                                             CEU014
R02DTL0014 N_INT_EQCY AmountL                                             CEU014
R02DTL0015 EQUIV_CCY                                                      CEU014
R02DTL0016 EQUIV_CCYD                                                     CEU014
R02DTL0017 IBAN                                                           CFT004
R02DTL0018 GRS INT OC AmountL                                                                 CGL031
R02DTL0019 TAX AMT OC AmountL                                                                 CGL031
R02DTL0020 NET INT OC AmountL                                                                 CGL031
R02DTL0021 GRS INT OC AmountL                                                               MD049504
R02DTL0022 TAX AMT OC AmountL                                                               MD049504
R02DTL0023 NET INT OC AmountL                                                               MD049504
R02DTL0024 CGL031                                                                           MD049504
R02DTL0025 CER055F                                                                          MD049504
R02DTL0026 POST_NARR                                                                        MD049504
ODACCT0001 ACCNUM                                                                             CER055
ODACCT0002 CURRENCY                                                                           CER055
ODACCT0003 CLRDBAL    AmountL                                                                 CER055
ODACCT0004 LDGRBAL    AmountL                                                                 CER055
ODACCT0005 ODLIMIT    AmountL                                                                 CER055
ODACCT0006 ODLMTEXPDT Date                                                                    CER055
ODACCT0007 DEBINTRTE  Rate  L7                                                                CER055
ODACCT0008 ODINTRATE  Rate  L7                                                                CER055
ODACCT0009 DTEODBAL   Date                                                                    CER055
ODACCT0010 NUMDAYS                                                                            CER055
CUST  0001 CUSTOMER
CUST  0002 CUST_NAME
CUST  0003 CUST_ADR1
CUST  0004 CUST_ADR2
CUST  0005 CUST_ADR3
CUST  0006 CUST_ADR4
CUST  0007 CUST_TOWN                                                      086918
CGSTAX0001 SEC_TAXA   AmountL                                                        CER048 BUG23986
CGSTAX0002 SEC_TAXB                                                                           CER048
CGSTAX0003 SEC_TXAC                                                                  CER048 BUG23986
CGSTAX0004 SEC_TAXR   Rate  L4                                                       CER048 BUG23986
CGSTAX0005 CER048                                                                           BUG23515
CGSTAX0006 THRSH_METH                                                                       BUG23515
CGSTAX0007 ZZFGINTC   AmountL                                                               BUG23515
CGSTAX0008 ZZFGINTD   AmountL                                                               BUG23515
CGSTAX0009 ZZFTINTC   AmountL                                                               BUG23515
CGSTAX0010 ZZFTINTD   AmountL                                                               BUG23515
CGSTAX0011 ZZFWHTC    AmountL                                                               BUG23515
CGSTAX0012 ZZFWHTB    AmountL                                                               BUG23515
CGSTAX0013 ZZFSCNC    AmountL                                                               BUG23515
CGSTAX0014 ZZFSCNB    AmountL                                                               BUG23515
CGSTAX0015 ZZFNINTC   AmountL                                                               BUG23515
CGSTAX0016 ZZFNINTD   AmountL                                                               BUG23515
CGTTAX0001 ZZFCHTC AmountL                                                                    CER054
CGTTAX0002 ZZFCHTB AmountL                                                                    CER054
CGTTAX0003 ZZFCHRT Rate L5                                                                    CER054
CGTTAX0004 THD_TAXB                                                                           CER054
CGTTAX0005 THD_TXAC                                                                           CER054
CGTTAX0006 THD_STAC                                                                           CER054
CGTTAX0007 THD_RELA                                                                           CER054
CHSTAX0001 ZSTAXFLG                                                                           CER049
CHSTAX0002 Z_TAX_AMT  AmountL                                                                 CER049
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                         BUG23986
0000001                                                                                     BUG23986
0000010                                                                                     BUG23986
0000100                                                                                     BUG23986
0001000                                                                                     BUG23986
0010000                                                                                     BUG23986
0100000                                                                                     BUG23986
1000000                                                                                     BUG23986
