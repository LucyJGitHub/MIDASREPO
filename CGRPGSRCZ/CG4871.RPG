     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Correspondence Manager Module                        *
     F*                                                               *
     F*  CG4861 - RE Interest Capitalisation Statement (CM) - Extract *
     F*           This program is patterned after REL070.             *
     F*                                                               *
     F*  Print type/subtype : RETAIL / INTCAP                         *
     F*  top level groupset : REL070                                  *
     F*                                                               *
     F*  Called By: CG4861 - RE Capitalisation driver                 *
     F*                                                               *
     F*  (c) Finastra International Limited 2021                      *
     F*                                                               *
      *  Last Amend No. MD059851           Date 27May21               *
      *  Prev Amend No. MD058206           Date 27May21               *
      *                 EMP108  *Create    Date 09Feb21               *
      *                 xxxxxx             Date ddmmmyy               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD059851 - Retail Interest Tiered structures not shown       *
      *             entirely on the Interest Capitalisation Statement *
      *  MD058206 - Negative credit interest shown as positive on      *
      *            extract.                                           *
     F*  EMP108 - Retail Interest Capitalisation Statement via CM     *
     F*                                                               *
     F*****************************************************************
     FCLINT   IF  E           K        DISK
     F*----- LF Customer Master -----
     FREHISL  IF  E           K        DISK
     F*----- LF RE Interest History -------
     FREHISSL IF  E           K        DISK
     F            REHISPSF                          KRENAMEREADJF
     F*----- LF RE History Capitalisation --------
     FRECOM   IF  E           K        DISK
     F*----- LF RE Commissions (by Account) ------
     FREHPOPL IF  E           K        DISK
     F            REHPOSPF                          KRENAMEREHPOPLF
     F*----- LF RE Postings history (by Account/Date) -----
     FREHPOPH IF  E           K        DISK
     F            REHPOSPF                          KRENAMEREHPOPHF
     F*----- LF RE History Postings & Rate changes (by Account/Posting date/History date)
     FACCRACJ IF  E           K        DISK
     F*----- Joinfile RE Interest & Charges accrued to-date ----------
     FREHRDJ  IF  E           K        DISK
     F*----- Joinfile RE History : Debit Rate changes ----------------
     FREHRCJ  IF  E           K        DISK
     F*----- Joinfile RE History : Credit Rate changes ---------------
     FREHPOML2IF  E           K        DISK
     F*----- LF RE History: Manual adjustments -----------------------
     FTABTBRE IF  E                    DISK                           UC
     F*----- PF Retail III Table File --------------------------
     FRECRG   IF  E           K        DISK
     F            RECRGAF                           KIGNORE
     F            RECRGZF                           KIGNORE
     F*----- LF RE Charges (Detail records only)----------------------
     FSDCURRL0IF  E           K        DISK
     F*----- LF Currencies -------------------------------------------
     FSDMMODPDIF  E                    DISK
     F*----- PF SD Midas modules--------------------------------------
     FRETAXJL IF  E           K        DISK
     F*----- Joinfile Retail taxes (by account) ----------------------
     FACCNT   IF  E           K        DISK
     F*----- LF Account Master file (by account) ----------------------
     FSDBRTDL1IF  E           K        DISK
     F*----- LF Basic Rate Tax (BRT) Control data ---------------------
     F/COPY WNCPYSRC,RE3761F001
     F*****************************************************************
     F*                                                               *
     F*   F U N C T I O N   O F   I N D I C A T O R S                 *
     F*   ===========================================                 *
     F*   01  DEBIT CAPITALISATION                                    *
     F*   02  CREDIT CAPITALISATION                                   *
     F*   20  IN CASE OF BACK VALUE PROCESSING                        *
     F*   22  OUTPUT BRT DETAILS TO REPORT                            *
     F*   23  PRINT CUSTOMER ADDRESS DETAILS                          *
     F*   30  CAPITALISATION IS ON DEMAND OR FOR MANAGEMENT STMT.     *
     F*   41  TO PRINT SIGN FOR WITHHOLDING TAX                       *
     F*   48  TOTAL CREDITED                                          *
     F*   49  TOTAL DEBITED                                           *
     F*   50  USE WITH REDETM                                         *
     F*                                                               *
     F*   51  USE WITH REHISL                                         *
     F*   52  USE WITH REHISL                                         *
     F*   53  Hist.date >=  Prev.Interest date (Credit)               *
     F*   54  Hist.date >=  Prev.Interest date (Debit)                *
     F*   55  Do not report exchange rate for alt. a/c in diff. ccy   *
     F*   60  USE WITH REHRDJ AND REHRCJ                              *
     F*   70  MANAGEMENT STATEMENT PRINT                              *
     F*   73  OVERFLOW INDICATORE ON PRINTER FOR DEBIT AND CREDIT     *
     F*   80  NUMBER OF DECIMAL POSITION WITH CURRENCY = 0            *
     F*   81  NUMBER OF DECIMAL POSITION WITH CURRENCY = 1            *
     F*   82  NUMBER OF DECIMAL POSITION WITH CURRENCY = 2            *
     F*   83  NUMBER OF DECIMAL POSITION WITH CURRENCY = 3            *
     F*   84  Tiered interest                                         *
     F*   85  Threshold interest                                      *
     F*                                                               *
     F*   79  MULTIBRANCHING OUTPUT INDICATOR                         *
     F*   86  MULTIBRANCHING INDICATOR MBIN = 'Y'                     *
     F*   87  CAPITALISATION TO AN ACCOUNT IN DIFFERENT CURRENCY      *
     F*   88  CHARGES FOR MULTIPLE TRANSACTION PRESENT                *
     F*   89  USE TO PRINT END OF AUDIT WHEN DB ERROR                 *
     F*   96  CURRENCIES ARRAY IS FULL                                *
     F*   97  USE IF CURRENCY EXIST                                   *
     F*   98  DATF = M                                                *
     F*   99  GENERAL ERROR AND CHAINING                              *
     F*                                                               *
     F*   U7  DATABASE ERROR                                          *
     F*   U8  DATABASE ERROR                                          *
     F*   LR  END OF PROGRAM                                          *
     F*                                                               *
     F*   DBERROR NUMBER MAXIMUM 52 (INCLUDE)                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*   S U B R O U T I N E   I N D E X                             *
     F*   ===============================                             *
     F*   BOTHSR - Credit and Debit processing                        *
     F*   B1EQ   - When debit and credit begin at the same date       *
     F*   B1GT   - When debit begin before credit                     *
     F*   B1LT   - When credit begin before debit                     *
     F*   CALBRT - Calculate base rate tax                            *
     F*   CLMSG  - Clear message                                      *
     F*   CRSR   - Credit only processing                             *
     F*   DBSR   - Database error handling                            *
     F*   DRSR   - Debit only processing                              *
     F*                                                               *
     F*   DETPR  - Detail processing                                  *
     F*   FIRST  - First cycle                                        *
     F*   ITYPCR - Interest type greater than 2                       *
     F*   ITYPDR - Interest type greater than 2                       *
     F*   MAIN   - Main processing                                    *
     F*   OPENCR - Credit opening bal and credit opening rate output  *
     F*   OPENDR - Debit opening bal and debit opening rate output    *
     F*   RATEC  - Prepare and output credit rate change              *
     F*   RATED  - Prepare and output debit rate change               *
     F*   RATESR - Rate change processing                             *
     F*   RCRSR  - Credit rate change output                          *
     F*   RDRSR  - Debit rate change output                           *
     F*   SUMMAR - Footer with print indicator (avoid empty extracts) *
     F*   TOTAL  - Total processing (not used any more)               *
     F*   TOTSR  - Days total output for crdeit and debit             *
     F*   ZICD   - Find number of days to calculate interest according*
     F*            to calculation basis                               *
     F*   *PSSR  - Error subroutine for certain access object errors  *
     F*****************************************************************
     F/EJECT
     F/COPY WNCPYSRC,RE3761F002
     F*================================================================
     E/COPY CGCPYSRC,CGPACKE
     E*CG Data Pack Arrays and Data Structures
     E/COPY CGCPYSRC,SRERRE
     E*Subroutine stack
     E*---------------------------------------
      * for RDE/groupset output and RDE formatting
     E                    ##GRP   1 236 10   ##RDEA 22
     E                    ##W        20  1
     E                    ##NUMA     29  1
     E                    CCYA      200  3
     E                    DPA       200  1 0
     E                    CCYN      200 14
     E                    RTA        12 11 7
     E                    BLA        12 15 0
     E                    NAR        39 39
     E                    CMD     1   2 50
     E                    CPY@    1   1 80
     E                    LITER   1   1 30
      *
     E/COPY ZSRSRC,ZDATE2Z1
     I*===============================================================
     IRECRGDF
     I*
     I** Rename RECRGDF format - RECRGD file
     I              RECI                            GRECI
     I              ACOD                            GACOD
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREADJF
     I** Rename READJF format fields - REHISSL file
     I*
     I              RECI                            ARECI
     I              BRCA                            ABRCA
     I              CNUM                            ACNUM
     I              CCY                             ACCY
     I              ACOD                            AACOD
     I              ACSQ                            AACSQ
     I              HISD                            AHISD
     I              HISB                            AHISB
     I              MNBL                            AMNBL
     I              PCHGAR                          ACHGAR
     I              TCHGAR                          ATHGAR
     I              PCHGAN                          ACHGAN
     I              TCHGAN                          ATHGAN
     I              DICT                            ADICT
     I              DRCB                            ADRCB
     I              DRCD                            ADRCD
     I              DAIC                            ADAIC
     I              PMADI                           APMADI
      *
     I              TMADI                           ATMADI
     I              PDID                            APDID
     I              DMINT                           ADMINT
     I              DRIP                            ADRIP
     I              DRIS                            ADRIS
     I              CICT                            ACICT
     I              CRCB                            ACRCB
     I              CRCD                            ACRCD
     I              CAIC                            ACAIC
     I              PMACI                           APMACI
      *
     I              TMACI                           ATMACI
     I              PCID                            APCID
     I              CMINT                           ACMINT
     I              CRIP                            ACRIP
     I              CRIS                            ACRIS
     I              STBL                            ASTBL
     I              CHGP                            ACHGP
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHISPSF
     I** Rename REHISPSF format fields - REHISL file
     I*
     I              RECI                            DRECI
     I              BRCA                            SBRCA
     I              CNUM                            SCNUM
     I              CCY                             SCCY
     I              ACOD                            SACOD
     I              ACSQ                            SACSQ
     I              HISD                            DHISD
     I              HISB                            DHISB
     I              MNBL                            SMNBL
     I              PCHGAR                          SCHGAR
     I              TCHGAR                          STHGAR
     I              PCHGAN                          SCHGAN
     I              TCHGAN                          STHGAN
     I              DICT                            DDICT
     I              DRCB                            SDRCB
     I              DRCD                            SDRCD
     I              DAIC                            SDAIC
     I              PMADI                           SPMADI
     I              TMADI                           STMADI
     I              PDID                            SPDID
     I              DMINT                           SDMINT
     I              DRIP                            SDRIP
     I              DRIS                            SDRIS
     I              SDCI                            SSDCI
     I              CICT                            DCICT
     I              CRCB                            SCRCB
     I              CRCD                            SCRCD
     I              CAIC                            SCAIC
     I              PMACI                           SPMACI
     I              TMACI                           STMACI
     I              PCID                            SPCID
     I              CMINT                           SCMINT
     I              CRIP                            SCRIP
     I              CRIS                            SCRIS
     I              SCCI                            SSCCI
     I              STBL                            SSTBL
     I              CHGP                            SCHGP
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHISPPF
     I** Rename REHISPPF format fields - REHISL file
     I*
     I              RECI                            DRECI
     I              BRCA                            DBRCA
     I              CNUM                            DCNUM
     I              CCY                             DCCY
     I              ACOD                            DACOD
     I              ACSQ                            DACSQ
     I              HISD                            DHISD
     I              HISB                            DHISB
     I              MNBL                            DMNBL
     I              CHGAR                           DCHGAR
     I              TCHGAR                          DTHGAR
     I              CHGAN                           DCHGAN
     I              TCHGAN                          DTHGAN
     I*
     I              DMVT                            DDMVT
     I              DICT                            DDICT
     I              DRCB                            DDRCB
     I              DRCD                            DDRCD
     I              DAID                            DDAID
     I              MADI                            DMADI
     I              TMADI                           DTMADI
     I              PDID                            DPDID
     I              DMINT                           DDMINT
     I              CMVT                            DCMVT
     I              CICT                            DCICT
     I              CRCB                            DCRCB
     I              CRCD                            DCRCD
     I              CAID                            DCAID
     I              MACI                            DMACI
     I              TMACI                           DTMACI
     I              PCID                            DPCID
     I              CMINT                           DCMINT
     I              DICI                            DDICI
     I              CICI                            DCICI
     I              DRCI                            DDRCI
     I              CRCI                            DCRCI
     I              VDTC                            DVDTC
     I              ADTY                            DADTY
     I              ALTI                            DALTI
     I              MNBCP                           DMNBCP
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHISPMF
     I** Rename REHISPMF format fields - REHISL file
     I*
     I              RECI                            DRECI
     I              HISD                            MHISD
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHRDJF
     I** Rename REHRDJF format fields - REHRDJ file
     I*
     I              RECI                            RRECI
     I              PSTD                            RPSTD
     I              VALD                            RVALD
     I              HISD                            RHISD
     I              PNAR                            RPNAR
     I              DRCR                            RDRCR
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHRCJF
     I** Rename REHRCJF format fields - REHRCJ file
     I*
     I              RECI                            RRECI
     I              PSTD                            RPSTD
     I              VALD                            RVALD
     I              HISD                            RHISD
     I              PNAR                            RPNAR
     I              DRCR                            RDRCR
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IREHPOSMF
     I** Rename REHPOSMF format fields - REHPOML2 file
     I*
     I              HISD                            MAHISD
     I              DRCR                            MADRCR
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     I* BRT ICD
     ISDBRTDD0
     I              ACOD                            ACODXX
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     IDSPARM    E DSRECAPM
      **  External DS for parameters based on PF/RECAPM (received from driver pgm)
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     ICPYR@#      DS
     I** DS for compilation- Copyright Insertion
     I                                        1  80 CPY@
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     ISDBANK    E DSSDBANKPD
     I              BJURPT                          TITL
     I**  External DS for Bank Details
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     ISDRETL    E DSSDRETLPD
     I              BMLDAI                          LDAC
     I**  Retail Details
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     I** Key Data Structure : CHKEY to Chain to RECRG file
     I*
     I            DS
     I                                        1  12 CHKEY
     I                                        1   1 BLANK1
     I                                        2   30CHGT
     I                                        4   80CHST
     I                                        9  11 WCCCY
     I                                       12  12 ENDK
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     I** DS for Begin date
     I            DS
     I                                        1   60SRES
     I                                        1   20ZISD
     I                                        3   40ZISM
     I                                        5   60ZISY
     I*- - - - - - - - - - - - - - - - - - - - - - - - - -
     I** DS for finishing date
     I            DS
     I                                        1   60FRES
     I                                        1   20ZIFD
     I                                        3   40ZIFM
     I                                        5   60ZIFY
     I*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     I** DS for no.of decimals in currency for History balance
     I            DS
     I                                        1  150HISB0
     I                                        1  151HISB1
     I                                        1  152HISB2
     I                                        1  153HISB3
     I*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      **** Debut PFJ028 New format for adjustment interest line
     I            DS
     I                                        1  150HISB4
     I                                        1  151HISB5
     I                                        1  152HISB6
     I                                        1  153HISB7
      *** Fin  PFJ028
     I*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     I            DS
     I                                        1  150TCHR0
     I                                        1  151TCHR1
     I                                        1  152TCHR2
     I                                        1  153TCHR3
     I*
     I            DS
     I                                        1  150TCHN0
     I                                        1  151TCHN1
     I                                        1  152TCHN2
     I                                        1  153TCHN3
     I*
     I            DS
     I                                        1  150CHGP0
     I                                        1  151CHGP1
     I                                        1  152CHGP2
     I                                        1  153CHGP3
     I*
     I            DS
     I                                        1  150CHGR0
     I                                        1  151CHGR1
     I                                        1  152CHGR2
     I                                        1  153CHGR3
     I*
     I            DS
     I                                        1  150CHGN0
     I                                        1  151CHGN1
     I                                        1  152CHGN2
     I                                        1  153CHGN3
     I*
     I            DS
     I                                        1  150TINTD0
     I                                        1  151TINTD1
     I                                        1  152TINTD2
     I                                        1  153TINTD3
     I*
     I            DS
     I                                        1  150TINTC0
     I                                        1  151TINTC1
     I                                        1  152TINTC2
     I                                        1  153TINTC3
     I*
     I            DS
     I                                        1  150TGINT0
     I                                        1  151TGINT1
     I                                        1  152TGINT2
     I                                        1  153TGINT3
     I*
     I            DS
     I                                        1  150BRTOT0
     I                                        1  151BRTOT1
     I                                        1  152BRTOT2
     I                                        1  153BRTOT3
     I*
     I            DS
     I                                        1  150PSTD0
     I                                        1  151PSTD1
     I                                        1  152PSTD2
     I                                        1  153PSTD3
     I*
     I            DS
     I                                        1  150INTC0
     I                                        1  151INTC1
     I                                        1  152INTC2
     I                                        1  153INTC3
     I*
     I            DS
     I                                        1  150INTD0
     I                                        1  151INTD1
     I                                        1  152INTD2
     I                                        1  153INTD3
     I*
     I            DS
     I                                        1  150NUMB0
     I                                        1  151NUMB1
     I                                        1  152NUMB2
     I                                        1  153NUMB3
      *** Debut PFJ028
     I            DS
     I                                        1  150NUMB4
     I                                        1  151NUMB5
     I                                        1  152NUMB6
     I                                        1  153NUMB7
      *** BASE COM DE COMPTE                                              PFJ028
     I            DS                                                      PFJ028
     I                                        1  150TPOS0                 PFJ028
     I                                        1  151TPOS1                 PFJ028
     I                                        1  152TPOS2                 PFJ028
     I                                        1  153TPOS3                 PFJ028
      *** BASE +FORT DEC                                                  PFJ028
     I            DS                                                      PFJ028
     I                                        1  150PBAL0                 PFJ028
     I                                        1  151PBAL1                 PFJ028
     I                                        1  152PBAL2                 PFJ028
     I                                        1  153PBAL3                 PFJ028
      *** Total Interest Debit                                            PFJ028
     I            DS                                                      PFJ028
     I                                        1  150INTTD0                PFJ028
     I                                        1  151INTTD1                PFJ028
     I                                        1  152INTTD2                PFJ028
     I                                        1  153INTTD3                PFJ028
      *** Total Interest Credit                                           PFJ028
     I            DS                                                      PFJ028
     I                                        1  150INTTC0                PFJ028
     I                                        1  151INTTC1                PFJ028
     I                                        1  152INTTC2                PFJ028
     I                                        1  153INTTC3                PFJ028
      *** FIN   PFJ028
      *
     I            DS                                                      086087
     I                                        1  117ORAT1                 086087
     I                                        1  11 ORATC                 086087
     I*
     I            DS
     I                                        1  150OBAL01
     I                                        1  151OBAL11
     I                                        1  152OBAL21
     I                                        1  153OBAL31
     I                                        1  15 OBALC                 086087
      * Define rates as an array                                          086087
     I            DS                                                      086087
     I                                        1  72 RAT23                 086087
     I                                        1  36 RAT2                  086087
     I                                       37  72 RAT3                  086087
     I                                    P   1  72 RTA                   086087
      *                                                                   086087
      * Define balances as an array                                       086087
     I            DS                                                      086087
     I                                        1  96 BAL23                 086087
     I                                        1  48 BAL2                  086087
     I                                       49  96 BAL3                  086087
     I                                    P   1  96 BLA                   086087
     I*- - - - - - - - - - - - - - - - - - - - - - - -
     I** DS for date format DD/MM/YY
     I*
     I            DS
     I                                        1   60RESULT
     I                                        1   20ZDAY
     I                                        3   40ZMTH
     I                                        5   60ZYEAR
     I*
     I*- - - - - - - - - - - - - - - - - - - - - - - -
RS   I*OKEY Not needed, since RECAPML already defined as *ENTRY-Parm
RS   I*OKEYD       DS
RS   I**************************************  1  18 OKEY
RS   I*                                       1  24 OKEY
RS   I*                                       1   3 OBRCA
RS   I*                                       4   90OCNUM
RS   I*                                      10  12 OCCY
RS   I************************************+* 13  160OACOD
RS   I*                                      13  220OACOD
RS   I*                                      23  240OACSQ
RS   I*********************************** P  19  210OLDID
RS   I*                                   P  25  270OLDID
      *
     I*- - - - - - - - - - - - - - - - - - - - - - - -
     I**   Name of Message File
     I*
     I            DS
     I                                        1  50 CMD1
     I                                       33  34 FILT2
     I*
     I*- - - - - - - - - - - - - - - - - - - - - - - - - - - -
     I                                        1   8 ADREF1
     I                                        1   1 WRCDT
     I*
RS   I*RKEY not needed, since RECAPML already defined as *ENTRY-Parm
RS   IRKEY2       DS
RS   I******************************          1  18 RKEY
RS   I                                        1  24 RKEY
RS   I                                        4  24 RKAC
RS   I                                        1   3 XBRCA
RS   I*************************************** 4   90XCNUM                 EMP108
     I                                        4   9 XCNUM                 EMP108
RS   I                                       10  12 XCCY
RS   I******************************         13  160CACOD
RS   I                                       13  220XACOD
RS   I******************************         17  180CACSQ
RS   I                                       23  240XACSQ
RS   I*******************************        19  230WDATE
RS   I                                       25  290WDATE
RS   I                                        1   3 CBRCA2
     I*- - - - - - - - - - - - - - - - - - - - - - - - - - - -
     I/COPY WNCPYSRC,RE3761I001
     I**- - - - - - - - - -
     I** Data Area RUNDAT
     I**
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I**- - - - - - - - - - - - - - - - -
     ISDBRCH    E DSSDBRCHPD
     I** to retrieve Branch Information
     I**
     I              A8BRNM                          BRNM
     I**- - - - - - - - - - - - - - - - -
     ISCSARD    E DSSCSARDPD                                              CFT004
      ** MIDAS Switchable Features Accessed Via Access Program            CFT004
      *                                                                   CFT004
     I**- - - - - - - - - - - - - - - - - -
     IACCNTB    E DSACCNTAB                                               CFT004
      ** MIDAS Account Master Details Accessed Via Access Program         CFT004
     I              ADREF1                          ADREFX                CFT004
     I              LCD                             LCDX                  CFT004
     I**- - - - - - - - - - - - - - - - - - - - - - - - - - -
     IDSFDY     E DSDSFDY
     I* First DS for access programs, short data structure
     I*
     I**- - - - - - - - - - - - - - - - - - - - - - - - - - -
     IDSSDY     E DSDSSDY                                                 CFT004
      ** Long data structure for access programs.                         CFT004
     I*
     I/COPY WNCPYSRC,RE3761I002
     I*
     I**- - - - - - - - - - - - - - - - - - - - - - - - - - -
     IW0FMT     E DSCGUDTAPD
      **  Record format of PF/CGUDTAPD for use as a parameter
     I**- - - - - - - - - - - - - - - - - - - - - - - - - - -
      * Named constants for print type/sub-type
     I              'RETAIL    '          C         #TEXT1
     I              'INTEREST  '          C         #TEXT2
     I              'Tiered'              C         #TEXT4
     I              'Threshold'           C         #TEXT5
     I              'Initial Threshold'   C         #TEXT6                                  MD059851
      *                                                                                     MD059851
     I              'DspZeroIntRate'      C         WSYSVL                                  MD059851
      *
     I**- - - - - - - - - - - - - - - - - - - - - - - - - - -
     I##SRDT      DS                         20
      **  DS to store subroutine specific data.
      **  - Saved Path
     I                                        1  70 ##SPAT
     I*
      **  - groupset / RDE association
     I            DS
     I                                        1  10 ##GRPX
     I                                        1   6 ##GRPS
     I                                        7  100##RDEN
     I**  Look-up string for RDE definition Array
     I*
     I##SDS       DS
     I                                        15632 ##S
     I**  Packed data string.
     I*
     I            DS
     I                                        1  20 ##W
     I                                        1  200##WNUM
     I**  Number Field
     I*
     I            DS
     I                                        1   8 ##ITMA
     I                                        1   80##ITEM
     I** Used to convert item reference from character to numeric
     I*
     I##UDCR    E DSCGUDCRPD
      ** External DS for incomplete reference
     I*
     I/COPY CGCPYSRC,CGPACKI
      *  CG Data Pack Data Structures
     I/COPY CGCPYSRC,SRERRI
      *  CG Error Processing - 'I' Specs
     ISPOOL       DS
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      *****************************************************************
      * Process     :  MAINLINE                                       *
      * Function    :  Mainline processing                            *
      *                                                               *
      * Called by   :  None                                           *
      * Calls       :  FIRST  - Initial Processing - On First Call    *
      * Calls       :  SRINZ  - Initialise Fields on Each Invocation  *
      *                MAIN   - Main Processing                       *
      *                TOTAL  - Totals Processing                     *
      *================================================================
      * K e y s , P a r a m e t e r s , D e f i n i t i o n s
      *================================================================
      *
      **  Parameter list for current program invocation.
     C           *ENTRY    PLIST
     C                     PARM           W0RTN   7
     C                     PARM           W0CMT   3
     C                     PARM           XXLG    2
      * activate this line when driver pgm was completed
     C                     PARM           DSPARM
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *-----------------------------------------------
     C                     MOVEACPY@      BIS@   80
     C***        *NAMVAR   DEFN           LDA
      *
      *-----------------------------------------------
     C** Key fields to access to files
     C**  Klist to access ACCNT
     C*
     C           KACCNT    KLIST
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CBRCA
     C*
     C**  Klist to chain on RECOM
     C*
     C           KLIST0    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C*
     C**  Klist to chain on REDETM
     C*
     C           KLIST1    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C*
     C**  Klist to read REHISL for debit
     C*
     C           KLIST2    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CLDID
     C*
     C**  Klist to read REHISL for credit
     C*
     C           KLIST3    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CLCID
     C*
     C**  Klist to read CLINT
     C*
     C           KLIST4    KLIST
     C                     KFLD           CCNUM
     C                     KFLD           RCDT
     C*
     C**  Klist to chain on REHRDJ
     C*
     C           KLIST5    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           DDRCD
     C*
     C**  Klist to chain on REHRCJ
     C*
     C           KLIST6    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           DCRCD
     C*
     C**  Klist to chain on REHPOML2
     C*
     C           KLIST9    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           DHISD
     C*----------------------------------------------------------------
     C** Set up parameter to form output line
     C** wahrscheinlich Relikt aus PRTF-Verarbeitung, einstweilen f}r
     C** erfolgreichen Compile noch ben¦tigt (SR CLMSG)
     C*----------------------------------------------------------------
     C           ZA1311    PLIST
     C                     PARM           MSGID   7
     C                     PARM           MSGDT0 40
     C                     PARM           MSGDT1 40
     C                     PARM           MSGDT2 40
     C                     PARM           MSGDT3 40
     C                     PARM           MSGDT4 40
     C                     PARM           MSGDT5 40
     C                     PARM           MSGDT6 40
     C                     PARM           MSGDT7 40
     C                     PARM           MSGDT8 40
     C                     PARM           MSGDT9 40
     C                     PARM           MNARR 200
     C*------------------------------
     C** Work fields definition
     C*------------------------------
     C           *LIKE     DEFN LGID      OLGID
     C           *LIKE     DEFN CCICI     WTTI
     C           *LIKE     DEFN DDAID     WDAID
     C           *LIKE     DEFN DCAID     WCAID
     C           *LIKE     DEFN LGID      DLGID
     C           *LIKE     DEFN DBKEY     ERRDAT
     C********** *LIKE     DEFN CNUM      I     - 3        EMP108
     C           *LIKE     DEFN RUND      PPSTD
     C           *LIKE     DEFN RUNA      PSTDO
     C           *LIKE     DEFN RUND      PVALD
     C           *LIKE     DEFN RUNA      VALDO
     C           *LIKE     DEFN ACNO      WACNO
     C           *LIKE     DEFN DCRCB     WCRCB
     C           *LIKE     DEFN DDRCB     WDRCB
     C           *LIKE     DEFN DHISB     WHISB
     C           *LIKE     DEFN DHISD     WHISD
     C           *LIKE     DEFN DHISD     WWHISD
     C           *LIKE     DEFN HISB      REBATE
      *
     C           *LIKE     DEFN DHISD     WHISDC
     C           *LIKE     DEFN DHISD     WHISDD
     C           *LIKE     DEFN MNBL      WMNBL
     C           *LIKE     DEFN DHISB     W1STBL
     C           *LIKE     DEFN DHISB     W2STBL
     C           *LIKE     DEFN DHISB     DOHISB
     C           *LIKE     DEFN DHISB     COHISB
     C********** *LIKE     DEFN CNUM      ZERROR- 5        EMP108
     C           *LIKE     DEFN RUND      ZIBEG
     C           *LIKE     DEFN RUND      ZIBW1
     C           *LIKE     DEFN RUND      ZIDREM
     C           *LIKE     DEFN CICT      ZIDW1
     C           *LIKE     DEFN RUND      ZIDW2
     C           *LIKE     DEFN RUND      ZID1
     C           *LIKE     DEFN RUND      ZID2
     C           *LIKE     DEFN RUND      ZIEND
     C           *LIKE     DEFN RUND      ZILPCP
     C           *LIKE     DEFN CICT      ZIMAN
     C           *LIKE     DEFN CICT      ZIM1
     C           *LIKE     DEFN RUND      ZIREM
     C           *LIKE     DEFN CICT      ZIY1
     C           *LIKE     DEFN SDAIC     @GADJ
      *
      *manual adjustments debit/credit
     C           *LIKE     DEFN INTD0     MADR#
     C           *LIKE     DEFN INTD0     MACR#
      *
     C                     Z-ADD0         TCHR0
     C                     Z-ADD0         TCHN0
     C                     Z-ADD0         ZERROR  10       EMP108
     C/COPY WNCPYSRC,RE3761C007
      *
     C/EJECT
     C*===================================================================
     C** P R O G R A M     S T A R T
     C*===================================================================
     C*
     C** First cycle processing
     C*
     C                     EXSR FIRST
     C*
     C** Main processing
     C*
     C                     EXSR MAIN
     C*
     C** Total processing
     C*
     C*                    EXSR TOTAL
     C*
     C*===================================================================
     C** P R O G R A M     E N D
     C*===================================================================
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      **  Terminate program
     C                     RETRN
      *****************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MAIN SUBROUTINE TO EXECUTE MAIN PROCESSING.
     C**
     C********************************************************************
     C           MAIN      BEGSR                           **MAIN BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      *...............................................................
     C                     MOVEL'RETAIL'  DRPTYP           * print type
     C                     MOVEL'INTCAP'  DRPSTP           * print s/type
     C                     MOVEL'N'       ##COPD
     C*
     C** populate some fields for CGUDCRPD using Entry-Parm
     C                     MOVELCBRCA     XBRCA
     C******************** Z-ADDCCNUM     XCNUM            EMP108
     C                     MOVELCCNUM     XCNUM            EMP108
     C                     MOVELCCCY      XCCY
     C*****                MOVELXXLG      DRLGID
     C                     Z-ADDCACOD     XACOD
     C                     Z-ADDCACSQ     XACSQ
     C*
      ** Output header record in CGUDCRPD.
     C                     EXSR SRGENR
      *
     C           ##COPD    CABEQ'N'       EXMAIN
      *
     C                     EXSR PRNO                       print selector
      *
     C**  Define Message files (if multilanguage required)
     C           XXLG      IFNE *BLANKS
      *
     C                     MOVELCMD,1     CMD1             --> GBREPRTMSGF
     C                     MOVELXXLG      FILT2
     C                     CALL 'QCMDEXC'
     C                     PARM           CMD1
     C                     PARM           MSGLEN
     C                     EXSR MULTL
      *
     C                     MOVELCMD,2     CMD1             --> GBCGUSRMSG
     C                     MOVELXXLG      FILT2
     C                     CALL 'QCMDEXC'
     C                     PARM           CMD1
     C                     PARM           MSGLEN
     C                     EXSR MULTL                      LOAD NARRATIVES
      *
     C                     END
      *
     C                     EXSR DETPR
      *
      *- - - - - - - - - - - - - - - - - - - - - - - - -
     C           EXMAIN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C** BOTHSR subroutine for debit and credit output processing
     C**
     C**     Called by       D E T P R
     C**
     C**     Calls           DBSR, B1EQ, B1LT, B1GT, RATESR
     C**                     TOTSR, ZICD
     C********************************************************************
     C           BOTHSR    BEGSR                           **BOTHSR BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'BOTHSR'  @STK,Q
     C*..............................................................
     C                     MOVE '0'       *IN72
     C                     MOVE '0'       *IN73
     C                     MOVE '0'       *IN74
     C                     MOVE '0'       *IN75
     C                     MOVEA'00'      *IN,42
      *
     C           KLIST2    SETLLREHISL               52                   064051
     C           KLIST1    READEREHISL                   52               064051
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD1         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 01**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
      *
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    W1STBL
     C                     Z-ADDDDRCD     WWDRCD  50                      040447
     C                     Z-ADDDCRCD     WWCRCD  50                      040447
     C                     Z-ADDDHISD     BDATE   50                      094337
     C                     Z-ADDDDRCB     WDRCBD  10                      125176
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     W1STBL
     C                     Z-ADDSDRCD     WWDRCD                          040447
     C                     Z-ADDSCRCD     WWCRCD                          040447
     C                     Z-ADDSDRCB     WDRCBD                          125176
     C                     ELSE                            - X2
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD2         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 02**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C*
     C                     END                             - E1
      *
     C                     Z-ADDDHISB     DOHISB
     C                     Z-ADDDHISB     WHISBD 150                      085171
     C                     Z-ADDCLDID     WHISDD
     C                     Z-ADDDRIR      WWDRIR 117
     C                     Z-ADD0         WMNBLD 150                      085171
     C                     Z-ADD0         WDAIDD                          085171
     C                     Z-ADD0         WCAIDD                          085171
      *
     C           KLIST3    SETLLREHISL               52                64051
     C           KLIST1    READEREHISL                   52            64051
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD3         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 03**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    W2STBL
     C                     Z-ADDDHISD     BDATE                           125176
     C                     Z-ADDDCRCB     WCRCBC  10                      125176
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     W2STBL
     C                     Z-ADDSCRCB     WCRCBC                          125176
     C                     ELSE                            - X2
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD4         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 04**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
      *
     C                     Z-ADDDHISB     COHISB
     C                     Z-ADDDHISB     WHISBC 150                      085171
     C                     Z-ADDCLCID     WHISDC
     C                     Z-ADDCRIR      WWCRIR 117
     C                     Z-ADD0         WMNBLC 150                      085171
      *
     C           CLDID     IFLT CLCID                      - B1
     C           KLIST2    SETLLREHISL                                   64051
     C           KLIST1    READEREHISL                   52              64051
     C                     MOVEA'10'      *IN,42                         PFJ028
     C                     ELSE                            - X1          PFJ028
     C                     MOVEA'01'      *IN,42                         PFJ028
     C                     END                             - E1
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS                     - B1
     C                     MOVE '1'       *IN65
     C                     END                             - E1
      *** Debut PFJ028
     C**************       WRITEHEADDC
     C                     EXSR HEADDC                                    CCG015
      *
      * Charge report if necessary
RS    * Instead of a printer line, set a flag for later charge processing
     C           CCICI     IFNE *BLANK                     - B1
     C           CCHGP     ANDNE*ZERO
RS   C*                    WRITEHEADCH
     C                     MOVEL'Y'       CHIND   1                       EMP007
     C                     END                             - E1
      *
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
      *
     C           CLDID     IFLT CLCID                      - B1           PFJ028
     C                     Z-ADDW1STBL    HISB0
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVEA'10'      *IN,42                          PFJ028
     C                     ELSE                            - X1           PFJ028
     C                     Z-ADDW2STBL    HISB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     MOVEA'01'      *IN,42                          PFJ028
     C                     END                             - E1           PFJ028
      *                                                                   PFJ028
     C                     Z-ADDDHISB     WHISB
      *                                                                   PFJ028
     C**  B/F balance output
     C*
     C*********            WRITETITLEDC                                   CCG015
     C                     EXSR TITLDC                     format         CCG015
     C                     EXSR DETAIL                     extract RDEs
      *                                                                   PFJ028
     C**  Process back value and opening
     C           CLDID     CASEQCLCID     B1EQ
     C           CLDID     CASLTCLCID     B1LT
     C           CLDID     CASGTCLCID     B1GT
     C                     END
      *
     C                     MOVE *BLANK    @ADJF
      *
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WWHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
      *
      * Generated adj. on start date has already been reported, but set
      * flag to ensure balance change is reported (as hist. balance is
      * updated but DMVT/CMVT not updated with gen. adj.).
     C           *IN70     IFEQ '1'                        - B2
     C           SDAIC     IFNE *ZEROS                     - B3
     C           SSDCI     ANDEQ'Y'
     C                     MOVE 'Y'       @ADJF
     C                     END                             - E3
     C           SCAIC     IFNE *ZEROS                     - B3
     C           SSCCI     ANDEQ'Y'
     C                     MOVE 'Y'       @ADJF
     C                     END                             - E3
     C                     END                             - E2
      *
     C           KLIST1    READEREHISL                   51
      *
      * Bypass interim capitalisation records
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C           DHISD     ANDLTCHISD
      *
      * If management cap. check for generated adjustment after start
      * date. This can only occur if CLDID *NE CLCID; for the side with
      * the earlier start date there can be an adj. for the other side.
     C           *IN70     IFEQ '1'                        - B3
     C           *IN51     ANDEQ'0'
     C           DRECI     ANDEQ'S'
     C           DHISD     ANDLTCHISD
     C           SDAIC     IFNE *ZEROS                     - B4
     C           SDICI     ANDNE*BLANK
     C           SSDCI     ANDEQ'Y'
     C                     Z-ADDSDAIC     @GADJ
     C                     MOVE 'Y'       @ADJF
     C                     END                             - E4
      *
     C           SCAIC     IFNE *ZEROS                     - B4
     C           SCICI     ANDNE*BLANK
     C           SSCCI     ANDEQ'Y'
     C                     Z-SUBSCAIC     @GADJ
     C                     MOVE 'Y'       @ADJF
     C                     END                             - E4
     C                     END                             - E3
      *
     C           KLIST1    READEREHISL                   51
     C                     ENDDO                           - E2
      *
     C           *IN51     IFEQ '0'                        - B2
     C           WWHISD    ANDNEDHISD
     C           DRECI     ANDNE'S'
     C*-------------------------------------------------------------------------
     C           CDICT     IFLT 3                          - B3
     C           CCICT     ANDLT3
     C                     MOVE '  '      DCFLAG  2                       PFJ028
      *
     C**  Process in case of interest type are both less than 3
     C*
     C**  Output days/product/interest for DEBIT side if relevant         125176
      *
     C           DDRCI     IFEQ 'Y'                        - B4           125176
     C           DDMVT     ORNE *ZEROS                                    125176
     C           DCMVT     ORNE *ZEROS                                    125176
     C           DMADI     ORNE *ZEROS                                    125176
      *
     C           DHISD     IFGE CLDID                      - B5           125176
     C           DHISD     ANDLTCHISD                                     125176
     C           *IN42     ANDEQ'1'                                       PFJ028
      *
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISDD    ZIBEG                           125176
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDDOHISB    HISB0
     C           HISB0     MULT DAYS      NUMB0
     C                     Z-ADDDDAID     INTD0
      *
     C           DAYS      IFNE *ZEROS                     - B6
     C                     MOVE 'DR'      DCFLAG  2                       094431
     C                     END                             - E6
      *
     C                     END                             - E5           125176
     C                     END                             - E4           125176
      *
     C**  Output days/product/interest for CREDIT side if relevant        125176
     C*
     C           DCRCI     IFEQ 'Y'                        - B4           125176
     C           DDMVT     ORNE *ZEROS                                    125176
     C           DCMVT     ORNE *ZEROS                                    125176
     C           DMACI     ORNE *ZEROS                                    125176
     C*
     C           DHISD     IFGE CLCID                      - B5           125176
     C           DHISD     ANDLTCHISD                                     125176
     C           *IN43     ANDEQ'1'                                       PFJ028
      *                                                                   125176
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISDC    ZIBEG                           125176
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
      *** Debut PFJ028
     C                     Z-ADDCOHISB    HISB4
     C           HISB4     MULT DAYS      NUMB4
      *** Fin   PFJ028
     C                     Z-SUBDCAID     INTC0                           094337
     C*
     C           DAYS      IFNE *ZEROS                     - B6
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     END                             - E6
     C                     END                             - E5
     C                     END                             - E4           125176
      *
     C                     EXSR WST                        Write subtotal PFJ028
     C*---------------------------------------------------------------------------
     C                     ELSE                            - X3
     C*
     C           CDICT     IFGT 2                          - B4
     C           CCICT     ANDGT2
     C                     MOVE '  '      DCFLAG                          PFJ028
     C**  Process in case of interest type are both greater than 3
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B5           PFJ028
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                                            PFJ028
      *
     C           DHISD     IFGT CLCID                                     PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E5           PFJ028
      *
     C           DRECI     IFEQ 'M'                        - B5
     C*
     C           DSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDGT*ZEROS
     C*
     C**  Process debit
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDDINT      INTD0
     C           MNBL      MULT DAYS      NUMB0
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B7            64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E7            64051
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
      *
     C           CSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDLT*ZEROS
     C*
     C**  Process credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBCINT      INTC0
      *** Debut PFJ028
     C                     Z-ADD0         INTD0
     C           MNBL      MULT DAYS      NUMB4
     C                     Z-ADD0         NUMB0
      *** Fin   PFJ028
     C           MHISD     IFGT CLCID                      - B7            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E7            64051
      *
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
      *
     C                     END                             - E6
     C*
     C**  Process until reading other than 'M'
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
      *
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C*
     C           DSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDGT*ZEROS
     C*
     C**  Process debit
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         INTC0                           PFJ028
     C*
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
      *
     C           CSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDLT*ZEROS
     C*
     C**  Process credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         INTD0                           PFJ028
      *
     C                     Z-ADD0         NUMB0                           PFJ028
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
      *
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
      *
     C                     END                             - E9
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C*
     C**  Process a S record
     C           SDICI     IFNE *BLANKS                    - B10         098818
     C                     MOVE '  '      DCFLAG                         PFJ028
     C*
     C**  Process if debit capitalisation
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         INTC0                           PFJ028
     C           DHISD     IFGT CLDID                      - B12           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     ELSE                            - X11
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         INTD0                           PFJ028
     C           DHISD     IFGT CLCID                      - B12           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     END                             - E11
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E10
     C*
     C           SCICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  Process if credit capitalisation
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
      *
     C                     MOVE '  '      DCFLAG                          PFJ028
     C           SMNBL     IFGT *ZEROS                     - B11
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADDDINT      INTD0
     C           DHISD     IFGT CLDID                      - B12           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
      *
     C                     ELSE                            - X11
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-SUBCINT      INTC0
     C           DHISD     IFGT CLCID                      - B12           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     END                             - E11
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E10
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           CDICT     IFGT 2                          - B5
     C           CCICT     ANDLT3
     C                     MOVE '  '      DCFLAG                          PFJ028
     C*
     C**  Process in case of interest type credit is less than 3
     C**  and interest type debit is greater than 2
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B6            64051
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
      *
     C           DHISD     IFGT CLCID                      - B6            64051
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
     C*
     C           DCRCI     IFEQ 'Y'                        - B6
     C*
     C**  Process when change rate credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
      *
     C           DAYS      IFNE *ZEROS                     - B7
     C                     MOVE '  '      DCFLAG                          PFJ028
     C*
     C           DHISD     IFGT CLDID                      - B8            64051
     C           DDAID     SUB  WDAID     INTD0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADDWHISB     HISB0                           PFJ028
     C           HISB0     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
      *
     C           DHISD     IFGT CLCID                      - B8            64051
     C           DCAID     SUB  WCAID     INTC0                           PFJ028
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           PFJ028
     C                     ENDIF                                                            MD058206
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADDWHISB     HISB4                           PFJ028
     C           HISB4     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                                             64051
     C*                                                    - E8
     C* Charge report if necessary
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  Process end of month or change rate for debit
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C           WHISDD    IFEQ 0                          - B7           064051
     C                     Z-ADDCLDID     WHISDD                          064051
     C                     END                             - E7           064051
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     MOVE '  '      DCFLAG                          PFJ028
     C           MNBL      IFGT *ZEROS                     - B7
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         INTC0                           PFJ028
     C           MHISD     IFGT CLDID                      - B8            64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     ELSE                            - X7
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         INTD0                           PFJ028
     C           MHISD     IFGT CLCID                      - B8            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     END                             - E7
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     ELSE                            - X9
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     END                             - E9
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         INTC0                           PFJ028
     C           DHISD     IFGT CLDID                      - B11           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
      *
     C                     ELSE                            - X10
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         INTD0                           PFJ028
     C           DHISD     IFGT CLCID                      - B11           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     END                             - E10
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     ELSE                            - X5
     C*
     C**  Process in case of interest type debit is less than 3
     C**  And interest type credit is greater than 2
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B6            64051
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
      *
     C           DHISD     IFGT CLCID                      - B6            64051
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
     C*
     C           DDRCI     IFEQ 'Y'                        - B6
     C*
     C**  Debit rate change
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           DHISD     IFGT CLDID                      - B8            64051
     C                     Z-ADDWHISB     HISB0                           PFJ028
     C           HISB0     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C           DHISD     IFGT CLCID                      - B8            64051
     C                     Z-ADDWHISB     HISB4                           PFJ028
     C           HISB0     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C*
     C* Charge report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  Credit end of month or credit rate change
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
      *
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADDDINT      INTD0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C           MHISD     IFGT CLDID                      - B8            64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
      *
     C                     ELSE                            - X7
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C           MHISD     IFGT CLCID                      - B8            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     END                             - E7
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
      *
     C                     ELSE                            - X9
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     END                             - E9
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     Z-ADDDINT      INTC0                           PFJ028
     C           DHISD     IFGT CLDID                      - B11           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     ELSE                            - X10
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-SUBCINT      INTC0
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C           DHISD     IFGT CLCID                      - B11           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     END                             - E10
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*==================================================================
      ** If CRE001 is switched ON and Overdraft Processed Ind. is 'Y'     CRE001
      ** then Output Overdraft Limit                                      CRE001
     C*==================================================================
     C           CRE001    IFEQ 'Y'                        - B1           CRE001
     C           ODLI      ANDEQ'Y'                                       CRE001
      *                                                                   CRE001
     C                     MOVE *BLANKS   ODLI                            CRE001
     C                     MOVE *BLANKS   PSTDO                           CRE001
     C                     Z-ADD*ZEROS    PPSTD                           CRE001
     C                     MOVE *BLANKS   PSTDA                           CRE001
      *                                                                   CRE001
      ** Convert Retail History Debit Date to DDMMMYY format              CRE001
     C           PVALD     IFNE WWHISD                     - B2           CRE001
     C                     MOVELWWHISD    ZDAYNO                          CRE001
     C                     EXSR ZDATE2                                    CRE001
     C                     MOVE ZDATE     VALDO                           CRE001
      *                                                                   CRE001
      **  Handle Conversion Error.                                        CRE001
      *                                                                   CRE001
     C           ZERROR    IFNE 0                          - B3           CRE001
     C                     Z-ADDWWHISD    WDATE                           CRE001
     C                     Z-ADD421       DBASE                           CRE001
     C                     MOVEL'ZDAT2'   DBFILE           ***************CRE001
     C                     MOVELWDATE     DBKEY            **DB ERROR 421*CRE001
     C                     MOVEA'1'       *IN,89           ***************CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                           - E3           CRE001
      *                                                                   CRE001
      ** Set Pervious Posting Value to Current Retail History DR Date     CRE001
     C                     Z-ADDWWHISD    PVALD                           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
     C                     MOVE VALDO     VALDA                           CRE001
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   CRE001
     C                     MOVELNAR,39    NARR                            CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     WODRL  150                      CRE001
     C                     SELEC                           - B2           CRE001
     C           DPA,I     WHEQ 0                                         CRE001
     C                     Z-ADDODRL      WODRL                           CRE001
     C           DPA,I     WHEQ 1                                         CRE001
     C           ODRL      MULT 10        WODRL                           CRE001
     C           DPA,I     WHEQ 2                                         CRE001
     C           ODRL      MULT 100       WODRL                           CRE001
     C           DPA,I     WHEQ 3                                         CRE001
     C           ODRL      MULT 1000      WODRL                           CRE001
     C                     ENDSL                           - E2           CRE001
      *                                                                   CRE001
     C           WODRL     IFGT *ZEROS                     - B2           CRE001
     C                     Z-ADDWODRL     PSTD0                           CRE001
     C                     ELSE                            - X2           CRE001
     C                     Z-SUBWODRL     PSTD0                           CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E1           CRE001
      *------------------------------------------------------------
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
     C*
     C                     MOVEA'00'      *IN,53
      *                                                                   125176
      * Reported generated adjustment if found                            125176
     C           @ADJF     IFEQ 'Y'                        - B2           125176
     C                     EXSR #ADJ                                      125176
      *                                                                   125176
     C           DHISD     IFGE CLDID                      - B3           125176
     C                     MOVE '1'       *IN54                           125176
     C                     END                             - E3           125176
     C           DHISD     IFGE CLCID                      - B3           125176
     C                     MOVE '1'       *IN53                           125176
     C                     END                             - E3           125176
     C                     END                             - E2           125176
     C*-------------------------------------
     C**  Process posting at the same date
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELPNAR      NARR
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X3
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  Output posting for debit and credit
     C*
     C           HISD      IFGE CLDID                      - B3            64051
     C******************** EXSR OVERDR                     prtf-overflow  PFJ028
     C                     MOVE '1'       *IN54
     C                     END                             - E3
     C           HISD      IFGE CLCID                      - B3          064051
     C                     MOVE '1'       *IN53
     C                     END                             - E3
     C*
     C* Charge Report if necessary
     C*
     C           HISD      IFGE CLCID                      - B3           125176
RS   C*                    EXSR PRN2CH                     chargesDetails2085713
     C                     END                             - E3           125176
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C**  print the manual adjustment
     C*
     C           DMADI     IFNE *ZEROS                     - B2
     C           DMACI     ORNE *ZEROS
     C*
     C           KLIST9    SETLLREHPOML2                 56
     C           KLIST9    READEREHPOML2                 56
     C           *IN56     DOWEQ'0'                        - B3
     C*
     C           PPSTD     IFNE MAHISD                     - B4
     C                     Z-ADDMAHISD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     END                             - E4
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE VALD                       - B4
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDVALD      PVALD
     C                     END                             - E4
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,29    NARR
     C*
     C           DRIA      IFNE *ZEROS                     - B4
     C           MAHISD    ANDGECLDID                                     125176
     C                     Z-ADDDRIA      INTD0
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WMA                        WRITE MAN ADJ  094431
     C                     Z-ADD*ZEROS    INTD0
     C                     MOVE '1'       *IN54
     C                     END                             - E4
     C*
     C           CRIA      IFNE *ZEROS                     - B4
     C           MAHISD    ANDGECLCID                                     125176
     C                     Z-ADDCRIA      INTC0
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WMA                        WRITE MAN ADJ  094431
     C                     Z-ADD*ZEROS    INTC0
     C                     MOVE '1'       *IN53
     C                     END                             - E4
     C*
     C           KLIST9    READEREHPOML2                 56
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*-----------------------------------------------
     C**  Process in case there is one rate change
     C*
     C                     EXSR RATESR
     C*
     C**  Output subtotal line
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C**  Check interest type
     C*
     C           CDICT     IFLT 3                          - B3
     C           CCICT     ANDLT3
     C*
     C**  Process in case of interest type are both less than 3
     C*
     C           DRECI     IFEQ 'D'                        - B4
     C           DCMVT     ANDNE*ZEROS
     C           DDMVT     ORNE *ZEROS
     C           DRECI     ANDEQ'D'
     C           DMACI     ORNE *ZEROS
     C           DRECI     ANDEQ'D'
     C           DCRCI     ORNE *BLANKS
     C           DRECI     ANDEQ'D'
     C           @ADJF     OREQ 'Y'                                       125176
     C           DRECI     ANDEQ'D'                                       125176
     C           DRECI     OREQ 'S'
     C           SDRIP     ANDNE*ZEROS
     C           DRECI     OREQ 'S'
     C           SCRIP     ANDNE*ZEROS
     C*
     C           WHISB     IFLE *ZEROS                     - B5           PFJ028
      *
     C           WHISBC    IFGE *ZEROS                     - B6           125176
     C*
     C**  Output days/product/interest line for credit                    125176
     C*
     C                     Z-ADDWCRCBC    ZICALC                          125176
     C                     Z-ADDWHISDC    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
      *** debut PFJ028
     C                     Z-ADDWHISBC    HISB4
     C           HISB4     MULT DAYS      NUMB4
     C                     Z-ADD0         HISB0
     C                     Z-ADD0         NUMB0
      *** fin   PFJ028
     C*
     C                     Z-ADD*ZEROS    INTC0
     C           DAYS      IFGT *ZEROS                     - B7
     C           NUMB4     ANDNE*ZEROS                                    PFJ028
     C*
     C           WHISDC    IFGE CLCID                      - B8
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     Z-ADDDHISD     WHISDC                          174403
     C                     END                             - E8
     C                     END                             - E7
     C                     ELSE                            - X6
     C                     Z-ADDWCRCBC    ZICALC
     C                     Z-ADDWHISDC    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
      *** Debut PFJ028
     C                     Z-ADDWHISBC    HISB4
     C           HISB4     MULT DAYS      NUMB4
     C                     Z-ADD0         HISB0
     C                     Z-ADD0         NUMB0
      *** Fin   PFJ028
     C           DCAID     SUB  WCAIDD    INTC0                           094337
     C           DRECI     IFEQ 'S'                        - B7
     C           SCICI     IFNE *BLANKS                    - B8           098818
     C           SCRIP     SUB  WCAIDD    INTC0                           094337
     C                     ADD  SGACI     INTC0
     C                     ELSE                            - X8
     C           SCAIC     SUB  WCAIDD    INTC0                           094337
     C                     END                             - E8
     C                     END                             - E7
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           094674
     C                     ENDIF                                                            MD058206
     C*
     C           DAYS      IFGT *ZEROS                     - B7
     C*
     C           WHISDC    IFGE CLCID                      - B8
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     Z-ADDDHISD     WHISDC                          174403
     C                     END                             - E8
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
      *
     C                     END                             - E4           PFJ028
     C*
     C           DDMVT     IFNE *ZEROS                     - B4
     C           DRECI     ANDEQ'D'
     C           DCMVT     ORNE *ZEROS
     C           DRECI     ANDEQ'D'
     C           DMADI     ORNE *ZEROS
     C           DRECI     ANDEQ'D'
     C           DDRCI     ORNE *BLANKS
     C           DRECI     ANDEQ'D'
     C           @ADJF     OREQ 'Y'                                       125176
     C           DRECI     ANDEQ'D'                                       125176
     C           DRECI     OREQ 'S'
     C           SDRIP     ANDNE*ZEROS
     C           DRECI     OREQ 'S'
     C           SCRIP     ANDNE*ZEROS
     C*
     C           WHISB     IFGT *ZEROS                     - B5           PFJ028
      *
     C           WHISBD    IFGT *ZEROS                     - B6
     C*
     C**  Output days/product/interest line for debit                     125176
     C*
     C                     Z-ADDWDRCBD    ZICALC
     C                     Z-ADDWHISDD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDWHISBD    HISB0
     C           HISB0     MULT DAYS      NUMB0
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DDAID     SUB  WDAIDD    INTD0
     C           DRECI     IFEQ 'S'                        - B7
     C           SDICI     IFNE *BLANKS                    - B8          098818
     C           SDRIP     SUB  WDAIDD    INTD0
     C                     ADD  SGADI     INTD0
     C                     ELSE                            - X8
     C           SDAIC     SUB  WDAIDD    INTD0
     C                     END                             - E8
     C                     END                             - E7
     C*
     C           DAYS      IFGT *ZEROS                     - B7
     C*
     C           WHISDD    IFGE CLDID                      - B8
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     Z-ADDDHISD     WHISDD                          174403
     C                     END                             - E8
     C                     END                             - E7
     C                     ELSE                            - X6
     C                     Z-ADDWDRCBD    ZICALC                          125176
     C                     Z-ADDWHISDD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDWHISBD    HISB0
     C           HISB0     MULT DAYS      NUMB0
     C                     Z-ADD*ZEROS    INTD0
     C                     Z-ADD0         NUMB4                           PFJ028
     C*
     C           DAYS      IFGT *ZEROS                     - B7
     C*
     C           WHISDD    IFGE CLDID                      - B8
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     Z-ADDDHISD     WHISDD                          174403
     C                     END                             - E8
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
      *
     C                     END                             - E4   PFJ028
     C*
     C                     ELSE                            - X3
     C*
     C           CDICT     IFGT 2                          - B4
     C           CCICT     ANDGT2
     C*
     C**  Process in case of interest type are both greater than 3
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B5           PFJ028
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E5           PFJ028
      *
     C           DHISD     IFGT CLDID                      - B5           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E5           PFJ028
     C*
     C           DRECI     IFEQ 'M'                        - B5
     C*
     C           DSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDGT*ZEROS
     C*
     C**  Process debit
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDDINT      INTD0
     C           MNBL      MULT DAYS      NUMB0
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B7            64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E7            64051
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           CSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDLT*ZEROS
     C*
     C**  Process credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBCINT      INTC0
      *** Debut PFJ028
     C           MNBL      MULT DAYS      NUMB4
     C                     Z-ADD0         INTD0
     C                     Z-ADD0         NUMB0
      *** Fin   PFJ028
     C           MHISD     IFGT CLCID                      - B7            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E7            64051
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C**  Process until reading other than 'M'
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C*
     C           DSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDGT*ZEROS
     C*
     C**  Process debit
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDDINT      INTD0
     C           MNBL      MULT DAYS      NUMB0
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C           CSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDLT*ZEROS
     C*
     C**  Process credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBCINT      INTC0
      *** Debut PFJ028
     C           MNBL      MULT DAYS      NUMB4
     C                     Z-ADD0         INTD0
     C                     Z-ADD0         NUMB0
      *** Fin   PFJ028
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C*
     C**  Process a S record
     C*
     C***********SDICI     IFEQ 'Y'                                      098818
     C           SDICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  Process if debit capitalisation
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-ADDDINT      INTD0
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DHISD     IFGT CLDID                      - B12           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     ELSE                            - X11
     C                     Z-SUBCINT      INTC0
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           DHISD     IFGT CLCID                      - B12           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     END                             - E11
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E10
     C*
     C***********SCICI     IFEQ 'Y'                                      098818
     C           SCICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  Process if credit capitalisation
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
      *
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-ADDDINT      INTD0
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DHISD     IFGT CLDID                      - B12           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     ELSE                            - X11
     C                     Z-SUBCINT      INTC0
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           DHISD     IFGT CLCID                      - B12           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E12           64051
     C                     END                             - E11
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E10
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           CDICT     IFGT 2                          - B5
     C           CCICT     ANDLT3
     C*
     C**  Process in case of interest type credit is less than 3
     C**  and interest type debit is greater than 2
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B6            64051
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
      *
     C           DHISD     IFGT CLCID                      - B6            64051
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
     C*
     C           DCRCI     IFEQ 'Y'                        - B6
     C*
     C**  Process when change rate credit
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
      *
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           DHISD     IFGT CLDID                                      64051
     C                     Z-ADDWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C                     Z-ADD0         HISB4
     C                     Z-ADD0         NUMB4
     C           DDAID     SUB  WDAID     INTD0
     C                     Z-ADD0         INTC0                           094337
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                                             64051
     C           DHISD     IFGT CLCID                      - B8            64051
     C                     Z-ADDWHISB     HISB4
     C           HISB4     MULT DAYS      NUMB4
     C                     Z-ADD0         HISB0
     C                     Z-ADD0         NUMB0
     C           DDAID     SUB  WDAID     INTC0
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           094337
     C                     ENDIF                                                            MD058206
     C                     Z-ADD0         INTD0                           094337
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C*
     C* Charge report if necessary
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  Process end of month or change rate for debit
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C           MNBL      MULT DAYS      NUMB0
     C                     Z-ADDDINT      INTD0
     C                     Z-ADD0         NUMB4
     C                     Z-ADD0         INTC0
     C           MHISD     IFGT CLDID                                      64051
     C                     MOVE 'DR'      DCFLAG           - B8           094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     ELSE                            - X7
     C                     Z-SUBCINT      INTC0
     C           MNBL      MULT DAYS      NUMB4
     C                     Z-ADD0         NUMB0
     C                     Z-ADD0         INTD0
     C           MHISD     IFGT CLCID                      - B8            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     END                             - E7
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-ADDDINT      INTD0
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     ELSE                            - X9
     C                     Z-SUBCINT      INTC0
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     END                             - E9
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-ADDDINT      INTD0
     C           SMNBL     MULT DAYS      NUMB0
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DHISD     IFGT CLDID                      - B11           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     ELSE                            - X10
     C                     Z-SUBCINT      INTC0
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DHISD     IFGT CLCID                      - B11           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     END                             - E10
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     ELSE                            - X5
     C*
     C**  Process in case of interest type debit is less than 3
     C**  and interest type credit is greater than 2
     C*
     C**  Process output changing day
     C*
     C           DHISD     IFGT CLDID                      - B6            64051
     C                     Z-ADDWMNBL     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
      *
     C           DHISD     IFGT CLCID                      - B6            64051
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADDWMNBL     HISB4                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E6            64051
     C*
     C           DDRCI     IFEQ 'Y'                        - B6
     C*
     C**  Debit rate change
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           DHISD     IFGT CLDID                      - B8            64051
     C                     Z-ADDWHISB     HISB0                           PFJ028
     C           HISB0     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C           DHISD     IFGT CLCID                      - B8            64051
     C                     Z-ADDWHISB     HISB4                           PFJ028
     C           HISB4     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C*
     C* Charge report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  Credit end of month or credit rate change
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
      *
     C           MNBL      IFGT *ZEROS                     - B7
     C                     Z-ADDDINT      INTD0
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B8            64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     ELSE                            - X7
     C                     Z-SUBCINT      INTC0
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           MHISD     IFGT CLCID                      - B8            64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E8            64051
     C                     END                             - E7
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-ADDDINT      INTD0                           PFJ028
     C           MNBL      MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           MHISD     IFGT CLDID                      - B10           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     ELSE                            - X9
     C                     Z-SUBCINT      INTC0                           PFJ028
     C           MNBL      MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           MHISD     IFGT CLCID                      - B10           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E10           64051
     C                     END                             - E9
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-ADDDINT      INTD0
     C           SMNBL     MULT DAYS      NUMB0                           PFJ028
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DHISD     IFGT CLDID                      - B11           64051
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     ELSE                            - X10
     C                     Z-SUBCINT      INTC0
     C           SMNBL     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         INTD0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
     C           DHISD     IFGT CLCID                      - B11           64051
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E11           64051
     C                     END                             - E10
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*-----------------------------------------------------------------
      ** If CRE001 is switched ON and Overdraft Processed Ind. is 'Y'     CRE001
      ** then Output Overdraft Limit                                      CRE001
     C*-----------------------------------------------------------------
     C           CRE001    IFEQ 'Y'                        - B3           CRE001
     C           ODLI      ANDEQ'Y'                                       CRE001
      *                                                                   CRE001
     C                     MOVE *BLANKS   ODLI                            CRE001
     C                     MOVE *BLANKS   PSTDO                           CRE001
     C                     Z-ADD*ZEROS    PPSTD                           CRE001
     C                     MOVE *BLANKS   PSTDA                           CRE001
      *                                                                   CRE001
      ** Convert Retail History Debit Date to DDMMMYY format              CRE001
     C           PVALD     IFNE WWHISD                     - B4           CRE001
     C                     MOVELWWHISD    ZDAYNO                          CRE001
     C                     EXSR ZDATE2                                    CRE001
     C                     MOVE ZDATE     VALDO                           CRE001
      *                                                                   CRE001
      **  Handle Conversion Error.                                        CRE001
      *                                                                   CRE001
     C           ZERROR    IFNE 0                          - B5           CRE001
     C                     Z-ADDWWHISD    WDATE                           CRE001
     C                     Z-ADD421       DBASE                           CRE001
     C                     MOVEL'ZDAT2'   DBFILE           ***************CRE001
     C                     MOVELWDATE     DBKEY            **DB ERROR 421*CRE001
     C                     MOVEA'1'       *IN,89           ***************CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                           - E5           CRE001
      *                                                                   CRE001
      ** Set Pervious Posting Value to Current Retail History DR Date     CRE001
     C                     Z-ADDWWHISD    PVALD                           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E4           CRE001
      *                                                                   CRE001
     C                     MOVE VALDO     VALDA                           CRE001
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   CRE001
     C                     MOVELNAR,39    NARR                            CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     WODRL  150                      CRE001
     C                     SELEC                           - B4           CRE001
     C           DPA,I     WHEQ 0                                         CRE001
     C                     Z-ADDODRL      WODRL                           CRE001
     C           DPA,I     WHEQ 1                                         CRE001
     C           ODRL      MULT 10        WODRL                           CRE001
     C           DPA,I     WHEQ 2                                         CRE001
     C           ODRL      MULT 100       WODRL                           CRE001
     C           DPA,I     WHEQ 3                                         CRE001
     C           ODRL      MULT 1000      WODRL                           CRE001
     C                     ENDSL                           - E4           CRE001
      *                                                                   CRE001
     C           WODRL     IFGT *ZEROS                     - B4           CRE001
     C                     Z-ADDWODRL     PSTD0                           CRE001
     C                     ELSE                            - X4           CRE001
     C                     Z-SUBWODRL     PSTD0                           CRE001
     C                     ENDIF                           - E4           CRE001
      *                                                                   CRE001
      **  Output Posting for Debit and Credit                             CRE001
      *                                                                   CRE001
     C*******************  EXSR OVERDR                     PRTF-overflow  PFJ028
      *                                                                   CRE001
     C                     ENDIF                           - E3           CRE001
      *                                                                   CRE001
     C                     END                             - E2
     C*
     C                     END                             - E1
      *----------------------------------------------------------------   CRE001
      ** If CRE001 is switched ON and Overdraft Processed Ind. is 'Y'     CRE001
      ** then Output Overdraft Limit                                      CRE001
      *-----------------------------------------------------------------  CRE001
     C           CRE001    IFEQ 'Y'                        - B1           CRE001
     C           ODLI      ANDEQ'Y'                                       CRE001
      *                                                                   CRE001
     C                     MOVE *BLANKS   ODLI                            CRE001
     C                     MOVE *BLANKS   PSTDO                           CRE001
     C                     Z-ADD*ZEROS    PPSTD                           CRE001
     C                     MOVE *BLANKS   PSTDA                           CRE001
      *                                                                   CRE001
     C           PVALD     IFNE DHISD                      - B2           CRE001
      *                                                                   CRE001
      ** Convert History Debit Capitalisation Date to DDMMMYY Format      CRE001
     C                     MOVELDHISD     ZDAYNO                          CRE001
     C                     EXSR ZDATE2                                    CRE001
     C                     MOVE ZDATE     VALDO                           CRE001
      *                                                                   CRE001
      ** Handle Conversion Error.                                         CRE001
      *                                                                   CRE001
     C           ZERROR    IFNE 0                          - B3           CRE001
     C                     Z-ADDDHISD     WDATE                           CRE001
     C                     Z-ADD421       DBASE                           CRE001
     C                     MOVEL'ZDAT2'   DBFILE           ***************CRE001
     C                     MOVELWDATE     DBKEY            **DB ERROR 421*CRE001
     C                     MOVEA'1'       *IN,89           ***************CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                           - E3           CRE001
      *                                                                   CRE001
     C                     Z-ADDDHISD     PVALD                           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
     C                     MOVE VALDO     VALDA                           CRE001
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   CRE001
     C                     MOVELNAR,39    NARR                            CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     WODRL  150                      CRE001
     C                     SELEC                           - B2           CRE001
     C           DPA,I     WHEQ 0                                         CRE001
     C                     Z-ADDODRL      WODRL                           CRE001
     C           DPA,I     WHEQ 1                                         CRE001
     C           ODRL      MULT 10        WODRL                           CRE001
     C           DPA,I     WHEQ 2                                         CRE001
     C           ODRL      MULT 100       WODRL                           CRE001
     C           DPA,I     WHEQ 3                                         CRE001
     C           ODRL      MULT 1000      WODRL                           CRE001
     C                     ENDSL                           - E2           CRE001
      *                                                                   CRE001
     C           WODRL     IFGT *ZEROS                     - B2           CRE001
     C                     Z-ADDWODRL     PSTD0                           CRE001
     C                     ELSE                            - X2           CRE001
     C                     Z-SUBWODRL     PSTD0                           CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
      **  Output Posting for Debit and Credit                             CRE001
      *                                                                   CRE001
     C*********************EXSR OVERDR                     PRTF-Overflow  PFJ028
      *                                                                   CRE001
     C                     ENDIF                           - E1           CRE001
     C*---------------------------------------------------------
     C           WHISB     IFGT *ZEROS                     - B1           PFJ028
      *
     C           CDAIC     SUB  WDAIDD    INTD0                           125176
     C                     SUB  MADR#     INTD0                           125176
     C                     Z-ADD0         INTC0                           PFJ028
     C                     Z-ADDWDRCBD    ZICALC
     C                     Z-ADDWHISDD    ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         NUMB4                           PFJ028
     C           DAYS      IFNE *ZEROS                     - B2           125176
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E2            64051
      *
     C                     END                             - E1           PFJ028
      *-----------------------------------------------------------------
     C           WHISB     IFLT *ZEROS                     - B1           PFJ028
      *
     C           CCAIC     SUB  WCAIDD    INTC0                           125176
     C                     SUB  MACR#     INTC0                           125176
     C                     Z-ADD0         INTD0                           PFJ028
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           094674
     C                     ENDIF                                                            MD058206
     C                     Z-ADDWCRCBC    ZICALC
     C                     Z-ADDWHISDC    ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
      *
     C                     Z-ADDWHISB     HISB4                           PFJ028
     C           HISB4     MULT DAYS      NUMB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADD0         NUMB0                           PFJ028
      *
     C           DAYS      IFNE *ZEROS                     - B2           125176
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C                     END                             - E2            64051
      *
     C                     END                                            PFJ028
     C*                                                    - E1
     C**  Prepare C/F balance
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C**  Transfer date MIDAS into DDMMMYY                                242804
     C*                                                                   242804
     C           PVALD     IFNE CHISD                      - B1           242804
     C                     Z-ADDCHISD     ZDAYNO                          242804
     C                     EXSR ZDATE2                                    242804
     C                     MOVE ZDATE     VALDO                           242804
     C                     MOVE CHISD     PVALD                           242804
     C                     END                             - E1           242804
     C*                                                                   242804
     C                     MOVE VALDO     VALDA                           242804
     C                     MOVE VALDO     VALDAY                          242804
      *
     C*********************Z-ADDCHISB     HISB0                           PFJ028
      *
     C           CHISB     IFGT 0                          - B1           PFJ028
     C                     MOVEA'10'      *IN,42           DEBIT          PFJ028
     C                     Z-ADDCHISB     HISB0                           PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     ELSE                            - X1           PFJ028
     C                     MOVEA'01'      *IN,42           CREDIT         PFJ028
     C                     Z-ADDCHISB     HISB4                           PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C           CHISB     IFEQ 0                          - B2           PFJ028
     C                     MOVEA'11'      *IN,42                          PFJ028
     C                     END                             - E2           PFJ028
     C                     END                             - E1           PFJ028
     C*
     C**  Output balance C/F
     C*
     C******************** EXSR OVERDR                    PRTF-overflow
     C*******************  WRITETITLEDC                                   PFJ028
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
     C*
     C**  Prepare total interest output
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDCLDID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C                     Z-ADDCDAIC     TINTD0
     C                     Z-ADDCCAIC     TINTC0                                 248123
     C*
     C**  Output total interest
     C                     MOVEL'N'       ZEROI   1
     C           CCAIC     IFEQ 0                          accrued int.DR PFJ028
     C           CDAIC     ANDEQ0                          accrued int.CR PFJ028
     C**  set a "no-details" flag for later CM processing
     C                     MOVEL'Y'       ZEROI
     C                     ELSE                            - X1           PFJ028
     C******************** EXSR OVERDR                     PRTF-Overflow
     C****************     WRITETOTALDC                                   PFJ028
     C                     EXSR TOTLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *
     C                     END                             - E1           PFJ028
      *
     C*
     C/COPY WNCPYSRC,RE3761C001
      *
     C                     Z-ADD*ZEROS    TINTD0                          248123
     C                     Z-ADD*ZEROS    TINTC0                          248123
      * Interest adjustment line                                          PFJ028
      *
     C                     MOVEA*IN,42    SA4243  2                       PFJ028
     C                     MOVEA'11'      *IN,42                          PFJ028
     C           CSGADI    IFNE *ZERO                      - B1           094337
     C                     EXSR CLMSG                                     094337
     C           CSGADI    IFGT *ZERO                      - B2           249283
     C                     Z-ADDCSGADI    TINTD0                          094337
     C                     ELSE                            - X2           249283
     C                     Z-SUBCSGADI    TINTC0                          249283
     C                     END                             - E2           249283
     C                     MOVELNAR,23    DNARR                           094337
     C*******************  EXSR OVERDR                     PRTF-Overflow  094337
     C******************** WRITETOTIAD                                    PFJ028
     C                     EXSR TOTIAD                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E1           094337
      *
     C                     Z-ADD*ZEROS    TINTD0                          248123
     C                     Z-ADD*ZEROS    TINTC0                          248123
     C           CSGACI    IFNE *ZERO                      - E1           094337
     C                     EXSR CLMSG                                     094337
     C           CSGACI    IFGT *ZERO                      - E2           249283
     C                     Z-ADDCSGACI    TINTC0                          249283
     C                     ELSE                            - X2           249283
     C                     Z-SUBCSGACI    TINTD0                          249283
     C                     END                             - E2           249283
     C                     MOVELNAR,23    DNARR                           094337
     C*******************  EXSR OVERDR                     PRTF-overflow  PFJ028
     C******************   WRITETOTIAD                                    PFJ028
     C                     EXSR TOTIAD                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E1           094337
     C*                                                                   094337
     C* Charge Report if necessary                                        094337
     C           CCICI     IFNE *BLANK                     - B1           094337
     C           CCHGP     ANDNE*ZERO                                     125176
     C                     Z-ADDCCHGP     CHGP0                           094337
     C                     MOVELNAR,22    XNARR                           125176
     C                     Z-ADD0         PSTD0                           125176
RS   C*                    EXSR OVERCH                                    125176
RS   C*                    WRITESTOTCH                                    125176
     C*                                                                   094337
     C** Prepare Rebate                                                   094337
     C                     EXSR REBSR                                     094337
     C           REBATE    IFNE 0                          - B2           125176
     C                     MOVELNAR,36    XNARR                           125176
     C                     Z-ADDCMNBCP    PSTD0                           094337
     C                     Z-ADDREBATE    TCHR0                           094337
RS   C*                    WRITESREBCH                                    094337
     C                     END                             - E2           125176
     C                     MOVELNAR,21    XNARR                           125176
RS   C*                    WRITETOTALCH                                   094337
     C                     END                             - E1           094337
     C*
     C**  Prepare total commission output
     C*
     C**  Prepare fixed commission output
     C***********          MOVE '0'       *IN59                           094337
     C                     MOVE '1'       *IN59                           094337
     C                     MOVE '0'       *IN58                           PFJ028
     C*
     C           FXDC      IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,28    DNARR
     C*
     C                     Z-ADDFXDC      TINTD0
     C*******************  EXSR OVERDR                     PRTF-overflow
     C******************   WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E1
     C*
     C**  Prepare commission on debit interest
     C*
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           CDIE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C                     Z-ADDCDIE      TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C*******************  WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C*
     C**  Prepare account commission
     C*
     C           ACCEA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C                     Z-ADDACCEA     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare H/O commission
     C*
     C           CHDBE     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C                     Z-ADDCHDBE     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare commission on minimum balance
     C*
     C           CMBE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C                     Z-ADDCMBE      TINTD0
     C*******************  EXSR OVERDR                     PRTF-overflow
     C*******************  WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare inactive commission
     C*
     C           IACE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,30    DNARR
     C*
     C                     Z-ADDIACE      TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C           CDICA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C           CDICA     SUB  CCDIC     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare account commission
     C*
     C           ACCC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C           ACCC      SUB  CACCC     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare H/O commission
     C*
     C           CHDBC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C           CHDBC     SUB  CCHDBC    TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare commission on minimum balance
     C*
     C           CMBC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C           CMBC      SUB  CCMBC     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare VAT
     C*
     C           VATAM     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,24    DNARR
     C*
     C                     Z-ADDVATAM     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C**  Prepare inactive commission
     C*
     C           IACCC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,30    DNARR
     C*
     C                     Z-ADDIACCC     TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C**  Prepare extra daily statment commission
     C*
     C           NOIP      ADD  CCINST    CCINST
     C           CCINST    IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,34    DNARR
     C*
     C                     Z-ADDCCINST    TINTD0
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITETOTCOM                                    PFJ028
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E2
     C/COPY WNCPYSRC,RE3761C008
     C*
     C**  Prepare total charges
     C*
     C           CCHGP     IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,22    DNARR
     C*
     C                     Z-ADDCCHGP     TINTC0
     C******************** EXSR OVERDR                     PRTF-overflow  PFJ028
     C******************** WRITETOTDDC                             PFJ028 EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E1
     C*
     C*
     C**  Prepare withholding tax output
     C*
     C           WWCINW    IFNE *ZEROS                     - B1
     C                     EXSR CLMSG
     C                     MOVEL*BLANKS   NCACP  19
     C           CACP      IFNE *BLANKS                    - B2
     C                     MOVEL' BY '    NCACP
     C                     MOVE CACP      NCACP
     C                     END                             - E2
     C                     MOVELNAR,26    DNARR
     C                     MOVE NCACP     DNARR
     C*
     C                     Z-ADD*ZEROS    TINTD0
     C                     Z-ADDWWCINW    TINTC0
     C*******************  EXSR OVERDR                                    PFJ028
     C                     MOVE '1'       *IN43            PRTF-overflow  PFJ028
     C*******************  WRITETOTDDC                             PFJ028 EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '0'       *IN43                           PFJ028
     C                     MOVE '1'       *IN59
     C                     MOVE '1'       *IN58                           PFJ028
     C                     END                             - E1
     C*
     C**  Prepare total
     C*
     C                     Z-ADD*ZERO     TINTD0
     C                     Z-ADD*ZERO     TINTC0                          086087
     C/COPY WNCPYSRC,RE3761C002
     C                     ADD  CCINST    TINTD0
     C           *IN70     IFEQ '0'                        - B1
     C                     ADD  CDICA     TINTD0
     C                     ADD  ACCC      TINTD0
     C                     ADD  CHDBC     TINTD0
     C                     ADD  CMBC      TINTD0
     C                     ADD  VATAM     TINTD0
     C                     ADD  IACCC     TINTD0
     C**********           ADD  CSGADI    TINTD0                   094337 121125
     C                     ELSE                            - X1
     C                     ADD  CDIE      TINTD0
     C                     ADD  ACCEA     TINTD0
     C                     ADD  CHDBE     TINTD0
     C                     ADD  CMBE      TINTD0
     C                     ADD  IACE      TINTD0
     C**********           ADD  CSGADI    TINTD0                   094337 121125
     C                     END                             - E1
     C                     ADD  FXDC      TINTD0
     C           CSGADI    IFGT *ZERO                      - B1           249283
     C                     ADD  CSGADI    TINTD0                          121125
     C                     ELSE                            - X1           249283
     C                     SUB  CSGADI    TINTC0                          248283
     C                     END                             - E1           249283
     C/COPY WNCPYSRC,RE3761C009
     C           CSDCI     IFEQ 'Y'                        - B1
     C           CSDCI     OREQ 'I'
     C           CSDCI     OREQ 'A'
     C           CSDCI     OREQ 'L'                                       PFJ028
     C                     ADD  CDAIC     TINTD0
     C                     END                             - E1
     C           CSCCI     IFEQ 'Y'                        - B1
     C           CSCCI     OREQ 'I'
     C           CSCCI     OREQ 'A'
     C           CSCCI     OREQ 'L'                                       PFJ028
     C***********          SUB  CCAIC     TINTD0                          086087
     C***********          ADD  WWCINW    TINTD0                          086087
     C****                 SUB  CCAIC     TINTC0                          086087 249283
     C                     ADD  CCAIC     TINTC0                          249283
     C                     ADD  WWCINW    TINTC0                          086087
      *                                                                   086087
      * Add BRT if applicable                                             086087
     C           *IN22     IFEQ '1'                        - B2           086087
     C                     ADD  BRTOT0    TINTC0                          086087
     C                     END                             - E2           086087
     C                     END                             - E1
     C           CSCHGI    IFEQ 'Y'                        - B1
     C           CSCHGI    OREQ 'I'
     C           CSCHGI    OREQ 'A'
     C           CSCHGI    OREQ 'L'                                       085171
     C           CSCHGI    OREQ 'O'                                       085171
     C                     ADD  CCHGP     TINTC0                          086087
     C                     END                             - E1
     C           CSGACI    IFGT *ZERO                      - B1           249283
     C                     ADD  CSGACI    TINTC0                          249283
     C                     ELSE                            - X1           249283
     C                     SUB  CSGACI    TINTD0                          249283
     C                     END                             - E1           249283
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C*
     C           *IN58     IFEQ '1'                        - B1           PFJ028
     C******************** EXSR OVERDR                     PRTF-overflow  PFJ028
     C******************** WRITETOTDDC                             PFJ028 EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E1           PFJ028
     C*
      * Report alternative a/c for DR interest if used                    125176
     C           DACP      IFNE *BLANK                     - B1           125176
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                        - B2
     C           DEXRT     ANDNE*ZEROS                                    125176
     C                     Z-ADDDEXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                            - X2           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                             - E2           094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,32    NARR                            125176
     C                     MOVELDACP      MIDK   15                       094337
     C******************** EXSR OVERDR                     PRTF-overflow
     C******************** WRITEALTNDC                             PFJ028 EMP007
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E1
      *                                                                   125176
      * Report alternative a/c for CR interest if used                    125176
     C           CACP      IFNE *BLANK                     - B1           094337
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                        - B2           125176
     C           CEXRT     ANDNE*ZEROS                                    125176
     C                     Z-ADDCEXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                            - X2           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                             - E2           094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,31    NARR                            125176
     C                     MOVELCACP      MIDK                            094337
     C******************** WRITEALTNDC                             PFJ028 EMP007
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E2
     C*                                                                   094337
      * Report alternative a/c for charges if used                        125176
     C           CHAC      IFNE *BLANK                     - E1           094337
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                                       125176
     C           CHXRT     ANDNE*ZEROS                     - B2           125176
     C                     Z-ADDCHXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                            - X2           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                             - E2           094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,33    NARR                            125176
     C                     MOVELCHAC      MIDK                            094337
     C*******************  EXSR OVERDR                     PRTF-overflow  PFJ028
     C*******************  WRITEALTNDC                                    PFJ028
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                             - E1
     C                     MOVEASA4243    *IN,42                          PFJ028
     C*
      *-- Base de calcul commission de compte                             PFJ028
     C                     Z-ADDGVDPC     TPOS0                           PFJ028
      *-- Base de calcul +fort decouvert                                  PFJ028
     C                     Z-ADDHDRB      PBAL0                           PFJ028
      *-- TOTAL INTERETS DEBIT
     C                     Z-ADD0         INTTD0                          PFJ028
     C                     Z-ADDCDAIC     INTTD0                          PFJ028
      *-- TOTAL INTERETS CREDIT
     C                     Z-ADD0         INTTC0                          PFJ028
     C                     Z-ADDCCAIC     INTTC0                          PFJ028
      *
     C*******************  WRITETOTALR                             PFJ028 EMP007
     C                     EXSR TOTALR                                    EMP007
     C*
     C*
      *-------------------------------------------------------
     C           EXBOTH    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C** CRSR subroutine for credit output processing
     C**
     C**     Called by       DETPR
     C**     Calls           DBSR, RATEC, ITYPCR, ZICD
     C**
     C********************************************************************
     C           CRSR      BEGSR                           **CRSR BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'CRSR  '  @STK,Q
      *...............................................................
     C**  Output Header lines
     C*
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
      *** DEBUT PFJ028
     C*********************WRITEHEADCR
     C*******************  WRITEHEADDC                                    EMP007
     C                     EXSR HEADDC                                    EMP007
     C*
      *** Fin   PFJ028
     C*
     C***********          END                                            085713
      *                                                                   125176
      * Charge report if necessary                                        125176
     C           CCICI     IFNE *BLANK                                    125176
     C           CCHGP     ANDNE*ZERO                                     125176
RS   C*                    WRITEHEADCH                                    125176
     C                     END                                            125176
     C*
     C**  Access REHISL with last Credit Capitalisation date
     C*
     C***********KLIST3    CHAINREHISL               52                   64051
     C           KLIST3    SETLLREHISL               52                   64051
     C*                                                                   64051
     C           KLIST1    READEREHISL                   52               64051
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD5         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 05**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C           SDICI     ANDNE*BLANKS                                  098818
     C           SCICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDMVT     ANDEQ*ZERO                                     094337
     C           DCMVT     ANDEQ*ZERO                                     094337
     C           DMACI     ANDEQ*ZERO                                     094337
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C**  Prepare B/F Balance
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADDDHISD     BDATE   50                      094337
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     HISB0
     C                     ELSE                            - X2
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD6         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 06**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     Z-ADDDHISB     COHISB
     C                     Z-ADDDHISB     WHISB                           058684
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
     C*
     C**  Output B/F Balance
     C*
     C*****************    EXSR OVERCR
      *** Debut PFJ028
     C*********************WRITETITLECR
     C*********************MOVEL'A5      'VALDAY
     C************         WRITETITLEDC                                   EMP007
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
     C*
      *** Fin   PFJ028
     C*
     C           KLIST3    SETLLREHPOPH
     C           KLIST1    READEREHPOPH                  50
     C*
     C**  Back value processing start
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C***********PSTD      ANDGECLCID                                     094337
     C           PSTD      ANDLECHISD                                     094337
     C*
     C**  Convert Posting date from Midas-format into DDMMMYY
     C*
      * If last day accruals a backvalued item posted on cap. value       125176
      * date is already reflected in that capitalisation.                 125176
      * If first day accruals a backvalued item posted on cap. value      125176
      * date is not reflected in that capitalisation as the cap. value    125176
      * date is cap. date + 1.                                            125176
     C           HISD      IFLT CLCID
     C           PSTD      ANDGTCLCID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLCID                                     094337
     C           PSTD      ANDGECLCID                                     094337
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B2
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E2
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C**  Convert Value date from Midas-fmt. into DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B2
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E2
     C*
     C                     MOVELPNAR      NARR
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  Check if Debit or Credit
     C*
     C           RECI      IFEQ 'P'                        - B3           094337
     C           DRCR      IFEQ 0                          - B2
     C           TURN      IFNE 'Y'
     C                     MOVE '1'       *IN33
     C                     END
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X2
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E2
     C*
     C**  Output back value
     C*
     C*****************    EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C*
     C                     MOVE '0'       *IN33
     C*
     C***********          END                              - E3          094337
     C*
     C* Charge Report if necessary
     C*
RS   C*                    EXSR PRN2CH                     chargesDetails2085713
     C                     ELSE                             - X3          094337
     C           DRCR      IFEQ 1                           - B4          094337
     C                     Z-ADDHISD      DCRCD                           094337
     C                     EXSR RATEC                                     094337
     C                     END                              - E4          094337
     C                     END                              - E3          094337
      *
     C                     END                              - E2          094337
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C*
      * Generated adjustments going to the a/c should be reported for     125176
      * both management and non-management CR only cap. as they affect    125176
      * the balance and DR adjs. would not be posted at a CR only cap.    125176
     C********** *IN70     IFEQ '1'                        - B1           125176
     C           KLIST1    SETLLREHISSL                  20
     C*
      * Report generated adjustments before start date                    125176
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C********** AHISD     ANDLECLCID                                     125176
     C           AHISD     ANDLTCLCID                                     125176
     C           AHISD     ANDLTCHISD
     C*
     C** Print interest of the back value date
     C*
     C***********SDCI      IFEQ 'Y'                        - B4           094337
     C***********SCCI      OREQ 'Y'                                       094337
     C           SCCI      IFEQ 'Y'                                       094337
     C           SDCI      OREQ 'Y'                                       125176
     C*
     C           PPSTD     IFNE RUND                       - B5
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E5
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B5
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E5
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B5
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     Z-ADDADAIC     PSTD0                           064051
     C*************        EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C           SCCI      IFEQ 'Y'                        - B5
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C****************     EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     ELSE                                           125176
     C                     MOVE '1'       *IN20                           125176
     C                     END                             - E2
     C*
     C*
     C**  Back value processing end
     C*
     C           KLIST3    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
     C**  Prepare Opening Balance output
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADDDHISB     WHISB
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     WHISB
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-ADDCOHISB    HISB0
     C                     Z-ADDCOHISB    WHISBC                          094337
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,2     TNARR
     C*
     C**  SAVE IN CASE OF NO POSTING
     C*
     C                     Z-ADDCLCID     WHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           CLCID     IFNE PVALD                      - B1
     C                     Z-ADDCLCID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLCID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  OUTPUT OPENING BALANCE
     C*
     C*******************  EXSR OVERCR
      *** DEBUT PFJ028
     C*********************WRITETITLECR
     C*********************MOVEL'A5      'VALDAY
     C******************   WRITETITLEDC                                   EMP007
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
     C*
      *** FIN   PFJ028
     C*
     C**  PREPARE OPENING RATE OUTPUT
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,8     RNARR
     C*
     C**  OUTPUT OPENING RATE
     C*
      **  ACCESS REHRCJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS       094337
      **  THE GOOD DATES FOR DEBIT RATE CHANGE TO                         094337
      *                                                                   094337
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST1    REDPEREHRCJ                   60               094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLCID                      - B1           094337
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST3    READEREHRCJ                   60               094337
     C                     END                                            094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C                     Z-ADD*ZEROS    CRIR                            094337
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           094337
      *                                                                   094337
     C                     EXSR CLMSG                                     094337
     C                     MOVELNAR,8     RNARR                           094337
      *                                                                   094337
     C                     MOVE *BLANKS   PSTDA                           094337
     C                     MOVE *BLANKS   VALDA                           094337
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *                                                                   094337
      **  OUTPUT CREDIT RATE CHANGE TO                                    094337
      *                                                                   094337
      *   CHANGE NARRAT. 'RATE CHANGE TO' TO 'OPENING RATE'               094337
     C                     MOVE 'Y'       OPN     1                       094337
     C                     EXSR RCRSR                                     094337
     C                     MOVE ' '       OPN     1                       094337
      *                                                                   125176
      * Report generated adjustments on start date                        125176
     C           *IN20     IFEQ '0'                                       125176
     C           AHISD     ANDEQCLCID                                     125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                                       125176
     C           SCCI      OREQ 'Y'                                       125176
      *                                                                   125176
     C           PPSTD     IFNE RUND                                      125176
     C                     Z-ADDRUND      ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     PSTDO                           125176
     C                     Z-ADDRUND      PPSTD                           125176
     C                     END                                            125176
     C                     MOVE PSTDO     PSTDA                           125176
      *                                                                   125176
     C           PVALD     IFNE AHISD                                     125176
     C                     Z-ADDAHISD     ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     VALDO                           125176
     C                     Z-ADDAHISD     PVALD                           125176
     C                     END                                            125176
     C                     MOVE VALDO     VALDA                           125176
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   125176
     C                     MOVELNAR,23    NARR                            125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                                       125176
     C           ADAIC     ANDNE*ZEROS                                    125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     Z-ADDADAIC     PSTD0                           125176
     C*************        EXSR OVERCR                             125176 EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR                                    125176
    *** PAS DE DETAIL      WRITEPOSTDC                                    125176
      *** FIN  PFJ028
     C                     END                                            125176
      *                                                                   125176
     C           SCCI      IFEQ 'Y'                                       125176
     C           ACAIC     ANDNE*ZEROS                                    125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     Z-SUBACAIC     PSTD0                           125176
     C*****************    EXSR OVERCR                             125176 EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR                                    125176
    *** PAS DE DETAIL      WRITEPOSTDC                                    125176
      *** FIN  PFJ028
     C                     END                                            125176
      *                                                                   125176
     C                     END                                            125176
     C                     END                                            125176
     C*
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C***********SDICI     ANDEQ'Y'                                       094337
     C********** SCICI     ANDEQ*BLANKS                                   125176
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C********** DDRCI     ANDEQ'Y'                                       125176
     C           DDMVT     ANDEQ*ZERO                                     094337
     C           DCMVT     ANDEQ*ZERO                                     094337
     C           DMACI     ANDEQ*ZERO                                     094337
     C           @ADJF     ANDEQ*BLANKS                                   125176
      *                                                                   125176
      * Check for generated adjustment after start date (must be DR).     125176
     C           *IN51     IFEQ '0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
     C           SDAIC     ANDNE*ZEROS                                    125176
     C           SSDCI     ANDEQ'Y'                                       125176
     C                     Z-ADDSDAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
      *                                                                   125176
     C           KLIST1    READEREHISL                   51
     C                     END                             - E2
     C*
     C           *IN51     IFEQ '0'                        - B2           125176
     C           WHISD     ANDNEDHISD                                     125176
     C           DHISD     ANDLTCHISD                                     125176
     C           CCICT     IFLT 3                          - B3           125176
     C                     Z-ADDWCRCB     ZICALC                          125176
     C                     Z-ADDWHISD     ZIBEG                           125176
     C                     Z-ADDDHISD     ZIEND                           125176
     C                     EXSR DAYCSR                                    125176
     C                     ELSE                            - X3           125176
     C                     EXSR ITYPCR                                    125176
     C                     END                             - E3           125176
     C                     END                             - E2           125176
     C*
     C                     END                             - E1
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
      *                                                                   125176
      * Report generated adjustment after start date if found             125176
     C           @ADJF     IFEQ 'Y'                                       125176
     C                     EXSR #ADJ                                      125176
     C           DHISD     IFGT CLCID                                     125176
     C**********           EXSR OVERCR                             125176 EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR                                    125176
    *** PAS DE DETAIL      WRITEPOSTDC                                    125176
      *** FIN  PFJ028
     C                     END                                            125176
     C                     END                                            125176
     C*
     C**  PROCESS POSTING AT THE SAME DATE
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     END                             - E3
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C                     MOVE PSTDO     PSTDA
     C                     MOVELPNAR      NARR
     C*
     C**  CHECK IF DEBIT OR CREDIT
     C*
     C           DRCR      IFEQ 0                          - B3
     C           TURN      IFNE 'Y'
     C                     MOVE '1'       *IN33
     C                     END
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X3
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUTPUT POSTING
     C*
     C***************      EXSR OVERCR                     EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C*
     C                     MOVE '0'       *IN33
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
RS   C*                    EXSR PRN2CH                     chargesDetails2085713
     C*
     C                     Z-ADDPSTD      PPSTD
     C                     Z-ADDHISD      PVALD
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C** PRINT THE MANUAL ADJUSTEMENT
     C*
     C           DMACI     IFNE *ZEROS
     C*
     C           KLIST9    SETLLREHPOML2                 56
     C           KLIST9    READEREHPOML2                 56
     C           *IN56     DOWEQ'0'
     C*
     C           PPSTD     IFNE MAHISD                     - B1
     C                     Z-ADDMAHISD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C*
     C                     END                             - E1
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE VALD                       - B1
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C*
     C                     Z-ADDVALD      PVALD
     C*
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,29    NARR
     C*
     C           CRIA      IFNE *ZEROS
     C                     Z-ADDCRIA      INTC0
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WMA                        WRITE MAN ADJ  094431
     C                     Z-ADD*ZEROS    INTC0
     C                     END
     C*
     C           KLIST9    READEREHPOML2                 56
     C*
     C                     END
     C*
     C                     END
     C*
     C**  CREDIT RATE CHANGE TO
     C*
     C           DCRCI     IFEQ 'Y'                        - B2
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATEC
     C*
     C                     END                             - E2
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDMVT     ANDEQ*ZEROS
     C           DCMVT     ANDEQ*ZEROS
     C           DMACI     ANDEQ*ZERO                                     094337
     C           @ADJF     ANDEQ*BLANKS                                   125176
      *                                                                   125176
      * Check for DR generated adjustment                                 125176
     C           *IN51     IFEQ '0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
     C           SDAIC     ANDNE*ZEROS                                    125176
     C           SSDCI     ANDEQ'Y'                                       125176
     C                     Z-ADDSDAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E2
     C*
     C**  OUTPUT SUBTOTAL LINE
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C           CCICT     IFLT 3                          - B3
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYCSR
     C                     ELSE                            - X3
     C                     EXSR ITYPCR
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           DCICT     IFLT 3                          - B1
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
      *** DEBUT PFJ028
     C   80                Z-ADDWHISB     HISB4
     C   81                Z-ADDWHISB     HISB5
     C   82                Z-ADDWHISB     HISB6
     C   83                Z-ADDWHISB     HISB7
     C   80      HISB4     MULT DAYS      NUMB4
     C   81      HISB5     MULT DAYS      NUMB5
     C   82      HISB6     MULT DAYS      NUMB6
     C   83      HISB7     MULT DAYS      NUMB7
      *** FIN   PFJ028
     C*
     C           CCAIC     SUB  WCAID     INTC0
     C                     SUB  MACR#     INTC0                           125176
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0
     C                     ENDIF                                                            MD058206
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C                     END                             - E1
     C*
     C** PREPARE C/F BALANCE
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE CHISD                      - B1
     C                     Z-ADDCHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C*
     C                     MOVE CHISD     PVALD
     C*
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
      *** DEBUT PFJ028
     C   80                Z-ADDCHISB     HISB4
     C   81                Z-ADDCHISB     HISB5
     C   82                Z-ADDCHISB     HISB6
     C   83                Z-ADDCHISB     HISB7
      *** FIN   PFJ028
     C*
     C**  OUTPUT BALANCE C/F
     C*
     C*******************  EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C*****                WRITETITLEDC                                   EMP007
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
     C*
      *** FIN   PFJ028
     C*
     C**  PREPARE TOTAL INTEREST OUTPUT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDCLCID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C                     Z-ADDCCAIC     TINTC0                          094337
     C*
     C                     MOVEL'N'       ZEROI   1                       EMP007
      ** If accrued interest Credit                                       EMP007
     C           CCAIC     IFEQ 0                                         EMP007
     C                     MOVEL'Y'       ZEROI                           EMP007
     C                     ENDIF                                          EMP007
     C*
     C**  Output total interest
     C*
     C                     EXSR CALBRT
     C/COPY WNCPYSRC,RE3761C003
     C*
     C**********           EXSR OVERCR
      *** DEBUT PFJ028
     C********************* RITETOTALCR                                   094431
     C*******************  WRITETOTALDC                                   EMP007
     C                     EXSR TOTLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
     C           CSGACI    IFNE *ZERO                                     094337
     C                     EXSR CLMSG                                     094337
     C                     Z-SUBCSGACI    TINTC0                          094337
     C                     MOVELNAR,23    DNARR                           094337
     C************         EXSR OVERCR                                    094337
      *** DEBUT PFJ028
     C******************   WRITETOTDDC                                    EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
      *** FIN   PFJ028
     C                     END                                            094337
     C*
     C* Charge Report if necessary
     C*
     C           CCICI     IFNE *BLANK
     C           CCHGP     ANDNE*ZERO                                     125176
     C                     Z-ADDCCHGP     CHGP0
     C                     Z-ADD0         PSTD0                           125176
     C                     MOVELNAR,22    XNARR                           125176
RS   C*                    EXSR OVERCH                                    125176
RS   C*                    WRITESTOTCH                                    125176
     C*                                                                   094337
     C** Prepare rebate                                                   094337
     C                     EXSR REBSR                                     094337
     C           REBATE    IFNE 0                                         125176
     C                     MOVELNAR,36    XNARR                           125176
     C                     Z-ADDCMNBCP    PSTD0                           094337
     C                     Z-ADDREBATE    TCHR0                           094337
RS   C*                    WRITESREBCH                             094337 EMP007
     C                     END                                            125176
     C                     MOVELNAR,21    XNARR                           125176
RS   C*                    WRITETOTALCH
     C                     END
     C*                                                                   085171
     C                     MOVE '0'       *IN59                           085171
     C*
     C**  Prepare total charges
     C           CCHGP     IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,22    DNARR
     C*
     C                     Z-ADDCCHGP     TINTC0
     C*****************    EXSR OVERCR
      *** DEBUT PFJ028
     C******************   WRITETOTDDC                                    EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
      *** FIN   PFJ028
     C                     MOVE '1'       *IN59                           085171
     C                     END                             -E1
     C*
     C***********          MOVE '0'       *IN59                           085171
     C*
     C**  Prepare withholding tax output
     C*
     C           WWCINW    IFNE *ZEROS                     - B1
     C                     EXSR CLMSG
     C                     MOVEL*BLANKS   NCACP
     C           CACP      IFNE *BLANKS                    - B2
     C                     MOVEL' BY '    NCACP
     C                     MOVE CACP      NCACP
     C                     END                             - E2
     C                     MOVELNAR,26    DNARR
     C                     MOVE NCACP     DNARR
     C*
     C                     Z-ADD*ZEROS    TINTD0
     C                     Z-ADDWWCINW    TINTC0
     C*************        EXSR OVERCR
      *** DEBUT PFJ028
     C***************      WRITETOTDDC                                    EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
     C                     MOVE '1'       *IN59
     C                     END                             - E1
     C*
     C**  Prepare Total
     C*
     C                     Z-ADD*ZERO     TINTC0
     C/COPY WNCPYSRC,RE3761C004
     C           CSCCI     IFEQ 'Y'
     C           CSCCI     OREQ 'I'
     C           CSCCI     OREQ 'A'
     C*
     C           CCAIC     IFGT 0                                                           MD058206
     C                     Z-SUBCCAIC     TINTC0
     C                     ELSE                                                             MD058206
     C                     Z-ADDCCAIC     TINTC0                                            MD058206
     C                     ENDIF                                                            MD058206
     C**********           SUB  CSGACI    TINTC0                   094337 121125
     C                     ADD  WWCINW    TINTC0                          125176
      *                                                                   086087
      * Add BRT if applicable                                             086087
     C           *IN22     IFEQ '1'                                       086087
     C                     ADD  BRTOT0    TINTC0
     C                     END                                            086087
     C                     END
     C           CSCHGI    IFEQ 'Y'
     C           CSCHGI    OREQ 'I'
     C           CSCHGI    OREQ 'A'
     C           CSCHGI    OREQ 'L'                                       085171
     C           CSCHGI    OREQ 'O'                                       085171
     C*
     C                     ADD  CCHGP     TINTC0
     C                     END
     C                     SUB  CSGACI    TINTC0
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C*
     C**********           EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C******************   WRITETOTDDC                                    EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
      *                                                                   125176
      * Report alternative a/c for CR interest if used                    125176
     C           CACP      IFNE *BLANKS                    - B2           094337
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                                       125176
     C           CEXRT     ANDNE*ZEROS                                    125176
     C                     Z-ADDCEXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                                           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                                            094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,31    NARR                            125176
     C                     MOVELCACP      MIDK                            094337
     C****************     EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C****************     WRITEALTNDC                                    EMP007
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C                     END                             - E2
      *                                                                   125176
      * Report alternative a/c for charges if used                        125176
     C           CHAC      IFNE *BLANKS                    - B2           094337
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                                       125176
     C           CHXRT     ANDNE*ZEROS                                    125176
     C                     Z-ADDCHXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                                           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                             - E2           094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,33    NARR                            125176
     C                     MOVELCHAC      MIDK                            094337
     C*************        EXSR OVERCR                                    EMP007
      *** DEBUT PFJ028
     C*****************    WRITEALTNDC                                    EMP007
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C                     END                             - E2
     C*
     C           *IN70     IFEQ '1'                        - B1
     C*****************    EXSR OVERCR                                    EMP007
      *** PFJ028           WRITETOTMCR
     C                     END
     C*
      *-------------------------------------------------------
     C           EXCRSR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR                           **CRSR ENDSR**
     C/EJECT
     C********************************************************************
     C** DRSR subroutine for debit output processing
     C**
     C**     Called by       D E T P R
     C**
     C**     Calls           DBSR, ITYPDR, RATED, ZICD
     C********************************************************************
     C           DRSR      BEGSR                           **DRSR BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'DRSR  '  @STK,Q
      *...............................................................
     C**  Output Header lines
     C*
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
      *** DEBUT PFJ028
     C*****************    WRITEHEADDC                                    EMP007
     C                     EXSR HEADDC                                    EMP007
      *** FIN   PFJ028
     C*
     C**  Access REHISL with last debit capitalisation date
     C*
     C           KLIST2    SETLLREHISL               51
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD8         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 08**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DMADI     ANDEQ*ZEROS
     C           DDMVT     ANDEQ*ZEROS
     C           DCMVT     ANDEQ*ZEROS
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C**  Prepare B/F Balance
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADDDHISD     BDATE   50                      094337
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     HISB0
     C                     ELSE                            - X2
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD9         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 09**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     Z-ADDDHISB     DOHISB
     C                     Z-ADDDHISB     WHISB                           058684
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
     C*
     C**  Output B/F Balance
     C******************   EXSR OVERDR                                    EMP007
      *** Debut FG001
     C******************** WRITETITLEDC                                   EMP007
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
      *** Fin   FG001
     C*
     C           KLIST2    SETLLREHPOPH
     C           KLIST1    READEREHPOPH                  50
     C*
     C**  Back value processing start
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLECHISD                                     094337
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
      * If last day accruals a backvalued item posted on cap. value       125176
      * date is already reflected in that capitalisation.                 125176
      * If first day accruals a backvalued item posted on cap. value      125176
      * date is not reflected in that capitalisation as the cap. value    125176
      * date is cap. date + 1.                                            125176
     C           HISD      IFLT CLDID
     C           PSTD      ANDGTCLDID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLDID                                     094337
     C           PSTD      ANDGECLDID                                     094337
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B2
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C*
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E2
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C**  Convert value date from Midas-fmt. into DDMMMYY
     C           PVALD     IFNE HISD                       - B2
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E2
     C*
     C                     MOVELPNAR      NARR
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   125176
     C           RECI      IFEQ 'P'                                       125176
     C*
     C**  Check if Debit or Credit
     C*
     C           DRCR      IFEQ 0                          - B2
     C           TURN      IFNE 'Y'
     C                     MOVE '1'       *IN33
     C                     END
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X2
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E2
     C********** RECI      IFEQ 'P'                                094337 125176
     C*
     C**  Output Back value
     C*
     C**************       EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
    *** Pas de detail      WRITEPOSTDC
      *** FIN  PFJ028
     C                     ELSE                                           094337
     C           DRCR      IFEQ 0                                         094337
     C                     Z-ADDHISD      DDRCD                           094337
     C                     EXSR RATED                                     094337
     C                     END                                            094337
     C                     END                                            094337
     C*
     C                     MOVE '0'       *IN33
     C*
     C                     END
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C*
      * Generated adjustments going to the a/c should be reported for     125176
      * both management and non-management DR only cap. as they affect    125176
      * the balance and CR adjs. would not be posted at a DR only cap.    125176
     C********** *IN70     IFEQ '1'                        - B1           125176
     C           KLIST1    SETLLREHISSL                  20
     C*
      * Report generated adjustments before start date                    125176
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C           AHISD     ANDLTCLDID
     C           AHISD     ANDLTCHISD
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C           SDCI      IFEQ 'Y'                        - B4
     C***********SCCI      OREQ 'Y'                                       094337
     C           SCCI      OREQ 'Y'                                       125176
     C*
     C           PPSTD     IFNE RUND                       - B5
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E5
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B5
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C*
     C                     Z-ADDAHISD     PVALD
     C*
     C                     END                             - E5
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B5
     C           ADAIC     ANDNE*ZEROS                                    064051
     C                     Z-ADDADAIC     PSTD0                           064051
     C****************     EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
     ** Pas de detail      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C           SCCI      IFEQ 'Y'                        - B5
     C           ACAIC     ANDNE*ZEROS                                    064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C******************   EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
     ** Pas de detail      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     ELSE
     C                     MOVE '1'       *IN20
     C                     END                             - E2
     C*
     C**  Back value processing end
     C           KLIST2    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
     C**  Prepare opening balance output
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADDDHISB     WHISB
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     WHISB
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-ADDDOHISB    HISB0
     C                     Z-ADDDOHISB    WHISBD                          094337
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,2     TNARR
     C*
     C**  Save in case of no posting
     C                     Z-ADDCLDID     WHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           CLDID     IFNE PVALD                      - B1
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  Output Opening Balance
     C*
     C*************        EXSR OVERDR                             125176 EMP007
      *** Debut PFJ028
     C******************   WRITETITLEDC                            125176 EMP007
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
      *                                                                   094337
      **  Access REHRDJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains       094337
      **  the good dates for Debit Rate change to...                      094337
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST1    REDPEREHRDJ                   60               094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLDID                      - B1           094337
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST2    READEREHRDJ                   60               094337
     C                     END                                            094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C                     Z-ADD*ZEROS    DRIR                            094337
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           094337
      *                                                                   094337
     C                     EXSR CLMSG                                     094337
     C                     MOVELNAR,3     RNARR                           094337
      *                                                                   094337
     C                     MOVE *BLANKS   PSTDA                           094337
     C                     MOVE *BLANKS   VALDA                           094337
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *                                                                   094337
      **  Output Credit Rate Change to...                                 094337
      *                                                                   094337
      *   CHANGE NARRAT. 'RATE CHANGE TO' TO 'OPENING RATE'               094337
     C                     MOVE 'Y'       OPN     1                       094337
     C                     EXSR RDRSR                                     094337
     C                     MOVE ' '       OPN     1                       094337
     C***********          EXSR OVERDR                                    094337
     C***********          WRITETITLEDR                                   094337
     C*
     C*
     C**  Prepare Opening Rate output
     C*
     C**  OUTPUT OPENING RATE
     C*
      * Report generated adjustments on start date                        125176
     C           *IN20     IFEQ '0'                        - B3           125176
     C           AHISD     ANDEQCLDID                                     125176
     C           AHISD     ANDLTCHISD
     C*
     C** Print Interest of the back value date
     C*
     C           SDCI      IFEQ 'Y'                        - B4
     C           SCCI      OREQ 'Y'
     C*
     C           PPSTD     IFNE RUND                       - B5
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E5
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B5
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E5
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B5
     C********** SGADI     ANDNE*ZEROS                              B8899064051
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     MOVE 'Y'       @ADJF                           125176
     C                     Z-ADDADAIC     PSTD0                           064051
     C***********          EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C           SCCI      IFEQ 'Y'                        - B5
     C********** SGACI     ANDNE*ZEROS                                   064051
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     MOVE 'Y'       @ADJF                           125176
     C**********           MOVELNAR,28    NARR                      64051 125176
     C******************** Z-ADDSGACI     PSTD0                           064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C******************   EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E2
     C*
     C**********           END                             - E1           125176
     C*
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C           DHISD     ANDLTCHISD                                     125176
     C           *IN51     OREQ '0'                                       125176
     C           DRECI     ANDEQ'D'                                       125176
     C           DDRCI     ANDEQ*BLANKS                                   125176
     C           DDMVT     ANDEQ*ZEROS                                    125176
     C           DCMVT     ANDEQ*ZEROS                                    125176
     C           DMADI     ANDEQ*ZEROS                                    125176
     C           @ADJF     ANDEQ*BLANKS                                   125176
      *                                                                   125176
      * Check for generated adjustment after start date (must be CR).     125176
     C           *IN51     IFEQ '0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
     C           SCAIC     ANDNE*ZEROS                                    125176
     C           SSCCI     ANDEQ'Y'                                       125176
     C                     Z-SUBSCAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
      *                                                                   125176
     C           KLIST1    READEREHISL                   51
     C                     END                             - E2
     C*
     C           *IN51     IFEQ '0'                        - B2           125176
     C           WHISD     ANDNEDHISD                                     125176
     C           DHISD     ANDLTCHISD                                     125176
     C           CDICT     IFLT 3                          - B3           125176
     C                     Z-ADDWDRCB     ZICALC                          125176
     C                     Z-ADDWHISD     ZIBEG                           125176
     C                     Z-ADDDHISD     ZIEND                           125176
     C                     EXSR DAYDSR                                    125176
     C                     ELSE                            - X3           125176
     C                     EXSR ITYPDR                                    125176
     C                     END                             - E3           125176
     C                     END                             - E2           125176
     C*
     C                     END                             - E1
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
      *                                                                   125176
      * Report generated adjustment after start date if found             125176
     C           @ADJF     IFEQ 'Y'                                       125176
     C                     EXSR #ADJ                                      125176
     C           DHISD     IFGT CLDID                                     125176
     C******               EXSR OVERDR                             125176 EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR                                    125176
    *** PAS DE DETAIL      WRITEPOSTDC                                    125176
      *** FIN  PFJ028
     C                     END                                            125176
     C                     END                                            125176
     C*
     C**  Process posting at the same date
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C                     MOVE PSTDO     PSTDA
     C                     MOVELPNAR      NARR
     C*
     C**  Check if Debit or Credit
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-ADDPSTA      PSTD0
     C           TURN      IFNE 'Y'
     C                     MOVE '1'       *IN33
     C                     END
     C                     ELSE                            - X3
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUPUT POSTING
     C*
     C***************      EXSR OVERDR                     EMP007
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C*
     C                     MOVE '0'       *IN33
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C** Print the manual adjustment
     C*
     C           DMADI     IFNE *ZEROS
     C*
     C           KLIST9    SETLLREHPOML2                 56
     C           KLIST9    READEREHPOML2                 56
     C           *IN56     DOWEQ'0'
     C*
     C           PPSTD     IFNE MAHISD                     - B1
     C                     Z-ADDMAHISD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     END                             - E1
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE VALD                       - B1
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C*
     C                     Z-ADDVALD      PVALD
     C*
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,29    NARR
     C*
     C           DRIA      IFNE *ZEROS
     C                     Z-ADDDRIA      INTD0
     C******************   EXSR OVERDR                                    094431
     C******************   WRITEMADJDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WMA                        WRITE MAN ADJ  094431
     C                     Z-ADD*ZEROS    INTD0
     C                     END
     C*
     C           KLIST9    READEREHPOML2                 56
     C*
     C                     END
     C*
     C                     END
     C*
     C*
     C**  Debit Rate change to...
     C*
     C           DDRCI     IFEQ 'Y'                        - B2
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATED
     C*
     C                     END                             - E2
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                       094337
     C********** SDICI     ANDEQ*BLANKS                                   125176
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DMADI     ANDEQ*ZEROS
     C           DDMVT     ANDEQ*ZEROS
     C           DCMVT     ANDEQ*ZEROS
     C           @ADJF     ANDEQ*BLANKS                                   125176
      *                                                                   125176
      * Check for CR generated adjustment                                 125176
     C           *IN51     IFEQ '0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
     C           SCAIC     ANDNE*ZEROS                                    125176
     C           SSCCI     ANDEQ'Y'                                       125176
     C                     Z-SUBSCAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E2
     C*
     C**  Output subtotal line
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C           CDICT     IFLT 3                          - B3
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYDSR
     C                     ELSE                            - X3
     C                     EXSR ITYPDR
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C*
     C           DDICT     IFLT 3                          - B1
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-ADDWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C*
     C           CDAIC     SUB  WDAID     INTD0
     C                     SUB  MADR#     INTD0                           125176
     C*
     C**  Output Subtotal
     C*
     C*******************  EXSR OVERDR                                    094431
     C*******************  WRITESTOTDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C                     END                             - E1
     C*
     C** Prepare C/F Balance
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE CHISD                      - B1
     C                     Z-ADDCHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     MOVE CHISD     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C                     Z-ADDCHISB     HISB0
     C*
     C**  Output Balance C/F
     C*
     C*******              EXSR OVERDR
      *** DEBUT PFJ028                                                    EMP007
     C*********************WRITETITLEDR
     C*********************MOVEL'A9      'VALDAY
     C******************   WRITETITLEDC
     C                     EXSR TITLDC                     format         EMP007
     C                     EXSR DETAIL                     extract RDEs   EMP007
     C*
      *** FIN   PFJ028
     C*
     C**  Prepare Total Interest Output
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDCLDID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C                     Z-ADDCDAIC     TINTD0
     C*
     C                     MOVEL'N'       ZEROI   1                       EMP007
      ** If accrued interest Debit                                        EMP007
     C           CDAIC     IFEQ 0                                         EMP007
     C                     MOVEL'Y'       ZEROI                           EMP007
     C                     ENDIF                                          EMP007
     C*
     C**  OUTPUT TOTAL INTEREST
     C*
     C*****                EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*******              WRITETOTALDC                                   EMP007
     C                     EXSR TOTLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
      *** FIN   PFJ028
     C           CSGADI    IFNE *ZERO                                     094337
     C                     EXSR CLMSG                                     094337
     C                     Z-ADDCSGADI    TINTD0                          094337
     C                     MOVELNAR,23    DNARR                           094337
     C*****                EXSR OVERDR                             094337 EMP007
      *** DEBUT PFJ028
     C****************     WRITETOTDDC                                    EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
     C                     END                                            094337
     C*
     C**  Prepare Total Commission output
     C*
     C***********          MOVE '0'       *IN59
     C                     MOVE '1'       *IN59
     C*
     C**  PREPARE FIXED COMMISSION OUTPUT
     C*
     C           FXDC      IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,28    DNARR
     C*
     C                     Z-ADDFXDC      TINTD0
     C****                 EXSR OVERDR                     EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDR
     C*********************WRITETOTDDC
      *** FIN   PFJ028
     C***************      WRITETOTCOM                     EMP007
     C                     EXSR TOTCOM                     EMP007
     C                     EXSR DETAIL                     EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E1
     C*
     C**  Prepare commission on debit interest
     C*
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           CDIE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C                     Z-ADDCDIE      TINTD0
     C***************      EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDR
     C*********************WRITETOTDDC                                    PFJ028
      *** FIN   PFJ028
     C******************   WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepate Account Commission
     C*
     C           ACCEA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C                     Z-ADDACCEA     TINTD0
     C***                  EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDR
     C*********************WRITETOTDDC                                    PFJ028
      *** FIN   PFJ028
     C******************   WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepare H/O Commission
     C*
     C           CHDBE     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C                     Z-ADDCHDBE     TINTD0
     C***********          EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDR
     C*********************WRITETOTDDC                                    PFJ028
      *** FIN   PFJ028
     C*************        WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepare Commission on minimum balance
     C*
     C           CMBE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C                     Z-ADDCMBE      TINTD0
     C********             EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDR
     C*********************WRITETOTDDC                                    PFJ028
      *** FIN   PFJ028
     C*******************  WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepare inactive commission
     C*
     C           IACE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,30    DNARR
     C*
     C                     Z-ADDIACE      TINTD0
     C***************      EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C*********************WRITETOTDDC                                    PFJ028
      *** FIN   PFJ028
     C************         WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C           CDICA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C           CDICA     SUB  CCDIC     TINTD0
     C**********           EXSR OVERDR                     EMP007
      *** DEBUT PFJ028
     C***************      WRITETOTDDC                     EMP007
     C                     EXSR TOTDDC                     EMP007
     C                     EXSR DETAIL                     EMP007
      *** FIN   PFJ028
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  PREPARE ACCOUNT COMMISSION
     C*
     C           ACCC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C           ACCC      SUB  CACCC     TINTD0
     C**********           EXSR OVERDR                                    EMP007
     C***************      WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  PREPARE H/O COMMISSION
     C*
     C           CHDBC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C           CHDBC     SUB  CCHDBC    TINTD0
     C**************       EXSR OVERDR                                    EMP007
     C**************       WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  PREPARE COMMISSION ON MINIMUM BALANCE
     C*
     C           CMBC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C           CMBC      SUB  CCMBC     TINTD0
     C************         EXSR OVERDR                                    EMP007
     C************         WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    PFJ028
     C                     EXSR DETAIL                                    PFJ028
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepare VAT
     C*
     C           VATAM     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,24    DNARR
     C*
     C                     Z-ADDVATAM     TINTD0
     C****************     EXSR OVERDR                                    EMP007
     C****************     WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C**  Prepare inactive commission
     C*
     C           IACCC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,30    DNARR
     C*
     C                     Z-ADDIACCC     TINTD0
     C**************       EXSR OVERDR                                    EMP007
     C****************     WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C**  Prepare extra daily statment commission
     C*
     C           NOIP      ADD  CCINST    CCINST
     C           CCINST    IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,34    DNARR
     C*
     C                     Z-ADDCCINST    TINTD0
     C****************     EXSR OVERDR                                    EMP007
     C***************      WRITETOTCOM                             PFJ028 EMP007
     C                     EXSR TOTCOM                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     MOVE '1'       *IN59
     C                     END                             - E2
     C/COPY WNCPYSRC,RE3761C010
     C*---------------------
     C**  Prepate Total
     C*
     C                     Z-ADD*ZERO     TINTD0
     C/COPY WNCPYSRC,RE3761C005
     C           CSDCI     IFEQ 'Y'
     C           CSDCI     OREQ 'I'
     C           CSDCI     OREQ 'A'
     C           CDAIC     ADD  FXDC      TINTD0
     C/COPY WNCPYSRC,RE3761C011
     C                     ADD  CDICA     TINTD0
     C                     ADD  ACCC      TINTD0
     C                     ADD  CHDBC     TINTD0
     C                     ADD  CMBC      TINTD0
     C                     ADD  VATAM     TINTD0
     C                     ADD  IACCC     TINTD0
     C                     ADD  CCINST    TINTD0
     C**********           ADD  CSGADI    TINTD0                   094337 121125
     C                     END
     C           CSGADI    IFGT *ZERO                                     249283
     C                     ADD  CSGADI    TINTD0                          121125
     C                     ELSE                                           249283
     C                     SUB  CSGADI    TINTC0                          249283
     C                     END                                            249283
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C*                                                                   249283
     C           TINTD0    IFGT *ZERO                                     249283
     C                     SUB  TINTD0    TINTC0                          249283
     C                     Z-ADD0         TINTD0                          249283
     C                     END                                            249283
     C*
     C           *IN59     IFEQ '1'                                       085171
     C***************      EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028                                                    EMP007
     C***************      WRITETOTDDC                           PFJ028   EMP007
     C                     EXSR TOTDDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
     C                     END                                            085171
     C*
     C***CAPITALISATION*TO*AN*ACCOUNT IN DIFFERENT CURRENCY AND           125176
     C***MULTIBRANCH*IS*PRESENT                                           125176
     C*
      * Report alternative a/c for DR interest if used                    125176
     C           DACP      IFNE *BLANK                                    125176
      *                                                                   125176
      * If capitalisation to a/c in different ccy, report exchange rate   125176
     C           *IN87     IFEQ '1'                        - B1
     C           DEXRT     ANDNE*ZEROS                                    125176
     C                     Z-ADDDEXRT     RATE
     C                     MOVE '0'       *IN55                           125176
     C                     ELSE                                           125176
     C                     MOVE '1'       *IN55                           125176
     C                     END                                            094337
      *                                                                   125176
     C                     EXSR CLMSG                                     125176
     C                     MOVELNAR,32    NARR                            125176
     C                     MOVELDACP      MIDK                            094337
     C**********           MOVE '1'       *IN55                    094337 125176
     C***********          EXSR OVERDR                                    EMP007
      *** DEBUT PFJ028
     C****************     WRITEALTNDC                             PFJ028 EMP007
     C                     EXSR ALTNDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C                     END                             - E2
     C*
     C           *IN70     IFEQ '1'                        - B1
     C********             EXSR OVERDR                                    EMP007
      *** PFJ028           WRITETOTMDR
     C                     END
      *
      *-------------------------------------------------------
     C           EXDRSR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR                           **DRSR ENDSR**
     C/EJECT
     C********************************************************************
     C** DAYCSR subroutine to prepare and output days total
     C**
     C**     Called by       CRSR, DRSR
     C**
     C**     Calls           ZICD
     C********************************************************************
     C           DAYCSR    BEGSR                           **DAYCSR BEGSR*
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-ADDWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C*
     C           DCAID     SUB  WCAID     INTC0
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0
     C                     ENDIF                                                            MD058206
      *                                                                   CRE001
      ** If CRE001 is switched ON, then output 'Overdraft Limit'          CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,38    ONARR                           CRE001
     C                     MOVE ODRL      OODRL                           CRE001
     C******************** EXSR OVERDR                             CRE001 EMP007
      *** PFJ028           WRITEODLNDC                                    CRE001
     C                     ENDIF                                          CRE001
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C*******************  EXSR OVERCR                                    094431
     C*******************  WRITESTOTCR                                    094431
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C                     ENDSR                           **DAYCSR ENDSR*
     C/EJECT
     C********************************************************************
     C** DAYDSR subroutine to prepare and output days total
     C**
     C**     Called by       CRSR, DRSR
     C**
     C**     Calls           ZICD
     C********************************************************************
     C           DAYDSR    BEGSR                           **DAYDSR BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'DAYDSR'  @STK,Q
     C*..............................................................
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-ADDWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C*
     C           DDAID     SUB  WDAID     INTD0
      *                                                                   CRE001
      ** If CRE001 is switched ON, then output 'Overdraft Limit'          CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,38    ONARR                           CRE001
     C                     MOVE ODRL      OODRL                           CRE001
     C*******              EXSR OVERDR                             CRE001 EMP007
      *** PFJ028           WRITEODLNDC                                    CRE001
     C                     ENDIF                                          CRE001
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C*******************  EXSR OVERDR                                    094431
     C*******************  WRITESTOTDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C**********           EXSR PRN1CH              chargesDetails1085713 125176
     C***********CCICI     IFNE *BLANK                                    085713
     C***********DTHGAR    IFNE *ZERO                                     085713
     C***********DTHGAN    ORNE *ZERO                                     085713
     C***********          Z-ADDDTHGAR    CHGR0                           085713
     C***********          Z-ADDDTHGAN    CHGN0                           085713
     C***********          Z-ADDNITMS     SNITMS                          085713
     C***********          WRITEPOSTCH                                    085713
     C***********          END                                            085713
     C***********          END                                            085713
     C*
      *-------------------------------------------------------
     C           EXDSR     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR                           **DAYDSR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C** B1EQ subroutine for begin when same date
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           DBSR
     C********************************************************************
     C           B1EQ      BEGSR                           **B1EQ   BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'B1EQ  '  @STK,Q
     C*..............................................................
     C           KLIST2    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*-------------------------------------
     C**  Back value processing
     C*-------------------------------------
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLECHISD                                     085250
      *
      * If last day accruals a backvalued item posted on cap. value       125176
      * date is already reflected in that capitalisation.                 125176
      * If first day accruals a backvalued item posted on cap. value      125176
      * date is not reflected in that capitalisation as the cap. value    125176
      * date is cap. date + 1.                                            125176
     C           HISD      IFLT CLDID                      - B2
     C           PSTD      ANDGTCLDID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLDID                                     085250
     C           PSTD      ANDGECLDID                                     085250
     C           LDAC      ANDEQ'N'                                       125176
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
      *
     C                     MOVE PSTDO     PSTDA
      *
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
      *
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
      *
     C                     MOVELPNAR      NARR
      *
     C           RECI      IFEQ 'P'                        - B3           125176
     C*
     C           DRCR      IFEQ 0                          - B4
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X4
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E4
      *
     C**  Output Posting for Debit and Credit
     C******************   EXSR OVERDR                     prtf-overflow
     C                     MOVE '1'       *IN54
     C                     MOVE '1'       *IN53
      *
     C* Charge Report if necessary
RS   C*                    EXSR PRN2CH                     chargesDetails
     C                     ELSE                            - X3           094337
     C           DRCR      IFEQ 1                          - B4           094337
     C                     Z-ADDHISD      DCRCD                           094337
     C                     EXSR RATEC                                     094337
     C                     ELSE                            - X4           094337
     C                     Z-ADDHISD      DDRCD                           094337
     C                     EXSR RATED                                     094337
     C                     END                             - E4           094337
     C                     END                             - E3           094337
      *
     C                     END                             - E2
      *
     C           KLIST1    READEREHPOPH                  50
      *
     C                     END                             - E1
      *------------------------------------------------------
      * If a management cap. check for generated adjustments              125176
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
      * Report adjustments before start date                              125176
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C           AHISD     ANDLTCLDID                                     64051
      *
     C*
     C** Print/extract Interest of the back value date
     C*
     C           SDCI      IFEQ 'Y'                        - B4
     C           SCCI      OREQ 'Y'
     C*
     C           PPSTD     IFNE RUND                       - B5
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E5
      *
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B5
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E5
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B5
     C           ADAIC     ANDNE*ZEROS                                    064051
     C                     Z-ADDADAIC     PSTD0                           064051
     C*****************    EXSR OVERDR                     prtf-overflow
     C                     END                             - E5
      *
     C           SCCI      IFEQ 'Y'                        - B5
     C           ACAIC     ANDNE*ZEROS                                    064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C*****************    EXSR OVERDR                     prtf-overflow
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
      *--------------------------------------
     C*   Prepare Opening Balance
      *--------------------------------------
     C           PVALD     IFNE CLDID                      - B1
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  Opening Balance Debit Output or Credit Output                   PFJ028
     C*
     C                     EXSR DCSET1                                    PFJ028
      *
      * Debit Balance
     C           *IN42     IFEQ '1'                        - B1           PFJ028
     C                     EXSR CLMSG
     C                     MOVELNAR,15    TNARR
     C                     Z-ADDDOHISB    HISB0                           PFJ028
     C                     Z-ADDDOHISB    WHISBD                    094337PFJ028
     C                     Z-ADD0         HISB4                           PFJ028
     C                     Z-ADD0         WHISBC                          PFJ028
     C                     ENDIF                           - E1           PFJ028
      *
      * Credit Balance                                                    PFJ028
     C           *IN43     IFEQ '1'                        - B1           PFJ028
     C                     EXSR CLMSG                                     PFJ028
     C                     MOVELNAR,16    TNARR                           PFJ028
     C                     Z-ADDCOHISB    HISB4                           PFJ028
     C                     Z-ADDCOHISB    WHISBC                          PFJ028
     C                     Z-ADD0         HISB0                           PFJ028
     C                     Z-ADD0         WHISBD                          PFJ028
     C                     ENDIF                           - E1
     C*
     C******************   EXSR OVERDR                    prtf-overflow
     C***********          WRITETITLEDC                                   PFJ028
     C                     EXSR TITLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
     C**  Opening Balance Credit Output
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C******************** MOVELNAR,3     RNARR                           040447
      *
     C**  Opening Rate Debit Output
     C*
     C**  Access REHRDJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains       040447
     C**  the good dates for Debit Rate Change to                         040447
     C*                                                                   040447
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST1    REDPEREHRDJ                   60               094337
      *
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLDID                                     094337
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST2    READEREHRDJ                   60               094337
     C                     END                             - E1           094337
     C           *IN60     IFEQ '1'                        - B1           040447
     C                     Z-ADD*ZEROS    DRIR                            040447
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           040447
     C*                                                                   040447
     C                     EXSR CLMSG                                     040447
     C                     MOVELNAR,3     RNARR                           040447
     C*                                                                   040447
     C                     MOVE *BLANKS   PSTDA                           040447
     C                     MOVE *BLANKS   VALDA                           040447
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *
     C**  Output Debit Rate Change to                                     040447
     C*                                                                   040447
     C*   Change narrat. 'RATE CHANGE TO' to 'OPENING RATE'               040447
     C                     MOVE 'Y'       OPN     1                       040447
     C                     EXSR RDRSR                                     040447
     C                     MOVE ' '       OPN     1                       040447
      *                                                                   CRE001
      ** If CRE001 is switched ON                                         CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                        - B1           CRE001
      *                                                                   CRE001
      **    Output Overdraft Limit                                        CRE001
     C                     EXSR CLMSG                                     CRE001
      *** Debut PFJ028
     C                     MOVELNAR,38    ONARR  30                       CRE001
     C                     MOVE ODRL      OODRL  110                      CRE001
      *
     C*******************  EXSR OVERDR                     prtf-overflow  CRE001
      *                                                                   CRE001
      **    Output Additional Overdraft Rate                              CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,37    ONARR                           CRE001
     C                     MOVE AODR      OAODR  117                      CRE001
     C*******************  EXSR OVERDR                     prtf-overflow  CRE001
     C                     ENDIF                           - E1           CRE001
      *
     C**  Opening Rate Credit Output
     C*
     C**  Access REHRCJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains       040447
     C**  the good dates for Credit Rate Change to                        040447
     C*                                                                   040447
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST1    REDPEREHRCJ                   60               094337
      *
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLCID                                     094337
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST3    READEREHRCJ                   60               094337
     C                     END                             - E1           094337
     C           *IN60     IFEQ '1'                        - B1           040447
     C                     Z-ADD*ZEROS    CRIR                            040447
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           040447
      *                                                                   040447
     C                     EXSR CLMSG                                     040447
     C                     MOVELNAR,8     RNARR                           040447
     C*                                                                   040447
     C                     MOVE *BLANKS   PSTDA                           040447
     C                     MOVE *BLANKS   VALDA                           040447
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *
     C**  Output Debit Rate change to                                     040447
     C*                                                                   040447
     C*   Change Narrat. 'RATE CHANGE to' TO 'OPENING RATE'               040447
     C                     MOVE 'Y'       OPN     1                       040447
     C                     EXSR RCRSR                                     040447
     C                     MOVE ' '       OPN     1                       040447
      *                                                                   125176
      * If a management cap. report any adjustments on start date.        125176
     C           *IN70     IFEQ '1'                        - B1           64051
     C           KLIST1    SETLLREHISSL                  20               64051
     C*                                                                   64051
     C           *IN20     IFEQ '1'                        - B2           64051
     C           KLIST1    READEREADJF                   20               64051
     C           *IN20     DOWEQ'0'                        - B3           64051
     C           AHISD     IFEQ CLDID                      - B4           64051
     C*                                                                   64051
     C** Print Interest of the back value date                            64051
     C*                                                                   64051
     C           SDCI      IFEQ 'Y'                        - B5           64051
     C           SCCI      OREQ 'Y'                                       64051
     C*                                                                   64051
     C           PPSTD     IFNE RUND                       - B6           64051
     C                     Z-ADDRUND      ZDAYNO                          64051
     C                     EXSR ZDATE2                                    64051
     C                     MOVE ZDATE     PSTDO                           64051
     C                     Z-ADDRUND      PPSTD                           64051
     C                     END                             - E6           64051
     C*                                                                   64051
     C                     MOVE PSTDO     PSTDA                           64051
     C*                                                                   64051
     C           PVALD     IFNE AHISD                      - B6           64051
     C                     Z-ADDAHISD     ZDAYNO                          64051
     C                     CALL 'ZDATA2'                                  64051
     C                     MOVE ZDATE     VALDO                           064051
     C                     Z-ADDAHISD     PVALD                           64051
     C                     END                             - E6           64051
     C*                                                                   64051
     C                     MOVE VALDO     VALDA                           64051
     C                     MOVE VALDO     VALDAY                          PFJ028
      *
     C                     MOVELNAR,23    NARR                            64051
      *
     C           SDCI      IFEQ 'Y'                        - B6           64051
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     Z-ADDADAIC     PSTD0                           64051
     C******************** EXSR OVERDR                                    64051
     C                     END                             - E6           64051
      *
     C           SCCI      IFEQ 'Y'                        - B6           64051
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     Z-SUBACAIC     PSTD0                           64051
     C******************** EXSR OVERDR                                    64051
     C                     END                             - E6           64051
      *
     C                     END                             - E5           64051
     C*                                                                   64051
     C                     END                             - E4           64051
     C           KLIST1    READEREADJF                   20               64051
     C*                                                                   64051
     C                     END                             - E3           64051
     C                     END                             - E2           64051
     C                     END                             - E1           64051
      *
     C           KLIST2    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
      *
      *-------------------------------------------------------
     C           EXB1EQ    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*******************************************************************
     C** B1LT subroutine for begin when debit lower than credit
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           DBSR,  OPENCR, OPENDR
     C*******************************************************************
     C           B1LT      BEGSR                           **B1LT   BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'B1LT  '  @STK,Q
     C*..............................................................
     C*
     C           KLIST2    SETLLREHPOPH
     C           KLIST1    READEREHPOPH                  50
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDGECLDID                                     040447
     C*--------------------------------------------------------------
      * Report backvalued postings/rate changes before DR start date      125176
     C*--------------------------------------------------------------
     C           HISD      IFLT CLDID                      - B2
     C           PSTD      ANDGTCLDID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLDID                                     094337
     C           PSTD      ANDGECLDID                                     094337
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C                     MOVELPNAR      NARR
     C*
     C           RECI      IFEQ 'P'                        - B3           125176
     C*
     C           DRCR      IFEQ 0                          - B4
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X4
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E4
     C*
      * Output posting/rate change to debit report                        125176
     C*
     C******************   EXSR OVERDR
     C*
     C                     ELSE                            - X3           094337
     C           DRCR      IFEQ 0                          - B4           094337
     C                     Z-ADDHISD      DDRCD                           094337
     C                     EXSR RATED                                     094337
     C                     END                             - E4           094337
     C                     END                             - E3           094337
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C                     END                             - E1
     C*---------------------------
     C** Opening Rate for Debit                                           125176
     C*---------------------------
     C           KLIST3    SETLLREHPOPH                                   094337
     C*                                                                   094337
     C           KLIST1    READEREHPOPH                  50               094337
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLECHISD                                     085250
     C*
      * Report backvalued postings/rate changes before CR start date      125176
     C*
     C           HISD      IFLT CLCID                      - B2
     C           PSTD      ANDGTCLCID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLCID                                     085250
     C           PSTD      ANDGECLCID                                     085250
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELPNAR      NARR
      *                                                                   125176
     C           RECI      IFEQ 'P'                        - B3           125176
     C*
     C           DRCR      IFEQ 0                          - B4
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X4
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E4
     C*
     C**  Output Posting for Credit
     C*
     C* Charge Report if necessary
RS   C*                    EXSR PRN2CH                     chargesDetails2085713
     C*
     C                     ELSE                            - X3           085250
     C           DRCR      IFEQ 1                          - B4           085250
     C                     Z-ADDHISD      DCRCD                           085250
     C                     EXSR RATEC                                     085250
     C                     END                             - E4           085250
     C                     END                             - E3           085250
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
      *
      * If a management cap. check for generated adjustments.             125176
     C           *IN70     IFEQ '1'                        - B1           125176
     C           KLIST1    SETLLREHISSL                  20               125176
      *                                                                   125176
      * Report adjustments before DR start date (on both reports).        125176
     C           *IN20     IFEQ '1'                        - B2           125176
     C           KLIST1    READEREADJF                   20               125176
     C           *IN20     DOWEQ'0'                        - B3           125176
     C           AHISD     ANDLTCLDID                                     125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                        - B4           125176
     C           SCCI      OREQ 'Y'                                       125176
      *                                                                   125176
     C           PPSTD     IFNE RUND                       - B5           125176
     C                     Z-ADDRUND      ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     PSTDO                           125176
     C                     Z-ADDRUND      PPSTD                           125176
     C                     END                             - E5           125176
     C                     MOVE PSTDO     PSTDA                           125176
      *                                                                   125176
     C           PVALD     IFNE AHISD                      - B5           125176
     C                     Z-ADDAHISD     ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     VALDO                           125176
     C                     Z-ADDAHISD     PVALD                           125176
     C                     END                             - E5           125176
     C                     MOVE VALDO     VALDA                           125176
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   125176
     C                     MOVELNAR,23    NARR                            125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                        - B5           125176
     C           ADAIC     ANDNE*ZEROS                                    125176
     C                     Z-ADDADAIC     PSTD0                           125176
     C******************   EXSR OVERDR                                    125176
     C                     END                             - E5           125176
      *
     C           SCCI      IFEQ 'Y'                        - B5           125176
     C           ACAIC     ANDNE*ZEROS                                    125176
     C                     Z-SUBACAIC     PSTD0                           125176
     C*********************EXSR OVERDR                                    125176
     C                     END                             - E5           125176
      *                                                                   125176
     C                     END                             - E4           125176
      *
     C           KLIST1    READEREADJF                   20               125176
     C                     END                             - E3           125176
      *                                                                   125176
     C                     ELSE                            - X2           125176
     C                     MOVE '1'       *IN20                           125176
      *                                                                   125176
     C                     END                             - E2           125176
     C                     END                             - E1           125176
      *----------------------------------------------                     125176
      * Opening balance and opening rate for debit                        125176
     C                     EXSR OPENDR                                    125176
     C*
      * If management cap. check for generated adjs. before CR start      125176
      * date. Report on CR side but only report on DR side if on DR       125176
      * start date (for DR side later adjs. are reported as found on      125176
      * REHISL so they are in date sequence).                             125176
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           *IN20     DOWEQ'0'                        - B2
     C           AHISD     ANDLTCLCID                                     125176
     C           AHISD     ANDLTCHISD
     C*
     C** Print interest of the back valued date
     C*
     C           SDCI      IFEQ 'Y'                        - B3
     C           SCCI      OREQ 'Y'
     C*
     C           PPSTD     IFNE RUND                       - B4
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E4
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B4
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E4
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B4
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     Z-ADDADAIC     PSTD0                           064051
      *
     C           AHISD     IFEQ CLDID                      - B5           125176
     C******************** EXSR OVERDR
     C                     END                             - E5           125176
     C                     END                             - E4
      *
     C           SCCI      IFEQ 'Y'                        - B4
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     Z-SUBACAIC     PSTD0                           064051
      *
     C           AHISD     IFEQ CLDID                      - B5           125176
     C******************** EXSR OVERDR
     C                     END                             - E5           125176
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C**  Opening Balance and opening rate for credit
     C*
     C                     EXSR OPENCR
     C*
      * Report any remaining adjustments on the CR report only (must      125176
      * be on CR start date).                                             125176
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           *IN20     ANDEQ'0'                                       125176
     C           AHISD     ANDLTCHISD
     C*
     C** Print Interest of the back value date
     C*
     C           SCCI      IFEQ 'Y'                        - B2           125176
     C*
     C           PPSTD     IFNE RUND                       - B3
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B3
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SCCI      IFEQ 'Y'                        - B3
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           KLIST2    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
      *-------------------------------------------------------
     C           EXB1LT    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C** OPENDR subroutine for debit output - opening balance and
     C**                                      opening rate
     C**     Called by       B1LT, B1GT
     C**     Calls           DBSR
     C********************************************************************
     C           OPENDR    BEGSR                           **OPENDR BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'OPENDR'  @STK,Q
     C*..............................................................
     C                     Z-ADDDOHISB    HISB0
     C                     Z-ADDDOHISB    WHISBD                          094337
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,15    TNARR
     C*
     C           PVALD     IFNE CLDID                      - B1
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  Output Opening Balance
     C*****************    EXSR OVERDR                                    prtf-overflow
      *** DEBUT PFJ028
     C****************     WRITETITLEDC                                   EMP007
     C                     EXSR TITLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN   PFJ028
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,3     RNARR
     C*
      *
      **  Access REHRDJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains       094337
      **  the good dates for debit rate change to...                      094337
      *                                                                   094337
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST1    REDPEREHRDJ                   60               094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLDID                      - B1           094337
     C           KLIST2    SETLLREHRDJ                                    094337
     C           KLIST2    READEREHRDJ                   60               094337
     C                     END                                            094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C                     Z-ADD*ZEROS    DRIR                            094337
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           094337
      *                                                                   094337
     C                     EXSR CLMSG                                     094337
     C                     MOVELNAR,3     RNARR                           094337
      *                                                                   094337
     C                     MOVE *BLANKS   PSTDA                           094337
     C                     MOVE *BLANKS   VALDA                           094337
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *                                                                   094337
      **  Output Credit Rate change to                                    094337
      *                                                                   094337
      *   Change Narrative 'RATE CHANGE TO' to 'OPENING RATE'             094337
     C                     MOVE 'Y'       OPN     1                       094337
     C                     EXSR RDRSR                                     094337
     C                     MOVE ' '       OPN     1                       094337
     C*
     C**  Output Opening rate
     C*
     C***********          EXSR OVERDR                                    094337
     C***********          WRITERATEDR                                    094337
     C*
      ** If CRE001 is switched ON, then output 'Overdraft Limit'          CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,38    ONARR                           CRE001
     C                     MOVE ODRL      OODRL                           CRE001
     C**************       EXSR OVERDR                                    CRE001
      *** PFJ028           WRITEODLNDC                                    CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
      *-------------------------------------------------------
     C           EXOPDR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C                     ENDSR                           **OPENDR ENDSR*
     C/EJECT
     C********************************************************************
     C** OPENCR subroutine for credit output - opening balance and
     C**                                       opening rate
     C**     Called by       B1LT, B1GT
     C**     Calls           DBSR
     C********************************************************************
     C           OPENCR    BEGSR                           **OPENCR BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'OPENCR'  @STK,Q
     C*..............................................................
     C                     Z-ADDCOHISB    HISB4
     C                     Z-ADDCOHISB    WHISBC                          094337
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,16    TNARR
     C*
     C           PVALD     IFNE CLCID                      - B1
     C                     Z-ADDCLCID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLCID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C**  Output Opening Balance
     C****************     EXSR OVERCR
      *** DEBUT PFJ028
     C*********************WRITETITLECR
     C*********************MOVEL'A10     'VALDAY
     C******************   WRITETITLEDC
     C                     EXSR TITLDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   VALDAY                          PFJ028
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,8     RNARR
     C*
      *                                                                   094337
      **  ACCESS REHRDJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS       094337
      **  THE GOOD DATES FOR DEBIT RATE CHANGE TO                         094337
      *                                                                   094337
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST1    REDPEREHRCJ                   60               094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C           BDATE     ANDEQCLCID                      - B1           094337
     C           KLIST3    SETLLREHRCJ                                    094337
     C           KLIST3    READEREHRCJ                   60               094337
     C                     END                                            094337
      *                                                                   094337
     C           *IN60     IFEQ '1'                        - B1           094337
     C                     Z-ADD*ZEROS    CRIR                            094337
     C                     Z-ADD*ZEROS    INTP                            125176
     C                     Z-ADD*ZEROS    INST                            125176
     C                     Z-ADD*ZEROS    INRT                            125176
     C                     END                             - E1           094337
      *                                                                   094337
     C                     EXSR CLMSG                                     094337
     C                     MOVELNAR,8     RNARR                           094337
      *                                                                   094337
     C                     MOVE *BLANKS   PSTDA                           094337
     C                     MOVE *BLANKS   VALDA                           094337
     C                     MOVE *BLANKS   VALDAY                          PFJ028
      *                                                                   094337
      **  OUTPUT CREDIT RATE CHANGE TO                                    094337
      *                                                                   094337
      *   CHANGE NARRAT. 'RATE CHANGE TO' TO 'OPENING RATE'               094337
     C                     MOVE 'Y'       OPN     1                       094337
     C                     EXSR RCRSR                                     094337
     C                     MOVE ' '       OPN     1                       094337
     C*
      *-------------------------------------------------------
     C           EXOPCR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C                     ENDSR                           **OPENCR ENDSR*
     C/EJECT
     C********************************************************************
     C** RATEC subroutine to prepare and output credit rate change
     C**
     C**     Called by       CRSR, RATESR
     C**     Calls           DBSR, RCRSR
     C******************************************************************
     C           RATEC     BEGSR                           **RATEC BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'RATEC '  @STK,Q
     C*..............................................................
     C**  Access REHRCJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains
     C**  the good dates for Credit Rate change to....
     C*
     C           KLIST6    SETLLREHRCJ                   60
     C           KLIST6    READEREHRCJ                   60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADDDCRCD     WDATE
     C                     Z-ADD22        DBASE
     C                     MOVE 'REHRCJ'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 22**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C**  Convert Value date into format DDMMMYY
     C           PVALD     IFNE RVALD                      - B1
     C                     Z-ADDRVALD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDRVALD     PVALD
     C                     END                             - E1
     C**  Convert Posting date into format DDMMMYY
     C           PPSTD     IFNE RPSTD                      - B1
     C                     Z-ADDRPSTD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRPSTD     PPSTD
     C                     END                             - E1
     C*
     C**  Prepare Debit Rate change to output
     C                     MOVE PSTDO     PSTDA
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,9     RNARR
     C*
     C**  Output/Extract Debit Rate Change data
     C*
     C                     EXSR RCRSR
      *-------------------------------------------------------
     C           EXRATC    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C** RATESR subroutine for debit and credit rate change
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           RATEC,RATED
     C********************************************************************
     C           RATESR    BEGSR                           **RATESR BEGSR*
     C*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'RATESR'  @STK,Q
     C*..............................................................
     C                     Z-ADDDHISD     WWHISD
     C*
     C           DDRCI     IFEQ 'Y'                        - B1
     C           CLDID     ANDLEDDRCD
     C           DRECI     ANDNE'B'
     C           DRECI     ANDNE'S'                                       094337
     C*
     C** write line if needed before new rate                             174403
RS   C*                    EXSR NEWLIN                                    174403
     C                     Z-ADDDHISD     WHISDC                          174403
     C*
     C**  Debit Rate change
     C                     EXSR RATED
     C*
     C                     MOVE '1'       *IN54
     C*
     C                     END                             - E1
     C*
     C           DCRCI     IFEQ 'Y'                        - B1
     C           CLCID     ANDLEDCRCD
     C           DRECI     ANDNE'B'
     C           DRECI     ANDNE'S'
     C*
     C*                                                                   174403
     C** write line if needed before new rate                             174403
RS   C*                    EXSR NEWLIN                                    174403
     C                     Z-ADDDHISD     WHISDD                          174403
     C*                                                                   174403
     C**  Credit Rate change
     C                     EXSR RATEC
     C*
     C                     MOVE '1'       *IN53
     C*
     C                     END                             - E1
     C*
     C**  Save REHISL  as previous
     C           *IN53     IFEQ '1'
     C                     Z-ADDDHISD     WHISDC
     C                     Z-ADDDMNBL     WMNBLC 150
     C                     Z-ADDDHISB     WHISBC 150
     C                     Z-ADDDCRCB     WCRCBC  10
     C                     Z-ADDDCAID     WCAIDD 150                      125176
     C*
     C           DRECI     IFEQ 'S'
     C           SCICI     IFNE *BLANKS                                   098818
     C                     Z-ADDSCRIP     WCAIDD                          094337
     C                     ELSE
     C                     Z-ADDSCAIC     WCAIDD                          094337
     C                     END
     C                     END
     C                     END
     C*
     C**  Save REHISL as previous
     C           *IN54     IFEQ '1'
     C                     Z-ADDDHISD     WHISDD
     C                     Z-ADDDMNBL     WMNBLD 150
     C                     Z-ADDDHISB     WHISBD 150
     C                     MOVE DDRCB     WDRCBD  10
     C                     Z-ADDDDAID     WDAIDD 150
     C*
     C           DRECI     IFEQ 'S'
     C           SDICI     IFNE *BLANKS                                  098818
     C                     Z-ADDSDRIP     WDAIDD 150
     C                     ELSE
     C                     Z-ADDSDAIC     WDAIDD
     C                     END
     C                     END
     C                     END
     C*
     C**  Save REHISL as previous
     C                     Z-ADDDMNBL     WMNBL
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDDAID     WDAID
     C                     Z-ADDDCAID     WCAID
     C*
     C           DRECI     IFEQ 'S'
     C           SDICI     IFNE *BLANKS                                  098818
     C                     Z-ADDSDRIP     WDAID
     C                     ELSE
     C                     Z-ADDSDAIC     WDAID
     C                     END
     C                     END
     C*
     C           DRECI     IFEQ 'S'
     C           SCICI     IFNE *BLANKS                                  098818
     C                     Z-ADDSCRIP     WCAID
     C                     ELSE
     C                     Z-ADDSCAIC     WCAID
     C                     END
     C                     END
     C*
     C                     MOVE *BLANKS   DDRCI
     C                     MOVE *BLANKS   DCRCI
     C*
     C           KLIST1    READEREHISL                   51
      *
      * Bypass interim capitalisation records                             125176
     C           *IN51     DOWEQ'0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
      *                                                                   125176
      * If management cap. check for generated adj. after start date.     125176
     C           *IN70     IFEQ '1'                                       125176
     C           *IN51     ANDEQ'0'                                       125176
     C           DRECI     ANDEQ'S'                                       125176
     C           DHISD     ANDLTCHISD                                     125176
     C           SDAIC     IFNE *ZEROS                                    125176
     C           SDICI     ANDNE*BLANK                                    125176
     C           SSDCI     ANDEQ'Y'                                       125176
     C                     Z-ADDSDAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
      *
     C           SCAIC     IFNE *ZEROS                                    125176
     C           SCICI     ANDNE*BLANK                                    125176
     C           SSCCI     ANDEQ'Y'                                       125176
     C                     Z-SUBSCAIC     @GADJ                           125176
     C                     MOVE 'Y'       @ADJF                           125176
     C                     END                                            125176
     C                     END                                            125176
      *                                                                   125176
     C           KLIST1    READEREHISL                   51
     C                     END
      *-------------------------------------------------------
     C           EXRTSR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **RATESR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C** RATED subroutine to prepare and output debit rate change
     C**
     C**     Called by       DRSR, RATESR
     C**     Calls           DBSR, RDRSR
     C******************************************************************
     C           RATED     BEGSR                           **RATED BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'RATED '  @STK,Q
     C*..............................................................
     C**  Access REHRDJ (REHPOSR1-REHPOSR2-REHPOSR3) which contains
     C**  the good dates for debit rate change to
     C*
     C           KLIST5    SETLLREHRDJ                   60
     C           KLIST5    READEREHRDJ                   60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADDDDRCD     WDATE
     C                     Z-ADD23        DBASE
     C                     MOVE 'REHRDJ'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 23**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C**  Convert value date from Midas fmt. to DDMMMYY
     C           PVALD     IFNE RVALD                      - B1
     C                     Z-ADDRVALD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDRVALD     PVALD
     C                     END                             - E1
     C**  Convert posting date from Midas fmt. to DDMMMYY
     C           PPSTD     IFNE RPSTD                      - B1
     C                     Z-ADDRPSTD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRPSTD     PPSTD
     C                     END                             - E1
     C*
     C**  Prepare Debit Rate Change to output
     C                     MOVE PSTDO     PSTDA
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,4     RNARR
     C*
     C**  Output Debit Rate Change to...
     C                     EXSR RDRSR
     C*
      ** If CRE001 is switched ON, Output Additional Overdraft Rate       CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,37    ONARR                           CRE001
     C                     MOVE AODR      OAODR                           CRE001
     C*******************  EXSR OVERDR                                    CRE001
     C*** PFJ028           WRITEAODRDC                                    CRE001
     C                     ENDIF                                          CRE001
     C*
      *-------------------------------------------------------
     C           EXRATD    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C                     ENDSR                           **RATED ENDSR**
     C********************************************************************
     C** RCRSR subroutine for credit rate output processing
     C**
     C**     Called by     RATEC
     C**
     C**     Calls         DBSR
     C********************************************************************
     C           RCRSR     BEGSR                           **RCRSR BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'RCRSR '  @STK,Q
     C*..............................................................
     C*
     C           INTP      IFEQ *ZEROS                     - B1           125176
     C*
     C                     Z-ADDINRT      RATE                            125176
     C*
     C**  Output Rate Change (equivalent to recfmt RATEDC)
RS   C******************   EXSR OVERCR
RS   C*******************  WRITERATEDC                                    EMP007
     C                     EXSR RATEDC                     edit fields    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
     C                     ELSE                            - X1
     C*
     C                     EXSR CLMSG
     C           OPN       IFEQ 'Y'                        - B2           040447
     C                     MOVELNAR,8     RNARR                           040447
     C                     ELSE                                           040447
     C                     MOVELNAR,12    RNARR
     C                     END                             - E2           040447
      *                                                                   086087
      * Print 'tiered' or 'threshold'                                     086087
     C                     MOVEA'00'      *IN,84                          086087
     C           INTP      IFEQ 01                         - B2           086087
     C           INTP      OREQ 03                                        086087
     C                     MOVE '1'       *IN84                           086087
     C                     ELSE                                           086087
     C                     MOVE '1'       *IN85                           086087
     C                     END                             - E2           086087
     C*
RS   C******************   EXSR OVERCR
RS   C****************     WRITERAT1DC                                    EMP007
     C                     EXSR RAT1DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
     C           INTH      IFGT *ZEROS                     - B2
     C                     Z-SUBINTH      HISB0                           040447
     C                     ELSE                            - X2
     C                     Z-ADDINTH      HISB0                           040447
     C                     END                             - E2           094337
     C*
     C                     EXSR CLMSG                                                       MD059851
     C                     EXSR RATIDC                                                      MD059851
     C                     EXSR DETAIL                                                      MD059851
     C                     MOVEL'Y'       SRIBAL                                            MD059851
     C*                                                                                     MD059851
     C                     EXSR CLMSG
     C                     MOVELNAR,14    BNARR
     C*
RS   C**************       EXSR OVERCR
RS   C**************       WRITERAT2DC                                    EMP007
     C                     EXSR RAT2DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *
      * Output first tier/threshold                                       086087
     C                     Z-ADDRTA,1     ORAT1                           086087
     C                     Z-ADDBLA,1     OBAL01                          086087
     C*
     C           WZERAT    IFEQ 'Y'                                                         MD059851
     C           INTH      ANDGTOBAL01                                                      MD059851
     C                     Z-ADD*ZEROS    ORAT1                                             MD059851
     C                     ENDIF                                                            MD059851
     C*                                                                                     MD059851
RS   C***************      EXSR OVERCR
RS   C***************      WRITERAT3DC                                    EMP007
     C                     EXSR RAT3DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *
      * Output rest of rates & balances until zero/blanks found           086087
     C                     Z-ADD1         @R      20                      086087
     C           @R        DOUEQ12                                        086087
     C                     ADD  1         @R                              086087
     C                     MOVE *BLANKS   ORATC                           086087
     C                     MOVE *BLANKS   OBALC                           086087
     C                     Z-ADDRTA,@R    ORAT1                           086087
     C                     Z-ADDBLA,@R    OBAL01                          086087
     C           ORAT1     IFNE *ZEROS                                    086087
     C           ORATC     ANDNE*BLANKS                                   086087
     C           OBAL01    ORNE *ZEROS                                    086087
     C           OBALC     ANDNE*BLANKS                                   086087
RS   C*****************    EXSR OVERCR                                    086087
RS   C*****************    WRITERAT3DC                                    086087
     C                     EXSR RAT3DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     ELSE                                           086087
     C                     Z-ADD12        @R                              086087
     C                     END                                            086087
     C                     END                                            086087
     C*
     C                     END                             - E1
      *-------------------------------------------------------
     C           EXCRS     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **RCRSR ENDSR**
     C/EJECT
     C********************************************************************
     C** RDRSR subroutine for debit rate output processing
     C**
     C**     Called by     RATED
     C**     Calls         DBSR
     C********************************************************************
     C           RDRSR     BEGSR                           **RDRSR BEGSR**
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'RDRSR '  @STK,Q
     C*..............................................................
     C           INTP      IFEQ *ZEROS                     - B1           125176
     C                     Z-ADDINRT      RATE                            125176
     C*
     C**  Output Rate Change
     C*
     C******************   EXSR OVERDR
      *** DEBUT PFJ028
     C*************        WRITERATEDC
      *** FIN   PFJ028
     C                     EXSR RATEDC                     format fields  EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
     C                     ELSE                            - X1
     C*
     C                     EXSR CLMSG
     C           OPN       IFEQ 'Y'                                       040447
     C                     MOVELNAR,3     RNARR                           040447
     C                     ELSE                                           040447
     C                     MOVELNAR,11    RNARR
     C                     END                                            040447
      *                                                                   086087
      * Print 'tiered' or 'threshold'                                     086087
     C                     MOVEA'00'      *IN,84                          086087
     C           INTP      IFEQ 01                                        086087
     C           INTP      OREQ 03                                        086087
     C                     MOVE '1'       *IN84                           086087
     C                     ELSE                                           086087
     C                     MOVE '1'       *IN85                           086087
     C                     END                                            086087
     C*
     C******************** EXSR OVERDR
      *** DEBUT PFJ028
     C*******************  WRITERAT1DC
      *** FIN  PFJ028
     C*
     C                     EXSR RAT1DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,14    BNARR                           125176
     C*
     C                     Z-ADDINTH      HISB0                           040447
     C*
     C*
     C******************** EXSR OVERDR
      *** DEBUT PFJ028
     C                     EXSR RAT2DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C******************** WRITERAT2DC
      *** FIN  PFJ028
      *                                                                   086087
      * Output first tier/threshold                                       086087
     C                     Z-ADDRTA,1     ORAT1                           086087
     C                     Z-ADDBLA,1     OBAL01                          086087
     C*
     C*******************  EXSR OVERDR
      *** DEBUT PFJ028
     C*******************  WRITERAT3DC
     C                     EXSR RAT3DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C*
      *                                                                   086087
      * Output rest of rates & balances until zero/blanks found           086087
     C                     Z-ADD1         @R                              125176
     C           @R        DOUEQ12                                        086087
     C                     ADD  1         @R                              086087
     C                     MOVE *BLANKS   ORATC                           086087
     C                     MOVE *BLANKS   OBALC                           086087
     C                     Z-ADDRTA,@R    ORAT1                           086087
     C                     Z-ADDBLA,@R    OBAL01                          086087
     C           ORAT1     IFNE *ZEROS                                    086087
     C           ORATC     ANDNE*BLANKS                                   086087
     C           OBAL01    ORNE *ZEROS                                    086087
     C           OBALC     ANDNE*BLANKS                                   086087
     C*****************    EXSR OVERDR                                    086087
      *** DEBUT PFJ028
     C*******************  WRITERAT3DC                                    086087
     C                     EXSR RAT3DC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
      *** FIN  PFJ028
     C                     ELSE                                           086087
     C                     Z-ADD12        @R                              086087
     C                     END                                            086087
     C                     END                                            086087
     C*
     C                     END                             - E1
      *-------------------------------------------------------
     C           EXDRS     TAG
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **RDRSR ENDSR**
     C/EJECT
      *****************************************************************
     C** B1GT subroutine for begin when debit greater than credit
     C**
     C**     Called by       B O T H S R
     C**     Calls           DBSR, OPENCR, OPENDR
      *****************************************************************
     C           B1GT      BEGSR                           **B1GT   BEGSR*
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'B1GT  '  @STK,Q
     C*..............................................................
     C           KLIST3    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDGECLCID                                     040447
     C*
      * Report backvalued postings/rate changes before CR start date      125176
     C           HISD      IFLT CLCID                      - B2
     C           PSTD      ANDGTCLCID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLCID                                     094337
     C           PSTD      ANDGECLCID                                     094337
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELPNAR      NARR
      *                                                                   125176
     C           RECI      IFEQ 'P'                        - B3           125176
     C*
     C           DRCR      IFEQ 0                          - B4
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X4
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E4
     C*
     C**  Output posting for credit
     C*
     C******************   EXSR OVERCR
      *** DEBUT PFJ028
     C*********************WRITEPOSTCR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C*
     C* Charge Report if necessary
RS   C*                    EXSR PRN2CH                     chargesDetails2085713
     C                     ELSE                            - X3           094337
     C           DRCR      IFEQ 1                          - B4           094337
     C                     Z-ADDHISD      DCRCD                           094337
     C******************   EXSR OVERCR                                    094337
     C                     EXSR RATEC                                     094337
     C                     END                             - E4           094337
     C                     END                             - E3           094337
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C*------------------------------------------------------
     C****OPENING*BALANCE*AND OPENING RATE FOR CREDIT                     125176
     C           KLIST2    SETLLREHPOPH
     C           KLIST1    READEREHPOPH                  50
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLECHISD                                     085250
     C*
      * Report backvalued postings/rate changes before DR start date      125176
     C*
     C           HISD      IFLT CLDID                      - B2
     C           PSTD      ANDGTCLDID
     C           LDAC      ANDEQ'Y'                                       125176
     C           HISD      ORLT CLDID                                     085250
     C           PSTD      ANDGECLDID                                     085250
     C           LDAC      ANDEQ'N'                                       125176
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELPNAR      NARR
      *                                                                   125176
     C           RECI      IFEQ 'P'                        - B3           125176
     C*
     C           DRCR      IFEQ 0                          - B4
     C                     Z-ADDPSTA      PSTD0
     C                     ELSE                            - X4
     C                     Z-SUBPSTA      PSTD0
     C                     END                             - E4
     C*
      * Output to debit report                                            125176
     C*
     C******************   EXSR OVERDR
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
    *** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C                     ELSE                            - X3           094337
     C           DRCR      IFEQ 0                          - B4           094337
     C                     Z-ADDHISD      DDRCD                           094337
     C                     EXSR RATED                                     094337
     C                     END                             - E4           094337
     C                     END                             - E3           094337
     C*
     C                     END                             - E1
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
      *                                                                   125176
      * If a management cap. check for generated adjustments.             125176
     C           *IN70     IFEQ '1'                        - B1           125176
     C           KLIST1    SETLLREHISSL                  20               125176
      *                                                                   125176
      * Report adjustments before CR start date (on both reports).        125176
     C           *IN20     IFEQ '1'                        - B2           125176
     C           KLIST1    READEREADJF                   20               125176
     C           *IN20     DOWEQ'0'                        - B3           125176
     C           AHISD     ANDLTCLCID                                     125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                                       125176
     C           SCCI      OREQ 'Y'                                       125176
      *                                                                   125176
     C           PPSTD     IFNE RUND                                      125176
     C                     Z-ADDRUND      ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     PSTDO                           125176
     C                     Z-ADDRUND      PPSTD                           125176
     C                     END                                            125176
     C                     MOVE PSTDO     PSTDA                           125176
      *                                                                   125176
     C           PVALD     IFNE AHISD                                     125176
     C                     Z-ADDAHISD     ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     VALDO                           125176
     C                     Z-ADDAHISD     PVALD                           125176
     C                     END                                            125176
     C                     MOVE VALDO     VALDA                           125176
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   125176
     C                     MOVELNAR,23    NARR                            125176
      *                                                                   125176
     C           SDCI      IFEQ 'Y'                                       125176
     C           ADAIC     ANDNE*ZEROS                                    125176
     C                     Z-ADDADAIC     PSTD0                           125176
     C******************** EXSR OVERDR                                    125176
      *** Debut PFJ028
     C*********************WRITEPOSTDR                                    125176
    *** pas de detail      WRITEPOSTDC                                    125176
      *** Fin  PFJ028
     C******************** EXSR OVERCR                                    125176
      *** Debut PFJ028
     C*********************WRITEPOSTCR                                    125176
    *** pas de detail      WRITEPOSTDC                                    125176
      *** fin  PFJ028
     C                     END                                            125176
      *                                                                   125176
     C           SCCI      IFEQ 'Y'                                       125176
     C           ACAIC     ANDNE*ZEROS                                    125176
     C                     Z-SUBACAIC     PSTD0                           125176
     C*****************    EXSR OVERDR                                    125176
      *** Debut PFJ028
     C*********************WRITEPOSTDR                                    125176
    *** pas de detail      WRITEPOSTDC                                    125176
      *** fin  PFJ028
     C*******************  EXSR OVERCR                                    125176
      *** Debut PFJ028
     C*********************WRITEPOSTCR                                    125176
    *** pas de detail      WRITEPOSTDC                                    125176
      *** fin  PFJ028
     C                     END                                            125176
      *                                                                   125176
     C                     END                                            125176
      *                                                                   125176
     C           KLIST1    READEREADJF                   20               125176
     C                     END                             - E3           125176
      *                                                                   125176
     C                     ELSE                                           125176
     C                     MOVE '1'       *IN20                           125176
      *                                                                   125176
     C                     END                             - E2           125176
     C                     END                             - E1           125176
      *                                                                   125176
      * Opening balance and opening rate for credit                       125176
     C                     EXSR OPENCR                                    125176
      *                                                                   125176
      * If management cap. check for generated adjs. before DR start      125176
      * date. Report on DR side but only report on CR side if on CR       125176
      * start date (for CR side later adjs. are reported as found on      125176
      * REHISL so they are in date sequence).                             125176
     C           *IN70     IFEQ '1'                        - B1
     C           *IN20     DOWEQ'0'                        - B3
     C           AHISD     ANDLTCLDID
     C           AHISD     ANDLTCHISD
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C           SDCI      IFEQ 'Y'
     C           SCCI      OREQ 'Y'
     C*
     C           PPSTD     IFNE RUND                       - B1
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E1
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B1
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C           SDCI      IFEQ 'Y'
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     Z-ADDADAIC     PSTD0                           064051
     C******************   EXSR OVERDR
      *** Debut PFJ028
     C*********************WRITEPOSTDR
     ** pas de detail      WRITEPOSTDC
      *** fin  PFJ028
     C           AHISD     IFEQ CLCID                                     125176
     C*****************    EXSR OVERCR
      *** Debut PFJ028
     C*********************WRITEPOSTCR
     ** pas de detail      WRITEPOSTDC
      *** fin  PFJ028
     C                     END                                            125176
     C                     END
      *
     C           SCCI      IFEQ 'Y'
     C           ACAIC     ANDNE*ZEROS                                   064051
     C                     Z-SUBACAIC     PSTD0                           064051
     C***************      EXSR OVERDR
      *** Debut PFJ028
     C*********************WRITEPOSTDR
     ** pas de detail      WRITEPOSTDC
      *** fin  PFJ028
     C           AHISD     IFEQ CLCID                                     125176
     C******************** EXSR OVERCR
      *** Debut PFJ028
     C*********************WRITEPOSTCR
     ** pas de detail      WRITEPOSTDC
      *** fin  PFJ028
     C                     END                                            125176
     C                     END
     C*
     C                     END
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E1
     C*
     C**  Opening balance and opening rate for debit
     C                     EXSR OPENDR
     C*
      * Report any remaining adjustments on the DR report only (must      125176
      * be on DR start date).                                             125176
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           *IN20     ANDEQ'0'                                       125176
     C           AHISD     ANDLTCHISD
     C*
     C** Print Interest of the back value date
     C           SDCI      IFEQ 'Y'                        - B3
     C*
     C           PPSTD     IFNE RUND                       - B4
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRUND      PPSTD
     C                     END                             - E4
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE AHISD                      - B4
     C                     Z-ADDAHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDAHISD     PVALD
     C                     END                             - E4
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE VALDO     VALDAY                          PFJ028
     C*
     C                     MOVELNAR,23    NARR
     C*
     C           SDCI      IFEQ 'Y'                        - B4
     C           ADAIC     ANDNE*ZEROS                                   064051
     C                     Z-ADDADAIC     PSTD0                           064051
     C*******************  EXSR OVERDR
      *** DEBUT PFJ028
     C*********************WRITEPOSTDR
     ** PAS DE DETAIL      WRITEPOSTDC
      *** FIN  PFJ028
     C**********           EXSR OVERCR
     C**********           WRITEPOSTCR
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           KLIST3    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
      *-------------------------------------------------------
     C           EX1GT     TAG
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **B1GT   ENDSR*
     C/EJECT
      ********************************************************************094431
      ** WST   subroutine - Writes 'Sub Total' print record               094431
      **       First deduct the accumulated Manual adjustment interest    094431
      **       since the last 'Sub Total' line                            094431
      **       Initialise Manual adjustment accumulator.                  094431
      ********************************************************************094431
     C           WST       BEGSR                                          094431
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'WST '    @STK,Q
      *..................................................................
      *
     C                     MOVEA'00'      *IN,42                          PFJ028
      *                                                                   094431
     C                     SELEC                                          094431
     C           DCFLAG    WHEQ 'DR'                                      094431
     C                     MOVEA'10'      *IN,42                          PFJ028
     C********** INTD0     SUB  MADR#     INTD0                    094431 125176
     C**************       EXSR OVERDR                                    094431
      *** DEBUT PFJ028
     C*********************WRITESTOTDR                                    094431
     C*********************WRITESTOTDC*******************                 PFJ028
      *** FIN   PFJ028
     C**********           Z-ADD*ZERO     MADR#                    094431 125176
      *                                                                   094431
     C           DCFLAG    WHEQ 'CR'                                      094431
     C                     MOVEA'01'      *IN,42                          PFJ028
     C******************** EXSR OVERCR                                    094431
      *** DEBUT PFJ028
     C*********************WRITESTOTCR                                    094431
     C*********************WRITESTOTDC***************                     PFJ028
      *** FIN   PFJ028
     C**********           Z-ADD*ZERO     MACR#                    094431 125176
     C                     ENDSL                                          094431
      *
     C***42                                                               PFJ028
     C*OR43*************** WRITESTOTDC                            PFJ028  EMP007
     C           *IN42     IFEQ '1'                                       EMP007
     C           *IN43     OREQ '1'                                       EMP007
     C                     EXSR STOTDC                                    EMP007
     C                     EXSR DETAIL                                    EMP007
     C                     END                                            EMP007
      *
      *................................................................
     C           EXWST     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      /EJECT
     C********************************************************************
     C** CALBRT subroutine to calculate base rates tax
     C**
     C**     Called by       BOTHSR, CRSR
     C**
     C**     Calls           none
     C********************************************************************
     C           CALBRT    BEGSR                           **CALBRT BEGSR**
     C*
     C** If BRT SAR installed
     C           S01383    IFEQ 'Y'                        B001
     C                     MOVE '0'       *IN22                           086087
     C*
     C** Access ACCNT to check if BRT liable
     C*
     C           KACCNT    CHAINACCNT                99
     C*
     C** Chain failure
     C           *IN99     IFEQ '1'
     C                     MOVEL'ACCNT'   DBFILE           ***************
     C                     MOVELRKEY      DBKEY            **DB ERROR 26**
     C                     Z-ADD26        DBASE            ***************
     C                     EXSR DBSR
     C                     END
     C                     END                             E001
     C*
     C** If BRT liable
     C*
     C           BRTCA     IFEQ 'L'                        B001
     C           BRTCA     OREQ 'P'
     C*
     C**    and credit interest to be paid
     C*
     C**    Credit interest is now reverse sign.                          094337
     C           TINTC0    IFLT 0                          B002           094337
     C*
     C** Process record with BRT applied
     C*
     C                     SETON                     22
     C*
     C** Apply new or old rate?
     C*                                                                   104618
     C* If date is before 'DEFF' on SDBRTDPD - use prev.BRT rate          104618
     C* otherwise - use current BRT rate.                                 104618
     C*                                                                   104618
     C           CCICI     IFEQ 'D'                                       104618
     C           CCICI     OREQ 'M'                                       104618
     C                     MOVE '1'       *IN30                           104618
     C                     ELSE                                           104618
     C                     MOVE '0'       *IN30                           104618
     C                     END                                            104618
     C*                                                                   104618
     C           LDAC      IFEQ 'Y'                                       104618
     C*                                                                   104618
     C           *IN30     IFEQ '1'                                       104618
     C           RUND      IFLE DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1    75                      104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           CCICI     IFEQ 'C'                                       104618
     C           RUND      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           *IN30     IFEQ '0'                                       104618
     C           CCICI     ANDNE'C'                                       104618
     C           NCID      IFLE DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C                     ELSE                                           104618
     C*                                                                   104618
     C           *IN30     IFEQ '1'                                       104618
     C           CCICI     OREQ 'C'                                       104618
     C           RUND      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           *IN30     IFEQ '0'                                       104618
     C           CCICI     ANDNE'C'                                       104618
     C           NCID      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C                     END                                            104618
     C*
     C           BRTCA     IFEQ 'L'
     C                     Z-ADDBRT1      WKBRT   75
     C                     ELSE
     C           BRT1      MULT 0.5       WKBRT
     C                     END
     C*
     C           TINTC0    MULT WKBRT     BRTOT0
     C           BRTOT0    DIV  100       BRTOT0    H
      *                                                                   099505
      * If CR interest is negative, BRT amount must be positive.          099505
     C                     Z-SUBBRTOT0    BRTOT0                          099505
     C                     Z-ADDTINTC0    TGINT0
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C           TINTC0    COMP 0                    4849                 094337
     C*
     C                     ENDSR
      *****************************************************************
     C           SRDDTE    BEGSR
     C* date formatting routine
      *****************************************************************
      *
     C                     MOVELZADATE    ZWRK5   5
     C                     MOVE ZWRK5     ZMTHA   3
     C                     Z-ADD1         C       20
     C           ZMTHA     LOKUPZMNM,C                   99*
      *
     C                     MOVELZADATE    ZDAY
     C                     Z-ADDC         ZMTH
     C                     MOVE ZADATE    ZYEAR
      *
     C                     MOVELZDAY      ZWRK4
     C                     MOVE ZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     MOVE '0'       *IN98
     C                     EXSR ZDATE1
      *
     C                     ENDSR
      *****************************************************************
     C           RATEDC    BEGSR
     C* date formatting routine for former line RATEDC
     C********************************************************************
     C******               MOVELVALDA     ZADATE
     C******               EXSR SRDDTE
     C******               MOVELZDAYNO    ##VDAT           value date
     C                     MOVELRNARR     ##NARR           narrative
     C                     Z-ADDRATE      ##RATE           rate
     C                     MOVEL'Y'       SRRATE
      *
     C                     MOVE VALDAY    ZDATE             7 A --> 6,0
     C                     EXSR ZDATE1                      ZDATE1
     C                     MOVE ZDAYNO    ##VDAT            6,0
      *
     C                     ENDSR
      *****************************************************************
     C           RAT1DC    BEGSR
     C* date formatting routine for former line RAT1DC
     C********************************************************************
     C                     MOVE PSTDA     ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    ##POST           posting date
      *
     C                     MOVE VALDAY    ZDATE
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    ##VDAT           value date
      *
     C                     MOVELRNARR     ##NARR
     C   84                MOVEL#TEXT4    ##NAR3           tiered
     C   85                MOVEL#TEXT5    ##NAR3           threshold
      *
     C                     ENDSR
      *****************************************************************                     MD059851
     C           RATIDC    BEGSR                                                            MD059851
     C*  formatting routine for former line Initial Threshold                               MD059851
     C*****************************************************************                     MD059851
      *                                                                                     MD059851
     C                     MOVEL#TEXT6    ##NARR                                            MD059851
     C                     MOVEL'Y'       SRIBAL                                            MD059851
      *                                                                                     MD059851
     C                     ENDSR                                                            MD059851
      *****************************************************************
     C           RAT2DC    BEGSR
     C*  formatting routine for former line RAT2DC
     C********************************************************************
      *
     C                     MOVELBNARR     ##NARR
     C                     Z-ADDHISB0     ##BALC
      *
     C                     ENDSR
      *****************************************************************
     C           RAT3DC    BEGSR
     C*  formatting routine for former line RAT3DC
     C********************************************************************
     C                     Z-ADDORAT1     ##RATE
     C                     MOVEL'Y'       SRRATE                          CCG015
     C****                 Z-ADDOBAL01    ##OBAL                          currently not used
     C                     Z-ADDOBAL01    ##OBAL                                            MD059851
     C                     MOVEL'Y'       SRCORR                                            MD059851
     C                     ENDSR
      *****************************************************************
     C           STOTDC    BEGSR
     C*  formatting routine for former subtotal line STOTDC
     C********************************************************************
     C                     MOVE VALDAY    ZDATE            7A--> 6,0
     C                     EXSR ZDATE1
     C                     MOVE ZDAYNO    ##VDAT
     C*
     C                     Z-ADDDAYS      ##NOFD
     C*
     C           *IN42     IFEQ '1'
     C                     Z-ADDNUMB0     ##NUMC
     C                     Z-ADDHISB0     ##BALD
     C                     Z-ADDINTD0     ##DINT           Debit
     C                     ENDIF
     C*
     C           *IN43     IFEQ '1'
     C                     Z-ADDNUMB4     ##NUMC
     C                     Z-ADDHISB4     ##BALC
     C                     Z-ADDINTC0     ##CINT           Credit
     C                     ENDIF
     C*
     C                     ENDSR
     ******************************************************************
     C           TOTIAD    BEGSR
     C*  formatting routine for former Manual adjustment line TOTIAD
     C*****************************************************************
     C                     MOVELDNARR     ##NARR
     C                     Z-ADDTINTD0    ##DINT
     C                     Z-ADDTINTC0    ##CINT
      *
     C                     ENDSR
     ******************************************************************
     C           TOTCOM    BEGSR
     C*  formatting routine for former Total Commissions line TOTCOM
     C*****************************************************************
     C                     MOVELDNARR     ##NARR
     C                     Z-ADDTINTD0    ##DINT
     C                     ENDSR
      *****************************************************************
     C           TOTLDC    BEGSR
     C*  formatting routine for former total line TOTALDC
     C********************************************************************
     C                     Z-ADDDAYS      ##NOFD
     C                     MOVELXNARR     ##NARR
     C*
     C                     Z-ADDTINTD0    ##DINT
     C                     Z-ADDTINTC0    ##CINT
     C*
     C           *IN42     IFEQ '1'                        Debit
     C                     Z-ADDHISB0     ##BALD
     C                     ENDIF
     C*
     C           *IN43     IFEQ '1'
     C                     Z-ADDHISB4     ##BALC           Credit
     C                     ENDIF
     C*
     C                     ENDSR
     ******************************************************************
     C           TOTDDC    BEGSR
     C*  formatting routine for former Total Charges line TOTDDC
     C*****************************************************************
     C                     MOVELDNARR     ##NARR
     C   42                Z-ADDTINTD0    ##DINT           debit
     C   43                Z-ADDTINTC0    ##CINT           credit
     C*
     C                     ENDSR
     ******************************************************************
     C           ALTNDC    BEGSR
     C*  formatting routine for former Alternative account line ALTNDC
     C*****************************************************************
     C                     MOVELNARR      ##NARR
     C                     MOVELMIDK      ##ALTA
     C*
     C                     ENDSR
     C********************************************************************
     C**
     C** DETPR subroutine for detail processing
     C**
     C**     Called by       M A I N
     C**
     C**     Calls         BOTHSR, DRSR, CRSR, DBSR
     C********************************************************************
     C           DETPR     BEGSR                           **DETPR BEGSR**
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'DETPR '  @STK,Q
     C*..............................................................
      **  Clear path
     C           1         OCUR ##SRDT
     C                     CLEAR##SRDT
     C                     MOVEL*BLANKS   S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\REL070' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                    CCG015
      *
      **  Store Path
     C           1         OCUR ##SRDT
     C                     MOVELS#PATH    ##SPAT
     C*
     C*..............................................................
     C**  Access ACCRACJ (ACCNTAB, REIACD, REACRD)
     C*
     C           KLIST1    CHAINACCRACJ              99
     C           *IN99     IFEQ '1'
     C                     Z-ADD11        DBASE            ***************
     C                     MOVE 'ACCRACJ' DBFILE           **DB ERROR 11**
     C                     MOVELRKEY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END
      *
     C**  Set indicator for address print.
     C*
     C                     MOVE '0'       *IN23
     C                     TESTB'2'       GLBT           23
     C*
     C**  Initialize workfields for taxes
     C*
     C                     Z-ADD*ZEROS    WWCINW 150
     C                     MOVEL*BLANK    #JITAX  1
      *
     C**  Retrieve & format IBAN number, if CFT004 is on
      *
     C                     MOVEL*BLANKS   RIBAN  47                       CFT004
     C                     MOVE '0'       *IN04                           CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C                     MOVELCCNUM     WCNUM   6                       CFT004
     C                     MOVELCACOD     WACOD  10                       CFT004
     C                     MOVELCACSQ     WACSQ   2                       CFT004
     C                     CALL 'AOACCTR0'                                CFT004
     C                     PARM *BLANKS   PRTCD                           CFT004
     C                     PARM '*KEY   ' POPTN                           CFT004
     C                     PARM *BLANK    PRETL  10                       CFT004
     C                     PARM WCNUM     PCNUM   6                       CFT004
     C                     PARM CCCY      PCUCD   3                       CFT004
     C                     PARM WACOD     PACCD  10                       CFT004
     C                     PARM WACSQ     PACSQ   2                       CFT004
     C                     PARM CBRCA     PBRCA   3                       CFT004
     C           ACCNTB    PARM ACCNTB    DSSDY                           CFT004
      *
     C           PRTCD     IFNE *BLANKS                                   CFT004
     C                     Z-ADD28        DBASE            ************   CFT004
     C                     MOVEL'ACCNTAB' DBFILE           * DBERR 28 *   CFT004
     C                     MOVELRKEY      DBKEY            ************   CFT004
     C                     MOVE '1'       *IN89                           CFT004
     C                     EXSR DBSR                                      CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      ** Format International Bank Account Numbers                        CFT004
     C           IBAN      IFNE *BLANKS                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM IBAN      PIBAN  47                       CFT004
     C                     PARM *BLANKS   PIWITH 47                       CFT004
     C                     PARM *BLANKS   PINOBL 34                       CFT004
      *                                                                   CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVELPIWITH    RIBAN                           CFT004
     C                     MOVE '1'       *IN04                           CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C**  Retail Withholding tax installed ...
     C*
     C           BGNTST    IFEQ 'Y'                        - B1
      *
     C           CCICI     IFEQ 'Y'                        - B2
     C           CCICI     OREQ 'C'
     C           CCICI     OREQ 'D'
      *
     C           KLIST1    CHAINRETAXJL              99
     C           *IN99     IFEQ '1'                        - B3
     C                     Z-ADD12        DBASE            ***************
     C                     MOVEL'RETAXJL' DBFILE           **DB ERROR 12**
     C                     MOVELRKEY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     ELSE                            - X3
     C           #JITAX    IFEQ 'Y'                        - B4
     C                     Z-ADD#JCINW    WWCINW
     C                     END                             - E4
     C*
     C/COPY WNCPYSRC,RE3761CCP2
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
      *
     C**  Access CLINT for client information (Address, Name etc.)
     C*
     C                     MOVE 'B'       RCDT
     C           KLIST4    CHAINCLINT                99
     C           *IN99     IFEQ '1'                        - B1
     C                     MOVELCCNUM     DBKEY
     C                     Z-ADD13        DBASE            ***************
     C                     MOVE 'CLINT'   DBFILE           **DB ERROR 13**
     C                     MOVELRCDT      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
      *
     C** Check for valid currency
     C*
     C******************** Z-ADD1         I                EMP108
     C                     Z-ADD1         I       30       EMP108
     C           CCCY      LOKUPCCYA,I                   97
     C*
     C           *IN97     IFEQ *ZERO                      - B1
     C                     Z-ADD14        DBASE            ***************
     C                     MOVE 'SDCURRPD'DBFILE           **DB ERROR 14**
     C                     MOVELCCCY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
      *                                                                   PFJ028
     C                     MOVE ACNO      WACNO
      *                                                                   PFJ028
     C** Save Currency name                                               PFJ028
     C                     MOVELCCYN,I    CCNM   14                       PFJ028
     C*
     C** Check no. of decimals for currency
     C*
     C                     MOVEA'0000'    *IN,80
     C           DPA,I     IFEQ 0                          - B1
     C                     MOVE '1'       *IN80
     C                     ELSE                            - X1
     C           DPA,I     IFEQ 1                          - B2
     C                     MOVE '1'       *IN81
     C                     ELSE                            - X2
     C           DPA,I     IFEQ 2                          - B3
     C                     MOVE '1'       *IN82
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN83
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
      *
     C                     MOVEA'00'      *IN,01
     C                     MOVEA'00'      *IN,42                          PFJ028
      *
     C**  Define Capitalisation to be processed
     C*
     C           CDICI     IFNE *BLANKS                    Debit
     C                     MOVE '1'       *IN01
     C                     END
     C*
     C           CCICI     IFNE *BLANKS                    Credit
     C                     MOVE '1'       *IN02
     C                     END
      *
     C           CCICI     IFNE *BLANKS                    - B1
     C           CDICI     ANDNE*BLANKS
     C                     EXSR BOTHSR
     C                     ELSE                            - X1
     C           CCICI     IFNE *BLANKS                    - B2
     C                     EXSR CRSR
     C                     END                             - E2
     C           CDICI     IFNE *BLANKS                    - B2
     C                     EXSR DRSR
     C                     END                             - E2
     C                     END                             - E1
      *
      * Output summary                                                    EMP007
     C                     EXSR SUMMAR                                    EMP007
      *
      * reset printerfile fields
     C                     EXSR INITPR
      *
      *-------------------------------------------------------
     C           EXDETP    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS                     CCG015
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRNO   subroutine to decide if record must be extracted or not
     C**
     C********************************************************************
     C           PRNO      BEGSR                           **PRNO   BEGSR*
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'PRNO  '  @STK,Q
     C*..............................................................
     C                     MOVE 'N'       PRYES
     C                     MOVE '0'       *IN70
     C*
     C*  For Management or demand print
     C*
     C           CDICI     IFEQ 'M'                        - B1
     C           CCICI     OREQ 'M'
     C           CDICI     OREQ 'D'
     C           CCICI     OREQ 'D'
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E1
     C           CDICI     IFEQ 'M'                        - B1
     C           CCICI     OREQ 'M'
     C                     MOVE '1'       *IN70
     C                     END                             - E1
     C*
     C*  Access RECOM for commission details
     C*
     C           KLIST0    CHAINRECOM                99
     C           *IN99     IFEQ '1'                        ***************
     C                     Z-ADD21        DBASE            **DB ERROR 21**
     C                     MOVE 'RECOM  ' DBFILE           ***************
     C                     MOVELRKEY      DBKEY
     C                     EXSR DBSR
     C                     END
     C           CDICI     IFEQ 'C'
     C           CDICI     OREQ ' '
     C                     Z-ADD*ZERO     FXDC
     C                     END
     C*
     C           CDICA     SUB  CCDIC     CDICA
     C           ACCC      SUB  CACCC     ACCC
     C           CHDBC     SUB  CCHDBC    CHDBC
     C           CMBC      SUB  CCMBC     CMBC
     C*
     C*  If Capitalisation occurs at least one amount must be <> 0 to
     C*  be printed.
     C*
     C           CDICI     IFNE ' '                        - B1
     C           CDAIC     IFNE *ZERO                      - B2
     C           CPMADI    ORNE *ZERO
     C           CTMADI    ORNE *ZERO
     C           CDMINT    ORNE *ZERO
     C           CSGADI    ORNE *ZERO
     C           FXDC      ORNE *ZERO
     C           ACCC      ORNE *ZERO
     C           CHDBC     ORNE *ZERO
     C           CMBC      ORNE *ZERO
     C           CDICA     ORNE *ZERO
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           CCICI     IFNE ' '                        - B1
     C           CCAIC     IFNE *ZERO
     C           CPMACI    ORNE *ZERO
     C           CTMACI    ORNE *ZERO
     C           CCMINT    ORNE *ZERO
     C           CSGACI    ORNE *ZERO
     C           CCHGP     ORNE *ZERO
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** Always printed
     C*
     C                     MOVE 'Y'       PRYES   1
      *...........................................................
     C           EXPRNO    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C** INITPR Subroutine to initialize all print/extract fields
     C**
     C**     Called by       DETPR
     C**     Calls           -
     C********************************************************************
     C           INITPR    BEGSR                           **INITPR BEGSR**
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'INITPR'  @STK,Q
     C*..............................................................
     C*
     C                     MOVE *BLANKS   PSTDA   7
     C                     MOVE *BLANKS   VALDA   7
     C                     MOVE *BLANKS   VALDAY  7                       PFJ028
     C                     MOVE *BLANKS   NARR   30
     C                     MOVE *BLANKS   RNARR  30
     C                     MOVE *BLANKS   TNARR  30
     C                     MOVE *BLANKS   XNARR  30
     C                     MOVE *BLANKS   DNARR  30
     C                     MOVE *BLANKS   BNARR  30
     C*
     C                     Z-ADD*ZEROS    PSTD0
     C                     Z-ADD*ZEROS    RATE   117
     C                     Z-ADD*ZEROS    DAYS
     C                     Z-ADD*ZEROS    NUMB0
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADD*ZEROS    INTD0
     C                     Z-ADD*ZEROS    INTC0
     C                     Z-ADD*ZEROS    TINTD0
     C                     Z-ADD*ZEROS    TINTC0
     C                     Z-ADD*ZEROS    ORAT1
     C                     Z-ADD*ZEROS    OBAL01
     C                     Z-ADD*ZEROS    WHISDC
     C                     Z-ADD*ZEROS    WHISDD
     C                     Z-ADD*ZEROS    WCAIDD 150
     C                     Z-ADD*ZEROS    WDAIDD 150
     C                     Z-ADD*ZEROS    TGINT0
     C                     Z-ADD*ZEROS    WKBRT
     C                     Z-ADD*ZEROS    BRTOT0
     C                     Z-ADD*ZEROS    BRTOT1
     C                     Z-ADD*ZEROS    BDATE   50
     C                     Z-ADD*ZEROS    MADR#
     C                     Z-ADD*ZEROS    MACR#
     C                     Z-ADD*ZEROS    TCHN0
     C                     Z-ADD*ZEROS    TCHR0
     C                     MOVE *BLANK    @ADJF   1
      *
      *...........................................................
     C           EXINPR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C                     ENDSR                           **INITPR ENDSR*
      *****************************************************************
     C           HEADDC    BEGSR
      **  Header line extracted
      *****************************************************************
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'HEADDC'  @STK,Q
      *................................................................
      *
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\HEADDC' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      * Branch
     C                     MOVELCBRCA     ##D,1
      * Address 1-4
     C                     MOVELCNA1      ##D,2
     C                     MOVELCNA2      ##D,3
     C                     MOVELCNA3      ##D,4
     C                     MOVELCNA4      ##D,5
      *
      * Account in format Brc-Cnum-Ccy-Acod-Sq (length 24)
     C                     MOVELRKEY      ##D,6
      *
      * Retail Acount No (10,0)
     C                     MOVELACNO      ##D,7
      *
      * IBAN
     C                     MOVELRIBAN     ##D,8
      *Currency
     C                     MOVELCCCY      ##D,9
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *................................................................
     C           EXHEAD    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C           DETAIL    BEGSR
      **  Detail line extracted. All the output fields from the former
      **  detail lines in the PRTF RE3764P1 are collected in this groupset.
      **  These are:
      **  ------------------------------------------------------------
      **  PRTF-Recfmt      fields
      **  ------------------------------------------------------------
      **  TITLEDC          Value Date, Narrative, History balance
      **  RATEDC           value Date, Narrative, Rate
      **  RAT1DC           Posting date, value date, narrative
      **  RAT2DC           narrative, History balance
      **  RAT3DC           Rate (tier/threshold)
      **  STOTDC           Subtotals: Balance, No.of days, Interest debit & credit
      **  TOTALDC          Totals: Narrative, Interest days, Hist.Balance, Interest debit & credit
      **  TOTIAD           Manual adjustments: Narrative , Interest debit & credit
      **  TOTCOM           Total commissions : Narrative , Interest debit
      **  ALTNDC           Alternate account name
      *****************************************************************
      *
      **  Set up subroutine stack name                                    EMP007
     C                     ADD  1         Q                               EMP007
     C                     MOVEL'DETAIL'  @STK,Q                          EMP007
      *................................................................
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\DETAIL' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                    CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *-------------------------------------------------------------
      ** Posting Date
     C           SRIBAL    IFNE 'Y'                                                         MD059851
     C                     MOVEL##POST    ##D,1
      *
      ** Value Date
     C                     MOVEL##VDAT    ##D,2
     C                     ENDIF                                                            MD059851
      *
      ** Narrative
     C                     MOVEL##NARR    ##D,3
      *
      ** Historic Balance Debit
     C           ##BALD    IFNE 0
     C                     MOVEL##BALD    ##D,4
     C                     MOVE A6NBDP    ##D,4
     C                     ENDIF
      *
      ** Historic Balance Credit
     C           ##BALC    IFNE 0
     C                     MOVEL##BALC    ##D,5
     C                     MOVE A6NBDP    ##D,5
     C                     ENDIF
      ** Rate
      ** Output zero rate if from RATE  SR
     C           ##RATE    IFNE 0
     C           SRRATE    OREQ 'Y'
     C                     MOVEL##RATE    ##D,6
     C                     ENDIF
      *
      ** Third Narrative
     C                     MOVEL##NAR3    ##D,7
      *
      ** Number of days
     C           ##NOFD    IFNE 0
     C                     MOVEL##NOFD    ##D,8
     C                     ENDIF
      *
      ** Debit Interest
     C           ##DINT    IFNE 0
     C           ##NOFD    ORNE 0
     C                     MOVEL##DINT    ##D,9
     C                     MOVE A6NBDP    ##D,9
     C                     ENDIF
      *
      ** Credit Interest
     C           ##CINT    IFNE 0
     C           ##NOFD    ORNE 0
     C                     MOVEL##CINT    ##D,10
     C                     MOVE A6NBDP    ##D,10
     C                     ENDIF
      *
      ** Interest
     C           ##NUMC    IFNE 0
     C                     MOVEL##NUMC    ##D,11
     C                     MOVE A6NBDP    ##D,11
     C                     ENDIF
      *
      ** Alternate Account to post interest
     C                     MOVEL##ALTA    ##D,12
      *                                                                                     MD059851
      ** Corresponding Balance                                                              MD059851
      ** Output zero Corresponding Balance                                                  MD059851
     C           ##OBAL    IFNE 0                                                           MD059851
     C           SRCORR    OREQ 'Y'                                                         MD059851
     C                     MOVEL##OBAL    ##D,13                                            MD059851
     C                     MOVE A6NBDP    ##D,13                                            MD059851
     C                     ENDIF                                                            MD059851
      *
      *----------------------------------------------------
      ** Reset container fields
     C                     Z-ADD0         ##VDAT  60
     C                     Z-ADD0         ##POST  60
     C                     Z-ADD0         ##BALC 150
     C                     Z-ADD0         ##BALD 150
     C                     Z-ADD0         ##RATE 117
     C                     Z-ADD0         ##NOFD  40
     C                     Z-ADD0         ##NUMC 150
     C                     Z-ADD0         ##CINT 150
     C                     Z-ADD0         ##DINT 150
     C                     MOVEL*BLANKS   ##NARR 35
     C                     MOVEL*BLANKS   ##NAR3 35
     C                     MOVEL*BLANKS   ##ALTA 18
     C                     MOVEL'N'       SRRATE  1
     C                     Z-ADD0         ##OBAL 150                                        MD059851
     C                     MOVEL'N'       SRCORR  1                                         MD059851
     C                     MOVEL'N'       SRIBAL  1                                         MD059851
      *------------------------------------------------------
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *................................................................
     C           EXDETL    TAG
      *
      **  Unwind subroutine stack name
      *
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C           TOTALR    BEGSR
      **  Equivalent to Totals line TOTALR
      *****************************************************************
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'TOTALR'  @STK,Q
      *................................................................
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\TOTALR' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS                                    CCG015
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *-------------------------------------------------------------
     C                     Z-ADDDAYS      ##NOFD           interest days
     C   42                Z-ADDHISB0     ##BALD           debit
     C   43                Z-ADDHISB4     ##BALC           credit
      **---- extract-----
      **  Balance Debit
     C           ##BALD    IFNE 0
     C                     MOVEL##BALD    ##D,1
     C                     MOVE A6NBDP    ##D,1
     C                     ENDIF
      *
      **  Balance Credit
     C           ##BALC    IFNE 0
     C                     MOVEL##BALC    ##D,2
     C                     MOVE A6NBDP    ##D,2
     C                     ENDIF
      *
      **  Gross amount DR postings capitalisation
     C                     Z-ADDTPOS0     ##BALC
     C           ##BALC    IFNE 0
     C                     MOVEL##BALC    ##D,3
     C                     MOVE A6NBDP    ##D,3
     C                     ENDIF
      *
      ** Number of days
     C           DAYS      IFNE 0
     C                     MOVELDAYS      ##D,4
     C                     ENDIF
      *
      ** Highest Debit Balance
     C           PBAL0     IFNE 0                          13,0
     C                     MOVELPBAL0     ##D,5
     C                     MOVE A6NBDP    ##D,5
     C                     ENDIF
      *
      ** Total debit accrued interest
     C           INTTD0    IFNE 0                          15,0
     C                     MOVELINTTD0    ##D,6
     C                     MOVE A6NBDP    ##D,6
     C                     ENDIF
      *
      ** Total Credit accrued interest
     C           INTTC0    IFNE 0                          15,0
     C                     MOVELINTTC0    ##D,7
     C                     MOVE A6NBDP    ##D,7
     C                     ENDIF
      *------------------------------------------------------
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *................................................................
     C           EXTOTL    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C*******************************************************************
     C           TITLDC    BEGSR
     C* edit value date & historic balance (according to no.of decimals)
     C*******************************************************************
     C           *IN49     IFEQ '1'
     C                     MOVELLITER,1   TNARR
     C                     ENDIF
      *
     C                     MOVE VALDAY    ZDATE             7 A --> 6,0
     C                     EXSR ZDATE1                      ZDATE1
     C                     MOVE ZDAYNO    ##VDAT            6,0
      *
     C***********          EXSR SRDDTE
     C***********          MOVELZDAYNO    ##VDAT
     C                     MOVELTNARR     ##NARR
      *
     C           *IN42     IFEQ '1'                        DEBIT
     C                     Z-ADDHISB0     ##BALD
     C                     ENDIF
     C           *IN43     IFEQ '1'                        CREDIT
     C                     Z-ADDHISB4     ##BALC
     C                     ENDIF
      *
     C                     ENDSR
     C/EJECT
      ********************************************************************125176
      ** #ADJ subroutine to set up generated adjustment for report        125176
      **                                                                  125176
      **     Called by       BOTHSR, CRSR, DRSR                           125176
      ********************************************************************125176
     C           #ADJ      BEGSR                           ** #ADJ BEGSR**125176
      *                                                                   125176
     C           PPSTD     IFNE RUND                                      125176
     C                     Z-ADDRUND      ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     PSTDO                           125176
     C                     Z-ADDRUND      PPSTD                           125176
     C                     END                                            125176
     C                     MOVE PSTDO     PSTDA                           125176
      *                                                                   125176
     C           PVALD     IFNE DHISD                                     125176
     C                     Z-ADDDHISD     ZDAYNO                          125176
     C                     EXSR ZDATE2                                    125176
     C                     MOVE ZDATE     VALDO                           125176
     C                     Z-ADDDHISD     PVALD                           125176
     C                     END                                            125176
     C                     MOVE VALDO     VALDA                           125176
     C                     MOVE VALDO     VALDAY                          PFJ028
      *                                                                   125176
     C                     MOVELNAR,23    NARR                            125176
     C                     Z-ADD@GADJ     PSTD0                           125176
     C                     MOVE *BLANK    @ADJF                           125176
      *                                                                   125176
     C                     ENDSR                                          125176
     C/EJECT
      ********************************************************************094337
      ** REBSR subroutine for rebate calculation                          094337
      **                                                                  094337
      **     Called by                                                    094337
      **     Calls           DBSR,                                        094337
      ********************************************************************094337
     C           REBSR     BEGSR                           **REBSR  BEGSR 094337
      *                                                                   153001
      * If closure capitalisation, no rebate or minimum/maximum charge.   153001
     C                     Z-ADD*ZERO     REBATE                          153001
     C                     MOVE *BLANK    MINMAX                          153001
      *                                                                   153001
     C           CCICI     IFNE 'C'                                       153001
     C                     MOVE CCCY      WCCCY                           094337
     C                     MOVE *BLANK    BLANK1                          094337
     C                     MOVE 'D'       ENDK                            094337
     C*                                                                   094337
     C** ACCESS RECRG FILE                                                094337
     C*                                                                   094337
     C           CHKEY     CHAINRECRG                99                   094337
     C*                                                                   094337
     C** ERROR IN RECRG                                                   094337
     C*                                                                   094337
     C           *IN99     IFEQ '1'                        - B1           094337
     C                     Z-ADD20        DBASE            ************** 094337
     C                     MOVE 'RECRG'   DBFILE           **DB ERROR 20* 094337
     C                     MOVELCHKEY     DBKEY            ************** 094337
     C                     MOVEA'1'       *IN,89                          094337
     C                     EXSR DBSR                                      094337
     C                     END                             - E1           094337
     C*                                                                   094337
     C**********           Z-ADD*ZERO     REBATE                   094337 153001
     C           CMNBCP    IFLE EXBL                       - B1           094337
     C           PERM      ANDGT*ZEROS                                    094337
     C*                                                                   094337
     C** CALCULATE REBATE CHARGES                                         094337
     C*                                                                   094337
     C           CMNBCP    ADD  EXBL      REBATE                          094337
     C           REBATE    DIV  PERM      REBATE                          094337
     C           REBATE    MULT REB       REBATE                          094337
     C                     END                             - E1           094337
     C*                                                                   094337
     C           CCHGP     IFEQ MINC                       - E1           094337
     C           CCHGP     ANDNE*ZERO                      - E1           094337
     C                     MOVE 'MINIMUM' MINMAX  7                       094337
     C                     END                             - E1           094337
     C           CCHGP     IFEQ MAXC                       - E1           094337
     C           CCHGP     ANDNE*ZERO                      - E1           094337
     C                     MOVE 'MAXIMUM' MINMAX  7                       094337
     C                     END                             - E1           094337
     C*                                                                   094337
     C                     MOVELNAR,34    XNARR                           094337
     C                     Z-ADDCSTBL     PSTD0                           094337
      *                                                                   153001
     C                     ENDIF                                          153001
      *                                                                   153001
     C                     ENDSR                           **REBSR  ENDSR 094337
      ********************************************************************094337
     C/EJECT                                                              094337
     C********************************************************************
     C** Balance DR CR set Processing
     C********************************************************************
     C           DCSET1    BEGSR                           **DCSET1 BEGSR*
      *
     C                     SETOF                     4243
     C           HISB0     IFGE 0                                                 248425
     C           WHISBD    IFGT 0                                                 249283
     C                     SETON                     42
     C                     ELSE                                                   249283
     C                     SETON                     43                           249283
     C                     END                                                    249283
     C                     ELSE
     C                     SETON                     43
     C                     END
     C*
     C                     ENDSR                           **DCSET ENDSR**
     C*******************************************************************174403
     C*    NEWLIN : Subroutine to write a new line before a new rate if *174403
     C*             necessary.                                          *174403
     C*                                                                 *174403
     C*    CALLED BY RATESR                                             *174403
     C*******************************************************************174403
     C           NEWLIN    BEGSR                                         174403
     C*                                                                  174403
     C**  Output subtotal line                                           174403
     C           *IN51     IFEQ '0'                        - B1          174403
     C           DHISD     ANDLTCHISD                                    174403
     C*                                                                  174403
     C**  Check interest type                                            174403
     C           CDICT     IFLT 3                          - B2          174403
     C           CCICT     ANDLT3                                        174403
     C*                                                                  174403
     C**  Process in case of interest type are both less than 3          174403
     C           WHISB     IFLE *ZEROS                     - B3          174403
     C*                                                                  174403
     C           WHISBC    IFGE *ZEROS                     - B4          174403
     C*                                                                  174403
     C**  Output days/product/interest line for credit                   174403
     C                     Z-ADDWCRCBC    ZICALC                         174403
     C                     Z-ADDWHISDC    ZIBEG                          174403
     C                     Z-ADDDHISD     ZIEND                          174403
     C*                                                                  174403
     C                     EXSR ZICD                                     174403
     C*                                                                  174403
     C                     Z-ADDZDAYN1    DAYS                           174403
     C                     Z-ADDWHISBC    HISB4                          174403
     C           HISB4     MULT DAYS      NUMB4                          174403
     C                     Z-ADD0         HISB0                          174403
     C                     Z-ADD0         NUMB0                          174403
     C*                                                                  174403
     C                     Z-ADD*ZEROS    INTC0                          174403
     C           DAYS      IFGT *ZEROS                     - B5          174403
     C           NUMB4     ANDNE*ZEROS                                   174403
     C*                                                                  174403
     C           WHISDC    IFGE CLCID                      - B6          174403
     C                     MOVE 'CR'      DCFLAG                         174403
     C                     EXSR WST                        WRITE SUB TOT 174403
     C                     END                             - E6          174403
     C                     END                             - E5          174403
     C                     ELSE                            - X4          174403
     C                     Z-ADDWCRCBC    ZICALC                         174403
     C                     Z-ADDWHISDC    ZIBEG                          174403
     C                     Z-ADDDHISD     ZIEND                          174403
     C*                                                                  174403
     C                     EXSR ZICD                                     174403
     C*                                                                  174403
     C                     Z-ADDZDAYN1    DAYS                           174403
     C                     Z-ADDWHISBC    HISB4                          174403
     C           HISB4     MULT DAYS      NUMB4                          174403
     C                     Z-ADD0         HISB0                          174403
     C                     Z-ADD0         NUMB0                          174403
     C           DCAID     SUB  WCAIDD    INTC0                          174403
     C           DRECI     IFEQ 'S'                        - B5          174403
     C           SCICI     IFNE *BLANKS                    - B6          174403
     C           SCRIP     SUB  WCAIDD    INTC0                          174403
     C                     ADD  SGACI     INTC0                          174403
     C                     ELSE                            - X6          174403
     C           SCAIC     SUB  WCAIDD    INTC0                          174403
     C                     END                             - E6          174403
     C                     END                             - E5          174403
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                          174403
     C                     ENDIF                                                            MD058206
     C*                                                                  174403
     C           DAYS      IFGT *ZEROS                     - B5          174403
     C*                                                                  174403
     C           WHISDC    IFGE CLCID                      - B6          174403
     C                     MOVE 'CR'      DCFLAG                         174403
     C                     EXSR WST                        WRITE SUB TOT 174403
     C                     END                             - E6          174403
     C                     END                             - E5          174403
     C                     END                             - E4          174403
      *                                                                  174403
     C                     END                             - E3          174403
     C*                                                                  174403
     C           WHISB     IFGT *ZEROS                     - B3          174403
      *                                                                  174403
     C           WHISBD    IFGT *ZEROS                     - B4          174403
     C*                                                                  174403
     C**  Output days/product/interest line for debit                    174403
     C                     Z-ADDWDRCBD    ZICALC                         174403
     C                     Z-ADDWHISDD    ZIBEG                          174403
     C                     Z-ADDDHISD     ZIEND                          174403
     C*                                                                  174403
     C                     EXSR ZICD                                     174403
     C*                                                                  174403
     C                     Z-ADDZDAYN1    DAYS                           174403
     C                     Z-ADDWHISBD    HISB0                          174403
     C           HISB0     MULT DAYS      NUMB0                          174403
     C                     Z-ADD0         HISB4                          174403
     C                     Z-ADD0         NUMB4                          174403
     C           DDAID     SUB  WDAIDD    INTD0                          174403
     C           DRECI     IFEQ 'S'                        - B5          174403
     C           SDICI     IFNE *BLANKS                    - B6          174403
     C           SDRIP     SUB  WDAIDD    INTD0                           174403
     C                     ADD  SGADI     INTD0                           174403
     C                     ELSE                            - X6           174403
     C           SDAIC     SUB  WDAIDD    INTD0                           174403
     C                     END                             - E6           174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C           DAYS      IFGT *ZEROS                     - B5           174403
     C*                                                                   174403
     C           WHISDD    IFGE CLDID                      - B6           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E6           174403
     C                     END                             - E5           174403
     C                     ELSE                            - X4           174403
     C                     Z-ADDWDRCBD    ZICALC                          174403
     C                     Z-ADDWHISDD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C*                                                                   174403
     C                     EXSR ZICD                                      174403
     C*                                                                   174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C                     Z-ADDWHISBD    HISB0                           174403
     C           HISB0     MULT DAYS      NUMB0                           174403
     C                     Z-ADD*ZEROS    INTD0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C*                                                                   174403
     C           DAYS      IFGT *ZEROS                     - B5           174403
     C*                                                                   174403
     C           WHISDD    IFGE CLDID                      - B6           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E6           174403
     C                     END                             - E5           174403
     C                     END                             - E4           174403
      *                                                                   174403
     C                     END                             - E3           174403
     C*                                                                   174403
     C* Charge report if necessary                                        174403
     C*                                                                   174403
     C*                                                                   174403
     C                     ELSE                            - X2           174403
     C*                                                                   174403
     C           CDICT     IFGT 2                          - B3           174403
     C           CCICT     ANDGT2                                         174403
     C*                                                                   174403
     C**  Process in case of interest type are both greater than 3        174403
     C*                                                                   174403
     C**  Process output changing day                                     174403
     C*                                                                   174403
     C           DHISD     IFGT CLDID                      - B4           174403
     C                     Z-ADDWMNBL     HISB0                           174403
     C                     Z-ADD0         HISB4                           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E4           174403
      *                                                                   174403
     C           DHISD     IFGT CLDID                      - B4           174403
     C                     Z-ADD0         HISB0                           174403
     C                     Z-ADDWMNBL     HISB4                           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B4           174403
     C*                                                                   174403
     C           DSDAT     IFNE *ZEROS                     - B5           174403
     C           MNBL      ANDGT*ZEROS                                    174403
     C*                                                                   174403
     C**  Process debit                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C                     Z-ADDDINT      INTD0                           174403
     C           MNBL      MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           MHISD     IFGT CLDID                      - B6           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E6           174403
     C                     Z-ADDMHISD     WHISDD                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C           CSDAT     IFNE *ZEROS                     - B5           174403
     C           MNBL      ANDLT*ZEROS                                    174403
     C*                                                                   174403
     C**  Process credit                                                  174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           MHISD     IFGT CLCID                      - B6           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E6           174403
     C                     Z-ADDMHISD     WHISDC                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C**  Process until reading other than 'M'                            174403
     C*                                                                   174403
     C           DRECI     DOWEQ'M'                        - B5           174403
     C           *IN51     ANDEQ'0'                                       174403
     C*                                                                   174403
     C           KLIST1    READEREHISL                   51               174403
     C*                                                                   174403
     C           *IN51     IFEQ '0'                        - B6           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B7           174403
     C*                                                                   174403
     C           DSDAT     IFNE *ZEROS                     - B8           174403
     C           MNBL      ANDGT*ZEROS                                    174403
     C*                                                                   174403
     C**  Process debit                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C                     Z-ADDDINT      INTD0                           174403
     C           MNBL      MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           MHISD     IFGT CLDID                      - B9           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E9           174403
     C                     Z-ADDMHISD     WHISDD                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E8           174403
     C*                                                                   174403
     C           CSDAT     IFNE *ZEROS                     - B8           174403
     C           MNBL      ANDLT*ZEROS                                    174403
     C*                                                                   174403
     C**  Process credit                                                  174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           MHISD     IFGT CLCID                      - B9           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E9           174403
     C                     Z-ADDMHISD     WHISDC                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E8           174403
     C*                                                                   174403
     C                     ELSE                            - X7           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'S'                        - B8           174403
     C*                                                                   174403
     C**  Process a S record                                              174403
     C           SDICI     IFNE *BLANKS                    - B9           174403
     C*                                                                   174403
     C**  Process if debit capitalisation                                 174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           SMNBL     IFGT *ZEROS                     - B10          174403
     C                     Z-ADDDINT      INTD0                           174403
     C           SMNBL     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DHISD     IFGT CLDID                      - B11          174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E11          174403
     C                     ELSE                            - X10          174403
     C                     Z-SUBCINT      INTC0                           174403
     C           SMNBL     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           DHISD     IFGT CLCID                      - B11          174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E11          174403
     C                     END                             - E10          174403
     C*                                                                   174403
     C                     Z-ADDDHISD     WHISDD                          174403
     C*                                                                   174403
     C                     END                             - E9           174403
     C*                                                                   174403
     C           SCICI     IFNE *BLANKS                    - B9           174403
     C*                                                                   174403
     C**  Process if credit capitalisation                                174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
      *                                                                   174403
     C*                                                                   174403
     C           SMNBL     IFGT *ZEROS                     - B10          174403
     C                     Z-ADDDINT      INTD0                           174403
     C           SMNBL     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DHISD     IFGT CLDID                      - B11          174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E11          174403
     C                     ELSE                            - X10          174403
     C                     Z-SUBCINT      INTC0                           174403
     C           SMNBL     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0            - B11          174403
     C           DHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E11          174403
     C                     END                             - E10          174403
     C*                                                                   174403
     C                     Z-ADDDHISD     WHISDC                          174403
     C*                                                                   174403
     C                     END                             - E9           174403
     C*                                                                   174403
     C                     END                             - E8           174403
     C*                                                                   174403
     C                     END                             - E7           174403
     C*                                                                   174403
     C                     END                             - E6           174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C                     ELSE                            - X3           174403
     C*                                                                   174403
     C           CDICT     IFGT 2                          - B4           174403
     C           CCICT     ANDLT3                                         174403
     C*                                                                   174403
     C**  Process in case of interest type credit is less than 3          174403
     C**  and interest type debit is greater than 2                       174403
     C*                                                                   174403
     C**  Process output changing day                                     174403
     C*                                                                   174403
     C           DHISD     IFGT CLDID                      - B5           174403
     C                     Z-ADDWMNBL     HISB0                           174403
     C                     Z-ADD0         HISB4                           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E5           174403
      *                                                                   174403
     C           DHISD     IFGT CLCID                      - B5           174403
     C                     Z-ADDWMNBL     HISB4                           174403
     C                     Z-ADD0         HISB0                           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C           DCRCI     IFEQ 'Y'                        - B5           174403
     C*                                                                   174403
     C**  Process when change rate credit                                 174403
     C*                                                                   174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C*                                                                   174403
     C                     EXSR ZICD                                      174403
     C*                                                                   174403
     C                     Z-ADDZDAYN1    DAYS                            174403
      *                                                                   174403
      *                                                                   174403
     C*                                                                   174403
     C           DAYS      IFNE *ZEROS                     - B5           174403
     C*                                                                   174403
     C           DHISD     IFGT CLDID                                     174403
     C                     Z-ADDWHISB     HISB0                           174403
     C           HISB0     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         HISB4                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DDAID     SUB  WDAID     INTD0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C           DHISD     IFGT CLCID                                     174403
     C                     Z-ADDWHISB     HISB4                           174403
     C           HISB4     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         HISB0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           DDAID     SUB  WDAID     INTC0                           174403
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           174403
     C                     ENDIF                                                            MD058206
     C                     Z-ADD0         INTD0                           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C*                                                                   174403
     C* Charge report if necessary                                        174403
RS   C*                    EXSR PRN1CH                     chargesDetails 174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C**  Process end of month or change rate for debit                   174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B4           174403
     C           DSDAT     ANDNE*ZEROS                                    174403
     C*                                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           MNBL      IFGT *ZEROS                     - B5           174403
     C           MNBL      MULT DAYS      NUMB0                           174403
     C                     Z-ADDDINT      INTD0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C                     Z-ADD0         INTC0                           174403
     C           MHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X5           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         NUMB0                           174403
     C                     Z-ADD0         INTD0                           174403
     C           MHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     Z-ADDMHISD     WHISDD                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C           DRECI     DOWEQ'M'                        - B4           174403
     C           *IN51     ANDEQ'0'                                       174403
     C*                                                                   174403
     C           KLIST1    READEREHISL                   51               174403
     C*                                                                   174403
     C           *IN51     IFEQ '0'                        - B5           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B6           174403
     C           DSDAT     ANDNE*ZEROS                                    174403
     C*                                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           MNBL      IFGT *ZEROS                     - B7           174403
     C                     Z-ADDDINT      INTD0                           174403
     C           MNBL      MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           MHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X7           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           MHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E7           174403
     C*                                                                   174403
     C                     Z-ADDMHISD     WHISDD                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     ELSE                            - X6           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'S'                        - B7           174403
     C           SDICI     ANDNE*BLANKS                                   174403
     C*                                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           SMNBL     IFGT *ZEROS                     - B8           174403
     C                     Z-ADDDINT      INTD0                           174403
     C           SMNBL     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X8           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           SMNBL     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E8           174403
     C*                                                                   174403
     C                     Z-ADDDHISD     WHISDD                          174403
     C*                                                                   174403
     C                     END                             - E7           174403
     C*                                                                   174403
     C                     END                             - E6           174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C                     ELSE                            - X3           174403
     C*                                                                   174403
     C**  Process in case of interest type debit is less than 3           174403
     C**  and interest type credit is greater than 2                      174403
     C*                                                                   174403
     C**  Process output changing day                                     174403
     C*                                                                   174403
     C           DHISD     IFGT CLDID                                     174403
     C                     Z-ADDWMNBL     HISB0                           174403
     C                     Z-ADD0         HISB4                           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
      *                                                                   174403
     C           DHISD     IFGT CLCID                                     174403
     C                     Z-ADD0         HISB0                           174403
     C                     Z-ADDWMNBL     HISB4                           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C*                                                                   174403
     C           DDRCI     IFEQ 'Y'                        - B4           174403
     C*                                                                   174403
     C**  Debit rate change                                               174403
     C*                                                                   174403
     C                     Z-ADDWDRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C*                                                                   174403
     C                     EXSR ZICD                                      174403
     C*                                                                   174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           DAYS      IFNE *ZEROS                     - B5           174403
     C*                                                                   174403
     C           DHISD     IFGT CLDID                                     174403
     C                     Z-ADDWHISB     HISB0                           174403
     C           HISB0     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         HISB4                           174403
     C                     Z-ADD0         NUMB4                           174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C           DHISD     IFGT CLCID                                     174403
     C                     Z-ADDWHISB     HISB4                           174403
     C           HISB4     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         HISB0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C*                                                                   174403
     C* Charge report if necessary                                        174403
RS   C*                    EXSR PRN1CH                     chargesDetails 174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C**  Credit end of month or credit rate change                       174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B4           174403
     C           CSDAT     ANDNE*ZEROS                                    174403
     C*                                                                   174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
      *                                                                   174403
     C           MNBL      IFGT *ZEROS                     - B5           174403
     C                     Z-ADDDINT      INTD0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           MHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X5           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           MHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     Z-ADDMHISD     WHISDC                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C           DRECI     DOWEQ'M'                        - B4           174403
     C           *IN51     ANDEQ'0'                                       174403
     C*                                                                   174403
     C           KLIST1    READEREHISL                   51               174403
     C*                                                                   174403
     C           *IN51     IFEQ '0'                        - B5           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'M'                        - B6           174403
     C           CSDAT     ANDNE*ZEROS                                    174403
     C*                                                                   174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDMHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           MNBL      IFGT *ZEROS                     - B7           174403
     C                     Z-ADDDINT      INTD0                           174403
     C           MNBL      MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           MHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X7           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           MNBL      MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           MHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E7           174403
     C*                                                                   174403
     C                     Z-ADDMHISD     WHISDC                          174403
     C                     Z-ADDMNBL      WMNBL                           174403
     C*                                                                   174403
     C                     ELSE                            - X6           174403
     C*                                                                   174403
     C           DRECI     IFEQ 'S'                        - B7           174403
     C           SCICI     ANDNE*BLANKS                                   174403
     C*                                                                   174403
     C                     Z-ADDWCRCB     ZICALC                          174403
     C                     Z-ADDWWHISD    ZIBEG                           174403
     C                     Z-ADDDHISD     ZIEND                           174403
     C                     EXSR ZICD                                      174403
     C                     Z-ADDZDAYN1    DAYS                            174403
     C*                                                                   174403
     C           SMNBL     IFGT *ZEROS                     - B8           174403
     C                     Z-ADDDINT      INTD0                           174403
     C           SMNBL     MULT DAYS      NUMB0                           174403
     C                     Z-ADD0         INTC0                           174403
     C                     Z-ADD0         NUMB4                           174403
     C           DHISD     IFGT CLDID                                     174403
     C                     MOVE 'DR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     ELSE                            - X8           174403
     C                     Z-SUBCINT      INTC0                           174403
     C           SMNBL     MULT DAYS      NUMB4                           174403
     C                     Z-ADD0         INTD0                           174403
     C                     Z-ADD0         NUMB0                           174403
     C           DHISD     IFGT CLCID                                     174403
     C                     MOVE 'CR'      DCFLAG                          174403
     C                     EXSR WST                        WRITE SUB TOT  174403
     C                     END                                            174403
     C                     END                             - E8           174403
     C*                                                                   174403
     C                     Z-ADDDHISD     WHISDC                          174403
     C*                                                                   174403
     C                     END                             - E7           174403
     C*                                                                   174403
     C                     END                             - E6           174403
     C*                                                                   174403
     C                     END                             - E5           174403
     C*                                                                   174403
     C                     END                             - E4           174403
     C*                                                                   174403
     C                     END                             - E3           174403
     C*                                                                   174403
     C                     END                             - E2           174403
     C*                                                                   174403
     C                     END                             - E1           174403
     C*                                                                   174403
     C                     END                                            174403
     C*                                                                   174403
     C                     ENDSR                           NEWLIN         174403
     C/EJECT
      ********************************************************************094431
      ** WMA   subroutine - Writes Manual adjustment print record.        094431
      **       Also accumulates the interest amount printed.              094431
      ********************************************************************094431
     C           WMA       BEGSR                                          094431
      *                                                                   094431
     C                     SELEC                                          094431
     C           DCFLAG    WHEQ 'DR'                                      094431
     C                     ADD  INTD0     MADR#                           094431
     C**************       EXSR OVERDR                                    094431
     C*** PFJ028           WRITEMADJDR                                    094431
      *                                                                   094431
     C           DCFLAG    WHEQ 'CR'                                      094431
     C***********          ADD  INTD0     MACR#                     094431094674
     C                     ADD  INTC0     MACR#                           094674
     C           INTC0     IFGT 0                                                           MD058206
     C                     Z-SUBINTC0     INTC0                           125176
     C                     ENDIF                                                            MD058206
     C******************   EXSR OVERCR                                    094431
     C*** PFJ028           WRITEMADJCR                                    094431
     C                     ENDSL                                          094431
      *                                                                   094431
     C                     ENDSR                                          094431
      /EJECT                                                              094431
      *****************************************************************
      * Subroutine  :  SRGENR                                         *
      * Function    :  Generate reference number                      *
      *                by writing to PF/CGUDCRPD                      *
      *                                                               *
      * Called by   :  SRMAIN - Main Processing                       *
      * Calls       :  CG9010 - Create reference record               *
      *****************************************************************
     C           SRGENR    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRGENR'  @STK,Q
      *................................................................
      *
      **  Generate reference number and check if further processing
      **  required. Set up all available information in the record
      **  format before calling.
      *
     C                     MOVELCBRCA     DRBRCA
     C                     MOVELCBRCA     DRORBR
     C                     MOVEL'RE'      DRMODI
     C                     MOVEL*BLANK    DRMTRN
     C           RKAC      CAT  XBRCA     DRMACT
      *
     C                     MOVELCCNUM     ##CUST
      *
     C                     CALL 'CG9010'
     C                     PARM           ##RTCD  7
     C                     PARM '*GEN'    ##MODE 10
     C                     PARM W0CMT     ##CMT   3
     C                     PARM           ##CUST  6
     C                     PARM           ##UDCR
     C                     PARM           ##ITMA  8
      *
      **  Blank return code implies generate correspondence.
      **  CGD1270 => no error, but suppress output for this transaction.
      *
     C           ##RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       ##COPD  1
      *                                                                   CCG015
      ** Pass reference as PRINTTYPE:SUBTYPE.                             CCG015
      *                                                                   CCG015
     C           DRPTYP    CAT  ':':0     COLON  11 P                     CCG015
     C           COLON     CAT  DRPSTP:0  ##REFR    P                     CCG015
      *                                                                   CCG015
     C                     EXSR WRAPRF                                    CCG015
      *
     C                     ELSE
      *
      *CGD1286=Error in reference generation program CG9010
     C           ##RTCD    IFNE 'CGD1270'
     C                     MOVEL'CG9010  'W0FILE
     C                     MOVEL##RTCD    W0KEY            ***************
     C                     Z-ADD10        W0ERNB           * DB ERROR 14 *
     C                     MOVEL'CGD1286' W0MSGD           ***************
     C                     MOVEL'CGUSRMSG'W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
      *...............................................................
      *
     C           EXGENR    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  SRRRDE                                         *
      * Function    :  Retrieve RDE information for RDEs in group set *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  -                                              *
      *****************************************************************
     C           SRRRDE    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRRDE'  @STK,Q
      *................................................................
      **  Reset
     C                     MOVEL*BLANK    ##R
     C                     MOVEL*BLANK    ##D
     C                     MOVEL*BLANK    ##S
      *
      **  Get information about next 20 RDEs in group set from compile
      **  time arrays
     C                     Z-ADD0         #1
     C           *IN99     DOUEQ'0'
     C           #1        OREQ 20
     C                     Z-ADD1         #2
     C           ##GRPX    LOKUP##GRP,#2                 99*
     C           *IN99     IFEQ '1'
     C                     ADD  1         #1
     C                     MOVEL##RDEA,#2 ##R,#1
     C                     ADD  1         ##RDEN
     C                     ENDIF
     C                     ENDDO
      *................................................................
     C           EXRRDE    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRADTA                                         *
      * Function    :  Accumulate RDEs and associated data for output *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG3999 - Format and Pack Data                  *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRADTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRADTA'  @STK,Q
      *
      *................................................................
      **  Reformat RDE data
      *
     C                     EXSR SRRFMN
      *
      **  Pack RDEs and associated data into data string
     C                     CLEAR##SDS
      *                                                                   CCG015
      ** Set-up Action Code parameter W0ACT                               CCG015
      *                                                                   CCG015
     C           CCG015    IFEQ 'Y'                                       CCG015
     C                     MOVE '*NEWARR 'W0ACT                           CCG015
     C                     MOVELS#PATH    W0SPAT                          CCG015
     C                     ELSE                                           CCG015
     C                     MOVE '*PACK   'W0ACT                           CCG015
     C                     MOVEL*BLANKS   W0SPAT                          CCG015
     C                     ENDIF                                          CCG015
      *                                                                   CCG015
     C                     CALL 'CG3999'
     C                     PARM *BLANK    ##RTCD  7
     C*********************PARM '*PACK   'W0ACT                           CCG015
     C                     PARM           W0ACT                           CCG015
     C                     PARM           ##R
     C                     PARM           ##D
     C                     PARM           ##S
     C                     PARM           W0SPAT 70                       CCG015
     C                     PARM           ##RN                            CCG015
     C                     PARM           ##DN                            CCG015
     C                     PARM           ##FM                            CCG015
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG3999  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 20 *
     C                     Z-ADD20        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *                                                                   CCG015
      ** Write a XML record for RDE.                                      CCG015
      *                                                                   CCG015
     C                     EXSR WRTRDE                                    CCG015
      *
      **  Initialise Write Format Parameter.
     C                     CLEARW0FMT
      *
      **  Set up Control Information.
     C                     Z-ADD##ITEM    DEITEM
     C                     ADD  1         ##OSEQ
     C                     Z-ADD##OSEQ    DEOSEQ
     C                     Z-ADD1         DEPBIN
     C                     Z-ADD1         DETBIN
     C                     MOVE 'FR'      DEFSLI
     C                     MOVE *BLANKS   W0PATH
     C                     MOVELS#PATH    W0PATH
      *
      **  Append Data from pack routine.
     C           W0FMT     CAT  ##SDS:0   W0FMT
      *
      *...............................................................
     C           EXADTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRRFMN                                         *
      * Function    :  Reformat RDE data                              *
      *                                                               *
      * Called by   :  SRADTA                                         *
      * Calls       :                                                 *
      *****************************************************************
     C           SRRFMN    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRRFMN'  @STK,Q
      *
      *................................................................
      ** Loop through RDE's and data
      *
     C                     Z-ADD0         #1
     C           #1        DOUEQ20
     C                     ADD  1         #1
     C                     MOVEL##R,#1    R#DEFN
     C                     MOVEL##D,#1    R#DATA
      *
      ** If data present and RDE is edited
      *
     C           R#DATA    IFNE *BLANK
     C           ##RDEC    ANDNE*BLANK
      *
      * Reformat Amount
     C                     Z-ADD1         #2
     C           *BLANK    LOKUP##NUMA,#2                99*
     C                     Z-ADD20        #3
     C                     Z-ADD0         ##WNUM
     C           #2        DOWGT1
     C           #2        ANDLE20
     C           #3        ANDGT1
     C                     SUB  1         #2
     C                     MOVEL##NUMA,#2 ##W,#3
     C                     SUB  1         #3
     C                     ENDDO
      *
      * Sign the amount
     C           ##SIGN    IFEQ '-'
     C                     Z-SUB##WNUM    ##NUMB
     C                     ELSE
     C                     Z-ADD##WNUM    ##NUMB
     C                     END
      *
      * Default Edit Type
     C           ##EDTT    IFEQ *BLANK
     C                     MOVEL##RDET    ##EDTT
     C                     END
      *
      * Default Decimal Places
     C           ##DCPA    IFEQ *BLANK
     C                     MOVEL##RDED    ##DCPA
     C                     END
      * New RDE data
     C                     MOVELR#DATA    ##D,#1
     C                     ENDIF
     C                     ENDDO
      *
      *................................................................
     C           EXRFMN    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      * Subroutine  :  SRODTA                                         *
      * Function    :  Output Accumulated data to PF/CGUDTAPD         *
      *                                                               *
      * Called by   :  Simple group set subroutines                   *
      * Calls       :  CG9020 - Output Data to CGUDTAPD               *
      *                SRERR  - Database Error                        *
      *****************************************************************
     C           SRODTA    BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRODTA'  @STK,Q
      *
      *................................................................
      ** Run CG9020 only if switchable feature CCG015 is *OFF.            CCG015
      *                                                                   CCG015
     C           CCG015    IFEQ 'N'                                       CCG015
      *                                                                   CCG015
      **  Output PF/CGUDTAPD Record.
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*WRITE  'W0ACT
     C                     PARM           W0PATH256
     C                     PARM           W0FMT
     C                     PARM *BLANK    W0TITL  7
     C                     PARM *BLANK    W0ULIN  7
     C                     PARM           W0CMT
      *
      **  Database error
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG9020  'W0FILE           ***************
     C                     MOVEL##RTCD    W0KEY            * DB ERROR 21 *
     C                     Z-ADD21        W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     ENDIF                                          CCG015
      *...............................................................
      *
     C           EXODTA    TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      * Subroutine  :  FIRST                                          *
      * Function    :  Initial processing - First Call Only           *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :  DBSR                                           *
      *****************************************************************
     C           FIRST     BEGSR                           **FIRST BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'FIRST '  @STK,Q
      *
     C** Prepare DBPGM, DBKEY and ERRDAT variables
     C*
     C                     MOVE 'CG4871  'DBPGM
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C           MBIN      IFEQ 'Y'
     C                     SETON                     86
     C                     END
      *
     C**-------------------------
     C**   Access Bank Details
     C**-------------------------
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBANKPD'DBFILE
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     MOVEL@OPTN     DBOPTN  7        **DB ERROR 15**
     C                     Z-ADD15        DBASE            ***************
     C                     EXSR DBSR
     C                     GOTO EXFST
     C                     END
      *
     C*------------------------------                                     094337
     C**   Access Retail Details.                                         094337
     C*------------------------------                                     094337
     C                     CALL 'AORETLR0'                                094337
     C                     PARM *BLANKS   @RTCD   7                       094337
     C                     PARM '*FIRST ' @OPTN   7                       094337
     C           SDRETL    PARM SDRETL    DSFDY                           094337
     C           @RTCD     IFNE *BLANK                                    094337
     C           *LOCK     IN   LDA                                       094337
     C                     MOVEL'SDRETLPD'DBFILE           ***************094337
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 27 *094337
     C                     MOVEL@OPTN     DBOPTN  7        ***************094337
     C                     Z-ADD027       DBASE                           094337
     C                     OUT  LDA                                       094337
     C                     EXSR DBSR                                      094337
     C                     GOTO EXFST                                     094337
     C                     END                                            094337
     C**-------------------------------------                             CRE003
     C**   Set off W-PRINT-Indicator                                      CRE003
     C**                                                                  CRE003
     C                     SETOF                     69                   CRE003
     C**                                                                  CRE003
     C**-------------------------------------                             CRE003
     C**  If accrual-on-cleared balances flag= 'N', seton W-PRINT-INDICAT.CRE003
     C**                                                                  CRE003
     C           BMCBAI    IFEQ 'N'                                       CRE003
     C                     SETON                     69                   CRE003
     C                     END                                            CRE003
      *
     C**-------------------------------------
     C** Initialise work fields
     C*
     C                     Z-ADD*ZEROS    PPSTD
     C                     Z-ADD*ZEROS    PVALD
      *** DEBUT PFJ028
     C                     Z-ADD1         PAGD    40
     C                     Z-ADD1         PAGC    40
      *** FIN   PFJ028
RS   C                     Z-ADD1         PAGN    40
     C                     Z-ADD1         PAGE
     C                     Z-ADD*ZEROS    DHISD
     C                     Z-ADD*ZEROS    WHISD
RS   C                     Z-ADD*ZEROS    DAYS    40
     C                     Z-ADD*ZEROS    NUMB0
     C                     Z-ADD*ZEROS    NUMB4                           182347
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADD*ZEROS    INTD0
     C                     Z-ADD*ZEROS    INTC0
     C                     Z-ADD*ZEROS    TINTD0
     C                     Z-ADD*ZEROS    TINTC0
     C                     Z-ADD*ZEROS    ZICALC  20
     C                     Z-ADD*ZEROS    WDAID
     C                     Z-ADD*ZEROS    WCAID
     C                     Z-ADD*ZEROS    RTA                             125176
     C                     Z-ADD*ZEROS    BLA                             143079
     C                     Z-ADD*ZEROS    HISB4                           PFJ023
     C                     Z-ADD*ZEROS    HISB5                           PFJ023
     C                     Z-ADD*ZEROS    HISB6                           PFJ023
     C                     Z-ADD*ZEROS    HISB7                           PFJ023
     C*
     C**--------------------------------------------------
     C**  Setup work field for message file override
     C                     Z-ADD50        MSGLEN 155
     C*
     C**--------------------------------------------------
     C** Open ICD Table for Retail
     C*
     C                     OPEN TABTBRE
     C           1         CHAINTABTBRE              99
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           RECI      ORNE 'D'
     C                     Z-ADD16        DBASE            ***************
     C                     MOVE 'TABTBRE' DBFILE           **DB ERROR 16**
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEA'0'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C**---------------------------------------------------------
     C** Check if "Charges for multiple Transaction" is present
     C*
     C           CMTR      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN88
     C                     ELSE                            - X1
     C                     MOVE '0'       *IN88
     C                     END                             - E1
     C*
     C**---------------------------------------------------------
     C** Check if "Capitalisation to an account in different currency
     C** and multibranch" is present
     C*
     C           CDFC      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN87
     C                     ELSE                            - X1
     C                     MOVE '0'       *IN87
     C                     END                             - E1
     C*
     C                     CLOSETABTBRE
     C*
     C**---------------------------------------------------------
     C* Check for "SWISS TAXES" present
     C*
     C           1         SETLLSDMMODPD
     C                     READ SDMMODPD                 99
?   ?C           *IN99     IFEQ '1'                        - B1
     C                     Z-ADD17        DBASE            ***************
     C                     MOVEL'SDMMODPD'DBFILE           **DB ERROR 17**
     C                     MOVEL'MMOD'    DBKEY            ***************
     C                     MOVEA'0'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
      *                                                                   CRE001
     C**-------------------------------------------------------------
      ** Access SAR Details File to determine if CRE001 is installed      CRE001
     C**-------------------------------------------------------------
      *                                                                   CRE001
     C                     CALL 'AOSARDR0'                                CRE001
     C                     PARM *BLANKS   @RTCD   7                       CRE001
     C                     PARM '*VERIFY' @OPTN                           CRE001
     C                     PARM 'CRE001'  @SARD   6                       CRE001
      *                                                                   CRE001
      ** Handle Datebase Error.                                           CRE001
     C           @RTCD     IFNE *BLANK                                    CRE001
     C           @RTCD     ANDNE'*NRF   '                  ***************CRE001
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 25**CRE001
     C                     MOVEL@RTCD     DBKEY            ***************CRE001
     C                     Z-ADD25        DBASE                           CRE001
     C                     EXSR DBSR                                      CRE001
     C                     GOTO EXFST                                     CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
      ** CRE001 is installed                                              CRE001
     C           @RTCD     IFEQ *BLANK                                    CRE001
     C                     MOVE 'Y'       CRE001  1                       CRE001
     C                     ELSE                                           CRE001
     C                     MOVE 'N'       CRE001                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C**-------------------------------------------------------------
     C                     EXSR MULTL                      Multilanguage
     C**-------------------------------------------------------------
     C** Check date format
     C**
     C           DATF      COMP 'M'                      98
     C**
     C**-------------------------------------------------------------
     C** Access SAR Details for BRT SAR is installed
     C**-------------------------------------------------------------
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01383'  @SARD   6
     C           @RTCD     IFNE *BLANK
     C           @RTCD     ANDNE'*NRF   '                  ***************
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 18**
     C                     MOVEL@RTCD     DBKEY            ***************
     C                     Z-ADD18        DBASE
     C                     EXSR DBSR                                      LN0112
     C                     GOTO EXFST
     C                     END
     C           @RTCD     IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C*
     C** IF BRT SAR INSTALLED
     C*
     C           S01383    IFEQ 'Y'                        B001
     C*
     C**-------------------------------------------------------------
     C** Access BRT Installation Control Data
     C**-------------------------------------------------------------
     C                     MOVE 'D'       RECI
     C           RECI      CHAINSDBRTDD0             99
     C           *IN99     IFEQ '1'                        ***************
     C                     MOVEL'SDBRTDPD'DBFILE           **DB ERROR 19**
     C                     MOVELRECI      DBKEY            ***************
     C                     Z-ADD19        DBASE
     C                     EXSR DBSR
     C                     GOTO EXFST
     C                     END
     C                     END                             E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3761CCP1                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADDTGINT0    TGINT0
     C                     Z-ADDWKBRT     WKBRT   75
     C                     Z-ADDBRTOT0    BRTOT0
     C                     Z-ADDBRTOT1    BRTOT1 151
     C*
     C                     EXSR CCYARR
      *
     C**---------------------------------------------------------------
      **  Access SAR details file to see if CFT004 is installed (IBAN)    CFT004
     C**---------------------------------------------------------------   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM '*VERIFY' POPTN   7                       CFT004
     C                     PARM 'CFT004'  PSARD   6                       CFT004
     C           SCSARD    PARM SCSARD    DSSDY                           CFT004
     C*                                                                   CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ENDIF                                          CFT004
      *
     C**---------------------------------------------------------------   CCG015
      **  Access SAR details file to determine if CCG015 is installed.    CCG015
     C**---------------------------------------------------------------   CCG015
     C                     CALL 'AOSARDR0'                                CCG015
     C                     PARM *BLANKS   PRTCD   7                       CCG015
     C                     PARM '*VERIFY' POPTN   7                       CCG015
     C                     PARM 'CCG015'  PSARD   6                       CCG015
     C           SCSARD    PARM SCSARD    DSSDY                           CCG015
     C*                                                                   CCG015
     C                     MOVE 'N'       CCG015  1                       CCG015
     C           PRTCD     IFEQ *BLANKS                                   CCG015
     C                     MOVE 'Y'       CCG015                          CCG015
     C                     ENDIF                                          CCG015
      *                                                                                     MD059851
      ** Call AOSVALR0 to check system value to zeroised interest rate if                   MD059851
      ** initial threshold is greater than the level balance.                               MD059851
      *                                                                                     MD059851
     C                     CALL 'AOSVALR0'                                                  MD059851
     C                     PARM *BLANKS   PRTCD                                             MD059851
     C                     PARM WSYSVL    WSVLK1 20                                         MD059851
     C                     PARM           WSVL1 200                                         MD059851
     C                     PARM *BLANKS   WSVLK2 20                                         MD059851
     C                     PARM           WSVL2 200                                         MD059851
     C                     PARM *BLANKS   WSVLK3 20                                         MD059851
     C                     PARM           WSVL3 200                                         MD059851
     C                     PARM *BLANKS   WSVLK4 20                                         MD059851
     C                     PARM           WSVL4 200                                         MD059851
     C                     PARM *BLANKS   WSVLK5 20                                         MD059851
     C                     PARM           WSVL5 200                                         MD059851
     C                     PARM *BLANKS   WSVLK6 20                                         MD059851
     C                     PARM           WSVL6 200                                         MD059851
     C                     PARM *BLANKS   WSVLK7 20                                         MD059851
     C                     PARM           WSVL7 200                                         MD059851
     C                     PARM *BLANKS   WSVLK8 20                                         MD059851
     C                     PARM           WSVL8 200                                         MD059851
     C                     PARM *BLANKS   WSVLK9 20                                         MD059851
     C                     PARM           WSVL9 200                                         MD059851
     C                     PARM *BLANKS   WSVLK0 20                                         MD059851
     C                     PARM           WSVL0 200                                         MD059851
      *                                                                                     MD059851
     C           PRTCD     IFNE *BLANKS                                                     MD059851
     C           WSVL1     ANDEQ'*NRF   '                                                   MD059851
     C                     EXSR *PSSR                                                       MD059851
     C                     ELSE                                                             MD059851
     C                     MOVELWSVL1     WZERAT  1                                         MD059851
     C                     ENDIF                                                            MD059851
      *                                                                                     MD059851
      *................................................................
     C           EXFST     TAG
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **FIRST ENDSR**
     C/SPACE 5
     C********************************************************************
     C**   SR. to set up an array of currencies and an array of decimal
     C**   places for those currencies.
     C********************************************************************
     C           CCYARR    BEGSR                           *** CCYARR  ***
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CCYARR'  @STK,Q
      *
     C**   Setof Error Indicator
     C                     SETOF                     99
     C**
     C**   Set array index to zero.
     C                     Z-ADD0         X       30
     C**
     C**   Set up key for currency table.
     C                     MOVE *BLANKS   W@CKEY  3
     C**
     C**   Set lower limit and read currency table header.
     C           W@CKEY    SETLLSDCURRL0
     C**
     C**   Loop to read currency detail records.
     C           XLOOP     TAG                             ** XLOOP TAG **
     C                     READ SDCURRL0                 99
     C**
     C**   end if all currency records processed
     C   99                GOTO XEND
     C**
     C**   Increment array index.
     C           X         ADD  1         X
     C**
     C**   Move data into arrays.
     C                     MOVE A6CYCD    CCYA,X
     C                     MOVE A6NBDP    DPA,X
     C                     MOVE A6CYNM    CCYN,X
     C**
     C**   CHECK FOR FULL ARRAY.96 ON IF FULL.
     C           X         COMP 200                      96
     C**
     C**   Goto Read next record.
     C  N96                GOTO XLOOP
     C**
     C           XEND      TAG                             ** XEND TAG  **
      **
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C**
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZICD subroutine to find number of days to calculate interest
     C**      according to calculation basis
     C**
     C**     Called by       BOTHSR, CRSR, DRSR, ITYPCR,
     C**                     ITYPDR, TOTSR
     C**
     C**     Calls           DBSR
     C********************************************************************
     C           ZICD      BEGSR                           **ZICD BEGSR**
     C*
     C* To determine number of days (interest to be calculated'
     C*
     C           ZIEND     SUB  ZIBEG     ZDAYN1
     C*
     C* CHECK FOR INTEREST CALCULATION BASIS
     C*
     C           ZICALC    IFEQ 3                          - B1
     C           ZIEND     IFGT ZIBEG                      - B2
     C*
     C** CALCULATING DATE FROM DAY NUMBER (BEGINNING DATE)
     C*
     C                     Z-ADDZIBEG     ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDZDATE     SRES
     C*
     C** CALCULATING DATE FROM DAY NUMBER (FINISHING DATE)
     C*
     C                     Z-ADDZIEND     ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDZDATE     FRES
     C*
     C*
     C** IN ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF ZIEND
     C** IS GREATER THAN ZIBEG, THEN THE DATE ZIEND MUST BE IN A DIFFERENT
     C** CENTURY TO ZIBEG. IF SO ADD 100 YEARS TO IT.
     C*
     C*
     C           ZIFY      IFLT ZISY                       - B3
     C           ZIFY      ADD  100       ZIFY2   30
     C                     ELSE                            - X3
     C                     Z-ADDZIFY      ZIFY2
     C                     END                             - E3
     C*
     C                     Z-ADDZISY      ZISY2   30
     C*
     C** DETERMINE WHETHER START YEAR IS A LEAP YEAR AND IF START MONTH
     C** IS FEBRUARY  THEN CONSIDER LAST DAY OF FEBRUARY AS DATE 30ND. OF THE
     C*  MONTH
     C*
     C           ZISM      IFEQ 2                          - B3
     C           ZISY2     ADD  1900      ZLYCHK  40
     C           ZLYCHK    DIV  4         ZLYCHK
     C                     MVR            ZLYREM  20
     C           ZLYREM    IFEQ 0                          - B4
     C           ZISD      IFEQ 29                         - B5
     C                     Z-ADD30        ZISD
     C                     END                             - E5
     C                     ELSE                            - X4
     C           ZISD      IFEQ 28                         - B5
     C                     Z-ADD30        ZISD
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           30        SUB  ZISD      ZID1
     C*
     C           ZID1      IFLT 0                          - B3
     C                     Z-ADD*ZEROS    ZID1
     C                     END                             - E3
     C*
     C           ZISM      IFEQ 12                         - B3
     C                     Z-ADD*ZEROS    ZISM
     C                     ADD  1         ZISY
     C                     ADD  1         ZISY2
     C                     END                             - E3
     C*
     C** DETERMINE WHETHER END YEAR IS A LEAP YEAR AND IF END MONTH IS FEBRUARY
     C*
     C           ZIFM      IFEQ 2                          - B3
     C           ZIFY2     ADD  1900      ZLYCHK  40
     C           ZLYCHK    DIV  4         ZLYCHK
     C                     MVR            ZLYREM  20
     C           ZLYREM    IFEQ 0                          - B4
     C           ZIFD      IFEQ 29                         - B5
     C                     Z-ADD30        ZIFD
     C                     END                             - E5
     C                     ELSE                            - X4
     C           ZIFD      IFEQ 28                         - B5
     C                     Z-ADD30        ZIFD
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           ZIFD      IFEQ 31                         - B3
     C                     ADD  30        ZID1
     C                     ELSE                            - X3
     C                     ADD  ZIFD      ZID1
     C                     END                             - E3
     C*
     C                     SUB  1         ZIFM
     C*
     C           ZISY      IFEQ ZIFY                       - B3
     C           ZIFM      SUB  ZISM      ZINOM   30
     C                     ELSE                            - X3
     C           12        SUB  ZISM      ZIM1
     C                     Z-ADD1         ZISM
     C*
     C** USE ENLARGE FIELDS THAT CAN HANDLE 1999 ONWARDS
     C*
     C                     ADD  1         ZISY2
     C           ZIFY2     SUB  ZISY2     ZIY1
     C           ZIY1      MULT 12        ZIM2    30
     C           ZIM2      ADD  ZIFM      ZIM2
     C           ZIM2      ADD  ZIM1      ZINOM
     C*
     C                     END                             - E3
     C*
     C           ZINOM     MULT 30        ZID2
     C           ZID2      ADD  ZID1      ZDAYN1
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           ZICALC    IFEQ 4                          - B1
     C           ZICALC    OREQ 5
     C*
     C** ONE DAY IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB IN THE
     C** THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG AND ZIEND
     C*
     C** FIND NO OF FOUR YEAR PERIODS BETWEEN DATES
     C*
     C           ZDAYN1    DIV  1461      ZIMAN
     C                     MVR            ZIREM
     C*
     C** FIND NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.
     C*
     C           ZIBEG     SUB  60        ZIBW1
     C           ZIBW1     DIV  1461      ZIDW1
     C                     MVR            ZIDREM
     C*
     C           ZIDREM    IFEQ 0                          - B2
     C                     Z-ADDZIBEG     ZIDW2
     C                     END                             - E2
     C*
     C** ROUND UP RESULT
     C*
     C           ZIDW1     ADD  1         ZIDW2
     C*
     C** CALCULATE NEXT 29 FEB.
     C*
     C           ZIDW2     MULT 1461      ZIDW2
     C           ZIDW2     ADD  60        ZIDW2
     C*
     C** IF THIS NEXT 29 FEB. DAYNO - ZIBEG IS GREATER OR EQUAL TO ZIREM THEN
     C** ADD 1 TO ZIMAN.
     C*
     C           ZIDW2     SUB  ZIBEG     ZILPCP
     C*
     C           ZIREM     IFGE ZILPCP                     - B2
     C                     ADD  1         ZIMAN
     C                     END                             - E2
     C*
     C** SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1 REQUIRED FOR THIS
     C** INTEREST CALCULATION
     C*
     C           ZDAYN1    SUB  ZIMAN     ZDAYN1
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **ZICD ENDSR**
     C********************************************************************
     C** MULTL - Multilanguage Subroutine
     C**
     C**     Called by       FIRST, MAIN
     C**     Calls           ZA1310
     C********************************************************************
     C           MULTL     BEGSR                           **MULTL BEGSR**
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'MULTL '  @STK,Q
      *
     C                     EXSR CLMSG
     C                     MOVEL'RES0001' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,1            ** B/F Balance **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0002' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,2            ** Opening balance **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0003' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,3            ** Debit opening rate **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0004' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,4            ** Debit rate change to **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0005' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,5            ** Total interest **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0006' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,6            ** Balance C/F **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0007' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,7            ** Total debited **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0008' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,8            ** Credit opening rate **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0009' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,9            ** Credit rate change to **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0010' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,10           ** Total credited **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0011' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,11           ** Debit rate change **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0012' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,12           ** Credit rate change to **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0013' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,13           ** For balances below **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0014' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,14           ** For balances over **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0015' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,15           ** Debit opening balance **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0016' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,16           ** Credit opening balance **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0017' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,17           Int. DR Comm.
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0018' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,18           Commission Acc.
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0019' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,19           Commission H/O
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0020' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,20           Min. Bal. Comm.
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0021' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,21           TOTAL
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0022' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,22           Total Charges
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0023' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,23           Int. Adjust.
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0024' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,24           ** VAT **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0025' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,25           Total debit numbers
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'TAS0001' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,26           ** W/TAX **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0033' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,27           ** Overdraft limit **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0035' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,28           ** Fixed Commission **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0039' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,29           Manual Adjustment
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0040' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,30           ** Inactive A/c Com **
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0041' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,31           Credit Int to
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0042' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,32           Debit Int to
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0043' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,33           Charges to
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0044' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,34           Extra Daily Stmt Com
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0045' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,35           Backvalued Man Adj
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0046' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,36           REBATE
     C                     MOVEL*BLANKS   MNARR
      *
      ** If CRE001 is switched ON                                         CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0034' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,37           ** Additional overdr. rate **
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0033' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,38           ** Overdraft limit **
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0037' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,39           ** New limit **
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     ENDIF                                          CRE001
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR                           **MULTL ENDSR**
     C/EJECT
     C********************************************************************
     C** ITYPCR subroutine for interest type greater than 2
     C**
     C**     Called by       CRSR, TOTSR
     C**
     C**     Calls           ZICD
     C********************************************************************
     C           ITYPCR    BEGSR                           **ITYPCR BEGSR*
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q       50
     C                     MOVEL'ITYPCR'  @STK,Q
      *...............................................................
     C*
     C**  Check if end of month or Rate change Credit
     C*
     C           DRECI     IFEQ 'M'                        - B1
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B2
     C                     Z-ADDDINT      INTD0
     C                     ELSE                            - X2
     C                     Z-SUBCINT      INTC0
     C                     ENDIF                                          085713
      *                                                                   085713
     C*******************  EXSR OVERCR                                    094431
     C*******************  WRITESTOTCR                                    094431
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        Write subtotl  094431
     C*
     C* Charge Report if necessary
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E1
     C*
     C           DRECI     DOWEQ'M'                        - B1
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFNE '1'                        - B2
     C*
     C           DRECI     IFEQ 'M'                        - B3
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B4
     C                     Z-ADDDINT      INTD0
     C                     ELSE                            - X4
     C                     Z-SUBCINT      INTC0
     C                     ENDIF                                          085713
     C*******************  EXSR OVERCR                                    094431
     C*******************  WRITESTOTCR                                    094431
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* Charge Report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X3
     C*
     C           DRECI     IFEQ 'S'                        - B4
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B5
     C                     Z-ADDDINT      INTD0
     C                     ELSE                            - X5
     C                     Z-SUBCINT      INTC0
     C*******************  EXSR OVERCR                                    094431
     C*******************  WRITESTOTCR                                    094431
     C                     MOVE 'CR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* Charge Report if necessary
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C                     END                             - E5
     C*
     C                     Z-ADDDHISD     WHISD
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
      *-------------------------------------------------------
     C           EXICR     TAG
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **ITYPCR ENDSR*
     C/EJECT
     C********************************************************************
     C** ITYPDR subroutine for interest type greater than 2
     C**
     C**     Called by       DRSR; TOTSR
     C**     Calls           ZICD
     C********************************************************************
     C           ITYPDR    BEGSR                           **ITYPDR BEGSR*
     C*
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'ITYPDR'  @STK,Q
     C*
     C**  Check if end of month or debit rate change
     C*
     C           DRECI     IFEQ 'M'                        - B1
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B2
     C                     Z-ADDDINT      INTD0
     C                     ELSE                            - X2
     C                     Z-SUBCINT      INTC0
     C*******************  EXSR OVERDR                                    094431
     C*******************  WRITESTOTDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* Charge Report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C                     END                             - E2
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E1
     C*
     C           DRECI     DOWEQ'M'                        - B1
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFNE '1'                        - B2
     C*
     C           DRECI     IFEQ 'M'                        - B3
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B4
     C                     Z-ADDDINT      INTD0
     C***********          EXSR OVERDR                                    085713
     C***********          WRITESTOTDR                                    085713
     C                     ELSE                            - X4
     C                     Z-SUBCINT      INTC0
     C                     ENDIF                                          085713
      *                                                                   085713
     C*******************  EXSR OVERDR                                    094431
     C*******************  WRITESTOTDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* Charge Report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X3
     C*
     C           DRECI     IFEQ 'S'                        - B4
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B5
     C                     Z-ADDDINT      INTD0
     C***********          EXSR OVERDR                                    085713
     C***********          WRITESTOTDR                                    085713
     C***********                                                         085713
     C                     ELSE                            - X5
     C                     Z-SUBCINT      INTC0
     C                     ENDIF                                          085713
      *                                                                   085713
     C*******************  EXSR OVERDR                                    094431
     C*******************  WRITESTOTDR                                    094431
     C                     MOVE 'DR'      DCFLAG                          094431
     C                     EXSR WST                        WRITE SUB TOT  094431
     C*
     C* Charge Report if necessary
     C*
RS   C*                    EXSR PRN1CH                     chargesDetails1085713
     C*
     C                     Z-ADDDHISD     WHISD
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
      *-------------------------------------------------------
     C           EXIDR     TAG
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     C*
     C                     ENDSR                           **ITYPDR ENDSR*
     C*
     C/EJECT
     C**==================================================================
     C           SUMMAR    BEGSR
     C**==================================================================
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SUMMAR'  @STK,Q
      *................................................................
      **  Retrieve subroutine specific data.
     C           1         OCUR ##SRDT
     C                     MOVEL##SPAT    S#PATH
      *
      **  Set up Path.
     C                     MOVEL'\SUMMAR' ##PNAM  7
     C           S#PATH    CAT  ##PNAM:0  S#PATH
     C                     EXSR PSHGRS
      *
      **  Retrieve RDE information for RDEs in group set
      *
     C                     MOVEL@STK,Q    ##GRPS
     C                     Z-ADD1         ##RDEN
     C                     EXSR SRRRDE
      *
      ** No-Details-Ind., set by default to 'N'. If no interest details exist, option to not print
     C                     MOVEL'N'       ##D,1            details exist
     C           ZEROI     IFEQ 'Y'
     C                     MOVEL'Y'       ##D,1            no details
     C                     ENDIF
      *
      **  Accumulate RDE's and associated data and output to
      **  PF/CGUDTAPD.
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
      *........................................................
     C           EXSUMM    TAG
      *
      **  Unwind subroutine stack name
     C                     EXSR POPGRS
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
     C********************************************************************
     C***   CLEAR INPUT VARIABLES OF MESSAGE
     C********************************************************************
     C           CLMSG     BEGSR                           ** SR CLMSG **
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'CLMSG '  @STK,Q
      *
     C                     MOVEL*BLANK    MSGDT0
     C                     MOVEL*BLANK    MSGDT1
     C                     MOVEL*BLANK    MSGDT2
     C                     MOVEL*BLANK    MSGDT3
     C                     MOVEL*BLANK    MSGDT4
     C                     MOVEL*BLANK    MSGDT5
     C                     MOVEL*BLANK    MSGDT6
     C                     MOVEL*BLANK    MSGDT7
     C                     MOVEL*BLANK    MSGDT8
     C                     MOVEL*BLANK    MSGDT9
     C                     MOVEL*BLANK    MNARR
      *
      *...............................................................
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR                           **CLMSG ENDSR**
     C********************************************************************
     C** DBSR  - Database error handling routine
     C********************************************************************
     C           DBSR      BEGSR                           **DBSR BEGSR**
     C*
     C                     SETON                     U7U8LR
     C                     DUMP
      *
     C                     RETRN
     C*
     C                     ENDSR                           **DBSR ENDSR**
      *****************************************************************
      * Subroutine  :  SRINZ                                          *
      * Function    :  Initialise Fields on Program Invocation        *
      *                                                               *
      * Called by   :  Mainline                                       *
      * Calls       :                                                 *
      *****************************************************************
     C           SRINZ     BEGSR
      *
      **  Set up subroutine stack name
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      *...............................................................
      *
      **  Initialise work fields
     C                     Z-ADD*ZEROS    ##W050  50
     C                     Z-ADD*ZEROS    ##W150 150
     C                     Z-ADD*ZEROS    #1      60
     C                     Z-ADD*ZEROS    #2      60
     C                     Z-ADD*ZEROS    #3      60
     C                     MOVE *BLANKS   S#PATH256
     C           *LIKE     DEFN DEOSEQ    ##OSEQ
      *
      **  Initialise output sequence (to CGUDTAPD)
     C                     Z-ADD*ZEROS    ##OSEQ
      *
      ** Initialise XML increment
      *
     C                     EXSR INIXML
      *
     C           EXINZ     TAG
      *................................................................
      *
      **  Unwind subroutine stack name
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY CGCPYSRC,SRERRPSSR
     C/COPY CGCPYSRC,SRERRC
     C/COPY CGCPYSRC,CGNWEX
      *****************************************************************
** ##GRP/##RDE
HEADDC0001 BRANCH                   Branch
HEADDC0002 CUST_ADR1                CustomerAddress1
HEADDC0003 CUST_ADR2                CustomerAddress2
HEADDC0004 CUST_ADR3                CustomerAddress3
HEADDC0005 CUST_ADR4                CustomerAddress4
HEADDC0006 ACCOUNT                  Account
HEADDC0007 RETL_ACNO                RetailAccount
HEADDC0008 IBAN                     IBAN
HEADDC0009 CURRENCY                 Currency
DETAIL0001 POST_DATE  Date          PostingDate
DETAIL0002 VALUE DATE Date          ValueDate
DETAIL0003 NARRATIVE                Narrative
DETAIL0004 HISBALD    AmountL       HistoryBalanceDebit
DETAIL0005 HISBALC    AmountL       HistoryBalanceCredit
DETAIL0006 RATE       Rate  L7      Rate
DETAIL0007 NARRATIVE2               SecondNarrative
DETAIL0008 DAYS INT                 NumberOfDaysInterest
DETAIL0009 INTDEBIT   AmountL       InterestDebit
DETAIL0010 INTCREDIT  AmountL       InterestCredit
DETAIL0011 INT CAP    AmountL       InterestCapit
DETAIL0012 ALTACCOUNT               AlternativeAccNumber
TOTALR0001 HISTBALD   AmountL       BalanceDebit
TOTALR0002 HISTBALC   AmountL       BalanceCredit
TOTALR0003 GRDEBIT    AmountL       DebitPostingsCapitalisation
TOTALR0004 DAYS TOT                 InterestDays
TOTALR0005 MAX DEBIT  AmountL       HighestDebitBalance
TOTALR0006 DEBINT     AmountL       DebitInterestAccrued
TOTALR0007 CREDINT    AmountL       CreditInterestAccrued
SUMMAR0001 PRINTIND                 PrintIndicator
DETAIL0013 CORRBAL    AmountL       CorrespondingBalances                                   MD059851
**   CMD - COMMAND TO OVERIDE MESSAGE FILE
OVRMSGF MSGF(  QUSERMSG) TOMSGF(GBREPTMSGF)
OVRMSGF MSGF( CGUSERMSG) TOMSGF(GBCGUSRMSG)
**  CPY@
(c) Finastra International Limited 2021
**   various text elements
  ** OPENING BALANCE **
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
