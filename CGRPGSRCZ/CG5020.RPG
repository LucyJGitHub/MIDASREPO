     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas CG C/M - Prompt for selection')                  *
/*OVRF*: OVRDBF (File in program) (file on system)                  : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - User Defined Correspondence                      *
     F*                                                               *
     F*  CG5020 - Correspondence Management: prompt for selection     *
     F*                                                               *
     F*  Function:  This program allows the use to enter the criteria *
     F*             for selection of Correspondence Items to display  *
     F*             on the Correspondence Management screen.          *
     F*                                                               *
     F*  Called By: CGC5020 - Correspondence Management               *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CRE075             Date 06Dec10               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD053             Date 01Jun06               *
      *                 CCG017             Date 23Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 115722             Date 12Feb98               *
      *                 095461             Date 24Oct95               *
     F*                 CCG009             DATE 01JUN95               *
     F*                 S01522             DATE 22NOV94               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade        *
      *         - (Recompile)                                         *
      *  CCG017 - Reprint by Item ID                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  115722 - Comment out references to CGUSRMSG/CGD1001          *
     F*  095461 - Add Correspondent type to selection                 *
     F*  CCG009 - Private Banking UDC                                 *
     F*  S01522 - User Defined Correspondence                         *
     F*                                                               *
     F*****************************************************************
     F*PMTRCD: Cpysrc Templates Initialise Program F-Spec
      /COPY WNCPYSRC,CG5020DFPG
     FCG5020DFCF  E                    WORKSTN
     F                                              KINFDS INFDS#
     F                                              KINFSR SRFILE
      * DSP: Prompt for selection      Prompt & validate record
      *
     FCGCORRL1IF  E           K        DISK
     F                                              KINFSR SRFILE
      * RTV : Correspondent Details     Retrieval index
      *
     FCGISTSL1IF  E           K        DISK
     F                                              KINFSR SRFILE
      * RTV : Print Item Status         Retrieval index
      *
     FCGPTYPL1IF  E           K        DISK
     F                                              KINFSR SRFILE
      * RTV : Print Item Type/Sub-Type  Retrieval index
      *
     FCGMSHTL1IF  E           K        DISK
     F                                              KINFSR SRFILE
      * RTV : Mail Shot Details         Retrieval index
      *
     FCGCTYPL1IF  E           K        DISK                               095461
     F                                              KINFSR SRFILE         095461
      * RTV : Correspondent Type        Retrieval index                   095461
      *                                                                   095461
      /EJECT
     E                    CPY@    1   1 80
     E*  Array containing Copyright statement
     E*
     E********************MOD     1   7  2                                CCG009
     E                    MOD     1   8  2                                CCG009
      ** Modules which produce correspondence
      *
      /COPY CGCPYSRC,SRERRE
     E*  Copysource for error processing
     E*
     E*PMTRCD: Cpysrc Templates Initialise Program E-Spec
      /COPY WNCPYSRC,CG5020DEPG
      /EJECT
      /COPY CGCPYSRC,SRERRI
     I*  End of Program Error Processing copysource
     I*
     I*PMTRCD: Cpysrc Templates Initialise Program I-Spec
      /COPY WNCPYSRC,CG5020DIPG
      * Data structures:
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IRUNDTA    E DSRUNDAT
     I*
     I* Get Rundate - Rundate  *
     I*
     IMMODDS    E DSSDMMODPD
     I*
     I* Modules Data Structure *
     I*
     IACCTDS    E DSACCNTAB
     I*
     I* Account details
     I*
     ISDLANG    E DSSDLANGPD
     I              LCD                             LCDX
     I              CHTP                            CHTPX
     I              TNLU                            TNLUX
     I              RECI                            RECIX
     I** Language details
     I*
     ISDBRCH    E DSSDBRCHPD
     I** Branch details
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     I* Data Structures used by Access Programs                           S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I* Data Structures used by Access Programs                           S01194
     I*                                                                   S01194
     IO1PARM      DS
     I                                        1  10 O1CORR
      ** Retrieval index: correspondent id
      *
     IO2PARM      DS
     I                                        1  10 O2ISTS
      ** Retrieval index: item status
      *
     IO3PARM      DS
     I                                        1  10 O3PTYP
     I                                       11  20 O3PSTP
      ** Retrieval index: print item type/sub-type
      *
     IO4PARM      DS                             10                       095461
      * KEY: Correspondent Type        Retrieval index                    095461
      * I : MAP Correspondent type                                        095461
     I                                        1  10 O4CTYP                095461
      * Parameter declarations
     IP#PARM      DS
      ** Selection details
     I                                        1  10 P#DCOR
     I                                       11  20 P#PCOR
     I                                       21  23 P#BRCA
     I                                       24  25 P#MODI
     I                                       26  40 P#MTRN
     I                                       41  43 P#OVBR
     I**********                             44  61 P#MACT                                    CGL029
     I                                       44  61 QQMACT                                    CGL029
     I                                       62  65 P#ISTS
     I                                       66  700P#PRTD
     I                                       71  80 P#PTYP
     I                                       81  90 P#PSTP
     I                                       91  92 P#LGID
     I                                       93  93 P#ATRM
     I                                       94 103 P#CTYP                095461
     I                                      104 127 P#MACT                                    CGL029
     I                                      128 1350P#ITEM                                    CCG017
      *
     I            DS
      * Message data for 'Invalid Action code (FT)'
     I                                        1 132 ZAMSDA
      * Action Code
     I                                        1   1 ZA0001
      *
     IDSMTR       DS
      *  Define fields for message transalation
      *
     I                                        1 132 #MSDTA
     I                                      133 264 #MSTX1
     I#MSTX2      DS
     I                                        1 256 #MSTXA
     I                                      257 512 #MSTXB
      *
     I            DS
      ** Account id components for verify
     I**********                              1  18 #1MACT                                    CGL029
     I                                        1  24 #1MACT                                    CGL029
     I                                        1   6 ##CNUM
     I                                        7   9 ##CYCD
     I**********                             10  13 ##ACCD                                    CGL029
     I**********                             14  15 ##ACSN                                    CGL029
     I**********                             16  18 ##BRCA                                    CGL029
     I                                       10  19 ##ACCD                                    CGL029
     I                                       20  21 ##ACSN                                    CGL029
     I                                       22  24 ##BRCA                                    CGL029
      *
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P0ACTC  1
     C                     PARM           P0KEYI100
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Conduct screen conversation
     C                     DO   *HIVAL
      * Start new transaction
     C                     MOVEL'Y'       W0TRN   1
      * Process current transaction
     C           W0TRN     DOWEQ'Y'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
     C   12                CAS            ZXEXPG
      *
      * Process screen input
     C                     CAS            DAPRSC
     C                     END
      *
     C                     END
      *
     C                     END
      *****************************************************************
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Update screen time
     C                     TIME           ##TME
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
      * Enable PUTOVR
     C                     SETON                     86
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDDTL1
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPRSC    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * USER: Process command keys
      * PMTRCD: Process Cmd Key - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates Process Command Keys
      /COPY WNCPYSRC,CG5020DPCK
      * Validate screen input
     C                     EXSR DBVLSC
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * USER: User defined action
      * PMTRCD: User Defined Acts - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates User Defined Actions
     C/COPY WNCPYSRC,CG5020DUDA
      *
      ** Set up parameter, and call lower link
     C                     MOVEL#1DCOR    P#DCOR
     C                     MOVEL#1PCOR    P#PCOR
     C                     MOVEL#1BRCA    P#BRCA
     C                     MOVEL#1MODI    P#MODI
     C                     MOVEL#1MTRN    P#MTRN
     C                     MOVEL#1OVBR    P#OVBR
     C                     MOVEL#1MACT    P#MACT
     C                     MOVEL#1ISTS    P#ISTS
     C                     MOVEL#1MACT    P#MACT
     C                     Z-ADD#1PRTD    P#PRTD
     C                     MOVEL#1PTYP    P#PTYP
     C                     MOVEL#1PSTP    P#PSTP
     C                     MOVEL#1LGID    P#LGID
     C                     MOVEL#1ATRM    P#ATRM
     C                     MOVEL#1CTYP    P#CTYP                          095461
     C                     MOVEL##ITEM    P#ITEM                                              CCG017
      *
     C                     CALL 'CG5000'               9090
     C                     PARM *BLANKS   P#RTN   7
     C                     PARM           P#PARM
     C                     PARM P0ACTC    P#ACTC  1
     C                     PARM P0KEYI    P#KEYI100
      *
      **  Option ended in error
     C           *IN90     IFEQ '1'
     C                     MOVEL'CGD1000' P#RTN
     C                     ENDIF
      *
      **  Depending on return code - exit or re-display screen
     C                     SELEC
      *
      **  F12 pressed - redisplay subfile
     C           P#RTN     WHEQ 'USR0790'                  *IF
     C                     MOVEL*BLANKS   P0RTN            *Return code
      *
     C***Send*message*'F12*taken*from*previous*screen'****************    115722
     C*********************MOVEL'CGD1001' ZAMSID                          115722
     C*********************EXSR ZASNMS                                    115722
     C                     GOTO DAEXIT
      *
      **  F3 pressed - exit program
     C           P#RTN     WHEQ 'Y2U9999'                  *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
      *
      **  If error redisplay
     C           P#RTN     WHNE *BLANKS                    *IF
      *
      **  Re-display screen
     C                     MOVEL'CGD1000' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO DAEXIT
      *
      **  New selection - redisplay subfile
     C           P#RTN     WHEQ *BLANKS                    *IF
     C                     MOVEL'Y'       W0DCF
     C                     GOTO DAEXIT
     C                     ENDSL                           *LS
      *
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBVLSC    BEGSR
      *================================================================
      * Validate screen input
      *================================================================
      *
      * Bypass ref file checks if error already detected
     C   99                GOTO DBEXIT
      * Check reference to Correspondent Details
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * Check reference to Correspondent Details
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
      * Check reference to Midas Branch codes
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9933  *
     C                     END
      * Check reference to Midas Branch codes
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9935  *
     C                     END
      * Check reference to Midas Branch codes
     C                     EXSR VECKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9937  *
     C                     END
      * Check reference to Print Item Status
     C                     EXSR VFCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9939  *
     C                     END
      * Check reference to Print Item Type/Sub-Type
     C                     EXSR VGCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     994142*
     C                     END
      * Check reference to Midas Languages codes
     C                     EXSR VHCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9943  *
     C                     END
      * Check reference to Correspondent Type                             095461
     C                     EXSR VJCKRL                                    095461
     C           W0RTN     IFNE *BLANK                                    095461
     C                     SETON                     9945  *              095461
     C                     END                                            095461
      * Check reference to Mail Shot Details
     C                     EXSR VICKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CALC: Screen function fields
      * PMTRCD: Screen Func. Flds - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates Screen Function Fields
     C/COPY WNCPYSRC,CG5020DSFI
      * USER: Validate relations
      * PMTRCD: Validate Relation - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates Validate Relations
     C/COPY WNCPYSRC,CG5020DVRE
      *
      ** Validate scheduled print date
     C           ##PDAT    IFEQ *BLANKS
     C                     CLEAR#1PRTD
     C                     ELSE
     C                     TESTN          ##PDAT     75
     C           *IN75     IFEQ '1'
     C                     MOVE ##PDAT    ##DATE
     C                     CALL 'ZA0270'
     C                     PARM           ##DATE  60
     C                     PARM AGDFF     ##DFMT  1
     C                     PARM           ##RTN   1
     C                     PARM           ##DAYN  50
     C                     ENDIF
      *
     C           ##RTN     IFNE '0'
     C           *IN75     OREQ '0'
     C                     MOVEL'CGD1556' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1556' W0RTN
     C                     SETON                     9940
     C                     ELSE
     C                     Z-ADD##DAYN    #1PRTD
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate module id
     C           #1MODI    IFNE *BLANK
     C           #1MODI    LOKUPMOD                      70
     C           *IN70     IFEQ '0'
     C                     MOVEL'CGD1561' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1561' W0RTN
     C                     SETON                     9934
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate account id
     C           #1MACT    IFNE *BLANK
     C                     CALL 'AOACCTV0'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM ##CNUM    ##ACID 10
     C                     PARM           ##CYCD  3
     C**********           PARM           ##ACCD  4                                           CGL029
     C                     PARM           ##ACCD 10                                           CGL029
     C                     PARM           ##ACSN  2
     C                     PARM           ##BRCA  3
     C                     PARM           ##TYPE  7
     C                     PARM           ##NOSN  2
     C           ACCTDS    PARM *BLANKS   DSSDY
      *
     C           ##RTCD    IFNE *BLANKS
     C                     MOVEL'CGD1562' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1562' W0RTN
     C                     SETON                     9938
     C                     ENDIF
     C                     ENDIF
      *
      ** Validate Auto-transmission indicator
     C           #1ATRM    SCAN ' YN'                    70
     C           *IN70     IFEQ '0'
     C                     MOVEL'CGD1565' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1565' W0RTN
     C                     SETON                     9944
     C                     ENDIF
      *
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Correspondent Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1DCOR    IFEQ *BLANK                     Correspondent
     C                     GOTO VAEXIT
     C                     END
      *
      * Check for selection
      *
     C           ' ?'      CHECK#1DCOR                   90
     C           *IN90     IFEQ '0'
     C           #1DCOR    ANDNE*BLANKS
     C                     MOVEL*BLANKS   O1PARM
     C                     CALL 'CG0021'               9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM 'S'       O1ACTC  1        Action Code
     C                     PARM           O1PARM           B:RDE
      *
      * Analyse return code
      *
     C           *IN90     IFEQ '0'
     C           P@RTCD    ANDEQ*BLANKS
      * Record found
     C                     MOVELO1CORR    #1DCOR
      *
      * Delay
      *
     C                     MOVEL'1'       *IN99
     C                     GOTO VAEXIT
     C                     END
      *
     C                     END
      *
     C           KLVCCD    KLIST
     C                     KFLD           CDCORR           Correspondent
      * Setup key
     C                     MOVEL#1DCOR    CDCORR           Correspondent
     C           KLVCCD    CHAIN@CORRL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Correspondent Details  NF'
     C                     MOVEL'CGD1157' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1157' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Correspondent Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1PCOR    IFEQ *BLANK                     Correspondent
     C                     GOTO VBEXIT
     C                     END
      *
      * Check for selection
      *
     C           ' ?'      CHECK#1PCOR                   90
     C           *IN90     IFEQ '0'
     C           #1PCOR    ANDNE*BLANKS
     C                     MOVEL*BLANKS   O1PARM
     C                     CALL 'CG0021'               9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM 'S'       O1ACTC  1        Action Code
     C                     PARM           O1PARM           B:RDE
      *
      * Analyse return code
      *
     C           *IN90     IFEQ '0'
     C           P@RTCD    ANDEQ*BLANKS
      * Record found
     C                     MOVELO1CORR    #1PCOR
      *
      * Delay
      *
     C                     MOVEL'1'       *IN99
     C                     GOTO VBEXIT
     C                     END
      *
     C                     END
      * Setup key
     C                     MOVEL#1PCOR    CDCORR           Correspondent
     C           KLVCCD    CHAIN@CORRL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Correspondent Details  NF'
     C                     MOVEL'CGD1157' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1157' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Midas Branch codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1BRCA    IFEQ *BLANK                     Branch Code
     C                     GOTO VCEXIT
     C                     END
      *
      * Setup key
     C                     MOVEL#1BRCA    P@BRCA           Branch
     C  N99      '?'       SCAN #1BRCA                   99
      *
      *  Call to access pgm for Customer details
      *
     C**********           CALL 'AOBRCHR0'             9090                                   CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM           P@BRCA  3
     C           SDBRCH    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBRCHR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 01 *
     C                     Z-ADD1         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           P@RTCD    IFEQ *BLANKS
      * Record found - move back any virtuals
     C                     MOVELA8BRCD    #1BRCA           Branch
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Midas Branch codes NF'
     C                     MOVEL'CGD1278' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1278' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Midas Branch codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1ORBR    IFEQ *BLANK                     Branch Code
     C                     GOTO VDEXIT
     C                     END
      *
      * Setup key
     C                     MOVEL#1ORBR    P@BRCA           Branch
     C  N99      '?'       SCAN #1ORBR                   99
      *
      *  Call to access pgm for branch details
      *
     C**********           CALL 'AOBRCHR0'             9090                                   CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM           P@BRCA  3
     C           SDBRCH    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBRCHR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 02 *
     C                     Z-ADD2         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           P@RTCD    IFEQ *BLANKS
      * Record found - move back any virtuals
     C                     MOVELA8BRCD    #1ORBR           Branch
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Midas Branch codes NF'
     C                     MOVEL'CGD1278' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1278' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
      *================================================================
      * Check reference to Midas Branch codes
      *================================================================
     CSR         VECKRL    BEGSR
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1OVBR    IFEQ *BLANK                     Branch Code
     C                     GOTO VEEXIT
     C                     END
      *
      * Setup key
     C                     MOVEL#1OVBR    P@BRCA           Branch
     C  N99      '?'       SCAN #1OVBR                   99
      *
      *  Call to access pgm for branch details
      *
     C**********           CALL 'AOBRCHR0'             9090                                   CGL029
     C                     CALL 'AOBRCHR1'             9090                                   CGL029
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY   ' P@OPTN  7
     C                     PARM           P@BRCA  3
     C           SDBRCH    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOBRCHR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 03 *
     C                     Z-ADD3         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           P@RTCD    IFEQ *BLANKS
      * Record found - move back any virtuals
     C                     MOVELA8BRCD    #1OVBR           Branch
     C                     GOTO VEEXIT
     C                     END
      * Send message 'Midas Branch codes NF'
     C                     MOVEL'CGD1278' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1278' W0RTN
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         VFCKRL    BEGSR
      *================================================================
      * Check reference to Print Item Status
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1ISTS    IFEQ *BLANK                     Item Status
     C                     GOTO VFEXIT
     C                     END
      *
      * Check for selection
     C           ' ?'      CHECK#1ISTS                   90
     C           *IN90     IFEQ '0'
     C           #1ISTS    ANDNE*BLANKS
     C                     MOVEL*BLANKS   O2PARM
     C                     CALL 'CG1200'               9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM 'S'       P@ACTC  1        Action Code
     C                     PARM           O2PARM
      *
      * Analyse return code
      *
     C           *IN90     IFEQ '0'
     C           P@RTCD    ANDEQ*BLANKS
      * Record found
     C                     MOVELO2ISTS    #1ISTS
      *
      * Delay
     C                     MOVEL'1'       *IN99
     C                     GOTO VFEXIT
     C                     END
      *
     C                     END
      *
     C           KLVFIS    KLIST
     C                     KFLD           ISISTS           Item Status
      * Setup key
     C                     MOVEL#1ISTS    ISISTS           Item Status
     C           KLVFIS    CHAIN@ISTSL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VFEXIT
     C                     END
      * Send message 'Print Item Status      NF'
     C                     MOVEL'CGD1551' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1551' W0RTN
      *================================================================
     CSR         VFEXIT    ENDSR
      /EJECT
     CSR         VGCKRL    BEGSR
      *================================================================
      * Check reference to Print Item Type/Sub-Type
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1PTYP    IFEQ *BLANK                     Print Item Type
     C           #1PSTP    ANDEQ*BLANK                     Print Item Sub-
     C                     GOTO VGEXIT
     C                     END
      *
      * Check for selection
      *
     C           ' ?'      CHECK#1PTYP                   90
     C           *IN90     IFEQ '1'
     C           #1PSTP    ANDNE*BLANKS
     C           ' ?'      CHECK#1PSTP                   90
     C                     END
     C           *IN90     IFEQ '0'
     C           #1PTYP    ANDNE*BLANKS
     C                     MOVEL*BLANKS   O3PARM
     C                     CALL 'CG1180'               9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM 'S'       O3ACTC  1        Action Code
     C                     PARM           O3PARM           B:RDE
      *
      * Analyse return code
      *
     C           *IN90     IFEQ '0'
     C           P@RTCD    ANDEQ*BLANKS
      * Record found
     C                     MOVELO3PTYP    #1PTYP
     C                     MOVELO3PSTP    #1PSTP
      *
      * Delay
      *
     C                     MOVEL'1'       *IN99
     C                     GOTO VGEXIT
     C                     END
      *
     C                     END
      *
      *
     C           KLVAIT    KLIST
     C                     KFLD           ITPTYP           Print Item Type
     C                     KFLD           ITPSTP           Print Item Sub-
      * Setup key
     C                     MOVEL#1PTYP    ITPTYP           Print Item Type
     C                     MOVEL#1PSTP    ITPSTP           Print Item Sub-
     C           KLVAIT    CHAIN@PTYPL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VGEXIT
     C                     END
      * Send message 'Print Item Type/Sub-Ty NF'
     C                     MOVEL'CGD1357' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1357' W0RTN
      *================================================================
      *================================================================
     CSR         VGEXIT    ENDSR
      /EJECT
     CSR         VHCKRL    BEGSR
      *================================================================
      * Check reference to Midas Languages codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1LGID    IFEQ *BLANK                     Language identi
     C                     GOTO VHEXIT
     C                     END
      * Setup key
     C                     MOVEL#1LGID    P@LGID           Language identi
      *
      *  Call to access pgm for Counterparty Nostro Details
      *
     C                     CALL 'AOLANGR0'             9090
     C                     PARM *BLANKS   P@RTCD           B:Return code
     C                     PARM '*KEY'    P@OPTN           I:Option
     C                     PARM           P@LGID  2        I:Key field
     C           SDLANG    PARM *BLANKS   DSSDY
      *
     C           *IN90     IFEQ '1'
     C                     MOVEL'AOLANGR0'W0FILE           ***************
     C                     MOVEL'*CALL'   W0KEY            * DB ERROR 04 *
     C                     Z-ADD4         W0ERNB           ***************
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           P@RTCD    IFEQ *BLANKS
      * Record found - move back any virtuals
     C                     MOVELSCUNT     #1LGID           Language identi
     C                     GOTO VHEXIT
     C                     END
      *
      * Send message 'Midas Languages co NF'
     C                     MOVEL'CGD1280' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1280' W0RTN
      *================================================================
     CSR         VHEXIT    ENDSR
      /EJECT
     CSR         VICKRL    BEGSR
      *================================================================
      * Check reference to Mail Shot Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * If all low order keys not entered, exit
     C           #1MSHT    IFEQ *BLANK                     Mail Shot Ident
     C                     GOTO VIEXIT
     C                     END
      *
     C           KLVIMS    KLIST
     C                     KFLD           MSMSHT           Mail Shot Ident
      * Setup key
     C                     MOVEL#1MSHT    MSMSHT           Mail Shot Ident
     C           KLVIMS    CHAIN@MSHTL1              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VIEXIT
     C                     END
      * Send message 'Mail Shot Details      NF'
     C                     MOVEL'CGD1553' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'CGD1553' W0RTN
      *================================================================
     CSR         VIEXIT    ENDSR
      /EJECT                                                              095461
     CSR         VJCKRL    BEGSR                                          095461
      *================================================================   095461
      * Check reference to Print Item Status                              095461
      *================================================================   095461
     C                     MOVEL*BLANK    W0RTN   7                       095461
      * If all low order keys not entered, exit                           095461
     C           #1CTYP    IFEQ *BLANK                     Item Status    095461
     C                     GOTO VJEXIT                                    095461
     C                     END                                            095461
      *                                                                   095461
      * Check for selection                                               095461
     C           ' ?'      CHECK#1CTYP                   90               095461
     C           *IN90     IFEQ '0'                                       095461
     C           #1CTYP    ANDNE*BLANKS                                   095461
     C                     MOVEL*BLANKS   O4PARM                          095461
     C                     CALL 'CG0040'               9090               095461
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  095461
     C                     PARM 'S'       P@ACTC  1        Action Code    095461
     C                     PARM           O4PARM                          095461
      *                                                                   095461
      * Analyse return code                                               095461
      *                                                                   095461
     C           *IN90     IFEQ '0'                                       095461
     C           P@RTCD    ANDEQ*BLANKS                                   095461
      * Record found                                                      095461
     C                     MOVELO4CTYP    #1CTYP                          095461
      *                                                                   095461
      * Delay                                                             095461
     C                     MOVEL'1'       *IN99                           095461
     C                     GOTO VJEXIT                                    095461
     C                     END                                            095461
      *                                                                   095461
     C                     END                                            095461
      *                                                                   095461
     C           KLVJCT    KLIST                                          095461
     C                     KFLD           CTCTYP           Correspondent t095461
      * Setup key                                                         095461
     C                     MOVEL#1CTYP    CTCTYP           Correspondent t095461
     C           KLVJCT    CHAIN@CTYPL1              9091  *              095461
     C           *IN90     IFEQ '0'                                       095461
      * Record found - move back any virtuals                             095461
     C                     GOTO VJEXIT                                    095461
     C                     END                                            095461
      * Send message 'Correspondent Type     NF'                          095461
     C                     MOVEL'CGD1279' ZAMSID                          095461
     C                     EXSR ZASNMS                                    095461
     C                     MOVEL'CGD1279' W0RTN                           095461
      *================================================================   095461
     CSR         VJEXIT    ENDSR                                          095461
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
      * USER: Exit program processing
      *
      * CASE: CTL.*CMD key is CF03
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     END                             *FI
      * CASE: CTL.*CMD key is CF12
     C           *IN12     IFEQ '1'                        *IF
     C                     MOVEL'USR0790' P0RTN            *Return code
     C                     END                             *FI
      * PMTRCD: Exit program - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates Exit Program Processing
     C/COPY WNCPYSRC,CG5020DEPP
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Copy any undisplayed messages back to caller
     C                     CALL 'Y2CPMSC'
     C                     PARM           ##PGM
      *
      * Exit program
     C                     SETON                     LR
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Initialise indicators for re-entry
     C                     MOVE '0'       *IN
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C                     MOVEL'CGUSRMSG'ZADFMF 10
     C                     MOVEL'N'       W0PMT   1
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Retrieve Midas Date - R10 Standard Functions  *
     C*
     C*  Set up copyright parameter
     C*
     C                     MOVEACPY@      ACT@   80
     C*
     C* Get Rundate - Rundate  *
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    ##MRDT  7        Midas Run date
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
      *
     C           AGMBIN    IFEQ 'Y'
     C                     MOVE *ON       *IN71
     C                     ENDIF
     C*
     C* Get modules information
     C*
     C                     CALL 'AOMMODR0'             9090
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*FIRST ' P@OPTN  7        I:Option
     C           MMODDS    PARM *BLANKS   DSFDY            O:Module Flg
      *
      *  If return with an error (LR seton in called program) then
      *  process for database error.
      *
     C           *IN90     IFEQ '1'
     C           P@RTCD    OREQ '*ERROR*'
     C                     MOVEL'AOMMODR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY            ***************
     C                     Z-ADD5         W0ERNB           * DB ERROR 05 *
     C                     MOVEL'MEM5003' W0MSGD           ***************
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Option Name
     C                     CALL 'CGC1000'              9090
     C                     PARM 'CGD1496' #MSGID
     C                     PARM 'CGUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    ##ONKY
      *
      ** Command keys
     C                     CALL 'CGC1000'              9090
     C                     PARM 'CGD1507' #MSGID
     C                     PARM 'CGUSRMSG'#MSGF
     C                     PARM           #MSDTA
     C                     PARM *BLANKS   #MSTX1
     C                     PARM *BLANKS   #MSTX2
      *
     C                     MOVEL#MSTX1    ##CMD2
      *
      ** Set up variables
     C                     Z-ADD*ZERO     YAFSCH  40
     C*
      * PMTRCD: Initialise prog. - R10 Copy source templates  *
     C*PMTRCD: Cpysrc Templates Initialise Program C-Spec
      /COPY WNCPYSRC,CG5020DCPG
      *================================================================
     CSR         ZZEXIT    ENDSR
      *
      **  File and Program Error Processing
      /COPY CGCPYSRC,SRERRC
      *
      ** PSSR Processing
      /COPY CGCPYSRC,SRERRPSSR
     O*PMTRCD: Cpysrc Templates Initialise Program O-Spec
      /COPY WNCPYSRC,CG5020DOPG
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** MOD - Modules which produce correspondence
DL
LE
FT
FF
GL
SE
RE
PB                                                                        CCG009
