      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CG Audit Letter - Extract')                      *
      *****************************************************************
      *                                                               *
      *  Midas - User Defined Correspondence                          *
      *                                                               *
      *  CG7120 - CG Audit Letter Summary Extract                     *
      *                                                               *
      *  Function: This program creates the Audit letter summary      *
      *            Extracts.                                          *
      *                                                               *
      *  (c) Finastra International Limited 2008                      *
      *                                                               *
      *  Last Amend No. AR1031825A         Date 09Jan13               *
      *  Prev Amend No. MD048750           Date 27Mar18               *
      *                 CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CER070             Date 25Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR822053           Date 29Aug11               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23826A          Date 28May09               *
      *                 BUG24025           Date 18May09               *
      *                 BUG23826           Date 01May09               *
      *                 BUG23512A          Date 24Apr09               *
      *                 BUG23250B          Date 15Apr09               *
      *                 BUG23510A          Date 15Apr09               *
      *                 BUG23510           Date 31Mar09               *
      *                 BUG23586           Date 31Mar09               *
      *                 BUG23512           Date 27Mar09               *
      *                 BUG23508A          Date 27Mar09               *
      *                 BUG23509           Date 23Mar09               *
      *                 BUG23504           Date 23Mar09               *
      *                 BUG23508           Date 23Mar09               *
      *                 BUG23507           Date 20Mar09               *
      *                 BUG23000           Date 26Feb09               *
      *                 BUG22741           Date 18Feb09               *
      *                 CER041  *CREATE    Date 19May08               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR1031825A - Audit Letters are showing future-valued Customer*
      *               Loans. Use VDAT as start date, which should be  *
      *               LE Rundate. (Child: AR1031826)                  *
      *  MD048750 - Add extract of IBAN.                              *
      *           - Applied for MD-50185.                             *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR822053 - Incorrect value of Effective Annual Interest Rate *
      *             in CGUXMLPD                                       *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate                                                *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23826A - Correspondence should not produce when Zero Conf *
      *              is 'N' and transaction is not present for module *
      *  BUG24025 - SIRS Program is incorrectly populating the        *
      *             NxtInterestPayment Field                          *
      *  BUG23826 - Suppressed the Zero conf processing for [RE, LE,  *
      *             MM, and FR] when Zero Conf flag is set to Y       *
      *  BUG23512A - Audit Letter does not follow the BRD Header Rules*
      *  BUG23250B - Add processing for LO FA, RE when ZCNF is 'Y'    *
      *  BUG23510A - Populate Interest Payment frequency              *
      *  BUG23510 - Populate New RDE's for IRS Deal                   *
      *  BUG23586 - Produce Audit Letter when Zero Confirmation = 'Y' *
      *  BUG23512 - Populate New RDE's for Customer information       *
      *  BUG23508A - Interest Calculation Basis RDE missing           *
      *  BUG23509 - Populate New RDE's for FRA Deal                   *
      *  BUG23504 - Populate 3 new RDE's for MM deal                  *
      *  BUG23508 - Populate New RDE's for Loan Deal                  *
      *  BUG23507 - Change RDE's name as per the in the file CGRDECPD *
      *  BUG23000 - Populate the loan type/subtype description        *
      *  BUG22741 - Populate Telex Number, when STTX Address is blank *
      *             in SDCUSTPD                                       *
      *  CER041 - Audit Letters Correspondence                        *
      *           (Upgrade of FGE132 and FGE171)                      *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  Indicator usage                                              *
      *  ===============                                              *
      *                                                               *
      *  80   -    GLACNTL8                                           *
      *  81   -    DLDEALLB                                           *
      *  82   -    LELOANLF                                           *
      *  83   -    DLDEALL8                                           *
      *  84   -    LEFCLTLT                                           *
      *                                                               *
      *****************************************************************
      *
     FGLACNTL8IF  E           K        DISK
      *
      ** GL Acc. Master - live file
      *
     FDLDEALLBIF  E           K        DISK
      *
      ** Money Market details by Cust # and Branch code
      *
     FDLDEALL8IF  E           K        DISK
      *
      ** FX Deals by Cust and Branch code
      *
     FLELOANLFIF  E           K        DISK
      *
      ** LE Cust. Loan by Cust and Branch file
      *
     FLEFCLTLTIF  E           K        DISK
      *
      ** Faclility details by Cust # and Branch code
      *
     FCGCORRL4IF  E           K        DISK
      *
      ** Correspondent file by customer number
      *
     FHISTR   IF  E           K        DISK
     F            HISTSHPF                          KIGNORE
     F            HISTSHQF                          KIGNORE
      *
      ** Midas LE History file R/A
      *
     FDLDEALLCIF  E           K        DISK
      *
      ** Forward Rate Agrmt/Int Rate Swaps by Cust & Branch
      *
     FSECDEPL8IF  E           K        DISK
      *
      ** Client Depot Positions - Detail
      *
     FFFTRNSL0IF  E           K        DISK
      *
      ** Transaction Details by Cust and Branch
      *
      *****************************************************************
     F/EJECT
      *****************************************************************
     E/COPY CGCPYSRC,CGPACKE
     E/COPY CGCPYSRC,SRERRE
     E                    ##W        20  1
     E                    ##NUMA     29  1
      *
      ** Number Arrays
      *
     E                    ##CY      100  3
      *
      ** Array of Currencies accessed by program
      *
     E                    ##CPY   1   1 80
      *
      ** Copyright array.
      *
      *****************************************************************
     E/EJECT
      *****************************************************************
     IHISTSHMF
     I              CCY                             CCYXX
     I              CPAM                            CPAMXX
      *
      ** Look-up string for RDE definition Array
      *
     I##SDS       DS
     I                                        15632 ##S
      *
     I#@SDS       DS
     I                                     51205120 #@S
      *
      ** Packed data string.
      *
     I            DS
     I                                        1  20 ##W
     I                                        1  200##WNUM
      *
      ** Number Field
      *
     I            DS
     I                                        1   8 ##ITMA
     I                                        1   80##ITEM
      *
      ** Used to convert item reference from character to numeric
      *
     I            DS
     I                                        1   6 ##NCIT
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I            DS
     I                                        1   5 ##CCCC
     I                                        1   3 ##CCY
     I                                        4   5 ##CCD
      *
      ** For error reporting
      *
     I              'BRANCH NAME'         C         BRNAME
     I              'AUDITLET  '          C         W#PTYP
     I              'LOAN      '          C         W#PST1
     I              'FACILITY  '          C         W#PST2
     I              'MONEYM    '          C         W#PST3
     I              'RETAIL    '          C         W#PST4
     I              'FOREIGN   '          C         W#PST5
     I              'FRA       '          C         W#PST6
     I              'IRS       '          C         W#PST7
     I              'SECURITIES'          C         W#PST8
     I              'FUTURES   '          C         W#PST9
      *
      ** Named constants
      *
     I##UDCR    E DSCGUDCRPD
      *
      ** External DS for Midas CG UDC data reference
      *
     ISDBANK    E DSSDBANKPD
      *
      ** External DS for Bank details
      *
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          QQACC1
      *
      ** External DS for General Ledger details
      *
     ISDMMOD    E DSSDMMODPD
      *
      ** External DS for Module details
      *
     ISDTRAD    E DSSDTRADPD
     I              QQACCD                          QQACC2
      *
      ** External DS for Trading Module details
      *
     ISDDEAL    E DSSDDEALPD
     I              QQACCD                          QQACC3
      *
      ** External DS for Dealing Module details
      *
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          QQACC4
      *
      ** External DS for Retail details
      *
     ISDMGME    E DSSDMGMEPD
      *
      ** External DS for Message Management details
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          QQDFA1
      *
      ** External DS for branch details
      *
     ISDCUST    E DSSDCUSTPD
      *
      ** External DS for customer details
      *
     ISDCURR    E DSSDCURRPD                101
      *
      ** External DS for currency details
      *
     IDSFDY     E DSDSFDY
      *
      ** First DS for access programs, short data structure
      *
     ISCSARD    E DSSCSARDPD
      *
      ** MIDAS Switchable Features Accessed Via Access Program
      *
     IDSSDY     E DSDSSDY
      *
      ** Second DS for access programs, long data structure
      *
     IW0FMT     E DSCGUDTAPD
      *
      ** Record format of PF/CGUDTAPD for use as a parameter
      *
     IDSPARM    E DSCGAUHDL1
      *
      ** External DS for CG Audit Letters Header file
      *
     ISDACOF    E DSSDACOFPD
      *
      ** External DS for Account Officer details
      *
     ISDACUS    E DSSDACUSPD                                                                BUG22741
      *                                                                                     BUG22741
      **  External DS for Additinal Customer details                                        BUG22741
      *                                                                                     BUG22741
     ISDLOAN    E DSSDLOANPD                                                                BUG23000
      *                                                                                     BUG23000
      ** External DS For LOAN Details                                                       BUG23000
      *                                                                                     BUG23000
     ISDBSRT    E DSSDBSRTPD                                                                BUG23509
      *                                                                                     BUG23509
      **  External DS for base rate details                                                 BUG23509
      *                                                                                     BUG23509
     I/COPY CGCPYSRC,CGPACKI
      *
     ICPYR        DS
      *
      ** Data Structure for Compilation - Copyright Insertion
      *
     I                                        1  80 ##CPY
     I/COPY CGCPYSRC,SRERRI
      *
      ** DS to store subroutine specific data.
      ** - Saved Path
      *
     I##PATH      DS                         20
     I                                        1   6 ##GRPS
      *
     I##BIND      DS                         20
     I I            1                         1   60##PBIN
     I I            1                         7  120##TBIN
      *
     I            DS
     I I            1                         1   60#@BIND
      *
     I#PDS        DS
     I I            0                         1   30P1
     I                                        4   60P2
     I                                        7   90P3
     I                                       10  120P4
     I                                       13  150P5
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Process     :  MAINLINE                                      *
      *  Function    :  Mainline processing                           *
      *                                                               *
      *  Called by   :  None                                          *
      *  Calls       :  SRINIT - Initial Processing - On First Call   *
      *                 SRINZ  - Initialise Fields on Each Invocation *
      *                 SRMAIN - Main Processing                      *
      *****************************************************************
      *
      ** Parameter list for current program invocation.
      *
     C           *ENTRY    PLIST
     C                     PARM           W0RTN
     C                     PARM           W0CMT   3
     C                     PARM           ##COPD  1
     C                     PARM           DSPARM
     C                     PARM           UFITEM  8
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      ** Initial processing - Once Only
      *
     C**********           MOVELFCUST     WFCUST  60                                          CER059
     C                     MOVELFCUST     WFCUST  6                                           CER059
     C           ##INIT    IFEQ *BLANK
     C                     EXSR SRINIT
     C                     MOVE 'Y'       ##INIT  1
     C                     ENDIF
      *
      ** Initialisation processing
      *
     C                     EXSR SRINZ
      *
      ** Main processing
      *
     C           FMODP     IFNE 'N'                                                        BUG23826A
     C                     EXSR SRMAIN
     C                     ENDIF                                                           BUG23826A
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      ** Terminate program
      *
     C                     SETON                         LR                                BUG23250B
     C                     RETRN
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRMAIN                                        *
      *  Function    :  Main processing                               *
      *                                                               *
      *  Called by   :  Mainline                                      *
      *  Calls       :                                                *
      *****************************************************************
     C           SRMAIN    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRMAIN'  @STK,Q
      *
      ** Generate reference number by writing to PF/CGUDCRPD
      ** If no confirmation to be produced, then bypass
      *
     C                     MOVE 'N'       ##COPD
     C                     EXSR SRGENR
     C           ##COPD    CABEQ'N'       EXMAIN
      *
      ** Extract
      *
     C                     EXSR ZFS132
      *
     C           EXMAIN    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  ZFS132                                        *
      *  Function    :  Process: Audit Letter                         *
      *                                                               *
      *  Called by   :  SRMAIN - main control subroutine              *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 CUST   - customer information                 *
      *                 SRACOF - Account officer details              *
      *                 BRANCH - Account officer details              *
      *                 ZFGE19 - Bank details BLZ/FAX                 *
      *                 Z132LO - Loan Controller subroutine           *
      *                 Z132FA - Facility Controller subroutine       *
      *                 Z132RE - Retail Controller subroutine         *
      *                 Z132MM - Money Market Controller subroutine   *
      *                 Z132FX - Foreign Exchange Controller subroutin*
      *                 Z132FR - FRA subroutine                       *
      *                 Z132IR - IRS subroutine                       *
      *                 Z132SE - Security deatail subroutine          *
      *                 Z132FF - For Future option subroutine         *
      *****************************************************************
     C           ZFS132    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'ZFS132'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'ZFS132'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
      ** Customer Details
      *
     C**********           EXSR CUST                                                       BUG23512A
     C                     EXSR CUSTE                                                      BUG23512A
      *
      ** Account Officer Details
      *
     C                     EXSR SRACOF
      *
      ** Branch Details
      *
     C                     EXSR BRANCH
      *
      ** Additional Address Details
      *
     C                     EXSR CGBRCH
      *
      ** Loan Controller
      *
     C           FMOID     IFEQ 'LO'
     C                     EXSR Z132LO
     C                     ENDIF
      *
      ** Facility Controller
      *
     C           FMOID     IFEQ 'FA'
     C                     EXSR Z132FA
     C                     ENDIF
      *
      ** Retail Controller
      *
     C           FMOID     IFEQ 'RE'
     C                     EXSR Z132RE
     C                     ENDIF
      *
      ** Money Market Controller
      *
     C           FMOID     IFEQ 'MM'
     C                     EXSR Z132MM
     C                     ENDIF
      *
      ** Zero-Confirmations are now created for more
      ** modules than only FX. The information whether zero-conf. is to
      ** be created is in field FZERO (value "Y") in file CGAUHDPD.
      *
      ** Foreign Exchange Controller
      *
     C           FMOID     IFEQ 'FX'
     C                     EXSR Z132FX
     C                     ENDIF
      *
      ** FRA Controller
      *
     C           FMOID     IFEQ 'FR'
     C                     EXSR Z132FR
     C                     ENDIF
      *
      ** Interest Rate controller
      *
     C           FMOID     IFEQ 'IR'
     C                     EXSR Z132IR
     C                     ENDIF
      *
      ** Security controller
      *
     C           FMOID     IFEQ 'SE'
     C                     EXSR Z132SE
     C                     ENDIF
      *
      ** For Future Option
      *
     C           FMOID     IFEQ 'FF'
     C                     EXSR Z132FF
     C                     ENDIF
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132RE                                        *
      *  Function    :  Process: Repeater for Retail                  *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D3 - Retail Details Extract               *
      *****************************************************************
     C           Z132RE    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132RE'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132RE'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLGLACNTL8
     C           KEY01     READEGLACNTL8                 80
     C                     ELSE
     C           WFCUST    SETLLGLACNTL8
     C           WFCUST    READEGLACNTL8                 80
     C                     ENDIF
      *                                                                                     BUG23586
     C           *IN80     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN80     DOWEQ'0'
      *
     C           ATYP      IFEQ 'R'
     C                     EXSR Z132D3
     C                     END
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEGLACNTL8                 80
     C                     ELSE
     C           WFCUST    READEGLACNTL8                 80
     C                     ENDIF
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Procesing                                                        BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C                     EXSR Z132D3                                                      BUG23586
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D3                                        *
      *  Function    :  Process: Retail Information                   *
      *                                                               *
      *  Called by   : Z132RE                                         *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRADTA - Format extract data                  *
      *                 SRODTA - Output extract data                  *
      *****************************************************************
     C           Z132D3    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D3'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D3'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     Z-ADD0         R1      30
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCCY       R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Ledger Balance
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'END_CLR '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
      *
     C           STFQ      IFEQ 'E'
     C                     MOVELLDBL      ##DATA
      *
      ** Forword statement balance
      *
     C                     ELSE
     C                     MOVELCFSB      ##DATA
     C                     END
      *
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELCCY       ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Retail Account Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'O '      #@RDE
     C                     MOVEL'RETL_ACN'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELACNO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Statement Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'STMT_NUM'#@RDE
     C                     MOVE 'BR'      #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           STFQ      IFNE 'E'
     C                     MOVELLSTP      ##DATA
     C                     ELSE
     C                     MOVELEPNO      ##DATA
     C                     END
      *
     C                     MOVEL'Number'  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch Name
      *
     C           BRCA      IFNE *BLANKS                                                    BUG23250B
     C                     MOVE BRCA      BCODE
     C                     ENDIF                                                           BUG23250B
     C                     EXSR SRBRNM
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVELBRNAME    #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** IBAN                                                                              MD048750
      *                                                                                    MD048750
     C                     ADD  1         R1                                               MD048750
     C                     CLEARR#DATA                                                     MD048750
     C                     CLEARR#DEFN                                                     MD048750
     C                     CLEAR#@RDE                                                      MD048750
     C                     MOVEL'IBAN'    #@RDE                                            MD048750
     C           ##RDE     CAT  #@RDE:1   ##RDE                                            MD048750
     C                     MOVELIBAN      R#DATA                                           MD048750
     C                     MOVELR#DATA    ##D,R1                                           MD048750
     C                     MOVELR#DEFN    ##R,R1                                           MD048750
      *                                                                                    MD048750
     C                     EXSR SRADTA
     C                     EXSR SRODTA
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132MM                                        *
      *  Function    :  Process: Repeater for MM                      *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D4 - Retail Details Extract               *
      *****************************************************************
      *
     C           Z132MM    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132MM'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132MM'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ***Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'MM'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D4                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLDLDEALLB
     C           KEY01     READEDLDEALLB                 81
     C                     ELSE
     C           WFCUST    SETLLDLDEALLB
     C           WFCUST    READEDLDEALLB                 81
     C                     ENDIF
      *
     C           *IN81     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN81     DOWEQ'0'
      *
     C                     EXSR Z132D4
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEDLDEALLB                 81
     C                     ELSE
     C           WFCUST    READEDLDEALLB                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C********** FZERO     IFEQ 'Y'                                                BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     EXSR Z132D4                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D4                                        *
      *  Function    :  Process: Money Market Informat                *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           Z132D4    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D4'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D4'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCCY       R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL TYP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDTYP      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'ER'      #@RDE
     C                     MOVEL'DEALNUMB'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLNO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Sub Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'YP'      #@RDE
     C                     MOVEL'DEALSUBT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLST      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'INT RATE'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELINTR      ##DATA
     C                     MOVEL'Rate  '  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVEL'7'       ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Maturity Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'MATUR DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELMDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Principal
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'L '      #@RDE
     C                     MOVEL'PRINCIPA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELPCPL      ##DATA
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELCCY       ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Value Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'VALUE DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELVDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch name
      *
     C           BRCA      IFNE *BLANKS                                                    BUG23250B
     C                     MOVE BRCA      BCODE
     C                     ENDIF                                                           BUG23250B
     C                     EXSR SRBRNM
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVELBRNAME    #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELFZERO     R#DATA                                            BUG23826
     C                     MOVELFZCNF     R#DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *                                                                                     BUG23504
      ** Interest Calculation Method                                                        BUG23504
      *                                                                                     BUG23504
     C                     ADD  1         R1                                                BUG23504
     C                     CLEARR#DATA                                                      BUG23504
     C                     CLEARR#DEFN                                                      BUG23504
     C                     CLEAR#@RDE                                                       BUG23504
     C                     MOVE 'BAS'     #@RDE                                             BUG23504
     C                     MOVEL'INT CAL' #@RDE                                             BUG23504
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23504
     C                     MOVELICBS      R#DATA                                            BUG23504
     C                     MOVELR#DATA    ##D,R1                                            BUG23504
     C                     MOVELR#DEFN    ##R,R1                                            BUG23504
      *                                                                                     BUG23504
      ** Interest Payment Frequency                                                         BUG23504
      *                                                                                     BUG23504
     C                     ADD  1         R1                                                BUG23504
     C                     CLEARR#DATA                                                      BUG23504
     C                     CLEARR#DEFN                                                      BUG23504
     C                     CLEAR#@RDE                                                       BUG23504
     C                     MOVE 'Q  '     #@RDE                                             BUG23504
     C                     MOVEL'INT FRE' #@RDE                                             BUG23504
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23504
     C                     MOVELIPFR      R#DATA                                            BUG23504
     C                     MOVELR#DATA    ##D,R1                                            BUG23504
     C                     MOVELR#DEFN    ##R,R1                                            BUG23504
      *                                                                                     BUG23504
      ** Next Interest Payment Date                                                         BUG23504
      *                                                                                     BUG23504
     C                     ADD  1         R1                                                BUG23504
     C                     CLEARR#DATA                                                      BUG23504
     C                     CLEARR#DEFN                                                      BUG23504
     C                     CLEAR#@RDE                                                       BUG23504
     C                     MOVE 'ATE'     #@RDE                                             BUG23504
     C                     MOVEL'NXT IPD' #@RDE                                             BUG23504
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23504
     C                     MOVELNIDT      R#DATA                                            BUG23504
     C                     MOVEL'Date  '  ##RDEC                                            BUG23504
     C                     MOVELR#DATA    ##D,R1                                            BUG23504
     C                     MOVELR#DEFN    ##R,R1                                            BUG23504
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132LO                                        *
      *  Function    :  Process: Repeater for loans                   *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D1 - Loan   Details Extract               *
      *****************************************************************
      *
     C           Z132LO    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132LO'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132LO'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLLELOANLF
     C           KEY01     READELELOANLF                 82
     C                     ELSE
     C           WFCUST    SETLLLELOANLF
     C           WFCUST    READELELOANLF                 82
     C                     ENDIF
      *                                                                                     BUG23586
     C           *IN82     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN82     DOWEQ'0'
      *
     C           VDAT      IFLE BJRDNB                                                    AR1031825A
     C                     EXSR Z132D1
     C                     ENDIF                                                          AR1031825A
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READELELOANLF                 82
     C                     ELSE
     C           WFCUST    READELELOANLF                 82
     C                     ENDIF
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C           VDAT      IFLE BJRDNB                                                    AR1031825A
     C                     EXSR Z132D1                                                      BUG23586
     C                     ENDIF                                                          AR1031825A
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D1                                        *
      *  Function    :  Process: Loan information                     *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           Z132D1    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D1'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D1'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     Z-ADD0         R1      30
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCCY       R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'INT RATE'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELINTR      ##DATA
     C                     MOVEL'Rate  '  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVEL'7'       ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Loan Reference
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'LOAN REF'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELLNRF      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Maturity Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'MATUR DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELMDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Principal
      *
     C           KEY02     SETLLHISTSHMF
     C           KEY02     READEHISTSHMF                 85
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'L '      #@RDE
     C                     MOVEL'PRINCIPA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELPRAM      ##DATA
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELCCYXX     ##CCY
     C                     EXSR SRDCDT
      *
      ** If CCYXX is 'IN' currency and CCYXX <> CCY - check CCY (from
      ** LELOANLF) and if it exist, move CCY to ##CCY. In this case
      ** also covert PRAM to EURO.
      *
     C           CCYXX     IFNE CCY
     C           CCY       ANDEQ'EUR'
     C           A6INCY    ANDEQ'Y'
     C                     MOVELCCY       ##CCY
     C                     EXSR SRDCDT
      *
     C                     Z-ADDPRAM      P@FRAM
     C                     CALL 'EU0200'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM           P@FRAM 183
     C                     PARM           CCYXX
     C                     PARM 'EUR'     P@TOCY  3
     C                     PARM *ZERO     P@OUTA 150
     C                     PARM           P@INTA 183
     C                     PARM           P@EXRT 159
     C                     PARM           P@MDIN  1
      *
      ** Database error handling:
      *
     C           P@RTCD    IFEQ '*ERROR*'
     C                     MOVEL'EU0200  'W0FILE
     C                     MOVEL'*CALL   'W0KEY
     C                     Z-ADD30        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
      *
      ** Otherwise, store amount in settlement currency as ##OUTA
      *
     C                     ELSE
     C                     MOVELP@OUTA    ##DATA
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Start date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'START_DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELVDAT      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Loan Type/Subtype
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZLTYP  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVE SUTP      #LTYP   4
     C                     MOVELLTYP      #LTYP
     C                     MOVEL#LTYP     R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Outstanding Amount
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C**********           MOVE 'T '      #@RDE                                             BUG23508
     C**********           MOVEL'ZZOSTDAM'#@RDE                                             BUG23508
     C                     MOVEL'OSTDAMT '#@RDE                                             BUG23508
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCPAM      ##DATA
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
      *
      ** Due to conversion, in historic file are always 'old' currency
      ** and in the file LELOANLF is the 'new - EUR' currency. From
      ** this reason was renamed the currency in the file HISTR to
      ** CCYXX and in this place compare with CCY (from other files).
      ** If CCYXX <> CCY and CCY is 'IN' currenccy, move CCY to output
      ** file.
      *
     C           CCYXX     IFNE CCY
     C                     MOVELCCY       ##CCY
     C                     ELSE
     C                     MOVELCCYXX     ##CCY
     C                     ENDIF
      *
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch name
      *
     C           BRCA      IFNE *BLANKS                                                    BUG23250B
     C                     MOVE BRCA      BCODE
     C                     ENDIF                                                           BUG23250B
     C                     EXSR SRBRNM
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVELBRNAME    #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Loan processing type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'LOAN PRO'#@RDE
     C                     MOVE 'TP'      #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELPTYP      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Access processing code for loan type/sub-type Description                          BUG23000
      *                                                                                     BUG23000
     C           LTYP      IFNE *BLANKS                                                    BUG23250B
     C           SUTP      ANDNE*BLANKS                                                    BUG23250B
     C           CLAS      ANDNE*BLANKS                                                    BUG23250B
      *                                                                                    BUG23250B
     C                     CLEARSDLOAN                                                     BUG23250B
      *                                                                                    BUG23250B
     C                     CALL 'AOLOANR0'                                                  BUG23000
     C                     PARM '*BLANKS' ##RTCD                                            BUG23000
     C                     PARM '*KEY   ' ##OPTN                                            BUG23000
     C                     PARM           LTYP                                              BUG23000
     C                     PARM           SUTP                                              BUG23000
     C                     PARM           CLAS                                              BUG23000
     C           SDLOAN    PARM SDLOAN    DSFDY                                             BUG23000
      *                                                                                     BUG23000
      ** Perform database error processing if not found.                                    BUG23000
      *                                                                                     BUG23000
     C           ##RTCD    IFNE *BLANKS                                                     BUG23000
     C                     MOVEL'SDLOANPD'W0FILE                                            BUG23000
     C                     MOVELLTYP      W0KEY                                             BUG23000
     C                     MOVE SUTP      W0KEY                                             BUG23000
     C                     Z-ADD32        W0ERNB                                            BUG23000
     C                     MOVEL'MEM5004' W0MSGD                                            BUG23000
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23000
     C                     EXSR SRERR                                                       BUG23000
     C                     ENDIF                                                            BUG23000
      *                                                                                    BUG23250B
     C                     ENDIF                                                           BUG23250B
      *                                                                                     BUG23000
      ** CER038 - Loan Typ/Subtype Description                                              BUG23000
      *                                                                                     BUG23000
     C                     ADD  1         R1                                                BUG23000
     C                     CLEARR#DATA                                                      BUG23000
     C                     CLEARR#DEFN                                                      BUG23000
     C                     CLEAR#@RDE                                                       BUG23000
     C                     MOVEL'ZZLTPD  '#@RDE                                             BUG23000
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23000
     C                     MOVELAYLNTD    R#DATA                                            BUG23000
     C                     MOVELR#DATA    ##D,R1                                            BUG23000
     C                     MOVELR#DEFN    ##R,R1                                            BUG23000
      *                                                                                     BUG23508
      ** Interest Calculation Method                                                        BUG23508
      *                                                                                     BUG23508
     C                     ADD  1         R1                                                BUG23508
     C                     CLEARR#DATA                                                      BUG23508
     C                     CLEARR#DEFN                                                      BUG23508
     C                     CLEAR#@RDE                                                       BUG23508
     C**********           MOVE 'AS '     #@RDE                                   BUG23508 BUG23508A
     C                     MOVE 'AS'      #@RDE                                            BUG23508A
     C                     MOVEL'INT CALB'#@RDE                                             BUG23508
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23508
     C                     MOVELICBS      R#DATA                                            BUG23508
     C                     MOVELR#DATA    ##D,R1                                            BUG23508
     C                     MOVELR#DEFN    ##R,R1                                            BUG23508
      *                                                                                     BUG23508
      ** Interest Payment Frequency                                                         BUG23508
      *                                                                                     BUG23508
     C                     ADD  1         R1                                                BUG23508
     C                     CLEARR#DATA                                                      BUG23508
     C                     CLEARR#DEFN                                                      BUG23508
     C                     CLEAR#@RDE                                                       BUG23508
     C                     MOVEL'INT FREQ'#@RDE                                             BUG23508
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23508
     C                     MOVELIPFR      R#DATA                                            BUG23508
     C                     MOVELR#DATA    ##D,R1                                            BUG23508
     C                     MOVELR#DEFN    ##R,R1                                            BUG23508
      *                                                                                     BUG23508
      ** Next Interest Payment Date                                                         BUG23508
      *                                                                                     BUG23508
     C                     ADD  1         R1                                                BUG23508
     C                     CLEARR#DATA                                                      BUG23508
     C                     CLEARR#DEFN                                                      BUG23508
     C                     CLEAR#@RDE                                                       BUG23508
     C                     MOVE 'TE'      #@RDE                                             BUG23508
     C                     MOVEL'NXT IPDA'#@RDE                                             BUG23508
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23508
     C                     MOVELNIDT      R#DATA                                            BUG23508
     C                     MOVEL'Date  '  ##RDEC                                            BUG23508
     C                     MOVELR#DATA    ##D,R1                                            BUG23508
     C                     MOVELR#DEFN    ##R,R1                                            BUG23508
      *
     C           CLE143    IFEQ 'Y'                                                           CLE143
      *                                                                                       CLE143
      ** Original Contract Date                                                               CLE143
      *                                                                                       CLE143
     C                     ADD  1         R1                                                  CLE143
     C                     CLEARR#DATA                                                        CLE143
     C                     CLEARR#DEFN                                                        CLE143
     C                     CLEAR#@RDE                                                         CLE143
     C                     MOVEL'ORIGCDAT'#@RDE                                               CLE143
     C           ##RDE     CAT  #@RDE:1   ##RDE                                               CLE143
     C                     MOVELOCDT      ##DATA                                              CLE143
     C                     MOVEL'Date  '  ##RDEC                                              CLE143
     C                     MOVELR#DATA    ##D,R1                                              CLE143
     C                     MOVELR#DEFN    ##R,R1                                              CLE143
      *                                                                                       CLE143
      ** Effective Annual Interest Rate                                                       CLE143
      *                                                                                       CLE143
     C                     ADD  1         R1                                                  CLE143
     C                     CLEARR#DATA                                                        CLE143
     C                     CLEARR#DEFN                                                        CLE143
     C                     CLEAR#@RDE                                                         CLE143
     C                     MOVEL'EFFAINTR'#@RDE                                               CLE143
     C           ##RDE     CAT  #@RDE:1   ##RDE                                               CLE143
     C                     MOVELEAIR      ##DATA                                              CLE143
     C                     MOVEL'Rate  '  ##RDEC                                              CLE143
     C                     MOVEL'L'       ##RDET                                              CLE143
     C**********           MOVEL'7'       ##DCPA                                     CLE143 AR822053
     C                     MOVEL'8'       ##DCPA                                            AR822053
     C                     MOVELR#DATA    ##D,R1                                              CLE143
     C                     MOVELR#DEFN    ##R,R1                                              CLE143
      *                                                                                       CLE143
      ** CLE143 Switchable Feature status RDE                                                 CLE143
      *                                                                                       CLE143
     C                     ADD  1         R1                                                  CLE143
     C                     CLEARR#DATA                                                        CLE143
     C                     CLEARR#DEFN                                                        CLE143
     C                     CLEAR#@RDE                                                         CLE143
     C                     MOVEL'CLE143F '#@RDE                                               CLE143
     C           ##RDE     CAT  #@RDE:1   ##RDE                                               CLE143
     C                     MOVELCLE143    ##DATA                                              CLE143
     C                     MOVELR#DATA    ##D,R1                                              CLE143
     C                     MOVELR#DEFN    ##R,R1                                              CLE143
      *                                                                                       CLE143
     C                     ENDIF                                                              CLE143
      *                                                                                       CLE143
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132FX                                        *
      *  Function    :  Process: Repeater for FX                      *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D5 - FX Details Extract                   *
      *****************************************************************
      *
     C           Z132FX    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132FX'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132FX'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ** Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'FX'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D5                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLDLDEALL8
     C           KEY01     READEDLDEALL8                 83
     C                     ELSE
     C           WFCUST    SETLLDLDEALL8
     C           WFCUST    READEDLDEALL8                 83
     C                     ENDIF
      *
     C           *IN83     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN83     DOWEQ'0'
      *
     C                     EXSR Z132D5
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEDLDEALL8                 83
     C                     ELSE
     C           WFCUST    READEDLDEALL8                 83
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C                     MOVE 'Y'       FZCNF   1                                         BUG23826
      *                                                                                     BUG23826
     C                     ENDIF                                                            BUG23826
      *                                                                                     BUG23826
     C                     EXSR Z132D5                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132FR                                        *
      *  Function    :  Process: Repeater for FR                      *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D6 - Retail Details Extract               *
      *****************************************************************
     C           Z132FR    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132FR'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132FR'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ***Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'FR'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D6                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLDLDEALLC
     C           KEY01     READEDLDEALLC                 81
     C                     ELSE
     C           WFCUST    SETLLDLDEALLC
     C           WFCUST    READEDLDEALLC                 81
     C                     ENDIF
      *
     C           *IN81     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN81     DOWEQ'0'
      *
     C                     EXSR Z132D6
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEDLDEALLC                 81
     C                     ELSE
     C           WFCUST    READEDLDEALLC                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C********** FZERO     IFEQ 'Y'                                                BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     EXSR Z132D6                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132IR                                        *
      *  Function    :  Process: Repeater for IR                      *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D7 - Retail Details Extract               *
      *****************************************************************
     C           Z132IR    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132IR'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132IR'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ***Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'IR'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D7                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLDLDEALLC
     C           KEY01     READEDLDEALLC                 81
     C                     ELSE
     C           WFCUST    SETLLDLDEALLC
     C           WFCUST    READEDLDEALLC                 81
     C                     ENDIF
      *
     C           *IN81     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN81     DOWEQ'0'
      *
     C                     EXSR Z132D7
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEDLDEALLC                 81
     C                     ELSE
     C           WFCUST    READEDLDEALLC                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C                     MOVE 'Y'       FZCNF   1                                         BUG23826
      *                                                                                     BUG23826
     C                     ENDIF                                                            BUG23826
      *                                                                                     BUG23826
     C                     EXSR Z132D7                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132SE                                        *
      *  Function    :  Process: Repeater for Security                *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D8 - Retail Details Extract               *
      *****************************************************************
     C           Z132SE    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132SE'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132SE'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ***Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'SE'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D8                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLSECDEPL8
     C           KEY01     READESECDEPL8                 81
     C                     ELSE
     C           WFCUST    SETLLSECDEPL8
     C           WFCUST    READESECDEPL8                 81
     C                     ENDIF
      *
     C           *IN81     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN81     DOWEQ'0'
      *
     C                     EXSR Z132D8
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READESECDEPL8                 81
     C                     ELSE
     C           WFCUST    READESECDEPL8                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C                     MOVE 'Y'       FZCNF   1                                         BUG23826
      *                                                                                     BUG23826
     C                     ENDIF                                                            BUG23826
      *                                                                                     BUG23826
     C                     EXSR Z132D8                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132FF                                        *
      *  Function    :  Process: Repeater for FF(For Future Option)   *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D9 - Retail Details Extract               *
      *****************************************************************
     C           Z132FF    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132FF'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132FF'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *                                                                                     BUG23826
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ***Zero*Confirmation*Processing                                                       BUG23586
      *
     C********** FMOID     IFEQ 'FF'                                                        BUG23586
     C********** FZERO     ANDEQ'Y'                                                         BUG23586
      *
     C**********           EXSR Z132D9                                                      BUG23586
      *
     C**********           ELSE                                                             BUG23586
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLFFTRNSL0
     C           KEY01     READEFFTRNSL0                 81
     C                     ELSE
     C           WFCUST    SETLLFFTRNSL0
     C           WFCUST    READEFFTRNSL0                 81
     C                     ENDIF
      *
     C           *IN81     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN81     DOWEQ'0'
      *
     C                     EXSR Z132D9
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READEFFTRNSL0                 81
     C                     ELSE
     C           WFCUST    READEFFTRNSL0                 81
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23826
     C                     MOVE 'Y'       FZCNF   1                                         BUG23826
      *                                                                                     BUG23826
     C                     ENDIF                                                            BUG23826
      *                                                                                     BUG23826
     C                     EXSR Z132D9                                                      BUG23586
      *                                                                                     BUG23586
     C**********           ENDIF                                                   BUG23586 BUG23826
      *                                                                                     BUG23586
     C                     ENDIF
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D5                                        *
      *  Function    :  Process: FX Information                       *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
     C           Z132D5    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D5'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D5'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     Z-ADD0         R1      30
      *
      ** Get Base Currency
      *
     C                     CALL 'AODEALR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST ' ##OPTN
     C           SDDEAL    PARM SDDEAL    DSSDY
      *
      ** DATABASE ERROR
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDEALPD 'W0FILE
     C                     Z-ADD01        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Base Currency Equivalent
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BCEEVAM '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELBCEQ      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELBNCYDL    ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELBRCA      R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELDDAT      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL TYP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELDTYP      R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'ER'      #@RDE
     C                     MOVEL'DEALNUMB'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELDLNO      R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Exchange Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'EXCH RAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELEXRT      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Xrate '  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVEL'8'       ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Purchase Amount
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'NT'      #@RDE
     C                     MOVEL'PURCH AM'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELPUAM      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELPUCY      ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Purchase Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'Y '      #@RDE
     C                     MOVEL'PURCH CC'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELPUCY      R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Sale Amount
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'T '      #@RDE
     C                     MOVEL'SALE AMN'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELSLAM      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELSLCY      ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Sale Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'SALE CCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELSLCY      R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Value Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'VALUE DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELVDAT      ##DATA
     C                     ELSE
     C                     MOVEL*ZEROS    ##DATA
     C                     ENDIF
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch name
      *
     C           FMOID     IFEQ 'FX'
     C           BRCA      IFNE *BLANKS                                                    BUG23250B
     C                     MOVE BRCA      BCODE
     C                     ENDIF                                                           BUG23250B
     C                     EXSR SRBRNM
     C                     ENDIF
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVELBRNAME    #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C           FMOID     IFEQ 'FX'
     C                     MOVELA8BRNM    R#DATA
     C                     ELSE
     C                     MOVEL*BLANKS   R#DATA
     C                     ENDIF
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Nullbest{tigungen Flg
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
      *
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELFZERO     ##DATA                                            BUG23826
     C                     MOVELFZCNF     ##DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132D6                                        *
      *  Function    :  Process: FRA Detail                           *
      *                                                               *
      *  Called by   :  Z132FR                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           Z132D6    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D6'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D6'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CUSTOMER'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCNUM      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUCUCY     R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDDAT      R#DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Transaction Reference
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'TRAN_REF'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLNO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Maturity Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'MATUR DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELMDAT      R#DATA
     C                     MOVEL'Date    '##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Principal
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'L '      #@RDE
     C                     MOVEL'PRINCIPA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUPAMT     R#DATA
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELCCY       ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Start Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'START_DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELVDAT      R#DATA
     C                     MOVEL'Date    '##RDEC                                            BUG23509
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL TYP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDTYP      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Sub Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'YP'      #@RDE
     C                     MOVEL'DEALSUBT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLST      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'INT RATE'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUEINR     ##DATA
     C                     MOVEL'Rate  '  ##RDEC                                            BUG23509
     C                     MOVEL'L'       ##RDET                                            BUG23509
     C                     MOVEL'7'       ##DCPA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate Calculation Method / Interest Calculation Basis
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'AS'      #@RDE
     C                     MOVEL'INT CALB'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUICBS     ##DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Ceiling Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'T '      #@RDE
     C                     MOVEL'CEILG RA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCLRAT     ##DATA
     C                     MOVEL'Rate  '  ##RDEC                                            BUG23509
     C                     MOVEL'L'       ##RDET                                            BUG23509
     C                     MOVEL'7'       ##DCPA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Floor Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'T '      #@RDE
     C                     MOVEL'FLOOR RA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFLRAT     ##DATA
     C                     MOVEL'Rate  '  ##RDEC                                            BUG23509
     C                     MOVEL'L'       ##RDET                                            BUG23509
     C                     MOVEL'7'       ##DCPA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELFZERO     ##DATA                                            BUG23826
     C                     MOVELFZCNF     ##DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *                                                                                     BUG23509
      ** Set Data for Reference Market Rate                                                 BUG23509
      *                                                                                     BUG23509
     C           BYSL      IFNE ' '                                                         BUG23509
     C           BYSL      IFEQ 'B'                                                         BUG23509
     C                     MOVE TBRTT     WRATE                                             BUG23509
     C                     ELSE                                                             BUG23509
     C                     MOVE UBRTT     WRATE                                             BUG23509
     C                     ENDIF                                                            BUG23509
      *                                                                                     BUG23509
     C                     CALL 'AOBSRTR0'                                                  BUG23509
     C                     PARM *BLANKS   ##RTCD                                            BUG23509
     C                     PARM '*KEY   ' ##OPTN                                            BUG23509
     C                     PARM           UCUCY   3                                         BUG23509
     C                     PARM           WRATE   2                                         BUG23509
     C           SDBSRT    PARM SDBSRT    DSSDY                                             BUG23509
      *                                                                                     BUG23509
      ** Database Error                                                                     BUG23509
      *                                                                                     BUG23509
     C           ##RTCD    IFNE *BLANK                                                      BUG23509
     C                     MOVEL'SDBSRTPD'W0FILE                                            BUG23509
     C                     MOVELWRATE     W0KEY                                             BUG23509
     C                     Z-ADD33        W0ERNB                                            BUG23509
     C                     MOVEL'MEM5004' W0MSGD                                            BUG23509
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23509
     C                     EXSR SRERR                                                       BUG23509
     C                     ENDIF                                                            BUG23509
      *                                                                                     BUG23509
     C                     ENDIF                                                            BUG23509
      *                                                                                     BUG23509
      ** Base Rate                                                                          BUG23509
      *                                                                                     BUG23509
     C                     ADD  1         R1                                                BUG23509
     C                     CLEARR#DATA                                                      BUG23509
     C                     CLEARR#DEFN                                                      BUG23509
     C                     CLEAR#@RDE                                                       BUG23509
     C                     MOVE 'E '      #@RDE                                             BUG23509
     C                     MOVEL'BASE_RAT'#@RDE                                             BUG23509
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23509
     C                     MOVELBACBSR    ##DATA                                            BUG23509
     C                     MOVEL'Rate  '  ##RDEC                                            BUG23509
     C                     MOVEL'L'       ##RDET                                            BUG23509
     C                     MOVEL'7'       ##DCPA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1                                            BUG23509
     C                     MOVELR#DEFN    ##R,R1                                            BUG23509
      *                                                                                     BUG23509
      ** Base Rate Code                                                                     BUG23509
      *                                                                                     BUG23509
     C                     ADD  1         R1                                                BUG23509
     C                     CLEARR#DATA                                                      BUG23509
     C                     CLEARR#DEFN                                                      BUG23509
     C                     CLEAR#@RDE                                                       BUG23509
     C                     MOVE 'YP'      #@RDE                                             BUG23509
     C                     MOVEL'BASERATT'#@RDE                                             BUG23509
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23509
     C                     MOVELBABSRC    ##DATA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1                                            BUG23509
     C                     MOVELR#DEFN    ##R,R1                                            BUG23509
      *                                                                                     BUG23509
      ** Base Rate Name                                                                     BUG23509
      *                                                                                     BUG23509
     C                     ADD  1         R1                                                BUG23509
     C                     CLEARR#DATA                                                      BUG23509
     C                     CLEARR#DEFN                                                      BUG23509
     C                     CLEAR#@RDE                                                       BUG23509
     C                     MOVE 'AM'      #@RDE                                             BUG23509
     C                     MOVEL'BASERATN'#@RDE                                             BUG23509
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23509
     C                     MOVELBABSRN    ##DATA                                            BUG23509
     C                     MOVELR#DATA    ##D,R1                                            BUG23509
     C                     MOVELR#DEFN    ##R,R1                                            BUG23509
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D7                                        *
      *  Function    :  Process: IRS Detail                           *
      *                                                               *
      *  Called by   :  Z132IR                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           Z132D7    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D7'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D7'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CUSTOMER'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCNUM      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUCUCY     R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDDAT      R#DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Transaction Reference
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'TRAN_REF'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLNO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Maturity Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'MATUR DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELMDAT      R#DATA
     C                     MOVEL'Date    '##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Our Principal Amount                                                               BUG23510
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C**********           MOVE 'L '      #@RDE                                             BUG23510
     C**********           MOVEL'PRINCIPA'#@RDE                                             BUG23510
     C                     MOVEL'OUR PRIN'#@RDE                                             BUG23510
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELUPAMT     R#DATA                                            BUG23510
     C                     MOVELUOPAM     R#DATA                                            BUG23510
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C**********           MOVELCCY       ##CCY                                             BUG23510
     C                     MOVELUCUCY     ##CCY                                             BUG23510
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *                                                                                     BUG23510
      ** Their Principal Amount                                                             BUG23510
      *                                                                                     BUG23510
     C           DTYP      IFEQ 'RX'                                                        BUG23510
      *                                                                                     BUG23510
     C                     ADD  1         R1                                                BUG23510
     C                     CLEARR#DATA                                                      BUG23510
     C                     CLEARR#DEFN                                                      BUG23510
     C                     CLEAR#@RDE                                                       BUG23510
     C                     MOVEL'THR PRIN'#@RDE                                             BUG23510
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23510
     C                     MOVELTOPAM     R#DATA                                            BUG23510
     C                     MOVEL'Amount'  ##RDEC                                            BUG23510
     C                     MOVEL'L'       ##RDET                                            BUG23510
     C                     MOVELTCUCY     ##CCY                                             BUG23510
     C                     EXSR SRDCDT                                                      BUG23510
     C                     MOVELA6NBDP    ##DCPA                                            BUG23510
     C                     MOVELR#DATA    ##D,R1                                            BUG23510
     C                     MOVELR#DEFN    ##R,R1                                            BUG23510
      *                                                                                     BUG23510
     C                     ENDIF                                                            BUG23510
      *
      ** Start Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'START_DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELVDAT      R#DATA
     C                     MOVEL'Date    '##RDEC                                            BUG23510
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL TYP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDTYP      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Sub Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'YP'      #@RDE
     C                     MOVEL'DEALSUBT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDLST      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'INT RATE'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUEINR     ##DATA
     C                     MOVEL'Rate  '  ##RDEC                                            BUG23510
     C                     MOVEL'L'       ##RDET                                            BUG23510
     C                     MOVEL'7'       ##DCPA                                            BUG23510
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Rate Calculation Method / Interest Calculation Basis
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'AS'      #@RDE
     C                     MOVEL'INT CALB'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELUICBS     ##DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Interest Payment Frequency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'INT FREQ'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELUICFR     ##DATA                                           BUG23510A
     C                     MOVELUIPFR     ##DATA                                           BUG23510A
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Next Interest Payment Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'NXT IPDA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELUNICD     ##DATA                                            BUG24025
     C                     MOVELUNIPD     ##DATA                                            BUG24025
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELFZERO     ##DATA                                            BUG23826
     C                     MOVELFZCNF     ##DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *                                                                                     BUG23510
      ** Our Outstanding Amount                                                             BUG23510
      *                                                                                     BUG23510
     C                     ADD  1         R1                                                BUG23510
     C                     CLEARR#DATA                                                      BUG23510
     C                     CLEARR#DEFN                                                      BUG23510
     C                     CLEAR#@RDE                                                       BUG23510
     C                     MOVE 'MT'      #@RDE                                             BUG23510
     C                     MOVEL'OUR OSTA'#@RDE                                             BUG23510
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23510
     C                     MOVELUPAMT     ##DATA                                            BUG23510
     C                     MOVEL'Amount'  ##RDEC                                            BUG23510
     C                     MOVEL'L'       ##RDET                                            BUG23510
     C                     MOVELUCUCY     ##CCY                                             BUG23510
     C                     EXSR SRDCDT                                                      BUG23510
     C                     MOVELA6NBDP    ##DCPA                                            BUG23510
     C                     MOVELR#DATA    ##D,R1                                            BUG23510
     C                     MOVELR#DEFN    ##R,R1                                            BUG23510
      *                                                                                     BUG23510
      ** Their Outstanding Amount                                                           BUG23510
      *                                                                                     BUG23510
     C           DTYP      IFEQ 'RX'                                                        BUG23510
      *                                                                                     BUG23510
     C                     ADD  1         R1                                                BUG23510
     C                     CLEARR#DATA                                                      BUG23510
     C                     CLEARR#DEFN                                                      BUG23510
     C                     CLEAR#@RDE                                                       BUG23510
     C                     MOVE 'MT'      #@RDE                                             BUG23510
     C                     MOVEL'THR OSTA'#@RDE                                             BUG23510
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23510
     C                     MOVELTPAMT     ##DATA                                            BUG23510
     C                     MOVEL'Amount'  ##RDEC                                            BUG23510
     C                     MOVEL'L'       ##RDET                                            BUG23510
     C                     MOVELTCUCY     ##CCY                                             BUG23510
     C                     EXSR SRDCDT                                                      BUG23510
     C                     MOVELA6NBDP    ##DCPA                                            BUG23510
     C                     MOVELR#DATA    ##D,R1                                            BUG23510
     C                     MOVELR#DEFN    ##R,R1                                            BUG23510
      *                                                                                     BUG23510
     C                     ENDIF                                                            BUG23510
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132D8                                        *
      *  Function    :  Process: Security Detail                      *
      *                                                               *
      *  Called by   :  Z132SE                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA - Output extract data                  *
      *****************************************************************
      *
     C           Z132D8    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D8'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D8'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCDPA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CUSTOMER'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCDCN      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELNMCY      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Security Shortname
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TN'      #@RDE
     C                     MOVEL'PB_SECSH'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCDSN      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Security Investment Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'YP'      #@RDE
     C                     MOVEL'SEC_INVT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELSITP      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Value Date Position
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'NE'      #@RDE
     C                     MOVEL'VAL_POS_'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCDNV      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C**********           MOVELFZERO     ##DATA                                            BUG23826
     C                     MOVELFZCNF     ##DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      *  Subroutine  :  Z132D9                                        *
      *  Function    :  Process: FF Details                           *
      *                                                               *
      *  Called by   :  Z132FF                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA - Output extract data                  *
      *****************************************************************
      *
     C           Z132D9    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D9'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D9'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CUSTOMER'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCUSC      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CURRENCY'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELISCY      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Deal Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'DEAL DAT'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELTRSD      R#DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Transaction Referencee
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'TRAN_REF'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELTNBR      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Maturity Datetion
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'MATUR DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFCDA      R#DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Start date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'TE'      #@RDE
     C                     MOVEL'START_DA'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELVALD      R#DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Instrument Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'NT'      #@RDE
     C                     MOVEL'INSTRUME'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELISTT      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Put Call
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'N '      #@RDE
     C                     MOVEL'PUTCALLI'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELPCAL      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Hedging / Trading
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'TRANSTYP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELHETR      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Number of Contract
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'CT'      #@RDE
     C                     MOVEL'TOTCONTR'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELNUCO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Contract Price
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'RC'      #@RDE
     C                     MOVEL'CONTRCTP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCOPR      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Zero Confirmation flag
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ZZNULLB' #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C*********            MOVELFZERO     ##DATA                                            BUG23826
     C                     MOVELFZCNF     ##DATA                                            BUG23826
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132FA                                        *
      *  Function    :  Process: Repeater for Facility                *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRBIND -                                      *
      *                 Z132D2 - Facility Details Extract             *
      *****************************************************************
      *
     C           Z132FA    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132FA'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132FA'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     EXSR SRBIND
      *
      ** Set Zero Confirmation Flag                                                         BUG23826
      *                                                                                     BUG23826
     C                     MOVE 'N'       FZCNF   1                                         BUG23826
      *
      ** Selection on Logical file to select records with RECI = 'D'
      ** These are Deals which have been Authorised and are Active.
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLLEFCLTLT
     C           KEY01     READELEFCLTLT                 84
     C                     ELSE
     C           WFCUST    SETLLLEFCLTLT
     C           WFCUST    READELEFCLTLT                 84
     C                     ENDIF
      *                                                                                     BUG23586
     C           *IN84     IFEQ '0'                                                         BUG23586
      *                                                                                     BUG23586
     C           *IN84     DOWEQ'0'
      *
     C                     EXSR Z132D2
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     READELEFCLTLT                 84
     C                     ELSE
     C           WFCUST    READELEFCLTLT                 84
     C                     ENDIF
     C                     ENDDO
      *
     C                     ELSE                                                             BUG23586
      *                                                                                     BUG23586
      ** Zero Confirmation Processing                                                       BUG23586
      *                                                                                     BUG23586
     C           FZERO     IFEQ 'Y'                                                         BUG23586
      *                                                                                     BUG23586
     C                     EXSR Z132D2                                                      BUG23586
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C                     ENDIF                                                            BUG23586
      *                                                                                     BUG23586
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
     C                     EXSR POPGRS
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  Z132D2                                        *
      *  Function    :  Process: Lending Facilities Mt                *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRDCDT -                                      *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           Z132D2    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'Z132D2'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'Z132D2'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     Z-ADD0         R1      30
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBRCA      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Facility Currency
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'FAC CCY '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFCCY      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Facility Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'UM'      #@RDE
     C                     MOVEL'FAC CSTN'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELCNUM      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Facility Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'ER'      #@RDE
     C                     MOVEL'FAC NUMB'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFCNO      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Facility Type
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'FAC TYPE'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFCTI      R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Fac. Approved Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C**********           MOVEL'ZZFACDTE'#@RDE                                             BUG23507
     C                     MOVEL'FACAPPD '#@RDE                                             BUG23507
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDTAP      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Fac. Expires Date
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C**********           MOVEL'ZZFACEXP'#@RDE                                             BUG23507
     C                     MOVEL'FACEXPD '#@RDE                                             BUG23507
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELDTEX      ##DATA
     C                     MOVEL'Date  '  ##RDEC
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Facility Amount
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C**********           MOVEL'ZZFAMT  '#@RDE                                             BUG23507
     C                     MOVEL'FAC AMT '#@RDE                                             BUG23507
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELFAMT      ##DATA
     C                     MOVEL'Amount'  ##RDEC
     C                     MOVEL'L'       ##RDET
     C                     MOVELFCCY      ##CCY
     C                     EXSR SRDCDT
     C                     MOVELA6NBDP    ##DCPA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch name
      *
     C           BRCA      IFNE *BLANKS                                                    BUG23250B
     C                     MOVE BRCA      BCODE
     C                     ENDIF                                                           BUG23250B
     C                     EXSR SRBRNM
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVELBRNAME    #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  CGBRCH                                        *
      *  Function    :  Process: Addtnl Address Info                  *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRERR  - Error Subroutine                     *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA - Output Extract Data                  *
      *****************************************************************
      *
     C           CGBRCH    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'CGBRCH'  @STK,Q
      *
      ** Retrieve subroutine specific data.
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'CGBRCH'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C           FBRCA     IFEQ 'ALL'
      *
      ** Get Customer Branch
      *
     C                     MOVE FCUST     CUSTA   6
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM CUSTA     ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCUSTA     W0KEY
     C                     Z-ADD02        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE BBBRCD    BCODE
     C                     ELSE
     C                     MOVE FBRCA     BCODE
     C                     ENDIF
      *
      ** Access branch file to retrieve Branch internal customer
      ** of originating branch of customer file
      *
     C                     CALL 'AOBRCHR0'
     C                     PARM '*MSG    '##RTCD  7
     C                     PARM '*KEY    '##OPTN  7
     C                     PARM BCODE     ##BRCD  3
     C           SDBRCH    PARM SDBRCH    DSFDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELBCODE     W0KEY
     C                     Z-ADD03        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Get Customer Details for Branch Internal Customer
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM A8BICN    ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELA8BICN    W0KEY
     C                     Z-ADD04        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Get Additional Customer Details for Branch Internal Customer                       BUG22741
      *                                                                                     BUG22741
     C                     CALL 'AOACUSR0'                                                  BUG22741
     C                     PARM *BLANKS   ##RTCD                                            BUG22741
     C                     PARM '*KEY   ' ##OPTN                                            BUG22741
     C                     PARM A8BICN    ##KEY   6                                         BUG22741
     C           SDACUS    PARM SDACUS    DSSDY                                             BUG22741
      *                                                                                     BUG22741
      ** Database error                                                                     BUG22741
      *                                                                                     BUG22741
     C           ##RTCD    IFNE *BLANKS                                                     BUG22741
     C                     MOVEL'SDACUSPD'W0FILE                                            BUG22741
     C                     MOVELA8BICN    W0KEY                                             BUG22741
     C                     Z-ADD31        W0ERNB                                            BUG22741
     C                     MOVEL'MEM5004' W0MSGD                                            BUG22741
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG22741
     C                     EXSR SRERR                                                       BUG22741
     C                     END                                                              BUG22741
      *
      ** Get Correspondent Details for Branch Internal Customer
      *
     C           A8BICN    CHAINCGCORRL4             99
      *
      ** If Correspondent not found
     C           *IN99     IFEQ '1'
      *
      ** Database Error
     C                     MOVEL'CGCORRPD'W0FILE
     C                     MOVELA8BICN    W0KEY
     C                     Z-ADD05        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     Z-ADD0         R1      30
      *
      ** Telex Number
      *
     C                     ADD  1         R1
     C           BBSTAD    IFNE *BLANKS                                                     BUG22741
     C                     MOVELBBSTAD    ##D,R1
     C                     ELSE                                                             BUG22741
     C                     MOVELE5TXNB    ##D,R1                                            BUG22741
     C                     ENDIF                                                            BUG22741
     C                     RESET##RDEF
     C                     MOVEL' ZZSTAD' ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Telephone Number
      *
     C                     ADD  1         R1
     C                     MOVELBBCTNB    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' ZZCTNB' ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** SWIFT Code
      *
     C                     ADD  1         R1
     C                     MOVELBBCSID    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' ZZCSID' ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** German Bankleitzahl
      *
     C                     ADD  1         R1
     C                     MOVELBBBLCD    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' ZZBLCD' ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Fax Number
      *
     C                     ADD  1         R1
     C                     MOVELCDFAX     ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' ZZFAX'  ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Branch Internal Customer Number
      *
     C                     ADD  1         R1
     C                     MOVELA8BICN    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' BICNBR' ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Chips Id (Branch-Internal Customer):
      *
     C                     ADD  1         R1
     C                     MOVELBBCHID    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' BCHIPS_'##RDE
     C                     MOVE 'ID  '    ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Chips ABA (Branch-Internal Customer)
      *
     C                     ADD  1         R1
     C           BBCABA    IFNE 0                                                           BUG23512
     C                     MOVELBBCABA    ##D,R1
     C                     ELSE                                                             BUG23512
     C                     MOVEL*BLANKS   ##D,R1                                            BUG23512
     C                     ENDIF                                                            BUG23512
     C                     RESET##RDEF
     C                     MOVEL' BCHIPS_'##RDE
     C                     MOVE 'ABA '    ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Chaps sort code (Branch-Internal Customer)
      *
     C                     ADD  1         R1
     C                     MOVELBBCHSC    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' BCHAPS_'##RDE
     C                     MOVE 'SRT '    ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** BOJ (Branch-Internal Customer)
      *
     C                     ADD  1         R1
     C                     MOVELBBBFIC    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' BBOJ'   ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Fedwire (Branch-Internal Customer)
      *
     C                     ADD  1         R1
     C                     MOVELBBFWCD    ##D,R1
     C                     RESET##RDEF
     C                     MOVEL' BFEDWIR'##RDE
     C                     MOVE 'E   '    ##RDE
     C                     MOVEL##RDEF    ##R,R1
      *
      ** Accumulate RDE's and associated data and output to
      ** PF/CGUDTAPD.
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  CUST                                          *
      *  Function    :  Process: Customer Details                     *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRERR  - Error Subroutine                     *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA - Output Extract Data                  *
      *****************************************************************
      *
     C********** CUST      BEGSR                                                           BUG23512A
     C           CUSTE     BEGSR                                                           BUG23512A
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C**********           MOVEL'CUST  '  @STK,Q                                           BUG23512A
     C                     MOVEL'CUSTE '  @STK,Q                                           BUG23512A
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C**********           MOVEL'CUST  '  ##GRPS    P                                      BUG23512A
     C                     MOVEL'CUSTE '  ##GRPS    P                                      BUG23512A
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
     C                     Z-ADD0         R1      30
      *
      ** Access Customer Details if the Customer has changed.
      ** (LF/SDCUSTL1)
      *
     C                     MOVE FCUST     UFCUST  6
     C           UFCUST    IFNE BBCUST
     C                     MOVE *BLANKS   UFKEY1
     C                     MOVE FCUST     UFKEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           UFKEY1 10
     C                     PARM *BLANKS   UFKYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** If not found, Database Error.
      *
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELFCUST     W0KEY
     C                     Z-ADD06        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *                                                                                     BUG23512
      ** Get Correspondent Details for Customer                                             BUG23512
      *                                                                                     BUG23512
     C           UFCUST    CHAINCGCORRL4             99                                     BUG23512
      *                                                                                     BUG23512
     C           *IN99     IFEQ '1'                                                         BUG23512
      *                                                                                     BUG23512
      ** Database error                                                                     BUG23512
      *                                                                                     BUG23512
     C                     MOVEL'CGCORRPD'W0FILE                                            BUG23512
     C                     MOVELUFCUST    W0KEY                                             BUG23512
     C                     Z-ADD33        W0ERNB                                            BUG23512
     C                     MOVEL'MEM5004' W0MSGD                                            BUG23512
     C                     MOVEL'MIDAS  ' W0MSGF                                            BUG23512
     C                     EXSR SRERR                                                       BUG23512
     C                     ENDIF                                                            BUG23512
      *
      ** Customer address line 1
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE '1 '      #@RDE
     C                     MOVEL'CUST_ADR'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCNA1    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer address line 2
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE '2 '      #@RDE
     C                     MOVEL'CUST_ADR'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCNA2    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer address line 3
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE '3 '      #@RDE
     C                     MOVEL'CUST_ADR'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCNA3    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer address line 4
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE '4 '      #@RDE
     C                     MOVEL'CUST_ADR'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCNA4    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Name
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'CUST_NAM'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Customer Number
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'CUSTOMER'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELBBCUST    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *                                                                                     BUG23512
      ** Customer Town                                                                      BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVE 'N '      #@RDE                                             BUG23512
     C                     MOVEL'CUST_TOW'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBCRTN    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Customer Telephone Number                                                          BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVEL'CUST_TEL'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBCTNB    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Customer Fax Number                                                                BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVEL'CUST_FAX'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELCDFAX     R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Customer SWIFT code                                                                BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVE 'FT'      #@RDE                                             BUG23512
     C                     MOVEL'CUST_SWI'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBCSID    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** German Bankleitzahl                                                                BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVEL'CUST_BLZ'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBBLCD    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Chips-Id (Customer)                                                                BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVE 'D '      #@RDE                                             BUG23512
     C                     MOVEL'CCHIPS_I'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBCHID    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Chips ABA (Customer)                                                               BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVE 'BA'      #@RDE                                             BUG23512
     C                     MOVEL'CCHIPS_A'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C           BBCABA    IFNE 0                                                           BUG23512
     C                     MOVELBBCABA    R#DATA                                            BUG23512
     C                     ELSE                                                             BUG23512
     C                     MOVEL*BLANKS   R#DATA                                            BUG23512
     C                     ENDIF                                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Chaps sort code (Branch-Internal Customer)                                         BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVE 'RT'      #@RDE                                             BUG23512
     C                     MOVEL'CCHAPS_S'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBCHSC    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** BOJ (Customer)                                                                     BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVEL'CBOJ    '#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBBFIC    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *                                                                                     BUG23512
      ** Fedwire (Customer)                                                                 BUG23512
      *                                                                                     BUG23512
     C                     ADD  1         R1                                                BUG23512
     C                     CLEARR#DATA                                                      BUG23512
     C                     CLEARR#DEFN                                                      BUG23512
     C                     CLEAR#@RDE                                                       BUG23512
     C                     MOVEL'CFEDWIRE'#@RDE                                             BUG23512
     C           ##RDE     CAT  #@RDE:1   ##RDE                                             BUG23512
     C                     MOVELBBFWCD    R#DATA                                            BUG23512
     C                     MOVELR#DATA    ##D,R1                                            BUG23512
     C                     MOVELR#DEFN    ##R,R1                                            BUG23512
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  BRANCH                                        *
      *  Function    :  Process: Branch Details                       *
      *                                                               *
      *  Called by   :  ZSF132 - Audit Letter top group set           *
      *  Calls       :  SRADTA - Format Extract Data                  *
      *                 SRODTA - Output Extract Data                  *
      *                 AOBRCHR0 - Obtain Branch Details              *
      *****************************************************************
      *
     C           BRANCH    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'BRANCH'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'BRANCH'  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C                     EXSR PSHGRS
      *
      ** Get Branch Details if the Branch has changed
      *
     C           FBRCA     IFEQ 'ALL'
      *
      ** Get Customer Branch
      *
     C                     MOVELFCUST     CUSTA
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM CUSTA     ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** In the next section the processing is common to both FBRCA
      ** and BBBRCD therefore move BBBRCD to a variable for further
      ** processing.
      *
     C                     MOVE BBBRCD    BCODE   3
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCUSTA     W0KEY
     C                     Z-ADD07        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Because the next section of code is common to both BBBRCD and
      ** FBRCA (selected branch from parm list) move FBRCA to variable
      ** BCODE for rest of processing.
      *
     C                     ELSE
     C                     MOVE FBRCA     BCODE
     C                     ENDIF
      *
     C                     CALL 'AOBRCHR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM BCODE     UFBRCD  3
     C           SDBRCH    PARM SDBRCH    DSFDY
      *
      ** Database Error
      *
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELBCODE     W0KEY
     C                     Z-ADD08        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     Z-ADD0         R1      30
      *
      ** Branch (Code)
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'BRANCH  '#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRCD    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Branch Name
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'AM'      #@RDE
     C                     MOVEL'BRANCH N'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELA8BRNM    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRACOF                                        *
      *  Function    :  Process: Account Officer Details              *
      *                                                               *
      *  Called by   :  ZSF132                                        *
      *  Calls       :  SRPATH - Builds Group paths                   *
      *                 SRERR  - Error Subroutine                     *
      *                 SRADTA - Format Extract Data                  *
      *                 SRADTA -  Output extract data                 *
      *****************************************************************
      *
     C           SRACOF    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRACOF'  @STK,Q
      *
     C                     ADD  1         P1
     C           P1        OCUR ##PATH
     C                     MOVEL'ACOF  '  ##GRPS    P
      *
     C                     EXSR SRPATH
      *
     C           FMOID     IFEQ 'LO'
      *
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLLELOANLF
     C           KEY01     READELELOANLF                 82
     C                     ELSE
     C           WFCUST    SETLLLELOANLF
     C           WFCUST    READELELOANLF                 82
     C                     ENDIF
     C                     ELSE
     C           FMOID     IFEQ 'FA'
     C           FBRCA     IFNE 'ALL'
     C           KEY01     SETLLLEFCLTLT
     C           KEY01     READELEFCLTLT                 84
     C                     ELSE
     C           WFCUST    SETLLLEFCLTLT
     C           WFCUST    READELEFCLTLT                 84
     C                     ENDIF
     C                     ELSE
      *
      ** Get Customer Branch
      *
     C                     MOVE FCUST     CUSTA
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM CUSTA     ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELFCUST     W0KEY
     C                     Z-ADD10        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     MOVE BBACOC    ACOF
     C                     ENDIF
     C                     ENDIF
      *
      ** Retrieve account officer details.
      *
     C                     CALL 'AOACOFR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM ACOF      P@ACOC  2
     C           SDACOF    PARM SDACOF    DSFDY
      *
     C           @RTCD     IFNE *BLANK
     C                     RESETSDACOF
     C                     ENDIF
      *
     C                     Z-ADD0         R1      30
      *
     C                     EXSR PSHGRS
      *
      ** Account Officer Code
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'ACOF_COD'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELAZACOC    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Acc. Officer Dept. Code
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'T '      #@RDE
     C                     MOVEL'ACOF_DEP'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELAZDPCD    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Account Officer Name
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'E '      #@RDE
     C                     MOVEL'ACOF_NAM'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELAZACON    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Account Officer Telephone Numb
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVE 'P '      #@RDE
     C                     MOVEL'ACOF_TEL'#@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELAZAPHN    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
      ** Acc. Off. Telephone Ext.
      *
     C                     ADD  1         R1
     C                     CLEARR#DATA
     C                     CLEARR#DEFN
     C                     CLEAR#@RDE
     C                     MOVEL'ACOF_TEL'#@RDE
     C                     MOVE 'X '      #@RDE
     C           ##RDE     CAT  #@RDE:1   ##RDE
     C                     MOVELAZAEXT    R#DATA
     C                     MOVELR#DATA    ##D,R1
     C                     MOVELR#DEFN    ##R,R1
      *
     C                     EXSR SRADTA
     C                     EXSR SRODTA
      *
     C                     EXSR POPGRS
      *
      ** Decrement Path DS index
      *
     C           P1        OCUR ##PATH
     C                     CLEAR##GRPS
     C                     SUB  1         P1
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      ******************************************************************
      *  Subroutine  :  SRBRNM                                         *
      *  Function    :  Get the name of the branch for the loan/facilit*
      *                 y retail trade/ money mkt trade/ FX trade.     *
      *                                                                *
      *  Called by   :  Z132LO, Z132FA, Z132RE, Z132MM, Z132FX         *
      *  Calls       :  Access object AOBRCHR0                         *
      ******************************************************************
      *
     C           SRBRNM    BEGSR
      *
      ** Access branch file to retrieve Branch name of loan/facility
      ** retail trade/ money mkt trade/ FX trade.
      *
     C                     CALL 'AOBRCHR0'
     C                     PARM '*MSG    '##RTCD  7
     C                     PARM '*KEY    '##OPTN  7
     C                     PARM BCODE     ##BRCD  3
     C           SDBRCH    PARM SDBRCH    DSFDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDBRCHPD'W0FILE
     C                     MOVELBCODE     W0KEY
     C                     Z-ADD03        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRINZ                                         *
      *  Function    :  Initialise Fields on Program Invocation       *
      *                                                               *
      *  Called by   :  Mainline                                      *
      *  Calls       :                                                *
      *****************************************************************
      *
     C           SRINZ     BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRINZ '  @STK,Q
      *
      ** Initialise work fields
      *
     C                     Z-ADD*ZEROS    ##W050  50
     C                     Z-ADD*ZEROS    ##W150 150
     C                     Z-ADD*ZEROS    ##W157 157
     C                     Z-ADD*ZEROS    #1      60
     C                     Z-ADD*ZEROS    #2      60
     C                     Z-ADD*ZEROS    #3      60
     C                     MOVE *BLANKS   S#PATH256
      *
     C           *LIKE     DEFN DEOSEQ    ##OSEQ
     C           *LIKE     DEFN ##TBIN    #@TBIN
     C           *LIKE     DEFN @SARD     ##SARD
      *
     C           KEY01     KLIST
     C                     KFLD           WFCUST
     C                     KFLD           FBRCA
      *
     C           KEY02     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           LNRF
      *
      ** Initialise output sequence (to CGUDTAPD)
      *
     C                     Z-ADD*ZEROS    ##OSEQ
      *
      ** DJU Additions for CG4999 1st version **
      *
     C                     MOVE *BLANKS   #@RDE  10
      *
     C           1         OCUR ##BIND
     C                     RESET##BIND
     C                     RESET#@BIND
     C                     RESET#PDS
      *
     C           FBRCA     IFEQ 'ALL'
      *
      ** Get Customer Branch
      *
     C                     MOVE FCUST     CUSTA   6
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY   ' ##OPTN
     C                     PARM CUSTA     ##KEY1 10
     C                     PARM *BLANKS   ##KYST  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCUSTPD'W0FILE
     C                     MOVELCUSTA     W0KEY
     C                     Z-ADD02        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C                     MOVE BBBRCD    BCODE
     C                     ELSE
     C                     MOVE FBRCA     BCODE
     C                     ENDIF
      *
      ** Initialize XML Increment
      *
     C                     EXSR INIXML
      *
     C           EXINZ     TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRINIT                                        *
      *  Function    :  Initial processing - First Call Only          *
      *                                                               *
      *  Called by   :  Mainline                                      *
      *  Calls       :  SRERR                                         *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRINIT'  @STK,Q
      *
      ** Call access program for Bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   ##RTCD  7
     C                     PARM '*FIRST  '##OPTN  7
     C           SDBANK    PARM SDBANK    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AOBANKR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD11        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
     C           BJDFIN    COMP 'M'                      98
      *
      ** Determine Number of decimal places - Base currency
      *
     C                     MOVELBJCYCD    ##CCY
     C                     EXSR SRDCDT
     C                     Z-ADDA6NBDP    BASCDP  10
      *
      ** Call access program for General Ledger Details
      *
     C                     CALL 'AOGELRR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDGELR    PARM SDGELR    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AOGELRR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD12        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Call access program for Midas Modules Details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDMMOD    PARM SDMMOD    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AOMMODR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD13        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Call access program for trading data details
      *
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDTRAD    PARM SDTRAD    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AOTRADR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD14        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
      *
      ** Call access program for Dealing data details
      *
     C           BGDLMM    IFEQ 'Y'
     C           BGDLFX    OREQ 'Y'
     C                     CALL 'AODEALR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDDEAL    PARM SDDEAL    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AODEALR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD15        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
      *
      ** Call access program for Retail details
      *
     C           BGRTBN    IFEQ 'Y'
     C           BGIOAC    OREQ 'Y'
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDRETL    PARM SDRETL    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AORETLR0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD16        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
      *
      ** Call access program for Message Management Details
      *
     C           BGNWMI    IFEQ 'Y'
     C                     CALL 'AOMGMER0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*FIRST  '##OPTN
     C           SDMGME    PARM SDMGME    DSSDY
      *
     C           ##RTCD    IFNE *BLANK
      *
      ** Database error
      *
     C                     MOVEL'AOMGMER0'W0FILE
     C                     MOVEL'*CALL'   W0KEY
     C                     Z-ADD17        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     END
     C                     END
      *
      ** Access Switchable Features file and check if CCG015 is
      ** installed (Correspondence Manager)
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*VERIFY' ##OPTN
     C                     PARM 'CCG015'  @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           ##RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       CCG015  1
     C                     ELSE
     C                     MOVE 'N'       CCG015
      *
     C           ##RTCD    IFNE '*NRF    '
     C                     MOVEL'SCSARDPD'W0FILE
     C                     MOVEL'*CALL   'W0KEY
     C                     Z-ADD19        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *                                                                                       CLE143
      ** Check if CLE143 is ON                                                                CLE143
      *                                                                                       CLE143
     C                     CALL 'AOSARDR0'                                                    CLE143
     C                     PARM *BLANKS   ##RTCD                                              CLE143
     C                     PARM '*VERIFY '##OPTN                                              CLE143
     C                     PARM 'CLE143'  @SARD                                               CLE143
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE143
      *                                                                                       CLE143
     C           ##RTCD    IFEQ *BLANKS                                                       CLE143
     C                     MOVE 'Y'       CLE143  1                                           CLE143
     C                     ELSE                                                               CLE143
     C                     MOVE 'N'       CLE143                                              CLE143
     C                     ENDIF                                                              CLE143
      *
     C           EXINIT    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRADTA                                        *
      *  Function    :  Accumulate RDEs and associated data for output*
      *                                                               *
      *  Called by   :  Simple group set subroutines                  *
      *  Calls       :  CG3999 - Format and Pack Data                 *
      *                 SRERR  - Database Error                       *
      *****************************************************************
      *
     C           SRADTA    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRADTA'  @STK,Q
      *
      ** Reformat RDE data
      *
     C                     EXSR SRRFMN
      *
      ** Pack RDEs and associated data into data string
      *
     C                     CLEAR##SDS
      *
      ** If CCG015 is installed, value of W0ACT is '*NEWARR'
      *
     C           CCG015    IFEQ 'Y'
     C                     MOVEL'*NEWARR 'W0ACT
     C                     MOVELS#PATH    W0SPAT
     C                     ELSE
     C                     MOVEL'*PACK   'W0ACT
     C                     MOVEL*BLANK    W0SPAT
     C                     ENDIF
      *
     C                     CALL 'CG3999'
     C                     PARM *BLANK    ##RTCD
     C                     PARM           W0ACT
     C                     PARM           ##R
     C                     PARM           ##D
     C                     PARM           ##S
     C                     PARM           W0SPAT 70
     C                     PARM           ##RN
     C                     PARM           ##DN
     C                     PARM           ##FM
      *
      ** Database error
      *
     C           ##RTCD    IFNE *BLANK
      *
     C                     MOVEL'CG3999  'W0FILE
     C                     MOVEL##RTCD    W0KEY
     C                     Z-ADD18        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
     C                     EXSR WRTRDE
      *
      ** Append Data from pack routine.
      *
     C           #@SDS     CAT  ##SDS:0   #@SDS
      *
     C                     MOVEL*BLANK    ##R
     C                     MOVEL*BLANK    ##D
     C                     MOVEL*BLANK    ##S
      *
     C           EXADTA    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      *  Subroutine  :  SRODTA                                        *
      *  Function    :  Output Accumulated data to PF/CGUDTAPD        *
      *                                                               *
      *  Called by   :  Simple group set subroutines                  *
      *  Calls       :  CG9020 - Output Data to CGUDTAPD              *
      *                 SRERR  - Database Error                       *
      *****************************************************************
      *
     C           SRODTA    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRODTA'  @STK,Q
      *
      ** Initialise Write Format Parameter.
      *
     C                     CLEARW0FMT
      *
      ** Set up Control Information.
      *
     C                     Z-ADD##ITEM    DEITEM
     C                     ADD  1         ##OSEQ
     C                     Z-ADD##OSEQ    DEOSEQ
     C                     Z-ADD##PBIN    DEPBIN
     C                     Z-ADD##TBIN    DETBIN
     C                     MOVE 'FR'      DEFSLI
     C                     MOVE *BLANKS   W0PATH
     C                     MOVELS#PATH    W0PATH
      *
      ** Append Data from pack routine.
      *
     C           W0FMT     CAT  #@SDS:0   W0FMT
      *
      ** Output PF/CGUDTAPD Record.
      *
     C           CCG015    IFEQ 'N'
     C                     CALL 'CG9020'
     C                     PARM *BLANK    ##RTCD
     C                     PARM '*WRITE  'W0ACT
     C                     PARM           W0PATH256
     C                     PARM           W0FMT
     C                     PARM *BLANK    W0TITL  7
     C                     PARM *BLANK    W0ULIN  7
     C                     PARM           W0CMT
      *
      ** Database error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'CG9020  'W0FILE
     C                     MOVEL##RTCD    W0KEY
     C                     Z-ADD20        W0ERNB
     C                     MOVEL'MEM5003' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
     C                     CLEAR#@SDS
      *
     C           EXODTA    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRBIND                                        *
      *  Function    :  Generate Binding numbers                      *
      *                                                               *
      *  Called by   :  All Repeating Group Set Subroutines           *
      *  Calls       :                                                *
      *****************************************************************
      *
     C           SRBIND    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRBIND'  @STK,Q
      *
     C           P1        SUB  1         P2
     C           P2        OCUR ##BIND
      *
     C                     Z-ADD##TBIN    #@TBIN
     C           P1        OCUR ##BIND
     C                     Z-ADD#@TBIN    ##PBIN
      *
     C                     ADD  1         #@BIND
     C                     Z-ADD#@BIND    ##TBIN
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRPATH                                        *
      *  Function    :  Generate Path String /GS1/GS2...              *
      *                                                               *
      *  Called by   :  All Group Set subroutines                     *
      *  Calls       :                                                *
      *****************************************************************
      *
     C           SRPATH    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRPATH'  @STK,Q
      *
     C                     CLEARS#PATH
      *
     C                     DO   P1        P2
     C           P2        OCUR ##PATH
     C           S#PATH    CAT  '\':0     S#PATH
     C           S#PATH    CAT  ##GRPS:0  S#PATH
     C                     END
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
      /SPACE 5
      *****************************************************************
      *  Subroutine  :  SRRFMN                                        *
      *  Function    :  Reformat RDE data                             *
      *                                                               *
      *  Called by   :  SRADTA                                        *
      *  Calls       :                                                *
      *****************************************************************
      *
     C           SRRFMN    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRRFMN'  @STK,Q
      *
      ** Loop through RDE's and data
      *
     C                     Z-ADD0         #1
     C           #1        DOUEQ20
     C                     ADD  1         #1
     C                     MOVEL##R,#1    R#DEFN
     C                     MOVEL##D,#1    R#DATA
      *
      ** If data present and RDE is edited
      *
     C           R#DATA    IFNE *BLANK
     C           ##RDEC    ANDNE*BLANK
      *
      ** Reformat Amount
      *
     C                     Z-ADD1         #2
     C           *BLANK    LOKUP##NUMA,#2                99*
     C                     Z-ADD20        #3
     C                     Z-ADD0         ##WNUM
     C           #2        DOWGT1
     C           #2        ANDLE20
     C           #3        ANDGT1
     C                     SUB  1         #2
     C                     MOVEL##NUMA,#2 ##W,#3
     C                     SUB  1         #3
     C                     ENDDO
      *
      ** Sign the amount
      *
     C           ##SIGN    IFEQ '-'
     C                     Z-SUB##WNUM    ##NUMB
     C                     ELSE
     C                     Z-ADD##WNUM    ##NUMB
     C                     END
      *
      ** Default Edit Type
      *
     C           ##EDTT    IFEQ *BLANK
     C                     MOVEL##RDET    ##EDTT
     C                     END
      *
      ** Default Decimal Places
      *
     C           ##DCPA    IFEQ *BLANK
     C                     MOVEL##RDED    ##DCPA
     C                     END
      *
      ** New RDE data
      *
     C                     MOVELR#DATA    ##D,#1
     C                     ENDIF
     C                     ENDDO
      *
     C           EXRFMN    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRDCDT                                        *
      *  Function    :  Determine Currency Details                    *
      *                                                               *
      *  Called by   :                                                *
      *  Calls       :                                                *
      *****************************************************************
      *
     C           SRDCDT    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRDCDT'  @STK,Q
      *
      ** Access array of Currency Details already loaded
      *
     C                     Z-ADD1         C       30
     C           ##CCY     LOKUP##CY,C                   99
      *
      ** If no match is found determine the next free space in the
      ** loaded currency array.
      *
     C           *IN99     IFEQ *OFF
     C                     Z-ADD1         C
     C           *BLANK    LOKUP##CY,C                   99
      *
      ** If no space is left, set the Currency Data data structure to
      ** the 101st occurrence so that when the new details are
      ** retrieved no existing details are overwritten.
      *
     C           *IN99     IFEQ *OFF
     C           101       OCUR SDCURR
      *
      ** If a space is found, set up the new currency into the array
      ** and position the Currency Data data structure on the
      ** occurrence matching the array index.
      *
     C                     ELSE
     C                     MOVE ##CCY     ##CY,C
     C           C         OCUR SDCURR
     C                     ENDIF
      *
      ** Retrieve the currency details.
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   ##RTCD
     C                     PARM '*KEY'    ##OPTN
     C                     PARM ##CCY     ##CCYP  3
     C           SDCURR    PARM *BLANK    DSSDY
      *
      ** Database Error
      *
     C           ##RTCD    IFNE *BLANK
     C                     MOVEL'SDCURRPD'W0FILE
     C                     MOVEL##CCY     W0KEY
     C                     Z-ADD21        W0ERNB
     C                     MOVEL'MEM5004' W0MSGD
     C                     MOVEL'MIDAS  ' W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
      *
      ** If the currency has been retrieved earlier, position the
      ** Currency Data data structure on the relevant occurrence.
      *
     C                     ELSE
     C           C         OCUR SDCURR
     C                     ENDIF
      *
     C           EXDCDT    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
      *****************************************************************
      *  Subroutine  :  SRGENR                                        *
      *  Function    :  Generate reference number                     *
      *                 by writing to PF/CGUDCRPD                     *
      *                                                               *
      *  Called by   :  SRMAIN - Main Processing                      *
      *  Calls       :  CG9010 - Create reference record              *
      *****************************************************************
      *
     C           SRGENR    BEGSR
      *
      ** Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'SRGENR'  @STK,Q
      *
      ** Generate reference number and check if further processing
      ** required. Set up all available information in the record
      ** format before calling.
      *
     C                     CLEAR##UDCR
      *
      ** Booking/Main Branch (Mandatory)
      *
     C                     MOVELBCODE     DRBRCA
      *
      ** Originating Branch (Optional)
      *
     C                     MOVELBCODE     DRORBR
      *
      ** Module identifier (Mandatory)
      *
     C           FMOID     IFEQ 'LO'
     C                     MOVEL'LE'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'FA'
     C                     MOVEL'LE'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'MM'
     C                     MOVEL'MM'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'RE'
     C                     MOVEL'RE'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'FX'
     C                     MOVEL'FX'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'FR'
     C                     MOVEL'FR'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'IR'
     C                     MOVEL'IR'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'SE'
     C                     MOVEL'SE'      DRMODI
     C                     ENDIF
     C           FMOID     IFEQ 'FF'
     C                     MOVEL'FF'      DRMODI
     C                     ENDIF
      *
     C                     MOVELW#PTYP    DRPTYP
      *
     C           FMOID     IFEQ 'LO'
     C                     MOVELW#PST1    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'FA'
     C                     MOVELW#PST2    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'MM'
     C                     MOVELW#PST3    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'RE'
     C                     MOVELW#PST4    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'FX'
     C                     MOVELW#PST5    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'FR'
     C                     MOVELW#PST6    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'IR'
     C                     MOVELW#PST7    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'SE'
     C                     MOVELW#PST8    DRPSTP
     C                     ENDIF
     C           FMOID     IFEQ 'FF'
     C                     MOVELW#PST9    DRPSTP
     C                     ENDIF
      *
      ** Auto Transmission indicator
      *
     C                     MOVEL'N'       DRATRM
      *
      ** Customer Number (Mandatory)
      *
     C                     MOVELFCUST     ##CUST
      *
     C                     CALL 'CG9010'
     C                     PARM           ##RTCD  7
     C                     PARM '*GEN'    ##MODE 10
     C                     PARM W0CMT     ##CMT   3
     C                     PARM           ##CUST  6
     C                     PARM           ##UDCR
     C                     PARM           ##ITMA  8
      *
      ** Blank return code implies generate correspondence.
      ** CGD1270 => no error, but suppress output for this transaction.
      *
     C           ##RTCD    IFEQ *BLANK
     C           DRPTYP    CAT  ':':0     COLON  11 P
     C           COLON     CAT  DRPSTP:0  ##REFR    P
     C                     EXSR WRAPRF
     C                     END
      *
     C           ##RTCD    IFEQ *BLANK
     C                     MOVE 'Y'       ##COPD
     C                     ELSE
      *
     C           ##RTCD    IFNE 'CGD1270'
     C                     MOVEL'CG9010  'W0FILE
     C                     MOVEL##RTCD    W0KEY
     C                     Z-ADD21        W0ERNB
     C                     MOVEL'CGD1286' W0MSGD
     C                     MOVEL'CGUSRMSG'W0MSGF
     C                     EXSR SRERR
     C                     ENDIF
     C                     ENDIF
      *
     C                     MOVE ##ITMA    UFITEM
      *
     C           EXGENR    TAG
      *
      ** Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     C                     ENDSR
      *****************************************************************
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRPSSR
     C/SPACE 5
     C/COPY CGCPYSRC,SRERRC
     C/SPACE 5
     C/COPY CGCPYSRC,CGNWEX
** ##CPY  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2008
