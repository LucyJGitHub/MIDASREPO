     H***********                                                                             164405
     H        1                                                                               164405
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Nostro transfers input')                      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Dealing Module                                       *
     F*                                                               *
     F*  DL0035 - Nostro Transfers Input                              *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD022776           Date 23Aug16               *
      *  Prev Amend No. CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CSW212             Date 03May12               *
      *                 CRE073             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 23Feb10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247705             Date 15May07               *
      *                 244293             Date 14Dec06               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 232990 (218708)    Date 11Jul06               *
      *                 (240256)                                      *
      *                 CDL038             Date 10May05               *
      *                 240343             Date 14JuL06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 237063             Date 20Nov05               *
      *                 CSD031             Date 10Apr06               *
      *                 235601             Date 05Sep05               *
      *                 BUG8759            Date 30Sep05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CAS009             Date 16May05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CAS008             Date 16Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3937            Date 26Nov04               *
      *                 BUG4360            Date 27Sep04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2079            Date 28Apr04               *
      *                 CAAA03             Date 19Apr04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 CRE009             Date 30Aug02               *
      *                 CDL010             Date 02Aug02               *
      *                 CAS004             Date 26Jun02               *
      *                 217684             Date 12May03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 174149             Date 25Jun02               *
      *                 197513             Date 06Jun02               *
      *                 197873             Date 29May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 164405             Date 24May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      *                 164679             Date 28Mar00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CEU003             Date 05Nov97               *
     F*                 120827             Date 06Jul97               *
     F*                 CCB002             Date 11JUL96               *
     F*                 S01408             DATE 24JAN96               *
     F*                 096087             DATE 17JAN96               *
     F*                 091452             DATE 18AUG95               *
     F*                 S01444             DATE 11APR95               *
     F*                 S01408             DATE 06MAR95               *
     F*                 073516             DATE 12AUG94               *
     F*                 060712             DATE 13JUL94               *
     F*                 067362             DATE 08FEB94               *
     F*                 052693             DATE 13JAN94               *
     F*                 042757             DATE 12JAN94               *
     F*                 046303             DATE 03JAN94               *
     F*                 S01453             DATE 13DEC93               *
     F*                 060935             DATE 15NOV93               *
     F*                 042960             DATE 20AUG93               *
     F*                 E38323             DATE 29JUL92               *
     F*                 E42830             DATE 27JUL92               *
     F*                 E33165             DATE 10DEC91               *
     F*                 E32332             DATE 17OCT91               *
     F*                 BHF970             DATE 03MAY91               *
     F*                 S01310             DATE 03MAY91               *
     F*                 S01314             DATE 29JAN91               *
     F*                 E23407             DATE 17SEP90               *
     F*                 E21923             DATE 11AUG90               *
     F*                 E22217             DATE 07AUG90               *
     F*                 E22644             DATE 02AUG90               *
     F*                 E21631             DATE 27JUL90               *
     F*                 E17641             DATE 13JUN90               *
     F*                 E21835             DATE 07JUN90               *
     F*                 S01252             DATE 21MAR90               *
     F*                 S01251             DATE 21FEB90               *
     F*                 S01241             DATE 08MAR90               *
     F*                 BHF678             DATE 19SEP90               *
     F*                 E270               DATE 03APR90               *
     F*                 E20194             DATE 13NOV89               *
     F*                 E19095             DATE 30OCT89               *
     F*                 E16905             DATE 10/10/89              *
     F*                 E18569             DATE 25OCT89               *
     F*                 E19125             DATE 25OCT89               *
     F*                 S01195             DATE 20/07/89              *
     F*                 S01194             DATE 20/07/89              *
     F*                 S01117             DATE 20/07/89              *
     F*                 S01199             DATE 08/03/89              *
     F*                 S01154             DATE 03/11/88              *
     F*                 E13149             DATE 04/07/88              *
     F*                 E13148             DATE 01/07/88              *
     F*                 E11533             DATE 14/06/88              *
     F*                 E13142             DATE 13/05/88              *
     F*                 E11841             DATE 05/11/87              *
     F*                 E10533             DATE 27/03/87              *
     F*                 S01125             DATE 11/11/86              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD022776 - If book code is optional for deals, set to ICD    *
      *             default                                           *
      *           - Applied for MD-40716.                             *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  CSW212 - SWIFT 2012 Changes                                  *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  247705 - Applied fix 240343.                                 *
      *  244293 - Problem with '?' processing for book code field.    *
      *           It does not replace the field with the value        *
      *           selected and '?' is still reflected.                *
      *  218708 - Add book code field to input screen as this is      *
      *           needed for CAS001.                                  *
      *           Fix applied annotated as BUG8759.                   *
      *  CDL038 - Extended Deal Sub Type                              *
      *  240343 - Increased the LOTSF data structure from 59 to 61.   *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  235601 - Check for deal type/sub type combination.           *
      *  BUG8759- Apply 232990 (218708)                               *
      *           Add book code field to input screen as this is      *
      *           needed for CAS001.                                  *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CAS008 - IAS 39 Enhancements                                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3937 - Component LEC000100 fails                          *
      *  BUG4360- Invalid date on DEALSDB                             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2079 - Pay and Receive Nostro details are not shown       *
      *            during enquiry.                                    *
      *  CAAA03 - Webfacing Changes (Recompile)                       *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CRE009 - Projected Account Movements for RE accounts         *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  CAS004 - Hedge Accounting Phase A                            *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  174149 - There is no holiday checking for the value date.    *
      *           Display warning message when value date entered is  *
      *           a holiday.                                          *
      *  197513 - Pay/Receive Nostro accept '?' even if selection was *
      *           made. Manipulate nostro field by using MOVE/MOVEL   *
      *           operation to retrieve correct nostro value. Also,   *
      *           process Pay Nostro before Receive Nostro.           *
      *  197873 - Corruption of data occurred because of wrong        *
      *           position of fields in O specs.                      *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  164405 - Added a dump in the *INFSR subroutine to identify   *
      *           that the transaction program encountered an error.  *
      *           The H specs was also amended to cater for the dump  *
      *           operation.                                          *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
     F*  164679 - Apply fix 146142:                                   *
     F*           Program dump when inserting nostro transfer deal.   *
     F*            NOTE: Renamed field TRTP 5 to TRTPW 5 since it's   *
     F*                  description clashed with same field from file*
     F*                  DEALSDC. It has been introduced by CSE006    *
     F*                  (Repurchase Agreements enhancement).         *
     F*  CEU003 - EMU Dealing Settlement Ccy Conversion               *
     F*  120827 - Profit Centre Accounting defaulting                 *
     F*  CCB002 - COB Performance Enhancements                        *
     F*           Access now via access object                        *
     F*           MEMOS is now accessed via GL/RE key rather than old *
     F*           relative record number.                             *
     F*  S01408 - Addition of core hooks DL0035IIP1                   *
     F*                                  DL0035CCP1                   *
     F*                                  DL0035CCP2                   *
     F*                                  DL0035CCP3                   *
     F*  096087 - Array index error in ZF2C (RECOMPILE OVER ZF2C)     *
     F*  091452 - Should not produce confirmations for 'NX' deals     *
     F*  S01444 - Recompiled. (LF/DEALSALL - amended to include       *
     F*           historic deals files)                               *
     F*  S01408 - Addition of core hooks DL0035IIPG                   *
     F*                                  DL0035OOPG                   *
     F*                                  DL0035OOP1                   *
     F*  073516 - Use decimal point and thousand separator as set up  *
     F*           in ICD                                              *
     F*  060712 - Recompiled due to change in copy source ZF2C.       *
     F*  067362 - Clarified error message if enquiring on a historic  *
     F*           nostro transfer, i.e. if deal not found on LF/DEALS *
     F*           but is found on Historic Deals File LF/DLDEALL.     *
     F*           Added new message to MSG array (not annotated)      *
     F*         - Added MSG,15 - omitted when 060935 was collected    *
     F*  052693 - Array Index Error due to fix 042757. Program        *
     F*           failed to condition Index based on size of Array.   *
     F*  042757 - Projected Nostro account movement value dated on    *
     F*           a non-working day should be reflected on the next   *
     F*           working day (and not on the previous working day).  *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  S01453 - Margin and FX Positions/Points and Base Currency    *
     F*           Positions/Points added to Deals file.               *
     F*  060935 - Should be able to enquire Matured deals.            *
     F*  042960 - Chain to DEALSALL instead of DLDEALL to better      *
     F*           check for duplicate Deal Numbers.                   *
     F*  E38323 - Recompilation of the program done due to a          *
     F*           change in ZFWDT subroutine                          *
     F*  E42830 - RECOMPILED FOR CHANGE TO DISPLAY FILE.              *
     F*  E33165 - MT210S NAK/ED BECASUE NO FIELD :52a:/:50a:.         *
     F*           OUTPUT BRANCH INTERNAL CUSTOMER TO RECEIVE          *
     F*           ORDERING BANK (ROBN)                                *
     F*  E32332 - THE PROFIT CENTRE FIELD IS OPTIONAL. REMOVE CODE    *
     F*           WHICH SENDS AN ERROR MESSAGE IF IT IS NOT ENTERED   *
     F*           ALSO RESET THE PROFIT CENTRE FIELD AFTER ? IS USED  *
     F*  BHF970 - PAY/RECEIVE BRANCHES SET UP IN REVERSE              *
     F*  S01310 - MG/ME R10 CHANGES                                   *
     F*  S01314 - R10 PTF Incorporation Changes: the field lOT2 was   *
     F*           defined for file DLDEALL with a different length    *
     F*           from is definition on DEALS, preventing             *
     F*           compilation.                                        *
     F*  E23407 - OVERRIDE EXTERNALLY DESCRIBED FILE, TABLE, WITH     *
     F*           TABDLI AT COMPILATION TIME. (NOW REDUNDANT)         *
     F*           CHECK FOR MODULES RE(RETAIL 2) OR IA(INTEREST ON    *
     F*           ACCOUNTS), RATHER THAN RT(RETAIL 1).(MMODIFIED)     *
     F*  E21923 - SETON PAY/RECEIVE INDICATOR IF EVENT DATE LESS      *
     F*           THAN OR EQUAL TO (DATE OF NEXT WORKING DAY MINUS    *
     F*           ONE PLUS TELEX NOTICE DAYS).                        *
     F*  E22217 - CHANGED #RTRN MESSAGE HANDLING TO PROCESS ALL       *
     F*           MESSAGE ID'S.                                       *
     F*  E22644 - DEAL NUMBER CANNOT BE WITHIN AUTOMATIC DEAL         *
     F*           DEAL NUMBERS RANGE                                  *
     F*  E21631 - 'F10 TO DELETE' SHOULD ONLY BE DISPLAYED            *
     F*           WHEN A REVERSAL IS BEING PERFORMED.                 *
     F*  E17641 - WHEN INSERTING A NEW DEAL THERE WAS NO CHECK        *
     F*           MADE TO SEE IF THE DEAL NUMBER ALREADY EXISTED      *
     F*           ON FILE AS HISTORIC.                                *
     F*  E21835 - AS SDMMODPD IS USED IN OTHER PGMS IF THE FILE IS    *
     F*           ALREADY OPEN BEFORE THIS PGM IS CALLED,THE FILE     *
     F*           POINTER WILL BE AT END OF FILE.SUBSEQUENTLY SETLL   *
     F*           CHANGED SO THAT IT PICKS UP THE FIRST(& ONLY) RECD  *
     F*           (NOW REDUNDANT - ACCESS OBJECT USED)                *
     F*  S01252 - ADDITIONAL SPARE WINDOW MANAGER PARAMETER           *
     F*  S01251 - SYNON FIELD/PROGRAM NAME CHANGES                    *
     F*  S01241 - WINDOW INCORPORATION                                *
     F*  BHF678 - DL1810 FALLING OVER WITH DBASE ERROR AT 33 WITH     *
     F*           A '000000' CUSTOMER NUMBER.                         *
     F*  E270   - AOPRFMR0 (Profit centre default prog) has new       *
     F*           parameters.                                         *
     F*  E20194 - ADDITION TO FIX E16905.                             *
     F*  E19095 - IF BOTH PAY AND RECEIVE SETTLEMENT TYPES ARE        *
     F*           INCORRECT RECEIVE METHOD IS NOT HIGHLIGHTED.        *
     F*  E16905 - NO CONFIRMATIONS SHOULD BE OUTPUT FOR NX DEALS.     *
     F*           REMOVE PART OF E11533.                              *
     F*  E18569 - Insert possible using deal numbers already          *
     F*           allocated to complete FX & MM deals.                *
     F*  E19125 - NOT ALL PACKED FIELDS ARE BEING OUTPUT TO DEALSDB.  *
     F*  S01195 - NEW HOLIDAY PROCESSING                              *
     F*  S01194 - NEW STANDING DATA - ACCESS PROGRAMS                 *
     F*  S01117 - RELEASE 10 - MULTIBRANCHING                         *
     F*  S01199 -  HELP SYSTEM.                                    *
     F*  S01154 - REAL TIME STATEMENTS - GENERATION OF                *
     F*           ACCOUNTS MOVEMENTS FILE.                            *
     F*  E13149 - DEBIT SETTLEMENT TYPE NOT HIGHLIGHTED IF DEBIT      *
     F*           AND CREDIT SETTLEMENT TYPES IN ERROR.               *
     F*           PAY AND RECEIVE SETTLEMENT INSTRUCTIONS WERE        *
     F*           INTERCHANGED BETWEEN DISPLAY FILE AND PROGRAM.      *
     F*           E11064 AS FEATURED IN DL0035FM RESULTED IN          *
     F*           CHANGES TO BUFFER POSITIONS IN DDS EXPANDED         *
     F*           SOURCE, YET THERE WAS A FAILURE TO ADJUST THE       *
     F*           'O' SPEC DL0035FMD.(N.B. DDS IS PGM DESCRIBED)      *
     F*  E13148 - ERROR NUMBER NOT DISPLAYED FOR BLANK CCY ENTRY      *
     F*           IF A FIELD AFTER THE CCY FIELD IS ALSO IN ERROR.    *
     F*  E11533 - PRODUCE NOSTRO CONFIRMATIONS                        *
     F*           INTEREST RATE OUTPUT AS 11,7 SHOULD BE 13,8         *
     F*  E13142 - CORRECT F SPEC COMMENTS DESCRIBING INDICATORS       *
     F*  E11841 - TO DISPLAY THE MESSAGE 'REVERSED DEAL' WHEN         *
     F*           ENQUIRING ON A REVERSED DEAL.                       *
     F*  E10533 - PGM NAME NOT PASSED TO PARAM HBPGM CAUSING          *
     F*           CPF MSG INSTEAD OF HELP TEXT.                       *
     F*  S01125 - INCORRECT CHAIN TO GET BRANCH INTERNAL CUSTOMER     *
     F*           NUMBER WHEN IN SINGLE BRANCH ENVIRONMENT            *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                       *
     F*                                                               *
0011 F* 01            WRKSTN FILE - INITIAL SCREEN                    *
0013 F* 02                        - INSERT SCREEN                     *
0014 F* 04                        - REVERSAL SCREEN                   *
0015 F* 05            DEALS FILE  - REVERSED DEAL DETAIL RECORD       *
0016 F* 06                        - ACTIVE DEAL DETAIL RECORD         *
0017 F* 07                        - EXPIRED DEAL(SWAP LEG 1)DETAIL REC*
0018 F* 08                        - TRAILER RECORD                    *
0019 F* 09                        - DELETED DEAL RECORD               *
0020 F**10************MEMOS FILE  - ACTIVE DETAIL RECORD              *   CCB002
0020 F* 10            AOMEMSU0    - ACCESS OBJ. RETURN CODE INDICATER *   CCB002
0021 F*       11      SCREEN OUTPUT FROM FILE                         *
0022 F**12************1ST TIME THROUGH RPG CYCLE                      *   E13142
0022 F* 12            DEALS FILE  - MATURED DEAL RECORD               *   060935
0023 F* 13            DTRIX FILE  - HEADER RECORD                     *
     F* 14            Write to DLDLDBQD                               *                      BUG3937
0025 F**15************OLPOS FILE  - ACTIVE DETAIL RECORD              *   E13142
0022 F* 15            DEALS FILE  - HISTORIC DEAL RECORD              *   067362
0026 F* 16            PRONO FILE  - ACTIVE DETAIL RECORD              *
0015 F**17************DEALS2 FILE - REVERSED DEAL DETAIL RECORD       *   E13142
0016 F**18************            - ACTIVE DEAL DETAIL RECORD         *   E13142
0017 F**19************            - EXPIRED DEAL(SWAP LEG 1)DETAIL REC*   E13142
0030 F**20************SNAME FILE  - ACTIVE DETAIL RECORD              *   E13142
0031 F**21************CLINT FILE  - ACTIVE DETAIL RECORD              *   E13142
     F* 20  - 'F10 TO DELETE' TO BE DISPLAYED                         *   E21631
     F* 17  - ON IF MULTIBRANCH INDICATOR IS 'Y' (@MBIN DTAARA/RUNDAT)*   S01117
     F* 18  - ON IF PROFIT CENTRE FIELD IS INVAL (PRFCNT DSPF/DL0035FM*   S01117
     F* 19  - ON IF ORIGINATING BRANCH FIELD IS INVALID (ORBRCH DSPF) *   S01117
0032 F**                                                              *
0033 F*       22      DEALS FILE CHAIN FAIL INDICATOR                 *
0034 F*       23      PROTECT INITIAL SCREEN FIELDS                   *
0035 F*       24      OUTPUT BUY AMOUNT WITH NO DECIMAL POSITIONS /   *
0036 F*                  'OP' DEAL TYPE IN UPDATE PROCEDURE           *
0037 F*       25      OUTPUT BUY AMOUNT WITH 1 DECIMAL POSITION /     *
0038 F*                  'OT' DEAL TYPE IN UPDATE PROCEDURE           *
0039 F*       26      OUTPUT BUY AMOUNT WITH TWO DECIMAL POSITIONS /  *
0040 F*                  'SW' DEAL TYPE IN UPDATE PROCEDURE           *
0041 F*       27      OUTPUT BUY AMOUNT WITH THREE DECIMAL POSITIONS /*
0042 F*                  NON 'SW' DEAL 'SWAP' IN UPDATE PROCEDURE     *
0043 F*       28      CHAIN FAIL INDICATOR                            *
0044 F********29      TABLE FILE CHAIN FAIL INDICATOR                 *   S01194
0044 F*       29      CHAIN FAIL INDICATOR                            *   S01194
0046 F*       30      OUTPUT SELL AMOUNT WITH NO DECIMAL POSITIONS    *
0047 F*       31      ACTION CODE 'I'                                 *
0048 F********32******            'A'                                 *   E13142
0047 F*       32      ERROR ON BOOK CODE (USED IN DSPF)               *  BUG8759
0049 F*       33                  'R'                                 *
0050 F*       34                  'E'                                 *
0051 F********35******OUTPUT SELL AMOUNT WITH ONE DECIMAL POSITION    *   E13142
0052 F********36******                   WITH TWO DECIMAL POSITIONS   *   E13142
0053 F********37******                   WITH THREE DECIMAL POSITIONS *   E13142
0054 F*       35      ORIGINATING-BRANCH-USED FLAG = Y (used in DSPF) *   S01117
0054 F*       36      PROFIT-CENTRE-USED FLAG = Y (used in DSPF)      *   S01117
     F*       37      DATABASE ERRORS IN FIRST CYCLE PROCESSING       *   E22644
0054 F*       38      FIRST CYCLE CALCULATIONS PERFORMED/OUTPUT TO SCR*
0055 F*       39      OUTPUT SCREEN FIELDS BACK TO SCREEN             *
0056 F*       40      OUTPUT FULL SCREEN                              *
0057 F**                                                              *
0058 F*       41      INVALID - DEAL NO.                              *
0059 F*       42              - ACTION CODE                           *
0060 F*       43              - DEAL TYPE                             *
0061 F*       44              - DEAL SUB-TYPE                         *
0062 F*       45              - DEAL DATE                             *
0063 F*       46              - BRANCH CODE                           *
0064 F*       47              - BROKER                                *
0065 F*       48              - BROKERAGE                             *
0066 F*       49              - SWAP/OPTION DEAL NO.                  *
0067 F*       50              - CUSTOMER                              *
0068 F*       51              - VALUE DATE                            *
0069 F*       52              - OPTION TO DATE                        *
0070 F*       53              - BUY CCY                               *
0071 F*       54              - BUY AMOUNT                            *
0072 F*       55              - EXCHANGE RATE                         *
0073 F*       56              - FEDERAL FUNDS INDICATOR               *
0074 F*       57              - SELL CCY                              *
0075 F*       58              - SELL AMOUNT                           *
0076 F*       59              - BASE CCY EQUIVALENT                   *
0077 F*       60              - OVERRIDE INDICATOR                    *
0078 F*       61      UPDATE OLPOS DETAIL RECORD                      *
0079 F*       62            -PRONO DETAIL RECORD                      *
0080 F*       63           - MEMOS DETAIL RECORD                      *
0081 F*       64       SECOND SCREEN LABELS NON-DISPLAY               *
0082 F*       65      INVALID - SETTLEMENT METHOD (RECEIVE)           *
0083 F*       66              - SETTLEMENT METHOD (PAYMENT)           *
0084 F*       67              - OUR RECEIVE BANK/A-C DEBITED          *
0085 F*       68              - OUR PAY BANK/A-C CREDITED             *
0086 F*       69              - THEIR PAY BANK /                      *
0087 F*                  ONE MEMO DETAIL RECORD UPDATED               *
0088 F*       70      INVALID - THEIR RECEIVE BANK /                  *
0089 F*                  TWO MEMO DETAIL RECORDS UPDATED              *
0090 F*       71      INVALID - FOR A-C OF /                          *
0091 F*                  THREE MEMOS DETAIL RECORDS UPDATED           *
0092 F*       72      INVALID - SPECIAL INSTRUCTIONS /                *
0093 F*                  FOUR MEMOS DETAIL RECORDS UPDATED            *
0094 F*       73      RECEIVE INSTRUCTIONS BEING PROCESSED            *
0095 F*       74      ALL-PURPOSE WORK INDICATOR /                    *
0096 F*                  SETTLEMENT TYPE '04' IN UPDATE PROCEDURE     *
0097 F*       75      ALL-PURPOSE WORK INDICATOR /                    *
0098 F*                  SETTLEMENT TYPE '05' IN UPDATE PROCEDURE     *
0099 F*       76      ALL-PURPOSE WORK INDICATOR /                    *
0100 F*                  SETTLEMENT TYPE '14' IN UPDATE PROCEDURE     *
0101 F*       77      ALL-PURPOSE WORK INDICATOR                      *
0102 F*       78      PROTECT RECEIPT/PAYMENT INSTRUCTIONS ON FULL SCR*
0103 F*       79      PROTECT AMEND SCREEN FIELDS                     *
0104 F*       80      NO ERROR CONDITIONS FOUND                       *
0105 F*       81      RELEASE DEALS FILE                              *
0106 F*       82      RECORD HAS BEEN UPDATED BY ANOTHER WORK-STATION *
0105 F*       83      RELEASE DEALS2 FILE                             *
     F*       84      DEALS 2 CHAIN FAIL                              *
0109 F*       85      RELEASE DEAL TRANSACTIONS INDEX HEADER FILE     *
0110 F*       86      END OF JOB INDICATOR                            *
0111 F*       87      UPDATE DEALS FILE TRAILER                       *
0112 F*       88                        DETAIL RECORD                 *
0118 F*       89      SET ON IF ERROR DURING READ FROM THE WORK STATN/*
0118 F*               HELP KEY PRESSED                                *
0114 F**                                                              *
0115 F*    90-99      STANDARD SUB-ROUTINE INDICATORS.                *
     F*****************************************************************
     F/COPY WNCPYSRC,DL0035F001
0119 F****DL0035FMCF  F     235            WORKSTN      KPASS  *NOIND     S01117
0119 F*DL0035FMCF***F***245************WORKSTN                      S01117E21631
0119 FDL0035FMCF  F     246            WORKSTN                            E21631
0121 F****DEALS   UF  F     400  6AI     2 DISK                           S01117
0121 F****DEALS   UF  F    1049  6AI     2 DISK                     S01117S01453
0121 F***DEALS***UF* F    1135  6AI     2 DISK                     S01453 CEU003
     F***DEALS***UF* F    1208  6AI     2 DISK                                         CEU003 CAS004
     F***DEALS** UF  F    2247  6AI     2 DISK                                         CAS004 CAS005
     F***DEALS** UF  F    2441  6AI     2 DISK                                         CAS005 CAS006
     F***DEALS** UF  F    2448  6AI     2 DISK                                         CAS006 CGL029
     F***DEALS   UF  F    2540  6AI     2 DISK                                         CGL029 CAS008
     FDEALS   UF  F    2550  6AI     2 DISK                                                   CAS008
     F                                              KCOMIT
0121 F*DLDEALL*IF**F****400**6AI**** 2 DISK                         E17641S01314
     F***DLDEALL*IF**F     413  6AI     2 DISK                     S01314 042960
     FDEALSALLIF  E           K        DISK         KINFSR INFSR          042960
     F*                                                                   042960
     F** All Deals. DRS and Midas                                         042960
     F*                                                                   042960
     F***CADENQLLIF**E           K        DISK         KINFSR INFSRE18569 042960
0122 F*MEMOS***UF**F******40            DISK                           U2 CCB002
     F********************                          KCOMIT                CCB002
     F/COPY WNCPYSRC,DLH00190
0124 FDTRIXHH UF  F      40            DISK
     F                                              KCOMIT
0124 FDTRIXDD O   F      40            DISK
     F                                              KCOMIT
0126 FPRONO   UF  F     128  5AI     2 DISK
     F                                              KCOMIT
0129 F*****TABLE   IF  F      96 12AI     2 DISK                          S01194
0132 F***ACCNT***IF**F     400 15AI     2 DISK                            S01117
0132 F***ACCNT** IF  F     400 18AI     2 DISK                                         S01117 CGL029
     FACCNT   IF  F     573 24AI     2 DISK                                                   CGL029
     FRSACMTPDO   E                    DISK                               S01154
     F                                              KCOMIT                S01154
      *                                                                   S01117
     F****DEALSDB O   F     400            DISK                      A    S01117
     F****DEALSDB O   F    1049            DISK                    AS01117S01453
     F***DEALSDB*O** F    1135            DISK                   A S01453 CEU003
     F***DEALSDB*O** F    1208            DISK                      A                  CEU003 CAS004
     F***DEALSDB O   F    1277            DISK                      A                  CAS004 CAS005
     F***DEALSDB O   F    1291            DISK                      A                  CAS005 CGL029
     F*DEALSDB*O**F****1363************DISK**********************A                     CGL029 CDL038
     F***DEALSDB*O***F    1367            DISK                      A                  CDL038 CSW212
     FDEALSDB O   F    2025            DISK                      A                            CSW212
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FDLDLDBQDO   F      59            DISK                      A                           BUG3937
     F                                              KCOMIT                                   BUG3937
     F                                              KINFSR INFSR                             BUG3937
     FFDDLNMLLIF  E                    DISK                               E22644
      *                                                                                       CSD015
      ** Compliance Watch Hit List                                                            CSD015
      *                                                                                       CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
     FFDDTSTL1IF  E           K        DISK                                                   235601
      *                                                                                       CSD015
     FSDTCLDPDIF  E                    DISK                                                   CDL038
     F/COPY WNCPYSRC,DL0035F002
     E                    CPY@    1   1 80
0135 E                    HCCY       25  3               HOLIDAY CCYS
0136 E                    ZHC        50  3               CURRENCY CODES
0137 E                    ZYDY    4   4  4 0             ZDATE1 YEAR
0138 E                    ZMDY   13  13  3 0             ZDATE1 MONTH
0139 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
0140 E                    ZA1        16  1               ZALIGN INPUT
0141 E                    ZA2        16  1               ZALIGN OUTPUT
0146 E                    PNB         5 15 0             PROJ.NOSTRO  BALS
0147 E                    PND         5  5 0             PRONO BAL. DATES
     E/COPY WNCPYSRC,DL0035E001
0148 E                    PNE         6  5 0             PRONO BAL. DATES
0151 E                    ERCD       38  4               ERROR CODES
0152 E********************MSG     1  10 76               ERROR MESSAGES   S01117
0152 E********************MSG     1  13 76          ERROR MESSAGES  S01117E22644
0152 E********************MSG     1  14 76          ERROR MESSAGES E22644 060935
0152 E********************MSG     1  15 76          ERROR MESSAGES  060935067362
     E********************MSG     1  16 76               ERROR MESSAGES   067362             BUG8759
     E                    MSG     1  18 76               ERROR MESSAGES                      BUG8759
     E                    POW     1   7  7 3             FOR CCY CONV
     E                    ZOB       100  3               SPF/USER BRS     S01117
      *                                                                   073516
     E                    @Z         14  1                                073516
      *                                                                   073516
      * ARRAY @Z STORES AMOUNT WITH DECIMAL (EXECUTION TIME  ARRAY)       073516
     E                    @Q         13  1 0                              073516
      *                                                                   073516
      * ARRAY @Q STORES AMOUNT AS IT IS (EXECUTION TIME  ARRAY)           073516
      *                                                                   073516
     E                    XOT     1  13 25                                                    CSD015
      *                                                                                       CSD015
      ** XML Opening Tags for the Compliance Engine                                           CSD015
      *                                                                                       CSD015
     E                    XCT     1  13 25                                                    CSD015
      *                                                                                       CSD015
      ** XML Closing Tags for the Compliance Engine                                           CSD015
      *                                                                                       CSD015
     E                    WLF        13 35                                                    CSD015
      *                                                                                       CSD015
      ** Watch List Fields Array.                                                             CSD015
      *                                                                                       CSD015
     E                    WSD        13 35                                                    CSD015
      *                                                                                       CSD015
      ** Watch List Fields Standing Data Array.                                               CSD015
      *                                                                                       CSD015
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZF2CE                                                  S01195
0154 IDL0035FMNS  01   1 CS   2 CF                                        S01117
0155 I       OR   02   1 CS   2 CI                                        S01117
0157 I       OR   04   1 CS   2 CR                                        S01117
0158 I                                        1   2 SRNID                 S01117
0159 I                                        3   8 DEALNO                S01117
0160 I                                        9   9 ACTION                S01117
0162 I                                       10  11 SUBTPE          44    S01117
0164 I                                       12  14 BRCODE                S01117
0169 I                                       15  20 VALDAT          51    S01117
0171 I                                       21  23 BUYCCY          53    S01117
0172 I                                       24  37 BUYAMT          54    S01117
     I                                       38  41 PRFCNT                S01117
     I                                       42  44 ORBRCH                S01117
     I                                       45  46 BKCODE                                   BUG8759
     I                                       47  48 PSETT                                    BUG8759
     I                                       49  50 OPAYCR                                   BUG8759
     I                                       51  52 RSETT                                    BUG8759
     I                                       53  54 ORECDR                                   BUG8759
     I                                       55  60 DEALNO          41                       BUG8759
     I                                       61  61 ACTION          42                       BUG8759
     I                                        1  61 LOTSF                                    BUG8759
0181 I**************                         45  46 PSETT                 S01117             BUG8759
0182 I**************                         47  48 OPAYCR                S01117             BUG8759
0179 I**************                         49  50 RSETT                 S01117             BUG8759
0180 I**************                         51  52 ORECDR                S01117             BUG8759
0187 I**************                         53  58 DEALNO          41    S01117             BUG8759
0188 I**************                         59  59 ACTION          42    S01117             BUG8759
0189 I**************                          1  59 LOTSF                 S01117             BUG8759
0154 I*DL0035FMNS**01***2 CS   3 CF                                       S01117
0155 I*****  OR   02   2 CS   3 CI                                        S01117
0157 I*****  OR   04   2 CS   3 CR                                        S01117
0158 I*****                                   1   1 *IN89                 S01117
0158 I*****                                   2   3 SRNID                 S01117
0159 I*****                                   4   9 DEALNO                S01117
0160 I*****                                  10  10 ACTION                S01117
0162 I*****                                  11  12 SUBTPE          44    S01117
0164 I*****                                  13  15 BRCODE                S01117
0169 I*****                                  16  21 VALDAT          51    S01117
0171 I*****                                  22  24 BUYCCY          53    S01117
0172 I*****                                  25  38 BUYAMT          54    S01117
0179 I*************************              39  40 RSETT                 E13149
0180 I*************************              41  42 ORECDR                E13149
0181 I*************************              43  44 PSETT                 E13149
0182 I*************************              45  46 OPAYCR                E13149
0187 I**********                             47  52 DEALNO          41    S01117
0188 I**********                             53  53 ACTION          42    S01117
0189 I**********                              2  53 LOTSF                 S01117
0190 I**   WORKSTN FILE CATCH-ALL
0191 I*
0192 I        NS
0193 I*
0194 I*    DEALS FILE - DETAIL RECORD, NOSTRO TRANSFERS (FX DEALS)
0195 I*
0196 IDEALS   NS  05   1 CR   8 CB  10 C0
0197 I       OR   06   1 CD   8 CB  10 C0
0197 I       OR   12   1 CM   8 CB  10 C0                                 060935
0199 I                                        1   1 RECI
0200 I                                        2   70DLNO
0201 I                                        8   8 RCDT
0202 I                                        9  100RCDC
0203 I**********                             11  160CNUM                                      CSD027
0203 I                                       11  16 CNUM                                      CSD027
0204 I***************************************17  190BRCD                  S01117
0204 I                                       17  19 BRCA                  S01117
0205 I                                       20  21 DTYP
0206 I                                       22  23 DLST
0207 I                                    P  24  260DDAT
0208 I                                    P  27  290VDAT
0209 I                                    P  30  320OTDT
0210 I                                       35  38 BRKC
0211 I                                    P  39  450BAGE
0212 I                                       46  48 PUCY
0213 I                                    P  49  550PUAM
0214 I                                    P  56  628EXRT
0215 I                                       86  88 SLCY
0216 I                                    P  89  950SLAM
0217 I                                    P 117 1230BCEQ
0218 I                                    P 124 1300OBCE
0219 I                                    P 131 1378LCXR
0220 I                                      138 1390PCST
0221 I**********                            140 151 OPCA                                      CGL029
     I**********                            140 151 OPCAQQ                            CGL029 BUG2079
0221 I**********                            140 141 OPCA2                                    BUG2079
0222 I                                      152 161 TSCN
0223 I                                      162 1630SCST
0224 I**********                            164 175 OSCA                                      CGL029
     I**********                            164 175 OSCAQQ                            CGL029 BUG2079
0224 I**********                            164 165 OSCA2                                    BUG2079
0225 I                                      176 185 TPCN
0226 I                                    P 192 1980ORPA
0227 I                                    P 205 2110ORSA
0228 I                                      212 2120FSLI
0229 I                                    P 213 2187INCR
0230 I                                      219 2190IICM
0231 I                                    P 220 2260SWIA
0232 I                                    P 227 2327EXPR
0233 I                                      233 2330EICM
0234 I                                    P 234 2400SWEA
0235 I                                    P 241 2470SPPD
0236 I                                    P 248 2540SPLA
0237 I                                      255 257 SPLC
0238 I**************************************285 290 SODN                  042960
0238 I                                      285 2900SODN                  042960
0239 I                                      300 309 FACO
0240 I                                      310 344 SPI
0241 I                                      370 370 DNSI
0242 I                                      371 371 DSTI
0243 I                                      372 372 CNFI
0244 I                                      373 373 ACEI
0245 I                                      374 374 TLXI
0246 I                                    P 391 3930ORED
0247 I                                    P 394 3960LCD
0248 I                                      397 397 CHTP
0249 I                                    P 398 4000TNLUD
     I                                      401 402 BOKC                                     BUG8759
     I                                     10371039 ORBR                  S01117
     I                                     10401043 PRFC                  S01117
     I                                     10441046 ROBR                  S01117
     I                                     10471049 POBR                  S01117
     I                                     12001202 RSCY                  CEU003
     I                                     12031205 PSCY                  CEU003
     I                                     12061208 IC72                  CEU003
     I                                     12921293 OPCA2                                    BUG2079
     I                                     12921309 OPCA                                      CGL029
     I                                     13101311 OSCA2                                    BUG2079
     I                                     13101327 OSCA                                      CGL029
     I                                     13761410 DSR1                                      CSW212
     I                                     14111445 DSR2                                      CSW212
     I                                     14461480 DSR3                                      CSW212
     I                                     14811515 DSR4                                      CSW212
     I                                     15161550 DSR5                                      CSW212
     I                                     15511585 DSR6                                      CSW212
     I                                     15861620 SSR1                                      CSW212
     I                                     16211655 SSR2                                      CSW212
     I                                     16561690 SSR3                                      CSW212
     I                                     16911725 SSR4                                      CSW212
     I                                     17261760 SSR5                                      CSW212
     I                                     17611795 SSR6                                      CSW212
     I                                     17961830 CND1                                      CSW212
     I                                     18311865 CND2                                      CSW212
     I                                     18661900 CND3                                      CSW212
     I                                     19011935 CND4                                      CSW212
     I                                     19361970 CND5                                      CSW212
     I                                     19712005 CND6                                      CSW212
     I                                     200620090ISDA                                      CSW212
     I                                     20102015 AGTY                                      CSW212
     I                                     201620210AGDT                                      CSW212
     I                                     202220230AGVV                                      CSW212
     I                                     202420250AGVC                                      CSW212
0250 I                                        1 256 LOT1
0251 I**************************************257 400 LOT2                  S01117
     I                                      257 413 LOT2                  S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL0035IIPG                                           S01408
     I*                                                                   S01408
0252 I*    DEALS FILE -TRAILER RECORD.
0253 I*
0254 IDEALS   NS  08   1 CT
0255 I                                        1   1 RECI
0256 I                                        2   70DLNO
0257 I                                        8   8 RCDT
0258 I                                        9  100RCDC
0259 I**********                             11  160CUSNUM                                    CSD027
0259 I                                       11  16 CUSNUM                                    CSD027
0260 I                                    P  17  190NORE
0261 I                                    P  20  220FLSZ
0262 I                                    P  23  250NLRB
0263 I                                    P  26  280NINS
0264 I                                    P  29  310NDEL
0265 I                                    P  32  340NLRA
0266 I                                    P  35  420VLBF
0267 I                                    P  43  440VLBL
0268 I                                    P  45  520VRIF
0269 I                                    P  53  540VRIL
0270 I                                    P  55  620VRDF
0271 I                                    P  63  640VRDL
0272 I                                    P  65  720VLAF
0273 I                                    P  73  740VLAL
0274 I                                    P  75  770DTMR
0275 I                                    P  78  800ITMR
0276 I                                    P 394 3960LCD
0277 I                                      397 397 CHTP
0278 I                                    P 398 4000TNLU
0279 I                                        1 256 LOT1T
0280 I                                      257 400 LOT2T
0281 I**   DEALS FILE - DELETED RECORD.
0282 I        NS  09   1 C*
0283 I**   DEALS FILE - CATCH-ALL
0284 I        NS
     I***********                                                         042960
     I***********                                                         042960
0283 I*****DLDEALL*FILE*-*DETAIL*RECORD*-*NOSTRO*TRANSFERS.******* E17641 042960
0284 I***********                                                  E17641 042960
     I***DLDEALL*NS       1 CH                                     E17641 042960
     I****************************************1 256 LOT1           E17641 042960
     I************************************* 257 400 LOT2            E17641S01314
     I**************************************257 413 LOT2           S01314 042960
     I*****DLDEALL*FILE*-*CATCH-ALL******************************* E17641 042960
     I********NS*                                                  E17641 042960
     I****************************************1   1 RECI           E17641 042960
     I***********                                                  E17641 042960
     I*                                                                   E17641
0314 I*    DEAL TRANSACTIONS INDEX FILE - HEADER RECORD.
0315 I*
0316 IDTRIXHH NS  13   1 CH
0317 I                                        1   1 RECI
0318 I                                        2   2 RCDT
0319 I                                        3   80DLNO
0324 I                                    P  21  230RRLX
0325 I                                    P  24  260RRXP
0326 I                                    P  27  290NDLR
0327 I                                    P  30  320NDAR
0328 I                                       33  330STPI
0330 I                                    P  38  400TNLU
0331 I                                        1  40 LOT
0332 I*
0355 I*    DTRIX FILE - CATCH-ALL.
0356 I        NS
0357 I*
0358 I*    PROJECTED NOSTRO BALANCES - DETAIL RECORD.
0359 I*
0360 IPRONO   NS  16   1 CD
0361 I                                        1   1 RECI
0362 I                                        2   4 CCY
0363 I                                        5   60NOSN
0364 I                                    P   7  46 PNB
0365 I                                    P  47  61 PND
0366 I**********                             62  670CNUM                                      CSD027
0366 I                                       62  67 CNUM                                      CSD027
0367 I                                       68  77 CSNM
0368 I                                    P 126 1280TNLU
0369 I                                        1 128 LOTA
0370 I**   PRONO FILE - CATCH-ALL
0371 I        NS
0402 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0403 I*****                                                               S01194
0404 I*****TABLE   NS       2 C0   3 C1  12 C1                            S01194
0405 I*****  AND      13 C0                                               S01194
0406 I*****                                   1   1 RECI                  S01194
0407 I*****                                   2   30RECT                  S01194
0408 I*****                                  12  130RCDE                  S01194
0409 I*****                                  14  66 TITL                  S01194
0410 I*****                                  67  67 DATF                  S01194
0411 I***************************************68  70 DFBR            S01117S01194
0411 I*****                                  68  70 DFBM            S01117S01194
0412 I*****                                  74  74 MODI1                 S01194
0413 I*****                                  75  75 MODI2                 S01194
0414 I*****                                  76  76 MODI3                 S01194
0415 I*****                               P  77  790RUND                  S01194
0416 I*****                                  80  86 RUNA                  S01194
0417 I*****                                  87  870SFLG                  S01194
0418 I*****                               P  90  920LCD                   S01194
0419 I*****                                  93  93 CHTP                  S01194
0420 I*****                               P  94  960TNLU                  S01194
0421 I*****                                                               S01194
0422 I*****                                                               S01194
0423 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 2.               S01194
0424 I*****                                                               S01194
0425 I*****TABLE   NS       1 CD   2 C0   3 C1                            S01194
0426 I*****  AND      12 C1  13 C1                                        S01194
0427 I*****                                   1   1 RECI                  S01194
0428 I*****                                  14  16 BCCY                  S01194
0429 I*****                                  44  460BVLP                  S01194
0430 I*****                                  47  49 LOCY                  S01194
     I*****                                  53  53 MBIN                  S01194
0431 I*****                                                               S01194
0432 I*****                                                               S01194
0440 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 5.               S01194
0441 I*****                                                               S01194
0442 I*****TABLE   NS       1 CD   2 C0   3 C1                            S01194
0443 I*****  AND      12 C4  13 C0                                        S01194
0444 I*****                                   1   1 RECI                  S01194
0445 I*****                                  22  22 TLII                  S01194
0446 I***************************************36  38 DLBR            S01117S01194
0446 I*****                                  36  38 TRBR            S01117S01194
0447 I*****                                  47  49 USCY                  S01194
     I*****                                  62  62 OBUV            S01117S01194
0448 I*****                                                               S01194
0449 I*****TABLE FILE - CURRENCIES RECORD 1.                              S01194
0450 I*****                                                               S01194
0451 I*****TABLE   NS       1 CD   2 C2   3 C0                            S01194
0452 I*****  AND      13 C1                                               S01194
0453 I*****                                   1   1 RECI                  S01194
0454 I*****                                   2   30RECT                  S01194
0455 I*****                                  10  12 CCY                   S01194
0456 I*****                                  13  130SREC                  S01194
0457 I*****                                  14  27 CCNM                  S01194
0458 I*****                               P  28  348SPOT                  S01194
0459 I*****                                  38  380CDP                   S01194
0460 I*****                                  39  390TNOT                  S01194
0461 I*****                                  40  40 DCCY                  S01194
0462 I*****                                  86  860MDIN                  S01194
0463 I*****                                                               S01194
0478 I*****                                                               S01194
0479 I*****TABLE FILE - HOLIDAY RECORD.                                   S01194
0480 I*****   E-EXCLUDE, I-INCLUDE.                                       S01194
0481 I*****                                                               S01194
0482 I*****TABLE   NS       1 CD   2 C2   3 C2                            S01194
0483 I*****  AND      14 CE                                               S01194
0484 I*****  OR        1 CD   2 C2   3 C2                                 S01194
0485 I*****  AND      14 CI                                               S01194
0486 I*****                                   1   1 RECI                  S01194
0487 I*****                                   2   30RECT                  S01194
0488 I*****                                   8  120HOL                   S01194
0489 I*****                                  13  130SREC                  S01194
0490 I*****                                  14  14 INEX                  S01194
0491 I*****                                  15  89 HCCY                  S01194
0492 I*****                               P  90  920LCD                   S01194
0493 I*****                                  93  93 CHTP                  S01194
0494 I*****                               P  94  960TNLU                  S01194
0495 I*****TABLE FILE - NOSTROS RECORD.                                   S01194
0496 I*****                                                               S01194
0497 I*****TABLE   NS       1 CD   2 C7   3 C0                            S01194
0498 I*****                                   1   1 RECI                  S01194
0499 I*****                                   2   30RECT                  S01194
0500 I*****                                   9  11 CCY                   S01194
0501 I*****                                  12  130NOSN                  S01194
0502 I*****                                  16  29 ONAC                  S01194
0503 I*****                                  30  350CNUM                  S01194
0504 I*****                                  36  370ACSQ                  S01194
0505 I*****                                  38  410ACOD                  S01194
     I*****                                  67  69 BRCDN           S01117S01194
0506 I*****                               P  90  920LCD                   S01194
0507 I*****                                  93  93 CHTP                  S01194
0508 I*****                               P  94  960TNLU                  S01194
0509 I*****TABLE FILE - BRANCH CODES RECORD.                              S01194
0510 I*****                                                               S01194
0511 I*****TABLE   NS       1 CD   2 C1   3 C0                            S01194
0512 I*****                                   1   1 RECI                  S01194
0513 I*****                                   2   30RECT                  S01194
0514 I***************************************11  130BRCD            S01117S01194
0514 I*****                                  11  130BRCA            S01117S01194
0515 I*****                                  14  43 BRNM                  S01194
0516 I*****                                  44  490BICN                  S01194
0517 I*****                                  50  51 LOCC                  S01194
0518 I***************************************52  53 CMPY            S01117S01194
0518 I*****                                  52  53 CMPYM           S01117S01194
     I***************************************78  790SACS            S01117S01194
0519 I*****                               P  90  920LCD                   S01194
0520 I*****                                  93  93 CHTP                  S01194
0521 I*****                               P  94  960TNLU                  S01194
0545 I*****TABLE FILE - DEAL SUB-TYPES RECORD.                            S01194
0546 I*****                                                               S01194
0547 I*****TABLE   NS       1 CD   2 C4   3 C2                            S01194
0548 I*****                                   1   1 RECI                  S01194
0549 I*****                                   2   30RECT                  S01194
0550 I*****                                  12  13 DSCD                  S01194
0551 I*****                                  14  43 DSNM                  S01194
0552 I*****                                  44  45 DSAC                  S01194
0553 I*****                               P  90  920LCD                   S01194
0554 I*****                                  93  93 CHTP                  S01194
0555 I*****                               P  94  960TNLU                  S01194
0556 I*****TABLE FILE CATCH ALL                                           S01194
0557 I*****TABLE   NS                                                     S01194
0558 I*****                                   1   1 RECI                  S01194
0287 I**
0288 I*****MEMOS   NS  10   1 CD                                          CCB002
0289 I*****                                   1   1 RECI                  CCB002
0290 I*****                                   2  160LDBL                  CCB002
0291 I*****                                  17  310CLBL                  CCB002
0292 I*****                                  32  32 DUBI                  CCB002
0293 I*****                                   1  40 LOT                   CCB002
0294 I*****                               P  37  380BNLU                  CCB002
0295 I*****                               P  39  400INLU                  CCB002
0296 I**
0297 I*    CATCHALL FOR DELETED RECORDS
0298 I**
0299 I        NS
0559 I*
0585 I*    ACCOUNT MASTER DETAIL RECORD
0586 I**
0587 IACCNT   NS       1 CD
0588 I                                        1   1 RECI
0589 I**********                              2  16 ACMDKY                                    CGL029
0590 I**********                              2   70CNUM                                      CSD027
0590 I                                        2   7 CNUM                                      CSD027
0591 I                                        8  10 CCY
0592 I**********                             11  140ACOD                                      CGL029
0592 I                                       11  140ACODQQ                                    CGL029
0593 I                                       15  160ACSQ
0594 I***************************************23  250BRCDX                 S01117
0594 I                                       23  25 BRCDX                 S01117
0595 I                                       26  26 ATYP
0596 I                                       29  29 ACST
0597 I                                    P  30  320DACO
0598 I                                    P 239 2410RRNM
0592 I                                      554 5630ACOD                                      CGL029
0599 I**
0600 I*    CATCHALL FOR DELETED RECORDS
0601 I        NS
0602 I                                        1   1 RECI
0603 I**
     I*****                                                         S01154S01117
     I****DATA STRUCTURE  TO HOLD ACCNT KEY FOR UPDATING RSACMTPD   S01154S01117
     I*****                                                         S01154S01117
     I*****       DS                                                S01154S01117
     I*****                                   1  15 ACCNO           S01154S01117
     I*****                                   1   60CNUM            S01154S01117
     I*****                                   7   9 CCY             S01154S01117
     I*****                                  10  130ACOD            S01154S01117
     I*****                                  14  150ACSQ            S01154S01117
     I*****                                  16  30 RSACCN          S01154S01117
     I*****                                  16  210CUSN            S01154S01117
     I*****                                  22  24 CCYD            S01154S01117
     I*****                                  25  280ACDE            S01154S01117
     I*****                                  29  300ASNC            S01154S01117
     I*****                                  31  45 RACCNO          S01154S01117
     I*****                                  46  60 PACCNO          S01154S01117
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY ZSRSRC,ZF2CI                                                  S01195
     IRUNDAT      DS                                                      S01194
     I** DATA STRUCTURE FOR MULTIBRANCH INDICATOR USING RUNDAT.           S01194
     I                                       13  13 @MBIN                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* DS FOR BANK DETAILS                                               S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I* DS FOR DEALING DETAILS                                            S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I* DS FOR TRADING DETAILS                                            S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I* DS FOR MODULE DETAILS                                             S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     I* DS FOR GENERAL LEDGER DETAILS                                     S01194
     I*                                                                   S01194
     ISDPRFC    E DSSDPRFCPD                                              S01194
     I* DS FOR PROFIT CENTRE DETAILS                                      S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I* DS FOR CURRENCIES DETAILS                                         S01194
     I*                                                                   S01194
     ISDDLST    E DSSDDLSTPD                                              S01194
     I* DS FOR DEAL SUBTYPE DETAILS                                       S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I* DS FOR BRANCH DETAILS                                             S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACC3                                    CGL029
     I* DS FOR NOSTRO DETAILS                                             S01194
     I*                                                                                      BUG8759
     ISDBOOK    E DSSDBOOKPD                                                                 BUG8759
     I* DS FOR BOOK CODE DETAILS                                                             BUG8759
     I*                                                                   S01117
     I/COPY WNCPYSRC,DL0035I001
     ISCSARD    E DSSCSARDPD                                                                  CSD015
      ** DS for Switchable Feature Details                                                    CSD015
      *                                                                                       CSD015
     ISDCUST    E DSSDCUSTPD                                                                  CSD015
     I              QQDFAC                          QQDFA1                                    CGL029
      ** DS for Customer Details                                                              CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** DS for Watch List Checking Details                                                   CSD015
      *                                                                                       CSD015
     ISDWLTO    E DSSDWLTOPD                                                                  CSD015
      ** DS for Watch List Transaction Details                                                CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** Compliance Watch Configuration Data DS                                               CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD Data Area                                                                         CSD015
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      ** 24X7 Status Data Area                                                                CSD015
      *                                                                                       CSD015
     IDSFDY     E DSDSFDY                                                 S01194
     I* DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                      S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                       S01194
     I*                                                                   S01117
     I/COPY WNCPYSRC,DLH00191
     IZMUSER      DS                             17                       S01117
     I                                       14  16 DEPT                  S01117
     I*                                                                   S01117
     I*****@PORC*******DS                             41                  E270
      ***Profit Centre Dft. Matrix Retrieval index (AOPRFMR0)             E270
      ***Book Code                                                        E270
     I******                                  1   2 @BOOK1                E270
      ***Relevant Transaction Type                                        E270
     I******                                  3   7 @DLTP1                E270
      ***Sub Type                                                         E270
     I******                                  8   9 SUBTPE                E270
      ***Branch code                                                      E270
     I******                                 10  12 BRCODE                E270
      ***Dept Code                                                        E270
     I******                                 13  15 @DEPT1                E270
      ***User                                                             E270
     I******                                 16  25 @USER1                E270
      ***Account Officer Code                                             E270
     I******                                 26  27 @ACOF1                E270
      ***Customer number                                                  E270
     I******                                 28  33 @CUST1                E270
      **Profit Centre Code                                                E270
     I******                                 34  37 @PRFC1                E270
     I*                                                                   S01117
     I***@ACCNO*     DS                             18                                 S01117 CGL029
     I@ACCNO      DS                             24                                           CGL029
     I*   DATA STRUCTURE TO HOLD ACCNT KEY FOR UPDATING RSACMTPD          S01117
     I**********                              1   60@CNUM                              S01117 CSD027
     I                                        1   6 @CNUM                                     CSD027
     I                                        7   9 @CCY                  S01117
     I**********                             10  130@ACOD                              S01117 CGL029
     I**********                             14  150@ACSQ                              S01117 CGL029
     I**********                             16  18 @BRCA                              S01117 CGL029
     I                                       10  190@ACOD                                     CGL029
     I                                       20  210@ACSQ                                     CGL029
     I                                       22  24 @BRCA                                     CGL029
     I*                                                                   S01117
     I***RSACCN*     DS                             18                                 S01117 CGL029
     IRSACCN      DS                             24                                           CGL029
     I*   DS FOR UPDATING RSACMTPD FROM FIELDS IN KEY TO ACCNT            S01117
     I**********                              1   60CUSN                               S01117 CSD027
     I                                        1   6 CUSN                                      CSD027
     I                                        7   9 CCYD                  S01117
     I**********                             10  130ACDE                               S01117 CGL029
     I**********                             14  150ASNC                               S01117 CGL029
     I**********                             16  18 BRCA                               S01117 CGL029
     I                                       10  190ACDE                                      CGL029
     I                                       20  210ASNC                                      CGL029
     I                                       22  24 BRCA                                      CGL029
     I**
     I**  DATA STRUCTURE  TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I**
     IDNATN       DS                              5
     I                                        1   50FNATN
     I**
     I**  RETRIEVE WSID FROM PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                     *PROGRAM ZAPGM                 S01241
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
     I**  DATA STRUCTURE FOR ERROR HANDLING SUBROUTINE
     I**
     IINFDS       DS
     I                                     *STATUS  STATUS
0255 I**
     I**  DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTION
     I                                       26  35 USRIDX
     I***************************************51 102 LOTSF                 S01117
     I***************************************51 109 LOTSF                 S01117             BUG8759
     I                                       51 111 LOTSF                                    BUG8759
     I**                                                                  CCB002
     I**  DATA STRUCTURE FOR KEY TO NOSTRO ACCOUNTS                       CCB002
     IKEYNOS      DS                                                      CCB002
     I**********                              1  18 ACCKEY                             CCB002 CGL029
     I                                        1  24 ACCKEY                                    CGL029
     I                                        1   6 #CNUM                 CCB002
     I                                        7   9 #CCY                  CCB002
     I**********                             10  13 #ACOD                              CCB002 CGL029
     I**********                             14  15 #ACSQ                              CCB002 CGL029
     I**********                             16  18 #BRCA                              CCB002 CGL029
     I                                       10  19 #ACOD                                     CGL029
     I                                       20  21 #ACSQ                                     CGL029
     I                                       22  24 #BRCA                                     CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL0035IIP1                                           S01408
     I*                                                                   S01408
      *                                                                   073516
     I            DS                                                      073516
      * DATA STRUCTURE TO REDEFINE ARRAY @Z AS RETURNED FIELD @@AMTD      073516
     I                                        1  14 @@AMTD                073516
     I                                        1  14 @Z                    073516
     I            DS                                                      073516
      *                                                                   073516
      * DATA STRUCTURE TO REDEFINE ARRAY @Q AS INPUT FIELD @@AMTW         073516
     I                                        1  130@@AMTW                073516
     I                                        1  130@Q                    073516
      *                                                                                       CSD015
      ** Backup Container of the Watch List Fields                                            CSD015
      *                                                                                       CSD015
     IWBC         DS                                                                          CSD015
     I**********                              1  12 BCRONS                             CSD015 CGL029
     I                                        1  12 QQRONS                                    CGL029
     I                                       13  20 BCRIBN                                    CSD015
     I**********                             21  260BCROBN                             CSD015 CSD027
     I**********                             27  320BCROCN                             CSD015 CSD027
     I                                       21  26 BCROBN                                    CSD027
     I                                       27  32 BCROCN                                    CSD027
     I**********                             33  44 BCPONS                             CSD015 CGL029
     I                                       33  44 QQPONS                                    CGL029
     I                                       45  52 BCPIBN                                    CSD015
     I**********                             53  580BCPOBN                             CSD015 CSD027
     I**********                             59  640BCPOCN                             CSD015 CSD027
     I                                       53  58 BCPOBN                                    CSD027
     I                                       59  64 BCPOCN                                    CSD027
     I                                       65  72 BCRCRN                                    CSD015
     I                                       73  80 BCRVNO                                    CSD015
     I                                       81  88 BCAWBN                                    CSD015
     I                                       89  96 BCBENN                                    CSD015
     I                                       97 131 BCDTP1                                    CSD015
     I                                      132 166 BCDTP2                                    CSD015
     I                                      167 201 BCDTP3                                    CSD015
     I                                      202 236 BCDTP4                                    CSD015
     I                                      237 254 BCRONS                                    CGL029
     I                                      255 272 BCPONS                                    CGL029
      *                                                                                       CSD015
      ** Data Structures used by the Compliance Watch Subroutine.                             CSD015
      *                                                                                       CSD015
     IWXPCKT      DS                            400                                           CSD015
     IPFFS        DS                           9999                                           CSD015
      *                                                                                       CSD015
     I              'A'                   C         ALL                                       CSD015
     I              'C'                   C         CHANGD                                    CSD015
      ** WMOVM (Move Mode) Constants.                                                         CSD015
      *                                                                                       CSD015
     I              'I'                   C         ONINS                                     CSD015
     I              'A'                   C         ONAMD                                     CSD015
      ** WCMPM (Compliance Mode) Constants.                                                   CSD015
      *                                                                                       CSD015
     I              13                    C         ARRMAX                                    CSD015
      ** Max. no. of elements associated with the CE arrays.                                  CSD015
      *                                                                                       CSD015
      *                                                                   073516
     I/EJECT
      *-------------------------------------------------------------------S01241
      * Insert DS to pass DATA parameter to the return program            S01241
      *                                                                   S01241
      /COPY QWINDSRC,DL0035DTA                                            S01241
      *                                                                   S01241
      *-------- S01241 ---------------------------------------------------S01241
0645 I/EJECT
     C**
     C**   FROM ERROR HANDLING SUBROUTINE RETURN TO EXIT POINT
     C           STATUS    IFEQ 01021
     C                     Z-ADD0         STATUS  50
     C                     GOTO CHANGE
     C                     END
     C/COPY WNCPYSRC,DL0035C001
0646 C**
     C*****ALLOW*HELP                                                     S01199
     C**
     C           *IN38     IFEQ '1'
     C************IN89     DOUEQ'0'                                       S01199
      *---- S01241 -------------------------------------------------------S01241
      * Display window on enquiry if no errors                            S01241
      *                                                                   S01241
     C           WIN       IFEQ 'Y'                                       S01241
     C           ACTION    ANDEQ'E'                                       S01241
     C           DEALNO    ANDEQ#DEAL                                     S01241
     C                     EXSR #WIND                                     S01241
     C                     MOVE 'N'       WIN                             S01241
     C                     END                                            S01241
     C                     MOVE DEALNO    #DEAL   6                       S01241
     C           GUTEN     TAG                                            S01241
      *---- S01241 -------------------------------------------------------S01241
     C                     READ DL0035FM                 89
     C************IN89     IFEQ '1'                                       S01199
     C*********************MOVEAERCD      HERCD 160                       S01199
     C*********************MOVEL'      '  HBPGM   8                       E10533
     C*********************MOVEL'DL0035'  HBPGM   8                E10533 S01199
     C*********************CALL 'MHELP'                                   S01199
     C*********************PARM           HBPGM                           S01199
     C*********************PARM           HERCD                           S01199
     C*********************END                                            S01199
     C*********************END                                            S01199
     C                     GOTO FIRST
     C                     END
0651 C*
0652 C**   FIRST CYCLE CALCULATIONS
     C                     MOVEACPY@      BIS@   80
     C*                                                                   S01194
     C** READ DATA AREA - RUNDAT                                          S01194
     C           *NAMVAR   DEFN           RUNDAT                          S01194
     C                     IN   RUNDAT                                    S01194
     C*
     C**  GET ZMUSER to access default branch.                            S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
0653 C*
0654 C*****                EXSR ZSYSTM                                    S01194
      *                                                                                       CSD015
      ** CSD015 (Compliance Watch) Startup                                                    CSD015
      ** =================================                                                    CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CSD015 is switched on.                                  CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF'                                                        CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CSC011 is switched on.                                  CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSC011'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF'                                                        CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details to see if CCF001 is switched on.                                  CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CCF001'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE '*NRF'                                                        CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if transactions are being monitored by Compliance Watch.                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM 'DEALING '@FUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF'                                                        CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Define the Compliance Watch Hit List Key.                                            CSD015
      *                                                                                       CSD015
     C           KCWHT     KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If 24X7 Processing is installed, read the relevant data areas.                       CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ENDIF                                                              CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      **  Access Compliance Watch Configuration Data if necessary.                            CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*FIRST ' @OPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      ** End of CSD015 (Compliance Watch) Startup                                             CSD015
      ** ========================================                                             CSD015
      *                                                                                       CSD015
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C************         PARM           SDBANK                          S01194
0655 C**   RECORD NOT FOUND.
0656 C***99****************GOTO TABMIS                                    S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO TABMIS                                    S01194
     C                     END                                            S01194
     C/COPY WNCPYSRC,DL0035C008
4070 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
4071 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*                                                                   S01194
     C** ACCESS DEALING DATA VIA ACCESS PROGRAM                           S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C***********          PARM           SDDEAL                          S01194
0655 C**   RECORD NOT FOUND.                                              S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO TABMIS                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C** ACCESS TRADING DATA VIA ACCESS PROGRAM                           S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C***********          PARM           SDTRAD                          S01194
0655 C**   RECORD NOT FOUND.                                              S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO TABMIS                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C** ACCESS MODULE DETAILS VIA ACCESS PROGRAM                         S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C**********           PARM           SDMMOD                          S01194
0655 C**   RECORD NOT FOUND.                                              S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO TABMIS                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C** ACCESS GENERAL LEDGER DETAILS VIA ACCESS PROGRAM                 S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01194 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C***********          PARM           SDGELR                          S01194
0655 C**   RECORD NOT FOUND.                                              S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO TABMIS                                    S01194
     C                     END                                            S01194
      *                                                                   CRE009
      ** Access Switchable features file to check for CRE009              CRE009
      *                                                                   CRE009
     C                     CALL 'AOSARDR0'                                CRE009
     C                     PARM *BLANKS   @RTCD   7                       CRE009
     C                     PARM '*VERIFY' @OPTN   7                       CRE009
     C                     PARM 'CRE009'  @SAR    6                       CRE009
      *                                                                   CRE009
     C           @RTCD     IFEQ *BLANK                                    CRE009
     C                     MOVE 'Y'       CRE009  1                       CRE009
     C                     ELSE                                           CRE009
     C                     MOVE 'N'       CRE009                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                                      BUG3937
      ** Access Switchable features file to check for CLE025                                 BUG3937
      *                                                                                      BUG3937
     C                     CALL 'AOSARDR0'                                                   BUG3937
     C                     PARM *BLANKS   PRTCD   7                                          BUG3937
     C                     PARM '*VERIFY' POPTN   7                                          BUG3937
     C                     PARM 'CLE025'  PSARD   6                                          BUG3937
      *                                                                                      BUG3937
     C           PRTCD     IFEQ *BLANK                                                       BUG3937
     C                     MOVE 'Y'       CLE025  1                                          BUG3937
     C                     ELSE                                                              BUG3937
     C                     MOVE 'N'       CLE025                                             BUG3937
     C                     ENDIF                                                             BUG3937
      *                                                                                       CDL038
      ** Access SAR details to see if CDL038 is switched on.                                  CDL038
      *                                                                                       CDL038
     C                     CALL 'AOSARDR0'                                                    CDL038
     C                     PARM *BLANKS   @RTCD                                               CDL038
     C                     PARM '*VERIFY' @OPTN                                               CDL038
     C                     PARM 'CDL038'  @SARD   6                                           CDL038
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL038
      *                                                                                       CDL038
     C           @RTCD     IFEQ *BLANKS                                                       CDL038
     C                     MOVE 'Y'       CDL038  1                                           CDL038
     C                     MOVE *ON       *IN21                                               CDL038
     C                     ELSE                                                               CDL038
     C                     MOVE 'N'       CDL038                                              CDL038
     C                     MOVE *OFF      *IN21                                               CDL038
     C                     ENDIF                                                              CDL038
      *                                                                                       CDL038
      * Access nostro transfer class default                                                  CDL038
      *                                                                                       CDL038
     C           CDL038    IFEQ 'Y'                                                           CDL038
     C                     READ SDTCLDD0                 99                                   CDL038
     C           *IN99     IFEQ *ON                                                           CDL038
     C                     MOVE '****'    NXCLAS                                              CDL038
     C                     ENDIF                                                              CDL038
     C                     ENDIF                                                              CDL038
      *                                                                                       CAP205
      ** Access SAR details file to see if CAP205 is installed.                               CAP205
      *                                                                                       CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY' @OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE '*NRF'                                                        CAP205
     C                     GOTO TABMIS                                                        CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                     MD022776
      ** Call Access pgm AOSARDR0 to check if CAS001 is ON                                  MD022776
      *                                                                                     MD022776
     C                     MOVEL'N'       CAS001  1                                         MD022776
     C                     CALL 'AOSARDR0'                                                  MD022776
     C                     PARM *BLANKS   PRTCD                                             MD022776
     C                     PARM '*VERIFY' POPTN                                             MD022776
     C                     PARM 'CAS001'  PSARD                                             MD022776
     C           SCSARD    PARM SCSARD    DSFDY                                             MD022776
      *                                                                                     MD022776
     C           PRTCD     IFEQ *BLANKS                                                     MD022776
     C                     MOVEL'Y'       CAS001                                            MD022776
     C                     ENDIF                                                            MD022776
      *                                                                                     MD022776
     C*                                                                   S01194
0655 C**   set originating-branch-used indicator accordingly              S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN35                           S01117
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN35                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
0655 C**   set profit-centre-used indicator accordingly                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN36                           S01117
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN36                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,DL0035C005
0657 C*****CHAIN TO ALL NECESSARY INSTALLATION CONTROL RECORDS.           S01194
0658 C*****GET CONTROL DATA RECORD 2.                                     S01194
0659 C*****                MOVE '1'       TABKEY                          S01194
0660 C*****                EXSR TABCHN                                    S01194
0661 C*****RECORD NOT FOUND.                                              S01194
0662 C***29                GOTO TABMIS                                    S01194
     C                     BITOF'0'       ORIG    1
     C   82                BITON'0'       ORIG
     C                     SETOF                     82
     C***********MBIN      COMP 'Y'                      82               S01194
     C           @MBIN     COMP 'Y'                      82               S01194
     C                     BITOF'0'       NEW     1
     C   82                BITON'0'       NEW
     C                     SETOF                     82
     C                     TESTB'0'       ORIG           82
      *                                                                   S01117
      ** Set the indicator which tells the DSPF if programme is multi     S01117
      *  branching.                                                       S01117
     C***********MBIN      IFEQ 'Y'                                 S01117S01194
     C           @MBIN     IFEQ 'Y'                                 S01117S01194
     C                     MOVE '1'       *IN17                           S01117
     C                     END                                            S01117
      *                                                                   S01117
0668 C*****GET CONTROL DATA RECORD 5.                                     S01194
0669 C*****                MOVE '40'      TABKEY                          S01194
0670 C*****                EXSR TABCHN                                    S01194
0671 C*****ALL INSTALLATION CONTROL DATA RECORDS PRESENT.                 S01194
0672 C**N29                GOTO KEYWRK                                    S01194
0672 C                     GOTO KEYWRK                                    S01194
0673 C*
0674 C*****TABLE*RECORD*MISSING*NO*FURTHER*PROCESSING ALLOWED.            S01194
0674 C** STANDING DATA RECORD MISSING.NO FURTHER PROCESSING ALLOWED.      S01194
0675 C           TABMIS    TAG                             **TABMIS TAG **
0676 C                     SETON                     86U7U8
     C**   SET 'A' TO 1 TO AVOID ARRAY INDEX ERROR.
     C                     Z-ADD1         A
0677 C                     GOTO FINEND
0678 C**   SET UP BLANK WORK FIELDS AND KEY FIELDS
0679 C           KEYWRK    TAG                             ** KEYWRK TAG *
      *                                                                   CEU003
      ** Initialise settlement currency fields.                           CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WBLNK3  3                       CEU003
     C                     MOVE *BLANKS   WBLNK6  6                                           CSW212
     C                     MOVE *BLANKS   WBLN35 35                                           CSW212
      *                                                                   CEU003
     C                     Z-ADD0         ZERO02  20                                         BUG3937
0680 C                     Z-ADD0         ZERO03  30
0680 C                     Z-ADD0         ZERO05  50
0681 C**********           Z-ADD0         ZERO06  60                                          CSD027
0681 C                     MOVE *BLANKS   ZERO06  6                                           CSD027
0682 C                     Z-ADD0         ZERO08  80
0683 C                     Z-ADD0         ZERO13 130
0684 C                     Z-ADD0         ZERO15 150
0685 C                     Z-ADD20        A       20
     C                     Z-ADD0         LITD   130                      E19125
     C                     Z-ADD0         LILA   130                      E19125
     C                     Z-ADD0         DITD   130                      E19125
     C                     Z-ADD0         DILA   130                      E19125
     C                     Z-ADD0         ILAM   130                      E19125
     C                     Z-ADD0         IDAM   130                      E19125
     C                     Z-ADD0         IDIA   130                      E19125
     C                     Z-ADD0         ILIR   117                      E19125
     C                     Z-ADD0         IDIR   117                      E19125
     C                     Z-ADD0         ILIA   130                      E19125
     C                     Z-ADD0         ILCM    10                                          197873
     C                     Z-ADD0         IDCM    10                                          197873
     C                     Z-ADD0         LNKDN   60                                          197873
     C**********           Z-ADD0         ROCN    60                                   197873 CSD027
     C**********           Z-ADD0         POBN    60                                   197873 CSD027
     C**********           Z-ADD0         POCN    60                                   197873 CSD027
     C                     MOVE *BLANKS   ROCN    6                                           CSD027
     C                     MOVE *BLANKS   POBN    6                                           CSD027
     C                     MOVE *BLANKS   POCN    6                                           CSD027
     C                     Z-ADD0         MGPT    72                      S01453
     C                     Z-ADD0         MGAM   130                      S01453
     C                     Z-ADD0         OSRT   138                      S01453
     C                     Z-ADD0         FWPT    72                      S01453
     C                     Z-ADD0         BFPA   130                      S01453
     C                     Z-ADD0         SFPA   130                      S01453
     C                     Z-ADD0         BDBS   138                      S01453
     C                     Z-ADD0         SDBS   138                      S01453
     C                     Z-ADD0         SDBE   130                      S01453
     C                     Z-ADD0         BDBF    72                      S01453
     C                     Z-ADD0         SDBF    72                      S01453
     C                     Z-ADD0         BDFA   130                      S01453
     C                     Z-ADD0         SDFA   130                      S01453
0686 C*
0687 C                     MOVE ' '       BLNK16 16
0688 C                     MOVE ' '       BLNKS 150
0689 C                     MOVE 'A'       CLKEY   7
0690 C                     MOVE '1'       WRK4    4
     C***********          Z-ADD1         ONE117 117                      E11533
     C                     Z-ADD1         ONE138 138                      E11533
     C                     MOVE ' '       BLNK10 10
     C                     MOVE *BLANKS   BLNK16 16                                           CGL029
     C                     MOVE ' '       BLNK35 35
     C                     MOVE *BLANKS   MGCY    3                       S01453
     C                     MOVE *BLANKS   MGBS    1                       S01453
      *                                                                   S01117
      ** Define the key and save key fields for the ACCNT file.           S01117
      *                                                                   S01117
     C**********           MOVE *BLANKS   ACCKEY 18                                    S01117 CGL029
     C**********           MOVE *BLANKS   OLDKY1 18                                    S01117 CGL029
     C**********           MOVE *BLANKS   OLDKY2 18                                    S01117 CGL029
     C**********           MOVE *BLANKS   NEWKY1 18                                    S01117 CGL029
     C**********           MOVE *BLANKS   NEWKY2 18                                    S01117 CGL029
     C                     MOVE *BLANKS   ACCKEY 24                                           CGL029
     C                     MOVE *BLANKS   OLDKY1 24                                           CGL029
     C                     MOVE *BLANKS   OLDKY2 24                                           CGL029
     C                     MOVE *BLANKS   NEWKY1 24                                           CGL029
     C                     MOVE *BLANKS   NEWKY2 24                                           CGL029
      *                                                                   S01117
0691 C**   SET UP ARRAY INDEX.
0692 C                     Z-ADD0         X       20     34
0693 C**   SET UP SCREEN ID CODE.
0694 C                     MOVE 'SF'      SRNID
0695 C*****CHAIN*TO*CCY*TABLE*FOR*BASE*CCY AND LOCAL CCY DETAILS.   DL0030S01194
0695 C**   CHAIN TO CCY FILE FOR BASE CCY AND LOCAL CCY DETAILS.          S01194
0696 C           LOCHN     TAG                             ** LOCHN TAG **DL0030
0697 C******               MOVEL'20      'TABKEY                    DL0030S01194
0698 C**N38*               MOVELBCCY      WRK4                      DL0030S01194
0699 C***38*               MOVELLOCY      WRK4                      DL0030S01194
0700 C******               MOVE WRK4      TABKEY                    DL0030S01194
0701 C******               EXSR TABCHN
0698 C  N38                MOVELBJCYCD    @AJCD            BASE CCY       S01194
0699 C   38                MOVELBJLCCY    @AJCD            LOCAL CCY      S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C***********          PARM           SDCURR                          S01194
0702 C**   STORE TELEX NOTICE DAYS FOR LOCAL CCY
0703 C***38****************Z-ADDTNOT      LOCNOT  10 64  64               S01194
0703 C   38                Z-ADDA6TXND    LOCNOT  10 64  64               S01194
0704 C   38                GOTO FIRST                                     S01241
      *                                                                   S01241
0705 C**   STORE NO. OF DECIMALS FOR BASE CCY.
0706 C*********************Z-ADDCDP       BASCDP  10 38  38               S01194
0706 C                     Z-ADDA6NBDP    BASCDP  10 38  38               S01194
0707 C                     GOTO LOCHN
      *                                                                   S01241
0708 C           FIRST     TAG                             ** FIRST TAG **
0709 C**   RE-SET ERROR MESSAGE/CODE FIELDS
0710 C                     MOVE '    '    ERCD
0711 C**   RE-SET ARRAY INDEX.
0712 C                     Z-ADD1         S       20 8011
0713 C**   RE-SET CALCULATED FIELDS
     C                     BITOF'0123'    NOST#   1
0714 C                     BITOF'0'       DSTIND  1
0715 C                     BITOF'01234'   DSTII   1
0721 C                     Z-ADD0         VDAYNO  50
0722 C**********           Z-ADD0         CUSNM   60                                          CSD027
0722 C                     MOVE *BLANKS   CUSNM   6                                           CSD027
0723 C                     Z-ADD0         SPLAMT 130
0724 C                     Z-ADD0         BRKX   130
0725 C                     Z-ADD0         BYAMTX 153
0726 C                     Z-ADD0         SLAMTX 153
     C                     Z-ADD0         MRR1    50
     C                     Z-ADD0         MRR2    50
     C                     Z-ADD0         MRR3    50
     C                     Z-ADD0         MRR4    50
0730 C**   RE-SET SCREEN INDICATORS.
0731 C                     SETOF                     222839
0732 C                     SETOF                     464849
0733 C                     SETOF                     525659
0734 C                     SETOF                     606566
0735 C                     SETOF                     676869
0736 C                     SETOF                     707172
0737 C                     SETOF                     787981
0737 C                     SETOF                     20                   E21631
     C                     MOVE *OFF      *IN32                                              BUG8759
      *                                                                   S01117
      ** If multibranching setof the multibranch fields' error            S01117
      *  indicators.                                                      S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     MOVE '0'       *IN18                           S01117
     C                     MOVE '0'       *IN19                           S01117
     C                     END                                            S01117
0738 C**   TEST FOR COMMAND KEY RESPONSE
0739 C*    END OF JOB
0740 C   KC                SETON                     86
0741 C   KC                GOTO FINEND
0742 C   KL
0743 CORNKJN04             GOTO INIT
0744 C*
0745 C   KJN04
0746 CORNKJ 04             SETOF                     414280
0747 C*    REVERSAL OF DEAL
0748 C   80                GOTO UDLOG
0749 C                     SETOF                     434445
0750 C                     SETOF                     475051
0751 C                     SETOF                     535455
0752 C                     SETOF                     5758
0753 C                     MOVEAMSG,1     ERCD,A
0754 C                     MOVE ' 020'    ERCD,1
     C                     SETOF                     20                   E21631
0755 C                     GOTO FINEND
0756 C*
0757 C**   TEST SCREEN TYPE
0758 C*
0759 C           INIT      TAG                             ** INIT  TAG **
0760 C*    INITIAL SCREEN REQUESTED.
0761 C  NKL                GOTO NOCMD
0762 C**   SET INPUT FIELDS TO BLANK.
0763 C                     MOVE '      '  DEALNO
0764 C                     MOVE ' '       ACTION
      * Reset status indicator to 0                                       S01241
      *                                                                   S01241
     C                     Z-ADD0         STS                             S01241
      *                                                                   S01241
0765 C**   SET INITIAL SCREEN ID.
0766 C                     MOVE 'SF'      SRNID
0767 C           NOCMD     TAG                             ** NOCMD TAG **
0768 C  NKLN01             GOTO SCSEC
0769 C**   RE-SET BLANK INPUT FIELD INDICATORS.
0770 C                     SETOF                     404142
0771 C                     SETOF                     434445
0772 C                     SETOF                     475051
0773 C                     SETOF                     535455
0774 C                     SETOF                     5758
     C                     SETOF                     20                   E21631
0775 C                     SETON                     3464
0776 C   KL                GOTO FINEND
0777 C*
0778 C*
0779 C           SCSEC     TAG                             ** SCSEC TAG **
0780 C**   FULL SCREEN
0782 C   02                GOTO FULL
0783 C  N01                GOTO FINEND
0784 C**   INITIAL / ENQUIRY SCREEN
0785 C                     SETOF                     347576
0786 C                     SETOF                     7477
0787 C**   RE-SET WORK FIELDS.
0788 C                     Z-ADD0         TNLUZ
     C                     BITOF'01234567'OLEXIS  1
0790 C*
0791 C**   VALIDATE ACTION CODE
0792 C           ACTION    COMP 'I'                      31
0794 C           ACTION    COMP 'R'                      33
0794 C           ACTION    COMP 'R'                      20               E21631
0795 C  N31N33   ACTION    COMP 'E'                  424234
0796 C   42                MOVE ' 021'    ERCD,1
     C   42                SETOF                     20                   E21631
0797 C   42                GOTO SFERR
0798 C**   VALIDATE DEAL NO
0799 C  N41                MOVELDEALNO    WRKX7   70
0800 C  N41                MOVELWRKX7     WRK6    6
0801 C  N41      DEALNO    COMP WRK6                 4141
0802 C**   CHECK FOR ENTRY OF ZERO.
0803 C  N41      DEALNO    COMP '000000'                 41
0804 C*
0805 C   41                MOVE ' 022'    ERCD,1
     C   41                SETOF                     20                   E21631
0806 C   41                SETON                     74
0807 C   41                GOTO SFERR
0808 C*
     C**   CHECK FOR AVAILABLE DEAL NUMBERS                               E22644
     C                     MOVE DEALNO    ADLKEY  60                      E22644
     C                     EXSR CHKNO                                     E22644
     C**   IF NO RECORDS FOUND THEN ERROR                                 E22644
     C           *IN37     IFEQ '1'                                       E22644
     C                     MOVE '1'       *IN86                           E22644
     C                     MOVE '1'       *INU7                           E22644
     C                     MOVE '1'       *INU8                           E22644
     C                     MOVE '1'       *INKC                           E22644
     C                     GOTO FINEND                                    E22644
     C                     ELSE                                           E22644
     C           ADLKEY    IFLT NORDLN                                    E22644
     C                     MOVE '1'       *IN41                           E22644
     C                     MOVEAMSG,14    ERCD,A                          E22644
     C                     MOVE '088'     ERCD,1                          E22644
     C                     SETOF                     80                   E22644
     C                     GOTO FINEND                                    E22644
     C                     END                                            E22644
     C                     END                                            E22644
0809 C**   CHECK FOR RECORD ON DEALS FILE
0810 C                     MOVE DEALNO    DLKEY   6
0811 C                     EXSR DLCHN
0812 C**   SAVE ORIGINAL NON STATIC INDICATORS FOR LATER REVERSAL CHECK
0813 C                     MOVE DNSI      DNSIT   1
0814 C**   RELEASE RECORD IF FOUND.
0815 C  N22                SETON                     81
0816 C   81                EXSR EXCPTN
     C***********                                                  E17641 042960
     C*****IF*DEAL*NO.*NOT*FOUND*CHECK*TO*SEE*IF*DEAL*NO.*IS*ON*** E17641 042960
     C*****FILE*BUT*WITH*RECI*=*'N'.****************************** E17641 042960
     C************                                                 E17641 042960
     C************IN22     IFEQ '1'                                E17641 042960
     C***********          EXSR DLCHN3                             E17641 042960
     C***********          END                                     E17641 042960
     C***********                                                  E17641 042960
     C**E18569*-*Chain*to*DRS*deals*file*to*see*if*deal*number**** E18569 042960
     C***********already*reserved*for*FX*or*MM*or*AB*deal.******** E18569 042960
     C************LIKE     DEFN DLNO      @DLNO                    E18569 042960
     C************IN31     IFEQ '1'                        B1      E18569 042960
     C************IN22     ANDEQ'1'                        B1      E18569 042960
     C***********          MOVE DLKEY     @DLNO            *1      E18569 042960
     C***********@DLNO     SETLLCADENQLL                 41*1      E18569 042960
     C************IN41     IFEQ '1'                        B*2     E18569 042960
     C*                                                                   042960
     C** If Deal Number not found check whether it exists in any          042960
     C** Back Office or DRS Files.                                        042960
     C*                                                                   042960
     C           *IN22     IFEQ '1'                        B1             042960
     C                     EXSR DLCHN3                     *1             042960
     C           *IN31     IFEQ '1'                        B2             042960
     C           *IN22     ANDEQ'0'                        B2             042960
     C                     MOVE ' 023'    ERCD,1           **2            E18569
     C                     MOVEAMSG,3     ERCD,A           **2            E18569
     C                     MOVE '1'       *IN34            **2            E18569
     C                     MOVE '0'       *IN80            **2            E18569
     C                     MOVE '0'       *IN20            **2            E21631
     C                     GOTO FINEND                     **2            E18569
     C                     END                             E*2            E18569
     C                     END                             E1             E18569
0817 C***31*22*************GOTO SFERR                                     S01117
0817 C   31 22             GOTO MBV1                                      S01117
     C*                                                                   067362
0818 C**   INSERT - RECORD MUST NOT EXIST,OR WITH REC-ID ='*'
0819 C   31N09             MOVE ' 023'    ERCD,1
     C*                                                                   067362
0822 C**   ENQUIRY- RECORD MUST EXIST WITH REC-ID 'D' OR'R'.
0822 C**          - OR 'M'                                                060935
0824 C***34N05N06          MOVE ' 024'    ERCD,1                          060935
0824 C   34N05N06                                                         060935
0824 CANN12                MOVE ' 024'    ERCD,1                          060935
0825 C*
0826 C*    REVERSAL - RECORD MUST EXIST WITH REC-ID ='D'
0827 C   33N06             MOVE ' 025'    ERCD,1
     C   33N06             SETOF                     20                   E21631
0837 C*    CHECK FOR ERROR ON DEAL NO.
0838 C           ERCD,1    COMP '    '               4141
     C           *IN41     IFEQ '1'                                       S01117
     C                     GOTO SFERR                                     S01117
     C                     END                                            S01117
0847 C*                                                                   S01117
      ** Validation of user's branch and action code security.            S01117
     C           MBV1      TAG                             ** MBV1 TAG ***S01117
     C*                                                                   S01117
      ** If multibranching, -                                             S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
      **                                                                  S01117
      ** - check the action and booking branch security only when         S01117
      **   the action is E or R.                                          S01117
     C           ACTION    IFEQ 'E'                        B*2            S01117
     C           ACTION    OREQ 'R'                        **2            S01117
      **                                                                  S01117
     C                     CALL 'ZVACTBU'                  **2            S01117
     C                     PARM ACTION    @ACTN            **2            S01117
     C                     PARM BRCA      @BRCD            **2            S01117
     C                     PARM           @ERR             **2            S01117
      **                                                                  S01117
     C           @ERR      IFNE 0                          B**3           S01117
      ** Set code and message if ZVACTBU ended in error.                  S01117
     C                     MOVE ' 302'    ERCD,1           ***3           S01117
     C                     MOVEAMSG,12    ERCD,A           ***3           S01117
      **                                                                  S01117
     C                     END                             E**3           S01117
      **                                                                  S01117
     C                     END                             E*2            S01117
      **                                                                  S01117
     C                     ELSE                            X1             S01117
      **                                                                  S01117
      ** If not multibranching check the user's action code and branch    S01117
      ** security.                                                        S01117
     C                     CALL 'ZVACTU'                   *1             S01117
     C                     PARM ACTION    @ACTN            *1             S01117
     C                     PARM           @ERR    10       *1             S01117
      **                                                                  S01117
     C           @ERR      IFNE 0                          B*2            S01117
     C                     MOVE ' 303'    ERCD,1           **2            S01117
     C                     MOVEAMSG,11    ERCD,A           **2            S01117
     C                     END                             E*2            S01117
      **                                                                  S01117
     C                     END                             E1             S01117
      *                                                                   S01117
0848 C**   CHECK FOR ERRORS ON INITIAL SCREEN
0849 C           SFERR     TAG                             ** SFERR TAG **
0850 C           ERCD,1    COMP '    '                   80
0851 C   80                GOTO SFVAL
0852 C*
      *                                                                   S01241
     C                     Z-ADD0         STS                             S01241
      *                                                                   S01241
0853 C**   ALLOCATE ERROR MESSAGES WHERE NECESSARY
0854 C   42                MOVEAMSG,2     ERCD,A
0855 C   31N74             MOVEAMSG,3     ERCD,A
0856 C   22                MOVEAMSG,4     ERCD,A
0857 C   76                MOVEAMSG,5     ERCD,A
0858 C   74                MOVEAMSG,6     ERCD,A
0859 C**   SET INDICATOR TO POSITION CURSOR ON INITIAL SCREEN.
0860 C                     SETON                     34
0861 C                     GOTO FINEND
0862 C*
0863 C*
0864 C**   INITIAL SCREEN VALID
0865 C           SFVAL     TAG                             ** SFVAL TAG **
0866 C                     SETOF                     64
0867 C                     SETON                     2340
0868 C   31                MOVE 'SI'      SRNID
0869 C   31                GOTO FINEND
0870 C*
0871 C**   AMEND FILE DATA FOR SCREEN OUTPUT
0872 C                     EXSR SCFILL
0873 C**   RETAIN TRANSACTION NO. OF LAST UPDATE.
0874 C                     Z-ADDTNLUD     TNLUZ   50 11
0875 C**   UPDATE SCREEN ID.
0877 C   33                MOVE 'SR'      SRNID
     C                     GOTO FINEND
0878 C*
0904 C*
0905 C**   VALIDATION OF FULL SCREEN
0906 C           FULL      TAG                             ** FULL TAG **
0907 C                     MOVELBLNK16    TABKEY 12
0910 C*
0911 C                     SETOF                     757677
0917 C**   VALIDATE DEAL SUB-TYPE
0918 C   44                GOTO SBERR
0919 C*****                MOVEL'42      'TABKEY                          S01194
0920 C*****                MOVE SUBTPE    TABKEY                          S01194
0921 C*****                EXSR TABCHN                                    S01194
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SUBTPE    @AQCD   3                       S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
     C***********          PARM           SDDLST                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE '1'       *IN44                           S01194
     C                     ELSE                                           S01194
      * PROCESS USE OF '?'                                                S01194
     C                     MOVELASDSTC    SUBTPE                          S01194
     C                     END                                            S01194
0922 C*
0923 C           SBERR     TAG                             ** SBERR TAG **
0924 C***29*               SETON                     44                   S01194
0925 C   44                MOVE ' 102'    ERCD,S
0926 C   44      S         ADD  1         S
      *                                                                                       235601
      ** Validate Deal Type/Sub Type                                                          235601
      *                                                                                       235601
     C           DTSTKY    KLIST                                                              235601
     C                     KFLD           KDTYP   2                                           235601
     C                     KFLD           KSTYP   2                                           235601
      *                                                                                       235601
     C                     MOVE 'NX'      KDTYP                                               235601
     C                     MOVE SUBTPE    KSTYP                                               235601
     C           SUBTPE    IFNE ' '                                                           235601
     C           DTSTKY    CHAINFDDTSTL1             28                                       235601
     C           *IN28     IFEQ *ON                                                           235601
     C                     MOVE *ON       *IN44                                               235601
     C                     MOVE ' 104'    ERCD,S                                              235601
     C           S         ADD  1         S                                                   235601
     C                     ENDIF                                                              235601
     C                     ENDIF                                                              235601
      *                                                                                       235601
1104 C**** VALIDATE BRANCH CODE                                           S01117
1105 C****       BRVAL     TAG                             ** BRVAL TAG **S01117
1106 C****       BRCODE    COMP ' '                      74               S01117
1107 C**** CHECK FOR SINGLE OR MULTI-BRANCH                               S01117
1108 C****       DFBR      COMP '000'                7777                 S01117
     C***74N77             GOTO BRCERR                              S01125S01117
1109 C**N77                GOTO MULTIB                              S01125S01117
1110 C**** SINGLE BRANCH - IF CODE ENTERED MUST BE DEFAULT CODE.          S01117
1111 C***74 77             MOVE DFBR      BRCODE                    S01125S01117
1112 C***77      DFBR      COMP BRCODE                   74         S01125S01117
1111 C***74                MOVE DFBR      BRCODE                          S01125
1112 C***        DFBR      COMP BRCODE                   74               S01125
1113 C***74                GOTO VDATT                                     S01125
1114 C**   SINGLE BRANCH ENTRY INVALID.
1115 C***                  GOTO BRCERR                                    S01125
1115 C**N74*77**           GOTO BRCERR                              S01125S01117
1116 C**   MULTI-BRANCH ENTRY MUST BE ON FILE
1117 C***        MULTIB    TAG                             **MULTIB TAG **S01125
1118 C***74                GOTO BRCERR                                    S01125
1119 C***********          MOVEL'10      'TABKEY                          S01117
1120 C***********          MOVE '    '    TABKEY                          S01117
1121 C***********          MOVE BRCODE    TABKEY                          S01117
1122 C***********          EXSR TABCHN                                    s01117
1123 C*
1127 C**N29******          GOTO VDATT                                     S01117
1128 C**                                                                  S01117
1129 C***********BRCERR    TAG                             **BRCERR TAG **S01117
1130 C***********          MOVE ' 103'    ERCD,S                          S01117
1131 C***********S         ADD  1         S          46                   S01117
1132 C*                                                                   S01117
      *                                                                   S01117
      ** Validate the booking branch                                      S01117
      **                                                                  S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
      **                                                                  S01117
      ** if booking branch entered then check it exists on file           S01117
     C           BRCODE    IFNE *BLANKS                    B*2            S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD            **2            S01117
     C                     PARM '*KEY   ' @OPTN            **2            S01117
     C                     PARM BRCODE    @DSNB   3        **2            S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C**********           PARM           SDBRCH           **2            S01117
      ** If branch not on file highlight booking branch on screen         S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C                     MOVE '1'       *IN46            ***3           S01117
     C                     MOVE ' 103'    ERCD,S           ***3           S01117
     C                     ADD  1         S                ***3           S01117
     C                     ELSE                            X**3           S01117
      * PROCESS USE OF '?'                                                S01117
     C                     MOVELA8BRCD    BRCODE           ***3           S01117
      ** else do user/action code validation                              S01117
     C                     CALL 'ZVACTBU'                  ***3           S01117
     C                     PARM ACTION    @ACTN   1        ***3           S01117
     C                     PARM BRCODE    @BRCD   3        ***3           S01117
     C                     PARM           @ERR             ***3           S01117
     C*                                                                   S01117
      ** If error highlight booking branch and action code on screen.     S01117
     C           @ERR      IFNE 0                          B***4          S01117
     C                     MOVE '1'       *IN46            ****4          S01117
     C                     MOVE '1'       *IN42            ****4          S01117
     C                     MOVE ' 302'    ERCD,S           ****4          S01117
     C                     ADD  1         S                ****4          S01117
     C                     END                             E***4          S01117
     C*                                                                   S01117
     C                     END                             E**3           S01117
     C*                                                                   S01117
     C                     ELSE                            X*2            S01117
     C*                                                                   S01117
      ** no branch code entered - for multibranch it is mandatory         S01117
     C                     MOVE '1'       *IN46            ****4          S01117
     C                     MOVE ' 301'    ERCD,S                          S01117
     C                     ADD  1         S                               S01117
     C                     END                             E*2            S01117
     C*                                                                   S01117
     C                     ELSE                            X1             S01117
     C*                                                                   S01117
      * not multibranched so not displayed - default to default           S01117
      * trading branch and access branch internal customer no             S01117
     C                     MOVE BJSBRC    BRCODE           *1             S01117
     C**********           CALL 'AOBRCHR0'                 *1                          S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD            *1             S01117
     C                     PARM '*KEY   ' @OPTN            *1             S01117
     C                     PARM BRCODE    @DSNB   3        *1             S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C***********          PARM           SDBRCH           *1             S01117
     C                     END                             E1             S01117
      *                                                                   S01117
1178 C**   VALIDATE VALUE DATE
1179 C           VDATT     TAG                             ** VDAT TAG  **
1180 C**   VALUE DATE PASSED THROUGH ZDATE1 - CHECK VALID
1181 C                     MOVELVALDAT    WK7N    70
1182 C                     MOVELWK7N      WK6A    6
1183 C           WK6A      COMP VALDAT               5151
     C  N51                MOVE VALDAT    ZDATE
     C  N51                EXSR ZDATE1
     C  N51N99             Z-ADDZDAYNO    VDAYNO
1184 C  N51      VDAYNO    COMP 0                        51
1185 C   51                MOVE ' 150'    ERCD,S
1186 C   51      S         ADD  1         S
1237 C*
1238 C**   VALIDATE PURCHASED CURRENCY
1240 C*********************MOVEL'20      'TABKEY                          S01194
1241 C**   INVALID BLANK ENTRY.
1242 C   53                MOVE ' 109'    ERCD,S
     C   53      S         ADD  1         S                               E13148
1243 C   53                GOTO BCCYER
1244 C**   CCY ENTERED MUST EXIST ON FILE.
1245 C*****                MOVELBUYCCY    WRK4                            S01194
1246 C*****                MOVE WRK4      TABKEY                          S01194
1247 C*****                EXSR TABCHN                                    S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM BUYCCY    @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C***********          PARM           SDCURR                          S01194
     C* IF NOT ON FILE SET ON *IN29                                       S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE '1'       *IN29                           S01194
     C                     ELSE                                           S01194
      * PROCESS USE OF '?'                                                S01194
     C                     MOVELA6CYCD    BUYCCY                          S01194
     C                     MOVE '0'       *IN29                           S01194
     C                     END                                            S01194
1248 C*    BUY CCY MUST BE VALID DEALING CCY
1249 C**N29******DCCY      COMP 'Y'                  2929                 S01194
1249 C  N29      A6DLCI    COMP 'Y'                  2929                 S01194
1250 C   29                GOTO BCCYER
1251 C**   STORE SPOT RATE/ NO. OF DECIMALS FOR BUY CCY.
1252 C*****                Z-ADDSPOT      BUYRAT 128                      S01194
1253 C*****                Z-ADDCDP       BUYCDP  10                      S01194
1254 C*****                Z-ADDMDIN      BUYMDI  10                      S01194
1252 C                     Z-ADDA6SPRT    BUYRAT 128                      S01194
1253 C                     Z-ADDA6NBDP    BUYCDP  10                      S01194
1254 C                     MOVE A6MDIN    BUYMDI  1                       S01194
1255 C*
1266 C*
1267 C**   INVALID PURCHASED CCY
1268 C           BCCYER    TAG                             ** BCCYER TAG *
1269 C   29                MOVE ' 109'    ERCD,S
1270 C   29      S         ADD  1         S          5329
1271 C*
1272 C**   VALIDATE PURCHASED AMOUNT
1274 C**   RE-SET WORK INDICATORS.
1275 C                     SETOF                     242526
1276 C                     SETOF                     27
1277 C**   INVALID BLANK ENTRY.
1278 C   54                MOVE ' 138'    ERCD,S
1278 C   54                ADD  1         S
1279 C***54********        GOTO SETV                                      S01117
1279 C   54                GOTO PCV                                       S01117
1280 C*
1281 C**   VALIDATE VIA ZALIGN SUBROUTINE
1282 C                     MOVELBLNK16    ZFIELD
1283 C                     MOVELBUYAMT    ZFIELD
1284 C*****                Z-ADDCDP       ZADEC                           S01194
1285 C*****      13        SUB  CDP       ZADIG                           S01194
1284 C                     Z-ADDA6NBDP    ZADEC                           S01194
1285 C           13        SUB  A6NBDP    ZADIG                           S01194
1286 C                     EXSR ZALIGN
1287 C*    VALID ENTRY-SAVE FOR FILE OUTPUT
1288 C  N99                MOVE ZFIELD    BAMT   130
1289 C  N99      BAMT      COMP 0                        99
1290 C*    INVALID ENTRY
     C           *IN99     IFEQ '1'                        ** IF  001
1291 C                     MOVE ' 138'    ERCD,S
1314 C   99      S         ADD  1         S          54
     C**   VALID ENTRY, CALCULATE BASE CCY EQUIV.
     C                     ELSE                            ** ELSE 001
     C*****      BASCDP    SUB  CDP       XX      10                      S01194
     C           BASCDP    SUB  A6NBDP    XX      10                      S01194
     C                     ADD  4         XX
     C*****      MDIN      IFEQ 1                          ** IF  002     S01194
     C*****      BAMT      DIV  SPOT      BCYEQ  130                      S01194
     C           A6MDIN    IFEQ 'D'                        ** IF  002     S01194
     C           BAMT      DIV  A6SPRT    BCYEQ  130                      S01194
     C                     ELSE                            ** ELSE 002
     C*****      BAMT      MULT SPOT      BCYEQ                           S01194
     C           BAMT      MULT A6SPRT    BCYEQ                           S01194
     C                     END                             ** END 002
     C                     MULT POW,XX    BCYEQ
     C                     END                             ** END 001
      *                                                                   S01117
     C           PCV       TAG                             ** PVC TAG **  S01117
      *                                                                   S01117
      ** Validate profit centre if profit centre used flag is on   .      S01117
     C           BKPRCU    IFEQ 'Y'                        B1             S01117
      **                                                                  S01117
      **   if profit centre not entered                                   S01117
     C           PRFCNT    IFEQ *BLANKS                    B*2            S01117
      **                                                                  S01117
      **     if profit centre default flag is on then set to default      S01117
     C           BKPCDU    IFEQ 'Y'                        B**3           S01117
      **                                                                  S01117
      ** MUST SET UP SOME FIELDS                                          S01117
     C******               MOVE DEPT      @DEPT1           ***3           E270
     C******               MOVE USRID     @USER1           ***3           E270
     C******               MOVE *BLANKS   @CUST1           ***3           E270
     C******               MOVE *BLANKS   @ACOF1           ***3           E270
     C******               MOVE *BLANKS   @DLTP1           ***3           E270
     C******               MOVE *BLANKS   @BOOK1           ***3           E270
     C                     CALL 'AOPRFMR0'                 ***3           S01117
     C                     PARM           @RTCD            ***3           S01117
     C                     PARM *BLANKS   BOOK    2        Book Code      E270
     C***********          PARM 'NX   '   TRTP    5   Transacton TypeE270 164679
     C                     PARM 'NX   '   TRTPW   5        Transacton Type164679
     C                     PARM SUBTPE    SUTP    2        Sub Type       E270
     C                     PARM BRCODE    BRAN    3        Branch Code    E270
     C                     PARM DEPT      DEPT1   3        Deptment Code  E270
     C                     PARM USRID     USER   10        User           E270
     C                     PARM *BLANKS   ACOF    2        Account OfficerE270
     C                     PARM *BLANKS   CUST    6        Customer NumberE270
     C           PRFCNT    PARM           PRFC    4        Profit Centre  E270
      *                                                                   E270
     C           @RTCD     IFEQ '2'                                       120827
     C                     MOVE '1'       *IN18                           120827
     C                     MOVE ' 306'    ERCD,S                          120827
     C                     ADD  1         S                               120827
     C                     END                                            120827
     C*                                                                   120827
     C******               PARM           @PORC            ***4           E270
      ******                                                              E270
      ***set up with default if found else leave blank                    E270
     C******     @RTCD     IFEQ *BLANKS                    B***4          E270
     C******               MOVE @PRFC1    PRFCNT           ****4          E270
     C******               END                             E***4          E270
      ******                                                              E270
      **                                                                  S01117
     C************         ELSE                            X**3     S01117E32332
      *******else*profit centre must be entered - therefore error   S01117E32332
     C************         MOVE '1'       *IN18            ***3     S01117E32332
     C************         MOVE ' 306'    ERCD,S           ***3     S01117E32332
     C************         ADD  1         S                ***3     S01117E32332
     C                     END                             E**3           S01117
      **                                                                  S01117
     C                     ELSE                            X*2            S01117
      **                                                                  S01117
      **   else profit centre entered - check existence on file           S01117
     C                     CALL 'AOPRFCR0'                 **2            S01117
     C                     PARM *BLANKS   @RTCD            **2            S01117
     C                     PARM '*KEY   ' @OPTN            **2            S01117
     C                     PARM PRFCNT    @KEY    4        **2            S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01194
     C************         PARM           SDPRFC           **2            S01117
      **                                                                  S01117
      ** Error if profit centre does not exist on file.                   S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C                     MOVE '1'       *IN18            ***3           S01117
     C                     MOVE ' 306'    ERCD,S           ***3           S01117
     C                     ADD  1         S                ***3           S01117
     C                     ELSE                            X**3           E32332
      * PROCESS USE OF '?'                                 X**3           E32332
     C                     MOVELDSPCCD    PRFCNT           X**3           E32332
     C                     END                             E**3           S01117
      **                                                                  S01117
     C                     END                             E*2            S01117
      **                                                                  S01117
      ** End of profit centre validation.                                 S01117
     C                     END                             E1             S01117
      *                                                                                      BUG8759
      ** Start of book code validation                                                       BUG8759
     C           BKCODE    IFEQ *BLANKS                                                      BUG8759
      *                                                                                     MD022776
      ** 3 conditions where BKCODE becomes mandatory                                        MD022776
      *                                                                                     MD022776
     C           CAS001    IFEQ 'Y'                                                         MD022776
     C           BNBCOP    OREQ 'N'                                                         MD022776
     C           BNBCOP    OREQ ' '                                                         MD022776
      *                                                                                      BUG8759
      ** Display error msg that book code is mandatory                                       BUG8759
     C                     MOVEAMSG,17    ERCD,A                                             BUG8759
     C                     MOVE ' 307'    ERCD,S                                             BUG8759
     C                     ADD  1         S                                                  BUG8759
     C                     MOVE *ON       *IN32                                              BUG8759
     C                     ELSE                                                             MD022776
      *                                                                                     MD022776
      ** If Book Code is blank but optional, set it to ICD default                          MD022776
      *                                                                                     MD022776
     C                     MOVELBNBKCD    BKCODE                                            MD022776
     C                     MOVELBNBKCD    BDBKCD                                            MD022776
     C                     MOVELBNBKCD    BOKC                                              MD022776
     C                     ENDIF                                                            MD022776
      *                                                                                      BUG8759
     C                     ELSE                                                              BUG8759
      *                                                                                      BUG8759
     C** Call Access Program for Book Details                                                BUG8759
     C                     CALL 'AOBOOKR0'                                                   BUG8759
     C                     PARM *BLANKS   @RTCD                                              BUG8759
     C                     PARM '*KEY    '@OPTN                                              BUG8759
     C                     PARM BKCODE    @BOKC   2                                          BUG8759
     C           SDBOOK    PARM SDBOOK    DSFDY                                              BUG8759
      *                                                                                      BUG8759
      ** If record not found                                                                 BUG8759
     C           @RTCD     IFNE *BLANK                                                       BUG8759
      *                                                                                      BUG8759
      ** Display error msg that book code is invalid                                         BUG8759
     C                     MOVEAMSG,18    ERCD,A                                             BUG8759
     C                     MOVE ' 307'    ERCD,S                                             BUG8759
     C                     ADD  1         S                                                  BUG8759
     C                     MOVE *ON       *IN32                                              BUG8759
      *                                                                                      BUG8759
     C                     ELSE                                                              BUG8759
      *                                                                                      BUG8759
      ** Move screen field to file field                                                     BUG8759
     C                     MOVELBDBKCD    BOKC                                               BUG8759
     C                     MOVELBDBKCD    BKCODE                                      BUG8759 244293
      *                                                                                      BUG8759
     C                     END                                                               BUG8759
      *                                                                                      BUG8759
     C                     END                                                               BUG8759
      ** End of book code validation                                                         BUG8759
      *                                                                                      BUG8759
      **                                                                  S01117
      ** Validate Originating Branch                                      S01117
      *                                                                   S01117
      ** if originating branch not entered (or if not multibranched -     S01117
      ** in which case it will be blank anyway) then, if booking branch   S01117
      ** not in error, use booking branch as default originating branch   S01117
     C           ORBRCH    IFEQ *BLANKS                    B1             S01117
     C           *IN46     ANDEQ'0'                        *1             S01117
     C                     MOVE BRCODE    ORBRCH           *1             S01117
     C                     END                             E1             S01117
      **                                                                  S01117
      ** If multibranched ....                                            S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
      **                                                                  S01117
      ** ....and if originating branch used flag is on and if the         S01117
      **  originating branch is not equal to blanks (would be blanks if   S01117
      **  Originating Branch not entered but error on Booking Branch so   S01117
      **  not defaulted) then validate the Originating Branch             S01117
     C           BKOBRU    IFEQ 'Y'                        B*2            S01117
     C           ORBRCH    ANDNE*BLANKS                    **2            S01117
      *                                                                   S01117
      ** check originating branch exists on file                          S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD            **2            S01117
     C                     PARM '*KEY   ' @OPTN            **2            S01117
     C                     PARM ORBRCH    @DSNB   3        **2            S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C********             PARM           SDBRCH           **2            S01117
      ** If branch not on file highlight originating branch on screen     S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C                     MOVE '1'       *IN19            ***3           S01117
     C                     MOVE ' 304'    ERCD,S           ***3           S01117
     C                     ADD  1         S                ***6           S01117
     C                     ELSE                            X**3           S01117
      * PROCESS USE OF '?'                                                S01117
     C                     MOVELA8BRCD    ORBRCH           ***3           S01117
      ** else branch valid so do user validation if required              S01117
     C           BKOBUV    IFEQ 'Y'                        B***4          S01117
     C                     CALL 'ZVOBU'                    ****4          S01117
     C                     PARM           ORBRCH           ****4          S01117
     C                     PARM           @ERR             ****4          S01117
      *                                                                   S01117
      ** If no valid branches for user or this one not valid for user     S01117
      ** then highlight field                                             S01117
     C           @ERR      IFNE 0                          B****5         S01117
     C                     MOVE '1'       *IN19            *****5         S01117
     C                     MOVE ' 305'    ERCD,S           *****5         S01117
     C                     ADD  1         S                *****5         S01117
     C                     END                             E****5         S01117
      *                                                                   S01117
     C                     END                             E***4          S01117
      *                                                                   S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C                     END                             E*2            S01117
      ** End of orig. branch validation.                                  S01117
     C                     END                             E1             S01117
1315 C*
1565 C*****VALIDATE*RECEIVE*SETTLEMENT*INSTRUCTIONS**********             197513
1567 C*****MOVE*FIELDS*INTO*SUBR*FIELDS*FOR*VALIDATION*CHECK*             197513
     C           SETV      TAG                             ** SETV TAG
      *                                                                   197513
      ** Validate Pay Settlement Instructions before Receive              197513
      ** Move fields into SUBR fields for validation check                197513
      *                                                                   197513
     C                     MOVE PSETT     TYPE                            197513
     C                     MOVE OPAYCR    OURS                            197513
     C                     SETOF                     73                   197513
     C                     EXSR SETTLE                                    197513
      *                                                                   197513
      ** Process for use of '?' in nostro code                            197513
      *                                                                   197513
     C                     MOVELOPAYCR    OPAYC1  1                       197513
     C                     MOVE OPAYCR    OPAYC2  1                       197513
      *                                                                   197513
     C           OPAYC1    IFEQ '?'                                       197513
     C           OPAYC2    OREQ '?'                                       197513
     C                     MOVELA7NONB    OPAYCR                          197513
     C                     END                                            197513
      *                                                                   197513
      ** Validate Receive settlement instructions                         197513
      ** Move fields into SUBR fields for validation check                197513
      *                                                                   197513
1568 C                     MOVE RSETT     TYPE    2
1569 C                     MOVE ORECDR    OURS    2
1574 C                     SETON                     73
1575 C                     EXSR SETTLE
      * PROCESS FOR USE OF '?' IN NOSTRO CODE                             S01117
      *                                                                   197513
     C                     MOVELORECDR    ORECD1  1                       197513
     C                     MOVE ORECDR    ORECD2  1                       197513
      *                                                                   197513
     C********** ORECDR    IFEQ '?'                                S01117 197513
     C           ORECD1    IFEQ '?'                                       197513
     C           ORECD2    OREQ '?'                                       197513
     C                     MOVELA7NONB    ORECDR                          S01117
     C                     END                                            S01117
1577 C*
1578 C*****VALIDATE*PAY*SETTLEMENT*INSTRUCTIONS**************             197513
1579 C*****MOVE*FIELDS*INTO*SUBR*FIELDS*FOR*VALIDATION*CHECK*             197513
1580 C**********           MOVE PSETT     TYPE                            197513
1581 C**********           MOVE OPAYCR    OURS                            197513
1584 C**********           SETOF                     73                   197513
1585 C**********           EXSR SETTLE                                    197513
      **PROCESS*FOR*USE*OF*'?'*IN*NOSTRO*CODE****************      S01117 197513
     C********** OPAYCR    IFEQ '?'                                S01117 197513
     C**********           MOVELA7NONB    OPAYCR                   S01117 197513
     C**********           END                                     S01117 197513
1587 C*
1588 C**   CHECK FOR WARNING ERRORS.
1589 C**   VALUE DATE MUST BE WORKING DAY IN CCY
     C           *IN51     IFEQ '0'
1594 C                     Z-ADDVDAYNO    ZDAYNO
1595 C                     MOVE BUYCCY    ZCCY
1596 C*********************MOVE 'N'       ZOPT                            S01195
1597 C*********************EXSR ZDATE5                                    S01195
1596 C                     MOVE BJSLCD    ZLOC                            S01195
1597 C                     EXSR ZCHKH                                     S01195
     C           *IN99     IFEQ '1'
     C           ZIND      OREQ 'H'                                                           174149
1604 C**********           MOVE ' W01'    ERCD,S                                              174149
     C                     MOVE ' W02'    ERCD,S                                              174149
1605 C                     ADD  1         S          51
1606 C                     END
1607 C                     END
     C**
      ** Check for warning errors.                                                            174149
      ** Value date must be working day in local ccy                                          174149
     C           *IN51     IFEQ '0'                                                           174149
     C                     Z-ADDVDAYNO    ZDAYNO                                              174149
     C                     MOVE BJLCCY    ZCCY                                                174149
     C                     MOVE BJSLCD    ZLOC                                                174149
     C                     EXSR ZCHKH                                                         174149
     C           *IN99     IFEQ '1'                                                           174149
     C           ZIND      OREQ 'H'                                                           174149
     C                     MOVE ' W01'    ERCD,S                                              174149
     C                     ADD  1         S          51                                       174149
     C                     END                                                                174149
     C                     END                                                                174149
      **                                                                                      174149
1651 C           VALEND    TAG                             ** VALEND TAG *
1652 C           ERCD,1    COMP '    '                   80
1653 C*
1654 C**   ERROR CONDITION FOUND - CHECK FOR WARNING ERRORS ONLY
1655 C**   UPDATE ONLY IF WARNINGS AS ON PREVIOUS SCREEN
1656 C  N80                MOVELERCD,1    WARN    2
1657 C  N80      WARN      COMP ' W'                     74
1658 C  N80 74   LOTSF     COMP LOTSAV                   80
1659 C**N80*74*************MOVE LOTSF     LOTSAV 52                       S01117
1659 C**N80*74*************MOVE LOTSF     LOTSAV 59                                    S01117 240343
1659 C  N80 74             MOVE LOTSF     LOTSAV 61                                           240343
1662 C   80                GOTO UDLOG
1663 C*
1664 C**   ERROR CONDITION FOUND - BYPASS UPDATE PROCEDURE.
1665 C*
1666 C                     GOTO FINEND
1667 C*
1668 C********************************************************************
1669 C** UPDATE PROCEDURE
1670 C**
1671 C           UDLOG     TAG                             ** UDLOG TAG **
      *---- S01241 -------------------------------------------------------S01241
      * WINDOW PROCESSING                                                 S01241
      *                                                                   S01241
     C                     EXSR #WIND                                     S01241
      *                                                                   S01241
      * Redisplay screen if Cmd12 has been pressed on the window,         S01241
      * else update files.                                                S01241
      *                                                                   S01241
     C*                                                                   S01241
     C***********#RTRN     IFEQ 'USR0790'                          S01241 E22217
     C           #RTRN     IFNE *BLANKS                            S01241 E22217
     C                     CALL 'SNDERMSG'                                S01241
     C                     PARM           ZAPGM            Program queue  S01241
     C                     PARM           ZAPGRL  5        Rel queue      S01241
     C*********************PARM 'WND0001' ZAMSID  7        Message  S01241E22217
     C                     PARM #RTRN     ZAMSID  7        Message Id.    E22217
     C*********************PARM 'MIDAS  ' ZAMSGF 10        Message fS01241E22217
     C                     PARM 'WNMSGF ' ZAMSGF 10        Message file.  E22217
     C                     PARM           ZAMSDA132        Message data.  S01241
     C                     PARM           ZAMSTP  7        Message type.  S01241
      * Clear all fields                                                  S01241
     C                     MOVEL*BLANK    ZAPGM            Program queue  S01241
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      S01241
     C                     MOVEL*BLANK    ZAMSID           Message Id.    S01241
     C                     MOVEL*BLANK    ZAMSGF           Message file.  S01241
     C                     MOVEL*BLANK    ZAMSDA           Message data.  S01241
     C                     MOVEL*BLANK    ZAMSTP           Message type.  S01241
     C                     GOTO FINEND                                    S01241
     C                     END                                            S01241
      *---- S01241 -------------------------------------------------------S01241
1672 C                     SETOF                     737879
1673 C                     SETOF                     757677
1674 C                     SETOF                     52
1678 C** CHECK STATUS OF TRANSACTION RECORD UNCHANGED
1679 C                     MOVE DEALNO    DLKEY
1680 C                     EXSR DLCHN
      *                                                                                       CSD015
      ** Save the Watch List Fields.                                                          CSD015
      *                                                                                       CSD015
     C                     EXSR SRSWLF                                                        CSD015
      *                                                                                       CSD015
1681 C** RECORD STATUS CHANGED ON INSERT
1682 C                     SETOF                     82
1683 C   31N22N09          SETON                     82
1684 C**
1699 C           CHANGE    TAG                             **CHANGE TAG **
1700 C  N82                GOTO UNCHGD
1701 C**   RECORD STATUS CHANGED-RELEASE FILES
1702 C                     SETON                     11
1703 C  N22N80             SETON                     81    RELEASE DEALS
1704 C  N80                EXSR EXCPTN
1705 C*
     C** ISSUE ERROR IF REC UPDATED BY ANOTHER W/S
     C**
1706 C**                   MOVEAMSG,7     ERCD,A
1707 C**                   MOVE ' 082'    ERCD,1
1706 C   77                MOVEAMSG,10    ERCD,A
1707 C   77                MOVE ' 200'    ERCD,1
1708 C**   SET SCREEN INDICATORS AS FOR INITIAL SCREEN.
1709 C                     SETON                     347879
1710 C                     SETOF                     80
1711 C**   SET UP SCREEN FIELDS FOR UPDATED RECORD
1712 C                     EXSR SCFILL
1713 C                     MOVE 'SF'      SRNID
1714 C*
1715 C                     GOTO FINEND
1716 C*
1718 C           UNCHGD    TAG                             ** UNCHGD TAG *
1722 C                     SETOF                     77
     C**
     C**  OBTAIN LAST TRANSACTION NUMBER  AND SET UP STANDARD OUTPUT
     C**  INFORMATION
     C                     EXSR ZTNLU1
     C                     MOVE 'DL'      MDID    2
     C                     MOVEL'      '  PGMN    8
     C                     MOVE WSID      WSIDX   3
     C                     MOVE USRID     USRIDX 10
1741 C*
1754 C**   MOVE FILE AMOUNTS/VALUE DATE INTO WORK FIELD.
1755 C  N31                Z-ADDPUAM      BAMT
1757 C  N31                Z-ADDVDAT      VDAYNO
1758 C**   CHECK WHETHER MEMOS FILE UPDATE REQUIRED.
1759 C**   SHADOW POSTINGS ONLY MADE IF RETAIL MODULE PRESENT
1760 C  NU2                GOTO DLSUP
1761 C*********************TESTB'2'       MODI1          74               S01194
1761 C                     MOVE '0'       *IN74                           S01194
1761 C           BGRTBN    IFEQ 'Y'                                       S01194
1761 C                     MOVE '1'       *IN74                           S01194
1761 C                     END                                            S01194
1761 C           BGIOAC    IFEQ 'Y'                                       E23407
1761 C                     MOVE '1'       *IN74                           E23407
1761 C                     END                                            E23407
1762 C**   CHECK VALUE DATE OF DEAL
1764 C                     SETOF                     75
1765 C***74**    VDAYNO    COMP RUND                   7575               S01194
1765 C   74      VDAYNO    COMP BJRDNB                 7575               S01194
1768 C  N75                GOTO DLSUP
1769 C**   REVERSAL - PROCESS FOR OLD SETT.INSTRS. ONLY
1770 C   33                SETON                     64
1771 C**   VALUE DATE <= TODAY,SHADOW POSTING REQUIRED
1772 C           MEM3A     TAG                             ** MEM3A TAG **
     C** BIT SET IF RETAIL NOSTRO ACCOUNT ENTERED ON SCREEN
     C                     TESTB'2'       NOST#          74
     C** IF OLD SETT. DETAILS BEING PROCESSED, CHECK FOR RETAIL NOSTROS
     C                     SETON                     73
     C   64                EXSR NOSOLD
     C   64                TESTB'0'       NOST#          74
     C  N74                GOTO PSETAG
1784 C           MEMPAY    TAG                             ** MEMPAY TAG *
1785 C**
1786 C                     EXSR MEMSR
1787 C**   UPDATE MEMO FILE POSTING RECORD.
1788 C   10                SETON                     63
1789 C***63****************EXSR EXCPTN                                    CCB002
1790 C  N73                GOTO MEM2
1791 C*****RETAIN MEMO RRNM FOR DEALS FILE RECORD PREFIX.                 CCB002
1792 C***70****************Z-ADDRRNM      MRR3       7173                 CCB002
1793 C***69N70*************Z-ADDRRNM      MRR2       7073                 CCB002
1794 C**N69****************Z-ADDRRNM      MRR1       6973                 CCB002
1795 C*
1796 C**   PAYMENT SETTLEMENT INSTRUCTIONS
1797 C           PSETAG    TAG                             ** PSETT TAG **
     C                     SETOF                     73
     C** BIT ON IF PAY RETAIL NOSTRO ENTERED
     C                     TESTB'3'       NOST#          74
     C** IF OLD SETT. DETAILS BEING PROCESSED, CHECK FOR RETAIL NOSTROS
     C   64                EXSR NOSOLD
     C   64                TESTB'1'       NOST#          74
     C  N74                GOTO DLSUP
1807 C**   REPEAT PROCESS FOR PAY INSTRUCTIONS.
1808 C                     GOTO MEMPAY
1809 C*
1810 C*****RETAIN MEMO RRNM FOR DEALS FILE RECORD PREFIX.                 CCB002
1811 C           MEM2      TAG                             ** MEM2 TAG  **
1812 C***71****************Z-ADDRRNM      MRR4                            CCB002
1813 C***70N71*************Z-ADDRRNM      MRR3                            CCB002
1814 C***69N70*************Z-ADDRRNM      MRR2       70                   CCB002
1815 C**N69****************Z-ADDRRNM      MRR1       69                   CCB002
1823 C*
1824 C**   UPDATE DEALS FILE DETAIL RECORD
1825 C           DLSUP     TAG                             ** DLSUP TAG **
1863 C*
1864 C**   BIT SETTINGS FOR SPECIAL INSTRUCTIONS
1866 C                     BITOF'012'     DNSI
1886 C**   A/C ENTRIES / TELEX - BITS SET OFF
1887 C                     BITOF'01234567'ACEI
1888 C                     BITOF'01234567'TLXI
1889 C**   STORE SETTLEMENT TYPES FOR DTRIX FILE UPDATE.
1890 C           STRSET    TAG                             **STRSET TAG **
1891 C                     MOVE PCST      RSET    2
1892 C                     MOVE SCST      PSET    2
1893 C                     MOVE OPCA      OPDEAL  2
1894 C                     MOVE OSCA      OSDEAL  2
1951 C                     SETOF                       30
1952 C*
     C**                                                                  S01154
     C**   GET ACCOUNT NUMBER FOR SETTLEMENT INSTRUCTIONS - INSERT        S01154
     C**                                                                  S01154
     C           *IN31     IFEQ '1'                                       S01154
     C*****                MOVELBUYCCY    WRK5                      S01154S01194
     C*****                MOVELORECDR    WRK2                      S01154S01194
     C                     MOVELBUYCCY    @KEYB                           S01194
     C                     MOVELORECDR    @KEYE                           S01194
     C                     SETON                     73                   S01154
     C                     EXSR RSACC                                     S01154
     C*****                MOVELOPAYCR    WRK2                      S01154S01194
     C                     MOVELOPAYCR    @KEYE                           S01194
     C                     SETOF                     73                   S01154
     C                     EXSR RSACC                                     S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C**   GET ACCOUNT NUMBER FOR SETTLEMENT INSTRUCTIONS - DELETE        S01154
     C**                                                                  S01154
     C           *IN33     IFEQ '1'                                       S01154
     C*****                MOVELPUCY      WRK5                      S01154S01194
     C*****                MOVELOPCA      WRK2                      S01154S01194
     C                     MOVELPUCY      @KEYB                     S01154S01194
     C                     MOVELOPCA      @KEYE                     S01154S01194
     C                     SETON                     73                   S01154
     C                     EXSR RSACC                                     S01154
     C*****                MOVELSLCY      WRK5                      S01154S01194
     C*****                MOVELOSCA      WRK2                      S01154S01194
     C                     MOVELSLCY      @KEYB                     S01154S01194
     C                     MOVELOSCA      @KEYE                     S01154S01194
     C                     SETOF                     73                   S01154
     C                     EXSR RSACC                                     S01154
     C                     END                                            S01154
1970 C**   UPDATE DEALS FILE DETAIL RECORD
1971 C                     SETON                     88
1972 C                     EXSR TIME
     C/COPY WNCPYSRC,DL0035C002
1973 C                     EXSR EXCPTN
2044 C**   UPDATE DEALS FILE TRAILER RECORD
2046 C**
2049 C**   INSERT OR REVERSAL-UPDATE DEALS TRAILER
2050 C**   FOR OPTION TAKEDOWN, UPDATE NUMBER FIELDS ONLY.
2051 C**   ACCESS TRAILER RECORD
2052 C                     MOVE '999999'  DLKEY
2053 C                     EXSR DLCHN
2054 C**
2059 C*    UPDATE RELEVANT TOTAL FIELDS
2060 C   31      NORE      ADD  1         NORE
2061 C   31      NINS      ADD  1         NINS
2062 C   33      NDEL      ADD  1         NDEL
2063 C   31      NLRA      ADD  1         NLRA
2064 C   33      NLRA      SUB  1         NLRA
2067 C                     MOVE BAMT      ZZAMT
2068 C   31                Z-ADDVRIF      ZZTOTI
2069 C   31                Z-ADDVRIL      ZZTOTD
2070 C   33                Z-ADDVRDF      ZZTOTI
2071 C   33                Z-ADDVRDL      ZZTOTD
2072 C                     EXSR GLZADD
2073 C   31                Z-ADDZZTOTI    VRIF
2074 C   31                Z-ADDZZTOTD    VRIL
2075 C   33                Z-ADDZZTOTI    VRDF
2076 C   33                Z-ADDZZTOTD    VRDL
2077 C**
2078 C                     MOVE BAMT      ZZAMT
2079 C                     Z-ADDVLAF      ZZTOTI
2080 C                     Z-ADDVLAL      ZZTOTD
2081 C   31                EXSR GLZADD
2082 C   33                EXSR GLZSUB
2083 C                     Z-ADDZZTOTI    VLAF
2084 C                     Z-ADDZZTOTD    VLAL
2085 C*    UPDATE CONTROL FIELDS
2086 C           NOTOT     TAG                             ** NOTOT **
2087 C*********************Z-ADDRUND      LCD                             S01194
2087 C                     Z-ADDBJRDNB    LCD                             S01194
2088 C   31                MOVE 'I'       CHTP
2089 C   33                MOVE 'R'       CHTP
2090 C                     Z-ADDNATN      TNLUD
2119 C                     SETON                     87
2120 C                     EXSR EXCPTN
2161 C*
2162 C*
2163 C**   DTRIX DETAIL FILE UPDATE
2171 C**   SET PAY/RECEIVE INDICATORS.
2172 C                     Z-ADD0         PR1     10     73
2173 C                     Z-ADD0         PR3     10
2175 C                     MOVE RSETT     TYPE
2180 C***********          EXSR PRIND                                     E16905
2180 C                     EXSR PRIND                                     E20194
     C                     Z-ADDPR1       PR3
2181 C*
2188 C*
2195 C*    UPDATE DTRIX DETAIL RECORD
2196 C                     SETOF                     77
2197 C                     SETON                     6030
2198 C                     EXSR TIME
2199 C                     EXSR EXCPTN
2378 C*
2379 C**   PRONO FILE UPDATE
2381 C**   SET UP SUB-ROUTINE FIELDS.
2382 C                     MOVE RSETT     TYPE
2383 C                     MOVE ORECDR    OURS
2401 C                     SETON                     73
     C/COPY WNCPYSRC,DL0035C009
2402 C                     EXSR SRPRON
     C/COPY WNCPYSRC,DL0035C010
2403 C**   UPDATE REQUIRED FOR RECEIVE INSTRUCTIONS.
     C   74 16             DO
2413 C                     SETON                     62
2414 C                     EXSR TIME
     C                     EXSR RSUPDT                                    S01154
2415 C                     EXSR EXCPTN
     C                     END
2416 C*
2417 C**   REPEAT PROCESSING FOR PAYMENT INSTRUCTIONS
2419 C**   SET UP SUBROUTINE FIELDS .
2420 C                     MOVE PSETT     TYPE
2421 C                     MOVE OPAYCR    OURS
2439 C                     SETOF                     73
     C/COPY WNCPYSRC,DL0035C011
2440 C                     EXSR SRPRON
     C/COPY WNCPYSRC,DL0035C012
2441 C*
2442 C**   UPDATE PRONO FOR PAY INSTRUCTIONS.
2444 C   16 74             DO
2452 C                     SETON                     62
2453 C                     EXSR TIME
     C                     EXSR RSUPDT                                    S01154
2454 C                     EXSR EXCPTN
     C                     END
2247 C*
2243 C*    DTRIX HEADER FILE UPDATES
2247 C*
     C                     MOVE '1'       DXCHN   10
2228 C           DXCHN     CHAINDTRIXHH              28
     C*    DTRIX HEADER NOT FOUND
     C  N13                SETON                     U7U8
     C   U8                GOTO DSERR
     C*
2229 C*    UPDATE RELEVANT CONTROL FIELD
2232 C   13
2235 COR 33 26   NDLR      ADD  1         NDLR
2243 C*    UPDATE DTRIX HEADER
2244 C                     SETON                     60
2245 C                     EXSR TIME
2246 C                     EXSR EXCPTN
2247 C*
     C           CMTTXT    COMIT
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0035CCP1                                           S01408
     C*                                                                   S01408
2483 C**   OUTPUT INITIAL SCREEN FOR FURTHER PROCESSING
2485 C*    RE-SET INDICATORS AND SCREEN FIELDS.
2486 C                     SETOF                     4066
2487 C                     SETON                     3464
2488 C                     MOVE 'SF'      SRNID
2489 C                     MOVE '      '  DEALNO
2490 C                     MOVE ' '       ACTION
2491 C                     GOTO FINEND
2492 C*
2494 C**   SET INDICATORS TO RELEASE FILES AND SCREEN
2495 C           DSERR     TAG                             ** DSERR TAG **
2496 C                     SETON                     86
2499 C                     SETOF                     3840
2500 C                     EXSR EXCPTN
2501 C*
2502 C           FINEND    TAG                             **FINEND TAG **
2503 C**   SET INDICATORS FOR SCREEN OUTPUT.
2504 C  N31                SETON                     79
2505 C  N31                SETON                     78
2506 C   64                SETON                     7879
2507 C   34                SETOF                     23
2508 C  N80                SETON                     39
      *---- S01241 -------------------------------------------------------S01241
      * Test error code array and status                                  S01241
      *                                                                   S01241
     C           *IN80     IFEQ '1'                                       S01241
     C                     ADD  1         STS     10                      S01241
     C           STS       IFEQ 2                                         S01241
     C                     Z-ADD0         STS                             S01241
     C                     MOVE 'Y'       WIN     1                       S01241
     C                     END                                            S01241
     C                     END                                            S01241
      *                                                                   S01241
      *---- S01241 -------------------------------------------------------S01241
     C**   TO DISPLAY 'REVERSED DEAL' WHEN ENQUIRING ON A REVERSED DEAL   E11841
     C   34 05             MOVEAMSG,9     ERCD,A                          E11841
     C*                                                                   060935
     C** To display 'MATURED DEAL' when enquiring on a reversed deal      060935
     C*                                                                   060935
     C   34 12             MOVEAMSG,15    ERCD,A                          060935
     C*                                                                   067362
     C** To display 'HISTORIC DEAL' when enquiring on a historic deal     067362
     C*                                                                   067362
     C   34 15             MOVEAMSG,16    ERCD,A                          067362
     C                     MOVE '0'       *IN15                           067362
     C*                                                                   067362
2509 C           ERCD,A    COMP ' '                      81
2510 C**   PICK UP TIME FOR SCREEN OUTPUT
2511 C                     EXSR TIME
     C   86                SETON                     LR
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWTCH - Initiates the Midas Compliance Engine.               *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details Parameter                                         CSD015
      ** ============================================                                         CSD015
      *                                                                                       CSD015
     C                     CLEARSDWLTO                                                        CSD015
      *                                                                                       CSD015
      ** Item Type, Identifier, and Branch information.                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'DLNT'    W4ITEM                                              CSD015
     C                     MOVELDEALNO    W4IDEN                                              CSD015
     C                     MOVELBRCODE    W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** Select the System Prefix.                                                            CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'DEALSDB' W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Get the Counter Party Detail.                                                        CSD015
      *                                                                                       CSD015
     C                     EXSR SRGTCD                                                        CSD015
     C                     MOVELA8BICN    W4CNUM                                              CSD015
     C                     MOVELWCTYP     W4CTYP                                              CSD015
     C                     MOVELWCRPT     W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Get the Deal Date.                                                                   CSD015
      *                                                                                       CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Get the Value Date.                                                                  CSD015
      *                                                                                       CSD015
     C                     Z-ADDVDAYNO    W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Get the Maturity Date.                                                               CSD015
      *                                                                                       CSD015
     C                     Z-ADD0         W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Currency and Amount information.                                                     CSD015
      *                                                                                       CSD015
     C                     MOVELBUYCCY    W4DEN1                                              CSD015
     C                     Z-ADDBAMT      W4AMT1                                              CSD015
     C                     MOVELBUYCCY    W4DEN2                                              CSD015
     C                     Z-ADDBAMT      W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Build the Free Format String                                                         CSD015
      ** ============================                                                         CSD015
      *                                                                                       CSD015
      ** Initialise additional account line                                                   CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WSD                                                 CSD015
     C                     MOVELRIBA      WSD,2                                               CSD015
     C                     MOVELPIBA      WSD,6                                               CSD015
     C                     MOVELRCRA      WSD,9                                               CSD015
     C                     MOVELAWBA      WSD,11                                              CSD015
     C                     MOVELBENA      WSD,12                                              CSD015
      *                                                                                       CSD015
      ** Begin string and packet assembly.                                                    CSD015
      *                                                                                       CSD015
     C                     Z-ADD1         N       20                                          CSD015
     C                     MOVE *BLANKS   PFFS                                                CSD015
     C                     MOVE *BLANKS   WXPCKT                                              CSD015
     C                     MOVE *BLANKS   WDATA                                               CSD015
      *                                                                                       CSD015
     C           N         DOUEQARRMAX                                                        CSD015
      *                                                                                       CSD015
     C           WLF,N     IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** Select the currency for nostro fields.                                               CSD015
      *                                                                                       CSD015
     C           N         IFEQ 1                                                             CSD015
     C           RSCY      IFNE *BLANKS                                                       CSD015
     C                     MOVE RSCY      WCCY    3                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE BUYCCY    WCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           N         IFEQ 5                                                             CSD015
     C           PSCY      IFNE *BLANKS                                                       CSD015
     C                     MOVE PSCY      WCCY                                                CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE BUYCCY    WCCY                                                CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Call the detail retriever program.                                                   CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM           WLF,N                                               CSD015
     C                     PARM *BLANKS   PINPA  35                                           CSD015
     C                     PARM *BLANKS   PINPB  35                                           CSD015
     C                     PARM *BLANKS   PINPC  35                                           CSD015
     C                     PARM *BLANKS   PINPD  35                                           CSD015
     C                     PARM *BLANKS   PINPE  35                                           CSD015
     C                     PARM           WCCY                                                CSD015
     C                     PARM           WDATA 216                                           CSD015
     C                     PARM           POUTA   6                                           CSD015
      *                                                                                       CSD015
     C           '0 '      CHECKWDATA     WPOS    40                                          CSD015
      *                                                                                       CSD015
     C           WDATA     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDEQ*BLANKS                                                       CSD015
     C           WPOS      ANDNE0                                                             CSD015
     C                     CAT  XOT,N:0   WXPCKT                                              CSD015
     C                     CAT  WDATA:0   WXPCKT                                              CSD015
     C                     CAT  WSD,N:1   WXPCKT                                              CSD015
     C                     CAT  XCT,N:0   WXPCKT                                              CSD015
     C                     CAT  WXPCKT:0  PFFS                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WXPCKT                                              CSD015
     C                     MOVE *BLANKS   WDATA                                               CSD015
     C                     MOVE *BLANKS   WCCY                                                CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         N                                                   CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Add the Payment Details.                                                             CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     CAT  XOT,N:0   WXPCKT                                              CSD015
     C                     CAT  DTP1:0    WXPCKT                                              CSD015
     C                     CAT  DTP2:1    WXPCKT                                              CSD015
     C                     CAT  DTP3:1    WXPCKT                                              CSD015
     C                     CAT  DTP4:1    WXPCKT                                              CSD015
     C                     CAT  XCT,N:0   WXPCKT                                              CSD015
     C                     CAT  WXPCKT:0  PFFS                                                CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check for compliance.                                                                CSD015
      *                                                                                       CSD015
     C           PFFS      IFNE *BLANKS                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           SDWLTO                                              CSD015
     C                     PARM           PFFS                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRCMPC - Handles the entire compliance checking activities.   *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRCMPC    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
      ** Execute a direct compliance check on insert operations.                              CSD015
      *                                                                                       CSD015
     C           WCMPM     WHEQ ONINS                                                         CSD015
      *                                                                                       CSD015
     C                     MOVE ALL       WMOVM   1                                           CSD015
     C                     EXSR SRDB2W                                                        CSD015
     C                     EXSR SRWLFC                                                        CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If the action associated with the current record is Amend,                           CSD015
      ** check first if this record has been analysed by the CE.                              CSD015
      *                                                                                       CSD015
     C           WCMPM     WHEQ ONAMD                                                         CSD015
      *                                                                                       CSD015
     C                     EXSR SRRETC                                                        CSD015
      *                                                                                       CSD015
     C           WRFLG     IFEQ 'Y'                                                           CSD015
     C                     MOVE ALL       WMOVM                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE CHANGD    WMOVM                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     EXSR SRDB2W                                                        CSD015
     C                     EXSR SRWLFC                                                        CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'Y'                                                           CSD015
     C           WCHFLG    ANDEQ'Y'                                                           CSD015
     C           WRFLG     OREQ 'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRDB2W - Moves relevant database fields to their respective   *                       CSD015
      *          Watch List Fields.                                   *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRDB2W    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Watch List Fields array to blanks.                                    CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF                                                 CSD015
      *                                                                                       CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
      ** Execute an unconditional move if necessary.                                          CSD015
      *                                                                                       CSD015
     C           WMOVM     WHEQ ALL                                                           CSD015
      *                                                                                       CSD015
     C                     MOVELORECDR    WLF,1                                               CSD015
     C                     MOVELPTHEIR    WLF,2                                               CSD015
     C                     MOVELA8BICN    WLF,3                                               CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVELOPAYCR    WLF,5                                               CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVELRTHEIR    WLF,11                                              CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
      *                                                                                       CSD015
     C           WMOVM     WHEQ CHANGD                                                        CSD015
      *                                                                                       CSD015
      ** Move only the fields that have changed since the last save.                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WCHFLG  1                                           CSD015
      *                                                                                       CSD015
     C           ORECDR    IFNE BCRONS                                                        CSD015
     C                     MOVELRONS      WLF,1                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PTHEIR    IFNE BCRIBN                                                        CSD015
     C                     MOVELRIBN      WLF,2                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C**********           MOVE A8BICN    WBICN   60                                   CSD015 CSD027
     C                     MOVE A8BICN    WBICN   6                                           CSD027
     C           WBICN     IFNE BCROBN                                                        CSD015
     C                     MOVELROBN      WLF,3                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           ROCN      IFNE BCROCN                                                        CSD015
     C                     MOVELROCN      WLF,4                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           OPAYCR    IFNE BCPONS                                                        CSD015
     C                     MOVELPONS      WLF,5                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PIBN      IFNE BCPIBN                                                        CSD015
     C                     MOVELPIBN      WLF,6                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           POBN      IFNE BCPOBN                                                        CSD015
     C                     MOVELPOBN      WLF,7                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           POCN      IFNE BCPOCN                                                        CSD015
     C                     MOVELPOCN      WLF,8                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RCRN      IFNE BCRCRN                                                        CSD015
     C                     MOVELRCRN      WLF,9                                               CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RVNO      IFNE BCRVNO                                                        CSD015
     C                     MOVELRVNO      WLF,10                                              CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           RTHEIR    IFNE BCAWBN                                                        CSD015
     C                     MOVELAWBN      WLF,11                                              CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BENN      IFNE BCBENN                                                        CSD015
     C                     MOVELBENN      WLF,12                                              CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           DTP1      IFNE BCDTP1                                                        CSD015
     C           DTP2      ORNE BCDTP2                                                        CSD015
     C           DTP3      ORNE BCDTP3                                                        CSD015
     C           DTP4      ORNE BCDTP4                                                        CSD015
     C                     MOVE 'Y'       WCHFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWLFC - Checks if there is something useful to return to     *                       CSD015
      *          to the Compliance Engine.                            *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWLFC    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check the Watch List Fields array.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WOKFLG  1                                           CSD015
     C                     Z-ADD1         N                                                   CSD015
      *                                                                                       CSD015
     C           N         DOUEQARRMAX                                                        CSD015
     C           WLF,N     IFNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WOKFLG                                              CSD015
     C                     LEAVE                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ADD  1         N                                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Check the Payment Details.                                                           CSD015
      *                                                                                       CSD015
     C           WOKFLG    IFEQ 'N'                                                           CSD015
     C           DTP1      IFNE *BLANKS                                                       CSD015
     C           DTP2      ORNE *BLANKS                                                       CSD015
     C           DTP3      ORNE *BLANKS                                                       CSD015
     C           DTP4      ORNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WOKFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRRETC - Checks if the current record is unconfirmed by the   *                       CSD015
      *          the Compliance Engine.                               *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRRETC    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       WRFLG   1                                           CSD015
     C                     MOVE *IN60     WINDF   1                                           CSD015
     C                     MOVE *BLANKS   KFUNT                                               CSD015
     C                     MOVE *BLANKS   KIDEN                                               CSD015
     C                     MOVE *BLANKS   KBRCH                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'DEALSDB' KFUNT                                               CSD015
     C                     MOVELDLNO      KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
      *                                                                                       CSD015
     C           KCWHT     CHAINSDCWHTL1             60                                       CSD015
      *                                                                                       CSD015
     C           *IN60     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C                     MOVE 'Y'       WRFLG                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE WINDF     *IN60                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRGTCD - Gets the Counterparty Details given a Customer       *                       CSD015
      *          Number.                                              *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRGTCD    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the relevant variables.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PCUST  10                                           CSD015
     C                     MOVE *BLANKS   WCRPT  30                                           CSD015
     C                     MOVE *BLANKS   WCTYP   1                                           CSD015
     C                     MOVELA8BICN    PCUST                                               CSD015
      *                                                                                       CSD015
      ** Get the Customer Detail.                                                             CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM           PCUST                                               CSD015
     C                     PARM *BLANKS   PERROR  7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** Assemble the Counterparty Report information.                                        CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    WCRPT                                               CSD015
      *                                                                                       CSD015
      ** Determine the Counterparty Type.                                                     CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Handle Database Errors if any occur.                                                 CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE '*NRF'                                                        CSD015
     C                     GOTO TABMIS                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRSWLF - Saves the current Watch List Fields to the data      *                       CSD015
      *          store.                                               *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRSWLF    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WBC                                                 CSD015
      *                                                                                       CSD015
     C                     MOVELRONS      BCRONS                                              CSD015
     C                     MOVELRIBN      BCRIBN                                              CSD015
     C                     MOVELROBN      BCROBN                                              CSD015
     C                     MOVELROCN      BCROCN                                              CSD015
     C                     MOVELPONS      BCPONS                                              CSD015
     C                     MOVELPIBN      BCPIBN                                              CSD015
     C                     MOVELPOBN      BCPOBN                                              CSD015
     C                     MOVELPOCN      BCPOCN                                              CSD015
     C                     MOVELRCRN      BCRCRN                                              CSD015
     C                     MOVELRVNO      BCRVNO                                              CSD015
     C                     MOVELAWBN      BCAWBN                                              CSD015
     C                     MOVELBENN      BCBENN                                              CSD015
     C                     MOVELDTP1      BCDTP1                                              CSD015
     C                     MOVELDTP2      BCDTP2                                              CSD015
     C                     MOVELDTP3      BCDTP3                                              CSD015
     C                     MOVELDTP4      BCDTP4                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                              073516
      *****************************************************************   073516
      *                                                               *   073516
      *       TITLE:BACK OFFICE AMOUNT EDITOR .                       *   073516
      *                                                               *   073516
      *       SUBROUTINE ZA0920 ACCEPTS AN AMOUNT FIELD (13N) AND     *   073516
      *       A FIELD (1N) SPECIFYING NO. OF DECIMALS AND WITH THIS   *   073516
      *       CONVERTS THE AMOUNT INTO AN ALPHAMERIC FIELD (14A)      *   073516
      *       WITH THE REQUIRED DECIMAL PLACE.                        *   073516
      *                                                               *   073516
      *                                                               *   073516
      * INPUT  :@@AMTW AMOUNT      FORMAT(13N)                        *   073516
      *         @@QECN DECIMAL NO. FORMAT(1N)                         *   073516
      *                                                               *   073516
      * OUTPUT :@@AMTD AMOUNT WITH DECIMAL FORMAT(14A)                *   073516
      *                                                               *   073516
      * USES :  @@AMTW AMOUNT FIELD PASSED                            *   073516
      *         @@QECN NO. OF DECIMAL FIELD                           *   073516
      *         @@QECW POSITION ON ARRAY @Z  FOR A DECIMAL POINT      *   073516
      *         @@SIG  POSITION ON ARRAY THAT CANNOT BE BLANK         *   073516
      *         @@Z    INDEX FOR ARRAY @Z                             *   073516
      *         @@Q    INDEX FOR ARRAY @Q                             *   073516
      *         @@SWT  SWITCH SAYING ZERO HAS BEEN SUPPRESSED         *   073516
      *         @@SWT1 SWITCH SAYING ZERO SUPPRESSION OVER            *   073516
      *                                                               *   073516
      * ARRAYS:  @Z ARRAY USED FOR DECIMAL ALIGNMENT                  *   073516
      *          @Q ARRAY USED FOR STORING AMOUNT PASSED TO THE SR    *   073516
      *                                                               *   073516
      *****************************************************************   073516
      *                                                               *   073516
     C           ZA0920    BEGSR                                          073516
      *                                                                   073516
      * INITIALIZATION                                                    073516
     C                     MOVE '0'       @@SWT1  1                       073516
      *                                                                   073516
      * FINDING WHERE DECIMAL POSITION IS                                 073516
      *                                                                   073516
     C           14        SUB  @@QECN    @@QECW  20                      073516
      *                                                                   073516
      * FINDING OUT MOST SIGNIFICANT POSITION                             073516
      *                                                                   073516
     C           @@QECW    SUB  1         @@SIG   20                      073516
     C                     MOVEA*BLANKS   @Z                              073516
     C                     Z-ADD1         @@Q     20                      073516
      *                                                                   073516
      * CHECK TO SEE IF NO.OF DECIMAL PLACES IS ZERO. IF ZERO             073516
      * THEN SIGNIFICANT POSITION IS 14 AND POSITION 1 IS BLANK           073516
     C           @@QECW    IFEQ 14                                        073516
     C                     Z-ADD14        @@SIG                           073516
     C                     Z-ADD2         @@Z     20                      073516
     C                     ELSE                                           073516
     C                     Z-ADD1         @@Z     20                      073516
     C                     END                                            073516
      *                                                                   073516
      * PERFORMING ACTUAL MOVEMENT                                        073516
     C           @@Z       DOWLT15                                        073516
     C           @@Q       ANDLT14                                        073516
      *                                                                   073516
      * SWITCH FOR ZERO SUPPRESSION                                       073516
     C                     MOVE '0'       @@SWT                           073516
      *                                                                   073516
      * IF ELEMENT OF ARRAY @Q  IS ZERO AND INDEX @@Z FOR ARRAY @Z        073516
      * IS *LT SIG.POSITION AND ALSO *LT DECIMAL POSITION THEN ZERO       073516
      * CAN BE SUPPRESSED AND ZERO SUPPRESSION SWITCH IS SETON            073516
      *                                                                   073516
     C           @Q,@@Q    IFEQ 0                                         073516
     C           @@SWT1    ANDEQ'0'                                       073516
     C           @@Z       ANDLT@@SIG                                     073516
     C           @@Z       ANDLT@@QECW                                    073516
     C                     MOVE *BLANK    @Z,@@Z                          073516
     C                     MOVE '1'       @@SWT   1                       073516
     C                     END                                            073516
      *                                                                   073516
      * IF INDEX @@Z FOR ARRAY @Z IS EQUAL TO THE DECIMAL POSITION        073516
      * AND NOT EQUAL TO THE LENGTH OF THE ARRAY @Z(14) THEN MOVE         073516
      * DECIMAL POSITION AND INCREMENT @@Z BY 1                           073516
      *                                                                   073516
     C           @@Z       IFEQ @@QECW                                    073516
     C           @@Z       ANDNE14                                        073516
     C                     MOVE BNDCSP    @Z,@@Z                          073516
     C                     ADD  1         @@Z                             073516
     C                     END                                            073516
      *                                                                   073516
      * IF ZERO HAS NOT BEEN SUPPRESSED THEN MOVE ELEMENT FROM ARRAY      073516
      * @Q TO @Z.SETON ZERO SUPPRESSION SWITCH OVER(@@SWT1)               073516
     C           @@SWT     IFEQ '0'                                       073516
     C                     MOVE @Q,@@Q    @Z,@@Z                          073516
     C                     MOVE '1'       @@SWT1                          073516
     C                     END                                            073516
      *                                                                   073516
     C                     ADD  1         @@Q                             073516
     C                     ADD  1         @@Z                             073516
      *                                                                   073516
     C                     END                                            073516
      *                                                                   073516
      * Dummy moves for definition of work fields.                        073516
     C                     GOTO ZA0929                                    073516
     C                     MOVE @@QECN    @@QECN  10                      073516
      *                                                                   073516
     C           ZA0929    ENDSR                                          073516
      *****************************************************************   073516
      /EJECT                                                              073516
2512 C********************************************************************
2513 C**   SUB-ROUTINE TO OUTPUT DATA AT EXCEPTION TIME
2514 C**
2515 C           EXCPTN    BEGSR                           ** EXCPTN SUBR*
     C                     BITOF'0'       ORIG
     C   82                BITON'0'       ORIG
     C                     SETOF                     82
     C                     TESTB'0'       NEW            82
2516 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0035CCP3                                           S01408
     C*                                                                   S01408
      *                                                                                       CSD015
      ** If Compliance Watch is enabled, check for pending cases.                             CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C           CSC011    ORNE 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           *IN88     IFEQ '1'                                                           CSD015
     C           *IN30     ANDEQ'0'                                                           CSD015
     C           *IN22     ANDEQ'1'                                                           CSD015
     C                     MOVE ONINS     WCMPM   1                                           CSD015
     C                     EXSR SRCMPC                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           *IN88     IFEQ '1'                                                           CSD015
     C           *IN30     ANDEQ'0'                                                           CSD015
     C           *IN22     ANDEQ'0'                                                           CSD015
     C                     MOVE ONAMD     WCMPM                                               CSD015
     C                     EXSR SRCMPC                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CLE025    IFEQ 'Y'                                                          BUG3937
      *                                                                                      BUG3937
     C           *IN88     IFEQ *ON                                                          BUG3937
     C           *IN30     ANDEQ*OFF                                                         BUG3937
     C           *IN22     ANDEQ*ON                                                          BUG3937
     C                     MOVE *ON       *IN14                                              BUG3937
     C                     ENDIF                                                             BUG3937
      *                                                                                      BUG3937
     C                     ENDIF                                                             BUG3937
      *                                                                                      BUG3937
2517 C                     EXCPT
     C                     SETOF                     82
     C                     MOVE *OFF      *IN14                                              BUG3937
     C                     TESTB'0'       ORIG           82
2518 C**   RE-SET INDICATORS
2519 C                     SETOF                     308183
2520 C                     SETOF                     798587
2521 C                     SETOF                     888968
2522 C                     SETOF                     606162
2523 C                     SETOF                     6378
2524 C*
2525 C                     ENDSR
2526 C********************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************
2527 C**   SUB-ROUTINE TO ASCERTAIN CORRECT TIME
2528 C           TIME      BEGSR                           ** TIME SUBR **
2529 C                     TIME           MTIME   60
     C                     MOVELMTIME     TIM     40
2530 C                     ENDSR
2540 C********************************************************************S01194
2541 C*****SUB-ROUTINE TO CHAIN TO TABLE FILE                             S01194
2542 C*****                                                               S01194
2543 C*****      TABCHN    BEGSR                           * TABCHN SUBR *S01194
2544 C*****                                                               S01194
2545 C*****                SETOF                     29                   S01194
2546 C*****                MOVE ' '       RECI                            S01194
2547 C*****      TABKEY    CHAINTABLE                29                   S01194
2548 C**N29      RECI      COMP 'D'                  2929                 S01194
2549 C*****                                                               S01194
2550 C*****                ENDSR                                          S01194
2551 C********************************************************************
     C**   SUBROUTINE TO READ THE FIRST AND ONLY RECORD ON DEAL NUMBER    E22644
     C**   RECORDS FILE                                                   E22644
     C           CHKNO     BEGSR                           ** CHKNO SUBR *E22644
     C           1         SETLLFDDLNMLL                                  E22644
     C           *IN37     DOUEQ'1'                                       E22644
     C           NODLTF    OREQ *BLANKS                                   E22644
     C                     READ FDDLNMLL                 37               E22644
     C                     END                                            E22644
     C                     ENDSR                                          E22644
     C********************************************************************E22644
2552 C**   SUB-ROUTINE TO CHAIN TO DEALS FILE
2553 C**
2554 C           DLCHN     BEGSR                           ** DLCHN SUBR *
2555 C*
2556 C                     SETOF                     060708
2557 C                     SETOF                     0922
2558 C*
2559 C           DLKEY     CHAINDEALS                22
2555 C*
2561 C                     ENDSR
2551 C********************************************************************E17641
2552 C*****SUB-ROUTINE*TO*CHAIN*TO*DLDEALL*FILE.****************** E17641 042960
2552 C*    SUB-ROUTINE TO CHAIN TO DEALSALL FILE.                     *   042960
2553 C**                                                                  E17641
2554 C           DLCHN3    BEGSR                           **DLCHN3 SUBR *E17641
2555 C*                                                                   E17641
2556 C                     SETOF                     22                   E17641
2559 C***********DLKEY     CHAINDLDEALL              22            E17641 042960
     C           *LIKE     DEFN DLNO      @DLNO                           042960
     C                     MOVE DLKEY     @DLNO            *1             042960
     C           @DLNO     CHAINDEALSALL             22                   042960
     C           *IN22     IFEQ '0'                                       067362
     C                     MOVE '1'       *IN15                           067362
     C                     ENDIF                                          067362
2555 C*                                                                   E17641
2561 C                     ENDSR                                          E17641
2558 C*                                                                   E17641
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C***********ZA1,ZX****COMP '.'                      90               073516
     C           ZA1,ZX    COMP BNDCSP                   90               073516
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
2690 C********************************************************************
2691 C**   SUB-ROUTINE TO SET UP SCREEN FIELDS FROM DATA
2692 C**   TAKEN FROM FILES
2693 C           SCFILL    BEGSR                           ** SCFILL SUBR*
2698 C*    VALUE DATE
2699 C                     Z-ADDVDAT      ZDAYNO
2700 C                     EXSR ZDATE2
2701 C                     Z-ADDZDATE     VDATSF  60
2714 C*    AMOUNT FIELDS
2734 C*    CHECK NO OF DECIMALS FOR BUY CCY
2735 C*****                MOVEL'20      'TABKEY                          S01194
2736 C*****                MOVELPUCY      WRK4                            S01194
2737 C*****                MOVE WRK4      TABKEY                          S01194
2738 C*****                EXSR TABCHN                                    S01194
2739 C*****                                                               S01194
2740 C*****      CDP       COMP 1                      2425               S01194
2741 C*****      CDP       COMP 2                    27  26               S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM PUCY      @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C***********          PARM           SDCURR                          S01194
2740 C           A6NBDP    COMP 1                      2425               S01194
2741 C           A6NBDP    COMP 2                    27  26               S01194
     C*                                                                   073516
     C*  Edit amount field for output                                     073516
     C   24                Z-ADD0         @@QECN                          073516
     C   25                Z-ADD1         @@QECN                          073516
     C   26                Z-ADD2         @@QECN                          073516
     C   27                Z-ADD3         @@QECN                          073516
     C                     Z-ADDPUAM      @@AMTW                          073516
     C                     EXSR ZA0920                                    073516
2769 C*
2770 C                     ENDSR
     C********************************************************************
2780 C**   SUB-ROUTINE TO CHAIN TO THE A/C MASTER FILE
2781 C**
2782 C           ACCHN     BEGSR                           ** ACCHN SUBR *
2783 C*
2784 C**   SET REC-ID TO BLANK.
2785 C                     MOVE ' '       RECI
2786 C                     SETOF                     28
2787 C           ACCKEY    CHAINACCNT                28
2788 C*
2789 C  N28      RECI      COMP 'D'                  2828
2790 C*
2791 C                     ENDSR
2792 C********************************************************************
2793 C**   SUB-ROUTINE TO CHAIN TO PROJECTED NOSTROS FILE
2794 C           NOSCHN    BEGSR                           ** NOSCHN SUBR*
2795 C*
2796 C                     SETOF                     1628
2797 C           NOSKEY    CHAINPRONO                28
2798 C*
2799 C                     ENDSR
2808 C********************************************************************
2818 C**   SUB-ROUTINE TO CHAIN TO MEMOS FILE.
2819 C**
2820 C           MEMCHN    BEGSR                           **MEMCHN SUBR**
2821 C*
2822 C                     SETOF                     1028
2823 C***********RRNM      CHAINMEMOS                28                   CCB002
2824 C*
     C*                                                                   CCB002
     C** MOVE ALPHA FIELDS TO NUMERICS FROM DS/ACCKEY                     CCB002
     C*                                                                   CCB002
     C**********           MOVE #CNUM     #CNUMN  60                                   CCB002 CSD027
     C                     MOVE #CNUM     #CNUMN  6                                           CSD027
     C**********           MOVE #ACOD     #ACODN  40                                   CCB002 CGL029
     C                     MOVE #ACOD     #ACODN 100                                          CGL029
     C                     MOVE #ACSQ     #ACSQN  20                      CCB002
     C*                                                                   CCB002
     C** CHAIN ACCESS OBJECT AOMEMSUO                                     CCB002
     C*                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD  7        I:Return code  CCB002
     C                     PARM 0         W0ACNO 100       O:Retail A/C NoCCB002
     C**********           PARM #CNUMN    W0CNUM  60       O:Customer No.              CCB002 CSD027
     C                     PARM #CNUMN    W0CNUM  6        O:Customer No.                     CSD027
     C                     PARM #CCY      W0CCY   3        O:Currency     CCB002
     C**********           PARM #ACODN    W0ACOD  40       O:Account Code              CCB002 CGL029
     C                     PARM #ACODN    W0ACOD 100                                          CGL029
     C                     PARM #ACSQN    W0ACSQ  20       O:Account Seq. CCB002
     C                     PARM #BRCA     W0BRCA  3        O:Branch       CCB002
     C                     PARM BJRDNB    W0PSTD  50       O:Posting date CCB002
     C                     PARM BJRDNB    W0VDAT  50       O:Value date   CCB002
     C                     PARM #PAMT     W0AMT  150       O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV  1        O:FT override  CCB002
     C*                                                           LDBL Up CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '1'       *IN10                           CCB002
     C                     EXSR INFSR                                                         164405
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL0035C006
     C*                                                                   CCB002
2825 C                     ENDSR
2941 C********************************************************************
2942 C*****SUB-ROUTINE TO CHECK FOR WARNING ERRORS.                       S01117
2943 C*****      SRWARN    BEGSR                           ** WARN SUBR **S01117
2944 C*****                                                               S01117
2950 C*****                MOVE BUYCCY    ZCCY                            S01117
2960 C*****DATE MUST BE A WORKING DAY                                     S01117
2962 C*****                EXSR ZDATE5                                    S01117
2963 C*****                                                               S01117
2964 C**N99                GOTO WRNEND                                    S01117
2965 C*****WARNING ERRORS FOUND.                                          S01117
2966 C*****                MOVE ' W01'    ERCD,S                          S01117
2969 C*****SET ON SCREEN INDICATORS TO FLASH ERROR FIELDS.                S01117
2970 C*****      S         ADD  1         S                               S01117
2972 C*****                SETON                     51                   S01117
2974 C*****                                                               S01117
2975 C*****      WRNEND    ENDSR                                          S01117
2976 C********************************************************************S01117
2977 C**   VALIDATE RECEIVE /PAY SETTLEMENT INSTRUCTIONS
2978 C**
2979 C           SETTLE    BEGSR                           **SETTLE SUBR**
2987 C**   SETTLEMENT METHOD MUST BE ON 01,07 OR 08
2988 C           TYPE      COMP '01'                     77
2988 C  N77      TYPE      COMP '07'                     77
2988 C  N77      TYPE      COMP '08'                     77
2989 C  N77                MOVE ' 037'    ERCD,S
2990 C  N77                GOTO SETERR
2991 C*
3004 C**   FOR TYPE 07,RELATED CCY MUST BE USD
3005 C           TYPE      COMP '07'                     77
3006 C***77******BUYCCY    COMP USCY                 6565                 S01194
3006 C   77      BUYCCY    COMP BLUSCY               6565                 S01194
     C  N77
3009 COR 77N65             GOTO OURST
3010 C                     MOVE ' 060'    ERCD,S
3011 C*    INVALID SETTLEMENT TYPE
3012 C           SETERR    TAG                             ** SETERR TAG *
     C*******************  SETOF                     6566                 E13149
     C           *IN73     IFEQ '1'                                       E13149
     C                     MOVE '0'       *IN65                           E13149
     C                     ELSE                                           E13149
     C                     MOVE '0'       *IN66                           E13149
     C                     END                                            E13149
     C********             SETOF                     6566                 E19095
3013 C   73      S         ADD  1         S          65
3014 C  N73      S         ADD  1         S          66
3015 C*
3016 C**   VALIDATE OUR RECEIVE / PAY BANK
3017 C           OURST     TAG                             ** OURS TAG **
3034 C*****CHECK NOSTRO CODE EXISTS ON TABLE FILE                         S01194
3038 C*****                MOVELOURS      NOSTNO                          S01194
3039 C*****                MOVE NOSTNO    WRK5    5                       S01194
3040 C*****                MOVELBUYCCY    WRK5                            S01194
3042 C*****                MOVEL'70      'TABKEY                          S01194
3043 C*****                MOVE WRK5      TABKEY                          S01194
3044 C*****                EXSR TABCHN                                    S01194
3034 C**   CHECK NOSTRO CODE EXISTS ON FILE (VIA ACCESS PROGRAM)          S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @KEYA   6                       S01194
     C                     PARM BUYCCY    @KEYB   3                       S01194
     C**********           PARM *BLANKS   @KEYC   4                                    S01194 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01194
     C                     PARM OURS      @KEYE   2                       S01194
     C                     PARM *BLANKS   @KEYF   3                       S01194
     C                     PARM *BLANKS   @KEYG  10                       S01194
     C                     PARM *BLANKS   @KEYH   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C***********          PARM           SDNOST                          S01194
     C           @RTCD     IFEQ '*NOSEL '                                 197513
     C                     MOVE *BLANK    SDNOST                          197513
     C                     END                                            197513
3045 C*    INVALID NOSTRO CODE ENTERED
     C           @RTCD     IFNE *BLANKS                                   S01194
3047 C***29**              MOVE ' 041'    ERCD,S                          S01194
3048 C***29**              GOTO OURERR                                    S01194
3047 C                     MOVE ' 041'    ERCD,S                          S01194
3048 C                     GOTO OURERR                                    S01194
     C                     END                                            S01194
     C/COPY WNCPYSRC,DL0035C003
      *                                                                   S01117
      ** If not multibranching , the nostro branch must equal the         S01117
      *  SINGLE branch.                                                   S01117
     C           @MBIN     IFNE 'Y'                                       S01117
     C           A7BRCD    ANDNEBJSBRC                                    S01117
     C                     MOVE ' 045'    ERCD,S                          S01117
     C                     GOTO OURERR                                    S01117
     C                     END                                            S01117
      *                                                                   S01117
     C**   SET UP 'THEIRS' FOR OUTPUT
     C** 73                MOVELCNUM      RTHEIR 10                       BHF678
     C**N73                MOVELCNUM      PTHEIR 10                       BHF678
     C   73                MOVELA7CUST    RTHEIR 10                       BHF678
     C  N73                MOVELA7CUST    PTHEIR 10                       BHF678
      *                                                                   S01117
      **  Set pay/receive settlement branches for output.                 S01117
      *                                                                   S01117
     C           *IN73     IFEQ '1'                                       S01117
     C***** MNFIX          MOVE A7BRCD    POBR                      S01117BHF970
     C                     MOVE A7BRCD    ROBR                            BHF970
     C                     ELSE                                           S01117
     C***** MNFIX          MOVE A7BRCD    ROBR                      S01117BHF970
     C                     MOVE A7BRCD    POBR                            BHF970
     C                     END                                            S01117
     C**
     C**   CHECK IF NOSTRO CODE ENTERED IS RETAIL,
     C**    - IF IT IS CHECK ACCOUNT IS LIVE
     C**     AND BACK-VALUE PERIOD IS NOT EXCEEDED
     C**     AND VALUE DATE IS NOT BEFORE DATE ACCOUNT OPENED
     C                     EXSR NOSCHK
3147 C                     GOTO SETEND
3148 C**   'OUR'FIELD ERROR ON RECEIPT/PAYMENT INSTRUCTIONS
3149 C           OURERR    TAG                             **OURERR TAG **
3150 C   73      S         ADD  1         S          67
3151 C  N73      S         ADD  1         S          68
3152 C*
     C/COPY WNCPYSRC,DL0035C004
3249 C           SETEND    ENDSR
3250 C********************************************************************
3251 C**   SUB-ROUTINE TO VALIDATE NOSTRO ACCOUNTS
     C**       (*IN73 - ON IF PROCESSING RECEIVE INSTRUCTIONS)
3252 C**
3253 C           NOSCHK    BEGSR                           ** NOSCHK SR **
     C**
     C** SET UP KEY AND GET ACCOUNT DETAILS
     C*****                MOVELCNUM      WRK9    9                       S01117
     C*****                MOVE CCY       WRK9                            S01117
     C*****                MOVELACOD      WRK6                            S01117
     C*****                MOVE ACSQ      WRK6                            S01117
     C*****                MOVELWRK9      ACCKEY                          S01117
     C*****                MOVE WRK6      ACCKEY                          S01117
     C                     MOVELA7CUST    @CNUM                     S01117S01194
     C                     MOVE A7CYCD    @CCY                      S01117S01194
     C                     MOVELA7ACCD    @ACOD                     S01117S01194
     C                     MOVE A7ACSN    @ACSQ                     S01117S01194
     C                     MOVELA7BRCD    @BRCA                     S01117S01194
     C                     MOVEL@ACCNO    ACCKEY                          S01117
     C           ACCKEY    CHAINACCNT                28
     C**
     C**  ACCOUNT MUST BE LIVE
     C  N28      RECI      COMP 'D'                  2828
     C  N28      ACST      COMP 'C'                      28
     C**
     C** IF LIVE ACCOUNT, CHECK IF RETAIL A/C
     C  N28      ATYP      COMP 'R'                      74
     C**
     C** CHECK 'VALUE DATE' NOT EARLIER THAN DATE A/C OPENED
     C  N28 74   VDAYNO    COMP DACO                   28
     C**
     C** IF RETAIL A/C CHECK BACK-VALUE PERIOD NOT EXCEEDED
     C**N28*74** RUND      SUB  VDAYNO    BVAL    50                      S01194
     C  N28 74   BJRDNB    SUB  VDAYNO    BVAL    50                      S01194
     C**N28*74***BVAL      COMP BVLP                 28                   S01194
     C  N28 74   BVAL      COMP BJBVPD               28                   S01194
     C**
     C** SET ERROR CODES IF A/C INVALID
     C***28                MOVE '052'     ERCD,S                          S01117
     C   28                MOVE ' 052'    ERCD,S                          S01117
     C   28 73             ADD  1         S          67
     C   28N73             ADD  1         S          68
     C   28                GOTO ENDNCH
     C**
     C**  SAVE ACCOUNT KEY DETAILS
     C***73****************MOVE ACCKEY    NEWKY1 15                       S01117
     C**N73****************MOVE ACCKEY    NEWKY2 15                       S01117
     C   73                MOVE ACCKEY    NEWKY1                          S01117
     C  N73                MOVE ACCKEY    NEWKY2                          S01117
     C**
     C** SET ON BITS FOR VALID RETAIL NOSTRO CODE FOUND
     C           *IN74     IFEQ '1'                                       164679
     C   73                BITON'2'       NOST#
     C  N73                BITON'3'       NOST#
     C                     ENDIF                                          164679
     C           ENDNCH    ENDSR
     C**
3250 C********************************************************************
3251 C**   SUB-ROUTINE TO CHECK FOR RETAIL NOSTRO ACCOUNTS
3252 C**
3253 C           NOSOLD    BEGSR                           ** NOSOLD SRR *
     C**
     C**  CHECK IF OLD SETTLEMENT TYPE IS A NOSTRO
     C   73                MOVE PCST      TYPE
     C  N73                MOVE SCST      TYPE
     C**
     C**  GET NOSTRO DETAILS, IF NOSTRO TYPE
     C***73                MOVELOPCA      WRK2    2                       S01194
     C**N73                MOVELOSCA      WRK2                            S01194
     C*****                MOVE WRK2      WRK5                            S01194
     C***73                MOVELPUCY      WRK5                            S01194
     C**N73                MOVELSLCY      WRK5                            S01194
     C*****                MOVEL'70      'TABKEY                          S01194
     C*****                MOVE WRK5      TABKEY                          S01194
     C*****                EXSR TABCHN                                    S01194
     C***29                GOTO ENDNSS                                    S01194
     C           *IN73     IFEQ '1'                                       S00194
     C                     MOVELOPCA      @KEYE                           S01194
     C                     MOVELPUCY      @KEYB                           S01194
     C                     ELSE                                           S01194
     C                     MOVELOSCA      @KEYE                           S01194
     C                     MOVELSLCY      @KEYB                           S01194
     C                     END                                            S01194
     C**                                                                  S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @KEYA   6                       S01194
     C                     PARM           @KEYB   3                       S01194
     C**********           PARM *BLANKS   @KEYC   4                                    S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01194
     C                     PARM           @KEYE   2                       S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C***********          PARM           SDNOST                          S01194
3045 C*    INVALID NOSTRO CODE ENTERED                                    S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     GOTO ENDNSS                                    S01194
     C                     END                                            S01194
     C**
     C**  GET ACCOUNT DETAILS
     C*****                MOVELCNUM      WRK9
     C*****                MOVE CCY       WRK9
     C*****                MOVELACOD      WRK6
     C*****                MOVE ACSQ      WRK6
     C*****                MOVELWRK9      ACCKEY 15                       S01117
     C*****                MOVE WRK6      ACCKEY                          S01117
     C                     MOVELA7CUST    @CNUM                     S01117S01194
     C                     MOVE A7CYCD    @CCY                      S01117S01194
     C                     MOVELA7ACCD    @ACOD                     S01117S01194
     C                     MOVE A7ACSN    @ACSQ                     S01117S01194
     C                     MOVELA7BRCD    @BRCA                     S01117S01194
     C                     MOVEL@ACCNO    ACCKEY                          S01117
     C           ACCKEY    CHAINACCNT                74
     C**
     C** CHECK IF RETAIL ACCOUNT
     C           ATYP      COMP 'R'                  7474
     C   74                GOTO ENDNSS
     C**
     C**  SAVE ACCOUNT DETAILS FOR USE IN MEMOSR
     C***73****************MOVE ACCKEY    OLDKY2 15                       S01117
     C**N73****************MOVE ACCKEY    OLDKY1 15                       S01117
     C   73                MOVE ACCKEY    OLDKY2                          S01117
     C  N73                MOVE ACCKEY    OLDKY1                          S01117
     C**
     C** SET ON BITS TO SHOW VALID RETAIL NOSTRO FOUND
     C   73                BITON'0'       NOST#
     C  N73                BITON'1'       NOST#
     C**
     C           ENDNSS    ENDSR
     C**
3250 C********************************************************************
      * ERROR FIX E16905 REMOVED THIS SUBROUTINE                          E16905
      * ERROR FIX E20194 REPLACED THIS SUBROUTINE                         E20194
      *
3251 C**   SUB-ROUTINE TO SET PAY/RECEIVE INDS .ON DTRIX DETAIL RECORD
3252 C**
3253 C           PRIND     BEGSR                           ** PRIND SUBR *
3259 C*****                Z-ADDRUND      ZDAYNO                          S01194
3265 C*****                MOVE BUYCCY    ZCCY                            S01194
3267 C*****                MOVELBUYCCY    WRK4                            S01194
3269 C*****                MOVE WRK4      TABKEY                          S01194
3270 C*****                MOVEL'20      'TABKEY                          S01194
3271 C*****                EXSR TABCHN                                    S01194
3272 C*****                Z-ADDTNOT      ZNRDYS                          S01194
3273 C*****                EXSR ZTXDAY                                    S01195
3276 C***********RUND      COMP VDAYNO                 6666               S01194
3259 C*********************Z-ADDBJRDNB    ZDAYNO                    S01194E21923
3259 C           BJDNWD    SUB  1         ZDAYNO                          E21923
3265 C                     MOVELBJLCCY    ZCCY1                           S01195
3267 C                     MOVELBJSLCD    ZLOC1                           S01195
3265 C                     MOVELBUYCCY    ZCCY2                           S01195
3267 C                     MOVELBJSLCD    ZLOC2                           S01195
     C* ACCESS CURRENCY FILE FOR TELEX NOTICE DAYS                        S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM BUYCCY    @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C**********           PARM           SDCURR                          S01194
3272 C                     Z-ADDA6TXND    ZNRDYS                          S01194
3273 C                     EXSR ZF2C                                      S01195
3276 C           BJRDNB    COMP VDAYNO                 6666               S01194
3278 C   66      VDAYNO    COMP ZDYNBR                 6666
3280 C   66                Z-ADD1         PR1
3289 C                     ENDSR
3290 C********************************************************************
3291 C**   SUB-ROUTINE TO ASCERTAIN WHETHER UPDATE OF PRONO FILE REQUIRED
3292 C**
3293 C           SRPRON    BEGSR                           ** PRONO SUBR**
3294 C**   SET OFF RECORD IDENTIFYING INDICATOR FOR NOSTRO TABLE.
3295 C                     SETOF                     16
3296 C**   GET PRONO DETAIL RECORD FOR CCY.
3297 C                     MOVELOURS      NOSTNO  2
     C                     MOVELBUYCCY    NOSKEY  5
3306 C                     MOVE NOSTNO    NOSKEY
3307 C                     EXSR NOSCHN
3308 C**   RECORD NOT FOUND.
3309 C  N16                GOTO PRNEND
3310 C*
3311 C**   LOAD ARRAY OF WORKING DAYS FOR PRONO UPDATE
3312 C*
3313 C                     Z-ADD1         Y       10
3314 C           LOAD      TAG
3315 C                     MOVE PND,Y     PNE,Y
3316 C           Y         COMP 5                        77
3317 C   77                GOTO LOAD2
3318 C           Y         ADD  1         Y
3319 C                     GOTO LOAD
3320 C           LOAD2     TAG
3321 C**
3322 C**   CALCULATE 6TH. ELEMENT
3323 C**
3324 C                     MOVELBJSLCD    ZLOC                            S01195
3324 C                     Z-ADD0         ZNRDYS                          S01195
3324 C                     MOVELNOSKEY    ZCCY
3325 C*********************MOVE 'Y'       ZOPT                            S01195
3326 C           PNE,5     ADD  1         ZDAYNO
3327 C*********************EXSR ZDATE5                                    S01195
3327 C                     EXSR ZFWDT                                     S01195
3328 C                     Z-ADDZDYNBR    PNE,6
3329 C**
3330 C*    CHECK WHETHER EVENT DATE IS IN NOSTRO RANGE
3331 C                     Z-ADD1         X            74
     C           EVCHK     TAG                              ** EVCHK TAG *
3332 C*
3333 C**   MOVE RELEVANT DATE INTO WORK FIELD FOR RANGE CHECK.
3347 C*                                                                   052693
3347 C***********VDAYNO    COMP PNE,X                  74                 052693
3347 C           VDAYNO    COMP PNE,X                  7474               052693
3347 C*                                                                   052693
3348 C**   EVENT DATE BEFORE OR WITHIN RANGE.
3349 C   74      X         COMP 1                        30
3350 C***74N30***X         SUB  1         X                               052693
     C   74                Z-ADDPNE,X     STORDT  50                      S01154
     C*                                                                   042757
     C** Update the Projected Nostro balances for date(s)  later          042757
     C** than the Event Date.                                             042757
     C*                                                                   042757
     C***********          ADD  1         X                        042757 052693
3351 C***74******          GOTO AMTUP                                     052693
3352 C**   EVENT DATE LATER THAN RANGE DATE.
3353 C           X         COMP 5                    30
     C   74N30             GOTO AMTUP                                     052693
     C   74 30             SETOF                     74                   052693
3354 C                     SETOF                     77
3355 C   30                SETON                     6277
3356 C   30                SETOF                     30
3357 C   77                EXSR EXCPTN                     RELEASE PRONO
3358 C   77                GOTO PRNEND
3359 C*
3360 C           X         ADD  1         X          30
3361 C                     GOTO EVCHK
3362 C*    UPDATE RELEVANT AMOUNT TOTALS - RECEIVE.
3363 C           AMTUP     TAG                             ** AMTUP TAG **
3364 C  N73                GOTO PTOTUP
3367 C   31      PNB,X     ADD  BAMT      PNB,X
3370 C   33      PNB,X     SUB  BAMT      PNB,X
3373 C                     GOTO XCHK
3374 C*
3375 C*    UPDATE RELEVANT AMOUNT TOTALS - PAYMENT.
3376 C           PTOTUP    TAG                             **PTOTUP TAG **
3379 C   31      PNB,X     SUB  BAMT      PNB,X
3382 C   33      PNB,X     ADD  BAMT      PNB,X
3385 C**   CHECK WHETHER ALL FIVE ARRAY DATES READ.
3386 C           XCHK      TAG                             ** XCHK TAG  **
3387 C           X         COMP 5                        30
3388 C  N30      X         ADD  1         X
3389 C  N30                GOTO AMTUP
3390 C**
3391 C           PRNEND    ENDSR
      /EJECT                                                              S01154
     C/COPY WNCPYSRC,DL0035C013
     C******************************************************************* S01154
     C**   SUB-ROUTINE TO RETRIEVE AND STORE THE ACCOUNT NUMBERS FOR      S01154
     C**    FOR THE NOSTRO SETTLEMENT CODES - USED FOR THE UPDATE OF      S01154
     C**    RSACMTPD                                                      S01154
     C**                                                                  S01154
     C           RSACC     BEGSR                           * RSACC  SUBR *S01154
     C**                                                                  S01154
     C*****                MOVEL'70      'TABKEY                          S01154
     C*****                MOVE WRK2      WRK5                            S01154
     C*****                MOVE WRK5      TABKEY                          S01154
     C*****                EXSR TABCHN                                    S01154
3034 C**   ACCESS NOSTRO DETAILS VIA ACCESS PROGRAM                       S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANKS   @KEYA   6                       S01194
     C                     PARM           @KEYB   3                       S01194
     C**********           PARM *BLANKS   @KEYC   4                                    S01194 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01194
     C                     PARM           @KEYE   2                       S01194
     C                     PARM *BLANKS   @KEYF                           S01194
     C                     PARM *BLANKS   @KEYG                           S01194
     C                     PARM *BLANKS   @KEYH                           S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C***********          PARM           SDNOST                          S01194
     C**                                                                  S01154
     C           *IN29     IFEQ '0'                                       S01154
     C** if no error then  set up fields in data structure @ACCNO         S01117
     C                     MOVE A7CUST    @CNUM                     S01117S01194
     C                     MOVE A7CYCD    @CCY                      S01117S01194
     C                     MOVE A7ACCD    @ACOD                     S01117S01194
     C                     MOVE A7ACSN    @ACSQ                     S01117S01194
     C                     MOVE A7BRCD    @BRCA                     S01117S01194
     C           *IN73     IFEQ '1'                                       S01154
     C*****                MOVE ACCNO     RACCNO                    S01154S01117
     C**********           MOVE @ACCNO    RACCNO 18                                    S01117 CGL029
     C                     MOVE @ACCNO    RACCNO 24                                           CGL029
     C                     ELSE                                           S01154
     C*****                MOVE ACCNO     PACCNO                    S01154S01117
     C**********           MOVE @ACCNO    PACCNO 18                                    S01117 CGL029
     C                     MOVE @ACCNO    PACCNO 24                                           CGL029
     C                     END                                            S01154
     C*                                                                   S01154
     C                     ELSE
     C*****                                                FOUND SO S01154S01117
     C*****                Z-ADD0         CNUM             THE CATCHS01154S01117
     C*****                MOVELWRK5      CCY              NOSTRO FOS01154S01117
     C*****                Z-ADD0         ACOD             THE CURRES01154S01117
     C*****                Z-ADD0         ACSQ                      S01154S01117
     C*
     C** nostro not found so use the catchall nostro for the currency     S01117
     C**********           Z-ADD0         @CNUM                                        S01117 CSD027
     C                     MOVE *BLANKS   @CNUM                                               CSD027
     C                     MOVEL@KEYE     @CCY                            S01117
     C                     Z-ADD0         @ACOD                           S01117
     C                     Z-ADD0         @ACSQ                           S01117
     C                     MOVE *BLANKS   @BRCA                           S01117
     C           *IN73     IFEQ '1'                                       S01154
     C*****                MOVE ACCNO     RACCNO                    S01154S01117
     C                     MOVE @ACCNO    RACCNO                          S01117
     C                     ELSE                                           S01154
     C*****                MOVE ACCNO     PACCNO                    S01154S01117
     C                     MOVE @ACCNO    PACCNO                          S01117
     C                     END                                            S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C                     ENDSR                                          S01154
     C**                                                                  S01154
      /EJECT                                                              S01154
     C******************************************************************* S01154
     C**   SUB-ROUTINE TO UPDATE PROJECTED ACCOUNTS MOVEMENTS FILE        S01154
     C**    RSACMTPD - BUT ONLY WHEN PRONO IS UPDATED                     S01154
     C**                                                                  S01154
     C           RSUPDT    BEGSR                           * RSUPDT SUBR *S01154
     C**                                                                  S01154
     C           *IN30     IFEQ '1'                        PRONO TO BE    S01154
     C**                                                   UPDATED        S01154
     C                     Z-ADDSTORDT    PTDT                            S01154
     C                     Z-ADDVDAYNO    VUDT                            S01154
     C                     MOVE 'NX'      TRYP                            S01154
     C                     MOVE DEALNO    TNMR                            S01154
     C                     Z-ADD0         CQNR                            S01154
     C                     Z-ADDBAMT      MVAM                            S01154
     C**                                                                  S01154
     C           *IN73     IFEQ '1'                        UPDATE RECV    S01154
     C                     MOVE RACCNO    RSACCN           SIDE           S01154
     C**                                                                  S01154
     C           *IN31     IFEQ '1'                                       S01154
     C                     Z-ADD0         DORC                            S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C           *IN33     IFEQ '1'                                       S01154
     C                     Z-ADD1         DORC                            S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C                     ELSE                            UPDATE PAY     S01154
     C**                                                   SIDE           S01154
     C                     MOVE PACCNO    RSACCN                          S01154
     C**                                                                  S01154
     C           *IN31     IFEQ '1'                                       S01154
     C                     Z-ADD1         DORC                            S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C           *IN33     IFEQ '1'                                       S01154
     C                     Z-ADD0         DORC                            S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C                     END                                            S01154
      *                                                                   CRE009
      ** If CRE009 is ON and the account is RE, set the value of the      CRE009
      ** posting date the same as the value date, except if the value     CRE009
      ** date is not less than the run date.                              CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
      *                                                                   CRE009
     C                     MOVELRSACCN    ACCKEY                          CRE009
     C           ACCKEY    CHAINACCNT                74                   CRE009
     C           *IN74     IFEQ *OFF                                      CRE009
     C           ATYP      ANDEQ'R'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C                     ENDIF                                          CRE009
      *                                                                                       CAP205
      ** Set up Module and Movement Type fields                                               CAP205
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVE 'DL'      CMOD                                                CAP205
     C           VUDT      IFEQ BJRDNB                                                        CAP205
     C                     MOVE 'S'       MTYP                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
     C**                                                                  S01154
     C                     WRITERSACMTPO                                  S01154
     C/COPY WNCPYSRC,DL0035C007
     C**                                                                  S01154
     C                     END                                            S01154
     C**                                                                  S01154
     C**                                                                  S01154
     C                     ENDSR                                          S01154
      /EJECT                                                              S01154
3533 C********************************************************************
3534 C**   SUB-ROUTINE TO UPDATE MEMO DETAIL RECORD.
3535 C**
3536 C           MEMSR     BEGSR                           ** MEMSR SUBR *
3537 C**   SET UP ACCOUNT NUMBER FOR SHADOW POSTING.
     C**
     C** FOR RETAIL A/C NOSTROS, USE SAVED KEYS
     C   73                MOVE NEWKY1    ACCKEY
     C  N73                MOVE NEWKY2    ACCKEY
     C  N73 64             MOVE OLDKY1    ACCKEY
     C   73 64             MOVE OLDKY2    ACCKEY
3579 C                     EXSR ACCHN
     C*                                                                   CCB002
     C** UPDATE PROCESSING FOR ONLINE UPDATES                             CCB002
     C** BEFORE CALLING ACCESS OBJ. AOMEMSU0                              CCB002
     C*                                                                   CCB002
     C           *IN73     IFEQ '1'                                       CCB002
     C*                                                                   CCB002
     C           *IN31     IFEQ '1'                                       CCB002
     C                     Z-ADDBAMT      #PAMT  150                      CCB002
     C                     ELSE                                           CCB002
     C                     Z-SUBBAMT      #PAMT                           CCB002
     C                     ENDIF                                          CCB002
     C*                                                                   CCB002
     C                     ELSE                                           CCB002
     C           *IN31     IFEQ '1'                                       CCB002
     C                     Z-SUBBAMT      #PAMT                           CCB002
     C                     ELSE                                           CCB002
     C                     Z-ADDBAMT      #PAMT                           CCB002
     C                     ENDIF                                          CCB002
     C                     ENDIF                                          CCB002
     C*                                                                   CCB002
3580 C**   GET MEMO FILE POSTING RECORD
     C**                                                                  CCB002
3581 C                     EXSR MEMCHN
3582 C*****RECORD NOT FOUND.                                              CCB002
3583 C**N10****************GOTO MEMEND                                    CCB002
3584 C*****RECEIVE INSTRUCTIONS.                                          CCB002
3585 C**N73****************GOTO ACPAY                                     CCB002
3586 C*****INSERT**********                                               CCB002
3588 C***31******BAMT******ADD  LDBL      LDBLX  150                      CCB002
3590 C***31******BAMT******ADD  CLBL      CLBLX  150                      CCB002
3591 C*****REVERSAL********                                               CCB002
3593 C***33******LDBL******SUB  BAMT      LDBLX                           CCB002
3595 C***33******CLBL******SUB  BAMT      CLBLX                           CCB002
3596 C*********************GOTO MEMEND                                    CCB002
3597 C*****PAYMENT INSTRUCTIONS.                                          CCB002
3598 C*****INSERT**********                                               CCB002
3599 C***********ACPAY*****TAG                             **ACPAY TAG  **CCB002
3601 C***31******LDBL******SUB  BAMT      LDBLX                           CCB002
3603 C***31******CLBL******SUB  BAMT      CLBLX                           CCB002
3604 C*****REVERSAL********                                               CCB002
3606 C***33******LDBL******ADD  BAMT      LDBLX                           CCB002
3608 C***33******CLBL******ADD  BAMT      CLBLX                           CCB002
3609 C**
3610 C           MEMEND    ENDSR
3611 C********************************************************************
3612 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
3613 C*   IND '99' IS SET BY AN OVERFLOW ERROR
3614 C*
3615 CSR         GLZADD    BEGSR                           *** GLZADD ****
3616 C*
3617 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
3618 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
3619 C*
3620 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
3621 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
3622 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
3623 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
3624 C*
3625 CSR                   EXSR GLZSUM
3626 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
3627 C*
3628 C********************************************************************
3629 C* SUBROUTINE TO SUBTRACT AN AMOUNT (ZZAMT) FROM THE TOTAL
3630 C*                                                   (ZZTOTI,ZZTOTD)
3631 C*  IND '99' IS SET BY AN OVERFLOW ERROR
3632 CSR         GLZSUB    BEGSR                           *** GLZSUB ****
3633 C* PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
3634 CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
3635 CSR                   EXSR GLZADD                       AND 'ADD'
3636 CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
3637 CSR                   ENDSR
3638 C********************************************************************
3639 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
3640 C*                        GLZADD, GLZSUB, GLZCMP.
3641 C*          PARAMETERS PASSED -
3642 C*                     I/P ZZAMTI ZZAMTD
3643 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
3644 C*
3645 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
3646 C*
3647 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
3648 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
3649 CSR                   SETOF                     919293
3650 CSR                   SETOF                     949599
3651 C*
3652 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
3653 CSR         ZZAMTI    COMP 0                      9293
3654 CSR 93      ZZAMTD    COMP 0                      9293
3655 CSR 93                GOTO ZZSEND                     ZERO BYPASS
3656 C*
3657 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
3658 CSR         ZZTOTI    COMP 0                      9193
3659 CSR 93      ZZTOTD    COMP 0                      9193
3660 C*
3661 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
3662 CSR 93                Z-ADDZZAMTI    ZZTOTI
3663 CSR 93                Z-ADDZZAMTD    ZZTOTD
3664 CSR 93                GOTO ZZSEND                     ZERO BYPASS
3665 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
3666 CSR 91N92
3667 CORN91 92             GOTO ZZOFPS
3668 C*
3669 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
3670 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
3671 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
3672 C*
3673 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
3674 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
3675 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
3676 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
3677 C*
3678 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
3679 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
3680 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
3681 CSRN99                Z-ADDZZWK2     ZZTOTD
3682 CSRN99                Z-ADDZZWK3     ZZTOTI
3683 C*
3684 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
3685 CSR 99                Z-ADD0         ZZAMT  153
3686 CSR                   GOTO ZZSEND
3687 C*
3688 C* THE 'SIGNS' ARE DIFFERENT
3689 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
3690 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
3691 C*
3692 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
3693 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
3694 C*
3695 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
3696 C*
3697 CSR 91                Z-SUBZZTOTI    ZZTOTI
3698 CSR 91                Z-SUBZZTOTD    ZZTOTD
3699 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
3700 C*
3701 CSR         ZZTOTI    COMP ZZAMTI               93  95
3702 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
3703 C*
3704 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
3705 CSR 95                Z-ADD0         ZZTOTI
3706 CSR 95                Z-ADD0         ZZTOTD
3707 CSR 95                GOTO ZZSEND
3708 C*
3709 C* IF ZZTOT GT. ZZAMT.
3710 CSR 93      ZZAMTD    COMP ZZTOTD               94
3711 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
3712 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
3713 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
3714 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
3715 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
3716 C*
3717 C*
3718 C* IF ZZAMT GT. ZZTOT.
3719 CSRN93      ZZTOTD    COMP ZZAMTD               94
3720 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
3721 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
3722 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
3723 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
3724 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
3725 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
3726 C*
3727 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
3728 CSR                   SETOF                     94
3729 CSR 93 91
3730 CORN93 92             SETON                     94
3731 CSR 94                Z-SUBZZTOTI    ZZTOTI
3732 CSR 94                Z-SUBZZTOTD    ZZTOTD
3733 C**
3734 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
3735 CSR 92                Z-SUBZZAMTI    ZZAMTI
3736 CSR 92                Z-SUBZZAMTD    ZZAMTD
3737 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
3738 C**
3739 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
3740 CSR                   SETOF                     96
3741 CSR         ZZTOTD    COMP 0                        91
3742 CSR 91      ZZTOTI    COMP 0                      96
3743 CSR 96                MOVE '.000-'   ZZNEGD  5
3744 CSR                   ENDSR                             ** ENDSR **
3745 C********************************************************************
3746 C**
3747 C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
3748 C**              CONVERT TO A NUMBER OF DAYS.
3749 C**
3750 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
3751 C**
3752 C           ZDATE1    BEGSR                           *** ZDATE1 ***
3753 C**
3754 C**   CLEAR DAY NUMBER.
3755 C                     Z-ADD0         ZDAYNO  50
3756 C**
3757 C**   CALCULATION TO DEFINE INPUT DATE FIELD.
3758 C                     Z-ADDZDATE     ZDATE   60
3759 C**
3760 C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
3761 C                     MOVE ZDATE     ZYEAR   20
3762 C  N98                MOVELZDATE     ZDAY    20
3763 C   98                MOVELZDATE     ZMTH    20
3764 C                     MOVE ZDATE     ZWRK4   40
3765 C  N98                MOVELZWRK4     ZMTH
3766 C   98                MOVELZWRK4     ZDAY
3767 C**
3768 C**   ENSURE MONTH IS VALID.
3769 C           ZMTH      COMP 0                      9999
3770 C  N99      ZMTH      COMP 12                   99
3771 C   99                GOTO ZDEND1                     BYPASS IF ERROR
3772 C**
3773 C**   CHECK FOR 30 DAY MONTHS.
3774 C           ZMTH      COMP 4                        90IF 90 ON, 30
3775 C  N90      ZMTH      COMP 6                        90DAY MONTH.
3776 C  N90      ZMTH      COMP 9                        90
3777 C  N90      ZMTH      COMP 11                       90
3778 C**
3779 C**   ENSURE DAY IS VALID.
3780 C           ZDAY      COMP 0                      9999
3781 C   90N99   ZDAY      COMP 30                   99
3782 C  N90N99   ZDAY      COMP 31                   99
3783 C   99                GOTO ZDEND1                     BYPASS IF ERROR
3784 C**
3785 C**   CHECK FOR LEAP YEAR AND FEBRUARY.
3786 C           ZYEAR     ADD  28        ZYEAR
3787 C           ZYEAR     DIV  4         ZLYR    20
3788 C                     MVR            ZLY     10     91LEAP YR, 91 ON
3789 C           ZMTH      COMP 2                    93  92FEB., 92 ON
3790 C**                                                   PAST FEB, 93 ON
3791 C**   IF FEBUARY FURTHER VALIDATE DAY.
3792 C  N91 92   ZDAY      COMP 28                   99
3793 C   91 92   ZDAY      COMP 29                   99
3794 C   99                GOTO ZDEND1                     BYPASS IF ERROR
3795 C**
3796 C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
3797 C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
3798 C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
3799 C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
3800 C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
3801 C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
3802 C**
3803 C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
3804 C**
3805 C**
3806 C********************************************************************
3807 C**
3808 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
3809 C**
3810 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
3811 C**
3812 C           ZDATE2    BEGSR                           *** ZDATE2 ***
3813 C**
3814 C**   CLEAR DATE FIELDS.
3815 C                     Z-ADD0         ZDATE   60
3816 C                     MOVEL'       ' ZADATE  7
3817 C**
3818 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
3819 C                     Z-ADDZDAYNO    ZDAYNO  50
3820 C**
3821 C**   DETERMINE YEAR NUMBER.
3822 C**
3823 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
3824 C           ZDAYNO    SUB  1         ZDAYN1  50   99
3825 C   99                GOTO ZDEND2
3826 C**
3827 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
3828 C           ZDAYN1    DIV  1461      ZLYR    20
3829 C                     MVR            ZDAYN1           SAVE REMAINING
3830 C**                                                   DAYS
3831 C**   CALCULATE NUMBER OF REMAINING YEARS.
3832 C                     Z-ADD1         ZWRK2   20
3833 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
3834 C           ZDAYN1    COMP ZYDY,ZWRK2             90
3835 C  N90      ZWRK2     ADD  1         ZWRK2
3836 C  N90                GOTO ZDTAG1
3837 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
3838 C**
3839 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
3840 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
3841 C**
3842 C**   CALCULATE ACTUAL YEAR NUMBER.
3843 C           ZLYR      MULT 4         ZWRK3   30
3844 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
3845 C                     Z-ADDZWRK3     ZYEAR   20
3846 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
3847 C**
3848 C**   DETERMINE MONTH NUMBER.
3849 C**
3850 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
3851 C                     SETOF                     9293
3852 C   91      ZDAYN1    COMP 59                     9293
3853 C   91N92   ZDAYN1    SUB  1         ZDAYN1
3854 C**
3855 C**   CALCULATE MONTH NUMBER.
3856 C                     Z-ADD2         ZWRK2
3857 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
3858 C           ZDAYN1    COMP ZMDY,ZWRK2             94
3859 C  N94      ZWRK2     ADD  1         ZWRK2
3860 C  N94                GOTO ZDTAG2
3861 C           ZWRK2     SUB  1         ZWRK2
3862 C**
3863 C                     Z-ADDZWRK2     ZMTH    20       MONTH
3864 C**
3865 C**   DETERMINE DAY OF MONTH.
3866 C**
3867 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
3868 C           ZDAYN1    ADD  1         ZDAYN1
3869 C**
3870 C**   CALCULATE DAY OF MONTH.
3871 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
3872 C**
3873 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
3874 C   93      ZDAY      ADD  1         ZDAY
3875 C**
3876 C**   FORMAT DATE, DDMMYY OR MMDDYY.
3877 C  N98                MOVELZDAY      ZWRK4   40
3878 C   98                MOVE ZDAY      ZWRK4
3879 C  N98                MOVE ZMTH      ZWRK4
3880 C   98                MOVELZMTH      ZWRK4
3881 C                     MOVELZWRK4     ZDATE
3882 C                     MOVE ZYEAR     ZDATE
3883 C**
3884 C**   FORMAT ALPHA DATE, DDMMMYY.
3885 C           ZDAY      COMP 10                     95
3886 C                     MOVELZDAY      ZWRK5   5
3887 C   95                MOVEL' '       ZWRK5
3888 C                     MOVE ZMNM,ZMTH ZWRK5
3889 C                     MOVELZWRK5     ZADATE
3890 C                     MOVE ZYEAR     ZADATE
3891 C**
3892 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZF2C                                                   S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
3903 C********************************************************************
3904 C*****                                                               S01195
3905 C*****ZTXDAY SR. TO CALCULATE ANY NUMBER OF DAYS FORWARD THAT ARE    S01195
3906 C*****           WORKING DAYS IN BOTH THE LOCAL CURRENCY AND ANY     S01195
3907 C*****           SPECIFIED CURRENCY.                                 S01195
3908 C*****                                                               S01195
3909 C*****    THIS SR. CAN BE USED WHEN THE INPUT CYCLE IS RUNNING AS    S01195
3910 C*****    HOLIDAY RECORDS ARE ACCESSED BY CHAIN. THEREFORE NEWLY     S01195
3911 C*****    ADDED RECORDS IN THE OVERFLOW AREA CAN ALSO BE ACCESSED.   S01195
3912 C*****                                                               S01195
3913 C*****      ZTXDAY    BEGSR                           *** ZTXDAY *** S01195
3914 C*****                                                               S01195
3915 C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           S01195
3916 C*****                Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  S01195
3917 C*****                MOVE ZCCY      ZCCY    3        DATE CURRENCY  S01195
3918 C*****                Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING S01195
3919 C*****LOCY DEFINED ON TABLE,TB-11;  AND SHOULD ALREADY HAVE          S01195
3920 C*****BEEN INPUT.                                                    S01195
3921 C*****                                                DAYS FORWARD   S01195
3922 C*****CLEAR COUNT OF NBR OF DAYS ADDED, & DEFINE ZDYNBR.             S01195
3923 C*****                Z-ADD0         ZDCNT   20                      S01195
3924 C*****                Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C***** SEE MANUAL ON SYSTEM SUBROUTINES                              S01195
     C***** IF ZNRDYS IS INPUT AS ZERO IT WILL NOW BE TREATED AS ZERO.    S01195
     C***** FIRST CHECK FOR ZERO NOTICE DAYS                              S01195
     C*****      ZNRDYS    COMP 0                        95               S01195
     C***95                GOTO ZTXEND                                    S01195
3925 C*****                                                               S01195
3926 C*****LOOP TO INCREMENT DAY NUMBER AND CHECK FOR HOLIDAY.            S01195
3927 C*****      ZTLOP1    TAG                             ** ZTLOP1 TAG *S01195
3928 C*****                                                               S01195
3929 C*****                SETOF                     9596                 S01195
3930 C*****      ZDYNBR    ADD  1         ZDYNBR                          S01195
3931 C*****                                                               S01195
3932 C*****SET KEY FOR FIRST HOLIDAY RECORD.                              S01195
3933 C*****                MOVEL'22    '  ZDHKEY 12                       S01195
3934 C*****                MOVELZDYNBR    ZWRK6   6                       S01195
3935 C*****                MOVE '1'       ZWRK6                           S01195
3936 C*****                MOVE ZWRK6     ZDHKEY                          S01195
3937 C*****                                                               S01195
3938 C*****CHAIN FOR HOLIDAY RECORD, RECORD 1 OR 2                        S01195
3939 C*****      ZTHCHN    TAG                             ** ZTHCHN TAG *S01195
3940 C*****                                                               S01195
3941 C*****      ZDHKEY    CHAINTABLE                90    ON NOT THERE   S01195
3942 C**N90      RECI      COMP 'D'                  9090  DELETED        S01195
3943 C*****                                                               S01195
3944 C*****NO RECORD 1 FOUND, IS NOT A HOLIDAY                            S01195
3945 C***90N95             GOTO ZTOAGN                                    S01195
3946 C*****                                                               S01195
3947 C*****NO RECORD 2 FOUND                                              S01195
3948 C***90 95 96          GOTO ZTLOP1                     EXC. NOT FOUND S01195
3949 C***90 95N96          GOTO ZTOAGN                     INC. NOT FOUND S01195
3950 C*****                                                               S01195
3951 C*****DETERMINE TYPE FOUND, INCLUDE OR EXCLUDE                       S01195
3952 C*****      INEX      COMP 'E'                  92  91               S01195
3953 C*****                                                               S01195
3954 C*****CHECK IF DAY IS HOLIDAY FOR CURRENCY.                          S01195
3955 C*****      ZCCY      LOKUPHCCY                     93               S01195
3956 C**N93      LOCY      LOKUPHCCY                     93               S01195
3957 C***91 93             GOTO ZTOAGN                     EXCLUDE FOUND  S01195
3958 C***92 93             GOTO ZTLOP1                     INCLUDE FOUND  S01195
3959 C*****                                                               S01195
3960 C*****IF EXCLUDE OR INCLUDE NOT FOUND CHECK                          S01195
3961 C*****FOR SECOND HOLIDAY RECORD, IF REQUIRED.                        S01195
3962 C*****      '   '     LOKUPHCCY                     94ON IF NO RCD.2 S01195
3963 C*****                MOVE ZDHKEY    ZWRK1   1                       S01195
3964 C*****      ZWRK1     COMP '1'                      95               S01195
3965 C***91 95             SETON                     96                   S01195
3966 C***95N94             MOVE '2'       ZDHKEY                          S01195
3967 C***95N94             GOTO ZTHCHN                     GET SECOND REC S01195
3968 C*****                                                               S01195
3969 C***91                GOTO ZTLOP1                     EXC. NOT FOUND S01195
3970 C***92                GOTO ZTOAGN                     INC. NOT FOUND S01195
3971 C*****                                                               S01195
3972 C*****INCREMENT COUNT AND CHECK IF REQUIRED NUMBER OF DAYS           S01195
3973 C*****HAVE BEEN ADDED. IF NOT, GO THROUGH LOOP1 AGAIN.               S01195
3974 C*****      ZTOAGN    TAG                             ** ZTOAGN TAG *S01195
3975 C*****                                                               S01195
3976 C*****      ZDCNT     ADD  1         ZDCNT                           S01195
3977 C*****      ZDCNT     COMP ZNRDYS                 97                 S01195
3978 C***97                GOTO ZTLOP1                                    S01195
3979 C*****                                                               S01195
3980 C*****      ZTXEND    ENDSR                            *** ZTXEND ***S01195
3981 C*****                                                               S01195
3982 C*****                                                               S01195
3983 C********************************************************************S01195
3984 C********************************************************************S01195
3985 C*****                                                               S01195
3986 C*****ZDATE5 SR. TO DETERMINE IF A DAY NUMBER DATE IS A HOLIDAY      S01195
3987 C*****           IN GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY         S01195
3988 C*****           AND IF REQUIRED, DETERMINE NEXT WORKING DAY.        S01195
3989 C*****                                                               S01195
3990 C*****      ZDATE5    BEGSR                           *** ZDATE5 *** S01195
3991 C*****                                                               S01195
3992 C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           S01195
3993 C*****                Z-ADDZDAYNO    ZDAYNO  50                      S01195
3994 C*****                MOVE ZCCY      ZCCY    3                       S01195
3995 C*****                MOVE ZOPT      ZOPT    1                       S01195
3996 C*****                                                               S01195
3997 C*****CALCULATIONS TO DEFINE/CLEAR WORKFIELDS.                       S01195
3998 C*****                MOVE '   '     ZHC                             S01195
3999 C*****                                                               S01195
4000 C*****RESET INDICATOR.                                               S01195
4001 C*****                SETOF                     99                   S01195
4002 C*****                                                               S01195
4003 C*****CALCULATION TO DEFINE/SET OUTPUT FIELD.                        S01195
4004 C*****                Z-ADDZDAYNO    ZDYNBR  50                      S01195
4005 C*****                                                               S01195
4006 C*****DETERMINE IF HOLIDAY                                           S01195
4007 C*****      ZDHOL     TAG                             ** ZDHOL TAG **S01195
4008 C*****                SETOF                     91                   S01195
4009 C*****                                                               S01195
4010 C*****SET KEY FOR FIRST HOLIDAY RECORD.                              S01195
4011 C*****                MOVEL'22      'ZTABKY 12                       S01195
4012 C*****                MOVELZDYNBR    ZWRK6   6                       S01195
4013 C*****                MOVE '1'       ZWRK6                           S01195
4014 C*****                MOVE ZWRK6     ZTABKY                          S01195
4015 C*****                                                               S01195
4016 C*****CHAIN FOR HOLIDAY RECORD, RECORD 1 OR 2.                       S01195
4017 C*****      ZDHCH5    TAG                             ** ZDHCH5 TAG *S01195
4018 C*****      ZTABKY    CHAINTABLE                90    ON NOT THERE   S01195
4019 C**N90      RECI      COMP 'D'                  9090  DELETED        S01195
4020 C*****                                                               S01195
4021 C*****STORE CURRENCIES IF RECORD FOUND.                              S01195
4022 C**N90N91             MOVEAHCCY      ZHC,1                           S01195
4023 C***91N90             MOVEAHCCY      ZHC,26                          S01195
4024 C*****                                                               S01195
4025 C*****GET SECOND RECORD, IF NOT ALREADY DONE.                        S01195
4026 C*****                MOVE ZTABKY    ZWRK1N  10                      S01195
4027 C*****      ZWRK1N    COMP 1                        91               S01195
4028 C*****                MOVE '2'       ZTABKY                          S01195
4029 C***91N90             GOTO ZDHCH5                                    S01195
4030 C*****                                                               S01195
4031 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
4032 C***90 91             GOTO ZDEND5                                    S01195
4033 C*****                                                               S01195
4034 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
4035 C*****      INEX      COMP 'E'                      92               S01195
4036 C*****      INEX      COMP 'I'                      93               S01195
4037 C*****                                                               S01195
4038 C*****CHECK IF CURRENCY ON HOLIDAY.                                  S01195
4039 C*****      ZCCY      LOKUPZHC                      94               S01195
4040 C*****                                                               S01195
4041 C*****BYPASS TO END IF NOT HOLIDAY FOR CURRENCY.                     S01195
4042 C***92 94                                                            S01195
4043 C*R*93N94             GOTO ZDEND5                                    S01195
4044 C*****                                                               S01195
4045 C*****SET INDICATOR FOR HOLIDAY FOR DAY NUMBER.                      S01195
4046 C*****                SETON                     99                   S01195
4047 C*****                                                               S01195
4048 C*****                                                               S01195
4049 C*****CHECK IF NEXT WORKING DAY REQUIRED.                            S01195
4050 C*****      ZOPT      COMP 'Y'                      95               S01195
4051 C***95      ZDYNBR    ADD  1         ZDYNBR                          S01195
4052 C***95                GOTO ZDHOL                                     S01195
4053 C*****                                                               S01195
4054 C*****                                                               S01195
4055 C*****      ZDEND5    ENDSR                           * ZDEND5 ENDSR*S01195
4056 C*****                                                               S01195
4057 C********************************************************************
4058 C*****                                                               S01194
4059 C*****ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
4060 C*****                                                               S01194
4061 C*****      ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
4062 C*****                                                               S01194
4063 C*****SET UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
4064 C*****                MOVEL'01      'TABKEY 12                       S01194
4065 C*****                MOVE '  10'    TABKEY                          S01194
4066 C*****                                                               S01194
4067 C*****      TABKEY    CHAINTABLE                99    ON NOT THERE   S01194
4068 C**N99      RECI      COMP 'D'                  9999  ON, IS DELETED S01194
4069 C*****                                                               S01194
4070 C*****CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
4071 C*****      DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
4072 C*****                                                               S01194
4073 C*****                ENDSR                                          S01194
4074 C********************************************************************S01194
     C**   FILE EXCEPTION / ERROR HANDLING SUBROUTINE
     C           INFSR     BEGSR
     C**   CHECK ERROR TYPE
     C           STATUS    IFEQ 01021
     C**   CHAIN FILE TO GET CURRENT DETAILS
     C           DLKEY     CHAINDEALS                22
     C**
     C           *IN22     IFEQ '0'
     C**   ROLLBACK UPDATES ALREADY DONE
     C                     ROLBK
     C**   SET ON 'RECORD UPDATED BY ANOTHER WORKSTATION' INDICATOR
     C                     SETON                     82
     C**   RESET OTHER INDICATORS
     C                     SETOF                     306061
     C                     SETOF                     626364
     C                     SETOF                     687881
     C                     SETOF                     858788
     C                     SETOF                     898377
     C**
     C                     MOVE '*DETC '  EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     DUMP                                                               164405
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     DUMP                                                               164405
     C                     END
     C**
     C                     ENDSREXTTAG
0671 C********************************************************************
4075 C/EJECT
      *---- S01241 -------------------------------------------------------S01241
      * #WIND subroutine - call window manager program                    S01241
      *                                                                   S01241
     C           #WIND     BEGSR                                          S01241
      *                                                                   S01241
     C***********BGL5ST    IFEQ 'Y'                                 S01241S01251
     C           BGWDPR    IFEQ 'Y'                                       S01251
      *    /copy to move data into the data structure fields passed       S01241
      *     as a parameter to the window controller                       S01241
      /COPY WNCPYSRC,DL0035MOV1                                           S01241
      *                                                                   S01241
     C                     CALL 'WN0010'                                  S01241
     C                     PARM 'DL0035'  #PGM   10                       S01241
     C                     PARM           FKEY    2                       S01241
     C                     PARM           ACTION                          S01241
     C                     PARM           DATA                            S01241
     C                     PARM *BLANKS   #RTRN   7                       S01241
     C                     PARM           SPARE 256                       S01252
     C                     END                                            S01241
      *                                                                   S01241
     C                     ENDSR                                          S01241
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0035CCP2                                           S01408
     C*                                                                   S01408
      *---- S01241 -------------------------------------------------------S01241
     C/EJECT
4076 O**   SCREEN OUTPUT
4077 O**
4078 ODL0035FMD        38N86
4079 O                                   K8 'DL0035F1'
     O*****                    *IN64      1                               S01117
     O*****                    *IN40      2                               S01117
     O*****                    *IN44      3                               S01117
     O*****                    *IN79      4                               S01117
     O*****                    *IN46      5                               S01117
     O*****                    *IN51      6                               S01117
     O*****                    *IN53      7                               S01117
     O*****                    *IN54      8                               S01117
     O*********                *IN65      9                               E13149
     O*********                *IN34     10                               E13149
     O*********                *IN33     11                               E13149
     O*********                *IN78     12                               E13149
     O*********                *IN67     13                               E13149
     O*********                *IN66     14                               E13149
     O*********                *IN68     15                               E13149
     O*****                    *IN66      9                         E13149S01117
     O*****                    *IN78     10                         E13149S01117
     O*****                    *IN68     11                         E13149S01117
     O*****                    *IN65     12                         E13149S01117
     O*****                    *IN34     13                         E13149S01117
     O*****                    *IN33     14                         E13149S01117
     O*****                    *IN67     15                         E13149S01117
     O*****                    *IN80     16                               S01117
     O*****                    *IN81     17                               S01117
     O*****                    *IN23     18                               S01117
     O*****                    *IN41     19                               S01117
     O*****                    *IN42     20                               S01117
4080 O*****                    SRNID     22                               S01117
4081 O*****                    MTIME     30 '  .  .  '                    S01117
4082 O*****                    WSID      33                               S01117
4083 O*****                    DEALNO    39                               S01117
4084 O*****                    ACTION    40                               S01117
4086 O*****                  39SUBTPE    42                               S01117
     O*****                  39BRCODE    45                               S01117
4093 O*****                  39VALDAT    51                               S01117
4095 O*****                  39BUYCCY    54                               S01117
4096 O*****                  39BUYAMT    68                               S01117
4103 O*********             39RSETT     70                                E13149
4105 O*********              39ORECDR    72                               E13149
4104 O*********              39PSETT     74                               E13149
4106 O*********              39OPAYCR    76                               E13149
4104 O*****                  39PSETT     70                         E13149S01117
4106 O*****                  39OPAYCR    72                         E13149S01117
4103 O*****                  39RSETT     74                         E13149S01117
4105 O*****                  39ORECDR    76                         E13149S01117
4112 O*****                  11DLST      42                               S01117
4114 O*****                  11BRCD      45                               S01117
4122 O*****                  11VDATSF    51                               S01117
4124 O*****                  11PUCY      54                               S01117
4125 O*****               11 25PUAM      68 '          0 . '              S01117
4126 O*****               11 26PUAM      68 '         0 .  '              S01117
4127 O*****               11 27PUAM      68 '        0 .   '              S01117
4128 O*****               11 24PUAM  Z   68                               S01117
4141 O*********              11PCST      70                               E13149
4143 O*********              11OPCA2     72                               E13149
4142 O*********              11SCST      74                               E13149
4144 O*********              11OSCA2     76                               E13149
4142 O*****                  11SCST      70                         E13149S01117
4144 O*****                  11OSCA2     72                         E13149S01117
4141 O*****                  11PCST      74                         E13149S01117
4143 O*****                  11OPCA2     76                         E13149S01117
4149 O*****                    ERCD     228                               S01117
4150 O*****                    DEALNO   234                               S01117
4151 O*****                    ACTION   235                               S01117
4080 O                         SRNID      2                               S01117
4081 O                         MTIME     10 '  .  .  '                    S01117
4082 O                         WSID      13                               S01117
4083 O                         DEALNO    19                               S01117
4084 O                         ACTION    20                               S01117
4086 O                       39SUBTPE    22                               S01117
     O                       39BRCODE    25                               S01117
4093 O                       39VALDAT    31                               S01117
4095 O                       39BUYCCY    34                               S01117
4096 O                       39BUYAMT    48                               S01117
     O                       39PRFCNT    52                               S01117
     O                       39ORBRCH    55                               S01117
     O                       39BKCODE    57                                                  BUG8759
     O                       39PSETT     59                                                  BUG8759
     O                       39OPAYCR    61                                                  BUG8759
     O                       39RSETT     63                                                  BUG8759
     O                       39ORECDR    65                                                  BUG8759
4103 O***********************39PSETT     57                               S01117             BUG8759
4105 O***********************39OPAYCR    59                               S01117             BUG8759
4104 O***********************39RSETT     61                               S01117             BUG8759
4106 O***********************39ORECDR    63                               S01117             BUG8759
4112 O                       11DLST      22                               S01117
4114 O                       11BRCA      25                               S01117
4122 O                       11VDATSF    31                               S01117
4124 O                       11PUCY      34                               S01117
4125 O********************11 25PUAM      48 '          0 . '        S01117073516
4126 O********************11 26PUAM      48 '         0 .  '        S01117073516
4127 O********************11 27PUAM      48 '        0 .   '        S01117073516
4128 O********************11 24PUAM  Z   48                         S01117073516
     O*                                                                   073516
     O                       11@@AMTD    48                               073516
     O*                                                                   073516
     O                 36 11   PRFC      52                               S01117
     O                 35 11 17ORBR      55                               S01117
     O                       11BOKC      57                                                  BUG8759
     O                       11SCST      59                                                  BUG8759
     O                       11OSCA2     61                                                  BUG8759
     O                       11PCST      63                                                  BUG8759
     O                       11OPCA2     65                                                  BUG8759
4141 O***********************11SCST      57                               S01117             BUG8759
4143 O***********************11OSCA2     59                               S01117             BUG8759
4142 O***********************11PCST      61                               S01117             BUG8759
4144 O***********************11OPCA2     63                               S01117             BUG8759
4149 O                         ERCD     217                                                  BUG8759
4150 O                         DEALNO   223                                                  BUG8759
4151 O                         ACTION   224                                                  BUG8759
4149 O*************************ERCD     215                               S01117             BUG8759
4150 O*************************DEALNO   221                               S01117             BUG8759
4151 O*************************ACTION   222                               S01117             BUG8759
4503 O*****MEMOS FILE DETAIL RECORD UPDATE.                               CCB002
4504 O*****                                                               CCB002
4505 O*****MEMOS   E        63                                            CCB002
4506 O*****                    LDBLX     16                               CCB002
4507 O*****                    CLBLX     31                               CCB002
4508 O*****                    NATN      40P                              CCB002
4509 O**   DEALS FILE TRAILER UPDATE
4510 O**
4511 ODEALS   E        87
4512 O                         LOT1T    256
4513 O                         NORE      19P
4514 O                         NINS      28P
4515 O                         NDEL      31P
4516 O                         NLRA      34P
4517 O                         VRIF      52P
4518 O                         VRIL      54P
4519 O                         VRDF      62P
4520 O                         VRDL      64P
4521 O                         VLAF      72P
4522 O                         VLAL      74P
4523 O                         LCD      396P
4524 O                         CHTP     397
4525 O                         NATN     400P
4526 O*
4527 O**   DEALS FILE DETAIL RECORD - INSERTION
4528 O**
4529 ODEALSDB EADD     88N30 22
4530 O                                    1 'D'
4531 O                         DEALNO     7
4532 O                                    8 'B'
4533 O                                   10 '10'
4537 O*************************BICN      16                               S01194
4537 O                         A8BICN    16                               S01194
4538 O                         BRCODE    19
4539 O                                   21 'NX'
4540 O                         SUBTPE    23
4541 O*************************RUND      26P                              S01194
4541 O                         BJRDNB    26P                              S01194
     O/COPY WNCPYSRC,DL0035O001
4542 O                         VDAYNO    29P
4543 O                         ZERO05    32P
     O                                   34 '01'
4544 O                                   38 'TELX'
4548 O                         ZERO13    45P
4549 O                         BUYCCY    48
4550 O                         BAMT      55P
4551 O***********              ONE117    62P                              E11533
4551 O                         ONE138    62P                              E11533
4552 O                         BUYCCY    88
4553 O                         BAMT      95P
4554 O                         BAMT     123P
4560 O                         ZERO13   130P
4561 O                         BUYRAT   137P
4562 O                         RSETT    139
4563 O**********               ORECDR   141                                                   CGL029
     O**********               BLNK10   151                                                   CGL029
4564 O                         PTHEIR   161
4565 O                         PSETT    163
4566 O**********               OPAYCR   165                                                   CGL029
     O**********               BLNK10   175                                                   CGL029
4567 O                         RTHEIR   185
4568 O                         ZERO13   198P
4570 O                         ZERO13   211P
4572 O                                  212 '0'
     O                         LITD     219P                              E19125
     O                         LILA     226P                              E19125
     O                         DITD     233P                              E19125
     O                         DILA     240P                              E19125
4578 O                         ZERO13   247P
4579 O                         ZERO13   254P
     O                         ILAM     267P                              E19125
     O                         IDAM     277P                              E19125
     O                         IDIA     284P                              E19125
     O                                  290 '000000'
     O                         ILIR     352P                              E19125
     O                         IDIR     358P                              E19125
     O                         ILIA     366P                              E19125
4585 O                         DNSI     370
4586 O                         DSTII    371
4587 O                         CNFI     372
4588 O                         ACEI     373
4589 O                         TLXI     374
     O                         ILCM     382                                                   197873
     O                         IDCM     383                                                   197873
     O                         ZERO03   386P
     O                         ZERO03   388P
4590 O*****                    RUND     393P                              S01194
4591 O*****                    RUND     396P                              S01194
4590 O                         BJRDNB   393P                              S01194
4591 O                         BJRDNB   396P                              S01194
4592 O                         ACTION   397
4593 O                         NATN     400P
     O                         BOKC     402                                                  BUG8759
     O                         LNKDN    408                                                   197873
     O                         RSETT    410                               S01310
     O**********               ORECDR   412                                            S01310 CGL029
     O                         PTHEIR   432                               S01310
     O                         A8BICN   471                               E33165
     O                         ROCN     477                                                   197873
     O                         PSETT    479                               S01310
     O**********               OPAYCR   481                                            S01310 CGL029
     O                         POBN     540                                                   197873
     O                         POCN     546                                                   197873
     O                         RTHEIR   607                               S01310
     O                         ORBRCH  1039                               S01117
     O                 36      PRFCNT  1043                               S01117
     O                         ROBR    1046                               S01117
     O                         POBR    1049                               S01117
     O**********               MGPT    1056P                                           S01453 197873
     O**********               MGAM    1063P                                           S01453 197873
     O**********               MGCY    1066                                            S01453 197873
     O**********               MGBS    1067                                            S01453 197873
     O**********               OSRT    1074P                                           S01453 197873
     O**********               FWPT    1078P                                           S01453 197873
     O**********               BFPA    1085P                                           S01453 197873
     O**********               SFPA    1092P                                           S01453 197873
     O**********               BDBS    1099P                                           S01453 197873
     O**********               SDBS    1106P                                           S01453 197873
     O**********               SDBE    1113P                                           S01453 197873
     O**********               BDBF    1117P                                           S01453 197873
     O**********               SDBF    1121P                                           S01453 197873
     O**********               BDFA    1128P                                           S01453 197873
     O**********               SDFA    1135P                                           S01453 197873
     O                         ZERO13  1059P                                                  197873
     O                         ZERO13  1066P                                                  197873
     O                         MGPT    1070P                                                  197873
     O                         MGAM    1077P                                                  197873
     O                         MGCY    1080                                                   197873
     O                         MGBS    1081                                                   197873
     O                         OSRT    1088P                                                  197873
     O                         FWPT    1092P                                                  197873
     O                         BFPA    1099P                                                  197873
     O                         SFPA    1106P                                                  197873
     O                         BDBS    1113P                                                  197873
     O                         SDBS    1120P                                                  197873
     O                         SDBE    1127P                                                  197873
     O                         BDBF    1131P                                                  197873
     O                         SDBF    1135P                                                  197873
     O                         BDFA    1142P                                                  197873
     O                         SDFA    1149P                                                  197873
      *                                                                   CEU003
     O                         WBLNK3  1202                               CEU003
     O                         WBLNK3  1205                               CEU003
     O                         WBLNK3  1208                               CEU003
     O                         WBLN35  1410                                                   CSW212
     O                         WBLN35  1445                                                   CSW212
     O                         WBLN35  1480                                                   CSW212
     O                         WBLN35  1515                                                   CSW212
     O                         WBLN35  1550                                                   CSW212
     O                         WBLN35  1585                                                   CSW212
     O                         WBLN35  1620                                                   CSW212
     O                         WBLN35  1655                                                   CSW212
     O                         WBLN35  1690                                                   CSW212
     O                         WBLN35  1725                                                   CSW212
     O                         WBLN35  1760                                                   CSW212
     O                         WBLN35  1795                                                   CSW212
     O                         WBLN35  1830                                                   CSW212
     O                         WBLN35  1865                                                   CSW212
     O                         WBLN35  1900                                                   CSW212
     O                         WBLN35  1935                                                   CSW212
     O                         WBLN35  1970                                                   CSW212
     O                         WBLN35  2005                                                   CSW212
     O                                 2009 '0000'                                            CSW212
     O                         WBLNK6  2015                                                   CSW212
     O                                 2021 '000000'                                          CSW212
     O                                 2023 '00'                                              CSW212
     O                                 2025 '00'                                              CSW212
      *                                                                                       CAS004
     O**********               ZERO13  1228                                           CAS004 BUG4360
     O**********               ZERO13  1235                                           CAS004 BUG4360
     O**********               ZERO13  1242                                           CAS004 BUG4360
     O**********               ZERO13  1249                                           CAS004 BUG4360
     O**********               ZERO13  1256                                           CAS004 BUG4360
     O**********               ZERO13  1263                                           CAS004 BUG4360
     O**********               ZERO13  1270                                           CAS004 BUG4360
     O**********               ZERO13  1277                                           CAS004 BUG4360
     O**********               ZERO13  1284                                           CAS005 BUG4360
     O**********               ZERO13  1291                                           CAS005 BUG4360
     O                         ZERO13  1228P                                                 BUG4360
     O                         ZERO13  1235P                                                 BUG4360
     O                         ZERO13  1242P                                                 BUG4360
     O                         ZERO13  1249P                                                 BUG4360
     O                         ZERO13  1256P                                                 BUG4360
     O                         ZERO13  1263P                                                 BUG4360
     O                         ZERO13  1270P                                                 BUG4360
     O                         ZERO13  1277P                                                 BUG4360
     O                         ZERO13  1284P                                                 BUG4360
     O                         ZERO13  1291P                                                 BUG4360
     O                         ORECDR  1293                                                   CGL029
     O                         BLNK16  1309                                                   CGL029
     O                         OPAYCR  1311                                                   CGL029
     O                         BLNK16  1327                                                   CGL029
     O                         ORECDR  1329                                                   CGL029
     O                         OPAYCR  1347                                                   CGL029
     O                       21NXCLAS  1367                                                   CDL038
     O                      N21        1367 '    '                                            CDL038
     O*                                                                   S01408
     O/COPY WNCPYSRC,DL0035OOPG                                           S01408
     O*                                                                   S01408
4594 O**
4595 O**   DEALS FILE DETAIL RECORD UPDATE
4596 O**
4597 ODEALS   E        88N30N22
4598 O*    INSERT OVER DELETED RECORD.
4599 O                                    1 'D'
4600 O                         DEALNO     7
4601 O                                    8 'B'
4602 O                                   10 '10'
4606 O*************************BICN      16                               S01194
4606 O                         A8BICN    16                               S01194
4607 O                         BRCODE    19
4608 O                                   21 'NX'
4609 O                         SUBTPE    23
4610 O*************************RUND      26P                              S01194
4610 O                         BJRDNB    26P                              S01194
     O/COPY WNCPYSRC,DL0035O002
4611 O                         VDAYNO    29P
4612 O                         ZERO05    32P
4615 O                                   34 '01'
4616 O                                   38 'TELX'
4617 O                         ZERO13    45P
4618 O                         BUYCCY    48
4619 O                         BAMT      55P
4620 O***********              ONE117    62P                              E11533
4620 O                         ONE138    62P                              E11533
4621 O                         BUYCCY    88
4622 O                         BAMT      95P
4623 O                         BAMT     123P
4629 O                         ZERO13   130P
4630 O                         BUYRAT   137P
4631 O                         ZERO13   198P
4633 O                         ZERO13   211P
4635 O                                  212 '0'
4641 O                         ZERO13   247P
4642 O                         ZERO13   254P
     O                                  290 '000000'
4646 O                         DNSI     370
4647 O                         DSTII    371
4648 O                         ACEI     373
4649 O                         TLXI     374
     O                         ZERO03   386P
     O                         ZERO03   388P
4650 O*******                  RUND     393P                              S01194
4650 O                         BJRDNB   393P                              S01194
     O                         ORBRCH  1039                               S01117
     O                 36      PRFCNT  1043                               S01117
     O                         ROBR    1046                               S01117
     O                         POBR    1049                               S01117
4651 O*    REVERSAL.
4652 O                       33LOT1     256
     O                       33OPCA    1309                                                   CGL029
     O                       33OSCA    1327                                                   CGL029
4653 O***********************33LOT2     400                               S01117
     O                       33LOT2     413                               S01117
4654 O                       33           1 'R'
4655 O*    INSERT
4656 O                      N33RSETT    139
4657 O**********            N33ORECDR   141                                                   CGL029
     O**********            N33BLNK10   151                                                   CGL029
4658 O                      N33PTHEIR   161
4659 O                      N33PSETT    163
4660 O**********            N33OPAYCR   165                                                   CGL029
     O**********            N33BLNK10   175                                                   CGL029
4661 O                      N33RTHEIR   185
4662 O                      N33BLNK10   309
4663 O                      N33BLNK35   344
4664 O                         CNFI     372
4665 O                         ACTION   397
     O                      N33ORBRCH  1039                               S01117
     O                    36N33PRFCNT  1043                               S01117
     O                      N33ROBR    1046                               S01117
     O                      N33POBR    1049                               S01117
     O**********               MGPT    1056P                                           S01453 197873
     O**********               MGAM    1063P                                           S01453 197873
     O**********               MGCY    1066                                            S01453 197873
     O**********               MGBS    1067                                            S01453 197873
     O**********               OSRT    1074P                                           S01453 197873
     O**********               FWPT    1078P                                           S01453 197873
     O**********               BFPA    1085P                                           S01453 197873
     O**********               SFPA    1092P                                           S01453 197873
     O**********               BDBS    1099P                                           S01453 197873
     O**********               SDBS    1106P                                           S01453 197873
     O**********               SDBE    1113P                                           S01453 197873
     O**********               BDBF    1117P                                           S01453 197873
     O**********               SDBF    1121P                                           S01453 197873
     O**********               BDFA    1128P                                           S01453 197873
     O**********               SDFA    1135P                                           S01453 197873
     O                         ZERO13  1059P                                                  197873
     O                         ZERO13  1066P                                                  197873
     O                         MGPT    1070P                                                  197873
     O                         MGAM    1077P                                                  197873
     O                         MGCY    1080                                                   197873
     O                         MGBS    1081                                                   197873
     O                         OSRT    1088P                                                  197873
     O                         FWPT    1092P                                                  197873
     O                         BFPA    1099P                                                  197873
     O                         SFPA    1106P                                                  197873
     O                         BDBS    1113P                                                  197873
     O                         SDBS    1120P                                                  197873
     O                         SDBE    1127P                                                  197873
     O                         BDBF    1131P                                                  197873
     O                         SDBF    1135P                                                  197873
     O                         BDFA    1142P                                                  197873
     O                         SDFA    1149P                                                  197873
      *                                                                   CEU003
     O                         WBLNK3  1202                               CEU003
     O                         WBLNK3  1205                               CEU003
     O                         WBLNK3  1208                               CEU003
      *                                                                                       CAS004
     O**********               ZERO13  1228                                           CAS004 BUG4360
     O**********               ZERO13  1235                                           CAS004 BUG4360
     O**********               ZERO13  1242                                           CAS004 BUG4360
     O**********               ZERO13  1249                                           CAS004 BUG4360
     O**********               ZERO13  1256                                           CAS004 BUG4360
     O**********               ZERO13  1263                                           CAS004 BUG4360
     O**********               ZERO13  1270                                           CAS004 BUG4360
     O**********               ZERO13  1277                                           CAS004 BUG4360
     O**********               ZERO13  1284                                           CAS005 BUG4360
     O**********               ZERO13  1291                                           CAS005 BUG4360
     O                         ZERO13  1228P                                                 BUG4360
     O                         ZERO13  1235P                                                 BUG4360
     O                         ZERO13  1242P                                                 BUG4360
     O                         ZERO13  1249P                                                 BUG4360
     O                         ZERO13  1256P                                                 BUG4360
     O                         ZERO13  1263P                                                 BUG4360
     O                         ZERO13  1270P                                                 BUG4360
     O                         ZERO13  1277P                                                 BUG4360
     O                         ZERO13  1284P                                                 BUG4360
     O                         ZERO13  1291P                                                 BUG4360
     O                         ORECDR  1293                                                   CGL029
     O                         BLNK16  1309                                                   CGL029
     O                         OPAYCR  1311                                                   CGL029
     O                         BLNK16  1327                                                   CGL029
     O                         ORECDR  1329                                                   CDL038
     O                         OPAYCR  1347                                                   CDL038
     O                       21NXCLAS  1367                                                   CDL038
     O                      N21        1367 '    '                                            CDL038
     O*                                                                   S01408
     O/COPY WNCPYSRC,DL0035OOP1                                           S01408
     O*                                                                   S01408
     O                         WBLN35  1410                                                   CSW212
     O                         WBLN35  1445                                                   CSW212
     O                         WBLN35  1480                                                   CSW212
     O                         WBLN35  1515                                                   CSW212
     O                         WBLN35  1550                                                   CSW212
     O                         WBLN35  1585                                                   CSW212
     O                         WBLN35  1620                                                   CSW212
     O                         WBLN35  1655                                                   CSW212
     O                         WBLN35  1690                                                   CSW212
     O                         WBLN35  1725                                                   CSW212
     O                         WBLN35  1760                                                   CSW212
     O                         WBLN35  1795                                                   CSW212
     O                         WBLN35  1830                                                   CSW212
     O                         WBLN35  1865                                                   CSW212
     O                         WBLN35  1900                                                   CSW212
     O                         WBLN35  1935                                                   CSW212
     O                         WBLN35  1970                                                   CSW212
     O                         WBLN35  2005                                                   CSW212
     O                                 2009 '0000'                                            CSW212
     O                         WBLNK6  2015                                                   CSW212
     O                                 2021 '000000'                                          CSW212
     O                                 2023 '00'                                              CSW212
     O                                 2025 '00'                                              CSW212
4693 O**   RELEASE DEALS FILE
4694 O        E        81
      *                                                                                      BUG3937
     ODLDLDBQDEADD     14                                                                    BUG3937
     O                         BRCODE     3                                                  BUG3937
     O                         DEALNO     9                                                  BUG3937
     O                         ZERO06    15                                                  BUG3937
     O                         ZERO03    18                                                  BUG3937
     O                         ZERO02    20                                                  BUG3937
     O                         ZERO06    26                                                  BUG3937
     O                         ZERO03    29                                                  BUG3937
     O                         ZERO02    31                                                  BUG3937
     O                                   32 ' '                                              BUG3937
     O                         ZERO15    40P                                                 BUG3937
     O                         ZERO15    48P                                                 BUG3937
     O                         ZERO15    56P                                                 BUG3937
     O                                   59 '   '                                            BUG3937
4715 O**
4715 O**
4716 O**   DTRIX DETAIL FILE
4717 O**
4718 ODTRIXDD E        60 30
4719 O                                    2 'DD'
4720 O                         DEALNO     8
4722 O                         ZERO08    16
4723 O                         ACTION    17
4724 O***********                        18 'N'                           E11533
4726 O***********                        19 'Y'                           E11533
4724 O***********                        18 'Y'                     E11533E16905
     O                                   18 'N'                           E16905
     O***********                        19 'N'                     E11533091452
     O                                   19 'Y'                           091452
     O                         TIM       25
4728 O                                   26 'N'
4729 O                         PR1       27
4730 O                                   28 '0'
4731 O                         PR3       29
4731 O                         BRCODE    37
4733 O                         NATN      40P
4734 O**   DTRIX HEADER FILE
4735 ODTRIXHH E        60N30
4736 O                         LOT       40
4739 O                         NDLR      29P
4740 O                         NATN      40P
4741 O**   RELEASE DTRIX HEADER FILE
4742 O        E        85
4943 O*
4751 O**   PRONO FILE DETAIL RECORD UPDATE
4752 OPRONO   E        62 30
4753 O                         LOTA     128
4754 O                         PNB       46P
4755 O                         PND       61P
4756 O                         NATN     128P
4757 O**   RELEASE PRONO
4758 O        E        62N30
4759 O**
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  ERROR MESSAGES
INVALID FUNCTION KEY
INVALID ACTION CODE
DEAL ALREADY ON FILE
DEAL NOT FOUND
INVALID DEAL TYPE
INVALID DEAL NUMBER
RECORD UPDATED BY ANOTHER WORKSTATION
REVERSAL CANNOT BE ACTIONED
REVERSED DEAL
MSG NOT USED
ACTION CODE NOT VALID FOR USER
ACTION / BKG.BR. ON RELATED DEAL REC. INVALID FOR USER
ORIGINATING BR. ON RELATED DEAL REC. INVALID FOR USER
DEAL NUMBER CANNOT BE WITHIN AUTOMATIC ALLOCATION RANGE
MATURED DEAL
HISTORIC DEAL, USE DEALS FILE ENQUIRY TO DISPLAY DETAILS
** POW - POWERS OF 10 FOR CCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** XOT - XML Opening Tags for the Compliance Engine.                                          CSD015
<Receipt Our Nostro>                                                                          CSD015
<Receipt Inter. Bank>                                                                         CSD015
<Receipt Ord. Bank>                                                                           CSD015
<Receipt Ord. Customer>                                                                       CSD015
<Payment Our Nostro>                                                                          CSD015
<Payment Inter. Bank>                                                                         CSD015
<Payment Ord. Bank>                                                                           CSD015
<Payment Ord. Customer>                                                                       CSD015
<Payment Rec. Corr.>                                                                          CSD015
<Payment Recipient>                                                                           CSD015
<Payment Acc. with Bank>                                                                      CSD015
<Payment Beneficiary>                                                                         CSD015
<Payment Details>                                                                             CSD015
** XCT - XML Closing Tags for the Compliance Engine.                                          CSD015
</Receipt Our Nostro>                                                                         CSD015
</Receipt Inter. Bank>                                                                        CSD015
</Receipt Ord. Bank>                                                                          CSD015
</Receipt Ord. Customer>                                                                      CSD015
</Payment Our Nostro>                                                                         CSD015
</Payment Inter. Bank>                                                                        CSD015
</Payment Ord. Bank>                                                                          CSD015
</Payment Ord. Customer>                                                                      CSD015
</Payment Rec. Corr.>                                                                         CSD015
</Payment Recipient>                                                                          CSD015
</Payment Acc. with Bank>                                                                     CSD015
</Payment Beneficiary>                                                                        CSD015
</Payment Details>                                                                            CSD015
