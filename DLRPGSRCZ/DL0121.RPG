     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Customer deals enquiry - descending date')    *
      *****************************************************************
      *                                                               *
      *  Midas - Dealing Module                                       *
      *                                                               *
      *  DL0121 - CUSTOMER DEALS ENQUIRY IN DESCENDING DATE ORDER     *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CGL165             Date 17Feb15               *
      *  Prev Amend No. CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 262285             Date 10Nov09               *
      *                 CER059             Date 19Jul10               *
      *                 260855             Date 08Jul09               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 260329             Date 20May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 249976A            Date 09Oct07               *
      *                 249976             Date 19Sep07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 117478             Date 26May06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 237063             Date 20Nov05               *
      *                 CDL033             Date 10Feb05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 20Apr04               *
      *                 BG2171             Date 01Sep03               *
      *                 CGL029             Date 01Sep03               *
      *                 214207             Date 19Feb03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 208051             Date 11Sep02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 170701             Date 01Feb01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 155954             Date 04Oct99               *
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CTI002             Date 23Sep98               *
      *                 S01408             DATE 16AUG96               *
     F*                 101742             DATE 23MAY96               *
     F*                 S01444             DATE 11APR95               *
     F*                 073516             DATE 12AUG94               *
     F*                 060779             DATE 10JAN94               *
     F*                 S01453             DATE 13DEC93               *
     F*                 062717             DATE 01NOV93               *
     F*                 S01378             DATE 15OCT92               *
     F*                 AUS015             DATE 24AUG92               *
     F*                 S01319             DATE 19AUG91               *
     F*                 E25812             DATE 02AUG91               *
     F*                 E28392             DATE 16JAN92               *
     F*                 E26937             DATE 10OCT91               *
     F*                 E27537             DATE 21AUG91               *
     F*                 DT0204             DATE 05JUN91               *
     F*                 S01332             DATE 23APR91               *
     F*                 DT0038             DATE 08APR91               *
     F*                 S01311             DATE 15JAN91               *
     F*                 LN0467             DATE 05SEP90               *
     F*                 E231               DATE 15FEB90               *
     F*                 E5                 DATE 12DEC89               *
     F*                 E22                DATE 01NOV89               *
     F*                 S01194             DATE 15/05/89              *
     F*                 S01117             DATE 15/05/89              *
     F*                 S01184             DATE 19FEB90               *
     F*                 E22855             DATE 29JUL90               *
     F*                 E20251             DATE 25JUN90               *
     F*                 BHF486             DATE 11SEP90               *
     F*                 E22567             DATE 22JUN90               *
     F*                 S01199             DATE 27FEB90               *
     F*                 E20901             DATE 25/01/90              *
     F*                 S01203             DATE 04/04/89              *
     F*                 S01157             DATE 04/10/88              *
     F*                 E15119             DATE 16/09/88              *
     F*                 E14702             DATE 14/08/88              *
     F*                 E13029             DATE 05/05/88              *
     F*                 S01136             DATE 15/12/87              *
     F*                 S01119             DATE 28/07/87              *
     F*                 E10784             DATE 20/05/87              *
     F*                 E10218             DATE 18/02/87              *
     F*                 S01004             DATE 11/07/86              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
     F*  THIS PROGRAM WAS CREATED FROM DL0120.                        *
     F*  PLEASE NOTE THAT ALTHOUGH THE ERROR NUMBERS FROM DL0120      *
     F*  HAVE BEEN LEFT IN THE PROGRAM A LARGE NUMBER OF REDUNDANT    *
     F*  LINES HAVE BEEN REMOVED. NEW CODE INSERTED HAS NOT BEEN      *
     F*  ANNOTATED WITH E26937                                        *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  262285 - Deal subtype not shown for CI deals.                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  260855 - Initialise *IN39 to avoid TCUCY of RX deal being    *
      *           used by SALE ccy of another deal.                   *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  260329 - Outstanding deals by customer returns wrong value.  *
      *           Applied fix 259360.                                 *
      *  249976A - Database error occurs when a customer with FX      *
      *            deals attached are enquired.                       *
      *  249976 - Include complete deals in enquiry.                  *
      *  117478 -  Deal type CI(certificate of deposit issued) is     *
      *            being reported against the internal customer.      *
      *            It should be picked up via the counterparty        *
      *            which on DEALSDC is held in field CHNA so new      *
      *            format on DEALSDC needs handling.                  *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL033 - Floating Rate CDs Issued (Recompile)                *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes                                   *
      *  BG2171 - Recompilations omitted by BUG1832                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  214207 - Options ODCD and ODEC impossible to page up/down.   *
      *  208051 - Format -ve rates with a leading '-' sign.           *
      *  170701 - Exposure management enquiry does not show deal      *
      *           details correctly due to customer number being      *
      *           override.  Fix is to rename field CNUM in           *
      *           PF/DEALSDD so that correct deal details can be      *
      *           shown using exposure management enquiry.            *
      *  CSD007 - Customer Closing                                    *
     F*  155954 - Applied fix 143256                                  *
     F*           Reversed deals do not have a narrative status.      *
     F*           Applied fix 130902 .                                *
     F*         - Do not display deleted/reversed deals that were not *
     F*           deleted today. Applied fix 104439 .                 *
      *  CGL011 - Collateral Processing for Midas                     *
      *  CDL006 - Dealing Fiduciary                                   *
      *  CTI002 - Recompiled : File SDEXPMPD changed                  *
     F*  S01408 - Core Hook DL0121CP22 Added                          *
     F*         - Core Hook DL0121CP21 Added                          *
     F*         - Core Hook DL0121CP20 Added                          *
     F*         - Core Hook DL0121CP19 Added                          *
     F*         - Core Hook DL0121CP18 Added                          *
     F*         - Core Hook DL0121CP17 Added                          *
     F*         - Core Hook DL0121CP16 Added                          *
     F*         - Core Hook DL0121CP15 Added                          *
     F*         - Core Hook DL0121CP14 Added                          *
     F*         - Core Hook DL0121CP13 Added                          *
     F*         - Core Hook DL0121CP12 Added                          *
     F*         - Core Hook DL0121CP11 Added                          *
     F*         - Core Hook DL0121CP10 Added                          *
     F*         - Core Hook DL0121CCP9 Added                          *
     F*         - Core Hook DL0121CCP8 Added                          *
     F*         - Core Hook DL0121CCP7 Added                          *
     F*         - Core Hook DL0121CCP6 Added                          *
     F*         - Core Hook DL0121CCP5 Added                          *
     F*         - Core Hook DL0121CCP4 Added                          *
     F*         - Core Hook DL0121CCP3 Added                          *
     F*         - Core Hook DL0121CCP2 Added                          *
     F*         - Core Hook DL0121CCP1 Added                          *
     F*  101742 - EM enquiry does not show NAP's where Issuer (ISCN)  *
     F*           is not the same as Customer (CNUM), although these  *
     F*           appear on Out. Deals by Cust. screen. Fix is to     *
     F*           amend EMCUSMM2/3 to key DEALSDD on ISCN instead     *
     F*           of CNUM (as per CACUSDL2/3), and rename the Cust.   *
     F*           No. field of these LF's in DL0121.                  *
     F*  S01444 - These files have been amended to include all the    *
     F*           historic deals files.                               *
     F*  073516 - Use decimal point and thousand separator as set up  *
     F*           in ICD                                              *
     F*  060779 - The confirmation matching feedback records are      *
     F*           not displaying the correct information. Set up      *
     F*           key correctly before chaining to LF/CFFEEDL0.       *
     F*  S01453 - Margin and FX Positions/Points and Base currency    *
     F*           Positions/Points added to FX input (recompiled)     *
     F*  062717 - Field TYPE in data structure @PARM should really    *
     F*           SDEAL to match display file.                        *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Include parcel             *
     F*           details on enquiry for na's purchased and sold.     *
     F*  AUS015 - Customer FX/MM Deals Enquiry.                       *
     F*  S01319 - Remove redundant processing                         *
     F*  E25812 - ERROR MESSAGES ARE GETTING DISPLAYED. NEED TO       *
     F*           WRITE OUT RECORD FORMAT DL0121F3                    *
     F*  E28392 - IF MULTIBRANCHING IS OFF CALL CONSOLIDATED          *
     F*           VERSION OF THE REPORT                               *
     F*  E26937 - DISPLAY THE DEALS IN REVERSE DATE ORDER             *
     F*  E27537 - FORMAT THE INTEREST RATE SPREAD IF THE BASE RATE    *
     F*           CODE IS EITHER BLANK OR '00' AS SOME DEALS EXIST    *
     F*           WITH '00' AS A BASE RATE CODE                       *
     F*           REPORTED BY CLIENT AS BH3148                        *
     F*  DT0204 - REPORT PROGRAM CALLED CHANGED TO BE STANDARD        *
     F*           RCF PROGRAM FC0040X                                 *
     F*  S01332 - Amended to allow linked enquiry for FRAs IRS' and   *
     F*           Options in Exposure Management Release 10           *
     F*  DT0038 - Recompiled to pick up S01311 changes to DL0120FM    *
     F*  S01311 - Amended to allow linked enquiry for Exposure        *
     F*           Management Release 10                               *
     F*  LN0467 - CHANGE PROGRAMME TO ALLOW SELECTION BY BRANCH       *
     F*           AND ALSO USE STANDARD VALIDATION USING SPF          *
     F*  E231   - CHECK AUTHORITY OF USER TO BOOKING BRANCH AND       *
     F*           REMOVE ALL USE OF F6                                *
     F*  E5     - REPORT REQUEST MUST CONFORM TO RCF STANDARDS        *
     F*  E22    - 1.AMENDED SO THAT CUSTOMER SHORT NAME IS            *
     F*           DISPLAYED AFTER CALLING AOCUSTR0 WITH '?'           *
     F*           PARAMETER                                           *
     F*           2.CHANGED PARM @RTCD IN CALL TO AOCUSTR0            *
     F*           TO '*BLANKS'                                        *
     F*  S01194 - NEW STANDING DATA - ADD ACCESS PROGRAMS             *
     F*  S01117 - RELEASE 10 - MULTIBRANCHING                         *
     F*  S01184 - CONFIRMATION MATCHING                               *
     F*           ADD IN MATCH STATUS OF RELATED COUNTERPARTY         *
     F*           AND BROKER CONFIRMATIONS.                           *
     F*  E22855 - HELP TEXT                                       *
     F*  E20251 - Does not show deals 'N'.                            *
     F*           Delete all reference to                             *
     F*           CUSDL, MMCUSDLL and FXCUSDLL as all deals can be    *
     F*           viewed through the CACUSDLL FILE.                   *
     F*  (BHF486 - USE CACUSDL1, MULTIBRANCHING LOGICAL, AND ABOVE    *
     F*           SPEED UP COB BY REMOVING REDUNDANT FILES. THIS WIL  *
     F*           SPEED UP DLC0606B WHICH IS A COB BOTTLENECK DUE TO  *
     F*           DEPENDANCIES.)                                      *
     F*  E22567 - Show Midas deal type not DRS                        *
     F*  S01199 - RECOMPILED FOR  HELP SYSTEM                      *
     F*  E20901 - AMOUNTS BEING SHOWN AS +VE OR -VE WHEN OUTPUT TO    *
     F*           SCREEN (AS HELD THIS WAY ON FILE). SIGN REMOVED.    *
     F*  E15119 - INCORPORATION CHANGES                               *
     F*  S01157 - (i)  FRA/IRS ENHANCEMENTS - SPLIT DEAL TYPE 'RL'    *
     F*           INTO 'RR' (COLLAR), 'RP' (CAP) AND 'RF' (FLOOR).    *
     F*           DO NOT OUTPUT CEILING RATE IF DEAL TYPE IS 'FR'.    *
     F*           (ii) ALTER REPORT TO DISPLAY BUY/SELL INDICATOR     *
     F*           NEXT TO THE DEAL SUB TYPE (eg. 'FR-01B')            *
     F*  E15119 - IF MULTIPLE RECORDS ARE SELECTED FOR BROWSING, THE  *
     F*           1ST RECORD ONLY IS DISPLAYED. (ONLY IF SPACE-BAR    *
     F*           HAS BEEN USED TO MOVE THE CURSOR ON THE SCREEN.)    *
     F*  E14702 - FD FILES ACCESSED IRRESPECTIVE OF WHETHER DRS IS    *
     F*           INSTALLED OR NOT, CAUSING DB ERROR.                 *
     F*  E13029 - INCREASE SIZE OF RELATIVE RECORD NUMBER OF          *
     F*           SUBFILE.                                            *
     F*  S01136 - DRS INCORPORATION - INCLUDE PROCESSING FOR FX/MM    *
     F*           DEALS FILE AS PROGRAM SPECIFICATION MM0065          *
0011 F*  S01119 - FRA/IRS INCORPORATION HAS ADDED 4 MORE DEAL TYPES   *
0011 F*  E10784 - DECIMAL PLACES FROM PURCHASE CURRENCY BEING USED    *
0011 F*           TO EDIT BOTH CURRENCIES.                            *
0011 F*  E10218 - I-SPECS INCORRECTLY DEFINED FOR CUSDL               *
0011 F*                                                               *
     F*  DESCRIPTION OF LAST CHANGE:      THIS ENQUIRY PROGRAM HAS    *
     F*  BEEN RE-WRITTEN USING A SUBFILE. IT NOW ALLOWS LIVE AND/OR   *
     F*  MATURED RECORDS TO BE OUTPUT WITH THE OPTION TO PRINT        *
     F*  THOSE RECORDS. LINKS TO THE SHORTNAME ENQUIRY AND DEALS      *
     F*  FILE ENQUIRY HAVE ALSO BEEN INCLUDED.                        *
     F*                                                               *
0012 F*****************************************************************
     FDL0121FMCF  E                    WORKSTN
     F                                        RCDNBRKSFILE DL0121F2
     F***CACUSDL2IF  E           K        DISK         KINFSR *PSSR      UC            LN0467 249976
     FCACUSDL4IF  E           K        DISK         KINFSR *PSSR      UC  LN0467              249976
     F            DEALSDBF                          KRENAMECADL2DBF       E20251
     F            DEALSDCF                          KRENAMECADL2DCF       E20251
     F            DLSDCFCI                          KRENAMECADL2CI        117478
     F            DEALSDDF                          KRENAMECADL2DDF       E20251
     F            DEALSDEF                          KRENAMECADL2DEF       E20251
     F            DEALSDGF                          KRENAMECADL2DGF       S01136
     F            DLBHISD0                          KRENAMECADHI2BF       S01444
     F            DLCHISD0                          KRENAMECADHI2CF       S01444
     F            DLDHISD0                          KRENAMECADHI2DF       S01444
     F            DLEHISD0                          KRENAMECADHI2EF       S01444
     F            DLGHISD0                          KRENAMECADHI2GF       S01444
     F                                              KINFDS INIDS2         S01136
     FEMCUSFX2IF  E           K        DISK         KINFSR *PSSR      UC  S01311
     F            DEALSDBF                          KRENAMEFXDEALP2       S01311
     F            FXDEALP0                          KRENAMEFXDEALP4                           249976
     F                                              KINFDS INJDS2         S01311
     FEMCUSMM2IF  E           K        DISK         KINFSR *PSSR      UC  S01311
     F            DEALSDCF                          KRENAMEMMDELDP2       S01311
     F            DEALSDDF                          KRENAMEMMDENBP2       S01311
     F            DEALSDEF                          KRENAMEMMDENSP2       S01311
     F            MMDELDP0                          KRENAMEMMDELDP4                           249976
     F            MMDENBP0                          KRENAMEMMDENBP4                           249976
     F            MMDENSP0                          KRENAMEMMDENSP4                           249976
     F                                              KINFDS INKDS2         S01311
     FEMCUSFR2IF  E           K        DISK         KINFSR *PSSR      UC  S01332
     F            DEALSDGF                          KRENAMEEMCUS2FR       S01332
     FEMCUSIR2IF  E           K        DISK         KINFSR *PSSR      UC  S01332
     F            DEALSDGF                          KRENAMEEMCUS2IR       S01332
     F***CACUSDL3IF  E           K        DISK         KINFSR *PSSR      UC            LN0467 249976
     FCACUSDL5IF  E           K        DISK         KINFSR *PSSR      UC                      249976
     F            DEALSDBF                          KRENAMECADL3DBF       E20251
     F            DEALSDCF                          KRENAMECADL3DCF       E20251
     F            DLSDCFCI                          KRENAMECADL3CI        117478
     F            DEALSDDF                          KRENAMECADL3DDF       E20251
     F            DEALSDEF                          KRENAMECADL3DEF       E20251
     F            DEALSDGF                          KRENAMECADL3DGF       S01136
     F            DLBHISD0                          KRENAMECADHI3BF       S01444
     F            DLCHISD0                          KRENAMECADHI3CF       S01444
     F            DLDHISD0                          KRENAMECADHI3DF       S01444
     F            DLEHISD0                          KRENAMECADHI3EF       S01444
     F            DLGHISD0                          KRENAMECADHI3GF       S01444
     F            FXDEALP0                          KRENAMEFXDEALP1                           249976
     F            MMDELDP0                          KRENAMEMMDELDP1                           249976
     F            MMDENBP0                          KRENAMEMMDENBP1                           249976
     F            MMDENSP0                          KRENAMEMMDENSP1                           249976
     F                                              KINFDS INIDS3         S01136
     FEMCUSFX3IF  E           K        DISK         KINFSR *PSSR      UC  S01311
     F            DEALSDBF                          KRENAMEFXDEALP3       S01311
     F            FXDEALP0                          KRENAMEFXDEALP5                           249976
     F                                              KINFDS INJDS3         S01311
     FEMCUSMM3IF  E           K        DISK         KINFSR *PSSR      UC  S01311
     F            DEALSDCF                          KRENAMEMMDELDP3       S01311
     F            DEALSDDF                          KRENAMEMMDENBP3       S01311
     F            DEALSDEF                          KRENAMEMMDENSP3       S01311
     F            MMDELDP0                          KRENAMEMMDELDP5                           249976
     F            MMDENBP0                          KRENAMEMMDENBP5                           249976
     F            MMDENSP0                          KRENAMEMMDENSP5                           249976
     F                                              KINFDS INKDS3         S01311
     FEMCUSFR3IF  E           K        DISK         KINFSR *PSSR      UC  S01332
     F            DEALSDGF                          KRENAMEEMCUS3FR       S01332
     FEMCUSIR3IF  E           K        DISK         KINFSR *PSSR      UC  S01332
     F            DEALSDGF                          KRENAMEEMCUS3IR       S01332
     F**FDINSTLLIF**E****                DISK         KINFSR *PSSRUCE14702S01319
     F**FDPMNTLLIF**E****                DISK         KINFSR *PSSRUCE14702S01319
     FFDMNTHLLIF  E                    DISK         KINFSR *PSSR      UC  S01319
     FCFFEEDL0IF  E           K        DISK                               S01184
     FSDEXPML1IF  E           K        DISK                               S01332
     F/COPY WNCPYSRC,DL0121F001
     F*****************************************************************   S01184
0023 F* 01            WORKSTN RECORD ID
0013 F* 02   USED TO CONDITION FIRST TIME PASS THROUGH RPG CALC CYCLE
0025 F* 04            CACUSDL1  B RECORD - FX                             E20251
0026 F* 05            CACUSDL1  C RECORD - LOANS/DEPOSITS                 E20251
0027 F* 06            CACUSDL1  D RECORD - NA PURCHASED                   E20251
0028 F* 07            CACUSDL1  E RECORD - NA SOLD                        E20251
0014 F* 08   SET ON IF ERROR DURING READ FROM THE WORK STATION
     F* 09            CATCHALL - ALL FILES
     F* 11   FRA/IRS RECORD FROM CACUSDL1 OR EMCUSFRL OR EMCUSIRL         S01332
     F* 17            LIVD BLANK
     F* 18            ROLLUP AND SUBFILE END INDICATOR
     F*       19      'THEIR SPREAD RATE' NON-DISPLAY                     S01119
     F* KC            CMD/3 TO END                                        S01203
     F* KI            CMD/9 PRINT DEALS FOR THAT CUSTOMER                 S01203
     F*       20      SUBFILE DISPLAY
     F*
     F*       21      SUBFILE CONTROL RECORD
0033 F*    22         BLANK CUSTOMER FIELD INPUT
0034 F*    23         MATURITY DATE ZERO
     F*       24      DTYP = RR, RA OR RF WITH  UDSTI OR TDSTI BIT OFF    S01157
0036 F*    25         PURCH/SALE DEAL NO. ZERO
0037 F*    26         'ROLLED OVER BY DEAL NO' IS ZERO
     F*    27         MATD BLANK
     F*    28         LIVD EQUALS 'Y'
     F*    29         MATD EQUALS 'Y'
     F*       31      LIVD AND MATD SELECTED
     F*          32   BUY/SELL INDICATOR FOR FRA/CAP/COLLAR/FLOOR         S01157
     F*    33         ERROR WITH READ CFFEEDL0                            S01184
0042 F*       34      OPTION DEAL
     F*       35      NOSTRO TRANSFER
     F*    36         'OUR BASE RATE' ZERO                                S01119
     F*    37         'OUR SPREAD RATE' NON-DISPLAY                       S01119
     F*    38         'THEIR BASE RATE' ZERO                              S01119
     F*       39      'RX' DEAL TYPE                                      S01119
     F*       40      CHAIN FAIL
     F*       41      CACUSDL1 READ UNSUCCESSFUL OR END OF FILE           E20251
     F*       42      MATURED DEAL
0049 F*       43      NON-DISPLAY MESSAGE FIELD
     F*       44      EOF SUBFILE
     F*       45      DTYP =RR/RP/RF WITH UDSTI OR TDSTI FLOOR RATE BIT ONS01157
     F*       46      DTYP = CI
     F*       47      DTYP = FR OR RS                                     S01119
     F*       48      CUCUSDL1 RECORD FOUND                               E20251
     F*       49      DTYP = RR, RA OR RF AND OUR CAP OR COLLAR           S01157
     F*       49      DTYP = RL AND OUR CAP OR COLLAR                     S01119
     F*       52      NON DISPLAY HEADINGS
     F*       53      DTYP = RR, RA OR RF AND THEIR CAP OR COLLAR         S01157
0057 F*       54      NOT REVERSED DEAL
0058 F*       55      FEDERAL FUND DEAL
0059 F*       56      DEAL IN DOLLARS
1111 F*       57      FEDERAL FUND SALE
     F*               RX DEAL-USED TO TEST BIT 2 OF TDSTI AND OUTPUT 'F'  S01119
0061 F*       58      SALE IN DOLLARS
     F*               RX DEAL-'THEIR CURRENCY' IN DOLLARS                 S01119
     F*       59      CUSTOMER NOT FOUND
0062 F*       60      LIVE FIELD ERROR
0063 F*       61      MATURED FIELD ERROR
0064 F*       62      LEOPSF FIELD ERROR
     F*       63      SUBFILE NEXT CHANGE INDICATOR (SFLNXTCHG)
     F*       64      WORK INDICATOR
     F*       65      CONTROLS OUTPUT OF HEADING                          S01119
     F*       66      NOT FRA/IRS DEAL TYPE                               S01119
     F*       67      'CEILING RATE' ZERO                                 S01119
     F*       69      FX/MM FIELD ERROR                                   AUS015
     F*       70      DISABLE LEOPSF FIELD ON SUBFILE                     S01119
     F*       71      INDICATE READ PREVIOUS RECORD                       S01136
     F*       80      FX MM FR IR OR CC EXPOSURE MANAGEMENT ENQUIRY       S01332
     F*       81      FIRST TIME THROUGH FOR EXPOSURE MANAGEMENT ENQRY    S01311
     F*       94      WORK INDICATOR
     F*       96      USER NOT AUTHORISED TO MENU ITEM                    E231
     F**
     F*****************************************************************   S01184
     E                    CPY@    1   1 80
     E*    TXT LENGTH MUST EQUAL LIN LENGTH OR FOLLOWING ENTRY MOVEA'D    S01119
     E*                                                                   S01119
     E**********          TXT     1  11 77                TEXT     S011577S01378
     E/COPY WNCPYSRC,DL0121E003
     E                    TXT     1  12 77                TEXT            S01378
     E***********         ERR     1  15 46                MESSAGES S01332 AUS015
     E/COPY WNCPYSRC,DL0121E001
     E                    ERR     1  16 46                MESSAGES        AUS015
     E/COPY WNCPYSRC,DL0121E002
0071 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0073 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    LIN        77  1               LINE02 SR ARRAY  S01119
     E*    ARRAYS FOR EDITING AN AMOUNT ACCORDING TO NO. OF DPS.
     E                    ZEDT        5  4               EDITED AMOUNT
     E                    ZED2        6  3               AMT WITH NO COMMA
     E                    ZAMT        5  3               AMOUNT FIELD
     E                    Z3          3  1               DUMMY 3 CHAR FLD
     E                    ZCOM    1   4 20               EDT CHARS FOR AMT
     E                    RAT        11  1 0             EDITED AMOUNT
     E                    OUT        12  1               EDITED AMOUNT
     E                    FF1        20  1                                073516
     E*                                                                   S01136
     E**  ARRAY OF MONTH NAMES                                            S01136
     E                    @MN        12  3                                S01136
     E*                                                                   S01136
     E** ARRAY FOR ALLIGN AND VALIDATION                                  S01136
     E                    @A1        10  1                                S01136
     E                    @A2        10  1                                S01136
     E*                                                                   S01136
     E** ARRAYS USED IN SR.ZA0750                                         S01136
     E*                                                                   S01136
     E** ARRAY FOR AMOUNT INPUT                                           S01136
     E                    @D         15  1                                S01136
     E*                                                                   S01136
     E** ARRAY FOR DISPLAY AMOUNT                                         S01136
     E                    @E         21  1                                S01136
     E*                                                                   S01136
     E** WORK ARRAY                                                       S01136
     E                    @C         21  1                                S01136
     E*                                                                   S01136
     E** ARRAY USED BY STANDARD SR.MM1013                                 S01136
     E                    @W         13  1                                S01136
     E*                                                                   S01136
     E*                                                                   S01136
     E** TABLE FOR DEAL STATUS NARRATIVE                                  S01136
     E**********          TABA    1   7  1   TABB    7             E20251 S01319
     E                    TABA    1   6  1   TABB    7                    S01319
     E*                                                                   S01378
     E** @IN, @OUT used to format parcel size (drop leading zeros)        S01378
     E                    @IN         5  1                                S01378
     E                    @OUT        5  1                                S01378
     E/COPY WNCPYSRC,DL0121E004
0074 E*
     ICADL2DGF    11                                                      S01136
     I              RCDT                            DLREC                 AUS015
0099 I              RECI                            RECIC                 S01136
     I                                              MDAT            23    S01136
     I                                              UBRTT           36    S01136
     I                                              TBRTT           38    S01136
     I                                              CLRAT           67    S01136
     I*                                                                   S01136
     ICADL2DBF    04                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              OTDT            23    E20251
     I*                                                                   E20251
     ICADL2DCF    05                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              MDAT            23    E20251
     I                                              RBDN            26    E20251
     ICADL2CI     05                                                      117478
     I              RCDT                            DLREC                 117478
     I              RECI                            RECIC                 117478
     I                                              MDAT            23    117478
     I                                              RBDN            26    117478
     ICADL2DDF    06                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              MDAT            23    E20251
     I                                              ASDN            25    E20251
     I              CNUM                            PCUS                  E20251
     ICADL2DEF    07                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              RPDN            25    E20251
     ICADHI2GF    11                                                      S01444
     I              RCDT                            DLREC                 S01444
0099 I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              UBRTT           36    S01444
     I                                              TBRTT           38    S01444
     I                                              CLRAT           67    S01444
     IFXDEALP0    04                                                                          249976
     I              FHDDLT                          DLREC                                     249976
     I              FHDSTS                          RECIC                                     249976
     I              FHDN38                          DLNO                                      249976
     IMMDELDP0    05                                                                          249976
     I              HKDDLT                          DLREC                                     249976
     I              HKDSTS                          RECIC                                     249976
     I              HKDN38                          DLNO                                      249976
     IMMDENBP0    06                                                                          249976
     I              HLDDLT                          DLREC                                     249976
     I              HLDSTS                          RECIC                                     249976
     I              HLDN38                          DLNO                                      249976
     IMMDENSP0    07                                                                          249976
     I              HMDDLT                          DLREC                                     249976
     I              HMDSTS                          RECIC                                     249976
     I              HMDN38                          DLNO                                      249976
     I*                                                                   S01444
     ICADHI2BF    04                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              OTDT            23    S01444
     I*                                                                   S01444
     ICADHI2CF    05                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              RBDN            26    S01444
     ICADHI2DF    06                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              ASDN            25    S01444
     I              CNUM                            PCUS                  S01444
     ICADHI2EF    07                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              RPDN            25    S01444
     IFXDEALP2    04                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     IFXDEALP4    04                                                                          249976
     I              FHDDLT                          DLREC                                     249976
     I              FHDSTS                          RECIC                                     249976
     I              FHDN38                          DLNO                                      249976
     IMMDELDP2    05                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     I              CNUM                            PCUS                  101742
     I*                                                                   S01311
     IMMDENBP2    06                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     I              CNUM                            PCNUM                 170701
     I*                                                                   S01311
     IMMDENSP2    07                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
      *                                                                                       249976
     IMMDELDP4    05                                                                          249976
     I              HKDDLT                          DLREC                                     249976
     I              HKDSTS                          RECIC                                     249976
     I              HKDN38                          DLNO                                      249976
     IMMDENBP4    06                                                                          249976
     I              HLDDLT                          DLREC                                     249976
     I              HLDSTS                          RECIC                                     249976
     I              HLDN38                          DLNO                                      249976
     IMMDENSP4    07                                                                          249976
     I              HMDDLT                          DLREC                                     249976
     I              HMDSTS                          RECIC                                     249976
     I              HMDN38                          DLNO                                      249976
     I*                                                                   S01311
     I/COPY WNCPYSRC,DL0121I002
      *                                                                   S01332
     IEMCUS2FR    11                                                      S01332
     I              RECI                            RECIC                 S01332
     I                                              MDAT            23    S01332
     I                                              UBRTT           36    S01332
     I                                              TBRTT           38    S01332
     I                                              CLRAT           67    S01332
      *                                                                   S01332
     IEMCUS2IR    11                                                      S01332
     I              RECI                            RECIC                 S01332
     I                                              MDAT            23    S01332
     I                                              UBRTT           36    S01332
     I                                              TBRTT           38    S01332
     I                                              CLRAT           67    S01332
     ICADL3DGF    11                                                      S01136
     I              RCDT                            DLREC                 AUS015
0099 I              RECI                            RECIC                 S01136
     I                                              MDAT            23    S01136
     I                                              UBRTT           36    S01136
     I                                              TBRTT           38    S01136
     I                                              CLRAT           67    S01136
     ICADL3DBF    04                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              OTDT            23    E20251
     I*                                                                   E20251
     ICADL3DCF    05                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              MDAT            23    E20251
     I                                              RBDN            26    E20251
     ICADL3CI     05                                                      117478
     I              RCDT                            DLREC                 117478
     I              RECI                            RECIC                 117478
     I                                              MDAT            23    117478
     I                                              RBDN            26    117478
     ICADL3DDF    06                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              MDAT            23    E20251
     I                                              ASDN            25    E20251
     I              CNUM                            PCUS                  E20251
     ICADL3DEF    07                                                      E20251
     I              RCDT                            DLREC                 AUS015
     I              RECI                            RECIC                 E20251
     I                                              RPDN            25    E20251
     ICADHI3GF    11                                                      S01444
     I              RCDT                            DLREC                 S01444
0099 I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              UBRTT           36    S01444
     I                                              TBRTT           38    S01444
     I                                              CLRAT           67    S01444
     ICADHI3BF    04                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              OTDT            23    S01444
     I*                                                                   S01444
     ICADHI3CF    05                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              RBDN            26    S01444
     ICADHI3DF    06                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              MDAT            23    S01444
     I                                              ASDN            25    S01444
     I              CNUM                            PCUS                  S01444
     ICADHI3EF    07                                                      S01444
     I              RCDT                            DLREC                 S01444
     I              RECI                            RECIC                 S01444
     I                                              RPDN            25    S01444
     IFXDEALP1    04                                                                          249976
     I              FHDDLT                          DLREC                                     249976
     I              FHDSTS                          RECIC                                     249976
     I              FHDN38                          DLNO                                      249976
     IMMDELDP1    05                                                                          249976
     I              HKDDLT                          DLREC                                     249976
     I              HKDSTS                          RECIC                                     249976
     I              HKDN38                          DLNO                                      249976
     IMMDENBP1    06                                                                          249976
     I              HLDDLT                          DLREC                                     249976
     I              HLDSTS                          RECIC                                     249976
     I              HLDN38                          DLNO                                      249976
     IMMDENSP1    07                                                                          249976
     I              HMDDLT                          DLREC                                     249976
     I              HMDSTS                          RECIC                                     249976
     I              HMDN38                          DLNO                                      249976
     I*                                                                   S01311
     IFXDEALP3    04                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     IFXDEALP5    04                                                                          249976
     I              FHDDLT                          DLREC                                     249976
     I              FHDSTS                          RECIC                                     249976
     I              FHDN38                          DLNO                                      249976
     I*                                                                   S01311
     IMMDELDP3    05                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     I*                                                                   S01311
     IMMDENBP3    06                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
     I              CNUM                            PCNUM                 170701
      *                                                                   S01332
     IMMDENSP3    07                                                      S01311
0099 I              RCDT                            DLREC                 S01311
0099 I              RECI                            RECIC                 S01311
      *                                                                                       249976
     IMMDELDP5    05                                                                          249976
     I              HKDDLT                          DLREC                                     249976
     I              HKDSTS                          RECIC                                     249976
     I              HKDN38                          DLNO                                      249976
     IMMDENBP5    06                                                                          249976
     I              HLDDLT                          DLREC                                     249976
     I              HLDSTS                          RECIC                                     249976
     I              HLDN38                          DLNO                                      249976
     IMMDENSP5    07                                                                          249976
     I              HMDDLT                          DLREC                                     249976
     I              HMDSTS                          RECIC                                     249976
     I              HMDN38                          DLNO                                      249976
      *                                                                                       249976
     IEMCUS3FR    11                                                      S01332
     I              RECI                            RECIC                 S01332
     I                                              MDAT            23    S01332
     I                                              UBRTT           36    S01332
     I                                              TBRTT           38    S01332
     I                                              CLRAT           67    S01332
      *                                                                   S01332
     IEMCUS3IR    11                                                      S01332
     I              RECI                            RECIC                 S01332
     I                                              MDAT            23    S01332
     I                                              UBRTT           36    S01332
     I                                              TBRTT           38    S01332
     I                                              CLRAT           67    S01332
     I***FDPMNTL1***************                                          S01319
     IFDMNTHP0                                                            S01319
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I** EXTERNAL DS FOR TRADING DETAILS                                  S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01194
     I              BBCSSN                          CSNM
     I              BBCRTN                          CTWN
     I              BBCRNM                          CRNM
     ISDBRCH    E DSSDBRCHPD                                              LN0467
     I              QQDFAC                          QQDFA1                                    CGL029
     I** EXTERNAL DS FOR BRANCH CODES                                     LN0467
     I*                                                                   LN0467
     ISDDEAL    E DSSDDEALPD                                              S01319
     I              QQACCD                          QQACC1                                    CGL029
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01319
     I*
     ISCSARD    E DSSCSARDPD                                              CDL006
      ** External Data Structure for Switchable Features                  CDL006
      *                                                                   CDL006
     I/COPY WNCPYSRC,DL0121I001
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
      *                                                                   CSD007
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
     I*                                                                   S01194
     IRUNDAT      DS                             13                       S01194
     I** DATA STRUCTURE FOR MULTIBRANCH INDICATOR USING RUNDAT.           S01194
     I                                    P   8  100@RDNB                 E231
     I                                       13  13 @MBIN                 S01194
      *                                                                   E231
     IZMUSER      DS                             17                       E231
     I**  USER DETAILS DATA AREA                                          E231
     I                                       11  13 @DFBR                 E231
     I                                       17  17 BANK                  LN0467
      *                                                                   E231
     I*                                                                   S01194
     I**  EXTERNAL DATA AREA OF BRANCHES FOR THIS USER, TOP DOWN    S01117LN0467
     I*ZBRU        DS                                               S01117LN0467
     I** DATA STRUCTURE FOR MODULES PRESENT                               S01136
     IMMODS       DS                            256                       S01136
     I*********                              11  11 MODFD          E14702 S01319
     I                                       60  60 @CNF                  S01184
     I*                                                                   S01136
     I** INFORMATION DATA STRUCTURE,FOR FORMAT ACCESSED                   S01136
     I*                                                                   S01136
     IINIDS2      DS                                                      S01136
     I                                     *RECORD  RECIM2                S01136
     IINJDS2      DS                                                      S01311
     I                                     *RECORD  RECJM2                S01311
     IINKDS2      DS                                                      S01311
     I                                     *RECORD  RECKM2                S01311
     IINIDS3      DS                                                      S01136
     I                                     *RECORD  RECIM3                S01136
     IINJDS3      DS                                                      S01311
     I                                     *RECORD  RECJM3                S01311
     IINKDS3      DS                                                      S01311
     I                                     *RECORD  RECKM3                S01311
     I*                                                                   S01136
     I**  Used by ZA0660 - Date input in YYYYMMDD format                  S01136
     I            DS                                                      S01136
     I                                        1   80@@DTIN                S01136
     I                                        1   40@@YYYY                S01136
     I                                        5   60@@MTH                 S01136
     I                                        7   80@@DAY                 S01136
     I*                                                                   S01136
     I** DRS - DL VALUE DATE DATA STRUCTURE                               S01136
     I            DS                                                      S01136
     I                                        1   80@VDAT                 S01136
     I                                        1   40FHVDYY                S01136
     I                                        1   40HKVDYY                S01136
     I                                        1   40HLVDYY                S01136
     I                                        1   40HMVDYY                S01136
     I                                        5   60FHVDMM                S01136
     I                                        5   60HKVDMM                S01136
     I                                        5   60HLVDMM                S01136
     I                                        5   60HMVDMM                S01136
     I                                        7   80FHVDDD                S01136
     I                                        7   80HKVDDD                S01136
     I                                        7   80HLVDDD                S01136
     I                                        7   80HMVDDD                S01136
     I*                                                                   S01136
     I*                                                                   S01136
     I** DRS - DL OPTION END DATE DATA STRUCTURE.                         S01136
     I            DS                                                      S01136
     I                                        1   80@ODAT                 S01136
     I                                        1   40FHDOEY                S01136
     I                                        5   60FHDOEM                S01136
     I                                        7   80FHDOED                S01136
     I*                                                                   S01136
     I** DRS - DL DONE DATE DATA STRUCTURE.                               S01136
     I            DS                                                      S01136
     I                                        1   80@DDAT                 S01136
     I                                        1   40FHDDYY                S01136
     I                                        1   40HKDDYY                S01136
     I                                        1   40HLDDYY                S01136
     I                                        1   40HMDDYY                S01136
     I                                        5   60FHDDMM                S01136
     I                                        5   60HKDDMM                S01136
     I                                        5   60HLDDMM                S01136
     I                                        5   60HMDDMM                S01136
     I                                        7   80FHDDDD                S01136
     I                                        7   80HKDDDD                S01136
     I                                        7   80HLDDDD                S01136
     I                                        7   80HMDDDD                S01136
     I** DRS - DL MATURITY  DATE STRUCTURE.                               S01136
     I            DS                                                      S01136
     I                                        1   80@MDAT                 S01136
     I                                        1   40HKMDYY                S01136
     I                                        1   40HLMDYY                S01136
     I                                        1   40HMMDYY                S01136
     I                                        5   60HKMDMM                S01136
     I                                        5   60HLMDMM                S01136
     I                                        5   60HMMDMM                S01136
     I                                        7   80HKMDDD                S01136
     I                                        7   80HLMDDD                S01136
     I                                        7   80HMMDDD                S01136
     I*                                                                   S01136
     I* DATSTRUCTURE USED IN SUBROUTINE ZA0750                            S01136
     I* DATASTUCTURE TO CONVERT 7@IAMT DECIMAL FIELD TO ALPHA FIELD       S01136
     I*                                                                   S01136
     I@@AMDS      DS                             15                       S01136
     I                                        1  150@@IAMT                S01136
     I*                                                                   S01136
     I** DATA STRUCTURE FOR JOB AND USER ID                               S01136
     IPSDS       SDS                                                      S01136
     I*                                                                   S01136
     I** WORKSTATION ID                                                   S01136
     I                                      244 246 WSID
     I                                      244 253 @JOB                  S01136
     I*                                                                   S01136
     I** USER ID                                                          S01136
     I                                      254 263 @USER                 S01136
0383 I**   DATA STRUCTURE FOR RATE AMOUNT
0384 I            DS
     I                                        1  110RAT
     I                                        1  117ZRATE
0277 I**  LOCAL DATA AREA FOR DATABASE RECORD
0278 ILDA        UDS                            256
     I                                      134 141 DBFILE                E14702
     I                                      142 170 DBKEY                 E14702
     I                                      171 180 DBPGM                 E14702
     I                                      181 183 DBASE                 E14702
     I** LINK ENQUIRY DATA AREA
     IDLSDS     E DSDLDTA
     I*                                                                   S01119
     I*    DATA STRUCTURE TO SET UP SUBFILE LINE 1                        S01119
     I*                                                                   S01119
     I            DS                                                      S01119
     I                                        1  77 ZLINE1                S01119
     I                                        1   5 DTYPW                                     CDL038
     I                                        6   9 CLASW                                     CDL038
     I                                       11  11 BYSLW                                     CDL038
     I                                       12  170DLNO                                      CDL038
     I                                       20  26 DDATE                                     CDL038
     I**********                              1   6 DTYPW                              S01157 CDL038
     I**********                              8  130DLNO                               S01119 CDL038
     I**********                             18  24 DDATE                              S01119 CDL038
     I                                       28  34 VDATE                 S01119
     I                                       36  43 NARR1                 S01119
     I                                       45  47 CCY                   S01119
     I                                       49  49 FFIN                  S01119
     I                                       52  68 AMT1W                 S01119
     I                                       70  75 RDNO                  S01119
     I*                                                                   S01119
     I*    DATA STRUCTURE TO SET UP SUBFILE LINE 2                        S01119
     I*                                                                   S01119
     I            DS                                                      S01119
     I                                        1  77 ZLINE2                S01119
     I                                        1   1 ZF1                   S01119
     I                                        2   9 TEXT                  S01119
     I                                       10  10 ZF2                   S01119
     I                                       11  77 LINE2                 S01119
     I*                                                                   S01119
     I*    DATA STRUCTURE TO SET UP SUBFILE LINE 3                        S01119
     I*                                                                   S01119
     I            DS                                                      S01119
     I                                        1  77 ZLINE3                S01119
     I                                        1   1 ZF3                   S01119
     I                                        2   9 TEXT2                 S01119
     I                                       10  10 ZF4                   S01119
     I                                       11  77 LINE3                 S01119
     I*                                                                   S01119
     I*    DATA STRUCTURE TO RETRIEVE DEAL NUMBER AFTER READC             S01119
     I*                                                                   S01119
     I            DS                                                      S01119
     I                                        1  77 SFLINE                S01119
     I                                       12  17 ZDLNO                                     CDL038
     I**********                              8  13 ZDLNO                              S01119 CDL038
     I*                                                                   S01119
     I** CFFEEDL0 KEY                                                     S01184
     I            DS                                                      S01184
     I                                        1  16 CFKY                  S01184
     I****************************************1   7 @TS1           S01184 060779
     I****************************************1   1 @KY1           S01184 060779
     I****************************************2   7 @KY2           S01184 060779
     I****************************************8  10 @KY3           S01184 060779
     I                                        1   8 @TS1                  060779
     I                                        1   2 @KY1                  060779
     I                                        3   8 @KY2                  060779
     I                                        9  11 @KY3                  060779
     I*                                                                   DT0204
     I@PARM       DS                            100                       DT0204
     I** DATA STRUCTURE OF PROMPT PARAMETER                               DT0204
     I*                                                                   DT0204
     I                                        1   6 CUSKEY                DT0204
     I                                        7   7 OPTLIV                DT0204
     I                                        8   8 OPTMAT                DT0204
     I**********                              9  10 TYPE            AUS015062717
     I                                        9  10 SDEAL                 062717
     I*                                                                   S01119
     I              ' COLLATERAL'         C         COLLA                 CGL011
      ** Constant field for 'Collateral' text                             CGL011
      *                                                                   CGL011
     I/COPY WNCPYSRC,DL0121I003
     I/EJECT
     C********************************************************************
     C/COPY WNCPYSRC,DL0121C023
     C           *NAMVAR   DEFN           DLSDS
     C           *NAMVAR   DEFN           LDA
     C**
0389 C*    FIRST  CYCLE CALCULATIONS.
     C*
     C*   FIRST CYCLE ONLY
     C  N02                DO
     C                     MOVEACPY@      BIS@   80
     C                     SETON                     02
     C/COPY WNCPYSRC,DL0121C025
      *                                                                   S01311
      *   Test whether it is an FX or MM Exposure Management Enquiry      S01311
      *   and setup defaults if it is an Exposure Management Enqury       S01311
      *                                                                   S01311
     C           *LOCK     IN   DLSDS                                     S01311
     C                     MOVE RQDTD     FXMM    2                       S01311
     C                     OUT  DLSDS                                     S01311
     C           FXMM      IFEQ 'FX'                                      S01311
     C           FXMM      OREQ 'MM'                                      S01311
     C           FXMM      OREQ 'FR'                                      S01332
     C           FXMM      OREQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C/COPY WNCPYSRC,DL0121C037
     C                     MOVE *BLANKS   EMICDK 10                       S01332
     C                     MOVEL'EXPM'    EMICDK                          S01332
     C           EMICDK    CHAINSDEXPML1             40                   S01332
     C                     SETON                     80                   S01311
     C           FXMM      IFEQ 'FX'                                      062717
     C           FXMM      OREQ 'MM'                                      062717
     C                     MOVE FXMM      SDEAL                           062717
     C                     ELSE                                           062717
     C                     MOVE '  '      SDEAL                           062717
     C                     END                                            062717
     C                     MOVELRQDTD     CNUM                            S01311
     C                     MOVELRQDTD     CUST                            S01311
     C                     MOVE 'Y'       LIVD                            S01311
     C                     MOVE ' '       MATD                            S01311
     C                     MOVE 'ALL'     SBRCA                           S01311
     C                     MOVE 'ALL'     SBRCAX                          S01311
     C                     END                                            S01311
     C*                                                                   S01408
      *                                                                   CDL006
      ** Check if switchable feature CDL006 is switched on                CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM '       ' @RTCD                           CDL006
     C                     PARM '*VERIFY' @OPTN                           CDL006
     C                     PARM 'CDL006'  @SARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           @RTCD     IFNE *BLANKS                                   CDL006
     C           @RTCD     ANDNE'*NRF   '                                 CDL006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDL006
     C                     MOVEL'CDL006'  DBKEY            * DBERR 05 *   CDL006
     C                     MOVEL'005'     DBASE            ************   CDL006
     C                     MOVE '1'       *INU7                           CDL006
     C                     MOVE '1'       *INU8                           CDL006
     C                     MOVE '1'       *INLR                           CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           @RTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,DL0121CCP3                                           S01408
     C*                                                                   S01408
      *                                                                   E231
     C           *NAMVAR   DEFN           ZMUSER                          E231
     C                     IN   ZMUSER                                    E231
0394 C*
0395 C**   SET INDICATORS.
0396 C                     SETON                     43
0397 C*
0398 C**   GET DATE FORMAT
0400 C*****INITIALISE*FIELDS.                                             S01194
     C*                                                                   S01184
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL'03'      DBASE            * DBERR 03 *   S01194
     C                     MOVEL@OPTN     DBKEY            ************   S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
0951 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*
     C**  SETUP CFFEEDL0 KEY                                              S01184
     C***********          MOVE 'D'       @KY1                     S01184 060779
     C                     MOVE 'DL'      @KY1                            060779
     C                     MOVE '999'     @KY3                            S01184
0402 C**
     C*                                                                   S01119
     C** ACCESS TRADING DETAILS FILE FOR USD CCY CODE (BLBWCD)            S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDTRADPD'DBFILE           ************   S01194
     C                     MOVEL'04'      DBASE            * DBERR 04 *   S01194
     C                     MOVEL@OPTN     DBKEY            ************   S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01119
     C*    SET UP CONTROL CHARACTERS FOR FIELD CONDITIONING               S01119
     C*                                                                   S01119
     C**********           MOVE ' '       HEX20   1         NORMAL        S01119              CAAA03
     C**********           MOVE ' '       HEX21   1         REVERSE VIDEO S01119              CAAA03
     C**********           MOVE ' '       HEX22   1         HIGH INTENSITYS01119              CAAA03
     C**********           BITOF'1'       HEX20                           S01119              CAAA03
     C**********           BITOF'1'       HEX21                           S01119              CAAA03
     C**********           BITOF'1'       HEX22                           S01119              CAAA03
     C**********           BITON'2'       HEX20                           S01119              CAAA03
     C**********           BITON'2'       HEX21                           S01119              CAAA03
     C**********           BITON'7'       HEX21                           S01119              CAAA03
     C**********           BITON'2'       HEX22                           S01119              CAAA03
     C**********           BITON'6'       HEX22                           S01119              CAAA03
     C*                                                                   S01136
     C** INITIAL PROCESSING FOR DRS                                       S01136
     C                     EXSR #A                                        S01136
     C/COPY WNCPYSRC,DL0121C014
     C*
     C** IF DATABASE ERROR EXIT PROGRAM
     C           *INU7     CABEQ'1'       ENDM
     C*                                                                   073516
     C* Setup edit field with right Thousand and Decimal Separator        073516
     C                     MOVEAZCOM,1    FF1                             073516
     C                     MOVE BNTHSP    FF1,4                           073516
     C                     MOVE BNTHSP    FF1,8                           073516
     C                     MOVE BNTHSP    FF1,12                          073516
     C                     MOVE BNTHSP    FF1,16                          073516
     C                     MOVEAFF1       ZCOM,1                          073516
     C*                                                                   073516
     C                     MOVEAZCOM,2    FF1                             073516
     C                     MOVE BNTHSP    FF1,4                           073516
     C                     MOVE BNTHSP    FF1,8                           073516
     C                     MOVE BNTHSP    FF1,12                          073516
     C                     MOVE BNTHSP    FF1,16                          073516
     C                     MOVE BNDCSP    FF1,20                          073516
     C                     MOVEAFF1       ZCOM,2                          073516
     C*                                                                   073516
     C                     MOVEAZCOM,4    FF1                             073516
     C                     MOVE BNDCSP    FF1,16                          073516
     C                     MOVEAFF1       ZCOM,4                          073516
     C*                                                                   073516
     C*                                                                   073516
     C**                                                            S01117S01194
     C** READ DATA AREA - RUNDAT - FOR MULTIBRANCHING INDICATOR           S01194
     C           *NAMVAR   DEFN           RUNDAT                          S01194
     C                     IN   RUNDAT                                    S01194
     C**                                                                  S01117
     C**  IF MBIN = Y, OBTAIN BOOKING/ A/C BRANCHES                       S01117
     C**  VALID FOR THIS USER, IN FIRST CYCLE                             S01117
     C           @MBIN     IFEQ 'Y'                                       S01194
     C                     SETON                     10                   LN0467
     C                     END                                            S01117
     C*                                                                   S01119
     C                     END
0412 C*
      ** Validation of user's action code security.                       E231
      **                                                                  E231
0412 C*
0413 C********************************************************************
0414 C**
0415 C*    DETAIL CALCULATIONS.
     C*
     C**
     C**    MAIN PROCESSING LOOP
     C**
0416 C           DSPSC     TAG                             ** DSPSC TAG **
     C*                                                                   S01136
     C** CLEAR ALL DISPLAY WORK FIELDS.                                   S01136
     C                     MOVE *BLANKS   @MDT                            S01136
      *                                                                   S01311
      *  If it is an Exposure Management linked enquiry do not display    S01311
      *  the initial screen                                               S01311
      *                                                                   S01311
     C           *IN80     IFEQ '1'                                       S01311
     C           *IN81     ANDEQ'0'                                       S01311
     C                     SETON                     215281               S01311
     C                     SETOF                     20                   S01311
     C                     GOTO VALSC                                     S01311
     C                     END                                            S01311
     C*
     C*     DISPLAY SCREEN
     C           *IN02     IFEQ '1'
     C                     EXSR SCREEN
     C                     END
0416 C           VALSC     TAG                             ** DSPSC TAG **
     C                     EXSR CMDSR
      *                                                                   S01311
      *  If F12 is pressed return user to previos screen                  S01311
      *                                                                   S01311
     C           *INKL     IFEQ '1'                                       S01311
     C                     MOVE *BLANKS   CNUM                            S01311
     C                     MOVE *BLANKS   CUST                            S01311
     C                     MOVE *BLANKS   LIVD                            S01311
     C                     MOVE *BLANKS   MATD                            S01311
     C                     MOVE *BLANKS   SBRCA                           S01311
     C                     MOVE *BLANKS   SBRCAX                          S01311
     C                     GOTO DSPSC                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
     C*
     C*     IF INPUT FIELDS NOT VALID REDISPLAY PROMPT
     C           *IN43     IFEQ '0'
     C                     GOTO DSPSC
     C*
     C                     ELSE
     C*
     C*     LOAD SUBFILE
     C           *IN43     IFEQ '1'
     C/COPY WNCPYSRC,DL0121C038
     C                     EXSR LOAD
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP4                                           S01408
     C*                                                                   S01408
     C                     END
     C**
     C**    BRANCH BACK ON RESPONSE
     C                     GOTO VALSC
     C*
     C                     END
0469 C           ENDM      TAG                             ** ENDM  TAG **
     C********************************************************************
     C/SPACE 3
     C********************************************************************
     C**
     C**    SCREEN SR. SETUP & DISPLAY SCREEN
     C**
     C           SCREEN    BEGSR
     C**
     C**    PROMPT FORMAT
     C**    SET INDICATORS TO DISPLAY HEADING
     C                     MOVE '1'       *IN21
     C                     MOVE '1'       *IN52
     C                     MOVE '0'       *IN20
     C                     WRITEDL0121F1
     C                     WRITEDL0121F3                                  E25812
     C*                                                                   E22855
     C                     EXFMTDL0121F4                                  E22855
     C*                                                                   E22855
     C                     ENDSR
     C**
     C**
     C********************************************************************
     C/SPACE 3
     C********************************************************************
     C**
     C**    CMDSR SR. PROCESSING OF COMMAND KEYS AND INPUT
     C**
     C           CMDSR     BEGSR
     C**
     C*                                                                   S01203
      *                                                                   S01311
      *  Validate Command Keys                                            S01311
      *                                                                   S01311
     C           *INKA     IFEQ '1'                                       S01311
     C                     MOVE 'S'       RETNWF  1                       S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
     C           *INKC     IFEQ '1'                                       S01311
     C                     MOVE 'Q'       RETNWF                          S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
      * If called from modular enqiury, F12 returns user to Customer      S01311
      * Input screen, otherwise return is to the Exposure Management      S01311
      * front screen                                                      S01311
      *                                                                   S01311
     C           *INKL     IFEQ '1'                                       S01311
     C           *IN80     IFEQ '0'                                       S01311
     C                     GOTO ENDCMD                                    S01311
     C                     ELSE                                           S01311
     C                     MOVE 'U'       RETNWF                          S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
     C                     END                                            S01311
      *                                                                   S01311
     C**    VALIDATE INPUT
     C                     EXSR VALID
     C*
     C           ENDCMD    ENDSR                           **ENDSR  TAG **S01311
     C********************************************************************
     C/SPACE 3
     C********************************************************************
     C**
     C**    VALID SR. TO VALIDATE INPUT FIELDS
     C**
     C           VALID     BEGSR                           ** VALID SR  **
     C**
0423 C**
     C*     VALIDATE CUSTOMER FIELD INPUT
     C**
     C*     RESET INDICATORS
     C**
     C                     SETON                     43
     C                     SETOF                     596061
     C                     SETOF                     282931
     C                     SETOF                     62
     C***********          SETOF                     68            LN0467 AUS015
     C                     SETOF                     6869                 AUS015
     C**
0448 C*    ERROR IF CUSTOMER NO.NOT ENTERED,
0449 C**
     C           CUST      COMP *BLANKS                  22
0450 C   22                MOVE ERR,1     MSG
     C   22                SETOF                         43
0451 C   22                GOTO ENDCUS
0452 C*
     C** READ CUSTOMER FILE. IF ERROR THEN SEND APPROPRIATE MESSAGE       S01194
     C** DEPENDING ON WHETHER CUSTOMER NUMBER OR CUSTOMER SHORTNAME       S01194
     C** ENTERED (@KYST)                                                  S01194
     C***********          CALL 'AOCUSTR0'                         S01194 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM '*BLANKS' @RTCD   7                S01194 E22
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CUST      @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C***********SDCUST    PARM SDCUST    DSSDY                    S01194 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           @RTCD     ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE *BLANK                                    S01194
     C           @KYST     IFEQ '*CNUM  '                                 S01194
     C                     MOVE ERR,2     MSG                             S01194
     C                     ELSE                                           S01194
     C                     MOVE ERR,3     MSG                             S01194
     C                     END                                            S01194
     C                     MOVE '0'       *IN43                           S01194
     C                     GOTO ENDCUS                                    S01194
     C                     END                                            S01194
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
      *
     C*                                                                   E22
     C** PUT CUSTOMER SHORT NAME INTO CUST ON DISPLAY FILE                E22
     C                     MOVELCSNM      CUST   10                       E22
     C*                                                                   E22
     C** SET UP CNUM WITH VALUE CUSTOMER NO. ON SDCUSTPD                  S01194
     C                     MOVELBBCUST    CNUM                            S01194
     C/COPY WNCPYSRC,DL0121C022
     C**                                                                  S01117
     C** IF MBIN = Y,VALIDATE CUST.BR. FOR USER                           S01117
     C**                                                                  S01117
     C           @MBIN     IFEQ 'Y'                                       S01194
     C           SBRCA     IFEQ '   '                                     LN0467
     C                     MOVE @DFBR     SBRCA                           LN0467
     C                     MOVE @DFBR     SBRCAX  3                       LN0467
     C                     ELSE                                           LN0467
     C                     MOVE SBRCA     SBRCAX                          LN0467
     C                     END                                            LN0467
     C           SBRCA     IFNE 'ALL'                                     LN0467
     C** VALIDATE CUST.BR. FOR USER                                 S01117LN0467
     C**********           CALL 'AOBRCHR0'                                             LN0467 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANK    @RTCD   7                       LN0467
     C                     PARM '*KEY    '@OPTN   7                       LN0467
     C                     PARM SBRCA     @KEYB   3                       LN0467
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        LN0467 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   LN0467
     C                     SETON                     68                   LN0467
     C                     MOVELERR,10    MSG                             LN0467
     C                     SETOF                     43                   LN0467
     C                     GOTO ENDVAL                                    LN0467
     C                     ELSE                                           LN0467
     C                     MOVE A8BRCD    SBRCA                           LN0467
     C                     MOVE A8BRCD    SBRCAX                          S01311
     C                     CALL 'ZVBBU'                                   LN0467
     C                     PARM           SBRCA                           LN0467
     C                     PARM *ZEROS    ERRCOD  10                      LN0467
     C           ERRCOD    IFNE 0                                         LN0467
     C                     SETON                     70                   LN0467
     C           ERRCOD    IFEQ 1                                         LN0467
     C                     MOVELERR,8     MSG                             S01311
     C                     ELSE                                           LN0467
     C                     MOVELERR,9     MSG                             S01311
     C                     END                                            LN0467
     C                     SETOF                     43                   LN0467
     C                     GOTO ENDVAL                                    LN0467
     C                     END                                            LN0467
     C/COPY WNCPYSRC,DL0121C019
     C                     GOTO CUSTDL                                    S01117
     C                     END                                            LN0467
     C                     ELSE                                           LN0467
     C           BANK      IFNE 'Y'                                       LN0467
     C                     SETON                     68                   LN0467
     C                     MOVELERR,11    MSG                             LN0467
     C                     SETOF                     43                   LN0467
     C                     GOTO ENDVAL                                    LN0467
     C                     ELSE                                           LN0467
     C/COPY WNCPYSRC,DL0121C020
     C                     GOTO CUSTDL                                    LN0467
     C                     END                                            LN0467
     C                     END                                            LN0467
     C                     ELSE                                           LN0467
     C/COPY WNCPYSRC,DL0121C021
     C                     GOTO CUSTDL                                    LN0467
     C                     END                                            LN0467
     C/COPY WNCPYSRC,DL0121C018
     C*
0481 C           ENDCUS    TAG                             ** ENDCUS TAG *
     C*
     C*    SET ERROR INDICATOR FOR CUSTOMER FIELD IN DISPLAY FILE
     C                     SETON                     59
0483 C                     GOTO ENDVAL
     C*
0481 C           CUSTDL    TAG                             ** CUSTDL TAG *
     C*                                                                   AUS015
     C**    CHECK FX/MM FIELD, ENTRY MUST BE 'FX','MM' OR BLANKS.         AUS015
     C*                                                                   AUS015
     C           SDEAL     IFNE '  '                                      AUS015
     C           SDEAL     IFNE 'FX'                                      AUS015
     C           SDEAL     ANDNE'MM'                                      AUS015
     C                     MOVE ERR,16    MSG                             AUS015
     C                     MOVE '0'       *IN43                           AUS015
     C                     MOVE '1'       *IN69                           AUS015
     C                     END                                            AUS015
     C                     END                                            AUS015
     C*
     C*    DISPLAY LIVE OR MATURED RECORDS, OR BOTH.
     C*    ENTRIES MUST BE ' ' OR 'Y' (CANNOT BOTH BE ' ')
     C           LIVD      COMP ' '                      17
     C*
     C           MATD      COMP ' '                      27
     C*
     C           *IN17     IFEQ '1'
     C           *IN27     IFEQ '1'
     C                     MOVE ERR,5     MSG
     C                     MOVE '0'       *IN43
0483 C                     GOTO SETIND
     C                     END
     C                     END
     C*
     C           *IN17     IFNE '1'
     C           LIVD      COMP 'Y'                      28
     C           *IN28     IFNE '1'
     C                     MOVE ERR,6     MSG
     C                     MOVE '0'       *IN43
     C                     END
     C                     END
     C*
     C           *IN27     IFNE '1'
     C           MATD      COMP 'Y'                      29
     C           *IN29     IFNE '1'
     C                     MOVE ERR,6     MSG
     C                     MOVE '0'       *IN43
     C                     END
     C                     END
     C           *IN28     IFEQ '1'
     C           *IN29     ANDEQ'1'
     C                     MOVE '1'       *IN31
     C                     END
0487 C           SETIND    TAG                             **SETIND TAG **
     C*
     C*     SET ERROR INDICATOR FOR 'LIVE' AND 'MATURED' FIELDS
     C*     ON THE DISPLAY FILE
     C   17 27
     CORN17N28             SETON                     60
     C   17 27
     CORN27N29             SETON                     61
     C*
     C*     IF ERROR BRANCH TO END
     C  N43                GOTO ENDVAL
     C/COPY WNCPYSRC,DLH00160
     C*
     C**
     C*     ACCESS DEALS FOR THIS CUSTOMER
     C**
     C                     MOVELCNUM      CUSKEY  6
     C*                                                                   S01136
     C                     MOVELCNUM      CKEY    9                       LN0467
     C                     MOVE SBRCAX    CKEY                            LN0467
     C*                                                                   LN0467
     C** RESET THE POINTER IN THE DEALS FILE.                             S01136
     C*                                                                   S01314
     C/COPY WNCPYSRC,DL0121C039
     C           SBRCAX    IFEQ 'ALL'                      B2             LN0467
     C           @MBIN     OREQ 'N'                        B2             LN0467
      *                                                                   S01311
      *  If it is an Exposure Management Enquiry, read either the         S01332
      *  FX, MM, FRA or IRS File                                          S01332
      *                                                                   S01311
     C           FXMM      IFEQ 'FX'                                      S01311
     C           CNUM      SETLLEMCUSFX2                 48               S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C           CNUM      SETLLEMCUSMM2                 48               S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP5                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'FR'                                      S01332
     C           CNUM      SETLLEMCUSFR2                 48               S01332
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C           CNUM      SETLLEMCUSIR2                 48               S01332
     C                     ELSE                                           S01311
     C********** CNUM      SETLLCACUSDL2                 48*2                          LN0467 249976
     C           CNUM      SETLLCACUSDL4                 48                                   249976
     C                     END                                            S01311
     C                     END                                            S01311
     C                     END                                            S01332
     C                     END                                            S01332
     C/COPY WNCPYSRC,DL0121C040
      *                                                                   S01311
     C                     ELSE                            X2             LN0467
     C           FXMM      IFEQ 'FX'                                      S01311
     C           @CRKY     SETLLEMCUSFX3                 48               S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C           @CRKY     SETLLEMCUSMM3                 48               S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP6                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'FR'                                      S01332
     C           @CRKY     SETLLEMCUSFR3                 48               S01332
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C           @CRKY     SETLLEMCUSIR3                 48               S01332
     C                     ELSE                                           S01311
     C********** @CRKY     SETLLCACUSDL3                 48*1                          LN0467 249976
     C           @CRKY     SETLLCACUSDL5                 48*1                                 249976
     C                     END                                            S01311
     C                     END                                            S01311
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                             E1             S01136
     C/COPY WNCPYSRC,DL0121C041
     C**
     C*     IF NO DEALS, DISPLAY MESSAGE
     C**
     C           *IN48     IFEQ '0'
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP7                                           S01408
     C*                                                                   S01408
     C           FXMM      IFEQ 'FX'                                      S01311
     C                     MOVE ERR,12    MSG                             S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C                     MOVE ERR,13    MSG                             S01311
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'FR'                                      S01332
     C                     MOVE ERR,14    MSG                             S01332
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C                     MOVE ERR,15    MSG                             S01332
     C                     ELSE                                           S01311
     C                     MOVE ERR,4     MSG
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP8                                           S01408
     C*                                                                   S01408
     C                     MOVE '0'       *IN43
     C                     END
     C*
0487 C           ENDVAL    ENDSR                           **ENDVAL TAG **
     C********************************************************************
     C/SPACE 3
     C********************************************************************
     C**
     C**    LOAD SR. TO FILL PAGE OF SUBFILE
     C**
     C           LOAD      BEGSR                           **  LOAD SR  **
     C*
     C                     Z-ADD0         RCDNBR
     C**
     C**    CLEAR SUBFILE
     C                     SETOF                         20
      *                                                                   S01311
      *   Write Header if called from Exposure Management Enquiry         S01311
      *                                                                   S01311
     C           *IN80     IFEQ '1'                                       S01311
     C                     WRITEDL0121F1                                  S01311
     C                     END                                            S01311
      *                                                                   S01311
     C                     WRITEDL0121F3
     C                     WRITEDL0121F4                                  E22855
     C           FILL      TAG                             **FILL TAG**
     C                     MOVE '0'       *IN52
     C*
     C**                   ADD  6         PAGE    30                      S01119
     C                     Z-ADD0         LINES                           S01119
     C*                                                                   S01119
     C*     SUBFILE PAGE NOW 12 VARIABLE FORMAT LINES                     S01119
     C*                                                                   S01119
     C           LINES     DOWLT12                                        S01119
     C**
     C**    READ DEALS FOR THIS CUSTOMER
     C                     MOVE '0'       *IN42
     C           READT     TAG                             **READTTAG**
     C                     MOVEA'0000'    *IN,04
     C                     MOVE '0'       *IN11                           S01119
     C                     MOVE '0'       *IN39                                               260855
     C*                                                                   S01136
     C** ACCESS APPROPRIATE FILES                                         S01136
     C                     EXSR #BBA                                      S01136
     C*
     C           *IN41     IFEQ '0'
     C*                                                                   AUS015
     C** CHECK IF READ RECORD IS CORRECT WITH RESPECT TO FX/MM FIELD.     AUS015
     C*                                                                   AUS015
     C           SDEAL     IFEQ 'FX'                                      AUS015
     C           DLREC     ANDNE'B'                                       AUS015
     C           FHRCID    ANDNE'FH'                                                          260329
     C                     GOTO READT                                     AUS015
     C                     END                                            AUS015
     C*                                                                   AUS015
     C           SDEAL     IFEQ 'MM'                                      AUS015
     C*                                                                   AUS015
     C           DLREC     IFNE 'C'                                       AUS015
     C           DLREC     ANDNE'D'                                       AUS015
     C           DLREC     ANDNE'E'                                       AUS015
     C           HKRCID    ANDNE'HK'                                                          249976
     C           HLRCID    ANDNE'HL'                                                          249976
     C           HMRCID    ANDNE'HM'                                                          249976
     C********** FHRCID    ANDNE'FH'                                                   249976 260329
     C                     GOTO READT                                     AUS015
     C                     END                                            AUS015
     C*                                                                   AUS015
     C                     END                                            AUS015
     C**
     C**    IF LIVE AND MATURED RECORDS SELECTED
     C           *IN31     CABEQ'1'       RECVAL
     C**
     C**    ONLY LIVE SELECTED
     C           *IN28     IFEQ '1'
     C           RECIC     IFEQ 'M'
     C           RECIC     OREQ 'N'
     C           RECIC     OREQ 'R'                                       155954
     C           LCD       ANDLTBJRDNB                                    155954
     C           DLREC     OREQ 'D'                                                           249976
     C           FHLCD     ANDLTBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HKLCD     ANDLTBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HLLCD     ANDLTBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HMLCD     ANDLTBJRDNB                                                        249976
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP1                                           S01408
     C*                                                                   S01408
     C                     GOTO READT
     C                     END
     C                     END
     C**
     C**    ONLY MATURED SELECTED
     C           *IN29     IFEQ '1'
     C           RECIC     IFEQ 'D'
     C           RECIC     OREQ 'R'
     C           DLREC     ANDNE'D'                                                           249976
     C********** LCD       ANDGEBJRDNB                                                 155954 249976
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP2                                           S01408
     C*                                                                   S01408
     C           RECIC     OREQ 'E'
     C           DLREC     ANDNE'D'                                                           249976
     C*                                                                   S01136
     C** EXCLUDE DRS DEAL TYPES A,I,C                                     S01136
     C           RECIC     OREQ 'A'                                       S01136
     C           DLREC     ANDNE'D'                                                           249976
     C           RECIC     OREQ 'I'                                       S01136
     C           DLREC     ANDNE'D'                                                           249976
     C           RECIC     OREQ 'C'                                       S01136
     C           DLREC     ANDNE'D'                                                           249976
     C           DLREC     OREQ 'D'                                       S01136
     C           FHLCD     ANDEQBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HKLCD     ANDEQBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HLLCD     ANDEQBJRDNB                                                        249976
     C           DLREC     OREQ 'D'                                                           249976
     C           HMLCD     ANDEQBJRDNB                                                        249976
     C*                                                                   S01136
     C                     GOTO READT
     C                     END
     C                     END
      *                                                                   S01332
      * If Caps, Collars and Floors included in Option Deals exclude      S01332
      * them from IRS Deals if program called via Exposure Management     S01332
      *                                                                   S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           BUCCSO    ANDEQ'O'                                       S01332
     C           DTYP      IFEQ 'RF'                                      S01332
     C           DTYP      OREQ 'RR'                                      S01332
     C           DTYP      OREQ 'RP'                                      S01332
     C                     GOTO READT                                     S01332
     C                     END                                            S01332
     C                     END                                            S01332
      *                                                                   S01332
      * If Options selected only display Caps, Collars and Floors if      S01332
      * program called via Exposure Management                            S01332
      *                                                                   S01332
     C           FXMM      IFEQ 'CC'                                      S01332
     C           DTYP      IFEQ 'RS'                                      S01332
     C           DTYP      OREQ 'RX'                                      S01332
     C                     GOTO READT                                     S01332
     C                     END                                            S01332
     C                     END                                            S01332
      *                                                                   S01332
     C                     ELSE
     C*     IF NO RECORDS DISPLAY MESSAGE
     C           RCDNBR    IFEQ 0000                                      E13029
     C           FXMM      IFEQ 'FX'                                      S01311
     C                     MOVE ERR,12    MSG                             S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C                     MOVE ERR,13    MSG                             S01311
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'FR'                                      S01332
     C                     MOVE ERR,14    MSG                             S01332
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C                     MOVE ERR,15    MSG                             S01332
     C                     ELSE                                           S01311
     C                     MOVE ERR,4     MSG
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C                     MOVE '0'       *IN43
     C                     MOVE '1'       *IN52
     C                     END
     C                     MOVE '0'       *IN18
     C                     GOTO ENDLD
     C*
     C                     END
     C           RECVAL    TAG                             **RECVAL TAG**
     C*
     C           RECIC     IFEQ 'M'
     C           RECIC     OREQ 'N'
     C                     MOVE '1'       *IN42
     C                     END
     C*
     C*     FRA/IRS DEALS                                                 S01119
     C*                                                                   S01119
     C           *IN11     IFEQ '1'                                       S01119
     C**                                                                  S01119
     C*     RESET INDICATOR CONTROLLING OUTPUT OF HEADING                 S01119
     C                     SETOF                     65                   S01119
     C**                                                                  S01119
     C*                                                                   S01119
     C                     SETOF                     392445               S01119
     C                     SETOF                     474953               S01119
     C                     SETOF                     66                   S01119
     C**                                                                  S01119
     C*     For FRA/IRS deals suppress the spread rate, if base rate      S01119
     C*     type GT zero and spread ind blank.                            S01119
     C                     MOVE '0'       *IN37                           S01119
     C                     MOVE '0'       *IN19                           S01119
     C**                                                                  S01119
     C**                                                                  S01119
     C           UBRTT     IFGT 0                                         S01119
     C           USPIN     ANDEQ' '                                       S01119
     C                     MOVE '1'       *IN37                           S01119
     C                     END                                            S01119
     C**                                                                  S01119
     C           TBRTT     IFGT 0                                         S01119
     C           TSPIN     ANDEQ' '                                       S01119
     C                     MOVE '1'       *IN19                           S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C** IF DEAL TYPE IS AN FRA OR RR,RP,RF THEN SET ON BUY/SELL          S01157
     C** CONDITIONING IND.                                                S01157
     C*                                                                   S01157
     C                     MOVE '0'       *IN32                           S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                                      S01157
     C           DTYP      OREQ 'RR'                                      S01157
     C           DTYP      OREQ 'RP'                                      S01157
     C           DTYP      OREQ 'RF'                                      S01157
     C                     MOVE '1'       *IN32                           S01157
     C                     END                                            S01157
     C**                                                                  S01119
     C*     IF READ SUCCESSFUL, DETERMINE DEAL TYPE,  ADD APPROPRIATE     S01119
     C*     AMOUNT TO LINES, LINE COUNTER                                 S01119
     C**                                                                  S01119
     C*     IF THE DEAL TYP IS RX, ADD 4 TO LINES                         S01119
     C**                                                                  S01119
     C           DTYP      IFEQ 'RX'                                      S01119
     C                     SETON                     39                   S01119
     C                     ADD  4         LINES   20                      S01119
     C                     ELSE                                           S01119
     C**                                                           S01119 S01157
     C* IF THE DEAL TYPE IS A CAP, COLLAR OR FLOOR (RP,RR OR RF) THEN     S01157
     C* TEST FOR OUR OR THEIR DEAL. IF A CAP OR FLOOR ADD 3 TO THE        S01157
     C* NUMBER OF LINES PRINTED ELSE (COLLAR) ADD 4 TO THE LINES          S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'RR'                                      S01157
     C           DTYP      OREQ 'RP'                                      S01157
     C           DTYP      OREQ 'RF'                                      S01157
     C*                                                                   S01157
     C           UBRTT     IFNE 0                                         S01157
     C                     SETON                     49                   S01157
     C                     ELSE                                           S01157
     C                     SETON                     53                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'RP'                                      S01157
     C           DTYP      OREQ 'RF'                                      S01157
     C                     SETON                     24                   S01157
     C                     ADD  3         LINES                           S01157
     C                     ELSE                                           S01157
     C                     SETON                     45                   S01157
     C                     ADD  4         LINES                           S01157
     C                     END                                            S01157
     C**                                                                  S01157
     C                     ELSE                                           S01119
     C**                                                                  S01119
     C*  DEAL TYPE RS TAKES UP 3 LINES / DEAL TYPE FR TAKES UP 2 LINES    S01157
     C**                                                                  S01119
     C/COPY WNCPYSRC,DL0121C026
     C           DTYP      IFEQ 'FR'                                      S01119
     C           DTYP      OREQ 'RS'                                      S01119
     C                     SETON                     47                   S01119
     C*                                                                   S01157
     C           DTYP      IFEQ 'RS'                                      S01157
     C                     ADD  3         LINES                           S01119
     C                     ELSE                                           S01157
     C                     ADD  2         LINES                           S01157
     C                     END                                            S01157
     C**                                                                  S01119
     C*    ALL OTHER TYPES OF DEALS TAKE UP 2 LINES                       S01119
     C**                                                                  S01119
     C                     ELSE                                           S01119
     C                     SETON                     66                   S01119
      *                                                                   CGL011
      ** If CGL011 is installed and Collateral Flag is 'Y' add one        CGL011
      ** more line; otherwise retain current processing of 2 lines.       CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           COLF      ANDEQ'Y'                                       CGL011
     C                     ADD  3         LINES                           CGL011
     C                     ELSE                                           CGL011
     C                     ADD  2         LINES                           S01119
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     END                                            S01119
     C                     END                                            S01119
     C/COPY WNCPYSRC,DL0121C027
     C                     END                                            S01119
     C*                                                                   S01119
     C*    IF DEALS OCCUPY LESS THAN 12 LINES FILL SUBFILE PAGE           S01119
     C*                                                                   S01119
     C           LINES     IFGT 12                                        S01119
     C                     MOVE '1'       *IN71                           S01136
     C*                                                                   S01136
     C** ACCESS APPROPRIATE FILES                                         S01136
     C                     EXSR #BBA                                      S01136
     C                     MOVE '0'       *IN71                           S01136
     C*                                                                   S01119
     C                     MOVE *BLANK    SFLINE                          S01119
     C*                                                                   S01119
     C                     Z-ADD0         CNT     10                      S01119
     C           12        SUB  SAVLIN    PAGFIL  30                      S01119
     C           CNT       DOWLTPAGFIL                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     ADD  1         CNT                             S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     ELSE                                           S01119
     C*                                                                   S01119
     C*    LINE01 COMMON TO ALL DEAL TYPES                                S01119
     C*                                                                   S01119
     C                     MOVE '1'       *IN20             NOT SFLCLR    S01119
     C*                                                                   S01119
     C                     MOVE '0'       *IN70             ENABLE LEOPSF S01119
     C                     EXSR LINE01                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                 30               S01119
     C/COPY WNCPYSRC,DL0121C028
     C*                                                                   S01119
     C*    LINE02 COMMON TO ALL NON-FRA/IRS DEALS                         S01119
     C*                                                                   S01119
     C           *IN11     IFEQ '0'                                       S01119
     C                     MOVE '1'       *IN70             DISABLE LEOPSFS01119
     C                     EXSR LINE02                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                 30               S01119
      *                                                                   CGL011
      ** If CGL011 is installed and Collateral Flag is 'Y', display       CGL011
      ** 'COLLATERAL' text field on the third subfile line.               CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C           COLF      ANDEQ'Y'                                       CGL011
     C                     ADD  1         RCDNBR                          CGL011
     C                     MOVE *BLANKS   SFLINE                          CGL011
     C                     MOVELCOLLA     SFLINE                          CGL011
     C                     WRITEDL0121F2                                  CGL011
     C                     MOVE *BLANKS   SFLINE                          CGL011
     C                     MOVE *BLANK    COLF                            CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C                     ELSE                                           S01119
     C*                                                                   S01119
     C                     MOVE '1'       *IN70             DISABLE LEOPSFS01119
     C*                                                                   S01119
     C*    LINE02 FOR 'FR' AND 'RS' DEALS                                 S01157
     C*                                                                   S01119
     C           DTYP      IFEQ 'FR'                                      S01119
     C           DTYP      OREQ 'RS'                                      S01119
     C                     EXSR LINE02                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     END                                            S01157
     C*                                                                   S01119
     C*    LINE03 FOR 'RS' DEALS                                          S01119
     C*                                                                   S01119
     C           DTYP      IFEQ 'RS'                                      S01157
     C                     EXSR LINE03                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C*    LINE02, LINE04 AND LINE03 FOR 'RX' DEALS                       S01119
     C*                                                                   S01119
     C           DTYP      IFEQ 'RX'                                      S01119
     C                     EXSR LINE02                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     EXSR LINE04                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     EXSR LINE03                                    S01119
     C                     ADD  1         RCDNBR                          S01119
     C                     WRITEDL0121F2                                  S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C*                                                                   S01157
     C**LINE05, LINE03 AND LINE06 FOR DEAL TYPE COLLAR 'RR'               S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'RR'                                      S01157
     C                     EXSR LINE05                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     EXSR LINE03                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     EXSR LINE06                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C**LINE05 AND LINE03 FOR DEAL TYPE CAP 'RP'                          S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'RP'                                      S01157
     C                     EXSR LINE05                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     EXSR LINE03                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C**LINE06 AND LINE03 FOR DEAL TYPE FLOOR 'RF'                        S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'RF'                                      S01157
     C                     EXSR LINE06                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     EXSR LINE03                                    S01157
     C                     ADD  1         RCDNBR                          S01157
     C                     WRITEDL0121F2                                  S01157
     C                     END                                            S01157
     C*                                                                   S01119
     C                     END                                            S01119
     C/COPY WNCPYSRC,DL0121C029
     C*                                                                   S01119
     C*    SAVE LINES FOR PAGE FILLING IN NEXT PASS                       S01119
     C*                                                                   S01119
     C                     MOVE LINES     SAVLIN  20                      S01119
     C*                                                                   S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C*     SAVE SUBFILE RCDNBR FOR SUBSEQUENT ROLL UP PAST SUBFILE END   S01119
     C*                                                                   S01119
     C                     MOVE RCDNBR    SAVRCN  40                      E13029
     C                     END                                            S01119
     C           CHECK     TAG                             **CHECKTAG**   S01119
     C*                    EXSR LINE01                                    S01119
     C*                    EXSR LINE02                                    S01119
     C*                                                                   S01119
     C******RESET RCDNBR TO PAGE                                          S01119
     C*                    Z-ADDKOUNT     RCDNBR                          S01119
     C*                                                                   S01119
     C******INCREMENT RECORD NUMBER                                       S01119
     C*                    MOVE '1'       *IN20                           S01119
     C*                    ADD  1         RCDNBR                          S01119
     C*                    ADD  1         KOUNT                           S01119
     C*                    WRITEDL0121F2                 30               S01119
     C*                                                                   S01119
     C*                    MOVE *BLANKS   TEXT                            S01119
     C*                                                                   S01119
     C*                    END                                            S01119
     C*          CHECK     TAG                             **CHECKTAG**   S01119
     C*
     C**    WHEN SUBFILE PAGE FULL READ TO SEE IF THERE IS NEXT RECORD
     C**    TO CONDITION SFLEND
     C**
     C*                                                                   S01136
     C** ACCESS APPROPRIATE FILES                                         S01136
     C                     EXSR #BBA                                      S01136
     C*                                                                   AUS015
     C** CHECK IF READ RECORD IS CORRECT WITH RESPECT TO FX/MM FIELD.     AUS015
     C*                                                                   AUS015
     C           SDEAL     IFEQ 'FX'                                      AUS015
     C           DLREC     ANDNE'B'                                       AUS015
     C           FHRCID    ANDNE'FH'                                                          260329
     C                     GOTO READT                                     AUS015
     C                     END                                            AUS015
     C*                                                                   AUS015
     C           SDEAL     IFEQ 'MM'                                      AUS015
     C*                                                                   AUS015
     C           DLREC     IFNE 'C'                                       AUS015
     C           DLREC     ANDNE'D'                                       AUS015
     C           DLREC     ANDNE'E'                                       AUS015
     C           HKRCID    ANDNE'HK'                                                          260329
     C           HLRCID    ANDNE'HL'                                                          260329
     C           HMRCID    ANDNE'HM'                                                          260329
     C                     GOTO READT                                     AUS015
     C                     END                                            AUS015
     C*                                                                   AUS015
     C                     END                                            AUS015
     C**
     C**    IF LIVE AND MATURED RECORDS SELECTED
     C           *IN31     CABEQ'1'       RECCHK
     C**
     C**    ONLY LIVE SELECTED
     C           *IN28     IFEQ '1'
     C           RECIC     IFEQ 'M'
     C           RECIC     OREQ 'N'
     C           *IN41     CABEQ'0'       CHECK
     C                     END
     C                     END
     C**
     C**    ONLY MATURED SELECTED
     C           *IN29     IFEQ '1'
     C           RECIC     IFEQ 'D'
     C           RECIC     OREQ 'R'
     C           RECIC     OREQ 'E'
     C*                                                                   S01136
     C** EXCLUDE DRS DEAL TYPES A,I,C                                     S01136
     C           RECIC     OREQ 'A'                                       S01136
     C           RECIC     OREQ 'I'                                       S01136
     C           RECIC     OREQ 'C'                                       S01136
     C           DLREC     OREQ 'D'                                       S01136
     C           *IN41     CABEQ'0'       CHECK
     C                     END
     C                     END
     C*
     C           RECCHK    TAG                             *RECCHK TAG*
     C*
     C           *IN41     IFEQ '1'
     C                     MOVE '0'       *IN18
     C                     ELSE
     C**
     C**    IF THERE IS A NEXT RECORD BACK IT OUT
     C**
     C                     MOVE '1'       *IN18
     C                     MOVE '1'       *IN71                           S01136
     C*                                                                   S01136
     C** ACCESS APPROPRIATE FILES                                         S01136
     C                     EXSR #BBA                                      S01136
     C                     MOVE '0'       *IN71                           S01136
     C                     END
     C           ENDLD     TAG                             **ENDLDTAG**
     C*
     C                     MOVE '0'       *IN42
     C*
     C                     MOVE '1'       *IN21
     C**
     C**    WRITE DL0121F1 FOR ERROR MESSAGES
     C                     WRITEDL0121F1
     C*
     C*                                                                   E22855
     C                     EXFMTDL0121F3               44           E22855S01311
     C*                                                                   E22855
     C**
     C**    CMD/9 PRINT DETAILS FOR THIS CUSTOMER                         S01203
     C           *INKI     IFEQ '1'                                       S01203
     C                     EXSR PRINTD
     C                     END
     C           *IN43     IFEQ '0'
     C           *IN62     ANDEQ'0'
     C                     GOTO FINLD
     C                     END
     C           *INKC     IFEQ '0'                                       S01203
     C           *INKA     ANDEQ'0'                                       S01311
     C           *INKL     ANDEQ'0'                                       S01311
     C           *INKI     ANDEQ'0'                                       S01311
      *                                                                                       214207
      ** Skip process if roll up was requested by the user.                                   214207
     C           *IN41     IFEQ *ON                                                           214207
     C           *IN18     OREQ *OFF                                                          214207
     C*
     C           SFLRD     TAG                             *SFLRD TAG**
     C*
     C                     MOVE '0'       *IN64
     C*
     C**    LOWER LINK ENQUIRY REQUESTED TO DEALS FILE ENQUIRY,
     C**    MORE THAN ONE ENTRY MAY BE MADE IN THE SELECTION FIELDS,
     C**    VALIDATION WILL BE CARRIED OUT ONE AT A TIME,
     C**
     C                     READCDL0121F2                 44
     C                     MOVE ZDLNO     DLNO                            S01119
     C           *IN44     IFEQ '1'
     C                     MOVE '0'       *IN63
     C                     END
     C**                                                                  E15119
     C** ALLOW FOR POSSIBLE 'SPACE-BAR' USE ON A SUBFILE RECORD......     E15119
     C** THIS APPEARS TO THE READC AS A CHANGED REC,BUT LEOPSF IS BLANK   E15119
     C** SO IGNORE THAT RECORD, AND PERFORM ANOTHER READC OPERATION.      E15119
     C**                                                                  E15119
     C           *IN44     IFEQ '0'                                       E15119
     C           LEOPSF    ANDEQ' '                                       E15119
     C                     GOTO SFLRD                                     E15119
     C                     END                                            E15119
     C**                                                                  E15119
     C           LEOPSF    IFNE ' '
     C                     MOVE '0'       *IN62
     C                     EXSR DTRQSS
     C*
     C                     MOVE '1'       *IN20
     C*
     C                     EXSR TEXSET
     C**
     C**    MOVE BLANK INTO SELECTION FIELD AND SETOF SFLNXTCHG IND.
     C           *IN43     IFEQ '1'
     C                     MOVE ' '       LEOPSF
     C           *IN63     IFEQ '1'
     C                     MOVE '1'       *IN64
     C                     END
     C                     MOVE '0'       *IN63
     C                     END
     C                     MOVE '0'       *IN70             ENABLE LEOPSF S01119
     C                     UPDATDL0121F2
     C           *IN41     IFEQ '0'
     C                     MOVE '1'       *IN18
     C                     END
     C*
     C           *IN64     IFEQ '1'
     C                     READCDL0121F2                 44
     C                     MOVE ZDLNO     DLNO                            S01119
     C           *IN44     IFEQ '0'
     C                     MOVE '1'       *IN63
     C                     EXSR TEXSET
     C                     MOVE '0'       *IN70             ENABLE LEOPSF S01119
     C                     UPDATDL0121F2
     C                     END
     C                     END
     C                     GOTO ENDLD
     C                     END
     C           *IN63     IFEQ '1'
     C**
     C**    SELECTION FIELD BLANKED OUT AFTER ERROR - RESET DSPATR(RI)
     C           LEOPSF    IFEQ ' '
     C           DLNO      IFEQ SDLNO
     C                     MOVE '0'       *IN62
     C*
     C                     EXSR TEXSET
     C                     MOVE '0'       *IN70             ENABLE LEOPSF S01119
     C                     UPDATDL0121F2
     C                     END
     C                     GOTO SFLRD
     C                     END
     C                     MOVE '0'       *IN70             ENABLE LEOPSF S01119
     C                     UPDATDL0121F2
     C                     GOTO SFLRD
     C                     END
      *                                                                                       214207
     C                     ENDIF                                                              214207
     C**
     C**    ROLLUP REQUESTED, ERROR IF COMPLETE
     C**
     C           *IN18     IFEQ '1'
     C           *IN41     IFEQ '0'
     C*
     C*     RESET RCDNBR IF ROLL UP PAST EXISTING SUBFILE END             S01119
     C*                                                                   S01119
     C                     MOVE SAVRCN    RCDNBR                          S01119
     C                     GOTO FILL
     C                     ELSE
     C                     MOVE '0'       *IN18                           S01136
     C                     GOTO ENDLD
     C                     END
     C                     END
     C                     END
     C*
     C           FINLD     ENDSR
     C********************************************************************
     C/SPACE 3
     C**
     C********************************************************************
     C**
     C**    LINE01 SR TO FORMAT DETAILS OF DEAL FOR SUBFILE LINE 1
     C**
     C**    CALLED FROM    LOAD
     C**    CALLS          ZDATE2, ZEDIT                                  S01194
     C**
     C           LINE01    BEGSR                           *** DETAIL ***
     C**
0563 C**
     C                     MOVE *BLANKS   LEOPSF
      *                                                                                       249976
      ** Process line 1 for complete FX deals                                                 249976
      *                                                                                       249976
     C           @INDS     IFEQ 'FXDEALP4'                                                    249976
     C           @INDS     OREQ 'FXDEALP5'                                                    249976
     C           @INDS     OREQ 'FXDEALP0'                                                   249976A
     C           @INDS     OREQ 'FXDEALP1'                                                   249976A
      *                                                                                       249976
     C                     EXSR #B                                                            249976
     C                     GOTO ENDFMT                                                        249976
      *                                                                                       249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 1 complete money market deals                                           249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDELDP4'                                                    249976
     C           @INDS     OREQ 'MMDELDP5'                                                    249976
     C           @INDS     OREQ 'MMDELDP0'                                                    249976
     C           @INDS     OREQ 'MMDELDP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #C                                                            249976
     C                     GOTO ENDFMT                                                        249976
      *                                                                                       249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 1 complete negotiable asset bought                                      249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDENBP4'                                                    249976
     C           @INDS     OREQ 'MMDENBP5'                                                    249976
     C           @INDS     OREQ 'MMDENBP0'                                                    249976
     C           @INDS     OREQ 'MMDENBP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #D                                                            249976
     C                     GOTO ENDFMT                                                        249976
      *                                                                                       249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 1 complete negotiable asset sold                                        249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDENSP4'                                                    249976
     C           @INDS     OREQ 'MMDENSP5'                                                    249976
     C           @INDS     OREQ 'MMDENSP0'                                                    249976
     C           @INDS     OREQ 'MMDENSP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #E                                                            249976
     C                     GOTO ENDFMT                                                        249976
      *                                                                                       249976
     C                     END                                                                249976
     C*                                                                   S01136
     C** FORMAT DRS DEALS ACCORDING TO FORMAT READ                        S01136
     C*                                                                   S01136
     C**   DEAL TYPE TEXT
     C                     MOVE *BLANKS   DTYPW                           S01157
     C                     MOVELDTYP      DTYPW                                               CDL038
     C**********           MOVE *BLANKS   STWK2   3                                    S01157 CDL038
     C**********           MOVELDTYP      STWK2                                        S01157 CDL038
     C**********           MOVE '-'       STWK2                                        S01157 CDL038
     C                     MOVE *BLANKS   STWK    3
     C                     MOVEL'-'       STWK                                                CDL038
     C                     MOVE DLST      STWK                                                CDL038
     C**********           MOVELDLST      STWK                                         S01157 CDL038
     C***32*****           MOVE BYSL      STWK                                         S01157 CDL038
     C**********           MOVELSTWK2     DTYPW                                        S01157 CDL038
     C                     MOVE STWK      DTYPW                           S01157
     C                     MOVE CLAS      CLASW                                               CDL038
     C   32                MOVE BYSL      BYSLW                                               CDL038
     C  N32                MOVE ' '       BYSLW                                               CDL038
0564 C**   FX - CHECK FOR OPTION.
0565 C           DTYP      COMP 'OP'                     34
0564 C**   FX - CHECK FOR NOSTRO TRANSFER
0565 C           DTYP      COMP 'NX'                     35
0566 C**   GET DEAL AMOUNT.
0567 C   04                Z-ADDPUAM      AMT1   130
0568 C   05                Z-ADDPCPL      AMT1
0569 C   06                Z-ADDFVAL      AMT1
0570 C   07                Z-ADDSAPR      AMT1
0570 C   11                Z-ADDUPAMT     AMT1                            S01119
     C                     MOVE '1'       *IN54
0571 C*****IS DEAL REVERSED                                               S01119
0572 C*          RECIC     IFEQ 'R'                                       S01119
     C*                    MOVE 'REVERSED'TEXT                            S01119
     C*                    MOVE '0'       *IN54                           S01119
     C*                    END                                            S01119
     C*****OR MATURED                                                     S01119
     C*          *IN42     IFEQ '1'                                       S01119
     C*                    MOVEL'MATURED' TEXT    8                       S01119
     C*                    MOVE '0'       *IN54                           S01119
     C*                    END                                            S01119
0573 C* IS DEAL FEDERAL FUND
0574 C                     SETOF                     5658
0575 C                     SETON                     5557
0576 C* N04      CCY       COMP USCY                     56               S01119
0576 C  N04N11   CCY       COMP BLUSCY                   56         S01194BHF486
0577 C   04      PUCY      COMP BLUSCY                   56         S01194BHF486
0577 C   11      UCUCY     COMP BLUSCY                   56         S01194BHF486
0578 C   04N56   SLCY      COMP BLUSCY                   58         S01194BHF486
0578 C  N56 11   TCUCY     COMP BLUSCY                   58               S01194
0579 C   56N11             TESTB'2'       DSTI       55                   S01119
0579 C   56 11             TESTB'2'       UDSTI      55                   S01119
0580 C*  58                TESTB'3'       DSTI       57                   S01119
0580 C   58N11             TESTB'3'       DSTI       57                   S01119
0580 C   58 11             TESTB'2'       TDSTI      57                   S01119
0581 C*    FOR C1 DO NOT SHOW YIELD
0582 C           DTYP      COMP 'C1'                     46
0583 C   46                Z-ADD0         YRAT
0584 C**
0585 C**   GET NO. OF DECIMAL PLACES.
0586 C* N04                GOTO CCY1                                      S01119
0587 C*                    MOVE SLCY      XXCCY                           S01119
0586 C  N04N39             GOTO CCY1                                      S01119
0587 C  N39                MOVE SLCY      XXCCY                           S01119
     C   39                MOVE TCUCY     XXCCY                           S01119
     C                     EXSR #L                                        S01194
0595 C*
     C**   SAVE SALE CCY DECIMAL PLACES.                                  E10784
     C                     MOVELA6NBDP    SCCDP   10                      S01194
     C*                                                                   E10784
0596 C           CCY1      TAG                             ** CCY1 **
0597 C   04                MOVE PUCY      XXCCY
0598 C* N04                MOVE CCY       XXCCY                           S01119
0598 C  N04N11             MOVE CCY       XXCCY                           S01119
     C   11                MOVE UCUCY     XXCCY                           S01119
     C                     EXSR #L                                        S01194
0584 C**
0585 C**  EDIT AMOUNT
0587 C                     Z-ADDAMT1      ZAMNT
0587 C                     MOVE 'Y'       ZCOMMA
0587 C                     MOVE 'N'       ZMINUS
     C                     MOVELA6NBDP    ZCDP                            S01194
0602 C                     EXSR ZEDIT
0603 C                     MOVE ZAMNTA    AMT1W  17
0600 C**   FORMAT DATES.
0601 C                     Z-ADDDDAT      ZDAYNO           DEAL DATE
0602 C                     EXSR ZDATE2
0603 C                     MOVE ZADATE    DDATE   7
0604 C*
0605 C                     Z-ADDVDAT      ZDAYNO           VALUE DATE
0606 C                     EXSR ZDATE2
0607 C                     MOVE ZADATE    VDATE   7
0608 C*
0609 C   07
0610 COR 23                GOTO NARDET
0611 C                     Z-ADDMDAT      ZDAYNO           MATURITY OR
0612 C   04                Z-ADDOTDT      ZDAYNO
0613 C                     EXSR ZDATE2                     OPTION TO DATE
0614 C                     MOVE ZADATE    MDATE   7
     C*
     C           NARDET    TAG                             **NARDET TAGSR*
0615 C**
0615 C**  DETERMINE NARR1 FIELD
0614 C                     MOVEL*BLANKS   NARR1
0614 C   04N35             MOVEL'PURCHASE'NARR1
0610 C   05      MDAT      IFNE 0
0614 C                     MOVELMDATE     NARR1
0610 C                     ELSE
0614 C                     MOVELNOTD      NARR1
0610 C                     END
0614 C   06                MOVELMDATE     NARR1
0614 C   11                MOVELMDATE     NARR1                           S01119
0615 C**
0615 C**  DETERMINE CCY   FIELD
0614 C   04                MOVELPUCY      CCY
0614 C   11                MOVELUCUCY     CCY                             S01119
0615 C**
0615 C**  DETERMINE FFIN  FIELD
     C  N55                MOVE 'F'       FFIN
0615 C**
0615 C**  DETERMINE RDNO  FIELD
0614 C                     MOVEL*BLANKS   RDNO
0610 C   04      SODN      IFNE 0
0614 C                     MOVELSODN      RDNO
0610 C                     END
0610 C   05      RODN      IFNE 0
0614 C                     MOVELRODN      RDNO
0610 C                     END
0610 C   05      RBDN      IFNE 0
0614 C                     MOVELRBDN      RDNO
0610 C                     END
0610 C   06      ASDN      IFNE 0
0614 C                     MOVELASDN      RDNO
0610 C                     END
0610 C   07      RPDN      IFNE 0
0614 C                     MOVELRPDN      RDNO
0610 C                     END
0610 C   11      LNKDN     IFNE 0                                         S01119
0614 C                     MOVELLNKDN     RDNO                            S01119
0610 C                     END                                            S01119
0615 C*                                                                   S01119
     C           ENDFMT    TAG                             **ENDFMT TAGSR*S01136
     C*                                                                   S01184
     C**  If CONFIRMATION MATCHING present and deal is FX, MM or NA,      S01184
     C**  get Counterparty/Broker matching status (defaults to "NO        S01184
     C**  FEEDBACK YET".                                                  S01184
     C           @CNF      IFEQ 'Y'                                       S01184
     C                     MOVE *BLANKS   CPST    2                       S01184
     C                     MOVE *BLANKS   BKST    2                       S01184
     C           @INDS     IFEQ 'FXDEALP2'                                S01184
     C           @INDS     OREQ 'FXDEALP3'                                S01184
     C           @INDS     OREQ 'MMDELDP2'                                S01184
     C           @INDS     OREQ 'MMDELDP3'                                S01184
     C           @INDS     OREQ 'MMDENBP2'                                S01184
     C           @INDS     OREQ 'MMDENBP3'                                S01184
     C           @INDS     OREQ 'MMDENSP2'                                S01184
     C           @INDS     OREQ 'MMDENSP3'                                S01184
     C           @INDS     OREQ 'FXDEALP4'                                                    249976
     C           @INDS     OREQ 'FXDEALP5'                                                    249976
     C           @INDS     OREQ 'FXDEALP0'                                                    249976
     C           @INDS     OREQ 'MMDEALP0'                                                    249976
     C           @INDS     OREQ 'MMDELDP4'                                                    249976
     C           @INDS     OREQ 'MMDELDP5'                                                    249976
     C           @INDS     OREQ 'MMDENBP0'                                                    249976
     C           @INDS     OREQ 'MMDENBP4'                                                    249976
     C           @INDS     OREQ 'MMDENBP5'                                                    249976
     C           @INDS     OREQ 'MMDENSP0'                                                    249976
     C           @INDS     OREQ 'MMDENSP4'                                                    249976
     C           @INDS     OREQ 'MMDENSP5'                                                    249976
     C                     MOVE '00'      CPST                            S01184
     C                     MOVE '00'      BKST                            S01184
     C                     MOVE DLNO      @KY2                            S01184
     C           CFKY      SETGTCFFEEDL0                                  S01184
     C                     READPCFFEEDL0                 33               S01184
     C***********          MOVELIMRF      @TS2    7                S01184 060779
     C                     MOVELIMRF      @TS2    8                       060779
     C           *IN33     IFEQ '0'                                       S01184
     C           @TS1      ANDEQ@TS2                                      S01184
     C                     MOVELCPSX      CPST                            S01184
     C                     MOVELBKSX      BKST                            S01184
     C                     END                                            S01184
     C                     SETOF                     33                   S01184
     C*                                                                   S01184
     C**  Broker involved?                                                S01184
     C*                                                                   S01184
     C           BRKC      IFEQ 'PHON'                                    S01184
     C           BRKC      OREQ 'TELX'                                    S01184
     C           BRKC      OREQ 'MAIL'                                    S01184
     C           BRKC      OREQ 'SWAP'                                    S01184
     C                     MOVE *BLANKS   BKST                            S01184
     C                     END                                            S01184
     C*                                                                   S01184
     C                     END                                            S01184
     C                     END                                            S01184
     C/COPY WNCPYSRC,DL0121C015
     C*                                                                   S01184
     C                     MOVE ZLINE1    SFLINE                          S01119
     C                     MOVE *BLANKS   ZLINE1                          S01119
0615 C*
     C           ENDDET    ENDSR                           **ENDDET ENDSR*
     C**
     C**
     C********************************************************************
     C/SPACE 3
0721 C********************************************************************
     C**
     C**
0722 C*    LINE02 SR TO FORMAT DEAL DETAILS FOR LINE 2 NON FRA/IRS,       S01119
     C*    'FR', 'RS' AND 'RX' DEALS                                      S01119
     C*    CALLED FROM   LOAD                                             S01119
     C*    CALLS SR                                                       S01119
     C*                                                                   S01119
0723 C           LINE02    BEGSR                           ** LIN2SR  ***
0725 C                     MOVE *BLANKS   LINE2
0725 C                     MOVEA*BLANKS   LIN
     C*                                                                   S01136
     C** FORMAT DEALS FOR LINE02                                          S01136
     C*                                                                   S01119
      *                                                                                       249976
      ** Process line 2 for complete foreign exchange deal                                    249976
      *                                                                                       249976
     C           @INDS     IFEQ 'FXDEALP4'                                                    249976
     C           @INDS     OREQ 'FXDEALP5'                                                    249976
     C           @INDS     OREQ 'FXDEALP0'                                                   249976A
     C           @INDS     OREQ 'FXDEALP1'                                                   249976A
      *                                                                                       249976
     C                     EXSR #F                                                            249976
     C                     GOTO ENDFM2                                                        249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 2 for complete money market deals                                       249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDELDP4'                                                    249976
     C           @INDS     OREQ 'MMDELDP5'                                                    249976
     C           @INDS     OREQ 'MMDELDP0'                                                    249976
     C           @INDS     OREQ 'MMDELDP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #G                                                            249976
     C                     GOTO ENDFM2                                                        249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 2 for complete negotiable asset boguht                                  249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDENBP4'                                                    249976
     C           @INDS     OREQ 'MMDENBP5'                                                    249976
     C           @INDS     OREQ 'MMDENBP0'                                                    249976
     C           @INDS     OREQ 'MMDENBP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #G                                                            249976
     C                     GOTO ENDFM2                                                        249976
     C                     END                                                                249976
      *                                                                                       249976
      ** Process line 2 for complete negotiable asset sold                                    249976
      *                                                                                       249976
     C           @INDS     IFEQ 'MMDENSP4'                                                    249976
     C           @INDS     OREQ 'MMDENSP5'                                                    249976
     C           @INDS     OREQ 'MMDENSP0'                                                    249976
     C           @INDS     OREQ 'MMDENSP1'                                                    249976
      *                                                                                       249976
     C                     EXSR #G                                                            249976
     C                     GOTO ENDFM2                                                        249976
     C                     END                                                                249976
      *                                                                                       249976
0571 C*    IS DEAL REVERSED                                               S01119
0572 C           RECIC     IFEQ 'R'                                       S01119
     C           LCD       ANDEQBJRDNB                                    155954
     C***********          MOVEL'REVERSED'TEXT    8                S01119 155954
     C                     MOVEL'DELETED 'TEXT    8                       155954
     C**********           MOVE HEX20     ZF2                             S01119              CAAA03
     C**********           MOVELHEX21     ZF1                             S01119              CAAA03
     C**********           MOVELHEX22     LIN,1                           S01119              CAAA03
     C                     MOVE '0'       *IN54                           S01119
     C                     END                                            S01119
     C           RECIC     IFEQ 'R'                                       155954
     C           LCD       ANDLTBJRDNB                                    155954
     C                     MOVEL'REVERSED'TEXT                            155954
     C**********           MOVE HEX20     ZF2                             155954              CAAA03
     C**********           MOVELHEX21     ZF1                             155954              CAAA03
     C**********           MOVELHEX22     LIN,1                           155954              CAAA03
     C                     MOVE '0'       *IN54                           155954
     C                     END                                            155954
     C*    OR MATURED                                                     S01119
     C           *IN42     IFEQ '1'                                       S01119
     C                     MOVEL'MATURED' TEXT                            S01119
     C**********           MOVE HEX20     ZF2                             S01119              CAAA03
     C**********           MOVELHEX21     ZF1                             S01119              CAAA03
     C**********           MOVELHEX22     LIN,1                           S01119              CAAA03
     C                     MOVE '0'       *IN54                           S01119
     C                     END                                            S01119
     C*                                                                   E26937
     C*    OR AUTHORISED                                                  E26937
     C           RECIC     IFEQ 'D'                                       E26937
     C                     MOVEL'AUTH    'TEXT    8                       E26937
     C**********           MOVE HEX20     ZF2                             E26937              CAAA03
     C**********           MOVELHEX21     ZF1                             E26937              CAAA03
     C**********           MOVELHEX22     LIN,1                           E26937              CAAA03
     C                     MOVE '0'       *IN54                           E26937
     C                     END                                            E26937
     C*    OR EXPIRED                                                     E26937
     C           RECIC     IFEQ 'E'                                       E26937
     C                     MOVEL'EXPIRED 'TEXT    8                       E26937
     C**********           MOVE HEX20     ZF2                             E26937              CAAA03
     C**********           MOVELHEX21     ZF1                             E26937              CAAA03
     C**********           MOVELHEX22     LIN,1                           E26937              CAAA03
     C                     MOVE '0'       *IN54                           E26937
     C                     END                                            E26937
      *                                                                                       CAAA03
     C**********           MOVELTEXT      LIN,1                                        CAAA03 CDL038
     C/COPY WNCPYSRC,DL0121C016
     C*                                                                   S01119
     C*   NON FRA/IRS DEALS                                               S01119
     C*                                                                   S01119
     C           *IN11     IFEQ '0'                                       S01119
      *  Foreign exchange trades (*IN04)                                  S01378
0726 C           *IN04     IFEQ '1'
0584 C**
0585 C**  EDIT AMOUNT
0587 C                     Z-ADDSLAM      ZAMNT
0587 C                     MOVE 'Y'       ZCOMMA
0587 C                     MOVE 'N'       ZMINUS
     C                     Z-ADDSCCDP     ZCDP                            E10784
0602 C                     EXSR ZEDIT
0603 C                     MOVE ZAMNTA    SLAMWF 17
     C/COPY WNCPYSRC,DL0121C042
0725 C   34                MOVEATXT,1     LIN,7                           S01119
0725 C   34                MOVEAMDATE     LIN,18                          S01119
0725 C  N35                MOVEATXT,2     LIN,30                          S01119
0725 C  N35                MOVEASLCY      LIN,35                          S01119
     C  N57                MOVEA'F'       LIN,41                          S01119
0725 C  N35                MOVEASLAMWF    LIN,42                          S01119
     C/COPY WNCPYSRC,DL0121C001
0728 C                     ELSE
      * loans/deposits (*IN05)                                            S01378
0726 C           *IN05     IFEQ '1'
     C                     Z-ADDRTSP      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    RTSPXX
0725 C                     MOVEATXT,3     LIN,8                           S01119
     C                     MOVE BRTT      BRTTWF  2
0725 C                     MOVEABRTTWF    LIN,19                          S01119
0725 C                     MOVEATXT,4     LIN,28                          S01119
0725 C                     MOVEARTSPXX    LIN,44                          S01119
     C/COPY WNCPYSRC,DL0121C036
0728 C                     ELSE
      * NA's purchased (*IN06)                                            S01378
0726 C           *IN06     IFEQ '1'
     C                     Z-ADDRTSP      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    RTSPXX 12
     C                     Z-ADDYRAT      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    YRATXX 12
0725 C                     MOVEATXT,5     LIN,8                           S01119
0725 C                     MOVEAYRATXX    LIN,13                          S01119
0725 C                     MOVEATXT,4     LIN,28                          S01119
0725 C                     MOVEARTSPXX    LIN,44                          S01119
     C*                                                                   S01378
     C** If parcelled NA set up parcel details (remove leading 0's)       S01378
     C           PCLI      IFEQ 'P'                                       S01378
     C                     MOVEATXT,12    LIN,59                          S01378
     C                     Z-ADDPSZE      @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     MOVEA@OUTCR    LIN,63                          S01378
     C                     END                                            S01378
     C*                                                                   S01378
0728 C                     ELSE
      * NA's sold (*IN07)                                                 S01378
0726 C           *IN07     IFEQ '1'
     C                     Z-ADDYRAT      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    YRATXX 12
0725 C                     MOVEATXT,5     LIN,8                           S01119
0725 C                     MOVEAYRATXX    LIN,13                          S01119
     C*                                                                   S01378
     C** If parcelled NA set up parcel details                            S01378
     C           PCLI      IFEQ 'P'                                       S01378
     C                     MOVEATXT,12    LIN,56                          S01378
     C                     Z-ADDPSZE      @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     MOVEA@OUTCR    LIN,61                          S01378
     C                     END                                            S01378
     C*                                                                   S01378
0728 C                     END
0728 C                     END
0728 C                     END
0728 C                     END
0728 C                     ELSE                                           S01119
     C*                                                                   S01119
     C*    FRA/IRS DEALS                                                  S01119
     C*                                                                   S01119
     C*                                                                   S01157
     C* SET UP THE TXT FIELDS FIRST                                       S01157
     C* IF DEAL TYPE IS FRA - INTEREST SPREAD SHOULD READ INTEREST RATE   S01157
     C* AND BASE RATE SHOULD READ REFERENCE RATE                          S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                                      S01157
     C                     MOVEATXT,11    LIN,3                           S01157
     C                     MOVEATXT,10    LIN,28                          S01157
     C                     ELSE                                           S01157
     C                     MOVEATXT,8     LIN,4                           S01157
0725 C                     MOVEATXT,4     LIN,28                          S01119
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF FRA THEN SETUP REF RATE                                        S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                                      S01157
     C*                                                                   S01157
0726 C           *IN36     IFEQ '0'                                       S01157
     C                     MOVE UBRTT     BRTTWF                          S01157
     C                     ELSE                                           S01157
     C                     MOVE TBRTT     BRTTWF                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVEABRTTWF    LIN,19                          S01157
     C*                                                                   S01157
     C* ELSE DEAL IS RS OR RX - SO SETUP OUR BASE RATE                    S01157
     C*                                                                   S01157
     C                     ELSE                                           S01157
     C*                                                                   S01157
     C           *IN36     IFEQ '0'                                       S01157
     C                     MOVE UBRTT     BRTTWF                          S01157
     C                     MOVEABRTTWF    LIN,19                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C** IF AN FRA AND SOLD THEN SET UP CONTRACT RATE WITH THEIRS         S01157
     C** ELSE SETUP CONTRACT RATE WITH OURS                               S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                                      S01157
     C           BYSL      ANDEQ'S'                                       S01157
     C*                                                                   S01157
0726 C           *IN19     IFEQ '0'                                       S01157
     C                     Z-ADDTRTSP     ZRATE                           S01157
     C                     EXSR RTEDIT                                    S01157
     C                     MOVE ZRATEA    TRTSPX 12                       S01157
0725 C                     MOVEATRTSPX    LIN,44                          S01157
     C                     END                                            S01157
0726 C           TSPIN     IFEQ 'S'                                       S01157
     C           TSPIN     OREQ 'P'                                       S01157
     C                     MOVEATSPIN     LIN,58                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     ELSE                                           S01157
     C*                                                                   S01157
0726 C           *IN37     IFEQ '0'                                       S01119
     C                     Z-ADDURTSP     ZRATE                           S01119
     C                     EXSR RTEDIT                                    S01119
     C                     MOVE ZRATEA    URTSPX 12                       S01119
0725 C                     MOVEAURTSPX    LIN,44                          S01119
     C                     END                                            S01119
0726 C           USPIN     IFEQ 'S'                                       S01119
     C           USPIN     OREQ 'P'                                       S01119
     C                     MOVEAUSPIN     LIN,58                          S01119
0728 C                     END                                            S01119
     C*                                                                   S01157
     C                     END                                            S01157
0728 C                     END                                            S01119
     C           ENDFM2    TAG                             **ENDFM2 TAGSR*S01136
     C*                                                                   S01184
     C**  IF CONFIRMATION MATCHING PRESENT GET COUNTERPARTY/BROKER STATUS S01184
     C*                                                                   S01184
     C           @CNF      IFEQ 'Y'                                       S01184
     C           CPST      ANDNE*BLANKS                                   S01184
     C           BKST      ANDNE*BLANKS                                   S01184
     C                     MOVEACPST      LIN,60                          S01184
     C                     MOVEABKST      LIN,63                          S01184
     C                     MOVEA'CF'      LIN,66                          S01184
     C                     END                                            S01184
     C*                                                                   S01184
0725 C                     MOVEALIN       LINE2
0727 C*
     C                     MOVE ZLINE2    SFLINE                          S01119
     C                     MOVE *BLANKS   ZLINE2                          S01119
     C*                                                                   S01119
0728 C                     ENDSR
     C/COPY WNCPYSRC,DL0121C030
     C**
     C********************************************************************
     C/SPACE 3                                                            S01119
0721 C********************************************************************S01119
     C**                                                                  S01119
0722 C*    LINE03 SR TO FORMAT DEAL DETAILS FOR LINE 3 'FR', 'RS',        S01119
     C*    'RR', 'RP', 'RF' DEALS; LINE 4 'RX' DEALS                      S01157
     C**   CALLED FROM   LOAD                                             S01119
     C**                                                                  S01119
0723 C           LINE03    BEGSR                           ** LIN3SR  *** S01119
0725 C                     MOVE *BLANKS   LINE3                           S01119
0725 C                     MOVEA*BLANKS   LIN                             S01119
     C*                                                                   S01119
     C                     MOVE '1'       *IN54                           S01119
     C*                                                                   S01119
     C           *IN49     IFEQ '1'                                       S01119
     C           *IN53     OREQ '1'                                       S01119
     C*                                                                   S01119
0571 C*    IS DEAL REVERSED                                               S01119
0572 C           RECIC     IFEQ 'R'                                       S01119
     C                     MOVEL'REVERSED'TEXT2   8                       S01119
     C**********           MOVE HEX20     ZF4                             S01119              CAAA03
     C**********           MOVELHEX21     ZF3                             S01119              CAAA03
     C**********           MOVELHEX22     LIN,1                           S01119              CAAA03
     C                     MOVE '0'       *IN54                           S01119
     C                     END                                            S01119
     C*    OR MATURED                                                     S01119
     C           *IN42     IFEQ '1'                                       S01119
     C                     MOVEL'MATURED' TEXT2                           S01119
     C**********           MOVE HEX20     ZF4                             S01119              CAAA03
     C**********           MOVELHEX21     ZF3                             S01119              CAAA03
     C**********           MOVELHEX22     LIN,1                           S01119              CAAA03
     C                     MOVE '0'       *IN54                           S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     MOVELTEXT2     LIN,1                                               CAAA03
     C                     END                                            S01119
     C*                                                                   S01119
     C           *IN47     IFEQ '1'                                       S01119
     C           *IN39     OREQ '1'                                       S01119
     C           *IN53     OREQ '1'                                       S01119
     C*                                                                   S01157
     C** IF THEIR CAP OR COLLAR MOVE 'BASE RATE' INTO TEXT ELSE SPECIFY   S01157
     C** 'THEIR BASE RATE'                                                S01157
     C*                                                                   S01157
     C           *IN53     IFEQ '1'                                       S01157
     C                     MOVEATXT,3     LIN,8                           S01157
     C                     ELSE                                           S01157
     C                     MOVEATXT,9     LIN,2                           S01119
     C                     END                                            S01157
     C*                                                                   S01157
0726 C           *IN38     IFEQ '0'                                       S01119
     C                     MOVE TBRTT     BRTTWF                          S01119
     C                     MOVEABRTTWF    LIN,19                          S01119
     C                     END                                            S01119
     C*                                                                   S01157
     C* IF DEAL TYPE IS FRA - INTEREST SPREAD SHOULD READ INTEREST RATE   S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                                      S01157
     C                     MOVEATXT,10    LIN,28                          S01157
     C                     ELSE                                           S01157
0725 C                     MOVEATXT,4     LIN,28                          S01119
     C                     END                                            S01157
0726 C           *IN19     IFEQ '0'                                       S01119
     C                     Z-ADDTRTSP     ZRATE                           S01119
     C                     EXSR RTEDIT                                    S01119
     C                     MOVE ZRATEA    TRTSPX 12                       S01119
0725 C                     MOVEATRTSPX    LIN,44                          S01119
     C                     END                                            S01119
0726 C           TSPIN     IFEQ 'S'                                       S01119
     C           TSPIN     OREQ 'P'                                       S01119
     C                     MOVEATSPIN     LIN,58                          S01119
     C                     END                                            S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C           *IN49     IFEQ '1'                                       S01119
     C                     MOVEATXT,3     LIN,8                           S01157
0726 C           *IN36     IFEQ '0'                                       S01119
     C                     MOVE UBRTT     BRTTWF                          S01119
     C                     MOVEABRTTWF    LIN,19                          S01119
     C                     END                                            S01119
0725 C                     MOVEATXT,4     LIN,28                          S01119
0726 C           *IN37     IFEQ '0'                                       S01119
     C                     Z-ADDURTSP     ZRATE                           S01119
     C                     EXSR RTEDIT                                    S01119
     C                     MOVE ZRATEA    URTSPX 12                       S01119
0725 C                     MOVEAURTSPX    LIN,44                          S01119
     C                     END                                            S01119
0726 C           USPIN     IFEQ 'S'                                       S01119
     C           USPIN     OREQ 'P'                                       S01119
     C                     MOVEAUSPIN     LIN,58                          S01119
     C                     END                                            S01119
     C                     END                                            S01119
     C*                                                                   S01119
0608 C**                                                                  S01119
0725 C                     MOVEALIN       LINE3                           S01119
     C                     MOVE ZLINE3    SFLINE                          S01119
     C                     MOVE *BLANKS   ZLINE3                          S01119
     C*                                                                   S01119
     C                     ENDSR                           ** END      SR*S01119
     C**                                                                  S01119
     C**                                                                  S01119
     C********************************************************************S01119
     C/SPACE 3                                                            S01119
0721 C********************************************************************S01119
     C*                                                                   S01119
0722 C*    LINE04 SR TO FORMAT DEAL DETAILS FOR LINE 3 'RX' DEALS         S01119
     C**   CALLED FROM   LOAD                                             S01119
     C*                                                                   S01119
0723 C           LINE04    BEGSR                           ** LIN4SR  *** S01119
0725 C                     MOVEA*BLANKS   LIN                             S01119
     C*                                                                   S01119
     C*     SET UP LINE 3 FOR DEAL TYPE RX                                S01119
     C*                                                                   S01119
0726 C           *IN39     IFEQ '1'                                       S01119
     C*                                                                   S01119
     C*     GET CURRENCY DECIMAL PLACES                                   S01119
0587 C                     MOVE TCUCY     XXCCY                           S01119
     C                     EXSR #L                                        S01194
0595 C**                                                                  S01119
     C*     FORMAT AMOUNT                                                 S01119
0587 C                     Z-ADDTPAMT     ZAMNT                           S01119
0587 C                     MOVE 'Y'       ZCOMMA                          S01119
0587 C                     MOVE 'N'       ZMINUS                          S01119
     C                     MOVELA6NBDP    ZCDP                            S01194
0602 C                     EXSR ZEDIT                                     S01119
0603 C                     MOVE ZAMNTA    TPAMTX 17                       S01119
0608 C**                                                                  S01119
     C                     MOVEATCUCY     LIN,45                          S01119
0726 C           *IN57     IFEQ '0'                                       S01119
     C                     MOVEA'F'       LIN,50                          S01119
     C                     END                                            S01119
     C                     MOVEATPAMTX    LIN,52                          S01119
     C                     END                                            S01119
0608 C**                                                                  S01119
0725 C                     MOVEALIN       SFLINE                          S01119
     C*                                                                   S01119
     C                     ENDSR                           **ENDDET ENDSR*S01119
     C*                                                                   S01119
     C********************************************************************S01119
     C/SPACE 3                                                            S01119
0721 C********************************************************************S01119
     C*                                                                   S01119
0722 C* LINE05 SR TO FORMAT DEAL DETAILS FOR LINE 2 RR/RP/RF DEALS        S01157
     C**   CALLED FROM   LOAD                                             S01119
     C*                                                                   S01119
0723 C           LINE05    BEGSR                           ** LIN5SR  *** S01119
0725 C                     MOVEA*BLANKS   LIN                             S01119
     C*                                                                   S01119
0726 C           *IN24     IFEQ '1'                                       S01119
0726 C           *IN45     OREQ '1'                                       S01119
0725 C                     MOVEATXT,6     LIN,38                          S01119
0726 C           *IN67     IFEQ '0'                                       S01119
     C                     Z-ADDCLRAT     ZRATE                           S01119
     C                     EXSR RTEDIT                                    S01119
     C                     MOVE ZRATEA    CLRATX 12                       S01119
     C                     MOVEACLRATX    LIN,54                          S01119
     C                     END                                            S01119
     C                     END                                            S01119
     C*                                                                   S01119
0725 C                     MOVEALIN       SFLINE                          S01119
     C*                                                                   S01119
     C                     ENDSR                           **ENDDET ENDSR*S01119
     C*                                                                   S01119
     C********************************************************************S01119
     C/SPACE 3                                                            S01119
0721 C********************************************************************S01119
     C*                                                                   S01119
0722 C*    LINE06 SR TO FORMAT DEAL DETAILS FOR LINE 4 RR/RP/RF DEALS     S01157
     C**   CALLED FROM   LOAD                                             S01119
     C*                                                                   S01119
0723 C           LINE06    BEGSR                           ** LIN6SR  *** S01119
0725 C                     MOVEA*BLANKS   LIN                             S01119
     C*                                                                   S01119
     C*                                                                   S01119
     C*    SETUP LINE 4 FOR DEAL TYPE RR, RP OR RF                        S01157
     C*                                                                   S01119
0725 C                     MOVEATXT,7     LIN,38                          S01119
     C                     Z-ADDFLRAT     ZRATE                           S01119
     C                     EXSR RTEDIT                                    S01119
     C                     MOVE ZRATEA    FLRATX 12                       S01119
     C                     MOVEAFLRATX    LIN,54                          S01119
     C*                                                                   S01119
0725 C                     MOVEALIN       SFLINE                          S01119
     C*                                                                   S01119
     C                     ENDSR                           **ENDDET ENDSR*S01119
     C*                                                                   S01119
     C********************************************************************S01119
     C/SPACE 3
0721 C********************************************************************
     C**
     C**   SR. TO RESTORE INITIAL VALUE OF DISPLAY INDICATOR FOR
     C**       'MATURED' & 'REVERSED' MESSAGE I.E. IND.54
0723 C           TEXSET    BEGSR                           *** TEXSET ***
     C**
     C           TEXT      IFEQ *BLANKS
     C                     MOVE '1'       *IN54
     C                     ELSE
     C                     MOVE '0'       *IN54
     C                     END
0728 C                     ENDSR
     C********************************************************************
     C*SPACE*3*************                                               S01194
0730 C********************************************************************
     C*
0739 C*    DTRQSS SR VALIDATE AND PROCESS DEALS DETAILS REQUEST
     C*
     C**   CALLED FROM   LOAD,
     C**   CALLS SR      EMCNSR,RETSR
     C**   CALLS PROG.   PGN2
0740 C           DTRQSS    BEGSR                           ** DTRQSS   ***
     C                     MOVE '1'       *IN43
0496 C**
0375 C**  CLEAR ERROR MESSAGE FIELD,
0376 C                     MOVE *BLANKS   MSG
0388 C**
0389 C**  CHECK THAT VALUE IS EQUAL TO 1
0387 C           LEOPSF    IFNE '1'
     C**
     C**  SET INDICATORS FOR REVERSE IMAGE AND SFLNXTCHG
     C                     MOVE '1'       *IN62
     C                     MOVE '1'       *IN63
0382 C                     MOVELERR,7     MSG
     C**
     C**  SAVE DEAL NUMBER
     C                     Z-ADDDLNO      SDLNO   60
0386 C                     ELSE
0391 C**
0392 C**      CALL REQESTED PROGRAM
0391 C**
0392 C**      FIRST UPDATE DATA AREA
0405 C           *LOCK     IN   DLSDS
     C                     MOVE *BLANKS   RQDTW  18                       S01311
     C                     MOVELRQDTW     RQDTD                           S01311
0402 C                     MOVELDLNO      RQDTD
      *                                                                   S01311
     C           FXMM      IFEQ *BLANKS                                   S01311
     C                     MOVE 'DL'      RQDTD                           S01311
     C                     END                                            S01311
      *                                                                   S01311
     C********IF MATURED RECORD MOVE VALUE INTO PARAMETER                 S01119
0405 C                     OUT  DLSDS
0391 C**
0392 C**      CALL PROGRAM
0405 C                     OUT  LDA
0406 C                     CALL 'DL0170'
     C/COPY WNCPYSRC,DL0121C024
0405 C           *LOCK     IN   LDA
     C                     IN   DLSDS                                     S01311
0409 C**
      *                                                                   S01311
      *   Test for database error in lower programs                       S01311
      *                                                                   S01311
     C           RETND     IFEQ 'E'                                       S01311
     C                     MOVEL'DL0121  'DBPGM                     S01119S01157
     C                     MOVEL'PROGRAM 'ZDB14  14                       S01119
     C                     MOVE 'DL0170'  ZDB14                           S01119
     C                     MOVEL' DEAL '  ZDB12  12                       S01119
     C                     MOVE DLNO      ZDB12                           S01119
     C                     MOVELZDB14     DBKEY                           S01119
     C                     MOVE ZDB12     DBKEY                           S01119
     C                     RETRN                                          S01119
     C                     END                                            S01119
      *                                                                   S01311
      *   Test for CMD1 or CMD3 pressed in lower program                  S01311
      *                                                                   S01311
     C           RETND     IFEQ 'Q'                                       S01311
     C           RETND     OREQ 'S'                                       S01311
     C           FXMM      ANDNE*BLANKS
     C                     SETON                     LR                   S01311
     C                     RETRN                                          S01311
     C                     END                                            S01311
     C*
     C                     END
0426 C**  INVALID INPUT DISPLAY ERROR CODES
0428 C           MSG       COMP *BLANKS                  43
0429 C**                                                               ***
     C                     MOVE '0'       *IN42
0744 C*
0745 C                     ENDSR
0846 C**
     C********************************************************************
     C/SPACE 3
0738 C********************************************************************
     C*
0739 C*    PRINTD SR  TO PRINT THE  DEAL DETAILS FOR THIS CUSTOMER
     C*
     C**   CALLED FROM   LOAD
     C**   CALLS PROG    DLCXXX
0418 C*
0740 C           PRINTD    BEGSR                           *** PRINTD  ***
     C**
     C**   INITIALIZE PARAMETER FIELDS
     C                     MOVE 'N'       OPTLIV
     C                     MOVE 'N'       OPTMAT
     C*
     C           *IN28     IFEQ '1'
     C           *IN29     ANDEQ'1'
     C                     MOVE 'Y'       OPTLIV  1
     C                     MOVE 'Y'       OPTMAT  1
     C                     GOTO CALLP
     C                     END
     C*
     C           *IN28     IFEQ '1'
     C                     MOVE 'Y'       OPTLIV  1
     C                     ELSE
     C                     MOVE 'Y'       OPTMAT  1
     C                     END
     C*
0740 C           CALLP     TAG                             ***  CALLP  ***
     C*                                                                   DT0204
     C                     MOVEL'DL2480'  @RNAM                           DT0204
     C                     MOVEL'DLC2482' @COTT                           DT0204
     C*                                                                   DT0204
     C           *IN10     IFEQ '1'                                       E28392
     C                     MOVEL'B'       @LVL    1                       E28392
     C                     MOVELSBRCA     @ETTY   3                       E28392
     C                     ELSE                                           E28392
     C                     MOVEL'S'       @LVL                            E28392
     C                     MOVEL*BLANKS   @ETTY                           E28392
     C                     END                                            E28392
     C*                                                                   E28392
     C                     OUT  LDA                                       E5
      *                                                                   E5
     C                     CALL 'FC0040X'                                 DT0204
     C                     PARM *BLANKS   @RTCD                           DT0204
     C                     PARM           @RNAM  10                       DT0204
     C                     PARM           @COTT  10                       DT0204
     C                     PARM '10001'   @CSEQ   5                       DT0204
     C                     PARM           @PARM                           DT0204
     C                     PARM @MBIN     @MBRC   1                       DT0204
     C**********           PARM 'B'       @LVL    1                DT0204 E28392
     C**********           PARM SBRCA     @ETTY   3                DT0204 E28392
     C                     PARM           @LVL                            E28392
     C                     PARM           @ETTY                           E28392
      *                                                                   E5
     C           *LOCK     IN   LDA                                       E5
      *                                                                   E5
     C*
     C                     ENDSR
     C********************************************************************
     C/SPACE 3
0746 C********************************************************************
0846 C**
0846 C**
     C*  RTEDIT SR SUBROUTINE TO EDIT A RATE FIELD FOR OUTPUT
     C*
     C*  CALLED BY: LINE02
     C*
     C*  THIS SUBROUTINE CONTERTS AN 11,7 RATE FIELD INTO A 12 ALPHAMERIC
     C*  FIELD WITH LEADING AND TRAILING ZEROS DELETED. IF THE RATE IS
     C*  LESS THAN 1 THEN A ZERO IS PLACED BEFORE THE DECIMAL POINT.
     C*
     C*
     C*  INPUT FIELDS:
     C*                    ZRATE  11 7    AMOUNT FIELD TO BE EDITED
     C*
     C*  OUTPUT FIELDS:
     C*                    ZRATEA 12 A    EDITED AMOUNT FIELD
     C*
     C*  INDICATOR USED:
     C*                    *IN94          SETON IF NON-ZERO CHARACTER
     C*                                   FOUND IN THE AMOUNT
     C*
     C           RTEDIT    BEGSR                           ***  RTEDIT ***
     C*
     C                     Z-ADDZRATE     ZRATE  117       I/P FIELD
     C                     MOVE *BLANK    ZRATEA 12        O/P FIELD
     C                     MOVE '0'       *IN94
     C*
     C                     MOVEA*BLANKS   OUT
     C                     Z-ADD1         J       20
     C*
     C*  CLEAR LEADING ZEROS
     C           J         DOWLE4
     C           *IN94     IFEQ '0'
     C           RAT,J     IFEQ 0
     C                     MOVE ' '       OUT,J
     C                     ELSE
     C                     MOVE RAT,J     OUT,J
     C                     SETON                     94
     C                     END
     C                     ELSE
     C                     MOVE RAT,J     OUT,J
     C                     END
     C                     ADD  1         J
     C                     END
     C*
     C*  MOVE IN DECIMAL POINT
     C           J         IFEQ 5
     C           *IN94     IFEQ '0'
     C                     MOVE '0'       OUT,4
     C                     END
     C*********            MOVE '.'       OUT,J                           073516
     C                     MOVE BNDCSP    OUT,J                           073516
     C                     END
     C*
     C*  POSITION DECIMALS,ADD TRAILING ZEROS
     C                     MOVE '0'       *IN94
     C                     Z-ADD11        J
     C                     Z-ADD12        K       20
     C           J         DOWGE5
     C           *IN94     IFEQ '0'
     C           RAT,J     IFEQ 0
     C                     MOVE '0'       OUT,K
     C                     ELSE
     C                     MOVE RAT,J     OUT,K
     C                     SETON                     94
     C                     END
     C                     ELSE
     C                     MOVE RAT,J     OUT,K
     C                     END
     C                     SUB  1         J
     C                     SUB  1         K
     C                     END
     C*                                                                   208051
     C*  Add leading '-' sign if rate is negative.                        208051
     C           ZRATE     IFLT 0                                         208051
     C*                                                                   208051
     C                     MOVE '0'       *IN94                           208051
     C                     Z-ADD3         L       20                      208051
     C*                                                                   208051
     C           L         DOWGE1                                         208051
     C           *IN94     ANDEQ'0'                                       208051
     C           OUT,L     IFEQ ' '                                       208051
     C                     MOVE '-'       OUT,L                           208051
     C                     SETON                     94                   208051
     C                     END                                            208051
     C                     SUB  1         L                               208051
     C                     END                                            208051
     C*                                                                   208051
     C                     END                                            208051
     C*
     C*  FINALLY MOVE  EDITED FIELD INTO O/P FIELD
     C                     MOVEAOUT       ZRATEA
     C*
     C****
     C                     ENDSR
0846 C**
0846 C**
     C********************************************************************
     C/SPACE 3
0746 C********************************************************************
0846 C**
     C*
     C*  ZEDIT SR. SUBROUTINE TO EDIT AN AMOUNT FIELD FOR OUTPUT
     C*
     C*  CALLED BY: BASFMT, ENQFMT
     C*
     C*  INPUT FIELDS:
     C*                    ZAMNT  15 0    AMOUNT FIELD TO BE EDITED
     C*                    ZCDP    1,0    NO. OF DECIMAL PLACES
     C*                    ZCOMMA  1 A    COMMAS WANTED ('Y' OR 'N')
     C*                    ZMINUS  1 A    MINUS SIGN WANTED ('Y' OR 'N')
     C*
     C*  OUTPUT FIELDS:
     C*                    ZAMNTA 21 A    EDITED AMOUNT FIELD
     C*
     C*  INDICATOR USED:
     C*                    *IN94          SETON IF NON-ZERO CHARACTER
     C*                                   FOUND IN THE AMOUNT
     C*
     C           ZEDIT     BEGSR                           ***  ZEDIT  ***
     C*
     C                     Z-ADDZAMNT     ZAMNT  150       I/P FIELD
     C                     MOVE ZCOMMA    ZCOMMA  1        VALUE Y OR N
     C                     MOVE ZMINUS    ZMINUS  1        VALUE Y OR N
     C                     Z-ADDZCDP      ZCDP    10       NO. OF DPs.
     C                     MOVE *BLANK    ZAMNTA 21        O/P FIELD
     C                     MOVE '0'       *IN94
     C*
     C                     MOVE *BLANK    ZAMNTB 16        NON-COMMA EDIT
     C                     MOVE *BLANK    ZAMNTC 20        NON-COMMA EDIT
     C                     MOVE *BLANK    ZAMNTD 17        NON-COMMA EDIT
     C                     MOVE *BLANK    ZFLD3  16        NON-COMMA EDIT
     C                     MOVE '00000000'ZFLD1  15
     C                     MOVEL'0000000' ZFLD1
     C                     MOVE *BLANK    ZFLD2  20
     C                     MOVE ' '       ZMINS   1        MINUS CHARCTER
     C                     MOVEA*BLANK    ZEDT
     C                     MOVEA*BLANK    ZED2
     C                     MOVEA*BLANK    ZAMT
     C                     MOVEA*BLANK    Z3
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C*  PROCESS AMOUNT AS A POSTIVE NUMBER EVEN IF NEGATIVE
     C           ZMINUS    IFEQ 'Y'                        **** B1
     C           ZAMNT     IFLT 0                          **** B2
     C                     MOVE '-'       ZMINS
     C                     Z-SUBZAMNT     ZAMNT
     C                     ELSE                            **** X2
     C                     MOVE ' '       ZMINS
     C                     END                             **** E2
     C                     ELSE                            **** X2
     C           ZAMNT     IFLT 0                          **** B2
     C                     Z-SUBZAMNT     ZAMNT
     C                     END                             **** E2
     C                     END                             **** E1
     C*
     C*  SEPARATE INTEGER AND DECIMAL PARTS OF AMOUNT
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B1
     C                     MOVE ZAMNT     ZFLD1
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B2
     C                     MOVE ZAMNT     ZDEC1   1
     C                     MOVELZAMNT     ZAMT1  14
     C                     MOVE ZAMT1     ZFLD1
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B3
     C                     MOVE ZAMNT     ZDEC2   2
     C                     MOVELZAMNT     ZAMT2  13
     C                     MOVE ZAMT2     ZFLD1
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B4
     C                     MOVE ZAMNT     ZDEC3   3
     C                     MOVELZAMNT     ZAMT3  12
     C                     MOVE ZAMT3     ZFLD1
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B5
     C                     MOVE ZAMNT     ZDEC8   8
     C                     MOVELZAMNT     ZAMT8   7
     C                     MOVE ZAMT8     ZFLD1
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C                     END                             **** E1
     C*
     C*  MOVE THE INTEGER FIELD INTO A 5X3 ARRAY FOR EDITING
     C                     MOVEAZFLD1     ZAMT
     C*
     C/SPACE 3
     C*
     C****
     C*
     C*  CHECK IF COMMAS ARE NEEDED OR NOT
     C*
     C****
     C           ZCOMMA    IFEQ 'Y'                        **** E1
     C****
     C*
     C*  IF ZCOMMA  IS 'Y' MOVE COMMAS ETC. INTO A 5X4 EDITED ARRAY
     C*  (FOR ZERO DECIMAL PLACES DO NOT WANT A DECIMAL POINT)
     C*
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVEAZCOM,1    ZEDT
     C                     ELSE
     C                     MOVEAZCOM,2    ZEDT
     C                     END                             **** E2
     C*
     C*
     C*  READ THROUGH AMOUNT ARRAY SO AS TO PLACE EDITED DIGITS
     C*  INTO ZEDT. THE ARRAY IS READ 3 CHARACTERS AT A TIME.
     C*  ALL LEADING ZEROES ARE SUPPRESSED.
     C                     DO   5         Z       10       **** B2
     C*
     C           *IN94     IFEQ '1'                        **** B3
     C                     MOVELZAMT,Z    ZEDT,Z
     C                     ELSE
     C*
     C*  BLANK OUT EDITED FIELD IF ZEROES ARE FOUND
     C           ZAMT,Z    IFEQ '000'                      **** B4
     C           Z         IFNE 5                          **** B5
     C                     MOVE '    '    ZEDT,Z
     C                     END                             **** E5
     C                     ELSE
     C*
     C*  WHEN FIRST NON ZERO CHARACTERS ARE REACHED REMOVE LEADING
     C*  ZEROES. READ ARRAY ELEMENT 1 CHARACTER AT A TIME.
     C                     MOVE '1'       *IN94
     C                     Z-ADD1         ZN      10
     C                     MOVEAZAMT,Z    Z3
     C           Z3,ZN     DOWEQ'0'                        **** B5
     C                     MOVE ' '       Z3,ZN
     C                     ADD  1         ZN
     C                     END                             **** E5
     C                     MOVEAZ3        ZEDT,Z
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  PLACE EDITED ARRAY INTO ALPHA FIELD TO INCLUDE DECIMALS.
     C                     MOVEAZEDT      ZFLD2
     C*
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVELZFLD2     ZAMT0  19
     C                     MOVE ZAMT0     ZAMNTC
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B3
     C                     MOVE ZFLD2     ZAMT1A 19
     C                     MOVELZAMT1A    ZAMNTC
     C                     MOVE ZDEC1     ZAMNTC
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B4
     C                     MOVE ZFLD2     ZAMT2A 18
     C                     MOVELZAMT2A    ZAMNTC
     C                     MOVE ZDEC2     ZAMNTC
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B5
     C                     MOVE ZFLD2     ZAMT3A 17
     C                     MOVELZAMT3A    ZAMNTC
     C                     MOVE ZDEC3     ZAMNTC
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B6
     C                     MOVE ZFLD2     ZAMT8A 12
     C                     MOVELZAMT8A    ZAMNTC
     C                     MOVE ZDEC8     ZAMNTC
     C                     END                             **** E6
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C           ZMINUS    IFEQ 'Y'                        **** B2
     C                     MOVELZAMNTC    ZAMNTA
     C                     MOVE ZMINS     ZAMNTA
     C                     ELSE                            **** X2
     C                     MOVE ZAMNTC    ZAMNTA
     C                     END                             **** E2
     C*
     C****                                                 ****
     C*
     C                     ELSE                            **** X1
     C*
     C****                                                 ****
     C*
     C*  ELSE IF ZCOMMA EQUAL 'N':
     C*  MOVE FORMAT LEFT INTO A 6X3 ARRAY - 6TH ELEMENT CONTAINS D.P.
     C*  (FOR ZERO DECIMAL PLACES DO NOT WANT A DECIMAL POINT)
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVEAZCOM,3    ZED2
     C                     ELSE
     C                     MOVEAZCOM,4    ZED2
     C                     END                             **** E2
     C*
     C*
     C*  READ THROUGH AMOUNT ARRAY SO AS TO PLACE EDITED DIGITS
     C*  INTO ZED2. THE ARRAY IS READ 3 CHARACTERS AT A TIME.
     C*  ALL LEADING ZEROES ARE SUPPRESSED.
     C                     DO   5         Z       10       **** B2
     C*
     C           *IN94     IFEQ '1'                        **** B3
     C                     MOVELZAMT,Z    ZED2,Z
     C                     ELSE
     C*
     C*  SEARCH FOR FIRST NONE-ZERO CHARACTERS
     C           ZAMT,Z    IFNE '000'                      **** B4
     C*
     C*  WHEN FIRST NON ZERO CHARACTERS ARE REACHED REMOVE LEADING
     C*  ZEROES. READ ARRAY ELEMENT 1 CHARACTER AT A TIME.
     C                     MOVE '1'       *IN94
     C                     Z-ADD1         ZN      10
     C                     MOVEAZAMT,Z    Z3
     C           Z3,ZN     DOWEQ'0'                        **** B5
     C                     MOVE ' '       Z3,ZN
     C                     ADD  1         ZN
     C                     END                             **** E5
     C                     MOVEAZ3        ZED2,Z
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  PLACE EDITED ARRAY INTO ALPHA FIELD TO INCLUDE DECIMALS.
     C                     MOVEAZED2      ZFLD3
     C*
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVELZFLD3     ZAMT0B 15
     C                     MOVE ZAMT0B    ZAMNTB
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B3
     C                     MOVE ZFLD3     ZAMT1B 15
     C                     MOVELZAMT1B    ZAMNTB
     C                     MOVE ZDEC1     ZAMNTB
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B4
     C                     MOVE ZFLD3     ZAMT2B 14
     C                     MOVELZAMT2B    ZAMNTB
     C                     MOVE ZDEC2     ZAMNTB
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B5
     C                     MOVE ZFLD3     ZAMT3B 13
     C                     MOVELZAMT3B    ZAMNTB
     C                     MOVE ZDEC3     ZAMNTB
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B6
     C                     MOVE ZFLD3     ZAMT8B  8
     C                     MOVELZAMT8B    ZAMNTB
     C                     MOVE ZDEC8     ZAMNTB
     C                     END                             **** E6
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C           ZMINUS    IFEQ 'Y'                        **** B2
     C                     MOVELZAMNTB    ZAMNTD
     C                     MOVE ZMINS     ZAMNTD
     C                     ELSE                            **** X2
     C                     MOVE ZAMNTB    ZAMNTD
     C                     END                             **** E2
     C*
     C*  FINALLY MOVE NON-COMMA EDITED FIELD INTO O/P FIELD
     C                     MOVE ZAMNTD    ZAMNTA
     C*
     C****
     C                     END                             **** E1
     C****
     C                     ENDSR
     C*
0847 C**
     C********************************************************************
     C/SPACE 3
0848 C********************************************************************
0849 C**
0850 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
0851 C**
0852 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
0853 C**
0854 C           ZDATE2    BEGSR                           *** ZDATE2 ***
0855 C**
0856 C**   CLEAR DATE FIELDS.
0857 C                     Z-ADD0         ZDATE   60
0858 C                     MOVEL'       ' ZADATE  7
0859 C**
0860 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
0861 C                     Z-ADDZDAYNO    ZDAYNO  50
0862 C**
0863 C**   DETERMINE YEAR NUMBER.
0864 C**
0865 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
0866 C           ZDAYNO    SUB  1         ZDAYN1  50   99
0867 C   99                GOTO ZDEND2
0868 C**
0869 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
0870 C           ZDAYN1    DIV  1461      ZLYR    20
0871 C                     MVR            ZDAYN1           SAVE REMAINING
0872 C**                                                   DAYS
0873 C**   CALCULATE NUMBER OF REMAINING YEARS.
0874 C                     Z-ADD1         ZWRK2   20
0875 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
0876 C           ZDAYN1    COMP ZYDY,ZWRK2             90
0877 C  N90      ZWRK2     ADD  1         ZWRK2
0878 C  N90                GOTO ZDTAG1
0879 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
0880 C**
0881 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
0882 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
0883 C**
0884 C**   CALCULATE ACTUAL YEAR NUMBER.
0885 C           ZLYR      MULT 4         ZWRK3   30
0886 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
0887 C                     Z-ADDZWRK3     ZYEAR   20
0888 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
0889 C**
0890 C**   DETERMINE MONTH NUMBER.
0891 C**
0892 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
0893 C                     SETOF                     9293
0894 C   91      ZDAYN1    COMP 59                     9293
0895 C   91N92   ZDAYN1    SUB  1         ZDAYN1
0896 C**
0897 C**   CALCULATE MONTH NUMBER.
0898 C                     Z-ADD2         ZWRK2
0899 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
0900 C           ZDAYN1    COMP ZMDY,ZWRK2             94
0901 C  N94      ZWRK2     ADD  1         ZWRK2
0902 C  N94                GOTO ZDTAG2
0903 C           ZWRK2     SUB  1         ZWRK2
0904 C**
0905 C                     Z-ADDZWRK2     ZMTH    20       MONTH
0906 C**
0907 C**   DETERMINE DAY OF MONTH.
0908 C**
0909 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
0910 C           ZDAYN1    ADD  1         ZDAYN1
0911 C**
0912 C**   CALCULATE DAY OF MONTH.
0913 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
0914 C**
0915 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
0916 C   93      ZDAY      ADD  1         ZDAY
0917 C**
0918 C**   FORMAT DATE, DDMMYY OR MMDDYY.
0919 C  N98                MOVELZDAY      ZWRK4   40
0920 C   98                MOVE ZDAY      ZWRK4
0921 C  N98                MOVE ZMTH      ZWRK4
0922 C   98                MOVELZMTH      ZWRK4
0923 C                     MOVELZWRK4     ZDATE
0924 C                     MOVE ZYEAR     ZDATE
0925 C**
0926 C**   FORMAT ALPHA DATE, DDMMMYY.
0927 C           ZDAY      COMP 10                     95
0928 C                     MOVELZDAY      ZWRK5   5
0929 C   95                MOVEL' '       ZWRK5
0930 C                     MOVE ZMNM,ZMTH ZWRK5
0931 C                     MOVELZWRK5     ZADATE
0932 C                     MOVE ZYEAR     ZADATE
0933 C**
0934 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
0935 C**
0936 C**
     C********************************************************************
     C/EJECT
     C***************************************************************     S01136
     C*                                                                   S01136
     C* #A        -  DRS INITIAL PROCESSING                               S01136
     C*                                                                   S01136
     C* CALLS       -                                                     S01136
     C*                                                                   S01136
     C* CALLED BY   - MAIN PROGRAM                                        S01136
     C*                                                                   S01136
     C* FLDS USED   -                                                     S01136
     C*                                                                   S01136
     C***************************************************************     S01136
     C           #A        BEGSR                                          S01136
     C*                                                                   S01136
     C** SET UP PROGRAM NAME                                              S01136
     C                     MOVEL'DL0121'  DBPGM                           S01136
     C*                                                                   S01136
     C** RETRIEVE THE EXTERNAL DATAAREA MMOD                              E14702
     C           *NAMVAR   DEFN MMOD      MMODS                           E14702
     C                     IN   MMODS                                     E14702
     C*                                                                   E14702
     C********** MODFD     IFEQ 'Y'                        B1      E14702 S01319
     C**********           OPEN FDPMNTLL                   *1      E14702 S01319
     C                     OPEN FDMNTHLL                   *1             S01319
     C**********           OPEN FDINSTLL                   *1      E14702 S01319
     C*                                                                   S01136
     C***ACCESS*DRS*INSTALLATION*CONTROL*DATA****                  S01136 S01319
     C********** 1         SETLLFDINSTLL                   *1      S01136 S01319
     C**********           READ FDINSTLL                 61*1      S01136 S01319
     C**********                                                   S01136 S01319
     C***IF*RECORD*NOT*FOUND*DATABASE*ERROR****                    S01136 S01319
     C********** *IN61     IFEQ '1'                        B*2     S01136 S01319
     C********** IDDLTF    OREQ '*'                        **2     S01136 S01319
     C**********           CALL 'AODEALR0'                                S01319              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01319              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C**********           MOVE '001'     DBASE            ********S01136 S01319
     C**********           MOVEL'FDINSTLL'DBFILE           *      S01136  S01319
     C**********           MOVE *BLANKS   DBKEY            * DBERR*S01136 S01319
     C**********           MOVE '1'       *INU7            *      *S01136 S01319
     C**********           MOVE '1'       *INU8            ********S01136 S01319
     C**********           GOTO #A9                        **2     S01136 S01319
     C**********           END                             E*2     S01136 S01319
     C*                                                                   S01136
     C** ACCESS MONTH NAME FILE                                           S01136
     C********** 1         SETLLFDPMNTLL                   *1      S01136 S01319
     C**********           READ FDPMNTLL                 61*1      S01136 S01319
     C           1         SETLLFDMNTHLL                   *1             S01319
     C                     READ FDMNTHLL                 61*1             S01319
     C*                                                                   S01136
     C** IF RECORD NOT FOUND DATABASE ERROR                               S01136
     C           *IN61     IFEQ '1'                        B*2            S01136
     C                     MOVE '002'     DBASE            ***************S01136
     C**********           MOVEL'FDPMNTLL'DBFILE           *      *S01136 S01319
     C                     MOVEL'FDMNTHLL'DBFILE           *             *S01319
     C                     MOVE *BLANKS   DBKEY            * DBERROR 002 *S01136
     C                     MOVE '1'       *INU7            *             *S01136
     C                     MOVE '1'       *INU8            ***************S01136
     C                     EXSR *PSSR                      **2            S01194
     C                     GOTO #A9                        **2            S01136
     C                     END                             E*2            S01136
     C*                                                                   S01136
     C***********          END                             E1      E14702 S01319
     C*                                                                   S01136
      ** Access Switchable Features file and check if CGL011              CGL011
      ** is switched on or not.                                           CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   PRTCD   7                       CGL011
     C                     PARM '*VERIFY' POTPN   7                       CGL011
     C                     PARM 'CGL011'  PSARD   6                       CGL011
     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
      *                                                                   CGL011
     C           PRTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       CGL011  1                       CGL011
      *                                                                   CGL011
     C                     ELSE                                           CGL011
     C                     MOVE 'N'       CGL011                          CGL011
     C           PRTCD     IFNE '*NRF   '                                 CGL011
     C                     MOVEL'006'     DBASE            ***************CGL011
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 006*CGL011
     C                     MOVEL'CGL011  'DBKEY            ***************CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CSD007
      ** Access Switchable Features file and check if CSD007              CSD007
      ** is switched on or not.                                           CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD   7                       CSD007
     C                     PARM '*VERIFY' @OPTN   7                       CSD007
     C                     PARM 'CSD007'  @SARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
      *                                                                   CSD007
      ** Database Error, if Return Code is not blanks or *NRF             CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'007'     DBASE                           CSD007
     C                     MOVEL'CSD007  'DBKEY                           CSD007
     C                     MOVE *ON       *INU7                           CSD007
     C                     MOVE *ON       *INU8                           CSD007
     C                     MOVE *ON       *INLR                           CSD007
     C                     EXSR *PSSR                                     CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
      *                                                                   S01311
      *   Only open CACUSDL2 if the program is NOT called as an           S01311
      *   Exposure Management linked enquiry                              S01311
      *   ELSE                                                            S01311
      *   Open the relevant Exposure Management file                      S01311
      *                                                                   S01311
     C           *IN80     IFEQ '0'                                       S01311
     C**********           OPEN CACUSDL2                   *1                          BHF486 249976
     C**********           OPEN CACUSDL3                   *1                          BHF486 249976
     C                     OPEN CACUSDL4                   *1                                 249976
     C                     OPEN CACUSDL5                   *1                                 249976
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'FX'                                      S01311
     C                     OPEN EMCUSFX2                                  S01311
     C                     OPEN EMCUSFX3                                  S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01332
     C                     OPEN EMCUSMM2                                  S01311
     C                     OPEN EMCUSMM3                                  S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CCP9                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'FR'                                      S01332
     C                     OPEN EMCUSFR2                                  S01332
     C                     OPEN EMCUSFR3                                  S01332
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C                     OPEN EMCUSIR2                                  S01332
     C                     OPEN EMCUSIR3                                  S01332
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C/COPY WNCPYSRC,DL0121C043
     C*                                                                   S01136
     C           #A9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #BBA        -  FILE ACCESS ROUTINE                            *   S01136
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -  LOAD                                           *   S01136
     C*                                                               *   S01136
     C* FLDS USED      @CRKY  - CUSTOMER KEY FOR FILE READ            *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #BBA      BEGSR                                          S01136
     C*                                                                   S01136
     C** INITIALISE RECORD ID AND FIELD INDICATORS                        S01136
     C                     MOVE '0'       *IN04                           S01136
     C                     MOVE '0'       *IN05                           S01136
     C                     MOVE '0'       *IN06                           S01136
     C                     MOVE '0'       *IN07                           S01136
     C                     MOVE '0'       *IN23                           S01136
     C                     MOVE '0'       *IN24                           S01136
     C                     MOVE '0'       *IN25                           S01136
     C                     MOVE '0'       *IN26                           S01136
     C/COPY WNCPYSRC,DL0121C031
     C*                                                                   S01136
     C** INITIALISE DTYP AS IT IS USED TO CALCULATE THE NUMBER OF LINES   S01136
     C** THAT EACH DEAL TYPE TAKES ON THE SCREEN. THIS VALUE MAY BE       S01136
     C** WRONG IF DTYP IS NOT RESET.                                      S01136
     C                     MOVE '  '      DTYP                            S01136
     C                     MOVE '  '      FHRCID                                              260329
     C                     MOVE '  '      HKRCID                                              260329
     C                     MOVE '  '      HLRCID                                              260329
     C                     MOVE '  '      HMRCID                                              260329
     C*                                                                   S01136
     C** SET UP CUSTOMER NUMBER READE KEY FOR CACUSDL2                    S01136
     C           @CRKY     KLIST                                          S01136
     C                     KFLD           SBRCAX                          S01136
     C                     KFLD           CNUM
     C*                                                                   S01136
     C           *IN71     IFEQ '0'                                       S01136
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP10                                           S01408
     C*                                                                   S01408
     C           SBRCAX    IFEQ 'ALL'                                     LN0467
     C           @MBIN     OREQ 'N'                        B2             LN0467
      *                                                                   S01311
      *  If it is an Exposure Management Enquiry, read either the         S01311
      *  FX or the MM file                                                S01311
      *                                                                   S01311
     C           FXMM      IFEQ 'FX'                                      S01311
     C           CNUM      READEEMCUSFX2                 41               S01311
     C                     MOVE RECJM2    @INDS                           S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C           CNUM      READEEMCUSMM2                 41               S01311
     C                     MOVE RECKM2    @INDS                           S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP11                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'FR'                                      S01332
     C           CNUM      READEEMCUSFR2                 41               S01332
      *                                                                   CDL006
      ** Test if transaction is fiduciary or not                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           *IN41     ANDEQ'0'                                       CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       WWFID   1                       CDL006
      *                                                                   CDL006
     C           DTYP      IFEQ 'FL'                                      CDL006
     C           DTYP      OREQ 'DP'                                      CDL006
     C           DTYP      OREQ 'LP'                                      CDL006
     C           DTYP      OREQ 'FT'                                      CDL006
     C           DTYP      OREQ 'DT'                                      CDL006
     C           DTYP      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
     C           *IN41     DOWEQ'0'                                       CDL006
     C           WWFID     ANDEQ'Y'                                       CDL006
      *                                                                   CDL006
      ** If the deal is Fiduciary                                         CDL006
      *                                                                   CDL006
     C           CNUM      READEEMCUSMM2                 41               CDL006
      *                                                                   CDL006
     C           DTYP      IFNE 'FL'                                      CDL006
     C           DTYP      ANDNE'DP'                                      CDL006
     C           DTYP      ANDNE'LP'                                      CDL006
     C           DTYP      ANDNE'FT'                                      CDL006
     C           DTYP      ANDNE'DT'                                      CDL006
     C           DTYP      ANDNE'LT'                                      CDL006
     C                     MOVE 'N'       WWFID                           CDL006
     C                     ELSE                                           CDL006
     C                     MOVE RECKM2    @INDS                           CDL006
     C                     ENDIF                                          CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP12                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C           CNUM      READEEMCUSIR2                 41               S01332
     C                     ELSE                                           S01332
     C********** CNUM      READECACUSDL2                 41                            LN0467 249976
     C           CNUM      READECACUSDL4                 41                                   249976
     C                     MOVE RECIM2    @INDS                           S01311
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C                     ELSE                                           LN0467
      *                                                                   S01311
     C           FXMM      IFEQ 'FX'                                      S01311
     C           @CRKY     READEEMCUSFX3                 41               S01311
     C                     MOVE RECJM3    @INDS                           S01311
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C           @CRKY     READEEMCUSMM3                 41               S01311
     C                     MOVE RECKM3    @INDS                           S01311
      *                                                                   CDL006
      ** Test if transaction is fiduciary or not                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           *IN41     ANDEQ'0'                                       CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       WWFID                           CDL006
      *                                                                   CDL006
     C           DTYP      IFEQ 'FL'                                      CDL006
     C           DTYP      OREQ 'DP'                                      CDL006
     C           DTYP      OREQ 'LP'                                      CDL006
     C           DTYP      OREQ 'FT'                                      CDL006
     C           DTYP      OREQ 'DT'                                      CDL006
     C           DTYP      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
     C           *IN41     DOWEQ'0'                                       CDL006
     C           WWFID     ANDEQ'Y'                                       CDL006
      *                                                                   CDL006
      ** If the deal is Fiduciary                                         CDL006
      *                                                                   CDL006
     C           @CRKY     READEEMCUSMM3                 41               CDL006
      *                                                                   CDL006
     C           DTYP      IFNE 'FL'                                      CDL006
     C           DTYP      ANDNE'DP'                                      CDL006
     C           DTYP      ANDNE'LP'                                      CDL006
     C           DTYP      ANDNE'FT'                                      CDL006
     C           DTYP      ANDNE'DT'                                      CDL006
     C           DTYP      ANDNE'LT'                                      CDL006
     C                     MOVE 'N'       WWFID                           CDL006
     C                     ELSE                                           CDL006
     C                     MOVE RECKM3    @INDS                           CDL006
     C                     ENDIF                                          CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP13                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'FR'                                      S01332
     C           @CRKY     READEEMCUSFR3                 41               S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP14                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C           @CRKY     READEEMCUSIR3                 41               S01332
     C                     ELSE                                           S01332
     C********** @CRKY     READECACUSDL3                 41                            LN0467 249976
     C           @CRKY     READECACUSDL5                 41                                   249976
     C                     MOVE RECIM3    @INDS   8                       S01311
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C                     END                                            LN0467
     C                     ELSE                                           S01136
      *                                                                   S01311
      *  If it is an Exposure Management Enquiry, read either the         S01332
      *  FX, MM, FRA or IRS File                                          S01332
      *                                                                   S01311
     C           SBRCAX    IFEQ 'ALL'                                     LN0467
     C           @MBIN     OREQ 'N'                        B2             LN0467
     C           FXMM      IFEQ 'FX'                                      S01311
     C/COPY WNCPYSRC,DL0121C004
     C                     READPEMCUSFX2                 41               S01311
     C/COPY WNCPYSRC,DL0121C005
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C/COPY WNCPYSRC,DL0121C002
     C                     READPEMCUSMM2                 41               S01311
      *                                                                   CDL006
      ** Test if transaction is fiduciary or not                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           *IN41     ANDEQ'0'                                       CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       WWFID                           CDL006
      *                                                                   CDL006
     C           DTYP      IFEQ 'FL'                                      CDL006
     C           DTYP      OREQ 'DP'                                      CDL006
     C           DTYP      OREQ 'LP'                                      CDL006
     C           DTYP      OREQ 'FT'                                      CDL006
     C           DTYP      OREQ 'DT'                                      CDL006
     C           DTYP      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
     C           *IN41     DOWEQ'0'                                       CDL006
     C           WWFID     ANDEQ'Y'                                       CDL006
      *                                                                   CDL006
      ** If the deal is Fiduciary                                         CDL006
      *                                                                   CDL006
     C                     READPEMCUSMM2                 41               CDL006
      *                                                                   CDL006
     C           DTYP      IFNE 'FL'                                      CDL006
     C           DTYP      ANDNE'DP'                                      CDL006
     C           DTYP      ANDNE'LP'                                      CDL006
     C           DTYP      ANDNE'FT'                                      CDL006
     C           DTYP      ANDNE'DT'                                      CDL006
     C           DTYP      ANDNE'LT'                                      CDL006
     C                     MOVE 'N'       WWFID                           CDL006
     C                     ENDIF                                          CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C/COPY WNCPYSRC,DL0121C006
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'FR'                                      S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP15                                           S01408
     C*                                                                   S01408
     C                     READPEMCUSFR2                 41               S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP16                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP17                                           S01408
     C*                                                                   S01408
     C                     READPEMCUSIR2                 41               S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP18                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C/COPY WNCPYSRC,DL0121C007
     C**********           READPCACUSDL2                 41                            BHF486 249976
     C                     READPCACUSDL4                 41                                   249976
     C/COPY WNCPYSRC,DL0121C008
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01311
     C                     END                                            S01311
     C                     ELSE                                           LN0467
     C           FXMM      IFEQ 'FX'                                      S01311
     C/COPY WNCPYSRC,DL0121C009
     C                     READPEMCUSFX3                 41               S01311
     C/COPY WNCPYSRC,DL0121C010
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'MM'                                      S01311
     C/COPY WNCPYSRC,DL0121C011
     C                     READPEMCUSMM3                 41               S01311
      *                                                                   CDL006
      ** Test if transaction is fiduciary or not                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           *IN41     ANDEQ'0'                                       CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       WWFID                           CDL006
      *                                                                   CDL006
     C           DTYP      IFEQ 'FL'                                      CDL006
     C           DTYP      OREQ 'DP'                                      CDL006
     C           DTYP      OREQ 'LP'                                      CDL006
     C           DTYP      OREQ 'FT'                                      CDL006
     C           DTYP      OREQ 'DT'                                      CDL006
     C           DTYP      OREQ 'LT'                                      CDL006
      *                                                                   CDL006
     C           *IN41     DOWEQ'0'                                       CDL006
     C           WWFID     ANDEQ'Y'                                       CDL006
      *                                                                   CDL006
      **  If the deal sub-type is a Fiduciary Deposit                     CDL006
      *                                                                   CDL006
     C                     READPEMCUSMM3                 41               CDL006
      *                                                                   CDL006
     C           DTYP      IFNE 'FL'                                      CDL006
     C           DTYP      ANDNE'DP'                                      CDL006
     C           DTYP      ANDNE'LP'                                      CDL006
     C           DTYP      ANDNE'FT'                                      CDL006
     C           DTYP      ANDNE'DT'                                      CDL006
     C           DTYP      ANDNE'LT'                                      CDL006
     C                     MOVE 'N'       WWFID                           CDL006
     C                     ENDIF                                          CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C/COPY WNCPYSRC,DL0121C003
     C                     ELSE                                           S01311
     C           FXMM      IFEQ 'FR'                                      S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP19                                           S01408
     C*                                                                   S01408
     C                     READPEMCUSFR3                 41               S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP20                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C           FXMM      IFEQ 'IR'                                      S01332
     C           FXMM      OREQ 'CC'                                      S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP21                                           S01408
     C*                                                                   S01408
     C                     READPEMCUSIR3                 41               S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0121CP22                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01332
     C/COPY WNCPYSRC,DL0121C012
     C**********           READPCACUSDL3                 41                            BHF486 249976
     C**********           READPCACUSDL4                 41                            249976 260329
     C                     READPCACUSDL5                 41                                   260329
     C/COPY WNCPYSRC,DL0121C013
     C                     END                                            S01332
     C                     END                                            S01136
     C                     END                                            S01136
     C                     END                                            S01332
     C                     END                                            S01136
     C                     END                                            S01136
     C*                                                                   S01136
     C           #BBA9     ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C**#B**********-**FORMAT*FXDEALP0*OR*FXDEALP1*FOR*LINE01******S01136 E20251
     C* #B          -  FORMAT FXDEALP0 FOR LINE01                     *   E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #B        BEGSR                                          S01136
     C*                                                                   S01136
     C**   DEAL TYPE TEXT                                                 S01136
     C                     MOVE *BLANKS   DTYPW                           S01157
     C**********           MOVELDTYP      DTYPW                                        S01136 249976
     C                     MOVELFHTYPE    DTYPW                                               249976
     C                     MOVE *BLANKS   STWK    3                       S01136
     C                     MOVEL'-'       STWK                            S01136
     C**********           MOVE DLST      STWK                                         S01136 249976
     C                     MOVE FHSTYP    STWK                                                249976
     C                     MOVE STWK      DTYPW                           S01136
     C**********           MOVE CLAS      CLASW                                        CDL038 249976
     C                     MOVE FHCLAS    CLASW                                               249976
     C                     MOVE ' '       BYSLW                                               CDL038
     C*                                                                   S01136
     C** FORMAT REMAINING F-X FIELDS.                                     S01136
     C*                                                                   S01136
     C** FORMAT DEAL VALUE AND DEAL DONE DATE.                            S01136
     C                     EXSR #K                                        S01136
     C*                                                                   S01136
     C** OBTAIN BUY/SELL CURRENCY AND AMOUNT.                             S01136
     C                     EXSR ZA0670                                    S01136
     C*                                                                   S01136
     C** ACCESS CURRENCY TABLE                                            S01136
     C                     MOVE @@DBCC    XXCCY   3                       S01194
     C                     EXSR #L                                        S01194
     C*                                                                   S01136
     C           *INU7     CABEQ'1'       #B9                             S01136
     C*                                                                   S01136
     C*                                                                   S01136
     C** FORMAT THE PURCHASE AMOUNT                                       S01136
     C                     MOVE @@DBCC    @@CCY                           S01136
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     Z-ADD@@DBAM    @@IAMT                          S01136
     C                     Z-ADD16        @@CRET                          S01136
     C                     EXSR ZA0750                                    S01136
     C                     MOVE @@ADSP    AMT1W                           S01136
     C*                                                                   S01136
     C** SET UP FIELD FOR THE DISPLAY.                                    S01136
     C                     MOVE @@DBCC    CCY                             S01136
     C*                                                                   S01136
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY     S01136
     C**********           TESTB'2'       DSTI       55                                       249976
     C**N55*****           TESTB'3'       DSTI       55                                       249976
     C********** *IN55     IFEQ '1'                        B1                          S01136 249976
     C           FHFEDF    IFEQ 'Y'                        B1                                 249976
     C           CCY       IFEQ BLUSCY                     B*2            S01194
     C                     MOVE 'F'       FFIN             **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C                     MOVEL'PURCHASE'NARR1                           S01136
     C*                                                                   S01136
     C** SET ASSOCIATED DEAL NUMBER                                       S01136
     C**********           MOVELSODN      RDNO                                         S01136 249976
     C                     MOVELFHDADN    RDNO                                                249976
     C*                                                                   S01136
     C           #B9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #C          -  FORMAT MMDELDP0 FOR LINE01         *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #C        BEGSR                                          S01136
     C*                                                                   S01136
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?                               S01136
     C*                                                                   S01136
     C**   DEAL TYPE TEXT                                                 S01136
     C                     MOVE *BLANKS   DTYPW                           S01157
     C**********           MOVELDTYP      DTYPW                                        E22567 249976
     C                     MOVELHKMTYP    DTYPW                                               249976
     C                     MOVE *BLANKS   STWK    3                       S01136
     C                     MOVEL'-'       STWK                            S01136
     C**********           MOVE DLST      STWK                                         S01136 262285
     C**********           MOVE STWK      DTYPW                                        S01136 249976
     C                     MOVE HKSTYP    STWK                                                249976
     C                     MOVE STWK      DTYPW                                               262285
     C**********           MOVE CLAS      CLASW                                        CDL038 249976
     C                     MOVE HKCLAS    CLASW                                               249976
     C                     MOVE ' '       BYSLW                                               CDL038
     C                     MOVE HKCCY     CCY                                                 249976
     C*                                                                   S01136
     C** FORMAT THE DATES                                                 S01136
     C                     EXSR #K                                        S01136
     C                     MOVEL@MDT      NARR1                           S01136
     C*                                                                   S01136
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY     S01136
     C**********           TESTB'2'       DSTI       55                                       249976
     C**N55*****           TESTB'3'       DSTI       55                                       249976
     C********** *IN55     IFEQ '1'                        B1                          S01136 249976
     C           HKFEDF    IFEQ 'Y'                        B1                                 249976
     C           CCY       IFEQ BLUSCY                     B*2            S01194
     C                     MOVE 'F'       FFIN             **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C** TAKE LDI AMOUNT AND EDIT.                                        S01136
     C                     Z-ADDHKAMNP    @@IAMT 150                                          249976
     C                     MOVE HKCCY     @@CCY   3                                           249976
     C                     Z-ADDHKCYDP    @@CDP   10                                          249976
     C**********           Z-ADDPCPL      @@IAMT 150                                   S01136 249976
     C**********           MOVE CCY       @@CCY   3                                    S01136 249976
     C                     Z-ADD16        @@CRET  20                      S01136
     C**********           MOVE CCY       XXCCY                                        S01136 249976
     C**********           EXSR #L                                                            249976
     C**********           Z-ADDA6NBDP    @@CDP   10                                   S01136 249976
     C                     EXSR ZA0750                                    S01136
     C                     MOVE @@ADSP    AMT1W                           S01136
     C*                                                                   S01136
     C** SET ASSOCIATED DEAL NUMBER                                       S01136
     C**********           MOVELLNKDN     RDNO                                         S01136 249976
     C                     MOVELHKDADN    RDNO                                                249976
     C*                                                                   S01136
     C*                                                                   S01136
     C           #C9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #D          -  FORMAT MMDENBP0 FOR LINE01         *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #D        BEGSR                                          S01136
     C*                                                                   S01136
     C**   DEAL TYPE TEXT                                                 S01136
     C                     MOVE *BLANKS   DTYPW                           S01157
     C**********           MOVELDTYP      DTYPW                                        E22567 249976
     C                     MOVELHLMTYP    DTYPW                                               249976
     C                     MOVE *BLANKS   STWK    3                       S01136
     C                     MOVEL'-'       STWK                            S01136
     C**********           MOVE DLST      STWK                                         S01136 249976
     C                     MOVE HLSTYP    STWK                            S01136
     C                     MOVE STWK      DTYPW                           S01136
     C**********           MOVE CLAS      CLASW                                        CDL038 249976
     C                     MOVE HLCLAS    CLASW                                               249976
     C                     MOVE ' '       BYSLW                                               CDL038
     C*                                                                   S01136
     C** FORMAT ASSOCIATED DATES                                          S01136
     C                     EXSR #K                                        S01136
     C                     MOVEL@MDT      NARR1                           S01136
     C                     MOVE HLCCY     CCY                                                 249976
     C*                                                                   S01136
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY     S01136
     C**********           TESTB'2'       DSTI       55                                       249976
     C**N55*****           TESTB'3'       DSTI       55                                       249976
     C********** *IN55     IFEQ '1'                        B1                          S01136 249976
     C           HLFEDF    IFEQ 'Y'                        B1                                 249976
     C           CCY       IFEQ BLUSCY                     B*2            S01194
     C                     MOVE 'F'       FFIN             **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C** TAKE NAB AMOUNT AND EDIT.                                        S01136
     C**********           MOVE PUPR      @@IAMT 150                                   S01136 249976
     C**********           MOVE CCY       @@CCY   3                                    S01136 249976
     C                     MOVE HLAMNP    @@IAMT 150                                          249976
     C                     MOVE HLCCY     @@CCY   3                                           249976
     C                     Z-ADD16        @@CRET  20                      S01136
     C                     MOVE HLCYDP    @@CDP   10                                          249976
     C**********           MOVE CCY       XXCCY                                        S01136 249976
     C**********           EXSR #L                                                            249976
     C**********           Z-ADDA6NBDP    @@CDP   10                                   S01136 249976
     C                     EXSR ZA0750                                    S01136
     C                     MOVE @@ADSP    AMT1W                           S01136
     C*                                                                   S01136
     C** SET ASSOCIATED DEAL NUMBER                                       S01136
     C**********           MOVELLNKDN     RDNO                                         S01136 249976
     C                     MOVELHLDADN    RDNO                                                249976
     C*                                                                   S01136
     C           #D9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #E          -  FORMAT MMDENSP0 FOR LINE01         *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -  LINE01                                         *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #E        BEGSR                                          S01136
     C*                                                                   S01136
     C**   DEAL TYPE TEXT                                                 S01136
     C                     MOVE *BLANKS   DTYPW                           S01157
     C**********           MOVELDTYP      DTYPW                                        E22567 249976
     C                     MOVELHMMTYP    DTYPW                                               249976
     C                     MOVE *BLANKS   STWK    3                       S01136
     C                     MOVEL'-'       STWK                            S01136
     C**********           MOVE DLST      STWK                            S01136       S01136 249976
     C                     MOVE HMSTYP    STWK                                                249976
     C                     MOVE STWK      DTYPW                           S01136
     C**********           MOVE CLAS      CLASW                                        CDL038 249976
     C                     MOVE HMCLAS    CLASW                                               249976
     C                     MOVE ' '       BYSLW                                               CDL038
     C*                                                                   S01136
     C** FORMAT ASSOCIATED DATES                                          S01136
     C                     EXSR #K                                        S01136
     C                     MOVEL@MDT      NARR1                           S01136
     C                     MOVE HMCCY     CCY                                                 249976
     C*                                                                   S01136
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY     S01136
     C**********           TESTB'2'       DSTI       55                                       249976
     C**N55*****           TESTB'3'       DSTI       55                                       249976
     C********** *IN55     IFEQ '1'                        B1                          S01136 249976
     C           HMFEDF    IFEQ 'Y'                        B1                                 249976
     C           CCY       IFEQ BLUSCY                     B*2            S01194
     C                     MOVE 'F'       FFIN             **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C** TAKE NAS AMOUNT AND EDIT.                                        S01136
     C**********           Z-ADDSAPR      @@IAMT                                       S01136 249976
     C**********           MOVE CCY       @@CCY                                        S01136 249976
     C                     Z-ADDHMAMNP    @@IAMT                                              249976
     C                     MOVE HMCCY     @@CCY                                               249976
     C                     Z-ADDHMCYDP    @@CDP                                               249976
     C                     Z-ADD16        @@CRET                          S01136
     C**********           MOVE CCY       XXCCY                                        S01136 249976
     C**********           EXSR #L                                                            249976
     C**********           Z-ADDA6NBDP    @@CDP                                        S01136 249976
     C                     EXSR ZA0750                                    S01136
     C                     MOVE @@ADSP    AMT1W                           S01136
     C*                                                                   S01136
     C** SET ASSOCIATED DEAL NUMBER                                       S01136
     C**********           MOVELRPDN      RDNO                                         S01136 249976
     C                     MOVELHMDADN    RDNO                                                249976
     C*                                                                   S01136
     C           #E9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #F          -  FORMAT FXDEALP0 FOR LINE02                     *   E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #F        BEGSR                                          S01136
     C*                                                                   S01136
     C** SET UP DEAL STATUS INDICATORS                                    S01136
     C                     EXSR #J                                        S01136
     C*                                                                   S01136
     C** CHECK DEAL TYPE FOR F-X.IS IT AN OPTION...?                      S01136
     C********** DTYP      IFEQ 'OP'                       B1                          S01136 249976
     C           FHTYPE    IFEQ 'OP'                       B1                                 249976
     C                     MOVEATXT,1     LIN,7            *1             S01136
     C*                                                                   S01136
     C** FORMAT OPTION TO DATE                                            S01136
     C                     Z-ADD@ODAT     @@DTIN           *1             S01136
     C                     EXSR ZA0660                     *1             S01136
     C                     MOVEA@@DATE    LIN,18           *1             S01136
     C*                                                                   S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C** SET UP FIELD FOR THE DISPLAY.                                    S01136
     C                     MOVEATXT,2     LIN,30                          S01136
     C                     MOVEA@@DSCC    LIN,35                          S01136
     C*                                                                   S01136
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY     S01136
     C**********           TESTB'2'       DSTI       55                                       249976
     C**N55*****           TESTB'3'       DSTI       55                                       249976
     C********** *IN55     IFEQ '1'                        B1             S01136              249976
     C           FHFEDF    IFEQ 'Y'                        B1                                 249976
     C           @@DSCC    IFEQ BLUSCY                     B*2            S01194
     C                     MOVEA'F'       LIN,41           **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C** ACCESS CURRENCY TABLE                                            S01136
     C                     MOVE @@DSCC    XXCCY   3                       S01194
     C                     EXSR #L                                        S01194
     C*                                                                   S01136
     C           *INU7     CABEQ'1'       #F9                             S01136
     C*                                                                   S01136
     C*                                                                   S01136
     C** FORMAT THE PURCHASE AMOUNT                                       S01136
     C                     MOVE @@DSCC    @@CCY                           S01136
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     Z-ADD@@DSAM    @@IAMT                          S01136
     C                     Z-ADD16        @@CRET                          S01136
     C                     EXSR ZA0750                                    S01136
     C*                                                                   S01136
     C** @@ADSP  21A FIELD IS MOVED IN TO  SLAMWF 16A FIELD               S01136
     C** AS SALE AMOUNT DOESN'T ALIGN WITH PURCHASE AMOUNT                S01136
0725 C                     MOVE @@ADSP    SLAMWF                          S01119
     C                     MOVEASLAMWF    LIN,42                          S01136
     C*                                                                   S01136
     C           #F9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #G          -  FORMAT MMDELDP0 FOR LINE02         *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #G        BEGSR                                          S01136
     C*                                                                   S01136
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?                               S01136
     C*                                                                   S01136
     C** SET UP DEAL STATUS INDICATORS
     C                     EXSR #J                                        S01136
     C*                                                                   S01136
     C** FORMAT BASE RATE FIELD                                           S01136
     C                     MOVEATXT,3     LIN,8                           S01136
     C*                                                                   S01136
     C** FORMAT THE INTEREST RATE/SPREAD                                  S01136
     C                     MOVEATXT,4     LIN,28                          S01136
     C********** BRTT      IFEQ 00                         B1                          E27537 249976
     C           HKBSRC    IFEQ *BLANKS                                                       249976
     C           HKBSRC    OREQ '00'                                                          249976
     C                     MOVEA'00'      LIN,19                                              249976
     C                     MOVE HKIIRT    @@INPR                                              249976
     C**********           MOVE BRTT      BRTTWF  2                                           249976
     C**********           MOVEABRTTWF    LIN,19                                       S01119 249976
     C/COPY WNCPYSRC,DL0121C032
     C**********           MOVE INTR      @@INPR           *1                          S01136 249976
     C/COPY WNCPYSRC,DL0121C033
     C                     EXSR MM1013                     *1             S01136
     C                     MOVEA@@OUTR    LIN,44           *1             S01136
     C*                                                                   S01136
     C                     ELSE                            X1             S01136
     C**********           MOVE BRTT      BRTTA   2        *1                          S01136 249976
     C**********           MOVEABRTTA     LIN,19           *1                          S01136 249976
     C/COPY WNCPYSRC,DL0121C034
     C**********           MOVE RTSP      @@INPR           *1                          S01136 249976
     C/COPY WNCPYSRC,DL0121C035
     C                     MOVEAHKBSRC    LIN,19                                              249976
     C                     MOVE HKSPRD    @@INPR                                              249976
     C                     EXSR MM1013                     *1             S01136
     C                     MOVEA@@OUTR    LIN,44           *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C           #G9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #H          -  FORMAT MMDENBP0 LINE 02            *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -                                                 *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #H        BEGSR                                          S01136
     C*                                                                   S01136
     C** SET UP DEAL STATUS INDICATORS          .                         S01136
     C                     EXSR #J                                        S01136
     C*                                                                   S01136
     C** FORMAT THE YIELD.                                                S01136
     C                     MOVEATXT,5     LIN,8                           S01136
     C**********           MOVE INTR      @@INPR                                       S01136 249976
     C           HLMTYP    IFEQ 'C1'                                                          249976
     C           HLMTYP    OREQ 'C2'                                                          249976
     C           HLMTYP    OREQ 'BP'                                                          249976
     C           HLMTYP    OREQ 'BD'                                                          249976
     C                     MOVE HLINTR    @@INPR                                              249976
     C                     ELSE                                                               249976
     C                     MOVE HLDCRT    @@INPR                                              249976
     C                     END                                                                249976
     C                     EXSR MM1013                                    S01136
     C                     MOVEA@@OUTR    LIN,13                          S01136
     C*                                                                   S01136
     C** FORMAT THE INTEREST RATE/SPREAD.                                 S01136
     C                     MOVEATXT,4     LIN,28                          S01136
     C**********           MOVE RTSP      @@INPR                                       S01136 249976
     C                     MOVE HLFRAT    @@INPR                                              249976
     C                     EXSR MM1013                                    S01136
     C                     MOVEA@@OUTR    LIN,44                          S01136
     C*                                                                   S01136
     C** If parcelled NA set up parcel fields                             S01378
     C********** PCLI      IFEQ 'P'                                                    S01378 249976
     C           HLPCLI    IFEQ 'P'                                                           249976
     C                     MOVEATXT,12    LIN,58                          S01378
     C**********           Z-ADDPSZE      @INNUM                                       S01378 249976
     C                     Z-ADDHLPSZE    @INNUM                                              249976
     C                     EXSR PFMT                                      S01378
     C                     MOVEA@OUTCR    LIN,63                          S01378
     C                     END                                            S01378
     C*                                                                   S01378
     C           #H9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #I          -  FORMAT MMDENSP0                    *               E20251
     C*                                                               *   S01136
     C* CALLS                                                         *   S01136
     C*                                                               *   S01136
     C* CALLED BY   -  LINE01                                         *   S01136
     C*                                                               *   S01136
     C* FLDS USED                                                     *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #I        BEGSR                                          S01136
     C*                                                                   S01136
     C** SET UP DEAL STATUS INDICATORS                                    S01136
     C                     EXSR #J                                        S01136
     C*                                                                   S01136
     C** FORMAT THE YIELD.                                                S01136
     C                     MOVEATXT,5     LIN,8                           S01136
     C**********           MOVE INTR      @@INPR                                       S01136 249976
     C                     MOVE HMINTR    @@INPR                                              249976
     C                     EXSR MM1013                                    S01136
     C                     MOVEA@@OUTR    LIN,13                          S01136
     C*                                                                   S01136
     C** If parcelled NA set up parcelling fields                         S01378
     C********** PCLI      IFEQ 'P'                                                    S01378 249976
     C           HMPCLI    IFEQ 'P'                                                           249976
     C                     MOVEATXT,12    LIN,56                          S01378
     C**********           Z-ADDPSZE      @INNUM                                       S01378 249976
     C                     Z-ADDHMPSZE    @INNUM                                              249976
     C                     EXSR PFMT                                      S01378
     C                     MOVEA@OUTCR    LIN,61                          S01378
     C                     END                                            S01378
     C*                                                                   S01378
     C           #I9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01378
     C*****************************************************************   S01378
     C*                                                               *   S01378
     C* PFMT        -  Format 5,0 field to a 5A field with            *   S01378
     C*                leading zeros suppressed                       *   S01378
     C* CALLS                                                         *   S01378
     C*                                                               *   S01378
     C* CALLED BY   -                                                 *   S01378
     C*                                                               *   S01378
     C* FLDS USED                                                     *   S01378
     C*                                                               *   S01378
     C*****************************************************************   S01378
     C           PFMT      BEGSR                                          S01378
      *                                                                   S01378
      ** reset work fields                                                S01378
     C                     MOVE *BLANKS   @OUT                            S01378
     C                     Z-ADD*ZERO     J                               S01378
      *                                                                   S01378
      ** transfer numeric input field to character array                  S01378
     C           *LIKE     DEFN PSZE      @INNUM                          S01378
     C                     MOVE @INNUM    @INCHR  5                       S01378
     C                     MOVEA@INCHR    @IN                             S01378
      *                                                                   S01378
      ** work through field looking for first non zero character          S01378
     C           J         DOUEQ5                          B1             S01378
     C                     ADD  1         J                *1             S01378
      *                                                                   S01378
      ** once first non zero character is found fill up @OUT and exit     S01378
     C           @IN,J     IFNE '0'                        B*2            S01378
     C                     MOVEA@IN,J     @OUT,J           **2            S01378
     C                     Z-ADD5         J                **2            S01378
     C                     END                             E*2            S01378
     C                     END                             E1             S01378
     C                     MOVEA@OUT      @OUTCR  5                       S01378
      *                                                                   S01378
     C                     ENDSR                                          S01378
     C*****************************************************************   S01378
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #K          - FORMATING OF DEAL DONE AND VALUE DATE           *   S01136
     C*                                                               *   S01136
     C* CALLS       - ZA0660                                          *   S01136
     C*                                                               *   S01136
     C* CALLED BY   - #B                                              *   S01136
     C*             - #C                                              *   S01136
     C*             - #D                                              *   S01136
     C*             - #E                                              *   S01136
     C*                                                               *   S01136
     C* FLDS USED   @VDAT   - VALUE DATE                              *   S01136
     C*             @DDAT   - DEAL DONE DATE                          *   S01136
     C*             @MDAT   - MATURITY DATE                           *   S01136
     C*             @@DTIN  - INPUT DATE TO ZA0660                    *   S01136
     C*             @@DATE  - OUTPUT DATE FROM ZA0660                 *   S01136
     C*             DDATE   - DEAL DONE DATE                          *   S01136
     C*             VDATE   - VALUE DATE                              *   S01136
     C*             ODATE   - OPTION TO DATE                          *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #K        BEGSR                                          S01136
     C*                                                                   S01136
     C** FORMAT DEAL VALUE AND DEAL DONE DATE.                            S01136
     C                     MOVE @VDAT     @@DTIN                          S01136
     C                     EXSR ZA0660                                    S01136
     C                     MOVE @@DATE    VDATE                           S01136
     C*                                                                   S01136
     C                     MOVE @DDAT     @@DTIN                          S01136
     C                     EXSR ZA0660                                    S01136
     C                     MOVE @@DATE    DDATE                           S01136
     C*                                                                   S01136
     C           @INDS     IFEQ 'MMDELDP0'                 B1             S01136
     C           @INDS     OREQ 'MMDENBP0'                 X1             S01136
     C           @INDS     OREQ 'MMDELDP1'                                S01311
     C           @INDS     OREQ 'MMDENBP1'                                S01311
     C           @INDS     OREQ 'MMDELDP4'                                                    249976
     C           @INDS     OREQ 'MMDELDP5'                                                    249976
     C           @INDS     OREQ 'MMDENBP4'                                                    249976
     C           @INDS     OREQ 'MMDENBP5'                                                    249976
     C*                                                                   S01136
     C           @MDAT     IFNE *ZEROS                     B*2            S01136
     C                     MOVE @MDAT     @@DTIN           **2            S01136
     C                     EXSR ZA0660                     **2            S01136
     C                     MOVE @@DATE    @MDT    7        **2            S01136
     C                     ELSE                            X*2            S01136
     C*                                                                   S01136
     C           @INDS     IFEQ 'MMDELDP0'                 B**3           S01136
     C           @INDS     OREQ 'MMDELDP1'                                S01311
     C           @INDS     OREQ 'MMDELDP4'                                                    249976
     C           @INDS     OREQ 'MMDELDP5'                                                    249976
     C*                                                                   S01136
     C********** NOTD      IFEQ 000                        B***4                       S01136 249976
     C           HKNTCE    IFEQ 000                                                           249976
     C                     MOVE ' CALL  ' @MDT             ****4          S01136
     C                     ELSE                            X***4          S01136
     C**********           MOVELNOTD      @MDT             ****4                       S01136 249976
     C                     MOVELHKNTCE    @MDT                                                249976
     C                     MOVE 'DAYS'    @MDT             ****4          S01136
     C                     END                             E***4          S01136
     C*                                                                   S01136
     C                     ELSE                            X**3           S01136
     C*                                                                   S01136
     C                     MOVE ' CALL  ' @MDT             ***3           S01136
     C*                                                                   S01136
     C                     END                             E**3           S01136
     C*                                                                   S01136
     C                     END                             E*2            S01136
     C*                                                                   S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C           #K9       ENDSR                                          S01136
     C****************************************************************    S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* #J          - SET UP DEAL STATUS                              *   S01136
     C*                                                               *   S01136
     C* CALLS       -                                                 *   S01136
     C*                                                               *   S01136
     C* CALLED BY   - #F                                              *   S01136
     C*             - #G                                              *   S01136
     C*             - #H                                              *   S01136
     C*             - #I                                              *   S01136
     C*                                                               *   S01136
     C* FLDS USED   TEXT    - DISPLAY FIELD                           *   S01136
     C*             @FEDF   - FEDERAL FUND WORK FIELD                 *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           #J        BEGSR                                          S01136
     C*                                                                   S01136
     C** CHECK IF DEAL HAS BEEN DELETED                                   S01136
     C           DLREC     IFEQ 'D'                        B1             S01136
     C           FHLCD     IFEQ BJRDNB                                                        249976
     C           HKLCD     OREQ BJRDNB                                                        249976
     C           HLLCD     OREQ BJRDNB                                                        249976
     C           HMLCD     OREQ BJRDNB                                                        249976
     C                     MOVE 'DELETED 'TEXT             *1             S01136
     C                     ELSE                                                               249976
     C                     MOVE 'REVERSED'TEXT                                                249976
     C                     END                                                                249976
     C**********           MOVE HEX20     ZF2              *1             S01136              CAAA03
     C**********           MOVELHEX21     ZF1              *1             S01136              CAAA03
     C**********           MOVELHEX22     LIN,1            *1             S01136              CAAA03
     C                     MOVELTEXT      LIN,1                                               CAAA03
     C                     MOVE '0'       *IN54            *1             S01136
     C                     ELSE                            X1             S01136
     C*                                                                   S01136
     C** SET UP DEAL STATUS INDICATORS                                    S01136
     C           RECIC     LOKUPTABA      TABB           56               S01136
     C           *IN56     IFEQ '1'                        B1             S01136
     C                     MOVE TABB      TEXT             *1             S01136
     C**********           MOVE HEX20     ZF2              **2            S01136              CAAA03
     C**********           MOVELHEX21     ZF1              **2            S01136              CAAA03
     C**********           MOVELHEX22     LIN,1            **2            S01136              CAAA03
     C                     MOVELTEXT      LIN,1                                               CAAA03
     C                     MOVE '0'       *IN54            **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C           #J9       ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C/COPY WNCPYSRC,DL0121C017
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C*       SUBROUTINE ZA0670 - THIS SUBROUTINE IS USED TO FIND     *   S01136
     C*       WHICH CCY AND WHICH AMOUNT IS BUY AND WHICH IS SELL.    *   S01136
     C*                                                               *   S01136
     C*       IF DEAL FIRST AMOUNT IS >0 THEN FIRST IS BUY            *   S01136
     C*       ELSE FIRST IS SELL.                                     *   S01136
     C*                                                               *   S01136
     C*       CALLED BY: #BBC FORMATING OF DRS DEALS  FOR OUTPUT      *   S01136
     C*                                                               *   S01136
     C*       CALLS:                                                  *   S01136
     C*       INPUT: FHDAM1 - DEAL FIRST AMOUNT                       *   S01136
     C*              FHDAM2 - DEAL SECOND AMOUNT                      *   S01136
     C*              FHCCY1 - DEAL FIRST CURRENCY                     *   S01136
     C*              FHCCY2 - DEAL SECOND CURRENCY                    *   S01136
     C*      OUTPUT: @@DBAM - DEAL BUY AMOUNT                         *   S01136
     C*              @@DSAM - DEAL SELL AMOUNT                        *   S01136
     C*              @@DBCC - DEAL BUY CURRENCY                       *   S01136
     C*              @@DSCC - DEAL SELL CURRENCY                      *   S01136
     C*        USES:                                                  *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C*                                                                   S01136
     C*                                                                   S01136
     C           ZA0670    BEGSR                                          S01136
      *                                                                                       249976
     C           FHDAM1    IFGT 0                                                             249976
     C                     Z-ADDFHDAM1    @@DBAM 150                                          249976
     C                     MOVE FHCCY1    @@DBCC  3                                           249976
     C                     Z-SUBFHDAM2    @@DSAM 150                                          249976
     C                     MOVE FHCCY2    @@DSCC  3                                           249976
     C                     ELSE                                                               249976
     C                     Z-SUBFHDAM1    @@DSAM                                              249976
     C                     MOVE FHCCY1    @@DSCC                                              249976
     C                     Z-ADDFHDAM2    @@DBAM                                              249976
     C                     MOVE FHCCY2    @@DBCC                                              249976
     C                     END                                                                249976
      *                                                                                       249976
     C********** PUAM      IFGT 0                                                      S01136 249976
     C**********           Z-ADDPUAM      @@DBAM 150                                   S01136 249976
     C**********           MOVE PUCY      @@DBCC  3                                    S01136 249976
     C**********           Z-SUBSLAM      @@DSAM 150                                   S01136 249976
     C**********           MOVE SLCY      @@DSCC  3                                    S01136 249976
     C**********           ELSE                                                        S01136 249976
     C**********           Z-SUBPUAM      @@DSAM                                       S01136 249976
     C**********           MOVE PUCY      @@DSCC                                       S01136 249976
     C**********           Z-ADDSLAM      @@DBAM                                       S01136 249976
     C**********           MOVE SLCY      @@DBCC                                       S01136 249976
     C**********           END                                                         S01136 249976
     C*                                                                   S01136
     C           ZA0679    ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C****************************************************************    S01136
     C*                                                              *    S01136
     C*                                                              *    S01136
     C*     MIDAS/DRS - STANDING DATA MODULE                         *    S01136
     C*                                                              *    S01136
     C*     ZA0750 -  CONVERT AMOUNT TO DISPLAY -38                  *    S01136
     C*                                                              *    S01136
     C*     AMEND NO. 000001                  DATE   04/07/86        *    S01136
     C*                                                              *    S01136
     C*       CALLED BY: #BBC FORMATING OF DRS DEALS  FOR OUTPUT     *    S01136
     C*                                                              *    S01136
     C*       CALLS:                                                 *    S01136
     C*                                                              *    S01136
     C*       INPUT: @@IAMT 15,0 (INPUT AMOUNT)                      *    S01136
     C*              @@CCY  3A   (INPUT CURRENCY)                    *    S01136
     C*              @@CRET 2,0  (NUMBER OF CHARACTERS TO RETURN)    *    S01136
     C*              @@CDP  1,0  (CURRENCY DECIMAL PLACES)           *    S01136
     C*                                                              *    S01136
     C*      OUTPUT: @@ADSP 21A    (AMOUNT TO DISPLAY)               *    S01136
     C*                                                              *    S01136
     C*        USES:                                                 *    S01136
     C*                                                              *    S01136
     C****************************************************************    S01136
     C*                                                                   S01136
     C           ZA0750    BEGSR                                          S01136
     C*                                                                   S01136
     C*          INITIALISE ARRAYS                                        S01136
     C*                                                                   S01136
     C                     MOVEA*BLANKS   @E                              S01136
     C                     MOVEA*BLANKS   @C                              S01136
     C*                                                                   E20901
     C*          AFTER '-' SIGN PLACED IN  @E CHANGE @@IAMT TO +VE        E20901
     C*                AND MOVE BLANK TO SIGN FIELD                       E20901
     C*                                                                   E20901
     C           @@IAMT    IFLT 0                          B1             E20901
     C                     Z-SUB@@IAMT    @@IAMT           *1             E20901
     C                     END                             E1             E20901
     C                     MOVE ' '       @E,21            *1             E20901
     C*                                                                   S01136
     C*          MOVE INPUT AMOUNT TO @D                                  S01136
     C*                                                                   S01136
     C                     MOVEA@@AMDS    @D                              S01136
     C*                                                                   S01136
     C*          MOVE DECIMAL PORTION OF AMOUNT TO @E                     S01136
     C*                                                                   S01136
     C                     Z-ADD15        @@C     20                      S01136
     C                     Z-ADD20        @@D     20                      S01136
     C*                                                                   S01136
     C           20        SUB  @@CDP     @@MAX   20                      S01136
     C           @@D       DOWGT@@MAX                      B1             S01136
     C                     MOVE @D,@@C    @E,@@D           *1             S01136
     C                     SUB  1         @@C              *1             S01136
     C                     SUB  1         @@D              *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C*          MOVE DECIMAL SEPARATOR TO @E                             S01136
     C*                                                                   S01136
     C           @@CDP     IFNE 0                          B1             S01136
     C***********          MOVE IDDCSP    @E,@@D           *1      S01136 S01319
     C                     MOVE BNDCSP    @E,@@D           *1             S01319
     C                     SUB  1         @@D              *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C*          FIND POSITION OF LAST CHARACTER TO BE MOVED              S01136
     C*                                                                   S01136
     C                     Z-ADD1         @@E     20                      S01136
     C*                                                                   S01136
     C           @@E       DOWLT15                         B1             S01136
     C           @D,@@E    ANDEQ'0'                        *1             S01136
     C                     ADD  1         @@E              *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C*          MOVE INTEGER PORTION OF AMOUNT TO @E                     S01136
     C*                                                                   S01136
     C                     Z-ADD0         @@CNT1  20                      S01136
     C                     Z-ADD0         @@CNT2  20                      S01136
     C*                                                                   S01136
     C           @@C       DOWGT@@E                        B1             S01136
     C                     MOVE @D,@@C    @E,@@D           *1             S01136
     C                     ADD  1         @@CNT1           *1             S01136
     C                     SUB  1         @@C              *1             S01136
     C                     SUB  1         @@D              *1             S01136
     C*                                                                   S01136
     C*          INSERT THOUSAND SEPARATORS                               S01136
     C*                                                                   S01136
     C           @@CNT1    DIV  3         @@RES   20       *1             S01136
     C                     MVR            @@REMD  10       *1             S01136
     C           @@REMD    IFEQ 0                          B*2            S01136
     C           @@CNT2    ANDLT5                          **2            S01136
     C**********           MOVE IDTHSP    @E,@@D           **2     S01136 S01319
     C                     MOVE BNTHSP    @E,@@D           **2            S01319
     C                     ADD  1         @@CNT2           **2            S01136
     C                     Z-ADD@@D       @@F     20       **2            S01136
     C                     SUB  1         @@D              **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C*          MOVE LAST CHARACTER                                      S01136
     C*                                                                   S01136
     C                     MOVE @D,@@C    @E,@@D                          S01136
     C*                                                                   S01136
     C*          IF NUMBER OF CHARACTERS MOVED IS GREATER THAN NUMBER     S01136
     C*        TO BE RETURNED DROP THOUSAND SEPARATORS TILL SATISFIED     S01136
     C*                                                                   S01136
     C           22        SUB  @@D       @@CMOV  20                      S01136
     C           @@CMOV    SUB  @@CRET    @@DIFF  20                      S01136
     C           @@DIFF    IFGT 0                          B1             S01136
     C                     DO   @@DIFF                     B*2            S01136
     C                     Z-ADD1         @@G     20       **2            S01136
     C                     Z-ADD2         @@H     20       **2            S01136
     C           @@G       DOWLE21                         B**3           S01136
     C                     MOVE @E,@@G    @C,@@H           ***3           S01136
     C                     ADD  1         @@G              ***3           S01136
     C                     ADD  1         @@H              ***3           S01136
     C           @@G       IFEQ @@F                        B***4          S01136
     C                     ADD  1         @@G              ****4          S01136
     C                     END                             E***4          S01136
     C                     END                             E**3           S01136
     C                     MOVEA@C        @E               **2            S01136
     C                     ADD  4         @@F              **2            S01136
     C                     END                             E*2            S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C*          MOVE @E TO DISPLAY FIELD                                 S01136
     C*                                                                   S01136
     C                     MOVEA@E        @@ADSP 21                       S01136
     C           ZA0759    ENDSR                                          S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01194
     C*       SUBROUTINE #L - THIS SUBROUTINE CHAINS THE CURRENCIES   *   S01194
     C*       FILE VIA THE ACCESS PROGRAM.                            *   S01194
     C*       INDICATOR 60 IS SET ON IF THE RECORD IS NOT PRESENT.    *   S01194
     C*       IF INDICATOR IS SET ON INFORMATION ABOUT THE NATURE     *   S01194
     C*       OF THE ATTEMPTED FILE ACCESS WILL BE PLACED IN THE LDA. *   S01194
     C*                                                               *   S01194
     C*       CALLS       - AOCURRR0                                  *   S01194
     C*                                                               *   S01194
     C*       CALLED BY   - #B, #F                                    *   S01194
     C*                                                               *   S01194
     C*       FIELDS USED : XXCCY  - INPUT PARM FOR ACCESS PROGRAM    *   S01194
     C*                     @RTCD  - OUTPUT PARM FOR ACCESS PROGRAM   *   S01194
     C*                                                               *   S01194
     C*****************************************************************   S01194
     C*                                                                   S01194
     C           #L        BEGSR                                          S01194
     C*                                                                   S01194
     C**  SET OFF INDICATOR                                               S01194
     C                     MOVE '0'       *IN60                           S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM XXCCY     @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C**  CHECK FOR ERROR ON RETURN                                       S01194
     C           @RTCD     IFNE *BLANKS                    B1             S01194
     C                     MOVE '1'       *IN60            *1             S01194
     C                     MOVEL'SDCURRPD'DBFILE           *************  S01194
     C                     MOVELXXCCY     DBKEY            * DBERR 908 *  S01194
     C                     MOVEL'908'     DBASE            *************  S01194
     C                     SETON                     U7U8LR*1             S01194
     C                     EXSR *PSSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C           #L9       ENDSR                                          S01194
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* MM1013 - Subroutine to convert a rate to display, with sign   *   S01136
     C*                                                               *   S01136
     C* CALLED BY : #BBC FORMATING OF DRS DEALS FOR OUTPUT            *   S01136
     C*                                                               *   S01136
     C* CALLS :                                                       *   S01136
     C*                                                               *   S01136
     C* INPUT  : @@INPR Rate to be edited.                            *   S01136
     C*                                                               *   S01136
     C* OUTPUT : @@OUTR Edited output rate.                           *   S01136
     C*                                                               *   S01136
     C* USES :   @@INPR Rate to be edited.                            *   S01136
     C*          @@OUTR Edited output rate.                           *   S01136
     C*          @@DECS Field to hold decimal digits for input rate.  *   S01136
     C*          @@INTS Field to hold integers for input rate.        *   S01136
     C*          @@N    Counter field.                                *   S01136
     C*          @@Q    Second counter field.                         *   S01136
     C*          @@STRP Rate start position after zero suppression.   *   S01136
     C*          @W     Work array.                                   *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           MM1013    BEGSR                                          S01136
     C*                                                                   S01136
     C**  Define fields used.                                             S01136
     C                     Z-ADD@@INPR    @@INPR 117                      S01136
     C                     MOVE *BLANKS   @@OUTR 13                       S01136
     C                     MOVE *BLANKS   @@DECS  7                       S01136
     C                     MOVE *BLANKS   @@INTS  4                       S01136
     C                     Z-ADD0         @@N     20                      S01136
     C                     Z-ADD0         @@Q     20                      S01136
     C                     Z-ADD0         @@STRP  20                      S01136
     C*                                                                   S01136
     C**  Initialise work array.                                          S01136
     C                     MOVEA*BLANKS   @W                              S01136
     C*                                                                   S01136
     C**  If the rate is negative the sign must be printed.               S01136
     C           @@INPR    IFLT 0                          B1             S01136
     C                     MOVE '-'       @W,13            *1             S01136
     C                     Z-SUB@@INPR    @@INPR           *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C**  Seperate integers and decimal digits into two fields.           S01136
     C                     MOVE @@INPR    @@DECS                          S01136
     C                     MOVEL@@INPR    @@INTS                          S01136
     C*                                                                   S01136
     C**  Move integers, decimal seperator and decimal digits into        S01136
     C**  work array.                                                     S01136
     C                     MOVEA@@INTS    @W                              S01136
     C**********           MOVE IDDCSP    @W,5                     S01136 S01319
     C                     MOVE BNDCSP    @W,5                            S01319
     C                     MOVEA@@DECS    @W,6                            S01136
     C*                                                                   S01136
     C**  Remove leading zeros from the rate and replace with blanks.     S01136
     C                     Z-ADD1         @@N                             S01136
     C           @@N       DOWLE3                          B1             S01136
     C           @W,@@N    ANDEQ'0'                        X1             S01136
     C                     MOVE *BLANK    @W,@@N           *1             S01136
     C                     ADD  1         @@N              *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C                     Z-ADD@@N       @@STRP                          S01136
     C*                                                                   S01136
     C**  Truncate trailing zeros and replace with blanks. If rate is     S01136
     C**  an integer a single zero after the decimal place should be      S01136
     C**  displayed.                                                      S01136
     C                     Z-ADD12        @@N                             S01136
     C           @@N       DOWGE7                          B1             S01136
     C           @W,@@N    ANDEQ'0'                        X1             S01136
     C                     MOVE *BLANK    @W,@@N           *1             S01136
     C                     SUB  1         @@N              *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C**  Right justify the array.                                        S01136
     C                     Z-ADD12        @@Q                             S01136
     C           @@N       IFNE @@Q                        B1             S01136
     C           @@N       DOWGE@@STRP                       B2           S01136
     C                     MOVE @W,@@N    @W,@@Q             *2           S01136
     C                     MOVE *BLANK    @W,@@N             *2           S01136
     C                     SUB  1         @@N                *2           S01136
     C                     SUB  1         @@Q                *2           S01136
     C                     END                               E1           S01136
     C                     END                             E2             S01136
     C*                                                                   S01136
     C**  Move the final array into the output field.                     S01136
     C                     MOVEA@W        @@OUTR                          S01136
     C*                                                                   S01136
     C           M10139    ENDSR                           **M10139**     S01136
     C*****************************************************************   S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
     C*                                                               *   S01136
     C* ZA0660 - THIS SUBROUTINE CONVERTS DATE FORMAT YYYYMMDD TO     *   S01136
     C*          DDMMMYY FORMAT                                       *   S01136
     C*                                                               *   S01136
     C* CALLED BY :                                                   *   S01136
     C*                                                               *   S01136
     C* CALLS :                                                       *   S01136
     C*                                                               *   S01136
     C* INPUT  : @@DTIN DATE INPUT (YYYYMMDD)  - IN DATA STRUCTURE    *   S01136
     C*                                                               *   S01136
     C* OUTPUT : @@DATE DATE OUTPUT (DDMMMYY)                         *   S01136
     C*                                                               *   S01136
     C* USES :   @@MTH  MONTH NUMBER                                  *   S01136
     C*          @@MNM  MONTH SHORTNAME                               *   S01136
     C*          @@DAY  DAY NUMBER                                    *   S01136
     C*          @@YYYY YEAR (4 CHARACTER)                            *   S01136
     C*          @@DAT5 5A WORKFIELD                                  *   S01136
     C*          @MN    ARRAY OF MONTH SHORTNAMES                     *   S01136
     C*                                                               *   S01136
     C*     LAST AMEND NO. ME1257              DATE 02/04/87          *   S01136
     C*     When date input is zero set output date to blanks         *   S01136
     C*                                                               *   S01136
     C*****************************************************************   S01136
     C           ZA0660    BEGSR                                          S01136
     C*                                                                   S01136
     C           @@DTIN    IFNE 0                          B1             S01136
     C                     MOVE @@YYYY    @@DATE  7        *1             S01136
     C                     MOVE @MN,@@MTH @@DAT5  5        *1             S01136
     C                     MOVEL@@DAY     @@DAT5           *1             S01136
     C                     MOVEL@@DAT5    @@DATE           *1             S01136
     C                     ELSE                            X1             S01136
     C                     MOVE *BLANKS   @@DATE           *1             S01136
     C                     END                             E1             S01136
     C*                                                                   S01136
     C           ZA0669    ENDSR                           **ZA0669 TAG **S01136
     C/EJECT                                                              S01136
     C*****************************************************************   S01136
0739  *    RETSR SR END OF PROGRAM PROCESSING                             S01311
      **   CALLED FROM   CMDSR                                            S01311
      **   CALLS SR                                                       S01311
0418  *    This is a standard link enquiry subroutine for ending the      S01311
0418  *    program.                                                       S01311
0418  *    Indicators used                                                S01311
0418  *    LR  seton - terminate program                                  S01311
0741  *                                                                   S01311
0740 C           RETSR     BEGSR                                          S01311
0741  *                                                                   S01311
0742 C                     SETON                     LR                   S01311
0392  **  Access DL Data Area                                             S01311
0405 C           *LOCK     IN   DLSDS                                     S01311
0402 C                     MOVE RETNWF    RETND                           S01311
0405 C                     OUT  DLSDS                                     S01311
0743 C                     RETRN                                          S01311
0744  *                                                                   S01311
0745 C                     ENDSR                                          S01311
0746 C********************************************************************S01311
     C*                                                                   S01136
     C* *PSSR    -   ROUTINE CALLED ON FILE / PROGRAM ERROR               S01136
     C*                                                                   S01136
     C* CALLS           -                                                 S01136
     C*                                                                   S01136
     C* CALLED BY       -                                                 S01136
     C*                                                                   S01136
     C* FLDS USED       -                                                 S01136
     C*                                                                   S01136
     C*****************************************************************   S01136
     C           *PSSR     BEGSR                                          S01136
      *                                                                   S01311
      * Update Linked Enquiry Data Area with Return Code set to 'E',      S01311
      * set on error switch, dump program and return to calling           S01311
      * program                                                           S01311
      *                                                                   S01136
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
      *                                                                   S01311
     C           *LOCK     IN   DLSDS                                     S01311
     C                     MOVE 'E'       RETND                           S01311
     C                     OUT  DLSDS                                     S01311
      *                                                                   S01311
     C                     SETON                     U7U8LR               S01131
     C                     DUMP                                           S01136
     C                     END                                            S01131
      *                                                                   S01131
     C                     RETRN                                          S01131
      *                                                                   S01131
     C                     ENDSR                                          S01136
     C*                                                                   S01136
     C*****************************************************************   S01136
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
** TXT
OPTION TO
SALE
BASE RATE
INTEREST/SPREAD
YIELD
CEILING RATE
FLOOR RATE
OUR BASE RATE
THEIR BASE RATE
CONTRACT RATE
REFERENCE RATE
P'SZ                                                                      S01378
     X/COPY WNCPYSRC,DL0121X001
** ERR
ENTER CUSTOMER
INVALID CUSTOMER NUMBER
INVALID SHORTNAME
* NO DEALS ARE HELD FOR THIS CUSTOMER *
INVALID ENTRY CANNOT BOTH BE BLANK
INVALID ENTRY - ENTER 'Y'
INVALID ENTRY - ENTER '1'
USER IS NOT AUTHORISED TO ANY BOOKING BRANCHES                            LN0467
USER IS NOT AUTHORISED TO THE BOOKING BRANCH                              LN0467
INVALID BRANCH CODE                                                       LN0467
NO BANK AUTHORIZATION FOR USER                                            LN0467
* NO FX DEALS ARE HELD FOR THIS CUSTOMER *                                S01311
* NO MM DEALS ARE HELD FOR THIS CUSTOMER *                                S01311
* NO FRAs FOR THIS CUSTOMER *                                             S01332
* NO IRS' FOR THIS CUSTOMER *                                             S01332
INVALID ENTRY - ENTER 'FX','MM' OR BLANKS                                 AUS015
     X/COPY WNCPYSRC,DL0121X002
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** ZCOM - EDIT FORMAT FOR AMOUNT FIELD
   ,   ,   ,   ,  0
   ,   ,   ,   ,  0.
              0
              0.
** TABLE TABA & TABB FOR DEAL STATUS NARRATIVES                           S01136
CCOMP                                                                     S01136
AAUTH                                                                     S01136
RREAUTH                                                                   S01136
EEXPIRED                                                                  S01136
MMATURED                                                                  S01136
NHIST                                                                     E20251
