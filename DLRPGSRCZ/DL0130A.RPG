     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Cust./parent exp. against limits.')           *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Dealing Module                                       *
     F*                                                               *
     F***DL0130*-*CUSTOMER/PARENT EXPOSURE AGAINST LIMITS ENQUIRY.    *
     F*  DL0130A- CUSTOMER/PARENT EXPOSURE AGAINST LIMITS ENQUIRY.    *
     F*           (Formerly MM0067/CA0200)                            *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD058285           Date 22Jun21               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 240878             Date 03Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 20Apr04               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 217684             Date 12May03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 194042             Date 26Jul01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 133831             Date 15Oct99               *
     F*                 127551             Date 12Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 109454             Date 24Sep97               *
     F*                 089129             DATE 27JUL95               *
     F*                 067425             DATE 18APR94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 S01408             DATE 01OCT93               *
     F*                 S01433             DATE 10SEP93               *
     F*                 029001             DATE 29SEP92               *
     F*                 E38323             DATE 29JUL92               *
     F*                 E38494             DATE 15APR92               *
     F*                 E28496             DATE 15JAN92               *
     F*                 S01332             DATE 15JAN92               *
     F*                 S01319             DATE 19AUG91               *
     F*                 E24329             DATE 06AUG91               *
     F*                 E24302             DATE 06AUG91               *
     F*                 E22526             DATE 22AUG90               *
     F*                 E22169             DATE 13AUG90               *
     F*                 E21602             DATE 26JUN90               *
     F*                 S01199             DATE 26FEB90               *
     F*                 E20637             DATE 18JAN90               *
     F*                 E19568             DATE 11SEP89               *
     F*                 LN0793             DATE 26SEP90               *
     F*                 BHF291(CORRECT FIX)DATE 24AUG90               *
     F*                 BHF291             DATE 07AUG90               *
     F*                 LN0527             DATE 13JUL90               *
     F*                 E20545             DATE 11APR90               *
     F*                 E19837             DATE 11APR90               *
     F*                 E19277             DATE 11APR90               *
     F*                 E310               DATE 29MAR90               *
     F*                 E232               DATE 15FEB90               *
     F*                 E226               DATE 24JAN90               *
     F*                 E134               DATE 08DEC89               *
     F*                 E00044A            DATE 16NOV89               *
     F*                 E00043A            DATE 16NOV89               *
     F*                 E00044             DATE 14NOV89               *
     F*                 E00039             DATE 11NOV89               *
     F*                 E24                DATE 31OCT89               *
     F*                 E17435             DATE 25OCT89               *
     F*                 E19568             DATE 11SEP89               *
     F*                 S01195             DATE 13/09/89              *
     F*                 S01194             DATE 12/09/89              *
     F*                 S01117             DATE 11/09/89              *
     F*                 S01203             DATE 30/03/89              *
     F*                 S01157             DATE  24/01/89             *
     F*                 E16000             DATE  12/01/89             *
     F*                 E14702             DATE  14/08/88             *
     F*                 E12574             DATE  10/03/88             *
     F*                 S01136             DATE  21/01/88             *
     F*                 S01119             DATE  06/01/88             *
     F*                 S01136             DATE  14/11/87             *
     F*                                                               *
     F*****************************************************************
     F*  ANY CHANGES MADE TO THIS PROGRAM SHOULD ALSO BE MADE TO      *
     F*  DL0130                                                       *
     F*****************************************************************
     F*                                                               *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  240878 - Spot limit amount should be displayed even if limit *
      *           type does not have 'SP ' as end of first period     *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP,*
      *           MMDEAMPP, MMDELDPP, MMDENBPP and MMDENSPP.          *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  194042 - Do not lock LDA in initialization to avoid          *
      *           locking in SD0451E when limits are enquired in SD.  *
     F*  133831 - Customer Exposure Against Limit enquiry includes    *
     F*           Deals maturing today in the exposure. Fix is to     *
     F*           exclude Deals w/ Maturity Date less than or equal   *
     F*           to Rundate.                                         *
     F*  127551 - The principal amount is added twice to the Lending  *
     F*           Exposure (both the deal and the roll over). Change  *
     F*           the conditions to disregard the rolled over deal.   *
     F*  109454 - Customer/Parent Exposure Enquiry shows FX           *
     F*           and MM limits incorrectly. Applied fix 108950.      *
     F*  089129 - RECOMPILE OVER CHANGED VERSION OF FWDRT             *
     F*  067425 - Limits are wrong when enquiring from branch(*ALL)   *
     F*           to branch(XXX). Original fix caters for FRA/IRS     *
     F*           limits. Additional fix added for the limits of      *
     F*           FX LINE and DEP LINE.                               *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  S01408 - Core hook DL0130CVSF added                          *
     F*  S01433 - ENHANCED DEALING LIMITS                             *
     F*           (NB. This function is to remain switchable until    *
     F*            after Alpha-site testing, when it will become      *
     F*            mandatory. At this point DL0130A  will be          *
     F*            renamed to DL0130 and the old version discarded.   *
     F*            Meanwhile version with SAR = DL0130A, without =    *
     F*            DL0130).                                           *
     F*  029001 - If 'Upper End Period' is equal to 'Lower End        *
     F*           Period' then a divide by Zero error will occur.     *
     F*  E38323 - Recompilation of the program done due to a          *
     F*           change in ZFWDT subroutine                          *
     F*  E38494 - IF F3 TAKEN FROM ? SELECT SCREENS, DISPLAY ERROR    *
     F*  E28496 - Recompile for SDFAISPD changes (BQHEOC - Hedged     *
     F*           Events on Cashflow removed).                        *
     F*  S01332 - EM rel 10 enhancements                              *
     F*  S01319 - Remove redundant processing                         *
     F*  E24329 - CUSTOMER EXPOSURE AGAINST LIMITS ENQUIRY SHOWS      *
     F*           NIL EXPOSURE FOR LENDING.  ERROR OCCURS             *
     F*           WHEN DEAL TYPE IS EQUAL TO 'TB'                     *
     F*  E24302 - CUSTOMER EXPOSURES WERE NOT SHOWN FOR THE           *
     F*           FORWARD DATES.                                      *
     F*  E22526 - BLANK OUT LINES WITH PERIOD XXX-000 AND RESET       *
     F*           REVERSE IMAGE INDICATOR ON BLANKED LINES.           *
     F*           (COVERED BY S01117 - IF NO LIMIT SET UP, ALLOW      *
     F*            EXPOSURE)                                          *
     F*  (COVERED BY S01117, E22169 - USE DIFFERENT INDICATOR ON      *
     F*           THE LIMITS FILE TO AVOID PROBLEMS WITH END OF       *
     F*           FILE INDICATOR.)                                    *
     F*  (SAME AS E310,  E21602 - RESET BASE CURRENCY INDICATOR.)     *
     F*  S01199 - RECOMPILE FOR  HELP SYSTEM                       *
     F*  E20637 - HIGHLIGHT EXCESS FIELD IF POSITIVE.                 *
     F*           COMPLETE LENDING CALCULATIONS IF SP USED IN LIMIT   *
     F*  LN0793 - NO NEED TO CONDITION ON RECORD BEING FOUND/LIVE     *
     F*  BHF291 - STRINGS OF ZEROS BEING DISPLAYED UNNECESSARILY      *
     F*  LN0527 - 1) NEED TO MAKE TEXT (EG. 'NO LIMIT') CONSISTENT    *
     F*              BETWEEN DEALING AND FRA/IRS.                     *
     F*           2) NEED TO SET UP FRA/IRS DEFAULT REQUESTED         *
     F*              FIELDS (IRDEF/FRDEF) TO GET DEFAULT              *
     F*           3) NEED TO SET LIMK3 FOR CHAIN TO LIMITJ TO 'SYS'   *
     F*              IF BANK LEVEL ENQUIRY REQUESTED                  *
     F*           4) NEED TO IDENTIFY BETWEEN DIFFERENT BRANCHES &    *
     F*              COMPANIES (CURRENTLY DOES ALL EACH TIME !)       *
     F*  E20545 - IF LIMITS ARE SET FOR SIX PERIODS AND FIELD         *
     F*           BGFIIN =/= 'Y' THEN THE LAST LINE IS DUPLICATED.    *
     F*  E19837 - MONTH NOT SHOWN WHEN DRS IS NOT PRESENT.            *
     F*           INVALID LINES SHOWN WHEN LESS THAN SIX PERIODS.     *
     F*  E19277 - AMEND PROGRAM TO CHECK DEAL DELETED INDICATOR AS    *
     F*           OPPOSED TO THE LOGICAL DELETE FLAG.                 *
     F*  E310   - TRADES WITH CCYS <> LIMIT CCY DO NOT REPORT         *
     F*           CORRECT EXPOSURE                                    *
     F*  E232   - FIX TO DEFAULT PROCESSING                           *
     F*  E226   - FIX TO DEFAULT PROCESSING                           *
     F*  E134   - FIX TO USE CORRECT VALUE OF MULT/DIV INDICATOR      *
     F*  E00043A- FILE ERROR WITH AOCUSTR0 SHOULD PRODUCE AN ERROR    *
     F*           MESSAGE                                             *
     F*  E00044A- CHANGE XLDA DEFINITION,MAKE SURE DISPLAY FIELDS     *
     F*           ARE BLANKED AND 'NO LIM.' MESSAGE SHOWN             *
     F*           REGARDLESS OF MULTIBRANCHING                        *
     F*  E00044 - CURSOR POSITIONED AT CORRECT FIELDS ON ERROR        *
     F*  E00039 - ONLY SHOW 'B' AS DEFAULT FOR BOOKING/ORIGINATING    *
     F*           BRANCH FIELD WHEN BLANK                             *
     F*  E24    - CUSTOMER SHORT NAME DISPLAYED AFTER CALLING         *
     F*           AOCUSTR0 WITH '?'                                   *
     F*  E17435 - AMEND PROGRAM TO SHOW THE CORRECT PERIOD RANGES     *
     F*           FOR LIMIT TYPES THAT DO NOT USE ALL SIX PERIODS.    *
     F*           ALSO,BLANK OUT MEANINGLESS LINES WHEN LESS THAN     *
     F*           SIX PERIOD RANGES.                                  *
     F*  (COVERED BY S01117 - E19568 - AMEND ERROR CAUSED BY S01157   *
     F*          .PROGRAM DISPLAYS JUNK)                              *
     F*  S01195 - NEW HOLIDAY PROCESSING                              *
     F*  S01117 - MULTI-BRANCHING CHANGES                             *
     F*  S01194 - NEW STANDING DATA CHANGES                           *
     F*  S01203 - INCORPORATION CHANGES                               *
     F*  S01157 - FRA/IRS EXPOSURES SHOWN AGAINST THEIR OWN LIMITS    *
     F*  E16000 - WHEN MULTIPLYING THE TOTAL AMOUNT OF THE LIMIT      *
     F*           BY THE PERIOD PERCENTAGE, THE RESULT SHOULD         *
     F*           BE HALF-ADJUSTED AND NOT TRUNCATED.                 *
     F*  E14702 - FD FILES ACCESSED IRRESPECTIVE OF WHETHER DRS       *
     F*           IS INSTALLED OR NOT, CAUSING DB ERROR.              *
     F*           ALSO, DEFINE LDA (IN UDS LINE OF 'I' SPECS).        *
     F*  E12574 - 10/03/88 - MMOD DEFINED AS LENGTH 256               *
     F*  S01136 - 21/01/88 - DRS FIXES                                *
     F*  S01119 - FRA/IRS INCORPORATION.                              *
     F*  S01136 - DRS Incorporation 2. Rename MM0067 to CA0200        *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F*                                                               *
     F*        01         Do not read initial screen                  *   S01332
     F*        02         Enable F1 and F12 keys                      *   S01332
     F*     11            DISPLAY EXCESS IN REVERSE IMAGE.            *   E20637
     F*     15            FILE ERROR                                  *
     F*        16         VALIDATION CHECK                            *
     F*        17         VALIDATION CHECK                            *
     F*        19         LIMITS CHAIN FAIL                           *   S01117
     F*        38         ERROR MESSAGES                              *
     F*        39         NON DISPLAY OF SUBFILE                      *
     F*        40         SUBFILE CONTROL                             *
     F*        41         CLEAR SUBFILE                               *
     F*        43         BLANK SUBFILE RECORD                        *
     F*        48         NO LIMITS FX                                *
     F*        49         NO LIMITS LOANS                             *
     F*     51            FILE END                                    *
     F*     52            DEALS FILE END                              *
     F*     53            SECOND DEALS FILE                           *
     F*        54         PARENT INDICATOR                            *
     F*        55         JOINT DEALS FILE END                        *
     F*        56         BASE CURRENCY FOR LIMITS                    *
     F******61****        TABLE FILE END                              *
     F*     73            BRANCH CODE BLANK OR 'ALL'                  *   S01117
     F*     74            COMPANY CODE BLANK OR 'ALL'                 *   S01117
     F*     75            MULTIBRANCHING INDICATOR IS ON              *   S01117
     F*     76            ORIGINATING BRANCH USED FOR REQUEST         *   S01117
     F*    N76            BOOKING BRANCH USED FOR REQUEST             *   S01117
     F*     77            INVALID BRANCH CODE                         *   S01117
     F*     78            INVALID COMPANY CODE                        *   S01117
     F*     79            INVALID BOOKING/ORIGINATING BRANCH          *   S01117
     F*     80            ORIGINATING BRANCH NOT USED ON SYSTEM       *
     F*        90         STANDARD SUBROUTINE                         *
     F*        91         STANDARD SUBROUTINE                         *
     F*        92         STANDARD SUBROUTINE                         *
     F*        93         STANDARD SUBROUTINE                         *
     F*        94         STANDARD SUBROUTINE                         *
     F*        95         STANDARD SUBROUTINE                         *
     F*        96         STANDARD SUBROUTINE                         *
     F*        97         STANDARD SUBROUTINE                         *
     F*        99         STANDARD SUBROUTINE                         *
     F*                                                               *
      /EJECT
     F*****************************************************************
     F*L0130FMCF  E                    WORKSTN                      S01136S01433
     FDL0130FACF  E                    WORKSTN                            S01433
     F                                        @CNT  KSFILE DL0130F2       S01136
     F**0200DDCF  E                    WORKSTN                            S01136
     F*************                           @CNT  KSFILE CA0200F2       S01136
     F********MM0067DDCF  E                    WORKSTN                    S01136
     F**********                              @CNT  KSFILE MM0067F2       S01136
     F********** FDPMNTLLIF  E         DISK         KINFSR *PSSR          E14702
     F*FDPMNTLLIF**E*******************DISK*********KINFSR**PSSRUC**E14702S01319
     FFDMNTHLLIF  E                    DISK         KINFSR *PSSR      UC  S01319
     F***CLINT   IF  E           K        DISK         KINFSR *PSSR       S01194
     F***SNAME   IF  E           K        DISK         KINFSR *PSSR       S01194
     F******      CLINTCBF                          KRENAMECLINTRBF       S01194
     F***LIMIT   IF  E           K        DISK         KINFSR *PSSR       S01117
     FLIMITJ  IF  E           K        DISK         KINFSR *PSSR          S01117
     F**TABDLI  IF  E         K        DISK         KINFSR *PSSR      UC  S01194
     F***PACUS   IF  E           K        DISK         KINFSR *PSSR       S01194
     F***         CLINTCBF                          KRENAMECLINTSBF       S01194
     FSDCUSTL4IF  E           K        DISK                               S01194
     F*CUSDE***IF**E**********K********DISK*********KINFSR**PSSR******UC**S01319
     F************DEALSDBF**************************KRENAMEDEALSCBF*******S01319
     F************DEALSDCF**************************KRENAMEDEALSCCF*******S01319
     F************DEALSDDF**************************KRENAMEDEALSCDF*******S01319
     F************DEALSDEF**************************KIGNORE***************S01319
     F************DEALSDGF**************************KRENAMEDEALSCGF*S01119S01319
     F                                              KINFDS INFDS
     FFXMIDLLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            DEDEALP0                          KIGNORE
     F            DEALSDGF                          KRENAMEDEALSFGF
     F                                              KINFDS INGDS
     FMMDLCSLLIF  E           K        DISK         KINFSR *PSSR      UC
     F            MMDENSP0                          KIGNORE
     F                                              KINFDS INHDS
     FMMDMCSLLIF  E           K        DISK         KINFSR *PSSR      UC
     FDEAMS   IF  E           K        DISK         KINFSR *PSSR      UC
     F********** FDINSTLLIF  E         DISK         KINFSR *PSSR          E14702
     F*FDINSTLLIF**E*******************DISK*********KINFSR**PSSRUC**E14702S01319
     FFWDRT   IF  E           K        DISK         KINFSR *PSSR          S01433
     F/COPY WNCPYSRC,DL0130AF01
     E                    CPY@    1   1 80                                S01194
     E*
     E** ARRAY OF CONVERSION FACTORS
     E                    FCT     1   4  4 0
     E*
     E** ARRAY FOR CUMULATIVE DAYS IN THE YEAR FOR FOUR YEAR PERIOD
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E*
     E** ARRAY FOR CUMULATIVE DAYS IN YEAR PER MONTH
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E*
     E***ARRAY*FOR*MONTH*NAMES*-*USED*IF*DRS*NOT*PRESENT************E19837S01319
     E********************ZMNM***12**12**3**************************E19837S01319
     E*                                                                   E19837
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR MONTH NAMES
     E                    @MN        12  3
     E*
     E** ARRAY FOR ERROR MESSAGES
     E******              ERR     2   4 40                                S01117
     E***************     ERR     2  12 40                                S01117
     E                    ERR     2  14 40                                S01117
     E*
     E*
     E** ARRAY FOR AMOUNT INPUT  SR.ZA0750
     E                    @D         15  1
     E** ARRAY FOR DISPLAY AMOUNT SR.ZA0750
     E                    @E         21  1
     E** WORK ARRAY SR.ZA0750
     E                    @C         21  1
     E*
     E** CURRENCY ARRAY
     E                    @HCCY      25  3
     E*
     E** SIX  ARRAYS FOR FX LIMITS
     E                    XFDA        6  3 0             PERIOD END DAYS
     E                    XFDT        6  5 0             PERIOD END DATES
     E                    XFLM        6  9 0             PERIOD LIMIT AMT.
     E                    XFXP        6 10 0             PERIOD EXPOS AMT.
     E                    XFXS        6 10 0             PERIOD EXCES AMT.
     E                    XFPC        6  3 2             PERIOD PERCENTGE.
     E*
     E***SIX*ARRAYS*FOR LOANS LIMITS.
     E** SIX ARRAYS FOR MONEY MARKET LIMITS.
     E                    XLDA        6  3 0             PERIOD END DAYS
     E                    XLDT        6  5 0             PERIOD END DATES
     E                    XLLM        6  9 0             PERIOD LIMIT AMT.
     E                    XLXP        6 10 0             PERIOD EXPOS AMT.
     E                    XLXS        6 10 0             PERIOD EXCES AMT.
     E                    XLPC        6  3 2             PERIOD PERCENTGE
     E*                                                                   S01433
     E**  SIX ARRAYS FOR PRECIOUS METAL LIMITS                            S01433
     E                    XPDT        6  5 0             PERIOD END DATES S01433
     E                    XPLM        6  9 0             PERIOD LIMIT AMT.S01433
     E                    XPXP        6 10 0             PERIOD EXPOS AMT.S01433
     E                    XPXS        6 10 0             PERIOD EXCES AMT.S01433
     E                    XPDA        6  3 0             PERIOD END DAYS  S01433
     E                    XPDC        6  3 2             PERIOD PERCENTGE S01433
     E*
     E** ARRAYS FOR PERIOD DATES
     E                    XFS         6  3 0             PERIOD START
     E                    XLS         6  3 0             PERIOD START
     E**********          XMS         6  3 0             PERIOD START     S01433
     E                    XPS         6  3 0             PERIOD START     S01433
     E*
     E** ARRAY FOR HYPHENS IN THE PERIODS
     E                    XFHY        6  1
     E                    XLHY        6  1
     E**********          XMHY        6  1                                S01433
     E                    XPHY        6  1                                S01433
     E*
     E***ARRAY*FOR THE FX/LOAN HEADINGS
     E** ARRAY FOR THE FX, MONEY MARKET AND PRECIOUS METAL HEADINGS
     E**********          XFNM        6  8                                S01157
     E                    XFNM        6  9                                S01157
     E                    XFEX        6  8
     E**********          XLNM        6  8                                S01157
     E                    XLNM        6  9                                S01157
     E                    XLEX        6  8
     E                    XPNM        6  9                                S01433
     E                    XPEX        6  8                                S01433
     E*
     E***XFDA*& XLDA DEFINED AS ALPHANUMERIC.                             S01433
     E** XFDA XLDA & XPDAA DEFINED AS ALPHANUMERIC.                       S01433
     E                    XFDAA       6  3
     E                    XLDAA       6  3
     E                    XPDAA       6  3                                S01433
     E*                                                                   S01433
     E** ARRAY USED TO CALCULATE THE NETTING OF FX DEALS                  S01433
     E                    FXBY      100 27                                S01433
     E                    FXSL      100 27                                S01433
     E**********          FXNT      100 76                                S01433
     E                    FXNT      100 79                                S01433
     E*
     E** ARRAY OF ZEROS
     E                    ZEROS       6  3 0
     E*                                                                   S01433
     E** ARRAY USED IN CURRENCY AMOUNT CONVERSION                         S01433
     E                    POWER   1   7  7 3                              S01433
     E*                                                                   S01433
     E** DATE ARRAY                                                       S01433
     E                    DAT        26  5 0A                             S01433
     E*                                                                   S01433
     E** RATE ARRAY                                                       S01433
     E                    RAT        26 13 8                              S01433
     E*                                                                   S01433
     E** NUMBER OF DAYS FORWARD ARRAY                                     S01433
     E                    DFWW       25  5 0                              S01433
     E*                                                                   S01433
     E** FORWARD RATES ARRAY                                              S01433
     E                    RFWW       25 13 8                              S01433
     E*                                                                   S01433
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY WNCPYSRC,DL0130AE01
     I*
     I** RENAME FIELDS FOR MONTH ARRAY
     I*FDPMNTL1***********************************************************S01319
     IFDMNTHP0                                                            S01319
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I**
     I**ODS       DS                             64                       E12574
     I*MMODS*******DS****************************256****************E12574S01319
     I***************************************11**11*MODFD***********E14702S01319
     I***************************************13**14*MODS******************S01319
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR
     I********** UDS                            256                       E14702
     I*LDA****** UDS                            256                       E14702              194042
     ILDA         DS                            256                                           194042
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I**********                            155 183 DBASE                 E14702
     I*****                                 181 183 DBASE         E14702  S01194
     I                                      181 1830DBASE                 S01194
     I*
     I** INFORMATION DATA STRUCTURE FOR FORMAT ACCESSED
     IINFDS       DS
     I                                     *RECORD  RECFMT
     I*
     IINGDS       DS
     I                                     *RECORD  RECGMT
     I*
     IINHDS       DS
     I                                     *RECORD  RECHMT
     I*
     I*****DATA STRUCTURE TO SET UP KEY TO PACUS                          S01194
     I*****       DS                                                      S01194
     I*****                                   1   6 PACUKY                S01194
     I*****                                   1   60CNUMCB                S01194
     I*
     I*****DATA STRUCTURE - KEY TO TABLE FILE                             S01194
     I*****       DS                                                      S01194
     I*****                                   1  12 KEYTAB                S01194
     I*****                                   1   2 TABRT                 S01194
     I*****                                   9  11 TABCCY                S01194
     I*****                                  12  12 TABSRT                S01194
     I*
     I** DATA STRUCTURE FOR VALUE DATE FROM DRS FILES
     I            DS
     I                                        1   80@VDAT
     I                                        1   40FHVDYY
     I                                        1   40HNVDYY
     I                                        5   60HNVDMM
     I                                        5   60FHVDMM
     I                                        7   80FHVDDD
     I                                        7   80HNVDDD
     I*
     I** DATA STRUCTURE FOR OPTION DATE FROM THE DRS FILES
     I            DS
     I                                        1   80@ODAT
     I                                        1   40FHDOEY
     I                                        5   60FHDOEM
     I                                        7   80FHDOED
     I*
     I** DATA STRUCTURE FOR MATURITY DATE FROM THE DRS FILES
     I            DS
     I                                        1   80@MDAT
     I                                        1   40HKMDYY
     I                                        1   40HLMDYY
     I                                        5   60HKMDMM
     I                                        5   60HLMDMM
     I                                        7   80HKMDDD
     I                                        7   80HLMDDD
     I*
     I**  DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE
     I            DS
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        3   40@@YY
     I                                        1   20@@CC
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I*
     I** DATA*STRUCTURE*BUILT*OVER*FIELDS*IN*THE*TABLE*FILE               S01117
     I*****       DS                                                      S01117
     I*****                                   1  18 LEPSIN                S01117
     I*****                                  19  36 LPCSIN                S01117
     I*****                                   1   3 LEP1                  S01117
     I*****                                   4   6 LEP2                  S01117
     I*****                                   7   9 LEP3                  S01117
     I*****                                  10  12 LEP4                  S01117
     I*****                                  13  15 LEP5                  S01117
     I*****                                  16  18 LEP6                  S01117
     I*****                                  19  210LPC1                  S01117
     I*****                                  22  240LPC2                  S01117
     I*****                                  25  270LPC3                  S01117
     I*****                                  28  300LPC4                  S01117
     I*****                                  31  330LPC5                  S01117
     I*****                                  34  360LPC6                  S01117
     I*
     I** DATA STRUCTURES FOR THE SCREEN
     I            DS
     I                                        1   7 SFS7
     I                                        1   3 SFS
     I                                        4   4 SFHY
     I                                        5   7 SFDAA
     I*                                                                   S01433
     I** DATA STRUCTURE FOR BUY AMOUNT AND CURRENCY                       S01433
     I            DS                                                      S01433
     I                                        1  27 FXBYDS                S01433
     I                                        1   3 FHCCY1                S01433
     I                                        4  180FHDAM1                S01433
     I                                       19  260FXBDAT                S01433
     I                                       27  27 FXBCLO                S01433
     I*                                                                   S01433
     I** DATA STRUCTURE FOR SELL AMOUNT AND CURRENCY                      S01433
     I            DS                                                      S01433
     I                                        1  27 FXSLDS                S01433
     I                                        1   3 FHCCY2                S01433
     I                                        4  180FHDAM2                S01433
     I                                       19  260FXSDAT                S01433
     I                                       27  27 FXSCLO                S01433
     I*                                                                   S01433
     I** DATA STRUCTURE TO RESTORE NETTED FX DEALS DETAILS                S01433
     I            DS                                                      S01433
     I**********                              1  61 FXNTDS                S01433
     I                                        1  79 FXNTDS                S01433
     I                                        1   60FXDN38                S01433
     I                                        7   7 FXCLOP                S01433
     I                                        8  220FXDAM1                S01433
     I                                       23  25 FXCCY1                S01433
     I                                       26  400FXDAM2                S01433
     I                                       41  43 FXCCY2                S01433
     I                                       44  45 FXTYPE                S01433
     I                                       46  490FXVDYY                S01433
     I                                       50  510FXVDMM                S01433
     I                                       52  530FXVDDD                S01433
     I                                       54  570FXDOEY                S01433
     I                                       58  590FXDOEM                S01433
     I                                       60  610FXDOED                S01433
     I                                       62  760FXBCAE                S01433
     I                                       76  79 FXMBCA                S01433
     I*
     I            DS
     I***********                             1  43 SF4                   E20637
     I                                        1  27 SF4                   E20637
     I                                        1  11 SF1
     I                                       14  27 SF2
     I                                       30  43 SF3
     I*
     I*****DATA*STRUCTURES*TO LINK XFDAA/XFDA & XLDAA/XLDA & INPUT FIELDS S01433
     I**   DATA STRUCTURES TO LINK XFDAA & XMDAA & XPDAA & INPUT FIELDS   S01433
     I            DS
     I                                        1  18 XFDA
     I                                        1  18 XFDAA
     I                                        1   3 FLEP1                 S01117
     I                                        4   60FLEP2                 S01117
     I                                        7   90FLEP3                 S01117
     I                                       10  120FLEP4                 S01117
     I                                       13  150FLEP5                 S01117
     I                                       16  180FLEP6                 S01117
     I******                                  1  18 XFDAIN                S01117
     I            DS
     I******                                  1  18 XLDA            S01117E44A
     I                                        1  18 XLDA                  E44A
     I                                        1  18 XLDAA
     I*****************                       1   3 LLEP1          S01117 109454
     I*****************                       4   60LLEP2          S01117 109454
     I*****************                       7   90LLEP3          S01117 109454
     I*****************                      10  120LLEP4          S01117 109454
     I*****************                      13  150LLEP5          S01117 109454
     I*****************                      16  180LLEP6          S01117 109454
     I                                        1   3 MLEP1                 109454
     I                                        4   60MLEP2                 109454
     I                                        7   90MLEP3                 109454
     I                                       10  120MLEP4                 109454
     I                                       13  150MLEP5                 109454
     I                                       16  180MLEP6                 109454
     I******                                  1  18 XLDAIN                S01117
     I/COPY WNCPYSRC,DL0130AI01
     I            DS                                                      S01433
     I                                        1  18 XPDA                  S01433
     I                                        1  18 XPDAA                 S01433
     I                                        1   3 PLEP1                 S01433
     I                                        4   60PLEP2                 S01433
     I                                        7   90PLEP3                 S01433
     I                                       10  120PLEP4                 S01433
     I                                       13  150PLEP5                 S01433
     I                                       16  180PLEP6                 S01433
     I            DS
     I                                        1  18 XFPC
     I*****                                   1  18 XFPCIN                S01117
     I                                        1  18 XFPCA                 S01117
     I                                        1   30FLPC1                 S01117
     I                                        4   60FLPC2                 S01117
     I                                        7   90FLPC3                 S01117
     I                                       10  120FLPC4                 S01117
     I                                       13  150FLPC5                 S01117
     I                                       16  180FLPC6                 S01117
     I            DS
     I                                        1  18 XLPC
     I                                        1  18 XLPCA                 S01117
     I***************                         1   30LLPC1          S01117 109454
     I***************                         4   60LLPC2          S01117 109454
     I***************                         7   90LLPC3          S01117 109454
     I***************                        10  120LLPC4          S01117 109454
     I***************                        13  150LLPC5          S01117 109454
     I***************                        16  180LLPC6          S01117 109454
     I                                        1   30MLPC1                 109454
     I                                        4   60MLPC2                 109454
     I                                        7   90MLPC3                 109454
     I                                       10  120MLPC4                 109454
     I                                       13  150MLPC5                 109454
     I                                       16  180MLPC6                 109454
     I/COPY WNCPYSRC,DL0130AI02
     I            DS                                                      S01433
     I                                        1  18 XPDC                  S01433
     I                                        1  18 XPDCA                 S01433
     I                                        1   30PLPC1                 S01433
     I                                        4   60PLPC2                 S01433
     I                                        7   90PLPC3                 S01433
     I                                       10  120PLPC4                 S01433
     I                                       13  150PLPC5                 S01433
     I                                       16  180PLPC6                 S01433
     I*
     I** PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      244 246 @JOB
     I*
     I                                      254 263 @USER
     I*
     I*   DATASTUCTURE TO CONVERT @@IAMT DECIMAL FIELD TO ALPHA FIELD
     I*
     I@@AMDS      DS                             15
     I                                        1  150@@IAMT
     I*                                                                   S01433
     I**   TO FILL DATE ARRAY                                             S01433
     IWWDS1       DS                                                      S01433
     I                                        1  75 DFW                   S01433
     I                                    P   1  75 DFWW                  S01433
     I*                                                                   S01433
     I**   TO FILL FORWARD RATES ARRAY                                    S01433
     IWWDS2       DS                                                      S01433
     I                                        1 175 RFW                   S01433
     I                                    P   1 175 RFWW                  S01433
     I*                                                                   S01117
     IRUNDAT      DS                                                      S01117
     I                                       13  13 @MBIN                 S01117
     I*
     IZMUSER      DS                             17                       S01117
     I* DATA STRUCTURE WITH DEFAULT BRANCH                                S01117
     I                                       11  13 BRC                   S01117
     I                                       14  16 DEPT                  S01117
     I                                       17  17 BNKAUT                S01117
     I*                                                                   S01332
     IEMSDS     E DSEMDTA                                                 S01332
     I** Linkage data structure from EM enquiry                           S01332
     I*
     I@BANK     E DSSDBANKPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO BANK DETAILS                  S01194
     I*
     I@DEAL     E DSSDDEALPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO DEALING DETAILS               S01194
     I*
     I@MMOD     E DSSDMMODPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO MIDAS MODULES DETAILS         S01194
     I*
     I@BRCH     E DSSDBRCHPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO BRANCH DETAILS                S01194
     I*
     I@COMP     E DSSDCOMPPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO COMPANY DETAILS               S01194
     I*
     I@FAIS     E DSSDFAISPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO FRA/IRS  DETAILS              S01194
     I*
     I@CURR     E DSSDCURRPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO CURRENCY DETAILS              S01194
     I*
     I@CUST     E DSSDCUSTPD                                              S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     I** DUMMY RECORD FORMATS FOR ACCESS TO CUSTOMER DETAILS              S01194
     I*
     I@GELR     E DSSDGELRPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I** DUMMY RECORD FORMATS FOR ACCESS TO GENERAL LEDGER DETAILS        S01194
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     ISVAL1       DS                            200                                           240878
     I                                        1   1 SVAL11                                    240878
      ** DS for AOSVALR0                                                                      240878
      *                                                                                       240878
     I              'DL130ADspSptLimCheck'C         SVALKK                                    240878
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN     - CUSTOMER/PARENT EXPOSURE AGAINST LIMITS            *
     C*                                                               *
     C* CALLS    #A       - FIRST CYCLE PROCESSING                    *
     C*          #B       - MAIN LINE PROCESSING                      *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C*
     C** MAIN LINE PROCESSING
     C*
     C** INITIAL PROCESSING
     C                     EXSR #A
     C*
     C** MAIN CONTROLLING PROCESSING
     C           *INU7     IFEQ '0'
     C                     EXSR #B
     C                     END
     C*                                                                   S01332
     C** Set up return code in EMSDS dependant of function key pressed    S01332
     C*                                                                   S01332
     C           *INKC     IFEQ '1'                                       S01332
     C                     MOVE 'Q'       @RTNC   1                       S01332
     C                     ELSE                                           S01332
     C           *INKA     IFEQ '1'                                       S01332
     C                     MOVE 'S'       @RTNC                           S01332
     C                     ELSE                                           S01332
     C           *INKL     IFEQ '1'                                       S01332
     C                     MOVE 'U'       @RTNC                           S01332
     C                     END                                            S01332
     C                     END                                            S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C           *LOCK     IN   EMSDS                                     S01332
     C                     MOVE @RTNC     RETND                           S01332
     C                     OUT  EMSDS                                     S01332
     C*
     C** PROCESSING ENDS DUE TO DATABASE ERROR
     C                     MOVE '1'       *INLR
     C*
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*  01  #A       - FIRST CYCLE PROCESSING                        *
     C*  02  #B       - MAIN LINE PROCESSING                          *
     C***03**#BA******-*PROCESSING*FOR*MIDAS*ONLY*************************S01319
     C*  04  #BAA     - CALCULATE EXPOSURE FOR MIDAS-FX ONLY          *
     C*  05  #BAB     - CALCULATE EXPOSURE FOR MIDAS-LOANS            *
     C*  06  #BAC     - FORMAT MIDAS DEALS FOR OUTPUT                 *
     C***07**#BB******-*PROCESSING*FOR*MIDAS*AND*DRS-FX*ONLY**************S01319
     C*  08  #BBA     - CALCULATE EXPOSURE FOR DRS=FX DEALS           *
     C*  09  #BC      - PROCESSING FOR MIDAS AND DRS-MM ONLY          *
     C*  10  #BCA     - CALCULATE EXPOSURE FOR DRS-LOANS              *
     C*  11  #BD      - PROCESSING FOR MIDAS AND DRS                  *
     C***12**TABCHN***- CHAIN TO THE TABLE FILE                       *   S01194
     C*  13  #BE      - VALIDATION PROCESSING                         *
     C*  14  #BF      - SET UP ARRAYS OF LIMIT PERIODS                *
     C*  14.1#BFA     - SET UP FX LIMIT ARRAY                         *   S01117
     C***14.2#BFB*****- SETUP LENDING LIMIT ARRAY                  S01117 S01433
     C*  14.2#BFB     - SETUP MONEY MARKET LIMIT ARRAY                *   S01433
     C*  14.3#BFC     - SETUP PRECIOUS METAL LIMIT ARRAY              *   S01433
     C*  15  #BG      - INITIALIZATION OF THE DISPLAY FIELDS          *
     C*  16  #BH      - SET UP OF THE DISPLAY FIELDS                  *
     C*  17  #BI      - OUTPUT TO THE SCREEN                          *
     C*  18  DLEXPF   - CALCULATES THE EXPOSURE FOR AN FX DEAL        *
     C*  19  DLEXPL   - CALCULATES THE EXPOSURE OF ALOAN              *
     C***20**ZDATE3***- CALCULATES DAYS FORWARD IN ANY CURRENCY       *   S01195
     C*  20  ZFWDT    - CALCULATES DAYS FORWARD IN ANY CURRENCY       *   S01195
     C*  21  ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT         *
     C*  22  ZA0680   - CONVERSION OF YYYYMMDD TO MIDAS DAY NO.       *
     C*  23  ZA0670   - WHICH IS BUY AND WHICH IS SELL CCY            *
     C*  24  ZA1020   - CONVERT AMOUNT TO DISPLAY                     *
     C*  25  *PSSR    - PROGRAM DUMP                                  *
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - FIRST CYCLE PROCESSING                             *
     C*                                                               *
     C* CALLS   *TABCHN***-*CHAIN*TO*THE*TABLE*FILE                   *   S01194
     C*         *ZDATE3***-*CALCULATES*DAYS*FORWARD*IN*ANY*CURRENCY   *   S01195
     C*          ZFWDT    - CALCULATES DAYS FORWARD IN ANY CURRENCY   *   S01195
     C*                                                               *
     C* CALLED BY  MAIN   - CUSTOMER/PARENT EXPOSURE AGAINST LIMITS   *
     C*                                                               *
     C* FLDS USED  @DATF  - DATE FORMAT WORK FIELD                    *
     C*************@RCDT  - RECORD FORMAT FOR KEY TO CLINT FILE       *   S01194
     C*            @JOB   - JOB ID WORK FIELD                         *
     C*                                                               *
     C*****************************************************************
     C           #A        BEGSR
     C*                                                                   S01433
     C           *LIKE     DEFN A6SPRT    WWSPRT                          S01433
     C           *LIKE     DEFN A6NBDP    WWDECP                          S01433
     C           *LIKE     DEFN A6MDIN    WWMDIV                          S01433
     C           *LIKE     DEFN DLVALU    WWDATE                          S01433
     C* NETFX should only be set to 'Y' if netting of FX exposure         S01433
     C* is required. At the moment it is not, 16-11-93.                   S01433
     C                     MOVE 'N'       NETFX   1                       S01433
     C*                                                                   S01433
     C**   INITIALISE VARIOUS ARRAY ELEMENTS                              S01433
     C                     Z-ADD1         L       20                      S01433
     C                     Z-ADD1         M       20                      S01433
     C                     Z-ADD1         N       20                      S01433
     C                     Z-ADD1         P       20                      S01433
     C                     Z-ADD1         Y       20                      S01433
     C**                                                                  S01117
     C*  SETUP KEY FOR LIMIT FILE
     C           LIMKEY    KLIST                                          S01117
     C                     KFLD           LIMK1   6                       S01117
     C                     KFLD           LIMK2   1                       S01117
     C                     KFLD           LIMK3   3                       S01117
     C**                                                                  S01117
     C                     MOVEACPY@      BIS@   80                       S01194
     C** SET UP PROGRAM NAME
     C           *NAMVAR   DEFN           LDA                                                 194042
     C           *LOCK     IN   LDA                                                           194042
     C                     MOVE *BLANKS   DBPGM                                               194042
     C                     MOVEL'DL0130'  DBPGM                           S01136
     C                     OUT  LDA                                                           194042
     C***********          MOVEL'CA0200'  DBPGM                           S01136
     C***********          MOVEL'MM0067'  DBPGM                           S01136
     C                     Z-ADD0         S01433  10                      S01433
     C*
     C***RETRIEVE*THE*EXTERNAL*DATAAREA*MMOD************************E14702S01319
     C************NAMVAR***DEFN*MMOD******MMODS*********************E14702S01319
     C*********************IN***MMODS*******************************E14702S01319
     C*                                                                   E14702
     C**  GET ZMUSER to access default branch.                            S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
     C**                                                                  S01117
     C**  GET RUNDAT to access MULTI-BRANCHING flag.                      S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C                     IN   RUNDAT                                    S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN75                           S01117
     C                     MOVE 'B'       BKOR                            E00039
     C                     ELSE                                           S01117
     C                     MOVE '0'       *IN75                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C***********MODFD*****IFEQ*'Y'************************B1*******E14702S01319
     C*********************OPEN*FDPMNTLL********************1*******E14702S01319
     C                     OPEN FDMNTHLL                   *1             S01319
     C********************************************************************S01319
     C** ACCESS THE MONTH NAME FILE
     C***********1*********SETLLFDPMNTLL********************1*************S01319
     C*********************READ*FDPMNTLL*****************15*1*************S01319
     C           1         SETLLFDMNTHLL                   *1             S01319
     C                     READ FDMNTHLL                 15*1             S01319
     C*
     C           *IN15     IFEQ '1'                        B*2
     C           *LOCK     IN   LDA                                                           194042
     C                     MOVE '001'     DBASE            ****************
     C*********************MOVEL'FDPMNTLL'DBFILE**************************S01319
     C                     MOVEL'FDMNTHLL'DBFILE           *              S01319
     C                     MOVE *BLANKS   DBKEY            * DB ERROR 001 *
     C                     OUT  LDA                        *              *                   194042
     C                     MOVE '1'       *INU7            *              *
     C                     MOVE '1'       *INU8            ****************
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*********************ELSE****************************X*1******E19837S01319
     C*********************MOVEAZMNM******@MN***********************E19837S01319
     C********************************************************************S01319
     C*********************END*****************************E1*******E14702S01319
     C*
     C***OPEN*THE*TABLE*FILE                                              S01194
     C*****                OPEN TABDLI                                    S01194
     C*****      *LOVAL    SETLLTABDLI                                    S01194
     C*
     C** INITIALIZE THE LIMIT ARRAY
     C                     Z-ADD0         XFDA
     C                     Z-ADD0         XLDA
     C                     Z-ADD0         XPDA                            S01433
     C*
     C***SET*UP*THE*KEY*FOR*THE*TABLE FILE                                S01194
     C*****                MOVE ' '       BLNK12 12                       S01194
     C*****                MOVEL'01      'KEYTAB                          S01194
     C*****                MOVE '  10'    KEYTAB                          S01194
     C*****                EXSR TABCHN                                    S01194
     C*****                                                               S01194
     C*****      *INU7     CABEQ'1'       #A9                             S01194
     C*****                                                               S01194
0149 C*
     C** READ BANK DETAILS VIA ACCESS PROGRAM                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           @BANK     PARM @BANK     DSFDY                           S01194
     C*********            PARM           @BANK                           S01194
     C*                                                                   S01194
0640 C*    CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C*****      DATF      IFEQ 'M'                                       S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE 'M'       @DATF   1
     C                     ELSE
     C                     MOVE 'D'       @DATF
     C                     END
     C/COPY WNCPYSRC,DL0130AC01
     C*
     C***SET*UP*THE*SECOND*KEY*TO*THE*TABLE*FILE                          S01194
     C*****                MOVE '11'      KEYTAB                          S01194
     C*****                EXSR TABCHN                                    S01194
     C*****                                                               S01194
     C*****      *INU7     CABEQ'1'       #A9                             S01194
     C*****                                                               S01119
     C***CHAIN*TO*TABTB40*CONTROL*DATA*RECORD.                    S01119  S01194
     C*****                                                       S01119  S01194
0577 C*****                MOVE ' '       BLNK12 12               S01119  S01194
0578 C*****                MOVEL'01      'KEYTAB                  S01119  S01194
0579 C*****                MOVE '  40'    KEYTAB                  S01119  S01194
0580 C*****                EXSR TABCHN                            S01119  S01194
     C*****                                                               S01194
     C*****      *INU7     CABEQ'1'       #A9                     S01119  S01194
     C** CALL ACCESS PROGRAM FOR GENERAL LEDGER DETAILS                   S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C********** @GELR     PARM @GELR     DSFDY                                        S01194 CGL029
     C           @GELR     PARM @GELR     DSSDY                                               CGL029
     C************         PARM           @GELR                           S01194
     C*                                                                   S01194
      * CHECK TO SEE IF ORIGINATING BRANCH IS USED BY THE SYSTEM          S01117
     C           BKOBRU    COMP 'Y'                      80               S01117
      *                                                                   S01117
     C** CALL ACCESS PROGRAM FOR DEALING DETAILS                          S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C********** @DEAL     PARM @DEAL     DSFDY                           S01194              CGL029
     C           @DEAL     PARM @DEAL     DSSDY                                               CGL029
     C***********          PARM           @DEAL                           S01194
     C*                                                                   S01194
     C*                                                                   S01194
     C** CALL ACCESS PROGRAM FOR MIDAS MODULES DETAILS                    S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C           @MMOD     PARM @MMOD     DSFDY                           S01194
     C************         PARM           @MMOD                           S01194
     C*                                                                   S01194
0642 C*  CHECK FOR FRA/IRS INDICATOR                                      S01194
0586 C*
     C*****      IRFRA     IFEQ 'Y'                *IRS/FRA IND ONS01119  S01194
     C           BGFIIN    IFEQ 'Y'                                       S01194
     C**                                                                  S01119
     C***CHAIN*TO*FRA/IRS*CONTROL*DATA RECORD.                    S01119  S01194
     C****                                                        S01119  S01194
0577 C*****                MOVE ' '       BLNK12 12               S01119  S01194
0578 C*****                MOVEL'01      'KEYTAB                  S01119  S01194
0579 C*****                MOVE '  70'    KEYTAB                  S01119  S01194
0580 C*****                EXSR TABCHN                            S01119  S01194
     C*****                                                               S01194
     C*****      *INU7     CABEQ'1'       #A9                     S01119  S01194
0586 C*
     C** CALL ACCESS PROGRAM FOR FRA/IRS  DETAILS                         S01194
     C                     CALL 'AOFAISR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C           @FAIS     PARM @FAIS     DSFDY                           S01194
     C***********          PARM           @FAIS                           S01194
     C*                                                                   S01194
     C                     END                                            S01119
      * Check to see if system value - Display Spot Limit regardless of                       240878
      * whether Limit type has 'SP' at end of first period.                                   240878
     C                     CALL 'AOSVALR0'                                                    240878
     C                     PARM           @RTCD                                               240878
     C                     PARM SVALKK    SVALK1 20                                           240878
     C                     PARM           SVAL1 200                                           240878
     C                     PARM *BLANK    SVALK2 20                                           240878
     C                     PARM           SVAL2 200                                           240878
     C                     PARM *BLANK    SVALK3 20                                           240878
     C                     PARM           SVAL3 200                                           240878
     C                     PARM *BLANK    SVALK4 20                                           240878
     C                     PARM           SVAL4 200                                           240878
     C                     PARM *BLANK    SVALK5 20                                           240878
     C                     PARM           SVAL5 200                                           240878
     C                     PARM *BLANK    SVALK6 20                                           240878
     C                     PARM           SVAL6 200                                           240878
     C                     PARM *BLANK    SVALK7 20                                           240878
     C                     PARM           SVAL7 200                                           240878
     C                     PARM *BLANK    SVALK8 20                                           240878
     C                     PARM           SVAL8 200                                           240878
     C                     PARM *BLANK    SVALK9 20                                           240878
     C                     PARM           SVAL9 200                                           240878
     C                     PARM *BLANK    SVALK0 20                                           240878
     C                     PARM           SVAL10200                                           240878
      *                                                                                       240878
     C           @RTCD     IFNE *BLANK                                                        240878
     C                     MOVELSVALKK    DBKEY                                               240878
     C                     MOVEL'SDSVALPD'DBFILE           ***************                    240878
     C                     Z-ADD002       DBASE            * DBERROR 002 *                    240878
     C                     OUT  LDA                        ************* *                    240878
     C                     MOVE '1'       *INU7                                               240878
     C                     MOVE '1'       *INU8                                               240878
     C                     EXSR *PSSR                                                         240878
     C                     ENDIF                                                              240878
     C                     MOVE SVAL11    SPLCHK  1                                           240878
     C*
     C** OBTAIN NO. OF D.P. FOR LIMITS CCY
     C*****                MOVEL'20      'KEYTAB                          S01194
     C*****                MOVE BCYL      TABCCY                          S01194
     C*****                MOVE '1'       TABSRT                          S01194
     C*****                EXSR TABCHN                                    S01194
     C*****                                                               S01194
     C*****      *INU7     CABEQ'1'       #A9                             S01194
     C*                                                                   S01433
     C** CALL ACCESS PROGRAM FOR BASE CURRENCY FOR DEALING DETAILS        S01433
     C*    AND OBTAIN NO.OF DEC. PLACES                                   S01433
     C                     CALL 'AOCURRR0'                                S01433
     C                     PARM '*DBERR  '@RTCD                           S01433
     C                     PARM '*KEY    '@OPTN                           S01433
     C                     PARM BNCYDL    @AJCD   3                       S01433
     C           @CURR     PARM @CURR     DSSDY                           S01433
     C*                                                                   S01433
     C                     Z-ADDA6NBDP    WWDPI   10                      S01433
     C*                                                                   S01433
     C** CALL ACCESS PROGRAM FOR BASE CURRENCY FOR LIMITS DETAILS         S01194
     C*    AND OBTAIN NO.OF DEC. PLACES
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM BNCYCD    @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C************         PARM           @CURR                           S01194
     C*                                                                   S01194
     C*
     C                     MOVE *BLANKS   WBRCON 14                       S01117
     C                     MOVE *BLANKS   BRDESC 18                       S01117
0593 C*
     C*
     C** CALCULATE FACTOR
     C*****      CDP       ADD  1         DEP     10                      S01194
     C           A6NBDP    ADD  1         DEP     10                      S01194
     C                     Z-ADDFCT,DEP   FACTOR  40
     C*
     C** OBTAIN NO. OF DAYS FORWARD FOR 'SP'
     C*****                Z-ADDRUND      ZDAYNO                          S01194
     C                     Z-ADDBJRDNB    ZDAYNO                          S01194
     C*****                MOVE BCYL      ZCCY                            S01194
     C                     MOVE BNCYCD    ZCCY                            S01194
     C                     Z-ADD2         ZNRDYS
     C                     MOVE BJSLCD    ZLOC    3                       S01195
     C*****                EXSR ZDATE3                                    S01195
     C                     EXSR ZFWDT                                     S01195
     C*****      ZDYNBR    SUB  RUND      SP      50                      S01194
     C           ZDYNBR    SUB  BJRDNB    SP      50                      S01194
     C                     MOVE '-'       HYPHEN  1
     C*
     C***SET*UP*KEY*FOR*CLINT*FILE                                        S01194
     C******               MOVE 'A'       @RCDT   1                       S01194
     C*
     C** SET UP THE WORKSTATION ID
     C                     MOVE @JOB      WSID    3
     C*
     C***********MODFD*****IFEQ*'Y'************************B1*******E14702S01319
     C*********************OPEN*FDINSTLL********************1*******E14702S01319
     C********************************************************************S01319
     C***********IDRCID****IFEQ**BLANKS********************B*2************S01319
     C***********1*********CHAINFDINSTLL*************15******2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C************IN15*****IFEQ*'1'************************B*2************S01319
     C*********************MOVE*'002'*****DBASE***************************S01319
     C*********************MOVEL'FDINSTLL'DBFILE**************************S01319
     C*********************MOVE**BLANKS***DBKEY**************DB*ERROR*002*S01319
     C*********************MOVE*'1'********INU7***************************S01319
     C*********************MOVE*'1'********INU8***************************S01319
     C*********************EXSR**PSSR******************************S01194 S01319
     C*********************GOTO*#A9**************************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1******E14702 S01319
     C*                                                                   S01332
     C           *NAMVAR   DEFN           EMSDS                           S01332
     C*                                                                   S01332
     C** Read in EMSDS to see if this is a linked enquiry or if called    S01332
     C** from Midas menu. If linked, then data in RQDTD will be           S01332
     C** non-blank.                                                       S01332
     C*                                                                   S01332
     C           *LOCK     IN   EMSDS                                     S01332
     C*                                                                   S01332
     C** Start of field will contain customer number, last two chars      S01332
     C** of field will be non-blank.                                      S01332
     C*                                                                   S01332
     C                     MOVELRQDTD     INPUT                           S01332
     C                     MOVE RQDTD     LINK    2                       S01332
     C                     OUT  EMSDS                                     S01332
     C*                                                                   S01332
     C           LINK      IFEQ *BLANKS                                   S01332
     C*                                                                   S01332
     C** OUTPUT THE INITIAL SCREEN
     C                     WRITEDL0130F1                                  S01136
     C                     WRITEDL0130F3                                  S01136
     C*                                                                   S01332
     C                     ELSE                                           S01332
     C*                                                                   S01332
     C** Otherwise, linked enquiry, so set on *IN02 to enable F1 & F12    S01332
     C** keys, and *IN01 to stop initial screen being read the first      S01332
     C** time as it has not been written.                                 S01332
     C*                                                                   S01332
     C                     MOVE '1'       *IN01                           S01332
     C                     MOVE '1'       *IN02                           S01332
     C*                                                                   S01332
     C** If multi-branching is on, then default the branch code to ALL    S01332
     C*                                                                   S01332
     C           *IN75     IFEQ '1'                                       S01332
     C                     MOVE 'ALL'     BCDX                            S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C                     SETOF                     777879               E00044
     C**************       WRITECA0200F1                                  S01136
     C**************       WRITECA0200F3                                  S01136
     C**************       WRITEMM0067F1                                  S01136
     C***************      WRITEMM0067F3                                  S01136
     C*
     C           #A9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - MAIN LINE PROCESSING                               *
     C*                                                               *
     C**CALLS****#BA******-*PROCESSING*FOR*MIDAS*ONLY*********************S01319
     C***********#BB******-*PROCESSING*FOR*MIDAS*AND*DRS-FX*ONLY**********S01319
     C***********#BC******-*PROCESSING*FOR*MIDAS*AND*DRS-MM*ONLY**********S01319
     C*          #BD      - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* CALLED BY  MAIN   - CUSTOMER/PARENT EXPOSURE AGAINST LIMITS   *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C           *INU7     CABEQ'1'       #B9
     C*
     C***RETRIEVE THE EXTERNAL DATA AREA                                  E14702
     C********** *NAMVAR   DEFN MMOD      MMODS                           E14702
     C**********           IN   MMODS                                     E14702
     C*
     C***OPEN*THE*APPROPRIATE*DEALS*FILE**********************************S01319
     C***********MODS******IFEQ*'NN'***********************B1*************S01319
     C*********************OPEN*CUSDE***********************1*************S01319
     C*********************OPEN*DEAMS***********************1*************S01319
     C*********************EXSR*#BA*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********MODS******IFEQ*'YN'***********************B1*************S01319
     C*********************OPEN*FXMIDLLL********************1*************S01319
     C*********************OPEN*DEAMS***********************1*************S01319
     C*********************EXSR*#BB*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********MODS******IFEQ*'NY'***********************B1*************S01319
     C*********************OPEN*MMDLCSLL********************1*************S01319
     C*********************OPEN*MMDMCSLL********************1*************S01319
     C*********************EXSR*#BC*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C***********MODS******IFEQ*'YY'***********************B1*************S01319
     C                     OPEN FXMIDLLL                   *1
     C                     OPEN MMDLCSLL                   *1
     C                     OPEN MMDMCSLL                   *1
     C                     OPEN DEAMS                      *1
     C                     EXSR #BD                        *1
     C*********************END*****************************E1*************S01319
     C*
     C           #B9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#BA******-*PROCESSING*FOR*MIDAS*ONLY******************************S01319
     C********************************************************************S01319
     C**CALLS****#BG******-*INITIALIZATION*OF*THE*DISPLAY*FIELDS**********S01319
     C***********#BE******-*VALIDATION*PROCESSING*************************S01319
     C***********#BF******-*SET*UP*ARRAYS*OF*LIMIT*PERIODS****************S01319
     C***********#BH******-*SET*UP*OF*THE*DISPLAY*FIELDS******************S01319
     C***********#BAA*****-*CALCULATE*EXPOSURE*FOR*MIDAS-FX*ONLY**********S01319
     C***********#BAB*****-*CALCULATE*EXPOSURE*FOR*MIDAS-LOANS************S01319
     C***********#BAC*****-*FORMAT*MIDAS*DEALS*FOR*OUTPUT*****************S01319
     C***********#BI******-*OUTPUT*TO*THE*SCREEN**************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#B*****-*MAIN*LINE*PROCESSING**************************S01319
     C********************************************************************S01319
     C**FLDS*USED*********-***********************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BA*******BEGSR******************************************S01319
     C********************************************************************S01319
     C***DO*PROCESSING*WHILE*COMMAND*KEY*NOT*ACTIVE***********************S01319
     C*********  *INKA     DOWEQ'0'                        B1             S01203
     C************INKC*****DOWEQ'0'************************B1*************S01319
     C************INKA*****ANDEQ'0'                                 S01332S01319
     C************INKL*****ANDEQ'0'                                 S01332S01319
     C**************************************************************S01203S01319
     C********************************************************************S01319
     C***READ*THE*SCREEN***********************************************   S01332
     C**************************************************************S01332S01319
     C***Only*read*the*screen*if**IN01*is*off.*If*this*is*a*linked* S01332S01319
     C***enquiry*(ie.*not*called*directly*from**idas*main*menu),*theS01332S01319
     C****IN01*will*have*been*set*on*in*the*initial*sub-routine*and*S01332S01319
     C***the*initial*screen*will*not*have*been*written.*Therefore,*dS01332S01319
     C***not*try*to*read*it.**IN01*will*then*get*set*off*so*that*on*S01332S01319
     C***subsequent*cycles*the*screen*will*be*read*as*normal.****** S01332S01319
     C*                                                             S01332S01319
     C************IN01*****IFEQ '0'                                 S01332S01319
     C*********************READ DL0130F3                 15         S01136S01319
     C*********************ELSE                                     S01332S01319
     C*********************MOVE '0'       *IN01                     S01332S01319
     C*********************END                                      S01332S01319
     C***************      READ CA0200F3                 15               S01136
     C***************      READ MM0067F3                 15               S01136
     C********************************************************************S01319
     C***CLEAR*THE*SUBFILE************************************************S01319
     C*********************MOVE*'0'********IN41***************************S01319
     C*********************WRITEDL0130CT****************************S01136S01319
     C***************      WRITECA0200CT                                  S01136
     C***************      WRITEMM0067CT                                  S01136
     C********************************************************************S01319
     C***INITIALIZE*THE*DISPLAY*FIELDS************************************S01319
     C*********************EXSR*#BG*************************1*************S01319
     C********************************************************************S01319
     C***VALIDATE*THE*INPUT***********************************************S01319
     C*********************EXSR*#BE*************************1*************S01319
     C********************************************************************S01319
     C************IN39*****CABEQ'1'*******#BA7**************1*************S01319
     C********************************************************************S01319
     C**************************************************************S01117
     C***********@MBIN*****IFEQ*'Y'*********************************S01117S01319
     C************IN76*****IFEQ*'0'************************BOOKING*S01117*S01319
     C*********************MOVEL'BOOKING*'WK10***10*****************S01117S01319
     C*********************MOVE*'BR'******WK10***********************S0111701319
     C*********************MOVELWK10******BRDESC*********************S0111701319
     C*********************MOVE*'ANCH****'BRDESC*********************S0111701319
     C*********************ELSE****************************ORIGINATIN01117S01319
     C*********************MOVEL'ORIGINAT'WK10***********************S0111701319
     C*********************MOVE*'IN'******WK10**********************S01117S01319
     C*********************MOVELWK10******BRDESC********************S01117S01319
     C*********************MOVE*'G*BRANCH'BRDESC********************S01117S01319
     C*********************END**************************************S01117S01319
     C********************************************************************S01319
     C************IN73*****IFEQ*'0'*********************************S01117S01319
     C***********BCDX******ANDNE'ALL'*************************************S01319
     C*********************MOVE*'B'*******LEVEL***1*****************S01117S01319
     C*********************MOVEL'BRANCH*'*WBRCON********************S01117S01319
     C*********************MOVE*'LIMITS*'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C************IN74*****IFEQ*'0'*********************************S01117S01319
     C***********CCDX******ANDNE'ALL'*************************************S01319
     C*********************MOVE*'C'*******LEVEL*********************S01117S01319
     C*********************MOVEL'COMPANY'*WBRCON********************S01117S01319
     C*********************MOVE*'*LIMITS'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LEVEL*********************S01117S01319
     C*********************MOVEL'BANK*LI'*WBRCON********************S01117S01319
     C*********************MOVE*'MITS***'*WBRCON********************S01117S01319
     C*********************END**************************************S01117S01319
     C*********************END**************************************S01117S01319
     C********************************************************************S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LIMK2*********************S01117S01319
     C*********************MOVE *BLANKS   LIMK3                     S01117LN0527
     C*********************MOVEL'SYS'*****LIMK3*********************LN0527S01319
     C*********************END**************************************S01117S01319
     C***SET*UP*LIMITS*ARRAYS*********************************************S01319
     C*********************EXSR*#BF*************************1*************S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BA9**************1******S01117*S01319
     C********************************************************************S01319
     C***CHECK*IF*REQUESTED*CUSTOMER*IS*A*PARENT.*************************S01319
     C*********************TESTB'2'*******CMIN***********54*1********01194S01319
     C***********BBPAIN****IFEQ*'P'*********************************S01194S01319
     C*********************MOVE*'1'********IN54*********************S01194S01319
     C*********************ELSE*************************************S01194S01319
     C*********************MOVE*'0'********IN54*********************S01194S01319
     C*********************END**************************************S01194S01319
     C********************************************************************S01319
     C***SET*UP*FIELDS*FOR*THE*HEADER*OUTPUT******************************S01319
     C*********************EXSR*#BH***************************************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*CUSTOMER**********************************************S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C************IN54*****IFEQ*'1'************************B*2************S01319
     C*********************Z-ADDCNUM******LIMPAR**60*********2******S01194S01319
     C*********************MOVELBBCUST****LIMPAR**6**********2******S01194S01319
     C***********LIMPAR****SETLLPACUS************************2******S01194S01319
     C***********LIMPAR****SETLLSDCUSTL4*********************2******S01194S01319
     C***********LIMPAR****READEPACUS********************51**2******S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51**2******S01194S01319
     C********************************************************************S01319
     C************IN51*****IFEQ*'1'************************B**3***********S01319
     C***********RECI******ORNE*'D'***************************3*****S01194S01319
     C*********************GOTO*#BA6**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************Z-ADDCNUM******LIMCUS**60*********2******S01194S01319
     C*********************MOVELBBCUST****LIMCUS**60*********2******S01194S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************Z-ADDCNUM******LIMCUS*************2******S01194S01319
     C*********************MOVELBBCUST****LIMCUS*************2******S01194S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*DEAL**************************************************S01319
     C***********LIMCUS****SETLLCUSDE*************************************S01319
     C********************************************************************S01319
     C***CHAIN*DEALS*FILE*&*UPDATE*EXPOSURE*FOR*EVERY*DNO*****************S01319
     C************IN52*****DOWEQ'0'************************B*2************S01319
     C********************************************************************S01319
     C***********LIMCUS****READECUSDE********************52**2************S01319
     C********************************************************************S01319
     C***IF*NO*MORE*DEALS*FOR*THIS*CUSTOMER*******************************S01319
     C************IN52*****IFEQ*'1'************************B**3***********S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C************IN54*****IFNE*'1'************************B***4**********S01319
     C*********************GOTO*#BA6***************************4**********S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C*********************ELSE****************************X***4**********S01319
     C***********LIMPAR****READEPACUS********************51****4****S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51****4****S01194S01319
     C********************************************************************S01319
     C***********RECI******IFNE*'D'************************B****5***S01194S01319
     C************IN51*****OREQ*'1'*****************************5***S01194S01319
     C************IN51*****IFEQ*'1'*****************************5***S01194S01319
     C*********************GOTO*#BA5****************************5*********S01319
     C*********************END*****************************E****5*********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN52****************4**********S01319
     C*********************Z-ADDCNUM******LIMCUS***************4****S01194S01319
     C*********************MOVELBBCUST****LIMCUS***************4****S01194S01319
     C***********LIMCUS****SETLLCUSDE**************************4**********S01319
     C*********************GOTO*#BA5***************************4**********S01319
     C*********************END*****************************E***4**********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***CALCULATE*EXPOSURE*FROM*DEAL*************************************S01319
     C***DISREGARD*RECORDS*WITHOUT*RECORD*ID*OF*DB,DD*OR*DC,*OR*WITH***AN*S01319
     C***ENTRY*IN*FACILITY*FILE.******************************************S01319
     C***********RECI******CABNE'D'*******#BA5***************2************S01319
     C**************************************************************S01119S01319
     C*****CALCULATE*EXPOSURE*FOR*FRA/IRS***************************S01119S01319
     C**************************************************************S01119S01319
     C***********RECFMT****IFEQ*'DEALSCGF'*****************B**3*****S01119S01319
     C*********************EXSR*FRAIRS******************************S01119S01319
     C**************************************************************S01119S01319
     C************INU7*****CABEQ'1'*******#BA9****************3*****S01119S01319
     C*********************GOTO*#BA5********************************LN0527S01319
     C*********************END*****************************E**3*****S01119S01319
     C********************************************************************S01319
     C*****CALCULATE*EXPOSURE*FOR*FX*DEALS********************************S01319
     C********************************************************************S01319
     C***********RECFMT****IFEQ*'DEALSCBF'*****************B**3***********S01319
     C*********************MOVE*'0'********IN70***************3*****S01117S01319
     C*********************EXSR*#BAA**************************3*****S01117S01319
     C************IN70*****CABEQ'1'*******#BA5****************3*****S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BA9****************3***********S01319
     C********************************************************************S01319
     C************IN16*****CABEQ'1'*******#BA5****************3***********S01319
     C********************************************************************S01319
     C***CALCULATE*EXPOSURE*FOR*LOANS*************************************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X**3***********S01319
     C********************************************************************S01319
     C***********FACT******CABNE*ZEROS****#BA5****************3***********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN70***************3*****S01117S01319
     C*********************EXSR*#BAB**************************3*****01117*S01319
     C************IN70*****CABEQ'1'*******#BA5****************3*****S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BA9****************3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********#BA5******TAG********************************************S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*****AFTER*SETTING*UP*EXPOSURE*ARRAYS,*ROUND*EXP.*AMTS*TO*1000'S****S01319
     C***AND*SET*INDICATORS*FOR*NON-DISPLAY*OF*FIELDS*********************S01319
     C***--*FIRST*FX*AMOUNTS.*********************************************S01319
     C***********#BA6******TAG******************************1*************S01319
     C********************************************************************S01319
     C*********************EXSR*#BAC************************1*************S01319
     C********************************************************************S01319
     C***WRITE*THE*SCREEN*************************************************S01319
     C***********#BA7******TAG******************************1*************S01319
     C********************************************************************S01319
     C***OUTPUT*DETAILS*TO*THE*SCREEN*************************************S01319
     C*********************EXSR*#BI*************************1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#BA9******ENDSR******************************************S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #BAA     - CALCULATE EXPOSURE FOR MIDAS-FX ONLY               *
     C*                                                               *
     C* CALLS    TABCHN   - CHAIN TO THE TABLE FILE                   *
     C*          DLEXPF   - CALCULATES THE EXPOSURE FOR AN FX DEAL    *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BAA      BEGSR
     C*
     C** CLEAR INDICATOR
     C                     MOVE '0'       *IN16
     C*
     C**   CHECK DEAL TYPE
     C           DTYP      IFEQ 'FP'                       B1
     C           DTYP      OREQ 'FS'                       X1
     C           DTYP      OREQ 'PI'                       X1
     C           DTYP      OREQ 'SI'                       X1
     C           DTYP      OREQ 'CX'                       X1
     C           DTYP      OREQ 'OT'                       X1
     C           DTYP      OREQ 'SW'                       X1
     C           DTYP      OREQ 'OP'                       X1
     C**                                                                  S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
      *
     C** IF BRANCH ENTERED                                                S01117
     C** IF ORIGINATING BRANCH                                            S01117
     C           *IN73     IFNE '1'                        B*2            S01117
     C           *IN76     IFEQ '1'                        B**3           S01117
     C           BCDX      ANDNEORBR                       ***3           S01117
     C                     MOVE '1'       *IN70            ***3           S01117
     C                     GOTO #BAA9                      ***3           S01117
     C                     END                             E**3           S01117
     C** BOOKING BRANCH                                                   S01117
     C           *IN76     IFEQ '0'                        B**3           S01117
     C           BCDX      ANDNEBRCA                       B**3           S01117
     C                     MOVE '1'       *IN70            ***3           S01117
     C                     GOTO #BAA9                      ***3           S01117
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
     C** IF COMPANY ENTERED                                               S01117
     C           *IN74     IFEQ '0'                        B*2            S01117
     C** IF BOOKING BRANCH ENTERED                                        S01117
     C           *IN76     IFEQ '0'                        B**3           S01117
     C                     MOVE BRCA      HBRC    3        ***3           S01117
     C                     ELSE                            X**3           S01117
     C** IF ORIGINATING BRANCH ENTERED                                    S01117
     C                     MOVE ORBR      HBRC             ***3           S01117
     C                     END                             E**3           S01117
      ** Check that  branch code exists on SDBRCHPD                       S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7        **2            S01117
     C                     PARM '*KEY   ' @OPTN   7        **2            S01117
     C                     PARM HBRC      @DSNB   3        **2            S01117
     C********** @BRCH     PARM @BRCH     DSFDY                                        S01194 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C***********          PARM           @BRCH            **2            S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C           CCDX      ORNE A8CMCD                     ***3           S01117
     C           CCDX      ANDNE*BLANKS                                   S01117
     C                     MOVE '1'       *IN70            ***3           S01117
     C                     GOTO #BAA9                      ***3           S01117
     C                     END                             E**3           S01117
     C*
     C                     END                             E*2            S01117
     C*
     C                     END                                            S01117
0823 C**
     C                     Z-ADDVDAT      DLVALU           *1
     C*
     C           DTYP      IFEQ 'OP'                       B*2
     C                     Z-ADDOTDT      DLVALU           **2
     C                     END                             E*2
     C*
     C                     ELSE                            X1
     C*
     C                     MOVE '1'       *IN16            *1
     C                     GOTO #BAA9                      *1
     C*
     C                     END                             E1
     C*
     C** IGNORE BACK VALUED DEALS
     C*****      DLVALU    IFLT RUND                       B1             S01194
     C           DLVALU    IFLT BJRDNB                     B1             S01194
     C                     MOVE '1'       *IN16            *1
     C                     GOTO #BAA9                      *1
     C                     END                             E1
     C** CALCULATE LIMIT CCY EQUIV AMT - DLAMTF.
     C                     MOVE '0'       *IN56                           E310
     C*  - IF PURCHASE CCY IS BCYL - DLAMTF IS PURCHASE AMT
     C*****      PUCY      IFEQ BCYL                       B1             S01194
     C           PUCY      IFEQ BNCYCD                     B1
     C           PUAM      DIV  FACTOR    DLAMTF    H      *1
     C                     MOVE '1'       *IN56            *1
     C                     END                             E1
     C*
     C** - IF SELL CCY IS BCYL - DLAMTF IS SELL AMT.
     C*****      SLCY      IFEQ BCYL                       B1             S01194
     C           SLCY      IFEQ BNCYCD                     B1             S01194
     C           SLAM      DIV  FACTOR    DLAMTF    H      *1
     C                     MOVE '1'       *IN56            *1
     C                     END                             E1
     C*
     C           *IN56     CABEQ'1'       #BAA8
     C*
     C** - ELSE DIVIDE PURCHASE AMT BY LIMIT CCY EQUIV. RATE
     C*****                MOVE BLNK12    KEYTAB                          S01194
     C*****                MOVE '20'      TABRT                           S01194
     C*****                MOVE PUCY      TABCCY                          S01194
     C*****                MOVE '1'       TABSRT                          S01194
     C*****                EXSR TABCHN                                    S01194
     C** CALL ACCESS PROGRAM FOR PURCHASE CURRENCY DETAILS                S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM PUCY      @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C************         PARM           @CURR                           S01194
     C*
     C*****      *INU7     CABEQ'1'       #BAA9                           S01194
     C*
     C*****      CDP       ADD  1         DEP                             S01194
     C           A6NBDP    ADD  1         DEP                             S01194
     C           PUAM      DIV  FCT,DEP   PUAM      H
     C*
     C*****      ERLC      IFNE 0                          B1             S01194
     C           A6ERLC    IFNE 0                          B1             S01194
     C*****      MDIN      IFEQ 0                          B*2            S01194
     C*****      A6A8ST    IFEQ '0'                        B*2      S01194E134
     C           A6MDIN    IFEQ 'D'                        B*2            E134
     C*****      PUAM      DIV  ERLC      DLAMTF    H      **2            S01194
     C           PUAM      DIV  A6ERLC    DLAMTF    H      **2            S01194
     C*
     C                     ELSE                            X*2
     C*****      PUAM      MULT ERLC      DLAMTF    H      **2            S01194
     C           PUAM      MULT A6ERLC    DLAMTF    H      **2            S01194
     C                     END                             E*2
     C*
     C                     ELSE                            X1
     C                     Z-ADDPUAM      DLAMTF           *1
     C                     END                             E1
     C*
     C           #BAA8     TAG
     C                     EXSR DLEXPF
     C*
     C           #BAA9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAB     - CALCULATE EXPOSURE FOR MIDAS-LOANS                 *
     C*                                                               *
     C* CALLS   *TABCHN***-*CHAIN*TO*THE*TABLE*FILE                   *   S01194
     C*          DLEXPL   - CALCULATES THE EXPOSURE OF ALOAN          *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED  @DLN1  - PARTIAL KEY TO THE DEAMS FILE             *
     C*            @DAV1  - PARTIAL KEY TO THE DEAMS FILE             *
     C*            @DAS1  - PARTIAL KEY TO THE DEAMS FILE             *
     C*            @DEMKY - KEY TO THE DEAMS FILE                     *
     C*                                                               *
     C*****************************************************************
     C           #BAB      BEGSR
     C*
     C** DISREGARD IF ROLLED OVER BY DEAL NO. IS NOT BLANK
     C           RECI      CABNE'D'       #BAB9
     C*
     C           RBDN      CABNE*ZEROS    #BAB9
     C*
     C** CHECK DEAL TYPE
     C           DTYP      IFEQ 'IP'                       B1
     C           DTYP      OREQ 'CL'                       X1
     C           DTYP      OREQ 'DL'                       X1
     C           DTYP      OREQ 'TI'                       X1
     C           DTYP      OREQ 'BD'                       X1
     C           DTYP      OREQ 'TB'                       X1
     C           DTYP      OREQ 'DA'                       X1
     C           DTYP      OREQ 'TA'                       X1
     C           DTYP      OREQ 'BP'                       X1
     C           DTYP      OREQ 'C1'                       X1
     C           DTYP      OREQ 'C2'                       X1
     C*
     C**                                                                  S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C*
     C** IF BRANCH ENTERED                                                S01117
     C** IF ORIGINATING BRANCH                                            S01117
     C           *IN73     IFNE '1'                                       S01117
     C           *IN76     IFEQ '1'                                       S01117
     C           BCDX      ANDNEORBR                                      S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BAB9                                     S01117
     C                     END                                            S01117
     C** BOOKING BRANCH                                                   S01117
     C           *IN76     IFEQ '0'                                       S01117
     C           BCDX      ANDNEBRCA                                      S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BAB9                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C** IF COMPANY ENTERED                                               S01117
     C           *IN74     IFEQ '0'                                       S01117
     C** IF BOOKING BRANCH ENTERED                                        S01117
     C           *IN76     IFEQ '0'                                       S01117
     C                     MOVE BRCA      HBRC                            S01117
     C                     ELSE                                           S01117
     C** IF ORIGINATING BRANCH ENTERED                                    S01117
     C                     MOVE ORBR      HBRC                            S01117
     C                     END                                            S01117
      ** Check that  branch code exists on SDBRCHPD                       S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7        **2            S01117
     C                     PARM '*KEY   ' @OPTN   7        **2            S01117
     C                     PARM HBRC      @DSNB   3        **2            S01117
     C********** @BRCH     PARM @BRCH     DSFDY                                        S01194 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C*************        PARM           @BRCH            **2            S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C           CCDX      ORNE A8CMCD                     ***3           S01117
     C           CCDX      ANDNE*BLANKS                                   S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BAB9                                     S01117
     C                     END                                            S01117
     C                     END
0823 C**
      *
     C                     END                                            S01117
     C** CALCULATE EXPOSURE.
     C                     Z-ADDMDAT      DLMATD           *1
     C                     Z-ADDNOTD      DLNOTD           *1
     C*
     C           RECFMT    IFEQ 'DEALSCDF'                 B*2
     C           RECGMT    OREQ 'DDDEALP0'                 X*2
     C                     Z-ADD*ZEROS    DLNOTD           **2
     C                     Z-ADDFVAL      PCPL             **2
     C                     END                             E*2
     C**
     C*****                MOVE BLNK12    KEYTAB           *1             S01194
     C*****                MOVE '20'      TABRT            *1             S01194
     C*****                MOVE CCY       TABCCY           *1             S01194
     C*****                MOVE '1'       TABSRT           *1             S01194
     C*****                EXSR TABCHN                     *1             S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C************         PARM           @CURR                           S01194
     C*
     C*****      *INU7     CABEQ'1'       #BAB9            *1             S01194
     C*
     C*****      CDP       ADD  1         DEP              *1             S01194
     C           A6NBDP    ADD  1         DEP              *1             S01194
     C           PCPL      DIV  FCT,DEP   PCPL      H      *1
     C*
     C*****      ERLC      IFNE 0                          B*2            S01194
     C           A6ERLC    IFNE 0                          B*2            S01194
     C*****      MDIN      IFEQ 0                          B**3           S01194
     C*****      A6A8ST    IFEQ '0'                        B**3     S01194E134
     C           A6MDIN    IFEQ 'D'                        B**3           E134
     C*****      PCPL      DIV  ERLC      DLAMTL    H      ***3           S01194
     C           PCPL      DIV  A6ERLC    DLAMTL    H      ***3           S01194
     C*
     C                     ELSE                            X**3
     C*****      PCPL      MULT ERLC      DLAMTL    H      ***3           S01194
     C           PCPL      MULT A6ERLC    DLAMTL    H      ***3           S01194
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C*
     C                     Z-ADDPCPL      DLAMTL           **2
     C                     END                             E*2
     C*
     C                     EXSR DLEXPL                     *1
     C*
     C** IF ANY AMENDMENTS INCREASE PRINCIPAL, ADD INCREASE TO EXP. A  MTS
     C           DASN      CABEQ*ZEROS    #BAB9            *1
     C*
     C                     Z-ADDDLNO      @DLN1   60
     C                     Z-ADDDAVD      @DAV1   50
     C                     Z-ADDDASN      @DAS1   30
     C*
     C**   CHAIN TO DEAMS FOR THIS & SUBSEQUENT AMENDMENTS
     C           @DEMKY    KLIST                           *1
     C                     KFLD           @DLN1
     C                     KFLD           @DAV1
     C                     KFLD           @DAS1
     C*
     C           @DEMKY    SETLLDEAMS
     C           @DEMKY    READEDEAMS                    51
     C*
     C           *IN51     IFEQ '1'                        B*2
     C           *LOCK     IN   LDA                                                           194042
     C                     MOVE '003'     DBASE            ****************
     C                     MOVEL'DEAMS   'DBFILE           *              *
     C                     MOVE DLNO      DBKEY            * DB ERROR 003 *
     C                     OUT  LDA                        *              *                   194042
     C                     MOVE '1'       *INU7            *              *
     C                     MOVE '1'       *INU8            ****************
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #BAB9                      **2
     C                     END                             E*2
     C*
     C           *IN51     DOWEQ'0'                        B*2
     C*
     C*
     C**   ONLY PROCESS AMENDMENT TYPE PI
     C           RECI      IFNE 'D'                        B**3
     C           AMTP      ORNE 'PI'                       X**3
     C                     GOTO #BAB8                      ***3
     C                     END                             E**3
     C**
     C*****                MOVE BLNK12    KEYTAB           **2            S01194
     C*****                MOVE '20'      TABRT            **2            S01194
     C*****                MOVE CCY       TABCCY           **2            S01194
     C*****                MOVE '1'       TABSRT           **2            S01194
     C*****                EXSR TABCHN                     **2            S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C************         PARM           @CURR                           S01194
     C*
     C*****      *INU7     CABEQ'1'       #BAB9            **2            S01194
     C*
     C*****      CDP       ADD  1         DEP              **2            S01194
     C           A6NBDP    ADD  1         DEP              **2            S01194
     C           DAAM      DIV  FCT,DEP   DAAM      H      **2
     C*
     C*****      MDIN      IFEQ 0                          B**3           S01194
     C*****      A6A8ST    IFEQ '0'                        B**3     S01194E134
     C           A6MDIN    IFEQ 'D'                        B**3           E134
     C*****      DAAM      DIV  ERLC      DLAMTL    H      ***3           S01194
     C           DAAM      DIV  A6ERLC    DLAMTL    H      ***3           S01194
     C                     ELSE                            X**3
     C*****      DAAM      MULT ERLC      DLAMTL    H      ***3           S01194
     C           DAAM      MULT A6ERLC    DLAMTL    H      ***3           S01194
     C                     END                             E**3
     C*
     C           NOTD      IFGT 0                          B**3
     C           VDAT      ADD  NOTD      DLMATD           ***3
     C                     ELSE                            X**3
     C                     Z-ADDVDAT      DLMATD           ***3
     C                     END                             E**3
     C*
     C                     EXSR DLEXPL                     **2
     C*
     C** SETUP KEY FOR NEXT DEAMS REC. IF THERE IS ONE.
     C           #BAB8     TAG                                         **
     C           NAAD      IFNE 0                          B**3
     C*
     C                     Z-ADDNAAD      @DAV1            ***3
     C                     Z-ADDNASN      @DAS1            ***3
     C*
     C           @DEMKY    READEDEAMS                    51***3
     C                     ELSE                            X**3
     C                     GOTO #BAB9                      ***3
     C*
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BAB9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAC     - FORMAT MIDAS DEALS FOR OUTPUT                      *
     C*                                                               *
     C* CALLS    ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT     *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BAC      BEGSR
     C*
     C           XFXP      DIV  1000      XFXP      H
     C           XFXP1     DIV  1000      XFXP1     H                     S01433
     C********** XPXP      DIV  1000      XPXP      H                     S01433
     C********** XPXP1     DIV  1000      XPXP1     H                     S01433
     C*
     C                     Z-ADD2         D
     C*
     C           D         DO   6
     C*
     C           XFDA,D    IFEQ 0
     C                     MOVE *BLANKS   XFXS,D
     C**********           MOVE *BLANKS   XMXS,D                          S01433
     C**********           MOVE *BLANKS   XPXS,D                          S01433
     C                     END
     C*
     C                     ADD  1         D
     C*
     C                     END
     C**
     C**   -- PERIOD DATES
     C**
     C*******              MOVE '001'     XFS,1                           S01433
     C**********           MOVE '002'     XFS,1                           S01433
     C**********           MOVE '002'     XMS,1                           S01433
     C                     MOVE '001'     XFS,1                           S01433
     C**********           MOVE '001'     XMS,1                           S01433
     C                     MOVE HYPHEN    XFHY,1
     C**********           MOVE HYPHEN    XMHY,1                          S01433
     C******                                                              S01117
     C***NO*LIMITS (& NOT DEFAULTED) OR EXPIRED LIMITS                    S01117
     C******     *IN48     IFEQ '1'                                       S01117
     C*****      FLED      OREQ 0                                         S01194
     C******     DZFLED    OREQ 0                                         S01194
     C******     FDEF      ANDNE'Y'                                       S01117
     C******               Z-ADD*ZEROS    XFXP,1                          S01117
     C******               Z-ADD2         D                               S01117
     C******     D         DOWLE6                                         S01117
     C******               Z-ADD*ZEROS    XFS,D                           S01117
     C******               ADD  1         D                               S01117
     C******               END                                            S01117
     C***NO LIMITS (& NOT DEFAULTED) OR EXPIRED LIMITS                    BHF291
     C********   *IN48     IFEQ '1'                                       BHF291
     C********   DZFLED    OREQ 0                                         BHF291
     C********   FDEF      ANDNE'Y'                                       BHF291
     C********             Z-ADD*ZEROS    XFXP,1                          BHF291
     C********             Z-ADD2         D                               BHF291
     C********   D         DOWLE6                                         BHF291
     C********             Z-ADD*ZEROS    XFS,D                           BHF291
     C********             ADD  1         D                               BHF291
     C********             END                                            BHF291
     C*
     C** LIMITS EXIST
     C******               ELSE
     C********             ELSE                                           BHF291
     C*
     C                     Z-ADD1         D
     C                     Z-ADD2         E       30
     C*
     C           E         DOWLE6
     C*
     C           XFDAA,D   IFNE '999'
     C***********XFDAA,D   ORNE '   '                                     E17435
     C           XFDAA,D   ANDNE'000'                                     E17435
     C***********XFDAA,D   ORNE '   '                               E19837BHF291
     C           XFDAA,D   ANDNE'   '                                     BHF291
     C           XFDA,D    ADD  1         XFS,E
     C********** XFDA,D    ADD  1         XMS,E                           S01433
     C                     MOVE HYPHEN    XFHY,E
     C**********           MOVE HYPHEN    XMHY,E                          S01433
     C           D         ADD  1         D
     C           E         ADD  1         E
     C                     ELSE
     C***********          Z-ADD6         E                               E17435
     C                     Z-ADD7         E                               E17435
     C*
     C                     END
     C*********            END                                            BHF291
     C*
     C                     END
     C******               END                                            S01117
     C*                                                                   S01433
     C* NOW PRECIOUS METALS                                               S01433
     C           XPXP      DIV  1000      XPXP      H                     S01433
     C           XPXP1     DIV  1000      XPXP1     H                     S01433
     C*                                                                   S01433
     C                     Z-ADD2         D                               S01433
     C*                                                                   S01433
     C           D         DO   6                                         S01433
     C*                                                                   S01433
     C           XPDA,D    IFEQ 0                                         S01433
     C                     MOVE *BLANKS   XPXS,D                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     ADD  1         D                               S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C**                                                                  S01433
     C**   -- PERIOD DATES                                                S01433
     C**                                                                  S01433
     C                     MOVE '001'     XPS,1                           S01433
     C                     MOVE HYPHEN    XPHY,1                          S01433
     C*                                                                   S01433
     C** LIMITS EXIST                                                     S01433
     C*                                                                   S01433
     C                     Z-ADD1         D                               S01433
     C                     Z-ADD2         E       30                      S01433
     C*                                                                   S01433
     C           E         DOWLE6                                         S01433
     C*                                                                   S01433
     C           XPDAA,D   IFNE '999'                                     S01433
     C           XPDAA,D   ANDNE'000'                                     S01433
     C           XPDAA,D   ANDNE'   '                                     S01433
     C           XPDA,D    ADD  1         XPS,E                           S01433
     C                     MOVE HYPHEN    XPHY,E                          S01433
     C           D         ADD  1         D                               S01433
     C           E         ADD  1         E                               S01433
     C                     ELSE                                           S01433
     C                     Z-ADD7         E                               S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*
     C**   -- THEN LOANS AMOUNTS
     C           XLXP      DIV  1000      XLXP      H
     C*
     C                     Z-ADD2         D
     C*
     C           D         DO   6
     C*
     C           XLDA,D    IFEQ 0
     C                     MOVE *BLANKS   XLXS,D
     C                     END
     C*
     C                     ADD  1         D
     C*
     C                     END
     C**
     C**   -- PERIOD DATES
     C**
     C                     MOVE '001'     XLS,1
     C                     MOVE HYPHEN    XLHY,1
     C******                                                              S01117
     C***NO*LIMITS (& NOT DEFAULTED) OR EXPIRED LIMITS                    S01117
     C******     *IN49     IFEQ '1'                                       S01117
     C*****      LLED      OREQ 0                                         S01194
     C******     DZLLED    OREQ 0                                         S01194
     C******     LDEF      ANDNE'Y'                                       S01117
     C******               Z-ADD*ZEROS    XLXP,1                          S01117
     C******               Z-ADD2         D                               S01117
     C******     D         DOWLE6                                         S01117
     C******               Z-ADD*ZEROS    XLS,D                           S01117
     C******               ADD  1         D                               S01117
     C******               END                                            S01117
     C***NO LIMITS (& NOT DEFAULTED) OR EXPIRED LIMITS                    BHF291
     C*******    *IN49     IFEQ '1'                                       BHF291
     C********   DZLLED    OREQ 0                                         BHF291
     C********   LDEF      ANDNE'Y'                                       BHF291
     C*********            Z-ADD*ZEROS    XLXP,1                          BHF291
     C********             Z-ADD2         D                               BHF291
     C*********  D         DOWLE6                                         BHF291
     C********             Z-ADD*ZEROS    XLS,D                           BHF291
     C*********            ADD  1         D                               BHF291
     C********             END                                            BHF291
     C*
     C** LIMITS EXIST
     C******               ELSE
     C********             ELSE                                           BHF291
     C*
     C**   -- PERIOD DATES
     C                     Z-ADD1         D
     C                     Z-ADD2         E
     C*
     C           E         DOWLE6
     C*
     C           XLDAA,D   IFNE '999'
     C***********XLDAA,D   ORNE '   '                                     E17435
     C           XLDAA,D   ANDNE'000'                                     E17435
     C***********XLDAA,D   ORNE '   '                               E19837BHF291
     C           XLDAA,D   ANDNE'   '                                     BHF291
     C           XLDA,D    ADD  1         XLS,E
     C                     MOVE HYPHEN    XLHY,E
     C           D         ADD  1         D
     C           E         ADD  1         E
     C                     ELSE
     C***********          Z-ADD6         E                               E17435
     C                     Z-ADD7         E                               E17435
     C                     END
     C********             END                                            BHF291
     C*
     C                     END
     C/COPY WNCPYSRC,DL0130AC02
     C*
     C******               END                                            S01117
     C*
     C           *IN48     IFNE '1'
     C*
     C******     FLTY      IFNE 0                                         S01194
     C           DZFXLT    IFNE *BLANKS                                   S01194
     C*****      FLED      ANDNE0                                         S01194
     C           DZFLED    ANDNE0                                         S01194
     C*****                Z-ADDFLED      ZDAYNO                          S01194
     C                     Z-ADDDZFLED    ZDAYNO                          S01194
     C                     EXSR ZDATE2
     C           DZFLAM    IFGT 0                                         S01433
     C                     MOVE *BLANK    FEXPRA                          S01157
     C*********            MOVE ZADATE    FEXPRA                          S01157
     C                     MOVELZADATE    FEXPRA  9                       S01157
     C                     END                                            S01433
     C           DZFXFA    IFGT 0                                         S01433
     C                     MOVE *BLANK    FEXPRF                          S01433
     C                     MOVELZADATE    FEXPRF  9                       S01433
     C                     END                                            S01433
     C                     END
     C*                                                                   S01433
     C                     END
     C*                                                                   S01433
     C           *IN50     IFNE '1'                                       S01433
     C*                                                                   S01433
     C           DZPLTY    IFNE *BLANKS                                   S01433
     C           DZPLED    ANDNE0                                         S01433
     C                     Z-ADDDZPLED    ZDAYNO                          S01433
     C                     EXSR ZDATE2                                    S01433
     C           DZPSAM    IFGT 0                                         S01433
     C                     MOVE *BLANK    PMXPRA                          S01433
     C                     MOVELZADATE    PMXPRA  9                       S01433
     C                     END                                            S01433
     C           DZPFAM    IFGT 0                                         S01433
     C                     MOVE *BLANK    PMXPRF                          S01433
     C                     MOVELZADATE    PMXPRF  9                       S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*
     C           *IN49     IFNE '1'
     C*
     C*****      LLTY      IFNE 0                                         S01194
     C*******    DZLLTY    IFNE *BLANKS                            S01194 S01433
     C           DZMMTY    IFNE *BLANKS                                   S01433
     C*****      LLED      ANDNE0                                         S01194
     C*******    DZLLED    ANDNE0                                  S01194 S01433
     C           DZMMED    ANDNE0                                         S01433
     C*****                Z-ADDLLED      ZDAYNO                          S01194
     C*******              Z-ADDDZLLED    ZDAYNO                   S01194 S01433
     C                     Z-ADDDZMMED    ZDAYNO                          S01433
     C                     EXSR ZDATE2
     C                     MOVE *BLANK    LEXPRA                          S01157
     C*******              MOVE ZADATE    LEXPRA                          S01157
     C                     MOVELZADATE    LEXPRA  9                       S01157
     C                     END
     C/COPY WNCPYSRC,DL0130AC03
     C*
     C                     END
     C*
     C** CALCULATE EXCESS
     C                     Z-ADD1         X       10
     C*
     C           X         DOWLE6                                      **
     C           XFXP,X    SUB  XFLM,X    XFXS,X
     C           XPXP,X    SUB  XPLM,X    XPXS,X                          S01433
     C           XLXP,X    SUB  XLLM,X    XLXS,X
     C/COPY WNCPYSRC,DL0130AC04
     C*
     C           XFXS,X    IFLT 0
     C                     Z-ADD0         XFXS,X
     C                     END
     C*                                                                   S01433
     C           XPXS,X    IFLT 0                                         S01433
     C                     Z-ADD0         XPXS,X                          S01433
     C                     END                                            S01433
     C*
     C           XLXS,X    IFLT 0
     C                     Z-ADD0         XLXS,X
     C                     END
     C*
     C           X         ADD  1         X
     C                     END
     C*
     C** SET UP FIELDS FOR DISPLAY
     C                     MOVE *BLANKS   XFNM,1
     C                     MOVE *BLANKS   XPNM,1                          S01433
     C                     MOVE *BLANKS   XFNM,2                          S01433
     C                     MOVE *BLANKS   XPNM,2                          S01433
     C*********************MOVEL' FX -   'XFEX,1                          S01157
     C*******              MOVEL'FX      'XFEX,1                   S01157 S01433
     C                     MOVEL'FX FWD  'XFEX,1                          S01433
     C                     MOVEL'METAL FW'XPEX,1                          S01433
     C****                 MOVE 'EXPIRY'  XFNM,2                          S01157
     C                     MOVE *BLANKS   XFNM,2                          S01157
     C                     MOVE *BLANKS   XLNM,1
     C*********************MOVE 'LENDING 'XLEX,1                          S01157
     C*******              MOVEL'LENDING 'XLEX,1                   S01157 S01433
     C                     MOVEL'MM      'XLEX,1                          S01433
     C****                 MOVE 'EXPIRY'  XLNM,2                          S01157
     C                     MOVE *BLANKS   XLNM,2                          S01157
     C                     MOVE *BLANK    XFEX,2                          S01157
     C                     MOVE *BLANK    XPEX,2                          S01433
     C                     MOVE *BLANK    XLEX,2                          S01157
     C/COPY WNCPYSRC,DL0130AC05
     C*
     C**IF THERE IS NO EXPIRY DATE, DO NOT PRINT EXPIRY.
     C           DZFLED    IFEQ 0                                         S01433
     C                     MOVE *BLANKS   XFNM,2                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           DZPLED    IFEQ 0                                         S01433
     C                     MOVE *BLANKS   XPNM,2                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           DZMMED    IFEQ 0                                         S01433
     C                     MOVE *BLANKS   XLNM,2                          S01433
     C                     END                                            S01433
     C/COPY WNCPYSRC,DL0130AC06
     C*                                                                   S01433
     C** SET UP LIMITS FIELD
     C***                  MOVE FEXPRA    XFEX,2                          S01157
     C****                 MOVE LEXPRA    XLEX,2                          S01157
     C                     MOVE FEXPRA    XFNM,1                          S01157
     C                     MOVE PMXPRA    XPNM,1                          S01433
     C                     MOVE FEXPRF    XFNM,2                          S01157
     C                     MOVE PMXPRF    XPNM,2                          S01433
     C                     MOVE LEXPRA    XLNM,1                          S01157
     C/COPY WNCPYSRC,DL0130AC07
      *
     C*
     C           #BAC9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#BB******-*PROCESSING*FOR*MIDAS*AND*DRS-FX*ONLY*******************S01319
     C********************************************************************S01319
     C**CALLS****#BG******-*INITIALIZATION*OF*THE*DISPLAY*FIELDS**********S01319
     C***********#BE******-*VALIDATION*PROCESSING*************************S01319
     C***********#BF******-*SET*UP*ARRAYS*OF*LIMIT*PERIODS****************S01319
     C***********#BH******-*SET*UP*OF*THE*DISPLAY*FIELDS******************S01319
     C***********#BBA*****-*CALCULATE*EXPOSURE*FOR*DRS=FX*DEALS***********S01319
     C***********#BAB*****-*CALCULATE*EXPOSURE*FOR*MIDAS-LOANS************S01319
     C***********#BAC*****-*FORMAT*MIDAS*DEALS*FOR*OUTPUT*****************S01319
     C***********#BI******-*OUTPUT*TO*THE*SCREEN**************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#B*****-*MAIN*LINE*PROCESSING**************************S01319
     C********************************************************************S01319
     C**FLDS*USED*********-***********************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BB*******BEGSR******************************************S01319
     C********************************************************************S01319
     C***DO*PROCESSING*WHILE*COMMAND*KEY*NOT*ACTIVE***********************S01319
     C************INKA*****DOWEQ'0'************************B1*******S01203S01319
     C************INKC*****DOWEQ'0'************************B1*************S01319
     C************INKA*****ANDEQ'0'                                 S01332S01319
     C************INKL*****ANDEQ'0'                                 S01332S01319
     C**************************************************************S01203S01319
     C********************************************************************S01319
     C***READ*THE*SCREEN**************************************************S01332
     C*                                                             S01332S01319
     C***Only*read*the*screen*if**IN01*is*off.*If*this*is*a*linked* S01332S01319
     C***enquiry*(ie.*not*called*directly*from*Midas*main*menu),*theS01332S01319
     C****IN01*will*have*been*set*on*in*the*initial*sub-routine*and*S01332S01319
     C***the*initial*screen*will*not*have*been*written.*Therefore,*dS01332S01319
     C***not*try*to*read*it.**IN01*will*then*get*set*off*so*that*on*S01332S01319
     C***subsequent*cycles*the*screen*will*be*read*as*normal.*      S01332S01319
     C*********************                                         S01332S01319
     C************IN01*****IFEQ '0'                                 S01332S01319
     C*********************READ*DL0130F3*****************15*********S01136S01319
     C*********************ELSE                                     S01332S01319
     C*********************MOVE '0'       *IN01                     S01332S01319
     C*********************END                                      S01332S01319
     C*********************                                         S01332S01319
     C*****************    READ CA0200F3                 15               S01136
     C*****************    READ MM0067F3                 15               S01136
     C********************************************************************S01319
     C***CLEAR*THE*SUBFILE************************************************S01319
     C*********************MOVE*'0'********IN41***************************S01319
     C*********************WRITEDL0130CT****************************S01136S01319
     C****************     WRITECA0200CT                                  S01136
     C****************     WRITEMM0067CT                                  S01136
     C********************************************************************S01319
     C***INITIALIZE*THE*DISPLAY*FIELDS************************************S01319
     C*********************EXSR*#BG*************************1*************S01319
     C********************************************************************S01319
     C***VALIDATE*THE*INPUT***********************************************S01319
     C*********************EXSR*#BE*************************1*************S01319
     C********************************************************************S01319
     C************IN39*****CABEQ'1'*******#BB7**************1*************S01319
     C**************************************************************S01117S01319
     C***********@MBIN*****IFEQ*'Y'*********************************S01117S01319
     C********************************************************************S01319
     C************IN76*****IFEQ*'0'************************BOOKING*BS01117S01319
     C*********************MOVEL'BOOKING*'WK10***10*****************S01117S01319
     C*********************MOVE*'BR'******WK10**********************S01117S01319
     C*********************MOVELWK10******BRDESC********************S01117S01319
     C*********************MOVE*'ANCH****'BRDESC********************S01117S01319
     C*********************ELSE****************************ORIGINATIS01117S01319
     C*********************MOVEL'ORIGINAT'WK10**********************S01117S01319
     C*********************MOVE*'IN'******WK10**********************S01117S01319
     C*********************MOVELWK10******BRDESC********************01117*S01319
     C*********************MOVE*'G*BRANCH'BRDESC********************S01117S01319
     C*********************END**************************************S01117S01319
     C********************************************************************S01319
     C************IN73*****IFEQ*'0'*********************************S01117S01319
     C*********************MOVE*'B'*******LEVEL***1*****************S01117S01319
     C*********************MOVEL'BRANCH*'*WBRCON********************S01117S01319
     C*********************MOVE*'LIMITS*'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C************IN74*****IFEQ*'0'*********************************S01117S01319
     C*********************MOVE*'C'*******LEVEL*********************S01117S01319
     C*********************MOVEL'COMPANY'*WBRCON********************S01117S01319
     C*********************MOVE*'*LIMITS'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LEVEL*********************S01117S01319
     C*********************MOVEL'BANK*LI'*WBRCON********************S01117S01319
     C*********************MOVE*'MITS***'*WBRCON********************S01117S01319
     C*********************END**************************************S01117S01319
     C*********************END**************************************S01117S01319
     C********************************************************************S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LIMK2*********************S01117S01319
     C*********************MOVE *BLANKS   LIMK3                     S01117LN0527
     C*********************MOVEL'SYS'*****LIMK3*********************LN0527S01319
     C*********************END**************************************S01117S01319
     C***SET*UP*LIMITS*ARRAYS*********************************************S01319
     C*********************EXSR*#BF*************************1*************S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BB9**************1*******S01117S01319
     C********************************************************************S01319
     C***CHECK*IF*REQUESTED*CUSTOMER*IS*A*PARENT.*************************S01319
     C*********************TESTB'2'*******CMIN***********54*1******S01194*S01319
     C***********BBPAIN****IFEQ*'P'*********************************S01194S01319
     C*********************MOVE*'1'********IN54*********************S01194S01319
     C*********************ELSE*************************************S01194S01319
     C*********************MOVE*'0'********IN54*********************S01194S01319
     C*********************END**************************************S01194S01319
     C********************************************************************S01319
     C***SET*UP*THE*DETAILS*FOR*THE*HEADER********************************S01319
     C*********************EXSR*#BH***************************************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*CUSTOMER**********************************************S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C************IN54*****IFEQ*'1'************************B*2************S01319
     C*********************Z-ADDCNUM******LIMPAR**60*********2*****S01194*S01319
     C*********************MOVELBBCUST****LIMPAR**6**********2******S01194S01319
     C***********LIMPAR****SETLLPACUS************************2******S01194S01319
     C***********LIMPAR****SETLLSDCUSTL4*********************2******S01194S01319
     C***********LIMPAR****READEPACUS********************51**2******S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51**2******S01194S01319
     C********************************************************************S01319
     C************IN51*****IFEQ*'1'************************B**3***********S01319
     C***********RECI******ORNE*'D'***************************3*****S01194S01319
     C*********************GOTO*#BB6**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************Z-ADDCNUM******LIMCUS**60*********2******S01194S01319
     C*********************MOVELBBCUST****LIMCUS**60*********2******S01194S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************Z-ADDCNUM******LIMCUS*************2*******S0119401319
     C*********************MOVELBBCUST****LIMCUS*************2*******S0119401319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*DEAL**************************************************S01319
     C***********LIMCUS****SETLLFXMIDLLL********************1*************S01319
     C********************************************************************S01319
     C***CHAIN*DEALS*FILE*&*UPDATE*EXPOSURE*FOR*EVERY*DNO*****************S01319
     C************IN52*****DOWEQ'0'************************B*2************S01319
     C********************************************************************S01319
     C***********LIMCUS****READEFXMIDLLL*****************52**2************S01319
     C********************************************************************S01319
     C***IF*NO*MORE*DEALS*FOR*THIS*CUSTOMER*******************************S01319
     C************IN52*****IFEQ*'1'************************B**3***********S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C************IN54*****IFNE*'1'************************B***4**********S01319
     C*********************GOTO*#BB6***************************4**********S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C*********************ELSE****************************X***4**********S01319
     C***********LIMPAR****READEPACUS********************51****4****S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51****4****S01194S01319
     C********************************************************************S01319
     C***********RECI******IFNE*'D'************************B****5***S01194S01319
     C************IN51*****OREQ*'1'*****************************5***S01194S01319
     C************IN51*****IFEQ*'1'*****************************5***S01194S01319
     C*********************GOTO*#BB5****************************5*********S01319
     C*********************END*****************************E****5*********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN52****************4**********S01319
     C*********************Z-ADDCNUM******LIMCUS***************4****S01194S01319
     C*********************MOVELBBCUST****LIMCUS***************4****S01194S01319
     C***********LIMCUS****SETLLFXMIDLLL***********************4**********S01319
     C*********************GOTO*#BB5***************************4**********S01319
     C*********************END*****************************E***4**********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***CALCULATE*EXPOSURE*FROM*DEAL*************************************S01319
     C***DISREGARD*RECORDS*WITHOUT*RECORD*ID*OF*DB,DD*OR*DC,*OR*WITH***AN*S01319
     C***ENTRY*IN*FACILITY*FILE.******************************************S01319
     C**************************************************************S01119S01319
     C*****CALCULATE*EXPOSURE*FOR*FRA/IRS***************************S01119S01319
     C**************************************************************01119*S01319
     C***********RECGMT****IFEQ*'DEALSFGF'*****************B**3*****S01119S01319
     C***********RECI******CABNE'D'*******#BB5*************X**3*****S01119S01319
     C*********************EXSR*FRAIRS******************************S01119S01319
     C**************************************************************S01119S01319
     C************INU7*****CABEQ'1'*******#BB9****************3*****S01119S01319
     C*********************GOTO*#BB5********************************LN0527S01319
     C*********************END*****************************E**3*****S01119S01319
     C**************************************************************S01119S01319
     C***********RECGMT****IFEQ*'FXDEALP0'*****************B**3***********S01319
     C********************************************************************S01319
     C***********FHDLTF****CABEQ'1'*******#BB5*************X**3*****E19277S01319
     C***********FHDDLT****CABEQ'D'*******#BB5*************X**3*****E19277S01319
     C********************************************************************S01319
     C*****CALCULATE*EXPOSURE*FOR*FX*DEALS********************************S01319
     C*********************MOVE*'0'********IN70***************3*****01117*S01319
     C*********************EXSR*#BBA**************************3***********S01319
     C************IN70*****CABEQ'1'*******#BB5****************3*****S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BB9****************3***********S01319
     C********************************************************************S01319
     C************IN17*****CABEQ'1'*******#BB5****************3***********S01319
     C********************************************************************S01319
     C***CALCULATE*EXPOSURE*FOR*LOANS*************************************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X**3***********S01319
     C********************************************************************S01319
     C***********FACT******CABNE*ZEROS****#BB5****************3***********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN70***************3*****S01117S01319
     C*********************EXSR*#BAB**************************3***********S01319
     C************IN70*****CABEQ'1'*******#BB5****************3*****S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BB9****************3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********#BB5******TAG*******************************2************S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*****AFTER*SETTING*UP*EXPOSURE*ARRAYS,*ROUND*EXP.*AMTS*TO*1000'S****S01319
     C***AND*SET*INDICATORS*FOR*NON-DISPLAY*OF*FIELDS*********************S01319
     C***--*FIRST*FX*AMOUNTS.*********************************************S01319
     C***********#BB6******TAG******************************1*************S01319
     C********************************************************************S01319
     C*********************EXSR*#BAC************************1*************S01319
     C********************************************************************S01319
     C***********#BB7******TAG******************************1*************S01319
     C********************************************************************S01319
     C***OUTPUT*DETAILS*TO*THE*SCREEN*************************************S01319
     C*********************EXSR*#BI*************************1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#BB9******ENDSR******************************************S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #BBA     - CALCULATE EXPOSURE FOR DRS=FX DEALS                *
     C*                                                               *
     C* CALLS    ZA0680   - YYYYMMDD TO MIDAS DAY NO                  *
     C*          ZA0670   - WHICH IS BUY AND WHICH IS SELL CCY        *
     C*          TABCHN   - CHAIN TO THE TABLE FILE                   *
     C*          DLEXPF   - CALCULATES THE EXPOSURE FOR AN FX DEAL    *
     C*                                                               *
     C* CALLED BY  #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED  @VDAT  - VALUE DATE WORK FIELD                     *
     C*            @@DTIN - INPUT FIELD TO ZA0680                     *
     C*            @@MDNO - INPUT FIELD TO SR.ZA0680                  *
     C*            @ODAT  - OPTION TO DATE WORK FIELD                 *
     C*            @@DBCC - OUTPUT BUY CCY FROM SR.ZA0670             *
     C*            @@DBAM - OUTPUT BUY AMOUNT FROM SR.ZA0670          *
     C*            @@DSCC - OUTPUT SELL CCY FROM SR.ZA0670            *
     C*            @@DSAM - OUTPUT SEE AMOUNT FROM SR.ZA0670          *
     C*                                                               *
     C*****************************************************************
     C           #BBA      BEGSR
     C*
     C** CLEAR INDICATOR
     C                     MOVE '0'       *IN17
     C*
     C**   CHECK DEAL TYPE
     C           FHTYPE    IFEQ 'FP'                       B1
     C           FHTYPE    OREQ 'FS'                       X1
     C           FHTYPE    OREQ 'PI'                       X1
     C           FHTYPE    OREQ 'SI'                       X1
     C           FHTYPE    OREQ 'CX'                       X1
     C           FHTYPE    OREQ 'OT'                       X1
     C           FHTYPE    OREQ 'SW'                       X1
     C           FHTYPE    OREQ 'OP'                       X1
     C*
     C           @MBIN     IFEQ 'Y'                                       S01117
     C** IF BRANCH ENTERED                                                S01117
     C** IF ORIGINATING BRANCH                                            S01117
     C           *IN73     IFNE '1'                                       S01117
     C           *IN76     IFEQ '1'                                       S01117
     C           BCDX      ANDNEFHORBR                                    S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BBA9                                     S01117
     C                     END                                            S01117
     C** BOOKING BRANCH                                                   S01117
     C           *IN76     IFEQ '0'                                       S01117
     C           BCDX      ANDNEFHMBCA                                    S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BBA9                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C** IF COMPANY ENTERED                                               S01117
     C           *IN74     IFEQ '0'                                       S01117
     C** IF BOOKING BRANCH ENTERED                                        S01117
     C           *IN76     IFEQ '0'                                       S01117
     C                     MOVE FHMBCA    HBRC                            S01117
     C                     ELSE                                           S01117
     C** IF ORIGINATING BRANCH ENTERED                                    S01117
     C                     MOVE FHORBR    HBRC                            S01117
     C                     END                                            S01117
      ** Check that  branch code exists on SDBRCHPD                       S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7        **2            S01117
     C                     PARM '*KEY   ' @OPTN   7        **2            S01117
     C                     PARM HBRC      @DSNB   3        **2            S01117
     C********** @BRCH     PARM @BRCH     DSFDY                                        S01194 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C************         PARM           @BRCH            **2            S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C           CCDX      ORNE A8CMCD                     ***3           S01117
     C           CCDX      ANDNE*BLANKS                                   S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BBA9                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
0823 C**
     C** CHANGE THE DATE FORMATS TO MIDAS DAY NO.
     C                     MOVE @VDAT     @@DTIN           *1
     C                     EXSR ZA0680                     *1
     C*
     C                     Z-ADD@@MDNO    DLVALU           *1
     C*
     C           FHTYPE    IFEQ 'OP'                       B*2
     C                     MOVE @ODAT     @@DTIN           **2
     C                     EXSR ZA0680                     **2
     C*
     C                     Z-ADD@@MDNO    DLVALU           **2
     C                     END                             E*2
     C*
     C*
     C** IGNORE BACK VALUED DEALS
     C*****      DLVALU    IFLT RUND                       B1             S01194
     C           DLVALU    IFLT BJRDNB                     B1             S01194
     C                     MOVE '1'       *IN17            *1
     C                     GOTO #BBA9                      *1
     C                     END                             E1
     C*
     C** DETERMINE WHICH IS BUY AND WHICH IS SELL CCY & AMOUNT
     C                     EXSR ZA0670
     C*
     C** CALCULATE LIMIT CCY EQUIV AMT - DLAMTF.
     C                     MOVE '0'       *IN56                     E310  S01433
     C** - IF PURCHASE CCY IS BCYL - DLAMTF IS PURCHASE AMT               S01433
     C*****      @@DBCC    IFEQ BCYL                       B1             S01194
     C           @@DBCC    IFEQ BNCYCD                     B1      S01194 S01433
     C           @@DBAM    DIV  FACTOR    DLAMTF    H      *1             S01433
     C                     MOVE '1'       *IN56            *1             S01433
     C                     END                             E1             S01433
     C*                                                                   S01433
     C** - IF SELL CCY IS BCYL - DLAMTF IS SELL AMT.                      S01433
     C*****      @@DSCC    IFEQ BCYL                       B1             S01194
     C           @@DSCC    IFEQ BNCYCD                     B1      S01194 S01433
     C           @@DSAM    DIV  FACTOR    DLAMTF    H      *1             S01433
     C                     MOVE '1'       *IN56            *1             S01433
     C                     END                             E1             S01433
     C*                                                                   S01433
     C           *IN56     CABEQ'1'       #BBA8                           S01433
     C*                                                                   S01433
     C** - ELSE DIVIDE PURCHASE AMT BY LIMIT CCY EQUIV. RATE              S01433
     C*****                MOVE BLNK12    KEYTAB                          S01194
     C*****                MOVE '20'      TABRT                           S01194
     C*****                MOVE @@DBCC    TABCCY                          S01194
     C*****                MOVE '1'       TABSRT                          S01194
     C*****                EXSR TABCHN                                    S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                  S01194 S01433
     C                     CALL 'AOCURRR0'                         S01194 S01433
     C                     PARM '*DBERR  '@RTCD                    S01194 S01433
     C                     PARM '*KEY    '@OPTN                    S01194 S01433
     C                     PARM @@DBCC    @AJCD   3                S01194 S01433
     C           @CURR     PARM @CURR     DSSDY                    S01194 S01433
     C************         PARM           @CURR                           S01194
     C*                                                                   S01194
     C*****      *INU7     CABEQ'1'       #BBA9                           S01194
     C*
     C*****      CDP       ADD  1         DEP                             S01194
     C           A6NBDP    ADD  1         DEP                      S01194 S01433
     C           @@DBAM    DIV  FCT,DEP   @@DBAM    H                     S01433
     C*****      ERLC      IFNE 0                          B1             S01194
     C           A6ERLC    IFNE 0                          B1      S01194 S01433
     C*****      MDIN      IFEQ 0                          B*2            S01194
     C*****      A6A8ST    IFEQ '0'                        B*2      S01194E134
     C           A6MDIN    IFEQ 'D'                        B*2       E134 S01433
     C*****      @@DBAM    DIV  ERLC      DLAMTF    H      **2            S01194
     C           @@DBAM    DIV  A6ERLC    DLAMTF    H      **2     S01194 S01433
     C*
     C                     ELSE                            X*2            S01433
     C*****      @@DBAM    MULT ERLC      DLAMTF    H      **2            S01194
     C           @@DBAM    MULT A6ERLC    DLAMTF    H      **2     S01194 S01433
     C                     END                             E*2            S01433
     C*
     C                     ELSE                            X1             S01433
     C                     Z-ADD@@DBAM    DLAMTF           *1             S01433
     C                     END                             E1             S01433
     C*
     C           #BBA8     TAG                                            S01433
     C                     EXSR DLEXPF                                    S01433
     C*
     C                     ELSE                            X1             S01433
     C*
     C                     MOVE '1'       *IN17            *1             S01433
     C*
     C**   CALCULATE REVALUATED AMOUNTS                                   S01433
     C                     Z-ADD@@DBAM    WWAMT  150                      S01433
     C                     MOVE @@DBCC    WWCCY   3                       S01433
     C                     EXSR #ZBB                                      S01433
     C           WWRVAM    DIV  FACTOR    WWRVBA 150H                     S01433
     C*
     C                     Z-ADD@@DSAM    WWAMT                           S01433
     C                     MOVE @@DSCC    WWCCY                           S01433
     C                     EXSR #ZBB                                      S01433
     C           WWRVAM    DIV  FACTOR    WWRVSA 150H                     S01433
     C*                                                                   S01433
     C           NETFX     IFEQ 'Y'                                       S01433
     C           WWRVBA    ADD  WWRVSA    DLAMTF                          S01433
     C                     DIV  2         DLAMTF    H                     S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     EXSR DLEXPF                                    S01433
     C*                                                                   S01433
     C                     END                             E1
     C*
     C           #BBA9     ENDSR
     C*****************************************************************   S01433
     C/EJECT                                                              S01433
     C*****************************************************************   S01433
     C**                                                              *   S01433
     C**   #ZBB      - THIS SUBROUTINE CALCULATES THE REVALUED        *   S01433
     C**               AMOUNT FOR THE SELECTED EVENT.                 *   S01433
     C**                                                              *   S01433
     C**   CALLS     - #ZBBA, #ZBBB, #ZBBC                            *   S01433
     C**                                                              *   S01433
     C**   CALLED BY - #BB                                            *   S01433
     C**                                                              *   S01433
     C*****************************************************************   S01433
     C           #ZBB      BEGSR                                          S01433
     C*                                                                   S01433
     C** INITIALISE TEMPORARY VARIABLES FOR THIS SUBROUTINE               S01433
     C                     Z-ADD*ZEROS    WWTMP1 138                      S01433
     C                     Z-ADD*ZEROS    WWTMP2  50                      S01433
     C                     Z-ADD*ZEROS    WWTMP3  50                      S01433
     C                     Z-ADD*ZEROS    WWTMP4 188                      S01433
     C                     Z-ADD*ZEROS    WWTMP5 138                      S01433
     C                     Z-ADD*ZEROS    WWRVAM 188                      S01433
     C                     Z-ADD*ZEROS    WWRAT  138                      S01433
     C                     Z-ADD*ZEROS    WWPOW  159                      S01433
     C*                                                                   S01433
     C** FILL FORWARD ARRAYS FOR THIS CURRENCY                            S01433
     C                     EXSR #ZBBA                                     S01433
     C*                                                                   S01433
     C** MOVE BOUGHT DATE INTO DATE WORK FIELD                            S01433
     C                     Z-ADDDLVALU    WWDATE                          S01433
     C*                                                                   S01433
     C** CALCULATE FORWARD RATE FOR DATE                                  S01433
     C                     EXSR #ZBBB                                     S01433
     C*                                                                   S01433
     C** CALCULATE REVALUATED AMOUNT FOR SOLD DATE                        S01433
     C                     EXSR #ZBBC                                     S01433
     C*                                                                   S01433
     C           #ZBB0     ENDSR                                          S01433
     C*                                                                   S01433
     C*****************************************************************   S01433
     C/EJECT                                                              S01433
     C*****************************************************************   S01433
     C**                                                              *   S01433
     C**   #ZBAA     - THIS SUBROUTINE FILLS THE FORWARD RATE AND     *   S01433
     C**               DATE ARRAYS FOR THE SELECTED CURRENCY          *   S01433
     C**                                                              *   S01433
     C**   CALLS     - NONE                                           *   S01433
     C**                                                              *   S01433
     C**   CALLED BY - #ZBB                                           *   S01433
     C**                                                              *   S01433
     C*****************************************************************   S01433
     C*                                                                   S01433
     C           #ZBBA     BEGSR                                          S01433
     C*                                                                   S01433
     C** INITIALISE ARRAYS                                                S01433
     C                     Z-ADD*ZEROS    DAT                             S01433
     C                     Z-ADD*ZEROS    RAT                             S01433
     C*                                                                   S01433
     C** INITIALISE LAST ELEMENT IN DATE ARRAY                            S01433
     C                     Z-ADD26        WWLAST  20                      S01433
     C*                                                                   S01433
     C** ACCESS FOWARD RATES FILE WITH CURRENT DEAL CURRENCY              S01433
     C           WWCCY     CHAINFWDRT                70                   S01433
     C*                                                                   S01433
     C** PROCESS ONLY ACTIVE RECORDS                                      S01433
     C           *IN70     IFEQ '0'                                       S01433
     C           RECI      ANDEQ'D'                                       S01433
     C           CHTP      ANDNE'D'                                       S01433
     C*                                                                   S01433
     C** PUT TODAYS DATE IN FIRST ELEMENT OF ARRAY                        S01433
     C                     Z-ADDRUND      DAT,1                           S01433
     C                     Z-ADD2         L                               S01433
     C                     Z-ADD1         P                               S01433
     C*                                                                   S01433
     C** IF FORWARD DATE ARRAY IS EMPTY                                   S01433
     C           DFWW,P    IFEQ *ZEROS                                    S01433
     C                     Z-ADD1         WWLAST                          S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C** WHILE A VALID DATE EXISTS IN FORWARD DATE ARRAY USE THESE        S01433
     C**  VALUES TO FILL DATE ARRAY                                       S01433
     C           L         DOWLE26                                        S01433
     C           DFWW,P    ANDNE*ZEROS                                    S01433
     C           DFWW,P    ADD  RUND      DAT,L                           S01433
     C                     ADD  1         L                               S01433
     C           L         IFNE 27                                        S01433
     C           L         SUB  1         P                               S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C** IF FORWARD DATE ARRAY NOT FULL NOTE POSITION OF LAST             S01433
     C**   VALID DATE                                                     S01433
     C           DFWW,25   IFEQ *ZEROS                                    S01433
     C                     Z-ADDP         WWLAST                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C** ACCESS CURRENCIES FILE WITH REQUIRED CURRENCY                    S01433
     C                     CALL 'AOCURRR0'                                S01433
     C                     PARM '*DBERR  '@RTCD                           S01433
     C                     PARM '*KEY    '@OPTN                           S01433
     C                     PARM WWCCY     @AJCD   3                       S01433
     C           @CURR     PARM @CURR     DSSDY                           S01433
     C*                                                                   S01433
     C**   SAVE SPOT RATE / NO. OF DECIMAL PLACES / MULT/DIV INDICATOR    S01433
     C**   FOR ROUTINE SCONV                                              S01433
     C           A6SPRT    IFEQ 0                                         S01433
     C                     DUMP                                           S01433
     C                     END                                            S01433
      *                                                                   S01433
     C                     Z-ADDA6SPRT    WWSPRT                          S01433
     C                     Z-ADDA6NBDP    WWDECP                          S01433
     C                     MOVE A6MDIN    WWMDIV                          S01433
     C*                                                                   S01433
     C**  FILL FORWARD RATE ARRAY FOR REQUIRED CURRENCY                   S01433
     C                     Z-ADDA6SPRT    RAT,1                           S01433
     C                     Z-ADD2         L                               S01433
     C           L         DOWLE26                                        S01433
     C           L         SUB  1         P                               S01433
     C                     Z-ADDRFWW,P    RAT,L                           S01433
     C                     ADD  1         L                               S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           #ZBBA0    ENDSR                                          S01433
     C*                                                                   S01433
     C*****************************************************************   S01433
     C/EJECT                                                              S01433
     C*****************************************************************   S01433
     C**                                                              *   S01433
     C**   #ZBBB     - THIS SUBROUTINE CALCULATES THE FORWARD RATE.   *   S01433
     C**                                                              *   S01433
     C**   CALLS     - NONE                                           *   S01433
     C**                                                              *   S01433
     C**   CALLED BY - #ZBB                                           *   S01433
     C**                                                              *   S01433
     C*****************************************************************   S01433
     C*                                                                   S01433
     C           #ZBBB     BEGSR                                          S01433
     C*                                                                   S01433
     C** LOOK UP DATE ARRAY FOR CURRENT DATE                              S01433
     C           WWDATE    LOKUPDAT,Y                    26               S01433
     C*                                                                   S01433
     C** IF WORK DATE DOES NOT MATCH A DATE IN THE DATE ARRAY             S01433
     C           *IN26     IFEQ '0'                                       S01433
     C                     Z-ADD1         N                               S01433
     C           WWDATE    DOWGTDAT,N                                     S01433
     C           N         ANDLTWWLAST                                    S01433
     C                     ADD  1         N                               S01433
     C                     END                                            S01433
     C           N         SUB  1         M                               S01433
     C*                                                                   S01433
     C** IF DATE BETWEEN TWO DATES ON ARRAY                               S01433
     C           WWDATE    IFLT DAT,N                                     S01433
     C*                                                                   S01433
     C** USE TEMPORARY VARIABLES TO CALCULATE RATE                        S01433
     C           RAT,N     SUB  RAT,M     WWTMP1                          S01433
     C           WWDATE    SUB  DAT,M     WWTMP2                          S01433
     C           DAT,N     SUB  DAT,M     WWTMP3                          S01433
     C           WWTMP1    MULT WWTMP2    WWTMP4                          S01433
     C           WWTMP4    DIV  WWTMP3    WWTMP5                          S01433
     C           RAT,M     ADD  WWTMP5    WWRAT                           S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C** IF WORK DATE AFTER LAST DATE IN ARRAY                            S01433
     C                     MOVE RAT,N     WWRAT                           S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C** EVENT DATE MATCHES A DATE IN THE ARRAY                           S01433
     C                     Z-ADDRAT,Y     WWRAT                           S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C** IF NO RATE RETRIEVED FROM FORWARD RATES FILE USE SPOT RATE       S01433
     C           WWRAT     IFEQ *ZEROS                                    S01433
     C                     Z-ADDWWSPRT    WWRAT                           S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           #ZBBB0    ENDSR                                          S01433
     C*                                                                   S01433
     C*****************************************************************   S01433
     C/EJECT                                                              S01433
     C*****************************************************************   S01433
     C**                                                              *   S01433
     C**   #ZBBC     - THIS SUBROUTINE CALCULATES THE REVALUATED      *   S01433
     C**               AMOUNT.                                        *   S01433
     C**                                                              *   S01433
     C**   CALLS     - NONE                                           *   S01433
     C**                                                              *   S01433
     C**   CALLED BY - #ZBB                                           *   S01433
     C**                                                              *   S01433
     C*****************************************************************   S01433
     C*                                                                   S01433
     C           #ZBBC     BEGSR                                          S01433
     C*                                                                   S01433
     C** CALCULATE REFERENCE NUMBER FOR POWER ARRAY                       S01433
     C           WWDECP    SUB  WWDPI     T       10                      S01433
     C           T         ADD  4         T                               S01433
     C*                                                                   S01433
     C** CALCULATE REVALUATED AMOUNT                                      S01433
     C           WWMDIV    IFEQ 'M'                                       S01433
     C*                                                                   S01433
     C** APPLY POWER OF 10                                                S01433
     C           WWRAT     DIV  POWER,T   WWPOW                           S01433
     C           WWAMT     MULT WWPOW     WWRVAM                          S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C*                                                                   S01433
     C** APPLY POWER OF 10                                                S01433
     C           WWRAT     MULT POWER,T   WWPOW                           S01433
     C           WWPOW     IFNE 0                                         S01433
     C           WWAMT     DIV  WWPOW     WWRVAM                          S01433
     C                     ELSE                                           S01433
     C                     DUMP                                           S01433
     C                     Z-ADD0         WWRVAM                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           #BBC0     ENDSR                                          S01433
     C*                                                                   S01433
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#BC******-*PROCESSING*FOR*MIDAS*AND*DRS-MM*ONLY*******************S01319
     C********************************************************************S01319
     C**CALLS****#BG******-*INITIALIZATION*OF*THE*DISPLAY*FIELDS**********S01319
     C***********#BE******-*VALIDATION*PROCESSING*************************S01319
     C***********#BF******-*SET*UP*ARRAYS*OF*LIMIT*PERIODS****************S01319
     C***********#BH******-*SET*UP*OF*THE*DISPLAY*FIELDS******************S01319
     C***********#BAA*****-*CALCULATE*EXPOSURE*FOR*MIDAS-FX*ONLY**********S01319
     C***********#BCA*****-*CALCULATE*EXPOSURE*FOR*DRS-LOANS**************S01319
     C***********#BAC*****-*FORMAT*MIDAS*DEALS*FOR*OUTPUT*****************S01319
     C***********#BI******-*OUTPUT*TO*THE*SCREEN**************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#B*****-*MAIN*LINE*PROCESSING**************************S01319
     C********************************************************************S01319
     C**FLDS*USED*********-***********************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#BC*******BEGSR******************************************S01319
     C********************************************************************S01319
     C***DO*PROCESSING*WHILE*COMMAND*KEY*NOT*ACTIVE***********************S01319
     C*******    *INKA     DOWEQ'0'                        B1             S01203
     C************INKC*****DOWEQ'0'************************B1*************S01319
     C************INKA*****ANDEQ'0'                                 S01332S01319
     C************INKL*****ANDEQ'0'                                 S01332S01319
     C**************************************************************S01203S01319
     C********************************************************************S01319
     C***READ*THE*SCREEN********************************************S01332S01319
     C**************************************************************S01332S01319
     C***Only*read*the*screen*if**IN01*is*off.*If*this*is*a*linked* S01332S01319
     C***enquiry*(ie.*not*called*directly*from*Midas*main*menu),*theS01332S01319
     C****IN01*will*have*been*set*on*in*the*initial*sub-routine*and*S01332S01319
     C***the*initial*screen*will*not*have*been*written.*Therefore,*dS01332S01319
     C***not*try*to*read*it.**IN01*will*then*get*set*off*so*that*on*S01332S01319
     C***subsequent*cycles*the*screen*will*be*read*as*normal.*      S01332S01319
     C**************************************************************S01332S01319
     C************IN01*****IFEQ '0'                                 S01332S01319
     C*********************READ*DL0130F3*****************15*********S01136S01319
     C*********************ELSE                                     S01332S01319
     C*********************MOVE '0'       *IN01                     S01332S01319
     C*********************END                                      S01332S01319
     C*********************                                         S01332S01319
     C******************   READ CA0200F3                 15               S01136
     C******************   READ MM0067F3                 15               S01136
     C********************************************************************S01319
     C***CLEAR*THE*SUBFILE************************************************S01319
     C*********************MOVE*'0'********IN41***************************S01319
     C*********************WRITEDL0130CT****************************S01136S01319
     C*******************  WRITECA0200CT                                  S01136
     C*******************  WRITEMM0067CT                                  S01136
     C********************************************************************S01319
     C***INITIALIZE*THE*DISPLAY*FIELDS************************************S01319
     C*********************EXSR*#BG***************************************S01319
     C********************************************************************S01319
     C***VALIDATE*THE*INPUT***********************************************S01319
     C*********************EXSR*#BE*************************1*************S01319
     C********************************************************************S01319
     C************IN39*****CABEQ'1'*******#BC7**************1*************S01319
     C********************************************************************S01319
     C***********@MBIN*****IFEQ*'Y'*********************************S01117S01319
     C**************************************************************S01117S01319
     C************IN76*****IFEQ*'0'************************BOOKING*BS01117S01319
     C*********************MOVEL'BOOKING*'WK10***10*****************S01117S01319
     C*********************MOVE*'BR'******WK10**********************S01117S01319
     C*********************MOVELWK10******BRDESC********************S01117S01319
     C*********************MOVE*'ANCH****'BRDESC********************S01117S01319
     C*********************ELSE****************************ORIGINATIS01117S01319
     C*********************MOVEL'ORIGINAT'WK10**********************S01117S01319
     C*********************MOVE*'IN'******WK10**********************S01117S01319
     C*********************MOVELWK10******BRDESC********************S01117S01319
     C*********************MOVE*'G*BRANCH'BRDESC********************S01117S01319
     C*********************END**************************************S01117S01319
     C**************************************************************S01117S01319
     C************IN73*****IFEQ*'0'*********************************S01117S01319
     C*********************MOVE*'B'*******LEVEL***1*****************S01117S01319
     C*********************MOVEL'BRANCH*'*WBRCON********************S01117S01319
     C*********************MOVE*'LIMITS*'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C************IN74*****IFEQ*'0'*********************************S01117S01319
     C*********************MOVE*'C'*******LEVEL*********************S01117S01319
     C*********************MOVEL'COMPANY'*WBRCON********************S01117S01319
     C*********************MOVE*'*LIMITS'*WBRCON********************S01117S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LEVEL*********************S01117S01319
     C*********************MOVEL'BANK*LI'*WBRCON********************S01117S01319
     C*********************MOVE*'MITS***'*WBRCON********************S01117S01319
     C*********************END**************************************S01117S01319
     C*********************END**************************************S01117S01319
     C********************************************************************S01319
     C*********************ELSE*************************************S01117S01319
     C*********************MOVE*'S'*******LIMK2*********************S01117S01319
     C*********************MOVE *BLANKS   LIMK3                     S01117LN0527
     C*********************MOVEL'SYS'*****LIMK3*********************LN0527S01319
     C*********************END**************************************S01117S01319
     C***SET*UP*LIMITS*ARRAYS*********************************************S01319
     C*********************EXSR*#BF*************************1*************S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BC9**************1*******S01117S01319
     C********************************************************************S01319
     C***CHECK*IF*REQUESTED*CUSTOMER*IS*A*PARENT.*************************S01319
     C*********************TESTB'2'*******CMIN***********54*1*******S01194S01319
     C***********BBPAIN****IFEQ*'P'*********************************S01194S01319
     C*********************MOVE*'1'********IN54*********************S01194S01319
     C*********************ELSE*************************************S01194S01319
     C*********************MOVE*'0'********IN54*********************S01194S01319
     C*********************END**************************************S01194S01319
     C********************************************************************S01319
     C***SET*UP*DETAILS*FOR*THE*HEADER************************************S01319
     C*********************EXSR*#BH***************************************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*CUSTOMER**********************************************S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C************IN54*****IFEQ*'1'************************B*2************S01319
     C*********************Z-ADDCNUM******LIMPAR**60*********2******S01194S01319
     C*********************MOVELBBCUST****LIMPAR**6**********2******S01194S01319
     C***********LIMPAR****SETLLPACUS************************2******S01194S01319
     C***********LIMPAR****SETLLSDCUSTL4*********************2******S01194S01319
     C***********LIMPAR****READEPACUS********************51**2******S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51**2******S01194S01319
     C********************************************************************S01319
     C************IN51*****IFEQ*'1'************************B**3***********S01319
     C***********RECI******ORNE*'D'***************************3*****S01194S01319
     C*********************GOTO*#BC6**************************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************Z-ADDCNUM******LIMCUS**60*********2******S01194S01319
     C*********************MOVELBBCUST****LIMCUS**60*********2******S01194S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************Z-ADDCNUM******LIMCUS*************2******S01194S01319
     C*********************MOVELBBCUST****LIMCUS*************2******S01194S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***SET*UP*1ST*DEAL**************************************************S01319
     C***********LIMCUS****SETLLMMDLCSLL********************1*************S01319
     C********************************************************************S01319
     C***CHAIN*DEALS*FILE*&*UPDATE*EXPOSURE*FOR*EVERY*DNO*****************S01319
     C************IN52*****DOWEQ'0'************************B*2************S01319
     C********************************************************************S01319
     C***********LIMCUS****READEMMDLCSLL*****************52**2************S01319
     C********************************************************************S01319
     C***IF*NO*MORE*DEALS*FOR*THIS*CUSTOMER*******************************S01319
     C************IN52*****IFEQ*'1'************************B**3***********S01319
     C********************************************************************S01319
     C***IF*SINGLE*CUSTOMER***********************************************S01319
     C************IN54*****IFNE*'1'************************B***4**********S01319
     C*********************GOTO*#BC6***************************4**********S01319
     C********************************************************************S01319
     C***IF*PARENT********************************************************S01319
     C*********************ELSE****************************X***4**********S01319
     C***********LIMPAR****READEPACUS********************51****4****S01194S01319
     C***********LIMPAR****READESDCUSTL4*****************51****4****S01194S01319
     C********************************************************************S01319
     C***********RECI******IFNE*'D'************************B****5***S01194S01319
     C************IN51*****OREQ*'1'*****************************5***S01194S01319
     C************IN51*****IFEQ*'1'*****************************5***S01194S01319
     C*********************GOTO*#BC6****************************5*********S01319
     C*********************END*****************************E****5*********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN52****************4**********S01319
     C*********************Z-ADDCNUM******LIMCUS***************4****S01194S01319
     C*********************MOVELBBCUST****LIMCUS***************4****S01194S01319
     C***********LIMCUS****SETLLMMDLCSLL***********************4**********S01319
     C*********************GOTO*#BC5***************************4**********S01319
     C*********************END*****************************E***4**********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***CALCULATE*EXPOSURE*FROM*DEAL*************************************S01319
     C***DISREGARD*RECORDS*WITHOUT*RECORD*ID*OF*DB,DD*OR*DC,*OR*WITH***AN*S01319
     C***ENTRY*IN*FACILITY*FILE.******************************************S01319
     C**************************************************************S01119S01319
     C*****CALCULATE*EXPOSURE*FOR*FRA/IRS***************************S01119S01319
     C**************************************************************S01119S01319
     C***********RECHMT****IFEQ*'DEALSDGF'*****************B**3*****S01119S01319
     C***********RECI******CABNE'D'*******#BC5*************X**3*****S01119S01319
     C*********************EXSR*FRAIRS******************************S01119S01319
     C**************************************************************S01119S01319
     C************INU7*****CABEQ'1'*******#BC9****************3*****S01119S01319
     C*********************GOTO*#BC5********************************LN0527S01319
     C*********************END*****************************E**3*****S01119S01319
     C**************************************************************S01119S01319
     C***********RECHMT****IFEQ*'DEALSDBF'*****************B**3***********S01319
     C***********RECI******CABNE'D'*******#BC5*************X**3***********S01319
     C***********FACT******CABNE*ZEROS****#BC5*************X**3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********RECHMT****IFEQ*'MMDELDP0'*****************B**3***********S01319
     C***********HKDLTF    CABEQ'1'       #BC5             X**3           E19277
     C***********HKDDLT****CABEQ'D'*******#BC5*************X**3*****E19277S01319
     C***********HKFCLY****CABNE*ZEROS****#BC5*************X**3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********RECHMT****IFEQ*'MMDENBP0'*****************B**3***********S01319
     C***********HLDLTF    CABEQ'1'       #BC5             X**3           E19277
     C***********HLDDLT****CABEQ'D'*******#BC5*************X**3*****E19277S01319
     C***********HLFCLY****CABNE*ZEROS****#BC5*************X**3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*****CALCULATE*EXPOSURE*FOR*FX*DEALS********************************S01319
     C***********RECHMT****IFEQ*'DEALSDBF'*****************B**3***********S01319
     C*********************MOVE*'0'********IN70*********************S01117S01319
     C*********************EXSR*#BAA**************************3***********S01319
     C************IN70*****CABEQ'1'*******#BC5**********************S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BC9****************3***********S01319
     C********************************************************************S01319
     C************IN16*****CABEQ'1'*******#BC5****************3***********S01319
     C********************************************************************S01319
     C***CALCULAT*EXPOSURE*FOR*LOANS**************************************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X**3***********S01319
     C********************************************************************S01319
     C*********************MOVE*'0'********IN70*********************S01117S01319
     C*********************EXSR*#BCA**************************************S01319
     C************IN70*****CABEQ'1'*******#BC5**********************S01117S01319
     C********************************************************************S01319
     C************INU7*****CABEQ'1'*******#BC9****************3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********#BC5******TAG********************************************S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***AFTER*SETTING*UP*EXPOSURE*ARRAYS,*ROUND*EXP.*AMTS*TO*1000'S******S01319
     C***AND*SET*INDICATORS*FOR*NON-DISPLAY*OF*FIELDS*********************S01319
     C***--*FIRST*FX*AMOUNTS.*********************************************S01319
     C***********#BC6******TAG******************************1*************S01319
     C********************************************************************S01319
     C*********************EXSR*#BAC************************1*************S01319
     C********************************************************************S01319
     C***********#BC7******TAG******************************1*************S01319
     C********************************************************************S01319
     C***OUTPUT*THE*DETAILS*TO*THE*SCREEN*********************************S01319
     C*********************EXSR*#BI*************************1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#BC9******ENDSR******************************************S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #BCA     - CALCULATE EXPOSURE FOR DRS-LOANS                   *
     C*                                                               *
     C* CALLS    ZA0680   - YYYYMMDD TO MIDAS DAY NO                  *
     C*          TABCHN   - CHAIN TO THE TABLE FILE                   *
     C*          DLEXPL   - CALCULATES THE EXPOSURE OF ALOAN          *
     C*                                                               *
     C* CALLED BY  #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED  @TYPE  - DEAL TYPE WORK FIELD                      *
     C*            @MDAT  - MATURITY DATE WORK FIELD                  *
     C*            @@DTIN - INPUT FIELD TO SR.ZA0680                  *
     C*            @@MDNO - OUTPUT FILED FROM SR.ZA0680               *
     C*            @NTCE  - NOTICE DAY WORK FIELD                     *
     C*            @AMNT  - AMOUNT WORK FIELD                         *
     C*            @DADN  - DEAM ASSOCIATED DEAL NUMBER               *
     C*            @CNUM  - CUSTOMER NUMBER                           *
     C*            @AMNTA - SECOND AMOUNT WORK FIELD                  *
     C*            @DAKEY - KEY TO LF/MMDMCSLL                        *
     C*            @AAMNT - THIRD AMOUNT WORK FIELD                   *
     C*            @VDAT  - VALUE DATE WORK FIELD                     *
     C*                                                               *
     C*****************************************************************
     C           #BCA      BEGSR
     C*
     C** DISREGARD IF ROLLED OVER BY DEAL NO. IS NOT BLANK
     C           RECHMT    IFEQ 'MMDELDP0'                 B1
     C*
     C***********HKDLTF    IFEQ '1'                        B*2            E19277
     C           HKDDLT    IFEQ 'D'                        B*2            E19277
     C***********HKRBSI    OREQ '0'                        X*2            127551
     C           HKROBY    ORNE *BLANKS                    X*2            127551
     C                     GOTO #BCA9                      **2
     C                     ELSE                            X*2
     C* FIX TO USE MIDAS DEAL TYPE                                        S01136
     C*********************MOVE HKTYPE    @TYPE   2        **2            S01136
     C                     MOVE HKMTYP    @TYPE   2        **2            S01136
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           RECHMT    IFEQ 'MMDENBP0'                 B1
     C*
     C***********HLDLTF    IFEQ '1'                        B*2            E19277
     C           HLDDLT    IFEQ 'D'                        B*2            E19277
     C           HLRBSI    OREQ '0'                        X*2
     C                     GOTO #BCA9                      **2
     C                     ELSE                            X*2
     C* FIX TO USE MIDAS DEAL TYPE                                        S01136
     C*********************MOVE HLTYPE    @TYPE            **2            S01136
     C                     MOVE HLMTYP    @TYPE            **2            S01136
     C                     END                             E*2
     C*
     C                     END                             E1
     C/COPY WNCPYSRC,DL0130AC08
     C*
     C** CHECK DEAL TYPE
     C           @TYPE     IFEQ 'IP'                       B1
     C           @TYPE     OREQ 'CL'
     C           @TYPE     OREQ 'DL'
     C           @TYPE     OREQ 'TI'
     C           @TYPE     OREQ 'BD'
     C           @TYPE     OREQ 'TP'
     C           @TYPE     OREQ 'DA'
     C           @TYPE     OREQ 'TA'
     C           @TYPE     OREQ 'BP'
     C           @TYPE     OREQ 'C1'
     C           @TYPE     OREQ 'C2'
     C           @TYPE     OREQ 'TB'                                      E24329
     C*
     C           @MBIN     IFEQ 'Y'                                       S01117
      *
     C           RECHMT    IFEQ 'MMDENBP0'                 B*2            S01117
     C                     MOVE HLBRCA    BBRC    3        **2            S01117
     C                     MOVE HLORBR    OBRC    3        **2            S01117
     C                     END                             E*2            S01117
     C*                                                                   S01117
     C           RECHMT    IFEQ 'MMDELDP0'                 B*2            S01117
     C                     MOVE HKBRCA    BBRC             **2            S01117
     C                     MOVE HKORBR    OBRC             **2            S01117
     C                     END                             E*2            S01117
     C** IF BRANCH ENTERED                                                S01117
     C** IF ORIGINATING BRANCH                                            S01117
     C           *IN73     IFNE '1'                                       S01117
     C           *IN76     IFEQ '1'                                       S01117
     C           BCDX      ANDNEOBRC                                      S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BCA9                                     S01117
     C                     END                                            S01117
     C** BOOKING BRANCH                                                   S01117
     C           *IN76     IFEQ '0'                                       S01117
     C           BCDX      ANDNEBBRC                                      S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BCA9                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C** IF COMPANY ENTERED                                               S01117
     C           *IN74     IFEQ '0'                                       S01117
     C** IF BOOKING BRANCH ENTERED                                        S01117
     C           *IN76     IFEQ '0'                                       S01117
     C                     MOVE BBRC      HBRC                            S01117
     C                     ELSE                                           S01117
     C** IF ORIGINATING BRANCH ENTERED                                    S01117
     C                     MOVE OBRC      HBRC                            S01117
     C                     END                                            S01117
      ** Check that  branch code exists on SDBRCHPD                       S01117
     C**********           CALL 'AOBRCHR0'                 **2                         S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7        **2            S01117
     C                     PARM '*KEY   ' @OPTN   7        **2            S01117
     C                     PARM HBRC      @DSNB   3        **2            S01117
     C********** @BRCH     PARM @BRCH     DSFDY                                        S01194 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C*************        PARM           @BRCH            **2            S01117
     C           @RTCD     IFNE *BLANKS                    B**3           S01117
     C           CCDX      ORNE A8CMCD                     ***3           S01117
     C           CCDX      ANDNE*BLANKS                                   S01117
     C                     MOVE '1'       *IN70                           S01117
     C                     GOTO #BCA9                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *
     C                     END                                            S01117
0823 C**
     C** CALCULATE EXPOSURE.
     C                     MOVE @MDAT     @@DTIN           *1
     C                     EXSR ZA0680                     *1
     C*
     C                     Z-ADD@@MDNO    DLMATD           *1
     C*****                MOVE BLNK12    KEYTAB           *1             S01194
     C*
     C           RECHMT    IFEQ 'MMDELDP0'                 B*2
     C                     Z-ADDHKNTCE    DLNOTD           **2
     C                     Z-ADDHKNTCE    @NTCE   30       **2
     C*****                MOVE HKCCY     TABCCY           **2            S01194
     C                     MOVE HKCCY     HCCY    3        **2            S01194
     C                     Z-ADDHKAMNP    @AMNT  150       **2
     C*                                                                   S01136
     C**FIX TO CONVERT NEGATIVE AMOUNTS ON DRS TAKINGS/PLACINGS           S01136
     C**FILE TO POSITIVE FOR OUTPUT                                       S01136
     C*                                                                   S01136
     C           @AMNT     IFLT 0                          B**3           S01136
     C                     Z-SUB@AMNT     @AMNT            ***3           S01136
     C                     END                             E**3           S01136
     C*                                                                   S01136
     C                     MOVE HKDN38    @DADN   60       **2
     C**********           Z-ADDHKCNUM    @CNUM   60       **2                                CSD027
     C                     MOVE HKCNUM    @CNUM   6        **2                                CSD027
     C                     ELSE                            X*2
     C*****                MOVE HLCCY     TABCCY           **2            S01194
     C                     MOVE HLCCY     HCCY             **2            S01194
     C                     Z-ADDHLFVAL    @AMNT            **2
     C                     Z-ADD*ZEROS    DLNOTD           **2
     C                     Z-ADD*ZEROS    @NTCE            **2
     C                     MOVE HLDN38    @DADN            **2
     C**********           Z-ADDHLCNUM    @CNUM            **2                                CSD027
     C                     MOVE HLCNUM    @CNUM            **2                                CSD027
     C                     END                             E*2
     C*
     C*****                MOVE '20'      TABRT            *1             S01194
     C*****                MOVE '1'       TABSRT           *1             S01194
     C*****                EXSR TABCHN                     *1             S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM HCCY      @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C***************      PARM           @CURR                           S01194
     C*
     C*****      *INU7     CABEQ'1'       #BCA9            *1             S01194
     C*
     C*
     C*****      CDP       ADD  1         DEP              *1             S01194
     C           A6NBDP    ADD  1         DEP              *1             S01194
     C           @AMNT     DIV  FCT,DEP   @AMNTA 150H      *1
     C*
     C*****      ERLC      IFNE 0                          B*2            S01194
     C           A6ERLC    IFNE 0                          B*2            S01194
     C*****      MDIN      IFEQ 0                          B**3           S01194
     C*****      A6A8ST    IFEQ '0'                        B**3     S01194E134
     C           A6MDIN    IFEQ 'D'                        B**3           E134
     C*****      @AMNTA    DIV  ERLC      DLAMTL    H      ***3           S01194
     C           @AMNTA    DIV  A6ERLC    DLAMTL    H      ***3           S01194
     C*
     C                     ELSE                            X**3
     C*****      @AMNTA    MULT ERLC      DLAMTL    H      ***3           S01194
     C           @AMNTA    MULT A6ERLC    DLAMTL    H      ***3           S01194
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C*
     C                     Z-ADD@AMNTA    DLAMTL           **2
     C                     END                             E*2
     C*
     C                     EXSR DLEXPL                     *1
     C*
     C** IF ANY AMENDMENTS INCREASE PRINCIPAL, ADD INCREASE TO EXP. A  MTS
     C**   CHAIN TO DEAMS FOR THIS & SUBSEQUENT AMENDMENTS
     C           @DAKEY    KLIST                           *1
     C                     KFLD           @CNUM            *1
     C                     KFLD           @DADN            *1
     C*
     C           @DAKEY    SETLLMMDMCSLL                   *1
     C*
     C           @DAKEY    READEMMDMCSLL                 51*1
     C*
     C           *IN51     DOWEQ'0'                        B*2
     C*
     C**   ONLY PROCESS AMENDMENT TYPE PI
     C***********HNDLTF    IFEQ '1'                        B**3           E19277
     C           HNDDLT    IFEQ 'D'                        B**3           E19277
     C           HNTYPE    ORNE 'PI'                       X**3
     C                     GOTO #BCA8                      ***3
     C                     END                             E**3
     C**
     C*****                MOVE BLNK12    KEYTAB           **2            S01194
     C*****                MOVE '20'      TABRT            **2            S01194
     C*****                MOVE HNCCY     TABCCY           **2            S01194
     C*****                MOVE '1'       TABSRT           **2            S01194
     C*****                EXSR TABCHN                     **2            S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM HNCCY     @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C**************       PARM           @CURR                           S01194
     C*
     C*****      *INU7     CABEQ'1'       #BCA9            **2            S01194
     C*
     C*****      CDP       ADD  1         DEP              **2            S01194
     C           A6NBDP    ADD  1         DEP              **2            S01194
     C           HNAMNP    DIV  FCT,DEP   @AAMNT 150H      **2
     C*
     C*****      MDIN      IFEQ 0                          B**3           S01194
     C*****      A6A8ST    IFEQ '0'                        B**3    S01194 E134
     C           A6MDIN    IFEQ 'D'                        B**3           E134
     C*****      @AAMNT    DIV  ERLC      DLAMTL    H      ***3           S01194
     C           @AAMNT    DIV  A6ERLC    DLAMTL    H      ***3           S01194
     C                     ELSE                            X**3
     C*****      @AAMNT    MULT ERLC      DLAMTL    H      ***3           S01194
     C           @AAMNT    MULT A6ERLC    DLAMTL    H      ***3           S01194
     C                     END                             E**3
     C*
     C                     MOVE @VDAT     @@DTIN           **2
     C                     EXSR ZA0680                     **2
     C*
     C           @NTCE     IFGT 0                          B**3
     C           @@MDNO    ADD  @NTCE     DLMATD           ***3
     C                     ELSE                            X**3
     C                     Z-ADD@@MDNO    DLMATD           ***3
     C                     END                             E**3
     C*
     C                     EXSR DLEXPL                     **2
     C*
     C** READ THE NEXT DEAL AMENDMENT IF ANY
     C           #BCA8     TAG                             **2
     C*
     C           @DAKEY    READEMMDMCSLL                 51**2
     C*                                                                **
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BCA9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD      - PROCESSING FOR MIDAS AND DRS                       *
     C*                                                               *
     C* CALLS    #BG      - INITIALIZATION OF THE DISPLAY FIELDS      *
     C*          #BE      - VALIDATION PROCESSING                     *
     C*          #BF      - SET UP ARRAYS OF LIMIT PERIODS            *
     C*          #BH      - SET UP OF THE DISPLAY FIELDS              *
     C*          #BBA     - CALCULATE EXPOSURE FOR DRS=FX DEALS       *
     C*          #BAA     - CALCULATE EXPOSURE FOR MIDAS-FX ONLY      *
     C*          #BAB     - CALCULATE EXPOSURE FOR MIDAS-LOANS        *
     C*          #BCA     - CALCULATE EXPOSURE FOR DRS-LOANS          *
     C*          #BAC     - FORMAT MIDAS DEALS FOR OUTPUT             *
     C*          #BI      - OUTPUT TO THE SCREEN                      *
     C*                                                               *
     C* CALLED BY  #B     - MAIN LINE PROCESSING                      *
     C*                                                               *
     C* FLDS USED  @RECFT - RECORD FORMAT WORK FIELD                  *
     C*                                                               *
     C*****************************************************************
     C           #BD       BEGSR
     C*
     C** DO PROCESSING WHILE COMMAND KEY NOT ACTIVE
     C*******    *INKA     DOWEQ'0'                        B1             S01203
     C           *INKC     DOWEQ'0'                        B1
     C           *INKA     ANDEQ'0'                                       S01332
     C           *INKL     ANDEQ'0'                                       S01332
     C*                                                                   S01203
     C*
     C** READ THE SCREEN
     C*                                                                   S01332
     C** Only read the screen if *IN01 is off. If this is a linked        S01332
     C** enquiry (ie. not called directly from Midas main menu), then     S01332
     C** *IN01 will have been set on in the initial sub-routine and       S01332
     C** the initial screen will not have been written. Therefore, do     S01332
     C** not try to read it. *IN01 will then get set off so that on       S01332
     C** subsequent cycles the screen will be read as normal.             S01332
     C*                                                                   S01332
     C           *IN01     IFEQ '0'                                       S01332
     C                     READ DL0130F3                 15               S01136
     C           *IN70     IFEQ '1'                                       S01433
     C           S01433    ANDEQ0                                         S01433
     C                     ADD  1         S01433                          S01433
     C                     END                                            S01433
     C           *IN71     IFEQ '1'                                       S01433
     C           S01433    ANDEQ1                                         S01433
     C                     SUB  1         S01433                          S01433
     C                     END                                            S01433
     C                     ELSE                                           S01332
     C                     MOVE '0'       *IN01                           S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C***************      READ CA0200F3                 15               S01136
     C***************      READ MM0067F3                 15               S01136
     C*
     C** CLEAR THE SUBFILE
     C                     MOVE '0'       *IN41
     C                     WRITEDL0130CT                                  S01136
     C*****************    WRITECA0200CT                                  S01136
     C*****************    WRITEMM0067CT                                  S01136
     C*
     C** INITIALIZE THE DISPLAY FIELDS
     C                     EXSR #BG                        *1
     C*
     C** VALIDATE THE INPUT
     C                     EXSR #BE                        *1
     C*
     C           *IN39     CABEQ'1'       #BD7             *1
     C*
     C           @MBIN     IFEQ 'Y'                                       S01117
     C**                                                                  S01117
     C           *IN76     IFEQ '0'                        BOOKING BR     S01117
     C                     MOVEL'BOOKING 'WK10   10                       S01117
     C                     MOVE 'BR'      WK10                            S01117
     C                     MOVELWK10      BRDESC                          S01117
     C                     MOVE 'ANCH    'BRDESC                          S01117
     C                     ELSE                            ORIGINATING BR S01117
     C                     MOVEL'ORIGINAT'WK10                            S01117
     C                     MOVE 'IN'      WK10                            S01117
     C                     MOVELWK10      BRDESC                          S01117
     C                     MOVE 'G BRANCH'BRDESC                          S01117
     C                     END                                            S01117
     C**                                                                  S01117
      *
     C           *IN73     IFEQ '0'                                       S01117
     C                     MOVE 'B'       LEVEL   1                       S01117
     C                     MOVEL'BRANCH ' WBRCON                          S01117
     C                     MOVE 'LIMITS ' WBRCON                          S01117
     C                     ELSE                                           S01117
     C           *IN74     IFEQ '0'                                       S01117
     C                     MOVE 'C'       LEVEL                           S01117
     C                     MOVEL'COMPANY' WBRCON                          S01117
     C                     MOVE ' LIMITS' WBRCON                          S01117
     C                     ELSE                                           S01117
     C                     MOVE 'S'       LEVEL                           S01117
     C                     MOVEL'BANK LI' WBRCON                          S01117
     C                     MOVE 'MITS   ' WBRCON                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *
     C                     ELSE                                           S01117
     C                     MOVE 'S'       LIMK2                           S01117
     C*********************MOVE *BLANKS   LIMK3                     S01117LN0527
     C                     MOVEL'SYS'     LIMK3                           LN0527
     C                     END                                            S01117
      *
     C** SET UP LIMITS ARRAYS
     C                     EXSR #BF                        *1
     C*
     C*****      *INU7     CABEQ'1'       #BD9             *1             S01117
     C*
     C** CHECK IF REQUESTED CUSTOMER IS A PARENT.
     C*****                TESTB'2'       CMIN           54*1             S01194
     C           BBPAIN    IFEQ 'P'                                       S01194
     C                     MOVE '1'       *IN54                           S01194
     C                     ELSE                                           S01194
     C                     MOVE '0'       *IN54                           S01194
     C                     END                                            S01194
     C*                                                                   067425
     C** An access object is being called in #BH, so save FRAIRS fields   067425
     C*                                                                   067425
     C                     Z-ADDDZFRLA    @TFRLA  90                      067425
     C                     Z-ADDDZFRED    @TFRED  50                      067425
     C                     Z-ADDDZIRLM    @TIRLM  90                      067425
     C                     Z-ADDDZIRED    @TIRED  50                      067425
     C*
     C** SET UP DETAILS FOR THE HEADER
     C                     EXSR #BH
     C*                                                                   067425
     C** Return original values.                                          067425
     C*                                                                   067425
     C                     Z-ADD@TFRLA    DZFRLA                          067425
     C                     Z-ADD@TFRED    DZFRED                          067425
     C                     Z-ADD@TIRLM    DZIRLM                          067425
     C                     Z-ADD@TIRED    DZIRED                          067425
     C*
     C** SET UP 1ST CUSTOMER
     C*
     C** IF PARENT
     C           *IN54     IFEQ '1'                        B*2
     C*****                Z-ADDCNUM      LIMPAR  60       **2            S01194
     C                     MOVELBBCUST    LIMPAR  6        **2            S01194
     C*****      LIMPAR    SETLLPACUS                      **2            S01194
     C           LIMPAR    SETLLSDCUSTL4                   **2            S01194
     C*****      LIMPAR    READEPACUS                    51**2            S01194
     C           LIMPAR    READESDCUSTL4                 51**2            S01194
     C*
     C           *IN51     IFEQ '1'                        B**3
     C*****      RECI      ORNE 'D'                        ***3           S01194
     C                     GOTO #BD6                       ***3
     C                     END                             E**3
     C*
     C*****                Z-ADDCNUM      LIMCUS  60       **2            S01194
     C**********           MOVELBBCUST    LIMCUS  60       **2                         S01194 CSD027
     C                     MOVELBBCUST    LIMCUS  6        **2                                CSD027
     C*
     C** IF SINGLE CUSTOMER
     C                     ELSE                            X*2
     C*****                Z-ADDCNUM      LIMCUS           **2            S01194
     C                     MOVELBBCUST    LIMCUS           **2            S01194
     C                     END                             E*2
     C*
     C** SET UP 1ST DEAL
     C           LIMCUS    SETLLFXMIDLLL                   *1
     C           LIMCUS    SETLLMMDLCSLL                   *1
     C*
     C** CHAIN DEALS FILE & UPDATE EXPOSURE FOR EVERY DNO
     C           *IN55     DOWEQ'0'                        B*2         *
     C*
     C                     MOVE *BLANKS   @RECFT  8
     C*
     C           LIMCUS    READEFXMIDLLL                 52**2
     C                     MOVE RECGMT    @RECFT           **2
     C*
     C** IF NO MORE DEALS FOR THIS CUSTOMER
     C           *IN52     IFEQ '1'                        B**3
     C*
     C** READ THE LOANS FILE
     C           LIMCUS    READEMMDLCSLL                 53***3
     C                     MOVE RECHMT    @RECFT           ***3
     C*
     C           *IN53     IFEQ '1'                        B***4
     C*
     C** IF SINGLE CUSTOMER
     C           *IN54     IFNE '1'                        B****5
     C                     MOVE '1'       *IN55            *****5
     C*
     C** IF PARENT
     C                     ELSE                            X****5
     C*****      LIMPAR    READEPACUS                    51*****5         S01194
     C           LIMPAR    READESDCUSTL4                 51*****5         S01194
     C*
     C*****      RECI      IFNE 'D'                        B*****6        S01194
     C*****      *IN51     OREQ '1'                        ******6        S01194
     C           *IN51     IFEQ '1'                        ******6        S01194
     C                     GOTO #BD6                       ******6
     C                     END                             E*****6
     C*
     C*****                Z-ADDCNUM      LIMCUS           *****5         S01194
     C                     MOVELBBCUST    LIMCUS           *****5         S01194
     C           LIMCUS    SETLLFXMIDLLL                   *****5
     C           LIMCUS    SETLLMMDLCSLL                   *****5
     C                     MOVE '0'       *IN52            *****5
     C                     MOVE '0'       *IN53            *****5
     C                     GOTO #BD5                       *****5
     C                     END                             E****5
     C*
     C                     END                             E***4
     C*
     C                     END                             E**3
     C*
     C** CALCULATE EXPOSURE FROM DEAL
     C** DISREGARD RECORDS WITHOUT RECORD ID OF DB,DD OR DC, OR WITH   AN
     C** ENTRY IN FACILITY FILE.
     C/COPY WNCPYSRC,DL0130AC26
     C*                                                                   S01119
     C**   CALCULATE EXPOSURE FOR FRA/IRS                                 S01119
     C*                                                                   S01119
     C           @RECFT    IFEQ 'DEALSFGF'                 B**3           S01119
     C           RECI      CABNE'D'       #BD5             X**3           S01119
     C                     EXSR FRAIRS                                    S01119
     C*                                                                   S01119
     C           *INU7     CABEQ'1'       #BD9             ***3           S01119
     C                     GOTO #BD5                                      LN0527
     C                     END                             E**3           S01119
     C*                                                                   S01119
     C           @RECFT    IFEQ 'FXDEALP0'                 B**3
     C***********FHDLTF    CABEQ'1'       #BD5             X**3           E19277
     C           FHDDLT    CABEQ'D'       #BD5             X**3           E19277
     C*******              MOVE '0'       *IN70            ***3    S01117 S01433
     C*******              EXSR #BBA                       ***3           S01433
     C                     EXSR #BBA                       ***3           S01433
     C*******    *IN70     CABEQ'1'       #BD5             ***3    S01117 S01433
     C*******              END                             E**3           S01433
     C*                                                                   S01433
     C           NETFX     IFEQ 'Y'                                       S01433
     C                     MOVE 'N'       FXCLOP                          S01433
     C                     Z-SUBFHDAM2    FHDAM2                          S01433
     C                     MOVE FHDN38    FXDN38                          S01433
     C                     Z-ADDFHDAM1    FXDAM1                          S01433
     C                     MOVE FHCCY1    FXCCY1                          S01433
     C                     Z-ADDFHDAM2    FXDAM2                          S01433
     C                     MOVE FHCCY2    FXCCY2                          S01433
     C                     MOVE FHTYPE    FXTYPE                          S01433
     C                     MOVE FHVDYY    FXVDYY                          S01433
     C                     MOVE FHVDMM    FXVDMM                          S01433
     C                     MOVE FHVDDD    FXVDDD                          S01433
     C                     MOVE FHDOEY    FXDOEY                          S01433
     C                     MOVE FHDOEM    FXDOEM                          S01433
     C                     MOVE FHDOED    FXDOED                          S01433
     C                     MOVE FHBCAE    FXBCAE                          S01433
     C                     MOVE FHMBCA    FXMBCA                          S01433
     C*                                                                   S01433
     C           FHTYPE    IFEQ 'OP'                                      S01433
     C                     Z-ADD@ODAT     FXBDAT                          S01433
     C                     Z-ADD@VDAT     FXSDAT                          S01433
     C                     ELSE                                           S01433
     C                     Z-ADD@VDAT     FXBDAT                          S01433
     C                     Z-ADD@VDAT     FXSDAT                          S01433
     C                     END                                            S01433
     C                     MOVE 'N'       FXSCLO                          S01433
     C                     MOVE 'N'       FXBCLO                          S01433
     C*                                                                   S01433
     C                     MOVE '0'       *IN21                           S01433
     C                     ADD  1         J                               S01433
     C                     Z-ADD1         K       30                      S01433
     C           FXBYDS    LOKUPFXSL,K                   21               S01433
     C           *IN21     IFEQ '1'                                       S01433
     C                     MOVE 'Y'       FXCLOP                          S01433
     C                     MOVE FXNTDS    FXNT,K                          S01433
     C                     MOVE 'Y'       FXSCLO                          S01433
     C                     MOVE FXSLDS    FXSL,K                          S01433
     C                     ELSE                                           S01433
     C           FXSLDS    LOKUPFXBY,K                   21               S01433
     C           *IN21     IFEQ '1'                                       S01433
     C                     MOVE 'Y'       FXCLOP                          S01433
     C                     MOVE FXNTDS    FXNT,K                          S01433
     C                     MOVE 'Y'       FXBCLO                          S01433
     C                     MOVE FXBYDS    FXBY,K                          S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     MOVE FXNTDS    FXNT,J                          S01433
     C                     MOVE FXBYDS    FXBY,J                          S01433
     C                     MOVE FXSLDS    FXSL,J                          S01433
     C*                                                                   S01136
     C                     END                                            S01433
     C                     END                             E**3
     C**FIX TO READ ONLY DRS FILES AND THUS AVOID PROCESSING A            S01136
     C**DEAL TWICE                                                        S01136
     C*                                                                   S01136
     C***********@RECFT    IFEQ 'DEALSDBF'                 B**3           S01136
     C***********RECI      CABNE'D'       #BD5             X**3           S01136
     C*********************EXSR #BAA                       ***3           S01136
     C*********************END                             E**3           S01136
     C*                                                                   S01136
     C***********@RECFT    IFEQ 'DCDEALP0'                 B**3           S01136
     C***********@RECFT    OREQ 'DDDEALP0'                 X**3           S01136
     C***********RECI      CABNE'D'       #BD5             X**3           S01136
     C***********FACT      CABNE*ZEROS    #BD5             X**3           S01136
     C*********************EXSR #BAB                       ***3           S01136
     C*********************END                             E**3           S01136
     C*
     C           @RECFT    IFEQ 'MMDELDP0'                 B**3
     C***********HKDLTF    CABEQ'1'       #BD5             X**3           E19277
     C           HKDDLT    CABEQ'D'       #BD5             X**3           E19277
     C           HKFCLY    CABNE*ZEROS    #BD5             X**3
     C                     MOVE '0'       *IN70                           S01117
     C                     EXSR #BCA                       ***3
     C           *IN70     CABEQ'1'       #BD5                            S01117
     C                     END                             E**3
     C*
     C           @RECFT    IFEQ 'MMDENBP0'                 B**3
     C***********HLDLTF    CABEQ'1'       #BD5             X**3           E19277
     C           HLDDLT    CABEQ'D'       #BD5             X**3           E19277
     C           HLFCLY    CABNE*ZEROS    #BD5             X**3
     C                     MOVE '0'       *IN70                           S01117
     C                     EXSR #BCA                       ***3
     C           *IN70     CABEQ'1'       #BD5                            S01117
     C                     END                             E**3
     C*
     C*
     C           *INU7     CABEQ'1'       #BD9
     C*
     C           #BD5      TAG
     C*
     C                     END                             E*2
     C*
     C**   AFTER SETTING UP EXPOSURE ARRAYS, ROUND EXP. AMTS TO 1000'S
     C** AND SET INDICATORS FOR NON-DISPLAY OF FIELDS
     C** -- FIRST FX AMOUNTS.
     C           #BD6      TAG                             *1          **
     C*                                                                   S01433
     C           NETFX     IFEQ 'Y'                                       S01433
     C                     Z-ADD1         J                               S01433
     C           FXNT,J    DOWNE*BLANK                                    S01433
     C           J         ANDLE100                                       S01433
     C*                                                                   S01433
     C                     MOVE FXNT,J    FXNTDS                          S01433
     C*                                                                   S01433
     C           FXCLOP    IFNE 'Y'                                       S01433
     C                     MOVE FXDN38    FHDN38                          S01433
     C                     MOVE FXDAM1    FHDAM1                          S01433
     C                     MOVE FXCCY1    FHCCY1                          S01433
     C                     MOVE FXDAM2    FHDAM2                          S01433
     C                     MOVE FXCCY2    FHCCY2                          S01433
     C                     MOVE FXTYPE    FHTYPE                          S01433
     C                     MOVE FXVDYY    FHVDYY                          S01433
     C                     MOVE FXVDMM    FHVDMM                          S01433
     C                     MOVE FXVDDD    FHVDDD                          S01433
     C                     MOVE FXDOEY    FHDOEY                          S01433
     C                     MOVE FXDOEM    FHDOEM                          S01433
     C                     MOVE FXDOED    FHDOED                          S01433
     C                     MOVE FXBCAE    FHBCAE                          S01433
     C                     MOVE FXMBCA    FHMBCA                          S01433
     C                     EXSR #BBA                                      S01433
     C                     END                                            S01433
     C                     ADD  1         J                               S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*
     C                     EXSR #BAC                       *1
     C*
     C           #BD7      TAG                             *1          **
     C*
     C** OUTPUT DETAILS TO THE SCREEN
     C           S01433    IFEQ 0                                         S01433
     C                     EXSR #BI                        *1
     C                     ELSE                                           S01433
     C                     EXSR #BI2                                      S01433
     C           NETFX     IFEQ 'Y'                                       S01433
     C                     Z-ADD*ZERO     J       30                      S01433
     C                     MOVEA*BLANKS   FXBY                            S01433
     C                     MOVEA*BLANKS   FXSL                            S01433
     C                     MOVEA*BLANKS   FXNT                            S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*
     C                     END                             E1
     C*
     C           #BD9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*****                                                           *   S01194
     C**TABCHN   - CHAIN TO THE TABLE FILE                            *   S01194
     C*****                                                           *   S01194
     C**CALLS             -                                           *   S01194
     C*****                                                           *   S01194
     C**CALLED BY  #A     - FIRST CYCLE PROCESSING                    *   S01194
     C*****        #BAA   - CALCULATE EXPOSURE FOR MIDAS-FX ONLY      *   S01194
     C*****        #BAB   - CALCULATE EXPOSURE FOR MIDAS-LOANS        *   S01194
     C*****        #BBA   - CALCULATE EXPOSURE FOR DRS=FX DEALS       *   S01194
     C*****        #BCA   - CALCULATE EXPOSURE FOR DRS-LOANS          *   S01194
     C*****        #BF    - SET UP ARRAYS OF LIMIT PERIODS            *   S01194
     C*****                                                           *   S01194
     C**FLDS USED         -                                           *   S01194
     C*****                                                           *   S01194
     C*****************************************************************   S01194
     C*****      TABCHN    BEGSR                                          S01194
     C*****                                                               S01194
     C*****      KEYTAB    CHAINTABDLI               61                   S01194
     C*****                                                               S01194
     C*****      *IN61     IFEQ '1'                        B1             S01194
     C*****      RECI      ORNE 'D'                        *1             S01194
     C*****                MOVE '901'     DBASE            ***************S01194
     C*****                MOVEL'TABDLI  'DBFILE           *              S01194
     C*****                MOVE KEYTAB    DBKEY            * DB ERROR 901 S01194
     C*****                MOVE '1'       *INU7            *              S01194
     C*****                MOVE '1'       *INU8            ***************S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C*****      TAB9      ENDSR                                          S01194
     C*****************************************************************   S01194
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BE      - VALIDATION PROCESSING                              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C**FLDS*USED**@RCDT**-*RECORD*FORMAT*FOR*KEY*TO*CLINT*FILE       *   S01194
     C*                                                               *
     C*****************************************************************
     C           #BE       BEGSR
     C*
     C** ERROR IF NOTHING INPUT
     C           INPUT     IFEQ *BLANKS                    B1
     C                     MOVE '1'       *IN38            *1
     C                     MOVE '1'       *IN39            *1
     C                     MOVE ERR,1     MSG              *1
     C                     GOTO #BE9                       *1
     C                     END                             E1
     C*
     C***TEST*WHETHER*CUSTOMER*NUMBER*OR*SHORTNAME*WAS*INPUT              S01194
     C*****                MOVELINPUT     ALPHA1  1                       S01194
     C*                                                                   S01194
     C*****      ALPHA1    IFGE '0'                                       S01194
     C*****                MOVELINPUT     ICUSTN  60                      S01194
     C*****                MOVELINPUT     ICUSTN  6                       S01194
     C*                                                                   S01194
     C** CALL ACCESS PROGRAM FOR CUSTOMER DETAILS                         S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                    E24    S01194
     C                     PARM '*BLANKS' @RTCD                    E24    S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM INPUT     @AENB  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           @CUST     PARM @CUST     DSSDY                           S01194
     C*************        PARM           @CUST                           S01194
     C*                                                                   S01194
     C                     MOVE @AENB     INPUT                          E00043A
     C           @RTCD     IFNE *BLANK                           B1       S01194
     C           @KYST     IFEQ '*CNUM'                          B*2      S01194
     C                     MOVE ERR,2     MSG                    **2      S01194
     C                     MOVE '1'       *IN38                  **2      S01194
     C                     MOVE '1'       *IN39                  **2      S01194
     C                     GOTO #BE9                             **2      S01194
     C                     END                                   E*2      E38494
     C**********           ELSE                                  X*2      S01194
     C*                                                                   E38494
     C           @KYST     IFEQ '*CSHT'                          B*2      S01194
     C                     MOVE ERR,3     MSG                    **2      S01194
     C                     MOVE '1'       *IN38                  **2      S01194
     C                     MOVE '1'       *IN39                  **2      S01194
     C                     GOTO #BE9                             **2      S01194
     C                     END                                   E*2      E38494
     C**********           ELSE                                  X*2     E00043A
     C*                                                                   E38494
     C           @KYST     IFEQ '*ERROR'                         B*2     E00043A
     C           @KYST     OREQ '      '                         B*2      E38494
     C                     MOVE ERR,3     MSG                    **2     E00043A
     C                     MOVE '1'       *IN38                  **2     E00043A
     C                     MOVE '1'       *IN39                  **2     E00043A
     C                     GOTO #BE9                             **2     E00043A
     C                     END                                   E*2     E00043A
     C**********           END                                   E*3S01394E38494
     C**********           END                                   E*2S01194E38494
     C*                                                                   E38494
     C                     END                                   E1       S01194
     C*                                                                   S01194
     C** MOVE CUSTOMER SHORT NAME INTO INPUT FIELD                        E24
     C                     MOVE BBCSSN    INPUT                           E24
     C*
     C******     INPUT     CHAINSNAME                51           *1      S01194
     C*****      *IN51     IFEQ '1'                               B*2     S01194
     C*****                MOVE ERR,3     MSG                     **2     S01194
     C*****                MOVE '1'       *IN38                   **2     S01194
     C*****                MOVE '1'       *IN39                   **2     S01194
     C*****                GOTO #BE9                              **2     S01194
     C*****                END                                    E*2     S01194
     C*****                                                               S01194
     C******               MOVELCNUM      ICUSTN                  *1      S01194
     C*
     C*****                END                                    E1      S01194
     C*
     C***CHAIN*TO*CLINT*TO*VALIDATE*CNUM*&*GET*DETAILS                    S01194
     C*****      CLIKEY    KLIST                                          S01194
     C*****                KFLD           ICUSTN                          S01194
     C*****                KFLD           @RCDT                           S01194
     C*****                                                               S01194
     C*****      CLIKEY    CHAINCLINT                51                   S01194
     C*****                                                               S01194
     C*****      *IN51     IFEQ '1'                               B1      S01194
0641 C**
     C**   VALIDATE BOOKING/ORIGINATING BRANCH  IF @MBIN=Y                S01117
     C           @MBIN     IFEQ 'Y'                               B1      S01117
     C           BKOR      IFEQ ' '                               B*2     S01117
     C                     MOVE 'B'       BKOR                    **2     S01117
     C                     END                                    E*2     S01117
      * IF ORIG BCHS NOT USED AND VALUE IS NOT 'B'
     C           BKOR      IFNE 'B'                               B*2     S01117
     C           BKOBRU    ANDNE'Y'                               B*2     S01117
     C                     MOVE '1'       *IN38                   ***3    S01117
     C                     MOVE '1'       *IN39                   ***3    S01117
     C                     MOVE '1'       *IN79                   ***3    E00044
     C                     MOVE ERR,13    MSG                     ***3    S01117
     C                     GOTO #BE9                              ***3    S01117
     C                     END                                    B*2     S01117
     C           BKOR      IFEQ 'O'                               B*2     S01117
     C                     MOVE '1'       *IN76                   **2     S01117
     C                     ELSE                                   X*2     S01117
     C           BKOR      IFEQ 'B'                               B**3    S01117
     C                     MOVE '0'       *IN76                   ***3    S01117
     C                     ELSE                                   X**3    S01117
     C                     MOVE '1'       *IN38                   ***3    S01117
     C                     MOVE '1'       *IN39                   ***3    S01117
     C                     MOVE '1'       *IN79                   ***3    E00044
     C                     MOVE ERR,5     MSG                     ***3    S01117
     C                     GOTO #BE9                              ***3    S01117
     C                     END                                    E**3    S01117
     C                     END                                    E*2     S01117
     C*
     C                     END                                    E1
     C**                                                                  S01117
     C**   VALIDATE BRANCH/COMPANY CODE, ONLY IF MBIN = Y                 S01117
     C           @MBIN     IFEQ 'Y'                        B1             S01117
     C                     MOVE *BLANKS   BRCO    3        *1             S01117
     C                     MOVE *BLANKS   BRCON  30        *1             S01117
     C                     MOVE *BLANKS   LIMK2            *1             S01117
     C                     MOVE *BLANKS   LIMK3            *1             S01117
      *                                                                   S01117
      ** IF BOTH BRCH AND CPNY BLANK, DEFAULT TO DEFAULT BRANCH           S01117
     C           BCDX      IFEQ *BLANKS                    B*2            S01117
     C           CCDX      ANDEQ*BLANKS                    B*2            S01117
     C                     MOVELBRC       BCDX             **2            S01117
     C                     END                             E*2            S01117
      *                                                                   S01117
      ** CHECK FOR USE OF 'ALL' TO GIVE CONSOLIDATED VIEW (BANK LEVEL)    S01117
     C           BCDX      IFEQ 'ALL'                      B*2            S01117
     C           CCDX      ANDEQ*BLANKS                    B*2            S01117
     C           CCDX      OREQ 'ALL'                      B*2            S01117
     C           BCDX      ANDEQ*BLANKS                    B*2            S01117
      *
      **  CHECK FOR BANK LEVEL AUTHORITY
     C           BNKAUT    IFEQ 'Y'                        B**3
     C                     MOVE *BLANKS   BRCO             ***3           S01117
     C                     MOVE *BLANKS   BRCON            ***3           S01117
     C                     MOVE 'S'       LIMK2            ***3           S01117
     C*********************MOVE *BLANKS   LIMK3            ***3     S01117LN0527
     C                     MOVEL'SYS'     LIMK3                           LN0527
      *
      ** IF EITHER BCH OR CMPY IS 'ALL' DO NOT SHOW BR/CO ON LINE 4/29
     C                     SETON                       7374***3
      *SKIP FURTHER VALIDATION
     C                     GOTO #BE9                       ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     SETON                       3839***3           S01117
      *  HIGHLIGHT CORRECT FIELD IN ERROR                                 S01117
     C           BCDX      COMP 'ALL'                    77***3           S01117
     C           CCDX      COMP 'ALL'                    78***3           S01117
     C                     MOVE ERR,14    MSG              ***3           S01117
     C                     GOTO #BE9                       ***3           S01117
     C                     END                             E**3
     C                     END                             E***4          S01117
     C**                                                                  S01117
     C**   BOTH BRANCH AND COMPANY ENTERED, ERROR                         S01117
     C           BCDX      IFNE *BLANKS                    B*2            S01117
     C           CCDX      IFNE *BLANKS                    B**3           S01117
     C                     MOVE '1'       *IN38            ***3           S01117
     C                     MOVE '1'       *IN39            ***3           S01117
     C                     MOVE '1'       *IN77            ***3           E00044
     C                     MOVE ERR,6     MSG              ***3           S01117
     C                     GOTO #BE9                       ***3           S01117
     C*                                                                   S01117
     C**   ONLY BRANCH CODE ENTERED, VALIDATE                             S01117
     C                     ELSE                            X**3           S01117
      *
     C***********BKOBUV    IFEQ 'Y'                        B***4          S01117
     C********** BKOR      ANDEQ'O'                        B***4          S01117
     C           BKOR      IFEQ 'O'                        B***4          S01117
     C           BKOR      OREQ 'B'                        B***4          S01117
      ** Check that  branch code exists on SDBRCHPD                       S01117
     C**********           CALL 'AOBRCHR0'                 ****4                       S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7        ****4          S01117
     C                     PARM '*KEY   ' @OPTN   7        ****4          S01117
     C                     PARM BCDX      @DSNB   3        ****4          S01117
     C********** @BRCH     PARM @BRCH     DSFDY                                        S01194 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C************         PARM           @BRCH            ****4          S01117
     C           @RTCD     IFNE *BLANKS                    B****5         S01117
     C                     MOVE '1'       *IN38            *****5         S01117
     C                     MOVE '1'       *IN39            *****5         S01117
     C                     MOVE '1'       *IN77            *****5         E00044
     C                     MOVE ERR,7     MSG              *****5         S01117
     C                     GOTO #BE9                       *****5         S01117
     C                     ELSE                            X****5         S01117
      *
      ** PROCESS FOR '?'
     C                     MOVELA8BRCD    BCDX
     C                     MOVE BCDX      BRCO             *****5         S01117
     C                     MOVE A8BRNM    BRCON            *****5         S01117
     C                     MOVE 'B'       LIMK2            *****5         S01117
     C                     MOVE BCDX      LIMK3            *****5         S01117
     C                     END                             E****5         S01117
     C                     END                             E***4          S01117
      *
      ** Validate the booking Branch against User                         S01117
      *                                                                   S01117
     C           BKOR      IFEQ 'B'                        B***4          S01117
     C                     CALL 'ZVBBU'                    ****4          S01117
     C                     PARM BCDX      ZBRCDX  3        ****4          S01117
     C                     PARM           EROR    10       ****4          S01117
     C           EROR      IFEQ 1                          B****5         S01117
      * no valid booking branches found for user                          S01117
     C                     MOVE '1'       *IN38            *****5         S01117
     C                     MOVE '1'       *IN39            *****5         S01117
     C                     MOVE '1'       *IN77            *****5         E00044
     C                     MOVE ERR,12    MSG              *****5         S01117
     C                     GOTO #BE9                       *****5         S01117
     C                     END                             E****5         S01117
      *                                                                   S01117
     C           EROR      IFEQ 2                          B****5         S01117
      * this booking branch invalid for user                              S01117
     C                     MOVE '1'       *IN38            *****5         S01117
     C                     MOVE '1'       *IN39            *****5         S01117
     C                     MOVE '1'       *IN77            *****5         E00044
     C                     MOVE ERR,9     MSG              *****5         S01117
     C                     GOTO #BE9                       *****5         S01117
     C                     END                             E****5         S01117
     C                     END                             E***4          S01117
      *                                                                   S01117
     C                     END                             E**3           S01117
      *                                                                   S01117
     C                     MOVE '0'       *IN73            **2            S01117
     C**                                                                  S01117
     C                     ELSE                            X*2            S01117
     C                     MOVE '1'       *IN73            **2            S01117
     C*                                                                   S01117
     C*    ONLY COMPANY CODE ENTERED, VALIDATE                            S01117
     C**  Spf Validation for Company                                      S01117
     C           CCDX      IFNE *BLANKS                    B**3           S01117
     C           CCDX      ANDNE'ALL'                      B**3           S01117
      ** Check that Company code exists on SDCOMPPD                       S01117
     C                     CALL 'AOCOMPR0'                 ***3           S01117
     C                     PARM *BLANKS   @RTCD   7        ***3           S01117
     C                     PARM '*KEY   ' @OPTN   7        ***3           S01117
     C                     PARM CCDX      @CENB   3        ***3           S01117
     C           @COMP     PARM @COMP     DSFDY                           S01194
     C************         PARM           @COMP            ***3           S01117
     C           @RTCD     IFNE *BLANKS                    B***4          S01117
     C                     MOVE '1'       *IN38            ****4          S01117
     C                     MOVE '1'       *IN39            ****4          S01117
     C                     MOVE '1'       *IN78            ****4          E00044
     C                     MOVE ERR,8     MSG              ****4          S01117
     C                     GOTO #BE9                       ****4          S01117
     C                     ELSE                            X***4          S01117
      *
      ** PROCESS FOR '?'
     C                     MOVELAPCMCD    CCDX
     C                     MOVE CCDX      BRCO             ****4          S01117
     C                     MOVE APCMNM    BRCON            ****4          S01117
     C                     MOVE 'C'       LIMK2            ****4          S01117
     C                     MOVE CCDX      LIMK3            ****4          S01117
     C                     END                             E***4          S01117
      *                                                                   S01117
     C                     CALL 'ZVCOU'                    ***3           S01117
     C                     PARM CCDX      ZCMPYX  3        ***3           S01117
     C                     PARM           EROR    10       ***3           S01117
     C           EROR      IFEQ 1                          B***4          S01117
      * no valid companies found for user                                 S01117
     C                     MOVE '1'       *IN38            ****4          S01117
     C                     MOVE '1'       *IN39            ****4          S01117
     C                     MOVE '1'       *IN78            ****4          E00044
     C                     MOVE ERR,11    MSG              ****4          S01117
     C                     GOTO #BE9                       ****4          S01117
     C                     END                             E***4          S01117
      *                                                                   S01117
     C           EROR      IFEQ 2                          B***4          S01117
      * this company is invalid for user                                  S01117
     C                     MOVE '1'       *IN38            ****4          S01117
     C                     MOVE '1'       *IN39            ****4          S01117
     C                     MOVE '1'       *IN78            ****4          E00044
     C                     MOVE ERR,10    MSG              ****4          S01117
     C                     GOTO #BE9                       ****4          S01117
     C                     END                             E***4          S01117
     C                     MOVE '0'       *IN74            ***3           S01117
     C                     ELSE                            X**3           S01117
     C                     MOVE '1'       *IN74            ***3           S01117
     C********                                                            S01117
     C*****NEITHER BRANCH NOR COMPANY CODE ENTERED,                       S01117
     C*****-*SYSTEM LEVEL (CONSOLIDATED)                                  S01117
     C********                                                            S01117
     C*******************  MOVE *BLANKS   BRCO             ***3           S01117
     C*******************  MOVE *BLANKS   BRCON            ***3           S01117
     C*******************  MOVE 'S'       LIMK2            ***3           S01117
     C*******************  MOVE *BLANKS   LIMK3            ***3           S01117
     C                     END                             E**3           S01117
     C                     END                             E*2            S01117
     C                     END                             E1             S01117
     C           #BE9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BF      - SET UP ARRAYS OF LIMIT PERIODS                     *
     C*                                                               *
     C* CALLS   *TABCHN***-*CHAIN*TO*THE*TABLE*FILE                   *   S01194
     C*            #BFA   - SET UP ARRAY FOR FX LIMITS                *   S01117
     C*************#BFB   - SET UP ARRAY FOR LN LIMITS             S01117 S01433
     C*            #BFB   - SET UP ARRAY FOR MM LIMITS                *   S01433
     C*            #BFC   - SET UP ARRAY FOR PM LIMITS                *   S01433
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BF       BEGSR                                       *
     C*
     C**   INITIALISE  FIELDS                                             S01117
     C                     MOVE *BLANKS   DZFXLT                          S01117
     C                     Z-ADD0         DZFLED                          S01117
     C*******              MOVE *BLANKS   DZLLTY                   S01117 S01433
     C*******              Z-ADD0         DZLLED                   S01117 S01433
     C                     Z-ADD0         DZFRED                          067425
     C                     Z-ADD0         DZIRED                          067425
     C                     Z-ADD0         DZFRLA                          067425
     C                     Z-ADD0         DZIRLM                          067425
     C                     Z-ADD0         DZFXLA                          067425
     C                     Z-ADD0         DZMLAM                          067425
     C*                                                                   067425
     C                     MOVE *BLANKS   DZMMTY                          S01433
     C                     Z-ADD0         DZMMED                          S01433
     C                     MOVE *BLANKS   DZPLTY                          S01433
     C                     Z-ADD0         DZPLED                          S01433
     C                     Z-ADD0         DZFLAM                          S01433
     C                     Z-ADD0         DZFXFA                          S01433
     C                     Z-ADD0         DZPSAM                          S01433
     C                     Z-ADD0         DZPFAM                          S01433
     C** BLANK 'NO LIMIT' MSG
     C                     MOVE *BLANKS   FEXPRA
     C                     MOVE *BLANKS   FEXPRF                          S01433
     C                     MOVE *BLANKS   LEXPRA
     C                     MOVE *BLANKS   PMXPRA                          S01433
     C                     MOVE *BLANKS   PMXPRF                          S01433
     C*                                                                   S01157
     C* RESET FRA & IRS TOTAL EXPOSURE FIELDS                             S01157
     C*                                                                   S01157
     C                     Z-ADD0         @FREA                           S01157
     C                     Z-ADD0         @IREA                           S01157
     C*                                                                   S01157
     C** RESET ARRAYS TO ZEROES
     C                     MOVE *BLANKS   FDEF                            E226
     C                     MOVE *BLANKS   LDEF                            E226
     C                     MOVE *BLANKS   PDEF                            S01433
     C                     MOVE *BLANKS   IRDEF                           E226
     C                     MOVE *BLANKS   FRDEF                           E226
     C                     MOVE *BLANKS   XFEX
     C**********           MOVE *BLANKS   XMEX                            S01433
     C                     MOVE *BLANKS   XPEX                            S01433
     C                     MOVE *BLANKS   XLEX
     C                     Z-ADD0         XFDA
     C                     Z-ADD0         XFDT
     C                     Z-ADD0         XFLM
     C                     Z-ADD0         XFXP
     C                     Z-ADD0         XFXS
     C                     Z-ADD0         XFLM1                           S01433
     C                     Z-ADD0         XFXP1                           S01433
     C                     Z-ADD0         XFXS1                           S01433
     C                     Z-ADD0         XPDT                            S01433
     C                     Z-ADD0         XPLM                            S01433
     C                     Z-ADD0         XPXP                            S01433
     C                     Z-ADD0         XPXS                            S01433
     C                     Z-ADD0         XPLM1                           S01433
     C                     Z-ADD0         XPXP1                           S01433
     C                     Z-ADD0         XPXS1                           S01433
     C                     Z-ADD0         XPDC                            S01433
     C                     Z-ADD0         XFPC                            S01433
     C                     Z-ADD0         XLDA
     C                     Z-ADD0         XLDT
     C                     Z-ADD0         XLLM
     C                     Z-ADD0         XLXP
     C                     Z-ADD0         XLXS
     C                     Z-ADD0         XFDA1   30                      S01433
     C                     Z-ADD0         XFDT1   50                      S01433
     C                     Z-ADD0         XFLM1   90                      S01433
     C                     Z-ADD0         XPDA1   30                      S01433
     C                     Z-ADD0         XPDT1   50                      S01433
     C                     Z-ADD0         XPLM1   90                      S01433
     C                     Z-ADD0         XLPC
     C                     MOVEA*ZEROS    XFS,1                           E232
     C                     MOVEA*BLANKS   XFHY,1                          E232
     C                     MOVEA*ZEROS    XFDA,1                          E232
     C                     MOVEA*ZEROS    XLS                             E232
     C                     MOVEA*BLANKS   XLHY,1                          E232
     C                     MOVEA*ZEROS    XLDA,1                          E232
     C                     MOVEA*ZEROS    XPS,1                           S01433
     C                     MOVEA*BLANKS   XPHY,1                          S01433
     C                     MOVEA*ZEROS    XPDA,1                          S01433
     C/COPY WNCPYSRC,DL0130AC09
     C*                                                                   S01117
0649 C**   CHAIN TO LIMIT FILE FOR CUSTOMER LIMITS.
     C                     MOVE BBCUST    LIMK1                           S01117
     C           LIMKEY    CHAINLIMITJ               19                   S01117
     C/COPY WNCPYSRC,DL0130AC10
0658 C**
     C*****                MOVE BLNK12    KEYTAB                          S01194
     C*****                                                               S01117
     C** ACCESS THE LIMITS FILE                                           S01117
     C****       CNUM      CHAINLIMIT                51                   S01117
     C****                                                                S01117
     C****S THE LIMIT DELETED                                             S01117
     C*****      RECI      IFNE 'D'                               B1      S01117
     C*****      *IN51     OREQ '1'                               *1      S01117
     C*****                MOVE ERR,4     MSG                     *1      S01117
     C*****                MOVE 'NO LIMIT'FEXPRA  8               S01157  S01117
     C*****                MOVE 'NO LIMIT'LEXPRA  8               S01157  S01117
     C*****                MOVE *BLANK    FEXPRA                  S01157  S01117
     C*****                MOVE *BLANK    LEXPRA                  S01157  S01117
     C*****                MOVE 'NO LIMIT'FEXPRA  9               S01157  S01117
     C*****                MOVE 'NO LIMIT'LEXPRA  9               S01157  S01117
     C*****                MOVE '1'       *IN38                   *1      S01117
     C*****                MOVE '1'       *IN48                   *1      S01117
     C*****                MOVE '1'       *IN49                   *1      S01117
     C*****                MOVEA'999'     XFDAA                   *1      S01117
     C*****                MOVEA'999'     XLDAA                   *1      S01117
     C*****                GOTO #BF9                              *1      S01117
     C*****                END                                    E1      S01117
     C*****                                                         S01136S01117
     C**IF NO FX LIMIT FORMAT FIELDS FOR OUTPUT                     S01136S01117
     C*****                                                         S01136S01117
     C*****      FLAM      IFEQ 0                                   S01136S01117
     C*****      FLED      ANDEQ0                                 *1S01157S01117
     C*****                MOVE *BLANK    FEXPRA                  *1S01157S01117
     C*****                MOVE 'NO LIMIT'FEXPRA                  *1S01136S01117
     C*****                MOVEA'999'     XFDAA                   *1S01136S01117
     C*****                END                                    E1S01136S01117
     C*****                                                               S01117
     C***CHECK IF FX LIMIT TYPE ZERO, OR EXPIRY DATE PASSED OR TODAY.     S01117
     C*****      FLED      IFEQ 0                                 B1      S01117
     C*****      FLAM      ANDGT0                                 *1S01157S01117
     C*****                Z-ADD99999     FLED                    *1S01157S01117
     C*****                MOVE *BLANK    FEXPRA                  *1S01157S01117
     C*****                MOVEL'NO'      FEXPRA                  *1S01157S01117
     C*****                MOVE 'EXPIRY'  FEXPRA                  *1S01157S01117
     C*****                END                                    X1      S01117
     C*****                                                               S01117
     C** IS THE DATE TODAY OR PASSED THE EXPIRY DATE ?                    S01117
     C*****      FLED      IFLE RUND                              B*2     S01117
     C*****      FLED      ANDNE0                                 **S01157S01117
     C*****                MOVE '1'       *IN48                   **      S01117
     C*****                MOVE *BLANK    FEXPRA                  **S01157S01117
     C*****                MOVE 'EXPIRED 'FEXPRA                  **2     S01117
     C*****                MOVEA'999'     XFDAA                   **2     S01117
     C*****                END                                    E*2     S01117
     C*****                                                               S01117
     C***CHECK LOAN LIMITS                                                S01117
     C*****                                                               S01117
     C*****                                                         S01136S01117
     C**IF NO MM LIMIT FORMAT FIELDS FOR OUTPUT                     S01136S01117
     C*****                                                         S01136S01117
     C*****      LLAM      IFEQ 0                                 B1S01136S01117
     C*****      LLED      ANDEQ0                                 *1S01157S01117
     C*****                MOVE *BLANK    LEXPRA                  *1S01157S01117
     C*****                MOVE 'NO LIMIT'LEXPRA                  *1S01136S01117
     C*****                MOVEA'999'     XLDAA                   *1S01136S01117
     C*****                END                                    E1S01136S01117
     C*****                                                               S01117
     C*****FOR EXPIRY OR NO LIMIT,                                        S01117
     C*****      LLED      IFEQ 0                                 B1      S01117
     C*****      LLAM      ANDGT0                                  S01157 S01117
     C*******              Z-ADD99999     LLED                     S01157 S01117
     C*****                MOVE *BLANK    LEXPRA                   S01157 S01117
     C*****                MOVEL'NO'      LEXPRA                   S01157 S01117
     C*****                MOVE 'EXPIRY'  LEXPRA                   S01157 S01117
     C*****                END                                    X1      S01117
     C*****                                                               S01117
     C***IS THE DATE TODAY OR PASSED THE EXPIRY DATE ?                    S01117
     C*****      LLED      IFLE RUND                              B*2     S01117
     C*****      LLED      ANDNE0                                  S01157 S01117
     C*****                MOVE '1'       *IN49                   2       S01117
     C*****                MOVE *BLANK    LEXPRA                   S01157 S01117
     C*****                MOVE 'EXPIRED 'LEXPRA                  *2      S01117
     C*****                MOVEA'999'     XLDAA                   **2     S01117
     C*****                END                                    E*2     S01117
     C*****                                                               S01117
     C*****PROCESS FX LIMITS FIRST                                        S01117
     C*****- CHECK IF LIMIT HAS EXPIRED.                                  S01117
     C*****      FLED      IFLE RUND                                      S01117
     C*****      FLED      ANDNE0                                  S01157 S01117
     C*****                                                               S01117
     C*****- IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES        S01117
     C*****  & ZEROIZE AMOUNT                                             S01117
     C*****                Z-ADD999       XFDA,1                          S01117
     C*****                Z-ADD99999     XFDT,1                          S01117
     C*****                Z-ADD0         XFLM,1                          S01117
     C*****                GOTO #BF8                                      S01117
     C*****                END                                            S01117
     C*****                                                        S01136 S01117
     C** BLANK data structure                                      S01136 S01117
     C*****                MOVE *BLANKS   LEPSIN                   S01136 S01117
     C*****                MOVE *BLANKS   LPCSIN                   S01136 S01117
     C*****                                                        S01136 S01117
     C*****                                                               S01117
     C*****- NOT EXPIRED - CHAIN TO LIMITS REC. ON S/TABLE.               S01117
     C*****- FIX TO CHAIN S/TABLE ONLY IF AN FX LIMIT HAS BEEN SET S01136 S01117
     C*****  THUS AVOID A DATABASE ERROR                           S01136 S01117
     C*****      FLAM      IFGT 0                                  S01136 S01117
     C*****                MOVE FLTY      KEYTAB                          S01117
     C*****                MOVEL'45'      KEYTAB                          S01117
     C*****                EXSR TABCHN                                    S01117
     C*****      *INU7     CABEQ'1'       #BF9                            S01117
     C*****                                                         S01136S01117
     C*****                END                                      S01136S01117
     C*****                                                               S01117
     C*****- MOVE DATA FROM INPUT FIELDS TO FX ARRAYS                     S01117
     C*****                MOVE LEPSIN    XFDAIN                          S01117
     C*****                MOVE LPCSIN    XFPCIN                          S01117
     C*****                                                               S01117
     C*                                                                   S01117
     C* IF RECORD NOT FOUND THEN DISPLAY NO LIMIT MESSAGE IF MBIN 'N'
     C           *IN19     IFEQ '1'                                       S01117
     C***********@MBIN     IFEQ 'N'                                       E44A
     C           @MBIN     IFEQ 'N'                                       E226
     C* FOR FX LIMIT
     C*********************MOVE 'NO LIM.' FEXPRA                    S01117LN0527
     C                     MOVEL'NO LIMIT'FEXPRA                          LN0527
     C                     MOVE '1'       *IN48                           S01117
     C                     Z-ADD999       XFDA,1                          S01117
     C                     Z-ADD99999     XFDT,1                          S01117
     C                     Z-ADD0         XFLM,1                          S01117
     C**AND*FOR*LENDING LIMITS                                            S01433
     C* AND FOR MONEY MARKET LIMITS                                       S01433
      *
     C*********************MOVE 'NO LIM.' LEXPRA                    S01117LN0527
     C                     MOVEL'NO LIMIT'LEXPRA                          LN0527
     C                     MOVE '1'       *IN49                           S01117
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     Z-ADD0         XLLM,1                          S01117
     C/COPY WNCPYSRC,DL0130AC11
     C*
     C** FOR PRECIOUS METAL LIMITS                                        S01433
     C*                                                                   S01433
     C                     MOVEL'NO LIMIT'PMXPRA                          S01433
     C                     MOVE '1'       *IN50                           S01117
     C                     Z-ADD999       XPDA,1                          S01117
     C                     Z-ADD99999     XPDT,1                          S01117
     C                     Z-ADD0         XPLM,1                          S01117
     C*                                                                   S01433
     C*********************END                                            E44A
      *                                                                   E226
      * RECORD NOT FOUND AND MBIN 'Y'                                     S01117
     C                     ELSE                                           S01117
     C**  IF BRANCH - NO DEFAULTING IS DONE                               S01117
     C           LEVEL     IFEQ 'B'                                       S01117
      * FX PROCESSING                                                     S01117
     C*********************MOVE 'NO LIM.' FEXPRA                    S01117LN0527
     C           DZFLAM    IFEQ 0                                         LN0527
     C                     MOVEL'NO LIMIT'FEXPRA                          LN0527
     C                     END                                            LN0527
     C           DZFXFA    IFEQ 0                                         LN0527
     C                     MOVEL'NO LIMIT'FEXPRF                          LN0527
     C                     END                                            LN0527
     C                     MOVE '1'       *IN48                           S01117
     C                     Z-ADD999       XFDA,1                          S01117
     C                     Z-ADD99999     XFDT,1                          S01117
     C                     Z-ADD0         XFLM,1                          S01117
      * MM PROCESSING                                                     S01117
     C*********************MOVE 'NO LIM.' LEXPRA                    S01117LN0527
     C                     MOVEL'NO LIMIT'LEXPRA                          LN0527
     C                     MOVE '1'       *IN49                           S01117
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     Z-ADD0         XLLM,1                          S01117
     C/COPY WNCPYSRC,DL0130AC12
      *                                                                   S01117
     C* PM PROCESSING                                                     S01433
     C           DZPSAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRA                          S01433
     C                     END                                            S01433
     C           DZPFAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRF                          S01433
     C                     END                                            S01433
     C                     MOVE '1'       *IN50                           S01117
     C                     Z-ADD999       XPDA,1                          S01117
     C                     Z-ADD99999     XPDT,1                          S01117
     C                     Z-ADD0         XPLM,1                          S01117
     C*                                                                   S01433
     C**  IF CO OR SYSTEM LEVEL                                           S01117
     C                     ELSE                                           S01117
     C                     MOVE 'Y'       LDEF                            S01117
     C*********************MOVE 'DEFAULT' LEXPRA                    S01117LN0527
     C                     MOVEL'DEFAULT' LEXPRA                          LN0527
     C                     MOVE 'Y'       FDEF                            S01117
     C*********************MOVE 'DEFAULT' FEXPRA                    S01117LN0527
     C/COPY WNCPYSRC,DL0130AC13
     C           DZFLAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' FEXPRA                          LN0527
     C                     END                                            LN0527
     C           DZFXFA    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' FEXPRF                          LN0527
     C                     END                                            LN0527
     C                     MOVE 'Y'       PDEF                            S01433
     C           DZPSAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' PMXPRA                          S01433
     C                     END                                            S01433
     C           DZPFAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' PMXPRF                          S01433
     C                     END                                            S01433
     C* IF FRA/IRS PRESENT THEN GET RESPECTIVE DEFAULTS                   LN0527
     C                     MOVE 'Y'       FRDEF                           LN0527
     C                     MOVE 'Y'       IRDEF                           LN0527
     C                     END                                            E226
     C                     END                                            E226
      *
      * RECORD FOUND ON LIMITJ
     C                     ELSE                                           S01117
     C**   Process FX Limits first                                        S01117
     C** CASE 1 - LIVE, NON ZERO                                          S01117
     C** IF FX LIMIT TYPE NON ZERO & EXPIRY DATE GT RUND                  S01117
     C           DZFXLT    IFNE *BLANKS                                   S01117
     C           DZFLAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRA                          S01433
     C                     END                                            S01433
     C           DZFXFA    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRF                          S01433
     C                     END                                            S01433
     C           DZFLED    IFGT BJRDNB                                    S01433
     C           DZFLED    OREQ 0                                         S01117
     C                     EXSR #BFA                                      S01117
     C                     END                                         ** S01117
     C                     END                                         ** S01117
     C**                                                                  S01117
     C**   CASE 2-EXPIRED                                                 S01117
     C**   - IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES        S01117
     C**     & ZEROIZE AMOUNT                                             S01117
     C           DZFLED    IFLE BJRDNB                                    S01117
     C           DZFLED    ANDNE0                                         S01117
     C                     Z-ADD999       XFDA,1                          S01117
     C                     Z-ADD99999     XFDT,1                          S01117
     C                     Z-ADD0         XFLM,1                          S01117
     C                     END                                            S01117
     C**   CASE 3 - NO LIMIT                                              S01117
     C**   - IF FX LIMIT TYPE 0, CONDITION DEFAULT                        S01117
     C           DZFXLT    IFEQ *BLANKS                                   S01117
     C* IF NOT MULTI-BRANCHED DISPLAY NO LIMIT MESSAGE
      *
     C           @MBIN     IFEQ 'N'                                       S01117
     C*********************MOVE 'NO LIM.' FEXPRA                    S01117LN0527
     C           DZFLAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRA                          LN0527
     C                     END                                            S01433
     C           DZFXFA    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRF                          S01433
     C                     END                                            S01433
     C                     MOVE '1'       *IN48                           S01117
     C                     Z-ADD999       XFDA,1                          S01117
     C                     Z-ADD99999     XFDT,1                          S01117
     C                     Z-ADD0         XFLM,1                          S01117
     C                     ELSE                                           S01117
     C**  IF BRANCH - NO DEFAULTING IS DONE                               S01117
     C           LEVEL     IFEQ 'B'                                       S01117
     C*********************MOVE 'NO LIM.' FEXPRA                    S01117LN0527
     C           DZFLAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRA                          LN0527
     C                     END                                            S01433
     C           DZFXFA    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'FEXPRF                          S01433
     C                     END                                            S01433
     C                     MOVE '1'       *IN48                           S01117
     C                     Z-ADD999       XFDA,1                          S01117
     C                     Z-ADD99999     XFDT,1                          S01117
     C                     Z-ADD0         XFLM,1                          S01117
     C                     ELSE                                           S01117
     C**  IF CO OR SYSTEM LEVEL                                           S01117
     C                     MOVE 'Y'       FDEF    1                       S01117
     C*********************MOVE 'DEFAULT' FEXPRA                    S01117LN0527
     C           DZFLAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' FEXPRA                          LN0527
     C                     END                                            S01433
     C           DZFXFA    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' FEXPRF                          S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C                     END                                            S01117
     C                     END                                            S01117
     C*****Process Lending Limits.                                 S01117 S01433
     C*    Process MM Limits.                                             S01433
     C**   CASE 1 - LIVE, NON ZERO                                        S01117
     C**   IF LN LIMIT TYPE NON ZERO & EXPIRY DATE GT RUND                S01117
     C*******    DZLLTY    IFNE *BLANKS                            S01117 S01433
     C*******    DZLLED    IFGT BJRDNB                             S01117 S01433
     C*******    DZLLED    OREQ 0                                  S01117 S01433
     C           DZMMTY    IFNE *BLANKS                                   S01433
     C/COPY WNCPYSRC,DL0130AC14
     C           DZMMED    IFGT BJRDNB                                    S01433
     C           DZMMED    OREQ 0                                         S01433
     C                     EXSR #BFB                                      S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C**   CASE 2 - EXPIRED                                               S01117
     C**   - IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES        S01117
     C**     & ZEROISE AMOUNT                                             S01117
     C*******    DZLLED    IFLE BJRDNB                             S01117 S01433
     C*******    DZLLED    ANDNE0                                  S01117 S01433
     C           DZMMED    IFLE BJRDNB                                    S01433
     C           DZMMED    ANDNE0                                         S01433
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     Z-ADD0         XLLM,1                          S01117
     C/COPY WNCPYSRC,DL0130AC15
     C                     END                                         ** S01117
     C**                                                                  S01117
     C**   CASE 3 - NO  LIMIT                                             S01117
     C**   - IF LIMIT TYPE 0, CONDITION DEFAULT                           S01117
     C*******    DZLLTY    IFEQ *BLANKS                            S01117 S01433
     C           DZMMTY    IFEQ *BLANKS                                   S01433
     C* IF NOT MULTI-BRANCHED DISPLAY NO LIMIT MESSAGE
      *
     C           @MBIN     IFEQ 'N'                                       S01117
     C*********************MOVE 'NO LIM.' LEXPRA                    S01117LN0527
     C                     MOVEL'NO LIMIT'LEXPRA                          LN0527
     C                     MOVE '1'       *IN49                           S01117
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     Z-ADD0         XLLM,1                          S01117
     C/COPY WNCPYSRC,DL0130AC16
     C                     ELSE                                           S01117
     C**  IF BRANCH - NO DEFAULTING IS DONE                               S01117
     C           LEVEL     IFEQ 'B'                                       S01117
     C*********************MOVE 'NO LIM.' LEXPRA                    S01117LN0527
     C                     MOVEL'NO LIMIT'LEXPRA                          LN0527
     C                     MOVE '1'       *IN49                           S01117
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     Z-ADD0         XLLM,1                          S01117
     C/COPY WNCPYSRC,DL0130AC17
     C                     ELSE                                           S01117
     C**  IF CO OR SYSTEM LEVEL                                           S01117
     C                     MOVE 'Y'       LDEF    1                       S01117
     C*********************MOVE 'DEFAULT' LEXPRA                    S01117LN0527
     C                     MOVEL'DEFAULT' LEXPRA                          LN0527
     C/COPY WNCPYSRC,DL0130AC18
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01433
     C**   Process PRECIOUS METALS Limits                                 S01433
     C** CASE 1 - LIVE, NON ZERO                                          S01433
     C** IF PM LIMIT TYPE NON ZERO & EXPIRY DATE GT RUND                  S01433
     C           DZPLTY    IFNE *BLANKS                                   S01433
     C           DZPLED    IFGT BJRDNB                                    S01433
     C           DZPLED    OREQ 0                                         S01433
     C           DZPSAM    IFEQ 0                                         S01117
     C                     MOVEL'NO LIMIT'PMXPRA                          S01117
     C                     END                                            S01117
     C           DZPFAM    IFEQ 0                                         S01117
     C                     MOVEL'NO LIMIT'PMXPRF                          S01117
     C                     END                                            S01117
     C                     EXSR #BFC                                      S01433
     C                     END                                         ** S01433
     C                     END                                         ** S01433
     C**                                                                  S01433
     C**   CASE 2-EXPIRED                                                 S01433
     C**   - IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES        S01433
     C**     & ZEROIZE AMOUNT                                             S01433
     C           DZPLED    IFLE BJRDNB                                    S01433
     C           DZPLED    ANDNE0                                         S01433
     C                     Z-ADD999       XPDA,1                          S01433
     C                     Z-ADD99999     XPDT,1                          S01433
     C                     Z-ADD0         XPLM,1                          S01433
     C                     END                                            S01433
     C**   CASE 3 - NO LIMIT                                              S01433
     C**   - IF PM LIMIT TYPE 0, CONDITION DEFAULT                        S01433
     C           DZPLTY    IFEQ *BLANKS                                   S01433
     C* IF NOT MULTI-BRANCHED DISPLAY NO LIMIT MESSAGE                    S01433
      *                                                                   S01433
     C           @MBIN     IFEQ 'N'                                       S01433
     C           DZPSAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRA                          S01433
     C                     END                                            S01433
     C           DZPFAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRF                          S01433
     C                     END                                            S01433
     C                     MOVE '1'       *IN50                           S01433
     C                     Z-ADD999       XPDA,1                          S01433
     C                     Z-ADD99999     XPDT,1                          S01433
     C                     Z-ADD0         XPLM,1                          S01433
     C                     ELSE                                           S01433
     C**  IF BRANCH - NO DEFAULTING IS DONE                               S01433
     C           LEVEL     IFEQ 'B'                                       S01433
     C           DZPSAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRA                          S01433
     C                     END                                            S01433
     C           DZPFAM    IFEQ 0                                         S01433
     C                     MOVEL'NO LIMIT'PMXPRF                          S01433
     C                     END                                            S01433
     C                     MOVE '1'       *IN50                           S01433
     C                     Z-ADD999       XPDA,1                          S01433
     C                     Z-ADD99999     XPDT,1                          S01433
     C                     Z-ADD0         XPLM,1                          S01433
     C                     ELSE                                           S01433
     C**  IF CO OR SYSTEM LEVEL                                           S01433
     C                     MOVE 'Y'       PDEF    1                       S01433
     C           DZPSAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' PMXPRA                          S01433
     C                     END                                            S01433
     C           DZPFAM    IFEQ 0                                         S01433
     C                     MOVEL'DEFAULT' PMXPRF                          S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*                                                                   LN0527
     C* DETERMINE WHETHER DEFAULTS FOR FRA/IRS NEEDED (DISPLAY FIELDS     LN0527
     C* AND SO FORTH SET UP IN #BI)                                       LN0527
     C           BGFIIN    IFEQ 'Y'                                       LN0527
     C           @MBIN     ANDEQ'Y'                                       LN0527
     C           LEVEL     ANDNE'B'                                       LN0527
     C*                                                                   LN0527
     C           DZFRLA    IFEQ 0                                         LN0527
     C           DZFRED    ANDEQ0                                         LN0527
     C                     MOVEL'Y'       FRDEF                           LN0527
     C                     END                                            LN0527
     C           DZIRLM    IFEQ 0                                         LN0527
     C           DZIRED    ANDEQ0                                         LN0527
     C                     MOVEL'Y'       IRDEF                           LN0527
     C                     END                                            LN0527
     C*                                                                   LN0527
     C                     END                                            LN0527
     C*                                                                   LN0527
     C                     END                                            E226
     C*                                                                   S01117
     C***IF*FX*, LN ,FRA OR IRA DEFAULT REQUIRED.                  S01117 S01433
     C** IF FX , MM , PM , FRA OR IRA DEFAULT REQUIRED.                   S01433
     C* OBTAIN FRA AND IRS DEFAULT FOR USE,IF NECESSARY LATER IN PROGRAM  S01117
     C           LEVEL     IFNE 'B'                                       S01117
     C           FDEF      IFEQ 'Y'                                       S01117
     C           LDEF      OREQ 'Y'                                       S01117
     C           PDEF      OREQ 'Y'                                       S01433
     C           FRDEF     OREQ 'Y'                                       S01117
     C           IRDEF     OREQ 'Y'                                       S01117
     C*                                                                   S01117
     C** DEFINE LEVEL FOR DEFAULT AND GET DEFAULT                         S01117
     C           LEVEL     IFEQ 'C'                                       S01117
     C                     MOVE CCDX      ENTITY  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE '   '     ENTITY  3                       S01117
     C                     END                                            S01117
     *******               Z-ADD0         FXLIM   90               S01117 S01433
     C                     Z-ADD0         FXLMS   90                      S01433
     C                     Z-ADD0         FXLMF   90                      S01433
     C                     Z-ADD0         LNLIM   90                      S01117
     C                     Z-ADD0         PMLMS   90                      S01433
     C                     Z-ADD0         PMLMF   90                      S01433
     C                     Z-ADD0         FRLIM   90                      S01117
     C                     Z-ADD0         IRLIM   90                      S01117
     C                     MOVE BBCUST    CUST    6                       S01117
     C                     MOVE 'Y'       FXSAME  1                       S01117
     C                     MOVE 'Y'       LNSAME  1                       S01117
     C                     MOVE 'Y'       PMSAME  1                       S01433
     C                     MOVE *BLANK    FXPER  18                       S01117
     C                     MOVE *BLANK    LNPER  18                       S01117
     C                     MOVE *BLANK    PMPER  18                       S01433
     C                     MOVE *BLANK    FXPC   18                       S01117
     C                     MOVE *BLANK    LNPC   18                       S01117
     C                     MOVE *BLANK    PMPC   18                       S01433
     C*******              CALL 'DL0131'                           S01117 S01433
     C                     CALL 'DL0131A'                                 S01433
     C                     PARM           CUST                            S01117
     C                     PARM           LEVEL                           S01117
     C                     PARM           ENTITY                          S01117
     C                     PARM           FDEF                            S01117
     C                     PARM           LDEF                            S01117
     C                     PARM           PDEF                            S01433
     C                     PARM           FRDEF   1                       S01117
     C                     PARM           IRDEF   1                       S01117
     C*******              PARM           FXLIM                    S01117 S01433
     C                     PARM           FXLMS                           S01433
     C                     PARM           FXLMF                           S01433
     C                     PARM           LNLIM                           S01117
     C                     PARM           PMLMS                           S01433
     C                     PARM           PMLMF                           S01433
     C                     PARM           FRLIM                           S01117
     C                     PARM           IRLIM                           S01117
     C                     PARM           FXSAME                          S01117
     C                     PARM           LNSAME                          S01117
     C                     PARM           PMSAME                          S01433
     C                     PARM           FXPER                           S01117
     C                     PARM           LNPER                           S01117
     C                     PARM           PMPER                           S01433
     C                     PARM           FXPC                            S01117
     C                     PARM           LNPC                            S01117
     C                     PARM           PMPC                            S01433
     C                     PARM BJRDNB    RUND    50                      S01117
     C**                                                                  S01117
     C*                                                                   S01117
     C**  APPLY DEFAULT VALUES                                            S01117
     C**                                                                  S01117
     C** IF FX DEFAULT REQUIRED                                           S01117
     C           FDEF      IFEQ 'Y'                                       S01117
     C** IF FX SPOT LIMIT FOUND                                           S01433
     C           FXLMS     IFNE 0                                         S01433
     C*                                                                   S01433
     C           FXSAME    IFEQ 'Y'                                       S01433
     C                     Z-ADDSP        XFDA1                           S01433
     C                     Z-ADDFXLMS     DZFLAM                          S01433
     C                     MOVE FXPC      XFPCA                           S01433
     C           DZFLAM    DIV  XFPC,1    DZFLAM                          S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C                     Z-ADDSP        XFDA1                           S01433
     C           SP        ADD  BJRDNB    XFDT1                           S01433
     C                     Z-ADDFXLMS     XFLM1                           S01433
     C                     END                                            S01433
     C**********           MOVEL'SP'      FLEP1                           S01433
     C                     MOVEL'002'     FLEP1                           S01433
     C                     MOVEL'999'     FLEP2                           S01433
     C                     Z-ADDSP        XFDA,1                          S01433
     C                     Z-ADD999       XFDA,2                          S01433
     C           SP        ADD  BJRDNB    XFDT,1                          S01433
     C                     Z-ADD99999     XFDT,2                          S01433
     C                     ELSE                                           S01433
     C                     Z-ADD999       XFDA1                           S01433
     C                     Z-ADD99999     XFDT1                           S01433
     C                     Z-ADD999       XFDA,1                          S01433
     C                     Z-ADD99999     XFDT,1                          S01433
     C                     MOVEL'999'     FLEP1                           S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C***IF*FX*LIMIT FOUND                                         S01117 S01433
     C*******    FXLIM     IFNE 0                                  S01117 S01433
     C** IF FX FORWARD LIMITS FOUND                                       S01433
     C           FXLMF     IFNE 0                                         S01433
     C**  IF ALL LOWER LEVEL LIMITS HAD SAME TYPE,                        S01117
     C**  USE THIS FOR 1ST PERIOD                                         S01117
     C           FXSAME    IFEQ 'Y'                                       S01117
     C                     MOVEAFXPER     XFDAA                           S01117
     C*******              Z-ADDFXLIM     DZFLAM                   S01117 S01433
     C****SPOT*LIMITS FOUND  - USE SPOT LIMITS FOR SPOT                   S01433
     C********** FXLMS     IFNE 0                                         S01433
     C**********           Z-ADDFXLMS     DZFLAM                          S01433
     C****SPOT LIMITS NOT FOUND  - USE FORWARD LIMITS FOR SPOT            S01433
     C*********            ELSE                                           S01433
     C*********            Z-ADDFXLMF     DZFLAM                          S01433
     C*********            END                                            S01433
     C                     Z-ADDFXLMF     DZFXFA                          S01433
     C                     MOVE FXPC      XFPCA                           S01117
     C*                                                                   S01117
     C********** DZFLAM    DIV  XFPC,1    DZFLAM    H                     S01117
     C           DZFXFA    DIV  XFPC,1    DZFXFA    H                     S01117
     C*                                                                   S01117
     C**********           EXSR #BFA                                      S01117
     C*                                                                   S01433
     C                     ELSE                                           S01117
     C**  ELSE SET UP SPOT PERIOD                                         S01117
     C**********           Z-ADD0         XFDA                            S01117
     C**********           Z-ADD0         XFDT                            S01117
     C**********           Z-ADDSP        XFDA,1                          S01117
     C********** SP        ADD  BJRDNB    XFDT,1                          S01117
     C**********           Z-ADD999       XFDA,2                          S01117
     C**********           Z-ADD99999     XFDT,2                          S01117
     C*******              Z-ADDFXLIM     XFLM,1                   S01117 S01433
     C**  SPOT LIMITS FOUND  - USE SPOT LIMITS FOR SPOT                   S01433
     C*********  FXLMS     IFNE 0                                         S01433
     C*********            Z-ADDFXLMS     XFLM,1                          S01433
     C**  SPOT LIMITS NOT FOUND  - USE FORWARD LIMITS FOR SPOT            S01433
     C*********            ELSE                                           S01433
     C                     Z-ADDFXLMF     XFLM,1                          S01433
     C*********            END                                            S01433
     C                     END                                            S01117
     C**********           ELSE                                           S01117
     C                     END                                            S01117
     C****IF*NOT FOUND                                                    S01117
     C****SPOT LIMITS ONLY FOUND  - SET UP SPOT DETAILS ONLY              S01433
     C********** FXLMS     IFNE 0                                         S01433
     C**********           Z-ADD0         XFDA                            S01433
     C**********           Z-ADD0         XFDT                            S01433
     C**********           Z-ADDSP        XFDA,1                          S01433
     C********** SP        ADD  BJRDNB    XFDT,1                          S01433
     C**********           Z-ADD999       XFDA,2                          S01433
     C**********           Z-ADD99999     XFDT,2                          S01433
     C**********           Z-ADDFXLMS     XFLM,1                          S01433
     C**********           ELSE                                           S01433
     C****NEITHER SPOT NOR FORWARD LIMITS FOUND                           S01433
     C**********           Z-ADD0         XFDA                            S01117
     C**********           Z-ADD0         XFDT                            S01117
     C**********           Z-ADD999       XFDA,1                          S01117
     C**********           Z-ADD99999     XFDT,1                          S01117
     C**********           END                                            S01433
     C*                                                                   S01433
     C           FXLMF     IFGT 0                                         S01433
     C           FXLMS     ORGT 0                                         S01433
     C           FXSAME    IFEQ 'Y'                                       S01433
     C                     EXSR #BFA                                      S01433
     C                     END                                            S01433
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C****IF*LN DEFAULT REQUIRED                                   S01117 S01433
     C**  IF MM DEFAULT REQUIRED                                          S01433
     C           LDEF      IFEQ 'Y'                                       S01117
     C****IF*LENDING LIMIT FOUND                                   S01117 S01433
     C**  IF MONEY MARKET LIMIT FOUND                                     S01433
     C           LNLIM     IFNE 0                                         S01117
     C**  IF ALL LOWER LEVEL LIMITS HAD SAME TYPE,                        S01117
     C**  USE THIS FOR 1ST PERIOD                                         S01117
     C           LNSAME    IFEQ 'Y'                                       S01117
     C                     MOVEALNPER     XLDAA                           S01117
     C*******              Z-ADDLNLIM     DZLLAM                   S01117 S01433
     C                     Z-ADDLNLIM     DZMMAM                          S01433
     C                     MOVE LNPC      XLPCA                           S01117
     C*                                                                   S01117
     C*******    DZLLAM    DIV  XLPC,1    DZLLAM    H              S01117 S01433
     C           DZMMAM    DIV  XLPC,1    DZMMAM    H                     S01433
     C*                                                                   S01117
     C                     EXSR #BFB                                      S01117
     C                     ELSE                                           S01117
     C**  ELSE SET UP OVERNIGHT PERIOD                                    S01117
     C                     Z-ADD0         XLDA                            S01117
     C                     Z-ADD0         XLDT                            S01117
     C                     Z-ADD1         XLDA,1                          S01117
     C           1         ADD  BJRDNB    XLDT,1                          S01117
     C                     Z-ADD999       XLDA,2                          S01117
     C                     Z-ADD99999     XLDT,2                          S01117
     C                     Z-ADDLNLIM     XLLM,1                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C** IF NOT FOUND                                                     S01117
     C                     Z-ADD0         XLDA                            S01117
     C                     Z-ADD0         XLDT                            S01117
     C                     Z-ADD999       XLDA,1                          S01117
     C                     Z-ADD99999     XLDT,1                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01433
     C** IF PM DEFAULT REQUIRED                                           S01433
     C           PDEF      IFEQ 'Y'                                       S01433
     C** IF PM SPOT LIMIT FOUND                                           S01433
     C           PMLMS     IFNE 0                                         S01433
     C*                                                                   S01433
     C           PMSAME    IFEQ 'Y'                                       S01433
     C                     Z-ADDSP        XPDA1                           S01433
     C                     Z-ADDPMLMS     DZPSAM                          S01433
     C                     MOVE PMPC      XPDCA                           S01433
     C           DZPSAM    DIV  XPDC,1    DZPSAM                          S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C                     Z-ADDSP        XPDA1                           S01433
     C           SP        ADD  BJRDNB    XPDT1                           S01433
     C                     Z-ADDPMLMS     XPLM1                           S01433
     C                     END                                            S01433
     C**********           MOVEL'SP'      PLEP1                           S01433
     C                     MOVEL'002'     PLEP1                           S01433
     C                     MOVEL'999'     PLEP2                           S01433
     C                     Z-ADDSP        XPDA,1                          S01433
     C                     Z-ADD999       XPDA,2                          S01433
     C           SP        ADD  BJRDNB    XPDT,1                          S01433
     C                     Z-ADD99999     XPDT,2                          S01433
     C                     ELSE                                           S01433
     C                     Z-ADD999       XPDA1                           S01433
     C                     Z-ADD99999     XPDT1                           S01433
     C                     Z-ADD999       XPDA,1                          S01433
     C                     Z-ADD99999     XPDT,1                          S01433
     C                     MOVEL'999'     PLEP1                           S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C** IF PM FORWARD LIMIT FOUND                                        S01433
     C           PMLMF     IFNE 0                                         S01433
     C**  IF ALL LOWER LEVEL LIMITS HAD SAME TYPE,                        S01433
     C**  USE THIS FOR 1ST PERIOD                                         S01433
     C           PMSAME    IFEQ 'Y'                                       S01433
     C**********           MOVEAPMPER     XFDAA                           S01433
     C                     MOVEAPMPER     XPDAA                           S01433
     C                     Z-ADDPMLMF     DZPFAM                          S01433
     C                     MOVE PMPC      XPDCA                           S01433
     C           DZPFAM    DIV  XPDC,1    DZPFAM    H                     S01433
     C*                                                                   S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C                     Z-ADDPMLMF     XPLM,1                          S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C           PMSAME    IFEQ 'Y'                                       S01433
     C           PMLMS     IFNE 0                                         S01433
     C           PMLMF     ORNE 0                                         S01433
     C                     EXSR #BFC                                      S01433
     C                     END                                            S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C**  SPOT LIMITS FOUND  - USE SPOT LIMITS FOR SPOT                   S01433
     C********** PMLMS     IFNE 0                                         S01433
     C**********           Z-ADDPMLMS     DZPSAM                          S01433
     C**  SPOT LIMITS NOT FOUND  - USE FORWARD LIMITS FOR SPOT            S01433
     C**********           ELSE                                           S01433
     C**********           Z-ADDPMLMF     DZPSAM                          S01433
     C**********           END                                            S01433
     C**********           Z-ADDPMLMF     DZPFAM                          S01433
     C**********           MOVE PMPC      XFPCA                           S01433
     C**********           MOVE PMPC      XPDCA                           S01433
     C**********                                                          S01433
     C********** DZPSAM    DIV  XFPC,1    DZPSAM    H                     S01433
     C********** DZPFAM    DIV  XPPC,1    DZPFAM    H                     S01433
     C**********                                                          S01433
     C**********           EXSR #BFC                                      S01433
     C**********           ELSE                                           S01433
     C**  ELSE SET UP SPOT PERIOD                                         S01433
     C**********           Z-ADD0         XFDA                            S01433
     C**********           Z-ADD0         XMDT                            S01433
     C**********           Z-ADDSP        XFDA,1                          S01433
     C********** SP        ADD  BJRDNB    XMDT,1                          S01433
     C**********           Z-ADD999       XFDA,2                          S01433
     C**********           Z-ADD99999     XMDT,2                          S01433
     C**********           Z-ADD0         XPDA                            S01433
     C**********           Z-ADD0         XPDT                            S01433
     C**********           Z-ADDSP        XPDA,1                          S01433
     C********** SP        ADD  BJRDNB    XPDT,1                          S01433
     C**********           Z-ADD999       XPDA,2                          S01433
     C**********           Z-ADD99999     XPDT,2                          S01433
     C**  SPOT LIMITS FOUND  - USE SPOT LIMITS FOR SPOT                   S01433
     C********** PMLMS     IFNE 0                                         S01433
     C**********           Z-ADDPMLMS     XMLM,1                          S01433
     C**********           Z-ADDPMLMS     XPLM,1                          S01433
     C**  SPOT LIMITS NOT FOUND  - USE FORWARD LIMITS FOR SPOT            S01433
     C**********           ELSE                                           S01433
     C**********           Z-ADDPMLMF     XMLM,1                          S01433
     C**********           Z-ADDPMLMF     XPLM,1                          S01433
     C**********           END                                            S01433
     C**********           END                                            S01433
     C**********           ELSE                                           S01433
     C**  IF NOT FOUND                                                    S01433
     C**  SPOT LIMITS ONLY FOUND  - SET UP SPOT DETAILS ONLY              S01433
     C********** PMLMS     IFNE 0                                         S01433
     C**********           Z-ADD0         XFDA                            S01433
     C**********           Z-ADD0         XMDT                            S01433
     C**********           Z-ADDSP        XFDA,1                          S01433
     C********** SP        ADD  BJRDNB    XMDT,1                          S01433
     C**********           Z-ADD999       XFDA,2                          S01433
     C**********           Z-ADD99999     XMDT,2                          S01433
     C**********           Z-ADDPMLMS     XMLM,1                          S01433
     C**********           Z-ADD0         XPDA                            S01433
     C**********           Z-ADD0         XPDT                            S01433
     C**********           Z-ADDSP        XPDA,1                          S01433
     C********** SP        ADD  BJRDNB    XPDT,1                          S01433
     C**********           Z-ADD999       XPDA,2                          S01433
     C**********           Z-ADD99999     XPDT,2                          S01433
     C**********           Z-ADDPMLMS     XPLM,1                          S01433
     C**********           ELSE                                           S01433
     C**  NEITHER SPOT NOR FORWARD LIMITS FOUND                           S01433
     C**********           Z-ADD0         XFDA                            S01433
     C**********           Z-ADD0         XMDT                            S01433
     C**********           Z-ADD999       XFDA,1                          S01433
     C**********           Z-ADD99999     XMDT,1                          S01433
     C**********           Z-ADD0         XPDA                            S01433
     C**********           Z-ADD0         XPDT                            S01433
     C**********           Z-ADD999       XPDA,1                          S01433
     C**********           Z-ADD99999     XPDT,1                          S01433
     C**********           END                                            S01433
     C**********           END                                            S01433
     C                     END                                            S01433
     C**                                                                  S01433
     C**********           END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01433
     C*
     C************         END                                            E226
      *
     C*****DLLOOP1 PROCESSES XFDAA - IF ANY ELEMENT IS BLANK OR 999       S01117
     C*****THE CORRESPONDING ELEMENTS IN XFDA & XFDT ARE SET TO NINES.    S01117
     C*****ELSE,XFDT IS CALCULATED BY ADDING RUND TO XFDA,                S01117
     C*****     XFLM,IS CALCULATED BY MULTIPLYING LIMIT AMOUNT BY XFPC    S01117
     C*****                Z-ADD0         D       20                      S01117
     C*****                                                               S01117
     C*****      D         DOWLE5                                  S01136 S01117
     C***********D         DOWLE6                                  S01136 S01117
     C*****                                                               S01117
     C*****      D         ADD  1         D                               S01117
     C*****                                                               S01117
     C*****      XFDAA,D   IFEQ '   '                                     S01117
     C*****                Z-ADD999       XFDA,D                          S01117
     C*****                Z-ADD99999     XFDT,D                          S01117
     C*****                Z-ADD6         D                        S01136 S01117
     C*********************Z-ADD7         D                        S01136 S01117
     C*****                ELSE                                           S01117
     C***********FLAM      MULT XFPC,D    XFLM,D                   E16000 S01117
     C*****      FLAM      MULT XFPC,D    XFLM,D    H              E16000 S01117
     C*****      XFDA,D    ADD  RUND      XFDT,D                          S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****      XFDAA,D   IFEQ '999'                                     S01117
     C*****                Z-ADD99999     XFDT,D                          S01117
     C*****                Z-ADD6         D                        S01136 S01117
     C*********************Z-ADD7         D                        S01136 S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****                                                               S01117
     C*****      XFDAA,1   IFEQ 'SP '                                     S01117
     C*****                Z-ADDSP        XFDA,1                          S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****      #BF8      TAG                                         ** S01117
     C*****                                                               S01117
     C*****PROCESS LENDING LIMITS.                                        S01117
     C*****-  CHECK IF LIMIT HAS EXPIRED                                  S01117
     C*****      LLED      IFLE RUND                                      S01117
     C*****      LLED      ANDNE0                                  S01157 S01117
     C*****                                                               S01117
     C*****- IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES        S01117
     C*****  & ZEROISE AMOUNT                                             S01117
     C*****                Z-ADD999       XLDA,1                          S01117
     C*****                Z-ADD99999     XLDT,1                          S01117
     C*****                Z-ADD0         XLLM,1                          S01117
     C*****                GOTO #BF9                                      S01117
     C*****                END                                            S01117
     C*****                                                        S01136 S01117
     C** BLANK data structure                                      S01136 S01117
     C*****                MOVE *BLANKS   LEPSIN                   S01136 S01117
     C*****                MOVE *BLANKS   LPCSIN                   S01136 S01117
     C*****                                                               S01117
     C*****                                                               S01117
     C*****- NOT EXPIRED - CHAIN TO LIMITS REC. ON S/TABLE.               S01117
     C*****- FIX TO CHAIN S/TABLE ONLY IF AN MM LIMIT HAS BEEN SET S01136 S01117
     C*****  THUS AVOID A DATABASE ERROR                           S01136 S01117
     C*****      LLAM      IFGT 0                                  S01136 S01117
     C*****                MOVEL'45'      KEYTAB                          S01117
     C*****                MOVE LLTY      KEYTAB                          S01117
     C*****                EXSR TABCHN                                    S01117
     C*****                                                               S01117
     C*****      *INU7     CABEQ'1'       #BF9                            S01117
     C*****                                                               S01117
     C*****                END                                     S01136 S01117
     C*****                                                               S01117
     C*****MOVE DATA FROM INPUT FIELDS TO LENDING ARRAYS                  S01117
     C*****                MOVE LEPSIN    XLDAIN                          S01117
     C*****                MOVE LPCSIN    XLPCIN                          S01117
     C*****                                                               S01117
     C*****                Z-ADD0         D       20                      S01117
     C*****                                                               S01117
     C*****COND LOOP AS ABOVE                                             S01117
     C*****      D         DOWLE5                                  S01136 S01117
     C***********D         DOWLE6                                  S01136 S01117
     C*****                                                               S01117
     C*****      D         ADD  1         D                               S01117
     C*****                                                               S01117
     C*****      XLDAA,D   IFEQ '   '                                     S01117
     C*****                Z-ADD999       XLDA,D                          S01117
     C*****                Z-ADD99999     XLDT,D                          S01117
     C*****                Z-ADD6         D                               S01117
     C*****                ELSE                                           S01117
     C***********LLAM      MULT XLPC,D    XLLM,D                   E16000 S01117
     C*****      LLAM      MULT XLPC,D    XLLM,D    H              E16000 S01117
     C*****      XLDA,D    ADD  RUND      XLDT,D                          S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****      XLDAA,D   IFEQ '999'                                     S01117
     C*****                Z-ADD99999     XLDT,D                          S01117
     C*****                Z-ADD6         D                        S01136 S01117
     C*********************Z-ADD7         D                        S01136 S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****      XLDAA,1   IFEQ 'SP '                                     S01117
     C*****                Z-ADDSP        XLDA,1                          S01117
     C*****                Z-ADD6         D                         S01136S01117
     C*********************Z-ADD7         D                         S01136S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C*****                END                                            S01117
     C*****                                                               S01117
     C           #BF9      ENDSR                                       ** S01117
     C*****************************************************************   S01117
     C/EJECT                                                              S01117
     C*****************************************************************   S01117
     C*                                                               *   S01117
     C**  #BFA -   SET  UP LIMIT ARRAYS FOR FX                        *   S01117
     C*                                                               *   S01117
     C* CALLS             -                                           *   S01117
     C*                                                               *   S01117
     C* CALLED BY  #BF    - SET UP OF ARRAY LIMIT PERIODS             *   S01117
     C*                                                               *   S01117
     C**  INPUT - XFDAA - PERIOD ARRAY                                *   S01117
     C**          XFPC - PERCENTAGE ARRAY                             *   S01117
     C**          FLAM - LIMIT AMOUNT                                 *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C**   IF ANY ELEMENT IS BLANK OR 999                                 S01117
     C**   THE CORRESPONDING ELEMENTS IN XFDA & XFDT ARE SET TO NINES.    S01117
     C**   ELSE,XFDT IS CALCULATED BY ADDING RUND TO XFDA,                S01117
     C**        XFLM,IS CALCULATED BY MULTIPLYING LIMIT AMOUNT BY XFPC    S01117
     C           #BFA      BEGSR                                          S01117
     C*                                                                   E24302
     C**   SET UP XFDA IF 'SP' LIMIT                                      E24302
     C*                                                                   E24302
     C           XFDAA,1   IFEQ 'SP '                                     S01433
     C                     Z-ADDSP        XFDA,1                          S01433
     C                     Z-ADDSP        XFDA1                           S01433
     C           SP        ADD  BJRDNB    XFDT,1                          S01433
     C           SP        ADD  BJRDNB    XFDT1                           S01433
     C                     MOVE 'Y'       SPSAV   1                       S01433
     C                     END                                            S01433
     C*                                                                   E24302
     C                     Z-ADD0         D       20                      S01117
     C*                                                                   S01117
     C           D         DOWLE5                                      *  S01117
     C*                                                                   S01117
     C           D         ADD  1         D                               S01117
     C*                                                                   S01117
     C********** XFDAA,D   IFEQ '   '                               S01117E309
     C           XFDAA,D   IFEQ '000'                                     E309
     C           XFDA,D    OREQ 0                                        E00044A
     C                     Z-ADD999       XFDA,D                          S01117
     C                     Z-ADD99999     XFDT,D                          S01117
     C                     Z-ADD6         D                               S01117
     C                     ELSE                                           S01117
     C*******    DZFLAM    MULT XFPC,D    XFLM,D    H              S01117 S01433
     C           DZFXFA    MULT XFPC,D    XFLM,D    H                     S01433
     C           SPSAV     IFEQ 'Y'                                       E24302
     C           SPLCHK    OREQ 'Y'                                                           240878
     C           DZFLAM    MULT XFPC,1    XFLM1   90H                     S01433
     C                     END                                            S01433
     C           XFDA,D    ADD  BJRDNB    XFDT,D                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           XFDAA,D   IFEQ '999'                                     S01117
     C                     Z-ADD99999     XFDT,D                          S01117
     C                     Z-ADD6         D                               S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**                                                                  S01117
     C***********XFDAA,1   IFEQ 'SP '                                     E24302
     C***********          Z-ADDSP        XFDA,1                          E24302
     C***********          END                                            E24302
     C*                                                                   S01117
     C                     END                                            S01117
     C                     MOVE 'N'       SPSAV                           S01433
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
     C/EJECT                                                              S01117
     C*****************************************************************   S01117
     C**  #BFB -   SET  UP LIMIT ARRAYS FOR LN                        *   S01117
     C*                                                               *   S01117
     C* CALLS             -                                           *   S01117
     C*                                                               *   S01117
     C* CALLED BY  #BF    - SET UP OF ARRAY LIMIT PERIODS             *   S01117
     C*                                                               *   S01117
     C**  INPUT - XLDAA - PERIOD ARRAY                                *   S01117
     C**          XLPC - PERCENTAGE ARRAY                             *   S01117
     C**          LLAM - LIMIT AMOUNT                                 *   S01117
     C*****************************************************************   S01117
     C**   IF ANY ELEMENT IS BLANK OR 999                                 S01117
     C**   THE CORRESPONDING ELEMENTS IN XLDA & XLDT ARE SET TO NINES.    S01117
     C**   ELSE,XLDT IS CALCULATED BY ADDING RUND TO XLDA,                S01117
     C**        XLLM,IS CALCULATED BY MULTIPLYING LIMIT AMOUNT BY XLPC    S01117
     C           #BFB      BEGSR                           **  #BFB  **   S01117
     C/COPY WNCPYSRC,DL0130AC19
     C*                                                                   S01117
      *                                                                   E24302
      **   SET UP XLDA IF 'SP' LIMIT                                      E24302
      *                                                                   E24302
     C           XLDAA,1   IFEQ 'SP '                                     E24302
     C                     Z-ADDSP        XLDA,1                          E24302
     C                     END                                            E24302
      *                                                                   E24302
     C                     Z-ADD0         D       20                      S01117
     C*                                                                   S01117
     C** SECOND LOOP AS ABOVE                                             S01117
     C           D         DOWLE5                                      *  S01117
     C*                                                                   S01117
     C           D         ADD  1         D                               S01117
     C*                                                                   S01117
     C           XLDAA,D   IFEQ '   '                                     S01117
     C           XLDA,D    OREQ 0                                        E00044A
     C                     Z-ADD999       XLDA,D                          S01117
     C                     Z-ADD99999     XLDT,D                          S01117
     C                     Z-ADD6         D                               S01117
     C                     ELSE                                           S01117
     C*******    DZLLAM    MULT XLPC,D    XLLM,D    H              S01117 S01433
     C           DZMMAM    MULT XLPC,D    XLLM,D    H                     S01433
     C           XLDA,D    ADD  BJRDNB    XLDT,D                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           XLDAA,D   IFEQ '999'                                     S01117
     C                     Z-ADD99999     XLDT,D                          S01117
     C                     Z-ADD6         D                               S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********XLDAA,1   IFEQ 'SP '                               S01117E24302
     C***********          Z-ADDSP        XLDA,1                    S01117E24302
     C***********          Z-ADD6         D                         S01117E20637
     C***********          END                                      S01117E24302
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,DL0130AC20
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
     C/EJECT                                                              S01117
     C*****************************************************************   S01433
     C*                                                               *   S01433
     C**  #BFC -   SET  UP LIMIT ARRAYS FOR PRECIOUS METAL            *   S01433
     C*                                                               *   S01433
     C* CALLS             -                                           *   S01433
     C*                                                               *   S01433
     C* CALLED BY  #BF    - SET UP OF ARRAY LIMIT PERIODS             *   S01433
     C*                                                               *   S01433
     C**  INPUT - XPDAA - PERIOD ARRAY                                *   S01433
     C**          XPPC - PERCENTAGE ARRAY                             *   S01433
     C**          DZPFAM - LIMIT AMOUNT                               *   S01433
     C*****************************************************************   S01433
     C*                                                                   S01433
     C**   IF ANY ELEMENT IS BLANK OR 999                                 S01433
     C**   THE CORRESPONDING ELEMENTS IN XPDA & XPDT ARE SET TO NINES.    S01433
     C**   ELSE,XPDT IS CALCULATED BY ADDING RUND TO XPDA,                S01433
     C**        XPLM,IS CALCULATED BY MULTIPLYING LIMIT AMOUNT BY XPPC    S01433
     C           #BFC      BEGSR                                          S01433
     C*                                                                   S01433
     C**   ALL CODE IN THIS SUBROUTINE CHINED FROM USING XF AND XM        S01433
     C**   TO XP FIELDS FOR CHANGE S01433                                 S01433
     C**                                                                  S01433
     C**   SET UP XPDA IF 'SP' LIMIT                                      S01433
     C*                                                                   S01433
     C*                                                                   S01433
     C           XPDAA,1   IFEQ 'SP '                                     S01433
     C                     Z-ADDSP        XPDA,1                          S01433
     C                     Z-ADDSP        XPDA1                           S01433
     C           SP        ADD  BJRDNB    XPDT,1                          S01433
     C           SP        ADD  BJRDNB    XPDT1                           S01433
     C                     MOVE 'Y'       SPSAV                           S01433
     C                     END                                            S01433
     C                     Z-ADD0         D       20                      S01433
     C*                                                                   S01433
     C           D         DOWLE5                                      *  S01433
     C*                                                                   S01433
     C           D         ADD  1         D                               S01433
     C*                                                                   S01433
     C********** XPDAA,D   IFEQ '   '                                     S01433
     C           XPDAA,D   IFEQ '000'                                     S01433
     C           XPDA,D    OREQ 0                                         S01433
     C                     Z-ADD999       XPDA,D                          S01433
     C                     Z-ADD99999     XPDT,D                          S01433
     C                     Z-ADD6         D                               S01433
     C                     ELSE                                           S01433
     C           DZPFAM    MULT XPDC,D    XPLM,D    H                     S01433
     C           SPSAV     IFEQ 'Y'                                       S01433
     C           SPLCHK    OREQ 'Y'                                                           240878
     C           DZPSAM    MULT XPDC,1    XPLM1   90H                     S01433
     C                     END                                            S01433
     C           XPDA,D    ADD  BJRDNB    XPDT,D                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           XPDAA,D   IFEQ '999'                                     S01433
     C                     Z-ADD99999     XPDT,D                          S01433
     C                     Z-ADD6         D                               S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C                     MOVE 'N'       SPSAV                           S01433
     C*                                                                   S01433
     C                     ENDSR                                          S01433
     C*****************************************************************   S01433
     C/EJECT                                                              S01433
     C*****************************************************************   S01117
     C*                                                               *
     C* #BG      - INITIALIZATION OF THE DISPLAY FIELDS               *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BG       BEGSR                                       *
     C*
     C                     MOVE *BLANKS   DDCRNM
     C                     MOVE *BLANKS   DDCSNM
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDCPAR
     C                     MOVE *BLANKS   DDCTWN
     C                     MOVE *BLANKS   SFS7
     C*
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C                     MOVE '0'       *IN40
     C                     MOVE '1'       *IN41
     C                     MOVE '0'       *IN48
     C                     MOVE '0'       *IN49
     C                     MOVE '0'       *IN50                           S01433
     C                     MOVE '0'       *IN51                           S01433
     C                     MOVE '0'       *IN52
     C                     MOVE '0'       *IN53
     C                     MOVE '0'       *IN54
     C                     MOVE '0'       *IN55
     C                     MOVE '0'       *IN50                           S01433
     C*
     C           #BG9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BH      - SET UP OF THE DISPLAY FIELDS                       *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BH       BEGSR                                       *
     C*
     C*****                MOVE CRNM      DDCRNM                          S01194
     C                     MOVE BBCRNM    DDCRNM                          S01194
     C*****                MOVE CSNM      DDCSNM                          S01194
     C                     MOVE BBCSSN    DDCSNM                          S01194
     C*****                MOVE CNUM      DDCNUM                          S01194
     C                     MOVE BBCUST    DDCNUM                          S01194
     C*****                MOVE CTWN      DDCTWN                          S01194
     C                     MOVE BBCRTN    DDCTWN                          S01194
     C*****                MOVE BCYL      DDBCYL                          S01194
     C                     MOVE BNCYCD    DDBCYL                          S01194
     C*
     C           *IN54     IFNE '1'
     C*****                MOVE CPAR      DDCPAR                          S01194
     C                     MOVE BBPCNB    DDCPAR                          S01194
     C                     END
     C*
     C           #BH9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BI      - OUTPUT TO THE SCREEN                               *
     C*                                                               *
     C* CALLS    ZA1020   - CONVERT AMOUNT TO DISPLAY                 *
     C*                                                               *
     C* CALLED BY  #BA    - PROCESSING FOR MIDAS ONLY                 *
     C*            #BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *
     C*            #BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *
     C*                                                               *
     C* FLDS USED  @CNT   - SUBFILE COUNT                             *
     C*            @CNU   - LOANS ARRAYS COUNT                        *
     C*            @@IAMT - INPUT AMOUNT TO SR.ZA1020                 *
     C*            @@CDP  - CURRENCY DECIMAL PLACES IN SR.ZA1020      *
     C*            @@CRET - NUMBER OF CHARACTERS TO RETURN            *
     C*            @@ADSP - AMOUNT TO DISPLAY                         *
     C*                                                               *
     C*****************************************************************
     C           #BI       BEGSR                                       *
     C*
     C** SET UP THE FIELDS IN THE DATASTRUCTURES
     C                     Z-ADD1         @CNT    30
     C                     Z-ADD1         @CNU    30
     C*
     C           *IN39     IFEQ '0'                        B1
     C*
     C** OUTPUT THE DETAILS
     C*****      @CNT      DO   13                         B*2            S01157
     C           @CNT      DO   16                         B*2            S01157
     C*
     C*RESET DISPLAY FIELDS SFEXPY,SFLIMIT                                S01157
     C*                                                                   S01157
     C                     MOVE *BLANK    SFEXPY           **2            S01157
     C                     MOVE *BLANK    SFLIMT           **2            S01157
     C                     MOVE *BLANKS   SFS7             **2           E00044A
     C                     MOVE *BLANKS   SF4              **2           E00044A
     C*
     C****       @CNT      IFEQ 7                          B**3           S01157
     C*******    @CNT      IFEQ 13                         B**3    S01157 S01433
     C*******    @CNT      OREQ 15                         ***3    S01157 S01433
     C/COPY WNCPYSRC,DL0130AC21
     C           @CNT      IFEQ 1                          B**3           S01433
     C           @CNT      OREQ 2                          ***3           S01433
     C/COPY WNCPYSRC,DL0130AC22
     C           @CNT      OREQ 9                          ***3           S01433
     C           @CNT      OREQ 11                         ***3           S01433
     C           @CNT      OREQ 13                         ***3           S01433
     C           @CNT      OREQ 14                         ***3           S01433
     C           @CNT      OREQ 17                         ***3           S01433
     C                     MOVE '1'       *IN43            ***3
     C                     ELSE                            X**3
     C*
     C*******    @CNT      IFLE 6                          B***4          S01433
     C*
     C** FORMAT THE FIELDS FOR OUTPUT
     C*******              Z-ADDXFLM,@CNT @@IAMT           ****4          S01433
     C*******              Z-ADD0         @@CDP            ****4          S01433
     C*******              Z-ADD11        @@CRET           ****4          S01433
     C*******              EXSR ZA1020                     ****4          S01433
     C*******              MOVE @@ADSP    SF1              ****4          S01433
     C*
     C*******              Z-ADDXFXP,@CNT @@IAMT           ****4          S01433
     C*******              Z-ADD0         @@CDP            ****4          S01433
     C*******              Z-ADD14        @@CRET           ****4          S01433
     C*******              EXSR ZA1020                     ****4          S01433
     C*******              MOVE @@ADSP    SF2              ****4          S01433
     C*
     C*******              Z-ADDXFXS,@CNT @@IAMT           ****4          S01433
     C*******              Z-ADD0         @@CDP            ****4          S01433
     C*******              Z-ADD14        @@CRET           ****4          S01433
     C*******              EXSR ZA1020                     ****4          S01433
     C*******              MOVE @@ADSP    SF3              ****4          S01433
     C*******              MOVE @@ADSP    EXES             ****4   E20637 S01433
     C*******    XFXS,@CNT COMP 0                    11    ****4   E20637 S01433
     C*
     C*******************  MOVE XFNM,@CNT SFEXPY           ****4          S01157
     C*******              MOVELXFNM,@CNT SFEXPY           ****4   S01157 S01433
     C*********************MOVE XFEX,@CNT SFLIMT           ****4          S01157
     C*******              MOVELXFEX,@CNT SFLIMT           ****4   S01157 S01433
     C*******              MOVE XFS,@CNT  SFS              ****4          S01433
     C*******              MOVE XFHY,@CNT SFHY             ****4          S01433
     C*******              MOVE XFDAA,@CNTSFDAA            ****4          S01433
     C*******              END                             E***4          S01433
     C*
     C**         @CNT      IFGT 7                          B***4          S01157
     C*******    @CNT      IFGT 6                          B***4   S01157 S01433
     C*******    @CNT      ANDLT13                         ****4   S01157 S01433
     C*                                                                   S01433
     C/COPY WNCPYSRC,DL0130AC23
     C           @CNT      IFGT 2                          B***4          S01433
     C           @CNT      ANDLT9                          ****4          S01433
     C*
     C                     Z-ADDXLLM,@CNU @@IAMT           ****4
     C                     Z-ADD0         @@CDP            ****4
     C                     Z-ADD11        @@CRET           ****4
     C                     EXSR ZA1020                     ****4
     C                     MOVE @@ADSP    SF1              ****4
     C*
     C                     Z-ADDXLXP,@CNU @@IAMT           ****4
     C                     Z-ADD0         @@CDP            ****4
     C                     Z-ADD14        @@CRET           ****4
     C                     EXSR ZA1020                     ****4
     C                     MOVE @@ADSP    SF2              ****4
     C*
     C                     Z-ADDXLXS,@CNU @@IAMT           ****4
     C                     Z-ADD0         @@CDP            ****4
     C                     Z-ADD14        @@CRET           ****4
     C                     EXSR ZA1020                     ****4
     C                     MOVE @@ADSP    SF3              ****4
     C                     MOVE @@ADSP    EXES             ****4          E20637
     C           XLXS,@CNU COMP 0                    11    ****4          E20637
     C*
     C                     MOVELXLNM,@CNU SFEXPY           ****4          S01157
     C***********          MOVE XLNM,@CNU SFEXPY           ****4          S01157
     C*********************MOVE XLEX,@CNU SFLIMT           ****4          S01157
     C                     MOVELXLEX,@CNU SFLIMT           ****4          S01157
     C                     MOVE XLS,@CNU  SFS              ****4
     C                     MOVE XLHY,@CNU SFHY             ****4
     C                     MOVE XLDAA,@CNUSFDAA            ****4
     C                     ADD  1         @CNU             ****4
     C                     END                             E***4
     C*                                                                   S01157
     C* SETUP FRA FIGURES                                                 S01157
     C*                                                                   S01157
     C*******    @CNT      IFEQ 14                         B***4  S01157  S01433
     C           @CNT      IFEQ 10                         B***4          S01433
     C*****      IRFRA     ANDEQ'Y'                        ****4  S01157  S01194
     C           BGFIIN    ANDEQ'Y'                        ****4          S01194
     C*                                                                   S01157
     C* DISPLAY FIELDS                                                    S01157
     C*                                                                   S01157
     C                     MOVE *BLANK    EXES             ****4          E20637
     C                     MOVE *BLANK    SF4              ****4          S01157
     C                     MOVE *BLANK    SFS7             ****4          S01157
     C                     MOVEL'FRA'     SFLIMT           ****4          S01157
     C*                                                                   S01157
     C                     DIV  1000      @FREA     H      ****4          S01157
     C*                                                                   S01157
     C**IF*LIMITS*HAVE*NOT*BEEN*SET*FOR*FRA*OR*RECORD*IS*NOT*LIVE*  S01157LN0793
     C* IF LIMITS HAVE NOT BEEN SET FOR FRA                               LN0793
     C*                                                                   S01157
     C*****      FRAM      IFEQ 0                          B****5  S01157 S01194
     C           DZFRLA    IFEQ 0                          B****5  S01157 S01194
     C*****      FRED      ANDEQ0                          *****5  S01157 S01194
     C           DZFRED    ANDEQ0                          *****5         S01194
     C***********RECI      ORNE 'D'                        *****5   S01157LN0527
     C************IN51     OREQ '1'                        *****5   S01157LN0527
     C************IN19     OREQ '1'                        *****5   LN0527LN0793
     C* IF NOT MULTI-BRANCHED DISPLAY NO LIMIT MESSAGE
      *
     C           @MBIN     IFEQ 'N'                        B*****6        S01117
     C*********************MOVE 'NO LIMIT'SFEXPY           ******6  S01157LN0527
     C                     MOVEL'NO LIMIT'SFEXPY           ******6        LN0527
     C                     Z-ADD0         DZFRLA           ******6        S01117
     C                     ELSE                            X*****6        S01117
     C* IF BLANK,DISPLAY 'B' AS DEFAULT FOR BOOKING/ORIGINATING BRANCH?   E00039
     C           BKOR      IFEQ ' '                                       E00039
     C                     MOVE 'B'       BKOR                            E00039
     C                     END                                            E00039
     C*IF BRANCH LEVEL:                                                   S01117
     C           LEVEL     IFEQ 'B'                                       S01117
     C*********************MOVE 'NO LIMIT'SFEXPY           *****5   S01157LN0527
     C                     MOVEL'NO LIMIT'SFEXPY           *****5         LN0527
     C*                                                                   S01157
     C*****                Z-ADD0         FRAM             *****5  S01157 S01194
     C                     Z-ADD0         DZFRLA           *****5         S01194
     C*                                                                   S01157
     C                     ELSE                            X*****6        S01117
     C* IF CO OR SYSTEM LEVEL:                                            S01117
     C                     Z-ADDFRLIM     DZFRLA           ******6        S01117
     C*********************MOVE 'DEFAULT 'SFEXPY           ******6  S01117LN0527
     C                     MOVEL'DEFAULT 'SFEXPY           ******6        LN0527
     C                     END                             E*****6        S01117
     C                     END                                            S01117
     C*                                                                   S01157
     C                     ELSE                            X****5         S01157
     C*                                                                   S01157
     C* IF EXPIRY DATE GT RUND FORMAT DATE                                S01157
     C*                                                                   S01157
     C*****      FRED      IFGT RUND                       B****6  S01157 S01194
     C           DZFRED    IFGT BJRDNB                     B****6         S01194
     C*****                Z-ADDFRED      ZDAYNO           *****6  S01157 S01194
     C                     Z-ADDDZFRED    ZDAYNO           *****6         S01194
     C                     EXSR ZDATE2                     *****6         S01157
     C                     MOVELZADATE    SFEXPY           *****6         S01157
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C* IF EXPIRY DATE LE RUND SET MSG EXPIRED                            S01157
     C*                                                                   S01157
     C*****      FRED      IFLE RUND                       B****6 S01157  S01194
     C           DZFRED    IFLE BJRDNB                     B****6         S01194
     C*****      FRED      ANDNE0                          *****6 S01157  S01194
     C           DZFRED    ANDNE0                          *****6         S01194
     C                     MOVEL'EXPIRED' SFEXPY           *****6         S01157
     C                     Z-ADD0         DZFRLA           *****6         S01157
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C* IF EXPIRY DATE 0 ;SET MSG NO EXPIRY                               S01157
     C*                                                                   S01157
     C*****      FRED      IFEQ 0                          B****6  S01157 S01194
     C           DZFRED    IFEQ 0                          B****6         S01194
     C                     MOVEL'NO'      SFEXPY           *****6         S01157
     C                     MOVE 'EXPIRY'  SFEXPY           *****6         S01157
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C                     END                             E****5         S01157
     C*                                                                   S01157
     C* FORMAT AMOUNTS                                                    S01157
     C*                                                                   S01157
     C*****                Z-ADDFRAM      @@IAMT           ****4   S01157 S01194
     C                     Z-ADDDZFRLA    @@IAMT           ****4          S01194
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD11        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF1              ****4          S01157
     C*                                                                   S01157
     C                     Z-ADD@FREA     @@IAMT           ****4          S01157
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD14        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF2              ****4          S01157
     C*                                                                   S01157
     C* CALC FRA EXCESS                                                   S01157
     C*                                                                   S01157
     C*****      @FREA     SUB  FRAM      @FRXS   90       ****4   S01157 S01194
     C           @FREA     SUB  DZFRLA    @FRXS   90       ****4          S01194
     C*                                                                   S01157
     C           @FRXS     IFLT 0                          B****5         S01157
     C                     Z-ADD0         @FRXS            *****5         S01157
     C                     END                             E****5         S01157
     C*                                                                   S01157
     C                     Z-ADD@FRXS     @@IAMT           ****4          S01157
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD14        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF3              ****4          S01157
     C                     MOVE @@ADSP    EXES             ****4          E20637
     C           @FRXS     COMP 0                    11    ****4          E20637
     C*                                                                   S01157
     C                     END                             E***4          S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C* CHECK FOR BGFIIN =/= 'Y'                                          E20545
     C*                                                                   E20545
     C*******    @CNT      IFEQ 14                                 E20545 S01433
     C           @CNT      IFEQ 10                         B***4          S01433
     C           BGFIIN    ANDNE'Y'                                       E20545
     C                     MOVE '1'       *IN43                           E20545
     C                     END                                            E20545
     C*                                                                   S01157
     C* SETUP IRS FIGURES                                                 S01157
     C*                                                                   S01157
     C*******    @CNT      IFEQ 16                         B***4   S01157 S01433
     C           @CNT      IFEQ 12                         B***4          S01433
     C*****      IRFRA     ANDEQ'Y'                        ****4   S01157 S01194
     C           BGFIIN    ANDEQ'Y'                        ****4          S01194
     C*                                                                   S01157
     C* DISPLAY FIELDS                                                    S01157
     C*                                                                   S01157
     C                     MOVE *BLANK    EXES             ****4          E20637
     C                     MOVE *BLANK    SF4              ****4          S01157
     C                     MOVE *BLANK    SFS7             ****4          S01157
     C                     MOVEL'IRS'     SFLIMT           ****4          S01157
     C*                                                                   S01157
     C                     DIV  1000      @IREA     H      ****4          S01157
     C*                                                                   S01157
     C**IF*LIMITS*HAVE*NOT*BEEN*SET*FOR*IRS*OR*RECORD*IS*NOT*LIVE*  S01157LN0793
     C* IF LIMITS HAVE NOT BEEN SET FOR IRS                               LN0793
     C*                                                                   S01157
     C*****      IRAM      IFEQ 0                          B****5 S01157  S01194
     C           DZIRLM    IFEQ 0                          B****5         S01194
     C*****      IRED      ANDEQ0                          *****5  S01157 S01194
     C           DZIRED    ANDEQ0                          *****5         S01194
     C***********RECI      ORNE 'D'                        *****5   S01157LN0793
     C************IN51     OREQ '1'                        *****5   S01157LN0793
     C* IF NOT MULTI-BRANCHED DISPLAY NO LIMIT MESSAGE
      *
     C           @MBIN     IFEQ 'N'                                       S01117
     C*********************MOVE 'NO LIMIT'SFEXPY                    S01117LN0527
     C                     MOVEL'NO LIMIT'SFEXPY                          LN0527
     C                     Z-ADD0         DZIRLM                          S01117
     C                     ELSE                                           S01117
     C*IF BRANCH LEVEL:
     C           LEVEL     IFEQ 'B'                                       S01117
     C*********************MOVE 'NO LIMIT'SFEXPY           ******6  S01157LN0527
     C                     MOVEL'NO LIMIT'SFEXPY           ******6        LN0527
     C*                                                                   S01157
     C******               Z-ADD0         IRAM             ******6 S01157 S01194
     C                     Z-ADD0         DZIRLM           ******6        S01194
     C                     ELSE                            X*****6
     C* IF CO OR SYSTEM LEVEL:
     C                     Z-ADDIRLIM     DZIRLM           ******6        S01194
     C*********************MOVE 'DEFAULT 'SFEXPY           ******6  S01117LN0527
     C                     MOVEL'DEFAULT 'SFEXPY           ******6        LN0521
     C                     END                             E*****6        S01117
     C                     END                                            S01117
     C*                                                                   S01157
     C                     ELSE                            X****5         S01157
     C*                                                                   S01157
     C* IF EXPIRY DATE GT RUND                                            S01157
     C*                                                                   S01157
     C*****      IRED      IFGT RUND                       B****6  S01157 S01194
     C           DZIRED    IFGT BJRDNB                     B****6         S01194
     C*****                Z-ADDIRED      ZDAYNO           *****6  S01157 S01194
     C                     Z-ADDDZIRED    ZDAYNO           *****6         S01194
     C                     EXSR ZDATE2                     *****6         S01157
     C                     MOVELZADATE    SFEXPY           *****6         S01157
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C* IF LIMIT HAS EXPIRED SETUP EXPIRED MSG                            S01157
     C*                                                                   S01157
     C*****      IRED      IFLE RUND                       B****6  S01157 S01194
     C           DZIRED    IFLE BJRDNB                     B****6         S01194
     C*****      IRED      ANDNE0                          *****6  S01157 S01194
     C           DZIRED    ANDNE0                          *****6         S01194
     C                     MOVEL'EXPIRED 'SFEXPY           *****6         S01157
     C*****                Z-ADD0         IRAM             *****6  S01157 S01194
     C                     Z-ADD0         DZIRLM           *****6         S01194
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C* IF EXPIRY DATE 0 ;SET MSG NO EXPIRY                               S01157
     C*                                                                   S01157
     C******     IRED      IFEQ 0                          B****6  S01157 S01194
     C           DZIRED    IFEQ 0                          B****6         S01194
     C                     MOVEL'NO'      SFEXPY           *****6         S01157
     C                     MOVE 'EXPIRY'  SFEXPY           *****6         S01157
     C                     END                             E****6         S01157
     C*                                                                   S01157
     C                     END                             E****5         S01157
     C*                                                                   S01157
     C* FORMAT AMOUNTS                                                    S01157
     C*                                                                   S01157
     C******               Z-ADDIRAM      @@IAMT           ****4   S01157 S01194
     C                     Z-ADDDZIRLM    @@IAMT           ****4          S01194
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD11        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF1              ****4          S01157
     C*                                                                   S01157
     C                     Z-ADD@IREA     @@IAMT           ****4          S01157
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD14        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF2              ****4          S01157
     C*                                                                   S01157
     C* CALC IRS EXCESS                                                   S01157
     C*                                                                   S01157
     C*****      @IREA     SUB  IRAM      @IRXS   90       ****4   S01157 S01194
     C           @IREA     SUB  DZIRLM    @IRXS   90       ****4          S01194
     C*                                                                   S01157
     C           @IRXS     IFLT 0                          B****5         S01157
     C                     Z-ADD0         @IRXS            *****5         S01157
     C                     END                             E****5         S01157
     C*                                                                   S01157
     C                     Z-ADD@IRXS     @@IAMT           ****4          S01157
     C                     Z-ADD0         @@CDP            ****4          S01157
     C                     Z-ADD14        @@CRET           ****4          S01157
     C                     EXSR ZA1020                     ****4          S01157
     C                     MOVE @@ADSP    SF3              ****4          S01157
     C                     MOVE @@ADSP    EXES             ****4          E20637
     C           @IRXS     COMP 0                    11    ****4          E20637
     C*                                                                   S01157
     C                     END                             E***4          S01157
     C*                                                                   S01157
     C*                                                                   E20545
     C* CHECK FOR BGFIIN =/= 'Y'                                          E20545
     C*                                                                   E20545
     C*******    @CNT      IFEQ 16                                 E20545 S01433
     C           @CNT      IFEQ 12                         B***4          S01433
     C           BGFIIN    ANDNE'Y'                                       E20545
     C                     MOVE '1'       *IN43                           E20545
     C                     END                                            E20545
     C*
     C           @CNT      IFEQ 15                         B***4          S01433
     C*                                                                   S01433
     C* DISPLAY FIELDS                                                    S01433
     C                     MOVE *BLANK    EXES             ****4          S01433
     C                     MOVE *BLANK    SF4              ****4          S01433
     C                     MOVE *BLANK    SFS7             ****4          S01433
     C                     MOVEL'FX LINE' SFLIMT           ****4          S01433
     C*                                                                   S01433
     C* FORMAT AMOUNTS                                                    S01433
     C                     Z-ADDDZFXLA    @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C                     END                             B***4          S01433
     C*                                                                   S01433
     C           @CNT      IFEQ 16                         B***4          S01433
     C*                                                                   S01433
     C* DISPLAY FIELDS                                                    S01433
     C                     MOVE *BLANK    EXES             ****4          S01433
     C                     MOVE *BLANK    SF4              ****4          S01433
     C                     MOVE *BLANK    SFS7             ****4          S01433
     C                     MOVEL'DEP LINE'SFLIMT           ****4          S01433
     C*                                                                   S01433
     C* FORMAT AMOUNTS                                                    S01433
     C                     Z-ADDDZMLAM    @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C                     END                             B***4          S01433
     C*                                                                   S01433
     C           SFS       IFEQ '000'                      B***4
     C           @CNT      ANDNE2                          ****4
     C                     MOVE '1'       *IN43            ****4
     C                     END                             E***4
     C*                                                                   S01433
     C*******    SFS       IFEQ '000'                      B***4          S01433
     C*******    @CNT      ANDEQ2                          X***4          S01433
     C*
     C*******    SFS       OREQ '000'                      X***4          S01433
     C           SFS       IFEQ '000'                      X***4          S01433
     C           @CNU      ANDEQ3                          X***4
     C           SFDAA     OREQ '000'                                     E22526
     C*
     C                     MOVE *BLANKS   SFS7             ****4
     C                     MOVE *BLANKS   SF4              ****4
     C                     MOVE *BLANKS   EXES             ****4          E20637
     C                     MOVE '0'       *IN43            ****4
     C                     MOVE '0'       *IN11                           E22526
     C                     END                             E***4
     C*
     C                     END                             E**3
     C*
     C                     WRITEDL0130F2                   **2            S01136
     C***************      WRITECA0200F2                   **2            S01136
     C***************      WRITEMM0067F2                   **2            S01136
     C                     MOVE '0'       *IN43            **2
     C                     MOVE '0'       *IN11            **2            E20637
     C*
     C                     ADD  1         @CNT             **2
     C*
     C                     END                             E*2
     C*
     C                     WRITEDL0130F1                   *1             S01136
     C                     WRITEDL0130CT                   *1             S01136
     C                     WRITEDL0130F3                   *1             S01136
     C                     SETOF                     777879*1             E00044
     C**************       WRITECA0200F1                   *1             S01136
     C**************       WRITECA0200CT                   *1             S01136
     C**************       WRITECA0200F3                   *1             S01136
     C**************       WRITEMM0067F1                   *1             S01136
     C***************      WRITEMM0067CT                   *1             S01136
     C****************     WRITEMM0067F3                   *1             S01136
     C*
     C                     ELSE                            X1
     C* IF BLANK,DISPLAY 'B' AS DEFAULT FOR BOOKING/ORIGINATING BRANCH?   E00039
     C           @MBIN     IFEQ 'Y'                                       E00039
     C           BKOR      IFEQ ' '                                       E00039
     C                     MOVE 'B'       BKOR                            E00039
     C                     END                                            E00039
     C                     END                                            E00039
     C                     WRITEDL0130F1                   *1             S01136
     C                     WRITEDL0130F3                   *1             S01136
     C                     SETOF                     777879               E00044
     C                     MOVE '0'       *IN41                          E00044A
     C                     WRITEDL0130CT                                 E00044A
     C****************     WRITECA0200F1                   *1             S01136
     C****************     WRITECA0200F3                   *1             S01136
     C****************     WRITEMM0067F1                   *1             S01136
     C****************     WRITEMM0067F3                   *1             S01136
     C                     END                             E1
     C*
     C           #BI9      ENDSR
     C*****************************************************************
     C/EJECT                                                              S01433
     C*****************************************************************   S01433
     C*                                                               *   S01433
     C* #BI2     - OUTPUT OF THE SECOND SCREEN                        *   S01433
     C*                                                               *   S01433
     C* CALLS    ZA1020   - CONVERT AMOUNT TO DISPLAY                 *   S01433
     C*                                                               *   S01433
     C* CALLED BY ?#BA    - PROCESSING FOR MIDAS ONLY                 *   S01433
     C*           ?#BB    - PROCESSING FOR MIDAS AND DRS-FX ONLY      *   S01433
     C*           ?#BC    - PROCESSING FOR MIDAS AND DRS-MM ONLY      *   S01433
     C*            #BD    - PROCESSING FOR MIDAS AND DRS              *   S01433
     C*                                                               *   S01433
     C* FLDS USED  @CNT   - SUBFILE COUNT                             *   S01433
     C*            @CNU   - LOANS ARRAYS COUNT                        *   S01433
     C*            @@IAMT - INPUT AMOUNT TO SR.ZA1020                 *   S01433
     C*            @@CDP  - CURRENCY DECIMAL PLACES IN SR.ZA1020      *   S01433
     C*            @@CRET - NUMBER OF CHARACTERS TO RETURN            *   S01433
     C*            @@ADSP - AMOUNT TO DISPLAY                         *   S01433
     C*                                                               *   S01433
     C*****************************************************************   S01433
     C           #BI2      BEGSR                                       *  S01433
     C*                                                                   S01433
     C** SET UP THE FIELDS IN THE DATASTRUCTURES                          S01433
     C                     Z-ADD1         @CNT    30                      S01433
     C                     Z-ADD1         @CNU    30                      S01433
     C                     Z-ADD1         @CNV    30                      S01433
     C*                                                                   S01433
     C           *IN39     IFEQ '0'                        B1             S01433
     C*                                                                   S01433
     C** OUTPUT THE DETAILS                                               S01433
     C           @CNT      DO   16                         B*2            S01433
     C*                                                                   S01433
     C*RESET DISPLAY FIELDS SFEXPY,SFLIMIT                                S01433
     C*                                                                   S01433
     C                     MOVE *BLANK    SFEXPY           **2            S01433
     C                     MOVE *BLANK    SFLIMT           **2            S01433
     C*                                                                   S01433
     C********** @CNT      IFEQ 1                          B***4          S01433
     C** OUTPUT FX SPOT LINE                                              S01433
     C           @CNT      IFEQ 2                          B***4          S01433
     C*                                                                   S01433
     C* DISPLAY FIELDS                                                    S01433
     C                     MOVE *BLANK    EXES             ****4          S01433
     C                     MOVE *BLANK    SF4              ****4          S01433
     C                     MOVE *BLANK    SFS7             ****4          S01433
     C                     MOVEL'FX SPOT' SFLIMT           ****4          S01433
     C**********           MOVELXFNM,@CNT SFEXPY           ****4          S01433
     C                     MOVELXFNM,1    SFEXPY           ****4          S01433
     C                     MOVE 'SPO'     SFS              ****4          S01433
     C                     MOVE 'T'       SFHY             ****4          S01433
     C*                                                                   S01433
     C* FORMAT AMOUNTS                                                    S01433
     C                     Z-ADDXFLM1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C*                                                                   S01433
     C                     Z-ADDXFXP1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF2              ****4          S01433
     C*                                                                   S01433
     C           XFXP1     SUB  XFLM1     XFXS1  100       ****4          S01433
     C           XFXS1     IFLT 0                                         S01433
     C                     Z-ADD0         XFXS1                           S01433
     C                     END                                            S01433
     C                     Z-ADDXFXS1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    EXES             ****4          S01433
     C           XFXS1     COMP 0                    11    ****4          S01433
     C                     END                             X***4          S01433
     C*                                                                   S01433
     C********** @CNT      IFEQ 2                          B**3           S01433
     C********** @CNT      OREQ 10                         ***3           S01433
     C** OUTPUT BLANK LINES                                               S01433
     C           @CNT      IFEQ 1                          B**3           S01433
     C           @CNT      OREQ 9                          ***3           S01433
     C                     MOVE '1'       *IN43            ***3           S01433
     C                     ELSE                            X**3           S01433
     C*                                                                   S01433
     C* OUTPUT FX FORWARD LINES                                           S01433
     C           @CNT      IFGT 2                          B***4          S01433
     C           @CNT      ANDLT9                          B***4          S01433
     C*                                                                   S01433
     C** FORMAT THE FIELDS FOR OUTPUT                                     S01433
     C                     Z-ADDXFLM,@CNV @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C*                                                                   S01433
     C                     Z-ADDXFXP,@CNV @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD14        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF2              ****4          S01433
     C*                                                                   S01433
     C                     Z-ADDXFXS,@CNV @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD14        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF3              ****4          S01433
     C                     MOVE @@ADSP    EXES             ****4          S01433
     C           XFXS,@CNV COMP 0                    11    ****4          S01433
     C*                                                                   S01433
     C                     MOVELXFEX,@CNV SFLIMT           ****4          S01433
     C           XFEX,@CNV IFEQ 'FX FWD'                                  S01433
     C                     MOVELXFNM,2    SFEXPY           ****4          S01433
     C                     END                                            S01433
     C                     MOVE XFS,@CNV  SFS              ****4          S01433
     C                     MOVE XFHY,@CNV SFHY             ****4          S01433
     C**********           MOVE XFDAA,@CNVSFDAA            ****4          S01433
     C                     Z-ADD0         SFSAV   30       ****4          S01433
     C                     MOVE XFDAA,@CNVSFSAV            ****4          S01433
     C**********           Z-ADDSFSAV     SFDAA            ****4          S01433
     C                     MOVE SFSAV     SFDAA            ****4          S01433
     C                     ADD  1         @CNV             ****4          S01433
     C                     END                             E***4          S01433
     C*                                                                   S01433
     C********   @CNT      IFEQ 9                          B***4          S01433
     C** OUTPUT PRECIOUS METAL SPOT LINE                   B***4          S01433
     C           @CNT      IFEQ 10                         B***4          S01433
     C*                                                                   S01433
     C* DISPLAY FIELDS                                                    S01433
     C                     MOVE *BLANK    EXES             ****4          S01433
     C                     MOVE *BLANK    SF4              ****4          S01433
     C                     MOVE *BLANK    SFS7             ****4          S01433
     C                     MOVEL'METAL S' SFLIMT           ****4          S01433
     C                     MOVE 'PT'      SFLIMT           ****4          S01433
     C**********           MOVELXMNM,1    SFEXPY           ****4          S01433
     C                     MOVELXPNM,1    SFEXPY           ****4          S01433
     C                     MOVE 'SPO'     SFS              ****4          S01433
     C                     MOVE 'T'       SFHY             ****4          S01433
     C*                                                                   S01433
     C* FORMAT AMOUNTS                                                    S01433
     C**********           Z-ADDXMLM1     @@IAMT           ****4          S01433
     C                     Z-ADDXPLM1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C*                                                                   S01433
     C**********           Z-ADDXMXP1     @@IAMT           ****4          S01433
     C                     Z-ADDXPXP1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF2              ****4          S01433
     C*                                                                   S01433
     C********** XMXP1     SUB  XMLM1     XMXS1  100       ****4          S01433
     C********** XMXS1     IFLT 0                                         S01433
     C**********           Z-ADD0         XMXS1                           S01433
     C           XPXP1     SUB  XPLM1     XPXS1  100       ****4          S01433
     C           XPXS1     IFLT 0                                         S01433
     C                     Z-ADD0         XPXS1                           S01433
     C                     END                                            S01433
     C**********           Z-ADDXMXS1     @@IAMT           ****4          S01433
     C                     Z-ADDXPXS1     @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    EXES             ****4          S01433
     C********** XMXS1     COMP 0                    11    ****4          S01433
     C           XPXS1     COMP 0                    11    ****4          S01433
     C                     END                             B***4          S01433
     C*                                                                   S01433
     C*  OUTPUT PRECIOUS METAL FORWARD LINES                              S01433
     C           @CNT      IFGT 10                         B***4          S01433
     C           @CNT      ANDLT17                         ****4          S01433
     C*                                                                   S01433
     C**********           Z-ADDXMLM,@CNU @@IAMT           ****4          S01433
     C                     Z-ADDXPLM,@CNU @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD11        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF1              ****4          S01433
     C*                                                                   S01433
     C**********           Z-ADDXMXP,@CNU @@IAMT           ****4          S01433
     C                     Z-ADDXPXP,@CNU @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD14        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF2              ****4          S01433
     C*                                                                   S01433
     C**********           Z-ADDXMXS,@CNU @@IAMT           ****4          S01433
     C                     Z-ADDXPXS,@CNU @@IAMT           ****4          S01433
     C                     Z-ADD0         @@CDP            ****4          S01433
     C                     Z-ADD14        @@CRET           ****4          S01433
     C                     EXSR ZA1020                     ****4          S01433
     C                     MOVE @@ADSP    SF3              ****4          S01433
     C                     MOVE @@ADSP    EXES             ****4          S01433
     C********** XMXS,@CNU COMP 0                    11    ****4          S01433
     C           XPXS,@CNU COMP 0                    11    ****4          S01433
     C*                                                                   S01433
     C**********           MOVELXMEX,@CNU SFLIMT           ****4          S01433
     C********** XMEX,@CNU IFEQ 'METAL FW'                                S01433
     C                     MOVELXPEX,@CNU SFLIMT           ****4          S01433
     C           XPEX,@CNU IFEQ 'METAL FW'                                S01433
     C                     MOVE 'D'       SFLIMT                          S01433
     C                     MOVELXPNM,2    SFEXPY                          S01433
     C                     END                                            S01433
     C**********           MOVE XMS,@CNU  SFS              ****4          S01433
     C**********           MOVE XMHY,@CNU SFHY             ****4          S01433
     C**********           MOVE XFDAA,@CNUSFDAA            ****4          S01433
     C                     MOVE XPS,@CNU  SFS              ****4          S01433
     C                     MOVE XPHY,@CNU SFHY             ****4          S01433
     C**********           MOVE XPDAA,@CNUSFDAA            ****4          S01433
     C                     Z-ADD0         SPSV    30       ****4          S01433
     C                     MOVE XPDAA,@CNUSPSV             ****4          S01433
     C**********           Z-ADDSPSV      SFDAA            ****4          S01433
     C                     MOVE SPSV      SFDAA            ****4          S01433
     C                     ADD  1         @CNU             ****4          S01433
     C                     END                             E***4          S01433
     C*                                                                   S01433
     C           SFS       IFEQ '000'                      B***4          S01433
     C           @CNT      ANDNE4                          ****4          S01433
     C                     MOVE '1'       *IN43            ****4          S01433
     C                     END                             E***4          S01433
     C*                                                                   S01433
     C           SFS       IFEQ '000'                      X***4          S01433
     C           @CNU      ANDEQ3                          X***4          S01433
     C           SFDAA     OREQ '000'                                     S01433
     C*                                                                   S01433
     C                     MOVE *BLANKS   SFS7             ****4          S01433
     C                     MOVE *BLANKS   SF4              ****4          S01433
     C                     MOVE *BLANKS   EXES             ****4          S01433
     C                     MOVE '0'       *IN43            ****4          S01433
     C                     MOVE '0'       *IN11                           S01433
     C                     END                             E***4          S01433
     C                     END                             E**3           S01433
     C*                                                                   S01433
     C*  OUTPUT BLANK LINES                                               S01433
     C                     WRITEDL0130F2                   **2            S01433
     C                     MOVE '0'       *IN43            **2            S01433
     C                     MOVE '0'       *IN11            **2            S01433
     C*                                                                   S01433
     C                     ADD  1         @CNT             **2            S01433
     C*                                                                   S01433
     C                     END                             E*2            S01433
     C*                                                                   S01433
     C                     WRITEDL0130F1                   *1             S01433
     C                     WRITEDL0130CT                   *1             S01433
     C                     WRITEDL0130F3                   *1             S01433
     C*                                                                   S01433
     C                     ELSE                            X1             S01433
     C                     WRITEDL0130F1                   *1             S01433
     C                     WRITEDL0130F3                   *1             S01433
     C                     END                             E1             S01433
     C*                                                                   S01433
     C           #BI29     ENDSR                                          S01433
     C*****************************************************************   S01433
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* DLEXPF   - CALCULATES THE EXPOSURE FOR AN FX DEAL             *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BAA   - CALCULATE EXPOSURE FOR MIDAS-FX ONLY      *
     C*            #BBA   - CALCULATE EXPOSURE FOR DRS=FX DEALS       *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           DLEXPF    BEGSR                           **  DLEXPF  **
     C*
     C** DEFINE INPUT FIELDS
     C                     Z-ADDDLVALU    DLVALU  50       VALUE DATE
     C                     Z-ADDDLAMTF    DLAMTF 130       LIMIT CCY EQUIV
     C*                                                        AMOUNT
     C*                                                                   S01433
     C** Check if one or both currencies are defined as precious metal    S01433
     C                     MOVE '0'       *IN72                           S01433
     C*                                                                   S01433
     C                     CALL 'AOCURRR0'                                S01433
     C                     PARM '*DBERR  '@RTCD                           S01433
     C                     PARM '*KEY    '@OPTN                           S01433
     C                     PARM FHCCY1    @AJCD   3                       S01433
     C           @CURR     PARM @CURR     DSSDY                           S01433
     C*                                                                   S01433
     C           A6PMRT    IFEQ 'Y'                                       S01433
     C                     MOVE '1'       *IN72                           S01433
     C                     ELSE                                           S01433
     C*                                                                   S01433
     C                     CALL 'AOCURRR0'                                S01433
     C                     PARM '*DBERR  '@RTCD                           S01433
     C                     PARM '*KEY    '@OPTN                           S01433
     C                     PARM FHCCY2    @AJCD   3                       S01433
     C           @CURR     PARM @CURR     DSSDY                           S01433
     C*                                                                   S01433
     C           A6PMRT    IFEQ 'Y'                                       S01433
     C                     MOVE '1'       *IN72                           S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C** IF VALUE DATE IS LESS OR EQUAL TO RUND - FIRST PERIOD ONLY
     C           BJRDNB    ADD  SP        RUND2   50                      S01433
     C*****      DLVALU    IFEQ RUND                                      S01194
     C           DLVALU    IFEQ BJRDNB                                    S01194
     C           DLVALU    ORLE RUND2                                     S01433
     C***********XFXP,1    ADD  DLAMTF    XFXP,1                          S01433
     C*                                                                   S01433
     C** ACCUMULATE SPOT EXPOSURE IF THERE IS A SPOT LIMIT                S01433
     C*                                                                   S01433
     C           XFLM1     IFGT *ZERO                                     S01433
     C  N72      XFXP1     ADD  DLAMTF    XFXP1  100                      S01433
     C                     ELSE                                           S01433
     C  N72      XFXP,1    ADD  DLAMTF    XFXP,1                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C********** XMLM1     IFGT *ZERO                                     S01433
     C********** XMXP1     ADD  DLAMTF    XMXP1  100                      S01433
     C           XPLM1     IFGT *ZERO                                     S01433
     C   72      XPXP1     ADD  DLAMTF    XPXP1  100                      S01433
     C                     ELSE                                           S01433
     C********** XMXP,1    ADD  DLAMTF    XMXP,1                          S01433
     C   72      XPXP,1    ADD  DLAMTF    XPXP,1                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C                     GOTO DLFEND
     C                     END
     C*
     C** VALUE DATE IS GREATER THAN TODAY - AMOUNT IS ADDED INTO EVER  Y
     C** PERIOD PRECEDING & INCLUDING THE PERIOD WHICH INCLUDES THE
     C** VALUE DATE.
     C                     Z-ADD1         D
     C*
     C           D         DOWLE6                                      **
     C*
     C** ADD AMOUNT INTO THIS PERIOD
     C*********  XFXP,D    ADD  DLAMTF    XFXP,D
     C** CHECK IF A PRECIOUS METAL DEAL                                   S01433
     C           *IN72     IFEQ '1'                                       S01433
     C           XPXP,D    ADD  DLAMTF    XPXP,D                          S01433
     C                     ELSE                                           S01433
     C           XFXP,D    ADD  DLAMTF    XFXP,D                          S01433
     C                     END                                            S01433
     C*
     C** LOOP AGAIN TO ADD AMOUNT INTO NEXT PERIOD IF
     C** - VALUE DATE EXCEEDS THIS END OF PERIOD DATE.
     C** - LESS THAN SIX PERIODS HAVE BEEN USED.
     C********** DLVALU    CABLEXFDT,D    DLFEND                          S01433
     C*                                                                   S01433
     C           *IN72     IFEQ '1'                                       S01433
     C           DLVALU    CABLEXPDT,D    DLFEND                          S01433
     C                     ELSE                                           S01433
     C           DLVALU    CABLEXFDT,D    DLFEND                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C           D         ADD  1         D                               S01433
     C*
     C                     END
     C*
     C           DLFEND    ENDSR                           **  DLFEND  **
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* DLEXPL   - CALCULATES THE EXPOSURE OF A LOAN                  *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BAB   - CALCULATE EXPOSURE FOR MIDAS-LOANS        *
     C*            #BCA   - CALCULATE EXPOSURE FOR DRS-LOANS          *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           DLEXPL    BEGSR                           **  DLEXPL  **
     C*
     C**   DEFINE INPUT FIELDS
     C                     Z-ADDDLMATD    DLMATD  50
     C                     Z-ADDDLAMTL    DLAMTL 130
     C                     Z-ADDDLNOTD    DLNOTD  30
     C*
     C** CALL/NOTICE DEAL-USE RUN DATE + NOTICE DAYS
     C***********RECFMT    IFEQ 'DEALSCCF'                                S01136
     C***********RECGMT    OREQ 'DCDEALP0'                                S01136
     C***********DLNOTD    ANDNE-999                                      S01136
     C***********RUND      ADD  NOTD      DLMATD                          S01136
     C*********************END                                            S01136
     C*                                                                   S01136
     C           DLNOTD    IFNE -999                                      S01136
     C*                                                                   S01136
     C           RECFMT    IFEQ 'DEALSCCF'                                S01136
     C           RECGMT    OREQ 'DCDEALP0'                                S01136
     C*****      RUND      ADD  NOTD      DLMATD                   S01136 S01194
     C           BJRDNB    ADD  NOTD      DLMATD                          S01194
     C                     END                                            S01136
     C*                                                                   S01136
     C           RECHMT    IFEQ 'MMDELDP0'                                S01136
     C*****      RUND      ADD  HKNTCE    DLMATD                   S01136 S01194
     C           BJRDNB    ADD  HKNTCE    DLMATD                          S01194
     C                     END                                            S01136
     C*                                                                   S01136
     C                     END                                            S01136
     C*
     C***IF*MATURITY*DATE*IS*LESS*THAN*RUND,*IGNORE*DEAL.                 133831
     C** If Maturity Date <= Rundate, Ignore Deal.                        133831
     C*****      DLMATD    IFLT RUND                                      S01194
     C***********DLMATD    IFLT BJRDNB                             S01194 133831
     C           DLMATD    IFLE BJRDNB                                    133831
     C***********DLNOTD    OREQ -999                                      S01136
     C                     GOTO ENDDL
     C                     END
     C/COPY WNCPYSRC,DL0130AC24
     C*
     C** LOOP TO ADD AMOUNT INTO EVERY PERIOD PRECEDING & INCLUDING
     C** THE PERIOD WHICH INCLUDES THE MATURITY DATE.
     C                     Z-ADD1         D       20
     C           D         DOWLE6                          **  DLOOP4  **
     C*
     C** ADD AMOUNT INTO THIS PERIOD
     C           XLXP,D    ADD  DLAMTL    XLXP,D
     C*
     C** LOOP AGAIN TO ADD AMOUNT INTO NEXT PERIOD IF
     C** - MATURITY DATE EXCEEDS THIS END OF PERIOD DATE.
     C** - LESS THAN SIX PERIODS HAVE BEEN USED
     C           DLMATD    CABLEXLDT,D    ENDDL
     C*
     C           D         ADD  1         D
     C                     END
     C/COPY WNCPYSRC,DL0130AC25
     C*
     C           ENDDL     ENDSR                           ** ENDDL **
     C*****************************************************************
     C*                                                               *   S01119
     C*  FRAIRS    - CALCULATE EXPOSURE FOR MIDAS FRA/IRS             *   S01119
     C*                                                               *   S01119
     C*****************************************************************   S01119
     C           FRAIRS    BEGSR                                          S01119
     C*                                                                   LN0527
     C           @MBIN     IFEQ 'Y'                                       LN0527
     C*                                                                   LN0527
     C** IF BRANCH ENTERED                                                LN0527
     C           *IN73     IFNE '1'                                       LN0527
     C** IF ORIGINATING BRANCH SELECTED AND NOT EQ. TO DEAL ORIG BRANCH   LN0527
     C           *IN76     IFEQ '1'                                       LN0527
     C           BCDX      ANDNEORBR                                      LN0527
     C                     MOVE '1'       *IN70                           LN0527
     C                     GOTO ENDFRS                                    LN0527
     C                     END                                            LN0527
     C** IF BOOKING BRANCH SELECTED AND NOT EQ. TO DEAL BOOKING BRANCH    LN0527
     C           *IN76     IFEQ '0'                                       LN0527
     C           BCDX      ANDNEBRCA                                      LN0527
     C                     MOVE '1'       *IN70                           LN0527
     C                     GOTO ENDFRS                                    LN0527
     C                     END                                            LN0527
     C                     END                                            LN0527
     C** IF COMPANY ENTERED                                               LN0527
     C           *IN74     IFEQ '0'                                       LN0527
     C** IF BOOKING BRANCH SELECTED USE DEAL BOOKING BRANCH               LN0527
     C           *IN76     IFEQ '0'                                       LN0527
     C                     MOVE BRCA      HBRC    3                       LN0527
     C                     ELSE                                           LN0527
     C** IF ORIGINATING BRANCH SELECTED USE DEAL ORIGINATING BRANCH       LN0527
     C                     MOVE ORBR      HBRC                            LN0527
     C                     END                                            LN0527
     C** GET COMPANY OF DEAL BRANCH FROM FILE                             LN0527
     C**********           CALL 'AOBRCHR0'                                             LN0527 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       LN0527
     C                     PARM '*KEY   ' @OPTN   7                       LN0527
     C                     PARM HBRC      @DSNB   3                       LN0527
     C********** @BRCH     PARM @BRCH     DSFDY                                        LN0527 CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C*                                                                   LN0527
     C           @RTCD     IFNE *BLANKS                                   LN0527
     C           CCDX      ORNE A8CMCD                                    LN0527
     C           CCDX      ANDNE*BLANKS                                   LN0527
     C                     MOVE '1'       *IN70                           LN0527
     C                     GOTO ENDFRS                                    LN0527
     C                     END                                            LN0527
     C*                                                                   LN0527
     C                     END                                            LN0527
     C*                                                                   LN0527
     C                     END                                            LN0527
     C*                                                                   S01119
     C                     MOVEA'00'      *IN,62           IND. 62 & 63   S01119
     C**                                                                  S01119
     C           DTYP      IFEQ 'FR'                       B1             S01119
     C*****      RUND      IFLE VDAT                       B*2     S01119 S01194
     C           BJRDNB    IFLE VDAT                       B*2            S01194
     C                     MOVE '1'       *IN62            **2            S01119
     C*****                Z-ADDRUND      RRSD             **2' FO S01119 S01194
     C                     Z-ADDBJRDNB    RRSD             **2' FOR DLRREXS01194
     C                     Z-ADDVDAT      RRED             **2            S01119
     C                     END                             E*2            S01119
     C                     ELSE                            X1             S01119
     C                     MOVE '1'       *IN63            *1             S01119
     C*****      RUND      IFLT VDAT                       B*2     S01119 S01194
     C           BJRDNB    IFLT VDAT                       B*2            S01194
     C                     Z-ADDVDAT      RRSD             **2            S01119
     C                     ELSE                            X*2            S01119
     C*****                Z-ADDRUND      RRSD             **2     S01119 S01194
     C                     Z-ADDBJRDNB    RRSD             **2            S01194
     C                     END                             E*2            S01119
     C                     Z-ADDMDAT      RRED             *1             S01119
     C                     END                             E1             S01119
     C*
     C           *IN62     IFEQ '1'                        B1             S01119
     C           *IN63     OREQ '1'                        *1             S01119
     C                     MOVELDTYP      RRDT             *1             S01119
     C                     Z-ADDUPAMT     RRPA             *1             S01119
     C                     EXSR DLRREX                     *1             S01119
0885 C**                                                                  S01119
0883 C                     Z-ADDMDAT      DLMATD           *1             S01119
0885 C**                                                                  S01119
0886 C*****                MOVE BLNK12    KEYTAB           *1      S01119 S01194
0887 C*****                MOVE '20'      TABRT            *1      S01119 S01194
0888 C*****                MOVE UCUCY     TABCCY           *1      S01119 S01194
0889 C*****                MOVE '1'       TABSRT           *1      S01119 S01194
0890 C*****                EXSR TABCHN                     *1      S01119 S01194
     C** CALL ACCESS PROGRAM FOR CURRENCY DETAILS                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM UCUCY     @AJCD   3                       S01194
     C           @CURR     PARM @CURR     DSSDY                           S01194
     C************         PARM           @CURR                           S01194
     C*                                                                   S01194
     C******     *INU7     CABEQ'1'       ENDFRS           *1      S01119 S01194
0892 C**                                                                  S01119
0894 C*****      CDP       ADD  1         DEP              *1      S01119 S01194
0894 C           A6NBDP    ADD  1         DEP              *1             S01194
0895 C           RREA      DIV  FCT,DEP   RREA      H      *1             S01119
0896 C*****      ERLC      COMP 0                        88*1      S01119 S01194
0896 C           A6ERLC    COMP 0                        88*1             S01194
     C*                                                                   S01119
     C           *IN88     IFEQ '0'                        B*2            S01119
     C*****      MDIN      IFEQ 0                          B**3   S01119  S01194
     C*****      A6A8ST    IFEQ '0'                        B**3    S01194 E134
     C           A6MDIN    IFEQ 'D'                        B**3           E134
     C*****      RREA      DIV  ERLC      DLAMTL    H      ***3    S01119 S01194
     C           RREA      DIV  A6ERLC    DLAMTL    H      ***3           S01194
     C                     ELSE                            X**3           S01119
     C*****      RREA      MULT ERLC      DLAMTL    H      ***3    S01119 S01194
     C           RREA      MULT A6ERLC    DLAMTL    H      ***3           S01194
     C                     END                             E**3           S01119
     C                     ELSE                            X*2            S01119
     C                     Z-ADDRREA      DLAMTL           **2            S01119
     C                     END                             E*2            S01119
     C*                                                                   S01119
     C* IF DEAL TYPE IS FR ADD AMOUNT TO FRA TOTAL EXPOSURE               S01157
     C*                                                                   S01157
     C           DTYP      IFEQ 'FR'                       B*2            S01157
     C                     ADD  DLAMTL    @FREA  130       **2            S01157
     C*                                                                   S01157
     C* ELSE ADD AMOUNT TO IRS EXPOSURE AMOUNT                            S01157
     C*                                                                   S01157
     C                     ELSE                            X*2            S01157
     C                     ADD  DLAMTL    @IREA  130       **2            S01157
     C                     END                             E*2            S01157
     C*                                                                   S01157
     C***********          EXSR DLEXPL                     *1     SO1119  S01157
     C                     END                             E1             S01119
0892 C**                                                                  S01119
     C           ENDFRS    ENDSR                                          S01119
     C**                                                                  S01119
     C********************************************************************S01119
     C**                                                                  S01119
     C** S/R DLRREX                                                       S01119
     C** PROCEDURE TO CALCULATE EXPOSURE AMOUNTS OF FRA/IRS               S01119
     C**                                                                  S01119
     C** INPUT:  START DATE                                          RRSD S01119
     C**         END DATE(VALUE DATE FOR FRA, MATURITY DATE FOR IRS) RRED S01119
     C**                 MIDAS DAY NUMBERS(5,0)                           S01119
     C**         PRINCIPAL AMOUNT 13,0                               RRPA S01119
     C**         DEAL TYPE 2A                                        RRDT S01119
     C**                                                                  S01119
     C** OUTPUT: EXPOSURE AMOUNT 13,0                                RREA S01119
     C**                                                                  S01119
     C           DLRREX    BEGSR                                          S01119
     C**                                                                  S01119
     C** DEFINE FIELDS                                                    S01119
     C                     Z-ADDRRPA      RRPA   130                      S01119
     C                     Z-ADDRRSD      RRSD    50                      S01119
     C                     Z-ADDRRED      RRED    50                      S01119
     C                     Z-ADD0         RREA   130                      S01119
     C                     MOVE RRDT      RRDT    2                       S01119
     C**                                                                  S01119
     C** IF PRINCIPAL IS ZERO, DO NOT PROCESS                             S01119
     C           RRPA      CABEQ0         RRXEND                          S01119
     C**                                                                  S01119
     C** DETERMINE FRA/IRS AND SET UP APPROPRIATE PERCENTAGES/PERIODS     S01119
     C** DEAL TYPE 'FR' IS FRA, ALL OTHERS ARE IRS                        S01119
     C           RRDT      IFEQ 'FR'                                      S01119
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL0130CVSF                                           S01408
     C*****                Z-ADDFRLPC     RRLPC   74                      S01119
     C                     Z-ADDBQFLPC    RRLPC   74                      S01119
     C*****                Z-ADDFRLPD     RRLPD   40                      S01119
     C                     Z-ADDBQFLPD    RRLPD   40                      S01119
     C*****                Z-ADDFRUPC     RRUPC   74                      S01119
     C                     Z-ADDBQFUPC    RRUPC   74                      S01119
     C*****                Z-ADDFRUPD     RRUPD   40                      S01119
     C                     Z-ADDBQFUPD    RRUPD   40                      S01119
     C                     ELSE                                           S01119
     C*****                Z-ADDIRLPC     RRLPC   74                      S01119
     C                     Z-ADDBQILPC    RRLPC   74                      S01119
     C*****                Z-ADDIRLPD     RRLPD   40                      S01119
     C                     Z-ADDBQILEP    RRLPD   40                      S01119
     C*****                Z-ADDIRUPC     RRUPC   74                      S01119
     C                     Z-ADDBQIUPC    RRUPC   74                      S01119
     C*****                Z-ADDIRUPD     RRUPD   40                      S01119
     C                     Z-ADDBQIUEP    RRUPD   40                      S01119
     C                     END                                            S01119
     C**                                                                  S01119
     C** IF UPPER END PERIOD IS ZERO, CALCULATE EXPOSURE AMOUNT BY        S01119
     C** OBTAINING LOWER END % OF PRINCIPAL                               S01119
     C           RRUPD     IFEQ 0                                         S01119
     C           RRPA      DIV  100       RRAMT  152                      S01119
     C           RRAMT     MULT RRLPC     RREA      H                     S01119
     C                     GOTO RRXEND                                    S01119
     C                     END                                            S01119
     C**                                                                  S01119
     C** IF UPPER END PERIOD IS NOT ZERO AND LOWER END PERIOD             S01119
     C** WHEN ADDED TO START DATE, IS GREATER THAN END DATE               S01119
     C** CALCULATE EXPOSURE AMOUNT BY OBTAINING LOWER END % OF PRINCIPAL  S01119
     C           RRSD      ADD  RRLPD     RRCHK   50                      S01119
     C***********RRCHK     IFGT RRED                                S01119029001
     C           RRCHK     IFGE RRED                                      029001
     C           RRPA      DIV  100       RRAMT                           S01119
     C           RRAMT     MULT RRLPC     RREA      H                     S01119
     C                     GOTO RRXEND                                    S01119
     C                     END                                            S01119
     C**                                                                  S01119
     C** OTHERWISE, ADD THE UPPER END PERIOD TO THE START DATE            S01119
     C** AND IF THE RESULT IS LESS THAN THE END DATE, CALCULATE           S01119
     C** EXPOSURE AMOUNT BY OBTAINING UPPER END % OF PRINCIPAL            S01119
     C           RRSD      ADD  RRUPD     RRCHK                           S01119
     C***********RRCHK     IFLT RRED                                S01119029001
     C           RRCHK     IFLE RRED                                      029001
     C           RRPA      DIV  100       RRAMT                           S01119
     C           RRAMT     MULT RRUPC     RREA      H                     S01119
     C                     GOTO RRXEND                                    S01119
     C                     END                                            S01119
     C**                                                                  S01119
     C** FINALLY, IF NONE OF THESE CASES WAS SATISFIED, THE EXPOSURE      S01119
     C** AMOUNT IS CALCULATED USING THE FOLLOWING % OF THE PRINCIPAL      S01119
     C**                                                                  S01119
     C**   LPC  +  ( (ED - (SD + LPD)) X (UPC - LPC) )  |   A             S01119
     C**           ( ------------------------------- )  |   -             S01119
     C**           (            UPD - LPD            )  |   B             S01119
     C**                                                                  S01119
     C           RRSD      ADD  RRLPD     RRCHK            SD + LPD       S01119
     C           RRED      SUB  RRCHK     RRA1    50       ED - (SD + LPD)S01119
     C**                                                                  S01119
     C           RRUPC     SUB  RRLPC     RRA2    74       UPC - LPC      S01119
     C           RRA1      MULT RRA2      RRA    158       RRPC = A       S01119
     C**                                                                  S01119
     C           RRUPD     SUB  RRLPD     RRB     50       UPD - LPD = B  S01119
     C**                                                                  S01119
     C           RRA       DIV  RRB       RRADB  158H      A/B            S01119
     C           RRLPC     ADD  RRADB     RRPC   158       LPC + A/B      S01119
     C**                                                                  S01119
     C           RRPA      DIV  100       RRAMT            PERCENTAGE     S01119
     C           RRAMT     MULT RRPC      RREA      H      CALCULATION    S01119
     C**                                                                  S01119
     C           RRXEND    ENDSR                                          S01119
     C**                                                                  S01119
     C********************************************************************
     C/EJECT
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C*                                                                   S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C*                                                                   S01195
     C*****************************************************************
     C******                                                          *   S01195
     C**ZDATE3   - CALCULATES DAYS FORWARD IN ANY CURRENCY            *   S01195
     C*****                                                           *   S01195
     C**CALLS             -                                           *   S01195
     C*****                                                           *   S01195
     C**CALLED BY  #A     - FIRST CYCLE PROCESSING                    *   S01195
     C*****                                                           *   S01195
     C**FLDS USED  @HCCY  - CURRENCY ARRAY                            *   S01195
     C*****                                                           *   S01195
     C*****************************************************************   S01195
     C*****      ZDATE3    BEGSR                           *** ZDATE3 *** S01195
     C*****                                                               S01195
     C***CALCULATIONS TO DEFINE INPUT FIELDS.                             S01195
     C*****                Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  S01195
     C*****                MOVE ZCCY      ZCCY    3        DATE CURRENCY  S01195
     C*****                Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING S01195
     C*****                                                DAYS FORWARD   S01195
     C***CLEAR COUNT OF NBR OF DAYS ADDED, & DEFINE ZDYNBR.               S01195
     C*****                Z-ADD0         ZDCNT   20                      S01195
     C*****                Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C*****                                                               S01195
     C***MOVE HOLIDAYS FOR CCY INTO AN ARRAY                              S01195
     C*****                MOVEAHCCY      @HCCY                           S01195
     C*****                                                               S01195
     C***LOOP TO INCREMENT DAY NUMBER AND CHECK FOR HOLIDAY.              S01195
     C*****      ZDLOP1    TAG                             ** ZDLOP1 TAG *S01195
     C*****                                                               S01195
     C*****                SETOF                     9596                 S01195
     C*****      ZDYNBR    ADD  1         ZDYNBR                          S01195
     C*****                                                               S01195
     C***SET KEY FOR FIRST HOLIDAY RECORD.                                S01195
     C*****                MOVEL'22    '  ZDHKEY 12                       S01195
     C*****                MOVELZDYNBR    ZWRK6   6                       S01195
     C*****                MOVE '1'       ZWRK6                           S01195
     C*****                MOVE ZWRK6     ZDHKEY                          S01195
     C*****                                                               S01195
     C***CHAIN FOR HOLIDAY RECORD, RECORD 1 OR 2                          S01195
     C*****      ZDHCHN    TAG                             ** ZDHCHN TAG *S01195
     C*****                                                               S01195
     C*****      ZDHKEY    CHAINTABDLI               90    ON NOT THERE   S01195
     C**N90      RECI      COMP 'D'                  9090  DELETED        S01195
     C*****                                                               S01195
     C*****NO RECORD 1 FOUND, IS NOT A HOLIDAY                            S01195
     C***90N95             GOTO ZDOAGN                                    S01195
     C*****                                                               S01195
     C*****NO RECORD 2 FOUND                                              S01195
     C***90 95 96          GOTO ZDLOP1                     EXC. NOT FOUND S01195
     C***90 95N96          GOTO ZDOAGN                     INC. NOT FOUND S01195
     C*****                                                               S01195
     C***DETERMINE TYPE FOUND, INCLUDE OR EXCLUDE                         S01195
     C*****      INEX      COMP 'E'                  92  91               S01195
     C*****                                                               S01195
     C***CHECK IF DAY IS HOLIDAY FOR CURRENCY.                            S01195
     C*****      ZCCY      LOKUP@HCCY                    93               S01195
     C***91 93             GOTO ZDOAGN                     EXCLUDE FOUND  S01195
     C***92 93             GOTO ZDLOP1                     INCLUDE FOUND  S01195
     C*****                                                               S01195
     C***IF EXCLUDE OR INCLUDE NOT FOUND CHECK                            S01195
     C***FOR SECOND HOLIDAY RECORD, IF REQUIRED.                          S01195
     C*****      '   '     LOKUP@HCCY                    94ON IF NO RCD.2 S01195
     C*****                MOVE ZDHKEY    ZWRK1   1                       S01195
     C*****      ZWRK1     COMP '1'                      95               S01195
     C***91 95             SETON                     96                   S01195
     C***95N94             MOVE '2'       ZDHKEY                          S01195
     C***95N94             GOTO ZDHCHN                     GET SECOND REC S01195
     C******                                                              S01195
     C***91                GOTO ZDLOP1                     EXC. NOT FOUND S01195
     C***92                GOTO ZDOAGN                     INC. NOT FOUND S01195
     C*****                                                               S01195
     C***INCREMENT COUNT AND CHECK IF REQUIRED NUMBER OF DAYS             S01195
     C***HAVE BEEN ADDED. IF NOT, GO THROUGH LOOP1 AGAIN.                 S01195
     C*****      ZDOAGN    TAG                             ** ZDOAGN TAG *S01195
     C*****                                                               S01195
     C*****      ZDCNT     ADD  1         ZDCNT                           S01195
     C*****      ZDCNT     COMP ZNRDYS                 97                 S01195
     C***97                GOTO ZDLOP1                                    S01195
     C*****                                                               S01195
     C*****                ENDSR                                          S01195
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* ZDATE2   - CONVERT A DAY NUMBER TO A DATE FORMAT              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BAC   - FORMAT MIDAS DEALS FOR OUTPUT             *
     C*                                                               *
     C* FLDS USED  @DATF  - DATE FORMAT WORK FIELD                    *
     C*            @MN    - MONTH ARRAY                               *
     C*                                                               *
     C*****************************************************************
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C** CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C** CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C** DETERMINE YEAR NUMBER.
     C**
     C** ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C*
     C** CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C*                                                    DAYS
     C** CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C*
     C           ZDTAG1    TAG
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C*
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C*
     C** DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C*
     C** CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C*
     C** DETERMINE MONTH NUMBER.
     C*
     C** ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C*
     C** CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C*
     C           ZDTAG2    TAG
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C*
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C*
     C** DETERMINE DAY OF MONTH.
     C*
     C** ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C*
     C** CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C*
     C** ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C*
     C** FORMAT DATE, DDMMYY OR MMDDYY.
     C           @DATF     IFEQ 'M'
     C                     MOVE ZDAY      ZWRK4
     C                     MOVELZMTH      ZWRK4
     C                     ELSE
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZMTH      ZWRK4
     C                     END
     C*
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C*
     C** FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C   95                MOVEL' '       ZWRK5
     C                     MOVELZDAY      ZWRK5   5
     C                     MOVE @MN,ZMTH  ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C*
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C********************************************************************
      /EJECT
     C*******************************************************************
     C*
     C* ZA0680 - THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO
     C*          MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)
     C*
     C* CALLED BY :
     C*
     C* CALLS :
     C*
     C* INPUT  : @@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)
     C*
     C* OUTPUT : @@MDNO MIDAS DAY NUMBER  (SIZE : 5N)
     C*
     C* USES :   @@CC   NUMBER OF CENTURIES IN DATE
     C*          @@DAY  DAY NUMBER
     C*          @@REM  REMAINDER FROM DIVIDE
     C*          @@MTH  MONTH NUMBER
     C*          @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN
     C*                 MONTH
     C*          @@WK2  WORK FIELD (2,0)
     C*          @@WK5  WORK FIELD (5,0)
     C*          @@YYYY YEAR (4 CHARACTER)
     C*          @@YY   YEAR (2 CHARACTER)
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN
     C*                 A FOUR YEAR PERIOD
     C*
     C*     LAST AMEND NO. ME1257              DATE 02/04/87                *
     C*     When date input is zero set output date to zeroes               *
     C*
     C*******************************************************************
     C*
     C           ZA0680    BEGSR
     C*
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD
     C                     Z-ADD0         @@MDNO  50
     C*
     C           @@DTIN    CABEQ0         ZA0689                          ME1257
     C*
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING
     C**   WORK OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,
     C**   BY SUBTRACTING 1972 FROM THE YEAR FIELD.
     C           @@YYYY    IFGE 2072                       B1
     C           @@YYYY    SUB  1972      @@YYYY           *1
     C*
     C**   MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)
     C**   THEN RESTORE THE YEAR WHICH WAS INPUT BACK TO THE
     C**   ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.
     C**
     C           @@CC      MULT 36524     @@MDNO           *1
     C           @@YYYY    ADD  1972      @@YYYY           *1
     C                     END                             E1
     C*
     C           @@YYYY    ADD  28        @@WK2   20
     C*
     C           @@WK2     DIV  4         @@WK2
     C                     MVR            @@REM   10
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD
     C           @@WK2     MULT 1461      @@WK5   50
     C                     ADD  @@WK5     @@MDNO
     C*
     C**  CHECK REMAINDER AND MONTH NUMBER
     C           @@REM     IFEQ 0                          B1
     C           @@MTH     ANDGT2                          B1
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR
     C           @@REM     IFNE 0                          B1
     C                     ADD  @YD,@@REM @@MDNO           *1
     C                     END                             E1
     C*
     C**  ADD MONTHS THIS YEAR
     C                     ADD  @MD,@@MTH @@MDNO
     C*
     C**  ADD DAYS THIS MONTH
     C                     ADD  @@DAY     @@MDNO
     C*
     C           ZA0689    ENDSR                           **ZA0689 TAG**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       SUBROUTINE ZA0670 - THIS SUBROUTINE IS USED TO FIND     *
     C*       WHICH CCY AND WHICH AMOUNT IS BUY AND WHICH IS SELL.    *
     C*                                                               *
     C*       IF DEAL FIRST AMOUNT IS >0 THEN FIRST IS BUY            *
     C*       ELSE FIRST IS SELL.                                     *
     C*                                                               *
     C*       CALLS:                                                  *
     C*       INPUT: FHDAM1 - DEAL FIRST AMOUNT                       *
     C*              FHDAM2 - DEAL SECOND AMOUNT                      *
     C*              FHCCY1 - DEAL FIRST CURRENCY                     *
     C*              FHCCY2 - DEAL SECOND CURRENCY                    *
     C*      OUTPUT: @@DBAM - DEAL BUY AMOUNT                         *
     C*              @@DSAM - DEAL SELL AMOUNT                        *
     C*              @@DBCC - DEAL BUY CURRENCY                       *
     C*              @@DSCC - DEAL SELL CURRENCY                      *
     C*        USES:                                                  *
     C*                                                               *
     C*****************************************************************
     C*
     C*
     C           ZA0670    BEGSR
     C           FHDAM1    IFGT 0
     C                     Z-ADDFHDAM1    @@DBAM 150
     C                     MOVE FHCCY1    @@DBCC  3
     C*******              Z-SUBFHDAM2    @@DSAM 150                      S01433
     C                     Z-ADDFHDAM2    @@DSAM 150                      S01433
     C                     MOVE FHCCY2    @@DSCC  3
     C                     ELSE
     C                     Z-SUBFHDAM1    @@DSAM
     C                     MOVE FHCCY1    @@DSCC
     C                     Z-ADDFHDAM2    @@DBAM
     C                     MOVE FHCCY2    @@DBCC
     C                     END
     C*                                                                   S01433
     C* Change negatives to positives.                                    S01433
     C           @@DBAM    IFLT 0                                         S01433
     C                     Z-SUB@@DBAM    @@DBAM                          S01433
     C                     END                                            S01433
     C           @@DSAM    IFLT 0                                         S01433
     C                     Z-SUB@@DSAM    @@DSAM                          S01433
     C                     END                                            S01433
     C*                                                                   S01433
     C*
     C           ZA0679    ENDSR
     C*****************************************************************
      /EJECT
     C****************************************************************
     C*                                                              *
     C*     ZA1020 -  Convert Amount to Display                      *
     C*                                                              *
     C*     CALLS:                                                   *
     C*                                                              *
     C*     INPUT:   @@IAMT - Input amount.                          *
     C*              @@CRET - Number of characters to return.        *
     C*              @@CDP  - Currency decimal places.               *
     C*                                                              *
     C*     OUTPUT:  @@ADSP - Amount to display.                     *
     C*                                                              *
     C*     USES:    @@C    Index for array @D.                      *
     C*              @@D    Index for array @E.                      *
     C*              @@E    Index for array @D.                      *
     C*              @@F    Work field.                              *
     C*              @@G    Index for array @E.                      *
     C*              @@H    Index for array @C.                      *
     C*              @@MAX  Maximum no. of integer positions.        *
     C*              @@CNT1 Counter field.                           *
     C*              @@CNT2 Counter field.                           *
     C*              @@RES  Result of a division operation.          *
     C*              @@REMD Remainder of a division operation.       *
     C*              @@CMOV No. of characters set up to be returned. *
     C*              @@DIFF Difference between @@CMOV and @@CRET.    *
     C*              @C     Work array.                              *
     C*              @D     Array for input amount.                  *
     C*              @E     Array to set up display amount.          *
     C*              @@CRET Number of chars. that must be returned.  *
     C*              @@AMDS Data structure to convert input amount   *
     C*                     to alpha field.                          *
     C*                                                              *
     C****************************************************************
     C*
     C           ZA1020    BEGSR
     C*
     C**  Define and initialise fields used.
     C                     Z-ADD@@IAMT    @@IAMT 150
     C                     Z-ADD@@CRET    @@CRET  20
     C                     Z-ADD@@CDP     @@CDP   10
     C                     MOVE *BLANKS   @@ADSP 21
     C*
     C                     Z-ADD*ZEROS    @@C     20
     C                     Z-ADD*ZEROS    @@D     20
     C                     Z-ADD*ZEROS    @@E     20
     C                     Z-ADD*ZEROS    @@F     20
     C                     Z-ADD*ZEROS    @@G     20
     C                     Z-ADD*ZEROS    @@H     20
     C                     Z-ADD*ZEROS    @@MAX   20
     C                     Z-ADD*ZEROS    @@CNT1  20
     C                     Z-ADD*ZEROS    @@CNT2  20
     C                     Z-ADD*ZEROS    @@RES   20
     C                     Z-ADD*ZEROS    @@CMOV  20
     C                     Z-ADD*ZEROS    @@DIFF  20
     C                     Z-ADD*ZEROS    @@REMD  10
     C                     Z-ADD*ZEROS    @@MRET  20
     C*
     C**  Initialise arrays.
     C                     MOVEA*BLANKS   @C
     C                     MOVEA*BLANKS   @D
     C                     MOVEA*BLANKS   @E
     C*
     C**  Take modulus of input amount.
     C           @@IAMT    IFLT *ZERO                      B1
     C                     Z-SUB@@IAMT    @@IAMT           *1
     C                     END                             E1
     C*
     C**  Move input amount to @D.
     C                     MOVEA@@AMDS    @D
     C*
     C**  Move decimal portion of amount to @E.
     C                     Z-ADD15        @@C
     C                     Z-ADD21        @@D
     C*
     C           21        SUB  @@CDP     @@MAX
     C           @@D       DOWGT@@MAX                      B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C**  Move decimal separator to @E.
     C           @@CDP     IFNE 0                          B1
     C*********************MOVE*IDDCSP****@E,@@D************1*************S01319
     C                     MOVE BNDCSP    @E,@@D           *1             S01319
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C**  Find position of last character to be moved.
     C                     Z-ADD1         @@E
     C*
     C           @@E       DOWLT15                         B1
     C           @D,@@E    ANDEQ'0'                        *1
     C                     ADD  1         @@E              *1
     C                     END                             E1
     C*
     C**  Move integer portion of amount to @E.
     C                     Z-ADD0         @@CNT1
     C                     Z-ADD0         @@CNT2
     C*
     C           @@C       DOWGT@@E                        B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     ADD  1         @@CNT1           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C*
     C**  Insert thousand separators.
     C           @@CNT1    DIV  3         @@RES            *1
     C                     MVR            @@REMD           *1
     C           @@REMD    IFEQ 0                          B*2
     C           @@CNT2    ANDLT5                          **2
     C*********************MOVE*IDTHSP****@E,@@D*************2************S01319
     C                     MOVE BNTHSP    @E,@@D           **2            S01319
     C                     ADD  1         @@CNT2           **2
     C                     Z-ADD@@D       @@F              **2
     C                     SUB  1         @@D              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Move last character.
     C                     MOVE @D,@@C    @E,@@D
     C*
     C**  Calculate the number of characters that must be returned.
     C           22        SUB  @@D       @@CMOV
     C           @@CMOV    SUB  @@CNT2    @@MRET
     C*
     C**  If number of characters to be returned is greater than the
     C**  number that must be returned.
     C           @@MRET    IFGT @@CRET                     B1
     C*
     C**  Output the required no. of characters, but all '*'.
     C           22        SUB  @@CRET    @@G              *1
     C                     MOVEA*BLANKS   @E               *1
     C                     MOVEA*ALL'*'   @E,@@G           *1
     C                     GOTO ZA1028                     *1
     C                     END                             E1
     C*
     C**  If number of characters moved is greater than number to be
     C**  returned, drop thousand separators until satisfied.
     C           @@CMOV    SUB  @@CRET    @@DIFF
     C           @@DIFF    IFGT 0                          B1
     C                     DO   @@DIFF                     B*2
     C                     Z-ADD1         @@G              **2
     C                     Z-ADD2         @@H              **2
     C           @@G       DOWLE21                         B**3
     C                     MOVE @E,@@G    @C,@@H           ***3
     C                     ADD  1         @@G              ***3
     C                     ADD  1         @@H              ***3
     C           @@G       IFEQ @@F                        B***4
     C                     ADD  1         @@G              ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     MOVEA@C        @E               **2
     C                     ADD  4         @@F              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Tag ZA1028.
     C           ZA1028    TAG                             **ZA1028**
     C*
     C**  Move @E to display field.
     C                     MOVEA@E        @@ADSP
     C*
     C           ZA1029    ENDSR                           **ZA1029**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    -  PROGRAM DUMP                                      *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     SETON                     U7U8LR               S01194
     C*                                                                   S01332
     C** Set up return code for EMSDS                                     S01332
     C*                                                                   S01332
     C           *LOCK     IN   EMSDS                                     S01332
     C                     MOVE 'E'       RETND                           S01332
     C                     OUT  EMSDS                                     S01332
     C                     DUMP
     C*
     C                     END                                            S01194
     C                     ENDSR
     C****************************************************************
      /EJECT
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   FCT - ARRAY OF CONVERSION FACTORS
0001
0010
0100
1000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
** @YD  USED BY SR. ZA0680 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0680 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ERR ARRAY OF ERROR MESSAGES
ENTER CUSTOMER                          INVALID CUSTOMER NUMBER
INVALID SHORTNAME                       *NO LIMITS HELD FOR THIS CUSTOMER*
VALUE MUST BE 'B' OR 'O'                CANNOT ENTER BOTH BRANCH AND COMPANY
INVALID BRANCH CODE                     INVALID COMPANY CODE
USER NOT AUTHORISED TO BRANCH           USER NOT AUTHORISED TO COMPANY
NO VALID COMPANY FOR USER               NO VALID BRANCH FOR USER
VALUE MUST BE 'B'                       USER DOES NOT HAVE BANK LEVEL AUTHORITY
**   POWER - POWERS OF 10 FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
