0001 H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Deals Transaction Index Extract')
0002 F********************************************************************
     F*                                                                  *
     F*  Midas - Dealing Module
0004 F*                                                                  *
0005 F*     DL0300  -  PAY/RECEIVE EXTRACT                               *
0006 F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
0008 F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 E19344             Date 24Jul90               *
     F*                 LN0135             Date 22MAY90               *S01117
     F*                    S01117             DATE  28/02/89             *S01117
     F*                    S01194             DATE  28/02/89             *S01194
     F*                    E11580             DATE  30/06/88             *
     F*                    E81284             DATE  28/10/86             *
     F*                                                                  *
0010 F********************************************************************
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*     E19344 - RECORDS CAN BE MISSING FROM DTRIXDD CAUSING CRASH.  *E19344
     F*     LN0135  -  REMOVE 'END OF REPORT' ON AUDIT REPORT            *LN0135
     F*     S01117  -  MULTIBRANCHING                                    *S01117
     F*     S01194  -  NEW STANDING DATA - ADD ACCESS PROGRAMS           *S01194
     F* E0096                                                            *
     F*  PROGRAM AMENDED SO THAT RECORDS WILL BE EXTRACTED TO            *
     F*   DTRIEPH IF THE RELATIVE RECORD NUMBER (RRN) OF THE RECORD      *
     F*   READ IS ( RRLX *LT RRN *LE RRLC ).                             *
     F*   THIS AMENDMENT IS TO SORT OUT A S.W.I.F.T./DL PROBLEM          *
     F*   WITH FIELD 21 (REFERENCE TO RELATED MESSAGE)                   *
     F*   CONSEQUENTLY AT I/C TERMINATION CONFS. MUST BE RUN BEFORE P/R. *
     F*                                                                  *
     F*     E11580 - PAY/RECEIVE IS NOT PRODUCED FOR A DEAL AMENDMENT    *E11580
     F*              WHEN IT IS THE LAST INPUT ON DTRIX.                 *E11580
     F*     E81284 - CHANGE DTRIX TO DTRIXHH AND DTRIXDD                 *E81284
     F*                                                                  *
     F********************************************************************
0011 F/SPACE 3
0012 F*****TABLE   IP  F      96 12AI     2 DISK                          S01194
0012 FSDBANKL1IP  E                    DISK                               S01194
0013 F*TRIX   UF  F      40            DISK                               E81284
0013 FDTRIXHH UF  F      40            DISK                               E81284
0013 FDTRIXDD IF  F      40            DISK                               E81284
     F                                              KRECNO RRN            E19344
0014 FDTRIEHH O   F      40            DISK
0014 FDTRIEPH O   F      40            DISK
0014 FDTRIEZZ O   F      40            DISK
0015 F****DL0300P1O   F  132            PRINTER                     S01124S01117
0015 FDL0300AUO   F     132            PRINTER                            S01117
0016 F/SPACE 3
0017 F* ID F  C  H  L    FUNCTION OF INDICATORS
0018 F**01************INSTALLATION CONTROL DATA REC. 1                    S01194
0019 F**03************S/DTRIX - HEADER
     F* 03            S/DTRIXHH - HEADER
0020 F**04********************- DETAIL
     F* 04            S/DTRIXDD - DETAIL
0021 F*       40      1ST CYCLE IND.
0022 F*       41      CHAIN FAILURE
0024 F********42******HEADER RECORD ON TABLE FILE                         S01194
0025 F*       43      LOOP CONTROL
     F*       50      END OF FILE FOUND ON READ OF DTRIXDD                E19344
0026 F/EJECT
     E                    CPY@    1   1 80
0027 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*1.******         S01194
0028 I***********************************************************         S01194
0030 I**********TABLE***NS  01   1 CD   2 C0   3 C1                       S01194
0031 I*******AND******12 C1  13 C0                                        S01194
0032 I**********                              1   1 RECIT                 S01194
0033 I**********                              2   30RECT                  S01194
0034 I**********                             12  130RCDE                  S01194
0035 I**********                             14  66 TITL                  S01194
0036 I**********                             67  67 DATF                  S01194
0037 I**********                             68  700DFBR                  S01194
0038 I**********                             74  74 MODI1                 S01194
0039 I**********                             75  75 MODI2                 S01194
0040 I**********                             76  76 MODI3                 S01194
0041 I**********                          P  77  790RUND                  S01194
0042 I**********                             80  86 RUNA                  S01194
0043 I**********                             87  870SFLG                  S01194
0044 I**********                          P  90  920LCD                   S01194
0045 I**********                             93  93 CHTP                  S01194
0046 I**********                          P  94  960TNLU                  S01194
0047 I**********                                                          S01194
0048 I********CATCHALL                                                    S01194
0049 I********NS                                                          S01194
0050 I**********                              1   1 RECIT                 S01194
0051 I**********                              2   30RECT                  S01194
0052 I**********                             12  130RCDE                  S01194
0053 I*
0054 I*
0055 I*    DEAL TRANSACTIONS INDEX FILE - HEADER RECORD.
0056 I*
0057 I*TRIX   NS  03   1 CH                                               E81284
0057 IDTRIXHH NS  03   1 CH                                               E81284
0058 I                                        1   1 RECI
0059 I                                        2   2 RCDT
0060 I                                        3   80DLNO
0061 I                                    P   9  110NORE
0062 I                                    P  12  140FLSZ
0063 I                                    P  15  170RRLC
0064 I                                    P  18  200RRNA
0065 I                                    P  21  230RRLX
0066 I                                    P  24  260RRXP
0067 I                                    P  27  290NDLR
0068 I                                    P  30  320NDAR
0069 I                                       33  330STPI
0070 I                                    P  35  370RRNT
0071 I                                    P  38  400TNLU
0072 I*
0073 I* DETAIL REC.
0074 I*       NS  04   1 CD                                               E81284
     IDTRIXDD NS  04   1 CD                                               E81284
0075 I                                        1  40 LOT
0076 I*
0077 I* CATCHALL
0078 I        NS
     I*                                                                   S01117
0079 I/EJECT
0080 C* 1 S T   C Y C L E   P R O C E S S I N G
0081 C***40****************GOTO START                                     S01194
0081 C   40                GOTO MAIN                                      S01194
0082 C                     SETON                     40
     C                     MOVEACPY@      BIS@   80
0083 C                     Z-ADD1         RECIN
0084 C                     Z-ADD2         RECOUT
0085 C                     Z-ADD1         RRN     50
0086 C*          RRN       CHAINDTRIX                41                   E81284
0086 C           RRN       CHAINDTRIXHH              41                   E81284
0087 C  N03                SETON                     LRU7
0088 C   LR                GOTO END                                       S01194
0088 C*********************GOTO END                                       S01194
0089 C*SPACE*3*************                                               S01194
0090 C**I*S***T*A*B*/*I*1***M*I*S*S*I*N*G**                               S01194
0091 C***********START*****TAG                             ** START TAG **S01194
0092 C*********************SETOF                     42                   S01194
0093 C***01****************GOTO MAIN                                      S01194
0094 C***********RECIT*****COMP 'H'                      42               S01194
0095 C***42****************GOTO END                                       S01194
0096 C**N01****************SETON                     LRU7                 S01194
0097 C***LR*U7*************GOTO END                                       S01194
0098 C/SPACE 3
0099 C* E X T R A C T   S / D T R I X   R E C O R D S
0100 C           MAIN      TAG                             ** MAIN TAG **
     C**
     C** IF RRN OF LAST TELEX IS LESS THAN RRN OF LAST CONF.
     C**  THEN PRODUCE EXTRACT RECORDS FOR TELEX RUN
     C**
     C** INITIALISE RRN WORK FIELD
0101 C           RRLX      ADD  1         RRN
     C*                                                                   E11580
     C*  IF DEAL AMENDMENT PRESENT AFTER RRN OF LAST CONFIRMATION ON      E11580
     C*  DTRIX TO INCLUDE IT IN THIS PAY/RECEIVE RUN.                     E11580
     C           NDLR      ADD  NDAR      TNO     50                      E11580
     C                     Z-ADDTNO       RRLC                            E11580
     C*                                                                   E19344
     C** USE SET LOWER LIMITS AND READ INSTEAD OF CHAIN                   E19344
     C*                                                                   E19344
     C           RRN       SETLLDTRIXDD                                   E19344
     C                     READ DTRIXDD                  50               E19344
     C*
     C           RRN       DOWLERRLC
     C           *IN50     ANDEQ'0'                                       E19344
     C**  PRODUCE RECORDS UNTIL RRN OF LAST CONFIRMATION REACHED
0103 C           RECIN     ADD  1         RECIN   50        *
0104 C***********          SETOF                     04     *             E19344
0105 C*          RRN       CHAINDTRIX                41     *             E81284
0105 C***********RRN       CHAINDTRIXDD              41     *       E81284E19344
0106 C***41******          SETON                     LRU7   *             E19344
0107 C***41******          GOTO END                         *             E19344
0108 C   04      RECOUT    ADD  1         RECOUT  50        *
0109 C   04                EXCPT                            *
0110 C***********RRN       ADD  1         RRN               *             E19344
0112 C**N43*               GOTO LOOP                       **ENDLOOP
     C                     READ DTRIXDD                  50               E19344
     C                     END
     C**  LAST P/R PRODUCED WITH RRN EQUAL TO RRN OF LAST CONF.
0113 C                     Z-ADDRRLC      RRNST   50
0114 C                     SETON                     LR
0115 C           END       TAG                             **  END TAG  **
0116 C/SPACE 3
0117 C* L A S T   R E C O R D
     C** IF NO RECORD FOUND AT ALL SET ON U7                              S01194
     CLRN40                SETON                     U7                   S01194
     C*                                                                   S01194
0118 CLR                   Z-ADD1         RRN
0119 C*RNU7      RRN       CHAINDTRIX                41                   E81284
0119 CLRNU7      RRN       CHAINDTRIXHH              41                   E81284
0120 CLR 03NU7             EXCPT
0121 C/EJECT
0122 O***DL0300P1T  203   LR                                        S01124S01117
0122 ODL0300AUT  203   LR                                                 S01117
0123 O***********************************22 'REFERENCE DL0300'            S01117
0123 O                                   24 'REFERENCE DL0300AU'          S01117
0124 O*************************TITL      89                               S01194
0124 O                         BJURPT    89                               S01194
0125 O                                  122 'DATE              PAGE'
0126 O*************************RUNA     112                               S01194
0126 O                         BJMRDT   112                               S01194
0127 O                         PAGE  Z  127
0128 O        T  1     LR
0129 O                                   62 'DEAL TRANSACTIONS INDEX'
0130 O                                   86 'EXTRACT - FILE CONTROLS'
0131 O        T  3     LR
0132 O                                   63 '------------------------'
0133 O                                   86 '-----------------------'
0134 O        T  1     LR
0135 O                                   28 'S/DTRIX - RUN CONTROLS'
0136 O                                   59 'NUMBER'
0137 O        T  2     LR
0138 O                                   28 '----------------------'
0139 O                                   59 'OF RECORDS'
0140 O        T  3     LR
0141 O                                   21 'RECORDS INPUT'
0142 O                         RECIN 3   59
0143 O        T  1     LR
0144 O                                   28 'S/DTRIE - RUN CONTROLS'
0145 O        T  2     LR
0146 O                                   28 '----------------------'
0147 O        T  3     LR
0148 O                                   28 'TOTAL RECORDS OUTPUT'
0149 O                         RECOUT3   59
0150 O        T 33     LR U7
0151 O                                   71 '*** DATABASE ERROR ***'
0152 O*****   T 00     LR                                                 LN0135
0153 O*****                              73 '*** END OF REPORT ***'       LN0135
0154 O/SPACE 3
0155 ODTRIEHH H        1P
0156 O                                    1 'H'
0157 ODTRIEPH E        04
0158 O                         LOT       40
0159 ODTRIEZZ T        LR
0160 O                                    1 'T'
0161 O                         RECOUT     6
0162 O/SPACE 3
     O*TRIX   E        LRN03                                              E81284
     O*TRIXHH E        LRN03                                       E81284 E11580
     ODTRIXHH E        LR 03                                              E11580
0164 O                         RRNST     26P
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
