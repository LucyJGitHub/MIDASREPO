     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA/IRS events file creation')                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FRA/IRS Module                                       *
     F*                                                               *
     F*  DL0401 - EVENTS CREATION FOR FRA/IRS.                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD062110           Date 09Mar24               *
      *  Prev Amend No. MD058815           Date 19Jun23               *
      *                 MD051554           Date 28Sep18               *
      *                 MD055733           Date 03Jul20               *
      *                 MD051152           Date 02Aug18               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 AR743357           Date 06Jul17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 MD039107           Date 01Aug16               *
      *                 CIR018             Date 12Aug14               *
      *                 CIR017             Date 10Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 BUG28009           Date 14Aug10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 CRE026             Date 24May06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CIR014             Date 11May06               *
      *                 215434             Date 26Apr06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9784            Date 06Jan06               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 11Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CAS008             Date 16Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CGL015             Date 15Apr02               *
      *                 217684             Date 12May03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 204923             Date 29Apr02               *
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 191130             Date 18Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CIR007             Date 11May01               *
      *                 151104             Date 14Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CIR003             Date 13Sep00               *
      *                 CIR006             Date 13Sep00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 156954             Date 11Mar99               *
      *                 152870             Date 11Jan99               *
     F*                 134625             Date 05MAY98               *
     F*                 CEU003             Date 28MAR98               *
     F*                 121768             DATE 19FEB98               *
     F*                 112685             DATE 16DEC97               *
     F*                 111790             DATE 16DEC97               *
      *                 098859             DATE 09DEC97               *
     F*                 126017             DATE 13NOV97               *
     F*                 097885             Date 31Jan97               *
     F*                 S01408             Date 02Oct96               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 100140             DATE 27JUN96               *
     F*                 S01408             DATE 11JUN96               *
     F*                 S01408             DATE 11APR96               *
     F*                 S01408             DATE 14MAR96               *
     F*                 S01408             DATE 05FEB96               *
     F*                 091548             DATE 05JAN96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 058188             DATE 09OCT95               *  *
     F*                 078160             DATE 09OCT95               *  *
     F*                 CIR002             DATE 13JUN95               *
     F*                 CIR001             DATE 13JUN95               *
     F*                 S01486             DATE 03FEB95               *
     F*                 066550             DATE 04FEB94               *
     F*                 060995             DATE 02FEB94               *
     F*                 031967             DATE 02FEB94               *
     F*                 046303             DATE 13JAN94               *
     F*                 S01408             DATE 01OCT93               *
     F*                 E36909             DATE 07MAY93               *
     F*                 S01393             DATE 29SEP92               *
     F*                 029001             DATE 29SEP92               *
     F*                 E38323             DATE 29JUL92               *
     F*                 043304             DATE 13AUG92               *
     F*                 040318             DATE 07AUG92               *
     F*                 AUS021             DATE 07AUG92               *
     F*                 E35983 (FUJ808)    DATE 13FEB92               *
     F*                 E28496             DATE 17SEP91               *
     F*                 E26580             DATE 25JUL91               *
     F*                 S01332             DATE 16MAY91               *
     F*                 S01328             DATE 04FEB91               *
     F*                 E22610             DATE 22JUL90               *
     F*                 S01194             DATE 16MAR90               *
     F*                 S01117             DATE 19MAR90               *
     F*                 S01195             DATE 18MAR90               *
     F*                 S01211             DATE 05/05/89              *
     F*                 S01157             DATE 07/12/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD062110 - FRA/IRS: no posting on settlement date in IRS     *
      *             deals.                                            *
      *             Ensure projection is generated for an OIS deal's  *
      *             Interest payment date or Maturity date falling on *
      *             a non-working day.                                *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Applied for MD061152.                             *
      *  MD051554 - Leap Year Fix for interest calculation basis to   *
      *             be used for 1st Jan should not be present in      *
      *             FRA/IRS module.                                   *
      *  MD051152 - FRA/IRS Interest Calculation Basis 6.             *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  AR743357 - Make sure that principal exchanges and interest   *
      *             are correct for CIR003.                           *
      *           - Applied for MD033602                              *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD039107 - Make sure that there is no negative amount in the *
      *             projection.                                       *
      *  CIR018 - Daily Rate Change Frequency on SIRS                 *
      *  CIR017 - SIRS Business Day Conventions for both legs         *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  BUG28009 - GLC0802C 00001                                    *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CIR014 - Mark to Market Cross-currency Interest Rate Swaps   *
      *  215434 - IRS has irregular cash flow.  Initialise CFLA to 0  *
      *           if no further cash flow schedule is present for the *
      *           deal in PF/DLCFSCPD.                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9784 - Incorrect field positions in file EMXT2D2.         *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CAS008 - IAS 39 Enhancements                                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines                                        *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CGL015 - Net Amounts on Events by Nostro.                    *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  204923 - Rate Fix Days Adjustment (OIS)                      *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  191130 - Correction to core fix 111790. Need to restore the  *
      *           previous value of CFLA (XCFLA) only if the interest *
      *           event in process is for the current interest period.*
      *           For future interest period/s, PRDT (ZDAYNO => event *
      *           date) must be applied to the correct CFLA (event    *
      *           amount). Allow cash flows on both sides.            *
      *  CIR007 - Overnight Index Swaps                               *
      *  151104 - Allow up to 900 branches.                           *
      *  CIR003 - Principal Exchange on Cross Currencies IRS          *
      *  CIR006 - Amortisation of Caps/Collars/Floors and Individual  *
      *           Compounding Swaps.                                  *
      *  CIR005 - FRA/IRS Business Day Conventions                    *
      *  CIR004 - Dealing Calculation Method Change                   *
     F*  156954 - Fix 100140 is incomplete.  It doesn't consider if   *
     F*           date format is MMDDYY.                              *
     F*  152870 - Wrong Ccy Sort Sequence causing problem in the      *
     F*           Cash Flow Report                                    *
     F*  134625 - Settlements not using Euro currency.                *
     F*  CEU003 - Settlement currency conversion.  When an event is   *
     F*           written with settlement details and if the          *
     F*           transaction holds a settlement currency, 2 new      *
     F*           events will be generated for each existing          *
     F*           transaction currency event. One is to cancel the    *
     F*           effect of the transaction currency event and the    *
     F*           other will provide a cashflow in settlement ccy.    *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  112685 - Exposure against limits should show the asset leg   *
     F*           for IRS.                                            *
     F*  111790 - Error in retrieving the cash flow amount under      *
     F*           SR/#LCASS (Determine next cash flow schedule).      *
      *  098859 - Correct the check for Parent Customer indicator,    *
      *           use 'P' instead of 'Y' for BBPAIN.                  *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Addition of Core Hook DL0401CP27                       *
     F*  CAC001  -  Profit Centre Accounting Development:             *
     F*             Output profit center to the DL events file.       *
     F*  100140 - Looping problems caused by FRA's fixing on 29th Feb *
     F*           Fix is to ensure that when 1 year is added to 29th  *
     F*           Feb in a leap year, the result is 28th Feb.         *
     F*  S01408 - Core hook DL0401CP26 added                          *
     F*           Core hook DL0401CP25 added                          *
     F*           Core hook DL0401CP24 added                          *
     F*           Core hook DL0401CP23 added                          *
     F*  S01408 - Core hook DL0401CP21 added                          *
     F*           Core hook DL0401CP22 added                          *
     F*  S01408 - Core hook DL0401IIP1 added                          *
     F*           Core hook DL0401CP14 added                          *
     F*           Core hook DL0401CP15 added                          *
     F*           Core hook DL0401CP16 added                          *
     F*           Core hook DL0401CP17 added                          *
     F*           Core hook DL0401CP18 added                          *
     F*           Core hook DL0401CP19 added                          *
     F*           Core hook DL0401CP20 added                          *
     F*  S01408 - Core hook DL0401CCP1 added                          *
     F*           Core hook DL0401CCP2 added                          *
     F*           Core hook DL0401CCP3 added                          *
     F*           Core hook DL0401CCP4 added                          *
     F*           Core hook DL0401CCP5 added                          *
     F*           Core hook DL0401CCP6 added                          *
     F*           Core hook DL0401CCP7 added                          *
     F*           Core hook DL0401CCP8 added                          *
     F*           Core hook DL0401CCP9 added                          *
     F*           Core hook DL0401CP10 added                          *
     F*           Core hook DL0401CP11 added                          *
     F*           Core hook DL0401CP12 added                          *
     F*  091548 - DB error is not reported: only FOOB in DL0400       *
     F*           Fix is update LDA correctly, and produce a dump     *
     F*         - Extend asterisks for deleted code.                  *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  058188 - NOSTRO CODES AND NOSTRO CURRENCIES GET MIXED           *
     F*           CAUSING DATA BASE ERROR WITH SDNOSTPD - ADDED          *
     F*           H SPEC & DUMP AS DB ERROR IS NOT REPORTED.             *
     F*  078160 - Parent fields not being reset in SR/TABCLT             *
     F*           causes errors on DL0761 report                         *
     F*  CIR002 - Compounding of Interest.                            *
     F*  CIR001 - Interest Rate Calendars.                            *
     F*  S01486 - PRIVATE BANKING UPGRADE (RECOMPILE)                 *
     F*  066550 - GLINTC has had historical problems and inaccuracies    *
     F*           and is now externaly descibed and changed to use       *
     F*           ZINTDYZ1. See document atached to error no on GEMS     *
      *  060995 - Settlement sum in FRA was incorrect.  Interest for     *
      *           excess days (due to holidays, etc.) of a one year      *
      *           calculation are calculated separately.  Applied        *
      *           fix 031967 was change to have 10 days for number       *
      *           of excess days.                                        *
      *  031967 - PROBLEMS CAN OCCUR WITH SETTLEMENT SUMS FOR FRAS       *031967
      *           ENTERED WITH MATURITY DATES JUST GREATER THAN 1        *031967
      *           YEAR (DUE TO EXACTLY 1 YEAR BEING A NON-WORKING        *031967
      *           DAY) AS MIDAS WILL CALCULATE THIS SUM USING             031967
      *           2 CALCULATIONS (1 YEAR CALC PLUS EXTRA DAYS            *031967
      *           CALC) RATHER THAN 1 CALC.                              *031967
      *           THIS CAUSES THE INCORRECT AMOUNTS.                     *031967
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  S01408 - Core hook DL0401CVSF added                          *
     F*  E36909 - (ASTEC NO. 038-361)                                 *
     F*           FRA deals with settlement method '01' entered at    *
     F*           time of input and with existing nostro still appear *
     F*           on O/S delivery instruction report, DL0670.         *
     F*           Fix remove validation of counterparty.              *
     F*  S01393 - Amended for Strategic Risk Management Release 2     *
     F*           to ensure that single and cross currency interest   *
     F*           rate swaps are correctly reflected within CENTAUR.  *
     F*           Also amended to correctly reflect the direction     *
     F*           of the nominal cash flow movements on a single      *
     F*           currency IRS.                                       *
     F*  029001 - If 'Upper End Period' is equal to 'Lower End        *
     F*           Period', a divide by Zero error will occur.         *
     F*  E38323 - Recompilation of the program done due to a change   *
     F*           in subroutine ZFWDT                                 *
     F*  043304 - FRA error in calulation of settlement amount for    *
     F*           Settlement formula - U.                             *
     F*  040318 - Settlement Formula for AUD (SETF=A) sometimes       *
     F*           outputs from DLRADS a negative amount; this causes  *
     F*           (eg.) a -ve Receipt which later becomes a Pay.      *
     F*  AUS021 - AUSTRALIAN PRODUCT. Includes two new settlement     *
     F*           formulas for FRAs. Initially includes one for       *
     F*           Australia and one for USA.                          *
     F*  E35983 - Calculation of discounted settlement amounts in     *
     F*           SR.DLRADS is done in wrong order which causes       *
     F*           half-adjust errors and consequent error of +/-      *
     F*           1 cent in settlement amount on confirmation         *
     F*  E28496 - Recompile for SDFAISPD changes (BQHEOC - Hedged     *
     F*           Events on Cashflow removed).                        *
     F*  E26580 - HEDIN (hedging Ind.) needs to be checked for = N    *
     F*           and not <> Y since never set to 'Y' for an IRS.     *
     F*  S01332 - Release 10 EM - recompile due to addition of Value  *
     F*           and Maturity Date fields to Tomorrows Events file   *
     F*  S01328 - FRA/IRS REVALUATION                                 *
     F*  E22610 - In SR DLRADS (calculates discounted settlement      *
     F*           amount for FRA's) discount factor for deals         *
     F*           longer than 1 year should use no. of days from      *
     F*           previous year, not current one.                     *
     F*  S01194 - NEW STANDING DATA CHANGES.                          *
     F*  S01117 - MULTI-BRANCHING CHANGES.                            *
     F*  S01195 - HOLIDAYS PROCESSING.                                *
     F*  S01211 - Strategic Risk Management Incorporation.            *
     F*           Produce dummy cashflow events for non-hedged deals  *
     F*           as well as hedged deals. (NOTE: For SRM use only).  *
     F*  S01157 - SPLIT DEAL TYPE 'RL' INTO DEAL TYPES 'RP', 'RF',    *
     F*           AND 'RR'.                                           *
     F*                                                               *
     F*****************************************************************
      /EJECT
     FDEALSDG IF  E                    DISK
     F*LINT***IF**E*******    K        DISK                               S01194
     F**********  CLINTCAF                          KIGNORE               S01194
     F**********  CLINTCCF                          KIGNORE               S01194
     F**********  CLINTC1F                          KIGNORE               S01194
     F*ABDLEI*IF**E********** K        DISK                               S01194
     F**********  TABLETAF                          KIGNORE               S01194
     F**********  TABTB10F                          KIGNORE               S01194
     F**********  TABTB20F                          KIGNORE               S01194
     F**********  TABTB40F                          KIGNORE               S01194
     F**********  TABTE10F                          KIGNORE               S01194
     F**********  TABTE20F                          KIGNORE               S01194
     F**********  TABTG20F                          KIGNORE               S01194
     F**********  TABLETIF                          KIGNORE               S01194
     F**********  TABLETKF                          KIGNORE               S01194
     F**********  TABLETLF                          KIGNORE               S01194
     F**********  TABLETMF                          KIGNORE               S01194
     F**********  TABLETPF                          KIGNORE               S01194
     F**********  TABLETRF                          KIGNORE               S01194
     F**********  TABLETSF                          KIGNORE               S01194
     F**********  TABLET1F                          KIGNORE               S01194
     F**********  TABLET2F                          KIGNORE               S01194
     F**********  TABLET5F                          KIGNORE               S01194
     F**********  TABLETXF                          KIGNORE               S01194
     FSDBRCHL1IF  E                    DISK                               S01117
     FDLCFSCPDIF  E           K        DISK                           UC  CIR001
     FDLDTSCPDIF  E           K        DISK                           UC  CIR001
     FDLPCSCPDIF  E           K        DISK                           UC  CIR001
     FDLGXSTL0IF  E           K        DISK                               CIR003
      *                                                                                       CLE025
      ** Midas DL Deals Extension File                                                        CLE025
     FDLDEALL5IF  E           K        DISK                                                   CLE025
     F            DLDLDBD0                          KIGNORE                                   CLE025
     F            DLDLDCD0                          KIGNORE                                   CLE025
      *                                                                                       CLE025
     FEVNTXED O   E                    DISK
     FEMTE2E2 O   E                    DISK                           U1
     FEMXT2D2 O   E                    DISK                           U1
     FDLOEVTL2UF  E           K        DISK                      A                            CIR007
     FDLOISRL0UF  E           K        DISK                      A                            CIR007
     F/COPY WNCPYSRC,DL0401F001
      /EJECT
      *----------------------------------------------------------------
      *
      * ID  F  C  H  L    FUNCTION OF INDICATORS
      *
      *       10          AVERAGE RATE METHOD IND ON
      *       11          INITIAL RATE SET IND ON
      *       12          FLOOR RATE PRESENT IND ON
      *       13 & 23     NEGATIVE INTEREST IND ON
      *       14          FEDERAL FUNDS IND ON
      *       15          PARENT IND ON
      *       16          DEAL DATE ACCOUNTING ENTRY IND ON
      *
      *       20          'THEIR' INT PAYMENT DETAILS FOR RS DEALS
      *       21          'THEIR' INT PAYMENT DETAILS FOR RX DEALS
      *
      ********50**********NO*FURTHER*INTEREST*CALCULATION*FOR*RL*DEALS    S01157
      *       50          NO FURTHER INTEREST CALCULATION FOR RP,RR,RF    S01157
      *       51          NO FURTHER INTEREST CALCULATION FOR RS DEALS
      *       52          NO FURTHER INTEREST CALCULATION FOR RX DEALS
      *       55          ARRAY IND  FOR BR,CO,IC                         S01117
      *
      *       60          WORK INDICATOR - PRODUCE EVENT RECORS (C1/C2)
      *
      *       80          BRANCH FILE IND                                 S01117
      *       89          DLRADS SR. END DATE < MATURITY DATE
      *       90-99       STANDARD SUBROUTINES
      *
      *       U1          EXPOSURE MANAGEMENT MODULE PRESENT
      *       U7          DATABASE ERROR
      *
      *----------------------------------------------------------------
      /EJECT
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3
     E*****               ZHC        50  3               ZFREQ SR. ARRAY  S01195
     E*****               ZFMD   12  12  2               ZFREQ SR. ARRAY  S01195
     E                    ZHC        50  3               @FREQB SR. ARRAY S01195
     E                    ZFMD   12  12  2               @FREQB SR. ARRAY S01195
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
      *                                                                   S01117
      **  Array for branch, company & internal customer no.               S01117
     E***********         BR        100  3               BRANCH CO S01117 151104
     E***********         CO        100  3               COMPANY CDS01117 151104
     E***********         IC        100  6               INTRNL CUSS01117 151104
     E                    BR        900  3               BRANCH CO        151104
     E                    CO        900  3               COMPANY CDS      151104
     E                    IC        900  6               INTRNL CUST NO   151104
     E*                                                                   S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      *                                                                   066550
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E*                                                                   S01195
     IDEALSDGF
     I              RECI                            RECID
     I              FACO                            WFACO
     IDLPCSCD0                                                            CIR001
     I              DLNO                            PCDLNO                CIR001
     I              OTIN                            PCOTIN                CIR001
     I*ABTB70F********************                                        S01194
     I*****                                                               S01194
     I***DATA STRUCTURE FOR TABLE FILE CHAINING KEY                       S01194
     I*****                                                               S01194
     I*****       DS                                                      S01194
     I*****                                   1  12 TABKEY                S01194
     I*****                                   9  11 CCYK                  S01194
     I*
     I** DATA STRUCTURE FOR EVENT TYPE
     I*
     I            DS
     I                                        1   4 ETYP
     I                                        3   4 ECOD
     I                                        3   3 WWCOD1                S01393
     I*
     I** DATA STRUCTURE FOR PAY/RECEIVE ACCOUNT
     I*
     I            DS
     I**********                              1  12 WACNT                                     CGL029
     I**********                              1   2 OSAC1                                     CGL029
     I**********                              3  12 OSAC2                                     CGL029
     I                                        1  18 WACNT                                     CGL029
     I                                        1   2 OSAC1                                     CGL029
     I                                        3  18 OSAC2                                     CGL029
     IPCURR       DS                                                      CIR005
      ** Data Structure for Payment Convention Currencies                 CIR005
      *                                                                   CIR005
     I                                        1   3 WCYP1                 CIR005
     I                                        4   6 WCYP2                 CIR005
     I                                        7   9 WCYP3                 CIR005
     I                                       10  12 WCYP4                 CIR005
     I                                       13  15 WCYP5                 CIR005
     I                                       16  18 WCYP6                 CIR005
     I                                       19  21 WCYP7                 CIR005
     I                                       22  24 WCYP8                 CIR005
     I                                       25  27 WCYP9                 CIR005
     I                                       28  30 WCYP0                 CIR005
     I*                                                                   S01194
     ISDFAIS    E DSSDFAISPD                                              S01194
     I** External DS for FWD RATE AGMT/INT RATE SW details                S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** External DS for CURRENCY details                                 S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I** External DS for CUSTOMER details                                 S01194
     I*                                                                   S01194
     ISDCTRY    E DSSDCTRYPD                                              S01194
     I** External DS for COUNTRY details                                  S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I** External DS for GENERAL LEDGER details                           S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** External DS for BANK LEDGER details                              S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACD1                                    CGL029
     I** External DS for NOSTRO details                                   S01194
     I*                                                                   S01194
     ISCSARD    E DSSCSARDPD                                              CIR001
      ** SAR descriptions                                                 CIR001
      *                                                                   CIR001
     ISDMMOD    E DSSDMMODPD                                              CAC001
     I** Module details                                                   CAC001
     I*                                                                   CAC001
     I* Dummy data structures used by ACCESS PROGRAMS                     S01194
     I* (DSSDY only used if file records over 150 chars. long)            S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I**   Local data area to hold database error information
     I*
     I*LDA*********DS******                      256                      S01194
     I*********************                 134 138 DBFILE                S01194
     I*********************                 139 167 DBKEY                 S01194
     I*********************                 168 175 DBPGM                 S01194
     I*********************                 176 1770DBASE                 S01194
     I*DBERR******DS*******                     256                S01194 091548
     ILDA         DS                            256                       091548
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
      *                                                                   S01117
      **  RUNDAT data structure - to access multibranching flag           S01117
     IRUNDAT      DS                                                      S01117
     I                                       13  13 @MBIN                 S01117
      *                                                                                       CIR007
     IULEVNT    E DSEVNTXED                                                                   CIR007
     I              ETYP                            WQETYP                                    CIR007
     I              OSAC1                           WQOSC1                                    CIR007
     I              OSAC2                           WQOSC2                                    CIR007
      *                                                                   S01117
     I**********    'LECalcBasis6LeapYear'C         WPARML                         MD035545 MD051554
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      *                                                                   066550
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I/COPY WNCPYSRC,DL0401IIP1                                           S01408
      *                                                                   066550
     I*                                                                   S01195
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C                     MOVEACPY@      BIS@   80
     C/COPY WNCPYSRC,DL0401C125
     C** PROGRAM IS CALLED FROM DL0400 (DEALING EVENTS CREATION)
     C*
     C           *ENTRY    PLIST
     C                     PARM           DATF    1        DATE FORMAT
     C                     PARM           RUND    50       RUN DATE
     C                     PARM           DNWD    50       DATE NEXT WRK DAY
     C                     PARM           ECD     50       EVENT CONTROL DATE
     C                     PARM           BCCY    3        BASE CCY
     C                     PARM           BCYL    3        LIMIT CCY
     C                     PARM           BCD     10       BASE CCY D.P.
     C                     PARM           LMD     10       LIMIT CCY D.P.
     C                     PARM           TAXR52  52       INT TAX RATE
     C                     PARM           HASHW  150       DEALS HASH
     C                     PARM           HASHD   30       DEALS HASH DEC
     C                     PARM           COUNTD  50       DEALS LIVE REC
     C                     PARM           HASHEW 150       EVNTXED HASH
     C                     PARM           HASHED  30       EVNTXED HASHDEC
     C                     PARM           COUNTE  50       EVNTXED COUNT
     C                     PARM           TNDLR   50       EMTE2E2 COUNT
     C                     PARM           XNDLR   50       EMXT2D2 COUNT
     C                     PARM           ERROR  20        D.B. ERROR FILE NAME
      *                                                                   CIR001
     C           *NAMVAR   DEFN           LDA                             091548
     C/COPY WNCPYSRC,DL0401C001
     C********** *LOCK     IN   LDA                                                    091548 CGL015
     C                     MOVEL'DL0401 ' DBPGM                           091548
     C**********           OUT  LDA                                                    091548 CGL015
     C/COPY WNCPYSRC,DL0401C002
     C*                                                                   091548
     C           IRSDTL    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           RCIP                            CIR001
     C                     KFLD           PRDT                            CIR001
      *                                                                   CIR001
     C           IRSDTP    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           RCIP                            CIR001
      *                                                                   CIR001
     C           IRSCFL    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           PRDT                            CIR001
      *                                                                   CIR001
     C           IRSCFP    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C*
     C* CALCULATE THE TAX RATE
     C*
     C           TAXR52    DIV  100       TAXR    54
     C*
     C** INITIAL PROCESSING
     C*
     C           DATF      COMP 'M'                      98
     C                     EXSR SETUP
      *                                                                   S01117
      **  Read RUNDAT for multibranching ind                              S01117
     C                     IN   RUNDAT                                    S01117
     C           *NAMVAR   DEFN           RUNDAT 13                       S01117
      *                                                                   S01117
      **  Load branch and company codes from SDBRCHPD into array          S01117
     C           1         SETLLSDBRCHL1                                  S01117
     C                     READ SDBRCHL1                 80               S01117
     C***********          Z-ADD1         X       20               S01117 151104
     C                     Z-ADD1         X       30                      151104
      *                                                                   S01117
      **  Load until end of file...                                       S01117
     C           *IN80     DOWEQ'0'                                       S01117
      *                                                                   S01117
     C                     MOVE A8BRCD    BR,X                            S01117
     C                     MOVE A8CMCD    CO,X                            S01117
     C                     MOVE A8BICN    IC,X                            S01117
     C                     ADD  1         X                               S01117
      *                                                                   S01117
     C                     READ SDBRCHL1                 80               S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      **  Set up ENTITY level fields                                      S01117
     C                     MOVE 'B'       ELVB                            S01117
     C                     MOVE 'C'       ELVC                            S01117
     C                     MOVE 'S'       ELVS                            S01117
      *                                                                   S01117
      ** Obtain BANK details via ACCESS PROGRAM                           S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     Z-ADD7         DBASE            * DBERR 07 *   091548
     C                     MOVEL@OPTN     DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'07'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C                     MOVEL'401/07 -'ERROR                           S01194
     C                     MOVE @OPTN     ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   CIR001
      ** Access AOSARDR0 to check if CIR001 is switched on                CIR001
      *                                                                   CIR001
     C                     CALL 'AOSARDR0'                                CIR001
     C                     PARM *BLANKS   @RTCD   7                       CIR001
     C                     PARM '*VERIFY' @OPTN   7                       CIR001
     C                     PARM 'CIR001'  @SARD   6                       CIR001
     C           SCSARD    PARM SCSARD    DSFDY                           CIR001
      *                                                                   CIR001
     C           @RTCD     IFEQ *BLANKS                                   CIR001
     C                     MOVE 'Y'       CIR001  1                       CIR001
     C                     OPEN DLCFSCPD                                  CIR001
     C                     OPEN DLDTSCPD                                  CIR001
     C                     OPEN DLPCSCPD                                  CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'N'       CIR001                          CIR001
     C                     END                                            CIR001
      *                                                                   CIR002
      ** Access AOSARDR0 to check if CIR002 is switched on                CIR002
      *                                                                   CIR002
     C                     CALL 'AOSARDR0'                                CIR002
     C                     PARM *BLANKS   @RTCD   7                       CIR002
     C                     PARM '*VERIFY' @OPTN   7                       CIR002
     C                     PARM 'CIR002'  @SARD   6                       CIR002
     C           SCSARD    PARM SCSARD    DSFDY                           CIR002
      *                                                                   CIR002
     C           @RTCD     IFEQ *BLANKS                                   CIR002
     C                     MOVE 'Y'       CIR002  1                       CIR002
     C                     ELSE                                           CIR002
     C                     MOVE 'N'       CIR002                          CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C061
     C*                                                                   CEU003
     C**   Check EMU switchable feature CEU003 in SCSARDPD file.          CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN CIR002    CEU003                          CEU003
     C*                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD                           CEU003
     C                     PARM '*VERIFY' @OPTN                           CEU003
     C                     PARM 'CEU003'  @SARD                           CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
     C*                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003                          CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR004
      ** Access Switchable Features Details                               CIR004
      *                                                                   CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   PRTCD   7                       CIR004
     C                     PARM '*VERIFY 'POPTN   7                       CIR004
     C                     PARM 'CIR004'  PSARD   6                       CIR004
     C           SCSARD    PARM SCSARD    DSFDY                           CIR004
     C           PRTCD     IFEQ *BLANKS                                   CIR004
     C                     MOVE 'Y'       CIR004  1                       CIR004
     C                     ELSE                                           CIR004
     C                     MOVE 'N'       CIR004                          CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR005
      ** Check if switchable feature CIR005 is switched on                CIR005
      *                                                                   CIR005
     C                     CALL 'AOSARDR0'                                CIR005
     C                     PARM *BLANKS   @RTCD                           CIR005
     C                     PARM '*VERIFY' @OPTN                           CIR005
     C                     PARM 'CIR005'  @SARD                           CIR005
     C           SCSARD    PARM SCSARD    DSFDY                           CIR005
      *                                                                   CIR005
     C           @RTCD     IFNE *BLANK                                    CIR005
     C           @RTCD     ANDNE'*NRF   '                                 CIR005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CIR005
     C                     Z-ADD14        DBASE            * DBERR 14 *   CIR005
     C                     MOVEL'CIR005'  DBKEY            ************   CIR005
     C                     MOVEL'401/14 -'ERROR                           CIR005
     C                     MOVE 'CIR005'  ERROR                           CIR005
     C                     EXSR *PSSR                                     CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           @RTCD     IFEQ *BLANKS                                   CIR005
     C                     MOVE 'Y'       CIR005  1                       CIR005
     C                     ELSE                                           CIR005
     C                     MOVE 'N'       CIR005                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR006
      ** Determine if SAR CIR006 is installed                             CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY '@OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD                           CIR006
     C           SCSARD    PARM SCSARD    DSFDY                           CIR006
      *                                                                   CIR006
     C           @RTCD     IFNE *BLANKS                                   CIR006
     C           @RTCD     ANDNE'*NRF   '                                 CIR006
     C                     MOVEL'SCSARDPD'DBFILE                          CIR006
     C                     Z-ADD15        DBASE                           CIR006
     C                     MOVEL'CIR006'  DBKEY                           CIR006
     C                     MOVEL'401/15 -'ERROR                           CIR006
     C                     MOVE 'CIR006'  ERROR                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR003
      ** Determine if SAR CIR003 is installed                             CIR003
      *                                                                   CIR003
     C                     CALL 'AOSARDR0'                                CIR003
     C                     PARM *BLANKS   @RTCD                           CIR003
     C                     PARM '*VERIFY '@OPTN                           CIR003
     C                     PARM 'CIR003'  @SARD                           CIR003
     C           SCSARD    PARM SCSARD    DSFDY                           CIR003
      *                                                                   CIR003
     C           @RTCD     IFNE *BLANKS                                   CIR003
     C           @RTCD     ANDNE'*NRF   '                                 CIR003
     C                     MOVEL'SCSARDPD'DBFILE                          CIR003
     C                     Z-ADD16        DBASE                           CIR003
     C                     MOVEL'CIR003'  DBKEY                           CIR003
     C                     MOVEL'401/16 -'ERROR                           CIR003
     C                     MOVE 'CIR003'  ERROR                           CIR003
     C                     EXSR *PSSR                                     CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           @RTCD     IFEQ *BLANKS                                   CIR003
     C                     MOVE 'Y'       CIR003  1                       CIR003
     C                     ELSE                                           CIR003
     C                     MOVE 'N'       CIR003                          CIR003
     C                     ENDIF                                          CIR003
     C*                                                                   CEU003
      ** Check if CIR017 - Separate Business Day Convention for SIRS                          CIR017
     C                     CALL 'AOSARDR0'                                                    CIR017
     C                     PARM *BLANKS   PRTCD                                               CIR017
     C                     PARM '*VERIFY' POPTN                                               CIR017
     C                     PARM 'CIR017'  PSARD                                               CIR017
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR017
      **                                                                                      CIR017
     C           PRTCD     IFEQ *BLANKS                                                       CIR017
     C                     MOVE 'Y'       CIR017  1                                           CIR017
     C                     ELSE                                                               CIR017
     C                     MOVE 'N'       CIR017                                              CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
      ** Check if CIR018 - Daily Rate Change Frequency on SIRS                                CIR018
     C                     CALL 'AOSARDR0'                                                    CIR018
     C                     PARM *BLANKS   PRTCD                                               CIR018
     C                     PARM '*VERIFY' POPTN                                               CIR018
     C                     PARM 'CIR018'  PSARD                                               CIR018
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR018
      **                                                                                      CIR018
     C           PRTCD     IFEQ *BLANKS                                                       CIR018
     C                     MOVE 'Y'       CIR018  1                                           CIR018
     C                     ELSE                                                               CIR018
     C                     MOVE 'N'       CIR018                                              CIR018
     C                     ENDIF                                                              CIR018
      *                                                                                       CIR018
      ** Determine if SAR CAS008 is installed                                                 CAS008
      *                                                                                       CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   @RTCD                                               CAS008
     C                     PARM '*VERIFY '@OPTN                                               CAS008
     C                     PARM 'CAS008'  @SARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C           @RTCD     IFNE *BLANKS                                                       CAS008
     C           @RTCD     ANDNE'*NRF   '                                                     CAS008
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS008
     C                     Z-ADD30        DBASE                                               CAS008
     C                     MOVEL'CAS008'  DBKEY                                               CAS008
     C                     MOVEL'401/16 -'ERROR                                               CAS008
     C                     MOVE 'CAS008'  ERROR                                               CAS008
     C                     EXSR *PSSR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           @RTCD     IFEQ *BLANKS                                                       CAS008
     C                     MOVE 'Y'       CAS008  1                                           CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE 'N'       CAS008                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Check if CLE025 (Multi-Option Facilities) is on                                      CLE025
      *                                                                                       CLE025
     C                     CALL 'AOSARDR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*VERIFY' POPTN                                               CLE025
     C                     PARM 'CLE025'  PSARD                                               CLE025
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           PRTCD     ANDNE'*NRF   '                                                     CLE025
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE025
     C                     MOVEL'CLE025'  DBKEY                                               CLE025
     C                     Z-ADD30        DBASE                                               CLE025
     C                     MOVEL'401/30 -'ERROR                                               CLE025
     C                     MOVE 'CLE025'  ERROR                                               CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     MOVE 'Y'       CLE025  1                                           CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE 'N'       CLE025                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Check if SAR CIR014 is intalled                                                      CIR014
      *                                                                                       CIR014
     C                     CALL 'AOSARDR0'                                                    CIR014
     C                     PARM *BLANKS   PRTCD                                               CIR014
     C                     PARM '*VERIFY' POPTN                                               CIR014
     C                     PARM 'CIR014'  PSARD                                               CIR014
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR014
      *                                                                                       CIR014
     C           PRTCD     IFNE *BLANKS                                                       CIR014
     C           PRTCD     ANDNE'*NRF   '                                                     CIR014
     C                     MOVEL'SCSARDPD'DBFILE                                              CIR014
     C                     MOVEL'CIR014'  DBKEY                                               CIR014
     C                     Z-ADD31        DBASE                                               CIR014
     C                     MOVEL'401/31 -'ERROR                                               CIR014
     C                     MOVE 'CIR014'  ERROR                                               CIR014
     C                     EXSR *PSSR                                                         CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C           PRTCD     IFEQ *BLANKS                                                       CIR014
     C                     MOVE 'Y'       CIR014  1                                           CIR014
     C                     ELSE                                                               CIR014
     C                     MOVE 'N'       CIR014                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C/COPY WNCPYSRC,DL0401C003
      *                                                                   CIR002
      ** Access AOMMODR0                                                  CAC001
      *                                                                   CAC001
     C                     CALL 'AOMMODR0'                                CAC001
     C                     PARM '*MSG   ' @RTCD   7                       CAC001
     C                     PARM '*FIRST ' @OPTN   7                       CAC001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC001
     C*                                                                   CAC001
     C           @RTCD     IFNE *BLANK                                    CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'SDMMODPD'DBFILE           ************   CAC001
     C                     Z-ADD10        DBASE            * DBERR 10 *   CAC001
     C                     MOVEL@OPTN     DBKEY            ************   CAC001
     C                     OUT  LDA                                       CAC001
     C                     MOVEL'401/10 -'ERROR                           CAC001
     C                     MOVE @OPTN     ERROR                           CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     END                                            CAC001
      *                                                                   S01117
      ** Obtain GENERAL LEDGER details via ACCESS PROGRAM                 S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01194 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDGELRPD'DBFILE           ************   S01194
     C                     Z-ADD8         DBASE            * DBERR 08 *   091548
     C                     MOVEL@OPTN     DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'08'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C                     MOVEL'401/08 -'ERROR                           S01194
     C                     MOVE @OPTN     ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01194
     C*****                                                               S01194
     C*****                MOVEL'01'      TABKEY                          S01194
     C*****                MOVE '70'      TABKEY                          S01194
     C*****      TABKEY    CHAINTABDLEI              U7                   S01194
     C*****                MOVE *BLANK    TABKEY                          S01194
     C*****                                                               S01194
     C*****      *INU7     IFEQ '1'                                       S01194
     C*****                SETON                     LR                   S01194
     C*****                END                                            S01194
      *                                                                   S01194
      *                                                                   S01194
      ** Obtain FWD RATE AGMT/INT RATE SW details via ACCESS PROGRAM      S01194
     C                     CALL 'AOFAISR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDFAIS    PARM SDFAIS    DSFDY                           S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     LR                   S01194
     C                     END                                            S01194
      **********                                                                   MD035545 MD051554
      ***Retrieve*system*value*setting****************************                 MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C**********           MOVELWPARML    P@OP01                                   MD035545 MD051554
     C**********           CALL 'AOSVALR0'                                         MD035545 MD051554
     C**********           PARM *BLANKS   W0RTCD  7                                MD035545 MD051554
     C**********           PARM           P@OP01 20                                MD035545 MD051554
     C**********           PARM           P@VL01200                                MD035545 MD051554
     C**********           PARM           P@OP02 20                                MD035545 MD051554
     C**********           PARM           P@VL02200                                MD035545 MD051554
     C**********           PARM           P@OP03 20                                MD035545 MD051554
     C**********           PARM           P@VL03200                                MD035545 MD051554
     C**********           PARM           P@OP04 20                                MD035545 MD051554
     C**********           PARM           P@VL04200                                MD035545 MD051554
     C**********           PARM           P@OP05 20                                MD035545 MD051554
     C**********           PARM           P@VL05200                                MD035545 MD051554
     C**********           PARM           P@OP06 20                                MD035545 MD051554
     C**********           PARM           P@VL06200                                MD035545 MD051554
     C**********           PARM           P@OP07 20                                MD035545 MD051554
     C**********           PARM           P@VL07200                                MD035545 MD051554
     C**********           PARM           P@OP08 20                                MD035545 MD051554
     C**********           PARM           P@VL08200                                MD035545 MD051554
     C**********           PARM           P@OP09 20                                MD035545 MD051554
     C**********           PARM           P@VL09200                                MD035545 MD051554
     C**********           PARM           P@OP10 20                                MD035545 MD051554
     C**********           PARM           P@VL10200                                MD035545 MD051554
      **********                                                                   MD035545 MD051554
      ***If*system value is not found then default value to 'N'                    MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C********** W0RTCD    IFNE '       '                                          MD035545 MD051554
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD051554
     C**********           ELSE                                                    MD035545 MD051554
     C**********           MOVELP@VL01    WCALC6                                   MD035545 MD051554
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD051554
      *                                                                   S01195
      ** Initialise ZNRDYS to zero. This will then be used by standard    S01195
      ** subroutine ZFWDT.                                                S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C*
     C/COPY WNCPYSRC,DL0401CCP2                                           S01408
     C*                                                                   S01408
     C** MAIN PROCESSING
     C*
     C           *INLR     DOWNE'1'
     C                     READ DEALSDGF                 LR
     C/COPY WNCPYSRC,DL0401C007
     C*
     C           *INLR     IFNE '1'
     C/COPY WNCPYSRC,DL0401C049
      *                                                                   CIR001
      ** If dealtype is RS or RX and the buy-out value date               CIR001
      ** is not 0, then set maturity date to buy-out value date.          CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C           DTYP      OREQ 'RP'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RR'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RF'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
      *                                                                   CIR001
     C           BOVD      IFNE 0                                         CIR001
     C                     Z-ADDBOVD      MDAT                            CIR001
     C           BOVD      IFLT TNIPD                                     CIR001
     C                     Z-ADDBOVD      TNIPD                           CIR001
     C                     Z-ADDBOVD      TNICD                           CIR001
     C                     END                                            CIR001
     C           BOVD      IFLT UNIPD                                     CIR001
     C                     Z-ADDBOVD      UNIPD                           CIR001
     C                     Z-ADDBOVD      UNICD                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR002
      ** Save values of our and their unsettled interest for exposure     CIR002
      **   events.                                                        CIR002
      *                                                                   CIR002
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C100
     C           DTYP      IFEQ 'RS'                                      CIR002
     C           DTYP      OREQ 'RX'                                      CIR002
     C           DTYP      OREQ 'RP'                                      CIR002
     C           DTYP      OREQ 'RF'                                      CIR002
     C           DTYP      OREQ 'RR'                                      CIR002
     C           OUSI      ADD  OUSA      WOUSI  150                      CIR002
     C           TUSI      ADD  TUSA      WTUSI  150                      CIR002
     C                     ELSE                                           CIR002
     C                     Z-ADD0         WOUSI                           CIR002
     C                     Z-ADD0         WTUSI                           CIR002
     C                     END                                            CIR002
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     Z-ADD0         WOUSI                           CIR002
     C                     Z-ADD0         WTUSI                           CIR002
     C                     END                                            CIR002
     C*                                                                   S01328
     C** SET UP REVALATION DEAL TYPE/SUB TYPE                             S01328
     C*                                                                   S01328
     C                     MOVEL*BLANK    RDTYP                           S01328
     C                     MOVEL*BLANK    RDLST                           S01328
     C                     MOVEL*BLANK    RCLAS                                               CDL038
     C                     MOVEL*BLANK    RSUPR                           S01328
     C           DTYP      IFEQ 'FR'                                      S01328
     C           DTYP      OREQ 'RS'                                      S01328
     C           DTYP      OREQ 'RX'                                      S01328
     C                     MOVELDTYP      RDTYP                           S01328
     C                     MOVELDLST      RDLST                           S01328
     C                     MOVELCLAS      RCLAS                                               CDL038
     C*                                                                   S01328
     C** SET UP SUPPRESS REVALATION INDICATOR                             S01328
     C** (IF DEAL IS A TRADED IRS AND AT LEAST ONE SIDE IS FLOATING RATE) S01328
     C*                                                                   S01328
     C           DTYP      IFNE 'FR'                                      S01328
     C***********HEDIN*****ANDNE'Y'                                 S01328E26580
     C           HEDIN     ANDEQ'N'                                       E26580
     C           UBRTT     IFNE *ZERO                                     S01328
     C           TBRTT     ORNE *ZERO                                     S01328
     C                     MOVEL'Y'       RSUPR                           S01328
     C                     END                                            S01328
     C                     END                                            S01328
     C                     END                                            S01328
      *                                                                   S01117
      ** Set up EXPOSURE INDICATOR                                        S01117
     C                     MOVE *BLANKS   EXEI                            S01117
      *                                                                   S01117
      ** Initialise the associated credit agreement facility details                          CLE025
      *                                                                                       CLE025
     C**********           Z-ADD*ZERO     MCAC                                         CLE025 CSD027
     C                     MOVE *BLANKS   MCAC                                                CSD027
     C                     Z-ADD*ZERO     MCAT                                                CLE025
     C                     Z-ADD*ZERO     MCAS                                                CLE025
      *                                                                                       CLE025
      ** If CLE025 is on, access FRA/IRS Deals Extension file so as to                        CLE025
      ** retrieve and output the associated credit agreement facility details                 CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           CIR014    OREQ 'Y'                                                           CIR014
     C                     MOVE DLNO      WDLNO   6                                           CLE025
     C           WDLNO     CHAINDLDLDGD0             81                                       CLE025
     C           *IN81     IFEQ *OFF                                                          CLE025
     C           CLE025    ANDEQ'Y'                                                           CIR014
     C**********           Z-ADDF1FCCU    MCAC                                         CLE025 CSD027
     C                     MOVE F1FCCU    MCAC                                                CSD027
     C                     Z-ADDF1FACT    MCAT                                                CLE025
     C                     Z-ADDF1FCNO    MCAS                                                CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C/COPY WNCPYSRC,DL0401C012
     C           DTYP      CASEQ'FR'      FRPROC
     C***********DTYP******CASEQ'RL'******RLPROC                          S01157
     C           DTYP      CASEQ'RP'      RLPROC                          S01157
     C           DTYP      CASEQ'RF'      RLPROC                          S01157
     C           DTYP      CASEQ'RR'      RLPROC                          S01157
     C           DTYP      CASEQ'RS'      RSPROC
     C           DTYP      CASEQ'RX'      RXPROC
     C                     END
     C*
     C           RECID     IFEQ 'D'
     C           COUNTD    ADD  1         COUNTD
     C           UPAMT     DIV  1000      ZZAMT
     C                     Z-ADDHASHW     ZZTOTI
     C                     Z-ADDHASHD     ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HASHW
     C                     Z-ADDZZTOTD    HASHD
     C                     END
     C                     END
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C050
     C                     RETRN
     C*
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C** EVENT SR.
     C** PROCEDURE TO FORMAT AND WRITE RECORDS TO EVENT FILE(S)
     C**
     C*   CALLED FROM :- FRCASH,CASHEV,CYNOEV,OSEXEV,FRSETT,RLIPAY,   *
     C*                  DICALC,IMPAY,OURIP,THRIP                     *
     C*   CALLS       :- TABCLT,FIPIP,FIPIR
     C*
     C           EVENT     BEGSR
     C*
     C** IF EVENT AMOUNT ZERO & NOT 'N1', 'N2' EVENT, SUPPRESS EVENT.
     C*
     C           ECOD      IFEQ 'N1'
     C*
     C           ECOD      OREQ 'N2'
     C*
     C           ECOD      ORNE 'N1'
     C           ECOD      ANDNE'N2'
     C           EAMT      ANDNE0
     C*
     C** BLANK OUT SETLEMENT FIELDS
     C*
     C                     MOVE *BLANKS   SETP
     C                     MOVE *BLANKS   TSEN
     C                     MOVE *BLANKS   WACNT            OSAC1/2
     C                     MOVE *BLANKS   FACO
     C                     MOVE *BLANKS   OSBR                            S01117
     C*                                                                   CAC001
     C** If Analytical Accounting Module is not switched on               CAC001
     C/COPY WNCPYSRC,DL0401C098
     C*                                                                   CAC001
     C           BGN0ST    IFNE 'Y'                                       CAC001
     C                     MOVE *BLANKS   PRFC                            CAC001
     C                     END                                            CAC001
     C/COPY WNCPYSRC,DL0401C099
     C*
     C** SET UP FIELDS WHICH ARE THE SAME FOR ALL EVENTS
     C*
     C**********           Z-ADDCNUM      CPCN                                                CSD027
     C                     MOVE CNUM      CPCN                                                CSD027
     C                     MOVE IOIND     INOI
     C                     MOVE UBCXR     DBCR
     C                     TESTB'1'       WDSTI          13 NEG INT IND
     C           *IN13     IFEQ '1'
     C           ECOD      ANDEQ'I1'
     C                     MOVE 'Y'       NGII
     C                     ELSE
     C                     MOVE *BLANK    NGII
     C                     END
     C*
     C** SET EVENT DATE:
     C** - FOR 'FR' MATURITY DATE CASH FLOW EVENTS
     C*
     C           DTYP      IFEQ 'FR'
     C           ETYP      IFEQ '21C2'
     C           ETYP      OREQ '21C3'
     C           ETYP      OREQ '21S2'                                    S01211
     C           ETYP      OREQ '21S3'                                    S01211
     C                     Z-ADDMDAT      EDAT
     C*
     C** - FOR OTHER 'FR' CASH FLOW EVENTS, SET TO VALUE DATE
     C*
     C                     ELSE
     C                     Z-ADDVDAT      EDAT
     C                     END
     C*
     C** - FOR ALL OTHER EVENTS;IF NOT ALREADY SET,SET TO MATURITY DATE
     C*
     C                     ELSE
     C           EDAT      IFEQ *ZERO
     C                     Z-ADDMDAT      EDAT
     C/COPY WNCPYSRC,DL0401C116
     C                     END
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C013
     C                     Z-ADDEDAT      FFVD
     C*
     C** SET EVENT CURRENCY:
     C** - FOR 'RX' CASH FLOW & SETTLEMENT EVENTS, SET ACCORDING TO
     C**   DETAILS BEING PROCESSED
     C*
     C           ETYP      IFEQ '23C1'
     C           ETYP      OREQ '23C2'
     C           ETYP      OREQ '23S1'                                    S01211
     C           ETYP      OREQ '23S2'                                    S01211
     C           ETYP      OREQ '23C3'                                    S01393
     C           ETYP      OREQ '23C4'                                    S01393
     C           ETYP      OREQ '23S3'                                    S01393
     C           ETYP      OREQ '23S4'                                    S01393
     C           ETYP      OREQ '23I1'
     C           ETYP      OREQ '23E1'                                    112685
     C                     MOVE WCUCY     ECCY
     C*
     C** - FOR ALL OTHER EVENTS, SET TO 'OUR' CURRENCY
     C*
     C                     ELSE
     C                     MOVE UCUCY     ECCY
     C                     MOVE PSCY      @SETCY                          CEU003
     C                     END
      *                                                                   CIR001
      ** Up-front fees and buy-outs                                       CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           ETYP      IFEQ '22FE'                                    CIR001
     C           ETYP      OREQ '23FE'                                    CIR001
     C           ETYP      OREQ '24FE'                                    CIR001
     C           UPPR      IFEQ 'P'                                       CIR001
     C                     MOVE UCUCY     ECCY                            CIR001
     C                     MOVE PSCY      @SETCY                          CEU003
     C                     ELSE                                           CIR001
     C                     MOVE TCUCY     ECCY                            CIR001
     C                     MOVE RSCY      @SETCY                          CEU003
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           ETYP      IFEQ '22BO'                                    CIR001
     C           ETYP      OREQ '23BO'                                    CIR001
     C           ETYP      OREQ '24BO'                                    CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           BAPR      IFEQ 'P'                                       CIR001
     C                     MOVE UCUCY     ECCY                            CIR001
     C                     MOVE PSCY      @SETCY                          CEU003
     C                     ELSE                                           CIR001
     C                     MOVE TCUCY     ECCY                            CIR001
     C                     MOVE RSCY      @SETCY                          CEU003
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C*
     C** SET FEDERAL FUNDS INDICATOR:
     C*
     C                     TESTB'2'       UDSTI          14 FED FUNDS IND
     C           *IN14     IFEQ '1'
     C                     MOVE 'F'       FFIN
     C                     ELSE
     C                     MOVE *BLANK    FFIN
     C                     END
     C*
     C** - FOR 'RX' EVENTS, SET ACCORDING TO DETAILS BEING PROCESSED
     C*
     C           DTYP      IFEQ 'RX'
     C           ECCY      IFNE UCUCY
     C                     TESTB'2'       TDSTI          14 FED FUNDS IND
     C           *IN14     IFEQ '1'
     C                     MOVE 'F'       FFIN
     C                     ELSE
     C                     MOVE *BLANK    FFIN
     C                     END
     C                     END
     C                     END
     C*
     C** SET OTHER DATE:
     C** - FOR OUTSTANDING EVENTS; SET TO MATURITY DATE FOR 'FR' DEALS,
     C**   VALUE DATE FOR OTHER DEALS
     C*
     C           ECOD      IFEQ 'O1'
     C           DTYP      IFEQ 'FR'
     C                     Z-ADDMDAT      OTHD
     C                     ELSE
     C                     Z-ADDVDAT      OTHD
     C                     END
     C*
     C** - FOR ALL OTHER EVENTS, SET TO ZERO
     C*
     C                     ELSE
     C                     Z-ADD0         OTHD
     C                     END
     C*
     C** SET OTHER AMOUNT & OTHER CURRENCY:
     C** - FOR 'RX' OUTSTANDING EVENTS, SET TO 'THEIR' PRINCIPAL AMOUNT
     C**   & CURRENCY
     C*
     C           ETYP      IFEQ '23O1'
     C                     Z-ADDTPAMT     OTHA
     C                     MOVE TCUCY     OTHC
     C*
     C** - FOR ALL OTHER EVENTS, SET TO ZERO & BLANK
     C*
     C                     ELSE
     C                     Z-ADD0         OTHA
     C                     MOVE *BLANKS   OTHC
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C008
     C** SET OTHER CURRENCY FED FUNDS INDICATOR:
     C** - FOR 'RX' EVENTS, SET ACCORDING TO OTHER DETAILS
     C**   FOR ALL OTHER EVENTS, SET TO BLANK
     C*
     C                     MOVE *BLANK    OCFF
     C*
     C           DTYP      IFEQ 'RX'
     C           ECCY      IFEQ UCUCY
     C                     TESTB'2'       TDSTI          14 FED FUNDS IND
     C           *IN14     IFEQ '1'
     C                     MOVE 'F'       OCFF
     C                     END
     C                     ELSE
     C*
     C                     TESTB'2'       UDSTI          14 FED FUNDS IND
     C           *IN14     IFEQ '1'
     C                     MOVE 'F'       OCFF
     C                     END
     C                     END
     C                     END
      *                                                                   S01117
      **   Set up COMPANY code for BOOKING branch                         S01117
      **   & set up EVENT BRANCH                                          S01117
     C                     MOVE *BLANKS   COBB                            S01117
     C                     MOVE *BLANKS   ECPY                            S01117
     C                     MOVE BRCA      EBRC                            S01117
      *                                                                   S01117
     C                     Z-ADD1         X                               S01117
     C           BRCA      LOKUPBR,X                     55               S01117
      *                                                                   S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      COBB                            S01117
     C                     MOVE CO,X      ECPY                            S01117
     C                     MOVE IC,X      WRKCNO  6                       S01117
     C                     END                                            S01117
      *                                                                   S01117
      **   Set up COMPANY code for ORIGINATING branch                     S01117
     C                     MOVE *BLANKS   COOB                            S01117
     C                     Z-ADD1         X                               S01117
     C           ORBR      LOKUPBR,X                     55               S01117
      *                                                                   S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      COOB                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      **   Set up multibranching & inter company event fields             S01117
     C                     MOVE 'N'       IBRE                            S01117
     C                     MOVE 'Y'       ICYE                            S01117
      *                                                                   S01117
     C*
     C***ACCESS*TABLE*&*CLINT*FILES*FOR*CURRENCY*&*CLIENT*DETAILS******   S01194
     C** Access files for CURRENCY & CLIENT details                       S01194
     C*
     C*******              MOVE BRCD      SBRCD   3                       S01194
     C                     MOVE BRCA      SBRCA   3                       S01194
     C                     EXSR TABCLT
     C*****                MOVE SBRCD     BRCD                            S01194
     C                     MOVE SBRCA     BRCA                            S01194
     C*
     C** DETERMINE EXCHANGE RATE FOR DBCE ACCORDING TO EVENT CURRENCY
     C*
     C           ECCY      IFEQ UCUCY
     C                     Z-ADDUBCXR     WBCXR  138
     C                     ELSE
     C           ECCY      IFEQ TCUCY
     C                     Z-ADDTBCXR     WBCXR
     C                     END
     C                     END
     C*
     C** DETERMINE DEALT & SPOT BASE CCY EQUIVALENTS OF EVENT AMOUNT
     C** IF EVENT CCY & BASE CCY ARE DIFFERENT
     C*
     C           ECCY      IFNE BCCY
     C           CDECP     SUB  BCD       N       10
     C           N         ADD  4         N
     C***********MDIND*****IFEQ '1'                                       S01117
     C           MDIND     IFEQ 'M'                                       S01117
     C           WBCXR     DIV  POWER,N   WRK159 159
     C           EAMT      MULT WRK159    DBCE      H
     C           XRATE     DIV  POWER,N   WRK159 159
     C           EAMT      MULT WRK159    BCEQ      H
     C                     ELSE
     C           WBCXR     MULT POWER,N   WRK159
     C           EAMT      DIV  WRK159    DBCE      H
     C           XRATE     MULT POWER,N   WRK159
     C           EAMT      DIV  WRK159    BCEQ      H
     C                     END
     C*
     C** IF EVENT CCY & BASE CCY ARE THE SAME, SET BOTH TO EVENT AMOUNT
     C*
     C                     ELSE
     C                     Z-ADDEAMT      DBCE
     C                     Z-ADDEAMT      BCEQ
     C                     END
     C*
     C** DETERMINE SPOT LIMIT CCY EQUIVALENT OF EVENT AMOUNT
     C** IF EVENT CCY & LIMIT CCY ARE DIFFERENT
     C*
     C           ECCY      IFNE BCYL
     C           CDECP     SUB  LMD       N       10
     C           N         ADD  4         N
     C***********MDIND*****IFEQ '1'                                      S01117
     C           MDIND     IFEQ 'M'                                      S01117
     C           LXRAT     DIV  POWER,N   WRK159 159
     C           EAMT      MULT WRK159    LCEQ      H
     C                     ELSE
     C           LXRAT     MULT POWER,N   WRK159
     C           EAMT      DIV  WRK159    LCEQ      H
     C                     END
     C*
     C** IF EVENT CCY & LIMIT CCY ARE THE SAME, SET TO EVENT AMOUNT
     C*
     C                     ELSE
     C                     Z-ADDEAMT      LCEQ
     C                     END
     C*
     C** SET FULL INSTRUCTIONS PRESENT INDICATOR:
     C** - FOR ALL EVENTS OTHER THAN THOSE BELOW, SET TO ' '
     C*
     C                     MOVE ' '       FIPI
     C*
     C** - FOR CURRENCY/NOSTRO SETTLEMENT EVENTS, CHECK RECEIPT DETAILS
     C*
     C           ECOD      IFEQ 'N1'
     C                     EXSR FIPIR
     C                     END
     C*
     C** - FOR NOSTRO SETTLEMENT EVENTS, CHECK PAYMENT DETAILS
     C*
     C           ECOD      IFEQ 'N2'
     C                     EXSR FIPIP
     C                     END
     C*
     C** - FOR INTEREST PAYMENT SETTLEMENT EVENTS,
     C**   CHECK RECEIPT/PAYMENT DETAILS ACCORDING TO I/O INDICATOR
     C*
     C           ECOD      IFEQ 'I1'
     C           IOIND     IFEQ 'I'
     C                     EXSR FIPIR
     C                     END
     C           IOIND     IFEQ 'O'
     C                     EXSR FIPIP
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0401C004
      *                                                                   CIR003
      ** Process Principal Exchange Events                                CIR003
      *                                                                   CIR003
     C           CIR003    IFEQ 'Y'                                       CIR003
      *                                                                   CIR003
     C           ETYP      IFEQ '23C3'                                    CIR003
     C           ETYP      OREQ '23S3'                                    CIR003
     C           ETYP      OREQ '23C4'                                    CIR003
     C           ETYP      OREQ '23S4'                                    CIR003
      *                                                                   CIR003
      ** Derive new settlement instructions from new file                 CIR003
      *                                                                   CIR003
     C           DLGXST    KLIST                                          CIR003
     C                     KFLD           KDLNO   60                      CIR003
     C                     KFLD           KEDCD   3                       CIR003
      *                                                                                       CAS008
      ** For CAS008 enhancement, allow revaluation for cross currency                         CAS008
      ** principal exchanges.                                                                 CAS008
      *                                                                                       CAS008
     C           CAS008    IFEQ 'Y'                                                           CAS008
     C                     MOVE ' '       RSUPR                                               CAS008
     C                     ENDIF                                                              CAS008
      *                                                                   CIR003
     C                     MOVE DLNO      KDLNO                           CIR003
      *                                                                   CIR003
     C           ETYP      IFEQ '23C3'                                    CIR003
     C           ETYP      OREQ '23S3'                                    CIR003
     C                     MOVE 'VAL'     KEDCD                           CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           ETYP      IFEQ '23C4'                                    CIR003
     C           ETYP      OREQ '23S4'                                    CIR003
     C                     MOVE 'MAT'     KEDCD                           CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           DLGXST    CHAINDLGXSTL0             86                   CIR003
      *                                                                   CIR003
     C           *IN86     IFEQ *ON                                       CIR003
     C                     MOVE KEDCD     WERR    9                       CIR003
     C                     MOVELKDLNO     WERR                            CIR003
     C                     MOVEL'DLGXSTL0'DBFILE                          CIR003
     C                     Z-ADD17        DBASE                           CIR003
     C                     MOVELWERR      DBKEY                           CIR003
     C                     MOVEL'401/17 -'ERROR                           CIR003
     C                     MOVE WERR      ERROR                           CIR003
     C                     EXSR *PSSR                                     CIR003
     C                     ELSE                                           CIR003
      *                                                                   CIR003
      ** Set up necessary settlement fields                               CIR003
      ** Value Date or Principal Increase                                 CIR003
      *                                                                   CIR003
     C           ETYP      IFEQ '23C3'                                    CIR003
     C           ETYP      OREQ '23S3'                                    CIR003
      *                                                                   CIR003
     C           ECCY      IFEQ UCUCY                                     CIR003
     C                     MOVE RXRSTM    SETP                            CIR003
     C                     MOVELRXRONS    WACNT                           CIR003
     C                     MOVE *BLANKS   TSEN                            CIR003
     C                     MOVE *BLANKS   FACO                            CIR003
     C                     MOVELRXROBR    OSBR                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           ECCY      IFEQ TCUCY                                     CIR003
     C                     MOVE RXPSTM    SETP                            CIR003
     C                     MOVELRXPONS    WACNT                           CIR003
     C                     MOVELRXAWBN    TSEN                            CIR003
     C                     MOVELRXBENN    FACO                            CIR003
     C                     MOVELRXPOBR    OSBR                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
      ** Maturity Date or Principal Decrease                              CIR003
      *                                                                   CIR003
     C           ETYP      IFEQ '23C4'                                    CIR003
     C           ETYP      OREQ '23S4'                                    CIR003
      *                                                                   CIR003
     C           ECCY      IFEQ UCUCY                                     CIR003
     C                     MOVE RXPSTM    SETP                            CIR003
     C                     MOVELRXPONS    WACNT                           CIR003
     C                     MOVELRXAWBN    TSEN                            CIR003
     C                     MOVELRXBENN    FACO                            CIR003
     C                     MOVELRXPOBR    OSBR                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           ECCY      IFEQ TCUCY                                     CIR003
     C                     MOVE RXRSTM    SETP                            CIR003
     C                     MOVELRXRONS    WACNT                           CIR003
     C                     MOVE *BLANKS   TSEN                            CIR003
     C                     MOVE *BLANKS   FACO                            CIR003
     C                     MOVELRXROBR    OSBR                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     MOVE OSBR      WSBR                            CIR003
     C                     MOVE 'Y'       FIPI                            CIR003
      *                                                                   CIR003
     C           SETP      IFEQ 00                                        CIR003
     C                     MOVE 'N'       FIPI                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           SETP      IFEQ 01                                        CIR003
     C           SETP      OREQ 07                                        CIR003
     C           SETP      OREQ 08                                        CIR003
     C           SETP      OREQ 02                                        CIR003
     C           SETP      OREQ 05                                        CIR003
     C           SETP      OREQ 12                                        CIR003
     C           SETP      OREQ 14                                        CIR003
      *                                                                   CIR003
     C           WACNT     IFEQ *BLANKS                                   CIR003
     C                     MOVE 'N'       FIPI                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR001
      ** Up-front fees and buy-outs                                       CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           ETYP      IFEQ '22FE'                                    CIR001
     C           ETYP      OREQ '23FE'                                    CIR001
     C           ETYP      OREQ '24FE'                                    CIR001
     C           UPPR      IFEQ 'P'                                       CIR001
     C                     EXSR FIPIP                                     CIR001
     C                     ELSE                                           CIR001
     C                     EXSR FIPIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           ETYP      IFEQ '22BO'                                    CIR001
     C           ETYP      OREQ '23BO'                                    CIR001
     C           ETYP      OREQ '24BO'                                    CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           BAPR      IFEQ 'P'                                       CIR001
     C                     EXSR FIPIP                                     CIR001
     C                     ELSE                                           CIR001
     C                     EXSR FIPIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C/COPY WNCPYSRC,DL0401C075
     C*
     C** WRITE RECORD TO EVNTX FILE, INCREMENT COUNT & HASH TOTALS
     C*
     C                     MOVE RECID     RECI
     C*                                                                   CEU003
     C* For settlement event, if the settlement currency is defined,      CEU003
     C*  use the new routine to output 2 additional records.              CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           @SETCY    ANDNE*BLANKS                                   CEU003
     C           ETYP      IFEQ '21I1'                                    CEU003
     C           ETYP      OREQ '22I1'                                    CEU003
     C           ETYP      OREQ '23I1'                                    CEU003
     C           ETYP      OREQ '24I1'                                    CEU003
     C           ECOD      OREQ 'N1'                                      CEU003
     C           ECOD      OREQ 'N2'                                      CEU003
     C                     EXSR EVNTEU                                    CEU003
     C                     ELSE                                           CEU003
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  CEU003
     C/COPY WNCPYSRC,DL0401C062
     C                     ENDIF                                          CEU003
     C                     ELSE                                           CEU003
     C/COPY WNCPYSRC,DL0401C014
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF
     C/COPY WNCPYSRC,DL0401C063
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C           COUNTE    ADD  1         COUNTE
     C           EAMT      DIV  1000      ZZAMT
     C           ZZAMT     IFLT 0
     C                     Z-SUBZZAMT     ZZAMT
     C                     END
     C                     Z-ADDHASHEW    ZZTOTI
     C                     Z-ADDHASHED    ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HASHEW
     C                     Z-ADDZZTOTD    HASHED
      *
      ** Suppress output of multibranched events for SRM specific         S01393
      ** EVENT types                                                      S01393
      *                                                                   S01393
     C           WWCOD1    IFNE 'S'                                       S01393
     C           WWCOD1    ANDNE'C'                                       S01393
     C           ETYP      OREQ '21C3'                                    S01393
      *
      **  Write out 2 extra EVNTEXD records for deals with non-blank      S01117
      **  SETTLEMENT BRANCH not equal to BOOKING BRANCH                   S01117
      *                                                                   S01117
      **  <===EVENT 2===>                                                 S01117
     C           @MBIN     IFEQ 'Y'                                       S01117
     C           WSBR      ANDNE*BLANKS                                   S01117
     C           WSBR      ANDNEBRCA                                      S01117
     C           IOIND     ANDNE*BLANKS                                   S01117
      *                                                                   S01117
      **  Set EVENT branch to settlement branch                           S01117
     C                     MOVE WSBR      EBRC                            S01117
     C                     MOVE *BLANKS   ECPY                            S01117
     C                     Z-ADD1         X                               S01117
     C           EBRC      LOKUPBR,X                     55               S01117
     C           *IN55     IFEQ '1'                                       S01117
     C                     MOVE CO,X      ECPY                            S01117
     C                     END                                            S01117
     C                     MOVE 'Y'       IBRE                            S01117
      *                                                                   S01117
      **  Set up INTER EVENT company                                      S01117
     C           COBB      IFNE ECPY                                      S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'N'       ICYE                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      **  Write record to EVENT file, increment count & hash totals       S01117
     C                     MOVE RECID     RECI                            S01117
     C/COPY WNCPYSRC,DL0401C096
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  S01117
     C/COPY WNCPYSRC,DL0401C064
      *                                                                   S01117
     C           COUNTE    ADD  1         COUNTE                          S01117
     C           EAMT      DIV  1000      ZZAMT                           S01117
     C           ZZAMT     IFLT 0                                         S01117
     C                     Z-SUBZZAMT     ZZAMT                           S01117
     C                     END                                            S01117
     C                     Z-ADDHASHEW    ZZTOTI                          S01117
     C                     Z-ADDHASHED    ZZTOTD                          S01117
     C                     EXSR GLZADD                                    S01117
     C                     Z-ADDZZTOTI    HASHEW                          S01117
     C                     Z-ADDZZTOTD    HASHED                          S01117
      *                                                                   S01117
      **  <===EVENT 3===>                                                 S01117
     C                     MOVELWRKCNO    @CUNR                           S01117
      *                                                                   S01194
      ** Obtain CUSTOMER details via ACCESS PROGRAM                       S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CUNR  10                       S01194
     C                     PARM *BLANK    @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCUSTPD'DBFILE           ************   S01194
     C                     Z-ADD5         DBASE            * DBERR 05 *   091548
     C                     MOVELCUNR      DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'05'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELCUNR      DBKEY  29                S01194 091548
     C                     MOVEL'401/05 -'ERROR                           S01194
     C                     MOVE CUNR      ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01194
      **  Set EVENT file fields to CUSTOMER file fields                   S01117
     C                     MOVE BBPCNB    PTNU                            S01117
     C                     MOVE BBCRNM    CRNM                            S01117
     C                     MOVE BBCRTN    CTWN                            S01117
     C                     MOVE BBCASC    CASK                            S01117
     C                     MOVE BBCNCZ    CCTZ                            S01117
     C                     MOVE BBCOLC    CLOC                            S01117
     C                     MOVE BBCUST    CUNR                            S01117
      *                                                                   S01117
      **  If parent...                                                    S01117
     C           BBPAIN    IFEQ 'P'                                       S01117
     C                     Z-ADD1         PARI                            S01117
     C                     ELSE                                           S01117
     C                     Z-ADD0         PARI                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      **  If Customer has a parent, obtain parent customer details        S01117
     C           BBPCNB    IFNE ' '                                       S01194
     C                     MOVELBBPCNB    @CPAR                           S01117
      *                                                                   S01194
      ** Obtain PARENT CUSTOMER details via ACCESS PROGRAM                S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CPAR  10                       S01194
     C                     PARM *BLANK    @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCUSTPD'DBFILE           ************   S01194
     C                     Z-ADD6         DBASE            * DBERR 06 *   091548
     C                     MOVELBBPCNB    DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'06'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELBBPCNB    DBKEY  29                S01194 091548
     C                     MOVEL'401/06 -'ERROR                           S01194
     C                     MOVE BBPCNB    ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01117
      **  Set EVENT file fields to PARENT CUSTOMER file fields            S01117
     C                     MOVE BBCRNM    PRNM                            S01117
     C                     MOVE BBCRTN    PTWN                            S01117
     C                     MOVE BBCASC    PASK                            S01117
      *                                                                   S01117
      ** Else customer does not have a parent, blank out fields           S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   PRNM                            S01117
     C                     MOVE *BLANKS   PTWN                            S01117
     C                     MOVE *BLANKS   PASK                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      **  Set up I/O ind                                                  S01117
     C           IOIND     IFEQ 'O'                                       S01117
     C                     MOVE 'I'       INOI                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'O'       INOI                            S01117
     C                     END                                            S01117
     C                     EXSR SRNEG                                                       MD039107
      *                                                                   S01117
      ** Write record to EVENT file, increment count & hash totals        S01117
     C                     MOVE RECID     RECI                            S01117
     C/COPY WNCPYSRC,DL0401C097
     C                     WRITEEVNTXEDF                                  S01117
     C/COPY WNCPYSRC,DL0401C065
      *                                                                   S01117
     C           COUNTE    ADD  1         COUNTE                          S01117
     C           EAMT      DIV  1000      ZZAMT                           S01117
     C           ZZAMT     IFLT 0                                         S01117
     C                     Z-SUBZZAMT     ZZAMT                           S01117
     C                     END                                            S01117
     C                     Z-ADDHASHEW    ZZTOTI                          S01117
     C                     Z-ADDHASHED    ZZTOTD                          S01117
     C                     EXSR GLZADD                                    S01117
     C                     Z-ADDZZTOTI    HASHEW                          S01117
     C                     Z-ADDZZTOTD    HASHED                          S01117
      *                                                                   S01117
     C                     END                                            S01117
      *                                                                   S01393
     C                     END                                            S01393
     C*
     C** PROCESS IF EXPOSURE MANAGEMENT MODULE PRESENT
     C*
     C           *INU1     IFEQ '1'
     C/COPY WNCPYSRC,DL0401C076
     C*
     C** IF EVENT DATE = DATE NEXT WORKING DAY, OUTPUT RECORD TO
     C** EMTE2 (TOMORROW'S EVENTS) FILE
     C*
     C           EDAT      IFEQ DNWD
     C**********           Z-ADDCNUM      MCUN                                                CSD027
     C                     MOVE CNUM      MCUN                                                CSD027
     C                     MOVE ETYP      MEVT
     C                     MOVE ECCY      MEVC
     C                     Z-ADDEAMT      MEVA
     C                     MOVE FCTI      MFCI
     C                     MOVE DTYP      MDTP
     C                     WRITEEMTE2E2F
     C           TNDLR     ADD  1         TNDLR
     C                     END
     C*
     C** IF DEAL DATE ACCOUNTING ENTRY INDICATOR IS ON, OUTPUT
     C** RECORD TO EMXT2 (MASTER FILE EXTRACT)
     C*
     C** THIS OUTPUT IS CONDITIONED ON 'E1' EVENT
     C** SO AS TO PRODUCE ONLY ONE RECORD PER DEAL
     C*
     C           ECOD      IFEQ 'E1'
     C                     TESTB'0'       ACEI           16 DL DATE ACC ENTRY
     C           *IN16     IFEQ '1'
     C**********           Z-ADDCNUM      MCUN                                                CSD027
     C                     MOVE CNUM      MCUN                                                CSD027
     C                     MOVE DTYP      MDTP
     C                     Z-ADDVDAT      MVD
     C                     Z-ADDMDAT      MOMD
     C                     Z-ADD0         MFV
     C                     MOVE FACT      MFTP
     C                     Z-ADD0         MFN
     C                     MOVE PSETM     MSMT
     C                     MOVE UCUCY     MCYC
     C                     Z-ADDUPAMT     MCYA
     C                     MOVE COBB      CMPYM                                              BUG9784
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'L'                                       CIR006
     C/COPY WNCPYSRC,DL0401C101
     C                     ADD  WOUSI     MCYA                            CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C051
     C                     WRITEEMXT2D2F
     C           XNDLR     ADD  1         XNDLR
     C*
     C** FOR CROSS CURRENCY IRS, OUTPUT A SECOND RECORD USING
     C** 'THEIR' DETAILS
     C*
     C           DTYP      IFEQ 'RX'
     C                     MOVE RSETM     MSMT
     C                     MOVE TCUCY     MCYC
     C                     Z-ADDTPAMT     MCYA
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'L'                                       CIR006
     C                     ADD  WTUSI     MCYA                            CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C056
     C                     WRITEEMXT2D2F
     C           XNDLR     ADD  1         XNDLR
     C                     END
     C/COPY WNCPYSRC,DL0401C009
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0401C077
     C                     END
     C*
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C079
     C                     Z-ADD0         EDAT
     C*
     C           ENDEV     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C**
     C** TABCLT SR.
     C***PROCEDURE*TO*CHAIN*TO*TABLE*&*CLINT*FILES*TO*OBTAIN***********   S01194
     C** PROCEDURE TO ACCESS                                              S01194
     C** CURRENCY & CLIENT DETAILS FOR OUTPUT TO EVENT FILE
     C**
     C*   CALLED FROM :- EVENT
     C*   CALLS       :-
     C*
     C           TABCLT    BEGSR
     C*
     C***CHAIN*TO*TABLE*FILE*CURRENCY*RECORD*FOR*DEC**PLACES***********   S01194
     C** CHAIN TO CURRENCY FILE TO ACCESS DEC. PLACES,                    S01194
     C** MULT/DIV IND, RATES FOR BCEQ AND LCEQ CONVERSIONS AND
     C** EVENT CURRENCY SORT SEQUENCE.
     C***IF*DATABASE*ERROR**RETURN*TO*CALLING*PROGRAM******************   S01194
     C*
     C*****                MOVEL'20'      TABKEY                          S01194
     C*****                MOVE ECCY      CCYK                            S01194
     C*****                MOVE '1'       TABKEY                          S01194
     C*****      TABKEY    CHAINTABDLEI              U7                   S01194
     C*****                                                               S01194
     C*****      *INU7     IFEQ '1'                                       S01194
     C*****                MOVEL'401/01 -'ERROR                           S01194
     C*****                MOVE TABKEY    ERROR                           S01194
     C*****      *LOCK     IN   LDA                                       S01194
     C*****                MOVE '01'      DBASE            ***************S01194
     C*****                MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C*****                MOVELTABKEY    DBKEY            *      01     *S01194
     C*****                EXSR DBERR                      ***************S01194
     C*****                END                                            S01194
      *                                                                   S01194
      ** Obtain CURRENCY details via ACCESS PROGRAM                       S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM ECCY      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCURRPD'DBFILE           ************   S01194
     C                     Z-ADD1         DBASE            * DBERR 01 *   091548
     C                     MOVELECCY      DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'01'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELECCY      DBKEY  29                S01194 091548
     C                     MOVEL'401/01 -'ERROR                           S01194
     C                     MOVE ECCY      ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*
     C*****                Z-ADDCDP       CDECP   10                      S01194
     C                     Z-ADDA6NBDP    CDECP   10                      S01194
     C*****                MOVE MDIN      MDIND   1                       S01194
     C                     MOVE A6MDIN    MDIND   1                       S01194
     C*****                Z-ADDSPOT      XRATE  138                      S01194
     C                     Z-ADDA6SPRT    XRATE  138                      S01194
     C*****                Z-ADDERLC      LXRAT  138                      S01194
     C                     Z-ADDA6ERLC    LXRAT  138                      S01194
     C*****                Z-ADDSSNO      ECSS                            S01194
     C                     Z-ADDA6SSNB    ECSS                            S01194
     C*
     C***CHAIN*TO*CLIENT*FILE*FOR*CUSTOMER*DETAILS*********************   S01194
     C***IF*DATABASE*ERROR**RETURN*TO*CALLING*PROGRAM******************   S01194
     C*****                                                               S01194
     C*****      CNUM      CHAINCLINT                U7                   S01194
     C*****                                                               S01194
     C*****      *INU7     IFEQ '1'                                       S01194
     C*****                MOVEL'401/02 -'ERROR                           S01194
     C*****                MOVE CNUM      ERROR                           S01194
     C*****      *LOCK     IN   LDA                                       S01194
     C*****                MOVE '02'      DBASE            ***************S01194
     C*****                MOVE 'CLINT'   DBFILE           *   DBERROR   *S01194
     C*****                MOVELCNUM      DBKEY            *      02     *S01194
     C*****                EXSR DBERR                      ***************S01194
     C*****                END                                            S01194
     C                     MOVELCNUM      @CNUM                           S01117
      *                                                                   S01194
      ** Obtain CUSTOMER details via ACCESS PROGRAM                       S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CNUM  10                       S01194
     C                     PARM *BLANK    @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCUSTPD'DBFILE           ************   S01194
     C                     Z-ADD2         DBASE            * DBERR 02 *   091548
     C                     MOVELCNUM      DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'02'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELCNUM      DBKEY  29                S01194 091548
     C                     MOVEL'401/02 -'ERROR                           S01194
     C                     MOVE CNUM      ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01194
      **  Set EVENT file fields to CUSTOMER file fields                   S01117
     C                     MOVE BBPCNB    PTNU                            S01117
     C                     MOVE BBCRNM    CRNM                            S01117
     C                     MOVE BBCRTN    CTWN                            S01117
     C                     MOVE BBCASC    CASK                            S01117
     C                     MOVE BBCNCZ    CCTZ                            S01117
     C                     MOVE BBCOLC    CLOC                            S01117
     C                     MOVE BBCUST    CUNR                            S01117
     C*
     C*
     C** SET PARENT INDICATOR
     C*
     C*****                TESTB'2'       CMIN           15 PARENT IND    S01194
     C*****      *IN15     IFEQ '1'                                       S01194
     C***********BBPAIN    IFEQ 'Y'                                S01194 098859
     C           BBPAIN    IFEQ 'P'                                       098859
     C                     Z-ADD1         PARI
     C                     ELSE
     C                     Z-ADD0         PARI
     C                     END
     C*
     C***IF CLIENT HAS A PARENT, STORE CLIENT DETAILS & CHAIN AGAIN***    S01194
     C***FOR DETAILS OF PARENT****************************************    S01194
     C***IF DATABASE ERROR, RETURN TO CALLING PROGRAM*****************    S01194
     C*****                                                               S01194
     C*****      CPAR      IFNE 0                                         S01194
     C*****                MOVE CNUM      SCNUM   60                      S01194
     C*****                MOVE CPAR      SCPAR   60                      S01194
     C*****                MOVE CRNM      SCRNM  20                       S01194
     C*****                MOVE CTWN      SCTWN  10                       S01194
     C*****                MOVE CASK      SCASK   8                       S01194
     C*****                MOVE CCTZ      SCCTZ   2                       S01194
     C*****                MOVE CLOC      SCLOC   2                       S01194
     C*****      CPAR      CHAINCLINT                U7                   S01194
     C*****                                                               S01194
     C*****      *INU7     IFEQ '1'                                       S01194
     C*****                MOVEL'401/03 -'ERROR                           S01194
     C*****                MOVE CPAR      ERROR                           S01194
     C*****      *LOCK     IN   LDA                                       S01194
     C*****                MOVE '03'      DBASE            ***************S01194
     C*****                MOVE 'CLINT'   DBFILE           *   DBERROR   *S01194
     C*****                MOVELCPAR      DBKEY            *      03     *S01194
     C*****                EXSR DBERR                      ***************S01194
     C*****                END                                            S01194
     C*****                                                               S01194
     C*****                                                               S01194
     C***SET UP PARENT'S DETAILS THEN MOVE CLIENT DETAILS BACK****        S01194
     C***TO OUTPUT FIELDS*****************************************        S01194
     C*****                                                               S01194
     C*****                MOVE CRNM      PRNM                            S01194
     C*****                MOVE CTWN      PTWN                            S01194
     C*****                MOVE CASK      PASK                            S01194
     C*****                MOVE SCNUM     CNUM                            S01194
     C*****                MOVE SCPAR     CPAR                            S01194
     C*****                MOVE SCRNM     CRNM                            S01194
     C*****                MOVE SCTWN     CTWN                            S01194
     C*****                MOVE SCASK     CASK                            S01194
     C*****                MOVE SCCTZ     CCTZ                            S01194
     C*****                MOVE SCLOC     CLOC                            S01194
      *                                                                   S01117
      **  If Customer has a parent, obtain parent customer details        S01117
     C           BBPCNB    IFNE ' '                                       S01194
     C                     MOVELBBPCNB    @PTNU                           S01117
      *                                                                   S01194
      ** Obtain CUSTOMER details via ACCESS PROGRAM                       S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @PTNU  10                       S01194
     C                     PARM *BLANK    @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCUSTPD'DBFILE           ************   S01194
     C                     Z-ADD3         DBASE            * DBERR 03 *   091548
     C                     MOVELBBPCNB    DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'03'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELBBPCNB    DBKEY  29                S01194 091548
     C                     MOVEL'401/03 -'ERROR                           S01194
     C                     MOVE BBPCNB    ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01117
      **  Set EVENT file fields to PARENT CUSTOMER file fields            S01117
     C                     MOVE BBCRNM    PRNM                            S01117
     C                     MOVE BBCRTN    PTWN                            S01117
     C                     MOVE BBCASC    PASK                            S01117
      *                                                                   078160
      ** Else customer does not have a parent, blank out fields           078160
     C                     ELSE                                           078160
     C                     MOVE *BLANKS   PRNM                            078160
     C                     MOVE *BLANKS   PTWN                            078160
     C                     MOVE *BLANKS   PASK                            078160
      *                                                                   S01117
     C                     END
     C*
     C***CHAIN*TO*COUNTRY*TABLE*FOR*REGION*CODE************************   S01194
     C***IF*DATABASE*ERROR**RETURN*TO*CALLING*PROGRAM******************   S01194
     C*****                                                               S01194
     C*****                MOVEL'50'      TABKEY                          S01194
     C*****                MOVE '    '    TABKEY                          S01194
     C*****                MOVE CCTZ      TABKEY                          S01194
     C*****      TABKEY    CHAINTABDLEI              U7                   S01194
     C*****                                                               S01194
     C*****      *INU7     IFEQ '1'                                       S01194
     C*****                MOVEL'401/04 -'ERROR                           S01194
     C*****                MOVE TABKEY    ERROR                           S01194
     C*****      *LOCK     IN   LDA                                       S01194
     C*****                MOVE '04'      DBASE            ***************S01194
     C*****                MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C*****                MOVELTABKEY    DBKEY            *      04     *S01194
     C*****                EXSR DBERR                      ***************S01194
     C*****                END                                            S01194
      *                                                                   S01194
      ** Obtain COUNTRY details for REGION CODE via ACCESS PROGRAM        S01194
     C                     CALL 'AOCTRYR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CCTZ      @CCTZ   2                       S01194
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01194
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDCTRYPD'DBFILE           ************   S01194
     C                     Z-ADD4         DBASE            * DBERR 04 *   091548
     C                     MOVELCCTZ      DBKEY            ************   091548
     C                     OUT  LDA                                       091548
     C************         MOVEL'04'      DBASE            * DBERR S01194 091548
     C************         MOVEL@OPTN     DBOPTN  7        ********S01194 091548
     C************         MOVELCCTZ      DBKEY  29                S01194 091548
     C                     MOVEL'401/04 -'ERROR                           S01194
     C                     MOVE CCTZ      ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     MOVE A4RGCD    REGC                            S01194
     C*
     C*
     C           ENDTC     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** SETUP SR.
     C** PROCEDURE TO SET UP OUTPUT FIELDS FOR EVENT FILE WHICH ARE
     C** THE SAME FOR ALL EVENTS
     C**
     C*   CALLED FROM :- INITIAL PROCESSING                           *
     C*   CALLS       :-
     C*
     C           SETUP     BEGSR
     C*
     C                     Z-ADD0         NOTD
     C                     Z-ADD0         EXRT
     C                     Z-ADD0         DASN
     C                     Z-ADD0         FACT
     C                     Z-ADD0         FCNO
     C                     Z-ADD0         FSLI
     C                     Z-ADD0         ICIR
     C                     Z-ADD0         ICAM
     C                     Z-ADD0         RBDA
     C                     Z-ADD0         RBDN                                              BUG28009
     C                     Z-ADD0         CGAMT                                             BUG28009
     C                     Z-ADD0         CMAMT                                             BUG28009
     C                     Z-ADD0         ETAX                                              BUG28009
     C                     MOVE 'N'       FCTI
     C                     MOVE 'N'       RLVI
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FIPIR SR.
     C** PROCEDURE TO SET FULL INSTRUCTIONS PRESENT INDICATOR
     C** USING RECEIPT DETAILS
     C**
     C*   CALLED FROM :- EVENT                                        *
     C*   CALLS       :-
     C*
     C           FIPIR     BEGSR
     C*
     C** SET UP SETLEMENT INSTRUCTIONS FIELDS
     C*
     C                     MOVE 'Y'       FIPI
     C                     MOVE RSETM     SETP
     C                     MOVE URACC     WACNT
     C                     MOVE CPPBK     TSEN
     C                     MOVE WFACO     FACO
      *                                                                   S01117
      ** Set up our settlement branch                                     S01117
     C                     MOVE ROBR      OSBR                            S01117
     C*
     C** NO SETTLEMENT INSTRUCTIONS ENTERED - SET TO 'N'
     C*
     C           RSETM     IFEQ 00
     C                     MOVE 'N'       FIPI
     C                     END
     C*
     C** IF SETTLING THROUGH A NOSTRO AND OUR RECEIVE A/C OR
     C** COUNTERPARTY PAYING BANK NOT ENTERED, SET TO 'N'
     C*
     C           RSETM     IFEQ 01
     C           RSETM     OREQ 07
     C           RSETM     OREQ 08
     C           URACC     IFEQ *BLANK
     C                     MOVE 'N'       FIPI
     C                     END
     C***********CPPBK     IFEQ *BLANK                                    E36909
     C***********          MOVE 'N'       FIPI                            E36909
     C***********          END                                            E36909
     C                     END
     C*
     C** IF SETTLING ACROSS AN ACCOUNT AND OUR RECEIVE A/C
     C** NOT ENTERED, SET TO 'N'
     C*
     C           RSETM     IFEQ 02
     C           RSETM     OREQ 05
     C           RSETM     OREQ 12
     C           RSETM     OREQ 14
     C           URACC     IFEQ *BLANK
     C                     MOVE 'N'       FIPI
     C                     END
     C                     END
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C           DTYP      OREQ 'RP'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RR'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RF'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           TINPM     IFEQ 'K'                                       CIR001
     C           TINPM     OREQ 'C'                                       CIR001
     C           EDAT      ANDNEMDAT                                      CIR001
     C           TINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           TINPM     OREQ 'A'                                       CIR006
     C           EDAT      ANDNEMDAT                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     MOVE 'N'       FIPI                            CIR001
     C                     MOVE '00'      SETP                            CIR001
     C                     MOVE *BLANKS   WACNT                           CIR001
     C                     MOVE *BLANKS   TSEN                            CIR001
     C                     MOVE *BLANKS   FACO                            CIR001
     C                     MOVE *BLANKS   OSBR                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FIPIP SR.
     C** PROCEDURE TO SET FULL INSTRUCTIONS PRESENT INDICATOR
     C** USING PAYMENT DETAILS
     C**
     C*   CALLED FROM :- EVENT                                        *
     C*   CALLS       :-
     C*
     C           FIPIP     BEGSR
     C*
     C** SET UP SETLEMENT INSTRUCTIONS FIELDS
     C*
     C                     MOVE 'Y'       FIPI
     C                     MOVE PSETM     SETP
     C                     MOVE UPACC     WACNT
     C                     MOVE CPRBK     TSEN
     C                     MOVE WFACO     FACO
      *                                                                   S01117
      ** Set up our settlement branch                                     S01117
     C                     MOVE POBR      OSBR                            S01117
     C*
     C** NO SETTLEMENT INSTRUCTIONS ENTERED - SET TO 'N'
     C*
     C           PSETM     IFEQ 00
     C                     MOVE 'N'       FIPI
     C                     END
     C*
     C** IF SETTLING THROUGH A NOSTRO AND OUR PAY A/C OR
     C** COUNTERPARTY RECEIVING BANK NOT ENTERED, SET TO 'N'
     C*
     C           PSETM     IFEQ 01
     C           PSETM     OREQ 07
     C           PSETM     OREQ 08
     C           UPACC     IFEQ *BLANK
     C                     MOVE 'N'       FIPI
     C                     END
     C***********CPRBK     IFEQ *BLANK                                    E36909
     C***********          MOVE 'N'       FIPI                            E36909
     C***********          END                                            E36909
     C                     END
     C*
     C** IF SETTLING ACROSS AN ACCOUNT AND OUR PAY A/C
     C** NOT ENTERED, SET TO 'N'
     C*
     C           PSETM     IFEQ 02
     C           PSETM     OREQ 05
     C           PSETM     OREQ 12
     C           PSETM     OREQ 14
     C           UPACC     IFEQ *BLANK
     C                     MOVE 'N'       FIPI
     C                     END
     C                     END
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C           DTYP      OREQ 'RP'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RR'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           DTYP      OREQ 'RF'                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           UINPM     IFEQ 'K'                                       CIR001
     C           UINPM     OREQ 'C'                                       CIR001
     C           EDAT      ANDNEMDAT                                      CIR001
     C           UINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           UINPM     OREQ 'A'                                       CIR006
     C           EDAT      ANDNEMDAT                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     MOVE 'N'       FIPI                            CIR001
     C                     MOVE '00'      SETP                            CIR001
     C                     MOVE *BLANKS   WACNT                           CIR001
     C                     MOVE *BLANKS   TSEN                            CIR001
     C                     MOVE *BLANKS   FACO                            CIR001
     C                     MOVE *BLANKS   OSBR                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FRPROC SR.
     C** MAIN PROCEDURE FOR DEAL TYPE 'FR'
     C**
     C*   CALLED FROM :- MAIN                                         *
     C*   CALLS       :- FRCASH,FRSETT,CYNOEV,OSEXEV,OUR,THEIR        *
     C*
     C           FRPROC    BEGSR
     C*
     C** ONLY PROCESS LIVE & UNSETTLED 'FR' DEALS
     C** SET EVENT CODE
     C*
     C           VDAT      IFGT ECD
     C           RECID     IFEQ 'D'
     C                     MOVEL'21'      ETYP
      *********************                                               S01117
      ***Set*up*ENTITY*CODE                                               S01117
     C*********************MOVE 'R'       EXEI                            S01117
     C*
     C** DETERMINE WHICH DETAILS ARE PRESENT & SET UP WORK FIELDS
     C*
     C           UBRTT     IFEQ 0
     C                     EXSR THEIR
     C                     MOVE 'I'       IOIND   1
     C                     Z-ADDUEINR     WFIXR  117
     C                     Z-ADDTEINR     WFLTR  117
     C                     ELSE
     C                     EXSR OUR
     C                     MOVE 'O'       IOIND
     C                     Z-ADDTEINR     WFIXR  117
     C                     Z-ADDUEINR     WFLTR  117
     C                     END
     C*
     C***GENERATE*CASH*FLOW*DUMMY*EVENTS*FOR*HEDGED*DEALS*IF***           S01211
     C***FIX*DATE*IS*>*NEXT*WORKING*DAY************************           S01211
     C**********                                                          S01211
     C********** HEDIN     IFEQ 'Y'                                       S01211
     C********** WINFD     ANDGTDNWD                                      S01211
     C*                                                                   S01211
     C***Generate*dummy*cashflow*events*if*fix*date*is*>*next***** S01211 S01393
     C** Generate dummy cashflow events if fix date is > or = next        S01393
     C** working day                                                      S01211
     C*                                                                   S01211
     C***********WINFD     IFGT DNWD                               S01211 S01393
     C           WINFD     IFGE DNWD                                      S01393
     C                     EXSR FRCASH
     C                     END
     C*
     C** IF FIX DATE IS > EVENT CONTROL DATE, GENERATE CCY/NOSTRO
     C** DUMMY EVENTS; OTHERWISE GENERATE SETTLEMENT EVENTS
     C*
     C           WINFD     IFGT ECD
     C                     EXSR CYNOEV
     C                     ELSE
     C                     EXSR FRSETT
     C                     END
     C*
     C** GENERATE OUTSTANDING AND EXPOSURE EVENTS
     C*
     C                     EXSR OSEXEV
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RLPROC SR.
     C***MAIN*PROCEDURE*FOR*DEAL*TYPE*'RL'*(CAP/COLLAR)                   S01157
     C** MAIN PROCEDURE FOR DEAL TYPE 'RP', 'RF', AND 'RR'                S01157
     C**
     C*   CALLED FROM :- MAIN                                         *
     C*   CALLS       :- CASHEV,RLSETT,CYNOEV,OSEXEV,OUR,THEIR
     C*
     C           RLPROC    BEGSR
     C*
     C** ONLY PROCESS ACTIVE DEALS. SET EVENT CODE
     C*
     C           RECID     IFEQ 'D'
     C/COPY WNCPYSRC,DL0401C015
     C                     MOVEL'24'      ETYP
      *********************                                               S01117
      ***Set*up*ENTITY*CODE                                               S01117
     C*********************MOVE 'I'       EXEI                            S01117
     C*
     C** PROCESS DETAILS FOR THE PROVIDER OF THE INT. RATE CAP/COLLAR
     C** (PROVIDER HAS NON-ZERO BASE RATE TYPE)
     C*
     C           UBRTT     IFEQ 0
     C                     EXSR THEIR
     C                     Z-ADDTEINR     WEINR
     C                     MOVE 'O'       IOIND
     C                     ELSE
     C                     EXSR OUR
     C                     Z-ADDUEINR     WEINR
     C                     MOVE 'I'       IOIND
     C                     END
     C*
     C***GENERATE*CASH*FLOW*DUMMY*EVENTS*FOR*HEDGED*DEALS***              S01211
     C***IF*FIX*DATE*IS*NON-BLANK***************************              S01211
     C*                                                                   S01211
     C** Generate dummy cashflow events                                   S01211
     C*                                                                   S01211
     C********** HEDIN     IFEQ 'Y'                                       S01211
     C                     EXSR CASHEV
     C**********           END                                            S01211
     C*
     C** CHECK AVERAGE RATE METHOD & INITIAL RATE SET INDICATORS.
     C** IF BOTH ARE ON, GENERATE CCY/NOSTRO DUMMY EVENTS.
     C*
     C                     TESTB'3'       WDSTI          10 AVE RATE METHOD IND
     C                     TESTB'0'       WDNSI          11 INITIAL RATE SET IND
     C*
     C           *IN11     IFEQ '1'
     C           *IN10     IFEQ '1'
     C*
     C** SET EVENT DATE TO NEXT INT. PAY. DATE IF NON-BLANK, ELSE TO
     C** NEXT INT.CHANGE DATE. IF BOTH ARE BLANK, SET IT TO MAT. DATE
     C*
     C           WNIPD     IFNE 0
     C                     Z-ADDWNIPD     EDAT
     C/COPY WNCPYSRC,DL0401C016
     C                     ELSE
     C           WNICD     IFNE 0
     C                     Z-ADDWNICD     EDAT
     C/COPY WNCPYSRC,DL0401C017
     C                     ELSE
     C                     Z-ADDMDAT      EDAT
     C                     END
     C                     END
     C                     EXSR CYNOEV
     C*
     C** IF ARMI IS OFF & IRSI IS ON, GENERATE SETTLEMENT EVENTS
     C*
     C                     ELSE
     C                     EXSR RLSETT
     C                     END
     C                     END
     C*
     C** GENERATE OUTSTANDING AND EXPOSURE EVENTS
     C*
     C                     EXSR OSEXEV
      *                                                                   CIR001
      ** Generate events for up-front fees.                               CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     EXSR #LUPFE                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR006
      ** Generate events for buy-outs.                                    CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C                     EXSR #LBUYE                                    CIR006
     C                     ENDIF                                          CIR006
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RSPROC SR.
     C** MAIN PROCEDURE FOR DEAL TYPE 'RS' (SINGLE CCY IRS)
     C**
     C*   CALLED FROM :- MAIN                                         *
     C*   CALLS       :- CASHEV,RSCFDT,RSSETT,OSEXEV,OUR,THEIR        *
     C*
     C           RSPROC    BEGSR
     C*
     C** ONLY PROCESS ACTIVE DEALS. SET EVENT CODE
     C*
     C           RECID     IFEQ 'D'
     C/COPY WNCPYSRC,DL0401C018
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** Initialise total amount of interest for capitalised interest.    CIR001
      *                                                                   CIR001
     C           *LIKE     DEFN EAMT      WTTOI                           CIR001
     C           *LIKE     DEFN EAMT      WUTOI                           CIR001
      *                                                                   CIR001
     C                     Z-ADD0         WUTOI                           CIR001
     C                     Z-ADD0         WTTOI                           CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVEL'22'      ETYP
      *********************                                               S01117
      ***Set*up*ENTITY*CODE                                               S01117
     C*********************MOVE 'I'       EXEI                            S01117
     C*
      ***Set*Incoming/Outgoing*Indicator*
     C********** HEDIN     IFNE 'N'                                S01211 S01393
     C***********HEDIN     IFEQ 'N'                                S01211 S01393
     C***********          MOVE 'I'       IOIND                    S01211 S01393
      ***********                                                  S01211 S01393
      ***If*(our*base*rate*type*NE*0*and*theirs*EQ*0)*             S01211 S01393
      ***Or*(our*base*rate*type*NE*0*and*theirs*NE*0**             S01211 S01393
      *******and*our*next*rate*change*date*LE*theirs)*             S01211 S01393
     C***********UBRTT     IFNE 0                                  S01211 S01393
     C***********TBRTT     ANDEQ0                                  S01211 S01393
     C***********UBRTT     ORNE 0                                  S01211 S01393
     C***********TBRTT     ANDNE0                                  S01211 S01393
     C***********UNICD     ANDLETNICD                              S01211 S01393
     C***********          MOVE 'O'       IOIND                    S01211 S01393
     C***********          END                                     S01211 S01393
      ***********                                                  S01211 S01393
     C***********          ELSE                                    S01211 S01393
     C***********          MOVE HEDIN     IOIND                           S01393
     C***********          END                                     S01211 S01393
     C***********                                                         S01393
     C***SELECT*DETAILS*FOR*CASH*FLOW*DUMMY*EVENTS*GENERATION*            S01393
     C***********                                                         S01393
     C***IF*'THEIR'*BASE*RATE*TYPE*IS*ZERO*&*'OURS'*IS*NOT,***            S01393
     C***USE*'OUR'*DETAILS*                                               S01393
     C***********                                                         S01393
     C***********UBRTT     IFNE 0                                         S01393
     C***********TBRTT     IFEQ 0                                         S01393
     C***********          EXSR OUR                                       S01393
     C***********          EXSR CASHEV                                    S01393
     C***********                                                         S01393
     C***IF*NEITHER*BASE*RATE*TYPE*IS*ZERO,*                              S01393
     C***SELECT*DETAILS*WITH*EARLIEST*'NEXT*INTEREST*RATE*CHANGE*DATE'*   S01393
     C***********                                                         S01393
     C***DETERMINE*DATES*                                                 S01393
     C***********                                                         S01393
     C***********          ELSE                                           S01393
     C***********          EXSR OUR                                       S01393
     C***********          EXSR RSCFDT                                    S01393
     C***********          Z-ADDEDAT      OURDT   50                      S01393
     C***********          Z-ADD0         EDAT                            S01393
     C***********                                                         S01393
     C***********          EXSR THEIR                                     S01393
     C***********          EXSR RSCFDT                                    S01393
     C***********          Z-ADDEDAT      THRDT   50                      S01393
     C***********          Z-ADD0         EDAT                            S01393
     C***********                                                         S01393
     C***SELECT*DETAILS,*DEFAULT*IS*'OURS'*                               S01393
     C***IF*'THEIR'*DETAILS*SELECTED,*REVERSE*INCOMING/OUTGOING*          S01393
     C***INDICATOR*FOR*CORRECT*REFLECTION*OF*DIRECTION*OF*FUNDS*          S01393
     C***********                                                         S01393
     C***********          EXSR OUR                                       S01393
     C***********                                                         S01393
     C***********THRDT     IFGT 0                                         S01393
     C***********                                                         S01393
     C***********OURDT     IFGT 0                                         S01393
     C***********OURDT     ANDGTTHRDT                                     S01393
     C***********                                                         S01393
     C***********OURDT     OREQ 0                                         S01393
     C***********                                                         S01393
     C***********          EXSR THEIR                                     S01393
     C***********IOIND     IFEQ 'I'                                       S01393
     C***********          MOVE 'O'       IOIND                           S01393
     C***********          ELSE                                           S01393
     C***********          MOVE 'I'       IOIND                           S01393
     C***********          END                                            S01393
     C***********                                                         S01393
     C***********          END                                            S01393
     C***********          END                                            S01393
     C***********                                                         S01393
     C***********          EXSR CASHEV                                    S01393
     C***********                                                         S01393
     C***********          END                                            S01393
     C***********                                                         S01393
     C***IF*'OUR'*BASE*RATE*TYPE*IS*ZERO*&*'THEIRS'*IS*NOT,*              S01393
     C***USE*'THEIR'*DETAILS*&*REVERSE*INCOMING/OUTGOING*INDICATOR*       S01393
     C***FOR*CORRECT*REFLECTION*OF*DIRECTION*OF*FUNDS*                    S01393
     C***********                                                         S01393
     C***********          ELSE                                           S01393
     C***********TBRTT     IFNE 0                                         S01393
     C***********          EXSR THEIR                                     S01393
     C***********IOIND     IFEQ 'I'                                       S01393
     C***********          MOVE 'O'       IOIND                           S01393
     C***********          ELSE                                           S01393
     C***********          MOVE 'I'       IOIND                           S01393
     C***********          END                                            S01393
     C***********          EXSR CASHEV                                    S01393
     C***********          END                                            S01393
     C***********          END                                            S01393
     C**********           END                                            S01211
      *                                                                   S01393
      * Generate Notional Principal Movements                             S01393
      *                                                                   S01393
      * If it is a FIXED/FLOATING IRS i.e. Our Base Rate Type EQ 0        S01393
      * and Their Base Rate Type NE 0 , set I/O Indicator to 'I' and      S01393
      * use Their Details to get Their Next Rate Change Date              S01393
      *                                                                   S01393
     C           UBRTT     IFEQ 0                                         S01393
     C           TBRTT     ANDNE0                                         S01393
     C                     MOVE 'I'       IOIND                           S01393
     C                     EXSR THEIR                                     S01393
     C                     EXSR CASHEV                                    S01393
     C                     END                                            S01393
      *                                                                   S01393
      * If it is a FLOATING/FIXED IRS i.e. Our Base Rate Type NE 0        S01393
      * and Their Base Rate Type EQ 0 , set I/O Indicator to 'O' and      S01393
      * use Our Details to get Our Next Rate Change Date                  S01393
      *                                                                   S01393
     C           UBRTT     IFNE 0                                         S01393
     C           TBRTT     ANDEQ0                                         S01393
     C                     MOVE 'O'       IOIND                           S01393
     C                     EXSR OUR                                       S01393
     C                     EXSR CASHEV                                    S01393
     C                     END                                            S01393
      *                                                                   S01393
      * If it is a FLOATING/FLOATING IRS i.e. Our Base Rate Type NE 0     S01393
      * and Their Base Rate Type NE 0 , select details with earliest      S01393
      * 'Next Interest Rate Change Date'.                                 S01393
      *                                                                   S01393
     C           UBRTT     IFNE 0                                         S01393
     C           TBRTT     ANDNE0                                         S01393
      *                                                                   S01393
      * Determine Our and Their Next Interest Dates                       S01393
      *                                                                   S01393
     C                     EXSR OUR                                       S01393
     C                     EXSR RSCFDT                                    S01393
     C                     Z-ADDEDAT      OURDT   50                      S01393
     C                     Z-ADD0         EDAT                            S01393
      *                                                                   S01393
     C                     EXSR THEIR                                     S01393
     C                     EXSR RSCFDT                                    S01393
     C                     Z-ADDEDAT      THRDT   50                      S01393
     C                     Z-ADD0         EDAT                            S01393
      *                                                                   S01393
      * IF: 'Our Next Interest Change Date' and' Their Next Interest      S01393
      * Change Date' NE 0 and 'Our Next Interest Change Date' > 'Their    S01393
      * Next Interest Change Date'                                        S01393
      * OR                                                                S01393
      * 'Our Next Interest Change Date' EQ 0 and 'Their Next Interest     S01393
      * Change Date' NE 0                                                 S01393
      * THEN: Use Their Details and set I/O Indicator to I                S01393
      *                                                                   S01393
     C           OURDT     IFNE 0                                         S01393
     C           THRDT     ANDNE0                                         S01393
     C           OURDT     ANDGTTHRDT                                     S01393
     C           OURDT     OREQ 0                                         S01393
     C           THRDT     ANDNE0                                         S01393
     C                     MOVE 'I'       IOIND                           S01393
     C                     EXSR THEIR                                     S01393
     C                     EXSR CASHEV                                    S01393
     C                     END                                            S01393
      *                                                                   S01393
      * IF: 'Our Next Interest Change Date' and 'Their Next Interest      S01393
      * Change Date' NE 0 and 'Their Next Interest Change Date' > 'Our    S01393
      * Next Interest Change Date'                                        S01393
      * OR                                                                S01393
      * 'Their Next Interest Change Date' EQ 0 and 'Our Next Interest     S01393
      * Change Date' NE 0                                                 S01393
      * THEN: Use Our Details and set I/O Indicator to O                  S01393
      *                                                                   S01393
     C           OURDT     IFNE 0                                         S01393
     C           THRDT     ANDNE0                                         S01393
     C           THRDT     ANDGTOURDT                                     S01393
     C           THRDT     OREQ 0                                         S01393
     C           OURDT     ANDNE0                                         S01393
     C                     MOVE 'O'       IOIND                           S01393
     C                     EXSR OUR                                       S01393
     C                     EXSR CASHEV                                    S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C*  Generate Additional Events for Floating/Floating single          S01393
     C*  currency IRS's.                                                  S01393
     C*                                                                   S01393
     C                     TESTB'0'       UDNSI          11               S01393
     C*                                                                   S01393
     C           *IN11     IFEQ '1'                                       S01393
     C                     EXSR OUR                                       S01393
     C           UNICD     IFGE UINFD                                     S01393
     C                     Z-ADDUNICD     OURDT                           S01393
     C                     ELSE                                           S01393
     C                     EXSR NXTICD                                    S01393
     C                     Z-ADDWEINR     OURDT                           S01393
     C                     END                                            S01393
     C                     EXSR THEIR                                     S01393
     C           TNICD     IFGE TINFD                                     S01393
     C                     Z-ADDTNICD     THRDT                           S01393
     C                     ELSE                                           S01393
     C                     EXSR NXTICD                                    S01393
     C                     Z-ADDWEINR     THRDT                           S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C           OURDT     IFGT THRDT                                     S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '22S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '22C3'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDTHRDT     EDAT                            S01393
     C                     Z-ADDUPAMT     EAMT                            S01393
     C                     MOVE 'I'       IOIND                           S01393
     C                     EXSR EVENT                                     S01393
     C*                                                                   S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '22S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '22C4'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDOURDT     EDAT                            S01393
     C                     Z-ADDUPAMT     EAMT                            S01393
     C                     MOVE 'O'       IOIND                           S01393
     C                     EXSR EVENT                                     S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C           OURDT     IFLT THRDT                                     S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '22S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '22C3'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDOURDT     EDAT                            S01393
     C                     Z-ADDUPAMT     EAMT                            S01393
     C                     MOVE 'O'       IOIND                           S01393
     C                     EXSR EVENT                                     S01393
     C*                                                                   S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '22S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '22C4'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDTHRDT     EDAT                            S01393
     C                     Z-ADDUPAMT     EAMT                            S01393
     C                     MOVE 'I'       IOIND                           S01393
     C                     EXSR EVENT                                     S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C                     END                                            S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C/COPY WNCPYSRC,DL0401C113
     C*
     C** GENERATE SETTLEMENT EVENTS
     C*
     C                     EXSR RSSETT
     C*
     C** GENERATE OUTSTANDING AND EXPOSURE EVENTS
     C*
     C                     EXSR OSEXEV
      *                                                                   CIR001
      ** Generate events for up-front fees and buy-outs.                  CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     EXSR #LUPFE                                    CIR001
     C                     EXSR #LBUYE                                    CIR001
     C                     END                                            CIR001
     C*
     C/COPY WNCPYSRC,DL0401C053
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RXPROC SR.
     C** MAIN PROCEDURE FOR DEAL TYPE 'RX' (CROSS CCY IRS)
     C**
     C*   CALLED FROM :- MAIN                                         *
     C*   CALLS       :- RXCASH,RXSETT,OSEXEV,OUR,THEIR               *
     C*
     C           RXPROC    BEGSR
     C*
     C** ONLY PROCESS ACTIVE DEALS. SET EVENT CODE
     C*
     C           RECID     IFEQ 'D'
     C/COPY WNCPYSRC,DL0401C019
     C                     MOVEL'23'      ETYP
      *********************                                               S01117
      ***Set*up*ENTITY*CODE                                               S01117
     C*********************MOVE 'I'       EXEI                            S01117
     C*
     C***GENERATE*CASH*FLOW*DUMMY*EVENTS*FOR*HEDGED*DEALS***              S01211
     C*                                                                   S01211
     C** Generate dummy cashflow events                                   S01211
     C*                                                                   S01211
     C********** HEDIN     IFNE 'N'                                       S01211
     C                     EXSR RXCASH
     C**********           END                                            S01211
     C*
     C** SET UP 'OUR' DETAILS AND GENERATE SETTLEMENT EVENTS IF
     C** EITHER BASE RATE TYPE IS NON-ZERO
     C** OR BASE RATE TYPE IS ZERO AND INITIAL RATE SET IND. IS ON
     C*
     C                     EXSR OUR
     C                     MOVE 'O'       IOIND
     C           WBRTT     IFEQ 0
     C                     EXSR RXSETT
     C                     ELSE
     C                     TESTB'0'       WDNSI          11 INITIAL RATE SET IND
     C           *IN11     IFEQ '1'
     C                     EXSR RXSETT
     C                     END
     C                     END
     C*
     C** SET UP 'THEIR' DETAILS AND GENERATE SETTLEMENT EVENTS IF
     C** EITHER BASE RATE TYPE IS NON-ZERO
     C** OR BASE RATE TYPE IS ZERO AND INITIAL RATE SET IND. IS ON
     C*
     C                     EXSR THEIR
     C                     SETON                     21
     C                     MOVE 'I'       IOIND
     C           WBRTT     IFEQ 0
     C                     EXSR RXSETT
     C                     ELSE
     C                     TESTB'0'       WDNSI          11 INITIAL RATE SET IND
     C           *IN11     IFEQ '1'
     C                     EXSR RXSETT
     C                     END
     C                     END
     C                     SETOF                     21
     C*
     C** GENERATE OUTSTANDING AND EXPOSURE EVENTS
     C*
     C                     EXSR OSEXEV
      *                                                                   CIR001
      ** Generate events for up-front fees and buy-outs.                  CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     EXSR #LUPFE                                    CIR001
     C                     EXSR #LBUYE                                    CIR001
     C                     END                                            CIR001
     C*
     C/COPY WNCPYSRC,DL0401C054
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FRCASH SR.
     C** PROCEDURE TO GENERATE CASH FLOW DUMMY EVENTS FOR 'FR' DEALS
     C**
     C*   CALLED FROM :- FRPROC                                       *
     C*   CALLS       :- GLINTC,EVENT                                 *
     C*
     C           FRCASH    BEGSR
     C*
     C** GENERATE VALUE DATE DUMMY PRINCIPAL EVENT
     C*
     C           HEDIN     IFEQ 'Y'                                       S01211
     C                     MOVE 'C1'      ETYP
     C                     ELSE                                           S01211
     C                     MOVE 'S1'      ETYP                            S01211
     C                     END                                            S01211
     C                     Z-ADDUPAMT     EAMT
     C                     EXSR EVENT
     C*
     C** REVERSE INCOMING/OUTGOING INDICATOR
     C*
     C           IOIND     IFEQ 'O'
     C                     MOVE 'I'       IOIND
     C                     ELSE
     C                     MOVE 'O'       IOIND
     C                     END
     C*
     C** GENERATE MATURITY DATE DUMMY PRINCIPAL EVENT
     C*
     C           HEDIN     IFEQ 'Y'                                       S01211
     C                     MOVE 'C2'      ETYP
     C                     ELSE                                           S01211
     C                     MOVE 'S2'      ETYP                            S01211
     C                     END                                            S01211
     C                     Z-ADDUPAMT     EAMT
     C                     EXSR EVENT
     C*
     C** PROCESS GLINTC TO CALCULATE FIXED RATE INTEREST AMOUNT
     C*
     C                     Z-ADDVDAT      ZIBEG
     C                     Z-ADDMDAT      ZIEND
     C                     Z-ADDUICBS     ZICALC
     C                     Z-ADDUPAMT     ZIAMT
     C                     Z-ADDWFIXR     ZIRATE
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP3                                           S01408
     C*                                                                   S01408
     C                     EXSR GLINTC
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP4                                           S01408
     C*
     C                     Z-ADD0         WRKTAX 150
     C*
     C** CALCULATE TAX ON INTEREST AMOUNT IF NECESSARY
     C** & SUBTRACT IT FROM INTEREST AMOUNT
     C*
     C           UBRTT     IFEQ 0
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT ZINTR     WRKTAX    H
     C                     END
     C                     END
     C                     END
     C*
     C           ZINTR     SUB  WRKTAX    EAMT      H
     C*
     C** GENERATE MATURITY DATE DUMMY FIXED INTEREST MOVEMENT EVENT
     C*
     C           HEDIN     IFEQ 'Y'                                       S01211
     C                     MOVE 'C3'      ETYP
     C                     ELSE                                           S01211
     C                     MOVE 'S3'      ETYP                            S01211
     C                     END                                            S01211
     C                     EXSR EVENT
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RSCFDT SR.
     C** PROCEDURE FOR 'RS' DEALS, WHERE BOTH 'OUR' & 'THEIR' RATES
     C** FLOATING, TO FIND WHICH SET OF DETAILS HAVE EARLIEST NEXT
     C** INTEREST RATE CHANGE DATE FOR CASH FLOW EVENT GENERATION.
     C**
     C*   CALLED FROM :- RSPROC
     C****CALLS*******:-*ZFREQB**ZDATE5**************                     S01195
     C*   CALLS       :- @FREQB                                           S01195
     C*
     C           RSCFDT    BEGSR
     C*
     C** IF INT.FIX DATE < OR = VALUE DATE, & > DATE NEXT WORKING DAY
     C** SET EVENT DATE TO VALUE DATE
     C*
     C           WINFD     IFLE VDAT
     C           WINFD     ANDGTDNWD
     C                     Z-ADDVDAT      EDAT
     C/COPY WNCPYSRC,DL0401C117
     C*
     C                     ELSE
     C*
     C** IF NEXT INTEREST RATE CHANGE DATE &/OR INTEREST FIX DATE ZERO
     C** THERE IS NO NEXT INTEREST RATE CHANGE DATE TO BE DETERMINED &
     C** NO FURTHER PROCESSING IS REQUIRED IN THIS PROCEDURE
     C*
     C           WNICD     IFNE 0
     C           WINFD     ANDNE0
     C*
     C*
     C** IF INT. FIX DATE < OR = VDAT, & < OR = DATE NEXT WORKING DAY
     C** SET EVENT DATE TO NEXT INTEREST CHANGE DATE
     C*
     C           WINFD     IFLE VDAT
     C           WINFD     IFLE DNWD
     C                     Z-ADDWNICD     EDAT
     C/COPY WNCPYSRC,DL0401C118
     C                     END
     C*
     C** IF INT. FIX DATE > VDAT AND < OR = DATE NEXT WORKING DAY
     C** OR INT. FIX DATE > VDAT AND > DATE NEXT WORKING DAY AND
     C**                             > NEXT INTEREST RATE CHANGE DATE
     C** THEN - CALCULATE SUBSEQUENT NEXT INTEREST RATE CHANGE DATE
     C*
     C                     ELSE                            WINFD > VDAT
     C*
     C           WINFD     IFLE DNWD
     C           WINFD     ORGT DNWD
     C           WINFD     ANDGTWNICD
     C*
     C           WICFR     IFNE ' '
     C                     MOVE WICFR     ZFREQ
     C                     Z-ADDWICBD     ZDAYNO
     C                     Z-ADDWICFD     ZMDAY
     C*****                MOVE WCUCY     ZCCY                            S01195
     C                     EXSR LOCN                                      S01195
     C*****                EXSR ZFREQB                                    S01195
      *                                                                   CIR005
      ** If Daily Rate Change Frequency then simply add 1 to next                             CIR018
      ** change date                                                                          CIR018
     C           CIR018    IFEQ 'Y'                                                           CIR018
     C           ZFREQ     ANDEQ'D'                                                           CIR018
     C           WNICD     ADD  1         ZDAT                                                CIR018
     C                     ELSE                                                               CIR018
      *                                                                                       CIR018
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C           CIR001    IFNE 'Y'                                       CIR001
     C                     EXSR @FREQB                                    S01195
     C******************** MOVE 'Y'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not Z for date schedule, use @FREQB.             CIR001
      *                                                                   CIR001
     C           ZFREQ     IFNE 'Z'                                       CIR001
     C                     EXSR @FREQB                                    CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** Else determine next date from IRS Date Schedule.                 CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'R'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    ZDYNBR                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM WPDCN     PPDCN   2                       CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT   50                      CIR005
     C                     PARM           PBSDT   50                      CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDYNBR                                    CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDZDYNBR    ZDAT    50
     C                     ENDIF                                                              CIR018
     C*
     C** IF SUBSEQUENT NEXT INTEREST RATE CHANGE DATE CALCULATED, AND
     C** CALCULATED DATE < MATURITY DATE, SET EVENT DATE TO THIS DATE
     C** ELSE THERE IS NO NEXT INTEREST RATE CHANGE DATE
     C*
     C           ZDAT      IFLT MDAT
     C                     Z-ADDZDAT      EDAT
     C/COPY WNCPYSRC,DL0401C119
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** IF INT. FIX DATE > DATE NEXT WORKING DAY AND
     C**                  < OR = NEXT INTEREST RATE CHANGE DATE
     C** SET EVENT DATE TO NEXT INTEREST CHANGE DATE
     C*
     C           WINFD     IFGT DNWD
     C           WINFD     ANDLEWNICD
     C                     Z-ADDWNICD     EDAT
     C/COPY WNCPYSRC,DL0401C120
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RXCASH SR.
     C** PROCEDURE TO CONTROL GENERATION OF CASH FLOW DUMMY EVENTS
     C** FOR 'RX' DEALS
     C**
     C*   CALLED FROM :- RXPROC
     C*   CALLS       :- CASHEV,OUR,THEIR
     C*
     C           RXCASH    BEGSR
     C*
     C** SET INCOMING/OUTGOING INDICATOR TO VALUE OF HEDGE INDICATOR
     C           HEDIN     IFEQ 'N'                                       S01211
     C                     MOVE 'I'       IOIND                           S01211
      *                                                                   S01211
      ** If (our base rate type NE 0 and theirs EQ 0)                     S01211
      ** Or (our base rate type NE 0 and theirs NE 0                      S01211
      **     and our next rate change date LE theirs)                     S01211
     C           UBRTT     IFNE 0                                         S01211
     C           TBRTT     ANDEQ0                                         S01211
     C           UBRTT     ORNE 0                                         S01211
     C           TBRTT     ANDNE0                                         S01211
     C           UNICD     ANDLETNICD                                     S01211
     C                     MOVE 'O'       IOIND                           S01211
     C                     END                                            S01211
      *                                                                   S01211
     C                     ELSE                                           S01211
     C                     MOVE HEDIN     IOIND
     C                     END                                            S01211
      *
     C                     Z-ADD3         XCOUNT  10
     C*
     C** IF 'OUR' BASE RATE TYPE IS ZERO & 'THEIRS' IS NOT, USE 'THEIR'
     C** DETAILS, SET COUNT TO GENERATE ONLY 1 SET OF CASH FLOW EVENTS
     C** & REVERSE INCOMING/OUTGOING INDICATOR FOR CORRECT REFLECTION
     C** OF DIRECTION OF FUNDS
     C*
     C           UBRTT     IFEQ 0
     C           TBRTT     IFNE 0
     C                     EXSR THEIR
     C                     Z-ADD2         XCOUNT
     C           IOIND     IFEQ 'I'
     C                     MOVE 'O'       IOIND
     C                     ELSE
     C                     MOVE 'I'       IOIND
     C                     END
     C                     END
     C*
     C** IF BOTH BASE RATE TYPES ARE NON-ZERO, USE 'OUR' DETAILS
     C** & SET COUNT TO GENERATE TWO SETS OF CASH FLOW EVENTS
     C** ('OURS' IS FIRST)
     C*
     C                     ELSE
     C           TBRTT     IFNE 0
     C                     EXSR OUR
     C                     Z-ADD1         XCOUNT
     C*
     C** IF 'THEIR' BASE RATE TYPE IS ZERO & 'OURS' IS NOT, USE 'OUR'
     C** DETAILS & SET COUNT TO GENERATE ONLY 1 SET OF CASH FLOW EVENTS
     C*
     C                     ELSE
     C                     EXSR OUR
     C                     Z-ADD2         XCOUNT
     C                     END
     C                     END
     C*
     C** CONTINUE PROCESSING UNTIL NO MORE CASH FLOW EVENTS TO GENERATE
     C*
     C           XCOUNT    DOWLE2
     C*
     C** GENERATE CASH FLOW DUMMY EVENTS FOR CURRENT DETAILS
     C** AND INCREMENT COUNT FIELD
     C*
     C                     EXSR CASHEV
     C           XCOUNT    ADD  1         XCOUNT
     C*
     C** IF A SECOND EVENT IS TO BE GENERATED, SET UP 'THEIR' DETAILS
     C** AND RETURN TO BEGINNING OF LOOP
     C*
     C           XCOUNT    IFLE 2
     C                     EXSR THEIR
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0401C005
      *                                                                   CIR003
      ** Generate principal events when CIR003 is switched on.            CIR003
      *                                                                   CIR003
     C           CIR003    IFEQ 'Y'                                       CIR003
      *                                                                   CIR003
      ** Process Our side of the swap                                     CIR003
      *                                                                   CIR003
     C                     EXSR OUR                                       CIR003
      *                                                                   CIR003
     C           VDEI      IFEQ 'Y'                                       CIR003
     C                     MOVE 'I'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S3'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C3'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     MOVE VDAT      EDAT                            CIR003
     C                     MOVE WPAMT     EAMT                            CIR003
     C                     MOVE WCUCY     ECCY                            CIR003
      *                                                                   CIR003
     C           EDAT      IFGE DNWD                                      CIR003
     C                     EXSR EVENT                                     CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C********** MDEI      IFEQ 'Y'                                                  CIR003 AR743357
     C**********           MOVE 'O'       IOIND                                      CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C********** HEDIN     IFEQ 'N'                                                  CIR003 AR743357
     C**********           MOVE '23S4'    ETYP                                       CIR003 AR743357
     C**********           ELSE                                                      CIR003 AR743357
     C**********           MOVE '23C4'    ETYP                                       CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C**********           MOVE MDAT      EDAT                                       CIR003 AR743357
     C**********           MOVE WPAMT     EAMT                                       CIR003 AR743357
     C**********           MOVE WCUCY     ECCY                                       CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C********** EDAT      IFGE DNWD                                                 CIR003 AR743357
     C**********           EXSR EVENT                                                CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      *                                                                   CIR003
      ** Get principal changes from file                                  CIR003
      *                                                                   CIR003
     C           PDEI      IFEQ 'Y'                                       CIR003
     C           UNPCD     ANDNE0                                         CIR003
      *                                                                   CIR003
     C                     MOVE OURTHR    OTIN                            CIR003
     C                     MOVE UNPCD     PRDT                            CIR003
      *                                                                   CIR003
     C********** PCSKEY    SETLLDLPCSCD0               87                            CIR003 AR743357
     C           PCLKEY    SETLLDLPCSCD0               87                                   AR743357
      *                                                                   CIR003
     C           *IN87     IFEQ *OFF                                      CIR003
     C********** PCSKEY    READEDLPCSCD0                 88                          CIR003 AR743357
     C           PCLKEY    READEDLPCSCD0                 88                                 AR743357
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     Z-ADDWPAMT     WWAMT  130                      CIR003
      *                                                                   CIR003
     C           *IN88     DOWNE*ON                                       CIR003
      *                                                                   CIR003
      ** Principal increase, process as if value date                     CIR003
      *                                                                   CIR003
     C           WWAMT     IFLT PAMT                                      CIR003
     C                     MOVE 'I'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S3'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C3'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           PAMT      SUB  WWAMT     EAMT                            CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
      ** Principal decrease, process as if maturity date                  CIR003
      *                                                                   CIR003
     C           WWAMT     IFGT PAMT                                      CIR003
     C                     MOVE 'O'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S4'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C4'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           WWAMT     SUB  PAMT      EAMT                            CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     MOVE WCUCY     ECCY                            CIR003
     C                     MOVE PRDT      EDAT                            CIR003
      *                                                                   CIR003
     C           EDAT      IFGE DNWD                                      CIR003
     C                     EXSR EVENT                                     CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     Z-ADDPAMT      WWAMT                           CIR003
      *                                                                   CIR003
     C********** PCSKEY    READEDLPCSCD0                 88                          CIR003 AR743357
     C           PCLKEY    READEDLPCSCD0                 88                                 AR743357
      *                                                                   CIR003
     C                     ENDDO                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                                     AR743357
     C           MDEI      IFEQ 'Y'                                                         AR743357
     C                     MOVE 'O'       IOIND                                             AR743357
      *                                                                                     AR743357
     C           HEDIN     IFEQ 'N'                                                         AR743357
     C                     MOVE '23S4'    ETYP                                              AR743357
     C                     ELSE                                                             AR743357
     C                     MOVE '23C4'    ETYP                                              AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     MOVE MDAT      EDAT                                              AR743357
      *                                                                                     AR743357
      ** Search for the last principal change date and amount for the                       AR743357
      ** swap.  This is the principal at maturity date.                                     AR743357
      *                                                                                     AR743357
     C           PCLKEY    KLIST                                                            AR743357
     C                     KFLD           DLNO                                              AR743357
     C                     KFLD           OTIN                                              AR743357
      *                                                                                     AR743357
     C           PCLKEY    SETGTDLPCSCD0               87                                   AR743357
      *                                                                                     AR743357
     C           *IN87     IFEQ '0'                                                         AR743357
     C           PCLKEY    REDPEDLPCSCD0                 88                                 AR743357
      *                                                                                     AR743357
     C           *IN88     IFEQ '0'                                                         AR743357
     C                     MOVE PAMT      WPAMT                                             AR743357
     C                     ENDIF                                                            AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     MOVE WPAMT     EAMT                                              AR743357
     C                     MOVE WCUCY     ECCY                                              AR743357
      *                                                                                     AR743357
     C           EDAT      IFGE DNWD                                                        AR743357
     C                     EXSR EVENT                                                       AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     ENDIF                                                            AR743357
      *                                                                   CIR003
      ** Process Their side of the swap                                   CIR003
      *                                                                   CIR003
     C                     EXSR THEIR                                     CIR003
      *                                                                   CIR003
     C           VDEI      IFEQ 'Y'                                       CIR003
     C                     MOVE 'O'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S3'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C3'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     MOVE VDAT      EDAT                            CIR003
     C                     MOVE WPAMT     EAMT                            CIR003
     C                     MOVE WCUCY     ECCY                            CIR003
      *                                                                   CIR003
     C           EDAT      IFGE DNWD                                      CIR003
     C                     EXSR EVENT                                     CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C********** MDEI      IFEQ 'Y'                                                  CIR003 AR743357
     C**********           MOVE 'I'       IOIND                                      CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C********** HEDIN     IFEQ 'N'                                                  CIR003 AR743357
     C**********           MOVE '23S4'    ETYP                                       CIR003 AR743357
     C**********           ELSE                                                      CIR003 AR743357
     C**********           MOVE '23C4'    ETYP                                       CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C**********           MOVE MDAT      EDAT                                       CIR003 AR743357
     C**********           MOVE WPAMT     EAMT                                       CIR003 AR743357
     C**********           MOVE WCUCY     ECCY                                       CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C********** EDAT      IFGE DNWD                                                 CIR003 AR743357
     C**********           EXSR EVENT                                                CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      ****************************************************************               CIR003 AR743357
     C**********           ENDIF                                                     CIR003 AR743357
      *                                                                   CIR003
      ** Get principal changes from file                                  CIR003
      *                                                                   CIR003
     C           PDEI      IFEQ 'Y'                                       CIR003
     C           TNPCD     ANDNE0                                         CIR003
      *                                                                   CIR003
     C                     MOVE OURTHR    OTIN                            CIR003
     C                     MOVE TNPCD     PRDT                            CIR003
      *                                                                   CIR003
     C********** PCSKEY    SETLLDLPCSCD0               87                            CIR003 AR743357
     C           PCLKEY    SETLLDLPCSCD0               87                                   AR743357
      *                                                                   CIR003
     C           *IN87     IFEQ *OFF                                      CIR003
     C********** PCSKEY    READEDLPCSCD0                 88                          CIR003 AR743357
     C           PCLKEY    READEDLPCSCD0                 88                                 AR743357
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     Z-ADDWPAMT     WWAMT                           CIR003
      *                                                                   CIR003
     C           *IN88     DOWNE*ON                                       CIR003
      *                                                                   CIR003
      ** Principal increase, process as if value date                     CIR003
      *                                                                   CIR003
     C           WWAMT     IFLT PAMT                                      CIR003
     C                     MOVE 'O'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S3'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C3'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           PAMT      SUB  WWAMT     EAMT                            CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
      ** Principal decrease, process as if maturity date                  CIR003
      *                                                                   CIR003
     C           WWAMT     IFGT PAMT                                      CIR003
     C                     MOVE 'I'       IOIND                           CIR003
      *                                                                   CIR003
     C           HEDIN     IFEQ 'N'                                       CIR003
     C                     MOVE '23S4'    ETYP                            CIR003
     C                     ELSE                                           CIR003
     C                     MOVE '23C4'    ETYP                            CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           WWAMT     SUB  PAMT      EAMT                            CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     MOVE WCUCY     ECCY                            CIR003
     C                     MOVE PRDT      EDAT                            CIR003
      *                                                                   CIR003
     C           EDAT      IFGE DNWD                                      CIR003
     C                     EXSR EVENT                                     CIR003
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C                     Z-ADDPAMT      WWAMT                           CIR003
      *                                                                   CIR003
     C********** PCSKEY    READEDLPCSCD0                 88                          CIR003 AR743357
     C           PCLKEY    READEDLPCSCD0                 88                                 AR743357
      *                                                                   CIR003
     C                     ENDDO                                          CIR003
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                                     AR743357
     C           MDEI      IFEQ 'Y'                                                         AR743357
     C                     MOVE 'I'       IOIND                                             AR743357
      *                                                                                     AR743357
     C           HEDIN     IFEQ 'N'                                                         AR743357
     C                     MOVE '23S4'    ETYP                                              AR743357
     C                     ELSE                                                             AR743357
     C                     MOVE '23C4'    ETYP                                              AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     MOVE MDAT      EDAT                                              AR743357
      *                                                                                     AR743357
      ** Search for the last principal change date and amount for the                       AR743357
      ** swap.  This is the principal at maturity date.                                     AR743357
      *                                                                                     AR743357
     C           PCLKEY    SETGTDLPCSCD0               87                                   AR743357
      *                                                                                     AR743357
     C           *IN87     IFEQ '0'                                                         AR743357
     C           PCLKEY    REDPEDLPCSCD0                 88                                 AR743357
      *                                                                                     AR743357
     C           *IN88     IFEQ '0'                                                         AR743357
     C                     MOVE PAMT      WPAMT                                             AR743357
     C                     ENDIF                                                            AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     MOVE WPAMT     EAMT                                              AR743357
     C                     MOVE WCUCY     ECCY                                              AR743357
      *                                                                                     AR743357
     C           EDAT      IFGE DNWD                                                        AR743357
     C                     EXSR EVENT                                                       AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     ENDIF                                                            AR743357
      *                                                                   CIR003
     C                     ENDIF                                          CIR003
      *                                                                   S01393
      *  Generate Notional Principal Events For Risk Management           S01393
      ** when CIR003 is not installed.                                    CIR003
      *                                                                   S01393
     C           CIR003    IFEQ 'N'                                       CIR003
      *  If our side is fixed use our details                             S01393
      *                                                                   S01393
     C           UBRTT     IFEQ 0                                         S01393
     C                     EXSR OUR                                       S01393
      *                                                                   S01393
     C                     MOVE 'I'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C3'    ETYP                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           VDAT      IFLE ECD                                       S01393
     C                     Z-ADDDNWD      EDAT                            S01393
     C                     ELSE                                           S01393
     C                     Z-ADDVDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
     C                     MOVE 'O'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C4'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  If their side is fixed use their details                         S01393
      *                                                                   S01393
     C           TBRTT     IFEQ 0                                         S01393
     C                     EXSR THEIR                                     S01393
      *                                                                   S01393
     C                     MOVE 'O'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C3'    ETYP                            S01393
     C                     END                                            S01393
     C           VDAT      IFLE ECD                                       S01393
     C                     Z-ADDDNWD      EDAT                            S01393
     C                     ELSE                                           S01393
     C                     Z-ADDVDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
     C                     MOVE 'I'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C4'    ETYP                            S01393
     C                     END                                            S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  If our side is floating use our currency and amount              S01393
      *                                                                   S01393
     C           UBRTT     IFNE 0                                         S01393
     C                     EXSR OUR                                       S01393
      *                                                                   S01393
      *  Bypass generation of Our Notional Events if Event Control Date   S01393
      *  is before Value Date and Initial Rate Fix Date ( i.e. Our        S01393
      *  Rate not yet fixed for first period)                             S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     ANDLEVDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     GOTO OUREND                                    S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Generate Incoming Notional Principal Event                       S01393
      *                                                                   S01393
     C                     MOVE 'I'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C3'    ETYP                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Before Value Date and after Initial Fix       S01393
      *  Date - Notional Principal incoming on Value Date                 S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     ANDEQ0                                         S01393
     C           ECD       ORLT VDAT                                      S01393
     C           WINFD     ANDGTVDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDVDAT      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date After Value Date - Notional Principal         S01393
      *  incoming on Date of Next Working Day                             S01393
      *                                                                   S01393
     C           ECD       IFGE VDAT                                      S01393
     C                     Z-ADDDNWD      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
      *  Generate Outgoing Notional Principal Event                       S01393
      *                                                                   S01393
     C                     MOVE 'O'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C4'    ETYP                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Before Value Date                             S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     IFGT VDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDWNICD     EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           WINFD     IFEQ 0                                         S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Equal to or After Value Date                  S01393
      *                                                                   S01393
     C           ECD       IFGE VDAT                                      S01393
     C           WINFD     IFLE WNICD                                     S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDWNICD     EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           WINFD     IFEQ 0                                         S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      * Next Interest Fix Date after Next Interest Change Date            S01393
     C* Calculate next Interest Rate Change Date after the current        S01393
     C* Interest Rate Change Date                                         S01393
      *                                                                   S01393
     C           WINFD     IFGT WNICD                                     S01393
     C*                                                                   S01393
     C           WICFR     IFNE ' '                                       S01393
     C                     MOVE WICFR     ZFREQ                           S01393
     C                     Z-ADDWICBD     ZDAYNO                          S01393
     C                     Z-ADDWICFD     ZMDAY                           S01393
     C                     MOVE WCUCY     ZCCY                            S01393
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C                     EXSR @FREQB                                    S01393
     C                     EXSR ZFWDT                                     S01393
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM           WPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDYNBR                                    CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDZDYNBR    ZDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           ZDAT      IFNE 0                                         S01393
     C                     Z-ADDZDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
     C                     END                                            S01393
     C           OUREND    TAG                                            S01393
      *                                                                   S01393
      *                                                                   S01393
      *  If their side is floating use their currency and amount          S01393
      *                                                                   S01393
     C           TBRTT     IFNE 0                                         S01393
     C                     EXSR THEIR                                     S01393
      *                                                                   S01393
      *  Bypass generation of Their Notional Events if Event Control      S01393
      *  Date is before Value Date and Initial Rate Fix Date              S01393
      *  ( i.e. Their Rate not yet fixed for first period)                S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     ANDLEVDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     GOTO THREND                                    S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Generate Outgoing Notional Principal Event                       S01393
      *                                                                   S01393
     C                     MOVE 'O'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S3'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C3'    ETYP                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Before Value Date and after Initial Fix       S01393
      *  Date - Notional Principal Outgoing on Value Date                 S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     ANDEQ0                                         S01393
     C           ECD       ORLT VDAT                                      S01393
     C           WINFD     ANDGTVDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDVDAT      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date After Value Date - Notional Principal         S01393
      *  outgoing on Date of Next Working Day                             S01393
      *                                                                   S01393
     C           ECD       IFGE VDAT                                      S01393
     C                     Z-ADDDNWD      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
      *  Generate Incoming Notional Principal Event                       S01393
      *                                                                   S01393
     C                     MOVE 'I'       IOIND                           S01393
     C           HEDIN     IFEQ 'N'                                       S01393
     C                     MOVE '23S4'    ETYP                            S01393
     C                     ELSE                                           S01393
     C                     MOVE '23C4'    ETYP                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Before Value Date                             S01393
      *                                                                   S01393
     C           ECD       IFLT VDAT                                      S01393
     C           WINFD     IFGT VDAT                                      S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDWNICD     EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           WINFD     IFEQ 0                                         S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      *  Event Control Date Equal to or After Value Date                  S01393
      *                                                                   S01393
     C           ECD       IFGE VDAT                                      S01393
     C           WINFD     IFLE WNICD                                     S01393
     C           WINFD     ANDNE0                                         S01393
     C                     Z-ADDWNICD     EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           WINFD     IFEQ 0                                         S01393
     C                     Z-ADDMDAT      EDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
      * Next Interest Fix Date after Next Interest Change Date            S01393
     C* Calculate next Interest Rate Change Date after the current        S01393
     C* Interest Rate Change Date                                         S01393
      *                                                                   S01393
     C           WINFD     IFGT WNICD                                     S01393
     C*                                                                   S01393
     C           WICFR     IFNE ' '                                       S01393
     C                     MOVE WICFR     ZFREQ                           S01393
     C                     Z-ADDWICBD     ZDAYNO                          S01393
     C                     Z-ADDWICFD     ZMDAY                           S01393
     C                     MOVE WCUCY     ZCCY                            S01393
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C                     EXSR @FREQB                                    S01393
     C                     EXSR ZFWDT                                     S01393
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM           WPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDYNBR                                    CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDZDYNBR    ZDAT                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C           ZDAT      IFNE 0                                         S01393
     C                     Z-ADDZDAT      EDAT                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
      *                                                                   S01393
     C                     Z-ADDWPAMT     EAMT                            S01393
     C                     MOVE WCUCY     ECCY                            S01393
     C                     EXSR EVENT                                     S01393
      *                                                                   S01393
     C                     END                                            S01393
     C                     ENDIF                                          CIR003
      *                                                                   CIR003
     C           THREND    TAG                                            S01393
     C/COPY WNCPYSRC,DL0401C006
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** CASHEV SR.
     C** PROCEDURE TO GENERATE CASH FLOW DUMMY EVENTS FOR DEAL TYPES
     C***'RL','RS','RX'                                                   S01157
     C** 'RP','RF','RR','RS','RX'                                         S01157
     C**
     C*   CALLED FROM :- RLPROC,RSPROC,RXCASH                         *
     C****CALLS****** :- EVENT,ZFREQB,ZDATE5                              S01195
     C*   CALLS       :- EVENT,@FREQB                                     S01195
     C*
     C           CASHEV    BEGSR
     C*
     C**PROCESS*RS,*RX*AND*NON-AVERAGE*RL*DEALS                           S01157
     C* PROCESS RS, RX AND NON-AVERAGE RP, RF, RR DEALS                   S01157
     C*
     C                     MOVE '0'       *IN,60
     C                     TESTB'3'       WDSTI          10   AVR. RL
     C*
     C***********DTYP******IFNE*'RL'***********************RS,*RX         S01157
     C           DTYP      IFNE 'RP'                       RS, RX         S01157
     C           DTYP      ANDNE'RF'                       RS, RX         S01157
     C           DTYP      ANDNE'RR'                       RS, RX         S01157
     C*
     C***********DTYP******OREQ*'RL'***********************RL*(NON-AVR)   S01157
     C           DTYP      OREQ 'RP'                       RA (NON-AVR)   S01157
     C           *IN10     ANDEQ'0'                                       S01157
     C           DTYP      OREQ 'RF'                       RF (NON-AVR)   S01157
     C           *IN10     ANDEQ'0'                                       S01157
     C           DTYP      OREQ 'RR'                       RR (NON-AVR)   S01157
     C           *IN10     ANDEQ'0'
     C*
     C*
     C***IF*DATE*NEXT*WORKING*DAY*<*INT.FIX*DATE*<*OR*=*VALUE*DATE*       S01393
     C** IF EVENT CONTROL DATE < INT.FIX DATE < OR = VALUE DATE           S01393
     C** SET EVENT DATE TO VALUE DATE & GENERATE
     C** 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C           WINFD     IFLE VDAT
     C***********WINFD     ANDGTDNWD                                      S01393
     C           WINFD     ANDGTECD                                       S01393
     C                     Z-ADDVDAT      EDAT
     C/COPY WNCPYSRC,DL0401C121
     C                     MOVE '1'       *IN,60
     C*
     C                     ELSE                            WINFD > VDAT
     C*
     C***IF*INT.FIX*DATE*<*OR*=*VALUE*DATE*<*OR*=*DATE*NEXT*WORKING*DAY   S01393
     C** IF INT.FIX DATE < OR = VALUE DATE < OR = EVENT CONTROL DATE      S01393
     C** SET EVENT DATE TO NEXT INTEREST CHANGE DATE (IF NON-ZERO)
     C** & GENERATE 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C           WNICD     IFNE 0
     C           WINFD     ANDNE0
     C*
     C           WINFD     IFLE VDAT
     C***********WINFD     IFLE DNWD                                      S01393
     C           WINFD     IFLE ECD                                       S01393
     C                     Z-ADDWNICD     EDAT
     C/COPY WNCPYSRC,DL0401C122
     C                     MOVE '1'       *IN,60
     C                     END
     C*
     C***IF*INT.*FIX*DATE****GT*VALUE*DATE**AND**LE*DATE*NEXT*WORKING*DAY S01393
     C***OR*INT.*FIX*DATE****GT*VALUE*DATE**AND**GT*DATE*NEXT*WORKING*DAY S01393
     C** IF INT. FIX DATE   *GT VALUE DATE  AND *LE EVENT CONTROL DATE AY S01393
     C** OR INT. FIX DATE   *GT VALUE DATE  AND *GT EVENT CONTROL DATE AY S01393
     C**                                    AND *GT NEXT INT. CHG DATE.
     C** THEN - CALCULATE SUBSEQUENT NEXT INTEREST CHANGE DATE
     C*
     C                     ELSE                            WINFD > VDAT
     C*
     C***********WINFD     IFLE DNWD                                      S01393
     C***********WINFD     ORGT DNWD                                      S01393
     C           WINFD     IFLE ECD                                       S01393
     C           WINFD     ORGT ECD                                       S01393
     C           WINFD     ANDGTWNICD
     C*
     C           WICFR     IFNE ' '
     C                     MOVE WICFR     ZFREQ
     C                     Z-ADDWICBD     ZDAYNO
     C                     Z-ADDWICFD     ZMDAY
     C*****                MOVE WCUCY     ZCCY                            S01195
     C                     EXSR LOCN                                      S01195
     C*****                EXSR ZFREQB                                    S01195
      *                                                                   CIR005
      ** If Daily Rate Change Frequency then simply add 1 to next                             CIR018
      ** change date                                                                          CIR018
     C           CIR018    IFEQ 'Y'                                                           CIR018
     C           ZFREQ     ANDEQ'D'                                                           CIR018
     C           WNICD     ADD  1         ZDAT                                                CIR018
     C                     ELSE                                                               CIR018
      *                                                                                       CIR018
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C           CIR001    IFNE 'Y'                                       CIR001
     C                     EXSR @FREQB                                    S01195
     C******************** MOVE 'Y'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not Z for date schedule, use @FREQB.             CIR001
      *                                                                   CIR001
     C           ZFREQ     IFNE 'Z'                                       CIR001
     C                     EXSR @FREQB                                    CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** Else determine next date from IRS Date Schedule.                 CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'R'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    ZDYNBR                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM WPDCN     PPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDYNBR                                    CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDZDYNBR    ZDAT    50
     C                     ENDIF                                                              CIR018
     C*
     C** IF CALCULATED DATE < MATURITY DATE ,SET EVENT DATE THIS DATE
     C** & GENERATE 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C           ZDAT      IFLT MDAT
     C                     Z-ADDZDAT      EDAT
     C/COPY WNCPYSRC,DL0401C123
     C                     MOVE '1'       *IN,60
     C                     END
     C                     END
     C*
     C                     END
     C*
     C***IF*INT.*FIX*DATE**GT*DATE*NEXT*WORKING*DAY*AND**LE*INT.CHG*DATE  S01393
     C** IF INT. FIX DATE *GT EVENT CONTROL DATE AND *LE INT.CHG DAT   E  S01393
     C** SET EVENT DATE TO NEXT INTEREST CHANGE DATE (IF NON-ZERO)
     C** & GENERATE 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C***********WINFD     IFGT DNWD                                      S01393
     C           WINFD     IFGT ECD                                       S01393
     C           WINFD     ANDLEWNICD
     C                     Z-ADDWNICD     EDAT
     C/COPY WNCPYSRC,DL0401C124
     C                     MOVE '1'       *IN,60
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C**
     C***PROCESS*AVERAGE*RL*DEALS                                         S01157
     C** PROCESS AVERAGE RP, RF, RR DEALS                                 S01157
     C*
     C*********************ELSE****************************RL*(NON-AVR)   S01157
     C                     ELSE                            RA RF RR       S01157
     C*
     C*
     C***IF*VALUE*DATE**GT*DATE*NEXT*WORKING*DATE                         S01393
     C** IF VALUE DATE *GT EVENT CONTROL DATE                             S01393
     C** SET EVENT DATE TO VALUE DATE & GENERATE
     C** 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C***********VDAT      IFGT DNWD                                      S01393
     C           VDAT      IFGT ECD                                       S01393
     C                     Z-ADDVDAT      EDAT
     C                     MOVE '1'       *IN,60
     C*
     C***IF*VALUE*DATE**LT*DATE*NEXT*WORKING*DAY                          S01393
     C** IF VALUE DATE *LT EVENT CONTROL DATE                             S01393
     C** AND NETX INT. CHG DATE *GT DATE NEXT WORKING DAY
     C** SET EVENT DATE TO NEXT INTEREST CHANGE DATE
     C** & GENERATE 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C***********          ELSE                            VDAT < DNWD    S01393
     C                     ELSE                            VDAT < ECD     S01393
     C*
     C***********WNICD     IFGT DNWD                                      S01393
     C           WNICD     IFGT ECD                                       S01393
     C                     Z-ADDWNICD     EDAT
     C                     MOVE '1'       *IN,60
     C*
     C***IF*VALUE*DATE**LT*DATE*NEXT*WORKING*DAY                          S01393
     C** IF VALUE DATE *LT EVENT CONTROL DATE                             S01393
     C***AND*NETX*INT.*CHG*DATE**LE*DATE*NEXT*WORKING*DAY                 S01393
     C** AND NEXT INT. CHG DATE *LE EVENT CONTROL DATE                    S01393
     C** CALCULATE THE SUBSEQUENT NEXT INTEREST CHANGE DATE
     C*
     C***********                                          VDAT < DNWD    S01393
     C***********          ELSE                            WNICD <,= DNWD S01393
     C*                                                    VDAT < ECD     S01393
     C                     ELSE                            WNICD <,= ECD  S01393
     C*
     C           WICFR     IFNE ' '
     C                     MOVE WICFR     ZFREQ
     C                     Z-ADDWICBD     ZDAYNO
     C                     Z-ADDWICFD     ZMDAY
     C*****                MOVE WCUCY     ZCCY                            S01195
     C                     EXSR LOCN                                      S01195
     C*****                EXSR ZFREQB                                    S01195
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C           CIR001    IFNE 'Y'                                       CIR001
     C                     EXSR @FREQB                                    S01195
     C******************** MOVE 'Y'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not Z for date schedule, use @FREQB.             CIR001
      *                                                                   CIR001
     C           ZFREQ     IFNE 'Z'                                       CIR001
     C                     EXSR @FREQB                                    CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** Else determine next date from IRS Date Schedule.                 CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'R'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    ZDYNBR                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM WPDCN     PPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDYNBR                                    CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDZDYNBR    ZDAT    50
     C*
     C** IF CALCULATED DATE < MATURITY DATE ,SET EVENT DATE THIS DATE
     C** & GENERATE 'START' DATE DUMMY PRINCIPAL EVENT
     C*
     C           ZDAT      IFLT MDAT
     C                     Z-ADDZDAT      EDAT
     C                     MOVE '1'       *IN,60
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C*
     C**
     C*** GENERATE 'START' DATE DUMMY PRINCIPAL EVENT IF REQUESTED.
     C*
     C           *IN60     IFEQ '1'
     C           HEDIN     IFNE 'N'                                       S01211
     C                     MOVE 'C1'      ETYP
     C                     ELSE                                           S01211
     C                     MOVE 'S1'      ETYP                            S01211
     C                     END                                            S01211
     C                     Z-ADDWPAMT     EAMT
     C*                                                                   S01393
     C* Setup of Floating/Floating flag output to Event file              S01393
     C*                                                                   S01393
     C           DTYP      IFEQ 'RS'                                      S01393
     C           DTYP      OREQ 'RX'                                      S01393
     C*                                                                   S01393
     C           ETYP      IFEQ '22C1'                                    S01393
     C           ETYP      OREQ '22C2'                                    S01393
     C           ETYP      OREQ '22S1'                                    S01393
     C           ETYP      OREQ '22S2'                                    S01393
     C           ETYP      OREQ '23C1'                                    S01393
     C           ETYP      OREQ '23C2'                                    S01393
     C           ETYP      OREQ '23S1'                                    S01393
     C           ETYP      OREQ '23S2'                                    S01393
     C*                                                                   S01393
     C           UBRTT     IFNE *ZERO                                     S01393
     C           TBRTT     ANDNE*ZERO                                     S01393
     C                     MOVE 'Y'       FLFL    1                       S01393
     C                     ELSE                                           S01393
     C                     MOVE 'N'       FLFL                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C/COPY WNCPYSRC,DL0401C115
     C                     EXSR EVENT
     C*
     C** REVERSE INCOMING/OUTGOING INDICATOR & GENERATE
     C** MATURITY DATE DUMMY PRINCIPAL EVENT
     C*
     C           IOIND     IFEQ 'O'
     C                     MOVE 'I'       IOIND
     C                     ELSE
     C                     MOVE 'O'       IOIND
     C                     END
     C           HEDIN     IFNE 'N'                                       S01211
     C                     MOVE 'C2'      ETYP
     C                     ELSE                                           S01211
     C                     MOVE 'S2'      ETYP                            S01211
     C                     END                                            S01211
     C                     EXSR EVENT
     C                     MOVE *BLANKS   FLFL                            S01393
     C*                                                                   S01393
     C*
     C                     END
     C                     MOVE '0'       *IN,60
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** CYNOEV SR.
     C** PROCEDURE TO GENERATE CCY/NOSTRO DUMMY EVENTS
     C***FOR*'FR'*&*'RL'*DEALS                                            S01157
     C** FOR 'FR' & 'RP', 'RF', 'RR' DEALS                                S01157
     C**
     C*   CALLED FROM :- FRPROC,RLPROC                                *
     C*   CALLS       :- EVENT                                        *
     C*
     C           CYNOEV    BEGSR
     C*
     C** SAVE THE EVENT DATE
     C*
     C                     Z-ADDEDAT      WDAT    50
     C*
     C** GENERATE DUMMY CURRENCY/NOSTRO SETTLEMENT EVENT
     C*
     C                     MOVE 'I'       IOIND
     C                     MOVE 'N1'      ETYP
     C                     Z-ADD0         EAMT
     C                     EXSR EVENT
     C*
     C** IF PAYMENT INSTR. FOR A NOSTRO DIFFERENT TO RECEIPT, OR
     C** IF PAYMENT INSTR. FOR A NOSTRO & RECEIPT INSTR. NOT,
     C** GENERATE DUMMY NOSTRO SETTLEMENT EVENT
     C*
     C           PSETM     IFEQ 01
     C           PSETM     OREQ 02
     C           PSETM     OREQ 07
     C           PSETM     OREQ 08
     C           PSETM     OREQ 12
     C*
     C           RSETM     IFEQ 01
     C           RSETM     OREQ 02
     C           RSETM     OREQ 07
     C           RSETM     OREQ 08
     C           RSETM     OREQ 12
     C*
     C           URACC     IFNE UPACC
     C                     MOVE 'O'       IOIND
     C                     MOVE 'N2'      ETYP
     C                     Z-ADD0         EAMT
     C                     Z-ADDWDAT      EDAT
     C/COPY WNCPYSRC,DL0401C020
     C                     EXSR EVENT
     C                     END
     C*
     C                     ELSE
     C                     MOVE 'O'       IOIND
     C                     MOVE 'N2'      ETYP
     C                     Z-ADD0         EAMT
     C                     Z-ADDWDAT      EDAT
     C/COPY WNCPYSRC,DL0401C021
     C                     EXSR EVENT
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** FRSETT SR.
     C** PROCEDURE TO GENERATE SETTLEMENT EVENTS FOR 'FR' DEALS
     C**
     C*   CALLED FROM :- FRPROC                                       *
     C*   CALLS       :- DLRADS,EVENT                                 *
     C*
     C           FRSETT    BEGSR
     C*
     C** CALCULATE ACCRUED INTEREST ADJUSTMENTS NOT POSTED
     C*
     C           UEINR     IFGE TEINR
     C           UAIAN     SUB  TAIAN     WAIAN
     C                     MOVE 'O'       IOIND
     C                     ELSE
     C           TAIAN     SUB  UAIAN     WAIAN
     C                     MOVE 'I'       IOIND
     C                     END
     C*
     C** IF NEGATIVE INTEREST INDICATOR IS ON, REVERSE SIGN OF
     C** INTEREST RATES FOR DLRADS TO CALCULATE POSITIVE AMOUNT.
     C*
     C                     TESTB'1'       UDSTI          13 OUR NEG.INT.
     C                     TESTB'1'       TDSTI          23 THEIR NEG.INT.
     C           *IN13     IFEQ '1'
     C           *IN23     OREQ '1'
     C                     Z-SUBWFIXR     WFIXR
     C                     Z-SUBWFLTR     WFLTR
     C                     END
     C*
     C** PROCESS DLRADS TO CALCULATE DISCOUNTED SETTLEMENT AMOUNT
     C*
     C                     Z-ADDWICBS     SZICB
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDVDAT      SZSDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDMDAT      SZEDAT
     C                     Z-ADDWFIXR     SZFIX
     C                     Z-ADDWFLTR     SZFLT
     C                     Z-ADDWPAMT     SZPPL
     C                     Z-ADDWAIAN     SZIANP
     C                     EXSR DLRADS
     C*
     C                     Z-ADD0         WRKTAX
     C*
     C** CALCULATE TAX ON SETTLEMENT AMOUNT IF NECESSARY
     C** & SUBTRACT IT FROM SETTLEMENT AMOUNT
     C*
     C           UEINR     IFGE TEINR
     C           TAXR      ANDNE0
     C           TAXI      ANDEQ'Y'
     C           TAXR      MULT SZDSA     WRKTAX    H
     C                     END
     C*
     C           SZDSA     SUB  WRKTAX    EAMT
     C*
     C** GENERATE SETTLEMENT EVENT
     C*
     C                     MOVE 'I1'      ETYP
     C                     EXSR EVENT
     C*
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RLSETT SR.
     C***PROCEDURE*TO*GENERATE*SETTLEMENT*EVENTS*FOR*'RL'*DEALS           S01157
     C** PROCEDURE TO GENERATE SETTLEMENT EVENTS FOR RP, RF, RR DEALS     S01157
     C**
     C*   CALLED FROM :- RLPROC                                       *
     C*   CALLS       :- DATSET,CAPCOL,OURICR,OURICD,THRICR,THRICD    *
     C*                  INTDUE,RLIPAY,NXTICD,NXTIPD,INTRL
     C*
     C           RLSETT    BEGSR
     C*
     C** SET NEXT INT. PAYMENT & CHANGE DATES AND INT. CALC. END DATE
     C*
     C                     EXSR DATSET
     C*
     C** CALCULATE REIMBURSEMENT & TOPPING-UP RATES
     C*
     C                     EXSR CAPCOL
     C*
     C** SET INTEREST CALC. RATE FOR 'OUR' DETAILS, THEN MOVE 'OUR'
     C** INTEREST CALC. DETAILS TO WORK FIELDS
     C*
     C                     EXSR OURICR
     C                     EXSR OURICD
     C*
     C** CALCULATE 'OUR' INTEREST DUE USING RATE FROM OURICR
     C*
     C                     Z-ADDICRT      ZIRATE
     C/COPY WNCPYSRC,DL0401CP14                                           S01408
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     OUTAMT 130
     C*
     C** SET INTEREST CALC. RATE FOR 'THEIR' DETAILS, THEN MOVE
     C** 'THEIR' INTEREST CALC. DETAILS TO WORK FIELDS
     C*
     C                     EXSR THRICR
     C                     EXSR THRICD
     C*
     C** CALCULATE 'THEIR' INTEREST DUE USING RATE FROM THRICR
     C*
     C                     Z-ADDICRT      ZIRATE
     C/COPY WNCPYSRC,DL0401CP15                                           S01408
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     INAMT  130
     C*
     C** CONTINUE PROCESSING UNTIL NO FURTHER INTEREST AMOUNTS CAN
     C** BE CALCULATED
     C*
     C                     SETOF                     50
     C           *IN50     DOWNE'1'
     C*
     C** GENERATE INTEREST PAYMENT EVENT IF REQUIRED
     C*
     C           WNIPD     IFLE WNICD
     C                     EXSR RLIPAY
     C                     END
     C*
     C** EXIT FROM LOOP IF CALC. END DATE IS > MATURITY DATE
     C*
     C           WICED     IFGE MDAT
     C                     SETON                     50
     C                     ELSE
     C*
     C** IF NEXT PAYMENT DATE IS > OR = NEXT INTEREST CHANGE DATE,
     C** STORE NICD AND CALCULATE THE FOLLOWING ONE
     C*
     C           WNIPD     IFGE WNICD
     C                     MOVE WNICD     SNICD   50
     C           WINFD     IFEQ 0
     C                     EXSR NXTICD
     C*
     C** CALCULATE REIMBURSEMENT & TOPPING-UP RATES
     C** USING NEW EFFECTIVE INTEREST RATE (FROM NXTICD)
     C*
     C                     EXSR CAPCOL
     C*
     C** IF STORED NICD AND NEXT PAYMENT DATES ARE THE SAME
     C** CALCULATE FOLLOWING PAYMENT DATE
     C*
     C           SNICD     IFEQ WNIPD
     C                     EXSR NXTIPD
     C                     END
     C*
     C** CALCULATE INTEREST AMOUNTS USING NEW CHANGE & PAYMENT DATES
     C*
     C                     EXSR INTRL
     C                     ELSE
     C*
     C** IF INTEREST FIX DATE IS > NEW INTEREST CHANGE DATE, CALCULATE
     C** THE FOLLOWING INT. CHANGE DATE, THEN CALCULATE THE RATES,
     C** PAYMENT DATE & INTEREST AMOUNTS AS ABOVE
     C*
     C           WINFD     IFGT WNICD
     C                     EXSR NXTICD
     C                     EXSR CAPCOL
     C           SNICD     IFEQ WNIPD
     C                     EXSR NXTIPD
     C                     END
     C                     EXSR INTRL
     C*
     C** IF INT. FIX DATE < NEW INT. CHANGE DATE, EXIT FROM LOOP
     C*
     C                     ELSE
     C                     SETON                     50
     C                     END
     C                     END
     C*
     C** IF ORIGINAL NEXT PAYMENT DATE < NEXT CHANGE DATE,
     C** CALCULATE FOLLOWING PAYMENT DATE AND INTEREST AMOUNTS
     C*
     C                     ELSE
     C                     EXSR NXTIPD
     C                     EXSR INTRL
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RSSETT SR.
     C** PROCEDURE TO GENERATE SETTLEMENT EVENTS FOR 'RS' DEALS
     C**
     C*   CALLED FROM :- RSPROC                                       *
     C*   CALLS       :- DATSET,INTDUE,IMPAY,OUR,THEIR,OURIP,THRIP    *
     C*
     C           RSSETT    BEGSR
     C*
     C** FOR 'OUR' DETAILS, SET RELEVANT DATES AND CALC. INTEREST DUE
     C*
     C                     EXSR OUR
     C                     EXSR DATSET
     C                     MOVE WIPFR     UIPFR
     C                     Z-ADDWIPFD     UIPFD
     C                     Z-ADDWIPBD     UIPBD
     C                     Z-ADD0         DCOUNT  10
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL0401CP21                                           S01408
     C*
      *                                                                                       CIR007
      ** Reset 'Our Side' completed flag                                                      CIR007
     C                     MOVE 'N'       WODONE  1                                           CIR007
      *                                                                                       CIR007
      ** Reset 'Their Side' completed flag                                                    CIR007
     C                     MOVE 'N'       WTDONE  1                                           CIR007
      *                                                                   CIR001
      ** If the interest is paid up front                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'D'                                       CIR001
     C           UINPM     OREQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** If the deal has not reached its value date                       CIR001
      ** the next payment date is the value date of the deal.             CIR001
      *                                                                   CIR001
     C                     TESTB'1'       ACEI       40                   CIR001
     C           *IN40     IFEQ '1'                                       CIR001
     C                     Z-ADDVDAT      WICED                           CIR001
     C                     Z-ADDVDAT      WIPBD                           CIR001
     C                     Z-ADDVDAT      WNIPD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Suppress interest events for the next interest payment date if   CIR001
      ** rate fixing is still due.                                        CIR001
      *                                                                   CIR001
     C           WINFD     IFGT *ZERO                                     CIR001
     C           WINFD     IFLE WNIPD                                     CIR001
     C                     BITOF'0'       UDNSI                           CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If rate fixing is not due, use current base rate as effective    CIR001
      ** interest rate for next period.                                   CIR001
      *                                                                   CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           UEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     UEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           UEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     UEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C*
     C           UBRTT     IFNE 0
     C/COPY WNCPYSRC,DL0401CP16                                           S01408
     C*
     C                     TESTB'0'       UDNSI          11 INITIAL RATE SET IND
     C/COPY WNCPYSRC,DL0401C022
     C           *IN11     IFEQ '1'
     C                     Z-ADDUEINR     ZIRATE
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     UINTD  130
     C           DCOUNT    ADD  1         DCOUNT
     C                     ELSE                            * NO FURTHER CALCS
     C                     Z-ADDMDAT      WICED              FOR OUR SIDE *
     C                     Z-ADDMDAT      WNIPD
     C                     END
     C*
     C                     ELSE
     C                     Z-ADDUEINR     ZIRATE
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     UINTD
     C           DCOUNT    ADD  1         DCOUNT
     C                     END
     C/COPY WNCPYSRC,DL0401C090
      *                                                                                       CIR007
      ** Do the single event for our (OIS) side                                               CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
      *                                                                                       CIR007
      ** Find base amount of interest due                                                     CIR007
      *                                                                                       CIR007
      ** Add 1 to USLIP to give the correct number of days                                    CIR007
     C           USLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
      ** If the deal has no interim interest payments, UNIPD will be                          CIR007
      ** zero. If this is the case, we project interest until MDAT.                           CIR007
     C           UNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      UNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO                                               CIR007
     C                     PARM 'O'       PSIDE                                               CIR007
     C                     PARM           PFDAT                                               CIR007
     C                     PARM UNIPD     PTDAT                                               CIR007
     C                     PARM *ZERO     PINTR                                               CIR007
     C                     PARM *BLANKS   PRTCD1                                              CIR007
     C                     PARM 'Y'       PTOAC   1                                           204923
      *                                                                                       CIR007
      ** Adjust base amount                                                                   CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD18        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/18 -'ERROR                                               CIR007
     C                     MOVE 'DL1651  'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
     C                     ADD  UAIAN     PINTR                                               CIR007
     C                     ADD  UAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      * Apply tax if required.                                                                CIR007
     C           TAXR      IFNE *ZERO                                                         CIR007
     C           TAXI      ANDEQ'Y'                                                           CIR007
     C           TAXR      MULT PINTR     WRKTAX    H                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     SUB  WRKTAX    PINTR                                               CIR007
      *                                                                                       CIR007
      * If net amount is not zero, set DCOUNT variable for IMPAY.                             CIR007
     C           PINTR     IFNE *ZERO                                                         CIR007
     C           DCOUNT    ANDNE1                                                             CIR007
     C           DCOUNT    ADD  1         DCOUNT                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDPINTR     UINTD                                               CIR007
     C                     Z-ADDUNIPD     WNIPD                                               CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
     C*
     C                     Z-ADDWNIPD     UNIPD   50
     C                     Z-ADDWNICD     UNICD   50
     C                     Z-ADDWICED     UICED   50
     C           CIR001    IFEQ 'Y'                                       CIR001
     C/COPY WNCPYSRC,DL0401C010
     C                     Z-ADDWIPBD     UIPBD                           CIR001
     C                     END                                            CIR001
     C*
     C** FOR 'THEIR' DETAILS, SET RELEVANT DATES AND CALC. INTEREST DUE
     C*
     C                     EXSR THEIR
     C                     EXSR DATSET
     C                     MOVE WIPFR     TIPFR
     C                     Z-ADDWIPFD     TIPFD
     C                     Z-ADDWIPBD     TIPBD
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL0401CP22                                           S01408
     C*
      ** If the interest is paid up front                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           TINPM     IFEQ 'D'                                       CIR001
     C           TINPM     OREQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** If the deal has not reached its value date                       CIR001
      ** the next payment date is the value date of the deal.             CIR001
      *                                                                   CIR001
     C                     TESTB'1'       ACEI       40                   CIR001
     C           *IN40     IFEQ '1'                                       CIR001
     C                     Z-ADDVDAT      WICED                           CIR001
     C                     Z-ADDVDAT      WIPBD                           CIR001
     C                     Z-ADDVDAT      WNIPD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Suppress interest events for the next interest payment date if   CIR001
      ** rate fixing is still due.                                        CIR001
      *                                                                   CIR001
     C           WINFD     IFGT *ZERO                                     CIR001
     C           WINFD     IFLE WNIPD                                     CIR001
     C                     BITOF'0'       TDNSI                           CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If rate fixing is not due, use current base rate as effective    CIR001
      ** interest rate for next period.                                   CIR001
      *                                                                   CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           TEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     TEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           TEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     TEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C*
     C           TBRTT     IFNE 0
     C/COPY WNCPYSRC,DL0401CP17                                           S01408
     C*
     C                     TESTB'0'       TDNSI          11 INITIAL RATE SET IND
     C/COPY WNCPYSRC,DL0401C023
     C           *IN11     IFEQ '1'
     C                     Z-ADDTEINR     ZIRATE
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     TINTD  130
     C           DCOUNT    ADD  1         DCOUNT
     C                     ELSE                            * NO FURTHER CALCS
     C                     Z-ADDMDAT      WICED              FOR THEIR SIDE *
     C                     Z-ADDMDAT      WNIPD
     C                     END
     C*
     C                     ELSE
     C                     Z-ADDTEINR     ZIRATE
     C                     EXSR INTDUE
     C                     Z-ADDWINTD     TINTD
     C           DCOUNT    ADD  1         DCOUNT
     C                     END
     C/COPY WNCPYSRC,DL0401C091
      *                                                                                       CIR007
      ** Do the single event for their (OIS) side.                                            CIR007
     C           TICFR     IFEQ 'O'                                                           CIR007
      *                                                                                       CIR007
      ** Find base amount of interest due.                                                    CIR007
      *                                                                                       CIR007
      ** Add 1 to TSLIP to give the correct number of days.                                   CIR007
     C           TSLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
      ** If the deal has no interim interest payments, TNIPD will be                          CIR007
      ** zero. If this is the case, we project interest up to MDAT.                           CIR007
     C           TNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      TNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO                                               CIR007
     C                     PARM 'T'       PSIDE                                               CIR007
     C                     PARM           PFDAT                                               CIR007
     C                     PARM TNIPD     PTDAT                                               CIR007
     C                     PARM *ZERO     PINTR                                               CIR007
     C                     PARM *BLANKS   PRTCD1                                              CIR007
     C                     PARM 'Y'       PTOAC                                               204923
      *                                                                                       CIR007
      ** Adjust base amount                                                                   CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD19        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/19 -'ERROR                                               CIR007
     C                     MOVE 'DL1651  'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
     C                     ADD  TAIAN     PINTR                                               CIR007
     C                     ADD  TAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If net amount is not zero, set DCOUNT variable for IMPAY.                            CIR007
     C           PINTR     IFNE *ZERO                                                         CIR007
     C           DCOUNT    ADD  1         DCOUNT                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDPINTR     TINTD                                               CIR007
     C                     Z-ADDTNIPD     WNIPD                                               CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
     C*
     C                     Z-ADDWNIPD     TNIPD   50
     C                     Z-ADDWNICD     TNICD   50
     C                     Z-ADDWICED     TICED   50
     C           CIR001    IFEQ 'Y'                                       CIR001
     C/COPY WNCPYSRC,DL0401C011
     C                     Z-ADDWIPBD     TIPBD                           CIR001
     C                     END                                            CIR001
     C*
     C** CONTINUE PROCESSING IF AT LEAST ONE INTEREST AMOUNT CALCULATED
     C*
     C           DCOUNT    IFGT 0
     C                     SETOF                     51
     C*
     C** CONTINUE TO INCREMENT PAYMENT & CHANGE DATES AND TO CALCULATE
     C** INTEREST PAYMENTS UNTIL EITHER NEW INTEREST RATE NOT KNOWN OR
     C** MATURITY DATE IS REACHED
     C*
     C           *IN51     DOWNE'1'
     C                     EXSR IMPAY
     C                     END
     C*
     C** IF 'OUR' & 'THEIR' NEXT PAYMENT DATES ARE EQUAL AND BOTH
     C** ARE EQUAL TO THE RESPECTIVE NEXT CHANGE DATES, CALCULATE
     C** NET INTEREST DUE AND GENERATE A MATCHED FINAL INTEREST PAYMENT.
     C/COPY WNCPYSRC,DL0401C070
      *                                                                                       CIR007
      ** Do the final maturity event for deals for which one or other                         CIR007
      ** side is an OIS.                                                                      CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
     C           TICFR     OREQ 'O'                                                           CIR007
      *                                                                                       CIR007
     C           DCOUNT    IFGE 2                                                             CIR007
     C                     EXSR SRNOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
     C*
     C           UNIPD     IFEQ TNIPD
     C           UNIPD     ANDEQUNICD
     C           TNIPD     ANDEQTNICD
     C           UINTD     ANDNE0
     C           TINTD     ANDNE0
      *                                                                   CIR001
      ** Do not net payments if either side is capitalising.              CIR001
      *                                                                   CIR001
     C           UINPM     ANDNE'C'                                       CIR001
     C           UINPM     ANDNE'K'                                       CIR001
     C           TINPM     ANDNE'C'                                       CIR001
     C           TINPM     ANDNE'K'                                       CIR001
     C*
     C                     Z-ADDUNIPD     EDAT
     C/COPY WNCPYSRC,DL0401C024
     C*
     C** CALCULATE TAX ON INTREST DUE IF NECESSARY,
     C** AND SUBTRACT IT FROM INTEREST DUE
     C*
     C                     Z-ADD0         WRKTAX
     C*
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT UINTD     WRKTAX    H
     C                     END
     C                     END
     C*
     C           UINTD     SUB  WRKTAX    UINTD
      *                                                                   CIR001
      ** If "our" interest is capitalised, set "our" interest amount      CIR001
      **   to the running total of "our" interest for the final payment   CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           UINPM     ANDEQ'C'                                       CIR001
     C           UINTD     ADD  WUTOI     UINTD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** If "their" interest is capitalised, set "their" interest         CIR001
      **   amount to the running total of "their" interest for the        CIR001
      **   final payment.                                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           TINPM     ANDEQ'C'                                       CIR001
     C           TINTD     ADD  WTTOI     TINTD                           CIR001
     C                     END                                            CIR001
     C*
     C           UINTD     IFGT TINTD
     C           UINTD     SUB  TINTD     EAMT
     C                     MOVE 'O'       IOIND
     C                     MOVE UDSTI     WDSTI
     C                     ELSE
     C           TINTD     SUB  UINTD     EAMT
     C                     MOVE 'I'       IOIND
     C                     MOVE TDSTI     WDSTI
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C080
     C                     Z-ADD0         UINTD
     C                     Z-ADD0         TINTD
     C/COPY WNCPYSRC,DL0401C081
     C*
     C           EAMT      IFNE 0
     C/COPY WNCPYSRC,DL0401C025
     C                     MOVE 'I1'      ETYP
     C                     EXSR EVENT
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C102
     C                     Z-ADD0         OUSI                            CIR002
     C                     Z-ADD0         OUSA                            CIR002
     C                     Z-ADD0         TUSI                            CIR002
     C                     Z-ADD0         TUSA                            CIR002
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C                     END
     C/COPY WNCPYSRC,DL0401C082
     C*
     C                     END
     C/COPY WNCPYSRC,DL0401C071
     C*
     C*  UNMATCHED ***
     C*
     C** GENERATE 'OUR' FINAL INTEREST PAYMENT EVENT IF REQUIRED
     C*
     C           UNIPD     IFEQ UNICD
     C           UINTD     ANDNE0
     C                     EXSR OURIP
     C                     END
     C*
     C** GENERATE 'THEIR' FINAL INTEREST PAYMENT EVENT IF REQUIRED
     C*
     C           TNIPD     IFEQ TNICD
     C           TINTD     ANDNE0
     C                     EXSR THRIP
     C                     END
     C/COPY WNCPYSRC,DL0401C092
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RXSETT SR.
     C** PROCEDURE TO GENERATE SETTLEMENT EVENTS FOR 'RX' DEALS
     C**
     C*   CALLED FROM :- RXPROC                                       *
     C*   CALLS       :- DATSET,INTDUE,NXTICD,NXTIPD,INTRSX           *
     C*
     C           RXSETT    BEGSR
     C*
     C** SET NEXT INT. PAYMENT & CHANGE DATES AND INT. CALC. END DATE
     C*
     C                     EXSR DATSET
     C*
     C           *IN21     IFEQ '0'
      *                                                                   CIR001
      ** If the interest is paid up front                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'D'                                       CIR001
     C           UINPM     OREQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** If the deal has not reached its value date                       CIR001
      ** the next payment date is the value date of the deal.             CIR001
      *                                                                   CIR001
     C                     TESTB'1'       ACEI       40                   CIR001
     C           *IN40     IFEQ '1'                                       CIR001
     C                     Z-ADDVDAT      WICED                           CIR001
     C                     Z-ADDVDAT      WIPBD                           CIR001
     C                     Z-ADDVDAT      WNIPD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Suppress interest events for the next interest payment date if   CIR001
      ** rate fixing is still due.                                        CIR001
      *                                                                   CIR001
     C           WINFD     IFGT *ZERO                                     CIR001
     C           WINFD     IFLE WNIPD                                     CIR001
     C                     BITOF'0'       WDNSI                           CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If rate fixing is not due, use current base rate as effective    CIR001
      ** interest rate for next period.                                   CIR001
      *                                                                   CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           UEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     UEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           UEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     UEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     Z-ADDUEINR     ZIRATE
     C                     Z-ADDUEINR     WEINR
     C/COPY WNCPYSRC,DL0401CP18                                           S01408
     C                     ELSE
      *                                                                   CIR001
      ** If the interest is paid up front                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           TINPM     IFEQ 'D'                                       CIR001
     C           TINPM     OREQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** If the deal has not reached its value date                       CIR001
      ** the next payment date is the value date of the deal.             CIR001
      *                                                                   CIR001
     C                     TESTB'1'       ACEI       40                   CIR001
     C           *IN40     IFEQ '1'                                       CIR001
     C                     Z-ADDVDAT      WICED                           CIR001
     C                     Z-ADDVDAT      WIPBD                           CIR001
     C                     Z-ADDVDAT      WNIPD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Suppress interest events for the next interest payment date if   CIR001
      ** rate fixing is still due.                                        CIR001
      *                                                                   CIR001
     C           WINFD     IFGT *ZERO                                     CIR001
     C           WINFD     IFLE WNIPD                                     CIR001
     C                     BITOF'0'       WDNSI                           CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If rate fixing is not due, use current base rate as effective    CIR001
      ** interest rate for next period.                                   CIR001
      *                                                                   CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           TEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     TEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C           WNICD     IFEQ WNIPD                                     CIR001
     C           TEINR     OREQ *ZERO                                     CIR001
     C                     EXSR #LEFIN                                    CIR001
     C                     Z-ADDWEINR     TEINR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     Z-ADDTEINR     ZIRATE
     C                     Z-ADDTEINR     WEINR
     C/COPY WNCPYSRC,DL0401CP19                                           S01408
     C                     END
     C/COPY WNCPYSRC,DL0401C026
     C*
     C** CALCULATE INTEREST DUE
     C*
     C           CIR001    IFNE 'Y'                                       CIR001
     C                     EXSR INTDUE
     C                     ELSE                                           CIR001
     C           WBRTT     IFEQ 0                                         CIR001
     C                     EXSR INTDUE                                    CIR001
     C                     ELSE                                           CIR001
     C                     TESTB'0'       WDNSI          11               CIR001
     C           *IN11     IFEQ '1'                                       CIR001
     C                     EXSR INTDUE                                    CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDMDAT      WICED                           CIR001
     C                     Z-ADDMDAT      WNIPD                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*
     C** CONTINUE PROCESSING UNTIL NO FURTHER INTEREST AMOUNTS CAN
     C** BE CALCULATED
     C*
     C                     SETOF                     52
     C           *IN52     DOWNE'1'
     C*
     C** IF NEXT INTEREST PAYMENT DATE < OR = NEXT CHANGE DATE,
     C** GENERATE INTEREST PAYMENT EVENT
     C*
     C           WNIPD     IFLE WNICD
     C                     Z-ADDWNIPD     EDAT
     C                     Z-ADD0         WRKTAX
     C/COPY WNCPYSRC,DL0401C027
     C*
     C** IF 'OUR' DETAILS BEING PROCESSED, CALCULATE TAX ON INTEREST
     C** DUE IF NECESSARY, AND SUBTRACT IT FROM INTEREST DUE
     C*
     C           *IN21     IFEQ '0'
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT WINTD     WRKTAX    H
     C                     END
     C                     END
     C                     END
     C*
     C           WINTD     SUB  WRKTAX    EAMT
      *                                                                   CIR001
      ** If interest is capitalised, maintain a running total             CIR001
      **   of interest. If the event date is maturity date, set           CIR001
      **   interest amount to the running total.                          CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           WINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDNEMDAT                                      CIR001
     C           WINPM     OREQ 'K'                                       CIR001
     C                     ADD  EAMT      WWTOI                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           WINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDEQMDAT                                      CIR001
     C           WWTOI     ADD  EAMT      EAMT                            CIR001
     C                     ADD  WIPRD     EAMT                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C*
     C                     Z-ADD0         WINTD  130
     C                     MOVE 'I1'      ETYP
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           F1PRVR    ANDNE*ZERO                                                         CIR014
     C           WNIPD     ANDGTF1LRRC                                                        CIR014
     C           F1PRVI    IFEQ 'O'                                                           CIR014
     C           F1LRRC    ANDGTUSLIP                                                         CIR014
     C           F1PRVI    OREQ 'T'                                                           CIR014
     C           F1LRRC    ANDGTTSLIP                                                         CIR014
     C                     ADD  F1PCHA    EAMT                                                CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     EXSR EVENT
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C           *IN21     IFEQ '0'                                       CIR002
     C                     Z-ADD0         OUSI                            CIR002
     C                     Z-ADD0         OUSA                            CIR002
     C                     ELSE                                           CIR002
     C                     Z-ADD0         TUSI                            CIR002
     C                     Z-ADD0         TUSA                            CIR002
     C                     END                                            CIR002
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C                     END
     C*
     C** IF INT. CALC. END DATE LATER THAN OR = MATURITY DATE, NO
     C** FURTHER CALCS. NECESSARY FOR THESE DETAILS. EXIT FROM LOOP
     C*
     C           WICED     IFGE MDAT
     C                     SETON                     52
     C                     ELSE
     C*
     C** STORE NEXT INTEREST PAYMENT AND CHANGE DATES
     C*
     C                     Z-ADDWNIPD     SNIPD   50
     C                     Z-ADDWNICD     SNICD   50
     C*
     C** 1) PROCESS IF NEXT PAY. DATE IS LATER THAN NEXT CHANGE DATE
     C*
     C           SNIPD     IFGT SNICD
     C*
     C** IF NEXT INTEREST FIX DATE IS BLANK,
     C** CALCULATE SUBSEQUENT CHANGE DATE AND NEW INTEREST RATE
     C*
     C           WINFD     IFEQ 0
     C                     EXSR NXTICD
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C                     ELSE
     C*
     C** IF NEXT FIX DATE IS KNOWN BUT IS LATER THAN NEXT CHANGE DATE,
     C** CALCULATE SUBSEQUENT CHANGE DATE & NEW INTEREST RATE AS ABOVE
     C*
     C           WINFD     IFGT WNICD
     C                     EXSR NXTICD
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C*
     C                     ELSE
     C                     SETON                     52
     C                     END
     C                     END
     C                     END
     C*
     C** 2) PROCESS IF NEXT PAYMENT DATE IS EQUAL TO NEXT CHANGE DATE
     C*
     C           SNIPD     IFEQ SNICD
     C*
     C** IF NEXT INTEREST FIX DATE IS BLANK, CALCULATE SUBSEQUENT
     C** CHANGE AND PAYMENT DATES, AND NEW INTEREST RATE
     C*
     C           WINFD     IFEQ 0
     C                     EXSR NXTICD
     C                     EXSR NXTIPD
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C*
     C** IF NEXT FIX DATE IS KNOWN BUT IS LATER THAN NEXT CHANGE DATE,
     C** CALCULATE SUBSEQUENT C & P DATES, & NEW INTEREST RATE AS ABOVE
     C*
     C                     ELSE
     C           WINFD     IFGT WNICD
     C                     EXSR NXTICD
     C                     EXSR NXTIPD
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C*
     C                     ELSE
     C                     SETON                     52
     C                     END
     C                     END
     C                     END
     C*
     C** 3) PROCESS IF NEXT PAY. DATE IS EARLIER THAN NEXT CHANGE DATE
     C*
     C** CALCULATE SUBSEQUENT PAYMENT DATE,NEW INTEREST RATE AND AMOUNT
     C*
     C           SNIPD     IFLT SNICD
     C                     EXSR NXTIPD
     C                     EXSR INTRSX
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** OSEXEV SR.
     C** PROCEDURE TO GENERATE OUTSTANDING AND EXPOSURE EVENTS
     C** FOR ALL DEAL TYPES
     C**
     C*   CALLED FROM :- FRPROC,RLPROC,RSPROC,RXPROC                  *
     C*   CALLS       :- EVENT,DLRREX                                 *
     C*
     C           OSEXEV    BEGSR
     C*
     C** SET UP OUTPUT FIELDS & GENERATE OUTSTANDING EVENT
     C*
     C                     MOVE 'O1'      ETYP
     C                     Z-ADD0         EDAT
     C                     Z-ADDUPAMT     EAMT
     C                     MOVE *BLANK    IOIND
     C                     MOVE UDSTI     WDSTI
     C                     EXSR EVENT
     C/COPY WNCPYSRC,DL0401C114
     C*
     C** SET START DATE FOR CALCULATION OF EXPOSURE AMOUNT.
     C** FOR 'FR' DEALS, SET TO RUN DATE
     C** FOR OTHER DEALS, SET TO THE LATER OF RUN DATE & VALUE DATE
     C*
     C           DTYP      IFEQ 'FR'
     C                     Z-ADDRUND      RRSD
     C                     ELSE
     C*
     C           RUND      IFLT VDAT
     C                     Z-ADDVDAT      RRSD
     C                     ELSE
     C                     Z-ADDRUND      RRSD
     C                     END
     C                     END
     C*
     C** FOR 'FR' DEALS, SET END DATE TO VALUE DATE
     C** FOR ALL OTHER DEALS, SET END DATE TO MATURITY DATE
     C*
     C           DTYP      IFEQ 'FR'
     C                     Z-ADDVDAT      RRED
     C                     ELSE
     C                     Z-ADDMDAT      RRED
     C                     END
      *                                                                   S01117
      ** For 'FR' deals, set EXPOSURE INDICATOR to 'R'                    S01117
      ** Else, for other deals set EXPOSURE INDICATOR to 'I'              S01117
      *                                                                   S01117
     C           DTYP      IFEQ 'FR'                                      S01117
     C                     MOVE 'R'       EXEI                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'I'       EXEI                            S01117
     C                     END                                            S01117
     C*
     C** PROCESS DLRREX TO CALCULATE EXPOSURE AMOUNT THEN
     C** SET UP OUTPUT FIELDS & GENERATE EXPOSURE EVENT
     C*
     C                     Z-ADDUPAMT     RRPA
      *                                                                   112685
      ** Show the asset leg for IRS exposure                              112685
      *                                                                   112685
     C           DTYP      IFEQ 'RX'                                      112685
     C                     Z-ADDTPAMT     RRPA                            112685
     C                     END                                            112685
      *                                                                   112685
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
      *                                                                   CIR006
     C           DTYP      IFEQ 'RX'                                      CIR006
      *                                                                   CIR006
     C           CIR002    IFEQ 'Y'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           TINPM     ANDEQ'L'                                       CIR006
     C                     ADD  WTUSI     RRPA                            CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C           CIR002    IFEQ 'Y'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           UINPM     ANDEQ'L'                                       CIR006
     C/COPY WNCPYSRC,DL0401C103
     C                     ADD  WOUSI     RRPA                            CIR002
     C                     END                                            CIR002
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     MOVE DTYP      RRDT
     C                     EXSR DLRREX
     C                     MOVE 'E1'      ETYP
     C                     Z-ADDRREA      EAMT
     C                     EXSR EVENT
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** DATSET SR.
     C** PROCEDURE TO SET UP DATES FOR SETTLEMENT EVENTS PROCESSING
     C**
     C*   CALLED FROM :- RLSETT,RSSETT,RXSETT                         *
     C*   CALLS       :                                               *
     C*
     C           DATSET    BEGSR
     C*
     C                     MOVE 'N'       WRTFL   1                       CIR005
      *                                                                   CIR005
     C** IF NEXT INTEREST PAYMENT & CHANGE DATES ARE BOTH BLANK,
     C** SET THEM TO MATRURITY DATE
     C*
     C           WNIPD     IFEQ 0
     C           WNICD     IFEQ 0
     C                     Z-ADDMDAT      WNIPD
     C                     Z-ADDMDAT      WNICD
     C*
     C** IF NEXT INTEREST PAYMENT DATE IS BLANK & CHANGE DATE IS NOT,
     C** SET PAYMENT DATE, FREQUENCY & DAY NO. TO THOSE FOR CHANGE DATE
     C*
     C                     ELSE
     C                     Z-ADDWNICD     WNIPD
     C                     MOVE WICFR     WIPFR
     C                     Z-ADDWICFD     WIPFD
     C                     Z-ADDWICBD     WIPBD
     C                     MOVE 'Y'       WRTFL                           CIR005
     C                     END
     C*
     C** IF NEXT INTEREST CHANGE DATE IS BLANK & PAYMENT DATE IS NOT,
     C** SET CHANGE DATE TO MATURITY DATE
     C*
     C                     ELSE
     C           WNICD     IFEQ 0
     C                     Z-ADDMDAT      WNICD
     C                     END
     C                     END
     C*
     C** SET INTEREST CALCULATION END DATE TO THE EARLIER OF
     C** NEXT INTERST CHANGE DATE & NEXT INTEREST PAYMENT DATE
     C*
     C           WNIPD     IFGT WNICD
     C                     Z-ADDWNICD     WICED   50
     C                     ELSE
     C                     Z-ADDWNIPD     WICED
     C                     END
      *                                                                   CIR005
      ** Set interest calculation end date to the earlier of interest     CIR005
      ** payment base date & interest rate change base date if CIR005     CIR005
      ** is switched on                                                   CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WIPFR     ANDNE'Z'                                       CIR005
     C           WAMCN     ANDEQ'A'                                       CIR005
     C           WNIPD     ANDLEWNICD                                     CIR005
     C           WIPBD     ANDNE0                                         CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C                     Z-ADDWIPBD     WICED                           CIR005
     C                     ENDIF                                          CIR005
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** CAPCOL SR.
     C** PROCEDURE TO CALCULATE REIMBURSEMENT AND TOPPING-UP RATES
     C***FOR*'RL'*DEALS                                                   S01157
     C** FOR 'RP', 'RF', 'RR' DEALS                                       S01157
     C**
     C*   CALLED FROM :- RLSETT                                       *
     C*   CALLS       :                                               *
     C*
     C           CAPCOL    BEGSR
     C/COPY WNCPYSRC,DL0401C074
     C*
     C** EFFECTIVE INTEREST RATE - CEILING RATE = REIMBURSEMENT RATE.
     C** IF NEGATIVE, SET IT TO ZERO
     C*
     C           WEINR     SUB  CLRAT     REIMBR 117
     C*
     C           REIMBR    IFLT 0
     C                     Z-ADD0         REIMBR
     C                     END
     C*
     C** FLOOR RATE - EFFECTIVE INTEREST RATE = TOPPING-UP RATE.
     C** IF NEGATIVE, SET IT TO ZERO
     C*
     C           FLRAT     SUB  WEINR     TOPUPR 117
     C*
     C           TOPUPR    IFLT 0
     C                     Z-ADD0         TOPUPR
     C                     END
     C*
     C** IF FLOOR RATE PRESENT IND. IS OFF, ZERO THE TOPPING-UP RATE
     C*
     C                     TESTB'4'       WDSTI          12 FLOOR RATE PRES IND
     C           *IN12     IFEQ '0'
     C                     Z-ADD0         TOPUPR
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** OURICR SR.
     C** PROCEDURE TO SET INTEREST CALC. RATE FOR 'OUR' DETAILS
     C**
     C*   CALLED FROM :- RLSETT,INTRL                                 *
     C*   CALLS       :                                               *
     C*
     C           OURICR    BEGSR
     C*
     C                     TESTB'1'       WDSTI          13 NEG INTEREST IND
     C*
     C** IF NEGATIVE INTEREST IND. IS ON, SET INTEREST CALC. RATE TO
     C** REIMB. RATE IF USER IS TAKER, ELSE SET IT TO TOPPING-UP RATE
     C*
     C           *IN13     IFEQ '1'
     C*
     C           UBRTT     IFEQ 0
     C                     Z-ADDREIMBR    ICRT   117
     C                     ELSE
     C                     Z-ADDTOPUPR    ICRT
     C                     END
     C*
     C** IF NEGATIVE INTEREST IND. IS OFF, SET INTEREST CALC. RATE TO
     C** TOPPING-UP RATE IF USER IS TAKER, ELSE SET IT TO REIMB. RATE
     C*
     C                     ELSE
     C           UBRTT     IFEQ 0
     C                     Z-ADDTOPUPR    ICRT
     C                     ELSE
     C                     Z-ADDREIMBR    ICRT
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** OURIP SR.
     C** PROCEDURE TO GENERATE 'OUR' INTEREST PAYMENT EVENT
     C** FOR 'RS' DEALS
     C**
     C*   CALLED FROM :- RSSETT,IMPAY
     C*   CALLS       :- EVENT                                        *
     C*
     C           OURIP     BEGSR
     C*
     C** CALCULATE TAX ON INTREST DUE IF NECESSARY,
     C** AND SUBTRACT IT FROM INTEREST DUE
     C*
     C                     Z-ADD0         WRKTAX
     C*
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT UINTD     WRKTAX    H
     C                     END
     C                     END
     C*
     C           UINTD     SUB  WRKTAX    EAMT
     C*
     C                     Z-ADDUNIPD     EDAT
     C                     MOVE UDSTI     WDSTI
     C                     MOVE 'O'       IOIND
     C                     MOVE 'I1'      ETYP
     C/COPY WNCPYSRC,DL0401C028
      *                                                                   CIR001
      ** If "our" interest is capitalised, maintain a running total       CIR001
      **   of "our" interest. If the event date is maturity date, set     CIR001
      **   "our" interest amount to the running total.                    CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDNEMDAT                                      CIR001
     C           UINPM     OREQ 'K'                                       CIR001
     C                     ADD  EAMT      WUTOI                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDEQMDAT                                      CIR001
     C           WUTOI     ADD  EAMT      EAMT                            CIR001
     C                     ADD  UIPRD     EAMT                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL0401C029
     C                     EXSR EVENT
     C/COPY WNCPYSRC,DL0401C030
     C                     Z-ADD0         UINTD
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C104
     C                     Z-ADD0         OUSI                            CIR002
     C                     Z-ADD0         OUSA                            CIR002
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** THRIP SR.
     C** PROCEDURE TO GENERATE 'THEIR' INTEREST PAYMENT EVENT
     C** FOR 'RS' DEALS
     C**
     C*   CALLED FROM :- RSSETT,IMPAY
     C*   CALLS       :- EVENT                                        *
     C*
     C           THRIP     BEGSR
     C*
     C                     Z-ADDTNIPD     EDAT
     C                     Z-ADDTINTD     EAMT
     C                     MOVE TDSTI     WDSTI
     C                     MOVE 'I'       IOIND
     C                     MOVE 'I1'      ETYP
     C/COPY WNCPYSRC,DL0401C031
      *                                                                   CIR001
      ** If "their" interest is capitalised, maintain a running total     CIR001
      **   of "their" interest. If the event date is maturity date, set   CIR001
      **   "their" interest amount to the running total.                  CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           TINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDNEMDAT                                      CIR001
     C           TINPM     OREQ 'K'                                       CIR001
     C                     ADD  EAMT      WTTOI                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           TINPM     IFEQ 'C'                                       CIR001
     C           EDAT      ANDEQMDAT                                      CIR001
     C           WTTOI     ADD  EAMT      EAMT                            CIR001
     C                     ADD  TIPRD     EAMT                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL0401C032
     C                     EXSR EVENT
     C/COPY WNCPYSRC,DL0401C033
     C                     Z-ADD0         TINTD
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C105
     C                     Z-ADD0         TUSI                            CIR002
     C                     Z-ADD0         TUSA                            CIR002
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** THRICR SR.
     C** PROCEDURE TO SET INTEREST CALC. RATE FOR 'THEIR' DETAILS
     C**
     C*   CALLED FROM :- RLSETT,INTRL                                 *
     C*   CALLS       :                                               *
     C*
     C           THRICR    BEGSR
     C*
     C                     TESTB'1'       WDSTI          13 NEG INTEREST IND
     C*
     C** IF NEGATIVE INTEREST IND. IS ON, SET INTEREST CALC. RATE TO
     C** TOPPING-UP RATE IF USER IS TAKER, ELSE SET IT TO REIMB. RATE
     C*
     C           *IN13     IFEQ '1'
     C*
     C           UBRTT     IFEQ 0
     C                     Z-ADDTOPUPR    ICRT
     C                     ELSE
     C                     Z-ADDREIMBR    ICRT
     C                     END
     C*
     C** IF NEGATIVE INTEREST IND. IS OFF, SET INTEREST CALC. RATE TO
     C** REIMB. RATE IF USER IS TAKER, ELSE SET IT TO TOPPING-UP RATE
     C*
     C                     ELSE
     C           UBRTT     IFEQ 0
     C                     Z-ADDREIMBR    ICRT
     C                     ELSE
     C                     Z-ADDTOPUPR    ICRT
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** INTDUE SR.
     C** PROCEDURE TO CALCULATE INTEREST DUE
     C**
     C*   CALLED FROM :- RLSETT,RSSETT,RXSETT                         *
     C*   CALLS       :- GLINTC                                       *
     C*
     C           INTDUE    BEGSR
     C*
     C                     Z-ADD0         WRKI1  130
     C                     Z-ADD0         WRKI2  130
     C                     Z-ADD0         WRKI3  130
     C                     Z-ADD0         WRKI4  130
      *                                                                   CIR001
      ** If interest is paid up front, calculate interest                 CIR001
      ** from the next interest pay date to the one after.                CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           WINPM     ANDEQ'D'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           WINPM     ANDEQ'Y'                                       CIR001
     C                     Z-ADDWIACD     ZIBEG                           CIR001
     C                     Z-ADDWIACD     ZDAYNO                          CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'P'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    ZIEND                           CIR001
     C                     Z-ADDWICBS     ZICALC                          CIR001
     C                     Z-ADDWPAMT     ZIAMT                           CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP5                                           S01408
     C*                                                                   S01408
     C                     EXSR GLINTC                                    CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP6                                           S01408
      *                                                                   CIR001
      ** If interest is yield based (method is 'Y')                       CIR001
      *                                                                   CIR001
     C           WINPM     IFEQ 'Y'                                       CIR001
     C                     EXSR #LINDY                                    CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C*
     C** PROCESS GLINTC TO CALCULATE INTEREST AMOUNT
     C*
     C                     Z-ADDWIACD     ZIBEG
     C                     Z-ADDWICED     ZIEND
     C                     Z-ADDWICBS     ZICALC
     C                     Z-ADDWPAMT     ZIAMT
     C           CIR001    IFNE 'Y'                                       CIR001
     C/COPY WNCPYSRC,DL0401C034
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'L'                                       CIR006
     C/COPY WNCPYSRC,DL0401C106
     C                     ADD  WUSI      ZIAMT                           CIR002
     C                     ADD  WUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C078
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL0401C035
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not 'C' for cash flow schedule,                  CIR001
      ** use GLINTC to calculate interest.                                CIR001
      *                                                                   CIR001
     C           WIPFR     IFNE 'C'                                       CIR001
     C                     Z-ADD0         ZINTX                                             AR743357
     C                     MOVE ' '       PDIND                                             AR743357
      *                                                                                     AR743357
      ** If principal change schedule exist for the period                                  AR743357
      ** calculate the interest based on exchanges                                          AR743357
      *                                                                                     AR743357
     C           WNPCD     IFNE 0                                                           AR743357
     C           ECD       ANDLEWNPCD                                                       AR743357
     C                     EXSR PCCHG                                                       AR743357
     C                     MOVE 'Y'       PDIND   1                                         AR743357
     C                     ENDIF                                                            AR743357
      ****************************************************************               CIR001 AR743357
      ***Access*the*previous*non-processed*record*on******************               CIR001 AR743357
      ***principal*change*schedule.***********************************               CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C           PCSKEY    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           PRDT                            CIR001
      *                                                                   CIR001
     C**********           MOVE *BLANKS   OTIN                                       CIR001 AR743357
     C********** DTYP      IFEQ 'RX'                                                 CIR001 AR743357
     C**********           MOVELOURTHR    OTIN                                       CIR001 AR743357
     C**********           END                                                       CIR001 AR743357
     C**********           Z-ADDZIBEG     PRDT                                       CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C********** PCSKEY    SETGTDLPCSCD0                                             CIR001 AR743357
     C**********           READPDLPCSCD0                 85                          CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C********** *IN85     IFEQ '0'                                                  CIR001 AR743357
     C********** DTPR      ANDNE'Y'                                                  CIR001 AR743357
     C********** PCDLNO    ANDEQDLNO                                                 CIR001 AR743357
     C********** PCOTIN    ANDEQOTIN                                                 CIR001 AR743357
     C**********           MOVE PAMT      ZIAMT                                      CIR001 AR743357
     C**********           ELSE                                                      CIR001 AR743357
      *                                                                   CIR001
      ** If interest is capitalised, add the accumulated interest         CIR001
      **   to the principal.                                              CIR001
      *                                                                   CIR001
     C                     Z-ADDWICED     ZIEND                                             AR743357
     C           WINPM     IFEQ 'C'                                       CIR001
     C           WINPM     OREQ 'K'                                       CIR001
     C           WINPM     OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
      *                                                                   CIR001
     C           OURTHR    IFEQ 'U'                                       CIR001
     C                     ADD  WUTOI     ZIAMT                           CIR001
     C                     ELSE                                           CIR001
     C                     ADD  WTTOI     ZIAMT                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ELSE                                           CIR001
     C                     ADD  WWTOI     ZIAMT                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           WINPM     OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'L'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C107
     C                     ADD  WUSI      ZIAMT                           CIR002
     C                     ADD  WUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
      *                                                                   CIR001
     C**********           END                                                       CIR001 AR743357
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL0401C045
     C                     EXSR GLINTC                                    CIR001
     C           ZINTX     ADD  ZINTR     ZINTR                                             AR743357
     C/COPY WNCPYSRC,DL0401C046
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** Determine payment due on next date from cash flow schedule       CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     Z-ADDZIEND     ZDAYNO                          CIR001
     C                     Z-ADD0         XDLNO                                               191130
     C                     EXSR #LCASS                                    CIR001
     C                     Z-ADDCFLA      ZINTR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*
     C** CALCULATE ACCRUED INTEREST TO DATE
     C*
     C           ZINTR     ADD  WAITC     WRKI1     H
     C           WAIAN     ADD  WAIAP     WRKI2
     C           WRKI1     ADD  WRKI2     WRKI3
     C*
     C** ACCR. INT. TO DATE - INT. PAID/RECEIVED TO DATE = INTEREST DUE
     C*
     C           WRKI3     SUB  WIPRD     WRKI4
     C                     Z-ADDWRKI4     WINTD  130
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** RLIPAY SR.
     C** PROCEDURE TO GENERATE CAP/COLLAR INTEREST PAYMENT EVENT
     C**
     C*   CALLED FROM :- RLSETT                                       *
     C*   CALLS       :- EVENT                                        *
     C*
     C           RLIPAY    BEGSR
     C*
     C** CALCULATE TAX ON OUTGOING AMOUNT IF NECESSARY,
     C** AND SUBTRACT IT FROM OUTGOING AMOUNT
     C*
     C                     Z-ADD0         WRKTAX
     C*
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT OUTAMT    WRKTAX
     C                     END
     C                     END
     C*
     C           OUTAMT    SUB  WRKTAX    OUTAMT
     C*
     C** SET UP DATE AND AMOUNT FOR EVENT RECORD AND
     C** DETERMINE WHETHER AMOUNT WILL BE INCOMING OR OUTGOING
     C*
     C                     Z-ADDWNIPD     EDAT
     C/COPY WNCPYSRC,DL0401C036
     C           OUTAMT    IFGT INAMT
     C           OUTAMT    SUB  INAMT     EAMT
     C                     MOVE 'O'       IOIND
     C                     ELSE
     C           INAMT     SUB  OUTAMT    EAMT
     C                     MOVE 'I'       IOIND
     C                     END
     C*
     C** RESET INCOMING/OUTGOING AMOUNTS & GENERATE INT. PAYMENT EVENT
     C*
     C                     Z-ADD0         INAMT
     C                     Z-ADD0         OUTAMT
     C*
     C           EAMT      IFNE 0
     C                     MOVE 'I1'      ETYP
     C                     EXSR EVENT
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
      *                                                                   CIR006
      ** Keep a running total of the interest for capitalisation          CIR006
      *                                                                   CIR006
     C           WINPM     IFEQ 'C'                                       CIR006
     C           EDAT      ANDNEMDAT                                      CIR006
     C           WINPM     OREQ 'A'                                       CIR006
     C           EDAT      ANDNEMDAT                                      CIR006
     C           WINPM     OREQ 'K'                                       CIR006
     C           WINPM     OREQ 'I'                                       CIR006
     C                     Z-ADDEAMT      WWTOI                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
      ** If event date is maturity date, set interest amount to the       CIR006
      ** running total                                                    CIR006
      *                                                                   CIR006
     C           WINPM     IFEQ 'C'                                       CIR006
     C           EDAT      ANDEQMDAT                                      CIR006
     C           WINPM     OREQ 'A'                                       CIR006
     C           EDAT      ANDEQMDAT                                      CIR006
     C                     ADD  WWTOI     EAMT                            CIR006
     C                     ADD  WIPRD     EAMT                            CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** NXTIPD SR.
     C** PROCEDURE TO CALCULATE NEXT INTEREST PAYMENT DATE &
     C** INTEREST PAYMENT BASE DATE
     C**
     C*   CALLED FROM :- RLSETT,RXSETT,DICALC                         *
     C****CALLS*******:- ZFREQB,ZDATE5                                *   S01195
     C*   CALLS       :- @FREQB                                           S01195
     C*
     C           NXTIPD    BEGSR
     C*
     C***IF*INTEREST*PAYMENT*FREQUENCY*IS*NON*BLANK**PROCESS*ZFREQB*&*    S01195
     C***ZDATE5*TO*CALCULATE*NEXT*PAYMENT*DATE*********                   S01195
     C** IF INTEREST PAYMENT FREQUENCY IS NON-BLANK, PROCESS @FREQB &     S01195
     C** ZFWDT TO CALCULATE NEXT PAYMENT DATE                             S01195
     C/COPY WNCPYSRC,DL0401C057
     C*
     C           WIPFR     IFNE ' '
     C                     MOVE WIPFR     ZFREQ
     C                     Z-ADDWIPBD     ZDAYNO
     C                     Z-ADDWIPFD     ZMDAY
     C*****                MOVE WCUCY     ZCCY                            S01195
     C                     EXSR LOCN                                      S01195
     C*****                EXSR ZFREQB                                    S01195
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           ZFREQ     OREQ 'C'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C           CIR001    IFNE 'Y'                                       CIR001
     C/COPY WNCPYSRC,DL0401C037
     C                     EXSR @FREQB                                    S01195
     C/COPY WNCPYSRC,DL0401C038
     C                     Z-ADDZDAYNO    CDAT    50
     C******************** MOVE 'Y'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP25                                           S01408
     C*                                                                   S01408
     C                     EXSR ZFWDT                                     S01195
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP26                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZDYNBR    ZDAT    50
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not 'Z' and not 'C',                             CIR001
      ** use @FREQB to calculate next payment date.                       CIR001
      *                                                                   CIR001
     C           ZFREQ     IFNE 'Z'                                       CIR001
     C           ZFREQ     IFNE 'C'                                       CIR001
     C/COPY WNCPYSRC,DL0401C047
     C                     EXSR @FREQB                                    CIR001
     C                     Z-ADDZDAYNO    CDAT    50                      CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     Z-ADDZDYNBR    ZDAT    50                      CIR001
     C/COPY WNCPYSRC,DL0401C048
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is 'C' for cash flow schedule                       CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     EXSR #LCASS                                    CIR001
     C                     Z-ADDZDAYNO    CDAT                            CIR001
     C                     Z-ADDZDAYNO    ZDAT                            CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is 'Z', determine next date from schedule.          CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'P'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    CDAT                            CIR001
     C                     Z-ADDZDAYNO    ZDAT                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM WPDCN     PPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPBSDT     CDAT                            CIR005
     C                     Z-ADDPAJDT     ZDAT                            CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WIPBD     IFGE ZDAT                                      CIR005
     C                     Z-ADDPBSDT     ZDAT                            CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
     C*
     C****F*DATE*OUTPUT FROM ZDATE5 IS < MATURITY DATE********            S01195
     C** IF DATE OUTPUT FROM ZFWDT IS < MATURITY DATE,                    S01195
     C** SET NEXT INTEREST PAYMENT DATE TO THIS DATE &
     C***SET*INTEREST*PAYMENT*BASE*DATE*TO*DATE OUTPUT FROM ZFREQB.       S01195
     C** SET INTEREST PAYMENT BASE DATE TO DATE OUTPUT FROM @FREQB.       S01195
     C** IF NOT, SET BOTH DATES TO MATURITY DATE
     C*
     C           ZDAT      IFLT MDAT
     C           CDAT      ANDLEMDAT                                      CIR005
     C                     Z-ADDCDAT      WIPBD
     C                     Z-ADDZDAT      WNIPD
     C                     ELSE
     C                     Z-ADDMDAT      WIPBD
     C                     Z-ADDMDAT      WNIPD
     C                     END
     C*
     C** IF INTEREST PAYMENT FREQUENCY IS BLANK,
     C** SET BOTH DATES TO MATURITY DATE
     C*
     C                     ELSE
     C/COPY WNCPYSRC,DL0401C058
     C                     Z-ADDMDAT      WIPBD
     C                     Z-ADDMDAT      WNIPD
     C/COPY WNCPYSRC,DL0401C059
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** NXTICD SR.
     C** PROCEDURE TO CALCULATE NEXT INTEREST CHANGE DATE,
     C** INTEREST CHANGE BASE DATE AND TO SET NEW EFFECTIVE INT. RATE
     C**
     C*   CALLED FROM :- RLSETT,RXSETT,DICALC                         *
     C****CALLS*******:- ZFREQB, DATE5                                *   S01195
     C*   CALLS       :- @FREQB                                           S01195
     C*
     C           NXTICD    BEGSR
     C*
     C****F*INTEREST CHANGE FREQUENCY IS NON-BLANK, PROCESS ZFREQB*&***   S01195
     C****DATE5*TO CALCULATE NEXT CHANGE DATE*********************        S01195
     C** IF INTEREST CHANGE FREQUENCY IS NON-BLANK, PROCESS @FREQB &      S01195
     C** ZFWDT TO CALCULATE NEXT CHANGE DATE                              S01195
     C*
     C           WICFR     IFNE ' '
     C                     MOVE WICFR     ZFREQ
     C                     Z-ADDWICBD     ZDAYNO
     C                     Z-ADDWICFD     ZMDAY
     C*****                MOVE WCUCY     ZCCY                            S01195
     C                     EXSR LOCN                                      S01195
     C*****                EXSR ZFREQB                                    S01195
      *                                                                   CIR005
     C           CIR018    IFEQ 'Y'                                                           CIR018
     C           ZFREQ     ANDEQ'D'                                                           CIR018
     C           WNICD     ADD  1         ZDAT                                                CIR018
     C                     ELSE                                                               CIR018
      *                                                                                       CIR018
     C           CIR005    IFEQ 'N'                                       CIR005
     C           ZFREQ     OREQ 'Z'                                       CIR005
     C           ZFREQ     OREQ 'C'                                       CIR005
     C           WCYP1     OREQ *BLANK                                    CIR005
      *                                                                   CIR005
     C           CIR001    IFNE 'Y'                                       CIR001
     C                     EXSR @FREQB                                    S01195
     C                     Z-ADDZDAYNO    CDAT    50
     C******************** MOVE 'Y'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAT    50
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is not 'Z', use @FREQB to calculate next date.      CIR001
      *                                                                   CIR001
     C           ZFREQ     IFNE 'Z'                                       CIR001
     C                     EXSR @FREQB                                    CIR001
     C                     Z-ADDZDAYNO    CDAT    50                      CIR001
     C                     EXSR ZFWDT                                     CIR001
     C                     Z-ADDZDYNBR    ZDAT    50                      CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      ** If frequency is 'Z', determine next date from schedule.          CIR001
      *                                                                   CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'R'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    CDAT                            CIR001
     C                     Z-ADDZDAYNO    ZDAT                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
      ** Adjust date according to payment date convention currencies      CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PCURR                           CIR005
     C                     PARM WPDCN     PPDCN                           CIR005
     C                     PARM           ZLOC                            CIR005
     C                     PARM           DATF                            CIR005
     C                     PARM           PAJDT                           CIR005
     C                     PARM           PBSDT                           CIR005
      *                                                                   CIR005
     C                     Z-ADDPBSDT     CDAT                            CIR005
     C                     Z-ADDPAJDT     ZDAT                            CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           WICBD     IFGE ZDAT                                      CIR005
     C                     Z-ADDPBSDT     ZDAT                            CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                                              CIR018
     C*
     C****F*DATE OUTPUT FROM ZDATE5 IS < MATURITY DATE*********           S01195
     C** IF DATE OUTPUT FROM ZFWDT IS < MATURITY DATE,                    S01195
     C** SET NEXT INTEREST CHANGE DATE TO THIS DATE &
     C****ET*INTEREST CHANGE BASE DATE TO DATE OUTPUT FROM*ZFREQB*****    S01195
     C** SET INTEREST CHANGE BASE DATE TO DATE OUTPUT FROM @FREQB.        S01195
     C** IF NOT, SET BOTH DATES TO MATURITY DATE
     C*
     C           ZDAT      IFLT MDAT
     C                     Z-ADDCDAT      WICBD
     C                     Z-ADDZDAT      WNICD
     C                     ELSE
     C                     Z-ADDMDAT      WICBD
     C                     Z-ADDMDAT      WNICD
     C                     END
     C*
     C** IF INTEREST CHANGE FREQUENCY IS BLANK,
     C** SET BOTH DATES TO MATURITY DATE
     C*
     C                     ELSE
     C                     Z-ADDMDAT      WICBD
     C                     Z-ADDMDAT      WNICD
     C                     END
     C*
     C** IF PROCESSING PROVIDER'S DETAILS, APPLY SPREAD/RATE TO BASE
     C** RATE TO GET EFFECTIVE INTEREST RATE. IF NOT, EIR = SPREAD/RATE
     C*
     C           WBRTT     IFNE 0
     C*
     C           WSPIN     IFEQ *BLANK
     C                     Z-ADDWBRTE     WEINR  117
     C                     END
     C*
     C           WSPIN     IFEQ 'A'                        ** ADD **
     C           WBRTE     ADD  WRTSP     WEINR
     C                     END
     C*
     C           WSPIN     IFEQ 'S'                        ** SUBTRACT **
     C           WBRTE     SUB  WRTSP     WEINR
     C                     END
     C*
     C           WSPIN     IFEQ 'P'                        ** PERCENTAGE **
     C           WRTSP     DIV  100       WK119  119
     C           WBRTE     MULT WK119     WEINR     H
     C                     ADD  WBRTE     WEINR
     C                     END
     C*
     C                     ELSE
     C                     Z-ADDWRTSP     WEINR
     C                     END
     C*
     C** IF NEGATIVE INTEREST IND. IS ON, REVERSE SIGN OF EIR
     C*
     C                     TESTB'1'       WDSTI          13 NEG INTEREST IND
     C           *IN13     IFEQ '1'
     C                     Z-SUBWEINR     WEINR
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** INTRL SR.
     C***PROCEDURE*TO*CALCULATE*INTEREST*FOR*NEXT*PERIOD*FOR*'RL'*DEALS   S01157
     C** PROCEDURE TO CALCULATE INTEREST FOR NEXT PERIOD FOR              S01157
     C** 'RP, 'RF', 'RR' DEALS                                            S01157
     C**
     C*   CALLED FROM :- RLSETT                                       *
     C*   CALLS       :- GLINTC,OURICR,THRICR                         *
     C*
     C           INTRL     BEGSR
     C*
     C** SET START AND END DATES FOR INTEREST CALCULATION.
     C** START DATE = PREVOIUS END DATE,
     C** END DATE = EARLIER OF NEXT CHANGE & PAYMENT DATES
     C*
     C                     Z-ADDWICED     ZIBEG
     C           WNIPD     IFGT WNICD
     C                     Z-ADDWNICD     WICED
     C                     ELSE
     C                     Z-ADDWNIPD     WICED
     C                     END
      *                                                                   CIR005
      ** Set interest calculation end date to interest payment base       CIR005
      ** date if CIR005 is switched on and amount code is actual          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WAMCN     ANDEQ'A'                                       CIR005
     C           WNIPD     ANDLEWNICD                                     CIR005
     C           WIPBD     ANDNE0                                         CIR005
     C                     Z-ADDWIPBD     WICED                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDWICED     ZIEND
     C*
     C** SET INTEREST CALC. RATE FOR 'OUR' DETAILS & CALCULATE INTEREST
     C** ADD RESULT TO OUTGOING AMOUNT
     C*
     C                     EXSR OURICR
     C*
     C                     Z-ADDWICBS     ZICALC
     C                     Z-ADDWPAMT     ZIAMT
      *                                                                   CIR006
      ** Access previous non-processed record on principal change         CIR006
      ** schedule                                                         CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C                     MOVE *BLANKS   OTIN                            CIR006
     C                     Z-ADDZIBEG     PRDT                            CIR006
      *                                                                   CIR006
     C           PCSKEY    SETGTDLPCSCD0                                  CIR006
     C                     READPDLPCSCD0                 85               CIR006
      *                                                                   CIR006
     C           *IN85     IFEQ *OFF                                      CIR006
     C           DTPR      ANDNE'Y'                                       CIR006
     C           PCDLNO    ANDEQDLNO                                      CIR006
     C           PCOTIN    ANDEQOTIN                                      CIR006
     C                     Z-ADDPAMT      ZIAMT                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP27                                           S01408
     C*                                                                   S01408
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WINPM     ANDEQ'L'                                       CIR006
     C                     ADD  WUSI      ZIAMT                           CIR002
     C                     ADD  WUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
     C                     Z-ADDICRT      ZIRATE
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP7                                           S01408
     C*                                                                   S01408
     C                     EXSR GLINTC
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP8                                           S01408
     C*
     C           ZINTR     ADD  OUTAMT    OUTAMT    H
     C*
     C** SET INTEREST CALC. RATE FOR 'THEIR' DETAILS & CALC. INTEREST
     C** ADD RESULT TO INCOMING AMOUNT
     C*
     C                     EXSR THRICR
     C*
     C                     Z-ADDICRT      ZIRATE
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP9                                           S01408
     C*                                                                   S01408
     C                     EXSR GLINTC
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP10                                           S01408
     C*
     C           ZINTR     ADD  INAMT     INAMT     H
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** IMPAY SR.
     C** PROCEDURE TO GENERATE INTEREST PAYMENT EVENTS, AND TO
     C** CONTINUE CALCULATING NEXT CHANGE & PAYMENT DATES AND
     C** GENERATING RELATED EVENTS UNTIL EITHER THE NEW CALCULATION
     C** RATE IS NOT KNOWN OR THE MATURITY DATE IS REACHED
     C**
     C*   CALLED FROM :- RSSETT                                       *
     C*   CALLS       :- OURIP,THRIP,EVENT,DICALC                     *
     C*
     C           IMPAY     BEGSR
     C*
     C** PROCESSING TO BE EXECUTED IF ONLY ONE INTEREST AMOUNT
     C** CALCULATED BEFORE ENTRY TO THIS SUBROUTINE
     C*
     C           DCOUNT    IFLT 2
     C*
     C** IF 'OUR' INTEREST PAYMENT DATE IS THE EARLIEST OF ALL
     C** POSSIBLE EVENT DATES, GENERATE AN INDIVIDUAL INTEREST PAYMENT
     C** EVENT USING 'OUR' DETAILS
     C/COPY WNCPYSRC,DL0401C093
      *                                                                                       CIR007
      ** If a single event is required and our side is an OIS, the                            CIR007
      ** event will be required for our side.                                                 CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
      *                                                                                       CIR007
     C                     EXSR SRUOIS                                                        CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
     C*
     C           UNIPD     IFLE UNICD
     C           UNIPD     ANDLTTNIPD
     C                     EXSR OURIP
     C                     END
     C*
     C** IF 'THEIR' INTEREST PAYMENT DATE IS THE EARLIEST OF ALL
     C** POSSIBLE EVENT DATES, GENERATE AN INDIVIDUAL INTEREST PAYMENT
     C** EVENT USING 'THEIR' DETAILS
     C/COPY WNCPYSRC,DL0401C094
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If a single event is required and their side is an OIS, the                          CIR007
      ** event will be required for their side.                                               CIR007
     C           TICFR     IFEQ 'O'                                                           CIR007
     C                     EXSR SRTOIS                                                        CIR007
     C                     ELSE                                                               CIR007
     C*
     C           TNIPD     IFLE TNICD
     C           TNIPD     ANDLTUNIPD
     C                     EXSR THRIP
     C                     END
     C/COPY WNCPYSRC,DL0401C095
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                   CIR001
      ** If "our" and "their" interest is to be paid on the same date     CIR001
      **   and either side is capitalising, produce searate events.       CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           UNIPD     ANDEQTNIPD                                     CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'C'                                       CIR001
     C           UINPM     OREQ 'K'                                       CIR001
     C           TINPM     OREQ 'C'                                       CIR001
     C           TINPM     OREQ 'K'                                       CIR001
      *                                                                   CIR001
     C           UNIPD     IFLT UNICD                                     CIR001
     C                     EXSR OURIP                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           TNIPD     IFLT TNICD                                     CIR001
     C                     EXSR THRIP                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C*
     C** PROCESSING TO BE EXECUTED IF BOTH INTEREST AMOUNTS
     C** CALCULATED BEFORE ENTRY TO THIS SUBROUTINE
     C*
     C                     ELSE
     C/COPY WNCPYSRC,DL0401C086
      *                                                                                       CIR007
     C                     SELEC                                                              CIR007
      *                                                                                       CIR007
      ** OUR SIDE of the deal ONLY is an OIS                                                  CIR007
      ** -----------------------------------                                                  CIR007
     C           UICFR     WHEQ 'O'                                                           CIR007
     C           TICFR     ANDNE'O'                                                           CIR007
      *                                                                                       CIR007
      ** 'Their' Next Interest Payment <= 'Their' Next Interest                               CIR007
      **  Payment Date                       Change Date                                      CIR007
     C           TNIPD     IFLE TNICD                                                         CIR007
      *                                                                                       CIR007
      ** If an event for 'Our Side' has not yet been created                                  CIR007
     C           WODONE    IFEQ 'N'                                                           CIR007
      *                                                                                       CIR007
      ** If 'Their' Next Interest   =   'Our' Next Interest                                   CIR007
      **     Payment date                Payment Date                                         CIR007
     C           TNIPD     IFEQ UNIPD                                                         CIR007
     C           TNIPD     ANDNEMDAT                                                          CIR007
      ** Produce one net event                                                                CIR007
     C                     EXSR SRNOIS                                                        CIR007
     C                     ELSE                                                               CIR007
      ** Else produce two seperate events, provided not maturity date.                        CIR007
     C           UNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR SRUOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
     C           TNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR THRIP                                                         CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
      *                                                                                       CIR007
      ** Already created only required event for 'Our Side'                                   CIR007
      ** So, create a single event for 'Their Side', if not maturity.                         CIR007
     C           TNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR THRIP                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
      *                                                                                       CIR007
      ** Cannot produce an event for 'Their Side'                                             CIR007
      ** If event for 'Our Side' has not been created, create it,                             CIR007
      ** provided it is not the maturity event.                                               CIR007
     C           WODONE    IFEQ 'N'                                                           CIR007
     C           UNIPD     ANDNEMDAT                                                          CIR007
     C                     EXSR SRUOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** THEIR SIDE of the deal ONLY is an OIS                                                CIR007
      ** -------------------------------------                                                CIR007
     C           TICFR     WHEQ 'O'                                                           CIR007
     C           UICFR     ANDNE'O'                                                           CIR007
      *                                                                                       CIR007
      ** 'Our' Next Interest Payment  <=  'Our' Next Interest                                 CIR007
      **  Payment Date                     Change Date                                        CIR007
      *                                                                                       CIR007
     C           UNIPD     IFLE UNICD                                                         CIR007
      *                                                                                       CIR007
      ** If an event for 'Thier Side' has not yet been created                                CIR007
     C           WTDONE    IFEQ 'N'                                                           CIR007
      *                                                                                       CIR007
      ** If 'Their' Next Interest   =   'Our' Next Interest                                   CIR007
      **     Payment date                Payment Date                                         CIR007
     C           TNIPD     IFEQ UNIPD                                                         CIR007
     C           TNIPD     ANDNEMDAT                                                          CIR007
      ** Produce one net event                                                                CIR007
     C                     EXSR SRNOIS                                                        CIR007
     C                     ELSE                                                               CIR007
      ** Else produce two seperate events, provided not maturity.                             CIR007
     C           TNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR SRTOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
     C           UNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR OURIP                                                         CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
      *                                                                                       CIR007
      ** Already created only required event for 'Their Side'                                 CIR007
      ** So, create a single event for 'Our Side'.                                            CIR007
      ** provided not maturity date.                                                          CIR007
     C           UNIPD     IFNE MDAT                                                          CIR007
     C                     EXSR OURIP                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ELSE                                                               CIR007
      *                                                                                       CIR007
      ** Cannot produce an event for 'Our Side'                                               CIR007
      ** If event for 'Their Side' has not been created, create it                            CIR007
      ** Provided it is not the maturity event.                                               CIR007
     C           WTDONE    IFEQ 'N'                                                           CIR007
     C           TNIPD     ANDNEMDAT                                                          CIR007
     C                     EXSR SRTOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** BOTH SIDES of the deal are OIS's                                                     CIR007
      *  --------------------------------                                                     CIR007
     C           TICFR     WHEQ 'O'                                                           CIR007
     C           UICFR     ANDEQ'O'                                                           CIR007
      *                                                                                       CIR007
      ** If both sides of the deal are OIS, we only go through this                           CIR007
      ** code once, and an amount for both sides will have been found                         CIR007
      ** If the NIPD's match, and this is not the maturity event, do                          CIR007
      ** one net event.                                                                       CIR007
     C           TNIPD     IFEQ UNIPD                                                         CIR007
     C           TNIPD     ANDNEMDAT                                                          CIR007
     C                     EXSR SRNOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If the NIPD's do not match, we do an event for each side,                            CIR007
      ** provided it is not the maturity event. Their side first.                             CIR007
     C           TNIPD     IFNE UNIPD                                                         CIR007
     C           TNIPD     ANDNEMDAT                                                          CIR007
     C                     EXSR SRTOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Our side second                                                                      CIR007
     C           UNIPD     IFNE TNIPD                                                         CIR007
     C           UNIPD     ANDNEMDAT                                                          CIR007
     C                     EXSR SRUOIS                                                        CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     OTHER                                                              CIR007
     C*
     C** IF 'OUR' NEXT INTEREST PAYMENT DATE IS > 'OUR' NEXT CHANGE
     C** DATE, GENERATE AN INDIVIDUAL INTEREST PAYMENT EVENT,
     C** DETERMINING WHICH DETAILS TO USE AS ABOVE
     C*
     C           UNIPD     IFGT UNICD
     C*
     C           TNIPD     IFLE TNICD
     C           TNIPD     ANDLTUNIPD
     C                     EXSR THRIP
     C                     END
     C*
     C** IF 'OUR' NEXT PAY. DATE < OR = 'OUR' NEXT CHANGE DATE AND
     C** 'THEIR' NEXT PAY. DATE > 'THEIR' NEXT CHANGE DATE, USE 'OUR'
     C** DETAILS AND GENERATE AN INDIVIDUAL INTEREST PAYMENT EVENT
     C*
     C                     ELSE
     C           TNIPD     IFGT TNICD
     C           UNIPD     IFLT TNIPD
     C                     EXSR OURIP
     C                     END
     C*
     C** IF 'OUR' & 'THEIR' NEXT PAYMENT DATES ARE EQUAL AND BOTH
     C** EARLIER THAN THE RESPECTIVE NEXT CHANGE DATES, CALCULATE
     C** NET INTEREST DUE AND GENERATE A MATCHED INTEREST PAYMENT EVENT
     C*
     C                     ELSE
     C/COPY WNCPYSRC,DL0401C072
     C           UNIPD     IFEQ TNIPD
      *                                                                   CIR001
      ** Do not net payments if either side is capitalising.              CIR001
      *                                                                   CIR001
     C           CIR001    ANDEQ'Y'                                       CIR001
     C           UINPM     ANDNE'C'                                       CIR001
     C           UINPM     ANDNE'K'                                       CIR001
     C           TINPM     ANDNE'C'                                       CIR001
     C           TINPM     ANDNE'K'                                       CIR001
     C           CIR001    OREQ 'N'                                       CIR001
     C           UNIPD     ANDEQTNIPD                                     CIR001
      *                                                                   CIR001
     C                     Z-ADDUNIPD     EDAT
     C/COPY WNCPYSRC,DL0401C039
     C*
     C** CALCULATE TAX ON INTREST DUE IF NECESSARY,
     C** AND SUBTRACT IT FROM INTEREST DUE
     C*
     C                     Z-ADD0         WRKTAX
     C*
     C           TAXR      IFNE 0
     C           TAXI      IFEQ 'Y'
     C           TAXR      MULT UINTD     WRKTAX    H
     C                     END
     C                     END
     C*
     C           UINTD     SUB  WRKTAX    UINTD
     C*
     C           UINTD     IFGT TINTD
     C           UINTD     SUB  TINTD     EAMT
     C                     MOVE 'O'       IOIND
     C                     MOVE UDSTI     WDSTI
     C                     ELSE
     C           TINTD     SUB  UINTD     EAMT
     C                     MOVE 'I'       IOIND
     C                     MOVE TDSTI     WDSTI
     C                     END
     C*
     C/COPY WNCPYSRC,DL0401C083
     C                     Z-ADD0         UINTD
     C                     Z-ADD0         TINTD
     C/COPY WNCPYSRC,DL0401C084
     C*
     C           EAMT      IFNE 0
     C                     MOVE 'I1'      ETYP
     C                     EXSR EVENT
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C108
     C                     Z-ADD0         OUSI                            CIR002
     C                     Z-ADD0         OUSA                            CIR002
     C                     Z-ADD0         TUSI                            CIR002
     C                     Z-ADD0         TUSA                            CIR002
     C                     Z-ADD0         WUSI                            CIR002
     C                     Z-ADD0         WUSA                            CIR002
     C                     END                                            CIR002
     C                     END
     C/COPY WNCPYSRC,DL0401C085
     C*
     C** IF 'THEIR' NEXT INTEREST PAYMENT DATE IS EARLIER THAN 'OURS',
     C** USE 'THEIR' DETAILS AND GENERATE AN INDIVIDUAL INTEREST
     C** PAYMENT EVENT
     C*
     C                     ELSE
     C           UNIPD     IFGT TNIPD
     C                     EXSR THRIP
     C                     ELSE
     C           UNIPD     IFLT TNIPD
     C                     EXSR OURIP
     C                     END
     C                     END
      *                                                                   CIR001
      ** If "our" and "their" interest is to be paid on the same date     CIR001
      **   and either side is capitalising, produce searate events.       CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           UNIPD     ANDEQTNIPD                                     CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'C'                                       CIR001
     C           UINPM     OREQ 'K'                                       CIR001
     C           TINPM     OREQ 'C'                                       CIR001
     C           TINPM     OREQ 'K'                                       CIR001
      *                                                                   CIR001
     C                     EXSR OURIP                                     CIR001
      *                                                                   CIR001
     C                     EXSR THRIP                                     CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END
     C/COPY WNCPYSRC,DL0401C073
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0401C087
      *                                                                                       CIR007
     C                     ENDSL                                                              CIR007
      *                                                                                       CIR007
     C                     END
     C/COPY WNCPYSRC,DL0401C088
      *                                                                                       CIR007
     C                     SELEC                                                              CIR007
      *                                                                                       CIR007
      ** Both sides of the deal are OIS's                                                     CIR007
      ** --------------------------------                                                     CIR007
     C           UICFR     WHEQ 'O'                                                           CIR007
     C           TICFR     ANDEQ'O'                                                           CIR007
      *                                                                                       CIR007
      ** End IMPAY loop. Set dates for final maturity event calc.                             CIR007
     C                     MOVE '1'       *IN51                                               CIR007
     C           WODONE    IFEQ 'Y'                                                           CIR007
     C                     Z-ADDUNIPD     USLIP                                               CIR007
     C                     Z-ADDMDAT      UNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
     C           WTDONE    IFEQ 'Y'                                                           CIR007
     C                     Z-ADDTNIPD     TSLIP                                               CIR007
     C                     Z-ADDMDAT      TNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** 'Our Side' of the deal only is an OIS                                                CIR007
      ** -------------------------------------                                                CIR007
     C           UICFR     WHEQ 'O'                                                           CIR007
     C           TICFR     ANDNE'O'                                                           CIR007
      *                                                                                       CIR007
      ** If the single required event for our side has already been                           CIR007
      ** created, set the dates for the final maturity event calc.                            CIR007
     C           WODONE    IFEQ 'Y'                                                           CIR007
     C                     Z-ADDUNIPD     USLIP                                               CIR007
     C                     Z-ADDMDAT      UNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** We may be able to produce a number of events for their side,                         CIR007
      ** provided the event created above was not the maturity event.                         CIR007
     C           TNIPD     IFLT MDAT                                                          CIR007
     C                     EXSR THEIR                                                         CIR007
     C                     MOVE '1'       *IN20                                               CIR007
     C                     EXSR DICALC                                                        CIR007
      *                                                                                       CIR007
      ** If IN51 has been set on by DICALC, it may be because no rate                         CIR007
      ** could be found for their (non-OIS) side. We do not want to                           CIR007
      ** produce a maturity event with just the OIS side, so we force                         CIR007
      ** SRNOIS to calculate a zero amount for the OIS side which nets                        CIR007
      ** to zero and no event is produced. Set start date to maturity.                        CIR007
     C           *IN51     IFEQ '1'                                                           CIR007
     C           TINTD     ANDEQ*ZERO                                                         CIR007
     C                     Z-ADDMDAT      USLIP                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If the position just found for their side is the maturity,                           CIR007
      ** then we need to end the IMPAY loop and do the final maturity                         CIR007
      ** event.                                                                               CIR007
     C           TICED     IFGE MDAT                                                          CIR007
     C                     MOVE '1'       *IN51                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** 'Their Side' of the deal only is an OIS                                              CIR007
      ** ---------------------------------------                                              CIR007
     C           TICFR     WHEQ 'O'                                                           CIR007
     C           UICFR     ANDNE'O'                                                           CIR007
      *                                                                                       CIR007
      ** If the single required event for their side has already been                         CIR007
      ** created, set the dates for the final maturity event calc.                            CIR007
     C           WTDONE    IFEQ 'Y'                                                           CIR007
     C                     Z-ADDTNIPD     TSLIP                                               CIR007
     C                     Z-ADDMDAT      TNIPD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** We may be able to produce a number of events for our side,                           CIR007
      ** provided the event created above was not the maturity event.                         CIR007
     C           UNIPD     IFLT MDAT                                                          CIR007
     C                     EXSR OUR                                                           CIR007
     C                     MOVE '0'       *IN20                                               CIR007
     C                     EXSR DICALC                                                        CIR007
      *                                                                                       CIR007
      ** If IN51 has been set on by DICALC, it is because no rate                             CIR007
      ** could be found for our (non-OIS) side. We do not want to                             CIR007
      ** produce a maturity event with just the OIS side, so we force                         CIR007
      ** SRNOIS to calculate a zero amount for the OIS side which nets                        CIR007
      ** to zero and no event is produced. Set start date to maturity.                        CIR007
     C           *IN51     IFEQ '1'                                                           CIR007
     C           UINTD     ANDEQ*ZERO                                                         CIR007
     C                     Z-ADDMDAT      TSLIP                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If the position just found for our side is the maturity,                             CIR007
      ** then we need to end the IMPAY loop and do the final maturity                         CIR007
      ** event.                                                                               CIR007
     C           UICED     IFGE MDAT                                                          CIR007
     C                     MOVE '1'       *IN51                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If Neither Side of the deal is an OIS                                                CIR007
     C                     OTHER                                                              CIR007
     C*
     C** IF BOTH SETS OF CALCULATIONS ARE COMPLETE, EXIT FROM LOOP
     C*
     C           UICED     IFGE MDAT
     C           TICED     IFGE MDAT
     C                     SETON                     51
     C                     END
     C                     END
     C*
     C** NOTE :
     C**   THE FOLLOWING PROCESSING IS TO BE REPEATED, IF OUR/THEIR DATES
     C**   ARE SET TO *EQ MDAT AND INTEREST CALCULATIONS DUE.
     C*
     C           REPEAT    DOUEQ' '
     C                     MOVE ' '       REPEAT  1
     C*
     C** IF 'OUR' INT. CALC. END DATE > OR = MATURITY DATE, NO FURTHER
     C** PROCESSING IS NECESSARY FOR 'OUR' DETAILS. CALCULATE NEXT INT.
     C** PAYMENT & CHANGE DATES AND INTEREST AMOUNT FOR 'THEIR' DETAILS
     C*
     C           UICED     IFGE MDAT
     C           TICED     IFLT MDAT
     C                     EXSR THEIR
     C                     SETON                     20
     C                     EXSR DICALC
     C                     END
     C*
     C** IF 'OUR' CALCULATIONS ARE NOT COMPLETE BUT 'THEIRS' ARE,
     C** CALCULATE NEXT DATES AND INTEREST AMOUNT FOR 'OUR' DETAILS
     C*
     C                     ELSE
     C           TICED     IFGE MDAT
     C                     EXSR OUR
     C                     SETOF                     20
     C                     EXSR DICALC
     C                     ELSE
     C*
     C** IF NEITHER SET OF CALCS. ARE COMPLETE, CALCULATE NEXT DATES
     C** AND INTEREST AMOUNT FOR THOSE DETAILS WITH EARLIER END DATE
     C*
     C           UICED     IFLT TICED
     C                     EXSR OUR
     C                     SETOF                     20
     C                     EXSR DICALC
     C           MASTER    IFEQ 'Y'                        THEIR CALC
     C           TNIPD     ANDNETICED                      REQUIRED?
     C                     MOVE 'Y'       REPEAT
     C                     END
      *
     C                     ELSE
     C*
     C           UICED     IFGT TICED
     C                     EXSR THEIR
     C                     SETON                     20
     C                     EXSR DICALC
     C           MASTER    IFEQ 'Y'                        OUR CALC
     C           UNIPD     ANDNEUICED                      REQUIRED?
     C                     MOVE 'Y'       REPEAT
     C                     END
      *
     C                     ELSE
     C*
     C** IF END DATES ARE EQUAL, PROCESS BOTH SETS OF DETAILS
     C*
     C           UICED     IFEQ TICED
     C                     EXSR OUR
     C                     SETOF                     20
     C                     EXSR DICALC
     C*
     C                     EXSR THEIR
     C                     SETON                     20
     C                     EXSR DICALC
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0401C060
     C*
     C                     END
     C/COPY WNCPYSRC,DL0401C089
      *                                                                                       CIR007
     C                     ENDSL                                                              CIR007
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** DICALC SR.
     C** PROCEDURE TO CALCULATE NEXT INTEREST CHANGE & PAYMENT DATES
     C** AND INTEREST AMOUNTS FOR 'RS' DEALS
     C**
     C*   CALLED FROM :- IMPAY
     C*   CALLS       :- NXTICD,NXTIPD,INTRSX,OUR,THEIR
     C*
     C           DICALC    BEGSR
     C/COPY WNCPYSRC,DL0401C040
     C*
     C* SET UP WORK FIELDS
     C*
     C                     MOVE ' '       MASTER  1
     C*
     C           *IN20     IFEQ '1'
     C                     Z-ADDTICED     WICED
     C                     Z-ADDTINTD     WINTD
     C                     Z-ADDTEINR     WEINR
     C                     ELSE
     C                     Z-ADDUICED     WICED
     C                     Z-ADDUINTD     WINTD
     C                     Z-ADDUEINR     WEINR
     C                     END
     C/COPY WNCPYSRC,DL0401CP20                                           S01408
     C*
     C** STORE NEXT INTEREST PAYMENT AND CHANGE DATES
     C*
     C                     Z-ADDWNIPD     SNIPD
     C                     Z-ADDWNICD     SNICD
     C*
     C** PROCESS IF NEXT PAYMENT DATE IS *GE TO NEXT CHANGE DATE
     C*
     C           SNIPD     IFGE SNICD
     C*
     C** IF NEXT INTEREST FIX DATE IS ZERO, CALCULATE
     C** SUBSEQUENT CHANGE DATE AND NEW INTEREST RATE
     C*
     C           WINFD     IFEQ 0
     C                     EXSR NXTICD
     C*
     C** IF PAYMENT & CHANGE DATES EQUAL, CALCULATE SUBSEQUENT PAY. DATE
     C*
     C           SNIPD     CASEQSNICD     NXTIPD
     C                     END
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C*
     C** IF NEXT FIX DATE IS KNOWN BUT IS LATER THAN NEXT CHANGE DATE,
     C** CALCULATE SUBSEQUENT CHANGE DATE & NEW INTEREST RATE AS ABOVE
     C*
     C                     ELSE
     C           WINFD     IFGT WNICD
     C                     EXSR NXTICD
     C*
     C** IF PAYMENT & CHANGE DATES EQUAL, CALCULATE SUBSEQUENT PAY. DATE
     C*
     C           SNIPD     CASEQSNICD     NXTIPD
     C                     END
     C*
     C** CALCULATE INTEREST AMOUNT FOR NEW PERIOD
     C*
     C                     EXSR INTRSX
     C*
     C** IF NEXT FIX DATE IS EARLIER THAN NEXT CHANGE DATE AND
     C** IF NEITHER SET OF CALCULATIONS WERE COMPLETE
     C** SET UP THIS SIDE AS COMPLETED,
     C*
     C                     ELSE
     C           UICED     IFLT MDAT
     C           TICED     IFLT MDAT
     C                     Z-ADD0         WINTD
     C                     Z-ADDMDAT      WICED
     C                     Z-ADDMDAT      WNIPD
     C                     Z-ADDMDAT      WNICD
     C                     MOVE 'Y'       MASTER
     C*
     C** OTHERWISE SET COMPLETION CONDITION
     C*
     C                     ELSE
     C                     SETON                     51
     C                     END
     C                     ELSE
     C                     SETON                     51
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C** PROCESS IF NEXT PAYMENT DATE IS EARLIER THAN NEXT CHANGE DATE
     C** CALCULATE SUBSEQUENT PAYMENT DATE, NEW INTEREST RATE AND AMOUNT
     C*
     C           SNIPD     IFLT SNICD
     C                     EXSR NXTIPD
     C                     EXSR INTRSX
     C                     END
     C*
     C** UPDATE DATE FIELDS WITH NEW VALUES
     C*
     C           *IN20     IFEQ '1'
     C                     Z-ADDWNIPD     TNIPD
     C                     Z-ADDWIPBD     TIPBD
     C                     Z-ADDWNICD     TNICD
     C                     Z-ADDWICBD     TICBD
     C                     Z-ADDWICED     TICED
     C                     Z-ADDWINTD     TINTD
     C                     Z-ADDWEINR     TEINR
     C                     ELSE
     C                     Z-ADDWNIPD     UNIPD
     C                     Z-ADDWIPBD     UIPBD
     C                     Z-ADDWNICD     UNICD
     C                     Z-ADDWICBD     UICBD
     C                     Z-ADDWICED     UICED
     C                     Z-ADDWINTD     UINTD
     C                     Z-ADDWEINR     UEINR
     C                     END
     C*
     C** IF BOTH SIDES REACHED MATURITY, SET ON THE COMPLETION INDICATOR.
     C*
     C           UICED     IFGE MDAT
     C           TICED     ANDGEMDAT
     C                     MOVE '1'       *IN51
     C                     END
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** INTRSX SR.
     C** PROCEDURE TO CALCULATE INTEREST FOR NEXT PERIOD
     C** FOR 'RS' & 'RX' DEALS
     C**
     C*   CALLED FROM :- DICALC,RXSETT                                *
     C*   CALLS       :- GLINTC                                       *
     C*
     C           INTRSX    BEGSR
      *                                                                   CIR001
      ** If interest is paid up front, calculate interest                 CIR001
      ** from the next interest pay date to the one after                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           WINPM     ANDEQ'D'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           WINPM     ANDEQ'Y'                                       CIR001
     C                     Z-ADDWNIPD     WICED                           CIR001
     C                     Z-ADDWNIPD     ZIBEG                           CIR001
     C                     Z-ADDWNIPD     ZDAYNO                          CIR001
     C                     MOVELOURTHR    OTIN                            CIR001
     C                     MOVEL'P'       RCIP                            CIR001
     C                     EXSR #LRATS                                    CIR001
     C                     Z-ADDZDAYNO    ZIEND                           CIR001
     C                     Z-ADDWICBS     ZICALC                          CIR001
     C                     Z-ADDWPAMT     ZIAMT                           CIR001
     C                     Z-ADDWEINR     ZIRATE                          CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP11                                           S01408
     C*                                                                   S01408
     C                     EXSR GLINTC                                    CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP12                                           S01408
      *                                                                   CIR001
      ** If interest is yield based                                       CIR001
      *                                                                   CIR001
     C           WINPM     IFEQ 'Y'                                       CIR001
     C                     EXSR #LINDY                                    CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C*
     C** SET START AND END DATES FOR INTEREST CALCULATION.
     C** START DATE = PREVOIUS END DATE,
     C** END DATE = EARLIER OF NEXT CHANGE & PAYMENT DATES
     C*
     C                     Z-ADDWICED     ZIBEG
     C           WNIPD     IFGT WNICD
     C                     Z-ADDWNICD     WICED
     C                     ELSE
     C                     Z-ADDWNIPD     WICED
     C                     END
      *                                                                   CIR005
      ** Set interest calculation end date to interest payment base       CIR005
      ** date if CIR005 is switched on and amount code is actual          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           ZFREQ     ANDNE'Z'                                       CIR005
     C           WAMCN     ANDEQ'A'                                       CIR005
     C           WNIPD     ANDLEWNICD                                     CIR005
     C           WIPBD     ANDNE0                                         CIR005
     C                     Z-ADDWIPBD     WICED                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDWICED     ZIEND
      *                                                                   CIR001
      ** If interest payment frequency is 'C', add cashflow amount        CIR001
      ** to interest due.                                                 CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           WIPFR     ANDEQ'C'                                       CIR001
     C                     Z-ADDCFLA      ZINTR                           CIR001
     C                     ELSE                                           CIR001
     C*
     C** CALCULATE INTEREST AMOUNT AND ADD TO INTEREST DUE
     C*
     C                     Z-ADDWICBS     ZICALC
     C                     Z-ADDWPAMT     ZIAMT
     C           CIR001    IFEQ 'Y'                                       CIR001
      ****************************************************************               CIR001 AR743357
      ***Access*the*previous*non-processed*record*on******************               CIR001 AR743357
      ***principal*change*schedule.***********************************               CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C                     Z-ADD0         ZINTX                                             AR743357
     C                     MOVE ' '       PDIND                                             AR743357
      *                                                                                     AR743357
      ** If principal change schedule exist for the period                                  AR743357
      ** calculate the interest based on exchanges                                          AR743357
      *                                                                                     AR743357
     C           WNPCD     IFNE 0                                                           AR743357
     C           ECD       ANDLEWNPCD                                                       AR743357
     C                     EXSR PCCHG                                                       AR743357
     C                     MOVE 'Y'       PDIND   1                                         AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C**********           MOVE *BLANKS   OTIN                                       CIR001 AR743357
     C********** DTYP      IFEQ 'RX'                                                 CIR001 AR743357
     C**********           MOVELOURTHR    OTIN                                       CIR001 AR743357
     C**********           END                                                       CIR001 AR743357
     C**********           Z-ADDZIBEG     PRDT                                       CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C********** PCSKEY    SETGTDLPCSCD0                                             CIR001 AR743357
     C**********           READPDLPCSCD0                 85                          CIR001 AR743357
      ****************************************************************               CIR001 AR743357
     C********** *IN85     IFEQ '0'                                                  CIR001 AR743357
     C********** DTPR      ANDNE'Y'                                                  CIR001 AR743357
     C********** PCDLNO    ANDEQDLNO                                                 CIR001 AR743357
     C********** PCOTIN    ANDEQOTIN                                                 CIR001 AR743357
     C**********           MOVE PAMT      ZIAMT                                      CIR001 AR743357
     C**********           ELSE                                                      CIR001 AR743357
     C                     Z-ADDWICED     ZIEND                                             AR743357
      *                                                                   CIR001
      ** If interest is capitalised, add the accumulated interest         CIR001
      **   to the principal.                                              CIR001
      *                                                                   CIR001
     C           WINPM     IFEQ 'C'                                       CIR001
     C           WINPM     OREQ 'K'                                       CIR001
     C           WINPM     OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
      *                                                                   CIR001
     C           OURTHR    IFEQ 'U'                                       CIR001
     C                     ADD  WUTOI     ZIAMT                           CIR001
     C                     ELSE                                           CIR001
     C                     ADD  WTTOI     ZIAMT                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ELSE                                           CIR001
     C                     ADD  WWTOI     ZIAMT                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           WINPM     OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           WINPM     OREQ 'L'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C109
     C                     ADD  WUSI      ZIAMT                           CIR002
     C                     ADD  WUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
     C**********           END                                                       CIR001 AR743357
     C                     ELSE                                           CIR001
     C           CIR002    IFEQ 'Y'                                       CIR002
     C/COPY WNCPYSRC,DL0401C110
     C                     ADD  WUSI      ZIAMT                           CIR002
     C                     ADD  WUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
     C                     END                                            CIR001
     C                     Z-ADDWEINR     ZIRATE
     C/COPY WNCPYSRC,DL0401C041
     C                     EXSR GLINTC
     C           ZINTX     ADD  ZINTR     ZINTR                                             AR743357
     C/COPY WNCPYSRC,DL0401C042
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*
     C           ZINTR     ADD  WINTD     WINTD     H
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** OUR SR.
     C** PROCEDURE TO MOVE 'OUR' DETAILS TO WORK FIELDS
     C**
     C*   CALLED FROM :- FRPROC,RLPROC,RSPROC,RXPROC,RXCASH,RSSETT,   *
     C*                  DICALC                                       *
     C*   CALLS       :                                               *
     C*
     C           OUR       BEGSR
     C*
     C                     MOVE UCUCY     WCUCY   3
     C                     MOVE PSCY      @SETCY                          CEU003
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           F1NPRI    ANDNE*ZERO                                                         CIR014
     C           F1LRRC    ANDGTUSLIP                                                         CIR014
     C           F1PRVI    ANDEQ'O'                                                           CIR014
     C                     Z-ADDF1NPRI    WPAMT                                               CIR014
     C                     ELSE                                                               CIR014
     C                     Z-ADDUPAMT     WPAMT  130
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     Z-ADDUBRTT     WBRTT   20
     C                     Z-ADDUBRTE     WBRTE  117
     C                     Z-ADDURTSP     WRTSP  117
     C                     MOVE USPIN     WSPIN   1
     C                     Z-ADDUICBS     WICBS   10
     C                     Z-ADDUINFD     WINFD   50
     C                     Z-ADDUNICD     WNICD   50
     C                     Z-ADDUICBD     WICBD   50
     C                     MOVE UICFR     WICFR   1
     C                     Z-ADDUICFD     WICFD   20
     C                     Z-ADDUNIPD     WNIPD   50
     C                     Z-ADDUIPBD     WIPBD   50
     C                     MOVE UIPFR     WIPFR   1
     C                     Z-ADDUIPFD     WIPFD   20
     C                     Z-ADDUIACD     WIACD   50
     C                     Z-ADDUAITC     WAITC  130
     C                     Z-ADDUAIAN     WAIAN  130
     C                     Z-ADDUAIAP     WAIAP  130
     C                     Z-ADDUIPRD     WIPRD  130
     C                     MOVE UDNSI     WDNSI   1
     C                     MOVE UDSTI     WDSTI   1
     C                     Z-ADDUNPCD     WNPCD   50                                        AR743357
      *                                                                   S01117
     C                     MOVE POBR      WSBR    3                       S01117
     C                     MOVE 'P'       @SETI   1                       S01195
     C*
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** Initialise total amount of interest for capitalised interest.    CIR001
      *                                                                   CIR001
     C           *LIKE     DEFN EAMT      WWTOI                           CIR001
     C                     Z-ADD0         WWTOI                           CIR001
      *                                                                   CIR001
     C                     MOVE 'U'       OURTHR  1                       CIR001
     C                     MOVE UINPM     WINPM   1                       CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C111
     C                     Z-ADDOUSI      WUSI   150                      CIR002
     C                     Z-ADDOUSA      WUSA   150                      CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C043
      *                                                                   CIR002
      ** Save payment convention -leg 1 details if CIR005 is on           CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVE L1PDCN    WPDCN   2                       CIR005
     C                     MOVE L1AMCN    WAMCN   2                       CIR005
     C                     MOVE L1CYP1    WCYP1   3                       CIR005
     C                     MOVE L1CYP2    WCYP2   3                       CIR005
     C                     MOVE L1CYP3    WCYP3   3                       CIR005
     C                     MOVE L1CYP4    WCYP4   3                       CIR005
     C                     MOVE L1CYP5    WCYP5   3                       CIR005
     C                     MOVE L1CYP6    WCYP6   3                       CIR005
     C                     MOVE L1CYP7    WCYP7   3                       CIR005
     C                     MOVE L1CYP8    WCYP8   3                       CIR005
     C                     MOVE L1CYP9    WCYP9   3                       CIR005
     C                     MOVE L1CYP0    WCYP0   3                       CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDSR
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** OURICD SR.
     C** PROCEDURE TO MOVE 'OUR' INTEREST CALC. DETAILS TO WORK FIELDS
     C**
     C*   CALLED FROM :- RLSETT                                       *
     C*   CALLS       :                                               *
     C*
     C           OURICD    BEGSR
     C*
     C                     Z-ADDUAITC     WAITC  130
     C                     Z-ADDUAIAN     WAIAN  130
     C                     Z-ADDUAIAP     WAIAP  130
     C                     Z-ADDUIPRD     WIPRD  130
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** THEIR SR.
     C** PROCEDURE TO MOVE 'THEIR' DETAILS TO WORK FIELDS
     C**
     C*   CALLED FROM :- FRPROC,RLPROC,RSPROC,RXPROC,RXCASH,RSSETT    *
     C*                  DICALC                                       *
     C*   CALLS       :                                               *
     C*
     C           THEIR     BEGSR
     C*
     C                     MOVE TCUCY     WCUCY   3
     C                     MOVE RSCY      @SETCY                          CEU003
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           F1NPRI    ANDNE*ZERO                                                         CIR014
     C           F1LRRC    ANDGTTSLIP                                                         CIR014
     C           F1PRVI    ANDEQ'T'                                                           CIR014
     C                     Z-ADDF1NPRI    WPAMT                                               CIR014
     C                     ELSE                                                               CIR014
     C                     Z-ADDTPAMT     WPAMT  130
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     Z-ADDTBRTT     WBRTT   20
     C                     Z-ADDTBRTE     WBRTE  117
     C                     Z-ADDTRTSP     WRTSP  117
     C                     MOVE TSPIN     WSPIN   1
     C                     Z-ADDTICBS     WICBS   10
     C                     Z-ADDTINFD     WINFD   50
     C                     Z-ADDTNICD     WNICD   50
     C                     Z-ADDTICBD     WICBD   50
     C                     MOVE TICFR     WICFR   1
     C                     Z-ADDTICFD     WICFD   20
     C                     Z-ADDTNIPD     WNIPD   50
     C                     Z-ADDTIPBD     WIPBD   50
     C                     MOVE TIPFR     WIPFR   1
     C                     Z-ADDTIPFD     WIPFD   20
     C                     Z-ADDTIACD     WIACD   50
     C                     Z-ADDTAITC     WAITC  130
     C                     Z-ADDTAIAN     WAIAN  130
     C                     Z-ADDTAIAP     WAIAP  130
     C                     Z-ADDTIPRD     WIPRD  130
     C                     MOVE TDNSI     WDNSI   1
     C                     MOVE TDSTI     WDSTI   1
     C                     Z-ADDTNPCD     WNPCD                                             AR743357
     C*                                                                   S01117
     C                     MOVE ROBR      WSBR    3                       S01117
     C                     MOVE 'R'       @SETI   1                       S01195
     C*
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
      ** Initialise total amount of interest for capitalised interest.    CIR001
      *                                                                   CIR001
     C                     Z-ADD0         WWTOI                           CIR001
      *                                                                   CIR001
     C                     MOVE 'T'       OURTHR  1                       CIR001
     C                     MOVE TINPM     WINPM   1                       CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL0401C112
     C                     Z-ADDTUSI      WUSI   150                      CIR002
     C                     Z-ADDTUSA      WUSA   150                      CIR002
     C                     END                                            CIR002
     C/COPY WNCPYSRC,DL0401C044
      *                                                                   CIR002
      ** Save the following payment convention details                    CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
      *                                                                   CIR005
     C           DTYP      IFEQ 'RX'                                      CIR005
      *                                                                   CIR005
     C                     MOVE L2PDCN    WPDCN                           CIR005
     C                     MOVE L2AMCN    WAMCN                           CIR005
     C                     MOVE L2CYP1    WCYP1                           CIR005
     C                     MOVE L2CYP2    WCYP2                           CIR005
     C                     MOVE L2CYP3    WCYP3                           CIR005
     C                     MOVE L2CYP4    WCYP4                           CIR005
     C                     MOVE L2CYP5    WCYP5                           CIR005
     C                     MOVE L2CYP6    WCYP6                           CIR005
     C                     MOVE L2CYP7    WCYP7                           CIR005
     C                     MOVE L2CYP8    WCYP8                           CIR005
     C                     MOVE L2CYP9    WCYP9                           CIR005
     C                     MOVE L2CYP0    WCYP0                           CIR005
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                   CIR005
     C                     MOVE L1PDCN    WPDCN                           CIR005
     C                     MOVE L1AMCN    WAMCN                           CIR005
     C                     MOVE L1CYP1    WCYP1                           CIR005
     C                     MOVE L1CYP2    WCYP2                           CIR005
     C                     MOVE L1CYP3    WCYP3                           CIR005
     C                     MOVE L1CYP4    WCYP4                           CIR005
     C                     MOVE L1CYP5    WCYP5                           CIR005
     C                     MOVE L1CYP6    WCYP6                           CIR005
     C                     MOVE L1CYP7    WCYP7                           CIR005
     C                     MOVE L1CYP8    WCYP8                           CIR005
     C                     MOVE L1CYP9    WCYP9                           CIR005
     C                     MOVE L1CYP0    WCYP0                           CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           CIR017    IFEQ 'Y'                                                           CIR017
     C           DTYP      ANDEQ'RS'                                                          CIR017
     C                     MOVE L2PDCN    WPDCN                                               CIR017
     C                     MOVE L2AMCN    WAMCN                                               CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDSR
     C**************************************************************************
      /EJECT                                                              S01195
      ********************************************************************S01195
      **                                                                  S01195
      ** LOCN SR                                                          S01195
      ** PROCEDURE TO DETERMINE LOCATION CODE                             S01195
      **                                                                  S01195
      *   CALLED FROM :- RSCFDT, CASHEV, NXTIPD, NXTICD                   S01195
      *                                                                   S01195
      *   CALLS       :                                                   S01195
      *                                                                   S01195
      ********************************************************************S01195
     C           LOCN      BEGSR                                          S01195
      *                                                                   S01195
      ** If Receive settlement instruction...                             S01195
     C           @SETI     IFEQ 'P'                                       S01195
     C                     MOVELUPACC     WRK2    2                       S01195
     C                     MOVE PSETM     @NSETM  10                      S01195
     C* Ensure settlement currency is used where appropriate for calls    CEU003
     C*  to AONOSTRO, sr/@FREQB (similar to sr/ZFREQB), sr/ZFWDT.         CEU003
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      WRK3                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     WRK3    3                       058188
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
      *                                                                   S01195
      ** Else...                                                          S01195
     C                     ELSE                                           S01195
     C                     MOVELURACC     WRK2                            S01195
     C                     MOVE RSETM     @NSETM                          S01195
     C*                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      WRK3                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE TCUCY     WRK3                            058188
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C                     END                                            S01195
      *                                                                   S01195
      ** If Settlement method NOT = Previous settlement method            S01195
      ** OR          Currency NOT = Previous Currency                     S01195
      ** OR       Nostro code NOT = Previous Nostro code                  S01195
      ** Set up new location code                                         S01195
     C           @NSETM    IFNE @SETM                                     S01195
     C***********UCUCY     ORNE @CUCY                               S01195058188
     C           WRK3      ORNE @CUCY                                     058188
     C           WRK2      ORNE @WRK2                                     S01195
     C***********          MOVE UCUCY     @CUCY   3                 S01195058188
     C                     MOVE WRK3      @CUCY   3                       058188
     C                     MOVE @NSETM    @SETM   10                      S01195
     C                     MOVE WRK2      @WRK2   2                       S01195
      *                                                                   S01195
      ** If settlement method is via a nostro                             S01195
     C           @SETM     IFEQ 01                                        S01195
     C           @SETM     OREQ 02                                        S01195
     C           @SETM     OREQ 07                                        S01195
     C           @SETM     OREQ 08                                        S01195
     C           @SETM     OREQ 12                                        S01195
      *                                                                   S01195
      ** If Nostro Code not blank...set up location.                      S01195
     C           @WRK2     IFNE *BLANKS                                   S01195
      *                                                                   S01195
      ** Call ACCESS program to get NOSTRO record                         S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*MSG   ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C                     PARM @CUCY     @CCY    3        Currency       S01195
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD  10        A/C Code                           CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM @WRK2     @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
      *                                                                   S01194
      ** If database error, return to calling program                     S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           *LOCK     IN   LDA                                       091548
     C                     MOVEL'SDNOSTPD'DBFILE           ************   S01194
     C                     Z-ADD9         DBASE            * DBERR 09 *   091548
     C***********          MOVEL'09'      DBASE            * DBERR S01194 091548
     C                     MOVEL@OPTN     DBOPTN  7        ******* S01194 091548
     C                     MOVE @CUCY     @KEY    5                       S01194
     C                     MOVEL@WRK2     @KEY                            S01194
     C                     MOVE @KEY      DBKEY                           S01194
     C                     OUT  LDA                                       091548
     C                     MOVEL'401/09 -'ERROR                           S01194
     C                     MOVE @KEY      ERROR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01195
      ** Set ZLOC to Nostro location                                      S01195
     C                     MOVE A7NOSN    ZLOC                            S01195
      *                                                                   S01195
      ** Else if Nostro code blank set ZLOC to blanks                     S01195
     C                     ELSE                                           S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      ** Set ZCCY to Deal Currency                                        S01195
     C                     MOVE @CUCY     ZCCY                            S01195
      *                                                                   S01195
      ** Else if not settled via a Nostro                                 S01195
      ** set ZLOC to System Location & ZCCY to local currency             S01195
     C                     ELSE                                           S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
      *                                                                   S01195
     C                     END                                            S01195
      *                                                                   S01195
     C                     ENDSR                                          S01195
     C********************************************************************S01195
      /EJECT                                                              S01195
     C********************************************************************
     C**
     C** THRICD SR.
     C** PROCEDURE TO MOVE 'THEIR' INTEREST CALC. DETAILS TO WORK FIELDS
     C**
     C*   CALLED FROM :- RLSETT                                       *
     C*   CALLS       :                                               *
     C*
     C           THRICD    BEGSR
     C*
     C                     Z-ADDTAITC     WAITC  130
     C                     Z-ADDTAIAN     WAIAN  130
     C                     Z-ADDTAIAP     WAIAP  130
     C                     Z-ADDTIPRD     WIPRD  130
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**                                                               .
     C** GLZADD SR. TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C**            IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**                                                               .
     C** GLZSUM SR. TO CARRY OUT THE ADDITION FOR GLZADD SR.           D)
     C**
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C**************************************************************************
      /EJECT
     C********************************************************************066550
     C***********                                                         066550
     C*****GLINTC SR. TO CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS.  066550
     C***********                                                         066550
     C*****THIS*VERSION REPLACES THE ORIGINAL GLINTC SR. NOW NAMED        066550
     C*****GLINTO.                                                        066550
     C***********                                                         066550
     C*****CALCULATION METHODS ARE -                                      066550
     C*****1**ACTUAL/365                                                  066550
     C*****2**ACTUAL/360                                                  066550
     C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
     C*****4**365/365 (EXCLUDING 29/02)                                   066550
     C*****5**365/360 (EXCLUDING 29/02)                                   066550
     C*****6**ACTUAL/366                                                  066550
     C***********                                                         066550
     C*****REQUIRES SUBRS. - ZDATE2, ZSAVE, & ZRSTOR.                     066550
     C***********                                                         066550
     C***********                                                         066550
     C***********GLINTC    BEGSR                           ** GLINTC  **  066550
     C***********                                                         066550
     C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           066550
     C***********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  066550
     C***********          Z-ADDZIEND     ZIEND   50       FINISHING DATE 066550
     C***********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    066550
     C***********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      066550
     C***********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST 066550
     C***********                                                         066550
     C****TO*DETERMINE NUMBER OF DAYS INTEREST TO BE CALCULATED           066550
     C***********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
     C***********                                                         066550
     C****CHECK*FOR INTEREST CALCULATION BASIS                            066550
     C*****USE*OF INDICATRS                                               066550
     C*****1,92**2,90  3,91  4,97  5,96  6,95                             066550
     C***********          SETOF                     959697               066550
     C***********ZICALC    COMP 2                    919290               066550
     C**N91******          GOTO ZICAL                                     066550
     C***********ZICALC    COMP 5                    959796               066550
     C***97******ZICALC    COMP 3                    97  91               066550
     C***95******                                                         066550
     C*R*96******          SETOF                     91                   066550
     C**N91******          GOTO ZILPCK                                    066550
     C***********                                                         066550
     C*****THIS*CODING WILL CALCULATE THE NUMBER OF DAYS TO USE WHEN      066550
     C*****USING*THE 30/360 BASIS - METHOD 3.                             066550
     C***********          EXSR ZSAVE                                     066550
     C***********          Z-ADDZIBEG     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZISD    20                      066550
     C***********          MOVE ZMTH      ZISM    20                      066550
     C***********          MOVE ZYEAR     ZISY    20                      066550
     C***********          Z-ADDZIEND     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZIFD    20                      066550
     C***********          MOVE ZMTH      ZIFM    20                      066550
     C***********          MOVE ZYEAR     ZIFY    20                      066550
     C***********          EXSR ZRSTOR                                    066550
     C***********          SETOF                     93                   066550
     C****IN*ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF  066550
     C****ZIEND*IS GREATER THAN ZIBEG,THEN THE DATE ZIEND MUST BE IN A    066550
     C****DIFFERENT CENTURY TO ZIBEG.IF SO ADD 100 YEARS TO IT.           066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER START YEAR IS A LEAP YEAR AND IF START       066550
     C*****MONTH*IS FEBRUARY.                                             066550
     C***********                                                         066550
     C**N98******          BITOF'0'       ZGLBIT  1                       066550
     C***98******          BITON'0'       ZGLBIT                          066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZISM      COMP 2                        99*FEBRUARY      066550
     C**N99******30        SUB  ZISD      ZID1    50   93                 066550
     C**N99*93***          Z-ADD0         ZID1                            066550
     C***99N98***28        SUB  ZISD      ZID1                            066550
     C***99*98***29        SUB  ZISD      ZID1                            066550
     C***********ZISM      COMP 12                       93               066550
     C***93******          Z-ADD0         ZISM                            066550
     C***93******ZISY      ADD  1         ZISY                            066550
     C***93******ZISY2     ADD  1         ZISY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER END YEAR IS A LEAP YEAR AND IF END MONTH     066550
     C*****IS*FEBRUARY.                                                   066550
     C***********                                                         066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZIFM      COMP 2                        99*FEBRUARY      066550
     C**N99******ZIFD      COMP 31                       93               066550
     C***99N98***ZIFD      COMP 28                       93               066550
     C***99*98***ZIFD      COMP 29                       93               066550
     C***********          SETOF                     98                   066550
     C***********          TESTB'0'       ZGLBIT         98               066550
     C***93******ZID1      ADD  30        ZID1                            066550
     C**N93******ZID1      ADD  ZIFD      ZID1                            066550
     C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
     C***93******          GOTO ZIOUT                                     066550
     C***********12        SUB  ZISM      ZIM1    20                      066550
     C***********          Z-ADD1         ZISM                            066550
     C*****USE*ENLARGED FIELDS THAT CAN HANDLE 1999 ONWARDS               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
     C***********ZIY1      MULT 12        ZIM2    30                      066550
     C***********ZIM2      ADD  ZIFM      ZIM2                            066550
     C***********ZIM1      ADD  ZIM2      ZINOM                           066550
     C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
     C***********ZINOM     MULT 30        ZID2    50                      066550
     C***********ZID2      ADD  ZID1      ZDAYN1                          066550
     C***********          SETOF                     93                   066550
     C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
     C**N96N97***          GOTO ZICAL                                     066550
     C*****THE*FOLLOWING CODING APPLIES FOR METHODS 4 AND 5 ONLY.         066550
     C*****1*DAY*IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB   066550
     C*****IN*THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG, & ZIEND.066550
     C***********                                                         066550
     C*****FIND*NO OF 4 YEAR PERIODS BETWEEN DATES                        066550
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
     C***********          MVR            ZIREM   50                      066550
     C*****FIND*NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.                    066550
     C***********ZIBEG     SUB  60        ZIBW1   50                      066550
     C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
     C***********          MVR            ZIDREM  50                      066550
     C***********ZIDREM    COMP 0                        94               066550
     C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
     C***94******          GOTO ZILP1                                     066550
     C*****ROUND*UP RESULT                                                066550
     C***********ZIDW1     ADD  1         ZIDW2                           066550
     C*****CALCULATE NEXT 29 FEB.                                         066550
     C***********ZIDW2     MULT 1461      ZIDW2                           066550
     C***********ZIDW2     ADD  60        ZIDW2                           066550
     C***********ZILP1     TAG                             * ZILP1 TAG *  066550
     C*****IF*THIS NEXT 29 FEB. DAYNO - ZIBEG IS GR. TH. OR EQ. TO        066550
     C*****ZIREM*THEN ADD 1 TO ZIMAN.                                     066550
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
     C***********ZIREM     COMP ZILPCP               94  94               066550
     C***94******ZIMAN     ADD  1         ZIMAN                           066550
     C*****SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1             066550
     C*****REQUIRED FOR THIS INTEREST CALCULATION.                        066550
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
     C***********          SETOF                     94                   066550
     C***********ZICAL     TAG                             * ZICAL TAG *  066550
     C***********                                                         066550
     C****CALCULATE INTEREST                                              066550
     C***90******                                                         066550
     C*R*91******                                                         066550
     C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
     C***92******                                                         066550
     C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
     C***********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
     C***********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST 066550
     C***********                                                         066550
     C***********          SETOF                     909192               066550
     C***********          SETOF                     959697               066550
     C***********          ENDSR                                          066550
     C***********                                                         066550
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
     C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
     C**
     C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
     C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
     C**
     C           ZSAVE     BEGSR                           *** ZSAVE ***
     C**
     C                     BITOF'01234567'ZBITS   1
     C   90                BITON'0'       ZBITS
     C   91                BITON'1'       ZBITS
     C   92                BITON'2'       ZBITS
     C   93                BITON'3'       ZBITS
     C   94                BITON'4'       ZBITS
     C   95                BITON'5'       ZBITS
     C   96                BITON'6'       ZBITS
     C   97                BITON'7'       ZBITS
     C**
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     9697
     C**
     C                     ENDSR
     C**
     C**
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZRSTOR SR. TO RESTORE INDICATORS 90 - 97 TO THE SETTINGS
     C**              THEY HAD BEFORE THE EXECUTION OF SR. ZSAVE.
     C**
     C           ZRSTOR    BEGSR                           *** ZRSTOR ***
     C**
     C                     TESTB'0'       ZBITS          90
     C                     TESTB'1'       ZBITS          91
     C                     TESTB'2'       ZBITS          92
     C                     TESTB'3'       ZBITS          93
     C                     TESTB'4'       ZBITS          94
     C                     TESTB'5'       ZBITS          95
     C                     TESTB'6'       ZBITS          96
     C                     TESTB'7'       ZBITS          97
     C**
     C                     ENDSR
     C**
     C**
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C** S/R DLRREX
     C** PROCEDURE TO CALCULATE EXPOSURE AMOUNTS OF FRA/IRS
     C**
     C** INPUT:  START DATE                                          RRSD
     C**         END DATE(VALUE DATE FOR FRA, MATURITY DATE FOR IRS) RRED
     C**                 MIDAS DAY NUMBERS(5,0)
     C**         PRINCIPAL AMOUNT 13,0                               RRPA
     C**         DEAL TYPE 2A                                        RRDT
     C**
     C** OUTPUT: EXPOSURE AMOUNT 13,0                                RREA
     C**
     C           DLRREX    BEGSR
     C**
     C** DEFINE FIELDS
     C                     Z-ADDRRPA      RRPA   130
     C                     Z-ADDRRSD      RRSD    50
     C                     Z-ADDRRED      RRED    50
     C                     Z-ADD0         RREA   130
     C                     MOVE RRDT      RRDT    2
     C**
     C** IF PRINCIPAL IS ZERO, DO NOT PROCESS
     C           RRPA      CABEQ0         RRXEND
     C**
     C** DETERMINE FRA/IRS AND SET UP APPROPRIATE PERCENTAGES/PERIODS
     C** DEAL TYPE 'FR' IS FRA, ALL OTHERS ARE IRS
     C           RRDT      IFEQ 'FR'
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL0401CVSF                                           S01408
     C*****                Z-ADDFRLPC     RRLPC   74                      S01194
     C                     Z-ADDBQFLPC    RRLPC   74                      S01194
     C*****                Z-ADDFRLPD     RRLPD   40                      S01194
     C                     Z-ADDBQFLPD    RRLPD   40                      S01194
     C*****                Z-ADDFRUPC     RRUPC   74                      S01194
     C                     Z-ADDBQFUPC    RRUPC   74                      S01194
     C*****                Z-ADDFRUPD     RRUPD   40                      S01194
     C                     Z-ADDBQFUPD    RRUPD   40                      S01194
     C                     ELSE
     C*****                Z-ADDIRLPC     RRLPC   74                      S01194
     C                     Z-ADDBQILPC    RRLPC   74                      S01194
     C*****                Z-ADDIRLPD     RRLPD   40                      S01194
     C                     Z-ADDBQILEP    RRLPD   40                      S01194
     C*****                Z-ADDIRUPC     RRUPC   74                      S01194
     C                     Z-ADDBQIUPC    RRUPC   74                      S01194
     C*****                Z-ADDIRUPD     RRUPD   40                      S01194
     C                     Z-ADDBQIUEP    RRUPD   40                      S01194
     C                     END
     C**
     C** IF UPPER END PERIOD IS ZERO, CALCULATE EXPOSURE AMOUNT BY
     C** OBTAINING LOWER END % OF PRINCIPAL
     C           RRUPD     IFEQ 0
     C           RRPA      DIV  100       RRAMT  152
     C           RRAMT     MULT RRLPC     RREA      H
     C                     GOTO RRXEND
     C                     END
     C**
     C** IF UPPER END PERIOD IS NOT ZERO AND LOWER END PERIOD
     C** WHEN ADDED TO START DATE, IS GREATER THAN END DATE
     C** CALCULATE EXPOSURE AMOUNT BY OBTAINING LOWER END % OF PRINCIPAL
     C           RRSD      ADD  RRLPD     RRCHK   50
     C***********RRCHK     IFGT RRED                                      029001
     C           RRCHK     IFGE RRED                                      029001
     C           RRPA      DIV  100       RRAMT
     C           RRAMT     MULT RRLPC     RREA      H
     C                     GOTO RRXEND
     C                     END
     C**
     C** OTHERWISE, ADD THE UPPER END PERIOD TO THE START DATE
     C** AND IF THE RESULT IS LESS THAN THE END DATE, CALCULATE
     C** EXPOSURE AMOUNT BY OBTAINING UPPER END % OF PRINCIPAL
     C           RRSD      ADD  RRUPD     RRCHK
     C***********RRCHK     IFLT RRED                                      029001
     C           RRCHK     IFLE RRED                                      029001
     C           RRPA      DIV  100       RRAMT
     C           RRAMT     MULT RRUPC     RREA      H
     C                     GOTO RRXEND
     C                     END
     C**
     C** FINALLY, IF NONE OF THESE CASES WAS SATISFIED, THE EXPOSURE
     C** AMOUNT IS CALCULATED USING THE FOLLOWING % OF THE PRINCIPAL
     C**
     C**   LPC  +  ( (ED - (SD + LPD)) X (UPC - LPC) )  |   A
     C**           ( ------------------------------- )  |   -
     C**           (            UPD - LPD            )  |   B
     C**
     C           RRSD      ADD  RRLPD     RRCHK            SD + LPD
     C           RRED      SUB  RRCHK     RRA1    50       ED - (SD + LPD)
     C**
     C           RRUPC     SUB  RRLPC     RRA2    74       UPC - LPC
     C           RRA1      MULT RRA2      RRA    158       RRPC = A
     C**
     C           RRUPD     SUB  RRLPD     RRB     50       UPD - LPD = B
     C**
     C           RRA       DIV  RRB       RRADB  158H      A/B
     C           RRLPC     ADD  RRADB     RRPC   158       LPC + A/B
     C**
     C           RRPA      DIV  100       RRAMT            PERCENTAGE
     C           RRAMT     MULT RRPC      RREA      H      CALCULATION
     C**
     C           RRXEND    ENDSR
     C**                                                              *
     C**************************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*   SR: DLRADS - TO CALCULATE DISCOUNTED SETTLED AMOUNT FOR FRA *
     C*                                                               *
     C*   CALLED FROM :- FRSETT                                       *
     C*   CALLS       :- ZDATE1,ZDATE2                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           DLRADS    BEGSR                           ** DLRADS **
     C*
     C                     Z-ADDSZVDAT    SZVDAT  50
     C                     Z-ADDSZMDAT    SZMDAT  50
     C                     Z-ADDSZPPL     SZPPL  130
     C                     Z-ADDSZFIX     SZFIX  117
     C                     Z-ADDSZFLT     SZFLT  117
     C                     Z-ADDSZICB     SZICB   10
     C                     Z-ADDSZIANP    SZIANP 130
     C                     Z-ADD0         SZICVL  30
     C                     Z-ADD0         SZSDAT  50
     C                     Z-ADD0         SZEDAT  50
     C                     Z-ADD0         SZPER   50
     C                     Z-ADD0         SPPER   50                                        MD051152
     C                     Z-ADD0         STYR    20
     C                     Z-ADD0         STWRK   40
     C                     Z-ADD0         STDAY   20
     C                     Z-ADD0         STMTH   20
     C                     Z-ADD0         ENDYR   20
     C                     Z-ADD0         ENDWRK  40
     C                     Z-ADD0         ENDDAY  20
     C                     Z-ADD0         ENDMTH  20
     C                     Z-ADD0         YEAR1   40
     C                     Z-ADD0         STORE   40
     C                     Z-ADD0         CHK     10
     C                     Z-ADD0         YEAR2   40
     C                     Z-ADD0         DAY1    20
     C                     Z-ADD0         MTHS    20
     C                     Z-ADD0         MTHS2   40
     C                     Z-ADD0         SZWRK1 117
     C**********           Z-ADD0         SZWRK2 157                      043304
     C                     Z-ADD0         SZWRK2 207                      043304
     C                     Z-ADD0         SZWRK3  50
     C                     Z-ADD0         SZWRK4 147
     C                     Z-ADD0         SZWRK5 147
     C**********           Z-ADD0         SZWRK6 159                      E35983
     C**********           Z-ADD0         SZWRK6 150                                 E35983 MD058815
     C                     Z-ADD0         SZWRK6 180                                        MD058815
     C                     Z-ADD0         SZWRK7 129
     C                     Z-ADD0         SZWRK8 150                      AUS021
     C                     Z-ADD0         SZWRK9 157                      AUS021
     C                     Z-ADD0         SZSETL 150
     C                     Z-ADD0         SZRDF  117
     C                     Z-ADD0         SZRSA  150
     C                     Z-ADD0         SZRDS  130
     C                     Z-ADD0         SZDISC 117
     C                     Z-ADD0         SZDSA  150
     C                     Z-ADD0         DATST   60
     C                     Z-ADD0         DATEND  60
     C                     Z-ADD0         SLEAP   50
     C                     Z-ADD0         ELEAP   50
     C                     Z-ADD0         CHK2    10
     C                     SETOF                     89
     C*                                                                   AUS021
     C**  CHECK IF AUSTRALIA FORMULA REQUIRED                             AUS021
     C*                                                                   AUS021
     C           SETF      IFEQ 'A'                                       AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING AUSTRALIAN         AUS021
     C*   FORMULA                                                         AUS021
     C*                                                                   AUS021
     C**  CALCULATE DAYS TO MATURITY                                      AUS021
     C*                                                                   AUS021
     C           SZMDAT    SUB  SZVDAT    SZWRK3                          AUS021
     C*                                                                   AUS021
     C**  MULTIPLY FACE VALUE BY (DAYS IN YEAR x 100)                     AUS021
     C*                                                                   AUS021
     C           SZPPL     MULT 36500     SZSETL                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE PROCEEDS FROM FLOATING RATE                           AUS021
     C*                                                                   AUS021
     C           SZWRK3    MULT SZFLT     SZWRK2                          AUS021
     C                     ADD  36500     SZWRK2                          AUS021
     C           SZWRK2    IFNE *ZEROS                                    AUS021
     C           SZSETL    DIV  SZWRK2    SZRSA     H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZRSA                           AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  CALCULATE PROCEEDS FROM FIXED AMOUNT                            AUS021
     C*                                                                   AUS021
     C           SZWRK3    MULT SZFIX     SZWRK2                          AUS021
     C                     ADD  36500     SZWRK2                          AUS021
     C           SZWRK2    IFNE *ZEROS                                    AUS021
     C           SZSETL    DIV  SZWRK2    SZWRK8    H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZWRK8                          AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT                          AUS021
     C*                                                                   AUS021
     C           SZRSA     IFGT SZWRK8                                    040318
     C           SZRSA     SUB  SZWRK8    SZRDS                           AUS021
     C                     ELSE                                           040318
     C           SZWRK8    SUB  SZRSA     SZRDS                           040318
     C                     END                                            040318
     C*                                                                   AUS021
     C                     ELSE                                           AUS021
     C*                                                                   AUS021
     C**  CHECK IF U.S.A FORMULA REQUIRED                                 AUS021
     C*                                                                   AUS021
     C           SETF      IFEQ 'U'                                       AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING U.S.A FORMULA      AUS021
     C*                                                                   AUS021
     C**  CALCULATE DAYS TO MATURITY                                      AUS021
     C*                                                                   AUS021
     C           SZMDAT    SUB  SZVDAT    SZWRK3                          AUS021
     C*                                                                   AUS021
     C**  MULTIPLY INTEREST SETTLEMENT RATE BY DAYS TO MATURITY           AUS021
     C**  AND ADD (DAYS IN YEAR x 100)                                    AUS021
     C*                                                                   AUS021
     C           SZFLT     MULT SZWRK3    SZWRK9                          AUS021
     C                     ADD  36000     SZWRK9                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE DIFFERENCE in RATES                                   AUS021
     C*                                                                   AUS021
     C           SZFLT     IFGT SZFIX                                     AUS021
     C           SZFLT     SUB  SZFIX     SZWRK1                          AUS021
     C                     ELSE                                           AUS021
     C           SZFIX     SUB  SZFLT     SZWRK1                          AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  MULTIPLY DIFFERENCE IN RATES BY DAYS TO MATURITY AND            AUS021
     C**  CONTRACT AMOUNT                                                 AUS021
     C*                                                                   AUS021
     C           SZWRK1    MULT SZWRK3    SZWRK2                          AUS021
     C           SZWRK2    MULT SZPPL     SZWRK2                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT                          AUS021
     C*                                                                   AUS021
     C           SZWRK9    IFNE *ZEROS                                    AUS021
     C           SZWRK2    DIV  SZWRK9    SZRDS     H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZRDS                           AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C                     ELSE                                           AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING U.K. FORMULA       AUS021
     C*                                                                   AUS021
     C*
     C**  DETERMINE VALUE ASSOCIATED WITH INTEREST CALCULATION BASIS
     C*
     C           SZICB     IFEQ 2
     C           SZICB     OREQ 3
     C           SZICB     OREQ 5
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C                     Z-ADD360       SZICVL
     C                     END
     C*
     C           SZICB     IFEQ 1
     C           SZICB     OREQ 4
     C                     Z-ADD365       SZICVL
     C                     END
     C*
     C           SZICB     IFEQ 6
     C                     Z-ADD366       SZICVL
     C                     END
     C*
     C**  SET START DATE EQUAL TO VALUE DATE
     C*
     C                     Z-ADDSZVDAT    SZSDAT
     C*
     C**  PROCESS UNTIL END DATE IS GREATER THAN MATURITY DATE
     C*
     C           *IN89     DOUEQ'1'
     C*
     C**  EXECUTE SUB-ROUTINE ZDATE2
     C*
     C                     Z-ADDSZSDAT    ZDAYNO
     C*
     C                     EXSR ZDATE2
     C*                                                                   100140
     C* 29th February does not exist in a non-leap year.                  100140
     C*                                                                   100140
     C           ZMTH      IFEQ 02                                        100140
     C           ZDAY      ANDEQ29                                        100140
     C                     Z-ADD28        ZDAY                            100140
     C           *IN98     IFEQ '0'                                       156954
     C                     MOVELZDAY      ZDATE                           100140
     C                     ELSE                                           156954
     C                     MOVE ZDAY      W@MDY   40P                     156954
     C                     MOVELZMTH      W@MDY                           156954
     C                     MOVELW@MDY     ZDATE                           156954
     C                     END                                            156954
     C                     END                                            100140
     C*
     C**  INCREMENT YEAR BY 1
     C*
     C                     ADD  1         ZYEAR
     C                     MOVE ZYEAR     ZDATE
     C*
     C**  EXECUTE SUB-ROUTINE ZDATE1
     C*
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SZEDAT
     C*                                                                   031967
     C**  CHECK TO SEE IF MATURITY DATE FALLS BETWEEN PERIOD END DATE     031967
     C****AND*PERIOD*END*DATE*+*5*(THIS*WILL*ONLY*HAPPEN*IF*AN*FRA**031967060995
     C**  AND PERIOD END DATE + 10 (THIS WILL ONLY HAPPEN IF AN FRA 031967060995
     C**  WAS ENTERED WITH AN INCREASED MATURITY DATE DUE TO THE          031967
     C**  ACTUAL MATURITY DATE FALLING ON A NON-WORKING DAY).             031967
     C**  IF IT DOES DO THE LATER DISCOUNTED SETTLEMENT AMOUNT            031967
     C**  CALCULATION UPTO MATURITY DATE OTHERWISE UPTO THE PERIOD        031967
     C**  END DATE. THE NUMBER 5 WAS CHOSEN AS THIS IS THE WORST          031967
     C**  POSIBLE CASE OF NON-WORKING DAYS IN A ROW (EASTER).             031967
     C*                                                                   031967
     C***********SZEDAT    ADD  5         #EDAT   50                031967060995
     C           SZEDAT    ADD  10        #EDAT   50                031967060995
     C*
     C**  IF END DATE IS GREATER THAN THE MATURITY DATE
     C**  THEN REPLACE END DATE  BY MATURITY DATE
     C*
     C           SZEDAT    IFGE SZMDAT
     C           SZEDAT    ORLT SZMDAT                                    031967
     C           #EDAT     ANDGESZMDAT                                    031967
     C                     SETON                     89
     C                     Z-ADDSZMDAT    SZEDAT
     C                     END
      *                                                                   CIR013
     C           SZICB     IFEQ 9                                         CIR013
     C           SZICB     OREQ 6                                                           MD051152
      * Convert start date to YYYYMMDD format                             CIR013
     C                     Z-ADDSZSDAT    @@DAYN  50                      CIR013
     C                     EXSR ZDATE9                                    CIR013
     C                     Z-ADD@@VDT     ZZDATA                          CIR013
      * Convert end date to YYYYMMDD format                               CIR013
     C                     Z-ADDSZEDAT    @@DAYN                          CIR013
     C                     EXSR ZDATE9                                    CIR013
     C                     Z-ADD@@VDT     ZZDATB                          CIR013
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
      *                                                                   CIR013
     C           SZICB     IFEQ 9                                                           MD051152
      *                                                                                     MD051152
     C                     EXSR #FEB29                                    CIR013
      *                                                                   CIR013
     C           #29FEB    IFEQ 'N'                                       CIR013
     C                     Z-ADD365       SZICVL                          CIR013
     C                     ELSE                                           CIR013
     C                     Z-ADD366       SZICVL                          CIR013
     C                     ENDIF                                          CIR013
      *                                                                   CIR013
     C                     ENDIF                                          CIR013
     C*
     C**  CALCULATE THE PERIOD BETWEEN START DATE AND END DATE
     C*
     C           SZICB     IFEQ 1
     C           SZICB     OREQ 2
     C           SZICB     OREQ 6
     C           SZICB     OREQ 9                                         CIR013
     C           #29FEB    ANDEQ'Y'                                       CIR013
     C           SZEDAT    SUB  SZSDAT    SZPER
     C                     END
      *                                                                                     MD051152
      ** Perform no. of days calculation for method 6                                       MD051152
     C           SZICB     IFEQ 6                                                           MD051152
      *                                                                                     MD051152
      ** If start and end date are in the same year, check if the                           MD051152
      ** year is a leap year and add no. of interest days to the                            MD051152
      ** relevant total                                                                     MD051152
     C           ZZYY1     IFEQ ZZYY2                                                       MD051152
     C           ZZYY1     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
     C                     Z-ADDSZPER     SPPER                                             MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
      ** else must break down the interest period into leap years                           MD051152
      ** and non-leap years                                                                 MD051152
     C                     ELSE                                                             MD051152
      ** Add 1 to starting year number                                                      MD051152
     C           ZZYY1     ADD  1         ZZYY2                                             MD051152
      * Get Midas day number for 1st Jan of year after start date                           MD051152
     C                     MOVE '01'      ZZMM2                                             MD051152
     C                     MOVE '01'      ZZDD2                                             MD051152
     C                     MOVE ZZDATB    ZZDTIN                                            MD051152
     C                     EXSR ZDAT10                                                      MD051152
     C                     Z-ADDZZMDNO    ZZENDW  50                                        MD051152
     C           ZZENDW    SUB  SZSDAT    SPPER                                             MD051152
      *                                                                                     MD051152
      ** Check if current year is a leap year                                               MD051152
     C           ZZYY1     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
      * Finally calculate the days for the last part-year up                                MD051152
      * to the end date                                                                     MD051152
      *                                                                                     MD051152
      * Get Midas day number for 1st Jan of current year                                    MD051152
     C                     MOVE '01'      ZZMM2                                             MD051152
     C                     MOVE '01'      ZZDD2                                             MD051152
     C                     MOVE ZZDATB    ZZDTIN                                            MD051152
     C                     EXSR ZDAT10                                                      MD051152
     C                     Z-ADDZZMDNO    ZZBEG   50                                        MD051152
     C           SZEDAT    SUB  ZZBEG     SPPER                                             MD051152
      *                                                                                     MD051152
      ** Check if year is a leap year                                                       MD051152
     C           ZZYY2     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
     C                     ENDIF                                                            MD051152
     C*
     C**  IF THE END DATE IS LESS THAN OR EQUAL TO THE MATURITY DATE
     C*
     C           *IN89     IFEQ '0'
     C*
     C           SZICB     IFEQ 3
     C           SZICB     OREQ 4
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C           SZICB     OREQ 9                                         CIR013
     C           #29FEB    ANDEQ'N'                                       CIR013
     C                     Z-ADDSZICVL    SZPER
     C                     END
     C*
     C           SZICB     IFEQ 5
     C                     Z-ADD365       SZPER
     C                     END
     C*
     C                     ELSE
     C*
     C**  THE END DATE WAS REPLACED BY THE MATURITY DATE
     C*
     C           SZICB     IFEQ 4
     C           SZICB     OREQ 5
     C           SZICB     OREQ 9                                         CIR013
     C           #29FEB    ANDEQ'N'                                       CIR013
     C           SZEDAT    SUB  SZSDAT    SZPER
     C*
     C**  CONVERT BOTH START AND END DAY NUMBERS TO DATES
     C*
     C                     Z-ADDSZSDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATST
     C*
     C                     Z-ADDSZEDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATEND
     C*
     C**  ATTEMPT TO CALCULATE THE DAY NUMBER FOR 29 FEB IN THE YEAR
     C*
     C           *IN98     IFEQ '0'
     C                     MOVEL'2902'    DATST
     C                     MOVEL'2902'    DATEND
     C                     ELSE
     C                     MOVEL'0229'    DATST
     C                     MOVEL'0229'    DATEND
     C                     END
     C*
     C                     Z-ADDDATST     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SLEAP
     C*
     C**  IF A DAY NUMBER IS FOUND CHECK IF IT LIES BETWEEN START DATE
     C**  AND END DATE
     C*
     C           *IN99     IFEQ '0'
     C*
     C           SLEAP     IFGE SZSDAT
     C           SLEAP     ANDLESZEDAT
     C           SZPER     SUB  1         SZPER
     C                     END
     C                     END
     C*
     C                     Z-ADDDATEND    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    ELEAP
     C*
     C           *IN99     IFEQ '0'
     C*
     C           ELEAP     IFGE SZSDAT
     C           ELEAP     ANDLESZEDAT
     C           SZPER     SUB  1         SZPER
     C                     END
     C                     END
     C*
     C                     END
     C*
     C**  FOR METHOD 3 SPLIT BOTH START AND END DATES INTO THEIR
     C**  RESPECTIVE DAY,MONTH AND YEAR PORTIONS
     C*
     C           SZICB     IFEQ 3
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C*
     C                     Z-ADD0         SZPER
     C*
     C                     Z-ADDSZSDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATST
     C*
     C                     MOVE DATST     STYR
     C                     MOVE DATST     STWRK
     C           *IN98     IFEQ '0'
     C                     MOVELDATST     STDAY
     C                     MOVELSTWRK     STMTH
     C                     ELSE
     C                     MOVELDATST     STMTH
     C                     MOVELSTWRK     STDAY
     C                     END
     C*
     C                     Z-ADDSZEDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATEND
     C*
     C                     MOVE DATEND    ENDYR
     C                     MOVE DATEND    ENDWRK
     C           *IN98     IFEQ '0'
     C                     MOVELDATEND    ENDDAY
     C                     MOVELENDWRK    ENDMTH
     C                     ELSE
     C                     MOVELDATEND    ENDMTH
     C                     MOVELENDWRK    ENDDAY
     C                     END
     C*
     C**  CHECK START DATE FOR LEAP YEAR
     C*
     C           STYR      ADD  1900      YEAR1
     C           YEAR1     DIV  4         STORE
     C                     MVR            CHK
     C*
     C**  CHECK END DATE FOR LEAP YEAR ALLOWING FOR CHANGE IN CENTURY
     C*
     C           ENDYR     ADD  1900      YEAR2
     C           YEAR2     IFLT YEAR1
     C                     ADD  100       YEAR2
     C                     END
     C           YEAR2     DIV  4         STORE
     C                     MVR            CHK2
     C*
     C**  IF START MONTH DOES NOT EQUAL 2 SUBTRACT DAY PORTION FROM 30
     C**  SETTING NEGATIVE RESULT TO ZERO FOR ACTUAL DAYS IN MONTH
     C*
     C           STMTH     IFNE 2
     C           30        SUB  STDAY     SZPER
     C           SZPER     IFLT 0
     C                     Z-ADD0         SZPER
     C                     END
     C                     END
     C*
     C**  IF MONTH DOES EQUAL 2
     C*
     C           STMTH     IFEQ 2
     C*
     C**  IF IT IS NOT A LEAP YEAR SUBTRACT DAY PORTION FROM 28
     C*
     C           CHK       IFNE 0
     C           28        SUB  STDAY     SZPER
     C                     ELSE
     C*
     C**  IF IT IS A LEAP YEAR SUBTRACT DAY PORTION FROM 29
     C*
     C           29        SUB  STDAY     SZPER
     C                     END
     C                     END
     C*
     C**  ADJUST START MONTH & YEAR TO CATER FOR YEAR END
     C*
     C           STMTH     IFEQ 12
     C                     Z-ADD0         STMTH
     C                     ADD  1         YEAR1
     C                     END
     C*
     C**  IF END MONTH IS NOT EQUAL TO 2 AND END DAY IS 31; OR MONTH
     C**  EQUALS 2 AND IT IS NOT A LEAP YEAR AND END DAY EQUALS 28;
     C**  OR MONTH EQUALS 2 AND IT IS A LEAP YEAR AND END DAY
     C**  EQUALS 29 THEN ADD 30 TO PERIOD COUNT
     C*
     C           ENDMTH    IFNE 2
     C           ENDDAY    ANDEQ31
     C           ENDMTH    OREQ 2
     C           CHK2      ANDNE0
     C           ENDDAY    ANDEQ28
     C           SZICB     ANDEQ3                                         CIR004
     C           ENDMTH    OREQ 2
     C           CHK2      ANDEQ0
     C           ENDDAY    ANDEQ29
     C           SZICB     ANDEQ3                                         CIR004
     C*
     C                     ADD  30        SZPER
     C*
     C                     ELSE
     C*
     C**  ADD DAY NUMBER PORTION TO PERIOD COUNT
     C*
     C                     ADD  ENDDAY    SZPER
     C*
     C                     END
     C*
     C**  SUBTRACT 1 FROM END MONTH
     C*
     C                     SUB  1         ENDMTH
     C*
     C**  IF START YEAR AND END YEAR ARE THE SAME SUBTRACT START
     C**  MONTH FROM END MONTH
     C*
     C           YEAR1     IFEQ YEAR2
     C           ENDMTH    SUB  STMTH     MTHS
     C                     ELSE
     C*
     C**  ADD END MTH TO THE RESULT OF SUBTRACTING START MONTH FROM 12
     C*
     C           12        SUB  STMTH     MTHS
     C           ENDMTH    ADD  MTHS      MTHS
     C                     END
     C*
     C**  MULTIPLY THE NUMBER OF MONTHS BY 30 AND ADD TO THE PERIOD
     C*
     C           MTHS      MULT 30        MTHS2
     C                     ADD  MTHS2     SZPER
     C*
     C                     END
     C*
     C                     END
     C*
     C**  CALCULATE THIS PERIOD'S DISCOUNTED SETTLEMENT AMOUNT USING
     C**  THIS EQUATION WHERE SS = SETTLEMENT AMOUNT
     C**                       D = PERIOD
     C**
     C**        SS = (BASE RATE - FIXED RATE) x D x PRINCIPAL
     C**             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C**             (INTEREST CALC BASIS x 100) + (BASE RATE x D)
     C*
     C           SZICB     IFNE 6                                                           MD051152
      *                                                                                     MD051152
     C           SZFLT     IFGE SZFIX
     C*
     C           SZFLT     SUB  SZFIX     SZWRK1
     C*
     C                     ELSE
     C*
     C           SZFIX     SUB  SZFLT     SZWRK1
     C*
     C                     END
     C*
     C           SZWRK1    MULT SZPER     SZWRK2
      *                                                                   E35983
      * Multiply now by principal to get larger value for dividing        E35983
      * and avoid errors due to half-adjusting small numbers later        E35983
     C           SZWRK2    MULT SZPPL     SZWRK6                          E35983
      *                                                                   E35983
     C           SZICVL    MULT 100       SZWRK3
     C           SZFLT     MULT SZPER     SZWRK4
     C           SZWRK3    ADD  SZWRK4    SZWRK5
     C********** SZWRK2    DIV  SZWRK5    SZWRK6    H                     E35983
     C           SZWRK6    DIV  SZWRK5    SZSETL    H                     E35983
     C********** SZWRK6    MULT SZPPL     SZSETL    H                     E35983
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
     C*
     C**  IF VALUE DATE = START DATE THEN FIRST PERIOD SO INITIALISE
     C**  RUNNING DISCOUNT FACTOR TO 1
     C*
     C           SZVDAT    IFEQ SZSDAT
     C*
     C                     Z-ADD1         SZRDF
     C                     Z-ADDSZSETL    SZRDS
     C                     ELSE
     C*                                                                   E22610
     C**  DIVIDE THE DISCOUNTED SETTLEMENT AMOUNT BY THE RUNNING          E22610
     C**  DISCOUNT FACTOR TO REDISCOUNT THIS PERIOD'S SETTLEMENT AMOUNT   E22610
     C**  BACK TO START DATE                                              E22610
     C*                                                                   E22610
     C           SZSETL    DIV  SZRDF     SZRSA     H                     E22610
     C*                                                                   E22610
     C**  ADD THE REDISCOUNTED SETTLEMENT AMOUNT TO THE RUNNING           E22610
     C**  DISCOUNTED  SETTLEMENT TOTAL                                    E22610
     C*                                                                   E22610
     C           SZRSA     ADD  SZRDS     SZRDS                           E22610
     C*                                                                   E22610
     C                     END                                            E22610
      *                                                                                     MD051152
     C                     Z-ADD0         SZSETL                                            MD051152
     C*
     C**  CALCULATE THIS PERIOD'S DISCOUNT FACTOR USING THE EQUATION
     C**
     C**    FACTOR = 1 +     (D x BASE RATE)
     C**                 ~~~~~~~~~~~~~~~~~~~~~~~~~~
     C**                 (INTEREST CALC BASIS x 100)
     C*
     C           SZWRK4    DIV  SZWRK3    SZWRK7    H
     C           1         ADD  SZWRK7    SZDISC    H
     C*
     C**  MULTIPLY THE DISCOUNT FACTOR BY THE RUNNING DISCOUNT FACTOR
     C**  TO OBTAIN THE NEW RUNNING DISCOUNT FACTOR FOR REDISCOUNTING
     C**  SETTLEMENT AMOUNTS BACK TO START DATE
     C*
     C           SZDISC    MULT SZRDF     SZRDF     H
     C*
     C****DIVIDE THE DISCOUNTED SETRTLEMENT AMOUNT BY THE RUNNING         E22610
     C****DISCOUNT FACTOR TO REDISCOUNT THIS PERIOD'S SETTLEMENT AM       E22610
     C****BACK TO START DATE                                              E22610
     C****                                                                E22610
     C****       SZSETL    DIV  SZRDF     SZRSA     H                     E22610
     C****                                                                E22610
     C****ADD THE REDISCOUNTED SETTLEMENT AMOUNT TO THE RUNNING           E22610
     C****DISCOUNTED  SETTLEMENT TOTAL                                    E22610
     C****                                                                E22610
     C****       SZRSA     ADD  SZRDS     SZRDS                           E22610
     C****                                                                E22610
     C****                 END                                            E22610
     C*
     C**  SET THE START DATE TO THE END DATE
     C*
     C                     Z-ADDSZEDAT    SZSDAT
     C                     END
     C*                                                                   AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C                     END                                            AUS021
     C*
     C**  ADD THE NET ACCRUED INTEREST ADJUSTMENTS NOT POSTED TO THE
     C**  RUNNING DISCOUNTED SETTLEMENT TOTAL TO GIVE THE DISCOUNTED
     C**  SETTLEMENT AMOUNT TOTAL
     C*
     C           SZIANP    ADD  SZRDS     SZDSA
     C*
     C                     ENDSR
     C*
     C**************************************************************************
      /EJECT
     C********************************************************************
     C           FRASR     BEGSR                                                            MD051152
      *                                                                                     MD051152
      **  Calculate this period's discounted settlement amount using                        MD051152
      **  this equation where SS = Settlement amount                                        MD051152
      **                       D = PERIOD                                                   MD051152
      **                                                                                    MD051152
      **        SS = (BASE RATE - FIXED RATE) x D x PRINCIPAL                               MD051152
      **             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                         MD051152
      **             (INTEREST CALC BASIS x 100) + (BASE RATE x D)                          MD051152
      *                                                                                     MD051152
     C           SZFLT     IFGE SZFIX                                                       MD051152
      *                                                                                     MD051152
     C           SZFLT     SUB  SZFIX     SZWRK1                                            MD051152
      *                                                                                     MD051152
     C                     ELSE                                                             MD051152
      *                                                                                     MD051152
     C           SZFIX     SUB  SZFLT     SZWRK1                                            MD051152
      *                                                                                     MD051152
     C                     END                                                              MD051152
      *                                                                                     MD051152
     C           SZWRK1    MULT SPPER     SZWRK2                                            MD051152
      *                                                                                     MD051152
      * Multiply now by principal to get larger value for dividing                          MD051152
      * and avoid errors due to half-adjusting small numbers later                          MD051152
     C           SZWRK2    MULT SZPPL     SZWRK6                                            MD051152
      *                                                                                     MD051152
     C           SZICVL    MULT 100       SZWRK3                                            MD051152
     C           SZFLT     MULT SZPER     SZWRK4                                            MD051152
     C           SZWRK3    ADD  SZWRK4    SZWRK5                                            MD051152
     C           SZWRK6    DIV  SZWRK5    W#SET6 180H                                       MD051152
      *                                                                                     MD051152
     C           W#SET6    ADD  SZSETL    SZSETL                                            MD051152
      *                                                                                     MD051152
     C                     ENDSR                                                            MD051152
      *                                                                                     MD051152
     C**************************************************************************            MD051152
      /SPACE 5                                                                              MD051152
     C**************************************************************************            MD051152
     C**
     C*****ZFREQ*-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A****             S01195
     C**   @FREQB - SR. TO INCREMENT A DAY NUMBER DATE BY A               S01195
     C**             PERIOD VALUE DETERMINED BY A CODE.
     C**
     C*****      ZFREQB    BEGSR                           *** ZFREQB *** S01195
     C           @FREQB    BEGSR                           *** @FREQB *** S01195
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ZFREQ     ZFREQ   1
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C                     Z-ADDZMDAY     ZMDAY   20
     C                     MOVE ZCCY      ZCCY    3
     C**
     C                     MOVE '   '     ZHC
     C                     MOVE ' '       ZTABKY 12
     C*
     C*            FIELDS USED FOR PERIOD CODES M,T,Q,X,Y
     C*
     C                     MOVE '  '      ZINDE   2
     C                     Z-ADD0         ZINTO   20
     C**
     C**   CONVERT DAY NUMBER TO DATE.
     C                     EXSR ZDATE2
     C                     SETOF                     90
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.
     C           ZFREQ     COMP 'D'                      91
     C   91      ZDAYNO    ADD  1         ZDAYNO
     C   91                GOTO ZFHCHK
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.
     C           ZFREQ     COMP 'W'                      91
     C   91      ZDAYNO    ADD  7         ZDAYNO
     C   91                GOTO ZFEND
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.
     C           ZFREQ     COMP 'F'                      91
     C   91      ZDAYNO    ADD  14        ZDAYNO
     C   91                GOTO ZFEND
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.
     C           ZFREQ     COMP 'S'                      91
     C   91      ZDAY      COMP 15                   939292
     C   91 92             Z-ADD31        ZDAY
     C   91 93             Z-ADD15        ZDAY
     C   91 93   ZMTH      ADD  1         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.
     C           ZFREQ     COMP 'M'                      91
     C   91                MOVE 'IN'      ZINDE
     C   91                Z-ADDZMDAY     ZDAY
     C   91      ZMTH      ADD  1         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTH
     C           ZFREQ     COMP 'R'                      91
     C   91                Z-ADD31        ZDAY
     C   91      ZMTH      ADD  1         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.
     C           ZFREQ     COMP 'T'                      91
     C   91                MOVE 'IN'      ZINDE
     C   91                Z-ADDZMDAY     ZDAY
     C   91      ZMTH      ADD  2         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.
     C           ZFREQ     COMP 'Q'                      91
     C   91                MOVE 'IN'      ZINDE
     C   91                Z-ADDZMDAY     ZDAY
     C   91      ZMTH      ADD  3         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.
     C           ZFREQ     COMP 'X'                      91
     C   91                MOVE 'IN'      ZINDE
     C   91                Z-ADDZMDAY     ZDAY
     C   91      ZMTH      ADD  6         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.
     C           ZFREQ     COMP 'Y'                      91
     C   91                MOVE 'IN'      ZINDE
     C   91                Z-ADDZMDAY     ZDAY
     C   91      ZYEAR     ADD  1         ZYEAR
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH.
     C           ZFREQ     COMP 'L'                      91
     C   91                Z-ADD31        ZDAY
     C   91      ZMTH      ADD  1         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.
     C           ZFREQ     COMP 'B'                      91
     C   91                Z-ADD31        ZDAY
     C   91      ZMTH      ADD  1         ZMTH
     C   91                GOTO ZFDATE
     C**
     C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.
     C           ZFREQ     COMP 'A'                      91
3758 C***91*               MOVEL'01    '  ZTABKY                          S01195
     C***91*               MOVE '    11'  ZTABKY                          S01195
     C***91*     ZTABKY    CHAINTABLE                99    ON NOT THERE   S01195
     C**N99*     RECI      COMP '*'                      99               S01195
     C***91N99             Z-ADDAPDA      ZDAYNO                          S01194
      *                                                                   S01194
      ** Since the GENERAL LEDGER file needs to be called only once,      S01194
      ** the file is called at the start of the program.                  S01194
      *                                                                   S01194
     C   91                Z-ADDBKAPDT    ZDAYNO                          S01194
     C**
     C**   BYPASS IF ZFREQ IS 'A' OR ANY OTHER VALUE
     C                     GOTO ZFEND
     C**
     C**
     C**   REFORMAT DATE AND ENSURE VALID.
     C           ZFDATE    TAG                             ** ZFDATE TAG*
     C**
     C**   VALIDATE MONTH.
     C           ZMTH      COMP 12                   91
     C   91      ZMTH      SUB  12        ZMTH
     C   91      ZYEAR     ADD  1         ZYEAR
     C**
     C**   CHECK FOR LEAP YEAR.
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     92LEAP YEAR-92 ON
     C**
     C**   VALIDATE DAY NUMBER.
     C                     MOVE ZFMD,ZMTH ZWRK2   20
     C           ZMTH      COMP 2                        93
     C   92 93             Z-ADD29        ZWRK2
     C**
     C           ZDAY      COMP ZWRK2                94
     C   94                Z-ADDZWRK2     ZDAY
     C**
     C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.
     C           ZFREQ     COMP 'R'                      91
     C   91      ZDAY      SUB  6         ZDAY
     C**
     C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C   98                MOVE ZDAY      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
     C**
     C**   CHECK IF CODE B, OR M,T,Q,X,Y TO BE CHECKED FOR HOLIDAY.
     C           ZFREQ     COMP 'B'                      91
     C           ZINDE     COMP 'IN'                     92
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP23                                           S01408
     C*                                                                   S01408
     C   92N99
     COR 91N99             GOTO ZFHCHK
     C**
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CP24                                           S01408
     C*                                                                   S01408
     C                     GOTO ZFEND
     C**
     C**   CHECK IF DAY NUMBER IS A HOLIDAY.
     C**
     C           ZFHCHK    TAG                             ** ZFHCHK TAG *
     C                     SETOF                     94
     C           ZFREQ     COMP 'D'                      91
     C           ZFREQ     COMP 'B'                      92
     C   91
     COR 92                GOTO ZSETK
     C*
     C*   FOR CODES M,T,Q,X,Y, CHECK ZINDE - 'IN' TO INCREMENT,
     C*                                    - 'DE' TO DECREMENT
     C*
     C           ZINDE     COMP 'IN'                     90
     C           ZINDE     COMP 'IN'                     91
     C           ZINDE     COMP 'DE'                     92
     C**
     C******ET KEY FOR FIRST HOLIDAY RECORD.                              S01195
     C           ZSETK     TAG                             ** ZSETK TAG **
3827 C******               MOVEL'22    '  ZTABKY                          S01195
3828 C******               MOVELZDAYNO    ZWRK6   6                       S01195
3829 C******               MOVE 1         ZWRK6                           S01195
3830 C******               MOVE ZWRK6     ZTABKY                          S01195
3831 C******                                                              S01195
3832 C******ET HOLIDAY RECORD.                                            S01195
3833 C******     ZFHCHN    TAG                             ** ZFHCHN TAG* S01195
3834 C******     ZTABKY    CHAINTABLE                93    ON NOT THERE   S01195
3835 C**N93*     RECI      COMP '*'                      93               S01195
     C**N94*               MOVE '   '     ZHC                             S01195
3836 C******                                                              S01195
3837 C*****STORE CURRENCIES IF RECORD FOUND.                              S01195
3838 C**N94N93             MOVEAHCCY      ZHC,1                           S01195
3839 C***94N93             MOVEAHCCY      ZHC,26                          S01195
3840 C********                                                            S01195
3841 C*****GET SECOND RECORD, IF NOT ALREADY DONE.                        S01195
3842 C********             MOVE ZTABKY    ZWRK1N  10                      S01195
3843 C********   ZWRK1N    COMP 1                        94               S01195
3844 C********             MOVE '2'       ZTABKY                          S01195
3845 C***94N93             GOTO ZFHCHN                                    S01195
3846 C********                                                            S01195
3847 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
3848 C***93*94             GOTO ZFEND                                     S01195
3849 C*                                                                   S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
3850 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
3851 C********   INEX      COMP 'E'                      95               S01195
3852 C********   INEX      COMP 'I'                      96               S01195
3853 C********                                                            S01195
3854 C*    CHECK IF CURRENCY ON HOLIDAY.                                  S01195
     C*                                                                   S01195
3855 C********   ZCCY      LOKUPZHC                      97               S01195
     C           ZIND      CABEQ'W'       ZFEND                           S01195
     C**
     C**   BYPASS IF NOT HOLIDAY FOR CURRENCY.
3858 C***95*97                                             EXCLUDE FOUND  S01195
3859 C*R*96N97             GOTO ZFEND                      INCL. NOT FOUNDS01195
     C**
     C**
     C   92                GOTO ZDECR
     C*
     C**   INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.
     C   91      ZDAYNO    ADD  1         ZDAYNO
     C*
     C*    ONLY FOR PERIOD CODE = M,T,Q,X OR Y, IF INCREMENTATION
     C*    TAKES THE OUTPUT DATE INTO THE FOLLOWING MONTH, RETURN TO
     C*    THE INPUT DATE AND DECREMENT - 92 ON.
     C*
     C   90 91   ZINTO     ADD  1         ZINTO
     C   90 91   ZINTO     ADD  ZDAY      ZINTOT  20
     C   90 91             MOVE ZINTOT    ZINTOA  2
     C**TO ALLOW 29 FEB ON LEAP YEARS TO PASS
     C                     SETOF                     93
     C   90 91   ZYEAR     DIV  4         ZLYR
     C   90 91             MVR            ZLY            92
     C   90 91 92ZMTH      COMP 2                        93
     C   93      ZINTOA    COMP '29'                 92
     C   90 91N93ZINTOA    COMP ZFMD,ZMTH            92
     C   90 91 92ZDAYNO    SUB  ZINTO     ZDAYNO
     C   90 91 92          MOVE 'DE'      ZINDE
     C**
     C           ZDECR     TAG                             ** ZDECR TAG **
3879 C***92*95N97                                          EXCL. NOT FOUNDS01195
3880 C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO           INCLUDE FOUND  S01195
3880 C   92      ZDAYNO    SUB  1         ZDAYNO                          S01195
     C                     GOTO ZFHCHK
     C**
     C**
     C           ZFEND     ENDSR                           * ZFEND ENDSR *
     C**
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C**
     C**
     C**************************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C**************************************************************************
      /EJECT
     C********************************************************************S01195
     C*********************                                               S01195
     C*****ZDATE5*SR.*TO*DETERMINE IF A DAY NUMBER DATE IS A HOLIDAY      S01195
     C****************IN*GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY         S01195
     C****************AND*IF REQUIRED, DETERMINE NEXT WORKING DAY.        S01195
     C*********************                                               S01195
     C***********ZDATE5****BEGSR                           *** ZDATE5 *** S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE INPUT FIELDS.                           S01195
     C*********************Z-ADDZDAYNO    ZDAYNO  50                      S01195
     C*********************MOVE ZCCY      ZCCY    3                       S01195
     C*********************MOVE ZOPT      ZOPT    1                       S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE/CLEAR WORKFIELDS.                       S01195
     C*********************MOVE '   '     ZHC                             S01195
     C*********************                                               S01195
     C*****RESET*INDICATOR.                                               S01195
     C*********************SETOF                     99                   S01195
     C*********************                                               S01195
     C*****CALCULATION*TO*DEFINE/SET OUTPUT FIELD.                        S01195
     C*********************Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C*********************                                               S01195
     C*****DETERMINE*IF*HOLIDAY                                           S01195
     C***********ZDHOL*****TAG                             ** ZDHOL TAG **S01195
     C*********************SETOF                     91                   S01195
     C*********************                                               S01195
     C*****SET*KEY*FOR*FIRST HOLIDAY RECORD.                              S01195
     C*********************MOVEL'22      'ZTABKY 12                       S01195
     C*********************MOVELZDYNBR    ZWRK6   6                       S01195
     C*********************MOVE '1'       ZWRK6                           S01195
     C*********************MOVE ZWRK6     ZTABKY                          S01195
     C*********************                                               S01195
     C*****CHAIN*FOR*HOLIDAY RECORD, RECORD 1 OR 2.                       S01195
     C***********ZDHCH5****TAG                             ** ZDHCH5 TAG *S01195
     C***********ZTABKY****CHAINTABDLI               90    ON NOT THERE   S01195
     C**N90******RECI******COMP 'D'                  9090  DELETED        S01195
     C*********************                                               S01195
     C*****STORE*CURRENCIES IF RECORD FOUND.                              S01195
     C**N90N91*************MOVEAHCCY      ZHC,1                           S01195
     C***91N90*************MOVEAHCCY      ZHC,26                          S01195
     C*********************                                               S01195
     C*****GET*SECOND*RECORD, IF NOT ALREADY DONE.                        S01195
     C*********************MOVE ZTABKY    ZWRK1N  10                      S01195
     C***********ZWRK1N****COMP 1                        91               S01195
     C*********************MOVE '2'       ZTABKY                          S01195
     C***91N90*************GOTO ZDHCH5                                    S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NO FIRST RECORD FOUND.                        S01195
     C***90*91*************GOTO ZDEND5                                    S01195
     C*********************                                               S01195
     C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
     C***********INEX******COMP 'E'                      92               S01195
     C***********INEX******COMP 'I'                      93               S01195
     C*********************                                               S01195
     C*****CHECK*IF*CURRENCY ON HOLIDAY.                                  S01195
     C***********ZCCY******LOKUPZHC                      94               S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NOT HOLIDAY FOR CURRENCY.                     S01195
     C***92*94*************                                               S01195
     C*OR*93N94************ GOTO ZDEND5                                   S01195
     C*********************                                               S01195
     C*****SET*INDICATOR FOR HOLIDAY FOR DAY NUMBER.                      S01195
     C*********************SETON                     99                   S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C*****CHECK*IF*NEXT*WORKING DAY REQUIRED.                            S01195
     C***********ZOPT******COMP 'Y'                      95               S01195
     C***95******ZDYNBR****ADD  1         ZDYNBR                          S01195
     C***95****************GOTO ZDHOL                                     S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C***********ZDEND5****ENDSR                           * ZDEND5 ENDSR*S01195
     C********************************************************************S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C*                                                                   S01195
      /EJECT
      *****************************************************************   S01194
      *********************                                           *   S01194
      ***DBERR  SR.****To*update LDA with database error information  *   S01194
      *****************&*exit program                                 *   S01194
      *********************                                           *   S01194
      *****************************************************************   S01194
      *********************                                               S01194
     C***********DBERR*****BEGSR                           ***  DBERR ****S01194
      *********************                                               S01194
     C************NAMVAR***DEFN           LDA                             S01194
     C*********************MOVE 'DL0401  'DBPGM                    S01157 S01194
     C*********************MOVEL'DL0401  'DBPGM                    S01157 S01194
     C*********************OUT  LDA                                       S01194
      *********************                                               S01194
     C*********************SETON                     U7U8LR               S01194
      *********************                                               S01194
     C*********************RETRN                                          S01194
      *********************                                               S01194
     C*********************ENDSR                                          S01194
      ********************************************************************S01194
0344 C********************************************************************S01194
      /EJECT
      *****************************************************************   S01194
      *                                                               *   S01194
      ****PSSR**SR.****To*update*LDA*with*database*error*informationS01194091548
      *****************&*exit*program*******************************S01194091548
      *  *PSSR  SR.    Abnormal termination processing                *   091548
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                               *   S01194
     C           *PSSR     BEGSR                                          S01194
      *                                                               *   S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C************         MOVEL'DL0401 ' DBPGM                    S01194 091548
      *                                                               *   S01194
     C************NAMVAR   DEFN           LDA   256                S01194 091548
     C************LOCK     IN   LDA                                S01194 091548
     C************         MOVELDBERR     LDA                      S01194 091548
     C************         OUT  LDA                                S01194 091548
      *                                                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP                                           091548
      *                                                                   S01194
     C/COPY WNCPYSRC,DL0401C052
     C                     RETRN                                          S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C********************************************************************S01194
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LCASS - Determine next cash flow schedule               *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LCASS    BEGSR                                          CIR001
     C                     Z-ADDZDAYNO    PRDT                            CIR001
      *                                                                                       191130
     C           DLNO      IFNE XDLNO                                                         191130
     C                     MOVE '1'       *IN30                                               191130
     C                     END                                                                191130
      *                                                                                       191130
     C           IRSCFL    CHAINDLCFSCD0             99                   CIR001
     C           *IN99     IFEQ '1'                                       CIR001
     C           DTPR      OREQ 'Y'                                       CIR001
     C                     Z-ADD0         CFLA                            CIR001
     C                     END                                            CIR001
      *                                                                   111790
      ** Save cash flow amount for the current processing date.           111790
      ** Also save the current deal number.                                                   191130
      *                                                                   111790
     C**********           Z-ADDCFLA      @CFLA  130                                   111790 191130
     C                     Z-ADDCFLA      XCFLA  130                                          191130
     C                     Z-ADDDLNO      XDLNO   60                                          191130
      *                                                                   111790
     C           IRSCFL    SETGTDLCFSCD0                                  CIR001
     C           IRSCFP    READEDLCFSCD0                 99               CIR001
     C           *IN99     IFEQ '0'                                       CIR001
     C                     Z-ADDPRDT      ZDAYNO                          CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADD0         CFLA                                                215434
     C                     Z-ADDMDAT      ZDAYNO                          CIR001
     C                     END                                            CIR001
      *                                                                   111790
      ***Restore*saved*cash*flow*amount.*******************************                111790 191130
      ** Restore saved cash flow amount only if event date in process                         191130
      ** is for the current interest period (i.e., it is the first                            191130
      ** interest period processing for the deal).                                            191130
      *                                                                                       191130
     C           *IN30     IFEQ '1'                                                           191130
      *                                                                                       191130
     C**********           Z-ADD@CFLA     CFLA                                         111790 191130
     C                     Z-ADDXCFLA     CFLA                                                191130
     C                     END                                                                191130
     C                     MOVE '0'       *IN30                                               191130
      *                                                                   111790
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LRATS - Determine next rate change/payment schedule     *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LRATS    BEGSR                                          CIR001
     C                     Z-ADDZDAYNO    PRDT                            CIR001
     C           IRSDTL    SETGTDLDTSCD0                                  CIR001
     C           IRSDTP    READEDLDTSCD0                 99               CIR001
     C           *IN99     IFEQ '0'                                       CIR001
     C                     Z-ADDPRDT      ZDAYNO                          CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDMDAT      ZDAYNO                          CIR001
     C                     END                                            CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LINDY - Calculate interest on discount/yield basis      *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LINDY    BEGSR                                          CIR001
      *                                                                   CIR001
      ** Interest = Principal ( 1 - 1 / ( 1 + Rate X Number of days/360)) CIR001
      **          = Principal ( 1 - 360 / ( 360 + Rate X Number of days)) CIR001
      *                                                                   CIR001
     C           ZICALC    IFEQ 2                                         CIR001
     C           ZICALC    OREQ 3                                         CIR001
     C           ZICALC    OREQ 5                                         CIR001
     C           ZICALC    OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C                     Z-ADD36000     ZIWRK3  50                      CIR001
     C                     ELSE                                           CIR001
     C           ZICALC    IFEQ 1                                         CIR001
     C           ZICALC    OREQ 4                                         CIR001
     C           ZICALC    OREQ 9                                         CIR013
     C           #29FEB    ANDEQ'N'                                       CIR013
     C                     Z-ADD36500     ZIWRK3                          CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADD36600     ZIWRK3                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           ZICALC    IFEQ 6                                         CIR013
     C           ZICALC    OREQ 9                                         CIR013
     C           #29FEB    ANDEQ'Y'                                       CIR013
     C           INT6DY    MULT ZIRATE    ZIWRK4 157                      CIR013
     C                     ELSE                                           CIR013
     C           ZZINDY    MULT ZIRATE    ZIWRK4 157                      CIR001
     C                     ENDIF                                          CIR013
     C                     ADD  ZIWRK3    ZIWRK4                          CIR001
      *                                                                   CIR001
     C           ZIWRK3    DIV  ZIWRK4    ZIWRK5 159H                     CIR001
     C           1         SUB  ZIWRK5    ZIWRK5                          CIR001
     C           ZIAMT     MULT ZIWRK5    ZINTR     H                     CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LEFIN - Update the effective interest rate              *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LEFIN    BEGSR                                          CIR001
      *                                                                   CIR001
     C           WSPIN     IFEQ *BLANK                                    CIR001
     C                     Z-ADDWBRTE     WEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           WSPIN     IFEQ 'A'                                       CIR001
     C           WBRTE     ADD  WRTSP     WEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           WSPIN     IFEQ 'S'                                       CIR001
     C           WBRTE     SUB  WRTSP     WEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           WSPIN     IFEQ 'P'                                       CIR001
     C           WRTSP     DIV  100       WK119                           CIR001
     C           WBRTE     MULT WK119     WEINR     H                     CIR001
     C                     ADD  WBRTE     WEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LUPFE - Create events for up-front fees                 *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LUPFE    BEGSR                                          CIR001
      *                                                                   CIR001
     C           UPVD      IFNE 0                                         CIR001
     C           UPVD      ANDGTECD                                       CIR001
      *                                                                   CIR001
     C                     SELEC                                          CIR001
     C           DTYP      WHEQ 'RS'                                      CIR001
     C                     MOVE '22FE'    ETYP                            CIR001
     C           DTYP      WHEQ 'RX'                                      CIR001
     C                     MOVE '23FE'    ETYP                            CIR001
     C           DTYP      WHEQ 'RP'                                      CIR001
     C           DTYP      OREQ 'RF'                                      CIR001
     C           DTYP      OREQ 'RR'                                      CIR001
     C                     MOVE '24FE'    ETYP                            CIR001
     C                     ENDSL                                          CIR001
      *                                                                   CIR001
     C                     Z-ADDUPVD      EDAT                            CIR001
      *                                                                   CIR001
     C           UPPR      IFEQ 'P'                                       CIR001
     C                     MOVE 'O'       IOIND                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'I'       IOIND                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     Z-ADDUPFE      EAMT                            CIR001
      *                                                                   CIR001
     C                     EXSR EVENT                                     CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  S/R #LBUYE - Create events for buy-outs                      *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LBUYE    BEGSR                                          CIR001
      *                                                                   CIR001
     C           BOVD      IFNE 0                                         CIR001
     C           BOVD      ANDGTECD                                       CIR001
      *                                                                   CIR001
     C                     SELEC                                          CIR001
     C           DTYP      WHEQ 'RS'                                      CIR001
     C                     MOVE '22BO'    ETYP                            CIR001
     C           DTYP      WHEQ 'RX'                                      CIR001
     C                     MOVE '23BO'    ETYP                            CIR001
     C           CIR006    WHEQ 'Y'                                       CIR006
     C           DTYP      IFEQ 'RP'                                      CIR006
     C           DTYP      OREQ 'RR'                                      CIR006
     C           DTYP      OREQ 'RF'                                      CIR006
     C                     MOVE '24BO'    ETYP                            CIR006
     C                     ENDIF                                          CIR006
     C                     ENDSL                                          CIR001
      *                                                                   CIR001
     C                     Z-ADDBOVD      EDAT                            CIR001
      *                                                                   CIR001
     C           BAPR      IFEQ 'P'                                       CIR001
     C                     MOVE 'O'       IOIND                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'I'       IOIND                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     Z-ADDBOAM      EAMT                            CIR001
      *                                                                   CIR001
     C                     EXSR EVENT                                     CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
 937 C*    SUBROUTINE TO WRITE 3 RECORDS TO EVNTXED FOR SETTLEMENT        CEU003
0938 C*    CURRENCY CONVERSION                                            CEU003
0939 C*                                                                   CEU003
0940 C           EVNTEU    BEGSR                           *** EVNTEU  ***CEU003
     C*                                                                   CEU003
     C*   CALLED FROM :- EVENT                                        *   CEU003
     C*   CALLS       :- EU0200                                           CEU003
     C*                                                                   CEU003
     C* EVNTEU Sub routine to ouptput 3 records for Settlement currency   CEU003
     C*  conversion                                                       CEU003
     C*                                                                   CEU003
     C* For events to correctly reflect when settlement is occurring in   CEU003
     C*  a currency, new 'cross currency' events will be generated in     CEU003
     C*  addition to the existing events (which are in transaction        CEU003
     C*  currency).  These events will appear like internal foreign       CEU003
     C*  exchange transactions.                                           CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN UCUCY     @SETCY                          CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN SETP      WSETP                           CEU003
     C           *LIKE     DEFN OSAC1     WOSAC1                          CEU003
     C           *LIKE     DEFN OSAC2     WOSAC2                          CEU003
     C           *LIKE     DEFN TSEN      WTSEN                           CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN ETYP      SVETYP                          CEU003
     C           *LIKE     DEFN INOI      SVINOI                          CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN EAMT      SVEAMT                          CEU003
     C           *LIKE     DEFN ECCY      SVECCY                          CEU003
     C           *LIKE     DEFN ECSS      SVECSS                          CEU003
     C           *LIKE     DEFN OTHA      SVOTHA                          CEU003
     C           *LIKE     DEFN OTHC      SVOTHC                          CEU003
     C*                                                                   CEU003
     C           *LIKE     DEFN EBRC      SVEBRC                          CEU003
     C*                                                                   CEU003
     C* Event types ending N1 and N2 are written with event currency      CEU003
     C*  set to settlement currency.  This is because they carry          CEU003
     C*  setlement instructions but are not settlement events.  They      CEU003
     C*  are simply used by the outstanding delivery instructions         CEU003
     C*  report.  The amounts on these events are all zeros.              CEU003
     C                     SELEC                                          CEU003
     C           ECOD      WHEQ 'N1'                                      CEU003
     C           ECOD      OREQ 'N2'                                      CEU003
     C                     MOVE ECCY      SVECCY                          CEU003
     C                     MOVE @SETCY    ECCY                            CEU003
     C*                                                                   152870
     C* Event Currency Sort Sequence is set to that of Settlement         152870
     C*  Currency.                                                        152870
     C*                                                                   152870
      ** Obtain CURRENCY details via ACCESS PROGRAM                       152870
     C                     CALL 'AOCURRR0'                                152870
     C                     PARM '*MSG   ' @RTCD   7                       152870
     C                     PARM '*KEY   ' @OPTN   7                       152870
     C                     PARM ECCY      @CCY    3                       152870
     C           SDCURR    PARM SDCURR    DSSDY                           152870
      *                                                                   152870
      ** If database error, return to calling program                     152870
     C           @RTCD     IFNE *BLANK                                    152870
     C           *LOCK     IN   LDA                                       152870
     C                     MOVEL'SDCURRPD'DBFILE           ************   152870
     C                     Z-ADD11        DBASE            * DBERR 11 *   152870
     C                     MOVELECCY      DBKEY            ************   152870
     C                     OUT  LDA                                       152870
     C                     MOVEL'401/11 -'ERROR                           152870
     C                     MOVE ECCY      ERROR                           152870
     C                     EXSR *PSSR                                     152870
     C                     END                                            152870
     C*                                                                   152870
     C                     Z-ADDA6SSNB    ECSS                            152870
     C*                                                                   CEU003
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  CEU003
     C/COPY WNCPYSRC,DL0401C066
     C*                                                                   CEU003
     C                     MOVE SVECCY    ECCY                            CEU003
     C* Event Currency Sort Sequence is set to that of Settlement         152870
     C*  Currency.                                                        152870
     C*                                                                   152870
      ** Obtain CURRENCY details via ACCESS PROGRAM                       152870
     C                     CALL 'AOCURRR0'                                152870
     C                     PARM '*MSG   ' @RTCD   7                       152870
     C                     PARM '*KEY   ' @OPTN   7                       152870
     C                     PARM ECCY      @CCY    3                       152870
     C           SDCURR    PARM SDCURR    DSSDY                           152870
      *                                                                   152870
      ** If database error, return to calling program                     152870
     C           @RTCD     IFNE *BLANK                                    152870
     C           *LOCK     IN   LDA                                       152870
     C                     MOVEL'SDCURRPD'DBFILE           ************   152870
     C                     Z-ADD11        DBASE            * DBERR 11 *   152870
     C                     MOVELECCY      DBKEY            ************   152870
     C                     OUT  LDA                                       152870
     C                     MOVEL'401/11 -'ERROR                           152870
     C                     MOVE ECCY      ERROR                           152870
     C                     EXSR *PSSR                                     152870
     C                     END                                            152870
     C*                                                                   152870
     C                     Z-ADDA6SSNB    ECSS                            152870
     C*                                                                   CEU003
     C                     OTHER                                          CEU003
     C*                                                                   CEU003
     C* Record 1 (existing event).  This will be same as what would       CEU003
     C*  have been written, except that the Settlement details will       CEU003
     C*  be blank.  'Settlement in another currency' flag is set to 'Y'   CEU003
     C                     MOVE 'Y'       SIAC    1                       CEU003
     C*                                                                   CEU003
     C*  Move blanks to Internal FX flag (IFXS)                           CEU003
     C                     MOVE *BLANK    IFXS                            CEU003
     C*                                                                   CEU003
     C* If Other currency OTHCCY is blank and Other amount is not zero,   CEU003
     C*  this is causing error in calling EU0200 routine.  Hence the      CEU003
     C*  Event currency is used for Other currency.                       CEU003
     C*                                                                   CEU003
     C           OTHA      IFNE *ZEROS                                    CEU003
     C           OTHC      ANDEQ*BLANKS                                   CEU003
     C                     MOVE ECCY      OTHC                            CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C*                                                                   CEU003
     C** Save and Blank out Settlement details                            CEU003
     C*                                                                   CEU003
     C                     MOVE SETP      WSETP                           CEU003
     C                     MOVE OSAC1     WOSAC1                          CEU003
     C                     MOVE OSAC2     WOSAC2                          CEU003
     C                     MOVE TSEN      WTSEN                           CEU003
     C*                                                                   CEU003
     C*                                                                   CEU003
     C                     MOVE *BLANKS   SETP                            CEU003
     C                     MOVE *BLANKS   TSEN                            CEU003
     C                     MOVE *BLANKS   WACNT            OSAC1/2        CEU003
     C*                                                                   CEU003
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  CEU003
     C/COPY WNCPYSRC,DL0401C067
     C*                                                                   CEU003
     C* For records 2 and 3 the following attributes are common.          CEU003
     C*                                                                   CEU003
     C* For both the new events set Internal FX indicator to 'Y' (IFXS)   CEU003
     C                     MOVE 'Y'       IFXS                            CEU003
     C*                                                                   CEU003
     C* For both the new events the last character of Event type (ETYP)   CEU003
     C*  is changed as follows.                                           CEU003
     C*                                                                   CEU003
     C* Save Event type for later process.                                CEU003
     C*                                                                   CEU003
     C                     MOVE ETYP      SVETYP                          CEU003
     C                     MOVE ETYP      WEVCD4  1                       CEU003
     C                     SELEC                                          CEU003
     C           WEVCD4    WHEQ '1'                                       CEU003
     C                     MOVE 'X'       ETYP                            CEU003
     C           WEVCD4    WHEQ '2'                                       CEU003
     C                     MOVE 'Y'       ETYP                            CEU003
     C                     ENDSL                                          CEU003
     C*                                                                   CEU003
     C* Set Event Branch (EBRC) to Settlement branch                      CEU003
     C                     MOVE EBRC      SVEBRC                          CEU003
     C*                                                                   CEU003
     C           INOI      IFEQ 'I'                                       CEU003
     C                     MOVE ROBR      EBRC                            CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C           INOI      IFEQ 'O'                                       CEU003
     C                     MOVE POBR      EBRC                            CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CEU003
     C* Record 2 (this is used to cancel the effect of the transaction    CEU003
     C*  currency event).                                                 CEU003
     C* This is same as that written in Record 1, except that the         CEU003
     C*  Incoming/Outgoing indicator (INOI)  is reversed.                 CEU003
     C*                                                                   CEU003
     C* Save Incoming/Outgoing indicator for later processing.            CEU003
     C*                                                                   CEU003
     C                     MOVE INOI      SVINOI                          CEU003
     C                     SELEC                                          CEU003
     C           SVINOI    WHEQ 'I'                                       CEU003
     C                     MOVE 'O'       INOI                            CEU003
     C           SVINOI    WHEQ 'O'                                       CEU003
     C                     MOVE 'I'       INOI                            CEU003
     C                     ENDSL                                          CEU003
     C*                                                                   134625
     C* Other Amount is set to the transaction event amount (EAMT)        134625
     C*  converted to settlement currency using pgm/EU0200.               134625
     C*                                                                   134625
     C                     Z-ADDEAMT      W#EAMT                          134625
     C                     Z-ADD0         WEAMT                           134625
     C*                                                                   134625
     C           W#EAMT    IFNE *ZEROS                                    134625
     C                     MOVE ECCY      W#TRCY           FROM Currency  134625
     C                     MOVE @SETCY    W#STCY           TO Currency    134625
     C*                                                                   134625
     C                     CALL 'EU0200'                                  134625
     C                     PARM *BLANKS   P@RTCD  7        Return Code    134625
     C                     PARM W#EAMT    P@FRAM 183       FROM Ccy Amount134625
     C                     PARM W#TRCY    P@FRCY  3        FROM Currency  134625
     C                     PARM W#STCY    P@TOCY  3        TO Currency    134625
     C           WEAMT     PARM           P@OUTA 150       Outright Amount134625
     C                     PARM           P@INTA 183       Interim Amount 134625
     C                     PARM           P@EXRT 159       Exchange Rate  134625
     C                     PARM           P@MDIN  1        Mult/Div Ind   134625
     C           P@RTCD    IFEQ '*ERROR*'                                 134625
     C           *LOCK     IN   LDA                                       134625
     C                     MOVEL'EU0200  'DBFILE           ************   134625
     C                     MOVE 12        DBASE            * DBERR 12 *   134625
     C                     MOVE *BLANKS   DBKEY            ************   134625
     C                     MOVE *BLANKS   W@OPTN  7                       134625
     C                     MOVELP@FRCY    W@OPTN                          134625
     C                     MOVE P@TOCY    W@OPTN                          134625
     C                     MOVELW@OPTN    DBKEY                           134625
     C                     OUT  LDA                                       134625
     C                     MOVEL'401/12 -'ERROR                           134625
     C                     MOVE W@OPTN    ERROR                           134625
     C                     EXSR *PSSR                                     134625
     C                     ENDIF                                          134625
     C*                                                                   134625
     C                     ENDIF                                          134625
     C*                                                                   134625
     C                     Z-ADDOTHA      SVOTHA                          134625
     C                     Z-ADDWEAMT     OTHA                            134625
     C*                                                                   134625
     C* Other currency is set to Settlement Currency (@SETCY).            134625
     C*                                                                   134625
     C                     MOVE OTHC      SVOTHC                          134625
     C                     MOVE @SETCY    OTHC                            134625
     C*                                                                   CEU003
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  CEU003
     C/COPY WNCPYSRC,DL0401C068
     C* Keep the count and hash totals for EVNTXED file                   CEU003
     C*                                                                   CEU003
     C           COUNTE    ADD  1         COUNTE                          CEU003
     C           EAMT      DIV  1000      ZZAMT                           CEU003
     C           ZZAMT     IFLT 0                                         CEU003
     C                     Z-SUBZZAMT     ZZAMT                           CEU003
     C                     END                                            CEU003
     C                     Z-ADDHASHEW    ZZTOTI                          CEU003
     C                     Z-ADDHASHED    ZZTOTD                          CEU003
     C                     EXSR GLZADD                                    CEU003
     C                     Z-ADDZZTOTI    HASHEW                          CEU003
     C                     Z-ADDZZTOTD    HASHED                          CEU003
      *                                                                   CEU003
     C*                                                                   CEU003
     C* Record 3 (this will provide a cash flow in the settlement         CEU003
     C*  currency).                                                       CEU003
     C*                                                                   CEU003
     C* Restore the Incoming/Outgoing indicator to INOI  field            CEU003
     C*                                                                   CEU003
     C                     MOVE SVINOI    INOI                            CEU003
     C*                                                                   CEU003
     C* Event amount is set to the transaction event amount (EAMT)        CEU003
     C*  converted to settlement currency using pgm/EU0200.               CEU003
     C*                                                                   CEU003
     C* Save Event amount, Event currency, Event currency Sort Sequence,  CEU003
     C***Other*amount*and*Other*currency*for*later*processing.     CEU003 134625
     C*                                                                   CEU003
     C                     Z-ADDEAMT      SVEAMT                          CEU003
     C                     MOVE ECCY      SVECCY                          CEU003
     C                     Z-ADDECSS      SVECSS                          CEU003
     C***********          Z-ADDOTHA      SVOTHA                   CEU003 134625
     C***********          MOVE OTHC      SVOTHC                   CEU003 134625
     C***********                                                  CEU003 134625
     C***********          Z-ADDEAMT      W#EAMT           FROM Cc CEU003 134625
     C***********          MOVE ECCY      W#TRCY           FROM Cu CEU003 134625
     C***********          MOVE @SETCY    W#STCY           TO Curr CEU003 134625
     C           *LIKE     DEFN P@FRAM    W#EAMT                          CEU003
     C           *LIKE     DEFN P@FRCY    W#TRCY                          CEU003
     C           *LIKE     DEFN P@TOCY    W#STCY                          CEU003
     C           *LIKE     DEFN P@OUTA    WEAMT                           CEU003
     C***********          CALL 'EU0200'                           CEU003 134625
     C***********          PARM *BLANKS   P@RTCD  7        Return  CEU003 134625
     C***********          PARM W#EAMT    P@FRAM 183       FROM Cc CEU003 134625
     C***********          PARM W#TRCY    P@FRCY  3        FROM Cu CEU003 134625
     C***********          PARM W#STCY    P@TOCY  3        TO Curr CEU003 134625
     C***********WEAMT     PARM           P@OUTA 150       Outrigh CEU003 134625
     C***********          PARM           P@INTA 183       Interim CEU003 134625
     C***********          PARM           P@EXRT 159       Exchang CEU003 134625
     C***********          PARM           P@MDIN  1        Mult/Di CEU003 134625
     C***********P@RTCD    IFEQ '*ERROR*'                          CEU003 134625
     C************LOCK     IN   LDA                                CEU003 134625
     C***********          MOVEL'EU0200  'DBFILE           ******* CEU003 134625
     C***********          MOVE 10        DBASE            * DBERR CEU003 134625
     C***********          MOVE *BLANKS   DBKEY            ******* CEU003 134625
     C***********          MOVE *BLANKS   W@OPTN  7                CEU003 134625
     C***********          MOVELP@FRCY    W@OPTN                   CEU003 134625
     C***********          MOVE P@TOCY    W@OPTN                   CEU003 134625
     C***********          MOVELW@OPTN    DBKEY                    CEU003 134625
     C***********          OUT  LDA                                CEU003 134625
     C***********          MOVEL'401/10 -'ERROR                    CEU003 134625
     C***********          MOVE W@OPTN    ERROR                    CEU003 134625
     C***********          EXSR *PSSR                              CEU003 134625
     C***********                                                  CEU003 134625
     C***********          ELSE                                    CEU003 134625
     C***********          Z-ADDWEAMT     EAMT                     CEU003 134625
     C***********          ENDIF                                   CEU003 134625
     C*                                                                   134625
     C                     Z-ADDWEAMT     EAMT                            134625
     C*                                                                   CEU003
     C* Event Currency is set to Settlement Currency (@SETCY)             CEU003
     C                     MOVE @SETCY    ECCY                            CEU003
     C*                                                                   CEU003
     C* Event Currency Sort Sequence is set to that of Settlement         CEU003
     C*  Currency.                                                        CEU003
     C*                                                                   CEU003
      ** Obtain CURRENCY details via ACCESS PROGRAM                       CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM '*MSG   ' @RTCD   7                       CEU003
     C                     PARM '*KEY   ' @OPTN   7                       CEU003
     C                     PARM ECCY      @CCY    3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
      ** If database error, return to calling program                     CEU003
     C           @RTCD     IFNE *BLANK                                    CEU003
     C           *LOCK     IN   LDA                                       CEU003
     C                     MOVEL'SDCURRPD'DBFILE           ************   CEU003
     C                     Z-ADD11        DBASE            * DBERR 11 *   CEU003
     C                     MOVELECCY      DBKEY            ************   CEU003
     C                     OUT  LDA                                       CEU003
     C                     MOVEL'401/11 -'ERROR                           CEU003
     C                     MOVE ECCY      ERROR                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     END                                            CEU003
     C*                                                                   CEU003
     C                     Z-ADDA6SSNB    ECSS                            CEU003
     C***********                                                  CEU003 134625
     C**Other*Amount*is*set*to*the*transaction*currency*other*amou CEU003 134625
     C***(OTHA)*converted*to*Settlement*currency*using*pgm/EU0200. CEU003 134625
     C***********                                                  CEU003 134625
     C***********          Z-ADDOTHA      W#EAMT           FROM Cc CEU003 134625
     C***********          Z-ADD0         WEAMT                    CEU003 134625
     C***********                                                  CEU003 134625
     C***********W#EAMT    IFNE *ZEROS                             CEU003 134625
     C***********          MOVE OTHC      W#TRCY           FROM Cu CEU003 134625
     C***********          MOVE @SETCY    W#STCY           TO Curr CEU003 134625
     C***********                                                  CEU003 134625
     C***********          CALL 'EU0200'                           CEU003 134625
     C***********          PARM *BLANKS   P@RTCD  7        Return  CEU003 134625
     C***********          PARM W#EAMT    P@FRAM 183       FROM Cc CEU003 134625
     C***********          PARM W#TRCY    P@FRCY  3        FROM Cu CEU003 134625
     C***********          PARM W#STCY    P@TOCY  3        TO Curr CEU003 134625
     C***********WEAMT     PARM           P@OUTA 150       Outrigh CEU003 134625
     C***********          PARM           P@INTA 183       Interim CEU003 134625
     C***********          PARM           P@EXRT 159       Exchang CEU003 134625
     C***********          PARM           P@MDIN  1        Mult/Di CEU003 134625
     C***********P@RTCD    IFEQ '*ERROR*'                          CEU003 134625
     C************LOCK     IN   LDA                                CEU003 134625
     C***********          MOVEL'EU0200  'DBFILE           ******* CEU003 134625
     C***********          MOVE 12        DBASE            * DBERR CEU003 134625
     C***********          MOVE *BLANKS   DBKEY            ******* CEU003 134625
     C***********          MOVE *BLANKS   W@OPTN                   CEU003 134625
     C***********          MOVELP@FRCY    W@OPTN                   CEU003 134625
     C***********          MOVE P@TOCY    W@OPTN                   CEU003 134625
     C***********          MOVELW@OPTN    DBKEY                    CEU003 134625
     C***********          OUT  LDA                                CEU003 134625
     C***********          MOVEL'401/12 -'ERROR                    CEU003 134625
     C***********          MOVE W@OPTN    ERROR                    CEU003 134625
     C***********          EXSR *PSSR                              CEU003 134625
     C***********                                                  CEU003 134625
     C***********          ELSE                                    CEU003 134625
     C***********          Z-ADDWEAMT     OTHA                     CEU003 134625
     C***********          ENDIF                                   CEU003 134625
     C***********                                                  CEU003 134625
     C**Other*currency*is*set*to*Settlement*Currency*(@SETCY).     CEU003 134625
     C***********          MOVE @SETCY    OTHC                     CEU003 134625
     C***********          ENDIF                                   CEU003 134625
     C*                                                                   134625
     C* Other Amount is set to the transaction currency event amount      134625
     C*                                                                   134625
     C                     Z-ADDSVEAMT    OTHA                            134625
     C*                                                                   134625
     C* Other currency is set to Event currency.                          134625
     C*                                                                   134625
     C                     MOVE SVECCY    OTHC                            134625
     C*                                                                   CEU003
     C* The Settlement details (SETP OSAC1 OSAC2 TSEN) are those that     CEU003
     C*  would have been written in the transaction currency event.       CEU003
     C*                                                                   CEU003
     C                     MOVE WSETP     SETP                            CEU003
     C                     MOVE WOSAC1    OSAC1                           CEU003
     C                     MOVE WOSAC2    OSAC2                           CEU003
     C                     MOVE WTSEN     TSEN                            CEU003
     C* 'Settlement In Another Currency' is set to blank.  This is the    CEU003
     C*   default value in the output.                                    CEU003
     C*                                                                   CEU003
     C                     MOVE *BLANK    SIAC                            CEU003
     C*                                                                   CEU003
     C                     EXSR SRNEG                                                       MD039107
     C                     WRITEEVNTXEDF                                  CEU003
     C/COPY WNCPYSRC,DL0401C069
     C*                                                                   CEU003
     C* Keep the count and hash totals for EVNTXED file                   CEU003
     C*                                                                   CEU003
     C           COUNTE    ADD  1         COUNTE                          CEU003
     C           EAMT      DIV  1000      ZZAMT                           CEU003
     C           ZZAMT     IFLT 0                                         CEU003
     C                     Z-SUBZZAMT     ZZAMT                           CEU003
     C                     END                                            CEU003
     C                     Z-ADDHASHEW    ZZTOTI                          CEU003
     C                     Z-ADDHASHED    ZZTOTD                          CEU003
     C                     EXSR GLZADD                                    CEU003
     C                     Z-ADDZZTOTI    HASHEW                          CEU003
     C                     Z-ADDZZTOTD    HASHED                          CEU003
      *                                                                   CEU003
     C*                                                                   CEU003
     C* Restore the event type to ETYP from the saved field               CEU003
     C                     MOVE SVETYP    ETYP                            CEU003
     C*                                                                   CEU003
     C* Restore Event Branch (EBRC)                                       CEU003
     C                     MOVE SVEBRC    EBRC                            CEU003
     C*                                                                   CEU003
     C* Restore Eventamount, Event currency, Event currency Sort Sequence,CEU003
     C*  Other amount and Other currency for later processing.            CEU003
     C*                                                                   CEU003
     C                     Z-ADDSVEAMT    EAMT                            CEU003
     C                     MOVE SVECCY    ECCY                            CEU003
     C                     Z-ADDSVECSS    ECSS                            CEU003
     C                     Z-ADDSVOTHA    OTHA                            CEU003
     C                     MOVE SVOTHC    OTHC                            CEU003
     C*                                                                   CEU003
     C                     MOVE *BLANK    IFXS                            CEU003
     C*                                                                   CEU003
     C* Obtain CURRENCY details via ACCESS PROGRAM for actual Event ccy   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM '*MSG   ' @RTCD   7                       CEU003
     C                     PARM '*KEY   ' @OPTN   7                       CEU003
     C                     PARM ECCY      @CCY    3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
      ** If database error, return to calling program                     CEU003
     C           @RTCD     IFNE *BLANK                                    CEU003
     C           *LOCK     IN   LDA                                       CEU003
     C                     MOVEL'SDCURRPD'DBFILE           ************   CEU003
     C                     Z-ADD13        DBASE            * DBERR 13 *   CEU003
     C                     MOVELECCY      DBKEY            ************   CEU003
     C                     OUT  LDA                                       CEU003
     C                     MOVEL'401/13 -'ERROR                           CEU003
     C                     MOVE ECCY      ERROR                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     END                                            CEU003
     C                     ENDSL                                          CEU003
     C*                                                                   CEU003
     C           ENDEVU    ENDSR                           ** ENDEVU TAG *CEU003
     C********************************************************************CEU003
      /EJECT                                                              066550
      *****************************************************************                       CIR007
      *                                                               *                       CIR007
      *  SRUOIS - 'Our' side processing for OIS.                      *                       CIR007
      *                                                               *                       CIR007
      *  Called by: IMPAY                                             *                       CIR007
      *                                                               *                       CIR007
      *  Calls:     DL1651, *PSSR, AOCURRR0, ZFWDT, EVENT             *                       CIR007
      *                                                               *                       CIR007
      *****************************************************************                       CIR007
     C           SRUOIS    BEGSR                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADD0         WRKTAX                                              CIR007
      *                                                                                       CIR007
      ** Find estimated amount of interest due at Next Interest                               CIR007
      ** Payment Date                                                                         CIR007
      *                                                                                       CIR007
      ** Add 1 to USLIP to give correct number of days.                                       CIR007
      *                                                                                       CIR007
     C           USLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
      ** If the deal has no interim interest payments, UNIPD will be                          CIR007
      ** zero. If this is the case, we project interest until MDAT.                           CIR007
     C           UNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      PTDAT                                               CIR007
     C                     ELSE                                                               CIR007
     C                     Z-ADDUNIPD     PTDAT                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO   60                                          CIR007
     C                     PARM 'O'       PSIDE   1                                           CIR007
     C                     PARM           PFDAT   50                                          CIR007
     C                     PARM           PTDAT   50                                          CIR007
     C                     PARM 0         PINTR  130                                          CIR007
     C                     PARM *BLANK    PRTCD1  1                                           CIR007
     C                     PARM 'Y'       PTOAC                                               204923
      *                                                                                       CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD20        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/20 -'ERROR                                               CIR007
     C                     MOVE '*CALL   'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
      ** To the Interest Amount, add Accrued Interest Adjusted Not                            CIR007
      ** Posted and Accrued Interest Adjusted And Posted                                      CIR007
     C                     ADD  UAIAN     PINTR                                               CIR007
     C                     ADD  UAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           TAXR      IFNE 0                                                             CIR007
     C           TAXI      ANDEQ'Y'                                                           CIR007
     C           TAXR      MULT PINTR     WRKTAX    H                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           PINTR     SUB  WRKTAX    EAMT                                                CIR007
      *                                                                                       CIR007
      ** Use PSCY instead if CEU003 is installed                                              CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           PSCY      ANDNE*BLANKS                                                       CIR007
     C                     MOVE PSCY      PCHR03                                              CIR007
     C                     ELSE                                                               CIR007
     C                     MOVE UCUCY     PCHR03                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'AOCURRR0'                                                    CIR007
     C                     PARM *BLANKS   PRTCD                                               CIR007
     C                     PARM '*KEY    'POPTN                                               CIR007
     C                     PARM           PCHR03  3                                           CIR007
     C           SDCURR    PARM SDCURR    DSSDY                                               CIR007
     C           PRTCD     IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD21        DBASE                                               CIR007
     C                     MOVEL'SDCURRPD'DBFILE                                              CIR007
     C                     MOVELPCHR03    DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/21 -'ERROR                                               CIR007
     C                     MOVE PCHR03    ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ***If*Settlement*Days*is*not*zero,*OIUVD*&*OITVD*must*be                         CIR007 204923
      ** If Settlement Days or Rate Fix Days Adjustment is not 0,                             204923
      ** increased by a number of working days in the Deal CCY                                CIR007
     C                     Z-ADDUNIPD     EDAT                                                CIR007
     C           A6SETD    IFNE 0                                                             CIR007
     C           A6FXDY    ORNE 0                                                             204923
     C                     MOVELEDAT      ZDAYNO                                              CIR007
     C                     MOVELA6CYCD    ZCCY                                                CIR007
     C           A6SETD    IFNE 0                                                             204923
     C                     Z-ADDA6SETD    ZNRDYS                                              CIR007
     C                     ELSE                                                               204923
     C                     Z-ADDA6FXDY    ZNRDYS                                              204923
     C                     ENDIF                                                              204923
     C                     EXSR ZFWDT                                                         CIR007
     C                     MOVELZDYNBR    EDAT                                                CIR007
     C                     Z-ADDEDAT      L4VDAT                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     MOVELUDSTI     WDSTI                                               CIR007
     C                     MOVEL'O'       IOIND                                               CIR007
     C                     MOVE 'I1'      ETYP                                                CIR007
      *                                                                                       CIR007
      ** If event amount is not zero,                                                         204923
      ** Write the event to the events file                                                   CIR007
     C           EAMT      IFNE 0                                                             204923
     C                     Z-ADDEDAT      EDATSV  50                                          CIR007
     C                     EXSR EVENT                                                         CIR007
     C                     Z-ADDEDATSV    EDAT                                                CIR007
      *                                                                                       CIR007
      ** Key list for DLOEVTL2                                                                CIR007
     C           KOEVT     KLIST                                                              CIR007
     C                     KFLD           DLNOA                                               CIR007
     C                     KFLD           L4VDAT                                              CIR007
      *                                                                                       CIR007
     C                     MOVE DLNO      DLNOA   6                                           CIR007
      *                                                                                       CIR007
      ** When the next interest payment date is equal to the next                             CIR007
      ** working day, then this is the very last COB in which this                            CIR007
      ** event record will be created.                                                        CIR007
      **                                                                                      CIR007
      ** If the event date was advanced (above) however, this event                           CIR007
      ** record will need to be saved (to PF/DLOEVTPD) so that it can                         CIR007
      ** be merged back into the main event file (PF/EVNTXED) on each                         CIR007
      ** succeeding day until the new event date is reached (DLC1656).                        CIR007
      **                                                                                      CIR007
      ** If a record is already found on LF/DLOEVTL2 it indicates that                        CIR007
      ** either DLC0607 00001 is being rerun, or DLC0607 00002 is                             CIR007
      ** running and the record was created by the preceeding DLC0607                         CIR007
      ** 00001.                                                                               CIR007
      **                                                                                      CIR007
      *                                                                                     MD062110
      ** Consider checking the next working day of next working day                         MD062110
      ** to determine projections falling on a non-working day.                             MD062110
      *                                                                                     MD062110
     C                     Z-ADDBJDNWD    ZDAYNO                                            MD062110
     C                     MOVELBJLCCY    ZCCY                                              MD062110
     C                     Z-ADD1         ZNRDYS                                            MD062110
     C                     EXSR ZFWDT                                                       MD062110
     C                     Z-ADDZDYNBR    WNXTWD  50                                        MD062110
      *                                                                                     MD062110
     C           A6SETD    IFNE 0                                                             CIR007
     C           UNIPD     ANDEQBJDNWD                                                        CIR007
     C           A6SETD    ORNE 0                                                           MD062110
     C           UNIPD     ANDGEBJDNWD                                                      MD062110
     C           UNIPD     ANDLTWNXTWD                                                      MD062110
     C           A6FXDY    ORNE 0                                                             204923
     C           UNIPD     ANDEQBJDNWD                                                        204923
     C           A6FXDY    ORNE 0                                                           MD062110
     C           UNIPD     ANDGEBJDNWD                                                      MD062110
     C           UNIPD     ANDLTWNXTWD                                                      MD062110
      *                                                                                       CIR007
     C           KOEVT     CHAINDLOEVTL2             74                                       CIR007
     C           *IN74     IFEQ '1'                                                           CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           @SETCY    ANDNE*BLANKS                                                       CIR007
     C                     EXSR SROEVT                                                        CIR007
     C                     ELSE                                                               CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELOSAC1     WQOSC1                                              CIR007
     C                     MOVELOSAC2     WQOSC2                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              204923
      *                                                                                       CIR007
      ** Create/Update record on OIS Settlement Rerun File                                    CIR007
     C           WODONE    IFEQ 'N'                                                           CIR007
     C           WTDONE    ANDEQ'N'                                                           CIR007
      *                                                                                       CIR007
     C           DLNO      CHAINDLOISRL0             72                                       CIR007
     C                     Z-ADDDLNO      L2DLNO                                              CIR007
     C                     Z-ADD0         L2TSET                                              CIR007
     C                     Z-ADDEAMT      L2OSET                                              CIR007
     C           *IN72     IFEQ '0'                                                           CIR007
     C                     UPDATDLOISRD0                                                      CIR007
     C                     ELSE                                                               CIR007
     C                     WRITEDLOISRD0                                                      CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Set Interest Amount due to zero                                                      CIR007
     C                     Z-ADD0         UINTD                                               CIR007
      *                                                                                       CIR007
      ** Event record created flag set on                                                     CIR007
     C                     MOVEL'Y'       WODONE                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADD0         EDAT                                                CIR007
      *                                                                                       CIR007
     C                     ENDSR                                                              CIR007
      *****************************************************************                       CIR007
      /EJECT                                                                                  CIR007
      *****************************************************************                       CIR007
      *                                                               *                       CIR007
      *  SRTOIS - 'Their' side processing for OIS.                    *                       CIR007
      *                                                               *                       CIR007
      *  Called by: IMPAY                                             *                       CIR007
      *                                                               *                       CIR007
      *  Calls:     DL1651, *PSSR, AOCURRR0, ZFWDT, EVENT             *                       CIR007
      *                                                               *                       CIR007
      *****************************************************************                       CIR007
     C           SRTOIS    BEGSR                                                              CIR007
      *                                                                                       CIR007
      ** Find estimated amount of interest due at Next Interest                               CIR007
      ** Payment Date                                                                         CIR007
      *                                                                                       CIR007
      ** Add 1 to TSLIP to give correct number of days.                                       CIR007
     C           TSLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
      ** If the deal has no interim interest payments, TNIPD will be                          CIR007
      ** zero. If this is the case, we project interest up to MDAT.                           CIR007
      *                                                                                       CIR007
     C           TNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      PTDAT                                               CIR007
     C                     ELSE                                                               CIR007
     C                     Z-ADDTNIPD     PTDAT                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO                                               CIR007
     C                     PARM 'T'       PSIDE                                               CIR007
     C                     PARM           PFDAT                                               CIR007
     C                     PARM           PTDAT                                               CIR007
     C                     PARM 0         PINTR                                               CIR007
     C                     PARM *BLANKS   PRTCD1                                              CIR007
     C                     PARM 'Y'       PTOAC                                               204923
      *                                                                                       CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD22        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/22 -'ERROR                                               CIR007
     C                     MOVE '*CALL   'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
      ** To the Interest Amount, add Accrued Interest Adjusted Not                            CIR007
      ** Posted and Accrued Interest Adjusted And Posted                                      CIR007
     C                     ADD  TAIAN     PINTR                                               CIR007
     C                     ADD  TAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDPINTR     EAMT                                                CIR007
      *                                                                                       CIR007
      ** Use RSCY instead if CEU003 is installed                                              CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           RSCY      ANDNE*BLANKS                                                       CIR007
     C                     MOVE RSCY      PCHR03                                              CIR007
     C                     ELSE                                                               CIR007
     C                     MOVE TCUCY     PCHR03                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'AOCURRR0'                                                    CIR007
     C                     PARM *BLANKS   PRTCD                                               CIR007
     C                     PARM '*KEY    'POPTN                                               CIR007
     C                     PARM           PCHR03                                              CIR007
     C           SDCURR    PARM SDCURR    DSSDY                                               CIR007
     C           PRTCD     IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD23        DBASE                                               CIR007
     C                     MOVEL'SDCURRPD'DBFILE                                              CIR007
     C                     MOVELPCHR03    DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/23 -'ERROR                                               CIR007
     C                     MOVE PCHR03    ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If Settlement Days is not zero, OIUVD & OITVD must be                                CIR007
      ** increased by a number of working days in the Deal CCY                                CIR007
     C                     Z-ADDTNIPD     EDAT                                                CIR007
     C           A6SETD    IFNE 0                                                             CIR007
     C           A6FXDY    ORNE 0                                                             204923
     C                     MOVELEDAT      ZDAYNO                                              CIR007
     C                     MOVELA6CYCD    ZCCY                                                CIR007
     C           A6SETD    IFNE 0                                                             204923
     C                     Z-ADDA6SETD    ZNRDYS                                              CIR007
     C                     ELSE                                                               204923
     C                     Z-ADDA6FXDY    ZNRDYS                                              204923
     C                     ENDIF                                                              204923
     C                     EXSR ZFWDT                                                         CIR007
     C                     MOVELZDYNBR    EDAT                                                CIR007
     C                     Z-ADDEDAT      L4VDAT                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     MOVELTDSTI     WDSTI                                               CIR007
     C                     MOVEL'I'       IOIND                                               CIR007
     C                     MOVE 'I1'      ETYP                                                CIR007
      *                                                                                       CIR007
      ** Write the event to the events file                                                   CIR007
     C                     Z-ADDEDAT      EDATSV                                              CIR007
     C                     EXSR EVENT                                                         CIR007
     C                     Z-ADDEDATSV    EDAT                                                CIR007
     C                     MOVE DLNO      DLNOA   6                                           CIR007
      *                                                                                       CIR007
      ** When the next interest payment date is equal to the next                             CIR007
      ** working day, then this is the very last COB in which this                            CIR007
      ** event record will be created.                                                        CIR007
      **                                                                                      CIR007
      ** If the event date was advanced (above) however, this event                           CIR007
      ** record will need to be saved (to PF/DLOEVTPD) so that it can                         CIR007
      ** be merged back into the main event file (PF/EVNTXED) on each                         CIR007
      ** succeeding day until the new event date is reached (DLC1656).                        CIR007
      **                                                                                      CIR007
      ** If a record is already found on LF/DLOEVTL2 it indicates that                        CIR007
      ** either DLC0607 00001 is being rerun, or DLC0607 00002 is                             CIR007
      ** running and the record was created by the preceeding DLC0607                         CIR007
      ** 00001.                                                                               CIR007
      *                                                                                       CIR007
      ** Consider checking the next working day of next working day                         MD062110
      ** to determine projections falling on a non-working day.                             MD062110
      *                                                                                     MD062110
     C                     Z-ADDBJDNWD    ZDAYNO                                            MD062110
     C                     MOVELBJLCCY    ZCCY                                              MD062110
     C                     Z-ADD1         ZNRDYS                                            MD062110
     C                     EXSR ZFWDT                                                       MD062110
     C                     Z-ADDZDYNBR    WNXTWD                                            MD062110
      *                                                                                     MD062110
     C           A6SETD    IFNE 0                                                             CIR007
     C           TNIPD     ANDEQBJDNWD                                                        CIR007
     C           A6SETD    ORNE 0                                                           MD062110
     C           TNIPD     ANDGEBJDNWD                                                      MD062110
     C           TNIPD     ANDLTWNXTWD                                                      MD062110
     C           A6FXDY    ORNE 0                                                             204923
     C           TNIPD     ANDEQBJDNWD                                                        204923
     C           A6FXDY    ORNE 0                                                           MD062110
     C           TNIPD     ANDGEBJDNWD                                                      MD062110
     C           TNIPD     ANDLTWNXTWD                                                      MD062110
      *                                                                                       CIR007
     C           KOEVT     CHAINDLOEVTL2             74                                       CIR007
     C           *IN74     IFEQ '1'                                                           CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           @SETCY    ANDNE*BLANKS                                                       CIR007
     C                     EXSR SROEVT                                                        CIR007
     C                     ELSE                                                               CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELOSAC1     WQOSC1                                              CIR007
     C                     MOVELOSAC2     WQOSC2                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Create/Update record on OIS Settlement Rerun File                                    CIR007
     C           WODONE    IFEQ 'N'                                                           CIR007
     C           WTDONE    ANDEQ'N'                                                           CIR007
      *                                                                                       CIR007
     C           DLNO      CHAINDLOISRL0             72                                       CIR007
     C                     Z-ADDDLNO      L2DLNO                                              CIR007
     C                     Z-ADD0         L2OSET                                              CIR007
     C                     Z-ADDEAMT      L2TSET                                              CIR007
     C           *IN72     IFEQ '0'                                                           CIR007
     C                     UPDATDLOISRD0                                                      CIR007
     C                     ELSE                                                               CIR007
     C                     WRITEDLOISRD0                                                      CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Set Interest Amount due to zero                                                      CIR007
     C                     Z-ADD0         TINTD                                               CIR007
      *                                                                                       CIR007
      ** Event record created flag set on                                                     CIR007
     C                     MOVEL'Y'       WTDONE                                              CIR007
     C                     Z-ADD0         EDAT                                                CIR007
      *                                                                                       CIR007
     C                     ENDSR                                                              CIR007
      *****************************************************************                       CIR007
      /EJECT                                                                                  CIR007
      *****************************************************************                       CIR007
      *                                                               *                       CIR007
      *  SRNOIS - Net OIS processing                                  *                       CIR007
      *                                                               *                       CIR007
      *  Called by: RSSETT, IMPAY                                     *                       CIR007
      *                                                               *                       CIR007
      *  Calls:     DL1651, *PSSR, AOCURRR0, ZFWDT, EVENT             *                       CIR007
      *                                                               *                       CIR007
      *****************************************************************                       CIR007
     C           SRNOIS    BEGSR                                                              CIR007
      *                                                                                       CIR007
      ** 'Our Side' of the deal is an OIS                                                     CIR007
      *                                                                                       CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
      *                                                                                       CIR007
      ** Find estimated amount of interest due at Next Interest                               CIR007
      ** Payment Date                                                                         CIR007
     C           USLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
     C* If the deal has no interim interest payments, UNIPD will be                           CIR007
     C* zero. If this is the case, we project interest until MDAT.                            CIR007
     C           UNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      PTDAT                                               CIR007
     C                     ELSE                                                               CIR007
     C                     Z-ADDUNIPD     PTDAT                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO                                               CIR007
     C                     PARM 'O'       PSIDE                                               CIR007
     C                     PARM           PFDAT                                               CIR007
     C                     PARM           PTDAT                                               CIR007
     C                     PARM 0         PINTR                                               CIR007
     C                     PARM *BLANKS   PRTCD1                                              CIR007
     C                     PARM 'Y'       PTOAC                                               204923
      *                                                                                       CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD24        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/24 -'ERROR                                               CIR007
     C                     MOVE '*CALL   'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
      ** To the Interest Amount, add Accrued Interest Adjusted Not                            CIR007
      ** Posted and Accrued Interest Adjusted And Posted                                      CIR007
     C                     ADD  UAIAN     PINTR                                               CIR007
     C                     ADD  UAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADD0         WRKTAX                                              CIR007
     C           TAXR      IFNE 0                                                             CIR007
     C           TAXI      ANDEQ'Y'                                                           CIR007
     C           TAXR      MULT PINTR     WRKTAX    H                                         CIR007
     C                     ENDIF                                                              CIR007
     C           PINTR     SUB  WRKTAX    UINTD                                               CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** 'Their Side' of the deal is an OIS                                                   CIR007
      *                                                                                       CIR007
     C           TICFR     IFEQ 'O'                                                           CIR007
      *                                                                                       CIR007
      ** Find estimated amount of interest due at Next Interest                               CIR007
      ** Payment Date                                                                         CIR007
     C           TSLIP     ADD  1         PFDAT                                               CIR007
      *                                                                                       CIR007
      ** If the deal has no interim interest payments, TNIPD will be                          CIR007
      ** zero. If this is the case, we project interest up to MDAT.                           CIR007
     C           TNIPD     IFEQ *ZERO                                                         CIR007
     C                     Z-ADDMDAT      PTDAT                                               CIR007
     C                     ELSE                                                               CIR007
     C                     Z-ADDTNIPD     PTDAT                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'DL1651'                                                      CIR007
     C                     PARM DLNO      PDLNO                                               CIR007
     C                     PARM 'T'       PSIDE                                               CIR007
     C                     PARM           PFDAT                                               CIR007
     C                     PARM           PTDAT                                               CIR007
     C                     PARM 0         PINTR                                               CIR007
     C                     PARM *BLANKS   PRTCD1                                              CIR007
     C                     PARM 'Y'       PTOAC                                               204923
      *                                                                                       CIR007
     C           PRTCD1    IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD25        DBASE                                               CIR007
     C                     MOVEL'DL1651  'DBFILE                                              CIR007
     C                     MOVEL'*CALL   'DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/25 -'ERROR                                               CIR007
     C                     MOVE '*CALL   'ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ELSE                                                               CIR007
      ** To the Interest Amount, add Accrued Interest Adjusted Not                            CIR007
      ** Posted and Accrued Interest Adjusted And Posted                                      CIR007
     C                     ADD  TAIAN     PINTR                                               CIR007
     C                     ADD  TAIAP     PINTR                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDPINTR     TINTD                                               CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** 'Our' Interest Due > 'Their' Interest Due                                            CIR007
      *                                                                                       CIR007
     C           UINTD     IFGT TINTD                                                         CIR007
      *                                                                                       CIR007
     C           UINTD     SUB  TINTD     EAMT                                                CIR007
     C                     MOVE 'O'       IOIND                                               CIR007
     C                     MOVELUDSTI     WDSTI                                               CIR007
      *                                                                                       CIR007
      ** 'Their' Interest Due => 'Our' Interest Due                                           CIR007
     C                     ELSE                                                               CIR007
     C           TINTD     SUB  UINTD     EAMT                                                CIR007
     C                     MOVE 'I'       IOIND                                               CIR007
     C                     MOVELTDSTI     WDSTI                                               CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Use PSCY instead if CEU003 is installed                                              CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           PSCY      ANDNE*BLANKS                                                       CIR007
     C                     MOVE PSCY      PCHR03                                              CIR007
     C                     ELSE                                                               CIR007
     C                     MOVE UCUCY     PCHR03                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     CALL 'AOCURRR0'                                                    CIR007
     C                     PARM *BLANKS   PRTCD                                               CIR007
     C                     PARM '*KEY    'POPTN                                               CIR007
     C                     PARM           PCHR03                                              CIR007
     C           SDCURR    PARM SDCURR    DSSDY                                               CIR007
     C           PRTCD     IFNE *BLANKS                                                       CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     Z-ADD26        DBASE                                               CIR007
     C                     MOVEL'SDCURRPD'DBFILE                                              CIR007
     C                     MOVELPCHR03    DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/26 -'ERROR                                               CIR007
     C                     MOVE PCHR03    ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ***If*Settlement*Days*is*not*zero,*OIUVD*&*OITVD*must*be                         CIR007 204923
      ** If Settlement Days or Rate Fix Days Adjustment is not 0,                             204923
      ** increased by a number of working days in the Deal CCY                                CIR007
     C                     Z-ADDUNIPD     EDAT                                                CIR007
     C           A6SETD    IFNE 0                                                             CIR007
     C           A6FXDY    ORNE 0                                                             204923
     C                     MOVELEDAT      ZDAYNO                                              CIR007
     C                     MOVELA6CYCD    ZCCY                                                CIR007
     C           A6SETD    IFNE 0                                                             204923
     C                     Z-ADDA6SETD    ZNRDYS                                              CIR007
     C                     ELSE                                                               204923
     C                     Z-ADDA6FXDY    ZNRDYS                                              204923
     C                     ENDIF                                                              204923
     C                     EXSR ZFWDT                                                         CIR007
     C                     MOVELZDYNBR    EDAT                                                CIR007
     C                     Z-ADDEDAT      L4VDAT                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** If Non-zero Event Amount                                                             CIR007
      ** Write the event to the events file                                                   CIR007
      *                                                                                       CIR007
     C           EAMT      IFNE 0                                                             CIR007
      *                                                                                       CIR007
     C                     MOVE 'I1'      ETYP                                                CIR007
     C                     Z-ADDEDAT      EDATSV                                              CIR007
     C                     EXSR EVENT                                                         CIR007
     C                     Z-ADDEDATSV    EDAT                                                CIR007
     C                     MOVE DLNO      DLNOA   6                                           CIR007
      *                                                                                       CIR007
      ** When the next interest payment date is equal to the next                             CIR007
      ** working day, then this is the very last COB in which this                            CIR007
      ** event record will be created.                                                        CIR007
      **                                                                                      CIR007
      ** If the event date was advanced (above) however, this event                           CIR007
      ** record will need to be saved (to PF/DLOEVTPD) so that it can                         CIR007
      ** be merged back into the main event file (PF/EVNTXED) on each                         CIR007
      ** succeeding day until the new event date is reached (DLC1656).                        CIR007
      **                                                                                      CIR007
      ** If a record is already found on LF/DLOEVTL2 it indicates that                        CIR007
      ** either DLC0607 00001 is being rerun, or DLC0607 00002 is                             CIR007
      ** running and the record was created by the preceeding DLC0607                         CIR007
      ** 00001.                                                                               CIR007
      *                                                                                       CIR007
      ** Consider checking the next working day of next working day                         MD062110
      ** to determine projections falling on a non-working day.                             MD062110
      *                                                                                     MD062110
     C                     Z-ADDBJDNWD    ZDAYNO                                            MD062110
     C                     MOVELBJLCCY    ZCCY                                              MD062110
     C                     Z-ADD1         ZNRDYS                                            MD062110
     C                     EXSR ZFWDT                                                       MD062110
     C                     Z-ADDZDYNBR    WNXTWD                                            MD062110
      *                                                                                     MD062110
     C           A6SETD    IFNE 0                                                             CIR007
     C           UNIPD     ANDEQBJDNWD                                                        CIR007
     C           A6SETD    ORNE 0                                                           MD062110
     C           UNIPD     ANDGEBJDNWD                                                      MD062110
     C           UNIPD     ANDLTWNXTWD                                                      MD062110
     C           A6FXDY    ORNE 0                                                             204923
     C           UNIPD     ANDEQBJDNWD                                                        204923
     C           A6FXDY    ORNE 0                                                           MD062110
     C           UNIPD     ANDGEBJDNWD                                                      MD062110
     C           UNIPD     ANDLTWNXTWD                                                      MD062110
     C           KOEVT     CHAINDLOEVTL2             74                                       CIR007
     C           *IN74     IFEQ '1'                                                           CIR007
     C           CEU003    IFEQ 'Y'                                                           CIR007
     C           @SETCY    ANDNE*BLANKS                                                       CIR007
     C                     EXSR SROEVT                                                        CIR007
     C                     ELSE                                                               CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELOSAC1     WQOSC1                                              CIR007
     C                     MOVELOSAC2     WQOSC2                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Create/Update record on OIS Settlement Rerun File                                    CIR007
      ** Provided no interim interest records have previously been                            CIR007
      ** created.                                                                             CIR007
      *                                                                                       CIR007
     C           EAMT      IFEQ 0                                                             CIR007
     C                     Z-ADD0         UINTD                                               CIR007
     C                     Z-ADD0         TINTD                                               CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           WODONE    IFEQ 'N'                                                           CIR007
     C           WTDONE    ANDEQ'N'                                                           CIR007
     C           DLNO      CHAINDLOISRL0             72                                       CIR007
     C                     Z-ADDDLNO      L2DLNO                                              CIR007
     C                     Z-ADDUINTD     L2OSET                                              CIR007
     C                     Z-ADDTINTD     L2TSET                                              CIR007
     C           *IN72     IFEQ '0'                                                           CIR007
     C                     UPDATDLOISRD0                                                      CIR007
     C                     ELSE                                                               CIR007
     C                     WRITEDLOISRD0                                                      CIR007
     C                     ENDIF                                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Set Interest Amounts due to zero                                                     CIR007
      *                                                                                       CIR007
     C                     Z-ADD0         UINTD                                               CIR007
     C                     Z-ADD0         TINTD                                               CIR007
      *                                                                                       CIR007
      ** Event record created flag set on for 'Our Side'                                      CIR007
      *                                                                                       CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
     C                     MOVEL'Y'       WODONE                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Event record created flag set on for 'Their Side'                                    CIR007
      *                                                                                       CIR007
     C           TICFR     IFEQ 'O'                                                           CIR007
     C                     MOVEL'Y'       WTDONE                                              CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADD0         EAMT                                                CIR007
      *                                                                                       CIR007
     C                     ENDSR                                                              CIR007
      *****************************************************************                       CIR007
      /EJECT                                                                                  CIR007
      *****************************************************************                       CIR007
      *                                                               *                       CIR007
      * SROEVT - Creates records in DLOEVTPD for deals settling in    *                       CIR007
      *          another ccy                                          *                       CIR007
      *                                                               *                       CIR007
      *****************************************************************                       CIR007
     C           SROEVT    BEGSR                                                              CIR007
      *                                                                                       CIR007
      ** Record 1 (existing event).  This will be same as what would                          CIR007
      ** have been written, except that the Settlement details will                           CIR007
      ** be blank.  'Settlement in another currency' flag is set to 'Y'                       CIR007
     C                     MOVE 'Y'       SIAC                                                CIR007
      *                                                                                       CIR007
      ** Move blanks to Internal FX flag (IFXS)                                               CIR007
     C                     MOVE *BLANK    IFXS                                                CIR007
      *                                                                                       CIR007
      ** If Other currency OTHCCY is blank and Other amount is not zero,                      CIR007
      ** this is causing error in calling EU0200 routine.  Hence the                          CIR007
      ** Event currency is used for Other currency.                                           CIR007
      *                                                                                       CIR007
     C           OTHA      IFNE *ZEROS                                                        CIR007
     C           OTHC      ANDEQ*BLANKS                                                       CIR007
     C                     MOVE ECCY      OTHC                                                CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Save and Blank out Settlement details                                                CIR007
      *                                                                                       CIR007
     C                     MOVE SETP      WSETP                                               CIR007
     C                     MOVE OSAC1     WOSAC1                                              CIR007
     C                     MOVE OSAC2     WOSAC2                                              CIR007
     C                     MOVE TSEN      WTSEN                                               CIR007
      *                                                                                       CIR007
     C                     MOVE *BLANKS   SETP                                                CIR007
     C                     MOVE *BLANKS   TSEN                                                CIR007
     C                     MOVE *BLANKS   WQOSC1                                              CIR007
     C                     MOVE *BLANKS   WQOSC2                                              CIR007
     C                     MOVE *BLANKS   WACNT                                               CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
      *                                                                                       CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
      *                                                                                       CIR007
      ** For records 2 and 3 the following attributes are common.                             CIR007
      *                                                                                       CIR007
      ** For both the new events set Internal FX indicator to 'Y' (IFXS)                      CIR007
     C                     MOVE 'Y'       IFXS                                                CIR007
      *                                                                                       CIR007
      ** For both the new events the last character of Event type (ETYP)                      CIR007
      ** is changed as follows.                                                               CIR007
      *                                                                                       CIR007
      ** Save Event type for later process.                                                   CIR007
      *                                                                                       CIR007
     C                     MOVE ETYP      SVETYP                                              CIR007
     C                     MOVE ETYP      WEVCD4  1                                           CIR007
     C                     SELEC                                                              CIR007
     C           WEVCD4    WHEQ '1'                                                           CIR007
     C                     MOVE 'X'       ETYP                                                CIR007
     C           WEVCD4    WHEQ '2'                                                           CIR007
     C                     MOVE 'Y'       ETYP                                                CIR007
     C                     ENDSL                                                              CIR007
      *                                                                                       CIR007
      ** Set Event Branch (EBRC) to Settlement branch                                         CIR007
      *                                                                                       CIR007
     C                     MOVE EBRC      SVEBRC                                              CIR007
      *                                                                                       CIR007
     C           INOI      IFEQ 'I'                                                           CIR007
     C                     MOVE ROBR      EBRC                                                CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           INOI      IFEQ 'O'                                                           CIR007
     C                     MOVE POBR      EBRC                                                CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
      ** Record 2 (this is used to cancel the effect of the transaction                       CIR007
      ** currency event).                                                                     CIR007
      ** This is same as that written in Record 1, except that the                            CIR007
      ** Incoming/Outgoing indicator (INOI) is reversed.                                      CIR007
      *                                                                                       CIR007
      ** Save Incoming/Outgoing indicator for later processing.                               CIR007
      *                                                                                       CIR007
     C                     MOVE INOI      SVINOI                                              CIR007
     C                     SELEC                                                              CIR007
     C           SVINOI    WHEQ 'I'                                                           CIR007
     C                     MOVE 'O'       INOI                                                CIR007
     C           SVINOI    WHEQ 'O'                                                           CIR007
     C                     MOVE 'I'       INOI                                                CIR007
     C                     ENDSL                                                              CIR007
      *                                                                                       CIR007
      ** Other Amount is set to the transaction event amount (EAMT)                           CIR007
      ** converted to settlement currency using pgm/EU0200.                                   CIR007
      *                                                                                       CIR007
     C                     Z-ADDEAMT      W#EAMT                                              CIR007
     C                     Z-ADD0         WEAMT                                               CIR007
      *                                                                                       CIR007
     C           W#EAMT    IFNE *ZEROS                                                        CIR007
     C                     MOVE ECCY      W#TRCY           FROM Currency                      CIR007
     C                     MOVE @SETCY    W#STCY           TO Currency                        CIR007
      *                                                                                       CIR007
     C                     CALL 'EU0200'                                                      CIR007
     C                     PARM *BLANKS   P@RTCD  7        Return Code                        CIR007
     C                     PARM W#EAMT    P@FRAM 183       FROM Ccy Amount                    CIR007
     C                     PARM W#TRCY    P@FRCY  3        FROM Currency                      CIR007
     C                     PARM W#STCY    P@TOCY  3        TO Currency                        CIR007
     C           WEAMT     PARM           P@OUTA 150       Outright Amount                    CIR007
     C                     PARM           P@INTA 183       Interim Amount                     CIR007
     C                     PARM           P@EXRT 159       Exchange Rate                      CIR007
     C                     PARM           P@MDIN  1        Mult/Div Ind                       CIR007
      *                                                                                       CIR007
     C           P@RTCD    IFEQ '*ERROR*'                                                     CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     MOVEL'EU0200  'DBFILE           ************                       CIR007
     C                     MOVE 27        DBASE            * DBERR 27 *                       CIR007
     C                     MOVE *BLANKS   DBKEY            ************                       CIR007
     C                     MOVE *BLANKS   W@OPTN  7                                           CIR007
     C                     MOVELP@FRCY    W@OPTN                                              CIR007
     C                     MOVE P@TOCY    W@OPTN                                              CIR007
     C                     MOVELW@OPTN    DBKEY                                               CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/27 -'ERROR                                               CIR007
     C                     MOVE W@OPTN    ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDOTHA      SVOTHA                                              CIR007
     C                     Z-ADDWEAMT     OTHA                                                CIR007
      *                                                                                       CIR007
      ** Other currency is set to Settlement Currency (@SETCY).                               CIR007
      *                                                                                       CIR007
     C                     MOVE OTHC      SVOTHC                                              CIR007
     C                     MOVE @SETCY    OTHC                                                CIR007
     C                     MOVE *BLANKS   WQOSC1                                              CIR007
     C                     MOVE *BLANKS   WQOSC2                                              CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
      *                                                                                       CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
      *                                                                                       CIR007
      ** Record 3 (this will provide a cash flow in the settlement                            CIR007
      ** currency).                                                                           CIR007
      *                                                                                       CIR007
      ** Restore the Incoming/Outgoing indicator to INOI  field                               CIR007
      *                                                                                       CIR007
     C                     MOVE SVINOI    INOI                                                CIR007
      *                                                                                       CIR007
      ** Event amount is set to the transaction event amount (EAMT)                           CIR007
      ** converted to settlement currency using pgm/EU0200.                                   CIR007
      *                                                                                       CIR007
      ** Save Event amount, Event currency, Event currency Sort Sequence,                     CIR007
      *                                                                                       CIR007
     C                     Z-ADDEAMT      SVEAMT                                              CIR007
     C                     MOVE ECCY      SVECCY                                              CIR007
     C                     Z-ADDECSS      SVECSS                                              CIR007
     C                     Z-ADDWEAMT     EAMT                                                CIR007
      *                                                                                       CIR007
      ** Event Currency is set to Settlement Currency (@SETCY)                                CIR007
      *                                                                                       CIR007
     C                     MOVE @SETCY    ECCY                                                CIR007
      *                                                                                       CIR007
      ** Event Currency Sort Sequence is set to that of Settlement                            CIR007
      ** Currency.                                                                            CIR007
      *                                                                                       CIR007
      ** Obtain CURRENCY details via ACCESS PROGRAM                                           CIR007
     C                     CALL 'AOCURRR0'                                                    CIR007
     C                     PARM '*MSG   ' @RTCD   7                                           CIR007
     C                     PARM '*KEY   ' @OPTN   7                                           CIR007
     C                     PARM ECCY      @CCY    3                                           CIR007
     C           SDCURR    PARM SDCURR    DSSDY                                               CIR007
      *                                                                                       CIR007
      ** If database error, return to calling program                                         CIR007
     C           @RTCD     IFNE *BLANK                                                        CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     MOVEL'SDCURRPD'DBFILE           ************                       CIR007
     C                     Z-ADD28        DBASE            * DBERR 28 *                       CIR007
     C                     MOVELECCY      DBKEY            ************                       CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/28 -'ERROR                                               CIR007
     C                     MOVE ECCY      ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C                     Z-ADDA6SSNB    ECSS                                                CIR007
      *                                                                                       CIR007
      * Other Amount is set to the transaction currency event amount                          CIR007
      *                                                                                       CIR007
     C                     Z-ADDSVEAMT    OTHA                                                CIR007
      *                                                                                       CIR007
      * Other currency is set to Event currency.                                              CIR007
      *                                                                                       CIR007
     C                     MOVE SVECCY    OTHC                                                CIR007
      *                                                                                       CIR007
      ** The Settlement details (SETP OSAC1 OSAC2 TSEN) are those that                        CIR007
      ** would have been written in the transaction currency event.                           CIR007
      *                                                                                       CIR007
     C                     MOVE WSETP     SETP                                                CIR007
     C                     MOVE WOSAC1    OSAC1                                               CIR007
     C                     MOVE WOSAC2    OSAC2                                               CIR007
     C                     MOVE WOSAC1    WQOSC1                                              CIR007
     C                     MOVE WOSAC2    WQOSC2                                              CIR007
     C                     MOVE WTSEN     TSEN                                                CIR007
      ** 'Settlement In Another Currency' is set to blank.  This is the                       CIR007
      ** default value in the output.                                                         CIR007
      *                                                                                       CIR007
     C                     MOVE *BLANK    SIAC                                                CIR007
     C                     MOVELETYP      WQETYP                                              CIR007
     C                     MOVELULEVNT    L4EREC                                              CIR007
     C                     MOVE 'N'       L4MIND                                              CIR007
     C                     Z-ADDBJRDNB    L4CDAT                                              CIR007
      *                                                                                       CIR007
     C                     WRITEDLOEVTD0                                                      CIR007
      *                                                                                       CIR007
      ** Restore the event type to ETYP from the saved field                                  CIR007
     C                     MOVE SVETYP    ETYP                                                CIR007
      *                                                                                       CIR007
      ** Restore Event Branch (EBRC)                                                          CIR007
     C                     MOVE SVEBRC    EBRC                                                CIR007
      *                                                                                       CIR007
      ** Restore Eventamount, Event currency, Event currency Sort Sequence,                   CIR007
      ** Other amount and Other currency for later processing.                                CIR007
      *                                                                                       CIR007
     C                     Z-ADDSVEAMT    EAMT                                                CIR007
     C                     MOVE SVECCY    ECCY                                                CIR007
     C                     Z-ADDSVECSS    ECSS                                                CIR007
     C                     Z-ADDSVOTHA    OTHA                                                CIR007
     C                     MOVE SVOTHC    OTHC                                                CIR007
      *                                                                                       CIR007
     C                     MOVE *BLANK    IFXS                                                CIR007
      *                                                                                       CIR007
      ** Obtain CURRENCY details via ACCESS PROGRAM for actual Event ccy                      CIR007
     C                     CALL 'AOCURRR0'                                                    CIR007
     C                     PARM '*MSG   ' @RTCD   7                                           CIR007
     C                     PARM '*KEY   ' @OPTN   7                                           CIR007
     C                     PARM ECCY      @CCY    3                                           CIR007
     C           SDCURR    PARM SDCURR    DSSDY                                               CIR007
      *                                                                                       CIR007
      ** If database error, return to calling program                                         CIR007
     C           @RTCD     IFNE *BLANK                                                        CIR007
     C           *LOCK     IN   LDA                                                           CIR007
     C                     MOVEL'SDCURRPD'DBFILE           ************                       CIR007
     C                     Z-ADD29        DBASE            * DBERR 29 *                       CIR007
     C                     MOVELECCY      DBKEY            ************                       CIR007
     C                     OUT  LDA                                                           CIR007
     C                     MOVEL'401/29 -'ERROR                                               CIR007
     C                     MOVE ECCY      ERROR                                               CIR007
     C                     EXSR *PSSR                                                         CIR007
     C                     END                                                                CIR007
      *                                                                                       CIR007
     C                     ENDSR                                                              CIR007
      *****************************************************************                       CIR007
      /EJECT                                                                                AR743357
      *****************************************************************                     AR743357
      *                                                               *                     AR743357
      * PCCHG  - Computes for the interest of a interest period based *                     AR743357
      *          on DLPCSCPD.                                         *                     AR743357
      *                                                               *                     AR743357
      *****************************************************************                     AR743357
     C           PCCHG     BEGSR                                                            AR743357
      *                                                                                     AR743357
     C           *LIKE     DEFN ZINTR     ZINTX                                             AR743357
     C                     Z-ADDZIBEG     PRDT                                              AR743357
     C                     Z-ADDZIBEG     PREV                                              AR743357
     C                     MOVE *BLANKS   OTIN                                              AR743357
     C           DTYP      IFEQ 'RX'                                                        AR743357
     C                     MOVELOURTHR    OTIN                                              AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C           PCSKEY    SETLLDLPCSCD0                                                    AR743357
     C           PCLKEY    READEDLPCSCD0                 85                                 AR743357
      *                                                                                     AR743357
     C           *IN85     DOWEQ'0'                                                         AR743357
     C           PRDT      ANDLTWICED                                                       AR743357
      *                                                                                     AR743357
     C                     Z-ADDWPAMT     ZIAMT                                             AR743357
     C           CIR002    IFEQ 'Y'                                                         AR743357
     C           WINPM     OREQ 'A'                                                         AR743357
     C           CIR006    ANDEQ'Y'                                                         AR743357
     C           WINPM     OREQ 'I'                                                         AR743357
     C           CIR006    ANDEQ'Y'                                                         AR743357
     C           WINPM     OREQ 'L'                                                         AR743357
     C           CIR006    ANDEQ'Y'                                                         AR743357
     C                     ADD  WUSI      ZIAMT                                             AR743357
     C                     ADD  WUSA      ZIAMT                                             AR743357
     C                     ENDIF                                                            AR743357
      *                                                                                     AR743357
     C                     Z-ADDPREV      ZIBEG                                             AR743357
     C                     Z-ADDPRDT      ZIEND                                             AR743357
     C                     EXSR GLINTC                                                      AR743357
     C                     ADD  ZINTR     ZINTX                                             AR743357
      *                                                                                     AR743357
     C                     Z-ADDPAMT      WPAMT                                             AR743357
     C                     Z-ADDPRDT      PREV    50                                        AR743357
      *                                                                                     AR743357
     C           PCLKEY    READEDLPCSCD0                 85                                 AR743357
     C                     ENDDO                                                            AR743357
     C                     Z-ADDWPAMT     ZIAMT                                             AR743357
     C                     Z-ADDPREV      ZIBEG                                             AR743357
     C                     ENDSR                                                            AR743357
      *****************************************************************                     AR743357
      /EJECT                                                                                MD039107
      *****************************************************************                     MD039107
      *                                                               *                     MD039107
      *  SRNEG - Process negative amount                              *                     MD039107
      *                                                               *                     MD039107
      *****************************************************************                     MD039107
     C           SRNEG     BEGSR                                                            MD039107
      *                                                                                     MD039107
     C           EAMT      IFLT 0                                                           MD039107
     C                     Z-SUBEAMT      EAMT                                              MD039107
     C           INOI      IFEQ 'O'                                                         MD039107
     C                     MOVE 'I'       INOI                                              MD039107
     C                     ELSE                                                             MD039107
     C                     MOVE 'O'       INOI                                              MD039107
     C                     ENDIF                                                            MD039107
     C                     ENDIF                                                            MD039107
      *                                                                                     MD039107
     C                     ENDSR                                                            MD039107
      *****************************************************************                     MD039107
      *
     C/COPY WNCPYSRC,DL0401C055
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,GLINTCZ1                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZFRQB3                                                 CIR005
     C/EJECT                                                              CIR005
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0401CCP1                                           S01408
     C*                                                                   S01408
     C/EJECT                                                              CIR013
     C/COPY ZSRSRC,ZFEB29                                                 CIR013
**  CPY@
(c) Finastra International Limited 2001
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
