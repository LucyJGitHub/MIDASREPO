     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Forward revaluation')                         *
      *****************************************************************
      *                                                               *
      *  Midas - Dealing Module                                       *
      *                                                               *
      *  DL0411 - Forward Revaluation                                 *
      *                                                               *
      *  Function:  This program generates the forward revaluation    *
      *    (COB)    postings which are totalled per branch/profit     *
      *             centre.                                           *
      *                                                               *
      *  Called By: DLC0608 - Forward Revaluation                     *
      *                                                               *
      *  Note:      Developers/Fixers - This program runs instead     *
      *             of DL0410 when Profit Centre Accounting is        *
      *             switched on.  Any changes made to this program    *
      *             should be duplicated in DL0410.                   *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 230217             Date 17Mar22               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 AR635480           Date 17Oct19               *
      *                 MD049609           Date 21Feb18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD036289A          Date 11May16               *
      *                 MD036289           Date 11May16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 AR720506           Date 19Aug14               *
      *                 258435             Date 20Jan09               *
      *                 AR813358           Date 18Dec12               *
      *                 CSW212             Date 03May12               *
      *                 262151             Date 27Oct09               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG13768           Date 23Apr07               *
      *                 244711             Date 15Jan07               *
      *                 243976             Date 28Nov06               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12463           Date 08Nov06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG9453            Date 30Nov05               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 BUG5336R *REOPEN   Date 17Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CAS008             Date 16Jun04               *
      *                 227580             Date 28Jun04               *
      *                 227579             Date 14Jun04               *
      *                 225831             Date 19Mar04               *
      *                 225302             Date 27Feb04               *
      *                 225189             Date 18Feb04               *
      *                 BUG5336            Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA110             Date 05Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 220201             Date 31Jul03               *
      *                 220200             Date 31Jul03               *
      *                 220199             Date 31Jul03               *
      *                 219337             Date 26Jun03               *
      *                 219336             Date 26Jun03               *
      *                 219334             Date 26Jun03               *
      *                 219333             Date 26Jun03               *
      *                 CAS005             Date 16Dec02               *
      *                 CGL020             Date 12Dec02               *
      *                 213046             Date 15Nov02               *
      *                 217120             Date 21Apr03               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 199516             Date 14Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS001             Date 23Nov01               *
      *                 138010             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 05Dec00               *
      *                 140797             Date 03May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 188977             Date 19Jan01               *
      *                 187356             Date 08Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179925             Date 17MAY00               *
      *                 170442             Date 28Mar00               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 155225             Date 22Apr99               *
      *                 CSD005             Date 01Mar99               *
      *                 136239             DATE 10MAY99               *
      *                 CTI002             Date 23Sep98               *
      *                 145193             Date 16OCT98               *
      *                 CEU011             Date 11Mar98               *
      *                 S01408             Date 01Dec97               *
      *                 124860 (PCA030)    Date 01Dec97               *
      *                 CAC002 *CREATE     Date 15SEP96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  Note:      Developers/Fixers - This program runs instead     *
      *             of DL0410 when Profit Centre Accounting is        *
      *             switched on.  Any changes made to this program    *
      *             should be duplicated in DL0410.                   *
      *                                                               *
      *  230217 - Remove reversal processing by IAS.                  *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  AR635480 - Failed Component DLC0608 due to CPF5004 in        *
      *             DL0411P2                                          *
      *           - Applied fix for MD-54234                          *
      *  MD049609 - Adjustment of forward day and rate array          *
      *             (entries per table)                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD036289A - UseForwardRateReval is not checked correctly.    *
      *              Remove also unnecessary codes in setting up      *
      *              rates and dates.                                 *
      *            - Applied for MD038095.                            *
      *  MD036289 - Forward rate is wrong. Rate interpolation should  *
      *             be done for dates in between.                     *
      *           - Applied for MD038095.                             *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  AR720506 - Allow user to choose if Forward Rates or Spot     *
      *             rate will be used in Forward Revaluation.         *
      *             Introduced new system value UseForwardRateReval   *
      *             so that core processing will not be affected.     *
      *             (Child: AR720507)                                 *
      *  258435 - Allow user to define parameter for calculation of   *
      *           forward days. Use new system value ForwardDays,     *
      *           whose permitted values are as follows:              *
      *           WR = Working Days from Run Date                     *
      *           WS = Working Days from Spot Date                    *
      *           CR = Calendar Days from Run Date                    *
      *           CS = Calandar Days from Spot Date                   *
      *           Apply fix 255972.                                   *
      *  AR813358 - Data mapping error on member EODPOPD, fix is to   *
      *             apply part of fix 249489 to correctly initialise  *
      *             TRAT and other numeric fields. Also apply CGL120  *
      *             for ORAMT NITMS CHGA fields. (Child: AR813359)    *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  262151 - Incorrect forward revaluation rate calculated.      *
      *           Align Days array and Rate arrays. Applied fix       *
      *           241940.                                             *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  BUG13768 - External field name entry is longer than six(6)   *
      *             characters                                        *
      *  244711 - Pass FSPRLA to WKPRLA when ECCY is equal to BJCYCD  *
      *  243976 - Applied fix 237364.                                 *
      *  237364 - Use system currency for postings. Also apply        *
      *           BUG7256 from DL0410                                 *
      *  BUG12463 - Validate profit center code only if its they are  *
      *             non-blanks.                                       *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG9453- Print RX principal amounts only if both CIR003 and  *
      *           CAS008 are ON.                                      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  BUG5336R - Rename work fields to indicate current length.    *
      *           - WDLDS must remain original length.                *
      *           - Initialize cheque number field CHQN.              *
      *           - GEFRPD RECI should always be 'P'.                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CAS008 - IAS39 Enhancements                                  *
      *  227580 - Skip call to access program AOBOOKR0 for deal types *
      *           NX (nostro transfer) as NX deals have blank book    *
      *           codes.                                              *
      *  227579 - Attempts to write to a closed file DL0410P3.        *
      *  225831 - If yield curve rate combination is not found, print *
      *           'Rates Missing' and do not compute for profit/loss. *
      *  225302 - GLC30 fails. Three records was produced in GEFRZZ.  *
      *  225189 - Ensure that *IN08 is always reset between branch    *
      *           processes                                           *
      *  BUG5336- Incorrect length for WDLDS                          *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA110 - Include book code for FT transactions for reval.    *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  220201 - Total outputs are repeatedly printed on reports     *
      *           other than DL0411P1.                                *
      *  220200 - Incorrect field length for WFLDS.                   *
      *         - Incorrect indicators for GEFRPD. 07 04 on the O-    *
      *           specs should be 17. Moreover, U1 must be specified  *
      *           to prevent writing to GEFRPD when BRAR index        *
      *           variable A is zero and &FREVAL = 'N' (DLC0608).     *
      *  220199 - A blank page is sometimes printed on DL0411P1       *
      *           because Total Time calculations do not fetch        *
      *           overflow.                                           *
      *  219337 - Incorrect revaluation and profit/loss amount for    *
      *           method other than 'N' or ' '.                       *
      *  219336 - Dealt Equivalent and Revalued Equivalent amount     *
      *           always reported negative.                           *
      *  219334 - Writes 'NO DETAILS TO REPORT' on the audit report   *
      *           even there were details reported in DL0410P4        *
      *  219333 - Attempts to write to a closed file DL0410P4.        *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
      *  213046 - Access book code details only if book code is not   *
      *           blanks.                                             *
      *  217120 - Net Profit/Loss Amounts for each reval type is      *
      *           incorrect                                           *
      *  CAS004 - Hedge Accounting Phase A                            *
      *  199516 - Reverse fix 187356. Accdg to Account Keys manual    *
      *           swap deals are not revalued. Remove 14V1 & 14V2 in  *
      *           TABE1 data array, and 14V1 in TABE3.                *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  138010 - Allow 5 digits in Forward Rate. Previous fix #089129*
      *           incorporated in CORE M106PXXSRC but missing few lines
      *           and not working properly. Compared it with #128797 &*
      *           #129789 and added the missing lines .               *
      *  CDE002 - Data Export - CCRM Revenue Analysis.                *
      *  140797 - Event Type (ETYP) 91P7 was removed from Array TABE1 *
      *           because it is not necessary to have that Event Type *
      *           in generating the Revaluation of Forward Commitment *
      *           Report (DL0410P1).                                  *
      *  188977 - Corrected 179925, as it caused a CoB problem.       *
      *           Print to clsoed  PRTF/DL0411P2.                     *
      *           Pattern fix from 151153, 142250 in DL0410.          *
      *           Due to the fix difference between DL0410 and DL0411 *
      *           they are not exactly the same code.                 *
      *  187356 - Swap deals (2nd leg) not included in system         *
      *           revaluation.                                        *
      *  179925 - Print to closed  PRTF/DL0411P2.                     *
      *  170442 - Mid-rate can not be reconciled with the interpolated*
      *           value from Forward rates table .  Enhanced core fix *
      *           129805 by applying associated 147688 .              *
      *  CGL007 - Account Postings Enquiry                            *
      *  155225 - When converting Dealt/ Revalued equivalent from Base*
      *           back to EUR ccy, reversed MULT/ DIV operation should*
      *           be performed depending on MDIN value .              *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  136239 - Program does not calculate Forward dates correctly. *
      *           Amended program to increment Run date by No of Spot *
      *           Days (working days only),  and then calculate the   *
      *           Forward Date from this date; i.e. 90 days forward   *
      *           is 90 calendar days from the Spot Date for the ccy. *
      *           Amended program to do this.                         *
      *  CTI002 - Recompiled : File SDEXPMPD changed                  *
      *  145193 - Blank out the rate field to avoid incorrect rate.   *
      *  CEU011 - EMU Position/Risk Reporting                         *
      *  S01408 - Insert Hooks in similar positions to those          *
      *           currently found in DL0410.                          *
      *  124860 - Forward revaluation entries being booked to Non-FX  *
      *           position profit centre.                             *
      *  CAC002 - Profit Centre Accounting Development Phase 2        *
      *           (New program based on DL0410)                       *
      *                                                               *
      *****************************************************************
      /EJECT
     F***DLEVNTL0IP  E           K        DISK                            CEU011
     F/COPY WNCPYSRC,DL0411F001
     F**********DLEVNTLBIP  E           K        DISK                                  CEU011 CAS001
     FDLEVNPL4IP  E           K        DISK                                                   CAS001
      ** Merged Events with PRFC for Forward Revaluation NPV Method                           CAS001
      *                                                                                       CAS001
     F***DLEVNPL2IF  E           K        DISK                                         CAS001 CAS004
     F**********  EVNTXEDF                          KRENAMEEVNTXDDF                    CAS001 CAS004
      ***Dealing*Events*by*Deal*no.*for*Forward*Revaluation*NPV*Method*                CAS001 CAS004
      *                                                                                       CAS001
     FDLDLDBL1UF  E           K        DISK                                                   CAS001
     F            DEALSDBF                          KRENAMEDEALSBBF                           CAS001
      ** FX Deals by Deal Number for Forward Revaluation NPV Method                           CAS001
      *                                                                                       CAS001
     FDLDLDCL1IF  E           K        DISK                                                   CAS004
     F            DEALSDCF                          KRENAMEDEALSCCF                           CAS004
      ** MM Deals by Deal Number for Forward Revaluation NPV Method                           CAS004
      *                                                                                       CAS004
     FDLDLDGLEIF  E           K        DISK                                                   CAS008
     F            DEALSDGF                          KRENAMEDEALSGGF                           CAS008
      ** FRA/IRSs by Deal Number for Forward Revaluation NPV Method                           CAS008
      *                                                                                       CAS008
     FRXCFLAPDO   E                    DISK                                                   CAS008
      ** Cross Currency Cash flow by Deal Number                                              CAS008
      *                                                                                       CAS008
     FSDYLDCL1IF  E           K        DISK                                                   CAS008
      ** Yield Curves File                                                                    CAS008
      *                                                                                       CAS008
     FFDDTSTL1IF  E           K        DISK                                                   CDL038
      ** Deal Types/Sub Types                                                                 CDL038
      *                                                                                       CDL038
     F/COPY WNCPYSRC,DL0411F002
     FFPVNTZZ IF  E                    DISK
     F***ACCNT** IF  F     400 18AI     2 DISK                                                CGL029
     FACCNT   IF  F     573 24AI     2 DISK                                                   CGL029
     FFWDRT   IF  F     611  3AI     2 DISK
     FGEFRHH  O   F     160            DISK                           U1
     F***GEFRPD**O   F     268            DISK                        U1  CGL007
     F*GEFRPD*O***F     331            DISK                           U1               CGL007 CGL020
     F***GEFRPD* O   F     589            DISK                           U1            CGL020 CGL029
     F/COPY WNCPYSRC,DLH00477
     FGEFRPD  O   F     620            DISK                           U1                      CGL029
     F/COPY WNCPYSRC,DLH00478
     FGEFRZZ  O   F     160            DISK                           U1
     FDLPOSTL0UF  E           K        DISK                      A    U1                      CAS005
     F            APOSTPDF                          KRENAMEDLPOSTF                            CAS005
     FSDBRCHL1IF  E           K        DISK
     F/COPY WNCPYSRC,DL0411FFPG                                           S01408
      *
     FDLNPVLPDO   E                    DISK                                                   CAS001
      * Revalued Forward Commitments File                                                     CAS001
     FDL0411P3O   E                    PRINTER      KINFDS SPOOL3     UC                      CAS001
      ** Printer File for Revaluation method "F"                                              CAS001
     FDL0411P4O   E                    PRINTER      KINFDS SPOOL4     UC                      CAS001
      ** Printer File for Revaluation method "B"                                              CAS001
     FDL0411P5O   E                    PRINTER      KINFDS SPOOL5     UC                      CAS001
      ** Printer File for Revaluation method "D"                                              CAS001
      *                                                                                       CAS001
     FDL0411P1O   F     132     OF     PRINTER      KINFDS SPOOL      UC
     FDL0411P2O   E                    PRINTER      KINFDS SPOOL2     UC  CEU011
     FDL0411AUO   F     132            PRINTER      KINFDS SPOOLU
      *
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   07 - BRANCH CODES RECORD                                    *
      *   08 - CURRENCY RECORD                                        *
      *   09 - ACCOUNT CODES                                          *
      *   10 - FORWARD RATES DETAIL                                   *
      *   11 - ACCOUNT MASTER DETAIL                                  *
      *   01 - EVENT FILE HEADER                                      *
      *   02 - EVENT FILE DETAIL                                      *
      *   03 - EVENT FILE TRAILER                                     *
      *   12 - DETAIL FPVNTDD                                         *
      *  N14 - P1 NOT OPENED/WRITTEN TO SO 'NO DETAILS TO REPORT      *
      *   15 - LEDGER BALANCE POSITIVE                                *
      *   20 - FORWARD REVALUATION OF INTEREST INDICATOR ON           *
      *   21 - EVENT TO BE INCLUDED IN REVALUATION                    *
      *   22 - EVENT TYPE IS ON EVENT TABLE 3                         *
      *   23 - P/L AMOUNT POSITIVE                                    *
      *   24 - TOTAL P/L AMOUNT FOR CURRENCY POSITIVE                 *
      *   25 - TOTAL CURRENCY AMOUNT IS POSITIVE                      *
      *   26 - TOTAL P/L AMOUNT POSITIVE                              *
      *   27 - FIRST DETAIL RECORD NOT FOUND.                         *
      *   28 - FIRST EVENT FOR A CURRENCY                             *
      *   29 - TRAILER RECORD READ                                    *
      *   30 - ALL DATES ENTERED IN ARRAY                             *
      *   32 - PRINT DEAL TYPE/SUB TYPE HEADINGS                      *
      *   33 - EVENT AMOUNT NEGATIVE                                  *
      *   35 - EVENT DATE EARLIER THAN NTH DATE IN ARRAY.             *
      *   36 - EVENT DATE EQUALS N-1 TH DATE IN ARRAY                 *
      *   38 - '-' SIGN FOR YEARLY SUB-TOTAL OF DBCE                  *
      *   39 - '-' SIGN FOR YEARLY SUB-TOTAL OF REVA                  *
      *   40 - CHAIN FAIL                                             *
      *   48 - '+' SIGN FOR ACCUMULATED VALUE OF DBCE FOR CCY         *
      *   49 - '-' SIGN FOR ACCUMULATED VALUE OF DBCE FOR CCY         *
      *   51 - P/L AMOUNT NEGATIVE                                    *
      *   57 - '+' SIGN FOR MONTHLY SUB-TOTAL OF PROFIT/LOSS AMT      *
      *   58 - '-' SIGN FOR MONTHLY SUB-TOTAL OF PROFIT/LOSS AMT      *
      *   59 - '+' SIGN FOR YEARLY SUB-TOTAL OF EAMT                  *
      *   64 - '+' SIGN FOR MONTHLY SUB-TOTAL OF EAMT                 *
      *   65 - '-' SIGN FOR MONTHLY SUB-TOTAL OF EAMT                 *
      *   66 - '+' SIGN FOR MONTHLY SUB-TOTAL OF DBCE                 *
      *   67 - '-' SIGN FOR MONTHLY SUB-TOTAL OF DBCE                 *
      *   68 - '+' SIGN FOR MONTHLY SUB-TOTAL OF REVA                 *
      *   69 - '-' SIGN FOR MONTHLY SUB-TOTAL OF REVA                 *
      *   77 - '-' SIGN FOR YEARLY SUB-TOTAL OF EAMT                  *
      *   78 - '+' SIGN FOR YEARLY SUB-TOTAL OF DBCE                  *
      *   79 - DETAIL WRITTEN TO P1                                   *
      *   81 - IND. TO CHECK FOR MONTHLY BREAK                        *
      *   82 - IND. TO CHECK FOR YEARLY BREAK                         *
      *   83 - OUTPUT CONTROL IND.                                    *
      *   84 - '+' SIGN FOR YEARLY SUB-TOTAL OF REVA                  *
      *   85 - Multibranching off                                     *
      *   86 - '+' SIGN FOR YEARLY SUB-TOTAL OF PROFIT/LOSS AMT       *
      *   87 - '-' SIGN FOR YEARLY SUB-TOTAL OF PROFIT/LOSS AMT       *
      *   88 - '+' SIGN FOR ACCUMULATED VALUE OF REVA FOR CCY         *
      *   89 - '-' SIGN FOR ACCUMULATED VALUE OF REVA FOR CCY         *
      *   U1 - GEFR TO BE CREATED                                     *
      *                                                               *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  CHECK  - Check Value for Output '+' or '-' Sign              *
      *  CONVTA - Convert Event Amount to Base Currency using the     *
      *           'Start Date' as the Event Date                      *
      *  CONVT  - Convert Event Amount to Base Currency               *
      *  CLREVA - Calculate Revalued Equivalent for Report            *
      *  INCLU  - Identify Events to be included in the Forward       *
      *           Revaluation                                         *
      *  SUDA   - Set up Date Array                                   *
      *  CPRLO  - Calculate Profit/Loss                               *
      *  EXCEPT - Perform Exception Output                            *
      *  ACCHN  - Access Account Master File                          *
      *  HASH   - Add ZZAMT to Hash Totals in Arrays INT and DEC      *
      *  SRPNAR - Determines Required Narratives                      *
      *                                                               *
      *  GLZADD - Add an Amount (ZZAMT) to the total (ZZTOTI,ZZTOTD)  *
      *  GLZSUM - Carry Out the Addition for GLZADD                   *
      *  *PSSR  - Subroutine to Handle Abnormal Error Conditions      *
      *                                                               *
      *****************************************************************
     E/EJECT
     E/COPY WNCPYSRC,DL0411EEPG                                           S01408
     E*                                                                   136239
     E/COPY ZSRSRC,ZHOLE                                                  136239
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3
     E                    BRAR      999  3
     E***********         BICA      999  6 0                                                  CSD027
     E                    BICA      999  6                                                    CSD027
     E/COPY WNCPYSRC,DL0411E001
     E                    TBR       999 13 0
     E                    TBP       999 13 0                                                  CAS005
     E                    TBL       999 13 0                                                  CAS005
     E/COPY WNCPYSRC,DL0411E002
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    INT         2 15 0
     E                    DEC         2  3 0
     E********************DFW        26  5 0                              136239
     E**********          DFW        25  5 0                                           136239 262151
     E**********          DFW        26  5 0                                         262151 MD049609
     E                    DFW        25  5 0                                                MD049609
0056 E***********         DAT        26  5 0A                             170442
0057 E***********         RAT        26 13 8                              170442
     E/COPY WNCPYSRC,DL0411E003
     E**********          DAT        27  5 0A                                          170442 262151
     E**********          RAT        27 13 8                                           170442 262151
     E**********          DAT        26  5 0A                                        262151 MD049609
     E**********          RAT        26 13 8                                         262151 MD049609
     E                    DAT        27  5 0A                                               MD049609
     E                    RAT        27 13 8                                                MD049609
     E/COPY WNCPYSRC,DL0411E004
     E                    RFW        25 13 8
     E********            TABE1   1  17  4                                187356
     E***********         TABE1   1  19  4                         187356 140797
     E**********          TABE1   1  18  4                                             140797 199516
     E**********          TABE1   1  16  4                                             199516 CAS008
     E                    TABE1   1  20  4                                                    CAS008
     E                    TABE2   1  15  4
     E/COPY WNCPYSRC,DL0411EEP1                                           S01408
     E********            TABE3   1  15  4                                187356
0060 E**********          TABE3   1  16  4                                             187356 199516
0060 E                    TABE3   1  15  4                                                    199516
     E/COPY WNCPYSRC,DL0411EEP2                                           S01408
     E                    DTX     1   3  2
     E                    DTH     1   3 35
     E                    TEXT    1   1 70
     E                    ZS1        15  1 0                              CEU011
     E                    ZS2        21  1                                CEU011
     I/EJECT
      *
     IEVNTXECF    01
      **  Events File - Header Record
      *
     IEVNTXEDF    02
      **  Events File - DL Detail Record
      *
     I              DLNO                            EDLNO
     I              CUNR                            ECNUM
     I                                              ECCY  L1
     I                                              PRFC  L2
     I              EBRC                            BRCA  L3
      *
     IFPVNTDDF    12
      **  Events File - FT Detail Record
      *
     I              CUNR                            ECNUM
     I              RATE                            ERATE
     I                                              ECCY  L1
     I                                              PRFC  L2
     I                                              BRCA  L3
     IEVNTXZZF    03
      **  Events File - Trailer Record
      *
     IACCNT   NS  11   1 CD
      **  Account Master File - Detail
     I                                        1   1 RECI
     I                                        2  16 ACMDKY
     I**********                              2   70CNUM                                      CSD027
     I                                        2   7 CNUM                                      CSD027
     I                                        8  10 CCY
     I**********                             11  140ACOD                                      CGL029
     I                                       11  140ACODQQ                                    CGL029
     I                                       15  160ACSQ
     I                                       23  25 BRCA
     I                                       26  26 ATYP
     I                                       27  27 STYP
     I                                       29  29 ACST
     I                                    P  30  320DACO
     I                                    P  33  350DACC
     I                                       36  55 ANAM
     I                                    P  56  630LDBL          1515
     I                                    P  64  710CLBL
     I                                       72  72 STFQ
     I                                       73  740STDY
     I                                    P  75  770LSTD
     I                                    P  78  800NSTD
     I                                    P  81  820LSTP
     I                                    P  83  900CFSB
     I                                    P  91  930LMVD
     I                                    P  94 1010EPLB
     I                                    P 102 1090EPCB
     I                                    P 110 1170YTDB
     I                                      118 118 GLBT
     I                                    P 138 1400LIMC
     I                                    P 178 1837CDIR
     I                                    P 184 1897CCIR
     I                                      190 1990ACNO
     I                                      200 200 RETB
     I                                      201 201 ODSC
     I                                    P 202 2070ODLN
     I                                    P 208 2100ODED
     I                                    P 211 2120DIOD
     I                                      213 2150FACT
     I                                      216 2170FCNO
     I                                      218 219 EFAC
     I                                    P 220 2270HELD
     I                                    P 228 2330MINB
     I                                    P 234 2360LACD
     I                                    P 237 2380LISP
     I                                    P 239 2410RRNM
     I**********                            242 2430DRIB                                      CSD103
     I                                      242 243 DRIB                                      CSD103
     I                                    P 244 2497DRIS
     I                                    P 250 2520DRCD
     I                                      253 2530DRIC
     I                                      254 254 DRIF
     I                                      255 2560DRDY
     I                                    P 257 2590NDID
     I                                    P 260 2620LDID
     I                                    P 263 2690LDIA
     I                                      270 270 SDAP
     I                                    P 271 2730LPAR
     I                                    P 274 2800DIIE
     I                                    P 281 2882DAIC
     I                                    P 289 2950MADI
     I                                    P 296 3020GADI
     I                                      303 303 DDIS
     I                                    P 304 3060DDIA
     I**********                            310 3110OLDB                                      CSD103
     I                                      310 311 OLDB                                      CSD103
     I                                    P 312 3177OLDS
     I**********                            318 3190CRIB                                      CSD103
     I                                      318 319 CRIB                                      CSD103
     I                                    P 320 3257CRIS
     I                                    P 326 3280CRCD
     I                                      329 3290CRIC
     I                                      330 330 CRIF
     I                                      331 3320CRDY
     I                                    P 333 3350NCID
     I                                    P 336 3380LCID
     I                                    P 339 3450LCIA
     I                                      346 346 SCAP
     I                                    P 347 3490LPAP
     I                                    P 350 3560CIIE
     I                                    P 357 3642CAIC
     I                                    P 365 3710MACI
     I                                    P 372 3780GACI
     I                                      379 379 CDIS
     I                                    P 380 3820DCIA
     I**********                            386 3870OLCB                                      CSD103
     I                                      386 387 OLCB                                      CSD103
     I                                    P 388 3937OLCS
     I                                    P 394 3960LCD
     I                                      397 397 CHTP
     I                                    P 398 4000TNLU
     I                                      554 5630ACOD                                      CGL029
     I                                        1 200 ACC1
     I                                      201 400 ACC2
      *
      **  Catchall
     I        NS
     I/COPY WNCPYSRC,DL0411I002
      *
     IFWDRT   NS  10   1 CD
      **  Forward Rates File - Header Record
      *
     I                                        1   1 RECI
     I                                        2   4 CCY
     I                                    P   5  79 DFW
     I                                    P  80 254 RFW
     I                                    P 255 2570LCD
     I                                      258 258 CHTP
     I                                    P 259 2610TNLU
      *
      **  Catchall for deleted records
      *
     IFWDRT   NS
      *
     IFPVNTZZF
      *
      **  Fields renamed to avoid confusion between trailer file fields
     I              RECI                            RRECI
     I              HRWN                            RHRWN
     I              HRDC                            RHRDC
      *                                                                                       CAS001
      ** Rename fields                                                                        CAS001
      *                                                                                       CAS001
     I***EVNTXDDF                                                                      CAS001 CAS004
     I**********    DLNO                            DLNO2                              CAS001 CAS004
     I**********    EDAT                            EDAT2                              CAS001 CAS004
     I**********    ETYP                            ETYP2                              CAS001 CAS004
     I**********    INOI                            INOI2                              CAS001 CAS004
     IDEALSBBF                                                                                CAS001
     I              DLNO                            WMDLNO                                    CAS001
     I              FSYUPL                          WMYUPL                                    CAS001
      *                                                                                       CAS004
     IDEALSCCF                                                                                CAS004
     I              DLNO                            WCDLNO                                    CAS004
     I              DTYP                            WDTYP                                     CAS004
     I              DLST                            WDLST                                     CAS004
     I              FSOYLC                          WCOYLC                                    CAS004
     I              FSYUPL                          WCYUPL                                    CAS004
      *                                                                                     BUG13768
     ISDYLDCD0                                                                              BUG13768
     I              FSYLDCA                         FYSLCA                                  BUG13768
      *                                                                   CEU011
     I            DS                                                      CEU011
     I                                        1  150WORK15                CEU011
     I                                        1  150ZS1                   CEU011
      *                                                                                       CAS005
     IWPOSL0    E DSDLPOSTPD                                                                  CAS005
     I                                        2  16 WDLDS                           BUG5336 BUG5336R
     I**********                              2  16 WDLDS                             CAS005 BUG5336
     I***WDLDS**     DS                                                             BUG5336 BUG5336R
     I**********                              1   60WCNUM                           BUG5336 BUG5336R
     I**********                              7   9 WCCY                            BUG5336 BUG5336R
     I**********                             10  190WACOD                           BUG5336 BUG5336R
     I**********                             20  210WACSQ                           BUG5336 BUG5336R
      *                                                                                       CAS005
     IWPOSSV      DS                                                                          CAS005
     I                                        1 100 WPSAV1                                    CAS005
     I                                      101 200 WPSAV2                                    CAS005
     I                                      201 300 WPSAV3                                    CAS005
     I                                      301 400 WPSAV4                                    CAS005
      *                                                                                       CAS001
      ** File Information Data Structure for DL0411P3                                         CAS001
     ISPOOL3      DS                                                                          CAS001
     I                                       83  92 SFILE3                                    CAS001
     I                                    B 123 1240SFNUM3                                    CAS001
     I                                    B 188 1890OFLLN3                                    CAS001
     I                                    B 367 3680PRTLN3                                    CAS001
      *                                                                                       CAS001
      ** File Information Data Structure for DL0411P4                                         CAS001
     ISPOOL4      DS                                                                          CAS001
     I                                       83  92 SFILE4                                    CAS001
     I                                    B 123 1240SFNUM4                                    CAS001
     I                                    B 188 1890OFLLN4                                    CAS001
     I                                    B 367 3680PRTLN4                                    CAS001
      *                                                                                       CAS001
      ** File Information Data Structure for DL0411P5                                         CAS001
     ISPOOL5      DS                                                                          CAS001
     I                                       83  92 SFILE5                                    CAS001
     I                                    B 123 1240SFNUM5                                    CAS001
     I                                    B 188 1890OFLLN5                                    CAS001
     I                                    B 367 3680PRTLN5                                    CAS001
      *
     ISPOOL       DS
      **  File information data structure
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      **  File information data structure                                 CEU011
      *                                                                   CEU011
     ISPOOL2      DS                                                      CEU011
     I                                       83  92 SFILE2                CEU011
     I                                    B 123 1240SFNUM2                CEU011
     I                                    B 367 3680PRTLNE                CEU011
     I/COPY WNCPYSRC,DL0411I003
      *
     ISPOOLU      DS
      **  File information data structure
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IJNSTAT     UDS                            200                                           CAS005
     I                                    P 103 1050PRUN                                      CAS005
     I@BANK     E DSSDBANKPD
      **  Bank details file
      *
     ISDMMOD    E DSSDMMODPD
      **  Module Details Accessed via access program
      *
     ISCSARD    E DSSCSARDPD
      **  SAR File Details accessed via access program AOSARDR0
      *
     ICGPNAR    E DSCGPNARPD
      **  UDC Multi Language Narrative Data Structure
      *
     ISDBOOK    E DSSDBOOKPD                                                                  CAS001
      ** Externally described DS for book details                                             CAS001
      *                                                                                       CAS001
     I##PRM1      DS
      **  Data Structure for Customer and Branch
      *
     I                                        1   6 A#CUST
     I                                        7   9 A#BRCA
      *
     ISDCUST    E DSSDCUSTPD
      **  Customer Details
      *
     I@DEAL     E DSSDDEALPD
      **  Dealing Data File
      *
     I              QQACCD                          QQACD1                                    CGL029
     I@ACOD     E DSSDACODPD
      **  Account Codes File
      *
     I              QQACCD                          QQACD2                                    CGL029
     I@CURR     E DSSDCURRPD
      **  Currencies file
      *
     I@BRCH     E DSSDBRCHPD
      **  Branch codes file
      *
     I              QQDFAC                          QQDFA1                                    CGL029
     I@DLST     E DSSDDLSTPD
      **  External DS for deal subtype details
      *
     ISDPRFC    E DSSDPRFCPD
      **  Profit Centre Details
      *
     ISDGELR    E DSSDGELRPD                                              CEU011
      ** General ledger details                                           CEU011
      *                                                                   CEU011
     I              QQACCD                          QQACD3                                    CGL029
     I/COPY WNCPYSRC,DL0411I004
     IDSFDY     E DSDSFDY
      **  First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      **  Second DS for access programs, long data structure
      *
     IDSFLDS      DS                                                                          CAS001
     I**********                              1  94 WFLDS                              CAS001 220200
     I                                        1  96 WFLDS                                     220200
     IDSNPVS      DS                                                                          CAS001
      **  DS to store revalued amount fields                                                  CAS001
     I                                        1  138RATE                                      CAS001
     I                                       14  268RATES                                     CAS001
     I                                       27  390REVA                                      CAS001
     I                                       40  520REVAS                                     CAS001
     I                                       53  650PLAM                                      CAS001
     I                                       66  789WDSCF                                     CAS001
     I                                       79  919WDSCFS                                    CAS001
     I                                       92  96 FSYLDC                                    CAS001
      *                                                                                       CAS001
     IRUNDAT      DS
      **  RUNDAT data structure - to access multi-branching flag
     I                                       13  13 @MBIN
      *
     I##ACID      DS
      **  DS to decode Account ID
     I                                        1   6 ##CNUM
     I                                        7   9 ##CCY
     I**********                             10  13 ##ACOD                                    CGL029
     I**********                             14  15 ##ACSQ                                    CGL029
     I                                       10  19 ##ACOD                                    CGL029
     I                                       20  21 ##ACSQ                                    CGL029
      *                                                                                       258435
      * Datastructure to hold input parameter for AOSVALR0.                                   258435
     I            DS                                                                          258435
     I                                        1  20 WPARM                                     258435
     I                                        1   5 WPARM1                                    258435
     I                                        6  10 WPARM2                                    258435
     I                                       11  15 WPARM3                                    258435
     I                                       16  20 WPARM4                                    258435
      *                                                                                       258435
     I              'UseForwardRateReval' C         WSVAL                                   AR720506
      *                                                                                     AR720506
     I/COPY WNCPYSRC,DL0411I001                                           S01408
     I/COPY ZSRSRC,ZHOLIA                                                 136239
     C/EJECT
      ********************************************************************
      *  MAIN PROCESSING
      ********************************************************************
      *
     C           *ENTRY    PLIST
     C                     PARM           SEQ     5
     C                     PARM           BRNCH   3
      *
      **  FIRST CYCLE CALCULATIONS
      *
     C                     Z-ADD0         ZERO15 150
     C                     Z-ADD0         CHQN                                              BUG5336R
     C                     Z-ADD0         ORAMT  130                                        AR813358
     C                     Z-ADD0         NITMS   50                                        AR813358
     C                     Z-ADD0         CHGA   130                                        AR813358
     C                     Z-ADD0         RRNM    50                                        AR813358
     C                     Z-ADD0         ACNO   100                                        AR813358
     C                     Z-ADD0         SETDAT  50                                        AR813358
     C                     Z-ADD0         REJC    30                                        AR813358
     C                     Z-ADD0         FEEVAL 130                                        AR813358
     C                     Z-ADD0         FEEPCT  52                                        AR813358
     C                     Z-ADD0         TRAT    50                                        AR813358
     C                     Z-ADD0         LTAI    10                                        AR813358
     C                     Z-ADD0         ACUM    10                                        AR813358
     C                     Z-ADD0         XRFN   100                                        AR813358
     C                     Z-ADD0         NOMINL 132                                        AR813358
      *                                                                                     AR813358
     C   80                GOTO ENDFC
      *
     C/COPY WNCPYSRC,DL0411CCPG                                           S01408
     C                     MOVEACPY@      BIS@   80
      *
      **  Read RUNDAT for multi-branching indicator
      *
     C                     IN   RUNDAT
     C           *NAMVAR   DEFN           RUNDAT 13
     C**********           Z-ADD0         ASOC    60                                          CSD027
     C                     MOVE *BLANKS   ASOC    6                                           CSD027
     C                     MOVE 'Y'       WUFLAG                                              CAS004
      *
     C                     SETON                     80
      *
      **  Use access program to read bank details file
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           @BANK     PARM @BANK     DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBANKPD'DBFILE 10        ************
     C                     Z-ADD1         DBASE   20       * DBERR 01 *
     C                     MOVEL@OPTN     DBOPTN  7        ************
     C                     GOTO ERROR
     C                     END
     C                     MOVELBJURPT    RPTTL  53                       CEU011
     C                     MOVELBJMRDT    RMRDT   7                       CEU011
     C           BJDFIN    COMP 'M'                      98
      *
      **  If multibranching indicator is off set up the branch code
      *
     C           @MBIN     IFNE 'Y'
     C                     MOVE BJSBRC    BRNCH
     C                     MOVE '1'       *IN85
     C                     END
      *
      **  Use access program to read dealing data file
      *
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** @DEAL     PARM @DEAL     DSFDY                                               CGL029
     C           @DEAL     PARM @DEAL     DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     GOTO ERROR
     C                     END
     C/COPY WNCPYSRC,DL0411C001                                           S01408
     C           BNFRDI    COMP 'Y'                      20
      *
      **  Access branch code file to obtain dealing branch
      **  Associated customer number if switch 1 ON
      *
     C  NU1                GOTO BYPAS
      *
      **  Access new Synon version of branch code file
      *
     C           *LOVAL    SETLLSDBRCHL1
     C                     Z-ADD1         A       30
     C           LOOP      TAG
     C                     READ SDBRCHL1                 74
     C   74                GOTO BYPAS
     C                     MOVE A8BICN    BICA,A
     C                     MOVE A8BRCD    BRAR,A
     C           A         ADD  1         A
     C                     SETOF                     74
     C                     GOTO LOOP
     C           BYPAS     TAG
      *
      **  Set on first detail record indicator
     C                     SETON                     27
      *
      **  Set up work fields
      *
     C                     MOVE '1'       WK4     4
     C                     MOVE '1'       WK5     5
     C                     BITOF'1'       PRIN    1
     C/COPY WNCPYSRC,DL0411C034
     C                     Z-ADD0         NRBG    50
     C/COPY WNCPYSRC,DL0411C035
      *
      **  Use access program to read currency details
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BJCYCD    @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE
     C                     Z-ADD3         DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           * DBERR 03 *
     C                     MOVELBJCYCD    DBKEY  29        ************
     C                     GOTO ERROR
     C                     ELSE                                           CEU011
     C                     MOVELA6INCY    WBINCY  1                       CEU011
     C                     END
     C/COPY WNCPYSRC,DL0411C002                                           S01408
      *
      **  Set indicator for no. of D.P. for base currency
      *
     C           A6NBDP    COMP 1                      6061
     C           A6NBDP    COMP 2                    63  62
     C                     Z-ADDA6NBDP    BCCDP   10
      *                                                                                       CAS001
      ** Save base currency interest calculation basis                                        CAS001
      *                                                                                       CAS001
     C                     MOVELA6DICB    WBCICB  1                                           CAS001
      *                                                                   CEU011
      ** Check if SAR CEU011 is installed                                 CEU011
      *                                                                   CEU011
     C                     CALL 'AOSARDR0'                                CEU011
     C                     PARM *BLANKS   @RTCD                           CEU011
     C                     PARM '*VERIFY' @OPTN                           CEU011
     C                     PARM 'CEU011'  @SARD   6                       CEU011
     C           SCSARD    PARM SCSARD    DSFDY                           CEU011
      *                                                                   CEU011
     C           @RTCD     IFEQ *BLANKS                                   CEU011
     C                     MOVE 'Y'       CEU011  1                       CEU011
     C                     ELSE                                           CEU011
     C                     MOVE 'N'       CEU011                          CEU011
      *                                                                   CEU011
     C           @RTCD     IFNE '*NRF   '                                 CEU011
     C                     MOVEL'SCSARDPD'DBFILE                          CEU011
     C                     MOVEL'CEU011'  DBKEY                           CEU011
     C                     MOVEL'*VERIFY' DBOPTN           ************   CEU011
     C                     Z-ADD15        DBASE            *DBERROR 15*   CEU011
     C                     GOTO ERROR                      ************   CEU011
     C                     ENDIF                                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                                       CAS001
      ** Call Access pgm AOSARDR0 to check if CAS001 is ON                                    CAS001
      *                                                                                       CAS001
     C                     MOVEL'N'       CAS001  1                                           CAS001
     C                     MOVE *OFF      *IN05                                               219334
     C                     MOVE *OFF      *IN06                                               CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD   7                                           CAS001
     C                     PARM '*VERIFY' POPTN   7                                           CAS001
     C                     PARM 'CAS001'  PSARD   6                                           CAS001
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           PRTCD     ANDNE'*NRF'                                                        CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C                     MOVEL'13'      DBASE                                               CAS001
     C                     MOVEL'CAS001'  DBKEY                                               CAS001
     C                     GOTO ERROR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVEL'Y'       CAS001                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C                     MOVE 'Y'       WFIRST  1                                           CAS001
     C                     MOVE 'N'       WFNPRT  1                                           CAS001
     C                     MOVE 'Y'       W1STBK  1                                           CAS001
     C                     MOVE 'Y'       W1STDS  1                                           CAS001
     C                     MOVE 'Y'       WNREC   1                                           CAS001
     C                     MOVE 'Y'       WPAS1   1                                           CAS001
     C                     MOVE *ON       *IN06                                               CAS001
     C                     MOVE *OFF      *IN09                                               CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
     C                     MOVE *ON       *IN09                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     MOVE *ON       *IN09                                               CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CGL020
      ** Call Access pgm AOSARDR0 to check if CGL020 is ON                                    CGL020
      *                                                                                       CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   PRTCD                                               CGL020
     C                     PARM '*VERIFY' POPTN                                               CGL020
     C                     PARM 'CGL020'  PSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE *BLANKS                                                       CGL020
     C           PRTCD     ANDNE'*NRF'                                                        CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD21        DBASE                                               CGL020
     C                     MOVEL'CGL020'  DBKEY                                               CGL020
     C                     GOTO ERROR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           PRTCD     IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   TICKER 10                                           CGL020
     C                     MOVE *BLANKS   EXCHNG 20                                           CGL020
     C                     MOVE *BLANKS   FEEFLG  1                                           CGL020
     C                     Z-ADD0         FEEVAL 130                                          CGL020
     C                     Z-ADD0         FEEPCT  52                                          CGL020
     C                     Z-ADD0         NOMINL 132                                          CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CAS005
      ** Call access pgm AOSARDR0 to check if CAS005 is ON                                    CAS005
      *                                                                                       CAS005
     C                     MOVEL'N'       CAS005  1                                           CAS005
     C                     MOVE *OFF      *IN07                                               CAS005
     C                     MOVE 'Y'       WFRUN   1                                           CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY' POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE *BLANKS                                                       CAS005
     C           PRTCD     ANDNE'*NRF'                                                        CAS005
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS005
     C                     Z-ADD25        DBASE                                               CAS005
     C                     MOVEL'CAS005'  DBKEY                                               CAS005
     C                     GOTO ERROR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVEL'Y'       CAS005                                              CAS005
     C                     MOVE *ON       *IN07                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     IN   JNSTAT                                                        CAS005
     C           *NAMVAR   DEFN           JNSTAT                                              CAS005
      *                                                                                       CAS008
      ** Call access pgm AOSARDR0 to check if CIR003 is ON                                    CAS008
      *                                                                                       CAS008
     C                     MOVEL'N'       CIR003  1                                           CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   PRTCD                                               CAS008
     C                     PARM '*VERIFY' POPTN                                               CAS008
     C                     PARM 'CIR003'  PSARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C           PRTCD     IFNE *BLANKS                                                       CAS008
     C           PRTCD     ANDNE'*NRF'                                                        CAS008
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS008
     C                     Z-ADD20        DBASE                                               CAS008
     C                     MOVEL'CIR003'  DBKEY                                               CAS008
     C                     GOTO ERROR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ *BLANKS                                                       CAS008
     C                     MOVEL'Y'       CIR003                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Call access pgm AOSARDR0 to check if CAS008 is ON                                    CAS008
      *                                                                                       CAS008
     C                     MOVEL'N'       CAS008  1                                           CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   PRTCD                                               CAS008
     C                     PARM '*VERIFY' POPTN                                               CAS008
     C                     PARM 'CAS008'  PSARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C           PRTCD     IFNE *BLANKS                                                       CAS008
     C           PRTCD     ANDNE'*NRF'                                                        CAS008
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS008
     C                     Z-ADD21        DBASE                                               CAS008
     C                     MOVEL'CAS008'  DBKEY                                               CAS008
     C                     GOTO ERROR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ *BLANKS                                                       CAS008
     C                     MOVEL'Y'       CAS008                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Calculate the Event Control Date                                                     CAS008
      *                                                                                       CAS008
     C           BJDNWD    SUB  1         EVCD    50                                          CAS008
      *                                                                                       CAS008
     C           BKAPDT    IFLT EVCD                                                          CAS008
     C                     Z-ADDBKAPDT    EVCD                                                CAS008
     C                     ENDIF                                                              CAS008
      *                                                                   CEU011
      ** Retrieve general ledger details                                  CEU011
      *                                                                   CEU011
     C           CEU011    IFEQ 'Y'                                       CEU011
     C**********           CALL 'AOGELRR0'                                             CEU011 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           CEU011
     C                     PARM '*FIRST ' @OPTN                           CEU011
     C********** SDGELR    PARM SDGELR    DSFDY                                        CEU011 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CEU011
     C           @RTCD     IFNE *BLANKS                                   CEU011
     C                     MOVEL'SDGELRPD'DBFILE                          CEU011
     C                     MOVEL'CEU011'  DBKEY            ************   CEU011
     C                     MOVEL'*FIRST'  DBOPTN           *DBERROR 16*   CEU011
     C                     Z-ADD16        DBASE            ************   CEU011
     C                     GOTO ERROR                                     CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
      ** Access Currency file for Euro Ccy details                        CEU011
      *                                                                   CEU011
     C                     CALL 'AOCURRR0'                                CEU011
     C                     PARM *BLANKS   @RTCD                           CEU011
     C                     PARM '*KEY   ' @OPTN                           CEU011
     C                     PARM BKEURO    @AJCD                           CEU011
     C           @CURR     PARM @CURR     DSSDY                           CEU011
      *                                                                   CEU011
     C           @RTCD     IFEQ *BLANK                                    CEU011
     C                     MOVELA6MDIN    WEMDIN  1                       CEU011
     C                     Z-ADDA6NBDP    WENBDP  10                      CEU011
     C                     Z-ADDA6SPRT    WESPRT 138                      CEU011
     C                     ELSE                                           CEU011
     C                     MOVEL'SDCURRPD'DBFILE                          CEU011
     C                     Z-ADD17        DBASE            ************   CEU011
     C                     MOVEL@OPTN     DBOPTN           *DBERROR 17*   CEU011
     C                     MOVELBKEURO    DBKEY            ************   CEU011
     C                     GOTO ERROR                                     CEU011
     C                     ENDIF                                          CEU011
     C                     ENDIF                                          CEU011
     C/COPY WNCPYSRC,DL0411C013                                           S01408
      *
      **  Call Module Prog. for Module Details.
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           @RTCD     IFNE *BLANK                     B1
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     MOVEL@OPTN     DBKEY             1
     C                     GOTO ERROR                       1
     C                     ELSE                            X1
     C/COPY WNCPYSRC,DLH00448
      *
      **  Call SAR Prog. for Switchable Feature
      *
     C           BGN1ST    IFEQ 'Y'                        B2
     C/COPY WNCPYSRC,DLH00449
      *
     C                     CALL 'AOSARDR0'                  2
     C                     PARM '       ' @RTCD             2
     C                     PARM '*VERIFY' @OPTN             2
     C                     PARM 'DLPNAR'  @SARD   6         2
     C           SCSARD    PARM SCSARD    DSFDY             2
      *
     C           @RTCD     IFNE *BLANK                     B3
     C           @RTCD     ANDNE'*NRF   '                   3
     C                     MOVEL'SCSARDPD'DBFILE            ************
     C                     Z-ADD5         DBASE             * DBERR 05 *
     C                     MOVEL@RTCD     DBKEY             ************
     C                     GOTO ERROR                       1
     C                     END                             E3
      *
     C           @RTCD     IFEQ *BLANK                     B3
     C                     MOVEL'Y'       DLPNAR  1         3
     C                     END                             E3
     C                     END                             E2
     C                     END                             E1
     C/COPY WNCPYSRC,DL0411CCP5                                           S01408
      *                                                                                       258435
      ** Check system value for meaning of Forward Days.                                      258435
      ** Set up parameter so access object checks System Value ForwardDays                    258435
     C                     MOVE *BLANKS   WPARM                                               258435
     C                     MOVEL'Forwa'   WPARM1                                              258435
     C                     MOVEL'rdDay'   WPARM2                                              258435
     C                     MOVEL's'       WPARM3                                              258435
     C                     MOVELWPARM     SVALK1                                              258435
      *                                                                                     AR720506
      ** Check if system should use Forward Rates as the first and                          AR720506
      ** second rate on the forward revaluation process.                                    AR720506
      *                                                                                     AR720506
     C                     MOVELWSVAL     SVALK2                                            AR720506
      * Call Access object:                                                                   258435
     C                     CALL 'AOSVALR0'                                                    258435
     C                     PARM           RTNCDE  7                                           258435
     C                     PARM           SVALK1 20                                           258435
     C                     PARM           SVAL1 200                                           258435
     C                     PARM           SVALK2 20                                           258435
     C                     PARM           SVAL2 200                                           258435
     C                     PARM           SVALK3 20                                           258435
     C                     PARM           SVAL3 200                                           258435
     C                     PARM           SVALK4 20                                           258435
     C                     PARM           SVAL4 200                                           258435
     C                     PARM           SVALK5 20                                           258435
     C                     PARM           SVAL5 200                                           258435
     C                     PARM           SVALK6 20                                           258435
     C                     PARM           SVAL6 200                                           258435
     C                     PARM           SVALK7 20                                           258435
     C                     PARM           SVAL7 200                                           258435
     C                     PARM           SVALK8 20                                           258435
     C                     PARM           SVAL8 200                                           258435
     C                     PARM           SVALK9 20                                           258435
     C                     PARM           SVAL9 200                                           258435
     C                     PARM           SVALK0 20                                           258435
     C                     PARM           SVAL10200                                           258435
      * If the system value is not found then issue a database error                          258435
     C           RTNCDE    IFNE '        '                                                    258435
     C                     MOVEL'SDSVALPD'DBFILE                                              258435
     C                     MOVEL'66'      DBASE                                               258435
     C                     MOVEL@OPTN     DBOPTN                                              258435
     C                     SELEC                                                            AR720506
     C           SVAL1     WHEQ '*NRF'                                                      AR720506
     C                     MOVEL'SVALK1'  DBKEY                                               258435
     C           SVAL2     WHEQ '*NRF'                                                      AR720506
     C                     MOVEL'SVALK2'  DBKEY                                             AR720506
     C                     ENDSL                                                            AR720506
     C                     GOTO ERROR                                                       AR720506
     C                     ELSE                                                               258435
      * Isolate the first 2 characters of SVAL1 which should contain the value                258435
     C                     MOVELSVAL1     WRK02   2        2 character fld                    258435
     C                     MOVELWRK02     WC      1        working or calendar                258435
     C                     MOVE WRK02     RS      1        from run date or spot              258435
      *                                                                                     AR720506
      ** Save SVAL2 to 'Use Forward Rate' work field.                                       AR720506
      *                                                                                     AR720506
     C                     MOVELSVAL2     WUFWR   1                                         AR720506
      *                                                                                     AR720506
     C                     ENDIF                                                              258435
      *
      **  DETAIL CALCULATIONS.
      *
     C           ENDFC     TAG                             ** ENDFC TAG **
     C   21                SETOF                     2128
     C   L1                SETOF                     31
     C/COPY WNCPYSRC,DL0411CCP2                                           S01408
      *
      **  Set indicator if trailer read.
     C   03                SETON                     29
      *
      **  Ignore non-detail records
     C  N02N12             GOTO END
      *
      **  If there is a change in profit centre, get profit centre dtls
      *
     C           *INL2     IFEQ '1'
     C           PRFC      IFNE *BLANKS                                                     BUG12463
     C                     CALL 'AOPRFCR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY'    @OPTN
     C                     PARM PRFC      @PRFC   4
     C           SDPRFC    PARM SDPRFC    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDPRFCPD'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     MOVELPRFC      DBKEY
     C                     GOTO ERROR
     C                     END
     C                     ENDIF                                                            BUG12463
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C                     MOVE 'Y'       WPCCH   1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   124860
     C                     MOVE '1'       *IN19                           155225
     C/COPY WNCPYSRC,DL0411C045
     C           DSFXPP    IFEQ 'Y'                                       124860
     C/COPY WNCPYSRC,DL0411C046
     C                     MOVE PRFC      RPRFC   4                       124860
     C/COPY WNCPYSRC,DL0411C047
     C                     ELSE                                           124860
     C                     MOVE DSFPPC    RPRFC                           124860
     C                     ENDIF                                          124860
     C/COPY WNCPYSRC,DL0411C048
      *                                                                   124860
     C                     END
     C/COPY WNCPYSRC,DL0411C084
      *
      **  Close printer file if there is a change in branch
      *
     C           *INL3     IFEQ '1'
     C/COPY WNCPYSRC,DL0411C085
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C           WP3CHK    IFEQ 'Y'                                                           227579
     C           WP4CHK    OREQ 'Y'                                                           227579
     C           WP5CHK    OREQ 'Y'                                                           227579
     C           WFIRST    IFNE 'Y'                                                           CAS001
     C           BRNCH     ANDEQ'ALL'                                                         CAS001
     C           WFIRST    ORNE 'Y'                                                           CAS001
     C           WFNPRT    ANDNE'Y'                                                           CAS001
     C                     EXSR SRPRT1                                                        CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              227579
      *                                                                                       CAS001
     C                     MOVE 'N'       WFIRST                                              CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
     C                     CLOSEDL0411P1                                                      CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C           WP3CHK    IFEQ 'Y'                                                           CAS001
     C                     CLOSEDL0411P3                                                      CAS001
     C                     MOVE ' '       WP3CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C           WP4CHK    IFEQ 'Y'                                                           CAS001
     C                     CLOSEDL0411P4                                                      CAS001
     C                     MOVE ' '       WP4CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C           WP5CHK    IFEQ 'Y'                                                           CAS001
     C                     CLOSEDL0411P5                                                      CAS001
     C                     MOVE ' '       WP5CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     CLOSEDL0411P1
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C/COPY WNCPYSRC,DL0411C086
     C                     SETOF                     79
     C                     END
      *
      **  Clear fields on EVNTXED not read from FPVNTDD
      *
     C           *IN12     IFEQ '1'
     C                     MOVEL*BLANK    RDTYP
     C                     MOVEL*BLANK    RDLST
     C                     MOVEL*BLANK    RCLAS                           CDL038
     C                     MOVEL*BLANK    RSUPR
     C                     END
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
      ** If there's a change in Currency                                                      CAS001
      *                                                                                       CAS001
     C           *INL1     IFEQ *ON                                                           CAS001
     C                     MOVE 'Y'       WCYCH   1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If there's a change in Book Code                                                     CAS001
      *                                                                                       CAS001
     C           BOKC      IFNE WBOKC                                                         CAS001
     C           BOKC      ANDNE*BLANKS                                                       213046
      *                                                                                       227580
      ** Call access program only for non-nostro transfer deal types.                         227580
      *                                                                                       227580
     C           DTYP      IFNE 'NX'                                                          227580
      *                                                                                       CAS001
      ** Call Access Program for Book Details                                                 CAS001
      *                                                                                       CAS001
     C                     CALL 'AOBOOKR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD   7                                           CAS001
     C                     PARM '*KEY   ' POPTN   7                                           CAS001
     C                     PARM BOKC      PBOKC   2                                           CAS001
     C           SDBOOK    PARM SDBOOK    DSFDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C                     MOVEL'SDBOOKPD'DBFILE                                              CAS001
     C                     MOVEL'14'      DBASE                                               CAS001
     C                     MOVELBOKC      DBKEY                                               CAS001
     C                     GOTO ERROR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       227580
     C                     ENDIF                                                              227580
      *                                                                                       CAS001
      ** Force a change in Deal Type/Subtype                                                  CAS001
      ** or a monthly/yearly total if *IN12 is on.                                            CAS001
      *                                                                                       CAS001
     C                     Z-ADD*ZERO     OMTH                                                CAS001
     C                     Z-ADD*ZERO     OYEAR                                               CAS001
     C                     MOVELBOKC      WBOKC   2                                           CAS001
     C                     MOVE *ON       *IN28                                               CAS001
      *                                                                                       CAS001
     C           W1STBK    IFNE 'Y'                                                           CAS001
     C                     MOVE 'Y'       WBKCH   1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       W1STBK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *
      **  If the revaluation deal type/deal sub-tupe have changed
      *
     C           SRDTYP    IFNE RDTYP
     C           SRDLST    ORNE RDLST
     C           SRCLAS    ORNE RCLAS                                     CDL038
      *
      **  Access sub-type narrative
      *
     C           SRDLST    IFNE RDLST
     C           RDLST     ANDNE*BLANK
     C                     CALL 'AODLSTR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM RDLST     @AQCD   2
     C           @DLST     PARM @DLST     DSFDY
      *
      **  Database error if deal sub-type not found
      *
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDDLSTPD'DBFILE           ************
     C                     Z-ADD7         DBASE            * DBERR 07 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     MOVELRDLST     DBKEY
     C                     GOTO ERROR
     C                     END
     C                     END
     C*                                                                   CDL038
     C**   ACCESS DEAL TYPE/SUB-TYPE NARRATIVE                            CDL038
     C*                                                                   CDL038
     C           DTSTK     KLIST                                          CDL038
     C                     KFLD           RDTYP                           CDL038
     C                     KFLD           RDLST                           CDL038
     C                     KFLD           RCLAS                           CDL038
     C           DTSTK     CHAINFDDTSTL1             99                   CDL038
     C*                                                                   CDL038
     C           *IN99     IFEQ *OFF                                      CDL038
     C                     MOVELNARR11    DSTCNR                          CDL038
     C                     ELSE                                           CDL038
     C                     MOVEL*BLANK    DSTCNR                          CDL038
     C                     MOVELASDSTN    DSTCNR 35                       CDL038
     C                     ENDIF                                          CDL038
     C*                                                                   CDL038
     C                     MOVELRDTYP     SRDTYP  2
     C                     MOVELRDLST     SRDLST  2
     C                     MOVELRCLAS     SRCLAS  4                       CDL038
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C           W1STDS    IFNE 'Y'                                                           CAS001
     C                     MOVE 'Y'       WDSCH   1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       W1STDS                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *
      **  Force output of monthly/yearly totals
      *
     C/COPY WNCPYSRC,DL0411C049
     C                     Z-ADD*ZERO     OMTH
     C                     Z-ADD*ZERO     OYEAR
      *
      **  Set the narrative to appear in the report headings
      **  Set on indicator 32 to output these headings
      **  and set on indicator 28 to force a page change
      *
     C                     Z-ADD1         X       10
     C           RDTYP     LOKUPDTX,X                    32
     C           *IN32     IFEQ '1'
     C                     MOVEL'1'       *IN28
     C                     MOVELDTH,X     DTPNAR 35
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0411C050
      *
      **  Check if first event record for a currency.
     C   L1
     COR 27                SETON                     28
      *
      **  If not, bypass data setup.
      *
     C           *INL1     IFEQ '0'
     C           *IN27     ANDEQ'0'
     C                     GOTO BYPASS
     C                     END
     C                     SETOF                     27
      *
      **  Use access program to read currency details
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM ECCY      @AJCD
     C           @CURR     PARM @CURR     DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE
     C                     Z-ADD8         DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           * DBERR 08 *
     C                     MOVELECCY      DBKEY            ************
     C                     GOTO ERROR
     C                     ELSE                                           CEU011
     C                     MOVELA6INCY    WEINCY  1                       CEU011
     C                     END
      *
      **  Set indicator for no. of D.P. for currency.
      *
     C           A6NBDP    COMP 1                      7071
     C           A6NBDP    COMP 2                    73  72
      *                                                                                       CAS001
      ** Save base currency number of decimal places                                          CAS001
      *                                                                                       CAS001
     C                     Z-ADDA6NBDP    WECDP   10                                          CAS001
      *                                                                                       CAS001
     C                     EXSR SUDA
      *                                                                                     AR720506
      ** Use Forward rates instead of Spot Rate                                             AR720506
      *                                                                                     AR720506
     C           WUFWR     IFEQ 'Y'                                                         AR720506
      *                                                                                     AR720506
     C**********           SELEC                                                  AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C********** DFW,1     WHEQ 1                                                 AR720506 MD036289A
     C********** DFW,2     ANDEQ2                                                 AR720506 MD036289A
     C********** *IN40     ANDEQ*OFF                                              AR720506 MD036289A
     C**********           MOVEARFW       RAT                                     AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C********** DFW,1     WHEQ 1                                                 AR720506 MD036289A
     C********** DFW,2     ANDGT2                                                 AR720506 MD036289A
     C********** *IN40     ANDEQ*OFF                                              AR720506 MD036289A
     C********** DFW,1     OREQ 2                                                 AR720506 MD036289A
     C********** DFW,2     ANDGT2                                                 AR720506 MD036289A
     C********** *IN40     ANDEQ*OFF                                              AR720506 MD036289A
     C**********           Z-ADDRFW,1     RAT,1                                   AR720506 MD036289A
     C**********           Z-ADDRFW,1     RAT,2                                   AR720506 MD036289A
     C**********           MOVEARFW,2     RAT,3                                   AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C**********           OTHER                                                  AR720506 MD036289A
     C           RS        IFEQ 'S'                                                        MD036289A
     C                     Z-ADDA6SPRT    RAT,1                                             AR720506
     C**********           Z-ADDA6SPRT    RAT,2                                    AR720506 MD036289
     C**********           MOVEARFW       RAT,3                                    AR720506 MD036289
     C                     Z-ADDA6SPRT    RAT,2                                            MD036289A
     C                     MOVEARFW       RAT,3                                            MD036289A
     C                     ELSE                                                            MD036289A
     C                     Z-ADDA6SPRT    RAT,1                                            MD036289A
     C                     MOVEARFW       RAT,2                                             MD036289
     C                     ENDIF                                                           MD036289A
      *                                                                                     AR720506
     C**********           ENDSL                                                  AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C                     ELSE                                                             AR720506
      *
      **  Element 1 of rate array contains spot rate.
      *
     C****************     MOVEARFW       RAT,2                           170442
     C/COPY WNCPYSRC,DL0411C093
     C                     Z-ADDA6SPRT    RAT,1
     C                     MOVEARFW       RAT,2                                               262151
     C**********           Z-ADDA6SPRT    RAT,2                                        170442 262151
     C**********           MOVEARFW       RAT,3                                        170442 262151
     C/COPY WNCPYSRC,DL0411C005                                           S01408
     C                     ENDIF                                                            AR720506
      *
      **  Maintain hash totals of event amount.
      *
     C           BYPASS    TAG                             ** BYPASS TAG *
     C                     SETOF                     33
     C           EAMT      COMP 0                      33
     C                     Z-ADD1         S       10
     C           EAMT      DIV  1000      ZZAMT
     C                     EXSR HASH
     C/COPY WNCPYSRC,DL0411C016                                           S01408
      *
      **  Check if this event is to be included in revaluation
      *
     C                     EXSR INCLU
      *
      **  If event branch is not the requested branch, then do not
      **    update monthly sub-totals
      *
     C           BRNCH     IFNE 'ALL'
     C           BRNCH     ANDNEBRCA
     C                     MOVE '0'       *IN21
     C                     MOVE '0'       *IN37                                               213046
     C                     END
     C/COPY WNCPYSRC,DL0411C051
      *
     C  N21                GOTO END
      *
      **  If P1 is closed and the event branch is the one requested,
      **    then open the P1
      *
     C           *IN79     IFEQ '0'
      *
     C           BRNCH     IFEQ 'ALL'
     C           BRNCH     OREQ BRCA
     C                     SETON                     37    Allow output
     C/COPY WNCPYSRC,DL0411C087
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
     C                     OPEN DL0411P1                                                      CAS001
     C                     MOVE '1'       *IN14                                               CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C           WP3CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P3                                                      CAS001
     C                     MOVE 'Y'       WP3CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C           WP4CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P4                                                      CAS001
     C                     MOVE 'Y'       WP4CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C           WP5CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P5                                                      CAS001
     C                     MOVE 'Y'       WP5CHK                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     OPEN DL0411P1
     C/COPY WNCPYSRC,DL0411C088
      *
      **  If P1 file opened then set on flag
     C                     MOVE '1'       *IN14
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *
      **  Ensure report spool file recorded by RCF
      **  transfer binary data into numeric field
      *
     C/COPY WNCPYSRC,DL0411C089
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
     C                     Z-ADDSFNUM     ZSNUM   60                                          CAS001
     C                     CALL 'ZSFILE'                                                      CAS001
     C                     PARM           SEQ     5                                           CAS001
     C                     PARM BRCA      @PARM   3                                           CAS001
     C                     PARM           SFILE                                               CAS001
     C                     PARM           ZSNUM                                               CAS001
     C                     PARM *BLANK    ZSERR   1                                           CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     MOVELSFNUM3    ZSNUM   60                                          CAS001
     C                     MOVELSFILE3    ZFILE  10                                           CAS001
     C                     EXSR SRRCF                                                         CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     MOVELSFNUM4    ZSNUM                                               CAS001
     C                     MOVELSFILE4    ZFILE                                               CAS001
     C                     EXSR SRRCF                                                         CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     MOVELSFNUM5    ZSNUM                                               CAS001
     C                     MOVELSFILE5    ZFILE                                               CAS001
     C                     EXSR SRRCF                                                         CAS001
      *                                                                                       CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     Z-ADDSFNUM     ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM BRCA      @PARM   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM
     C                     PARM *BLANK    ZSERR   1
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C/COPY WNCPYSRC,DL0411C090
      *
      **  Error during ZSFILE processing, return to calling program
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
     C                     Z-ADD0         PAGE
      *
      **  Use access program to read branch codes file
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BRCA      @DSNB   3
     C********** @BRCH     PARM @BRCH     DSFDY                                               CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBRCHPD'DBFILE
     C                     Z-ADD9         DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           * DBERR 09 *
     C                     MOVELBRCA      DBKEY            ************
     C                     GOTO ERROR
     C                     END
      *
      **  Else the event branch is not the one requested
      *
     C                     ELSE
     C                     SETOF                     37
     C                     END
     C                     END
      *
     C/COPY WNCPYSRC,DL0411C022                                           S01408
     C                     SETON                     3179
     C/COPY WNCPYSRC,DL0411C023                                           S01408
      *
      **  Convert event date to DDMMMYY format.
      *
     C                     Z-ADDEDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    EDATA   7
     C/COPY WNCPYSRC,DL0411C052
      *
      **  To check for diff. mth. & diff. year
      *
     C           ZMTH      COMP OMTH                 8181
     C           ZYEAR     COMP OYEAR                8282
      *
      **  If year changes, must also be change of month even if month
      **  no. is the same.
      *
     C   82                SETON                     81
     C/COPY WNCPYSRC,DL0411C053
      *
      **  Check '+' or '-' sign
     C   81
     C/COPY WNCPYSRC,DL0411C054
     COR 82                EXSR CHECK
      *
      **  Output monthly or yearly sub-total
      *
     C   81 83
     C/COPY WNCPYSRC,DL0411C055
     COR 82 83             EXSR EXCEPT
      *
      **  Store value month and year of last event
      *
     C/COPY WNCPYSRC,DL0411C056
     C                     Z-ADDZMTH      OMTH    20
     C                     Z-ADDZYEAR     OYEAR   20
      *
     C  N83                MOVE '1'       *IN83
      *
      **  Check if event is an option deal
      *
     C/COPY WNCPYSRC,DL0411CCP1                                           S01408
     C                     SETOF                     5253
     C           ETYP      COMP '12V1'                   52
     C  N52      ETYP      COMP '12V2'                   53
      *
     C   47                Z-ADDEAMT      REVA
     C   47                Z-ADDA6SPRT    RATE
     C   47                GOTO PLCALC
      *
      **  Convert event amount to base currency using the 'Start Date'
      **  as the event date
      *
     C   52
     COR 53                EXSR CONVTA
      *
      **  Convert event amount to base currency
     C/COPY WNCPYSRC,DL0411C036
      *
     C                     EXSR CONVT
     C           PLCALC    TAG                             ** PLCALC TAG**
      *
      **  Calculate profit/loss amount and maintain
      **  Total for currency.
      *
      ** Set a work field that would determine which type of                                  219337
      ** method CPRLO subroutine should process.                                              219337
      *                                                                                       219337
     C                     MOVE 'N'       WNPVM   1                                           219337
     C                     EXSR CPRLO
     C/COPY WNCPYSRC,DL0411C091
      *                                                                                       CAS001
      ** DL0411 will process all the four different NPV method                                CAS001
      ** and output the details to PF/DLNPVLPD for ad hoc reporting.                          CAS001
      ** However, it will ony generate postings for one method.                               CAS001
      ** After processing method "N" or " ", process method "D",                              CAS001
      ** then method "B" and finally method "F". This additional                              CAS001
      ** process is for FX events only.                                                       CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
      ** Initialize work fields                                                               CAS001
      *                                                                                       CAS001
     C                     MOVEL*BLANKS   WFLDS                                               CAS001
     C                     MOVEL*BLANKS   WIN23   1                                           CAS001
     C                     MOVEL*BLANKS   WIN51   1                                           CAS001
     C                     MOVEL*BLANKS   WIN55   1                                           CAS001
      *                                                                                       CAS001
     C                     MOVEL'N'       FSNPVM                                              CAS001
     C                     MOVEL*BLANKS   PNPYLD                                              CAS001
     C                     Z-ADD0         WDSCF                                               CAS001
     C                     Z-ADD0         WDSCFS                                              CAS001
     C                     EXSR SRWNPV                                                        CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
     C                     MOVELDSNPVS    WFLDS                                               CAS001
     C                     MOVEL*IN23     WIN23                                               CAS001
     C                     MOVEL*IN51     WIN51                                               CAS001
     C                     MOVEL*IN55     WIN55                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Calculate Profit and Loss Using Method D                                             CAS001
      *                                                                                       CAS001
     C                     EXSR SRREVD                                                        CAS001
      *                                                                                       CAS001
      ** Calculate Profit and Loss Using Method B                                             CAS001
      *                                                                                       CAS001
     C                     EXSR SRREVB                                                        CAS001
      *                                                                                       CAS001
      ** Calculate Profit and Loss Using Method F                                             CAS001
      *                                                                                       CAS001
     C                     EXSR SRREVF                                                        CAS001
      *                                                                                       CAS008
      ** For CAS008 changes, populate RXCFLAPD fields                                         CAS008
      *                                                                                       CAS008
     C           CIR003    IFEQ 'Y'                                                           CAS008
     C           CAS008    ANDEQ'Y'                                                           CAS008
      *                                                                                       CAS008
     C           ETYP      IFEQ '23C3'                                                        CAS008
     C           ETYP      OREQ '23S3'                                                        CAS008
     C           ETYP      OREQ '23C4'                                                        CAS008
     C           ETYP      OREQ '23S4'                                                        CAS008
      *                                                                                       CAS008
     C                     MOVE EDLNO     IRDLNO                                              CAS008
     C                     MOVE 'RX'      IRDTYP                                              CAS008
     C                     MOVE DLST      IRDLST                                              CAS008
     C                     MOVE CLAS      IRCLAS                                              CDL038
     C                     Z-ADDEDAT      IRFLDT                                              CAS008
      *                                                                                       CAS008
      ** Convert Event Date to DDMMMYY format                                                 CAS008
      *                                                                                       CAS008
     C                     Z-ADDEDAT      ZDAYNO                                              CAS008
     C                     EXSR ZDATE2                                                        CAS008
     C                     MOVE ZADATE    IRDATE                                              CAS008
      *                                                                                       CAS008
     C           EDAT      SUB  EVCD      IRNDYP                                              CAS008
      *                                                                                       CAS008
     C                     Z-ADDEAMT      IRCAMT                                              CAS008
      *                                                                                       CAS008
     C                     Z-ADDWDSCF     IRDSCF                                              CAS008
     C                     MOVE INOI      IRIOIN                                              CAS008
     C                     MOVE ECNUM     IRCNUM                                              CAS008
     C                     MOVE BRCA      IRBRCA                                              CAS008
     C                     MOVE ECCY      IRCYCD                                              CAS008
     C                     MOVE BOKC      IRBKCD                                              CAS008
     C                     Z-ADD0         IRIRAT                                              CAS008
     C                     Z-ADD0         IRSPRR                                              CAS008
     C                     MOVE *BLANK    IRSPIN                                              CAS008
     C                     MOVE *BLANK    IRMISS                                              CAS008
      *                                                                                       CAS008
      ** If Yield Rates missing, update IRMISS accordingly.                                   CAS008
      *                                                                                       CAS008
     C           *IN30     IFEQ *ON                                                           CAS008
     C                     MOVE 'R'       IRMISS                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** If Yield Curve missing, update IRMISS accordingly.                                   CAS008
      *                                                                                       CAS008
     C           PNPYLD    IFNE *BLANKS                                                       CAS008
     C           PNPYLD    CHAINSDYLDCL1             34                                       CAS008
     C           *IN34     IFEQ *ON                                                           CAS008
     C                     MOVE 'C'       IRMISS                                              CAS008
     C                     ENDIF                                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           EDLNO     CHAINDLDLDGLE             34                                       CAS008
     C           *IN34     IFEQ *OFF                                                          CAS008
     C           ECCY      IFEQ UCUCY                                                         CAS008
     C                     MOVE UICBS     IRICBS                                              CAS008
     C                     MOVE FSOFYC    IRFYLD                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE TICBS     IRICBS                                              CAS008
     C                     MOVE FSTFYC    IRFYLD                                              CAS008
     C                     ENDIF                                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVEL'DEALSDG' DBFILE                                              CAS008
     C                     Z-ADD24        DBASE                                               CAS008
     C                     MOVELEDLNO     DBKEY                                               CAS008
     C                     GOTO ERROR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Calculation Methods are:                                                             CAS008
      *                                                                                       CAS008
     C                     SELEC                                                              CAS008
      *                                                                                       CAS008
      ** 1  Actual/365                                                                        CAS008
      ** 4  365/365 (excluding 29/02)                                                         CAS008
      *                                                                                       CAS008
     C           IRICBS    WHEQ 1                                                             CAS008
     C           IRICBS    OREQ 4                                                             CAS008
     C                     Z-ADD365       IRNDYY                                              CAS008
      *                                                                                       CAS008
      ** 2  Actual/360                                                                        CAS008
      ** 3  360/360 (sometimes called 30/360)                                                 CAS008
      ** 5  365/360 (excluding 29/02)                                                         CAS008
      *                                                                                       CAS008
     C           IRICBS    WHEQ 2                                                             CAS008
     C           IRICBS    OREQ 3                                                             CAS008
     C           IRICBS    OREQ 5                                                             CAS008
     C                     Z-ADD360       IRNDYY                                              CAS008
      *                                                                                       CAS008
      ** 6  Actual/366                                                                        CAS008
      *                                                                                       CAS008
     C           IRICBS    WHEQ 6                                                             CAS008
     C                     Z-ADD366       IRNDYY                                              CAS008
      *                                                                                       CAS008
     C                     ENDSL                                                              CAS008
      *                                                                                       CAS008
      ** Determine value of Cash Flow Type                                                    CAS008
     C                     SELEC                                                              CAS008
      *                                                                                       CAS008
     C           VDAT      WHEQ EDAT                                                          CAS008
     C                     MOVE 'VAMT'    IRFTYP                                              CAS008
      *                                                                                       CAS008
     C           BOVD      WHEQ EDAT                                                          CAS008
     C           MDAT      OREQ EDAT                                                          CAS008
     C                     MOVE 'MAMT'    IRFTYP                                              CAS008
      *                                                                                       CAS008
     C                     OTHER                                                              CAS008
      *                                                                                       CAS008
      ** For Principal Increase, 'S3' or 'C3'.  For                                           CAS008
      ** Principal Decrease, 'S4' or 'C4'.                                                    CAS008
      *                                                                                       CAS008
     C           ETYP      IFEQ '23S3'                                                        CAS008
     C           ETYP      OREQ '23C3'                                                        CAS008
     C                     MOVE 'PINC'    IRFTYP                                              CAS008
     C                     ENDIF                                                              CAS008
     C           ETYP      IFEQ '23S4'                                                        CAS008
     C           ETYP      OREQ '23C4'                                                        CAS008
     C                     MOVE 'PDEC'    IRFTYP                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ENDSL                                                              CAS008
      *                                                                                       CAS008
     C           BNNPVM    IFEQ 'F'                                                           CAS008
     C           *INU1     ANDEQ*ON                                                           CAS008
     C           BNNPV2    OREQ 'F'                                                           CAS008
     C           *INU1     ANDEQ*OFF                                                          CAS008
     C                     MOVELPNPYLD    IRYLDC                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVELBNBCYC    IRYLDC                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           IRCAMT    MULT IRDSCF    IRNPVA                                              CAS008
      *                                                                                       CAS008
     C                     WRITERXCFLAD0                                                      CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS001
      ** Restore back fields for reporting                                                    CAS001
      *                                                                                       CAS001
     C                     MOVELWFLDS     DSNPVS                                              CAS001
     C                     MOVELWIN23     *IN23                                               CAS001
     C                     MOVELWIN51     *IN51                                               CAS001
     C                     MOVELWIN55     *IN55                                               CAS001
      *                                                                                       CAS001
     C           *IN09     IFEQ *OFF                                                          CAS001
     C                     EXSR SRPRD1                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                   CEU011
     C           CEU011    IFEQ 'Y'                                       CEU011
     C           WEINCY    ANDEQ'Y'                                       CEU011
     C           *IN21     ANDEQ'1'                                       CEU011
     C           CEU011    OREQ 'Y'                                       CEU011
     C           ECCY      ANDEQBKEURO                                    CEU011
     C           *IN21     ANDEQ'1'                                       CEU011
      *                                                                   CEU011
     C           *INL3     IFEQ '1'                                       CEU011
     C           WBRCA     ANDNE*BLANKS                                   CEU011
      *                                                                   CEU011
      *                                                                   155225
      *  Since *inL3 is Not correctly set ON when the branch changes,     155225
      *  check its value against Branch-field-check 'WBFCK' and use WFRST 155225
      *  to make sure it is not ht every first, initial run               155225
     C           BRCA      ORNE WBFCK                                     155225
     C           WFRST     ANDNE' '                                       155225
      *                                                                   155225
      *  Print on the next page if Profit Centre changes within the same  155225
      *  Branch . Use work-field WFPRC to verify the change .             155225
     C           *IN19     OREQ '1'                                       155225
     C           PRFC      ANDNEWFPRC                                     155225
     C           WFRST     ANDNE' '                                       155225
      *                                                                   155225
      * If the Branch has changed, initialize the Branch-close check-field155225
      * to close the report for this Branch                               155225
     C           BRCA      IFNE WBFCK                                     155225
     C                     MOVE 'C'       WBCLS   1                       155225
     C                     END                                            155225
     C                     EXSR SRP004                                    CEU011
      *                                                                   CEU011
     C           *IN04     IFEQ *ON                                                           188977
     C********** PRTLNE    IFGT 49                               CEU011 AR635480
     C           PRTLNE    IFGE 49                                      AR635480
     C********** WBCLS     IFEQ 'C'                                                     179925188977
     C**********           CLOSEDL0411P2                                                179925188977
     C**********           OPEN DL0411P2                                                179925188977
     C**********           MOVE ' '       WBCLS                                         179925188977
     C**********           END                                                          179925188977
     C                     WRITEDL0411D1                                  CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     WRITEDL0411D3                                  CEU011
     C                     WRITEDL0411D4                                  CEU011
      *                                                                   CEU011
      * If the Branch has changed, ONLY then close the report and open a  155225
      * new for the next branch.                                          155225
     C           WBCLS     IFEQ 'C'                                       155225
      *                                                                   CEU011
     C                     CLOSEDL0411P2                                  CEU011
     C**********           OPEN DL0411P2                                                CEU011188977
      *                                                                   CEU011
      *                                                                   CEU011
     C                     MOVE ' '       WBCLS                           155225
     C                     MOVE ' '       FCHK    1                                           188977
     C                     END                                            155225
     C                     ENDIF                                                              188977
      *                                                                                       188977
     C           FCHK      IFEQ ' '                                                           188977
     C                     OPEN DL0411P2                                                      188977
     C                     MOVE '1'       FCHK    1                                           188977
     C                     ENDIF                                                              188977
     C                     Z-ADD*ZEROS    ETDBCE                          CEU011
     C                     Z-ADD*ZEROS    ETREVA                          CEU011
     C                     Z-ADD*ZEROS    ETPROF                          CEU011
     C                     Z-ADD*ZEROS    ETLOSS                          CEU011
     C                     Z-ADD*ZEROS    ETOTPL                          CEU011
     C                     MOVE *BLANKS   RBRCA                           CEU011
     C                     MOVE *BLANKS   RBRNM                           CEU011
      *                                                                   CEU011
     C                     MOVELBRCA      RBRCA                           CEU011
     C                     MOVELA8BRNM    RBRNM                           CEU011
     C                     WRITEDL0411D1                                  CEU011
     C                     ENDIF                                          CEU011
     C                     MOVE BRCA      WBRCA   3                       CEU011
     C                     ENDIF                                          CEU011
      *                                                                   155225
     C                     MOVE PRFC      WFPRC   4                       155225
     C                     MOVE BRCA      WBFCK   3                       155225
     C                     MOVE '1'       WFRST   1                       155225
      *                                                                   155225
     C                     MOVE '0'       *IN19                           155225
      *                                                                   CEU011
     C           CEU011    IFEQ 'Y'                                       CEU011
     C           WEINCY    ANDEQ'Y'                                       CEU011
     C           *IN21     ANDEQ'1'                                       CEU011
     C           CEU011    OREQ 'Y'                                       CEU011
     C           ECCY      ANDEQBKEURO                                    CEU011
     C           *IN21     ANDEQ'1'                                       CEU011
      *                                                                   CEU011
      ** Convert Dealt Base Equivalent amount                             CEU011
     C           BJCYCD    IFEQ BKEURO                                    CEU011
     C           DBCE      OREQ *ZEROS                                    CEU011
     C                     Z-ADDDBCE      EUDBCE 130                      CEU011
     C                     ELSE                                           CEU011
     C                     Z-ADDDBCE      P@FRAM                          CEU011
     C                     Z-ADD18        WDBASE  30                      CEU011
     C                     EXSR SRP001                                    CEU011
     C                     Z-ADDP@OUTA    EUDBCE                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
      ** Convert Revalued Equivalent amount                               CEU011
     C           BJCYCD    IFEQ BKEURO                                    CEU011
     C           *IN55     IFEQ '0'                                       CEU011
     C                     Z-ADDREVA      EUREVA                          CEU011
     C                     ELSE                                           CEU011
     C                     Z-ADDREVAS     EUREVA                          CEU011
     C                     ENDIF                                          CEU011
     C                     ELSE                                           CEU011
      *                                                                   CEU011
     C           *IN55     IFEQ '0'                                       CEU011
     C                     Z-ADDREVA      P@FRAM                          CEU011
     C                     ELSE                                           CEU011
     C                     Z-ADDREVAS     P@FRAM                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     Z-ADD19        WDBASE  30                      CEU011
     C                     EXSR SRP001                                    CEU011
     C                     Z-ADDP@OUTA    EUREVA 130                      CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
      ** Convert Profit/Loss Amount                                       CEU011
     C           BJCYCD    IFEQ BKEURO                                    CEU011
     C           PLAM      OREQ *ZEROS                                    CEU011
     C                     Z-ADDPLAM      EUPLAM 130                      CEU011
     C                     ELSE                                           CEU011
     C                     Z-ADDPLAM      P@FRAM                          CEU011
     C                     Z-ADD20        WDBASE  30                      CEU011
     C                     EXSR SRP001                                    CEU011
     C                     Z-ADDP@OUTA    EUPLAM 130                      CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
      ** Total the Euro equivalent amount                                 CEU011
     C           *IN22     IFEQ '1'                                       CEU011
     C           ETDBCE    ADD  EUDBCE    ETDBCE 130                      CEU011
     C           ETREVA    ADD  EUREVA    ETREVA 130                      CEU011
     C                     ELSE                                           CEU011
     C           ETDBCE    SUB  EUDBCE    ETDBCE                          CEU011
     C           ETREVA    SUB  EUREVA    ETREVA                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     ADD  EUPLAM    ETOTPL 130                      CEU011
      *                                                                   CEU011
     C           *IN23     IFEQ '1'                                       CEU011
     C           ETLOSS    ADD  EUPLAM    ETLOSS 130                      CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C           *IN51     IFEQ '1'                                       CEU011
     C           ETPROF    ADD  EUPLAM    ETPROF 130                      CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
      ** Write record to DL0411P2                                         CEU011
     C                     EXSR SRP002                                    CEU011
      *                                                                   CEU011
     C                     ENDIF                                          CEU011
     C/COPY WNCPYSRC,DL0411CCP4                                           S01408
      *
      **  Restore coding to previous state - EAMSGN should be used
      **  only for determining P/L and Sign printing
      *
     C           *IN,22    IFEQ '1'
     C/COPY WNCPYSRC,DL0411C037
     C           TEAMT     ADD  EAMT      TEAMT  130
     C                     ELSE
     C/COPY WNCPYSRC,DL0411C038
     C           TEAMT     SUB  EAMT      TEAMT  130
     C                     END
     C                     SELEC                                                              217120
     C           BNNPVM    WHEQ 'N'                                                           217120
     C           BNNPVM    OREQ ' '                                                           217120
     C           TOTPL     ADD  PLAM      TOTPL  130 2446
     C           BNNPVM    WHEQ 'D'                                                           217120
     C           TOTPL     ADD  PLAMD     TOTPL      2446                                     217120
     C           BNNPVM    WHEQ 'B'                                                           217120
     C           TOTPL     ADD  PLAMB     TOTPL      2446                                     217120
     C           BNNPVM    WHEQ 'F'                                                           217120
     C           TOTPL     ADD  PLAMF     TOTPL      2446                                     217120
     C                     ENDSL                                                              217120
     C/COPY WNCPYSRC,DL0411C057
     C                     SELEC                                                              217120
     C           BNNPVM    WHEQ 'N'                                                           217120
     C           BNNPVM    OREQ ' '                                                           217120
     C           TOTBR     ADD  PLAM      TOTBR  130
     C           BNNPVM    WHEQ 'D'                                                           217120
     C           TOTBR     ADD  PLAMD     TOTBR                                               217120
     C           BNNPVM    WHEQ 'B'                                                           217120
     C           TOTBR     ADD  PLAMB     TOTBR                                               217120
     C           BNNPVM    WHEQ 'F'                                                           217120
     C           TOTBR     ADD  PLAMF     TOTBR                                               217120
     C                     ENDSL                                                              217120
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     SELEC                                                              CAS005
     C           BNNPVM    WHEQ 'N'                                                           CAS005
     C           BNNPVM    OREQ ' '                                                           CAS005
     C           PLAM      IFGE 0                                                             CAS005
     C           WPAMT     ADD  PLAM      WPAMT  130                                          CAS005
     C                     ELSE                                                               CAS005
     C           WLAMT     ADD  PLAM      WLAMT  130                                          CAS005
     C                     ENDIF                                                              CAS005
     C           BNNPVM    WHEQ 'D'                                                           CAS005
     C           PLAMD     IFGE 0                                                             CAS005
     C           WPAMT     ADD  PLAMD     WPAMT                                               CAS005
     C                     ELSE                                                               CAS005
     C           WLAMT     ADD  PLAMD     WLAMT                                               CAS005
     C                     ENDIF                                                              CAS005
     C           BNNPVM    WHEQ 'B'                                                           CAS005
     C           PLAMB     IFGE 0                                                             CAS005
     C           WPAMT     ADD  PLAMB     WPAMT                                               CAS005
     C                     ELSE                                                               CAS005
     C           WLAMT     ADD  PLAMB     WLAMT                                               CAS005
     C                     ENDIF                                                              CAS005
     C           BNNPVM    WHEQ 'F'                                                           CAS005
     C           PLAMF     IFGE 0                                                             CAS005
     C           WPAMT     ADD  PLAMF     WPAMT                                               CAS005
     C                     ELSE                                                               CAS005
     C           WLAMT     ADD  PLAMF     WLAMT                                               CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDSL                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,DL0411C024                                           S01408
      *
      **  To accumulate monthly and yearly sub-total:
      **    For option deals, the revaluation amount reported is the
      **    lowest of revaluation using event date (REVA), and
      **    revaluation using start date (REVAS) - the correct amount
      **    should be used when calculating monthly and yearly totals.
      *
     C           *IN22     IFEQ '1'
     C                     ADD  EAMT      MEAMT  130
     C/COPY WNCPYSRC,DL0411C058
     C                     ADD  DBCE      MDBCE  130
      *
     C           *IN55     IFEQ '0'
     C/COPY WNCPYSRC,DL0411C059
     C                     ADD  REVA      MREVA  130
     C                     ELSE
     C/COPY WNCPYSRC,DL0411C060
     C                     ADD  REVAS     MREVA  130
     C                     END
      *
     C                     ADD  EAMT      YEAMT  130
     C                     ADD  DBCE      YDBCE  130
      *
     C           *IN55     IFEQ '0'
     C                     ADD  REVA      YREVA  130
     C                     ELSE
     C                     ADD  REVAS     YREVA  130
     C                     END
      *
     C                     ADD  DBCE      TDBCE  130
      *
     C           *IN55     IFEQ '0'
     C                     ADD  REVA      TREVA  130
     C                     ELSE
     C                     ADD  REVAS     TREVA  130
     C                     END
      *
     C                     ELSE
     C                     SUB  EAMT      MEAMT  130
     C/COPY WNCPYSRC,DL0411C061
     C                     SUB  DBCE      MDBCE  130
      *
     C           *IN55     IFEQ '0'
     C/COPY WNCPYSRC,DL0411C062
     C                     SUB  REVA      MREVA  130
     C                     ELSE
     C/COPY WNCPYSRC,DL0411C063
     C                     SUB  REVAS     MREVA  130
     C                     END
      *
     C                     SUB  EAMT      YEAMT  130
     C                     SUB  DBCE      YDBCE  130
      *
     C           *IN55     IFEQ '0'
     C                     SUB  REVA      YREVA  130
     C                     ELSE
     C                     SUB  REVAS     YREVA  130
     C                     END
      *
     C                     SUB  DBCE      TDBCE  130
      *
     C           *IN55     IFEQ '0'
     C                     SUB  REVA      TREVA  130
     C                     ELSE
     C                     SUB  REVAS     TREVA  130
     C                     END
      *
     C/COPY WNCPYSRC,DL0411C064
     C                     END
     C/COPY WNCPYSRC,DL0411C083
     C                     SELEC                                                              217120
     C           BNNPVM    WHEQ 'N'                                                           217120
     C           BNNPVM    OREQ ' '                                                           217120
     C                     ADD  PLAM      MPLAM  130
     C                     ADD  PLAM      YPLAM  130
      *
     C   23                ADD  PLAM      TPROF  130
     C   51                ADD  PLAM      TLOSS  130
     C           BNNPVM    WHEQ 'D'                                                           217120
     C                     ADD  PLAMD     MPLAM                                               217120
     C                     ADD  PLAMD     YPLAM                                               217120
      *                                                                                       217120
     C   23                ADD  PLAMD     TPROF                                               217120
     C   51                ADD  PLAMD     TLOSS                                               217120
     C           BNNPVM    WHEQ 'B'                                                           217120
     C                     ADD  PLAMB     MPLAM                                               217120
     C                     ADD  PLAMB     YPLAM                                               217120
      *                                                                                       217120
     C   23                ADD  PLAMB     TPROF                                               217120
     C   51                ADD  PLAMB     TLOSS                                               217120
     C           BNNPVM    WHEQ 'F'                                                           217120
     C                     ADD  PLAMF     MPLAM                                               217120
     C                     ADD  PLAMF     YPLAM                                               217120
      *                                                                                       217120
     C   23                ADD  PLAMF     TPROF                                               217120
     C   51                ADD  PLAMF     TLOSS                                               217120
     C                     ENDSL                                                              217120
     C/COPY WNCPYSRC,DL0411C014                                           S01408
      *
      **  Increment total of records reported.
     C   37      RECS      ADD  1         RECS    50
     C/COPY WNCPYSRC,DL0411C025                                           S01408
      *
     C                     GOTO END
      *
      **  Set error indicators.
     C           ERROR     TAG                             ** ERROR TAG **
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
      *
      **  END OF DETAIL CALULATIONS.
     C           END       TAG                             ** END TAG **
      *
      **  TOTAL CALCULATIONS.
      *
     C/COPY WNCPYSRC,DL0411C003                                           S01408
     CL1NU7      TEAMT     COMP 0                    25
     C/COPY WNCPYSRC,DL0411C065
     CL1NU7 31             MOVEA'11'      *IN,81
     CL1NU7 31             EXSR CHECK
     CL1NU7 31             EXSR EXCEPT
     CL1NU7                MOVE '0'       *IN83
     CL1NU7      TDBCE     COMP 0                    8889
     CL1NU7      TREVA     COMP 0                    4849
     C/COPY WNCPYSRC,DL0411C039
      *
     CL2NU7 U1             Z-ADD1         A
     CL2NU7 U1   BRCA      LOKUPBRAR,A                   75
     C/COPY WNCPYSRC,DL0411C015                                           S01408
      *                                                                                       CAS005
     CL2NU7 U1   CAS005    IFEQ 'N'                                                           CAS005
     CL2NU7 U1   TBR,A     ADD  TOTBR     TBR,A
     CL2                   ELSE                                                               CAS005
     CL2NU7 U1   TBP,A     ADD  WPAMT     TBP,A                                               CAS005
     CL2NU7 U1   TBL,A     ADD  WLAMT     TBL,A                                               CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
     CL2NU7 U1             Z-ADD0         TOTBR
      *                                                                                       CAS005
     CL2NU7 U1   CAS005    IFEQ 'Y'                                                           CAS005
     CL2NU7 U1             Z-ADD0         WPAMT                                               CAS005
     CL2NU7 U1             Z-ADD0         WLAMT                                               CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      *
     C/COPY WNCPYSRC,DL0411C009                                           S01408
      **  Ignore LR/L2 calculations if database error or switch 1 off
      *
     CL2NU1
     COR LRNU1
     COR U7                GOTO FIN
     C/COPY WNCPYSRC,DL0411C026                                           S01408
      *
      **  Setup key for account master file.
      *
     C*2*********BICA,A    COMP 0                        76                                   CSD027
     CL2         BICA,A    COMP *BLANKS                  76                                   CSD027
     CL2 76                GOTO FINISH
     C/COPY WNCPYSRC,DL0411C066
     C/SPACE 3
      *                                                                                       CAS005
      ** Do posting of net Profit/Loss to a P/L account and contra account                    CAS005
      ** if CAS005 is not installed                                                           CAS005
      *                                                                                       CAS005
     CL2         CAS005    IFEQ 'N'                                                           CAS005
      *
      **  Do Fwd Reval P/L Account
      *
     C/COPY WNCPYSRC,DL0411C010                                           S01408
     CL2                   MOVELBICA,A    WK9     9
     CL2                   MOVE BJCYCD    WK9
     C***L2*****              MOVE '01'      WK6     6                                        CGL029
     C***L2*****              MOVELWK9       ACCKEY 18                                        CGL029
     C***L2*****              MOVE '01'      WK6    12                               CGL029 BUG5336R
     CL2                   MOVE '01'      WK12   12                                         BUG5336R
     CL2                   MOVELWK9       ACCKEY 24                                           CGL029
      *
      **  Access Fwd Reval. P/L A/c.
      *
     C/COPY WNCPYSRC,DL0411C067
     C***L2*****              MOVELBNACCD    WK6                                            BUG5336R
     CL2                   MOVELBNACCD    WK12                                              BUG5336R
     C/COPY WNCPYSRC,DL0411C068
     C***L2*****              MOVELWK6       WK9A    9                                        CGL029
     C***L2*****              MOVELWK6       WK9A   15                               CGL029 BUG5336R
     CL2                   MOVELWK12      WK15   15                                         BUG5336R
      *
      **  Insert branch code into account key
      *
     C***L2*****              MOVE BRAR,A    WK9A                                           BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                         BUG5336R
     CL2                   MOVE BRAR,A    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     C***L2*****              MOVELACCKEY    ACCKY  15                                        CGL029
     CL2                   MOVELACCKEY    ACCKY  21                                           CGL029
     C/COPY WNCPYSRC,DL0411C069
     CL2                   EXSR ACCHN
     C/COPY WNCPYSRC,DL0411C030                                           S01408
      *
      **  Use access prog.to read a/c codes file to obtain account type
      *
     CL2                   CALL 'AOACODR0'
     CL2                   PARM '*MSG   ' @RTCD
     CL2                   PARM '*KEY   ' @OPTN
     C***L2*****              PARM BNFRPL    @AFNB   4                                        CGL029
     C***L2*****    @ACOD     PARM @ACOD     DSFDY                                            CGL029
     CL2                   PARM BNFRPL    @AFNB  10                                           CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
     CL2         @RTCD     IFNE *BLANK
     CL2                   MOVEL'SDACODPD'DBFILE
     CL2                   Z-ADD10        DBASE            ************
     CL2                   MOVEL@OPTN     DBOPTN           * DBERR 10 *
     CL2                   MOVELBNFRPL    DBKEY            ************
     CL2                   GOTO LRERR
     CL2                   END
     C/COPY WNCPYSRC,DL0411C070
     CL2         TBR,A     COMP 0                    26
     C/COPY WNCPYSRC,DL0411C071
      *
      **  Post positive amounts
      *
     CL2 15                Z-SUBLDBL      LDBL
     C/COPY WNCPYSRC,DL0411C072
     CL2N26                Z-SUBTBR,A     TBR,A
     C/COPY WNCPYSRC,DL0411C040
      *
     C/SPACE 3
      **  Write generated entry,
      **  but not zero balances.
      *
      **  Post new balance (TBR)
     C/COPY WNCPYSRC,DL0411C041
     C*
     CL2         TBR,A     IFNE 0                          *TBR,A Zero?
     C/COPY WNCPYSRC,DL0411C031                                           S01408
      *
      **  Determine Posting Narratives:
      *
     CL2                   MOVE ACCKY     ##ACID
     CL2                   MOVE BNFRPL    ##ACOD
     CL2                   MOVE 'GB00480' ##MGID
     CL2                   EXSR SRPNAR
     C/COPY WNCPYSRC,DL0411C073
      *
     CL2                   SETON                     42
     CL2                   EXSR EXCEPT
     CL2         TOTNUM    ADD  1         TOTNUM  50       Update count
     CL2         NRBG      ADD  1         NRBG
     C/COPY WNCPYSRC,DL0411C074
     CL2         RBG       ADD  TBR,A     RBG    150
     C/COPY WNCPYSRC,DL0411C027                                           S01408
      *
      **  Keep hash total of posting amounts.
      *
     CL2                   Z-ADD2         S
     C/COPY WNCPYSRC,DL0411C075
     CL2         TBR,A     DIV  500       ZZAMT
     C/COPY WNCPYSRC,DL0411C076
     CL2                   EXSR HASH
     CL2                   END
      *
     C/SPACE 3
      *
     C/COPY WNCPYSRC,DL0411C032                                           S01408
      **  Do Fwd Reval P/L Contra Account
      *
      **  Set up account key for Fwd Reval Contra A/C
      *
     C***L2*****              MOVELBNACCD    WK9A                                           BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                         BUG5336R
     CL2                   MOVELBNACCD    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     CL2                   MOVELACCKEY    ACCKY
      *
      **  Use access prog.to read a/c codes file to obtain account type
      *
     CL2                   CALL 'AOACODR0'
     CL2                   PARM '*MSG   ' @RTCD
     CL2                   PARM '*KEY   ' @OPTN
     CL2                   PARM BNACCD    @AFNB
     C***L2*****    @ACOD     PARM @ACOD     DSFDY                                            CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
     CL2         @RTCD     IFNE *BLANK
     CL2                   MOVEL'SDACODPD'DBFILE
     CL2                   Z-ADD11        DBASE            ************
     CL2                   MOVEL@OPTN     DBOPTN           * DBERR 11 *
     CL2                   MOVELBNACCD    DBKEY            ************
     CL2                   GOTO LRERR
     CL2                   END
     C/COPY WNCPYSRC,DL0411C042
      *
     C/SPACE 3
      **  Write generated entries
      **  But not zero balances.
      *
      **  Post new balance (TBR)
     C/COPY WNCPYSRC,DL0411C043
      *
     CL2         TBR,A     IFNE 0                          *TBR,A Zero?
     C/COPY WNCPYSRC,DL0411C077
      *
      **  Determine Posting Narratives:
      *
     CL2                   MOVE ACCKY     ##ACID
     CL2                   MOVE 'GB00700' ##MGID
     CL2                   EXSR SRPNAR
      *
     CL2                   SETON                     44
     CL2                   EXSR EXCEPT
     CL2         TOTNUM    ADD  1         TOTNUM           Update count
     CL2         NRBG      ADD  1         NRBG
     C/COPY WNCPYSRC,DL0411C078
     CL2         RBG       ADD  TBR,A     RBG
     C/COPY WNCPYSRC,DL0411C028                                           S01408
     CL2                   END                             *
     C/COPY WNCPYSRC,DL0411C011                                           S01408
      *
      **  Reset branch/profit centre totals
      *
     CL2                   Z-ADD0         TBR,A
      *                                                                                       CAS005
      ** Else, do posting of net Profit and Loss seperately                                   CAS005
      *                                                                                       CAS005
     CL2                   ELSE                                                               CAS005
      *                                                                                       CAS005
      ** Do Fwd Reval Profit Account posting                                                  CAS005
      *                                                                                       CAS005
     CL2                   MOVELBICA,A    WK9                                                 CAS005
     CL2                   MOVE BJCYCD    WK9                                                 CAS005
     C***L2*****              MOVE '01'      WK6                                     CAS005 BUG5336R
     CL2                   MOVE '01'      WK12                                       CAS005 BUG5336R
     CL2                   MOVELWK9       ACCKEY                                              CAS005
     C***L2*****              MOVELBNACCD    WK6                                     CAS005 BUG5336R
     C***L2*****              MOVELWK6       WK9A                                    CAS005 BUG5336R
     CL2                   MOVELBNACCD    WK12                                              BUG5336R
     CL2                   MOVELWK12      WK15                                              BUG5336R
     C***L2*****              MOVE BRAR,A    WK9A                                    CAS005 BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                  CAS005 BUG5336R
     CL2                   MOVE BRAR,A    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     CL2                   MOVELACCKEY    ACCKY                                               CAS005
     CL2                   EXSR ACCHN                                                         CAS005
      *                                                                                       CAS005
      ** Use access prog. to read a/c codes file to obtain account type                       CAS005
      *                                                                                       CAS005
     CL2                   CALL 'AOACODR0'                                                    CAS005
     CL2                   PARM '*MSG   ' PRTCD                                               CAS005
     CL2                   PARM '*KEY   ' POPTN                                               CAS005
     CL2                   PARM BNFRPL    @AFNB                                               CAS005
     C***L2*****    @ACOD     PARM  ACOD     DSFDY                                     CAS005 CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
      *                                                                                       CAS005
     CL2         PRTCD     IFNE *BLANK                                                        CAS005
     CL2                   MOVEL'SDACODPD'DBFILE                                              CAS005
     CL2                   Z-ADD21        DBASE                                               CAS005
     CL2                   MOVELPOPTN     DBOPTN                                              CAS005
     CL2                   MOVELBNFRPL    DBKEY                                               CAS005
     CL2                   GOTO LRERR                                                         CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Post positive amounts                                                                CAS005
      *                                                                                       CAS005
     CL2         TBP,A     COMP 0                    26                                       CAS005
     CL2 15                Z-SUBLDBL      LDBL                                                CAS005
     CL2N26                Z-SUBTBP,A     TBP,A                                               CAS005
      *                                                                                       CAS005
      ** Determine Posting Narratives                                                         CAS005
      *                                                                                       CAS005
     CL2         TBP,A     IFNE 0                                                             CAS005
     CL2                   MOVE ACCKY     ##ACID                                              CAS005
     CL2                   MOVE BNFRPL    ##ACOD                                              CAS005
     CL2                   MOVE 'GB00480' ##MGID                                              CAS005
     CL2                   EXSR SRPNAR                                                        CAS005
      *                                                                                       CAS005
     CL2                   MOVE *ON       *IN42                                               CAS005
     CL2                   EXSR EXCEPT                                                        CAS005
     CL2         TOTNUM    ADD  1         TOTNUM                                              CAS005
     CL2         NRBG      ADD  1         NRBG                                                CAS005
     CL2         RBG       ADD  TBP,A     RBG                                                 CAS005
      *                                                                                       CAS005
      ** Keep hash total of posting amounts                                                   CAS005
      *                                                                                       CAS005
     CL2                   Z-ADD2         S                                                   CAS005
     CL2         TBP,A     DIV  500       ZZAMT                                               CAS005
     CL2                   EXSR HASH                                                          CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Do Fwd Reval Profit Contra Account posting                                           CAS005
      *                                                                                       CAS005
     C***L2*****              MOVELBNACCD    WK9A                                    CAS005 BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                  CAS005 BUG5336R
     CL2                   MOVELBNACCD    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     CL2                   MOVELACCKEY    ACCKY                                               CAS005
      *                                                                                       CAS005
      ** Use access prog. to read a/c codes file to obtain account type                       CAS005
      *                                                                                       CAS005
     CL2                   CALL 'AOACODR0'                                                    CAS005
     CL2                   PARM '*MSG   ' PRTCD                                               CAS005
     CL2                   PARM '*KEY   ' POPTN                                               CAS005
     CL2                   PARM BNACCD    @AFNB                                               CAS005
     C***L2*****    @ACOD     PARM @ACOD     DSFDY                                     CAS005 CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
      *                                                                                       CAS005
     CL2         PRTCD     IFNE *BLANK                                                        CAS005
     CL2                   MOVEL'SDACODPD'DBFILE                                              CAS005
     CL2                   Z-ADD22        DBASE                                               CAS005
     CL2                   MOVELPOPTN     DBOPTN                                              CAS005
     CL2                   MOVELBNACCD    DBKEY                                               CAS005
     CL2                   GOTO LRERR                                                         CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Post new balance                                                                     CAS005
      *                                                                                       CAS005
     CL2         TBP,A     IFNE 0                                                             CAS005
     CL2                   MOVE ACCKY     ##ACID                                              CAS005
     CL2                   MOVE 'GB00700' ##MGID                                              CAS005
     CL2                   EXSR SRPNAR                                                        CAS005
     CL2                   MOVE *ON       *IN44                                               CAS005
     CL2                   EXSR EXCEPT                                                        CAS005
     CL2         TOTNUM    ADD  1         TOTNUM                                              CAS005
     CL2         NRBG      ADD  1         NRBG                                                CAS005
     CL2         RBG       ADD  TBP,A     RBG                                                 CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
     CL2                   Z-ADD0         TBP,A                                               CAS005
      *                                                                                       CAS005
      ** Do Fwd Reval Loss Account posting                                                    CAS005
      *                                                                                       CAS005
     CL2                   MOVE *ON       *IN08                                               CAS005
      *                                                                                       CAS005
     C***L2*****              MOVELBNFRLA    WK9A                                    CAS005 BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                  CAS005 BUG5336R
     CL2                   MOVELBNFRLA    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     CL2                   MOVELACCKEY    ACCKY                                               CAS005
      *                                                                                       CAS005
      ** Use access prog. to read a/c codes file to obtain account type                       CAS005
      *                                                                                       CAS005
     CL2                   CALL 'AOACODR0'                                                    CAS005
     CL2                   PARM '*MSG   ' PRTCD                                               CAS005
     CL2                   PARM '*KEY   ' POPTN                                               CAS005
     CL2                   PARM BNFRLA    @AFNB                                               CAS005
     C***L2*****    @ACOD     PARM @ACOD     DSFDY                                     CAS005 CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
      *                                                                                       CAS005
     CL2         PRTCD     IFNE *BLANK                                                        CAS005
     CL2                   MOVEL'SDACODPD'DBFILE                                              CAS005
     CL2                   Z-ADD23        DBASE                                               CAS005
     CL2                   MOVELPOPTN     DBOPTN                                              CAS005
     CL2                   MOVELBNFRLA    DBKEY                                               CAS005
     CL2                   GOTO LRERR                                                         CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Post positive amounts                                                                CAS005
      *                                                                                       CAS005
     CL2         TBL,A     COMP 0                    26                                       CAS005
     CL2 15                Z-SUBLDBL      LDBL                                                CAS005
     CL2N26                Z-SUBTBL,A     TBL,A                                               CAS005
      *                                                                                       CAS005
      ** Post new balance                                                                     CAS005
      *                                                                                       CAS005
     CL2         TBL,A     IFNE 0                                                             CAS005
     CL2                   MOVE ACCKY     ##ACID                                              CAS005
     CL2                   MOVE 'GB00480' ##MGID                                              CAS005
     CL2                   EXSR SRPNAR                                                        CAS005
     CL2                   MOVE *ON       *IN42                                               CAS005
     CL2                   EXSR EXCEPT                                                        CAS005
     CL2         TOTNUM    ADD  1         TOTNUM                                              CAS005
     CL2         NRBG      ADD  1         NRBG                                                CAS005
     CL2         RBG       ADD  TBL,A     RBG                                                 CAS005
      *                                                                                       CAS005
      ** Keep hash total of posting amounts                                                   CAS005
      *                                                                                       CAS005
     CL2                   Z-ADD2         S                                                   CAS005
     CL2         TBL,A     DIV  500       ZZAMT                                               CAS005
     CL2                   EXSR HASH                                                          CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Do Fwd Reval Loss Contra Account posting                                             CAS005
      *                                                                                       CAS005
     CL2                   MOVE *ON       *IN08                                               CAS005
      *                                                                                       CAS005
     C***L2*****              MOVELBNLCAC    WK9A                                    CAS005 BUG5336R
     C***L2*****              MOVE WK9A      ACCKEY                                  CAS005 BUG5336R
     CL2                   MOVELBNLCAC    WK15                                              BUG5336R
     CL2                   MOVE WK15      ACCKEY                                            BUG5336R
     CL2                   MOVELACCKEY    ACCKY                                               CAS005
      *                                                                                       CAS005
      ** Use access prog. to read a/c codes file to obtain account type                       CAS005
      *                                                                                       CAS005
     CL2                   CALL 'AOACODR0'                                                    CAS005
     CL2                   PARM '*MSG   ' PRTCD                                               CAS005
     CL2                   PARM '*KEY   ' POPTN                                               CAS005
     CL2                   PARM BNLCAC    @AFNB                                               CAS005
     C***L2*****    @ACOD     PARM @ACOD     DSFDY                                     CAS005 CGL029
     CL2         @ACOD     PARM @ACOD     DSSDY                                               CGL029
      *                                                                                       CAS005
     CL2         PRTCD     IFNE *BLANK                                                        CAS005
     CL2                   MOVEL'SDACODPD'DBFILE                                              CAS005
     CL2                   Z-ADD24        DBASE                                               CAS005
     CL2                   MOVELPOPTN     DBOPTN                                              CAS005
     CL2                   MOVELBNLCAC    DBKEY                                               CAS005
     CL2                   GOTO LRERR                                                         CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Post new balance                                                                     CAS005
      *                                                                                       CAS005
     CL2         TBL,A     IFNE 0                                                             CAS005
     CL2                   MOVE ACCKY     ##ACID                                              CAS005
     CL2                   MOVE 'GB00700' ##MGID                                              CAS005
     CL2                   EXSR SRPNAR                                                        CAS005
     CL2                   MOVE *ON       *IN44                                               CAS005
     CL2                   EXSR EXCEPT                                                        CAS005
     CL2         TOTNUM    ADD  1         TOTNUM                                              CAS005
     CL2         NRBG      ADD  1         NRBG                                                CAS005
     CL2         RBG       ADD  TBL,A     RBG                                                 CAS005
     CL2                   ENDIF                                                              CAS005
      *                                                                                       CAS005
     CL2                   Z-ADD0         TBL,A                                               CAS005
     CL2                   MOVE '0'       *IN08                                               225189
      *                                                                                       CAS005
     CL2                   ENDIF                                                              CAS005
     C/COPY WNCPYSRC,DL0411C079
      *
     CL2         FINISH    TAG
     C/SPACE 3
      *
      **  Write generated entries trailer.
      *
     C/COPY WNCPYSRC,DL0411C080
     CLR         TOTNUM    ADD  2         TOTNUM
     C/COPY WNCPYSRC,DL0411C081
     CLR                   SETON                     45
     CLR                   EXSR EXCEPT
      *
      **  Compare input and calculated event amount totals
      *
     CLR         1         SETLLFPVNTZZF
     CLR                   READ FPVNTZZ                  99
      *
      **  Ensure FT events hash total does not include regular
      **  Payments, for consistency with EVENTA/LF.
      *
     CLRN99                Z-ADDHWNX      ZZAMT            Integer field
     CLRN99                MOVE HDCX      ZZAMT            Decimal field
      *
     CLR                   Z-ADDHRWN      ZZTOTI
     CLR                   Z-ADDHRDC      ZZTOTD
      *
     CLRN99                EXSR GLZADD
     C/COPY WNCPYSRC,DL0411C044
     CLR         INT,1     COMP ZZTOTI               U8U8
     CLRNU8      DEC,1     COMP ZZTOTD               U8U8
      *
     CLR U8                DUMP
      *
     CLR                   GOTO FIN
      *
      **  Set error indicators
     CLR         LRERR     TAG                             ** LRERR TAG **
     CLR                   SETON                     U7U8
     CLR                   EXSR *PSSR
      *
     CLR         FIN       TAG                             ** FIN TAG **
      *
      **  Ensure totals spool file recorded by RCF
      *
     CLR                   Z-ADDSFNUMU    ZSNUMU  60
     CLR                   CALL 'ZSFILE'
     CLR                   PARM           SEQ
     CLR                   PARM *BLANK    @PARM
     CLR                   PARM           SFILEU
     CLR                   PARM           ZSNUMU
     CLR                   PARM *BLANK    ZSERR   1
      *
      **  Error during ZSFILE processing, return to calling program
      *
     CLR         ZSERR     IFEQ 'Y'
     CLR                   SETON                     U7U8LR
     CLR                   RETRN
     CLR                   END
      *
      **  Read bank details file (when empty files)
      *
     CLRN80                CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           @BANK     PARM @BANK     DSFDY
     CLRN80      @RTCD     IFNE *BLANK
     CLRN80                MOVEL'SDBANKPD'DBFILE 10        ************
     CLRN80                Z-ADD12        DBASE   20       * DBERR 12 *
     CLRN80                MOVEL@OPTN     DBOPTN  7        ************
     CLR                   END
      *                                                                   CEU011
     CLR         CEU011    IFEQ 'Y'                                       CEU011
     CLR         *IN04     ANDEQ'1'                                       CEU011
      *                                                                   CEU011
     CLR                   EXSR SRP004                                    CEU011
      *                                                                   CEU011
     C***LR***** PRTLNE    IFGT 49                               CEU011 AR635480
     CLR         PRTLNE    IFGE 49                                      AR635480
     CLR                   WRITEDL0411D1                                  CEU011
     CLR                   ENDIF                                          CEU011
      *                                                                   CEU011
     CLR                   WRITEDL0411D3                                  CEU011
      *                                                                   CEU011
     CLR                   WRITEDL0411D4                                  CEU011
      *                                                                   CEU011
     CLR                   CLOSEDL0411P2                                  CEU011
     CLR                   MOVE ' '       FCHK                                                188977
      *                                                                   CEU011
     CLR                   ENDIF                                          CEU011
      *                                                                                       CAS001
     CLR         CAS001    IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     CLR         WP3CHK    IFEQ 'Y'                                                           219333
     CLR         WP4CHK    OREQ 'Y'                                                           219333
     CLR         WP5CHK    OREQ 'Y'                                                           219333
     CLR         BRNCH     IFEQ 'ALL'                                                         CAS001
     CLR                   EXSR SRPRT1                                                        CAS001
     CLR                   ENDIF                                                              CAS001
     CLR                   ENDIF                                                              219333
      *                                                                                       CAS001
     CLR                   SELEC                                                              CAS001
      *                                                                                       CAS001
     CLR         BNNPVM    WHEQ 'F'                                                           CAS001
     CLR         WP3CHK    IFEQ 'Y'                                                           CAS001
     CLR                   CLOSEDL0411P3                                                      CAS001
     CLR                   ENDIF                                                              CAS001
      *                                                                                       CAS001
     CLR         BNNPVM    WHEQ 'B'                                                           CAS001
     CLR         WP4CHK    IFEQ 'Y'                                                           CAS001
     CLR                   CLOSEDL0411P4                                                      CAS001
     CLR                   ENDIF                                                              CAS001
      *                                                                                       CAS001
     CLR         BNNPVM    WHEQ 'D'                                                           CAS001
     CLR         WP5CHK    IFEQ 'Y'                                                           CAS001
     CLR                   CLOSEDL0411P5                                                      CAS001
     CLR                   ENDIF                                                              CAS001
      *                                                                                       CAS001
     CLR                   ENDSL                                                              CAS001
      *                                                                                       CAS001
     CLR                   ENDIF                                                              CAS001
      *                                                                                       CAS001
     C/COPY WNCPYSRC,DL0411C006                                           S01408
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CHECK - Subroutine to check value for output '+' or '-' sign *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           CHECK     BEGSR                           ** CHECK ***
     C/COPY WNCPYSRC,DL0411C082
      *
     C           MEAMT     COMP 0                    6465
     C           MDBCE     COMP 0                    6667
     C           MREVA     COMP 0                    6869
     C           MPLAM     COMP 0                    5758
     C           YEAMT     COMP 0                    5977
     C           YDBCE     COMP 0                    7838
     C           YREVA     COMP 0                    8439
     C           YPLAM     COMP 0                    8687
     C/COPY WNCPYSRC,DL0411C012                                           S01408
      *
     C                     ENDSR                           END CHECK **
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CONVTA - Subroutine to convert event amount to base currency *
      *           using the 'Start Date' as the event date            *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  CLREVA                                           *
      *                                                               *
      *****************************************************************
     C           CONVTA    BEGSR                           *** CONVTA ***
      *
      **  Is the start date less than the run date?
      *
     C           OTHD      COMP DAT,1                  54
     C/COPY WNCPYSRC,DL0411CCP6                                           S01408
      *
     C***54******          Z-ADDRAT,1     RATES  128                                          138010
     C   54                Z-ADDRAT,1     RATES  138                                          138010
     C/COPY WNCPYSRC,DL0411CCP7                                           S01408
      *
     C   54                GOTO CREVAS
      *
      **  Compare start date with dates in array.
     C                     Z-ADD1         N       20
     C           OTHD      LOKUPDAT,N                35
     C  N35                GOTO CASEB
      *
      **  Check if N-1 TH date matches start date
     C           N         SUB  1         M       20
     C           OTHD      COMP DAT,M                    36
     C   36                GOTO CASEA
      *
      **  Third case - start date is between two dates in
      **  the array.
      *
     C/COPY WNCPYSRC,DL0411CCP8                                           S01408
0606 C********** RAT,N     SUB  RAT,M     WKR1   128                                          138010
0606 C           RAT,N     SUB  RAT,M     WKR1   138                                          138010
     C/COPY WNCPYSRC,DL0411CCP9                                           S01408
      *
     C           OTHD      SUB  DAT,M     WKD1    50
     C           DAT,N     SUB  DAT,M     WKD2    50
     C           WKR1      MULT WKD1      RATES
     C           RATES     DIV  WKD2      RATES
     C           RATES     ADD  RAT,M     RATES
     C                     GOTO CREVAS
      *
      **  First case - start date matches a date in the array
     C           CASEA     TAG                             ** CASEA TAG **
     C                     Z-ADDRAT,M     RATES
     C                     GOTO CREVAS
      *
      **  Second case - start date is after last date in
      **  the array
     C           CASEB     TAG                             ** CASEB TAG **
     C                     Z-ADDRAT,LAST  RATES
      *
      **  Calculate revalued amount.
      *
     C           CREVAS    TAG
      *
     C           A6NBDP    SUB  BCCDP     K       10
     C           K         ADD  4         K
      *
      **  Indicator 32 no longer attached to the multiply/divide flag
      **  as currencies file is now externally described
      *
     C/COPY WNCPYSRC,DL0411CP10                                           S01408
     C**********           Z-ADDRATES     WKRATE 128                                          138010
     C                     Z-ADDRATES     WKRATE 138                                          138010
      *
     C/COPY WNCPYSRC,DL0411CP11                                           S01408
     C                     EXSR CLREVA
     C                     Z-ADDWKREVA    REVAS  130
      *
      **  Convert other date to DDMMMYY format.
     C                     Z-ADDOTHD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATA   7
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CONVT - Subroutine to convert event amount to base currency  *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  CLREVA                                           *
      *                                                               *
      *****************************************************************
     C           CONVT     BEGSR                           *** CONVT ***
      *
      **  Compare event date with dates in array.
      *
     C                     Z-ADD1         N       20
     C           EDAT      LOKUPDAT,N                35
     C  N35                GOTO CASE2
      *
      **  Check if N-1 TH date matches event date
     C           N         SUB  1         M       20
     C           EDAT      COMP DAT,M                    36
     C   36                GOTO CASE1
      *
      **  Third case - event date is between to dates in
      **  the array.
      *
     C/COPY WNCPYSRC,DL0411CP12                                           S01408
0606 C********** RAT,N     SUB  RAT,M     WKR1   128                                          138010
0606 C           RAT,N     SUB  RAT,M     WKR1   138                                          138010
     C/COPY WNCPYSRC,DL0411CP13                                           S01408
      *
     C           EDAT      SUB  DAT,M     WKD1    50
     C           DAT,N     SUB  DAT,M     WKD2    50
     C           WKR1      MULT WKD1      WRK15  158
     C/COPY WNCPYSRC,DL0411CP14                                           S01408
      *
     C********** WRK15     DIV  WKD2      RATE   128                                          138010
     C           WRK15     DIV  WKD2      RATE   138                                          138010
      *
     C/COPY WNCPYSRC,DL0411CP15                                           S01408
     C           RATE      ADD  RAT,M     RATE
     C                     GOTO CREVA
      *
      **  First case - event date matches a date in the array
     C           CASE1     TAG                             ** CASE1 TAG **
     C                     Z-ADDRAT,M     RATE
     C                     GOTO CREVA
      *
      **  Second case - event date is after last date in
      **  the array
     C           CASE2     TAG                             ** CASE2 TAG **
     C                     Z-ADDRAT,LAST  RATE
      *
      **  Calculate revalued amount.
      *
     C           CREVA     TAG
      *
     C           A6NBDP    SUB  BCCDP     K       10
     C           K         ADD  4         K
      *
      **  Indicator 32 no longer attached to the multiply/divide flag
      **  as currencies file is now externally described
      *
     C                     Z-ADDRATE      WKRATE
     C                     EXSR CLREVA
     C                     Z-ADDWKREVA    REVA   130
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CLREVA - Subroutine to calculate revalued equivalent for     *
      *           report                                              *
      *                                                               *
      *  Called By:  CONVTA, CONVT                                    *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           CLREVA    BEGSR                                       *
      *
     C           A6MDIN    IFEQ 'D'
      *
     C           K         IFNE 1
     C           K         ANDNE2
     C           WKRATE    MULT POWER,K   WK159  159
     C           EAMT      DIV  WK159     WKREVA 130H
     C                     END
     C           K         IFEQ 1
     C***********WKRATE    MULT 100       RATE1  126                                          138010
     C***********RATE1     MULT POWER,K   WK129  129                                          138010
     C           WKRATE    MULT 100       RATE1  136                                          138010
     C           RATE1     MULT POWER,K   WK129  159                                          138010
     C           EAMT      DIV  WK129     WK152  152H
     C           WK152     MULT 100       WKREVA    H
     C                     END
      *
     C           K         IFEQ 2
     C***********WKRATE    MULT 10        RATE2  127                                          138010
     C           WKRATE    MULT 10        RATE2  137                                          138010
     C           RATE2     MULT POWER,K   WK129
     C           EAMT      DIV  WK129     WK151  151H
     C           WK151     MULT 10        WKREVA    H
     C                     END
      *
     C                     ELSE
      *
     C           K         IFNE 6
     C           K         ANDNE7
     C           WKRATE    DIV  POWER,K   WK159
     C           EAMT      MULT WK159     WKREVA    H
     C                     END
     C           K         IFEQ 7
     C           WKRATE    MULT 100       RATE1
     C           RATE1     DIV  POWER,K   WK129
      *
      **  Use half-adjust instead of truncate, to ensure calculated
      **  amount is correct to the nearest unit.
      *
     C           EAMT      MULT WK129     WKREVA    H
     C           WKREVA    DIV  100       WKREVA    H
     C                     END
      *
     C           K         IFEQ 6
     C           WKRATE    MULT 10        RATE2
     C           RATE2     DIV  POWER,K   WK129
      *
      **  Use half-adjust instead of truncate, to ensure calculated
      **  amount is correct to the nearest unit.
      *
     C           EAMT      MULT WK129     WKREVA    H
     C           WKREVA    DIV  10        WKREVA    H
     C                     END
      *
     C                     END
      *
     C                     ENDSR
     C/COPY WNCPYSRC,DL0411C019                                           S01408
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INCLU - Subroutine to identify events to be included in the  *
      *          forward revaluation                                  *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           INCLU     BEGSR                           *** INCLU ***
      *
     C           ETYP      LOKUPTABE1                    21
     C/COPY WNCPYSRC,DL0411C033
      *                                                                                      BUG9453
      ** Include principal amounts for RX deals only when                                    BUG9453
      ** CIR003 and CAS008 are ON.                                                           BUG9453
      *                                                                                      BUG9453
     C           ETYP      IFEQ '23C3'                                                       BUG9453
     C           ETYP      OREQ '23S3'                                                       BUG9453
     C           ETYP      OREQ '23C4'                                                       BUG9453
     C           ETYP      OREQ '23S4'                                                       BUG9453
      *                                                                                      BUG9453
     C           CIR003    IFNE 'Y'                                                          BUG9453
     C           CAS008    ORNE 'Y'                                                          BUG9453
     C                     MOVE *OFF      *IN21                                              BUG9453
     C                     ENDIF                                                             BUG9453
      *                                                                                      BUG9453
     C                     ENDIF                                                             BUG9453
      *
      **  Second group of events is checked only if fwd. rev.
      **  of interest ind. is on
      *
     C   20N21   ETYP      LOKUPTABE2                    21
     C/COPY WNCPYSRC,DL0411C092
      *
      **  Check suppress revaluation ind. to see if output necessary
      *
     C   20 21   RSUPR     COMP 'Y'                  2121
      *
      **  Do not include interbranch events. Note field only on EVNTXED
      *
     C   21 02   IBRE      COMP 'Y'                  2121
      *
      **  Not incl. if amount zero
     C   21      EAMT      COMP 0                    2121
     C   21      EDAT      COMP BJRDNB               21  21
     C/COPY WNCPYSRC,DL0411C018                                           S01408
      *
      **  Incl. if event for base ccy.
     C   21      ECCY      COMP BJCYCD                   47
      *
      **  If Interest on Outright Accruals Indicator is on, and
      **  deal type is PI or SI, set include flag off.
      *
     C           BNAOIO    IFEQ 'Y'
     C           DTYP      IFEQ 'PI'
     C           DTYP      OREQ 'SI'
     C                     MOVE '0'       *IN21
     C                     END
     C                     END
      *
      **  Events of deals which has already been rolled over
      **  should not be included in revaluation
      *
     C           RLVI      IFEQ 'Y'
     C           RBDA      ANDNE0
     C                     MOVE '0'       *IN21
     C                     END
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUDA - Subroutine to set up date array                       *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           SUDA      BEGSR                           *** SUDA ***
     C                     Z-ADD0         DAT
     C                     Z-ADD0         RAT
     C                     Z-ADD*ZERO     RFW
      *
      **  Access forward rate file.
      *
     C                     SETOF                     10
     C           ECCY      CHAINFWDRT                40
      *
      **  Put run date in first element.
      *
     C                     Z-ADDBJRDNB    DAT,1
     C/COPY WNCPYSRC,DL0411C007                                           S01408
     C  N10                Z-ADD2         N
     C  N10                GOTO ESUDA
     C***********                                                         136239
     C****Loop*to*calculate*remaining*dates.***************************** 136239
     C***********                                                         136239
     C***********          Z-ADD1         N                               136239
     C***********          Z-ADD0         Y       20                      136239
     C/COPY WNCPYSRC,DL0411C008                                           S01408
      *                                                                   136239
      **  Increment Run Date by No of Spot Days for Currency, taking any  136239
      **  non-working days for the currency into account - Forward Days   136239
      **  are calculated from spot date.                                  136239
      *                                                                   136239
     C           RS        IFEQ 'S'                                                           258435
     C           WUFWR     ANDEQ'Y'                                                        MD036289A
     C                     Z-ADDBJRDNB    ZDAYNO                          136239
     C                     MOVE ECCY      ZCCY                            136239
     C                     MOVE *BLANKS   ZLOC                            136239
     C                     Z-ADDA6SPDY    ZNRDYS                          136239
     C                     EXSR ZFWDTA                                    136239
     C/COPY WNCPYSRC,DL0411C101
     C                     Z-ADDZDYNBR    @BASE   50                      136239
     C                     Z-ADD@BASE     DAT,2                                            MD036289A
     C                     Z-ADD3         N                                                MD036289A
     C                     ELSE                                                               258435
     C                     Z-ADDBJRDNB    @BASE                                               258435
     C                     Z-ADD2         N                                                MD036289A
     C                     END                                                                258435
      ****************************************************************              136239 MD036289A
      ****Increment*Spot*date*by*number*of*Forward*Days***************              136239 MD036289A
      ****************************************************************              136239 MD036289A
     C**********           Z-ADD2         N                                         136239 MD036289A
     C***********          Z-ADD2         Y       20               136239 170442
     C/COPY WNCPYSRC,DL0411C094
     C**********           Z-ADD1         Y       20                                170442 MD036289A
     C/COPY WNCPYSRC,DL0411C095
      *                                                                   136239
     C**********           Z-ADD@BASE     DAT,N                                        136239 262151
     C**********           ADD  1         N                                            136239 262151
      **********                                                                  AR720506 MD036289A
     C********** WUFWR     IFEQ 'Y'                                               AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C**********           SELEC                                                  AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C********** DFW,1     WHEQ 1                                                 AR720506 MD036289A
     C********** DFW,2     ANDEQ2                                                 AR720506 MD036289A
     C**********           Z-ADD2         N                                       AR720506 MD036289A
     C**********           Z-ADD2         Y                                       AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C********** DFW,1     WHEQ 1                                                 AR720506 MD036289A
     C********** DFW,2     ANDGT2                                                 AR720506 MD036289A
     C********** DFW,1     OREQ 2                                                 AR720506 MD036289A
     C********** DFW,2     ANDGT2                                                 AR720506 MD036289A
     C**********           Z-ADD2         N                                       AR720506 MD036289A
     C**********           Z-ADD1         Y                                       AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C**********           ENDSL                                                  AR720506 MD036289A
      **********                                                                  AR720506 MD036289A
     C**********           ENDIF                                                  AR720506 MD036289A
      *                                                                   136239
     C                     Z-ADD1         Y       20                                       MD036289A
     C           N         DOWLE25                                        136239
     C           DFW,Y     ANDNE0                                         136239
     C           WC        IFEQ 'C'                                                           258435
     C           WUFWR     ORNE 'Y'                                                        MD036289A
     C********** @BASE     ADD  DFW,Y     DAT,N                                        136239 262151
     C********** BJRDNB    ADD  DFW,Y     DAT,N                                     262151 MD036289A
     C           @BASE     ADD  DFW,Y     DAT,N                                            MD036289A
     C                     ELSE                                                               258435
     C                     Z-ADD@BASE     ZDAYNO                                              258435
     C                     MOVE ECCY      ZCCY                                                258435
     C                     MOVE *BLANKS   ZLOC                                                258435
     C                     Z-ADDDFW,Y     ZNRDYS                                              258435
     C                     EXSR ZFWDTA                                                        258435
     C                     Z-ADDZDYNBR    DAT,N                                               258435
     C                     END                                                                258435
     C                     ADD  1         N                               136239
     C                     ADD  1         Y                               136239
     C                     ENDDO                                          136239
     C/COPY WNCPYSRC,DLH00125
      *                                                                   136239
     C***********REST      TAG                             ** REST TAG ** 136239
     C***********N         ADD  1         N                               136239
     C***********Y         ADD  1         Y                               136239
     C***********N         COMP 26                   30                   136239
     C**N30******DFW,Y     COMP 0                        30               136239
     C***30******          GOTO ESUDA                                     136239
     C***********DFW,Y     ADD  BJRDNB    DAT,N                           136239
     C***********          GOTO REST                                      136239
      *
     C           ESUDA     TAG                             ** ESUDA TAG **
     C           N         SUB  1         LAST    20
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CPRLO - Subroutine to calculate profit/loss                  *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           CPRLO     BEGSR                           *** CPRLO ***
      *
     C                     SETOF                     5556
      *
      **  Check event type
      *
     C           ETYP      LOKUPTABE3                    22
      *
     C           *IN22     IFEQ '0'
     C           ETYP      IFEQ '21I1'
     C           INOI      ANDEQ'I'
     C           ETYP      OREQ '22I1'
     C           INOI      ANDEQ'I'
     C           ETYP      OREQ '23I1'
     C           INOI      ANDEQ'I'
     C           ETYP      OREQ '24I1'
     C           INOI      ANDEQ'I'
     C           ETYP      OREQ '23C3'                                                        CAS008
     C           INOI      ANDEQ'I'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                          BUG9453
     C           CAS008    ANDEQ'Y'                                                          BUG9453
     C           ETYP      OREQ '23S3'                                                        CAS008
     C           INOI      ANDEQ'I'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                          BUG9453
     C           CAS008    ANDEQ'Y'                                                          BUG9453
     C           ETYP      OREQ '23C4'                                                        CAS008
     C           INOI      ANDEQ'I'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                          BUG9453
     C           CAS008    ANDEQ'Y'                                                          BUG9453
     C           ETYP      OREQ '23S4'                                                        CAS008
     C           INOI      ANDEQ'I'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                          BUG9453
     C           CAS008    ANDEQ'Y'                                                          BUG9453
     C                     MOVE '1'       *IN,22
     C                     END
     C                     END
      *
      **  *IN22 If ON (1), indicates event amount is incoming.
      **  *IN33 If ON (1), Indicates event amount is negative.
      **  Report requires '+' to show incoming and '-' for outgoing.
      **  Given the above, event amount sign & effect should be -
      **  Incoming positive, sign '+', Incoming.
      **  Incoming negative, sign '-', Outgoing.
      **  Outgoing positive, sign '-', Outgoing.
      **  Outgoing negative, sign '+', Incoming.
      *
     C                     MOVE '+'       EAMSGN  1
      *
     C           *IN,22    IFEQ '1'                        Incoming &
     C           *IN,33    ANDEQ'1'                        Negative
      *
     C           *IN,22    OREQ '0'                        Outgoing &
     C           *IN,33    ANDEQ'0'                        Positive
      *
     C                     MOVE '-'       EAMSGN
     C                     END
      *
      **  Calculate profit/loss using positive values.
      *
     C           *IN,33    IFEQ '1'
     C                     Z-SUBREVA      REVA
     C                     Z-SUBREVAS     REVAS
     C                     Z-SUBDBCE      DBCE
     C                     END
      *
      ** Instead of using BNNPVM which will never change through out                          219337
      ** the whole processing, use WNPVM (set before each call to CPRLO                       219337
      ** to calculate profit/loss for method 'N', 'F' and 'B'). Profit                        219337
      ** and Loss for method 'D' has its own calculation subroutine (SRREVD)                  219337
      ** and should never be recalculated in this subroutine.                                 219337
      *                                                                                       219337
     C                     SELEC                                                              217120
     C********** BNNPVM    WHEQ 'N'                                                    217120 219337
     C********** BNNPVM    OREQ ' '                                                    217120 219337
     C           WNPVM     WHEQ 'N'                                                           219337
     C           WNPVM     OREQ ' '                                                           219337
     C           EAMSGN    IFEQ '+'
     C           REVA      SUB  DBCE      PLAM   130 2351
     C                     ELSE
     C           DBCE      SUB  REVA      PLAM       2351
     C                     END
      *                                                                                       217120
     C********** BNNPVM    WHEQ 'D'                                                    217120 219337
     C********** EAMSGN    IFEQ '+'                                                    217120 219337
     C********** REVA      SUB  DBCE      PLAMD      2351                              217120 219337
     C**********           ELSE                                                        217120 219337
     C********** DBCE      SUB  REVA      PLAMD      2351                              217120 219337
     C**********           ENDIF                                                       217120 219337
      *                                                                                       217120
     C********** BNNPVM    WHEQ 'F'                                                    217120 219337
     C           WNPVM     WHEQ 'F'                                                           219337
     C           EAMSGN    IFEQ '+'                                                           217120
     C           REVA      SUB  DBCE      PLAMF  130 2351                                     217120
     C                     ELSE                                                               217120
     C           DBCE      SUB  REVA      PLAMF      2351                                     217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C********** BNNPVM    WHEQ 'B'                                                    217120 219337
     C           WNPVM     WHEQ 'B'                                                           219337
     C           EAMSGN    IFEQ '+'                                                           217120
     C           REVA      SUB  DBCE      PLAMB  130 2351                                     217120
     C                     ELSE                                                               217120
     C           DBCE      SUB  REVA      PLAMB      2351                                     217120
     C                     ENDIF                                                              217120
     C                     ENDSL                                                              217120
      *
      **  For option deals select least profit or greatest loss.
      *
     C           *IN47     IFEQ '0'                        Not Bccy
     C           *IN52     ANDEQ'1'                        Option 12V1
     C           *IN47     OREQ '0'                        Not Bccy
     C           *IN53     ANDEQ'1'                        Option 12V2
     C           EAMSGN    IFEQ '+'
     C           REVA      SUB  DBCE      PLAMO  130
     C           REVAS     SUB  DBCE      PLAMS  130
     C                     ELSE
     C           DBCE      SUB  REVA      PLAMO
     C           DBCE      SUB  REVAS     PLAMS
     C                     END
     C/COPY WNCPYSRC,DL0411C020                                           S01408
      *
     C           PLAMS     COMP PLAMO                565555
     C/COPY WNCPYSRC,DL0411C021                                           S01408
     C********** BNNPVM    IFEQ 'N'                                                    217120 219337
     C********** BNNPVM    OREQ ' '                                                    217120 219337
     C           WNPVM     IFEQ 'N'                                                           219337
     C           WNPVM     OREQ ' '                                                           219337
     C   55                Z-ADDPLAMS     PLAM       2351
     C   56                Z-ADDPLAMO     PLAM       2351
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           *IN55     IFEQ *ON                                                           217120
     C                     SELEC                                                              217120
     C********** BNNPVM    WHEQ 'D'                                                    217120 219337
     C**********           Z-ADDPLAMS     PLAMD      2351                              217120 219337
     C********** BNNPVM    WHEQ 'F'                                                    217120 219337
     C           WNPVM     WHEQ 'F'                                                           219337
     C                     Z-ADDPLAMS     PLAMF      2351                                     217120
     C********** BNNPVM    WHEQ 'B'                                                    217120 219337
     C           WNPVM     WHEQ 'B'                                                           219337
     C                     Z-ADDPLAMS     PLAMB      2351                                     217120
     C                     ENDSL                                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           *IN56     IFEQ *ON                                                           217120
     C                     SELEC                                                              217120
     C********** BNNPVM    WHEQ 'D'                                                    217120 219337
     C**********           Z-ADDPLAMO     PLAMD      2351                              217120 219337
     C********** BNNPVM    WHEQ 'F'                                                    217120 219337
     C           WNPVM     WHEQ 'F'                                                           219337
     C                     Z-ADDPLAMO     PLAMF      2351                                     217120
     C********** BNNPVM    WHEQ 'B'                                                    217120 219337
     C           WNPVM     WHEQ 'B'                                                           219337
     C                     Z-ADDPLAMO     PLAMB      2351                                     217120
     C                     ENDSL                                                              217120
     C                     ENDIF                                                              217120
      *
      **  Set profit and loss to zero for options (Purch +Sold)
      **  Event types 12V1 and 12V2 if in base currency.
      *
     C           *IN47     IFEQ '1'                        Base Ccy
     C           *IN52     ANDEQ'1'                        + Opt 12V1
     C           *IN47     OREQ '1'                        or Base Ccy
     C           *IN53     ANDEQ'1'                        + Opt 12V2
     C                     Z-ADD0         PLAM
     C                     Z-ADD*ZEROS    PLAMD                                               217120
     C                     Z-ADD*ZEROS    PLAMF                                               217120
     C                     Z-ADD*ZEROS    PLAMB                                               217120
     C                     SETOF                     2351
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,DL0411C017                                           S01408
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  EXCEPT - Subroutine to perform exception output              *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           EXCEPT    BEGSR                           *** EXCEPT ***
      *                                                                                       CAS005
      ** Process reversals                                                                    CAS005
      *                                                                                       CAS005
     C           WFRUN     IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       WFRUN                                               CAS005
     C                     MOVE *IN45     WIN45   1                                           225302
     C                     MOVE '0'       *IN45                                               225302
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVE *ON       *IN17                                               CAS005
      *                                                                                       CAS005
      ** To avoid field overrides, save values of DLPOSTL0 and then put back                  CAS005
      ** later                                                                                CAS005
      *                                                                                       CAS005
     C                     MOVELWPOSL0    WPOSSV                                              CAS005
      *                                                                                       CAS005
     C           *LOVAL    SETLLDLPOSTL0                                                      CAS005
     C                     READ DLPOSTL0                 16                                   CAS005
     C           *IN16     DOWEQ*OFF                                                          CAS005
      *                                                                                       CAS005
     C********** DRCR      IFEQ 1                                                      CAS005 230217
     C**********           Z-ADD0         DRCR                                         CAS005 230217
     C**********           ELSE                                                        CAS005 230217
     C**********           Z-ADD1         DRCR                                         CAS005 230217
     C**********           ENDIF                                                       CAS005 230217
      *                                                                                       CAS005
     C**********           Z-ADD1         VOIN                                         CAS005 230217
      *                                                                                       CAS005
      ** Prevent printer file exception output.                                               CAS005
      *                                                                                       CAS005
     C                     MOVE *IN37     WIN37   1                                           CAS005
     C                     MOVE *OFF      *IN37                                               CAS005
      *                                                                                       CAS005
     C**********           EXCPT                                                       CAS005 230217
      *                                                                                       CAS005
     C                     MOVE WIN37     *IN37                                               CAS005
      *                                                                                       CAS005
      ** Keep hash total of posting amounts                                                   CAS005
      *                                                                                       CAS005
     C**********           ADD  1         NRBG                                         CAS005 230217
     C********** RBG       ADD  PSTA      RBG                                          CAS005 230217
     C**********           ADD  1         TOTNUM                                       CAS005 230217
      *                                                                                       CAS005
     C**********           Z-ADD2         S                                            CAS005 230217
     C********** PSTA      DIV  1000      ZZAMT                                        CAS005 230217
     C**********           EXSR HASH                                                   CAS005 230217
      *                                                                                       CAS005
      ** Delete records                                                                       CAS005
      *                                                                                       CAS005
     C                     DELETDLPOSTL0                                                      CAS005
      *                                                                                       CAS005
     C                     READ DLPOSTL0                 16                                   CAS005
     C                     ENDDO                                                              CAS005
      *                                                                                       CAS005
     C                     MOVE *OFF      *IN17                                               CAS005
      *                                                                                       CAS005
      ** Put back the values of DLPOSTL0                                                      CAS005
      *                                                                                       CAS005
     C                     MOVELWPOSSV    WPOSL0                                              CAS005
      *
     C                     ENDIF                                                              CAS005
     C                     MOVE WIN45     *IN45                                               225302
     C**********           ENDIF                                                     225302 BUG5336R
     C                     ENDIF                                                              CAS005
      *
      **  VOIN = 1 If reversal of ledger balances (*IN41 or *IN43 ON)
      **  Otherwise, VOIN = 0.
      *
     C           *IN41     IFEQ '1'
     C           *IN43     OREQ '1'
     C                     Z-ADD1         VOIN    10
     C                     ELSE
     C                     Z-ADD0         VOIN
     C                     END
     C/COPY WNCPYSRC,DL0411CCP3                                           S01408
      *
     C           CAS005    IFEQ 'N'                                                           CAS005
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           WFRUN     ANDNE'Y'                                                           CAS005
     C                     MOVE ##ACOD    ACOD                                              BUG5336R
     C                     EXCPT
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Post to PF/DLPOSTPD                                                                  CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           *IN42     ANDEQ*ON                                                           CAS005
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           *IN44     ANDEQ*ON                                                           CAS005
      *                                                                                       CAS005
     C**********           MOVE ACCKY     WDLDS                                      CAS005 BUG5336R
     C                     MOVELACCKY     WDLDS                                             BUG5336R
     C                     MOVE '000001'  WDLDS                                             BUG5336R
      *                                                                             BUG5336 BUG5336R
     C**********           Z-ADDWCNUM     CNUM                                      BUG5336 BUG5336R
     C**********           MOVELWCCY      CCY                                       BUG5336 BUG5336R
     C**********           Z-ADDWACOD     ACOD                                      BUG5336 BUG5336R
     C**********           Z-ADDWACSQ     ACSQ                                      BUG5336 BUG5336R
      *                                                                                      BUG5336
     C                     MOVEABRAR,A    BRCA                                                CAS005
      *                                                                                       CAS005
      ** Account Code                                                                         CAS005
      *                                                                                       CAS005
     C           *IN42     IFEQ *ON                                                           CAS005
     C           *IN08     IFEQ *OFF                                                          CAS005
     C                     MOVE BNFRPL    ACOD                                                CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE BNFRLA    ACOD                                                CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Posting Amount                                                                       CAS005
      *                                                                                       CAS005
     C           *IN08     IFEQ *OFF                                                          CAS005
     C           *IN42     ANDEQ*ON                                                           CAS005
     C           *IN08     OREQ *OFF                                                          CAS005
     C           *IN44     ANDEQ*ON                                                           CAS005
     C                     Z-ADDTBP,A     PSTA                                                CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           *IN08     IFEQ *ON                                                           CAS005
     C           *IN42     ANDEQ*ON                                                           CAS005
     C           *IN08     OREQ *ON                                                           CAS005
     C           *IN44     ANDEQ*ON                                                           CAS005
     C                     Z-ADDTBL,A     PSTA                                                CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Debit/Credit Indicator                                                               CAS005
      *                                                                                       CAS005
     C           *IN42     IFEQ *ON                                                           CAS005
     C           *IN26     ANDEQ*ON                                                           CAS005
     C           *IN44     OREQ *ON                                                           CAS005
     C           *IN26     ANDEQ*OFF                                                          CAS005
     C                     Z-ADD1         DRCR                                                CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADD0         DRCR                                                CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Posting Date                                                                         CAS005
      *                                                                                       CAS005
     C                     Z-ADDBJRDNB    PSTD                                                CAS005
      *                                                                                       CAS005
     C                     MOVE 'P'       RECI                                                CAS005
     C**********           Z-ADDCNUM      CNUM                                         CAS005 CSD027
     C                     MOVE CNUM      CNUM                                                CSD027
     C                     MOVE CCY       CCY                                                 CAS005
      *                                                                                       CAS005
     C**********           Z-ADDACOD      ACOD                                       CAS005 BUG5336R
     C                     MOVE ##ACOD    ACOD                                              BUG5336R
     C                     Z-ADDACSQ      ACSQ                                                CAS005
     C                     Z-ADDBJRDNB    VALD                                                CAS005
     C                     MOVELO#PNAR    PNAR                                                CAS005
      *                                                                                       CAS005
     C**********           Z-ADDASOC      ASOC                                         CAS005 CSD027
     C                     MOVE ASOC      ASOC                                                CSD027
     C                     MOVE 'GE-FR'   SPOS                                                CAS005
     C                     MOVE *OFF      RIND                                                CAS005
     C                     MOVE A5ACTY    ATYP                                                CAS005
     C                     MOVE PRIN      PRIN                                                CAS005
     C                     MOVE 'F'       GETP                                                CAS005
     C                     MOVE RPRFC     PRFC                                                CAS005
     C                     MOVE '235959'  PTIM                                                CAS005
     C                     MOVE VOIN      VOIN                                                CAS005
     C                     MOVE A5ACSC    ACSC                                                CAS005
     C                     MOVE *BLANKS   OTRF                                                CAS005
     C                     MOVE *BLANKS   OTST                                                CAS005
     C                     MOVE *BLANKS   OTTP                                                CAS005
     C                     Z-ADDZERO15    SDCB                                                CAS005
     C                     Z-ADDZERO15    SDLB                                                CAS005
     C                     MOVE *BLANKS   BOKC                                                CAS005
      *                                                                                       CAS005
     C                     WRITEDLPOSTF                                                       CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C           *IN09     ANDEQ*OFF                                                          CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
      *                                                                                       CAS001
      ** Total calculations                                                                   CAS001
      *                                                                                       CAS001
     C           *INL1     WHEQ *ON                                                           CAS001
     C           *INU7     ANDEQ*OFF                                                          CAS001
     C           *IN31     ANDEQ*ON                                                           CAS001
     C           *IN42     ANDEQ*OFF                                                          220201
     C           *IN44     ANDEQ*OFF                                                          220201
     C                     EXSR SRPRD2                                                        CAS001
     C                     EXSR SRPRD3                                                        CAS001
     C                     EXSR SRPRD4                                                        CAS001
      *                                                                                       CAS001
      ** Annual Calculations                                                                  CAS001
      *                                                                                       CAS001
     C           *IN82     WHEQ *ON                                                           CAS001
     C                     EXSR SRPRD2                                                        CAS001
     C                     EXSR SRPRD3                                                        CAS001
      *                                                                                       CAS001
      ** Monthly Calculations                                                                 CAS001
      *                                                                                       CAS001
     C           *IN81     WHEQ *ON                                                           CAS001
     C                     EXSR SRPRD2                                                        CAS001
      *                                                                                       CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     SETOF                     414243
     C                     SETOF                     4445
     C                     MOVE *OFF      *IN08                                               CAS005
     C                     MOVEA'00'      *IN,38
     C                     MOVEA'000'     *IN,57
     C                     MOVEA'000000'  *IN,64
     C                     MOVEA'00'      *IN,77
     C                     MOVEA'00'      *IN,81
     C                     MOVEA'0'       *IN,84
     C                     MOVEA'00'      *IN,86
     C/COPY WNCPYSRC,DL0411C029                                           S01408
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  ACCHN - Subroutine to access account master file             *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           ACCHN     BEGSR                           ** ACCHN ***
      *
     C                     SETOF                     11
     C           ACCKEY    CHAINACCNT                40
     C  N11                Z-ADD0         LDBL           15
     C           *IN40     IFEQ '1'                                                           237364
     C                     MOVELACCKY     CNUM                                                237364
     C                     MOVE ACCKY     @ACCNT 12                                           237364
     C                     MOVEL@ACCNT    ACOD                                                237364
     C                     MOVELBJCYCD    CCY                                                 237364
     C                     MOVE @ACCNT    ACSQ                                                237364
     C                     Z-ADD0         ACODQQ                                              237364
     C                     ENDIF                                                              237364
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  HASH - Subroutine to add ZZAMT to hash totals in arrays INT  *
      *         and DEC.                                              *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  GLZADD                                           *
      *                                                               *
      *****************************************************************
     C           HASH      BEGSR                           *** HASH ***
      *
     C           ZZAMT     COMP 0                      50
     C   50                Z-SUBZZAMT     ZZAMT
     C                     Z-ADDINT,S     ZZTOTI
     C                     Z-ADDDEC,S     ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    INT,S
     C                     Z-ADDZZTOTD    DEC,S
      *
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRPNAR - Subroutine to determine the required narratives.    *
      *                                                               *
      *  Called By:  Main Processing                                  *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     C           SRPNAR    BEGSR                           * S R P N A R *
      *
      **  Define the destination narrative field:
      *
     C                     MOVE *BLANKS   O#PNAR 30
      *
      **  Define the data structure parameter:
      *
     C           *LIKE     DEFN CGPNAR    ##PNAR
      *
      **  Fill the variable narrative field with the existing value:
      *
     C                     MOVELTEXT,1    O#PNAR
      *
      **  If the facility is switched off or unavailable,
      **  or UDC is not installed, exit this subroutine:
      *
     C           DLPNAR    IFNE 'Y'
     C                     GOTO EXPNAR
     C                     ENDIF
      *
      **  Determine the customer's name:
      *
     C                     MOVEL##CNUM    ##KEY     P
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM           ##RTN   7
     C                     PARM '*KEY   ' ##OPT   7
     C                     PARM           ##KEY  10
     C                     PARM           ##STS   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           ##RTN     IFNE *BLANKS
     C                     MOVEL'SDCUSTPD'DBFILE             ************
     C                     Z-ADD13        DBASE              * DBERR 13 *
     C                     MOVEL##OPT     DBOPTN             ************
     C                     MOVEL##KEY     DBKEY
     C                     EXSR *PSSR
     C                     SETON                     U7U8LR
     C                     GOTO END
     C                     ENDIF
      *
      **  Determine the value for the narrative using AOPNARR0:
      *
     C                     CLEARCGPNAR
     C                     CLEAR##PRM1
      *
     C                     MOVE 'DL'      MNMODI
     C                     MOVE BRAR,A    MNBRCA
     C                     MOVE ##CNUM    MNCUST
     C                     MOVE ##CCY     MNCYCD
     C                     MOVE ##ACOD    MNACCD
     C                     MOVE ##ACSQ    MNACSQ
     C                     MOVE BBCRNM    MNCRNM
     C                     MOVELO#PNAR    MNNARR    P
     C                     MOVELASOC      MNASOC    P
     C/COPY WNCPYSRC,DLH00450
      *
     C                     CALL 'AOPNARR0'
     C                     PARM           ##RTN
     C                     PARM           ##MGID  7
     C                     PARM           ##PRM1
     C           CGPNAR    PARM CGPNAR    ##PNAR
     C                     PARM           ##NARR 50
     C/COPY WNCPYSRC,DLH00451
      *
     C           ##RTN     IFNE *BLANKS
     C                     MOVEL'CGPNARPD'DBFILE             ************
     C                     Z-ADD14        DBASE              * DBERR 14 *
     C                     MOVELMNCUST    DBKEY              ************
     C                     EXSR *PSSR
     C                     SETON                     U7U8LR
     C                     GOTO END
     C                     ENDIF
      *
     C                     MOVEL##NARR    O#PNAR    P
      *
     C           EXPNAR    TAG
      *
     C                     ENDSR
      ********************************************************************
     C/EJECT                                                              CEU011
      *****************************************************************   CEU011
      *  SRP001 - This is use to convert the amount from the          *   CEU011
      *           original currency into the Euro equivalent.         *   CEU011
      *                                                               *   CEU011
      *  Call on   : EU0200 - Euro conversion program                 *   CEU011
      *                                                               *   CEU011
      *  Call by   : Main processing                                  *   CEU011
      *                                                               *   CEU011
      *                                                               *   CEU011
      *****************************************************************   CEU011
     C           SRP001    BEGSR                                          CEU011
      *                                                                   CEU011
     C           WBINCY    IFEQ 'Y'                                       CEU011
     C                     CALL 'EU0200'                                  CEU011
     C                     PARM *BLANKS   P@RTCD  7                       CEU011
     C                     PARM           P@FRAM 183                      CEU011
     C                     PARM BJCYCD    P@FRCY  3                       CEU011
     C                     PARM BKEURO    P@TOCY  3                       CEU011
     C                     PARM *ZEROS    P@OUTA 150                      CEU011
     C                     PARM *ZEROS    P@INTA 183                      CEU011
     C                     PARM *ZEROS    P@EXRT 159                      CEU011
     C                     PARM *BLANKS   P@MDIN  1                       CEU011
      *                                                                   CEU011
     C           P@RTCD    IFNE *BLANKS                                   CEU011
     C                     MOVEL'*CALL'   DBFILE                          CEU011
     C                     MOVEL'EU0200'  DBKEY                           CEU011
     C                     Z-ADDWDBASE    DBASE                           CEU011
     C                     GOTO ERROR                                     CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     ELSE                                           CEU011
      *                                                                   CEU011
     C                     Z-ADDP@FRAM    ZAMTCI                          CEU011
     C                     Z-ADDWESPRT    ZEXCH                           CEU011
     C                     MOVELWEMDIN    ZMD                             CEU011
     C                     MOVELBJCYCD    ZCCYI                           CEU011
     C                     MOVELBKEURO    ZCCYO                           CEU011
     C                     Z-ADDBCCDP     ZCDPI                           CEU011
     C                     Z-ADDWENBDP    ZCDPO                           CEU011
      *                                                                   155225
      * Use unique field WUFLAG - for the use in ZCONV sub-routine to     155225
      * establsh if it has been called from DL0410                        155225
     C                     MOVE 'Y'       WUFLAG  1                       155225
      *                                                                   CEU011
     C                     EXSR ZCONV                                     CEU011
      *                                                                   CEU011
     C                     Z-ADDZAMTCO    P@OUTA                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     ENDSR                                          CEU011
      *****************************************************************   CEU011
     C/EJECT                                                              CEU011
      *****************************************************************   CEU011
      *                                                               *   CEU011
      *  SRP002 - Write record to PRTF/DL0411P2                       *   CEU011
      *                                                               *   CEU011
      *  Call on   : SRP003 - Setup printer file fields               *   CEU011
      *                                                               *   CEU011
      *  Call by   : Main processing                                  *   CEU011
      *                                                               *   CEU011
      *                                                               *   CEU011
      *****************************************************************   CEU011
     C           SRP002    BEGSR                                          CEU011
      *                                                                   CEU011
     C           *IN04     IFEQ '0'                                       CEU011
      *                                                                   CEU011
     C**********           OPEN DL0411P2                            CEU011179925
     C           FCHK      IFEQ ' '                                                           188977
     C                     OPEN DL0411P2                                                      188977
     C                     MOVE '1'       FCHK                                                188977
     C                     ENDIF                                                              188977
     C                     MOVE '1'       *IN04                           CEU011
      *                                                                   CEU011
     C                     Z-ADDSFNUM2    ZSNUM2  60                      CEU011
     C                     CALL 'ZSFILE'                                  CEU011
     C                     PARM           SEQ     5                       CEU011
     C                     PARM BRCA      SENTY   3                       CEU011
     C                     PARM           SFILE2                          CEU011
     C                     PARM           ZSNUM2                          CEU011
     C                     PARM *BLANK    ZSERR   1                       CEU011
      *                                                                   CEU011
      **  Error during ZSFILE processing, return to calling program       CEU011
      *                                                                   CEU011
     C           ZSERR     IFEQ 'Y'                                       CEU011
     C                     SETON                     U7U8LR               CEU011
     C                     RETRN                                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C           *IN85     IFEQ '0'                                       CEU011
     C                     MOVELBRCA      RBRCA                           CEU011
     C                     MOVELA8BRNM    RBRNM                           CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     WRITEDL0411D1                                  CEU011
      *                                                                   CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     EXSR SRP003                                    CEU011
      *                                                                   CEU011
     C********** PRTLNE    IFGT 58                               CEU011 AR635480
     C           PRTLNE    IFGE 58                                      AR635480
     C                     WRITEDL0411D1                                  CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     WRITEDL0411D2                                  CEU011
      *                                                                   CEU011
     C                     ENDSR                                          CEU011
      *****************************************************************   CEU011
     C/EJECT                                                              CEU011
      *****************************************************************   CEU011
      *                                                               *   CEU011
      *  SRP003 - Setup printer file fields (Detail records)          *   CEU011
      *                                                               *   CEU011
      *  Call on   : ZSEDIT - Edit amount with decimals and signs     *   CEU011
      *                                                               *   CEU011
      *  Call by   : SRP002 - Write record to PRTF/DL0411P2           *   CEU011
      *                                                               *   CEU011
      *                                                               *   CEU011
      *****************************************************************   CEU011
     C           SRP003    BEGSR                                          CEU011
      *                                                                   CEU011
     C                     MOVELEDATA     RDATA                           CEU011
     C                     MOVELECNUM     RCNUM                           CEU011
     C                     MOVELEDLNO     RDLNO                           CEU011
     C                     MOVELDTYP      RDTYP                           CEU011
     C                     MOVELDLST      RDLST                           CEU011
     C                     MOVELCLAS      RCLAS                           CDL038
     C                     MOVELPREF      RPREF                           CEU011
     C                     MOVELECCY      RCCY                            CEU011
      *                                                                   CEU011
     C                     MOVE *BLANKS   RRATE                           145193
     C           *IN55     IFEQ '0'                                       CEU011
     C                     MOVE RATE      RRATE                           CEU011
     C                     ELSE                                           CEU011
     C                     MOVE RATES     RRATE                           CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     MOVE RRATE     ZFLD15                          CEU011
     C                     Z-ADD8         ZDECS                           CEU011
     C                     MOVE 'L'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVE ZOUT21    RRATE                           CEU011
      *                                                                   CEU011
     C           *IN22     IFEQ '1'                                       CEU011
     C           *IN33     ANDEQ'1'                                       CEU011
     C           *IN22     OREQ '0'                                       CEU011
     C           *IN33     ANDEQ'0'                                       CEU011
     C                     Z-SUBEUDBCE    EUDBCE                          CEU011
     C                     Z-SUBEUREVA    EUREVA                          CEU011
     C                     ENDIF                                          CEU011
      *                                                                   CEU011
     C                     Z-ADDEUDBCE    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    REDBCE                          CEU011
      *                                                                   CEU011
     C                     Z-ADDEUREVA    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    REREVA                          CEU011
      *                                                                   CEU011
     C                     Z-ADDEUPLAM    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    REPLAM                          CEU011
      *                                                                   CEU011
     C                     ENDSR                                          CEU011
      *****************************************************************   CEU011
     C/EJECT                                                              CEU011
      *****************************************************************   CEU011
      *                                                               *   CEU011
      *  SRP004 - Setup printer file fields (Total records)           *   CEU011
      *                                                               *   CEU011
      *  Call on   : ZSEDIT - Edit amount with decimals and signs     *   CEU011
      *                                                               *   CEU011
      *  Call by   : Total Calclulation and Detail Calculation        *   CEU011
      *                                                               *   CEU011
      *                                                               *   CEU011
      *****************************************************************   CEU011
     C           SRP004    BEGSR                                          CEU011
      *                                                                   CEU011
     C                     Z-ADDETDBCE    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    RTDBCE                          CEU011
      *                                                                   CEU011
     C                     Z-ADDETREVA    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    RTREVA                          CEU011
      *                                                                   CEU011
     C                     Z-ADDETPROF    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    RTPROF                          CEU011
      *                                                                   CEU011
     C                     Z-ADDETLOSS    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    RTLOSS                          CEU011
      *                                                                   CEU011
     C                     Z-ADDETOTPL    ZFLD15                          CEU011
     C                     Z-ADDWENBDP    ZDECS                           CEU011
     C                     MOVEL'J'       ZECODE                          CEU011
     C                     EXSR ZSEDIT                                    CEU011
     C                     MOVELZOUT21    RTOTPL                          CEU011
     C                     ENDSR                                          CEU011
      *                                                                   CEU011
      *****************************************************************   CEU011
      /EJECT                                                              CEU011
      *****************************************************************
      *                                                               *
      *  GLZADD - Subroutine to add an amount (ZZAMT) to the total    *
      *           (ZZTOTI,ZZTOTD).  Indicator 99 is set by an         *
      *           overflow error                                      *
      *                                                               *
      *  Called By:  HASH                                             *
      *                                                               *
      *  Calls    :  GLZSUM                                           *
      *                                                               *
      *****************************************************************
     CSR         GLZADD    BEGSR                           *** GLZADD ****
      *
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
      *
      * SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
      * BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
      *
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  GLSUM - Subroutine to carry out the addition for subroutines *
      *          GLZADD, GLZSUB, GLZCMP.                              *
      *          Parameters passed -                                  *
      *              I/P ZZAMTI ZZAMTD                                *
      *              O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.          *
      *                                                               *
      *  Called By:  GLZADD                                           *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
      *
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
      *
      *    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
      *
      *    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
      *
      *    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
      *    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
      *
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
      *
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      * IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
      *
      * IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
      *
      * THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
      * IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
      *
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
      *
      * IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
      *
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
      * BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
      *
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
      *
      * IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
      *
      * IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      * IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      * REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
      *
      **   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
      *
      **   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR - Subroutine to handle abnormal error conditions       *
      *                                                               *
      *  Called By:  Main Processing, SRPNAR,                         *
      *                                                               *
      *  Calls    :  None                                             *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     C/COPY WNCPYSRC,DL0411C004                                           S01408
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRREVF - Revaluation Calculation NPV Method "F"              *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: SRCREV  SRDFC  CPRLO  SRWNPV                          *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRREVF    BEGSR                                                              CAS001
      *                                                                                       217120
      ** Determine diff of currency decimal place between event                               217120
      ** currency and base currency                                                           217120
      *                                                                                       217120
     C           A6NBDP    SUB  BCCDP     K                                                   217120
     C           K         ADD  4         K                                                   217120
      *                                                                                       217120
      ** Convert event currency to base currency                                              217120
      *                                                                                       217120
     C                     Z-ADDA6SPRT    WKRATE                                              217120
     C                     EXSR SRCREV                                                        217120
     C                     Z-ADDWNREV     BASAMT 309                                          217120
      *                                                                                       CAS001
      ** Retrieve yield curve from master file and set up parameter                           CAS001
      ** for ZADSFCAL                                                                         CAS001
      *                                                                                       CAS001
     C                     Z-ADD1         WDSCF                                               CAS004
     C                     MOVEL*BLANKS   PNPYLD                                              CAS004
      *                                                                                       CAS004
     C           *IN12     IFEQ *ON                                                           CAS001
     C**********           Z-ADD1         WDSCF                                        CAS001 CAS004
     C**********           MOVEL*BLANKS   PNPYLD                                       CAS001 CAS004
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C           EDLNO     CHAINDLDLDBL1             13                                       CAS001
      *                                                                                       CAS001
     C           *IN13     IFEQ *OFF                                                          CAS001
      **********                                                                       CAS001 CAS004
      ***If*deal*is*an*internal*contract*and*event*"V1"*or*"V2"************            CAS001 CAS004
      ***use*linked*deal*yield*curve*from*master*file**********************            CAS001 CAS004
      **********                                                                       CAS001 CAS004
     C********** DTYP      IFEQ 'PS'                                                   CAS001 CAS004
     C**********           MOVE ETYP      WETYP   2                                    CAS001 CAS004
     C********** WETYP     IFEQ 'V1'                                                   CAS001 CAS004
     C********** WETYP     OREQ 'V2'                                                   CAS001 CAS004
      **********                                                                       CAS001 CAS004
     C**********           Z-ADDLNKDN     WLNKDN  60                                   CAS001 CAS004
      **********                                                                       CAS001 CAS004
      ***Retrieve*incoming*outgoing*indicator*of*link*deal*****************            CAS001 CAS004
      **********                                                                       CAS001 CAS004
     C**********           MOVELINOI      WINOI   1                                    CAS001 CAS004
     C********** WLNKDN    SETLLDLEVNPL2                                               CAS001 CAS004
     C********** WLNKDN    READEDLEVNPL2                 13                            CAS001 CAS004
     C********** *IN13     DOWEQ*OFF                                                   CAS001 CAS004
     C********** EDAT      ANDLEEDAT2                                                  CAS001 CAS004
     C**********           MOVE ETYP2     WETYP2  2                                    CAS001 CAS004
     C********** WETYP     IFEQ WETYP2                                                 CAS001 CAS004
     C**********           MOVELINOI2     INOI                                         CAS001 CAS004
     C**********           LEAVE                                                       CAS001 CAS004
     C**********           ENDIF                                                       CAS001 CAS004
     C********** WLNKDN    READEDLEVNPL2                 13                            CAS001 CAS004
     C**********           ENDDO                                                       CAS001 CAS004
      **********                                                                       CAS001 CAS004
     C**********           ENDIF                                                       CAS001 CAS004
     C**********           ENDIF                                                       CAS001 CAS004
      *                                                                                       CAS001
     C           INOI      IFEQ 'I'                                                           CAS001
     C                     MOVELFSOYLC    PNPYLD                                              CAS001
     C                     ELSE                                                               CAS001
     C                     MOVELFSTYLC    PNPYLD                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS004
      ** If deal is an internal contract, use Yield Curve of the                              CAS004
      ** linked deal number from DEALSDC.                                                     CAS004
      *                                                                                       CAS004
     C           DTYP      IFEQ 'PS'                                                          CAS004
     C           LNKDN     ANDNE0                                                             CAS004
      *                                                                                       CAS004
     C           LNKDN     CHAINDLDLDCL1             13                                       CAS004
     C           *IN13     IFEQ *OFF                                                          CAS004
     C                     MOVELWCOYLC    PNPYLD                                              CAS004
     C*********************ELSE                                                        CAS004 CDL038
     C*********************MOVEL'DEALSDC 'DBFILE                                       CAS004 CDL038
     C*********************MOVEL'16'      DBASE                                        CAS004 CDL038
     C*********************MOVELLNKDN     DBKEY                                        CAS004 CDL038
     C*********************GOTO ERROR                                                  CAS004 CDL038
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
     C           PNPYLD    IFNE *BLANKS                                                       CAS001
      *                                                                                       CAS001
     C**********           MOVELWINOI     INOI                                         CAS001 CAS004
     C                     MOVELECCY      PNPCCY                                              CAS001
     C                     MOVELA6DICB    PNPINC                                              CAS001
      *                                                                                       CAS001
      ** If deal is an option deal use other date as a value date                             CAS001
      *                                                                                       CAS001
     C           ETYP      IFEQ '12V1'                                                        CAS001
     C           ETYP      OREQ '12V2'                                                        CAS001
     C                     Z-ADDOTHD      PNPFDT                                              CAS001
      *                                                                                       CAS001
     C                     EXSR SRDFC                                                         CAS001
      *                                                                                       CAS001
      ** Calculate revalued amount                                                            CAS001
      *                                                                                       CAS001
     C                     Z-ADDPNPDF     WDSCFS 139                                          CAS001
     C********** EAMT      MULT WDSCFS    WRKAMT 150H                                  CAS001 217120
     C           BASAMT    MULT WDSCFS    REVAS     H                                         217120
     C/COPY WNCPYSRC,DL0411C096
      *****************************************************************                CAS001 217120
      ***Determine*diff*of*currency*decimal*place*between*event********                CAS001 217120
      ***currency*and*base*currency************************************                CAS001 217120
      *****************************************************************                CAS001 217120
     C********** A6NBDP    SUB  BCCDP     K                                            CAS001 217120
     C********** K         ADD  4         K                                            CAS001 217120
      *****************************************************************                CAS001 217120
      ***Convert*revalued*equivalent*to*base*ccy***********************                CAS001 217120
      *****************************************************************                CAS001 217120
     C**********           Z-ADDA6SPRT    WKRATE                                       CAS001 217120
     C**********           EXSR SRCREV                                                 CAS001 217120
     C**********           Z-ADDWNREV     REVAS                                        CAS001 217120
      *                                                                                       CAS001
      ** End if ETYPE = "12V1" or "12V2"                                                      CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Revalue deal with value date                                                         CAS001
      *                                                                                       CAS001
     C                     Z-ADDEDAT      PNPFDT                                              CAS001
      *                                                                                       CAS001
     C                     EXSR SRDFC                                                         CAS001
      *                                                                                       CAS001
     C                     Z-ADDPNPDF     WDSCF  139                                          CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** For CAS008 changes, get the forward commitment yield curves                          CAS008
      ** from DLDLDGLE for cross currency principal exchanges.                                CAS008
      *                                                                                       CAS008
     C           CIR003    IFEQ 'Y'                                                           CAS008
     C           CAS008    ANDEQ'Y'                                                           CAS008
      *                                                                                       CAS008
     C           ETYP      IFEQ '23C3'                                                        CAS008
     C           ETYP      OREQ '23S3'                                                        CAS008
     C           ETYP      OREQ '23C4'                                                        CAS008
     C           ETYP      OREQ '23S4'                                                        CAS008
      *                                                                                       CAS008
     C           EDLNO     CHAINDLDLDGLE             34                                       CAS008
     C           *IN34     IFEQ *OFF                                                          CAS008
      *                                                                                       CAS008
      ** If deal found, process accordingly.                                                  CAS008
      *                                                                                       CAS008
     C           INOI      IFEQ 'I'                                                           CAS008
     C                     MOVELFSOFCC    PNPYLD                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVELFSTFCC    PNPYLD                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     MOVELECCY      PNPCCY                                              CAS008
     C                     MOVELA6DICB    PNPINC                                              CAS008
     C                     MOVELEDAT      PNPFDT                                              CAS008
      *                                                                                       CAS008
     C                     EXSR SRDFC                                                         CAS008
      *                                                                                       CAS008
     C                     Z-ADDPNPDF     WDSCF                                               CAS008
      *                                                                                       CAS008
      ** Deal number not found in Deals File                                                  CAS008
      *                                                                                       CAS008
     C                     ELSE                                                               CAS008
     C                     MOVEL'DEALSDG' DBFILE                                              CAS008
     C                     Z-ADD22        DBASE                                               CAS008
     C                     MOVELEDLNO     DBKEY                                               CAS008
     C                     GOTO ERROR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C********** EAMT      MULT WDSCF     WRKAMT    H                                  CAS001 217120
     C/COPY WNCPYSRC,DL0411C097
      *****************************************************************                CAS001 217120
      ***Determine*diff*of*currency*decimal*place*between*event********                CAS001 217120
      ***currency*and*base*currency************************************                CAS001 217120
      *****************************************************************                CAS001 217120
     C********** A6NBDP    SUB  BCCDP     K                                            CAS001 217120
     C********** K         ADD  4         K                                            CAS001 217120
      *****************************************************************                CAS001 217120
      ***Convert*revalued*equivalent*to*base*ccy***********************                CAS001 217120
      *****************************************************************                CAS001 217120
     C**********           Z-ADDA6SPRT    WKRATE                                       CAS001 217120
     C**********           EXSR SRCREV                                                 CAS001 217120
     C**********           Z-ADDWNREV     REVA                                         CAS001 217120
     C                     Z-ADDA6SPRT    RATE                                                217120
     C           BASAMT    MULT WDSCF     REVA      H                                         217120
      *                                                                                       CAS001
      ** Calculate Profit/Loss                                                                CAS001
      ** only if rates are present                                                            225831
      *                                                                                       CAS001
     C           *IN30     IFEQ '0'                                                           225831
     C                     MOVE 'F'       WNPVM                                               219337
     C                     EXSR CPRLO                                                         CAS001
      *                                                                                       225831
     C                     ELSE                                                               225831
     C                     Z-ADD0         PLAMF                                               225831
     C                     ENDIF                                                              225831
      *                                                                                       CAS001
      ** Write Record to PF/DLNPVLPD                                                          CAS001
      *                                                                                       CAS001
     C                     MOVEL'F'       FSNPVM                                              CAS001
     C                     EXSR SRWNPV                                                        CAS001
      *                                                                                       CAS001
      ** Save indicators and fields in array                                                  CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'F'                                                           CAS001
     C                     MOVELDSNPVS    WFLDS                                               CAS001
     C                     MOVEL*IN23     WIN23                                               CAS001
     C                     MOVEL*IN51     WIN51                                               CAS001
     C                     MOVEL*IN55     WIN55                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           ENDSRF    ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRREVB - Revaluation Calculation NPV Method "B"              *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: SRBCDF  SRCREV  CPRLO  SRWNPV                         *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRREVB    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Determine diff of currency decimal place between event                               CAS001
      ** currency and base currency                                                           CAS001
      *                                                                                       CAS001
     C           A6NBDP    SUB  BCCDP     K                                                   CAS001
     C           K         ADD  4         K                                                   CAS001
      *                                                                                       CAS001
      ** Convert event amount to base currency                                                CAS001
      *                                                                                       CAS001
     C**********           Z-ADDEAMT      WRKAMT                                       CAS001 217120
     C                     Z-ADDEAMT      WRKAMT 150H                                         217120
      *                                                                                       CAS001
     C                     Z-ADDRATE      WKRATE                                              CAS001
     C                     EXSR SRCREV                                                        CAS001
     C                     Z-ADDWNREV     REVA                                                CAS001
      *                                                                                       CAS001
     C                     Z-ADDRATES     WKRATE                                              CAS001
     C                     EXSR SRCREV                                                        CAS001
     C                     Z-ADDWNREV     REVAS                                               CAS001
      *                                                                                       CAS001
      ** Calculate revalued amount, if option deal use other date.                            CAS001
      *                                                                                       CAS001
     C                     Z-ADD1         WDSCF                                               CAS004
     C                     MOVEL*BLANKS   PNPYLD                                              CAS004
      *                                                                                       CAS004
     C           *IN12     IFEQ *ON                                                           CAS001
     C**********           Z-ADD1         WDSCF                                        CAS001 CAS004
     C**********           MOVEL*BLANKS   PNPYLD                                       CAS001 CAS004
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C           ETYP      IFEQ '12V1'                                                        CAS001
     C           ETYP      OREQ '12V2'                                                        CAS001
     C                     Z-ADDOTHD      PNPFDT                                              CAS001
      *                                                                                       CAS001
      ** Get Base Currency Discount Factor                                                    CAS001
      *                                                                                       CAS001
     C                     EXSR SRBCDF                                                        CAS001
      *                                                                                       CAS001
     C                     Z-ADDPNPDF     WDSCFS                                              CAS001
      *                                                                                       CAS001
     C           REVAS     MULT WDSCFS    REVAS     H                                         CAS001
     C/COPY WNCPYSRC,DL0411C098
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Get Base Currency Discount Factor                                                    CAS001
      *                                                                                       CAS001
     C                     Z-ADDEDAT      PNPFDT                                              CAS001
     C                     EXSR SRBCDF                                                        CAS001
      *                                                                                       CAS001
     C                     Z-ADDPNPDF     WDSCF                                               CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           REVA      MULT WDSCF     REVA      H                                         CAS001
     C/COPY WNCPYSRC,DL0411C099
      *                                                                                       CAS001
      ** Calculate Profit/Loss                                                                CAS001
      ** only if rates are present                                                            225831
      *                                                                                       CAS001
     C           *IN30     IFEQ '0'                                                           225831
     C                     MOVE 'B'       WNPVM                                               219337
     C                     EXSR CPRLO                                                         CAS001
      *                                                                                       225831
     C                     ELSE                                                               225831
     C                     Z-ADD0         PLAMB                                               225831
     C                     ENDIF                                                              225831
      *                                                                                       CAS001
      ** Write Record to PF/DLNPVLPD                                                          CAS001
      *                                                                                       CAS001
     C                     MOVEL'B'       FSNPVM                                              CAS001
     C                     EXSR SRWNPV                                                        CAS001
      *                                                                                       CAS001
      ** Save fields in array                                                                 CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'B'                                                           CAS001
     C                     MOVELDSNPVS    WFLDS                                               CAS001
     C                     MOVEL*IN23     WIN23                                               CAS001
     C                     MOVEL*IN51     WIN51                                               CAS001
     C                     MOVEL*IN55     WIN55                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           ENDSRB    ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRREVD - Revaluation Calculation NPV Method "D"              *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: SRBCDF  SRWNPV                                        *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRREVD    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Get base currency discount factor                                                    CAS001
      *                                                                                       CAS001
     C                     Z-ADD1         WDSCF                                               CAS004
     C                     MOVE *BLANKS   PNPYLD                                              CAS004
      *                                                                                       CAS004
     C           *IN12     IFEQ *ON                                                           CAS001
     C**********           Z-ADD1         WDSCF                                        CAS001 CAS004
     C**********           MOVE *BLANKS   PNPYLD                                       CAS001 CAS004
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C           ETYP      IFEQ '12V1'                                                        CAS001
     C           ETYP      OREQ '12V2'                                                        CAS001
     C                     Z-ADDOTHD      PNPFDT                                              CAS001
     C                     ELSE                                                               CAS001
     C                     Z-ADDEDAT      PNPFDT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     EXSR SRBCDF                                                        CAS001
      *                                                                                       CAS001
      ** Calculate revalued profit/loss                                                       CAS001
      *                                                                                       CAS001
     C           *IN55     IFEQ *OFF                                                          CAS001
     C                     Z-ADDPNPDF     WDSCF                                               CAS001
     C                     ELSE                                                               CAS001
     C                     Z-ADDPNPDF     WDSCFS                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
     C********** PLAM      MULT PNPDF     PLAM      H                                  CAS001 217120
     C           PLAM      MULT PNPDF     PLAMD  130H                                         217120
     C/COPY WNCPYSRC,DL0411C100
      *                                                                                       CAS001
      ** Write Record to PF/DLNPVLPD                                                          CAS001
      *                                                                                       CAS001
     C                     MOVEL'D'       FSNPVM                                              CAS001
     C                     EXSR SRWNPV                                                        CAS001
      *                                                                                       CAS001
      ** Save fields in array                                                                 CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'D'                                                           CAS001
     C                     MOVELDSNPVS    WFLDS                                               CAS001
     C                     MOVEL*IN23     WIN23                                               CAS001
     C                     MOVEL*IN51     WIN51                                               CAS001
     C                     MOVEL*IN55     WIN55                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           ENDSRD    ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRWNPV - Initialize and Write Records to PF/DLNPVLPD         *                       CAS001
      *           Update master file with Unrealized P/L values.      *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *             SRREVF  SRREVB  SRREVD                            *                       CAS001
      *                                                               *                       CAS001
      *  Calls: None                                                  *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRWNPV    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Move fields to PF/DLNPVLPD                                                           CAS001
      *                                                                                       CAS001
     C                     MOVELBRCA      FSBRCA                                              CAS001
     C                     MOVELPRFC      FSPRFC                                              CAS001
     C                     MOVELECCY      FSCYCD                                              CAS001
     C                     MOVELBOKC      FSBKCD                                              CAS001
     C                     Z-ADDEDAT      FSVDAT                                              CAS001
     C                     MOVELECNUM     FSCNUM                                              CAS001
     C                     MOVELDTYP      FSDTYP                                              CAS001
     C                     MOVELDLST      FSDLST                                              CAS001
     C                     MOVELCLAS      FSCLAS                                              CDL038
     C                     MOVELPNPYLD    FSYLDC                                              CAS001
     C                     Z-ADDA6SPRT    FSSPOT                                              CAS001
      *                                                                                       CAS001
     C           *IN12     IFEQ '1'                                                           CAS001
     C                     Z-ADD0         EDLNO                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVEL*BLANKS   PREF                                                CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVELPREF      FSPREF                                              CAS001
     C                     Z-ADDEDLNO     FSDLNO                                              CAS001
      *                                                                                       CAS001
      ** Use the other date values if *IN55 is 'ON'                                           CAS001
      *                                                                                       CAS001
     C           *IN55     IFEQ '0'                                                           CAS001
     C                     Z-ADDRATE      FSMRAT                                              CAS001
     C                     Z-ADDREVA      FSREVA                                              CAS001
     C                     Z-ADDWDSCF     FSDSCF                                              CAS001
     C                     ELSE                                                               CAS001
     C                     Z-ADDRATES     FSMRAT                                              CAS001
     C                     Z-ADDREVAS     FSREVA                                              CAS001
     C                     Z-ADDWDSCFS    FSDSCF                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Check sign of event amount if '+'                                                    CAS001
      *                                                                                       CAS001
     C           EAMSGN    IFEQ '-'                                                           CAS001
     C           EAMT      IFGT 0                                                             CAS001
     C           EAMT      MULT -1        FSDAMT                                              CAS001
     C                     ELSE                                                               CAS001
     C                     Z-ADDEAMT      FSDAMT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Event amount is '-'                                                                  CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
     C           EAMT      IFGE 0                                                             CAS001
     C                     Z-ADDEAMT      FSDAMT                                              CAS001
     C                     ELSE                                                               CAS001
     C           EAMT      MULT -1        FSDAMT                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     Z-ADDDBCE      FSEAMT                                              CAS001
     C           FSEAMT    IFGT 0                                                             CAS001
     C           FSEAMT    MULT -1        FSEAMT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           *IN22     IFEQ *ON                                                           CAS001
     C           *IN33     ANDEQ*OFF                                                          CAS001
     C           FSEAMT    MULT -1        FSEAMT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           FSREVA    IFGT 0                                                             CAS001
     C           FSREVA    MULT -1        FSREVA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           *IN22     IFEQ *ON                                                           CAS001
     C           *IN33     ANDEQ*OFF                                                          CAS001
     C           FSREVA    MULT -1        FSREVA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     Z-ADDPLAM      FSPRLA                                              CAS001
      *                                                                                       217120
     C           FSNPVM    IFEQ 'D'                                                           217120
     C                     Z-ADDPLAMD     FSPRLA                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           FSNPVM    IFEQ 'B'                                                           217120
     C                     Z-ADDPLAMB     FSPRLA                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           FSNPVM    IFEQ 'F'                                                           217120
     C                     Z-ADDPLAMF     FSPRLA                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           *IN51     IFEQ *ON                                                           CAS001
     C           FSPRLA    ANDGT0                                                             CAS001
     C                     MULT -1        FSPRLA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           *IN23     IFEQ *ON                                                           CAS001
     C           FSPRLA    ANDLT0                                                             CAS001
     C                     MULT -1        FSPRLA                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Initialize UNRL P/L as of Yearend to zero.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD*ZERO     FSYUPL                                              CAS001
      *                                                                                       CAS004
      ** Update DEALSDB file with the unrealized P/L of the posting method                    CAS004
      *                                                                                       CAS004
     C           BNNPVM    IFEQ FSNPVM                                                        CAS004
     C           BNNPVM    ANDNE' '                                                           CAS004
     C           BNNPVM    OREQ ' '                                                           CAS004
     C           FSNPVM    ANDEQ'N'                                                           CAS004
      *                                                                                       CAS001
      ** If the transaction is NOT a FT payment:                                              CAS001
      *                                                                                       CAS001
     C           *IN12     IFEQ '0'                                                           CAS001
      *                                                                                       CAS001
      ** Update Deals File by outputting:                                                     CAS001
      ** 1. the value of previous unrealized P/L to both the                                  CAS001
      **    Unrealized P/L Today's Posting Amt & UNRL P/L Posted to Date.                     CAS001
      ** 2. the Revaluation Amount as the new Unrealized P/L Amount.                          CAS001
      *                                                                                       CAS001
     C           EDLNO     CHAINDLDLDBL1             13                                       CAS001
     C           *IN13     IFEQ *OFF                                                          CAS001
      *                                                                                       CAS001
     C           ETYP      IFEQ '20V1'                                                        CAS004
     C           ETYP      OREQ '20V2'                                                        CAS004
     C           ETYP      OREQ '11V1'                                                        CAS004
     C           ETYP      OREQ '11V2'                                                        CAS004
     C                     Z-ADD0         WPREV  150                                          CAS001
     C                     Z-ADDFSURPL    WPREV                                               CAS001
      *                                                                                       CAS004
     C           ECCY      IFNE BJCYCD                                                        CAS004
     C                     EXSR SRCONV                                                        CAS004
     C**********           Z-ADDZAMTCO    FSPRLA                                       CAS004 217120
     C                     Z-ADDZAMTCO    WKPRLA 130                                          217120
     C                     ELSE                                                               244711
     C                     Z-ADDFSPRLA    WKPRLA                                              244711
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           ECCY      IFEQ PUCY                                                          CAS004
     C**********           Z-ADDFSREVA    FSURPL                                       CAS001 CAS004
     C**********           Z-ADDFSPRLA    FSURPL                                       CAS004 217120
     C                     Z-ADDWKPRLA    FSURPL                                              217120
     C                     ELSE                                                               CAS004
     C**********           Z-ADDFSPRLA    FSSUPL                                       CAS004 217120
     C                     Z-ADDWKPRLA    FSSUPL                                              217120
     C                     ENDIF                                                              CAS004
     C                     Z-ADDWPREV     FSTUPL                                              CAS001
     C                     Z-ADDWPREV     FSPUPL                                              CAS001
      *                                                                                       CAS001
     C                     UPDATDEALSBBF                                                      CAS001
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
      ** For FX, output UNRL P/L as of Yearend to DLNPVLPD                                    CAS001
      *                                                                                       CAS001
     C           ECCY      IFEQ PUCY                                                          CAS004
     C                     Z-ADDWMYUPL    FSYUPL                                              CAS001
     C                     ELSE                                                               CAS004
     C                     Z-ADDFSSYPL    FSYUPL                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS001
     C                     WRITEDLNPVLD0                                                      CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRBCDF - Get Base Currency Discount Factor                   *                       CAS001
      *                                                               *                       CAS001
      *  Called by: SRREVB  SRREVD                                    *                       CAS001
      *                                                               *                       CAS001
      *  CALLS: SRDFC                                                 *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRBCDF    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** If NPV method is not "B" or "D", base currency yield curve is                        CAS001
      ** conditional and can be blank, as such discount factor is equal                       CAS001
      ** to 1.                                                                                CAS001
      *                                                                                       CAS001
     C           BNNPVM    IFEQ 'F'                                                           CAS001
     C           BNNPVM    OREQ 'N'                                                           CAS001
     C           BNNPVM    OREQ ' '                                                           CAS001
      *                                                                                       CAS001
     C           BNBCYC    IFEQ *BLANKS                                                       CAS001
     C                     Z-ADD1         PNPDF                                               CAS001
     C                     MOVELBNBCYC    PNPYLD                                              CAS001
     C                     MOVEL*BLANKS   PNPRTC                                              CAS001
     C                     GOTO ENDBDF                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     MOVELBNBCYC    PNPYLD                                              CAS001
     C                     MOVELBJCYCD    PNPCCY                                              CAS001
     C                     MOVELWBCICB    PNPINC                                              CAS001
      *                                                                                       CAS001
     C                     EXSR SRDFC                                                         CAS001
      *                                                                                       CAS001
     C           ENDBDF    ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRCREV - Calculate Revalued Amount for Method "F","B" & "D"  *                       CAS001
      *                                                               *                       CAS001
      *  Called by: SRREVF  SRREVB                                    *                       CAS001
      *                                                               *                       CAS001
      *  Calls: NONE                                                  *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRCREV    BEGSR                                                              CAS001
      *                                                                                       CAS001
     C           K         IFEQ 0                                                             CAS004
     C                     Z-ADD4         K                                                   CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           A6MDIN    IFEQ 'D'                                                           CAS001
      *                                                                                       CAS001
     C           K         IFNE 1                                                             CAS001
     C           K         ANDNE2                                                             CAS001
     C           WKRATE    MULT POWER,K   WK159                                               CAS001
     C           WRKAMT    DIV  WK159     WNREV  309                                          CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           K         IFEQ 1                                                             CAS001
     C           WKRATE    MULT 100       RATE1                                               CAS001
     C           RATE1     MULT POWER,K   WK129                                               CAS001
     C           WRKAMT    DIV  WK129     WK309  309                                          CAS001
     C           WK309     MULT 100       WNREV                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           K         IFEQ 2                                                             CAS001
     C           WKRATE    MULT 10        RATE2                                               CAS001
     C           RATE2     MULT POWER,K   WK129                                               CAS001
     C           WRKAMT    DIV  WK129     WK309                                               CAS001
     C           WK309     MULT 10        WNREV                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C           K         IFNE 6                                                             CAS001
     C           K         ANDNE7                                                             CAS001
     C           WKRATE    DIV  POWER,K   WK159                                               CAS001
     C           WRKAMT    MULT WK159     WNREV                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           K         IFEQ 7                                                             CAS001
     C           WKRATE    MULT 100       RATE1                                               CAS001
     C           RATE1     DIV  POWER,K   WK129                                               CAS001
     C           WRKAMT    MULT WK129     WNREV                                               CAS001
     C           WNREV     DIV  100       WNREV                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           K         IFEQ 6                                                             CAS001
     C           WKRATE    MULT 10        RATE2                                               CAS001
     C           RATE2     DIV  POWER,K   WK129                                               CAS001
     C           WRKAMT    MULT WK129     WNREV                                               CAS001
     C           WNREV     DIV  10        WNREV                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRH1 - Print Header Details                                *                       CAS001
      *                                                               *                       CAS001
      *  Called by: EXCEPT  SRCHKL                                    *                       CAS001
      *                                                               *                       CAS001
      *  Calls: None                                                  *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRH1    BEGSR                                                              CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C           WP3CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P3                                                      CAS001
     C                     MOVELSFNUM3    ZSNUM   60                                          CAS001
     C                     MOVELSFILE3    ZFILE  10                                           CAS001
     C                     EXSR SRRCF                                                         CAS001
     C                     MOVEL'Y'       WP3CHK  1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C           WP4CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P4                                                      CAS001
     C                     MOVELSFNUM4    ZSNUM                                               CAS001
     C                     MOVELSFILE4    ZFILE                                               CAS001
     C                     EXSR SRRCF                                                         CAS001
     C                     MOVEL'Y'       WP4CHK  1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C           WP5CHK    IFEQ ' '                                                           CAS001
     C                     OPEN DL0411P5                                                      CAS001
     C                     MOVELSFNUM5    ZSNUM                                               CAS001
     C                     MOVELSFILE5    ZFILE                                               CAS001
     C                     EXSR SRRCF                                                         CAS001
     C                     MOVEL'Y'       WP5CHK  1                                           CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     MOVELBRCA      RBRCA                                               CAS001
     C                     MOVELA8BRNM    RBRNM                                               CAS001
      *                                                                                       CAS001
     C           WNREC     IFEQ 'Y'                                                           CAS001
      *                                                                                       CAS001
     C                     MOVELDSPCCD    RPCCD                                               CAS001
     C                     MOVELDSPCDS    RPCDS                                               CAS001
     C                     MOVELECCY      RECCY                                               CAS001
     C                     MOVELBOKC      RBOKC                                               CAS001
     C                     MOVELBDBKD     RDBKD                                               CAS001
      *                                                                                       CAS001
     C           *IN32     IFEQ *ON                                                           CAS001
     C                     MOVELDTYP      RDTYP1                                              CAS001
     C                     MOVELDTPNAR    RDTNAR                                              CAS001
     C                     MOVELDLST      RDLST1                                              CAS001
     C                     MOVELCLAS      RCLAS1                                              CDL038
     C                     MOVELDSTCNR    RDSNAR                                              CDL038
     C*********************MOVELASDSTN    RDSNAR                                       CAS001 CDL038
     C                     ELSE                                                               CAS001
     C                     MOVE *BLANKS   RDTYP1                                              CAS001
     C                     MOVE *BLANKS   RDTNAR                                              CAS001
     C                     MOVE *BLANKS   RDLST1                                              CAS001
     C                     MOVE *BLANKS   RCLAS1                                              CDL038
     C                     MOVE *BLANKS   RDSNAR                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITEHEADP3H1                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITEHEADP4H1                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITEHEADP5H1                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRD1 - Print Detail Record format 1                        *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: ZSEDIT  SRCHKL                                        *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRD1    BEGSR                                                              CAS001
      *                                                                                       CAS001
     C           WDSCH     IFEQ 'Y'                                                           CAS001
     C           WBKCH     OREQ 'Y'                                                           CAS001
     C           WCYCH     OREQ 'Y'                                                           CAS001
     C           WPCCH     OREQ 'Y'                                                           CAS001
     C                     MOVE 'Y'       WNREC                                               CAS001
     C                     EXSR SRPRH1                                                        CAS001
     C                     MOVE 'N'       WDSCH                                               CAS001
     C                     MOVE 'N'       WBKCH                                               CAS001
     C                     MOVE 'N'       WCYCH                                               CAS001
     C                     MOVE 'N'       WPCCH                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           WDSCH     IFEQ 'Y'                                                           CAS001
     C                     EXSR SRPRH1                                                        CAS001
     C                     MOVE 'N'       WDSCH                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Value Date                                                                           CAS001
      *                                                                                       CAS001
     C                     MOVELEDATA     RVDAT                                               CAS001
      *                                                                                       CAS001
      ** Customer Number                                                                      CAS001
      *                                                                                       CAS001
     C                     MOVELECNUM     RCUST                                               CAS001
      *                                                                                       CAS001
      ** Deal Number / Payment Reference                                                      CAS001
      *                                                                                       CAS001
     C           *IN02     IFEQ *ON                                                           CAS001
     C                     MOVELEDLNO     RDEAL                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVELPREF      RDEAL                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Deal Type / Subtype                                                                  CAS001
      *                                                                                       CAS001
     C           *IN32     IFEQ *OFF                                                          CAS001
     C                     MOVELDTYP      RDTYP2                                              CAS001
     C                     MOVELDLST      RDLST2                                              CAS001
     C                     MOVELCLAS      RCLAS2                                              CDL038
     C                     ELSE                                                               CAS001
     C                     MOVE *BLANKS   RDTYP2                                              CAS001
     C                     MOVE *BLANKS   RDLST2                                              CAS001
     C                     MOVE *BLANKS   RCLAS2                                              CDL038
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Event Amount                                                                         CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDEAMT      ZFLD15                                              CAS001
     C           EAMSGN    IFEQ '-'                                                           CAS001
     C           EAMT      IFGT 0                                                             CAS001
     C           EAMT      MULT -1        ZFLD15                                              CAS001
     C                     ELSE                                                               CAS001
     C                     Z-ADDEAMT      ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ELSE                                                               CAS001
     C           EAMT      IFGE 0                                                             CAS001
     C                     Z-ADDEAMT      ZFLD15                                              CAS001
     C                     ELSE                                                               CAS001
     C           EAMT      MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
     C                     Z-ADDWECDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    REAMT                                               CAS001
      *                                                                                       CAS001
      ** Dealt Equivalent                                                                     CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDDBCE      ZFLD15                                              CAS001
     C           DBCE      IFGT 0                                                             CAS001
     C           DBCE      MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C           *IN22     IFEQ *ON                                                           CAS001
     C           *IN33     ANDEQ*OFF                                                          CAS001
     C********** DBCE      MULT -1        ZFLD15                                       CAS001 219336
     C           ZFLD15    MULT -1        ZFLD15                                              219336
     C                     ENDIF                                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RDBCE                                               CAS001
      *                                                                                       CAS001
      ** Yield Curve                                                                          CAS001
      *                                                                                       CAS001
     C                     MOVELFSYLDC    RYLDC                                               CAS001
      *                                                                                       CAS001
      ** Mid-Rate                                                                             CAS001
      *                                                                                       CAS001
     C           *IN55     IFEQ *ON                                                           CAS001
     C                     MOVE RATES     RMRAT                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE RATE      RMRAT                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Discount Factor                                                                      CAS001
      *                                                                                       CAS001
     C           *IN55     IFEQ *ON                                                           CAS001
     C                     MOVE WDSCFS    RDSCF                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE WDSCF     RDSCF                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Revalued Equivalent                                                                  CAS001
      *                                                                                       CAS001
     C           *IN55     IFEQ *ON                                                           CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDREVAS     ZFLD15                                              CAS001
     C           REVAS     IFGT 0                                                             CAS001
     C           REVAS     MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C           *IN22     IFEQ *ON                                                           CAS001
     C           *IN33     ANDEQ*OFF                                                          CAS001
     C********** REVAS     MULT -1        ZFLD15                                       CAS001 219336
     C           ZFLD15    MULT -1        ZFLD15                                              219336
     C                     ENDIF                                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RREVA                                               CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDREVA      ZFLD15                                              CAS001
     C           REVA      IFGT 0                                                             CAS001
     C           REVA      MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C           *IN22     IFEQ *ON                                                           CAS001
     C           *IN33     ANDEQ*OFF                                                          CAS001
     C********** REVA      MULT -1        ZFLD15                                       CAS001 219336
     C           ZFLD15    MULT -1        ZFLD15                                              219336
     C                     ENDIF                                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RREVA                                               CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Profit and Loss Amount                                                               CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     SELEC                                                              217120
     C           BNNPVM    WHEQ 'N'                                                           217120
     C           BNNPVM    OREQ ' '                                                           217120
     C                     Z-ADDPLAM      ZFLD15                                              CAS001
     C           *IN51     IFEQ *ON                                                           CAS001
     C           PLAM      ANDGT0                                                             CAS001
     C                     MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
     C           *IN23     IFEQ *ON                                                           CAS001
     C           PLAM      ANDLT0                                                             CAS001
     C                     MULT -1        ZFLD15                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       217120
     C           BNNPVM    WHEQ 'D'                                                           217120
     C                     Z-ADDPLAMD     ZFLD15                                              217120
     C           *IN51     IFEQ *ON                                                           217120
     C           PLAMD     ANDGT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
     C           *IN23     IFEQ *ON                                                           217120
     C           PLAMD     ANDLT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           BNNPVM    WHEQ 'B'                                                           217120
     C                     Z-ADDPLAMB     ZFLD15                                              217120
     C           *IN51     IFEQ *ON                                                           217120
     C           PLAMB     ANDGT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
     C           *IN23     IFEQ *ON                                                           217120
     C           PLAMB     ANDLT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
      *                                                                                       217120
     C           BNNPVM    WHEQ 'F'                                                           217120
     C                     Z-ADDPLAMF     ZFLD15                                              217120
     C           *IN51     IFEQ *ON                                                           217120
     C           PLAMF     ANDGT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
     C           *IN23     IFEQ *ON                                                           217120
     C           PLAMF     ANDLT0                                                             217120
     C                     MULT -1        ZFLD15                                              217120
     C                     ENDIF                                                              217120
     C                     ENDSL                                                              217120
      *                                                                                       217120
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RPLAM                                               CAS001
      *                                                                                       CAS001
      ** Check that sufficient lines remain for the Format. If not,                           CAS001
      ** write out the Main Headings on a new page.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD2         WRQDLN  30                                          CAS001
     C                     EXSR SRCHKL                                                        CAS001
      *                                                                                       CAS001
      ** Select which Record Format to Write by NPV                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITEDETLP3D1                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITEDETLP4D1                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITEDETLP5D1                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       219334
      ** Set on an indicator when details are reported for DL0410P3,                          219334
      ** DL0410P4 or DL0410P5.                                                                219334
      *                                                                                       219334
     C                     MOVE *ON       *IN05                                               219334
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRD2 - Print Detail Record format 2 - Monthly Calculation  *                       CAS001
      *                                                               *                       CAS001
      *  Called by: EXCEPT                                            *                       CAS001
      *                                                               *                       CAS001
      *  Calls: ZSEDIT  SRCHKL                                        *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRD2    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Monthly Event Amount                                                                 CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDMEAMT     ZFLD15                                              CAS001
     C                     Z-ADDWECDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RMEAMT                                              CAS001
      *                                                                                       CAS001
      ** Monthly Dealt Equivalent                                                             CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDMDBCE     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RMDBCE                                              CAS001
      *                                                                                       CAS001
      ** Monthly Revalued Equivalent                                                          CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDMREVA     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RMREVA                                              CAS001
      *                                                                                       CAS001
      ** Monthly Profit and Loss Amount                                                       CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDMPLAM     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RMPLAM                                              CAS001
      *                                                                                       CAS001
      ** Check that sufficient lines remain for the Format. If not,                           CAS001
      ** write out the Main Headings on a new page.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD4         WRQDLN                                              CAS001
     C                     EXSR SRCHKL                                                        CAS001
      *                                                                                       CAS001
      ** Select which Record Format to Write by NPV                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITEDETLP3D2                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITEDETLP4D2                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITEDETLP5D2                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
      ** Reset monthly values                                                                 CAS001
      *                                                                                       CAS001
     C                     Z-ADD0         MEAMT                                               CAS001
     C                     Z-ADD0         MDBCE                                               CAS001
     C                     Z-ADD0         MREVA                                               CAS001
     C                     Z-ADD0         MPLAM                                               CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRD3 - Print Detail Record format 3 - Annual Calculation   *                       CAS001
      *                                                               *                       CAS001
      *  Called by: EXCEPT                                            *                       CAS001
      *                                                               *                       CAS001
      *  Calls: ZSEDIT  SRCHKL                                        *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRD3    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Annual Event Amount                                                                  CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDYEAMT     ZFLD15                                              CAS001
     C                     Z-ADDWECDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RYEAMT                                              CAS001
      *                                                                                       CAS001
      ** Annual Dealt Equivalent                                                              CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDYDBCE     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RYDBCE                                              CAS001
      *                                                                                       CAS001
      ** Annual Revalued Equivalent                                                           CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDYREVA     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RYREVA                                              CAS001
      *                                                                                       CAS001
      ** Annual Profit and Loss Amount                                                        CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDYPLAM     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RYPLAM                                              CAS001
      *                                                                                       CAS001
      ** Check that sufficient lines remain for the Format. If not,                           CAS001
      ** write out the Main Headings on a new page.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD3         WRQDLN                                              CAS001
     C                     EXSR SRCHKL                                                        CAS001
      *                                                                                       CAS001
      ** Select which Record Format to Write by NPV                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITEDETLP3D3                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITEDETLP4D3                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITEDETLP5D3                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
      ** Reset Annual values                                                                  CAS001
      *                                                                                       CAS001
     C                     Z-ADD0         YEAMT                                               CAS001
     C                     Z-ADD0         YDBCE                                               CAS001
     C                     Z-ADD0         YREVA                                               CAS001
     C                     Z-ADD0         YPLAM                                               CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRD4 - Print Detail Record format 4 - Total Calculation    *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: ZSEDIT  SRCHKL                                        *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRD4    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Total Event Amount                                                                   CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTEAMT     ZFLD15                                              CAS001
     C                     Z-ADDWECDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    RTEAMT                                              CAS001
      *                                                                                       CAS001
      ** Total Dealt Equivalent                                                               CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTDBCE     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    R2TDBC                                              CAS001
      *                                                                                       CAS001
      ** Total Revalued Equivalent                                                            CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTREVA     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    R2TREV                                              CAS001
      *                                                                                       CAS001
      ** Total Profit Amount                                                                  CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTPROF     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    R2TPRO                                              CAS001
      *                                                                                       CAS001
      ** Total Loss Amount                                                                    CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTLOSS     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    R2TLOS                                              CAS001
      *                                                                                       CAS001
      ** Total Profit and Loss Amount                                                         CAS001
      *                                                                                       CAS001
     C                     MOVE *BLANKS   ZFLD15                                              CAS001
     C                     Z-ADDTOTPL     ZFLD15                                              CAS001
     C                     Z-ADDBCCDP     ZDECS                                               CAS001
     C                     MOVE 'J'       ZECODE                                              CAS001
     C                     EXSR ZSEDIT                                                        CAS001
     C                     MOVE ZOUT21    R2TPLA                                              CAS001
      *                                                                                       CAS001
      ** Check that sufficient lines remain for the Format. If not,                           CAS001
      ** write out the Main Headings on a new page.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD7         WRQDLN                                              CAS001
     C                     EXSR SRCHKL                                                        CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITEDETLP3D4                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITEDETLP4D4                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITEDETLP5D4                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
      ** Reset Total values                                                                   CAS001
      *                                                                                       CAS001
     C                     Z-ADD0         TEAMT                                               CAS001
     C                     Z-ADD0         TDBCE                                               CAS001
     C                     Z-ADD0         TREVA                                               CAS001
     C                     Z-ADD0         TPROF                                               CAS001
     C                     Z-ADD0         TLOSS                                               CAS001
     C                     Z-ADD0         TOTPL                                               CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRPRT1 - Print End of Report                                 *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: SRCHKL                                                *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRPRT1    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Check that sufficient lines remain for the Format. If not,                           CAS001
      ** write out the Main Headings on a new page.                                           CAS001
      *                                                                                       CAS001
     C                     Z-ADD4         WRQDLN                                              CAS001
     C                     EXSR SRCHKL                                                        CAS001
      *                                                                                       CAS001
      ** Select which Record Format to Write by NPV                                           CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C                     WRITETRALP3T1                                                      CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C                     WRITETRALP4T1                                                      CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C                     WRITETRALP5T1                                                      CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
     C           BRNCH     IFNE 'ALL'                                                         CAS001
     C                     MOVE 'Y'       WFNPRT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRCHKL - Check Available Space of Report                     *                       CAS001
      *                                                               *                       CAS001
      *  Called by: SRPRD1  SRPRD2  SRPRD3  SRPRD4  SRPRT1            *                       CAS001
      *                                                               *                       CAS001
      *  Calls: SRPRH1                                                *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRCHKL    BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Check if there are sufficient lines to print                                         CAS001
      *                                                                                       CAS001
     C                     SELEC                                                              CAS001
     C           BNNPVM    WHEQ 'F'                                                           CAS001
     C           OFLLN3    SUB  PRTLN3    WDIFLN  30                                          CAS001
     C           BNNPVM    WHEQ 'B'                                                           CAS001
     C           OFLLN4    SUB  PRTLN4    WDIFLN                                              CAS001
     C           BNNPVM    WHEQ 'D'                                                           CAS001
     C           OFLLN5    SUB  PRTLN5    WDIFLN                                              CAS001
     C                     ENDSL                                                              CAS001
      *                                                                                       CAS001
      ** If lines are not sufficient print out header for a new a page.                       CAS001
      *                                                                                       CAS001
     C           WDIFLN    IFLE WRQDLN                                                        CAS001
      *                                                                                       CAS001
     C           WPAS1     IFNE 'Y'                                                           CAS001
     C                     MOVE 'N'       WNREC                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       WPAS1                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     EXSR SRPRH1                                                        CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRRCF - Register New Printer Files via RCF                   *                       CAS001
      *                                                               *                       CAS001
      *  Called by: Main Processing                                   *                       CAS001
      *                                                               *                       CAS001
      *  Calls: NONE                                                  *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRRCF     BEGSR                                                              CAS001
      *                                                                                       CAS001
      ** Ensure Report Spool File recorded by RCF                                             CAS001
      *                                                                                       CAS001
     C                     CALL 'ZSFILE'                                                      CAS001
     C                     PARM           SEQ                                                 CAS001
     C                     PARM BRCA      @PARM                                               CAS001
     C                     PARM           ZFILE                                               CAS001
     C                     PARM           ZSNUM                                               CAS001
     C                     PARM *BLANK    ZSERR                                               CAS001
      *                                                                                       CAS001
      ** Error during ZSFILE processing, return to calling program                            CAS001
      *                                                                                       CAS001
     C           ZSERR     IFEQ 'Y'                                                           CAS001
     C                     MOVE *ON       *INU7                                               CAS001
     C                     MOVE *ON       *INU8                                               CAS001
     C                     MOVE *ON       *INLR                                               CAS001
     C                     RETRN                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
     C/EJECT                                                                                  CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS001
      *  SRDFC - Discount Factor Calculation                          *                       CAS001
      *                                                               *                       CAS001
      *  Called by: SRREVF  SRBCDF                                    *                       CAS001
      *                                                               *                       CAS001
      *  Calls: NONE                                                  *                       CAS001
      *                                                               *                       CAS001
      *****************************************************************                       CAS001
      *                                                                                       CAS001
     C           SRDFC     BEGSR                                                              CAS001
      *                                                                                       CAS001
     C                     CALL 'ZADSFCAL'                                                    CAS001
     C                     PARM *BLANKS   PNRTCD  7                                           CAS001
     C                     PARM           PNPRTC  5                                           CAS001
     C                     PARM           PNPYLD  5                                           CAS001
     C                     PARM           PNPCCY  3                                           CAS001
     C                     PARM           PNPINC  1                                           CAS001
     C                     PARM           PNPFDT  50                                          CAS001
     C                     PARM *ZERO     PNPDF  139                                          CAS001
      *                                                                                       CAS001
     C                     MOVEL'0'       *IN30                                               225831
      *                                                                                       225831
     C           PNRTCD    IFEQ '*NRF'                                                        225831
     C                     MOVEL'1'       *IN30                                               225831
     C                     ELSE                                                               225831
      *                                                                                       225831
     C           PNRTCD    IFNE *BLANKS                                                       CAS001
     C                     MOVEL'SDYLDRL2'DBFILE                                              CAS001
     C                     MOVEL'15'      DBASE                                               CAS001
     C                     MOVEL*BLANKS   DBOPTN                                              CAS001
     C                     GOTO ERROR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       225831
     C                     ENDIF                                                              225831
      *                                                                                       CAS001
     C                     ENDSR                                                              CAS001
      *                                                                                       CAS001
      *****************************************************************                       CAS001
      *                                                               *                       CAS004
      * SRCONV - Subroutine that convert amounts to another currency  *                       CAS004
      *                                                               *                       CAS004
      *****************************************************************                       CAS004
      *                                                                                       CAS004
     C           SRCONV    BEGSR                                                              CAS004
     C                     Z-ADDBCCDP     ZCDPI                                               CAS004
     C                     Z-ADDWECDP     ZCDPO                                               CAS004
     C                     MOVELBJCYCD    ZCCYI                                               CAS004
     C                     MOVELECCY      ZCCYO                                               CAS004
     C                     Z-ADDFSPRLA    ZAMTCI                                              CAS004
     C                     MOVELA6MDIN    ZMD                                                 CAS004
     C                     Z-ADDA6SPRT    ZEXCH                                               CAS004
     C                     EXSR ZCONV                                                         CAS004
      *                                                                                       CAS004
     C                     ENDSR                                                              CAS004
      *****************************************************************                       CAS004
      /COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZSEDITZ3                                               CEU011
     C/COPY ZSRSRC,ZCONVZ1                                                CEU011
     C/COPY ZSRSRC,ZACCH                                                  136239
     C/COPY ZSRSRC,ZFWDTA                                                 136239
     O/EJECT
      *****************************************************************
     O/COPY WNCPYSRC,DL0411O019
     ODL0411P1D  203   02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  203   OF 37                                                                  CAS001
     O       OR  203   OF 37 09                                                               CAS001
     O       OR  203   12 21 28
     O       AND       09                                                                     CAS001
     O                                   24 'REFERENCE DL0411P1'
     O                         BJURPT    89
     O                                  104 'DATE'
     O                         BJMRDT   112
     O                                  122 'PAGE'
     O                         PAGE  Z  127
      *
     O        D  1     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  1     OF 37                                                                  CAS001
     O       OR  1     OF 37 09                                                               CAS001
     O       OR  1     12 21 28
     O       AND       09                                                                     CAS001
     O                                   64 'REVALUATION OF FORWARD '
     O                                   78 'COMMITMENTS  -'
     O                         ECCY      83
      *
     O        D  2     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  2     OF 37                                                                  CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       OR  2     12 21 28
     O       AND       09                                                                     CAS001
     O                                   65 '------------------------'
     O                                   83 '------------------'
      *
     O        D  2     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  2     OF 37                                                                  CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       OR  2     12 21 28
     O       AND       09                                                                     CAS001
     O                N85                12 'BRANCH'
     O                N85      BRCA      16
     O                N85      A8BRNM    48
      *
     O        D  2     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  2     OF 37                                                                  CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       OR  2     12 21 28
     O       AND       09                                                                     CAS001
     O                                   19 'PROFIT CENTRE'
     O                         PRFC      24
     O                         DSPCDS    56
      *                                                                                       CAS001
     O        D  2     02 21 28                                                               CAS001
     O       AND       37 09 06                                                               CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       AND       06                                                                     CAS001
     O                                   15 'BOOK CODE'                                       CAS001
     O                         BOKC      18                                                   CAS001
     O                         BDBKD     50                                                   CAS001
      *                                                                                       CAS001
     O/COPY WNCPYSRC,DL0411O018
      *
     O        D  1     02 21 28
     O*******AND       37 32                                                                  CAS001
     O       AND       37 32 09                                                               CAS001
     O       OR  1     OF 37NL3
     O*******AND      NL1 32                                                                  CAS001
     O       AND      NL1 32 09                                                               CAS001
     O                                   15 'DEAL TYPE'
     O                         DTYP      19
     O                         DTPNAR    55
      *
     O        D  2     02 21 28
     O*******AND       37 32                                                                  CAS001
     O       AND       37 32 09                                                               CAS001
     O       OR  2     OF 37NL3
     O*******AND      NL1 32                                                                  CAS001
     O       AND      NL1 32 09                                                               CAS001
     O                                   14 'SUB TYPE'
     O                         DLST      19
     O                         CLAS      23                               CDL038
     O                         DSTCNR    59                               CDL038
     O*************************ASDSTN    50                               CDL038
      *
     O        D  1     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  1     OF 37                                                                  CAS001
     O       OR  1     OF 37 09                                                               CAS001
     O*******OR  2     OF 37                                                                  CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       OR  1     12 21 28
     O       AND       09                                                                     CAS001
     O/COPY WNCPYSRC,DL0411O001                                           S01408
     O                                   24 'VALUE  CUSTOMER   DEAL'
     O                N32                33 'DEAL'
     O                                   71 'DEALT'
     O                                  124 'REVALUED          PROFIT'
     O/COPY WNCPYSRC,DL0411O020
      *
     O        D  2     02 21 28
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O*******OR  2     OF 37                                                                  CAS001
     O       OR  2     OF 37 09                                                               CAS001
     O       OR  2     12 21 28
     O       AND       09                                                                     CAS001
     O                                   25 'DATE   NUMBER   NUMBER'
     O                N32                33 'TYPE'
     O                                   53 'AMOUNT'
     O                                   85 'EQUIVALENT    MID-RATE'
     O                                  109 'EQUIVALENT'
     O                                  126 '/LOSS'
     O/COPY WNCPYSRC,DL0411O005                                           S01408
      *
     O        D  1     02 21 37
     O       AND       09                                                                     CAS001
     O*******OR  1     12 21                                                                  CAS001
     O       OR  1     12 21 09                                                               CAS001
     O                         EDATA      8
     O                         ECNUM     16
     O                 02      EDLNO     25
     O                 02N32   DTYP      30
     O                 02N32             31 '-'
     O                 02N32   DLST      33
     O                 12      PREF      34
     O/COPY WNCPYSRC,DL0411O003                                           S01408
     O                 70      EAMT      53 ' ,   ,   ,   , 0 '
     O                 71      EAMT      53 '   ,   ,   , 0 . '
     O                 72      EAMT      53 '  ,   ,   , 0 .  '
     O                 73      EAMT      53 ' ,   ,   , 0 .   '
     O                         EAMSGN    54
     O                 02N32   CLAS      37                               CDL038
     O                 60      DBCE      73 ' ,   ,   ,   , 0 '
     O                 61      DBCE      73 '   ,   ,   , 0 . '
     O                 62      DBCE      73 '  ,   ,   , 0 .  '
     O                 63      DBCE      73 ' ,   ,   , 0 .   '
     O                                   74 '-'
     O                 22                74 '+'
     O                 33                74 '-'
     O/COPY WNCPYSRC,DL0411OOP1                                           S01408
      *
     O*************            RATE      89 '  0 .        '                                   138010
     O*************    55      RATES     89 '  0 .        '                                   138010
     O                         RATE      89 '   0 .        '                                  138010
     O                 55      RATES     89 '   0 .        '                                  138010
     O/COPY WNCPYSRC,DL0411OOP2                                           S01408
      *
     O                 60N55   REVA     109 ' ,   ,   ,   , 0 '
     O                 61N55   REVA     109 '   ,   ,   , 0 . '
     O                 62N55   REVA     109 '  ,   ,   , 0 .  '
     O                 63N55   REVA     109 ' ,   ,   , 0 .   '
     O                                  110 '-'
     O                 22               110 '+'
     O                 33               110 '-'
     O                 60 55   REVAS    109 ' ,   ,   ,   , 0 '
     O                 61 55   REVAS    109 '   ,   ,   , 0 . '
     O                 62 55   REVAS    109 '  ,   ,   , 0 .  '
     O                 63 55   REVAS    109 ' ,   ,   , 0 .   '
     O                 60      PLAM     127 ' ,   ,   ,   , 0 '
     O                 61      PLAM     127 '   ,   ,   , 0 . '
     O                 62      PLAM     127 '  ,   ,   , 0 .  '
     O                 63      PLAM     127 ' ,   ,   , 0 .   '
     O                 51               128 '-'
     O                 23               128 '+'
     O/COPY WNCPYSRC,DL0411O007                                           S01408
      *
     O********EF1      81 37                                                                  CAS001
     O        EF1      81 37 09                                                               CAS001
     O                                   29 'MONTHLY SUB-TOTAL'
     O                 70      MEAMT  B  53 ' ,   ,   ,   , 0 '
     O                 71      MEAMT  B  53 '   ,   ,   , 0 . '
     O                 72      MEAMT  B  53 '  ,   ,   , 0 .  '
     O                 73      MEAMT  B  53 ' ,   ,   , 0 .   '
     O                    64             54 '+'
     O                    65             54 '-'
     O                 60      MDBCE  B  73 ' ,   ,   ,   , 0 '
     O                 61      MDBCE  B  73 '   ,   ,   , 0 . '
     O                 62      MDBCE  B  73 '  ,   ,   , 0 .  '
     O                 63      MDBCE  B  73 ' ,   ,   , 0 .   '
     O                    66             74 '+'
     O                    67             74 '-'
     O                 60      MREVA  B 109 ' ,   ,   ,   , 0 '
     O                 61      MREVA  B 109 '   ,   ,   , 0 . '
     O                 62      MREVA  B 109 '  ,   ,   , 0 .  '
     O                 63      MREVA  B 109 ' ,   ,   , 0 .   '
     O                    68            110 '+'
     O                    69            110 '-'
     O                 60      MPLAM  B 127 ' ,   ,   ,   , 0 '
     O                 61      MPLAM  B 127 '   ,   ,   , 0 . '
     O                 62      MPLAM  B 127 '  ,   ,   , 0 .  '
     O                 63      MPLAM  B 127 ' ,   ,   , 0 .   '
     O                    57            128 '+'
     O                    58            128 '-'
      *
     O/COPY WNCPYSRC,DL0411O010
     O********E  2     81 37                                                                  CAS001
     O        E  2     81 37 09                                                               CAS001
     O********EF 2     82 37                                                                  CAS001
     O        EF 2     82 37 09                                                               CAS001
     O                                   29 'ANNUAL SUB-TOTAL'
     O                 70      YEAMT  B  53 ' ,   ,   ,   , 0 '
     O                 71      YEAMT  B  53 '   ,   ,   , 0 . '
     O                 72      YEAMT  B  53 '  ,   ,   , 0 .  '
     O                 73      YEAMT  B  53 ' ,   ,   , 0 .   '
     O                    59             54 '+'
     O                    77             54 '-'
     O                 60      YDBCE  B  73 ' ,   ,   ,   , 0 '
     O                 61      YDBCE  B  73 '   ,   ,   , 0 . '
     O                 62      YDBCE  B  73 '  ,   ,   , 0 .  '
     O                 63      YDBCE  B  73 ' ,   ,   , 0 .   '
     O                    78             74 '+'
     O                    38             74 '-'
     O                 60      YREVA  B 109 ' ,   ,   ,   , 0 '
     O                 61      YREVA  B 109 '   ,   ,   , 0 . '
     O                 62      YREVA  B 109 '  ,   ,   , 0 .  '
     O                 63      YREVA  B 109 ' ,   ,   , 0 .   '
     O                    84            110 '+'
     O                    39            110 '-'
     O                 60      YPLAM  B 127 ' ,   ,   ,   , 0 '
     O                 61      YPLAM  B 127 '   ,   ,   , 0 . '
     O                 62      YPLAM  B 127 '  ,   ,   , 0 .  '
     O                 63      YPLAM  B 127 ' ,   ,   , 0 .   '
     O                    86            128 '+'
     O                    87            128 '-'
      *
     O        TF2      L1 31NU7
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O                 70      TEAMT  B  53 ' ,   ,   ,   , 0 '
     O                 71      TEAMT  B  53 '   ,   ,   , 0 . '
     O                 72      TEAMT  B  53 '  ,   ,   , 0 .  '
     O                 73      TEAMT  B  53 ' ,   ,   , 0 .   '
     O                                   54 '-'
     O                 25                54 '+'
     O                 60      TDBCE  B  73 ' ,   ,   ,   , 0 '
     O                 61      TDBCE  B  73 '   ,   ,   , 0 . '
     O                 62      TDBCE  B  73 '  ,   ,   , 0 .  '
     O                 63      TDBCE  B  73 ' ,   ,   , 0 .   '
     O                    88             74 '+'
     O                    89             74 '-'
     O                                   90 'TOTAL'
     O                 60      TREVA  B 109 ' ,   ,   ,   , 0 '
     O                 61      TREVA  B 109 '   ,   ,   , 0 . '
     O                 62      TREVA  B 109 '  ,   ,   , 0 .  '
     O                 63      TREVA  B 109 ' ,   ,   , 0 .   '
     O                    48            110 '+'
     O                    49            110 '-'
     O                 60      TPROF  B 127 ' ,   ,   ,   , 0 '
     O                 61      TPROF  B 127 '   ,   ,   , 0 . '
     O                 62      TPROF  B 127 '  ,   ,   , 0 .  '
     O                 63      TPROF  B 127 ' ,   ,   , 0 .   '
     O                                  128 '+'
      *
     O********T*2      L1 31NU7                                                               220199
     O        TF2      L1 31NU7                                                               220199
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O                 60      TLOSS  B 127 ' ,   ,   ,   , 0 '
     O                 61      TLOSS  B 127 '   ,   ,   , 0 . '
     O                 62      TLOSS  B 127 '  ,   ,   , 0 .  '
     O                 63      TLOSS  B 127 ' ,   ,   , 0 .   '
     O                                  128 '-'
      *
     O********T*2      L1 31NU7                                                               220199
     O        TF2      L1 31NU7                                                               220199
     O*******AND       37                                                                     CAS001
     O       AND       37 09                                                                  CAS001
     O/COPY WNCPYSRC,DL0411OOP3                                           S01408
      *
     O                                  109 '(NET)'
     O/COPY WNCPYSRC,DL0411OOP4                                           S01408
     O                 60      TOTPL  B 127 ' ,   ,   ,   , 0 '
     O                 61      TOTPL  B 127 '   ,   ,   , 0 . '
     O                 62      TOTPL  B 127 '  ,   ,   , 0 .  '
     O                 63      TOTPL  B 127 ' ,   ,   , 0 .   '
     O/COPY WNCPYSRC,DL0411O008                                           S01408
     O                 46               128 '-'
     O                 24               128 '+'
     O/COPY WNCPYSRC,DL0411O004                                           S01408
      *
     O        T 3      U7 U8 37
     O       AND       09                                                                     CAS001
     O                                   30 'REFERENCE DL0411'
     O                                   62 'PRINT TERMINATED'
     O                                   80 'DATABASE IN ERROR'
      *
     O********T*3      L3 37 79                                                               220199
     O        TF3      L3 37 79                                                               220199
     O       AND       09                                                                     CAS001
     O/COPY WNCPYSRC,DL0411O006                                           S01408
     O*******OR*       LR 37 79                                                               220199
     O       ORF       LR 37 79                                                               220199
     O       AND       09                                                                     CAS001
     O                N85                65 '*** END OF REPORT '
     O                N85                79 'FOR BRANCH ***'
     O                 85                84 '*** END OF REPORT ***'
      ********************************************************************
     O/COPY WNCPYSRC,DL0411O009
     ODL0411AUT  203   LR
     O/COPY WNCPYSRC,DL0411O002                                           S01408
     O                                   24 'REFERENCE DL0411AU'
     O                         BJURPT    89
     O                                  104 'DATE'
     O                         BJMRDT   112
     O                                  122 'PAGE'
     O                         PAGE1 Z  127
     O        T  1     LR
     O                                   68 'REVALUATION OF FORWARD '
     O                                   79 'COMMITMENTS'
     O        T        LR
     O                                   69 '------------------------'
     O                                   79 '----------'
     O        T  215   LRNU7
     O                                   18 'RUN CONTROLS'
     O        T  2     LRNU7
     O                                   59 'NUMBER'
     O                 U1                84 'VALUE'
     O        T  2     LRNU7
     O                                   31 'RECORDS LISTED IN THIS '
     O                                   37 'REPORT'
     O                         RECS  3   59
     O/COPY WNCPYSRC,DL0411O011
     O        T  2     LRNU7 U1
     O                                   29 'REVALUATION BALANCES '
     O                                   38 'GENERATED'
     O                         NRBG  3   59
     O                         RBG   3   84
      *
     O        T 33     LRNU7N14
     O       AND      N06                                                                     219334
     O       OR        LRNU7N09                                                               219334
     O       AND       06N05                                                                  219334
     O                                   63 '***   NO DETAILS TO REPO'
     O                                   71 'RT   ***'
     O        T   25   LR U7 U8
     O                                   71 '*** PRINT TERMINATED ***'
     O        T 1      LR U7 U8
     O                                   57 'DATABASE ERROR'
     O                         DBASE     61
     O                                   67 'FILE'
     O                         DBFILE    78
     O        T 13     LR U7 U8
     O                                   49 'OPTION'
     O                         DBOPTN    57
     O                                   66 'KEY'
     O                         DBKEY     96
     OGEFRHH  H        01 U1
     O                                    1 'A'
     OGEFRPD  E        41
     O       OR        42
     O       OR        43
     O       OR        44
     O       OR        17 U1                                                                  CAS005
     O                                    1 'P'
     O**********               ACCKY     16                                                   CGL029
     O**********               RECI       1                                          CGL029 BUG5336R
     O                         CNUM       7                                                   CGL029
     O                         CCY       10                                                   CGL029
     O                         ACODQQ    14                                                   CGL029
     O                         ACSQ      16                                                   CGL029
     O                         ACOD     599                                                   CGL029
     O**********             17WDLDS     16                                           CAS005 BUG5336
     O                       17WDLDS     16                                         BUG5336 BUG5336R
     O/COPY WNCPYSRC,DL0411O012
     O**********             41BNFRPL    14                                                   CGL029
     O**********             42BNFRPL    14                                                   CGL029
     O**********       41 07 08BNFRLA    14                                            CAS005 CGL029
     O**********       42 07 08BNFRLA    14                                            CAS005 CGL029
     O**********             17ACOD      14                                            CAS005 CGL029
     O                       41BNFRPL   599                                                   CGL029
     O                       42BNFRPL   599                                                   CGL029
     O                 41 07 08BNFRLA   599                                                   CGL029
     O                 42 07 08BNFRLA   599                                                   CGL029
     O                       17ACOD     599                                                   CGL029
     O/COPY WNCPYSRC,DL0411O013
     O                         BJRDNB    35P
     O                         BJRDNB    38P
     O                         O#PNAR    73
     O                       17PNAR      73                                                   CAS005
     O                 41      LDBL      80P
     O                 43      LDBL      80P
     O/COPY WNCPYSRC,DL0411O014
     O**********             42TBR,A     80P                                                  CAS005
     O**********             44TBR,A     80P                                                  CAS005
     O                   N07 42TBR,A     80P                                                  CAS005
     O                   N07 44TBR,A     80P                                                  CAS005
     O                    07 42TBP,A     80P                                                  CAS005
     O                    07 44TBP,A     80P                                                  CAS005
     O                 08 07 42TBL,A     80P                                                  CAS005
     O                 08 07 44TBL,A     80P                                                  CAS005
     O                       17PSTA      80P                                                  CAS005
     O/COPY WNCPYSRC,DL0411O015
     O                                   81 '0'
     O/COPY WNCPYSRC,DL0411O016
     O                 41 15             81 '1'
     O                 43N15             81 '1'
     O/COPY WNCPYSRC,DL0411O017
     O                    42 26          81 '1'
     O                    44N26          81 '1'
     O                       17DRCR      81                                                   CAS005
     O                         ASOC      87
     O                         CHQN      95                                                 BUG5336R
     O                                  102 'GE-FR'
     O                         BRAR,A   105
     O                       17BRCA     105                                                   CAS005
     O                                  106 '0'
     O                         A5ACTY   124
     O                       17ATYP     124                                                   CAS005
     O                         PRIN     128
     O                                  129 'F'
     O***********              PRFC     134                               124860
     O                         RPRFC    134                               124860
     O                                  140 '235959'
     O                         VOIN     141
     O                         A5ACSC   146
1090 O                       17ACSC     146                                                   CAS005
     O                                  230 '               '
     O                                  240 '          '
     O                                  250 '          '
     O                         ZERO15   258P
     O                         ZERO15   266P
     O                                  268 '  '
     O                         FEEFLG   352                                                   CGL020
     O                         FEEVAL   359P                                                  CGL020
     O                         FEEPCT   364                                                   CGL020
     O                         TICKER   540                                                   CGL020
     O                         EXCHNG   560                                                   CGL020
     O                         NOMINL   573                                                   CGL020
     O                         NITMS    271P                                                AR813358
     O                         CHGA     279P                                                AR813358
     O                         ORAMT    316P                                                AR813358
     O                         ACNO      32                                                 AR813358
     O                         TRAT      43                                                 AR813358
     O                         REJC     108P                                                AR813358
     O                         RRNM     114P                                                AR813358
     O                         ACUM     130                                                 AR813358
     O                         LTAI     147                                                 AR813358
     O                         XRFN     329                                                 AR813358
     O                         SETDAT   530P                                                AR813358
     O/COPY WNCPYSRC,DL0411O021
     OGEFRZZ  E        45
     O                                    1 'T'
     O                         TOTNUM     6
     O                         INT,2     14P
     O                         DEC,2     16P
     O/COPY WNCPYSRC,DL0411OOPG                                           S01408
     X/COPY WNCPYSRC,DL0411X001                                           S01408
      *
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   POWER - POWERS OF 10 FOR CURRENCY CONVERSIONS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TABE1
11V1
11V2
12V1
12V2
13V1
13V2
20V1
20V2
91P1
91P2
91P3
91P4
91P5
91P6
91P8
91P9
23C3                                                                                          CAS008
23S3                                                                                          CAS008
23C4                                                                                          CAS008
23S4                                                                                          CAS008
**   TABE2
14V3
14V4
15I2
15M2
16I2
16M2
17I2
17M2
20V3
20V4
21C3
21I1
22I1
23I1
24I1
**   TABE3
11V1
12V1
13V1
14V3
14V4
15I2
15M2
17I2
17M2
20V1
20V3
91P2
91P3
91P6
91P8
** DTX DEAL TYPES
FR
RS
RX
** DTH DEAL TYPE HEADINGS
FORWARD RATE AGREEMENTS
SINGLE CURRENCY INTEREST RATE SWAPS
CROSS CURRENCY INTEREST RATE SWAPS
** TEXT - Text Strings
FORWARD REVALUATIONS
