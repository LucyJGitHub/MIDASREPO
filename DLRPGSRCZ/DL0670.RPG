0002 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Outstanding Delivery Instructions Report')    *
0003 F*****************************************************************
0005 F*                                                               *
     F*  Midas - Dealing Module
0005 F*                                                               *
0006 F*  DL0670  -  OUTSTANDING DELIVERY INSTRUCTIONS REPORT          *
0007 F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
0009 F*                                                               *
      *  Last Amend No. CDL099             Date 06Oct17               *
      *  Prev Amend No. CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 196260             Date 10Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
     F*                 171057             Date 01Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CEU003             Date 02Jan98               *
     F*                 S01408             Date 31Jul96               *
     F*                 058968             Date 28Jan94               *
     F*                 049265             DATE 23APR93               *
     F*                 S01393             DATE 11AUG92               *
     F*                 E23911             DATE 26JUN91               *
     F*                 E20836             DATE 17JAN90               *
     F*                 LN1050             DATE 29NOV90               *
     F*                 LN0813             DATE 08OCT90               *
     F*                 LN0613             DATE 19SEP90               *
     F*                 LN0135             DATE 24MAY90               *
0009 F*                 LN0232             DATE 22MAY90               *
0009 F*                 E147               DATE  5DEC89               *
0009 F*                 E131               DATE 30NOV89               *
0009 F*                 S01117             DATE 20/04/89              *
0009 F*                 S01194             DATE 20/04/89              *
0009 F*                 S01153             DATE 09/05/88              *
     F*                 S01119             DATE 15/06/87              *
0011 F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  196260 - Excluded from this report deals which have 04 as    *
      *           their pay/receipt settlement method. The logic      *
      *           behind this is that the payment/receipt settlement  *
      *           details for method 04 would already have been       *
      *           completed upon authorization of the deal.           *
     F*  171057 - Prevent deals settled in EUR from appearing on this *
     F*           report incorrectly.                                 *
     F*         - The report should not include Payment details when  *
     F*           settlement method = 01, 07 or 08, 'our receive a/c' *
     F*           is present, counter paying bank is not there but    *
     F*           'a/c with bank' is.  Since Settlement Instructions  *
     F*           are already completed when inserted, Nostro         *
     F*           transferdeals should also be excluded in the        *
     F*           report.                                             *
     F*  CEU003 - Settlement currency conversion.  When an event is   *
     F*           written with settlement details and if the          *
     F*           transaction holds a settlement currency, 2 new      *
     F*           events will be generated for each existing          *
     F*           transaction currency event. One is to cancel the    *
     F*           effect of the transaction currency event and the    *
     F*           other will provide a cashflow in settlement ccy.    *
     F*  S01408 - Core Hook DL0670CCP2 Added                          *
     F*         - Core Hook DL0670CCP1 Added                          *
     F*         - Core Hook DL0670EEP1 Added                          *
     F*         - Core Hook DL0670FFP1 Added                          *
     F*  058968 - For fix E23911, settlment method should be          *
     F*           checked against '00' before deciding whether        *
     F*           to include in report or not.                        *
     F*  049265 - EVENTS WITH SIMILAR DETAILS (DEAL NUMBER,           *
     F*           EVENT NARRATIVE, EVENT DATE, SETTLEMENT TYPE,       *
     F*           OUR REC/PAY, THEIR PAY/REC) ARE PRINTED             *
     F*           MORE THAN ONCE.                                     *
     F*  S01393 - Recompiled for Strategic Risk Management            *
     F*           Book Code added to PF/EVNTXED                       *
     F*  E23911 - This report should not include the receipt          *
     F*           Settlement Instructions of deals when the           *
     F*           settlement method and our receive account are       *
     F*           correct but the counter paying bank is missing.     *
     F*                                                               *
     F*  E20836 - DUMP DATABASE ERROR DETAILS AND CORRECT             *
     F*           SPELLING MISTAKE.(SUPERSEDED BY S01194 & S01117)    *
     F*  LN1050 - P1 REPORT NOT BEING PRODUCED DUE TO LN0613          *
     F*  LN0813 - CHANGE 'END OF BRANCH REPORT' TO 'END OF REPORT     *
     F*           FOR BRANCH'                                         *
     F*  LN0613 - ONLY PRODUCE A P1 REPORT IF DETAILS TO REPORT       *
     F*  LN0135 - REMOVE 'END OF REPORT' FROM AUDIT REPORT            *
     F*  LN0232 - P1 REPORT HEADINGS WERE BEING OMITTED IF THE        *
     F*           FIRST RECORD FOR A PARTICULAR EVENT BRANCH WAS      *
     F*           NOT OUTPUT                                          *
     F*  E147   - ONLY PRODUCE A P1 REPORT FOR A BRANCH IF THERE      *
     F*           ARE DETAILS TO REPORT IE DOES NOT FAIL A TEST       *
     F*  S01117/E131 - CENTRE OUTPUT AND REMOVE PAGE THROW            *
     F*  S01117 - MULTIBRANCHING - R10                                *
     F*  S01194 - NEW STANDING DATA - ADD ACCESS OBJECTS              *
     F*  S01153 - COB ENHANCEMENTS                                    *
     F*  S01119 - AMENDMENTS TO ALLOW FRA/IRS DEALS                   *
     F*                                                               *
0012 F*****************************************************************
     F*                                                               *
0013 F* ID F  C  H  L    FUNCTION OF INDICATORS
0014 F* 01            SORTED EVENT FILE - HEADER
0015 F* 02                              - DETAIL
0016 F**03*******                       - TRAILER                         S01153
0017 F* 04            CLIENT FILE DETAIL.
0018 F*       20      FIRST CYCLE CALCULATIONS DONE.
0019 F********21*     DELIVERY INSTRUCTIONS OUTSTANDING.                  S01153
0020 F*       22      C/P CUST. NO. AND CUST. NO. DIFFERENT.
0021 F*       23      EVENT TYPE ON TABLE.
0022 F*       24      INCOMING OUTGOING INDICATOR 'I'.
0023 F*       25      EVENT AMOUNT NEGATIVE
0024 F*       26      NO 'FOR A/C OF DETAILS'
0025 F*       27      NO SPECIAL INSTRUCTIONS
0026 F*       28      EVENT DATE NOT MORE THAN 10 DAYS AHEAD
0027 F*       29      AMENDMENT EVENT
0028 F*       30      CHAIN FAIL.
0029 F*       31      DETAILS TO BE REPORTED EXIST
0030 F********32*     BALANCE EQUALS ZERO                                 S01153
0031 F********33*     SETTLEMENT TYPE IS EITHER '03' OR '06'              S01153
0032 F********34*     EVENT TYPE IS EITHER 12V1 OR 12V2                   S01153
     F*       35      WORK INDICATOR USED FOR BENEFICIARY BANK DETAILS
     F*       36      BENEFICIARY BANK DETAILS EXIST IN SPI FIELD
0033 F********40*     ON TO SUPPRESS OUTPUT OF INVALID RECORDS            S01153
0034 F*
     F*****************************************************************
0037 F*VNT2***IP* E           K        DISK                               S01153
0038 F*****TABLE   IF  F      96 12AI     2 DISK                          S01194
0039 F*****CLINT   IF  F     256  7AI     2 DISK                          S01194
0037 FEVNTL5  IP  E           K        DISK                               S01153
0037 FDEALS   IF  E           K        DISK                               171057
0037 F            DEALSDAF                          KIGNORE               171057
0037 F            DEALSDFF                          KIGNORE               171057
0037 F            DEALSDGF                          KIGNORE               171057
     F*                                                                   S01408
     F/COPY WNCPYSRC,DL0670FFP1                                           S01408
     F*                                                                   S01408
0040 F*PRINT  O   F     132     OF     PRINTER                            S01124
0040 FDL0670AUO   F     132     OA     PRINTER      KINFDS SPOOLU         S01117
0040 FDL0670P1O   F     132     OF     PRINTER      KINFDS SPOOL      UC  S01117
     E                    CPY@    1   1 80
0041 E***                 TABETY  1  23  4   TABENA 10                    S01119
0041 E***********         TABETY  1  35  4   TABENA 10             S01119 CEU003
     E                    TABETY  1  62  4   TABENA 10                    CEU003
0042 E***********         TABAEV  1   4  4                                CEU003
     E                    TABAEV  1   8  4                                CEU003
0043 E                    HCCY       25  3               HOLIDAY CCYS
     E*                                                                   S01408
     E/COPY WNCPYSRC,DL0670EEP1                                           S01408
     E*                                                                   S01408
0044 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0045 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0046 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
0047 I*    EVENTS FILE - HEADER RECORD.
0048 I*
0049 IEVNTXECF    01
0051 I*
0052 I*
0053 I*    EVENTS FILE - DETAIL RECORD.
0054 I*
0055 IEVNTXEDF    02
0061 I***********                                   EAMT            32    S01153
     I                                              EBRC  L1              S01117
0100 I                                              FACO            26
0101 I                                              SPI             27
      *                                                                   171057
      ** Rename field defined differently in events file                  171057
      *                                                                   171057
     IDEALSDEF                                                            171057
     I              SETP                            @SETP1                171057
0103 I*
0104 I***********                                                         S01153
0105 I*****EVENTS FILE - TRAILER RECORD.                                  S01153
0106 I***********                                                         S01153
0107 I*VNTXZZF*** 03                                                      S01153
0117 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*1.*              S01194
0118 I*************                                                       S01194
0119 I*****TABLE***NS       2 C0   3 C1  12 C1                            S01194
0120 I*******AND***   13 C0                                               S01194
0121 I*************                           1   1 RECI                  S01194
0122 I*************                           2   30RECT                  S01194
0123 I*************                          12  130RCDE                  S01194
0124 I*************                          14  66 TITL                  S01194
0125 I*************                          67  67 DATF                  S01194
0126 I*************                          68  700DFBR                  S01194
0127 I*************                          74  74 MODI1                 S01194
0128 I*************                          75  75 MODI2                 S01194
0129 I*************                          76  76 MODI3                 S01194
0130 I*************                       P  77  790RUND                  S01194
0131 I*************                          80  86 RUNA                  S01194
0132 I*************                          87  870SFLG                  S01194
0133 I*************                       P  90  920LCD                   S01194
0134 I*************                          93  93 CHTP                  S01194
0135 I*************                       P  94  960TNLU                  S01194
0136 I*************                                                       S01194
0137 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*2.**             S01194
0138 I*************                                                       S01194
0139 I*****TABLE***NS       1 CD   2 C0   3 C1                            S01194
0140 I*******AND***   12 C1  13 C1                                        S01194
0141 I*************                           1   1 RECI                  S01194
0142 I*************                           2   30RECT                  S01194
0143 I*************                          12  130RCDE                  S01194
0144 I*************                          14  16 BCCY                  S01194
0145 I*************                          17  19 BCYL                  S01194
0146 I*************                          20  22 HOCY                  S01194
0147 I*************                          23  280HEAD                  S01194
0148 I*************                       P  29  310APDA                  S01194
0149 I*************                          35  35 APFQ                  S01194
0150 I*************                       P  36  380LOGS                  S01194
0151 I*************                          39  40 CUZR                  S01194
0152 I*************                       P  41  430DNWD                  S01194
0153 I*************                          44  460BVLP                  S01194
0154 I*************                          47  49 LOCY                  S01194
0155 I*************                          50  510FDAY                  S01194
0156 I*************                          86  86 ISAV                  S01194
0157 I*************                       P  87  890LLOG                  S01194
0158 I*************                       P  90  920LCD                   S01194
0159 I*************                          93  93 CHTP                  S01194
0160 I*************                       P  94  960TNLU                  S01194
0161 I*************                                                       S01194
0162 I*****CATCHALL**                                                     S01194
0163 I********NS***                                                       S01194
0164 I*************                           1   1 RECI                  S01194
0165 I*************                                                       S01194
0166 I*****CLIENT*FILE*-*CUSTOMER*STANDING*DATA*RECORD.**                 S01194
0167 I*************                                                       S01194
0168 I*****CLINT***NS**04   1 CD   8 CA                                   S01194
0169 I*************                           1   1 RECI                  S01194
0170 I*************                           2   70CNUM                  S01194
0171 I*************                           8   8 RCDT                  S01194
0172 I*************                           9  28 CRNM                  S01194
0173 I*************                          29  38 CTWN                  S01194
0174 I*************                          39  48 CSNM                  S01194
0175 I*************                          49  56 CASK                  S01194
0176 I*************                          57  68 TELX                  S01194
0177 I*************                          69  80 CSID                  S01194
0178 I*************                          81  82 ACOC                  S01194
0179 I*************                          83  83 CBSI                  S01194
0180 I*************                          84  85 CCTZ                  S01194
0181 I*************                          86  87 CLOC                  S01194
0182 I*************                          88  930CPAR                  S01194
0183 I*************                          94  960BRCD                  S01194
0184 I*************                          97  980LINS                  S01194
0185 I*************                          99 1010LIND                  S01194
0186 I*************                       P 102 1040DASU                  S01194
0187 I*************                       P 105 1070CDIC                  S01194
0188 I*************                       P 108 1100DADE                  S01194
0189 I*************                         111 111 CMIN                  S01194
0190 I*************                         112 112 CTYP                  S01194
0191 I*************                         113 124 TELF                  S01194
0192 I*************                         125 133 CHID                  S01194
0193 I*************                         134 136 CHAB                  S01194
0194 I*************                       P 250 2520LCD                   S01194
0195 I*************                         253 253 CHTP                  S01194
0196 I*************                       P 254 2560TNLU                  S01194
0197 I*************                                                       S01194
0198 I*****CATCHALL**                                                     S01194
0199 I********NS*****                                                     S01194
0925 I**                                                                  S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
0925 I**                                                                  S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
0925 I**                                                                  S01117
     I**   FIELDS USED FOR BENEFICIARY BANK DETAILS
     I            DS
     I                                        1  35 SPI
     I                                        1   3 SPEC3
     I                                        1   5 SPEC5
     I                                        6   8 SPEC8
     I                                        1   8 SPEC9
     I                                        6  12 SPEC12
     I                                        9  14 SPEC14
     I                                        9  17 SPEC17
     I                                       10  18 SPEC18
     I                                        5  34 SPEC34
     I                                        6  35 SPEC35
0315 I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I** EXTERNAL DS FOR BRANCH DETAILS                                   S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01194
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
0315 I*                                                                   S01194
      *                                                                   171057
      ** Data structure to save and restore fields after DEALS accessed   171057
      *                                                                   171057
     I@DSED1    E DSEVNTXED                                               171057
     I              SPI                             @SPI                  171057
     I              SETP                            @SETP2                171057
     I              OSACQQ                          OSACEV                                    CGL029
0037 I@DSED2      DS                           2000                       171057
0200 I/EJECT
0201 C*
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM           BRNCH   3                       S01117
     C*                                                                   S01117
0202 C*    FIRST CYCLE CALCULATIONS.
0203 C   20                GOTO NOTFC
0204 C                     SETON                     20
     C                     MOVEACPY@      BIS@   80
0205 C*
0206 C*****ACCESS*INSTALLATION*CONTROL*DATA*1.**
0207 C*********************EXSR ZSYSTM
     C** READ BANK DETAILS VIA ACCESS PROGRAM                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE 10        ************   S01194
     C                     MOVEL'01'      DBASE   2        * DBERR 01 *   S01194
     C                     MOVEL@OPTN     DBKEY            ************   S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO ERROR                                     S01194
     C                     END                                            S01194
0330 C*                                                                   S01194
0208 C*********************                                               S01194
0209 C*****ACCESS*INSTALLATION*CONTROL*DATA*2**                           S01194
0210 C*********************MOVE '1'       ZTABKY                          S01194
0211 C***********ZTABKY****CHAINTABLE                30                   S01194
0212 C***30****************GOTO ERROR                                     S01194
0213 C*
0214 C*    CALCULATE TEN CALENDAR DAYS AHEAD
0215 C*
0216 C***********RUND******ADD  10        CDAYN   50                      S01194
0216 C           BJRDNB    ADD  10        CDAYN   50                      S01194
0217 C*
0218 C*****SETUP*CLIENT*FILE*KEY.***                                      S01194
0219 C*********************MOVE 'A'       CLTKEY  7                       S01194
0220 C*********************                                               S01194
0221 C*    SET UP BLANK FIELD
0222 C                     MOVE ' '       BLNK10 10
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0670CCP1                                           S01408
     C*                                                                   S01408
0223 C*
0224 C*    DETAIL CALCULATIONS.
0225 C           NOTFC     TAG                             ** NOTFC TAG **
     C                     SETOF                     3536
0226 C*    KEEP COUNT OF NUMBER OF RECORDS READ.
0227 C***01******                                                         S01153
0228 C*R*02******                                                         S01153
0229 C*R*03******NREC      ADD  1         NREC    50                      S01153
0229 C   02      NREC      ADD  1         NREC    50                      S01153
0230 C*
0231 C*    PROCESS DETAIL RECORDS.
0232 C  N02                GOTO END
     C*                                                                   S01117
     C********** *INL1     IFEQ '1'                                 S01117LN0613
     C**********           CLOSEDL0670P1                            S01117LN0613
     C********** BRNCH     IFEQ 'ALL'                               S01117LN0613
     C********** BRNCH     OREQ EBRC                                S01117LN0613
     C**********           SETON                     58 ALLOW OUTPUTS01117LN0613
     C**********           OPEN DL0670P1                            S01117LN0613
     C**********           Z-ADD0         PAGE                      S01117LN0613
     C**********           Z-ADD0         WRIT    50                E147  LN0613
     C**********                                                    S01117LN0613
     C***ENSURE REPORT SPOOL FILE RECORDED BY RCF                   S01117LN0613
     C**********                                                    S01117LN0613
      ***TRANSFER*BINARY*DATA*INTO*NUMERIC*FIELD*                   S01117LN0613
     C**********           Z-ADDSFNUM     ZSNUM   60                S01117LN0613
     C**********           CALL 'ZSFILE'                            S01117LN0313
     C**********           PARM           SEQ                       S01117LN0613
     C**********           PARM EBRC      @PARM   3                 S01117LN0613
     C**********           PARM           SFILE                     S01117LN0613
     C**********           PARM           ZSNUM                     S01117LN0613
     C**********           PARM *BLANK    ZSERR   1                 S01117LN0613
     C**********                                                    S01117LN0613
     C********** ZSERR     IFEQ 'Y'                                 S01117LN0613
     C**********           SETON                     U7U8LR         S01117LN0613
     C**********           RETRN                                    S01117LN0613
     C**********           END                                      S01117LN0613
     C**********                                                    S01117LN0613
     C***To*get Branch Name :                                       S01117LN0613
     C**********           CALL 'AOBRCHR0'                          S01194LN0613
     C**********           PARM '*MSG   ' @RTCD   7                 S01194LN0613
     C**********           PARM '*KEY   ' @OPTN   7                 S01194LN0613
     C**********           PARM EBRC      @DSNB   3                 S01194LN0613
     C********** SDBRCH    PARM SDBRCH    DSFDY                     S01194LN0613
     C********** @RTCD     IFNE *BLANK                              S01194LN0613
     C**********           MOVEL'SDBRCHPD'DBFILE 10    ***********  S01194LN0613
     C**********           MOVEL'03'      DBASE   2    *DBERR 03 *  S01194LN0613
     C**********           MOVEL@OPTN     DBOPTN  7    ***********  S01194LN0613
     C**********           MOVELEBRC      DBKEY  29                 S01194LN0613
     C**********           EXSR *PSSR                               S01194LN0613
     C**********           GOTO ERROR                               S01194LN0613
     C**********           END                                      S01194LN0613
     C*********************1                                        S01117E147
0261 C*****IF*DETAILS*TO*REPORT EXIST, SET INDICATOR                S01117E147
0262 C*********************SETON                     31             S01117E147
0263 C*********************                                         S01117E147
     C**********           ELSE                                     S01117LN0613
     C*********************SETOF                     58             S01117E147
     C**********           SETOF                     5831           E147  LN0613
     C**********           END                                      S01117LN0613
     C**********           END                                      S01117LN0613
0260 C**                                                            S01117LN0613
0233 C*
0234 C*    ADD EVENT AMOUNT TO HASH TOTAL
0235 C           EAMT      DIV  1000      ZZAMT        25
0236 C   25                Z-SUBZZAMT     ZZAMT
0237 C                     EXSR GLZADD
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0670CCP2                                           S01408
     C*                                                                   S01408
0238 C*
0239 C*****CHECK*IF DELIVERY INSTRUCTIONS ARE OUTSTANDING.                S01153
0240 C***********FIPI      COMP 'N'                      21               S01153
0241 C**N21******          GOTO END                                       S01153
0242 C*
0243 C*    EVENT DATE MUST NOT BE MORE THAN TEN
0244 C*    DAYS AHEAD AND NOT EARLIER THAN RUN DATE
0245 C           EDAT      COMP CDAYN                28
0246 C**N28******EDAT******COMP RUND                   28                 S01194
0246 C  N28      EDAT      COMP BJRDNB                 28                 S01194
0247 C   28                GOTO END
0248 C*
     C*                                                                   E23911
     C           INOI      IFEQ 'I'                                       E23911
     C***********SETP      ANDNE'0'                                E23911 058968
     C           SETP      ANDNE'00'                                      058968
     C           OSAC      ANDNE*BLANKS                                   E23911
     C           TSEN      ANDEQ*BLANKS                                   E23911
     C                     SETON                     28                   E23911
     C                     GOTO END                                       E23911
     C                     END                                            E23911
     C*                                                                   E23911
      ** If a payment, and 'our a/c' present but 'their nostro' is not... 171057
      *                                                                   171057
     C           INOI      IFEQ 'O'                        --- B000       171057
     C           OSAC      ANDNE*BLANKS                                   171057
     C           TSEN      ANDEQ*BLANKS                                   171057
      *                                                                   171057
      ** ... and type 01, 07, or 08                                       171057
      *                                                                   171057
     C           SETP      IFEQ '01'                       --- B111       171057
     C           SETP      OREQ '07'                                      171057
     C           SETP      OREQ '08'                                      171057
      *                                                                   171057
      ** ... then save field details (clear 'a/c with bank' work field)   171057
      *                                                                   171057
     C                     MOVEL@DSED1    @DSED2                          171057
     C                     MOVELSPI       @SPI                            171057
     C           *LIKE     DEFN OSAC      #OSAC                           171057
     C                     MOVELOSAC      #OSAC                           171057
     C           *LIKE     DEFN AWBN      @AWBN                           171057
     C                     CLEARAWBN                                      171057
      *                                                                   171057
      ** ... and attempt to find the associated deal                      171057
      *                                                                   171057
     C           DLNO      CHAINDEALS                50                   171057
      *                                                                   171057
      ** ... restore field details (saving 'a/c with bank')               171057
      *                                                                   171057
     C                     MOVELAWBN      @AWBN                           171057
     C                     MOVEL@DSED2    @DSED1                          171057
     C                     MOVEL@SPI      SPI                             171057
     C                     MOVEL#OSAC     OSAC                            171057
      *                                                                   171057
      ** ... and skip output if 'a/c with bank' is set.                   171057
      *                                                                   171057
     C           @AWBN     IFNE *BLANKS                    --- B222       171057
     C                     SETON                     28                   171057
     C                     GOTO END                                       171057
     C                     ENDIF                           --- E222       171057
     C                     ENDIF                           --- E111       171057
     C                     ENDIF                           --- E000       171057
      *                                                                   171057
      ** If deal is a Nostro Transfer.                                    171057
      *                                                                   171057
     C           DTYP      IFEQ 'NX'                                      171057
     C                     MOVE '1'       *IN28                           171057
     C                     GOTO END                                       171057
     C                     END                                            171057
      *                                                                   171057
      ** Bypass event with Settled in another currency = 'Y'              171057
      *                                                                   171057
     C           SIAC      IFEQ 'Y'                                       171057
     C                     MOVE '1'       *IN28                           171057
     C                     GOTO END                                       171057
     C                     ENDIF                                          171057
      *                                                                   171057
      ** If settlement type is 04                                                             196260
      *                                                                                       196260
     C           SETP      IFEQ '04'                                                          196260
     C                     MOVE '1'       *IN28                                               196260
     C                     GOTO END                                                           196260
     C                     ENDIF                                                              196260
      *                                                                                       196260
0249 C*****SETTLEMENT TYPE MUST NOT BE '03' OR '06'                       S01153
0250 C***********SETP      COMP 3                        33               S01153
0251 C**N33******SETP      COMP 6                        33               S01153
0252 C***33******          GOTO END                                       S01153
0253 C***********                                                         S01153
0254 C*****MUST*NOT BE OPTION EVENT WITH ZERO BALANCE                     S01153
0255 C***********ETYP      COMP '12V1'                   34               S01153
0256 C**N34******ETYP      COMP '12V2'                   34               S01153
0257 C***********          SETOF                     40                   S01153
0258 C***34*32***          SETON                     40                   S01153
0259 C***40******          GOTO END                                       S01153
0260 C**
0261 C*****IF DETAILS TO REPORT EXIST, SET INDICATOR                      S01117
0262 C*****                SETON                     31                   S01117
0263 C*
0264 C*    COMPARE C/P CUSTOMER NO. AND CUSTOMER NO.
0265 C***********CPCN******COMP CNUM                 2222                 S01194
     C                     MOVELCPCN      @CPCN   6                       S01194
0265 C           @CPCN     COMP CUNR                 2222                 S01194
0266 C*
0267 C*    IF DIFFERENT ACCESS CUSTOMER MASTER FILE FOR DETAILS.
0268 C***22****************MOVELCPCN      CLTKEY                          S01194
0268 C   22                MOVELCPCN      KEY1                            S01194
0269 C   22                EXSR CLTCHN
0270 C   22N04             GOTO ERROR
0271 C*
0272 C*    OBTAIN EVENT NARRATIVE FROM TABLE.
0273 C           ETYP      LOKUPTABETY    TABENA         23
0274 C   23                MOVE TABENA    EVNAR  10
0275 C  N23                MOVE BLNK10    EVNAR
0276 C*
0277 C*    CHECK IF AMENDMENT EVENT
0278 C           ETYP      LOKUPTABAEV                   29
0279 C*
0280 C*    CONVERT EVENT DATE TO DDMMMYY FORMAT.
0281 C                     Z-ADDEDAT      ZDAYNO
0282 C                     EXSR ZDATE2
0283 C*
0284 C*    CHECK INCOMING/OUTGOING INDICATOR.
0285 C           INOI      COMP 'O'                      24
     C/COPY WNCPYSRC,DL0670C001
     C*
     C**   CHECK BENEFICIARY BANK DETAILS
     C*
     C**   IGNORE IF SPECIAL INSTRUCTIONS IS BLANK
     C   27                GOTO BENEND
     C*
     C           SPEC5     COMP '/BEN/'              353536
     C   35                GOTO BENEND
     C*
     C**   CHECK FOR CHIPS NUMBER
     C           SPEC8     COMP '/CH'                    35
     C   35                MOVE SPEC14    WORK6   6
     C   35                MOVE *BLANKS   SPI
     C   35                MOVE 'CHIPS'   SPEC5
     C   35                MOVE WORK6     SPEC12
     C   35                GOTO BENEND
     C*
     C**   CHECK FOR FED. WIRE NUMBER
     C           SPEC8     COMP '/FW'                    35
     C   35                MOVE SPEC17    WORK9   9
     C   35                MOVE *BLANKS   SPI
     C   35                MOVE 'FED.WIRE'SPEC9
     C   35                MOVE WORK9     SPEC18
     C   35                GOTO BENEND
     C*
     C**   MUST NOW BE 'ACCOUNT'
     C                     MOVE SPEC35    WORK30 30
     C                     MOVE *BLANKS   SPI
     C                     MOVE 'A/C'     SPEC3
     C                     MOVE WORK30    SPEC34
     C*
     C           BENEND    TAG                             * BENEND TAG *
     C*
0286 C*
0287 C*    INCREMENT COUNT OF RECORDS WRITEN.
     C           DLNO      IFEQ @DLNO                                     049265
     C           EVNAR     ANDEQ@EVNR                                     049265
     C           ZADATE    ANDEQ@EDAT                                     049265
     C           SETP      ANDEQ@SETP                                     049265
     C           OSAC      ANDEQ@OSAC                                     049265
     C           TSEN      ANDEQ@TSEN                                     049265
     C                     MOVE '0'       *IN02                           049265
     C                     ELSE                                           049265
     C                     MOVE DLNO      @DLNO   60                      049265
     C                     MOVE EVNAR     @EVNR  10                       049265
     C                     MOVE ZADATE    @EDAT   7                       049265
     C                     MOVE SETP      @SETP   2                       049265
     C**********           MOVE OSAC      @OSAC  12                                    049265 CGL029
     C                     MOVE OSAC      @OSAC  18                                           CGL029
     C                     MOVE TSEN      @TSEN  10                       049265
0288 C*****      RRIT      ADD  1         RRIT    50                      S01117
0288 C***02*58   RRIT      ADD  1         RRIT    50               S01117 LN0232
0288 C***02*58   WRIT      ADD  1         WRIT                     E147   LN0232
     C***********                                                   LN0232LN1050
     C************IN02     IFEQ '1'                                 LN0232LN1050
     C************IN58     ANDEQ'1'                                 LN0232LN1050
     C***********RRIT      ADD  1         RRIT    50                LN0232LN1050
     C***********WRIT      ADD  1         WRIT                      LN0232LN1050
     C***********                                                   LN0232LN1050
     C***SAVE*LEVEL BREAK CHANGE IN *IN38                           LN0613LN1050
     C***********                                                   LN0613LN1050
     C************INL1     IFEQ '1'                                 LN0613LN1050
     C***********          MOVE '1'       *IN38                     LN0613LN1050
     C***********          END                                      LN0613LN1050
     C************IN38     IFEQ '1'                                 LN0613LN1050
     C***********                                                   LN0613LN1050
     C***SET*OFF**IN38                                              LN0613LN1050
     C***********                                                   LN0613LN1050
     C***********          MOVE '0'       *IN38                     LN0613LN1050
     C*                                                                   LN1050
     C** AS THERE IS A DETAIL TO BE PRINTED NEED P1 REPORT OPENED         LN1050
     C** CHANGE P1 REPORTS IF CHANGE OF BRANCH OR HAS BEEN A CHANGE OF    LN1050
     C** BRANCH BUT PREVIOUS DETAILS NOT PRINTED                          LN1050
     C*                                                                   LN1050
     C           *INL1     IFEQ '1'                                       LN1050
     C           *IN38     OREQ '1'                                       LN1050
     C*                                                                   LN1050
     C                     SETOF                     38                   LN1050
     C                     SETON                     L1                   LN1050
     C                     CLOSEDL0670P1                                  LN0613
     C           BRNCH     IFEQ 'ALL'                                     LN0613
     C           BRNCH     OREQ EBRC                                      LN0613
     C                     SETON                     58    ALLOW OUTPUT   LN0613
     C                     OPEN DL0670P1                                  LN0613
     C**                                                                  LN0613
     C                     Z-ADD0         PAGE                            LN0613
     C***********          Z-ADD0         WRIT    50                LN0613LN1050
     C           RRIT      ADD  1         RRIT    50                      LN1050
     C** ENSURE REPORT SPOOL FILE RECORDED BY RCF                         LN0613
     C*                                                                   LN0613
      ** TRANSFER BINARY DATA INTO NUMERIC FIELD                          LN0613
     C                     Z-ADDSFNUM     ZSNUM   60                      LN0613
     C                     CALL 'ZSFILE'                                  LN0613
     C                     PARM           SEQ                             LN0613
     C                     PARM EBRC      @PARM   3                       LN0613
     C                     PARM           SFILE                           LN0613
     C                     PARM           ZSNUM                           LN0613
     C                     PARM *BLANK    ZSERR   1                       LN0613
     C*                                                                   LN0613
     C           ZSERR     IFEQ 'Y'                                       LN0613
     C                     SETON                     U7U8LR               LN0613
     C                     RETRN                                          LN0613
     C                     END                                            LN0613
     C**                                                                  LN0613
     C** To get Branch Name :                                             LN0613
     C**********           CALL 'AOBRCHR0'                                             LN0613 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       LN0613
     C                     PARM '*KEY   ' @OPTN   7                       LN0613
     C                     PARM EBRC      @DSNB   3                       LN0613
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        LN0613 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    LN0613
     C                     MOVEL'SDBRCHPD'DBFILE 10        ************   LN0613
     C                     MOVEL'03'      DBASE   2        * DBERR 03 *   LN0613
     C                     MOVEL@OPTN     DBOPTN  7        ************   LN0613
     C                     MOVELEBRC      DBKEY  29                       LN0613
     C                     EXSR *PSSR                                     LN0613
     C                     GOTO ERROR                                     LN0613
     C                     END                                            LN0613
     C                     ELSE                                           LN0613
     C                     SETOF                     5831                 LN0613
     C                     END                                            LN0613
     C                     END                                            LN0613
0260 C**                                                                  LN0613
     C*                                                                   LN0613
     C***********WRIT      IFEQ 1                                   LN0232LN1050
     C************INL1     ANDEQ'0'                                 LN0232LN1050
     C***********          SETON                     L1             LN0232LN1050
     C***********          END                                      LN0232LN1050
     C***********                                                   LN0232LN1050
     C***********          END                                      LN0232LN1050
     C***********                                                   LN0232LN1050
     C                     END                                            049265
0289 C                     GOTO END
0290 C*
0291 C*    SET ERROR INDICATORS.
0292 C           ERROR     TAG                             ** ERROR TAG **
0293 C*********************SETON                     U7U8                 S01194
0293 C                     SETON                     U7U8LR               S01194
0294 C*
0295 C           END       TAG                             ** END TAG **
     C*                                                                   E147
0261 C**   IF DETAILS TO REPORT EXIST, SET INDICATOR                      E147
     C***********WRIT      COMP 0                    31               E147LN1050
     C           RRIT      COMP 0                    31                   LN1050
     C*                                                                   LN1050
     C** CHANGE OF BRANCH BUT FIRST DETAIL FOR THAT BRANCH DOES NOT       LN1050
     C** NEED PRINTING                                                    LN1050
     C*                                                                   LN1050
     C           *INL1     IFEQ '1'                                       LN1050
     C           *IN28     ANDEQ'1'                                       LN1050
     C                     SETON                     38                   LN1050
     C                     END                                            LN1050
0296 C*
0297 C*    TOTAL TIME CALCULATIONS
     C**                                                                  S01117
     C** ENSURE TOTALS SPOOL FILE RECORDED BY RCF                         S01117
     C*                                                                   S01117
      ** TRANSFER BINARY DATA INTO NUMERIC FIELD                          S01117
     CLR                   Z-ADDSFNUMU    ZSNUMU  60                      S01117
     CLR                   CALL 'ZSFILE'                                  S01117
     CLR                   PARM           SEQ                             S01117
     CLR                   PARM *BLANK    @PARM                           S01117
     CLR                   PARM           SFILEU                          S01117
     CLR                   PARM           ZSNUMU                          S01117
     CLR                   PARM *BLANK    ZSERR                           S01117
     C*                                                                   S01117
     CLR         ZSERR     IFEQ 'Y'                                       S01117
     CLR                   SETON                     U7U8                 S01117
     CLR                   RETRN                                          S01117
     CLR                   END                                            S01117
     C*                                                                   S01194
0298 CLR                   SETON                     OF
0299 C*****CHECK*IF FILE IS IN BALANCE.                                   S01153
0300 C*RNU7******NREC      COMP NORE                 U8U8                 S01153
0301 C*RNU7NU8***ZZTOTI    COMP HRWN                 U8U8                 S01153
0302 C*RNU7NU8***ZZTOTD    COMP HRDC                 U8U8                 S01153
0303 C*
0304 C********************************************************************
0305 C*************                                                       S01194
0306 C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD.** S01194
0307 C*************                                                       S01194
0308 C***********ZSYSTM****BEGSR                           *** ZSYSTM *** S01194
0309 C*************                                                       S01194
0310 C*****SET*UP*KEY*FOR*INSTALLATION*CONTROL*RECORD.*                   S01194
0311 C*************        MOVEL'01      'ZTABKY 12                       S01194
0312 C*************        MOVE '  10'    ZTABKY                          S01194
0313 C*************                                                       S01194
0314 C***********ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0315 C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0316 C*************                                                       S01194
0317 C*****CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.**                  S01194
0318 C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0319 C*************                                                       S01194
0320 C*************        ENDSR                                          S01194
0321 C*************                                                       S01194
0322 C*************                                                       S01194
0323 C********************************************************************
0324 C*    SR. TO ACCESS CLIENT MASTER FILE.
0325 C           CLTCHN    BEGSR                           *** CLTCHN ***
0326 C*
0327 C                     SETOF                     04
0328 C***********CLTKEY****CHAINCLINT                30
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           KEY1   10                       S01194
     C                     PARM           KYST    7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDCUSTPD'DBFILE 10        ************   S01194
     C                     MOVEL'02'      DBASE   2        * DBERR 02 *   S01194
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01194
     C                     MOVELKEY1      DBKEY                           S01194
     C                     MOVELKYST      DBKYST  7                       S01194
     C                     EXSR *PSSR                                     S01194
     C                     ELSE                                           S01194
     C                     MOVE '1'       *IN04                           S01194
     C                     END                                            S01194
0329 C*
0330 C                     ENDSR
0331 C********************************************************************
0332 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0333 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0334 C*
0335 CSR         GLZADD    BEGSR                           *** GLZADD ****
0336 C*
0337 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0338 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0339 C*
0340 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0341 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0342 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0343 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0344 C*
0345 CSR                   EXSR GLZSUM
0346 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0347 C*
0348 C********************************************************************
0349 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0350 C*                        GLZADD, GLZSUB, GLZCMP.
0351 C*          PARAMETERS PASSED -
0352 C*                     I/P ZZAMTI ZZAMTD
0353 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0354 C*
0355 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0356 C*
0357 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0358 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0359 CSR                   SETOF                     919293
0360 CSR                   SETOF                     949599
0361 C*
0362 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0363 CSR         ZZAMTI    COMP 0                      9293
0364 CSR 93      ZZAMTD    COMP 0                      9293
0365 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0366 C*
0367 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0368 CSR         ZZTOTI    COMP 0                      9193
0369 CSR 93      ZZTOTD    COMP 0                      9193
0370 C*
0371 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0372 CSR 93                Z-ADDZZAMTI    ZZTOTI
0373 CSR 93                Z-ADDZZAMTD    ZZTOTD
0374 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0375 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0376 CSR 91N92
0377 CORN91 92             GOTO ZZOFPS
0378 C*
0379 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0380 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0381 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0382 C*
0383 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0384 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0385 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0386 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0387 C*
0388 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0389 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0390 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0391 CSRN99                Z-ADDZZWK2     ZZTOTD
0392 CSRN99                Z-ADDZZWK3     ZZTOTI
0393 C*
0394 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0395 CSR 99                Z-ADD0         ZZAMT  153
0396 CSR                   GOTO ZZSEND
0397 C*
0398 C* THE 'SIGNS' ARE DIFFERENT
0399 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0400 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0401 C*
0402 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0403 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0404 C*
0405 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0406 C*
0407 CSR 91                Z-SUBZZTOTI    ZZTOTI
0408 CSR 91                Z-SUBZZTOTD    ZZTOTD
0409 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0410 C*
0411 CSR         ZZTOTI    COMP ZZAMTI               93  95
0412 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0413 C*
0414 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0415 CSR 95                Z-ADD0         ZZTOTI
0416 CSR 95                Z-ADD0         ZZTOTD
0417 CSR 95                GOTO ZZSEND
0418 C*
0419 C* IF ZZTOT GT. ZZAMT.
0420 CSR 93      ZZAMTD    COMP ZZTOTD               94
0421 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0422 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0423 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0424 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0425 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0426 C*
0427 C*
0428 C* IF ZZAMT GT. ZZTOT.
0429 CSRN93      ZZTOTD    COMP ZZAMTD               94
0430 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0431 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0432 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0433 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0434 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0435 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0436 C*
0437 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0438 CSR                   SETOF                     94
0439 CSR 93 91
0440 CORN93 92             SETON                     94
0441 CSR 94                Z-SUBZZTOTI    ZZTOTI
0442 CSR 94                Z-SUBZZTOTD    ZZTOTD
0443 C**
0444 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0445 CSR 92                Z-SUBZZAMTI    ZZAMTI
0446 CSR 92                Z-SUBZZAMTD    ZZAMTD
0447 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0448 C**
0449 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0450 CSR                   SETOF                     96
0451 CSR         ZZTOTD    COMP 0                        91
0452 CSR 91      ZZTOTI    COMP 0                      96
0453 CSR 96                MOVE '.000-'   ZZNEGD  5
0454 CSR                   ENDSR                             ** ENDSR **
0455 C********************************************************************
0456 C**
0457 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
0458 C**
0459 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
0460 C**
0461 C           ZDATE2    BEGSR                           *** ZDATE2 ***
0462 C**
0463 C**   CLEAR DATE FIELDS.
0464 C                     Z-ADD0         ZDATE   60
0465 C                     MOVEL'       ' ZADATE  7
0466 C**
0467 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
0468 C                     Z-ADDZDAYNO    ZDAYNO  50
0469 C**
0470 C**   DETERMINE YEAR NUMBER.
0471 C**
0472 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
0473 C           ZDAYNO    SUB  1         ZDAYN1  50   99
0474 C   99                GOTO ZDEND2
0475 C**
0476 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
0477 C           ZDAYN1    DIV  1461      ZLYR    20
0478 C                     MVR            ZDAYN1           SAVE REMAINING
0479 C**                                                   DAYS
0480 C**   CALCULATE NUMBER OF REMAINING YEARS.
0481 C                     Z-ADD1         ZWRK2   20
0482 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
0483 C           ZDAYN1    COMP ZYDY,ZWRK2             90
0484 C  N90      ZWRK2     ADD  1         ZWRK2
0485 C  N90                GOTO ZDTAG1
0486 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
0487 C**
0488 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
0489 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
0490 C**
0491 C**   CALCULATE ACTUAL YEAR NUMBER.
0492 C           ZLYR      MULT 4         ZWRK3   30
0493 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
0494 C                     Z-ADDZWRK3     ZYEAR   20
0495 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
0496 C**
0497 C**   DETERMINE MONTH NUMBER.
0498 C**
0499 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
0500 C                     SETOF                     9293
0501 C   91      ZDAYN1    COMP 59                     9293
0502 C   91N92   ZDAYN1    SUB  1         ZDAYN1
0503 C**
0504 C**   CALCULATE MONTH NUMBER.
0505 C                     Z-ADD2         ZWRK2
0506 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
0507 C           ZDAYN1    COMP ZMDY,ZWRK2             94
0508 C  N94      ZWRK2     ADD  1         ZWRK2
0509 C  N94                GOTO ZDTAG2
0510 C           ZWRK2     SUB  1         ZWRK2
0511 C**
0512 C                     Z-ADDZWRK2     ZMTH    20       MONTH
0513 C**
0514 C**   DETERMINE DAY OF MONTH.
0515 C**
0516 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
0517 C           ZDAYN1    ADD  1         ZDAYN1
0518 C**
0519 C**   CALCULATE DAY OF MONTH.
0520 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
0521 C**
0522 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
0523 C   93      ZDAY      ADD  1         ZDAY
0524 C**
0525 C**   FORMAT DATE, DDMMYY OR MMDDYY.
0526 C  N98                MOVELZDAY      ZWRK4   40
0527 C   98                MOVE ZDAY      ZWRK4
0528 C  N98                MOVE ZMTH      ZWRK4
0529 C   98                MOVELZMTH      ZWRK4
0530 C                     MOVELZWRK4     ZDATE
0531 C                     MOVE ZYEAR     ZDATE
0532 C**
0533 C**   FORMAT ALPHA DATE, DDMMMYY.
0534 C           ZDAY      COMP 10                     95
0535 C                     MOVELZDAY      ZWRK5   5
0536 C   95                MOVEL' '       ZWRK5
0537 C                     MOVE ZMNM,ZMTH ZWRK5
0538 C                     MOVELZWRK5     ZADATE
0539 C                     MOVE ZYEAR     ZADATE
0540 C**
0541 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
0542 C**
0543 C**
0597 C*****************************************************************   S01117
     C*                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
     C*                                                                   S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
0597 C*****************************************************************   S01194
0545 C/EJECT
0546 O*L0670P1H**203   01                                                 S01117
0547 O*******OR**203   OF                                                 S01117
0548 O***********                        22 'REFERENCE DL0670'            S01117
0546 O*L0670P1H**203***L1*58**                                      S01117E147
0547 O*******OR**203***OF*58**                                      S01117E147
0546 O*DL0670P1H* 203   L1 58 31                                      E147LN1050
0547 O*******OR**203   OF 58 31                                       E147LN1050
0546 ODL0670P1H  203   L1 58N38                                           LN1050
0547 O       OR  203   OF 58N38                                           LN1050
0548 O                                   24 'REFERENCE DL0670P1'          S01117
0549 O*************************TITL      89                               S01194
0549 O                         BJURPT    89                               S01194
0550 O                                  104 'DATE'
0551 O*************************RUNA     112                               S01194
0551 O                         BJMRDT   112                               S01194
0552 O                                  122 'PAGE'
0553 O                         PAGE     127
0554 O********H**1     01                                                 S01117
0555 O*******OR**1     OF                                                 S01117
0554 O********H**1*****L1*58**                                      S01117E147
0555 O*******OR**1*****OF*58**                                      S01117E147
0554 O********H**1     L1 58 31                                       E147LN1050
0555 O*******OR**1     OF 58 31                                       E147LN1050
     O        H  1     L1 58N38                                           LN1050
     O       OR  1     OF 58N38                                           LN1050
0556 O                                   67 'OUTSTANDING DELIVERY '
0557 O                                   79 'INSTRUCTIONS'
0558 O********H**2     01                                                 S01117
0559 O*******OR**2     OF                                                 S01117
0558 O********H**2*****L1*58**                                      S01117E147
0559 O*******OR**2*****OF*58**                                      S01117E147
0558 O********H**2     L1 58 31                                       E147LN1050
0559 O*******OR**2     OF 58 31                                       E147LN1050
     O        H  2     L1 58N38                                           LN1050
     O       OR  2     OF 58N38                                           LN1050
0560 O                                   67 '---------------------'
0561 O                                   79 '------------'
0558 O********H**2*****L1*58**                                      S01117E147
0559 O*******OR**2*****OF*58**                                      S01117E147
0558 O********H**2     L1 58 31                                       E147LN1050
0559 O*******OR**2     OF 58 31                                       E147LN1050
     O        H  2     L1 58N38                                           LN1050
     O       OR  2     OF 58N38                                           LN1050
     O                                   12 'BRANCH'                      S01117
     O                         EBRC      16                               S01117
     O                         A8BRNM    48                               S01117
     O/COPY WNCPYSRC,DL0670O001
0562 O********H**1     01                                                 S01117
0563 O*******OR**1     OFNLR                                              S01117
0562 O********H**1*****L1*58**                                      S01117E147
0563 O*******OR**1*****OFNLR*58                                     S01117E147
0562 O********H**1     L1 58 31                                       E147LN1050
     O        H  1     L1 58N38                                           LN1050
0563 O       OR  1     OFNLR 58                                           E147
0563 O*******AND*      31                                             E147LN1050
     O       AND      N38                                                 LN1050
0564 O                                   68 'DEAL           EVENT'
0565 O                                   83 'SETTL''T'
0566 O********H**2     01                                                 S01117
0567 O*******OR**2     OFNLR                                              S01117
0566 O********H**2*****L1*58**                                      S01117E147
0567 O*******OR**2*****OFNLR*58                                     S01117E147
0566 O********H**2     L1 58 31                                       E147LN1050
     O        H  2     L1 58N38                                           LN1050
0567 O       OR  2     OFNLR 58                                           E147
0563 O*******AND*      31                                             E147LN1050
     O       AND      N38                                                 LN1050
0568 O                                   14 'CUSTOMER'
0569 O                                   63 'NUMBER      TYPE'
0570 O                                   81 'DATE     TYPE'
0571 O                                  100 'OUR REC/PAY'
0571 O**********                        104 'BR'                                       S01117 CGL029
     O                                  107 'BR'                                              CGL029
0572 O                                  122 'THEIR PAY/REC'
0573 O********D**1*****02N28                                        S01153S01117
0573 O        D  1     02N28 58                                           S01117
0573 O********D**1     02 21N28                                           S01153
0574 O*******AND*     N33N40                                              S01153
0574 O*******AND*      31                                             E147LN1050
0575 O*************************CNUM       9                               S01117
0575 O                         CUNR       9                               S01117
0576 O                         CRNM      31
0577 O                         CTWN      42
0578 O                         DLNO      53
0579 O                 29                54 '*'
0580 O                         EVNAR     66
0581 O                         ZADATE    74
0582 O                         SETP      80
0583 O**********               OSAC     100                                                   CGL029
0571 O**********               OSBR     104                                            S01117 CGL029
     O                         OSAC     104                                                   CGL029
     O                         OSBR     107                                                   CGL029
0584 O                         TSEN     122
     O/COPY WNCPYSRC,DL0670O002
0585 O        D  1     02 24N26                                           S01153
0586 O*******AND*     N28 58 31                                       E147LN1050
     O       AND      N28 58                                              LN1050
0586 O*******AND      N28                                           S01153S01117
0586 O*******AND******N28*58**                                      S01117E147
0585 O********D**1     02 21 24                                           S01153
0586 O*******AND*     N26N28N33                                           S01153
0587 O*******AND*     N40                                                 S01153
0588 O                                   86 'FOR A/C OF'
0589 O                         FACO      98
0590 O        D  1     02 24N27                                           S01153
0591 O*******AND******N28                                           S01153S01117
0591 O*******AND*     N28 58 31                                       E147LN1050
     O       AND      N28 58                                              LN1050
0591 O*******AND******N28*58**                                      S01117E147
0590 O********D**1     02 21 24                                           S01153
0591 O*******AND*     N27N28N33                                           S01153
0592 O*******AND*     N40                                                 S01153
0593 O                                   86 'SPECIAL INSTRUCTIONS'
    OO                 36                86 'BENEFICIARY BANK    '
0594 O                         SPI      123
0595 O*****   T   30   LRNU7N31                                           S01117
0596 O*****                              60 '***  NO DETAILS TO '         S01117
0597 O*****                              71 'REPORT  ***'                 S01117
     O        T 3      L1 58NU7                                           S01117
     O*******AND*      31                                             E147LN1050
     O       AND      N38                                                 LN1050
     O***********                        71 '*** END OF BRANCH REPORT'    LN0813
     O***********                        75 ' ***'                        LN0813
     O                                   71 '*** END OF REPORT FOR '      LN0813
     O                                   81 'BRANCH ***'                  LN0813
0624 O        T        LR U7 U8                                           S01117
0625 O                                   22 'REFERENCE DL0670'            S01117
0626 O                                   62 'PRINT TERMINTATED, '         S01117
0627 O                                   80 'DATABASE IN ERROR.'          S01117
0598 O********TF00*****LRNU7
0546 ODL0670AUH  203   01                                                 S01117
0548 O                                   24 'REFERENCE DL0670AU'          S01117
0549 O*************************TITL      89                         S01117
0549 O                         BJURPT    89                               S01194
0550 O                                  104 'DATE'                        S01117
0551 O*************************RUNA     112                         S01117S01194
0551 O                         BJMRDT   112                               S01194
0552 O                                  122 'PAGE'                        S01117
0553 O                                  127 '1'                           S01117
0554 O        H  1     01                                                 S01117
0556 O                                   67 'OUTSTANDING DELIVERY '       S01117
0557 O                                   79 'INSTRUCTIONS'                S01117
0558 O        H  2     01                                                 S01117
0560 O                                   67 '---------------------'       S01117
0561 O                                   79 '------------'                S01117
0599 O        T  235   LRNU7
0600 O                                   18 'RUN CONTROLS'
0601 O        T  2     LRNU7
0602 O                                   59 'NUMBER'
0603 O                                   84 'VALUE'
0604 O        T  2     LRNU7
0605 O                                   27 'SORTED EVENTS FILE '
0606 O***********                        40 'RECORDS INPUT'               S01153
0606 O                                   47 'DETAIL RECORDS INPUT'        S01153
0607 O                         NREC  3   59
0608 O                         ZZTOTIZ   81
0609 O                         ZZTOTD    84
0610 O                 U8                88 '***'
0611 O********T**2     LRNU7                                              S01153
0612 O***********                        27 'SORTED EVENTS FILE '         S01153
0613 O***********                        41 'CONTROL TOTALS'              S01153
0614 O***********              NORE  3   59                               S01153
0615 O***********              HRWN  Z   81                               S01153
0616 O***********              HRDC      84                               S01153
0617 O***********      U8                88 '***'                         S01153
0618 O        T  3     LRNU7
0619 O                                   31 'RECORDS LISTED IN THIS '
0620 O                                   37 'REPORT'
0621 O                         RRIT  3   59
     O********T**3     LRNU7 U8                                           S01153
0623 O***********                        71 '*** DIFFERENCE ***'          S01153
0595 O********T   30   LRNU7N31
0596 O********                           60 '***  NO DETAILS TO '
     O********                           71 'REPORT  ***'
     O        T 30     LRNU7N31                                           E131
     O                                   64 '***  NO DETAILS TO '         E131
     O                                   75 'REPORT  ***'                 E131
     O        T 3      LR U7 U8                                           S01117
     O                                   71 '*** PRINT TERMINATED ***'    S01117
     O        T 1      LR U7 U8                                           S01117
     O                                   57 'DATABASE ERROR'              S01117
     O                         DBASE     61                               S01117
     O                                   67 'FILE'                        S01117
     O                         DBFILE    78                               S01117
     O        T 13     LR U7 U8                                           S01117
     O                                   46 'KEY'                         S01117
     O                         DBKEY     76                               S01117
    EO*****   T        LRNU7                                              S01117
    EO********T 2      LRNU7                                        S01117LN0135
    EO******************************     71 '***  END OF REPORT ***'      LN0135
0624 O********T        LR U7 U8                                           S01117
0625 O********                           22 'REFERENCE DL0670'            S01117
0626 O********                           62 'PRINT TERMINTATED, '         S01117
0627 O********                           80 'DATABASE IN ERROR.'          S01117
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**    TABETY/TABENA   EVENT TYPE/NAME
11V1VALUE
11VXVALUE                                                                 CEU003
11V2VALUE
11VYVALUE                                                                 CEU003
12V1OP MAT
12VXOP MAT                                                                CEU003
12V2OP MAT
12VYOP MAT                                                                CEU003
13V1OT VALUE
13VXOT VALUE                                                              CEU003
13V2OT VALUE
13VYOT VALUE                                                              CEU003
14V1SW VALUE
14VXSW VALUE                                                              CEU003
14V2SW VALUE
14VYSW VALUE                                                              CEU003
15V1START
15VXSTART                                                                 CEU003
15I2INT PAY
15IYINT PAY                                                               CEU003
15M1MATURITY
15MXMATURITY                                                              CEU003
15V3INCREASE
15VZINCREASE                                                              CEU003
15M4DECREASE
15MZDECREASE                                                              CEU003
16V1START
16VXSTART                                                                 CEU003
16I2INT PAY
16IYINT PAY                                                               CEU003
16M1MATURITY
16MXMATURITY                                                              CEU003
16M4DECREASE
16MZDECREASE                                                              CEU003
17V1NIA VALUE
17VXNIA VALUE                                                             CEU003
17I2INT PAY
17IYINT PAY                                                               CEU003
17M1MATURITY
17MXMATURITY                                                              CEU003
17V3N/A VALUE
17VZN/A VALUE                                                             CEU003
18M1N/A SALE
18MXN/A SALE                                                              CEU003
16V3INCREASE
16VZINCREASE                                                              CEU003
21I1INT PAY
21IXINT PAY                                                               CEU003
21N1INT PAY
21N2INT PAY
22I1INT PAY
22IXINT PAY                                                               CEU003
22N1INT PAY
22N2INT PAY
23I1INT PAY
23IXINT PAY                                                               CEU003
23N1INT PAY
23N2INT PAY
24I1INT PAY
24IXINT PAY                                                               CEU003
24N1INT PAY
24N2INT PAY
**   TABAEV - AMENDMENT EVENT
15V3
15VZ                                                                      CEU003
15M4
15MZ                                                                      CEU003
16V3
16VZ                                                                      CEU003
16M4
16MZ                                                                      CEU003
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
