0001 H        1
0002 F****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Exposure by cust of risk by brch/cpy')        *
/**VRF*:*OVRDBF*FILE(EVLP)*TOFILE(EVLOBP)***************************:**   CDL002
/**VRF*:*OVRDBF*FILE(EVLN)*TOFILE(EVLCBN)***************************:**   CDL002
/*OVRF*: OVRDBF FILE(EVLP) TOFILE(EVLBBP)                           : *   CDL002
/*OVRF*: OVRDBF FILE(EVLN) TOFILE(EVLBBN)                           : *   CDL002
/*OVRF*: OVRDBF FILE(FXNEVTP) TOFILE(FXNEVTL1)                      : *   CDL002
/*OVRF*: OVRDBF FILE(FXNEVTN) TOFILE(FXNEVTL2)                      : *   CDL002
0002 F****************************************************************
0004 F*                                                              *
     F*  Midas - Dealing Module                                      *
0004 F*                                                              *
0005 F*  DL0761 - CUSTOMER EXPOSURE AGAINST LIMITS-BY CO OR BR       *
0005 F*           CALLED BY DLC806OA OR DLC806BA ACCORDING TO MENU   *
0005 F*           SELECTION OF ORIGINATING BRANCH OR BOOKING BRANCH; *
0005 F*           PROMPT PROGRAM USED IS DL0806A WITH DSPF DL806AFM. *
0006 F*                                                              *
      *  (c) Finastra International Limited 2001                      *
     F*                                                              *
      *  Last Amend No. EMP104             Date 23Apr20               *
      *  Prev Amend No. MD058285           Date 22Jun21               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 03Nov03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 200925             Date 07Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 144668             Date 30Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 166671             Date 28Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 126977             Date 08Dec97              *
      *                 099275             Date 12Feb98              *
     F*                 124759             DATE 30OCT97               *
     F*                 CDL002             DATE 16SEP97              *
     F*                 099251             DATE 24FEB97              *
     F*                 076018             DATE 09OCT95              *
     F*                 080947             DATE 09OCT95              *
     F*                 S01408             DATE 07APR95              *
     F*                 S01498             DATE 10AUG94              *
     F*                 067533             DATE 09MAR94               *
     F*                 065015             DATE 24DEC93              *
     F*                 S01433             DATE 04OCT93              *
     F*                 S01393             DATE 11AUG92              *   *
     F*                 E38323             DATE 29JUL92              *
     F*                 LN0633             DATE 15AUG90              *
     F*                      LN0632             DATE  15AUG90        *
     F*                      LN0618             DATE  10AUG90        *
     F*                      LN0363             DATE  13JUN90        *
     F*                      LN0226             DATE  05JUN90        *
     F*            AMEND NO. E309               DATE  10APR90        *
     F*            AMEND NO. E204               DATE  27MAR90        *
     F*            AMEND NO. S01157             DATE  09MAR90        *    S01157
     F*            AMEND NO. E131               DATE  24NOV89        *
     F*                      E100               DATE  1DEC89         *
0008 F*                      E99                DATE  24NOV89        *
0008 F*                      E00014             DATE  01NOV89        *    E00014
0010 F*                                                              *
     F*****************************************************************
     F*  ANY CHANGES MADE TO THIS PROGRAM SHOULD ALSO BE MADE TO      *
     F*                    DL0761A                                    *
     F*****************************************************************
     F*                                                               *
      *  EMP104 - Remove FX/IRS Exposures and Limits                  *
      *           (Upgrade NADC02 to FM2.1 SP23)                      *
      *           Amendment of core hooks DL0761C005 and DL0761C010   *
      *           Addition of hooks EMP104_028 to EMP108_033          *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance Receive Settlement Instructions             *
      *           (Recompiled)                                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Correct parameters on program calls                 *
      *  200925 - Component DLC806BA was looping when there are seve- *
      *           ral records in FXNEVTPD to be processed prior to the*
      *           records in EVNTXED. Don't save and restore the det- *
      *           ails read from SR/NEVTD as it cause other records in*
      *           FXNEVTPD not to be processed and loop on SR/NEVT2.  *
     F*  144668 - Include all limits in the report DL0761P1 if the    *
     F*           user indicated 'N' in the option "Show limits in    *
     F*           excess only (Y/N)" during request.                  *
     F*  166671 - Applied fix 156827:                                 *
     F*           Set off overflow indicator right after EXCPT TRAILR *
     F*           and before closure of DL0761P1 to prevent I/O       *
     F*           operation applied to closed file DL0761P1.          *
      *  CDL006 - Dealing Fiduciary                                   *
     F*  126977 - Prevent looping if only one Net Event               *
     F*  099275 - Applied fix 075099:                                 *
     F*           Program attempts to write to DL0761P1 which was     *
     F*           closed. This is happening when exception report     *
     F*           trying to write record before opening printer file. *
     F*  124759 - Overflow indicator OF is always set off everytime   *
     F*           DL0761P1 is opened disallowing the header and the   *
     F*           page to be printed (DL0761P1H).                     *
     F*  CDL002 - FX Netting. Exclude netted FX deal events and       *
     F*           include FX net events.                              *
     F*  099251 - Different exposure amount shown on the report       *
     F*           and on exception report.                            *
     F*  076018 - Indicators 46 and 47 are not being set off          *
     F*           in subroutines FRWRIT and IRWRIT causing Parent     *
     F*           no to be produced at odd times.                     *
     F*  080947 - Prevent zero excess FRA/IRS's being printed         *
     F*  S01408 - Addition of core hooks DL0761CCPG                   *
     F*                                  DL0761CCP1                   *
     F*  S01498 - Portfolio Lending Upgrade to Release 10.            *
     F*           Ensure LB clients are printed when Portfolio        *
     F*           Lending is on and LB Clients are to be reported.    *
     F*  067533 - Set up Overflow Line correctly in the Print File    *
     F*           definition instead of amending it in the RPG code.  *
     F*  065015 - Producing 'No Details to Report' at wrong           *
     F*         - time on the report, fix also in DL0761a.            *
     F*  S01433 - Enhanced processing to include precious metals      *
     F*           and money market deals on the report                *
     F*           (NB. This function is to remain switchable until    *
     F*           after Alpha-site testing, when it will become       *
     F*           mandatory. At this point DL0761A  will be           *
     F*           renamed to DL0761 and the old version discarded.    *
     F*           Meanwhile version with SAR = DL0761A, without =     *
     F*           DL0761).                                            *
     F*  S01393 - Recompiled for Strategic Risk Management            *
     F*           Book Code added to PF/EVNTXED                       *
     F*  E38323 - Recompilation of the program done due to a          *
     F*           change in subroutine ZFWDT                          *
     F*  LN0633 - CUSTOMER HEADINGS NOT DISPLAYED FOR FRA/IRS         *
     F*  LN0632 - EXPOSURE AND LIMITS ARE NOT CALCULATED              *
     F*           PROPERLY FOR FRA/IARS                               *
     F*  LN0618 - CALL OF SUBROUTINES TO PROCESS FRA/IRS IS NOT       *
     F*           CONDITIONED PROPERLY                                *
     F*  LN0363 - WAS NOT CLEARING @PREV SO FILE OPEN/CLOSED AND      *
     F*           PAGE RESET FOR EVERY NON-PARENT DETAIL PRINTED      *
     F*  LN0226 - INCORPORATE FURTHER CHANGES MADE FOR                *
     F*           R10 - FRA/IRS.  S01117, S01194, S01157 ETC.         *
     F*  E309   - ASSUMES LAST LIMIT PERIOD WILL BE 999, ACTUALLY     *
     F*           IF LEFT BLANK WILL DEFAULT TO 000                   *
     F*  E204   - CORRECT PAGE SKIP FOR BCH/CUST CHG, AND ENSURE      *
     F*            PARENT/NON PARENT TEXT ALWAYS APPEARS              *
     F*  S01157 - FRA/IRS INCORPORATION                               *
     F*  S01117/E131 - CENTRE REPORT TITLES                           *
     F*  E100   - CALL #ZZ TO READ BANK DETAILS IF NO RECORDS         *
     F*           READ                                                *
     F*  E99    - 'NO DETAILS' MSG INCORRECTLY POSITIONED IN          *
     F*           AUDIT REPORT                                        *
     F*  E00014 - MOVE OF THE OPENING OF DL0761P1 TO WITHIN           *
     F*           SUBROUTINES FXWRIT AND LEWRIT TO MAKE SURE          *
     F*           ONLY OPENED WHEN THERE ARE DETAILS TO PRINT         *
     F*                                                               *
     F*  065015 - Producing 'No Details to Report' at wrong           *
     F*         - time on the report, fix also in DL0761a.            *
     F*  S01433 - Enhanced processing to include precious metalS      *
     F*           and money market deals on the report                *
     F*           (NB. This function is to remain switchable until    *
     F*           after Alpha-site testing, when it will become       *
     F*           mandatory. At this point DL0761A  will be           *
     F*           renamed to DL0761 and the old version discarded.    *
     F*           Meanwhile version with SAR = DL0761A, without =     *
     F*           DL0761).                                            *
     F*                                                               *
     F*  S01393 - Recompiled for Strategic Risk Management            *  *
     F*           Book Code added to PF/EVNTXED                       *  *
0010 F*  E38323 - Recompilation of the program done due to a          *
     F*               R10 - FRA/IRS.  S01117, S01194, S01157 ETC.    *
     F*                  ONLY OPENED WHEN THERE ARE DETAILS TO PRINT *    E00014
     F*                                                              *
     F*****************************************************************
     F*
     F* FILE OVERRIDES:
     F*       VS BRANCH LIMITS, ALL BRANCHES  EVLBBP,BBN OR OBP,OBN
     F*            "            ONE BRANCH             "
     F*       VS COMP. LIMITS, ALL COMPANIES  EVLCBP,CBN OR COP,CON
     F*            "            ONE COMPANY            "
     F*
     F*    -- WITH 'O' = USING TRANS. ORIGINATING BRANCH
     F*            'B' =  "     "     BOOKING BRANCH
     F*    -- FOR 'ONE BR','ONE CO' OPTIONS, FILE OVERRIDE TO THIS
     F*       BR OR CO IS DONE IN COMPONENT CL PGM
     F*       (DLC806OA OR DLC806BA DEPENDING ON ORIG. OR BOOK. BRANCH)
     F*
0011 F********************************************************************
0012 FEVLP    IP  E           K        DISK
0012 FEVLN    IS  E           K        DISK
      *                                                                   CDL002
     FFXNEVTP IF  E           K        DISK                           UC  CDL002
     F            FXNEVTD0                          KRENAMEFXNEVTP0       CDL002
     FFXNEVTN IF  E           K        DISK                           UC  CDL002
     F            FXNEVTD0                          KRENAMEFXNEVTN0       CDL002
      *                                                                   CDL002
      * Deals                                                             CDL002
     FDEALS   IF  E           K        DISK                           UC  CDL002
     F            DEALSDAF                          KIGNORE               CDL002
     F/COPY WNCPYSRC,DL0761F002
     F*********** DEALSDCF                          KIGNORE        CDL002 CDL006
     F            DEALSDDF                          KIGNORE               CDL002
     F            DEALSDEF                          KIGNORE               CDL002
     F            DEALSDFF                          KIGNORE               CDL002
     F            DEALSDGF                          KIGNORE               CDL002
     F/COPY WNCPYSRC,DL0761F003
      *                                                                   CDL002
0014 FDL0761AUO   F     132     OA     PRINTER      KINFDS SPOOLU
     F***DL0761P1O** F     132     OF    LPRINTER      KINFDS SPOOL1  UC  067533
     FDL0761P1O   F     132     OF     PRINTER      KINFDS SPOOL1     UC  067533
     F/COPY WNCPYSRC,DL0761F001
     F* 01,46             PARENT EVENT
     F* 02,47             NON-PARENT EVENT
     F* 30                FRA/IRS MODULE PRESENT IND.                     S01157
     F* 41                NO DETAILS
     F* 42                1ST CYCLE DONE
     F**43****************REPORT BY ONE ENTITY (BRANCH OR COMPANY)        E204
     F* 44                PARENT ON EVENT IS 0
     F* 45                REPORT IS VS BRANCH LIMITS
     F**48****************NO OUTPUT REQD FOR THIS ENTITY                  E204
     F* 48                PROCESS THIS DETAIL RECORD                      E204
     F* 50                CUSTOMER HEADINGS NOT OUTPUT YET
     F* 51                NO DETAILS TO REPORT IF ON
     F* 52                RESETS PAGE NUMBER ON OPENING NEW PRINT FILE
     F* 53                FX LIMIT END DATE NON ZERO
     F* 54                LN   "     "        "
     F* 58                PRINT FILE P1 IS OPEN
     F* 60                ZERO EXPOSURE FOR CUSTOMER/ENTITY
     F* 70                EXPOSURE GTR THAN LIMIT(EXCEPTION REPORTS).
     F* 71                1ST PERIOD IS SPOT-BR/CO  LIM-FX
     F* 72                     "        "              -LN
     F* 83                FX Net Events Parent                            CDL002
     F* 84                FX Net Events Customer                          CDL002
     F* 85                No record on DEALS                              CDL002
     F* 86 87 88 89       WORK INDS
     F*
     F* L1                ENTITY - CO OR BR
     F* L2                CUSTOMER
     F*
     F* U1                FOR EXCEPTION REPORTS(SETON IN CALLING CL).
0295 E********************************************************************
     E                    CPY@    1   1 80
0015 E                    FCT     1   4  4 0
0016 E                    HCY        25  3
     E                    HDG     1   5 22
0071 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0072 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0073 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
0295 E********************************************************************
     E**   BR OR CO LEVEL LIMITS
0019 E**   SIX  ARRAYS FOR FX LIMITS
0020 E                    XFDA        6  3 0             PERIOD END DAYS
0021 E                    XFDT        6  5 0             PERIOD END DATES
0022 E                    XFLM        6  9 0             PERIOD LIMIT AMT.
0023 E                    XFXP        6 13 0             PERIOD EXPOS AMT.
0024 E                    XFXS        6 10 0             PERIOD EXCES AMT.
0025 E                    XFPC        6  3 2             PERIOD PERCENTGE.
0026 E**   SIX ARRAYS FOR LOANS LIMITS.
0027 E                    XLDA        6  3 0             PERIOD END DAYS
0028 E                    XLDT        6  5 0             PERIOD END DATES
0029 E                    XLLM        6  9 0             PERIOD LIMIT AMT.
0030 E                    XLXP        6 13 0             PERIOD EXPOS AMT.
0031 E                    XLXS        6 10 0             PERIOD EXCES AMT.
0032 E                    XLPC        6  3 2             PERIOD PERCENTGE
0295 E********************************************************************
     E**
     E**   BR OR CO LEVEL LIMITS
0035 E**   XFDA & XLDA DEFINED AS ALPHANUMERIC.
0036 E                    XFDAA       6  3
0037 E                    XLDAA       6  3
0719 E/COPY ZSRSRC,ZHOLE                                               ***
     E/COPY WNCPYSRC,DL0761E001
      **  Arrays for Fiduciary Deposits                                   CDL006
      *                                                                   CDL006
     E                    FIDA        6  3 0             PERIOD END DAYS  CDL006
     E                    FIDT        6  5 0             PERIOD END DATES CDL006
     E                    FILM        6  9 0             PERIOD LIMIT AMT.CDL006
     E                    FIXP        6 13 0             PERIOD EXPOS AMT.CDL006
     E                    FIXS        6 10 0             PERIOD EXCES AMT.CDL006
     E                    FIPC        6  3 2             PERIOD PERCENTGE CDL006
     E                    FIDAA       6  3                                CDL006
     E**
0295 I********************************************************************
0038 L***DL0761P1 66FL 54OL                                               067533
     L/COPY WNCPYSRC,DL0761L001
0040 IEVLPF       01
     I                                              ENTITYL2
     I                                              PTNU  L1
0088 I*
0040 IEVLNF       02
     I                                              ENTITYL2
     I                                              CUNR  L1
     I**
     ISPOOL1      DS
     I**   FILE INFORMATION DATA STRUCTURE
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I**
     ISPOOLU      DS
     I**   FILE INFORMATION DATA STRUCTURE
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I**
0295 I********************************************************************
0296 I**   BR/CO  LEVEL LIMITS
0297 I**   DATA STRUCTURES TO LINK XFDAA & XLDAA & INPUT FIELDS
0298 I            DS
0300 I                                        1  18 XFDAA
     I****************************************1***3*FLEP1                 CDL002
     I****************************************4***60FLEP2                 CDL002
     I****************************************7***90FLEP3                 CDL002
     I***************************************10**120FLEP4                 CDL002
     I***************************************13**150FLEP5                 CDL002
     I***************************************16**180FLEP6                 CDL002
     I                                        1   3 WFLEP1                CDL002
     I                                        4   60WFLEP2                CDL002
     I                                        7   90WFLEP3                CDL002
     I                                       10  120WFLEP4                CDL002
     I                                       13  150WFLEP5                CDL002
     I                                       16  180WFLEP6                CDL002
0302 I            DS
0304 I                                        1  18 XLDAA
     I/COPY WNCPYSRC,DL0761I001
     I                                        1  18 FIDAA                 CDL006
      *                                                                   CDL006
     I****************************************1***3*LLEP1                 CDL002
     I****************************************4***60LLEP2                 CDL002
     I****************************************7***90LLEP3                 CDL002
     I***************************************10**120LLEP4                 CDL002
     I***************************************13**150LLEP5                 CDL002
     I***************************************16**180LLEP6                 CDL002
     I                                        1   3 WLLEP1                CDL002
     I                                        4   60WLLEP2                CDL002
     I                                        7   90WLLEP3                CDL002
     I                                       10  120WLLEP4                CDL002
     I                                       13  150WLLEP5                CDL002
     I                                       16  180WLLEP6                CDL002
0306 I            DS
0307 I                                        1  18 XFPC
     I                                        1  18 XFPCA
     I****************************************1***30FLPC1                 CDL002
     I****************************************4***60FLPC2                 CDL002
     I****************************************7***90FLPC3                 CDL002
     I***************************************10**120FLPC4                 CDL002
     I***************************************13**150FLPC5                 CDL002
     I***************************************16**180FLPC6                 CDL002
     I                                        1   30WFLPC1                CDL002
     I                                        4   60WFLPC2                CDL002
     I                                        7   90WFLPC3                CDL002
     I                                       10  120WFLPC4                CDL002
     I                                       13  150WFLPC5                CDL002
     I                                       16  180WFLPC6                CDL002
0309 I            DS
0310 I                                        1  18 XLPC
     I                                        1  18 XLPCA
     I/COPY WNCPYSRC,DL0761I002
     I                                        1  18 FIPC                  CDL006
     I                                        1  18 FIPCA                 CDL006
      *                                                                   CDL006
     I****************************************1***30LLPC1                 CDL002
     I****************************************4***60LLPC2                 CDL002
     I****************************************7***90LLPC3                 CDL002
     I***************************************10**120LLPC4                 CDL002
     I***************************************13**150LLPC5                 CDL002
     I***************************************16**180LLPC6                 CDL002
     I                                        1   30WLLPC1                CDL002
     I                                        4   60WLLPC2                CDL002
     I                                        7   90WLLPC3                CDL002
     I                                       10  120WLLPC4                CDL002
     I                                       13  150WLLPC5                CDL002
     I                                       16  180WLLPC6                CDL002
     I*
0719 E/COPY ZSRSRC,ZHOLI                                               ***
     I*
     ISDBANK    E DSSDBANKPD
     I** EXTERNAL DS FOR BANK DETAILS
     I*
     ISDDEAL    E DSSDDEALPD
     I** EXTERNAL DS FOR DEALING DETAILS
     I*
     ISDCURR    E DSSDCURRPD
     I** EXTERNAL DS FOR CURRENCY DETAILS
     I*
     ISDMMOD    E DSSDMMODPD                                              S01157
     I** EXTERNAL DS FOR MODULE DETAILS                                   S01157
     I*
     ISDLOMB    E DSSDLOMBPD                                              S01498
     I** Dummy record format for Portfolio Lending ICD.                   S01498
     I*                                                                   S01498
     ISDLBCS    E DSSDLBCSPD                                              S01498
     I** Dummy record format for Portfolio Lending Customer File          S01498
     I*                                                                   CDL002
     ISDLIMT    E DSSDLIMTPD                                              CDL002
     I** Dummy record format for Limit Types                              CDL002
     I*                                                                   CDL002
     ISDCLLM      DS                            500                       CDL002
     I** Dummy record format for Client Limits                            CDL002
     I                                       15  17 W#FXLT                CDL002
     I                                       37  39 W#LLTY                CDL002
     I                                       83  85 W#MMTY                CDL002
     I/COPY WNCPYSRC,EMP104_028                                           EMP104
     I                                      116 118 W#PLTY                CDL002
     I                                      141 1430FIFILT                CDL006
     I                                      144 1480FIFILA                CDL006
     I*                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I**                                                                  CDL002
     IW3SAVE      DS                           1000                       CDL002
     I* Saved Event field                                                 CDL002
     I                                        1   3 W3ENTI                CDL002
     I                                        4  11 W3PASK                CDL002
     I                                       12  17 W3PTNU                CDL002
     I                                       18  25 W3CASK                CDL002
     I                                       26  31 W3CUNR                CDL002
     I*                                                                   CDL002
     I                                        1  17 W3KEYP                CDL002
     I                                        1  31 W3KEYN                CDL002
     I*                                                                   CDL002
     IW2EVL       DS                                                      CDL002
     I* Event fields                                                      CDL002
     I                                        1   3 ENTITY                CDL002
     I                                        4  11 PASK                  CDL002
     I                                       12  17 PTNU                  CDL002
     I                                       18  25 CASK                  CDL002
     I                                       26  31 CUNR                  CDL002
     I                                    P  32  340EDAT                  CDL002
     I                                    P  35  410LCEQ                  CDL002
     I                                       42  42 EXEI                  CDL002
     I                                       43  43 IBRE                  CDL002
     I                                       44  44 ICYE                  CDL002
     I                                       45  500DLNO                  CDL002
     I                                       51  53 ECCY                  CDL002
     I                                       54  56 OTHC                  CDL002
     I                                       57  76 NAME                  CDL002
     I                                       77  86 TOWN                  CDL002
     I                                       87 116 ENAM                  CDL002
     I                                      117 119 DZFXLT                CDL002
     I                                    P 120 1240DZFLAM                CDL002
     I                                    P 125 1290DZFXFA                CDL002
     I                                    P 130 1320DZFLED                CDL002
     I                                      133 135 DZLLTY                CDL002
     I                                    P 136 1400DZLLAM                CDL002
     I                                    P 141 1430DZLLED                CDL002
     I                                      144 146 DZMMTY                CDL002
     I                                    P 147 1510DZMMAM                CDL002
     I                                    P 152 1540DZMMED                CDL002
     I                                      155 157 DZPLTY                CDL002
     I                                    P 158 1620DZPFAM                CDL002
     I                                    P 163 1670DZPSAM                CDL002
     I                                    P 168 1700DZPLED                CDL002
     I                                    P 171 1750DZFRLA                CDL002
     I                                    P 176 1780DZFRED                CDL002
     I                                    P 179 1830DZIRLM                CDL002
     I                                    P 184 1860DZIRED                CDL002
     I                                      187 189 FLEP1                 CDL002
     I                                    P 190 1910FLEP2                 CDL002
     I                                    P 192 1930FLEP3                 CDL002
     I                                    P 194 1950FLEP4                 CDL002
     I                                    P 196 1970FLEP5                 CDL002
     I                                    P 198 1990FLEP6                 CDL002
     I                                    P 200 2010FLPC1                 CDL002
     I                                    P 202 2030FLPC2                 CDL002
     I                                    P 204 2050FLPC3                 CDL002
     I                                    P 206 2070FLPC4                 CDL002
     I                                    P 208 2090FLPC5                 CDL002
     I                                    P 210 2110FLPC6                 CDL002
     I                                      212 214 LLEP1                 CDL002
     I                                    P 215 2160LLEP2                 CDL002
     I                                    P 217 2180LLEP3                 CDL002
     I                                    P 219 2200LLEP4                 CDL002
     I                                    P 221 2220LLEP5                 CDL002
     I                                    P 223 2240LLEP6                 CDL002
     I                                    P 225 2260LLPC1                 CDL002
     I                                    P 227 2280LLPC2                 CDL002
     I                                    P 229 2300LLPC3                 CDL002
     I                                    P 231 2320LLPC4                 CDL002
     I                                    P 233 2340LLPC5                 CDL002
     I                                    P 235 2360LLPC6                 CDL002
     I                                      237 239 MLEP1                 CDL002
     I                                    P 240 2410MLEP2                 CDL002
     I                                    P 242 2430MLEP3                 CDL002
     I                                    P 244 2450MLEP4                 CDL002
     I                                    P 246 2470MLEP5                 CDL002
     I                                    P 248 2490MLEP6                 CDL002
     I                                    P 250 2510MLPC1                 CDL002
     I                                    P 252 2530MLPC2                 CDL002
     I                                    P 254 2550MLPC3                 CDL002
     I                                    P 256 2570MLPC4                 CDL002
     I                                    P 258 2590MLPC5                 CDL002
     I                                    P 260 2610MLPC6                 CDL002
     I                                      262 264 PLEP1                 CDL002
     I                                    P 265 2660PLEP2                 CDL002
     I                                    P 267 2680PLEP3                 CDL002
     I                                    P 269 2700PLEP4                 CDL002
     I                                    P 271 2720PLEP5                 CDL002
     I                                    P 273 2740PLEP6                 CDL002
     I                                    P 275 2760PLPC1                 CDL002
     I                                    P 277 2780PLPC2                 CDL002
     I                                    P 279 2800PLPC3                 CDL002
     I                                    P 281 2820PLPC4                 CDL002
     I                                    P 283 2840PLPC5                 CDL002
     I                                    P 285 2860PLPC6                 CDL002
     I*                                                                   CDL002
     I                                        1  17 W2KEYP                CDL002
     I                                        1  31 W2KEYN                CDL002
     I*                                                                   CDL002
     IW1KEY       DS                                                      CDL002
     I                                        1   3 W1ENTI                CDL002
     I                                        4  11 W1PASK                CDL002
     I                                       12  17 W1PTNU                CDL002
     I                                       18  25 W1CASK                CDL002
     I                                       26  31 W1CUNR                CDL002
     I*                                                                   CDL002
     I                                        1  17 W1KEYP                CDL002
     I                                        1  31 W1KEYN                CDL002
     I**                                                                  CDL002
     IW4SAVE      DS                           1000                       CDL002
     I* Saved Event field                                                 CDL002
     I*                                                                   CDL002
     I*
0295 I********************************************************************
     I/EJECT
0295 C********************************************************************
     C**
     C**  PARAMETERS - SEQUENCE NUMBER - 5 ALPHA
     C**               LEVEL (BRANCH/COMPANY)
     C**               ENTITY - WHICH BR OR CO
     C**               ORIGINATING OR BOOKING BRANCH
     C**
     C           *ENTRY    PLIST
     C                     PARM           @RSEQ   5
     C                     PARM           @RLEV   1
     C                     PARM           @RENT   3
     C                     PARM           @OB     1
     C**
0295 C********************************************************************
0312 C**   ON FIRST CYCLE - GET ICDR1 & 2
     C           *IN42     IFNE '1'
0313 C                     EXSR FIRST
     C   U8                GOTO LRTAG
     C                     END
0314 C**
0295 C********************************************************************
     C**  DETAIL CYCLE
     C**********           SETOF                     52                   E204
     C**********           SETOF                     50                   E204
     C                     SETOF                     485052               E204
     C*                                                                   CDL002
     C                     MOVE FLEP1     WFLEP1                          CDL002
     C                     MOVE FLEP2     WFLEP2                          CDL002
     C                     MOVE FLEP3     WFLEP3                          CDL002
     C                     MOVE FLEP4     WFLEP4                          CDL002
     C                     MOVE FLEP5     WFLEP5                          CDL002
     C                     MOVE FLEP6     WFLEP6                          CDL002
     C                     MOVE LLEP1     WLLEP1                          CDL002
     C                     MOVE LLEP2     WLLEP2                          CDL002
     C                     MOVE LLEP3     WLLEP3                          CDL002
     C                     MOVE LLEP4     WLLEP4                          CDL002
     C                     MOVE LLEP5     WLLEP5                          CDL002
     C                     MOVE LLEP6     WLLEP6                          CDL002
     C                     MOVE FLPC1     WFLPC1                          CDL002
     C                     MOVE FLPC2     WFLPC2                          CDL002
     C                     MOVE FLPC3     WFLPC3                          CDL002
     C                     MOVE FLPC4     WFLPC4                          CDL002
     C                     MOVE FLPC5     WFLPC5                          CDL002
     C                     MOVE FLPC6     WFLPC6                          CDL002
     C                     MOVE LLPC1     WLLPC1                          CDL002
     C                     MOVE LLPC2     WLLPC2                          CDL002
     C                     MOVE LLPC3     WLLPC3                          CDL002
     C                     MOVE LLPC4     WLLPC4                          CDL002
     C                     MOVE LLPC5     WLLPC5                          CDL002
     C                     MOVE LLPC6     WLLPC6                          CDL002
     C*                                                                   CDL002
     C**********                                                          E204
     C****IS*THIS*BR/CO*THE*ENTITY*REQD**FOR*SINGLE*ENTITY*SELECTION      E204
     C**********                                                          E204
     C***L2*43*02          DO                                             E204
     C********** ENTITY    IFEQ @RENT                                     E204
     C**********           MOVE 'Y'       GOT1    1                       E204
     C**********           END                                            E204
     C**********           END                                            E204
     C**********                                                          E204
     C***NO*DETAILS*TO*PRINT*SINCE*FILE*IS*BEING*CLOSED**          E00014 E204
     C***L2*****           SETON                     51            E00014 E204
     C***L2*****           SETOF                     4858                 E204
     C***L2*****           CLOSEDL0761P1                                  E204
     C***L2*43**           DO                                             E204
     C********** ENTITY    COMP @RENT                4848                 E204
     C********** GOT1      IFEQ 'Y'                                       E204
     C***02*48**           SETON                     LR                   E204
     C***48*****           GOTO ENDDET                                    E204
     C**********           END                                            E204
     C**********           END                                            E204
     C****                                                                E00014
     C****IF NEW BR/CO, OUTPUT HEADING                                    E00014
     C****       *INL2     IFEQ '1'                                       E00014
     C****       *IN48     ANDEQ'0'                                       E00014
     C****                 SETON                     OF52                 E00014
     C****                 OPEN DL0761P1                                  E00014
     C****                 MOVE '1'       *IN58                           E00014
     C****                 MOVE '1'       *IN51                           E00014
     C** CALL ZSFILE FOR P1 FILE                                          E00014
     C****                 Z-ADDSFNUM1    ZSNUM   60                      E00014
     C****                 CALL 'ZSFILE'                                  E00014
     C****                 PARM           @RSEQ   5                       E00014
     C****                 PARM ENTITY    @PARM   3                       E00014
     C****                 PARM           SFILE1                          E00014
     C****                 PARM           ZSNUM                           E00014
     C****                 PARM           ZSERR   1                       E00014
     C****                                                                E00014
     C****       ZSERR     IFEQ 'Y'                                       E00014
     C** Error during ZSFILE processing, return to calling program        E00014
     C****                 SETON                     U7U8LR               E00014
     C****                 RETRN                                          E00014
     C****                 END                                            E00014
     C****                                                                E00014
     C****                 END                                            E00014
      *                                                                   E204
      ***SET*ON*'NO DETAILS TO REPORT' INDICATOR                     E204 065015
     C**********           SETON                     51              E204 065015
      *                                                                   E204
      ** IF REQUIRED BRANCH THEN PRODUCE A REPORT                         E204
     C           @RENT     IFEQ 'ALL'                                     E204
     C           @RENT     OREQ ENTITY                                    E204
      *                                                                   E204
      ** NOTE HAVING READ A RCD FROM THE PRIMRY FILE (EVENTS WITH PARENTS)E204
     C   01                MOVE 'PRIMARY' @PREV   7                       E204
     C                     SETON                     48                   E204
      *                                                                   CDL002
      * Process any net group settlement customers after other            CDL002
      * customers with events and process any entities with only          CDL002
      * net events before other entities with events                      CDL002
      *                                                                   CDL002
      * Entity Changed                                                    CDL002
     C           *INL2     IFEQ *ON                                       CDL002
     C           W#NTCE    ANDEQ'Y'                                       CDL002
     C*                                                                   CDL002
     C                     EXSR NEVT1                                     CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *                                                                   E204
      ** IF CHANGE OF ENTITY, OR                                          E204
      ** PREV RCD WAS FROM PARENT FILE AND THIS IS A NON PARENT, THEN     E204
      ** MUST CLOSE PRINTER FILE TO FORCE NEW PAGE                        E204
     C           *INL2     IFEQ '1'                                       E204
     C********   @PREV     OREQ 'PRIMARY'                            E204 LN0363
     C********   *IN02     ANDEQ'1'                                  E204 LN0363
     C                     EXCPTTRAILR                                    CDL002
     C                     SETOF                     OF                   166671
     C                     SETOF                     58                   E204
     C                     CLOSEDL0761P1                                  E204
      *                                                                   E204
      ** SET ON 'NO DETAILS TO REPORT' INDICATOR                          065015
     C                     SETON                     51                   065015
      *                                                                   E204
     C           @PREV     IFEQ 'PRIMARY'                                 LN0363
     C           *IN02     ANDEQ'1'                                       LN0363
     C                     MOVE *BLANKS   @PREV                           LN0363
     C                     END                                            LN0363
     C*                                                                   LN0363
     C                     ELSE                                           LN0363
     C           @PREV     IFEQ 'PRIMARY'                                 LN0363
     C           *IN02     ANDEQ'1'                                       LN0363
     C                     MOVE *BLANKS   @PREV                           LN0363
     C                     SETON                     OF                   LN0363
     C                     END                                            LN0363
     C*                                                                   LN0363
     C                     END                                            E204
     C*                                                                   E204
     C**
      *                                                                   CDL002
      * Process any net group settlement customers before next            CDL002
      * customer with events                                              CDL002
      *                                                                   CDL002
      * Customer Changed                                                  CDL002
     C           *INL1     IFEQ *ON                                       CDL002
     C           W#NTCE    ANDEQ'Y'                                       CDL002
     C*                                                                   CDL002
     C                     EXSR NEVT2                                     CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C**  IF NEW CUST, GET BR/CO LIMIT, CHECK IF HAS PARENT
     C           *INL1     IFEQ '1'
     C*                                                                   E204
     C**  SET OFF PARENT/NON-PARENT INDS (CAN HAVE CUSTOMER WHICH IS      E204
     C**  NOT A PARENT AND IS NOT A CHILD OF A PARENT                     E204
     C                     SETOF                     4647                 E204
     C*                                                                   E204
     C           *IN01     IFEQ '1'
     C                     MOVE PTNU      CUST    6
     C                     SETON                     46
     C                     END
     C           *IN02     IFEQ '1'
     C           PTNU      COMP *BLANKS                  44
     C  N44      PTNU      COMP '000000'                 44
     C                     MOVE CUNR      CUST
     C                     SETON                     47
     C**********           SETOF                     46                   E204
     C                     END
      *                                                                   S01498
      ** If Portfolio Lending is switched on, if a LB customer            S01498
      ** is selected for extraction ignore it when the LB setup           S01498
      ** is to, not include LB customers for DL Exposure reports.         S01498
      *                                                                   S01498
     C           BGLMCR    IFEQ 'Y'                                       S01498
     C           LBLCDL    ANDEQ'N'                                       S01498
      *                                                                   S01498
      ** Call Access Program to determine if a LB Customer.               S01498
     C                     CALL 'AOLBCSR0'                                S01498
     C                     PARM '*MSG    '@RTCD                           S01498
     C                     PARM '*KEY    '@OPTN                           S01498
     C                     PARM CUST      @AENB  10                       S01498
     C***********          PARM *BLANKS   @KYST   7                                    S01498 222373
     C           SDLBCS    PARM SDLBCS    DSSDY                           S01498
     C*                                                                   S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           @RTCD     ANDNE'*NRF'                                    S01498
     C                     MOVEL'SDLBCSPD'DBFILE            ************* S01498
     C                     MOVEL'05'      DBASE             *DBERROR 005* S01498
     C                     MOVEL@OPTN     DBOPTN            ************* S01498
     C                     MOVELCUST      DBKEY  29                       S01498
     C                     SETON                     U7U8LR               S01498
     C                     EXSR *PSSR                                     S01498
     C                     END                                            S01498
      *                                                                   S01498
      ** Customer is a LB customer - ignore.                              S01498
     C           @RTCD     IFEQ *BLANKS                                   S01498
     C                     GOTO LRTAG                                     S01498
     C                     END                                            S01498
     C                     END                                            S01498
     C/COPY WNCPYSRC,DL0761C001
      *                                                                   CDL006
      **  If CDL006 is installed, access Client Limits file to retrieve   CDL006
      **  Fiduciary Limit Type & Limit Amounts                            CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C/COPY WNCPYSRC,EMP104_029                                           EMP104
     C                     CALL 'AOCLLMR0'                                CDL006
     C                     PARM *BLANKS   PRTCD                           CDL006
     C                     PARM '*KEY   ' POPTN                           CDL006
     C                     PARM CUST      PCUST   6                       CDL006
     C                     PARM 'S'       PLEVL   1                       CDL006
     C                     PARM 'SYS'     PBCCD   3                       CDL006
     C           SDCLLM    PARM SDCLLM    DSFDY                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE *BLANKS                                   CDL006
     C                     Z-ADD0         FIFILT                          CDL006
     C                     Z-ADD0         FIFILA                          CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,EMP104_030                                           EMP104
      *                                                                   S01498
     C                     EXSR LMTS
     C                     END
     C**
0295 C********************************************************************
     C/COPY WNCPYSRC,EMP104_031                                           EMP104
     C** CALC EXPOSURE AGAINST BR,CO & SYS LIMITS
     C** -FX
     C/COPY WNCPYSRC,DL0761C012
     C*                                                                   CDL002
     C* Net FX Customer Exposure?                                         CDL002
     C           W#NTCE    IFEQ 'Y'                                       CDL002
     C           EXEI      ANDEQ'F'                                       CDL002
     C*                                                                   CDL002
     C           DLNO      CHAINDEALSDBF             85                   CDL002
     C           *IN85     IFEQ *ON                                       CDL002
     C                     MOVEL'DEALS   'DBFILE           ************   CDL002
     C                     MOVEL'07'      DBASE            * DBERR 07 *   CDL002
     C                     MOVELDLNO      DBKEY            ************   CDL002
     C                     SETON                     U7U8LR               CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ELSE                                           CDL002
     C*   Exclude netted FX deal events                                   CDL002
     C           NETBR     IFNE *BLANKS                                   CDL002
     C                     MOVE 'N'       EXEI                            CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C           EXEI      IFEQ 'F'
     C                     Z-ADDEDAT      DLVALU
     C           A6NBDP    ADD  1         DEP
     C           LCEQ      DIV  FCT,DEP   DLAMTF    H
     C                     EXSR EXPFS
     C                     ADD  1         RREAD   50
     C                     END
     C**
     C**  -LENDING
     C           EXEI      IFEQ 'L'
     C           EDAT      IFLT BJRDNB
     C           EDAT      ADD  BJRDNB    DLMATD
     C                     ELSE
     C                     Z-ADDEDAT      DLMATD
     C                     END
     C**
     C           A6NBDP    ADD  1         DEP     10
     C           LCEQ      DIV  FCT,DEP   DLAMTL    H
     C                     EXSR EXPLS
     C                     ADD  1         RREAD
     C                     END
     C**
      *                                                                   S01157
      ** -FRA EVENT                                                       S01157
     C           EXEI      IFEQ 'R'                                       S01157
     C           A6NBDP    ADD  1         DEP                             S01157
      *                                                                   S01157
     C           LCEQ      DIV  FCT,DEP   DLAMTR 130H                     S01157
     C           RXPOS     ADD  DLAMTR    RXPOS  100                      S01157
      *                                                                   S01157
     C                     ADD  1         RREAD                           S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
      ** -IRS EVENT                                                       S01157
     C           EXEI      IFEQ 'I'                                       S01157
     C           A6NBDP    ADD  1         DEP                             S01157
      *                                                                   S01157
     C           LCEQ      DIV  FCT,DEP   DLAMTI 130H                     S01157
     C           IXPOS     ADD  DLAMTI    IXPOS  100                      S01157
      *                                                                   S01157
     C                     ADD  1         RREAD                           S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            E204
     C*                                                                   E204
     C** SKIP TO END OF FILE IF DETAILS FOR REQUESTED ENTITY HAVE FINISHEDE204
     C           @RENT     IFNE 'ALL'                                     E204
     C           ENTITY    ANDGT@RENT                                     E204
     C*                                                                   E204
     C** IF STILL READING PRIMARY FILE MUST START ON SECONDARY         HEDE204
     C           *IN01     IFEQ '1'                                       E204
     C                     FEOD EVLP                                      E204
     C                     SETOF                     48                   E204
     C                     ELSE                                           E204
     C** IF READING SECONDARY FILE (*IN02 ON) THEN END PROCESSING      HEDE204
     C                     SETON                     LR                   E204
     C                     SETOF                     48                   E204
     C                     END                                            E204
     C                     END                                            E204
     C/COPY WNCPYSRC,DL0761C013
     C********** ENDDET    TAG                             ** ENDDET **   E204
     C**
0295 C********************************************************************
     C*L1N48****            MOVE '1'       *IN50                          E204
     C*L1N48****            EXSR FXWRIT                                   E204
     C*L1N48****            EXSR LEWRIT                                   E204
     C*                                                                   CDL002
     C*                                                                   CDL002
     C* Include any nets for the customer                                 CDL002
     CL1         *IN48     IFEQ *ON                                       CDL002
     CL1         W#NTCE    ANDEQ'Y'                                       CDL002
     CL1                   EXSR NEVTD                                     CDL002
     CL1                   ENDIF                                          CDL002
     C*                                                                   CDL002
     C*                                                                   E204
     C** TOTAL TIME CALCULATIONS                                          E204
     C*                                                                   E204
     CL1 48                MOVE '1'       *IN50                           E204
     CL1 48                EXSR FXWRIT                                    E204
     CL1 48                EXSR LEWRIT                                    E204
      *                                                                   S01157
      *   Execute these subroutines only if FRA/IRS module present.       S01157
     C*1N48*30*************EXSR FRWRIT                             S01157 LN0618
     C*1N48*30*************EXSR IRWRIT                             S01157 LN0618
     CL1 48 30             EXSR FRWRIT                                    LN0618
     CL1 48 30             EXSR IRWRIT                                    LN0618
     C*                                                                   CDL002
     C* Process any net group settlement customers before next            CDL002
     C* customer with events                                              CDL002
     C*                                                                   CDL002
     C* Customer Changed                                                  CDL002
     CL1         W#NTCE    IFEQ 'Y'                                       CDL002
     C*                                                                   CDL002
     CL1                   EXSR NEVT2                                     CDL002
     CL1                   ENDIF                                          CDL002
     C**
     C** (OUTPUT NO DETAILS ONLY WHEN EXCEPTION REPORT (*INU1=1) FOR
     C** ALL ENTITIES (*IN43=0) WHEN P1 HAS ALREADY BEEN OPENED
     C** (*IN58=1) FOR A PARTICULAR ENTITY FOR WHICH, IT IS LATER
     C** CALCULATED, THERE ARE NO LIMITS IN EXCESS (*IN51=1))
     C*L1N48*L2** *IN51     IFEQ '1'                                      E204
     C*L1******** *INU1     ANDEQ'1'                                      E204
     C*L1******** *IN58     ANDEQ'1'                                      E204
     C*L1********          EXCPTNODETS                                    E204
     C*L1********           END                                           E204
     CL1         *IN51     IFEQ '1'                                       E204
     CL1         *INU1     ANDEQ'1'                                       E204
     CL1         *IN58     ANDEQ'1'                                       E204
     CL1         *IN48     ANDEQ'1'                                       E204
     CL1                   EXCPTNODETS                                    E204
     CL1                   END                                            E204
     C*
     C* Process any net group settlement customers after other            CDL002
     C* customers with events and process any entities with only          CDL002
     C* net events before other entities with events                      CDL002
     C*                                                                   CDL002
     C* Entity Changed                                                    CDL002
     CL2         W#NTCE    IFEQ 'Y'                                       CDL002
     C*                                                                   CDL002
     CL2                   EXSR NEVT1                                     CDL002
     CL2                   ENDIF                                          CDL002
      *                                                                   CDL002
     CLR         LRTAG     TAG                             ** LRTAG **
     C*                                                                   CDL002
     C* Process any Net Group Settlement Customers after last customer    CDL002
     C* with events                                                       CDL002
     CLR         W#NTCE    IFEQ 'Y'                                       CDL002
     CLR                   EXSR NEVTLR                                    CDL002
     CLR                   ENDIF                                          CDL002
     CLR                   EXCPTTRAILR                                    CDL002
     C*                                                                   CDL002
     CLR         RLIST     COMP 0                        41
     CLR                   FREE 'DL0131'
     C**
     C** IF NO DETAILS THEN CALL #ZZ FOR HEADING/DATE ETC. FOR AU         E100
     CLR         *IN41     IFEQ '1'                                       E100
     CLR                   EXSR #ZZ                                       E100
     CLR                   END                                            E100
     C*                                                                   E100
     C** CALL ZSFILE FOR AU FILE - ONCE ONLY
     CLR                   Z-ADDSFNUMU    ZSNUM   60
     CLR                   CALL 'ZSFILE'
     CLR                   PARM           @RSEQ   5
     CLR                   PARM *BLANKS   @PARM   3
     CLR                   PARM           SFILEU
     CLR                   PARM           ZSNUM
     CLR                   PARM           ZSERR   1
     C*
     CLR         ZSERR     IFEQ 'Y'
     C** Error during ZSFILE processing, return to calling program
     CLR                   SETON                     U7U8LR
     CLR                   RETRN
     CLR                   END
     C**
0461 C********************************************************************
     C/EJECT
0461 C********************************************************************
     C**
     C**    LIST OF SR'S CALLED, FREQUENCY & SEQUENCE
     C**
     C**        SR             FREQ                   SEQ
     C**        --             ----                   ---
     C**        LMTS,SF,SL     X CUST                  2
     C**
     C**        EXPFS          X FX EVENTS             1
     C**        EXPLS          X LN EVENTS             1
     C**
     C**        FXWRIT         X CUST                  2
     C**        LEWRIT         X CUST                  2
     C**        FRWRIT         X CUST                  2                  S01157
     C**        IRWRIT         X CUST                  2                  S01157
     C**
     C**   EXCESS EXPOSURE SUBROUTINES
     C**        EXSFS,LS       = WRITES                2
     C**        EXSRS,IS       = WRITES                2                  S01157
     C**
     C**        DL0131         X CUST + X CUST,CO      3
     C**        ZFWDT          X                       4
     C**        ZACCH          X                       4
     C**        FIRST          1                       4
     C**
0595 C********************************************************************
     C/EJECT
0595 C********************************************************************
     C**
     C**   EXPOSURE SUBROUTINES, AGAINST:
     C**     BR/CO LIMIT -FX - EXPFS
     C**                 -LN - EXPLS
     C**
0595 C********************************************************************
     C*    BR/CO  LEVEL LIMITS
0603 C**   EXPFS  SR. CALCULATES EXPOSURE FOR A FX DEAL.
0604 C**
0605 C           EXPFS     BEGSR                           **  EXPFS   **
0606 C**
0607 C**   DEFINE INPUT FIELDS
0608 C                     Z-ADDDLVALU    DLVALU  50       VALUE DATE
0609 C                     Z-ADDDLAMTF    DLAMTF 130       LIMIT CCY EQUIV
0610 C**                                                       AMOUNT
0611 C** IF VALUE DATE IS LESS OR EQUAL TO RUN DATE - FIRST PERIOD ONLY
0612 C           DLVALU    COMP BJRDNB                 8989
0613 C   89      XFXP,1    ADD  DLAMTF    XFXP,1
0614 C   89                GOTO EXPFS9
0615 C**
0616 C**   VALUE DATE IS GREATER THAN TODAY - AMOUNT IS ADDED INTO EVERY
0617 C**   PERIOD PRECEDING & INCLUDING THE PERIOD WHICH INCLUDES THE
0618 C**   VALUE DATE.
0619 C                     Z-ADD0         D       20
0620 C**
0621 C           EXPFS1    TAG                             **  EXPFS1  **
0622 C           D         ADD  1         D
0623 C**
0624 C**   ADD AMOUNT INTO THIS PERIOD
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0761CCPG                                           S01408
     C*                                                                   S01408
0625 C           XFXP,D    ADD  DLAMTF    XFXP,D
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL0761CCP1                                           S01408
     C*                                                                   S01408
0626 C**
0627 C**   LOOP AGAIN TO ADD AMOUNT INTO NEXT PERIOD IF
0628 C**   - VALUE DATE EXCEEDS THIS END OF PERIOD DATE.
0629 C**   - LESS THAN SIX PERIODS HAVE BEEN USED.
0630 C           DLVALU    COMP XFDT,D               88
0631 C           D         COMP 6                      87
0632 C   87 88             GOTO EXPFS1
0633 C**
0634 C           EXPFS9    ENDSR                           **  EXPFS9  **
0635 C**
0636 C********************************************************************
     C**   BR/CO  LEVEL  LIMITS
0637 C**   EXPLS  SR. CALCULATES EXPOSURE FOR A LOAN DEAL.
0638 C**
0639 C           EXPLS     BEGSR                           **  EXPLS   **
0640 C**
0641 C**   DEFINE INPUT FIELDS
0642 C                     Z-ADDDLMATD    DLMATD  50
0643 C                     Z-ADDDLAMTL    DLAMTL 130
     C/COPY WNCPYSRC,DL0761C002
0644 C**
0648 C**
0649 C**   LOOP TO ADD AMOUNT INTO EVERY PERIOD PRECEDING & INCLUDING
0650 C**   THE PERIOD WHICH INCLUDES THE MATURITY DATE.
0651 C                     Z-ADD0         D       20
0652 C           EXPLS1    TAG                             **  EXPLS1  **
     C/COPY WNCPYSRC,DL0761C003
      *                                                                   CDL006
      ** If CDL006 is installed, and Deal types are FL, DP or LP          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           DLNO      CHAINDEALSDCF             85                   CDL006
     C           DTYP      IFEQ 'FL'                                      CDL006
     C           DTYP      OREQ 'DP'                                      CDL006
     C           DTYP      OREQ 'LP'                                      CDL006
      *                                                                   CDL006
     C           D         ADD  1         D                               CDL006
      *                                                                   CDL006
      ** Add amount into this period                                      CDL006
      *                                                                   CDL006
     C           FIXP,D    ADD  DLAMTL    FIXP,D                          CDL006
      *                                                                   CDL006
      ** Loop again to add amount into next period if                     CDL006
      ** - Maturity date exceeds this end of period date                  CDL006
      ** - Less than six periods have been used                           CDL006
      *                                                                   CDL006
     C           DLMATD    COMP FIDT,D               88                   CDL006
     C           D         COMP 6                      87                 CDL006
     C   87 88             GOTO EXPLS1                                    CDL006
     C                     ENDIF                                          CDL006
     C                     ELSE                                           CDL006
0653 C           D         ADD  1         D
0654 C**
0655 C**   ADD AMOUNT INTO THIS PERIOD
0656 C           XLXP,D    ADD  DLAMTL    XLXP,D
0657 C**
0658 C**   LOOP AGAIN TO ADD AMOUNT INTO NEXT PERIOD IF
0659 C**   - MATURITY DATE EXCEEDS THIS END OF PERIOD DATE.
0660 C**   - LESS THAN SIX PERIODS HAVE BEEN USED
0661 C           DLMATD    COMP XLDT,D               88
0662 C           D         COMP 6                      87
0663 C   87 88             GOTO EXPLS1
     C/COPY WNCPYSRC,DL0761C004
     C                     END                                            CDL006
0664 C**
0665 C                     ENDSR
0666 C********************************************************************
     C/EJECT
0595 C********************************************************************
     C**   BR/CO LEVEL SR'S -
     C**      LMTS
     C********FXWRIT, LEWRIT                                              S01157
     C********EXSFS, EXSLS                                                S01157
     C**      FXWRIT, LEWRIT, FRWRIT, IRWRIT                              S01157
     C**      EXSFS, EXSLS, EXSRS, EXSIS                                  S01157
0461 C********************************************************************
     C*   BR/CO LEVEL LIMITS
0472 C*     LMTS SR. SETS UP ARRAYS OF LIMIT PERIODS & AMOUNTS,
0473 C*    FOR FX LIMITS AND LENDING LIMITS.
0474 C           LMTS      BEGSR                           **  LMTS *  *
     C                     MOVE *BLANKS   FDESC   7
     C                     MOVE *BLANKS   LDESC   7
     C                     MOVE *BLANKS   RDESC   7                       S01157
     C                     MOVE *BLANKS   IDESC   7                       S01157
     C                     MOVE *BLANKS   FDEF
     C                     MOVE *BLANKS   LDEF
     C                     MOVE *BLANKS   RDEF    1                       S01157
     C                     MOVE *BLANKS   IDEF    1                       S01157
     C                     MOVE *BLANKS   ASTF
     C                     MOVE *BLANKS   ASTL
     C                     Z-ADD0         XRLM                            S01157
     C                     Z-ADD0         XILM                            S01157
0475 C**
0476 C**   FIRST RESET ARRAYS TO ZEROES
0478 C                     Z-ADD0         XFDA
0478 C                     Z-ADD0         XFDT
0479 C                     Z-ADD0         XFLM
0480 C                     Z-ADD0         XFXP
0481 C                     Z-ADD0         XFXS
0478 C                     Z-ADD0         XLDA
0484 C                     Z-ADD0         XLDT
0485 C                     Z-ADD0         XLLM
0486 C                     Z-ADD0         XLXP
0487 C                     Z-ADD0         XLXS
     C/COPY WNCPYSRC,DL0761C005
      *                                                                   CDL006
      ** If CDL006 is installed                                           CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVE *BLANKS   FIDEF   1                       CDL006
     C                     MOVE *BLANKS   FIDESC  7                       CDL006
     C                     MOVE *BLANKS   FISTL                           CDL006
     C                     Z-ADD0         FIDA                            CDL006
     C                     Z-ADD0         FIDT                            CDL006
     C                     Z-ADD0         FILM                            CDL006
     C                     Z-ADD0         FIXP                            CDL006
     C                     Z-ADD0         FIXS                            CDL006
     C                     END                                            CDL006
0489 C*
0491 C                     SETOF                     7172
0492 C**
0494 C**
0495 C**   PROCESS FX LIMITS FIRST
     C** CASE 1 - LIVE, NON ZERO
     C** IF FX LIMIT TYPE NON ZERO & EXPIRY DATE GT RUND
     C** (DZFXLT - FX LIMIT TYPE;    DZFLED - LIMIT EXPIRY DATE)
     C           DZFXLT    IFNE *BLANKS
     C           DZFLED    IFGT BJRDNB
     C           DZFLED    OREQ 0
     C                     EXSR LMTSF
     C**  GET EXPIRY DATE
     C                     MOVE DZFLED    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    FDESC
     C                     END
     C                     END
     C**
0500 C**   CASE 2-EXPIRED
0501 C**   - IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES
0502 C**     & ZEROIZE AMOUNT
     C** (DZFXLT - FX LIMIT TYPE;    DZFLED - LIMIT EXPIRY DATE)
     C           DZFLED    IFLE BJRDNB
     C           DZFLED    ANDNE0
     C                     MOVE 'EXPIRED' FDESC   7
0503 C                     Z-ADD999       XFDA,1
0504 C                     Z-ADD99999     XFDT,1
0505 C                     Z-ADD0         XFLM,1
     C                     END
0508 C**   CASE 3 - NO LIMIT
0509 C**   - IF FX LIMIT TYPE 0, CONDITION DEFAULT FOR CO,SYS ONLY
     C           DZFXLT    IFEQ *BLANKS
     C**  IF BRANCH
     C           @RLEV     IFEQ 'B'
     C                     MOVE 'NO LIM.' FDESC
0503 C                     Z-ADD999       XFDA,1
0504 C                     Z-ADD99999     XFDT,1
0505 C                     Z-ADD0         XFLM,1
     C                     ELSE
     C**  IF CO OR SYSTEM LEVEL
     C                     MOVE 'Y'       FDEF    1
     C                     MOVE 'DEFAULT' FDESC
     C                     END
     C                     END
     C**
0546 C**   PROCESS LENDING LIMITS.
0551 C**
0565 C**   CASE 1 - LIVE, NON ZERO
0569 C**   IF LN LIMIT TYPE NON ZERO & EXPIRY DATE GT RUND
     C* (DZLLTY - LENDING LIMIT TYPE; DZLLED - LENDING LIMIT EXP. DATE)
     C           DZLLTY    IFNE *BLANKS
     C           DZLLED    IFGT BJRDNB
     C           DZLLED    OREQ 0
     C                     EXSR LMTSL
     C**  GET EXPIRY DATE
     C                     MOVE DZLLED    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    LDESC
     C                     END
     C                     END
     C**
0552 C**   CASE 2 - EXPIRED
0553 C**   - IF EXPIRED, SET FIRST PERIOD END DAYS & DATE TO NINES
0554 C**     & ZEROISE AMOUNT
     C           DZLLED    IFLE BJRDNB
     C           DZLLED    ANDNE0
     C                     MOVE 'EXPIRED' LDESC   7
0555 C                     Z-ADD999       XLDA,1
0556 C                     Z-ADD99999     XLDT,1
0557 C                     Z-ADD0         XLLM,1
0559 C                     END                                         **
     C**
0560 C**   CASE 3 - NO  LIMIT
0561 C**   - IF LIMIT TYPE 0, CONDITION DEFAULT
     C           DZLLTY    IFEQ *BLANKS
     C**  IF BRANCH
     C           @RLEV     IFEQ 'B'
     C                     MOVE 'NO LIM.' LDESC
0503 C                     Z-ADD999       XLDA,1
0504 C                     Z-ADD99999     XLDT,1
0505 C                     Z-ADD0         XLLM,1
     C                     ELSE
     C**  IF CO OR SYSTEM LEVEL
     C                     MOVE 'Y'       LDEF    1
     C                     MOVE 'DEFAULT' LDESC
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0761C006
      *                                                                   CDL006
      ** If CDL006 is installed, Process fiduciary limits                 CDL006
      ** Case 1 - Live, non-zero                                          CDL006
      ** If FI Limit type non zero & expiry date GT Rundate               CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           FIFILT    IFNE 0                                         CDL006
     C           DZLLED    IFGT BJRDNB                                    CDL006
     C           DZLLED    OREQ 0                                         CDL006
     C                     EXSR LMTSFI                                    CDL006
      *                                                                   CDL006
      ** Get Expiry Date                                                  CDL006
      *                                                                   CDL006
     C                     MOVE DZLLED    ZDAYNO                          CDL006
     C                     EXSR ZDATE2                                    CDL006
     C                     MOVE ZADATE    FIDESC                          CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Case 2 - Expired                                                 CDL006
      ** If expired, set first period end days & date to nines and        CDL006
      ** zeroise amount                                                   CDL006
      *                                                                   CDL006
     C           DZLLED    IFLE BJRDNB                                    CDL006
     C           DZLLED    ANDNE0                                         CDL006
     C                     MOVE 'EXPIRED' FIDESC  7                       CDL006
     C                     Z-ADD999       FIDA,1                          CDL006
     C                     Z-ADD99999     FIDT,1                          CDL006
     C                     Z-ADD0         FILM,1                          CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Case 3 - No limit                                                CDL006
      ** If Limit type 0, condition default                               CDL006
      *                                                                   CDL006
     C           FIFILT    IFEQ 0                                         CDL006
      *                                                                   CDL006
      ** If branch                                                        CDL006
      *                                                                   CDL006
     C           @RLEV     IFEQ 'B'                                       CDL006
     C                     MOVE 'NO LIM.' FIDESC                          CDL006
     C                     Z-ADD999       FIDA,1                          CDL006
     C                     Z-ADD99999     FIDT,1                          CDL006
     C                     Z-ADD0         FILM,1                          CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** If CO or system level                                            CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       FIDEF                           CDL006
     C                     MOVE 'DEFAULT' FIDESC                          CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
     C**
      *                                                                   S01157
      *   PROCESS FRA LIMITS ===> CASE 1 - Live, Non Zero                 S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If Expiry Date GT Rundate...                                     S01157
      *                                                                   S01157
     C           DZFRED    IFGT BJRDNB                                    S01157
     C           DZFRED    OREQ 0                                         S01157
      *                                                                   S01157
      *   Get Expiry Date                                                 S01157
      *                                                                   S01157
     C                     MOVE DZFRED    ZDAYNO                          S01157
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZADATE    RDESC                           S01157
     C                     Z-ADDDZFRLA    XRLM    90                      S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
      *   PROCESS FRA LIMITS ===> CASE 2 - Expired                        S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If Expired, Set Description field.                               S01157
      *                                                                   S01157
     C           DZFRED    IFLE BJRDNB                                    S01157
     C           DZFRED    ANDNE0                                         S01157
     C                     MOVE 'EXPIRED' RDESC   7                       S01157
     C                     Z-ADD0         XRLM                            LN0632
     C                     END                                            S01157
      *                                                                   S01157
      *   PROCESS FRA LIMITS ===> CASE 3 - No Limit                       S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If limit amount blank...                                         S01157
      *                                                                   S01157
     C           DZFRLA    IFEQ 0                                         S01157
      *                                                                   S01157
      ** If Branch level...                                               S01157
      *                                                                   S01157
     C           @RLEV     IFEQ 'B'                                       S01157
     C                     MOVE 'NO LIM.' RDESC                           S01157
      *                                                                   S01157
      ** Else If Company OR System Level                                  S01157
      *                                                                   S01157
     C                     ELSE                                           S01157
     C                     MOVE 'Y'       RDEF                            S01157
     C                     MOVE 'DEFAULT' RDESC                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
      *   PROCESS IRS LIMITS ===> CASE 1 - Live, Non Zero                 S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If Expiry Date GT Rundate...                                     S01157
      *                                                                   S01157
     C           DZIRED    IFGT BJRDNB                                    S01157
     C           DZIRED    OREQ 0                                         S01157
      *                                                                   S01157
      *   Get Expiry Date                                                 S01157
      *                                                                   S01157
     C                     MOVE DZIRED    ZDAYNO                          S01157
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZADATE    IDESC                           S01157
     C                     Z-ADDDZIRLM    XILM    90                      S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
      *   PROCESS IRS LIMITS ===> CASE 2 - Expired                        S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If Expired, Set Description field.                               S01157
      *                                                                   S01157
     C           DZIRED    IFLE BJRDNB                                    S01157
     C           DZIRED    ANDNE0                                         S01157
     C                     MOVE 'EXPIRED' IDESC   7                       S01157
     C                     Z-ADD0         XILM                            LN0632
     C                     END                                            S01157
      *                                                                   S01157
      *   PROCESS IRS LIMITS ===> CASE 3 - No Limit                       S01157
      *   ------------------                                              S01157
      *                                                                   S01157
      ** If limit amount blank...                                         S01157
      *                                                                   S01157
     C           DZIRLM    IFEQ 0                                         S01157
      *                                                                   S01157
      ** If Branch...                                                     S01157
      *                                                                   S01157
     C           @RLEV     IFEQ 'B'                                       S01157
     C                     MOVE 'NO LIM.' IDESC                           S01157
      *                                                                   S01157
      ** Else If Company OR System Level                                  S01157
      *                                                                   S01157
     C                     ELSE                                           S01157
     C                     MOVE 'Y'       IDEF                            S01157
     C                     MOVE 'DEFAULT' IDESC                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C***IF*FX*OR*LN*DEFAULT*REQD*****************                        S01157
     C** If FX, LN, FRA or IRS default required...                        S01157
     C           @RLEV     IFNE 'B'
     C           FDEF      IFEQ 'Y'
     C           LDEF      OREQ 'Y'
     C           RDEF      OREQ 'Y'                                       S01157
     C           IDEF      OREQ 'Y'                                       S01157
     C                     MOVE 'C'       @RLEV
     C                     MOVE ENTITY    ENTY    3
     C                     EXSR DL0131
     C**
     C**  APPLY DEFAULT VALUES
     C**
     C** IF FX DEFAULT REQUIRED
     C           FDEF      IFEQ 'Y'
     C** IF FX LIMIT FOUND
     C           FXLIM     IFNE 0
     C**  IF ALL LOWER LEVEL LIMITS HAD SAME TYPE,
     C**  USE THIS FOR 1ST PERIOD  (DZFLAM - FX LIMIT AMOUNT)
     C           FXSAME    IFEQ 'Y'
     C                     MOVEAFXPER     XFDAA
     C                     Z-ADDFXLIM     DZFLAM
     C                     MOVE FXPC      XFPCA
     C*
     C           DZFLAM    DIV  XFPC,1    DZFLAM    H
     C*
     C                     EXSR LMTSF
     C                     ELSE
     C**  ELSE SET UP SPOT PERIOD
     C                     Z-ADDSP        XFDA,1
     C           SP        ADD  BJRDNB    XFDT,1
     C                     Z-ADD999       XFDA,2
     C                     Z-ADD99999     XFDT,2
     C                     Z-ADDFXLIM     XFLM,1
     C                     MOVE '*'       ASTF    1
     C                     END
     C                     ELSE
     C**  IF NOT FOUND
     C                     Z-ADD999       XFDA,1
     C                     Z-ADD99999     XFDT,1
     C                     END
     C                     END
     C**
     C**  IF LN DEFAULT REQUIRED
     C           LDEF      IFEQ 'Y'
     C**  IF LENDING LIMIT FOUND
     C           LNLIM     IFNE 0
     C**  IF ALL LOWER LEVEL LIMITS HAD SAME TYPE,
     C**  USE THIS FOR 1ST PERIOD
     C**  (DZLLAM - LENDING LIMIT AMOUNT)
     C           LNSAME    IFEQ 'Y'
     C                     MOVEALNPER     XLDAA
     C                     Z-ADDLNLIM     DZLLAM
     C                     MOVE LNPC      XLPCA
     C*
     C           DZLLAM    DIV  XLPC,1    DZLLAM    H
     C*
     C                     EXSR LMTSL
     C                     ELSE
     C**  ELSE SET UP OVERNIGHT PERIOD
     C                     Z-ADD1         XLDA,1
     C           1         ADD  BJRDNB    XLDT,1
     C                     Z-ADD999       XLDA,2
     C                     Z-ADD99999     XLDT,2
     C                     Z-ADDLNLIM     XLLM,1
     C                     MOVE '*'       ASTL    1
     C                     END
     C                     ELSE
     C** IF NOT FOUND
     C                     Z-ADD999       XLDA,1
     C                     Z-ADD99999     XLDT,1
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL0761C007
      *                                                                   CDL006
      ** If CDL006 is installed, check if FI Default is required          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           FIDEF     IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           LNLIM     IFNE 0                                         CDL006
      *                                                                   CDL006
      ** If all lower level limits had same type, use this for 1st        CDL006
      ** period                                                           CDL006
      *                                                                   CDL006
     C           LNSAME    IFEQ 'Y'                                       CDL006
     C                     MOVEALNPER     FIDAA                           CDL006
     C                     Z-ADDLNLIM     FIFILA                          CDL006
     C                     MOVE LNPC      FIPCA                           CDL006
      *                                                                   CDL006
     C           FIFILA    DIV  FIPC,1    FIFILA    H                     CDL006
      *                                                                   CDL006
     C                     EXSR LMTSFI                                    CDL006
      *                                                                   CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Else set up overnight period                                     CDL006
      *                                                                   CDL006
     C                     Z-ADD1         FIDA,1                          CDL006
     C           1         ADD  BJRDNB    FIDT,1                          CDL006
     C                     Z-ADD999       FIDA,2                          CDL006
     C                     Z-ADD99999     FIDT,2                          CDL006
     C                     Z-ADDLNLIM     FILM,1                          CDL006
     C                     MOVE '*'       FISTL   1                       CDL006
     C                     END                                            CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** If not found                                                     CDL006
      *                                                                   CDL006
     C                     Z-ADD999       FIDA,1                          CDL006
     C                     Z-ADD99999     FIDT,1                          CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
      *                                                                   LN0632
      ** If FRA default required, set up company limit                    LN0632
     C           RDEF      IFEQ 'Y'                                       LN0632
     C                     Z-ADDFRLIM     XRLM                            LN0632
     C                     END                                            LN0632
      *                                                                   LN0632
      ** If IRS default required, set up company limit                    LN0632
     C           IDEF      IFEQ 'Y'                                       LN0632
     C                     Z-ADDIRLIM     XILM                            LN0632
     C                     END                                            LN0632
      *                                                                   LN0632
     C                     END
     C**
0593 C                     ENDSR                                       **
0594 C**
     C********************************************************************
     C**  LMTSF SR SETS UP LIMIT ARRAYS FOR FX
     C**  INPUT - XFDAA - PERIOD ARRAY
     C**          XFPC - PERCENTAGE ARRAY
     C**          DZFLAM - LIMIT AMOUNT
     C**   IF ANY ELEMENT IS BLANK OR 999
     C**   THE CORRESPONDING ELEMENTS IN XFDA & XFDT ARE SET TO NINES.
     C**   ELSE,XFDT IS CALCULATED BY ADDING RUND TO XFDA,
     C**        XFLM,IS CALCULATED BY MULTIPLYING LIMIT AMOUNT BY XFPC
     C**
     C           LMTSF     BEGSR                           **  LMTSF **
     C                     Z-ADD0         D       20
     C           XFDAA,1   COMP 'SP '                    71
     C           LMTS1     TAG                             ** LMTS1   **
     C**
     C           D         ADD  1         D
     C********** XFDAA,D   COMP '   '                    88               E309
     C           XFDAA,D   COMP '000'                    88               E309
     C           XFDAA,D   COMP '999'                    87
     C**
     C   88                Z-ADD999       XFDA,D
     C  N88                MOVE XFDAA,D   XFDA,D
     C*
     C**
     C           XFDA,D    ADD  BJRDNB    XFDT,D
     C   88
     COR 87                Z-ADD99999     XFDT,D
     C**
     C  N88      DZFLAM    MULT XFPC,D    XFLM,D
     C**
     C           D         COMP 6                      86
     C   86N87N88          GOTO LMTS1
     C   71                Z-ADDSP        XFDA,1
     C   71      SP        ADD  BJRDNB    XFDT,1
     C                     ENDSR
     C**
     C********************************************************************
     C**  LMTSL SR SETS UP LIMIT ARRAYS FOR LN
     C**  INPUT - XLDAA - PERIOD ARRAY
     C**          XLPC - PERCENTAGE ARRAY
     C**          DZLLAM - LIMIT AMOUNT
     C**  PROCESSES XLDAA IN THE SAME WAY AS LMTSF
     C           LMTSL     BEGSR                           **  LMTSL **
     C                     Z-ADD0         D
     C           XLDAA,1   COMP 'SP '                    72
     C           LMTS2     TAG                             **  LMTS2   **
     C**
     C           D         ADD  1         D
     C********** XLDAA,D   COMP '   '                    88               E309
     C           XLDAA,D   COMP '000'                    88               E309
     C           XLDAA,D   COMP '999'                    87
     C**
     C   88                Z-ADD999       XLDA,D
     C  N88                MOVE XLDAA,D   XLDA,D
     C*
     C**
     C           XLDA,D    ADD  BJRDNB    XLDT,D
     C   88
     COR 87                Z-ADD99999     XLDT,D
     C**
     C  N88      DZLLAM    MULT XLPC,D    XLLM,D
     C**
     C           D         COMP 6                      86
     C   86N87N88          GOTO LMTS2
     C   72                Z-ADDSP        XLDA,1
     C   72      SP        ADD  BJRDNB    XLDT,1
     C                     ENDSR
     C**
0684 C********************************************************************
     C**   FORMAT & OUTPUT CUST  LIMIT & EXPOSURE
     C**
     C           FXWRIT    BEGSR                           ** FXWRIT **
     C                     SETON                     60
     C                     SETOF                     70
     C**   CALC EXCESS, CHECK FOR ZERO EXPOSURE
     C                     EXSR EXSFS
     C**   IF NOT ZERO, PRINT. IN60 STILL ON IF ZERO
     C           *IN60     IFNE '1'
0295 C**                                                               ***
     C**   IF U1 NOT ON, PRINT EVEN IF EXPOSURE LESS THAN LIMIT.
     C**    IF U1 ON, ONLY PRINT IF EXPOSURE GREATER THAN LIMIT.
     C           *INU1     IFEQ '0'
     C           *INU1     OREQ '1'
     C********** *IN70     ANDEQ'1'                                       099275
0430 C**                                                                  099275
     C***DETAILS TO PRINT SO SET OFF NO-DETAILS INDICATOR                 099275
     C**********           MOVE '0'       *IN51                           099275
     C**                                                                  E00014
     C** OPEN FILE IF NOT ALREADY OPEN AND PRINT HEADINGS                 E00014
     C           *IN58     IFEQ '0'                                       E00014
     C************         SETON                     OF52          E00014 124759
     C                     OPEN DL0761P1                                  E00014
     C                     SETON                     OF52                 124759
     C                     MOVE '1'       *IN58                           E00014
     C** CALL ZSFILE FOR P1 FILE                                          E00014
     C                     Z-ADDSFNUM1    ZSNUM   60                      E00014
     C                     CALL 'ZSFILE'                                  E00014
     C                     PARM           @RSEQ   5                       E00014
     C                     PARM ENTITY    @PARM   3                       E00014
     C                     PARM           SFILE1                          E00014
     C                     PARM           ZSNUM                           E00014
     C                     PARM           ZSERR   1                       E00014
     C*                                                                   E00014
     C           ZSERR     IFEQ 'Y'                                       E00014
     C** Error during ZSFILE processing, return to calling program        E00014
     C                     SETON                     U7U8LR               E00014
     C                     RETRN                                          E00014
     C                     END                                            E00014
     C*                                                                   E00014
     C                     END                                            E00014
     C           *IN70     IFEQ '1'                                       099275
     C           *INU1     ANDEQ'1'                                       144668
     C           *INU1     OREQ '0'                                       144668
0430 C**                                                                  099275
     C** DETAILS TO PRINT SO SET OFF NO-DETAILS INDICATOR                 099275
     C                     MOVE '0'       *IN51                           099275
0430 C**
0431 C**   PRINT DETAILS
0432 C                     Z-ADD0         D
     C**
0433 C           D         DOUEQ6                                      **
0434 C                     ADD  1         D
0442 C**   MOVE EXPOSURE AMT. TO 10 DIGIT FIELD
0443 C                     Z-ADDXFXP,D    FXPOS  100
     C*
     C** IF NOT ALREADY WRITTEN OUTPUT HEADING FOR THIS CUSTOMER
     C           *IN50     IFEQ '1'
     C                     EXCPTHEADS
     C                     MOVE '0'       *IN50
     C                     END
     C*
0446 C**   PRINT 1ST LINE
     C           D         IFEQ 1
     C**
0447 C                     EXCPTFXLIN1
     C                     ADD  1         RLIST   50
     C                     ELSE
0437 C**   PRINT LINES 2-6 IF REQD
0438 C**   - TEST IF PERIOD END DATE ZERO
0439 C           XFDT,D    COMP 0                    53    PRINT
     C   53
0447 COR 54                EXCPTFXLIN2
     C                     END
0448 C**
0449 C**   - CALCULATE NEXT START OF PERIOD
0450 C           XFDA,D    ADD  1         NEXTF   30
0452 C**
     C                     END
     C                     END                                            099275
     C                     END                             *inu1=1
     C                     END
     C**********                                                          E204
     C****SET*OFF*PAR/NON-PAR*INDS                                        E204
     C**********           SETOF                     4647                 E204
     C**********                                                          E204
     C                     ENDSR                           *** FXWRIT ***
     C**
0595 C********************************************************************
     C**   FORMAT & OUTPUT CUST  LIMIT & EXPOSURE
     C**
     C           LEWRIT    BEGSR                           ** LEWRIT **
     C                     SETON                     60
     C                     SETOF                     70
     C**   CALC EXCESS, CHECK FOR ZERO EXPOSURE
     C                     EXSR EXSLS
     C**   IF NOT ZERO, PRINT. IN60 STILL ON IF ZERO
     C           *IN60     IFNE '1'
0295 C**                                                               ***
     C**   IF U1 NOT ON, PRINT EVEN IF EXPOSURE LESS THAN LIMIT.
     C**    IF U1 ON, ONLY PRINT IF EXPOSURE GREATER THAN LIMIT.
     C           *INU1     IFEQ '0'
     C           *INU1     OREQ '1'
     C********** *IN70     ANDEQ'1'                                       099275
0430 C**                                                                  099275
     C** DETAILS TO PRINT SO SET OFF NO-DETAILS INDICATOR                 099275
     C*********            MOVE '0'       *IN51                           099275
     C**                                                                  E00014
     C** OPEN FILE IF NOT ALREADY OPEN AND PRINT HEADINGS                 E00014
     C           *IN58     IFEQ '0'                                       E00014
     C************         SETON                     OF52           E00014124759
     C                     OPEN DL0761P1                                  E00014
     C                     SETON                     OF52                 124759
     C                     MOVE '1'       *IN58                           E00014
     C** CALL ZSFILE FOR P1 FILE                                          E00014
     C                     Z-ADDSFNUM1    ZSNUM   60                      E00014
     C                     CALL 'ZSFILE'                                  E00014
     C                     PARM           @RSEQ   5                       E00014
     C                     PARM ENTITY    @PARM   3                       E00014
     C                     PARM           SFILE1                          E00014
     C                     PARM           ZSNUM                           E00014
     C                     PARM           ZSERR   1                       E00014
     C*                                                                   E00014
     C           ZSERR     IFEQ 'Y'                                       E00014
     C** Error during ZSFILE processing, return to calling program        E00014
     C                     SETON                     U7U8LR               E00014
     C                     RETRN                                          E00014
     C                     END                                            E00014
     C*                                                                   E00014
     C                     END                                            E00014
0430 C**                                                                  099275
     C           *IN70     IFEQ '1'                                       099275
     C           *INU1     ANDEQ'1'                                       144668
     C           *INU1     OREQ '0'                                       144668
0430 C**                                                                  099275
     C** DETAILS TO PRINT SO SET OFF NO-DETAILS INDICATOR                 099275
     C                     MOVE '0'       *IN51                           099275
0430 C**
0431 C**   PRINT DETAILS
0432 C                     Z-ADD0         D
     C**
0433 C           D         DOUEQ6                                      **
0434 C                     ADD  1         D
0442 C**   MOVE EXPOSURE AMT. TO 10 DIGIT FIELD
0444 C                     Z-ADDXLXP,D    LXPOS  100
     C*
     C** IF NOT ALREADY WRITTEN OUTPUT HEADING FOR THIS CUSTOMER
     C           *IN50     IFEQ '1'
     C                     EXCPTHEADS
     C                     MOVE '0'       *IN50
     C                     END
     C*
0446 C**   PRINT 1ST LINE
     C           D         IFEQ 1
     C**
0447 C                     EXCPTLELIN1
     C                     ADD  1         RLIST   50
     C                     ELSE
0437 C**   PRINT LINES 2-6 IF REQD
0438 C**   - TEST IF PERIOD END DATE ZERO
0440 C           XLDT,D    COMP 0                    54    PRINT
     C   53
0447 COR 54                EXCPTLELIN2
     C                     END
0448 C**
0449 C**   - CALCULATE NEXT START OF PERIOD
0451 C           XLDA,D    ADD  1         NEXTL   30
0452 C**
     C                     END
     C/COPY WNCPYSRC,DL0761C008
      *                                                                   CDL006
      ** If CDL006 is installed                                           CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVE *ON       *IN80                           CDL006
     C                     Z-ADD0         D                               CDL006
      *                                                                   CDL006
     C           D         DOUEQ6                                         CDL006
     C                     ADD  1         D                               CDL006
      *                                                                   CDL006
      ** Move Exposure amount to 10 digit field                           CDL006
      *                                                                   CDL006
     C                     Z-ADDFIXP,D    FIXPOS 100                      CDL006
      *                                                                   CDL006
      ** If not already written output heading for this customer          CDL006
      *                                                                   CDL006
     C           *IN50     IFEQ '1'                                       CDL006
     C                     EXCPTHEADS                                     CDL006
     C                     MOVE '0'       *IN50                           CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Print 1st line                                                   CDL006
      *                                                                   CDL006
     C           D         IFEQ 1                                         CDL006
     C                     EXCPTFILIN1                                    CDL006
     C                     ADD  1         FILIST  50                      CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Print line 2-6 if required, test if period end date zero         CDL006
      *                                                                   CDL006
     C           FIDT,D    COMP 0                    31                   CDL006
     C   31                EXCPTFILIN2                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** - Calculate next start of period                                 CDL006
      *                                                                   CDL006
     C           FIDA,D    ADD  1         NEXTFI  30                      CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
     C                     END                                            099275
     C                     END                             *inu1=1
     C                     END
     C**********                                                          E204
     C****SET*OFF*PAR/NON-PAR INDS                                        E204
     C**********           SETOF                     4647                 E204
     C**********                                                          E204
     C                     ENDSR                           *** LEWRIT ***
     C**
0595 C********************************************************************
      /EJECT                                                              S01157
      ********************************************************************S01157
      *                                                                  *S01157
      *    FRA - FORMAT & OUTPUT CUSTOMER LIMIT & EXPOSURE               *S01157
      *                                                                  *S01157
      ********************************************************************S01157
      *                                                                   S01157
     C           FRWRIT    BEGSR                           ** FRWRIT **   S01157
      *                                                                   S01157
     C                     MOVE '1'       *IN60                           S01157
     C                     MOVE '0'       *IN70                           S01157
      *                                                                   S01157
      *  Calculate Excess Exposure, Check for Zero Exposure               S01157
     C                     EXSR EXSRS                                     S01157
      *                                                                   S01157
      *  If Not Zero, PRINT...*IN60 still ON if Zero                      S01157
     C           *IN60     IFNE '1'                                       S01157
      *                                                                   S01157
      *  If U1 NOT on, PRINT even if exposure LESS than Limit.            S01157
      *  If U1 on, only PRINT if exposure GREATER than Limit.             S01157
     C           *INU1     IFEQ '0'                                       S01157
     C           *INU1     OREQ '1'                                       S01157
     C********** *IN70     ANDEQ'1'                                       099275
      *                                                                   099275
      ***Details*to*print*so*set off NO-DETAILS INDICATOR                 099275
     C**********           MOVE '0'       *IN51                           099275
      *                                                                   S01157
      *  Open file if not already open and print headings                 S01157
     C           *IN58     IFEQ '0'                                       S01157
     C************         SETON                     OF52          S01157 124759
     C                     OPEN DL0761P1                                  S01157
     C                     SETON                     OF52                 124759
     C                     MOVE '1'       *IN58                           S01157
      *                                                                   S01117
      *  Call ZSFILE for P1 file.                                         S01117
     C                     Z-ADDSFNUM1    ZSNUM   60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ   5                       S01117
     C                     PARM ENTITY    @PARM   3                       S01117
     C                     PARM           SFILE1                          S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
      *                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
      *                                                                   S01117
      *  Error during ZSFILE processing, return to calling program        S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01157
     C*                                                                   LN0633
     C           *IN70     IFEQ '1'                                       099275
     C           *INU1     ANDEQ'1'                                       144668
     C           *INU1     OREQ '0'                                       144668
      *                                                                   099275
      *  Details to print so set off NO-DETAILS INDICATOR                 099275
     C                     MOVE '0'       *IN51                           099275
     C** IF NOT ALREADY WRITTEN OUTPUT HEADING FOR THIS CUSTOMER          LN0633
     C           *IN50     IFEQ '1'                                       LN0633
     C                     EXCPTHEADS                                     LN0633
     C                     MOVE '0'       *IN50                           LN0633
     C                     END                                            LN0633
      *                                                                   S01157
      *  Print details.                                                   S01157
     C                     EXCPTFRLIN                                     S01157
      *                                                                   S01157
     C                     ADD  1         RLIST   50                      S01157
      *                                                                   S01157
      ***Initialise*exposure*field.***                             S01157 099251
     C***********          Z-ADD0         RXPOS                    S01157 099251
     C                     END                                            S01157
      *  Initialise exposure field.                                       099251
     C                     Z-ADD0         RXPOS                           099251
     C                     END                                            S01157
     C                     END                                            099275
      *                                                                   S01157
      ***Set*OFF*par/non-par inds.                                  S01157076018
     C***********          SETOF                     4647           S01157076018
      *                                                                   S01157
     C                     ENDSR                           *** FRWRIT *** S01157
      *                                                                   S01157
      ********************************************************************S01157
      /EJECT                                                              S01157
      ********************************************************************S01157
      *                                                                  *S01157
      *    IRS - FORMAT & OUTPUT CUSTOMER LIMIT & EXPOSURE               *S01157
      *                                                                  *S01157
      ********************************************************************S01157
      *                                                                   S01157
     C           IRWRIT    BEGSR                           ** IRWRIT **   S01157
      *                                                                   S01157
     C                     MOVE '1'       *IN60                           S01157
     C                     MOVE '0'       *IN70                           S01157
      *                                                                   S01157
      *  Calculate Excess Exposure, Check for Zero Exposure               S01157
     C                     EXSR EXSIS                                     S01157
      *                                                                   S01157
      *  If Not Zero, PRINT...*IN60 still ON if Zero                      S01157
     C           *IN60     IFNE '1'                                       S01157
      *                                                                   S01157
      *  If U1 NOT on, PRINT even if exposure LESS than Limit.            S01157
      *  If U1 on, only PRINT if exposure GREATER than Limit.             S01157
     C           *INU1     IFEQ '0'                                       S01157
     C           *INU1     OREQ '1'                                       S01157
     C********** *IN70     ANDEQ'1'                                       099275
      *                                                                   099275
      ***Details*to*print so set off NO-DETAILS INDICATOR                 099275
     C**********           MOVE '0'       *IN51                           099275
      *                                                                   S01157
      *  Open file if not already open and print headings                 S01157
     C           *IN58     IFEQ '0'                                       S01157
     C************         SETON                     OF52          S01157 124759
     C                     OPEN DL0761P1                                  S01157
     C                     SETON                     OF52                 124759
     C                     MOVE '1'       *IN58                           S01157
      *                                                                   S01157
      *  Call ZSFILE for P1 file.                                         S01117
     C                     Z-ADDSFNUM1    ZSNUM   60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           @RSEQ   5                       S01117
     C                     PARM ENTITY    @PARM   3                       S01117
     C                     PARM           SFILE1                          S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
      *                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
      *                                                                   S01117
      *  Error during ZSFILE processing, return to calling program        S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01157
     C           *IN70     IFEQ '1'                                       099275
     C           *INU1     ANDEQ'1'                                       144668
     C           *INU1     OREQ '0'                                       144668
      *                                                                   099275
      *  Details to print so set off NO-DETAILS INDICATOR                 099275
     C                     MOVE '0'       *IN51                           099275
     C*                                                                   LN0633
     C** IF NOT ALREADY WRITTEN OUTPUT HEADING FOR THIS CUSTOMER          LN0633
     C           *IN50     IFEQ '1'                                       LN0633
     C                     EXCPTHEADS                                     LN0633
     C                     MOVE '0'       *IN50                           LN0633
     C                     END                                            LN0633
      *                                                                   S01157
      *  Print details.                                                   S01157
     C                     EXCPTIRLIN                                     S01157
      *                                                                   S01157
     C                     ADD  1         RLIST   50                      S01157
      *                                                                   S01157
      ***Initialise*exposure*field.***                             S01157 099251
     C***********          Z-ADD0         IXPOS                    S01157 099251
     C                     END                                            S01157
      *  Initialise exposure field.                                       099251
     C                     Z-ADD0         IXPOS                           099251
     C                     END                                            S01157
     C                     END                                            099275
      *                                                                   S01157
      ***Set*OFF*par/non-par inds.                                 S01157 076018
     C***********          SETOF                     4647          S01157 076018
      *                                                                   S01157
     C                     ENDSR                           *** IRWRIT *** S01157
      *                                                                   S01157
      ********************************************************************S01157
      /EJECT                                                              S01157
      ********************************************************************S01157
     C**   BR/CO LEVEL LIMITS
0668 C**   EXSFS  SR. WORKS OUT EXCESS EXPOSURE FOR FX
0669 C**   -FIRST ROUNDS EXPOSURE FOR EACH PERIOD TO NEAREST 1000 UNITS
0670 C**   -THEN COMPARES EXPOSURE AMOUNTS TO CORRESP. LIMIT AMOUNTS.
0671 C           EXSFS     BEGSR                           **  EXSFS   **
0672 C                     Z-ADD0         D
0673 C           EXSFS1    TAG                             **  EXSFS1  **
0674 C           D         ADD  1         D
0675 C           XFXP,D    DIV  1000      XFXP,D    H
     C   60      XFXP,D    COMP 0                        60
0676 C           XFXP,D    COMP XFLM,D               89
0677 C   89      XFXP,D    SUB  XFLM,D    XFXS,D
     C   89                SETON                     70
0678 C**
0679 C**   LOOP ROUND AGAIN IF LESS THAN 6 PERIODS HAVE BEEN PROCESSED
0680 C           D         COMP 6                      89
0681 C   89                GOTO EXSFS1
0682 C                     ENDSR
0683 C**
0685 C********************************************************************
     C**   BR/CO LEVEL LIMITS
0686 C**   EXSLS  SR. WORKS OUT EXCESS EXPOSURE FOR LOANS.
0687 C           EXSLS     BEGSR                           **  EXSLS **
0688 C                     Z-ADD0         D
0689 C           EXSLS1    TAG                             **  EXSLS1  **
0690 C           D         ADD  1         D
0691 C           XLXP,D    DIV  1000      XLXP,D    H
     C   60      XLXP,D    COMP 0                        60
0692 C           XLXP,D    COMP XLLM,D               89
0693 C   89      XLXP,D    SUB  XLLM,D    XLXS,D
     C   89                SETON                     70
0694 C**
0695 C           D         COMP 6                      89
0696 C   89                GOTO EXSLS1
     C/COPY WNCPYSRC,DL0761C009
      *                                                                   CDL006
      ** If CCDL006 is installed                                          CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     Z-ADD0         D                               CDL006
     C           EXFIS2    TAG                                            CDL006
     C           D         ADD  1         D                               CDL006
     C           FIXP,D    DIV  1000      FIXP,D    H                     CDL006
     C   60      FIXP,D    COMP 0                        60               CDL006
     C           FIXP,D    COMP FILM,D               89                   CDL006
     C   89      FIXP,D    SUB  FILM,D    FIXS,D                          CDL006
     C   89                SETON                     70                   CDL006
      *                                                                   CDL006
     C           D         COMP 6                      89                 CDL006
     C   89                GOTO EXFIS2                                    CDL006
     C                     END                                            CDL006
0697 C                     ENDSR
0698 C**
0699 C********************************************************************
     C/EJECT                                                              S01157
      ********************************************************************S01157
      *                                                                  *S01157
      *    EXSRS - CALCULATE FRA EXCESS EXPOSURE                         *S01157
      *                                                                  *S01157
      ********************************************************************S01157
      *                                                                   S01157
     C           EXSRS     BEGSR                           ** EXSRS **    S01157
      *                                                                   S01157
      ** FRA EVENT                                                        S01157
      ** Convert exposure amount to thousands first                       S01157
     C           RXPOS     DIV  1000      RXPOS     H                     S01157
     C           RXPOS     SUB  XRLM      XRXS                            S01157
     C***********XRXS      IFLT 0                                  S01157 080947
     C           XRXS      IFLE 0                                         080947
     C                     Z-ADD0         XRXS   100                      S01157
     C                     ELSE                                           S01157
     C                     SETON                         70               S01157
     C                     END                                            S01157
      *                                                                   S01157
      ** If exposure is non-zero, then set-off ind 60                     S01157
     C           RXPOS     IFGT 0                                         S01157
     C                     MOVE '0'       *IN60                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     ENDSR                           *** EXSRS ***  S01157
      *                                                                   S01157
      ********************************************************************S01157
      /EJECT                                                              S01157
      ********************************************************************S01157
      *                                                                  *S01157
      *    EXSIS - CALCULATE IRS EXCESS EXPOSURE                         *S01157
      *                                                                  *S01157
      ********************************************************************S01157
      *                                                                   S01157
     C           EXSIS     BEGSR                           ** EXSIS **    S01157
      *                                                                   S01157
      ** IRS EVENT                                                        S01157
      ** Convert exposure amount to thousands first                       S01157
     C           IXPOS     DIV  1000      IXPOS     H                     S01157
     C           IXPOS     SUB  XILM      XIXS                            S01157
     C***********XIXS      IFLT 0                                  S01157 080947
     C           XIXS      IFLE 0                                         080947
     C                     Z-ADD0         XIXS   100                      S01157
     C                     ELSE                                           S01157
     C                     SETON                         70               S01157
     C                     END                                            S01157
      *                                                                   S01157
      ** If exposure is non-zero, then set-off ind 60                     S01157
     C           IXPOS     IFGT 0                                         S01157
     C                     MOVE '0'       *IN60                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     ENDSR                           *** EXSIS ***  S01157
      *                                                                   S01157
      ********************************************************************S01157
     C/EJECT
0699 C********************************************************************
     C**
     C**   P/DL0131 TO GET DEFAULT LIMITS FOR SYSTEM OR COMPANY LEVEL
     C**
     C           DL0131    BEGSR
     C                     Z-ADD0         FXLIM   90
     C                     Z-ADD0         LNLIM   90
     C                     MOVE 'Y'       FXSAME  1
     C                     MOVE 'Y'       LNSAME  1
     C                     MOVE *BLANKS   FXPER  18
     C                     MOVE *BLANKS   LNPER  18
     C                     MOVE *BLANKS   FXPC   18
     C                     MOVE *BLANKS   LNPC   18
     C                     CALL 'DL0131'
     C                     PARM           CUST
     C                     PARM           @RLEV
     C                     PARM           ENTY
     C                     PARM           FDEF
     C                     PARM           LDEF
     C*************        PARM           FRA     1                       S01157
     C*************        PARM           IRS     1                       S01157
     C                     PARM           RDEF                            S01157
     C                     PARM           IDEF                            S01157
     C                     PARM           FXLIM
     C                     PARM           LNLIM
     C                     PARM           FRLIM   90
     C                     PARM           IRLIM   90
     C                     PARM           FXSAME
     C                     PARM           LNSAME
     C                     PARM           FXPER
     C                     PARM           LNPER
     C                     PARM           FXPC
     C                     PARM           LNPC
     C                     PARM           BJRDNB
     C                     ENDSR
0848 C********************************************************************
0849 C**
0850 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
0851 C**
0852 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
0853 C**
0854 C           ZDATE2    BEGSR                           *** ZDATE2 ***
0855 C**
0856 C**   CLEAR DATE FIELDS.
0857 C                     Z-ADD0         ZDATE   60
0858 C                     MOVEL'       ' ZADATE  7
0859 C**
0860 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
0861 C                     Z-ADDZDAYNO    ZDAYNO  50
0862 C**
0863 C**   DETERMINE YEAR NUMBER.
0864 C**
0865 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
0866 C           ZDAYNO    SUB  1         ZDAYN1  50   99
0867 C   99                GOTO ZDEND2
0868 C**
0869 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
0870 C           ZDAYN1    DIV  1461      ZLYR    20
0871 C                     MVR            ZDAYN1           SAVE REMAINING
0872 C**                                                   DAYS
0873 C**   CALCULATE NUMBER OF REMAINING YEARS.
0874 C                     Z-ADD1         ZWRK2   20
0875 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
0876 C           ZDAYN1    COMP ZYDY,ZWRK2             90
0877 C  N90      ZWRK2     ADD  1         ZWRK2
0878 C  N90                GOTO ZDTAG1
0879 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
0880 C**
0881 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
0882 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
0883 C**
0884 C**   CALCULATE ACTUAL YEAR NUMBER.
0885 C           ZLYR      MULT 4         ZWRK3   30
0886 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
0887 C                     Z-ADDZWRK3     ZYEAR   20
0888 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
0889 C**
0890 C**   DETERMINE MONTH NUMBER.
0891 C**
0892 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
0893 C                     SETOF                     9293
0894 C   91      ZDAYN1    COMP 59                     9293
0895 C   91N92   ZDAYN1    SUB  1         ZDAYN1
0896 C**
0897 C**   CALCULATE MONTH NUMBER.
0898 C                     Z-ADD2         ZWRK2
0899 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
0900 C           ZDAYN1    COMP ZMDY,ZWRK2             94
0901 C  N94      ZWRK2     ADD  1         ZWRK2
0902 C  N94                GOTO ZDTAG2
0903 C           ZWRK2     SUB  1         ZWRK2
0904 C**
0905 C                     Z-ADDZWRK2     ZMTH    20       MONTH
0906 C**
0907 C**   DETERMINE DAY OF MONTH.
0908 C**
0909 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
0910 C           ZDAYN1    ADD  1         ZDAYN1
0911 C**
0912 C**   CALCULATE DAY OF MONTH.
0913 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
0914 C**
0915 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
0916 C   93      ZDAY      ADD  1         ZDAY
0917 C**
0918 C**   FORMAT DATE, DDMMYY OR MMDDYY.
0919 C  N98                MOVELZDAY      ZWRK4   40
0920 C   98                MOVE ZDAY      ZWRK4
0921 C  N98                MOVE ZMTH      ZWRK4
0922 C   98                MOVELZMTH      ZWRK4
0923 C                     MOVELZWRK4     ZDATE
0924 C                     MOVE ZYEAR     ZDATE
0925 C**
0926 C**   FORMAT ALPHA DATE, DDMMMYY.
0927 C           ZDAY      COMP 10                     95
0928 C                     MOVELZDAY      ZWRK5   5
0929 C   95                MOVEL' '       ZWRK5
0930 C                     MOVE ZMNM,ZMTH ZWRK5
0931 C                     MOVELZWRK5     ZADATE
0932 C                     MOVE ZYEAR     ZADATE
0933 C**
0934 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
0935 C**
0936 C**
0719 C********************************************************************
0719 C/COPY ZSRSRC,ZFWDT                                               ***
0719 C/COPY ZSRSRC,ZACCH                                               ***
0719 C********************************************************************
     C**  FIRST CYCLE PROCESS
     C           FIRST     BEGSR                            ** FIRST **
     C                     SETON                     42
     C                     MOVEACPY@      BIS@   80
     C/COPY WNCPYSRC,DL0761C010
      *                                                                   CDL006
      **  Access SAR Details File to determine if Fiduciary Deposits is   CDL006
      **  installed                                                       CDL006
      *                                                                   CDL006
     C                     MOVEL'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM '       ' PRTCD   7                       CDL006
     C                     PARM '*VERIFY' POPTN   7                       CDL006
     C                     PARM 'CDL006'  PSARD   6                       CDL006
      *                                                                   CDL006
     C           PRTCD     IFEQ *BLANK                                    CDL006
     C                     MOVEL'Y'       CDL006                          CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE *BLANKS                                   CDL006
     C           PRTCD     ANDNE'*NRF   '                                 CDL006
     C                     MOVEL'SCSARDPD'DBFILE                          CDL006
     C                     MOVEL'011'     DBASE                           CDL006
     C                     MOVELPOPTN     DBOPTN                          CDL006
     C                     MOVELPOPTN     DBKEY                           CDL006
     C                     MOVE *ON       *INU7                           CDL006
     C                     MOVE *ON       *INU8                           CDL006
     C                     MOVE *ON       *INLR                           CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     GOTO END                                       CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Open deals file if Net FX Customer Limits indicator is 'N' but   CDL006
      ** feature CDL006 is installed.                                     CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C           BNNTCE    ANDNE'Y'                                       CDL006
     C                     OPEN DEALS                                     CDL006
     C                     ENDIF                                          CDL006
     C*
     C** OBTAIN BANK DETAILS VIA ACCESS PROGRAM
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBANKPD'DBFILE 10        ************
     C                     MOVEL'01'      DBASE   3        * DBERR 01 *
     C                     MOVEL@OPTN     DBOPTN  7        ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO END
     C                     END
     C*
     C** TEST DATE FORMAT VALUE
0951 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON
     C*                                                                   S01157
     C** Obtain MODULE details via ACCESS PROGRAM                         S01157
     C                     CALL 'AOMMODR0'                                S01157
     C                     PARM '*MSG   ' @RTCD   7                       S01157
     C                     PARM '*FIRST ' @OPTN   7                       S01157
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01157
     C           @RTCD     IFNE *BLANK                                    S01157
     C                     MOVEL'SDMMODPD'DBFILE 10        ************   S01157
     C                     MOVEL'04'      DBASE   3        * DBERR 04 *   S01157
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01157
     C                     SETON                     U7U8LR               S01157
     C                     EXSR *PSSR                                     S01157
     C                     GOTO END                                       S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C** Check if FRA/IRS module present.                                 S01157
     C           BGFIIN    IFEQ 'Y'                                       S01157
     C                     MOVE '1'       *IN30                           S01157
     C                     END                                            S01157
0951 C*
     C** READ DEAL DETAILS VIA ACCESS PROGRAM FOR BASE CCY FOR LIMITS
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     MOVEL'02'      DBASE            * DBERR 02 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO END
     C                     END
0951 C*                                                                N
     C** READ CCY DETAILS VIA ACCESS PROGRAM FOR DECIMAL PLACES
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM BNCYCD    @AJCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     MOVEL'03'      DBASE            * DBERR 03 *
     C                     MOVEL@OPTN     DBOPTN  7        ************
     C                     MOVEL@AJCD     DBKEY  29
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO END
     C                     END
0330 C*
0331 C*    OBTAIN NO. OF DAYS FORWARD FOR 'SP'
0332 C                     Z-ADDBJRDNB    ZDAYNO
0333 C                     MOVE BNCYCD    ZCCY
0334 C                     Z-ADD2         ZNRDYS
     C                     MOVE BJSLCD    ZLOC
0335 C                     EXSR ZFWDT
0336 C           ZDYNBR    SUB  BJRDNB    SP      50
     C****IS*SELECTIONFOR*FOR ONE ENTITY                                  E204
     C********** @RENT     IFNE 'ALL'                                     E204
     C**********           MOVE '1'       *IN43                           E204
     C**********           END                                            E204
     C**
     C**  SET RPT HEADINGS ACCORDING TO LEVEL SELECTED
     C           @RLEV     IFEQ 'B'
     C                     MOVE '1'       *IN45
     C                     MOVE HDG,1     OPTION 23
     C                     END
     C           @RLEV     IFEQ 'C'
     C                     MOVE '0'       *IN45
     C                     MOVE HDG,2     OPTION
     C                     END
     C**
     C           @RLEV     IFNE 'B'
     C           @RLEV     ANDNE'C'
     C                     MOVE HDG,3     OPTION
     C                     END
     C**
     C**  FOR ORIGINATING OR BOOKING BRANCH
     C           @OB       IFEQ 'O'
     C                     MOVE HDG,4     BRANCH 23
     C                     ELSE
     C           @OB       IFEQ 'B'
     C                     MOVE HDG,5     BRANCH
     C                     END
     C                     END
      *                                                                   S01498
      ** Call Access Program for Portfolio Lending ICD.                   S01498
     C           BGLMCR    IFEQ 'Y'                                       S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM '*MSG    '@RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01498
      *                                                                   S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C                     MOVEL'SDLOMBPD'DBFILE 10         ************* S01498
     C                     MOVEL'06'      DBASE   3         *DBERROR 006* S01498
     C                     MOVEL@OPTN     DBOPTN  7         ************* S01498
     C                     SETON                     U7U8LR               S01498
     C                     EXSR *PSSR                                     S01498
     C                     GOTO END                                       S01498
     C                     END                                            S01498
     C                     END                                            S01498
      *                                                                   CDL002
      * Save entity                                                       CDL002
     C                     MOVE ENTITY    W4ENTI                          CDL002
      *                                                                   CDL002
0337 C**
0341 C           END       ENDSR
     C/COPY WNCPYSRC,DL0761C011
      ********************************************************************CDL006
      *  SR - LMTSFI                                                     *CDL006
      ********************************************************************CDL006
     C           LMTSFI    BEGSR                                          CDL006
      *                                                                   CDL006
     C                     Z-ADD0         D                               CDL006
     C           FIDAA,1   COMP 'SP '                    72               CDL006
     C           LMTFI2    TAG                                            CDL006
      *                                                                   CDL006
     C           D         ADD  1         D                               CDL006
     C           FIDAA,D   COMP '000'                    88               CDL006
     C           FIDAA,D   COMP '999'                    87               CDL006
     C   88                Z-ADD999       FIDA,D                          CDL006
     C  N88                MOVE FIDAA,D   FIDA,D                          CDL006
      *                                                                   CDL006
     C           FIDA,D    ADD  BJRDNB    FIDT,D                          CDL006
     C   88                                                               CDL006
     COR 87                Z-ADD99999     FIDT,D                          CDL006
      *                                                                   CDL006
     C  N88      FIFILA    MULT FIPC,D    FILM,D                          CDL006
      *                                                                   CDL006
     C           D         COMP 6                      86                 CDL006
     C   86N87N88          GOTO LMTFI2                                    CDL006
     C   72                Z-ADDSP        FIDA,1                          CDL006
     C   72      SP        ADD  BJRDNB    FIDT,1                          CDL006
      *                                                                   CDL006
     C                     ENDSR                                          CDL006
     C*
     C*****************************************************************   CDL002
     C           *INZSR    BEGSR                            ** INZSR **   CDL002
     C*****************************************************************   CDL002
     C*                                                                   CDL002
     C* Get Dealing ICD                                                   CDL002
     C**********           CALL 'AODEALR0'                                             CDL002 CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           CDL002
     C                     PARM '*FIRST ' @OPTN                           CDL002
     C********** SDDEAL    PARM SDDEAL    DSFDY                                        CDL002 CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    CDL002
     C                     MOVEL'SDDEALPD'DBFILE           ************   CDL002
     C                     MOVEL'08'      DBASE            * DBERR 08 *   CDL002
     C                     MOVEL@OPTN     DBOPTN           ************   CDL002
     C                     SETON                     U7U8LR               CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
     C*                                                                   CDL002
     C* FX Netting?                                                       CDL002
     C                     CALL 'AOSARDR0'                                CDL002
     C                     PARM *BLANKS   @RTCD                           CDL002
     C                     PARM '*VERIFY' @OPTN                           CDL002
     C                     PARM 'CDL002'  WSARD   6                       CDL002
     C                     MOVE 'N'       CDL002  1                       CDL002
     C           @RTCD     IFEQ *BLANK                                    CDL002
     C                     MOVE 'Y'       CDL002                          CDL002
     C                     CLEARW#NTCE                                    CDL002
     C*                                                                   CDL002
     C* Net FX Customer Exposure?                                         CDL002
     C           BNNTCE    IFEQ 'Y'                                       CDL002
     C                     MOVE BNNTCE    W#NTCE  1                       CDL002
     C/COPY WNCPYSRC,DL0761C014
     C                     OPEN DEALS                                     CDL002
     C/COPY WNCPYSRC,DL0761C015
     C                     OPEN FXNEVTP                                   CDL002
     C                     OPEN FXNEVTN                                   CDL002
     C*   Get first parent net event                                      CDL002
     C                     READ FXNEVTP                  83               CDL002
     C           *IN83     IFEQ *OFF                                      CDL002
     C                     MOVE ENTITY    W1ENTI                          CDL002
     C                     MOVE PASK      W1PASK                          CDL002
     C                     MOVE PTNU      W1PTNU                          CDL002
     C                     MOVE *ON       *IN03                           CDL002
     C                     ELSE                                           CDL002
     C*   Get first customer net event                                    CDL002
     C                     READ FXNEVTN                  84               CDL002
     C           *IN84     IFEQ *ON                                       CDL002
     C                     MOVE *HIVAL    W1ENTI                          CDL002
     C                     MOVE *HIVAL    W1PASK                          CDL002
     C                     MOVE *HIVAL    W1PTNU                          CDL002
     C                     MOVE *HIVAL    W1CASK                          CDL002
     C                     MOVE *HIVAL    W1CUNR                          CDL002
     C                     ELSE                                           CDL002
     C                     MOVE ENTITY    W1ENTI                          CDL002
     C                     MOVE PASK      W1PASK                          CDL002
     C                     MOVE PTNU      W1PTNU                          CDL002
     C                     MOVE CASK      W1CASK                          CDL002
     C                     MOVE CUNR      W1CUNR                          CDL002
     C                     MOVE *ON       *IN04                           CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C*                                                                   CDL002
     C                     ENDSR                                          CDL002
     C*                                                                   CDL002
     C*****************************************************************   CDL002
     C           NEVT1     BEGSR                                          CDL002
     C*****************************************************************   CDL002
      *                                                                   CDL002
     C           W1ENTI    IFLT ENTITY                                    CDL002
     C           *IN02     OREQ *ON                                       CDL002
     C           *IN03     ANDEQ*ON                                       CDL002
      *                                                                   CDL002
      * Save event fields and indicators                                  CDL002
     C                     MOVELW2EVL     W3SAVE    P                     CDL002
     C                     MOVE *IN01     W2IN01                          CDL002
     C                     MOVE *IN02     W2IN02                          CDL002
     C                     MOVE *IN44     W2IN44                          CDL002
     C                     MOVE *IN46     W2IN46                          CDL002
     C                     MOVE *IN47     W2IN47                          CDL002
      *                                                                   CDL002
      * Get FX Net again                                                  CDL002
     C           *IN83     IFEQ *OFF                                      CDL002
     C           K1PTNU    CHAINFXNEVTP              83                   CDL002
     C                     ELSE                                           CDL002
     C           K1CUNR    CHAINFXNEVTN              84                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     MOVELENTITY    W4ENTI                          CDL002
     C           *IN02     IFEQ *ON                                       CDL002
     C           *IN03     ANDEQ*ON                                       CDL002
     C                     MOVE *HIVAL    W4ENTI                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Process all FX Nets up to the Entity that we have saved           CDL002
     C           W1ENTI    DOWLTW3ENTI                                    CDL002
     C           *IN03     ANDEQ*ON                                       126977
     C           *IN83     ANDEQ*OFF                                      126977
     C           W1ENTI    ORLT W3ENTI                                    126977
     C           *IN04     ANDEQ*ON                                       126977
     C           *IN84     ANDEQ*OFF                                      126977
     C           *IN02     OREQ *ON                                       CDL002
     C           *IN03     ANDEQ*ON                                       CDL002
      *                                                                   CDL002
     C                     EXSR NEVTSL                                    CDL002
      *                                                                   CDL002
      * New print file for new entity?                                    CDL002
     C           W1ENTI    IFNE W4ENTI                                    CDL002
     C                     EXCPTTRAILR                                    CDL002
     C                     SETOF                     OF                   166671
     C                     MOVE *OFF      *IN58                           CDL002
     C                     CLOSEDL0761P1                                  CDL002
     C                     MOVE *ON       *IN50                           CDL002
     C                     MOVE ENTITY    W4ENTI                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Process net group settlement customer                             CDL002
     C                     EXSR NEVTP                                     CDL002
     C                     ENDDO                                          CDL002
      *                                                                   CDL002
      * Restore event fields and indicators                               CDL002
     C                     MOVELW3SAVE    W2EVL                           CDL002
     C                     MOVE W2IN01    *IN01                           CDL002
     C                     MOVE W2IN02    *IN02                           CDL002
     C                     MOVE W2IN44    *IN44                           CDL002
     C                     MOVE W2IN46    *IN46                           CDL002
     C                     MOVE W2IN47    *IN47                           CDL002
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C           K1PTNU    KLIST                                          CDL002
     C                     KFLD           W1ENTI                          CDL002
     C                     KFLD           W1PASK                          CDL002
     C                     KFLD           W1PTNU                          CDL002
      *                                                                   CDL002
     C           K1CUNR    KLIST                                          CDL002
     C                     KFLD           W1ENTI                          CDL002
     C                     KFLD           W1PASK                          CDL002
     C                     KFLD           W1PTNU                          CDL002
     C                     KFLD           W1CASK                          CDL002
     C                     KFLD           W1CUNR                          CDL002
      *                                                                   CDL002
     C           *LIKE     DEFN ENTITY    W4ENTI                          CDL002
     C           *LIKE     DEFN *IN01     W2IN01                          CDL002
     C           *LIKE     DEFN *IN02     W2IN02                          CDL002
     C           *LIKE     DEFN *IN44     W2IN44                          CDL002
     C           *LIKE     DEFN *IN46     W2IN46                          CDL002
     C           *LIKE     DEFN *IN47     W2IN47                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
     C*                                                                   CDL002
     C*****************************************************************   CDL002
     C           NEVT2     BEGSR                                          CDL002
     C*****************************************************************   CDL002
      *                                                                   CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C           *IN83     ANDEQ*OFF                                      126977
     C           W1KEYP    ANDLTW2KEYP                                    CDL002
      *                                                                   CDL002
     C           *IN04     OREQ *ON                                       CDL002
     C           *IN84     ANDEQ*OFF                                      126977
     C           W1KEYN    ANDLTW2KEYN                                    CDL002
      *                                                                   CDL002
      * Save event fields and indicators                                  CDL002
     C                     MOVELW2EVL     W3SAVE    P                     CDL002
     C                     MOVE *IN01     W2IN01                          CDL002
     C                     MOVE *IN02     W2IN02                          CDL002
     C                     MOVE *IN44     W2IN44                          CDL002
     C                     MOVE *IN46     W2IN46                          CDL002
     C                     MOVE *IN47     W2IN47                          CDL002
      *                                                                   CDL002
      * Get FX Net again                                                  CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C           K1PTNU    CHAINFXNEVTP              83                   CDL002
     C                     ELSE                                           CDL002
     C           K1CUNR    CHAINFXNEVTN              84                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C           *IN03     DOWEQ*ON                                       CDL002
     C           *IN83     ANDEQ*OFF                                      126977
     C           W1KEYP    ANDLTW3KEYP                                    CDL002
     C           *IN04     OREQ *ON                                       CDL002
     C           *IN84     ANDEQ*OFF                                      126977
     C           W1KEYN    ANDLTW3KEYN                                    CDL002
      *                                                                   CDL002
     C                     EXSR NEVTSL                                    CDL002
      *                                                                   CDL002
     C                     EXSR NEVTP                                     CDL002
     C                     ENDDO                                          CDL002
      *                                                                   CDL002
      * Restore event fields and indicators                               CDL002
     C                     MOVELW3SAVE    W2EVL                           CDL002
     C                     MOVE W2IN01    *IN01                           CDL002
     C                     MOVE W2IN02    *IN02                           CDL002
     C                     MOVE W2IN44    *IN44                           CDL002
     C                     MOVE W2IN46    *IN46                           CDL002
     C                     MOVE W2IN47    *IN47                           CDL002
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
     C*                                                                   CDL002
      *****************************************************************   CDL002
      * Process any Net Group Settlement Customers after last customer*   CDL002
      * with events                                                   *   CDL002
      *****************************************************************   CDL002
     C           NEVTLR    BEGSR                                      *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     MOVELW1ENTI    W4ENTI                          CDL002
     C           *IN83     DOWEQ*OFF                                      CDL002
     C           *IN84     OREQ *OFF                                      CDL002
      *                                                                   CDL002
      * Get FX Net again                                                  CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C           K1PTNU    CHAINFXNEVTP              83                   CDL002
     C                     ELSE                                           CDL002
     C           K1CUNR    CHAINFXNEVTN              84                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C           ENTITY    IFNE W4ENTI                                    CDL002
      *                                                                   CDL002
     C                     EXCPTTRAILR                                    CDL002
     C                     SETOF                     OF                   166671
     C                     MOVE *OFF      *IN58                           CDL002
     C                     CLOSEDL0761P1                                  CDL002
     C                     MOVE *ON       *IN51                           CDL002
     C                     MOVE ENTITY    W4ENTI                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     EXSR NEVTSL                                    CDL002
      *                                                                   CDL002
     C                     MOVE ENTITY    W4ENTI                          CDL002
      *                                                                   CDL002
     C                     EXSR NEVTP                                     CDL002
     C*                                                                   CDL002
     C                     ENDDO                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
     C*                                                                   CDL002
     C*****************************************************************   CDL002
     C           NEVTSL    BEGSR                                      *   CDL002
     C*****************************************************************   CDL002
      *                                                                   CDL002
     C                     SELEC                                          CDL002
      * Net parent                                                        CDL002
     C           *IN83     WHEQ *OFF                                      CDL002
     C                     MOVE *ON       *IN46                           CDL002
     C                     MOVE PTNU      CUST                            CDL002
      *                                                                   CDL002
     C                     OTHER                                          CDL002
     C                     MOVE *ON       *IN47                           CDL002
     C                     MOVE CUNR      CUST                            CDL002
     C           PTNU      IFEQ *BLANKS                                   CDL002
     C           PTNU      OREQ '000000'                                  CDL002
     C                     MOVE *ON       *IN44                           CDL002
     C                     ENDIF                                          CDL002
     C                     ENDSL                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
      *                                                                   CDL002
      *****************************************************************   CDL002
      * Process net group settlement customer.                        *   CDL002
      *****************************************************************   CDL002
     C           NEVTP     BEGSR                                      *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
      *                                                                   CDL002
      * Portfolio Lending on and Portfolio Lending customers not to be    CDL002
      * included?                                                         CDL002
     C           BGLMCR    IFEQ 'Y'                                       CDL002
     C           LBLCDL    ANDEQ'N'                                       CDL002
      *                                                                   CDL002
      * Call Access Program to determine if a LB Customer.                CDL002
     C                     CALL 'AOLBCSR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM CUST      @AENB  10                       CDL002
     C***********          PARM *BLANKS   @KYST   7                                    CDL002 222373
     C           SDLBCS    PARM SDLBCS    DSSDY                           CDL002
     C*                                                                   CDL002
     C           @RTCD     IFNE *BLANK                                    CDL002
     C           @RTCD     ANDNE'*NRF'                                    CDL002
     C                     MOVEL'SDLBCSPD'DBFILE            ************  CDL002
     C                     MOVEL'09'      DBASE             *DBERROR 09*  CDL002
     C                     MOVEL@OPTN     DBOPTN            ************  CDL002
     C                     MOVELCUST      DBKEY  29                       CDL002
     C                     SETON                     U7U8LR               CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Customer is a LB customer - ignore.                               CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     GOTO LRTAG                                     CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Get Client Limits                                                 CDL002
     C                     CALL 'AOCLLMR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM CUST      @CUST   6                       CDL002
     C                     PARM @RLEV     WWLEV   1                       CDL002
     C                     PARM @RENT     WWENT   3                       CDL002
     C           SDCLLM    PARM SDCLLM    DSFDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
      * Get FX Limits                                                     CDL002
     C                     CALL 'AOLIMTR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM W#FXLT    WWLTYP  3                       CDL002
     C           SDLIMT    PARM SDLIMT    DSFDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     MOVE A2E1LP    FLEP1                           CDL002
     C                     MOVE A2E2LP    FLEP2                           CDL002
     C                     MOVE A2E3LP    FLEP3                           CDL002
     C                     MOVE A2E4LP    FLEP4                           CDL002
     C                     MOVE A2E5LP    FLEP5                           CDL002
     C                     MOVE A2E6LP    FLEP6                           CDL002
     C                     MOVE A2PL1P    FLPC1                           CDL002
     C                     MOVE A2PL2P    FLPC2                           CDL002
     C                     MOVE A2PL3P    FLPC3                           CDL002
     C                     MOVE A2PL4P    FLPC4                           CDL002
     C                     MOVE A2PL5P    FLPC5                           CDL002
     C                     MOVE A2PL6P    FLPC6                           CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Get Lending Limits                                                CDL002
     C                     CALL 'AOLIMTR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM W#LLTY    WWLTYP  3                       CDL002
     C           SDLIMT    PARM SDLIMT    DSFDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     MOVE A2E1LP    LLEP1                           CDL002
     C                     MOVE A2E2LP    LLEP2                           CDL002
     C                     MOVE A2E3LP    LLEP3                           CDL002
     C                     MOVE A2E4LP    LLEP4                           CDL002
     C                     MOVE A2E5LP    LLEP5                           CDL002
     C                     MOVE A2E6LP    LLEP6                           CDL002
     C                     MOVE A2PL1P    LLPC1                           CDL002
     C                     MOVE A2PL2P    LLPC2                           CDL002
     C                     MOVE A2PL3P    LLPC3                           CDL002
     C                     MOVE A2PL4P    LLPC4                           CDL002
     C                     MOVE A2PL5P    LLPC5                           CDL002
     C                     MOVE A2PL6P    LLPC6                           CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Get Money Market Limits                                           CDL002
     C                     CALL 'AOLIMTR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM W#MMTY    WWLTYP  3                       CDL002
     C           SDLIMT    PARM SDLIMT    DSFDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     MOVE A2E1LP    MLEP1                           CDL002
     C                     MOVE A2E2LP    MLEP2                           CDL002
     C                     MOVE A2E3LP    MLEP3                           CDL002
     C                     MOVE A2E4LP    MLEP4                           CDL002
     C                     MOVE A2E5LP    MLEP5                           CDL002
     C                     MOVE A2E6LP    MLEP6                           CDL002
     C                     MOVE A2PL1P    MLPC1                           CDL002
     C                     MOVE A2PL2P    MLPC2                           CDL002
     C                     MOVE A2PL3P    MLPC3                           CDL002
     C                     MOVE A2PL4P    MLPC4                           CDL002
     C                     MOVE A2PL5P    MLPC5                           CDL002
     C                     MOVE A2PL6P    MLPC6                           CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Get Precious Metals Limits                                        CDL002
     C                     CALL 'AOLIMTR0'                                CDL002
     C                     PARM '*MSG    '@RTCD                           CDL002
     C                     PARM '*KEY    '@OPTN                           CDL002
     C                     PARM W#PLTY    WWLTYP  3                       CDL002
     C           SDLIMT    PARM SDLIMT    DSFDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     MOVE A2E1LP    PLEP1                           CDL002
     C                     MOVE A2E2LP    PLEP2                           CDL002
     C                     MOVE A2E3LP    PLEP3                           CDL002
     C                     MOVE A2E4LP    PLEP4                           CDL002
     C                     MOVE A2E5LP    PLEP5                           CDL002
     C                     MOVE A2E6LP    PLEP6                           CDL002
     C                     MOVE A2PL1P    PLPC1                           CDL002
     C                     MOVE A2PL2P    PLPC2                           CDL002
     C                     MOVE A2PL3P    PLPC3                           CDL002
     C                     MOVE A2PL4P    PLPC4                           CDL002
     C                     MOVE A2PL5P    PLPC5                           CDL002
     C                     MOVE A2PL6P    PLPC6                           CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     EXSR LMTS                                      CDL002
     C                     EXSR NEVTD                                     CDL002
      *                                                                   CDL002
     C           *IN48     IFEQ *ON                                       CDL002
     C                     MOVE *ON       *IN50                           CDL002
     C                     EXSR FXWRIT                                    CDL002
     C                     EXSR LEWRIT                                    CDL002
     C           *IN30     IFEQ *ON                                       CDL002
     C                     EXSR FRWRIT                                    CDL002
     C                     EXSR IRWRIT                                    CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
      *                                                                   CDL002
      *****************************************************************   CDL002
      * Process all net events for this customer                      *   CDL002
      *****************************************************************   CDL002
     C           NEVTD     BEGSR                                      *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
      *                                                                   CDL002
      * Any net events for this parent/customer?                          CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C           W2KEYP    ANDEQW1KEYP                                    CDL002
     C           *IN04     OREQ *ON                                       CDL002
     C           W2KEYN    ANDEQW1KEYN                                    CDL002
      *                                                                   CDL002
      * Get FX Net again                                                  CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C           K1PTNU    CHAINFXNEVTP              83                   CDL002
     C                     ELSE                                           CDL002
     C           K1CUNR    CHAINFXNEVTN              84                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Process all net events for this parent/customer                   CDL002
     C           *IN03     DOWEQ*ON                                       CDL002
     C           W2KEYP    ANDEQW1KEYP                                    CDL002
     C           *IN83     ANDEQ*OFF                                      CDL002
     C           *IN04     OREQ *ON                                       CDL002
     C           W2KEYN    ANDEQW1KEYN                                    CDL002
     C           *IN84     ANDEQ*OFF                                      CDL002
      *                                                                   CDL002
      * Incoming only                                                     CDL002
     C           INOI      IFEQ 'I'                                       CDL002
     C                     Z-ADDEDAT      DLVALU                          CDL002
     C           A6NBDP    ADD  1         DEP                             CDL002
     C           LCEQ      DIV  FCT,DEP   DLAMTF                          CDL002
     C                     EXSR EXPFS                                     CDL002
     C                     ADD  1         RREAD                           CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C* Save current rec                                                  CDL002
     C**********           MOVELW2EVL     W4SAVE    P              CDL002 200925
      *                                                                   CDL002
      * Get Parent Net Events                                             CDL002
     C           *IN03     IFEQ *ON                                       CDL002
      *                                                                   CDL002
     C                     READ FXNEVTP                  83               CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      * Get Customer Net Events                                           CDL002
     C           *IN04     IFEQ *ON                                       CDL002
      *                                                                   CDL002
     C                     READ FXNEVTN                  84               CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     ENDDO                                          CDL002
     C*                                                                   CDL002
     C* Parent                                                            CDL002
     C           *IN03     IFEQ *ON                                       CDL002
     C*   No more Parents Left?                                           CDL002
     C           *IN83     IFEQ *ON                                       CDL002
     C                     CLEAR*IN03                                     CDL002
     C*     Get first customer net event                                  CDL002
     C                     READ FXNEVTN                  84               CDL002
     C           *IN84     IFEQ *OFF                                      CDL002
     C                     MOVE *ON       *IN04                           CDL002
     C                     ENDIF                                          CDL002
     C                     ELSE                                           CDL002
     C                     MOVE ENTITY    W1ENTI                          CDL002
     C                     MOVE PASK      W1PASK                          CDL002
     C                     MOVE PTNU      W1PTNU                          CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C* Customer                                                          CDL002
     C           *IN04     IFEQ *ON                                       CDL002
     C                     MOVE ENTITY    W1ENTI                          CDL002
     C                     MOVE PASK      W1PASK                          CDL002
     C                     MOVE PTNU      W1PTNU                          CDL002
     C                     MOVE CASK      W1CASK                          CDL002
     C                     MOVE CUNR      W1CUNR                          CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C* Restore Current rec                                               CDL002
     C**********           MOVELW4SAVE    W2EVL                    CDL002 200925
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
      *                                                                   CDL002
0590 C********************************************************************
     C           *PSSR     BEGSR
     C*
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
      *                                                                   CDL002
     C                     SETON                     U7U8LR               CDL002
     C                     RETRN                                          CDL002
     C*
     C                     ENDSR
0295 C********************************************************************
     C*                                                                   E100
     C* SUBROUTINE : #ZZ                                                  E100
     C*                                                                   E100
     C* CALLED BY MAIN PROCESSING DURING TOTAL TIME CALCULATIONS IF       E100
     C* NO RECORDS READ AND THEREFORE SDBANKPD NOT READ                   E100
     C*                                                                   E100
     C           #ZZ       BEGSR                                          E100
     C*                                                                   E100
     C** IF FIRST CYCLE NOT PERFORMED GET BANK DETAILS FOR HEADINGS       E100
     C*                                                                   E100
     C                     CALL 'AOBANKR0'                                E100
     C                     PARM '*MSG   ' @RTCD   7                       E100
     C                     PARM '*FIRST ' @OPTN   7                       E100
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK                                    E100
     C                     MOVEL'SDBANKPD'DBFILE           ************   E100
     C                     MOVEL'04'      DBASE            * DBERR 04 *   E100
     C                     MOVEL@OPTN     DBOPTN           ************   E100
     C                     SETON                     U7U8LR               E100
     C                     EXSR *PSSR                                     E100
     C                     GOTO #ZZ9                                      E100
     C                     END                                            E100
     C*                                                                   E100
     C** READ DEAL DETAILS VIA ACCESS PROGRAM FOR BASE CCY FOR LIMITS
     C**********           CALL 'AODEALR0'                                                    CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDDEAL    PARM SDDEAL    DSFDY                                               CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDDEALPD'DBFILE           ************
     C                     MOVEL'10'      DBASE            * DBERR 10 *
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO #ZZ9
     C                     END
     C*                                                                   E204
     C**  SET RPT HEADINGS ACCORDING TO LEVEL SELECTED                    E204
     C           @RLEV     IFEQ 'B'                                       E204
     C                     SETON                     45
     C                     MOVE HDG,1     OPTION                          E204
     C                     END                                            E204
     C           @RLEV     IFEQ 'C'                                       E204
     C                     SETOF                     45                   E204
     C                     MOVE HDG,2     OPTION                          E204
     C                     END                                            E204
     C*                                                                   E204
     C           @RLEV     IFNE 'B'                                       E204
     C           @RLEV     ANDNE'C'                                       E204
     C                     MOVE HDG,3     OPTION                          E204
     C                     END                                            E204
     C*                                                                   E204
     C**  FOR ORIGINATING OR BOOKING BRANCH                               E204
     C           @OB       IFEQ 'O'                                       E204
     C                     MOVE HDG,4     BRANCH                          E204
     C                     END                                            E204
     C           @OB       IFEQ 'B'                                       E204
     C                     MOVE HDG,5     BRANCH                          E204
     C                     END                                            E204
     C*                                                                   E204
     C           #ZZ9      ENDSR                                          E100
0597 C*****************************************************************   E100
0922 ODL0761P1H   03   OF
0923 O                                   24 'REFERENCE DL0761P1'
0924 O                         BJURPT    89
0925 O                                  122 'DATE              PAGE'
0926 O                         BJMRDT   112
0927 O                 52      PAGE  Z  127
0928 O        H 2      OFNU1
0929 O                                   45 'EXPOSURE AGAINST LIMITS '
0930 O                                   54 'IN 000''S '
0931 O                         BNCYCD    57
     O                                   59 '-'
     O                         OPTION    83
     O                 45                92 'BRANCH -'
     O                N45                93 'COMPANY -'
     O                         ENTITY    97
     O                         ENAM     128
0928 O        H 2      OF U1
     O                                   30 'EXCEPTION EXPOSURE '
0929 O                                   45 'AGAINST LIMITS '
0930 O                                   54 'IN 000''S '
0931 O                         BNCYCD    57
     O                                   59 '-'
     O                         OPTION    83
     O                 45                92 'BRANCH -'
     O                N45                93 'COMPANY -'
     O                         ENTITY    97
     O                         ENAM     128
0932 O        H 1      OFNU1
0933 O                                   45 '------------------------'
0934 O                                   59 '--------------'
     O                         BRANCH    83
0932 O        H 1      OF U1
0933 O                                   30 '-------------------'
0934 O                                   45 '---------------'
0934 O                                   59 '--------------'
     O                         BRANCH    83
0935 O        H 21     OF
0941 O                                   11 'CUSTOMER'
0941 O                 46                20 '(PARENT)'
0941 O                 47                24 '(NON-PARENT)'
     O                                   82 'PERIOD'
     O                                   96 'LIMIT'
     O                                  125 'EXPOSURE         EXCESS'
     O**
     O****BR*CO*LIMIT*-*LINE*1*- FX                                       LN0633
     O        EF2              HEADS
0950 O                         CUST       6
0951 O                         NAME      27
0951 O                         TOWN      38
0953 O                 47N44             48 'PAR-'
     O                 47N44   PTNU      54
     O**
     O        EF1              HEADS
     O                                   24 '------------------------'
     O                                   38 '--------------'
     O**  BR/CO LIMIT - LINE 1 - FX                                       LN0633
     O        EF21             FXLIN1
     O                         FDESC     45
     O                                   63 'FOREIGN EXCHANGE'
0956 O                                   79 '001-'
     O                         XFDA,1    82
0959 O                    71             80 ' SPOT  '
     O                         XFLM,11   96
0963 O                         FXPOS 1  110
0964 O                         XFXS,11  125
     O**
     O**  BR/CO LIMIT - LINES 2-6 - FX
     O        E  1             FXLIN2
0955 O                       53NEXTF     78
0957 O                       53          79 '-'
0958 O                       53XFDA,D    82
0960 O                       53XFLM,D1   96
     O                       53ASTF      97
0963 O                       53FXPOS 1  110
0964 O                       53XFXS,D1  125
     O**
     O**  BR/CO LIMIT - LINE 1 - LENDING
     O        EF21             LELIN1
     O                         LDESC     45
     O/COPY WNCPYSRC,EMP104_032                                          EMP104
     O                                   54 'LENDING'
     O/COPY WNCPYSRC,EMP104_033                                          EMP104
0966 O                                   79 '001-'
     O                         XLDA,1    82
0969 O                    72             80 ' SPOT  '
     O                         XLLM,11   96
0973 O                         LXPOS 1  110
0974 O                         XLXS,11  125
     O**
     O**  BR/CO LIMIT - LINES 2-6 - LENDING
     O        E  1             LELIN2
0965 O                       54NEXTL     78
0967 O                       54          79 '-'
0968 O                       54XLDA,D    82
0970 O                       54XLLM,D1   96
     O                       54ASTL      97
0973 O                       54LXPOS 1  110
0974 O                       54XLXS,D1  125
     O/COPY WNCPYSRC,DL0761O001
      *                                                                   CDL006
      ** BR/CO Limit - Line 1 - Fiduciary deposits                        CDL006
      *                                                                   CDL006
     O        EF21     80      FILIN1                                     CDL006
     O                 80      FIDESC    45                               CDL006
     O                 80                65 'FIDUCIARY DEPOSITS'          CDL006
     O                 80                79 '001-'                        CDL006
     O                 80      FIDA,1    82                               CDL006
     O                 80 72             83 ' SPOT  '                     CDL006
     O                 80      FILM,11   96                               CDL006
     O                 80      FIXPOS1  110                               CDL006
     O                 80      FIXS,11  125                               CDL006
      *                                                                   CDL006
      ** BR/CO Limit - Lines 2-6 - Fiduciary deposits                     CDL006
      *                                                                   CDL006
     O        E  1     80 31   FILIN2                                     CDL006
     O                 80    31NEXTFI    78                               CDL006
     O                 80    31          79 '-'                           CDL006
     O                 80    31FIDA,D    82                               CDL006
     O                 80    31FILM,D1   96                               CDL006
     O                 80    31FISTL     97                               CDL006
     O                 80    31FIXPOS1  110                               CDL006
     O                 80    31FIXS,D1  125                               CDL006
     O**
     O*   BR/CO LIMIT - FRA                                               S01157
     O*                                                                   S01157
     O        EF21             FRLIN                                      S01157
     O                         RDESC     45                               S01157
     O                                   69 'FORWARD RATE AGREEMENT'      S01157
     O                         XRLM  1   96                               S01157
     O                         RXPOS 1  110                               S01157
     O                         XRXS  1  125                               S01157
     O*                                                                   S01157
     O*                                                                   S01157
     O*   BR/CO LIMIT - IRS                                               S01157
     O*                                                                   S01157
     O        EF21             IRLIN                                      S01157
     O                         IDESC     45                               S01157
     O                                   66 'INTEREST RATE SWAPS'         S01157
     O                         XILM  1   96                               S01157
     O                         IXPOS 1  110                               S01157
     O                         XIXS  1  125                               S01157
     O*                                                                   S01157
     O        E   22           NODETS
     O                                   63 '***   NO DETAILS TO REPO'
     O                                   71 'RT   ***'
     O**
     O********T*3      L2 58N51                                           CDL002
     O        EF3      L2 58N51TRAILR                                     CDL002
     O                                   66 '*** END OF REPORT FOR'
     O                 45                77 ' BRANCH ***'
     O                N45                78 ' COMPANY ***'
     O*********        45                66 '*** END OF BRANCH '
     O*********       N45                66 '*** END OF COMPANY '
     O*********                          76 'REPORT ***'
     O**
     O**
     ODL0761AUT   03   LR
     O                                   24 'REFERENCE DL0761AU'
     O                         BJURPT    89
     O                                  122 'DATE              PAGE'
     O                         BJMRDT   112
     O                         PAGE1 Z  127
     O        T 2      LRNU1
     O                                   68 'EXPOSURE AGAINST LIMITS '    E131
     O                                   77 'IN 000''S '                  E131
     O                         BNCYCD    80                               E131
     O                                   82 '-'                           E131
     O                                   95 'RUN CONTROLS'                E131
      *                                                                   E131
     O********                           45 'EXPOSURE AGAINST LIMITS '    E131
     O********                           54 'IN 000''S '                  E131
     O********                 BNAJCD    57                               E131
     O********                           59 '-'                           E131
     O********                           72 'RUN CONTROLS'                E131
     O        T 2      LR U1
     O********                           30 'EXCEPTION EXPOSURE '
     O********                           45 'AGAINST LIMITS '
     O********                           54 'IN 000''S '
     O********                 BNAJCD    57
     O********                           59 '-'
     O********                           72 'RUN CONTROLS'
      *
     O                                   53 'EXCEPTION EXPOSURE '
     O                                   68 'AGAINST LIMITS '
     O                                   77 'IN 000''S '
     O                         BNCYCD    80
     O                                   82 '-'
     O                                   95 'RUN CONTROLS'
     O        T 1      LRNU1
     O********                           45 '------------------------'
     O********                           59 '--------------'
     O********                           72 '--------------'
     O                                   68 '------------------------'
     O                                   82 '--------------'
     O                                   95 '--------------'
     O        T 1      LR U1
     O********                           30 '-------------------'
     O********                           45 '---------------'
     O********                           59 '--------------'
     O********                           72 '--------------'
      *
     O                                   53 '-------------------'
     O                                   68 '---------------'
     O                                   83 '---------------'
     O                                   95 '------------'
     O*****   T   22   LR 41                                              E99
1004 O*****                              63 '***   NO DETAILS TO REPO'    E99
1005 O*****                              71 'RT   ***'                    E99
0978 O*****   T 2      LR                                                 E99
     O        T 2      LR 41                                              E99
0978 O        T   22   LR                                                 E99
0979 O                                   59 'NUMBER'
0995 O        T 2      LR
0996 O                                   28 'RECORDS READ IN THIS'
0997 O                                   35 ' REPORT'
0998 O                         RREAD 3   59
0981 O        T 2      LR
0982 O                                   29 'LIMITS/EXPOSURES REPO'
0983 O                                   33 'RTED'
0984 O                         RLIST 3   59
      *
      *  NO DETAILS TO REPORT PROCESSING
     O        T 2      LR 41                                              E99
1004 O                                   63 '***   NO DETAILS TO REPO'    E99
1005 O                                   71 'RT   ***'                    E99
      *                                                                   E204
      *  MORE NO DETAILS TO REPORT PROCESSING                             E204
     O        T 3      LR 41                                              E99
     O                                   35 '***'                         E99
     O                         OPTION    61                               E204
     O                 45                72 ' BRANCH -'                   E204
     O                N45                72 ' COMPANY -'                  E204
     O                         @RENT     76                               E204
     O                                   82 '***'                         E99
      *  MORE NO DETAILS TO REPORT PROCESSING
     O        T 1      LR 41                                              E99
     O                                   41 '***'                         E99
     O                         BRANCH    67
     O                                   73 '***'                         E99
     O        T 3      LR U7 U8
     O                                   71 '*** PRINT TERMINATED ***'
     O        T 1      LR U7 U8
     O                                   57 'DATABASE ERROR'
     O                         DBASE     61
     O                                   67 'FILE'
     O                         DBFILE    78
     O        T 13     LR U7 U8
     O                                   46 'KEY'
     O                         DBKEY     76
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   FCT - CONVERSION FACTORS
0001
0010
0100
1000
**   HDG - REPORT HEADINGS, FOR PRODUCTION OPTION & ORIGIN./BOOKING BR
AGAINST BRANCH LIMITS,
AGAINST COMPANY LIMITS,
INCORRECT P.O.
FOR ORIGINATING BRANCH
FOR BOOKING BRANCH
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
