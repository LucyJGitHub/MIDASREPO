0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Deals by Customer This Month Extract')        *
0002 F********************************************************************
0004 F*                                                                  *
     F*  Midas - Dealing Module
0004 F*                                                                  *
0005 F*     DL1040  -  DEALS BY CUSTOMER THIS MONTH EXTRACT              *
0006 F*                                                                  *
     F*     Function:  This produces an extract used by DL1060/DL1061/   *
     F*                DL1062 report programs.                           *
     F*                                                                  *
     F*     Called by: DLC1201 (full monthly report)                     *
     F*                DLC0901 (interim report)                          *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 22Dec08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10282           Date 04Feb06               *
      *                 CDL038             Date 10May05               *
      *                 BG7717             Date 27Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 156196             Date 25Apr00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01408             Date 22May96               *
     F*                    088138           DATE 31MAY95                 *
     F*                    048933           DATE 19MAR93                 *
     F*                    S01378           DATE 15OCT92                 *
0010 F*                    LN0135           DATE 23MAY89                 *
0010 F*                    E165             DATE 07DEC89                 *
     F*                    S01117           DATE 08/03/89                *
     F*                    S01194           DATE 08/03/89                *
     F*                    SA1157           DATE 08/03/89                *
     F*                    E11306           DATE 01/09/87                *
     F*                    S01119           DATE 15/06/87                *
0009 F*                    E81162           DATE 07/01/87                *
0009 F*                    S01124           DATE 00/00/00                *
     F*                                                                  *
0010 F*------------------------------------------------------------------*
      *                                                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date                                    *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CSC042 - COB Performance improvements. Try to keep number of *
      *           accesses to AOBRCHR0 to a minimum.                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10282 - Fix field CLAS for DEALSDC.                       *
      *  CDL038 - Extended Deal Sub Type                              *
      *  BG7717 - DBASE error if customer deleted                     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD007 - Customer Closing                                    *
     F*     156196 - EoM  FOOB. Take real value of DAMT as in DL0500.    *
     F*     S01408 - Core hook DL1040FFP1 added.                         *
     F*            - Core hook DL1040IIP1 added.                         *
     F*            - Core hook DL1040CCP1 added.                         *
     F*            - Core hook DL1040CCP2 added.                         *
     F*     088138 - The position of the field PCLI of DEALSD should be  *
     F*              1055 instead of 1054.                               *
     F*              The position of the field OPUP of DEALSD should be  *
     F*              1059-1065 instead of 1058-1064                      *
     F*     048933  -  RESTART RECOVERY PROCESSING REWRITE               *
     F*                                                                  *
      *     S01378 - Facilitates the partial sale of a parcel
      *              of negotiable instruments which have been
      *              previously input to the system as a single
      *              transaction. When NAB is entered the parcel
      *              size defines the number of parcels it may be
      *              split into for selling. When NAS is entered
      *              the parcel size defines the number of parcels
      *              being sold by the transaction. (was MOF53).
     F*     LN0135  - REMOVE 'END OF REPORT' FROM AUDIT REPORT           *LN0135
     F*     E165    - ZSFILE NOT CALLED IF ONLY 'AU' PRODUCED            *
     F*     S01117  -  MULTIBRANCHING                                    *
     F*     S01194  -  STANDING DATA CHANGES DERIVED FROM SYNON          *
0011 F*     SA1157 - (i) FRA/IRS ENHANCEMENTS - SPLIT DEAL TYPE 'RL'     *SA1157
     F*              INTO 'RR' (COLLAR), 'RP' (CAP) AND 'RF' (FLOOR).    *SA1157
     F*              DO NOT OUTPUT CEILING RATE IF DEAL TYPE IS 'FR'.    *SA1157
     F*              (ii) IF AN FRA, CAP OR COLLAR HAS FIXED RATE        *SA1157
     F*              IN 'OUR' DETAILS (UBRTT = 0) THEN IT IS A           *SA1157
     F*              PURCHASE, ELSE IT IS A SALE. BUT IF A FLOOR HAS     *SA1157
     F*              FIXED RATE IN 'OUR' DETAILS THEN IT IS A SALE,      *SA1157
     F*              ELSE IT IS A PURCHASE.                              *SA1157
     F*     E11306  -  TO READ DEALING ICD FOR USD CCY.                  *E11306
     F*     S01119  -  PROCESS FRA/IRS DEALS                             *S01119
     F*     E81162  -  TO CORRECT REPORTING ERROR OF MATURITY DATE.      *E81162
0008 F*                                                                  *
0010 F********************************************************************
0011 F/SPACE 3
0012 F*EALS***IP**F*****400**6AI*****2*DISK***************                S01119
     F*EALS***IP**F*****600  6AI     2 DISK                         S01119S01378
     F***DEALS**  IP  F    1067  6AI     2 DISK                                        S01378 CGL029
     F*DEALS***IP**F****2325**6AI*****2*DISK                                           CGL029 CDL038
     FDEALS   IP  F    2606  6AI     2 DISK                                                   CDL038
0013 F*EALS2**IF**F*****400**6AI*****2*DISK***************                S01119
     FDEALS2  IF  F     600  6AI     2 DISK                               S01119
0014 F*ABLE***IF**F******96*12AI*****2*DISK***************                S01194
0015 F*LINT***IF**F*****256**7AI*****2*DISK***************                S01194
0016 FEVDCMHH O   F     128            DISK
0016 F*VDCMED*O***F*****128            DISK                               S01117
0016 F*EVDCMED*O***F*****134************DISK                       S01117 CDL038
     F*EVDCMED*O***F*****138************DISK**************                             CDL038 CDL099
     FEVDCMED O   F     141            DISK                                                   CDL099
0016 FEVDCMZZ O   F     128            DISK
0017 F*PRINT  O   F     132            PRINTER                            S01124
0017 F*L1040P1O   F     132            PRINTER                     S01124 S01117
0017 F*L1040AUO***F*****132************PRINTER                            S01117
0017 F*L1040AUO   F     132            PRINTER      KINFDS SPOOLU   S01117E165
0017 FDL1040AUO   F     132            PRINTER                            E165
     F*                                                                   S01408
     F/COPY WNCPYSRC,DL1040FFP1                                           S01408
     F*                                                                   S01408
0018 F/SPACE 3
0019 F* ID F  C  H  L    FUNCTION OF INDICATORS
0020 F* 01            S/DEALS  - HEADER
0021 F* 02                       DETAIL
0022 F* 03                       DETAIL
0023 F* 04                       DETAIL
0024 F* 05                       DETAIL
     F* 10                       DETAIL - FRA/IRS                         S01119
0025 F* 06                       TRAILER
0026 F* 07            S/DEALS2 - TRAILER
0027 F**08************S/TABLE - CURRENCY RECORD                           S01194
0028 F**09************S/CLINT - CLIENT DETAILS                            S01194
     F**11************LF/TABLE - TABTB40                           S01119 S01194
     F**12************LF/TABLE - TABTB11                           S01119 S01194
0029 F*    20         AMOUNT NEGATIVE
0030 F*    21         MATURITY DATE ON DEALS,DC IS ZERO
0031 F*       40      1ST CYCLE IND.
0032 F*       41      CHAIN FAILURE
0033 F*       42      EXTRACT HAS ALREADY BEEN RUN
0034 F*       43      ORIGINAL ENTRY DATE GT. PREVIOUS RUN DATE
0035 F*       44      LIVE DEAL RECORD
0036 F*       45      DEAL IN DOLLARS (OR OUR CCY = USCY FOR FRA/IRS)     S01119
0037 F*       46      SALE IN DOLLARS (OR THEIR CCY = USCY FOR FRA/IRS)   S01119
0038 F*       47      FEDERAL FUND DEAL
     F*       61      FRA/IRS TYPE RX DEAL                                S01119
     F*       62      FRA/IRS THEIR FIXED RATE REQUIRED ON EXTRACT        S01119
     F*       63      FRA/IRS THEIR FLOATING RATE REQUIRED ON EXTRACT     S01119
     F*       64      FRA/IRS OUR FIXED RATE REQUIRED ON EXTRACT          S01119
     F*       65      FRA/IRS OUR FLOATING RATE REQUIRED ON EXTRACT       S01119
     F*       66      FRA/IRS FLOOR RATE PRESENT                          S01119
     F********67******FRA/IRS*TYPE*'RL'*DEAL***********************S01119 SA1157
     F*       67      FRA/IRS TYPE 'RR','RP' OR 'RF' DEAL                 SA1157
0039 F*       80      I/P CYCLE RUN
     E                    CPY@    1   1 80
0040 E                    INT         2 15 0
0041 E                    DEC         2  3 0
     E                    ##BR      999  3               Branch Codes                         CSC042
     E                    ##BC      999  3               Company Codes                        CSC042
0042 F/EJECT
0043 I*    DEALS FILE - HEADER RECORD.
0044 I*
0045 IDEALS   NS  01   1 CH
0046 I                                        1   1 RECI
0047 I                                        2   70DLNO
0048 I                                        8   8 RCDT
0049 I                                        9  100RCDC
0050 I**********                             11  160CNUM                                      CSD027
0050 I                                       11  16 CNUM                                      CSD027
0051 I                                    P 394 3960LCD
0052 I                                      397 397 CHTP
0053 I                                    P 398 4000TNLU
     I***********                          10541054 PCLI            S01378088138
     I                                     10551055 PCLI                  088138
     I***********                         P105810640OPUP            S01378088138
     I                                    P105910650OPUP                  088138
0054 I*
0055 I*
0056 I*    DEALS FILE - DETAIL RECORD - FX SWAPS/OUTRIGHTS.
0057 I*
0058 IDEALS   NS  02   1 CD   8 CB
0059 I       OR        1 CE   8 CB
0060 I       OR        1 CM   8 CB
0061 I       OR        1 CR   8 CB
0062 I                                        1   1 RECI
0063 I                                        2   70DLNO
0064 I                                        8   8 RCDT
0065 I                                        9  100RCDC
0066 I**********                             11  160CNUM                                      CSD027
0066 I                                       11  16 CNUM                                      CSD027
0067 I*****                                  17  190BRCD                  S01117
0067 I                                       17  19 BRCA                  S01117
0068 I                                       20  21 DTYP
0069 I                                       22  23 DLST
0070 I                                    P  24  260DDAT
0071 I                                    P  27  290VDAT
0072 I                                    P  30  320OTDT
0073 I                                       35  38 BRKC
0074 I                                    P  39  450BAGE
0075 I                                       46  48 PUCY
0076 I                                    P  49  550PUAM          20
0077 I                                    P  56  628EXRT
0078 I                                       86  88 SLCY
0079 I                                    P  89  950SLAM
0080 I                                    P 117 1230BCEQ
0081 I                                    P 131 1378LCXR
0082 I                                      138 1390PCST
0083 I**********                            140 151 OPCA                                      CGL029
     I                                      140 151 OPCAQQ                                    CGL029
0084 I                                      152 161 TSCN
0085 I                                      162 1630SCST
0086 I**********                            164 175 OSCA                                      CGL029
     I                                      164 175 OSCAQQ                                    CGL029
0087 I                                      176 185 TPCN
0088 I                                    P 192 1980ORPA
0089 I                                    P 205 2110ORSA
0090 I                                      212 2120FSLI
0091 I                                    P 241 2470SPPD
0092 I                                    P 248 2540SPLA
0093 I                                      255 257 SPLC
0094 I                                      285 2900SODN
0095 I                                      300 309 FACO
0096 I                                      310 344 SPI
0097 I                                      370 370 DNSI
0098 I                                      371 371 DSTI
0099 I                                      372 372 CNFI
0100 I                                      373 373 ACEI
0101 I                                      374 374 TLXI
0102 I                                    P 391 3930ORED
0103 I                                    P 394 3960LCD
0104 I                                      397 397 CHTP
0105 I                                    P 398 4000TNLU
     I                                     12921309 OPCA                                      CGL029
     I                                     13101327 OSCA                                      CGL029
     I                                     13641367 CLAS                                      CDL038
     I                                    P223622360BSDT1                                     CDL099
     I                                    P223922410BSDT2                                     CDL099
     I                                    P224222440BRSD2                                     CDL099
0106 I*
0107 I*
0108 I*    DEALS FILE - DETAIL - TAKINGS/PLACINGS/TIME DEPOSITS/LOANS.
0109 I*
0110 IDEALS   NS  03   1 CD   8 CC
0111 I       OR        1 CE   8 CC
0112 I       OR        1 CM   8 CC
0113 I       OR        1 CR   8 CC
0114 I                                        1   1 RECI
0115 I                                        2   70DLNO
0116 I                                        8   8 RCDT
0117 I                                        9  100RCDC
0118 I**********                             11  160CNUM                                      CSD027
0118 I                                       11  16 CNUM                                      CSD027
0119 I*****                                  17  190BRCD                  S01117
0067 I                                       17  19 BRCA                  S01117
0120 I                                       20  21 DTYP
0121 I                                       22  23 DLST
0122 I                                    P  24  260DDAT
0123 I                                    P  27  290VDAT
0124 I                                    P  30  320MDAT            21
0125 I                                       33  340CDAS
0126 I                                       35  38 BRKC
0127 I                                    P  39  450BAGE
0128 I                                       46  48 CCY
0129 I                                    P  49  550PCPL          20
0130 I                                       56  56 INTC
0131 I                                       63  640BRTT
0132 I                                    P  65  707BRTE
0133 I                                    P  71  767RTSP
0134 I                                    P  77  827INTR
0135 I                                       83  850NOTD
0136 I                                       86 105 RNNA
0137 I**********                            106 1110CHNA                                      CSD027
0137 I                                      106 111 CHNA                                      CSD027
0138 I                                      112 1140FACT
0139 I                                      115 1160FCNO
0140 I                                    P 117 1230OPAM
0141 I                                    P 124 1308BCXR
0142 I                                    P 131 1378LCXR
0143 I                                      138 1390SDST
0144 I**********                            140 151 OSDA                                      CGL029
     I                                      140 151 OSDAQQ                                    CGL029
0145 I                                      152 161 TSTN
0146 I                                      162 1630MDST
0147 I**********                            164 175 OMDA                                      CGL029
     I                                      164 175 OMDAQQ                                    CGL029
0148 I                                      176 185 TMAN
0149 I                                      186 1910RODN
0150 I                                    P 192 1980RODA
0151 I                                      199 2040RBDN
0152 I                                    P 205 2110RBDA
0153 I                                      212 2120ICBS
0154 I                                      213 213 IPFR
0155 I                                    P 214 2200TOTI
0156 I                                    P 221 2230NIDT
0157 I                                    P 224 2260IBDT
0158 I                                    P 227 2290SLID
0159 I                                    P 230 2360AIPD
0160 I                                    P 237 2390DLRC
0161 I                                    P 240 2420IACD
0162 I                                    P 243 2490AITC
0163 I                                    P 250 2560AIAN
0164 I                                    P 257 2630AIAP
0165 I                                    P 264 2700IPRD
0166 I                                    P 271 2770IPRM
0167 I                                    P 278 2840ICTD
0168 I                                    P 294 2960DAVD
0169 I                                      297 2990DASN
0170 I                                      300 309 FACO
0171 I                                      310 344 SPI
0172 I                                      345 3460INTF
0173 I                                      370 370 DNSI
0174 I                                      371 371 DSTI
0175 I                                      372 372 CNFI
0176 I                                      373 373 ACEI
0177 I                                      374 374 TLXI
0178 I                                    P 391 3930ORED
0179 I                                    P 394 3960LCD
0180 I                                      397 397 CHTP
0181 I                                    P 398 4000TNLU
0181 I                                      447 4520RDLN                  S01117
     I*************************************16721689 OMDA                               CGL029 CDL038
     I*************************************16901707 OSDA                               CGL029 CDL038
     I                                     17211738 OSDA                                      CDL038
     I                                     17391756 OMDA                                      CDL038
     I**********                           18981901 CLAS                             CDL038 BUG10282
     I                                     20102013 CLAS                                    BUG10282
0182 I*
0183 I*
0184 I*    DEALS FILE - DETAIL RECORD - NEGOTIABLE ASSETS PURCHASED.
0185 I*
0186 IDEALS   NS  04   1 CD   8 CD
0187 I       OR        1 CE   8 CD
0188 I       OR        1 CM   8 CD
0189 I       OR        1 CR   8 CD
0190 I                                        1   1 RECI
0191 I                                        2   70DLNO
0192 I                                        8   8 RCDT
0193 I                                        9  100RCDC
0194 I**********                             11  160ISCN                                      CSD027
0194 I                                       11  16 ISCN                                      CSD027
0195 I*****                                  17  190BRCD                  S01117
0067 I                                       17  19 BRCA                  S01117
0196 I                                       20  21 DTYP
0197 I                                       22  23 DLST
0198 I                                    P  24  260DDAT
0199 I                                    P  27  290VDAT
0200 I                                    P  30  320MDAT
0201 I                                       33  340IDAS
0202 I                                       35  38 BRKC
0203 I                                    P  39  450BAGE
0204 I                                       46  48 CCY
0205 I                                    P  49  550PUPR          20
0206 I                                    P  57  627YRAT
0207 I                                    P  71  767RTSP
0208 I                                    P  77  827INTR
0209 I                                       86 105 RNNA
0210 I**********                            106 1110PCUS                                      CSD027
0210 I                                      106 111 PCUS                                      CSD027
0211 I                                      112 1140FACT
0212 I                                      115 1160FCNO
0213 I                                    P 117 1230FVAL
0214 I                                    P 124 1308BCXR
0215 I                                    P 131 1378LCXR
0216 I                                      138 1390SDST
0217 I**********                            140 151 OSDA                                      CGL029
     I                                      140 151 OSDAQQ                                    CGL029
0218 I                                      152 161 TSTN
0219 I                                      162 1630MDST
0220 I**********                            164 175 OMDA                                      CGL029
     I                                      164 175 OMDAQQ                                    CGL029
0221 I                                      176 185 TMAN
0222 I                                    P 192 1980DISA
0223 I                                    P 205 2110DPTD
0224 I                                      212 2120ICBS
0225 I                                      213 213 IPFR
0226 I                                    P 214 2200TOTI
0227 I                                    P 221 2230NIDT
0228 I                                    P 224 2260IBDT
0229 I                                    P 227 2290SLID
0230 I                                    P 230 2360AIPD
0231 I                                    P 237 2390DLRC
0232 I                                    P 240 2420IACD
0233 I                                    P 243 2490AITC
0234 I                                    P 250 2560AIAN
0235 I                                    P 257 2630AIAP
0236 I                                    P 264 2700IPRD
0237 I                                    P 271 2770IPRM
0238 I                                    P 278 2840SAPRDD
0239 I                                      285 2900ASDN
0240 I                                    P 291 2930SADT
0241 I                                    P 294 2960DAVD
0242 I                                      297 2990DASN
0243 I                                      300 309 FACO
0244 I                                      310 344 SPI
0245 I                                      345 3460INTF
0246 I                                      370 370 DNSI
0247 I                                      371 371 DSTI
0248 I                                      372 372 CNFI
0249 I                                      373 373 ACEI
0250 I                                      374 374 TLXI
0251 I                                    P 391 3930ORED
0252 I                                    P 394 3960LCD
0253 I                                      397 397 CHTP
0254 I                                    P 398 4000TNLU
     I                                     10541054 PCLI                  S01378
     I                                    P105810640OPUP                  S01378
     I*************************************16721689 OMDA                               CGL029 CDL038
     I*************************************16901707 OSDA                               CGL029 CDL038
     I                                     12451262 OSDA                                      CDL038
     I                                     12631280 OMDA                                      CDL038
     I                                     13171320 CLAS                                      CDL038
0255 I*
0256 I*
0257 I*    DEALS FILE - DETAIL RECORD - NEGOTIABLE ASSETS SOLD.
0258 I*
0259 IDEALS   NS  05   1 CD   8 CE
0260 I       OR        1 CE   8 CE
0261 I       OR        1 CM   8 CE
0262 I       OR        1 CR   8 CE
0263 I                                        1   1 RECI
0264 I                                        2   70DLNO
0265 I                                        8   8 RCDT
0266 I                                        9  100RCDC
0267 I**********                             11  160ISCN                                      CSD027
0267 I                                       11  16 ISCN                                      CSD027
0268 I*****                                  17  190BRCD                  S01117
0067 I                                       17  19 BRCA                  S01117
0269 I                                       20  21 DTYP
0270 I                                       22  23 DLST
0271 I                                    P  24  260DDAT
0272 I                                    P  27  290VDAT
0273 I                                       35  38 BRKC
0274 I                                    P  39  450BAGE
0275 I                                       46  48 CCY
0276 I                                    P  49  550SAPRX         20
0277 I                                    P  57  627YRAT
0278 I                                    P  77  827INTR
0279 I                                       86 105 RNNA
0280 I**********                            106 1110SCUS                                      CSD027
0280 I                                      106 111 SCUS                                      CSD027
0281 I                                    P 117 1230FVAL
0282 I                                      138 1390SETP
0283 I**********                            140 151 OSAC                                      CGL029
     I                                      140 151 OSACQQ                                    CGL029
0284 I                                      152 161 TSEN
0285 I                                    P 285 2900RPDN
0286 I                                      370 370 DNSI
0287 I                                      371 371 DSTI
0288 I                                      372 372 CNFI
0289 I                                      373 373 ACEI
0290 I                                      374 374 TLXI
0291 I                                    P 391 3930ORED
0292 I                                    P 394 3960LCD
0293 I                                      397 397 CHTP
0294 I                                    P 398 4000TNLU
     I                                     10381038 PCLI                  S01378
     I                                     10481065 OSAC                                      CGL029
     I                                     11021105 CLAS                                      CDL038
     I*                                                                   S01119
     I*    DEALS FILE - DETAIL - FRA/IRS                                  S01119
     I*                                                                   S01119
     IDEALS   NS  10   1 CD   8 CG                                        S01119
     I       OR        1 CE   8 CG                                        S01119
     I       OR        1 CM   8 CG                                        S01119
     I       OR        1 CR   8 CG                                        S01119
     I                                        1   1 RECI                  S01119
     I                                        2   70DLNO                  S01119
     I                                        8   8 RCDT                  S01119
     I                                        9  100RCDC                  S01119
     I**********                             11  160CNUM                               S01119 CSD027
     I                                       11  16 CNUM                                      CSD027
     I*****                                  17  190BRCD           S01119 S01117
     I                                       17  19 BRCA                  S01117
     I                                       20  21 DTYP                  S01119
     I                                       22  23 DLST                  S01119
     I                                    P  24  260DDAT                  S01119
     I                                    P  27  290VDAT                  S01119
     I                                    P  30  320MDAT                  S01119
     I                                       33  340CDAS                  S01119
     I                                       35  38 BRKC                  S01119
     I                                    P  39  450BAGE                  S01119
     I                                       46  510LNKDN                 S01119
     I                                       52  52 HEDIN                 S01119
     I                                       53  53 TAXI                  S01119
     I                                       54  56 UCUCY                 S01119
     I                                    P  57  630UPAMT         20      S01119
     I                                       64  650UBRTT                 S01119
     I                                    P  66  717USTRT                 S01119
     I                                    P  72  777UBRTE                 S01119
     I                                    P  78  837URTSP                 S01119
     I                                       84  84 USPIN                 S01119
     I                                    P  85  907UEINR                 S01119
     I                                       91  910UICBS                 S01119
     I                                       92  930UFRFD                 S01119
     I                                    P  94  960UINFD                 S01119
     I                                    P  97  990USLIP                 S01119
     I                                    P 100 1020UNICD                 S01119
     I                                    P 103 1050UICBD                 S01119
     I                                      106 106 UICFR                 S01119
     I                                      107 1080UICFD                 S01119
     I                                    P 109 1110UNIPD                 S01119
     I                                    P 112 1140UIPBD                 S01119
     I                                      115 115 UIPFR                 S01119
     I                                      116 1170UIPFD                 S01119
     I                                    P 118 1248UBCXR                 S01119
     I                                    P 125 1270UIACD                 S01119
     I                                    P 128 1340UIALC                 S01119
     I                                    P 135 1410UAITC                 S01119
     I                                    P 142 1480UAIPD                 S01119
     I                                    P 149 1550UAIAN                 S01119
     I                                    P 156 1620UAIAP                 S01119
     I                                    P 163 1690UIPRD                 S01119
     I                                    P 170 1760UIPRM                 S01119
     I                                    P 177 1830UNSAM                 S01119
     I                                    P 184 1900UTAXD                 S01119
     I                                    P 191 1970UTAXM                 S01119
     I                                      198 200 TCUCY                 S01119
     I                                    P 201 2070TPAMT                 S01119
     I                                      208 2090TBRTT                 S01119
     I                                    P 210 2157TSTRT                 S01119
     I                                    P 216 2217TBRTE                 S01119
     I                                    P 222 2277TRTSP                 S01119
     I                                      228 228 TSPIN                 S01119
     I                                    P 229 2347TEINR                 S01119
     I                                      235 2350TICBS                 S01119
     I                                      236 2370TFRFD                 S01119
     I                                    P 238 2400TINFD                 S01119
     I                                    P 241 2430TSLIP                 S01119
     I                                    P 244 2460TNICD                 S01119
     I                                    P 247 2490TICBD                 S01119
     I                                      250 250 TICFR                 S01119
     I                                      251 2520TICFD                 S01119
     I                                    P 253 2550TNIPD                 S01119
     I                                    P 256 2580TIPBD                 S01119
     I                                      259 259 TIPFR                 S01119
     I                                      260 2610TIPFD                 S01119
     I                                    P 262 2688TBCXR                 S01119
     I                                    P 269 2710TIACD                 S01119
     I                                    P 272 2780TIALC                 S01119
     I                                    P 279 2850TAITC                 S01119
     I                                    P 286 2920TAIPD                 S01119
     I                                    P 293 2990TAIAN                 S01119
     I                                    P 300 3060TAIAP                 S01119
     I                                    P 307 3130TIPRD                 S01119
     I                                    P 314 3200TIPRM                 S01119
     I                                    P 321 3270TNSAM                 S01119
     I                                    P 328 3340TTAXD                 S01119
     I                                    P 335 3410TTAXM                 S01119
     I                                    P 342 3477CLRAT                 S01119
     I                                    P 348 3537FLRAT                 S01119
     I                                    P 354 3550AVPER                 S01119
     I                                    P 356 3638TIRAT                 S01119
     I                                    P 364 3697AACRT                 S01119
     I                                      370 3710RSETM                 S01119
     I**********                            372 383 URACC                              S01119 CGL029
     I                                      372 383 URACQQ                                    CGL029
     I                                      384 393 CPPBK                 S01119
     I                                      394 3950PSETM                 S01119
     I**********                            396 407 UPACC                              S01119 CGL029
     I                                      396 407 UPACQQ                                    CGL029
     I                                      408 417 CPRBK                 S01119
     I                                      418 427 FACO                  S01119
     I                                      428 462 SPI                   S01119
     I                                    P 463 4650SDCAR                 S01119
     I                                    P 466 4680ULPCD                 S01119
     I                                    P 469 4710TLPCD                 S01119
     I                                    P 472 4780UAEXA                 S01119
     I                                    P 479 4850TAEXA                 S01119
     I                                      570 570 UDNSI                 S01119
     I                                      571 571 TDNSI                 S01119
     I                                      572 572 UDSTI                 S01119
     I                                      573 573 TDSTI                 S01119
     I                                      574 574 CNFI                  S01119
     I                                      575 575 ACEI                  S01119
     I                                      576 576 TLXI                  S01119
     I                                    P 587 5880LSWC                  S01119
     I                                    P 589 5900LSWS                  S01119
     I                                    P 591 5930ORED                  S01119
     I                                    P 594 5960LCD                   S01119
     I                                      597 597 CHTP                  S01119
     I                                    P 598 6000TNLU                  S01119
     I*************************************22902307 UPACC                              CGL029 CDL038
     I*************************************23082325 URACC                              CGL029 CDL038
     I                                     24692486 URACC                                     CDL038
     I                                     24872504 UPACC                                     CDL038
     I                                     26032606 CLAS                                      CDL038
0295 I*
0296 I*
0297 I*    DEALS FILE -TRAILER RECORD.
0298 I*
0299 IDEALS   NS  06   1 CT
0300 I                                        1   1 RECI
0301 I                                        2   70DLNO
0302 I                                        8   8 RCDT
0303 I                                        9  100RCDC
0304 I**********                             11  160CNUM                                      CSD027
0304 I                                       11  16 CNUM                                      CSD027
0305 I                                    P  17  190NORE
0306 I                                    P  20  220FLSZ
0307 I                                    P  23  250NLRB
0308 I                                    P  26  280NINS
0309 I                                    P  29  310NDEL
0310 I                                    P  32  340NLRA
0311 I                                    P  35  420VLBF
0312 I                                    P  43  440VLBL
0313 I                                    P  45  520VRIF
0314 I                                    P  53  540VRIL
0315 I                                    P  55  620VRDF
0316 I                                    P  63  640VRDL
0317 I                                    P  65  720VLAF
0318 I                                    P  73  740VLAL
0319 I                                    P  75  770DTMR
0320 I                                    P  78  800ITMR
0321 I                                    P 394 3960LCD
0322 I                                      397 397 CHTP
0323 I                                    P 398 4000TNLU
0324 I*
0325 I* CATCHALL
0326 I        NS
0327 I*
0328 I*
0329 I*    DEALS FILE -TRAILER RECORD.
0330 I*
0331 IDEALS2  NS  07   1 CT
0332 I                                        1   1 RECI
0333 I                                        2   70DLNO
0334 I                                        8   8 RCDT
0335 I                                        9  100RCDC
0336 I**********                             11  160CNUM                                      CSD027
0336 I                                       11  16 CNUM                                      CSD027
0337 I                                    P  17  190NORE
0338 I                                    P  20  220FLSZ
0339 I                                    P  23  250NLRB
0340 I                                    P  26  280NINS
0341 I                                    P  29  310NDEL
0342 I                                    P  32  340NLRA
0343 I                                    P  35  420VLBF
0344 I                                    P  43  440VLBL
0345 I                                    P  45  520VRIF
0346 I                                    P  53  540VRIL
0347 I                                    P  55  620VRDF
0348 I                                    P  63  640VRDL
0349 I                                    P  65  720VLAF
0350 I                                    P  73  740VLAL
0351 I                                    P  75  770DTMR
0352 I                                    P  78  800ITMR
0353 I                                    P 394 3960LCD
0354 I                                      397 397 CHTP
0355 I                                    P 398 4000TNLU
0356 I* CATCHALL
0357 I        NS
0358 I*
0359 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*1.****           S01194
0360 I*****                                                               S01194
0361 I*ABLE***NS*******2*C0***3*C1**12*C1**********************           S01194
0362 I*****  AND      13 C0                                               S01194
0363 I*****                                   1   1 RECI                  S01194
0364 I*****                                   2   30RECT                  S01194
0365 I*****                                  12  130RCDE                  S01194
0366 I*****                                  14  66 TITL                  S01194
0367 I*****                                  67  67 DATF                  S01194
0368 I*****                                  68  700DFBR                  S01194
0369 I*****                                  74  74 MODI1                 S01194
0370 I*****                                  75  75 MODI2                 S01194
0371 I*****                                  76  76 MODI3                 S01194
0372 I*****                               P  77  790RUND                  S01194
0373 I*****                                  80  86 RUNA                  S01194
0374 I*****                                  87  870SFLG                  S01194
0375 I*****                               P  90  920LCD                   S01194
0376 I*****                                  93  93 CHTP                  S01194
0377 I*****                               P  94  960TNLU                  S01194
     I*****                                                        S01119 S01194
     I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 2.        S01119 S01194
     I*****                                                        S01119 S01194
     I*ABLE   NS  12   2 C0   3 C1  12 C1                          S01119 S01194
     I*****  AND      13 C1                                        S01119 S01194
     I*****                               P  41  430DNWD           S01119 S01194
0378 I*****                                                               S01194
0379 I*****                                                               S01194
0380 I*****TABLE FILE - CURRENCIES RECORD 1.                              S01194
0381 I*****                                                               S01194
0382 I*ABLE   NS  08   1 CD   2 C2   3 C0                                 S01194
0383 I*****  AND      13 C1                                               S01194
0384 I*****                                   1   1 RECI                  S01194
0385 I*****                                   2   30RECT                  S01194
0386 I*****                                  10  12 CCY                   S01194
0387 I*****                                  13  130SREC                  S01194
0388 I*****                                  14  27 CCNM                  S01194
0389 I*****                               P  28  348SPOT                  S01194
0390 I*****                                  35  37 CCYS                  S01194
0391 I*****                                  38  380CDP                   S01194
0392 I*****                                  39  390TNOT                  S01194
0393 I*****                                  40  40 DCCY                  S01194
0394 I*****                                  41  44 SRC1                  S01194
0395 I*****                                  45  48 SRC2                  S01194
0396 I*****                                  49  520TACC                  S01194
0397 I*****                                  53  560TEQV                  S01194
0398 I*****                                  57  600SWQV                  S01194
0399 I*****                                  61  640TAC4                  S01194
0400 I*****                                  65  680TAC5                  S01194
0401 I*****                                  69  69 HIND                  S01194
0402 I*****                               P  70  768PART                  S01194
0403 I*****                                  77  780SSNO                  S01194
0404 I*****                               P  79  858ERLC                  S01194
0405 I*****                               P  90  920LCD                   S01194
0406 I*****                                  93  93 CHTP                  S01194
0407 I*****                               P  94  960TNLU                  S01194
     I*****                                                        S01119 S01194
     I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 5.        S01119 S01194
     I*****                                                        S01119 S01194
     I*ABLE   NS  11   1 CD   2 C0   3 C1                          S01119 S01194
     I*****  AND      12 C4  13 C0                                 S01119 S01194
     I*****                                  47  49 USCY           S01119 S01194
0408 I*****                                                               S01194
0409 I**CATCHALL                                                          S01194
0410 I*****   NS                                                          S01194
0411 I*****                                   1   1 RECI                  S01194
0412 I*****                                                               S01194
0413 I*****CLIENT FILE - CUSTOMER STANDING DATA RECORD.                   S01194
0414 I*****                                                               S01194
0415 I*LINT   NS  09   1 CD   8 CA                                        S01194
0416 I*****  OR        1 CC   8 CA                                        S01194
0417 I*****                                   1   1 RECI                  S01194
0418 I*****                                   2   70CNUM                  S01194
0419 I*****                                   8   8 RCDT                  S01194
0420 I*****                                   9  28 CRNM                  S01194
0421 I*****                                  29  38 CTWN                  S01194
0422 I*****                                  39  48 CSNM                  S01194
0423 I*****                                  49  56 CASK                  S01194
0424 I*****                                  57  68 TELX                  S01194
0425 I*****                                  69  80 CSID                  S01194
0426 I*****                                  81  82 ACOC                  S01194
0427 I*****                                  83  83 CBSI                  S01194
0428 I*****                                  84  85 CCTZ                  S01194
0429 I*****                                  86  87 CLOC                  S01194
0430 I*****                                  88  930CPAR                  S01194
0431 I*****                                  94  960BRCD                  S01194
0432 I*****                                  97  980LINS                  S01194
0433 I*****                                  99 1010LIND                  S01194
0434 I*****                               P 102 1040DASU                  S01194
0435 I*****                               P 105 1070CDIC                  S01194
0436 I*****                               P 108 1100DADE                  S01194
0437 I*****                                 111 111 CMIN                  S01194
0438 I*****                                 112 112 CTYP                  S01194
0439 I*****                                 113 124 TELF                  S01194
0440 I*****                                 125 133 CHID                  S01194
0441 I*****                                 134 136 CHAB                  S01194
0442 I*****                               P 250 2520LCD                   S01194
0443 I**CATCHALL                                                          S01194
0444 I*****   NS                                                          S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* BANK DETAILS ACCESSED VIA ACCESS PROGRAM                          S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I* TRADING DETAILS ACCESSED VIA ACCESS PROGRAM                       S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I* CURRENCY DETAILS ACCESSED VIA ACCESS PROGRAM                      S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I* CUSTOMER DETAILS ACCESSED VIA ACCESS PROGRAM                      S01194
     I*                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I* COMPANY/BRANCH  DETAILS ACCESSED VIA ACCESS PROGRAM               S01117
      *                                                                   CSD007
     ISCSARD    E DSSCSARDPD                                              CSD007
      ** External Data Structure for Switchable Features                  CSD007
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
0445 I/EJECT
0446 I* D A T A   S T R U C T U R E S
0447 I            DS
0448 I                                        1  133AMOUNT
0449 I                                        1  130PUAM
0450 I                                        1  130PCPL
0451 I                                        1  130PUPR
0452 I                                        1  130SAPRX
     I                                        1  130UPAMT                 S01119
0453 I*
0454 I                                       14  16 CURR
0455 I                                       14  16 CCY
0456 I                                       14  16 PUCY
0457 I*
0458 I**********                             17  220CUST                                      CSD027
0459 I**********                             17  220CNUM                                      CSD027
0460 I**********                             17  220ISCN                                      CSD027
0458 I                                       17  22 CUST                                      CSD027
0459 I                                       17  22 CNUM                                      CSD027
0460 I                                       17  22 ISCN                                      CSD027
0461 I*
0462 I                                       36  400DATE
0463 I                                       36  400OTDT
0464 I                                       36  400MDAT
     I*                                                                   S01117
     I**SPOOLU      DS                                              S01117E165
     I****  SPOOL FILE INFORMATION DATA STRUCTURE                   S01117E165
     I****                                   83  90 SFILEU          S01117E165
     I****                                B 123 1240SFNUMU          S01117E165
     I              '**CUSTOMER DELETED**'C         DLTD                                      BG7717
0465 I/EJECT
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1040IIP1                                           S01408
     I*                                                                   S01408
0466 C* 1 S T   C Y C L E   P R O C E S S I N G
0467 C   40                GOTO START
0468 C                     SETON                     40
     C                     MOVEACPY@      BIS@   80
     C                     Z-ADD0         ##BNDX  40                                          CSC042
     C           *LIKE     DEFN ##BNDX    B                                                   CSC042
     C           *LIKE     DEFN ##BNDX    ##BSV                                               CSC042
      *                                                                                       CSC042
0469 C***U7******          SETON                     80                   048933
0470 C***********          SETOF                     U7                   048933
0470 C   U1                SETON                     80                   048933
0471 C                     Z-ADD0         ZERO13 130
0472 C                     Z-ADD0         ZERO5   50
0473 C                     Z-ADD0         RECOUT
     C*                                                                   S01117
0474 C*****                MOVE 'A'       CLIKEY  7                       S01194
0475 C*****                MOVE '1'       TAB4    4                       S01194
0476 C*****                MOVEL'20'      TABKEY 12                       S01194
     C***OBTAIN US CCY CODE                                        S01119 S01194
     C*****                MOVEL'01      'USCYKY 12                S01119 S01194
     C*****                MOVE '  40'    USCYKY                   S01119 S01194
     C*****      USCYKY    CHAINTABLE                41            S01119 S01194
     C*****                                                        S01119 S01194
     C*****      *IN11     IFEQ '0'                                S01119 S01194
     C*****                SETON                     LRU7U8        S01119 S01194
     C*****                GOTO END                                S01119 S01194
     C*****                END                                     S01119 S01194
     C*****                                                        S01119 S01194
     C***OBTAIN NEXT WORKING DAY                                   S01119 S01194
     C*****                MOVEL'01      'NWDYKY 12                S01119 S01194
     C*****                MOVE '  11'    NWDYKY                   S01119 S01194
     C*****      NWDYKY    CHAINTABLE                41            S01119 S01194
     C*                                                            S01119 S01194
     C*****      *IN12     IFEQ '0'                                S01119 S01194
     C*****                SETON                     LRU7U8        S01119 S01194
     C*****                GOTO END                                S01119 S01194
     C*****                END                                     S01119 S01194
     C** READ TRADING  DETAILS VIA ACCESS PROGRAM                         S01194
     C** TO OBTAIN US CCY CODE                                            S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVEL'01'      DBASE   30       **********     S01194
     C                     MOVEL'*FIRST ' DBOPTN  7        *  001   *     S01194
     C                     MOVEL'*FIRST ' DBKEY   9        **********     S01194
     C                     MOVEL'SDTRADPD'DBFILE 10                       S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C*                                                                   S01119
     C** READ BANK DETAILS VIA ACCESS PROGRAM                             S01194
     C** FOR NEXT WORKING DAY ....ETC.                                    S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVE '05'      DBASE            **********     S01194
     C                     MOVEL'*FIRST ' DBOPTN  7        *  005   *     S01194
     C                     MOVEL'*FIRST ' DBKEY            **********     S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C**   CHECK SYSTEM DATE FORMAT                                       S01194
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
      *                                                                   CSD007
      ** Access Switchable Features file and check if CSD007              CSD007
      ** is switched on or not.                                           CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD   7                       CSD007
     C                     PARM '*VERIFY' @OPTN   7                       CSD007
     C                     PARM 'CSD007'  @SARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
      *                                                                   CSD007
      ** Database Error, if Return Code is not blanks or *NRF             CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'007'     DBASE                           CSD007
     C                     MOVEL'CSD007  'DBKEY                           CSD007
     C                     MOVE *ON       *INU7                           CSD007
     C                     MOVE *ON       *INU8                           CSD007
     C                     MOVE *ON       *INLR                           CSD007
     C                     EXSR *PSSR                                     CSD007
     C                     GOTO END                                       CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
     C*                                                                   S01119
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1040CCP1                                           S01408
     C*                                                                   S01408
      *                                                                                       CDL099
      ** Check if feature CDL099 is enabled                                                   CDL099
      *                                                                                       CDL099
     C                     CALL 'AOSARDR0'                                                    CDL099
     C                     PARM *BLANKS   @RTCD                                               CDL099
     C                     PARM '*VERIFY' @OPTN                                               CDL099
     C                     PARM 'CDL099'  @SARD                                               CDL099
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL099
      *                                                                                       CDL099
     C           @RTCD     IFEQ *BLANKS                                                       CDL099
     C                     MOVE 'Y'       CDL099  1                                           CDL099
     C                     ELSE                                                               CDL099
     C                     MOVE 'N'       CDL099                                              CDL099
     C                     ENDIF                                                              CDL099
     C*                                                                   S01119
0477 C* INITIALIZING FINISHED.
0478 C*****                EXSR ZSYSTM                                    S01194
0479 C***99                SETON                     LRU7U8               S01194
0480 C                     MOVE '999999'  DLKEY   6        GET TRAILER
0481 C           DLKEY     CHAINDEALS2               41      RECORD.
0482 C  N07                SETON                     LRU7U8
0483 C*****      RUND      COMP DTMR                     42-COMPARE DATES S01194
0483 C           BJRDNB    COMP DTMR                     42-COMPARE DATES S01194
0484 C   42                SETON                     LRU6
0485 C                     GOTO END
0486 C/EJECT
0487 C* M A I N   P R O C E S S I N G
0488 C           START     TAG                             ** START TAG **
0489 C  N05N04N03
0490 C*NN02****************GOTO*END************************NOT DETAIL REC.S01119
     CANN02N10             GOTO END                        NOT DETAIL REC.S01119
     C*
     C** READ BRANCH  DETAILS VIA ACCESS PROGRAM                          S01117
     C** TO OBTAIN COMPANY CODE                                           S01117
      * This code should probably be after the GOTO END if the deal                           CSC042
      * is reversed but for simplicity I will leave it here                                   CSC042
     C                     MOVELBRCA      ##KB                                                CSC042
     C                     EXSR ##CHKB                                                        CSC042
      * If branch is in the array then use the details                                        CSC042
     C           ##FIC     IFEQ 'Y'                        *** B10                            CSC042
     C                     EXSR ##SETB                                                        CSC042
     C                     ELSE                            *** X10                            CSC042
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     MOVEL'10'      DBASE                           S01194
     C                     MOVEL'*KEY   ' DBOPTN  7        **********     S01194
     C                     MOVEL@DSNB     DBKEY            *  010   *     S01194
     C                     MOVEL'SDBRCHPD'DBFILE           **********     S01194
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01117
     C                     ELSE                                                               CSC042
      * Details found on the DB so add them to the array                                      CSC042
      * if the array still has room                                                           CSC042
     C                     EXSR ##ADDB                                                        CSC042
     C                     END                                            S01117
     C                     END                             *** E10                            CSC042
     C*
0491 C           RECI      COMP 'D'                      44
0492 C   44      RECIN     ADD  1         RECIN   50       DEALS I/P COUNT
0493 C   44                Z-ADD1         X       10        LIVE
0494 C   44                EXSR HASH
0495 C           ORED      COMP DTMR                 43    EXTRACT NEEDED.
     C/COPY WNCPYSRC,DL1040C001
     C* DO NOT OUTPUT REVERSED DEALS
     C   43      RECI      COMP 'R'                  4343
0496 C  N43                GOTO END
     C/COPY WNCPYSRC,DL1040C002
0497 C*
0498 C*    CHECK FOR OPTION DEAL
0499 C   02      DTYP      COMP 'OP'                     30
0500 C   02 30             Z-ADDORPA      PUAM
0501 C                     Z-ADD2         X
      *                                                                   S01378
      **  For parcelled NAB use Original Purchase Price for output        S01378
      **  to S/EVDCM. PUPR defined in data structure. Note that during    S01378
      **  CoB the main purchase price, PUPR, is reduced to reflect        S01378
      **  NA's sold input against the purchased NA's. Hence use OPUP.     S01378
     C           *IN04     IFEQ '1'                                       S01378
     C           PCLI      ANDEQ'P'                                       S01378
     C                     Z-ADDOPUP      PUPR                            S01378
     C                     END                                            S01378
      *                                                                   S01378
0502 C                     EXSR HASH
0503 C           RECOUT    ADD  1         RECOUT  50       EVDCM O/P COUNT
0504 C* GET EVENT CCY SORT SEQ AND DEC. PLACES
     C*                         ( - OUR CCY & CDP FOR FRA/IRS )           S01119
0505 C*********************MOVELCURR******TAB4**************              S01119
     C**N10                MOVELCURR      TAB4                     S01119 S01194
     C***10                MOVELUCUCY     TAB4                     S01119 S01194
0506 C*****                MOVE TAB4      TABKEY                          S01194
0507 C*****      TABKEY    CHAINTABLE                41                   S01194
0508 C**N08                SETON                     LRU7U8               S01194
0509 C**N08                GOTO END                                       S01194
     C** READ CURRENCY DETAILS VIA ACCESS PROGRAM                         S01194
     C  N10                MOVELCURR      @AJCD                           S01194
     C   10                MOVELUCUCY     @AJCD                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'20'      DBASE                           S01194
     C                     MOVEL'*KEY   ' DBOPTN  7        **********     S01194
     C                     MOVEL@AJCD     DBKEY            *  020   *     S01194
     C                     MOVEL'SDCURRPD'DBFILE           **********     S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C*                                                                   S01119
0510 C*****                Z-ADDCDP       ECDP    10                      S01194
0510 C                     Z-ADDA6NBDP    ECDP    10                      S01194
0511 C*********************MOVE*CURR******ECURR***3*********              S01119
     C  N10                MOVE CURR      ECURR   3                       S01119
     C   10                MOVE UCUCY     ECURR                           S01119
0512 C*****                Z-ADDSSNO      ESSNO   20                      S01194
0512 C                     Z-ADDA6SSNB    ESSNO   20                      S01194
     C**                                                                  S01119
     C* FOR FRA/IRS TYPE 'RX' - SECOND (THEIR) CURRENCY & AMOUNT SHOWN    S01119
     C*                                                                   S01119
     C           *IN10     IFEQ '1'                                       S01119
     C*                                                                   S01119
     C           DTYP      IFEQ 'RX'                                      S01119
     C                     SETON                     61                   S01119
     C*    GET DECIMAL PLACES FOR THEIR CURRENCY                          S01119
     C*****                MOVELTCUCY     TAB4                     S01119 S01194
     C*****                MOVE TAB4      TABKEY                   S01119 S01194
     C*****      TABKEY    CHAINTABLE                41            S01119 S01194
     C*****                                                        S01119 S01194
     C*****      *IN08     IFEQ '0'                                S01119 S01194
     C*****                SETON                     LRU7U8        S01119 S01194
     C*****                GOTO END                                S01119 S01194
     C*****                END                                     S01119 S01194
     C*****                                                        S01119 S01194
     C*****                Z-ADDCDP       TCDP    10               S01119 S01194
     C** READ CURRENCY DETAILS VIA ACCESS PROGRAM                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM TCUCY     @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'30'      DBASE                           S01194
     C                     MOVEL'*KEY   ' DBOPTN  7        **********     S01194
     C                     MOVEL@AJCD     DBKEY            *  030   *     S01194
     C                     MOVEL'SDCURRPD'DBFILE           **********     S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C                     Z-ADDA6NBDP    TCDP    10                      S01194
     C*                                                                   S01119
     C                     ELSE                                           S01119
     C                     SETOF                     61                   S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     END                                            S01119
     C**                                                                  S01119
0513 C* GET CUSTOMER DETAILS.
0514 C*****                MOVELCUST      CLIKEY                          S01194
0515 C*****      CLIKEY    CHAINCLINT                41                   S01194
0516 C**N09                SETON                     LRU7U8               S01194
0517 C**N09                GOTO END                                       S01194
     C** READ CUSTOMER DETAILS VIA ACCESS PROGRAM                         S01194
     C                     MOVELCUST      @KEY1                           S01194
     C***********          CALL 'AOCUSTR0'                         S01194 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @KEY1  10                       S01194
     C                     PARM           @KYST   7                       S01194
     C***********SDCUST    PARM SDCUST    DSSDY                    S01194 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *                                                                   CSD007
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           @RTCD     ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
     C           @KYST     ANDNE'*ERROR '                                 CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
      *                                                                                       BG7717
      ** If Customer found but deleted, include this on the report                            BG7717
     C           @RTCD     IFEQ '*NRF'                                                        BG7717
     C           BBDTDL    ANDGT*ZERO                                                         BG7717
     C                     MOVELDLTD      BBCRNM                                              BG7717
      *                                                                                       BG7717
     C                     ELSE                                                               BG7717
     C           @RTCD     IFNE *BLANK                                    S01194
     C           @KYST     OREQ '*ERROR '                                 S01194
     C                     MOVEL'40'      DBASE                           S01194
     C                     MOVEL'*KEY   ' DBOPTN  7        **********     S01194
     C                     MOVEL@KEY1     DBKEY            *  040   *     S01194
     C                     MOVEL'SDCUSTPD'DBFILE           **********     S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
      *                                                                   CSD007
     C                     ENDIF                                                              BG7717
0518 C  N02                GOTO NOT02                      **
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1040CCP2                                           S01408
     C*                                                                   S01408
0519 C* SAVE PURCHASE CCY FIELD                             *
0520 C                     MOVE PUCY      PUCYX   3         *
0521 C* GET SALE CCY NO. DE. PLACES                         *
0522 C*****                SETOF                     08     *             S01194
0523 C*****                MOVELSLCY      TAB4              *             S01194
0524 C*****                MOVE TAB4      TABKEY            *             S01194
0525 C*****      TABKEY    CHAINTABLE                41     *             S01194
0526 C**N08                SETON                     LRU7U8 *             S01194
0527 C**N08                GOTO END                         *             S01194
     C** READ CURRENCY DETAILS VIA ACCESS PROGRAM                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM SLCY      @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'50'      DBASE                           S01194
     C                     MOVEL'*KEY   ' DBOPTN  7        **********     S01194
     C                     MOVEL@AJCD     DBKEY            *  050   *     S01194
     C                     MOVEL'SDCURRPD'DBFILE           **********     S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
0528 C           NOT02     TAG                             ** NOT02 TAG **
0529 C* IS DEAL FEDERAL FUND
0530 C                     SETOF                     4546
0531 C                     SETON                     47
     C*                                                                   S01119
     C* NON FRA/IRS DEALS                                                 S01119
     C           *IN10     IFEQ '0'                                       S01119
0532 C**N02******CCY       COMP 'USD'                    45               E11306
0533 C***02******PUCYX     COMP 'USD'                    45               E11306
0534 C***02N45***SLCY      COMP 'USD'                    46               E11306
0532 C**N02      CCY       COMP USCY                     45        E11306 S01194
0533 C***02      PUCYX     COMP USCY                     45        E11306 S01194
0534 C***02N45   SLCY      COMP USCY                     46        E11306 S01194
0532 C  N02      CCY       COMP BLUSCY                   45        E11306 S01194
0533 C   02      PUCYX     COMP BLUSCY                   45        E11306 S01194
0534 C   02N45   SLCY      COMP BLUSCY                   46        E11306 S01194
0535 C   45                TESTB'2'       DSTI       47
0536 C   46                TESTB'3'       DSTI       47
     C* FRA/IRS DEALS                                                     S01119
     C                     ELSE                                           S01119
     C*****      UCUCY     COMP USCY                     45        S01119 S01194
     C           UCUCY     COMP BLUSCY                   45        S01119 S01194
     C   45                TESTB'2'       UDSTI      47                   S01119
     C*                                                                   S01119
     C           *IN61     IFEQ '1'                                       S01119
     C           *IN47     ANDEQ'1'                                       S01119
     C*****      TCUCY     COMP USCY                     46        S01119 S01194
     C           TCUCY     COMP BLUSCY                   46        S01119 S01194
     C   46                TESTB'2'       TDSTI      47                   S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     END                                            S01119
     C**                                                                  S01119
0537 C*
0538 C* WORK OUT RATE
     C*                                                                   S01119
     C* NON FRA/IRS DEALS                                                 S01119
     C           *IN10     IFEQ '0'                                       S01119
0539 C                     Z-ADDYRAT      INTEX  138
0540 C   02                Z-ADDEXRT      INTEX
0541 C   03                Z-ADDINTR      INTEX
     C                     ELSE                                           S01119
     C*                                                                   S01119
     C* FRA/IRS DEALS                                                     S01119
     C                     MOVEA'000000'  *IN,62                          S01119
     C**FOR*CAPS*&*COLLARS*(TYPE*'RL')*-********                   S01119 SA1157
     C* FOR CAPS & COLLARS (TYPE 'RR','RP' OR 'RF') -                     SA1157
     C*          DTYP      IFEQ 'RL'                               S01119 SA1157
     C           DTYP      IFEQ 'RR'                                      SA1157
     C           DTYP      OREQ 'RP'                                      SA1157
     C           DTYP      OREQ 'RP'                                      SA1157
     C                     SETON                     67                   S01119
     C* EITHER 'OUR' OR 'THEIR' FLOATING RATE                             S01119
     C           UBRTT     COMP 0                    656563               S01119
     C*                                - CHECK IF FLOOR RATE PRESENT      S01119
     C   63                TESTB'4'       TDSTI          66               S01119
     C   65                TESTB'4'       UDSTI          66               S01119
     C* CHECK IF FIXED RATE TO BE SHOWN                                   S01119
     C   65                TESTB'0'       UDNSI          64               S01119
     C   64                Z-ADDUEINR     INTEX                           S01119
     C   63                TESTB'0'       TDNSI          62               S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C* FOR FORWARD RATE AGREEMENTS (TYPE 'FR')                           S01119
     C           DTYP      IFEQ 'FR'                                      S01119
     C*'OURS'                                                             S01119
     C           UBRTT     COMP 0                    656564               S01119
     C***65      UINFD     COMP DNWD                   64          S01119 S01194
     C   65      UINFD     COMP BJDNWD                 64          S01119 S01194
     C   64                Z-ADDUEINR     INTEX                           S01119
     C*'THEIRS'                                                           S01119
     C           TBRTT     COMP 0                    636362               S01119
     C***63      TINFD     COMP DNWD                   62          S01119 S01194
     C   63      TINFD     COMP BJDNWD                 62          S01119 S01194
     C                     END                                            S01119
     C*                                                                   S01119
     C* FOR INTEREST RATE SWAPS - SINGLE/CROSS CURRENCY (TYPES 'RS'/'RX') S01119
     C*                                                                   S01119
     C           DTYP      IFEQ 'RS'                                      S01119
     C           DTYP      OREQ 'RX'                                      S01119
     C*'OURS'                                                             S01119
     C           UBRTT     COMP 0                    656564               S01119
     C   65                TESTB'0'       UDNSI          64               S01119
     C   64                Z-ADDUEINR     INTEX                           S01119
     C*'THEIRS'                                                           S01119
     C           TBRTT     COMP 0                    636362               S01119
     C   63                TESTB'0'       TDNSI          62               S01119
     C                     END                                            S01119
     C*                                                                   S01119
     C                     END                                            S01119
     C**                                                                  S01119
0542 C*
0543 C***21****************Z-ADDNOTD******DATE*******                     E81162
     C*  21 03             Z-ADDNOTD      DATE                     E81162 S01119
     C   21N10 03          Z-ADDNOTD      DATE                            S01119
0544 C           END       TAG                             **  END TAG  **
0545 C/EJECT
0546 CLR U7
0547 COR U6                GOTO ENDLR
0548 CLR         RECOUT    ADD  2         RECOUT
0549 C*
0550 CLR         INT,1     COMP VLAF                 U8U8
0551 CLRNU8      DEC,1     COMP VLAL                 U8U8
0552 C*
0553 CLRNU8      NLRA      COMP RECIN                U8U8
0554 CLR         ENDLR     TAG                             ** ENDLR TAG **
     C*                                                                   S01117
     C***ENSURE*SPOOL*FILE*RECORDED*BY*RCF                          S01117E165
     C*R**                 CALL 'ZSFILE'                            S01117E165
     C*R**                 PARM *BLANKS   SEQ     5                 S01117E165
     C*R**                 PARM *BLANKS   @PARM   3                 S01117E165
     C*R**                 PARM           SFILEU                    S01117E165
     C*R**                 PARM           SFNUMU                    S01117E165
     C*                                                             S01117E165
0555 C/EJECT
0556 C* S U B R O U T I N E S
0557 C*
0558 C********************************************************************
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##CHKB - Subroutine to check the Branch in the arrays                                 CSC042
      *                                                                                       CSC042
     C           ##CHKB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN A8BRCD    ##KB                                                CSC042
      *                                                                                       CSC042
      * Set off the branch found indicator                                                    CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 30 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN30   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN30                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     SETOF                         30                                   CSC042
      *                                                                                       CSC042
      * Restore the saved Value of B                                                          CSC042
     C                     Z-ADD##BSV     B                                                   CSC042
      *                                                                                       CSC042
     C* Check whether details for Branch already in array                                     CSC042
      *                                                                                       CSC042
      * Is this the same as the last LOKUP, if so we can bypass                               CSC042
      * the LOKUP                                                                             CSC042
      * Defend against B being 0                                                              CSC042
     C           B         IFEQ 0                                                             CSC042
     C                     Z-ADD1         B                                                   CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * If the branch being checked is the same then use these                                CSC042
      * details rather than doing a LOKUP                                                     CSC042
     C           ##KB      IFEQ ##BR,B                                                        CSC042
      * Found so seton 30                                                                     CSC042
     C                     SETON                         30                                   CSC042
     C                     ELSE                                                               CSC042
     C                     Z-ADD1         B                                                   CSC042
     C           ##KB      LOKUP##BR,B                   30                                   CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Save the last update to B                                                             CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 30.                                                      CSC042
     C           #IN30     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN30                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN30                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##SETB - Sets up the SDBRCHPD fields used in the code from the                        CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##SETB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C                     MOVEL##BR,B    A8BRCD                                              CSC042
     C                     MOVEL##BC,B    A8CMCD                                              CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##ADDB - Adds the SDBRCHPD fields used in the code to the                             CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##ADDB    BEGSR                                                              CSC042
      *                                                                                       CSC042
      * If there is still room in the array then add the details                              CSC042
     C           ##BNDX    IFLT 999                                                           CSC042
     C                     ADD  1         ##BNDX                                              CSC042
     C                     Z-ADD##BNDX    B                                                   CSC042
     C                     MOVELA8BRCD    ##BR,B                                              CSC042
     C                     MOVELA8CMCD    ##BC,B                                              CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Update ##BSV  so next call to ##CHKB checks this latest adddition                     CSC042
      * to the array firss                                                                    CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
0559 C*
0560 C           HASH      BEGSR                           ***  HASH  ***
0561 C*
0562 C                     Z-ADDINT,X     ZZTOTI
0563 C                     Z-ADDDEC,X     ZZTOTD
0564 C                     Z-ADDAMOUNT    ZZAMT
0565 C***20*******         Z-SUBAMOUNT    ZZAMT                           156196
0566 C                     EXSR GLZADD
0567 C                     Z-ADDZZTOTI    INT,X            STORE
0568 C                     Z-ADDZZTOTD    DEC,X              RESULTS
0569 C                     ENDSR
0570 C********************************************************************
0571 C/SPACE 3
0572 C********************************************************************
0573 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0574 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0575 C*
0576 CSR         GLZADD    BEGSR                           *** GLZADD ****
0577 C*
0578 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0579 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0580 C*
0581 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0582 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0583 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0584 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0585 C*
0586 CSR                   EXSR GLZSUM
0587 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0588 C*
0589 C********************************************************************
0590 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0591 C*                        GLZADD, GLZSUB, GLZCMP.
0592 C*          PARAMETERS PASSED -
0593 C*                     I/P ZZAMTI ZZAMTD
0594 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0595 C*
0596 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0597 C*
0598 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0599 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0600 CSR                   SETOF                     919293
0601 CSR                   SETOF                     949599
0602 C*
0603 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0604 CSR         ZZAMTI    COMP 0                      9293
0605 CSR 93      ZZAMTD    COMP 0                      9293
0606 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0607 C*
0608 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0609 CSR         ZZTOTI    COMP 0                      9193
0610 CSR 93      ZZTOTD    COMP 0                      9193
0611 C*
0612 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0613 CSR 93                Z-ADDZZAMTI    ZZTOTI
0614 CSR 93                Z-ADDZZAMTD    ZZTOTD
0615 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0616 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0617 CSR 91N92
0618 CORN91 92             GOTO ZZOFPS
0619 C*
0620 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0621 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0622 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0623 C*
0624 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0625 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0626 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0627 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0628 C*
0629 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0630 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0631 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0632 CSRN99                Z-ADDZZWK2     ZZTOTD
0633 CSRN99                Z-ADDZZWK3     ZZTOTI
0634 C*
0635 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0636 CSR 99                Z-ADD0         ZZAMT  153
0637 CSR                   GOTO ZZSEND
0638 C*
0639 C* THE 'SIGNS' ARE DIFFERENT
0640 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0641 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0642 C*
0643 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0644 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0645 C*
0646 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0647 C*
0648 CSR 91                Z-SUBZZTOTI    ZZTOTI
0649 CSR 91                Z-SUBZZTOTD    ZZTOTD
0650 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0651 C*
0652 CSR         ZZTOTI    COMP ZZAMTI               93  95
0653 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0654 C*
0655 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0656 CSR 95                Z-ADD0         ZZTOTI
0657 CSR 95                Z-ADD0         ZZTOTD
0658 CSR 95                GOTO ZZSEND
0659 C*
0660 C* IF ZZTOT GT. ZZAMT.
0661 CSR 93      ZZAMTD    COMP ZZTOTD               94
0662 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0663 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0664 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0665 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0666 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0667 C*
0668 C*
0669 C* IF ZZAMT GT. ZZTOT.
0670 CSRN93      ZZTOTD    COMP ZZAMTD               94
0671 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0672 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0673 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0674 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0675 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0676 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0677 C*
0678 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0679 CSR                   SETOF                     94
0680 CSR 93 91
0681 CORN93 92             SETON                     94
0682 CSR 94                Z-SUBZZTOTI    ZZTOTI
0683 CSR 94                Z-SUBZZTOTD    ZZTOTD
0684 C**
0685 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0686 CSR 92                Z-SUBZZAMTI    ZZAMTI
0687 CSR 92                Z-SUBZZAMTD    ZZAMTD
0688 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0689 C**
0690 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0691 CSR                   SETOF                     96
0692 CSR         ZZTOTD    COMP 0                        91
0693 CSR 91      ZZTOTI    COMP 0                      96
0694 CSR 96                MOVE '.000-'   ZZNEGD  5
0695 CSR                   ENDSR                             ** ENDSR **
0696 C********************************************************************
0697 C/SPACE 3
0698 C********************************************************************
0699 C*****                                                               S01194
0700 C*****ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
0701 C*****                                                               S01194
0702 C*****      ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
0703 C*****                                                               S01194
0704 C*****SET UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
0705 C*****                MOVEL'01      'ZTABKY 12                       S01194
0706 C*****                MOVE '  10'    ZTABKY                          S01194
0707 C*****                                                               S01194
0708 C*****      ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0709 C**N99      RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0710 C*****                                                               S01194
0711 C*****CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
0712 C*****      DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0713 C*****                                                               S01194
0714 C*****                ENDSR                                          S01194
0715 C*****                                                               S01194
0716 C********************************************************************
     C**                                                                  S01194
     C*  ERROR DUMP SUB-ROUTINE                                           S01194
     C           *PSSR     BEGSR                           *** *PSSR  *** S01194
     C**                                                                  S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     ENDSR                           * *PSSR  ENDSR*S01194
     C**                                                                  S01194
     C********************************************************************
0717 C/EJECT
0718 O*PRINT  T  203   LR                                                 S01124
0718 O*L1040P1T  203   LR                                          S01124 S01117
0718 ODL1040AUT  203   LR                                                 S01117
0719 O***                                22 'REFERENCE DL1040'            S01117
0719 O                                   24 'REFERENCE DL1040AU'          S01117
0720 O*****                    TITL      89                               S01194
0720 O                         BJURPT    89                               S01194
0721 O                                  122 'DATE              PAGE'
0722 O*****                    RUNA     112                               S01194
0722 O                         BJMRDT   112                               S01194
0723 O                         PAGE  Z  127
0724 O        T  1     LR
0725 O                       80          46 'INTERIM'
0726 O                                   71 'DEALS BY CUSTOMER THIS M'
0727 O                                   85 'ONTH - EXTRACT'
0728 O        T        LR
0729 O                       80          46 '*******'
0730 O                                   71 '------------------------'
0731 O                                   85 '--------------'
0732 O*
0733 O        T 33     LR U6
0734 O                                   73 'THIS REPORT HAS ALREADY'
0735 O                                   82 'BEEN RUN'
0736 O*
0737 O********T 33     LR U7 U8                                           S01117
0738 O********                           22 'REFERENCE DL1040'            S01117
0739 O********                           64 'PRINT TERMINATED, '          S01117
0740 O********                           82 'DATABASE IN ERROR'           S01117
     O        T 3      LR U7 U8                                           S01117
     O                                   71 '*** PRINT TERMINATED ***'    S01117
     O        T 1      LR U7 U8                                           S01117
     O                                   57 'DATABASE ERROR'              S01117
     O                         DBASE     61                               S01117
     O                                   67 'FILE'                        S01117
     O                         DBFILE    78                               S01117
     O        T 13     LR U7 U8                                           S01117
     O                                   46 'KEY'                         S01117
     O                         DBKEY     76                               S01117
0741 O        T  236   LRNU6NU7
0742 O                                   18 'RUN CONTROLS'
0743 O        T  2     LRNU6NU7
0744 O                                   59 'NUMBER'
0745 O                                   84 'VALUE'
0746 O        T  2     LRNU6NU7
0747 O                                   32 'DEALS FILE RECORDS INPUT'
0748 O                                   40 '- LIVE'
0749 O                         RECIN 3   59
0750 O                         INT,1 Z   81
0751 O                         DEC,1     84
0752 O        T  2     LRNU6NU7
0753 O                                   32 'DEALS FILE CONTROL TOTAL'
0754 O                                   40 'S - LIVE'
0755 O                         NLRA  3   59
0756 O                         VLAF  Z   81
0757 O                         VLAL      84
0758 O        T  3     LRNU6NU7
0759 O                                   28 'EXTRACT FILE CREATED'
0760 O                                   44 '- TOTAL RECORDS'
0761 O                         RECOUT3   59
0762 O                         INT,2 Z   81
0763 O                         DEC,2     84
0764 O        T  3     LRNU6NU7
0765 O       AND       U8
0766 O                                   71 '***   DIFFERENCE   ***'
0767 O*****   T 3      LR                                                 LN0135
0768 O*****                              71 '*** END OF REPORT ***'       LN0135
0769 O/EJECT
0770 OEVDCMHH H        1P
0771 O                                    1 'A'
0772 OEVDCMED D        43 02NLR
0773 O       OR        43 03NLR
0774 O       OR        43 04NLR
0775 O       OR        43 05NLR
     O       OR        43 10NLR                                           S01119
0776 O                                    1 'D'
     O/COPY WNCPYSRC,DL1040O001
0777 O                         DLNO       7
0778 O                         CUST      13
0779 O*****                    CASK      21                               S01194
0779 O                         BBCASC    21                               S01194
0780 O                         VDAT      24P
0781 O                         AMOUNT    31P
0782 O                         ECURR     34
0783 O                         ESSNO     36
0784 O                         ECDP      37
0785 O                         DTYP      39
0786 O                         DLST      41
0787 O*************************INTEX*****48P******************            S01119
     O                N10      INTEX     48P                              S01119
     O                 10 64   INTEX     48P                              S01119
0788 O                         DATE      51P
0789 O                       05ZERO5     51P
0790 O                         ZERO13    58P
0791 O                       02SLAM      58P
     O                 10 61   TPAMT     58P                              S01119
0792 O                       02SLCY      61
     O                 10 61   TCUCY     61                               S01119
0793 O*****                  02CDP       62                               S01194
     O                       02A6NBDP    62                               S01194
     O                 10 61   TCDP      62                               S01119
0794 O                 02 30   ORSA      58P
C795 O*****                    CRNM      82                               S01194
C795 O                         BBCRNM    82                               S01194
0796 O*****                    CTWN      92                               S01194
0796 O                         BBCRTN    92                               S01194
0797 O                      N47          93 'F'
     O                 10 65   UBRTT     95                               S01119
     O                 10 62   TEINR    101P                              S01119
     O                 10 63   TBRTT    103                               S01119
     O                 10 67   CLRAT    109P                              S01119
     O                 10 66   FLRAT    115P                              S01119
     O                 10 66            116 'Y'                           S01119
     O                 10 62            117 'Y'                           S01119
     O                 10 63            118 'Y'                           S01119
     O                 10 64            119 'Y'                           S01119
     O                 10 65            120 'Y'                           S01119
      *                                                                   S01378
      ** Only output Parcel Indicator for NA's bought/sold                S01378
     O                    04   PCLI     121                               S01378
     O                    05   PCLI     121                               S01378
     O                         BRCA     124                               S01117
     O                         A8CMCD   127                               S01117
     O                 03      RDLN     134                               S01117
     O                N03               134 '000000'                      S01117
     O                         CLAS     138                               CDL038
     O                         BSDT2    141P                                                  CDL099
0798 OEVDCMZZ T        LR
0799 O                                    1 'Z'
0800 O                         RECOUT     6
0801 O                         INT,2     14P
0802 O                         DEC,2     16P
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
