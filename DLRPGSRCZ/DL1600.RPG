     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA/IRS deal types maintenance')              *
      *****************************************************************
      *                                                               *
      *   Midas - FRA/IRS Module                                      *
      *                                                               *
      *   DL1600 - FRA/IRS DEALS MAINTENANCE PROGRAM -                *
      *            CONTROLLING PROGRAM                                *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CRE073             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 226723             Date 28Feb06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CAS009             Date 16May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CAS008             Date 16Jun04               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 217684             Date 12May03               *
      *                 CDL010             Date 02Aug02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 159271             Date 22Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186458             Date 01Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 179380             Date 28Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAP010             Date 02Jul99               *
      *                 CAP003             Date 03Aug98               *
      *                 S01408             DATE 02AUG96               *
      *                 S01408             DATE 10JUN96               *
      *                 076296             DATE 18APR96               *
     F*                 S01444             DATE 11APR95               *
     F*                 S01453             DATE 14DEC93               *
     F*                 042960             DATE 20AUG93               *
     F*                 E22518             DATE 31JUL90               *
     F*                `E20774             DATE 09APR90               *
      *                    S01117             DATE 18DEC89            *   S01117
      *                    S01199             DATE 18DEC89            *   S01199
      *                    S01194             DATE 18DEC89            *   S01194
      *                    S01157             DATE 03/10/88           *
      *                    E13163             DATE 23/05/88           *
      *                    S01119             DATE 13/07/87           *
      *---------------------------------------------------------------*
      *                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  226723 - Recompile due to changes done in DL1600DF.          *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  159271 - FDDLNMPP is not read at all when DRS is OFF which   *
      *           caused NORDLN to be zero. Removed the checking for  *
      *           DRS since deal number range should always be checked*
      *         - If action code is INSERT ('I'), always check for    *
      *           the FDDLNMPP file which holds the DEAL NUMBER       *
      *           RANGES which defines which Deal Numbers are allowed *
      *           to be inserted. This is to avoid errors on duplicate*
      *           Deal Numbers being inserted on DEALS FILES:FX, MM,  *
      *           AB, which uses AUTOMATIC GENERATION OF DEAL NUMBERS.*
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  186458 - Display Confirmation Matching status.               *
      *           - Recompile only.                                   *
      *  179380 - Confirmation matching status for deal types 'FR'    *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR005 - FRA/IRS Business Day Conventions                    *
      *           - Recompile only.                                   *
      *  CAP010 - Enhanced switchability for APIs                     *
      *           Use CAP123 rather than CAP003                       *
      *  CAP003 - Conversion of inputs into modular structure to      *
      *           use as APIs.                                        *
      *           This program will only permit the processing of     *
      *           Caps, Floors and Collars once APIs are installed    *
      *  S10408 - Addition of Core Hook - DL1600FFP1                  *
      *         - Addition of Core Hook - DL1600EEP2                  *
      *         - Addition of Core Hook - DL1600EEP1                  *
      *         - Addition of Core Hook - DL1600CCP6                  *
      *         - Addition of Core Hook - DL1600CCP5                  *
      *         - Addition of Core Hook - DL1600CCP4                  *
      *         - Addition of Core Hook - DL1600CCP3                  *
      *         - Addition of Core Hook - DL1600IIP1                  *
      *  S10408 - Addition of Core Hook - DL1600CCP1                  *
      *         - Addition of Core Hook - DL1600CCP2                  *
      *  076296 - Use file DEALSALL instead of override file          *
      *           DEALSCH when checking for duplicate deal nos.       *
     F*  S01444 - Recompiled. (LF/DEALSALL - amended to include       *
     F*           historic deals files)                               *
      *  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
      *           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  042960 - Chain to DEALSALL instead of DEALS and CADENQLL     *
     F*           so as to be better able to check for duplicate      *
     F*           Deal Numbers.                                       *
      *     E22518  -  DUPLICATE KEYS ON DRSDEALS                     *
      *     E20774  -  REPLACE QCAEXEC WITH QCMDEXC                   *
      *     S01117  -  MULTIBRANCHING CHANGES/ADDITIONS               *   S01117
      *     S01199 - HELP SYSTEM. (THIS FIX WAS APPLIED TO THIS      *    S01199
      *                PROGRAM FOR R10 AT THE SAME TIME AS IT WAS     *   S01199
      *                APPLIED TO ANOTHER VERSION FOR R2 - THEREFORE  *   S01199
      *                THEY MAY NOT BE INDENTICAL CHANGES)            *   S01199
      *     S01194  -  NEW STANDING DATA CHANGES                      *   S01194
      *     S01157  -  CHANGE RL TO RP;RR;RF                          *
      *             -  RCLRSC TO CLOSE ALL FILES LOWER IN STACK       *
      *     E13163  -  CONDITION USE OF MEMOS AND ACNUM ON RETAIL.    *   E13163
      *                                                               *
      *     S01119  -  FRA/IRS INCORPORATION.                         *   S01119
      *                                                               *
      *****************************************************************
     F***CADENQLLIF**E           K        DISK                     E22518 042960
     F*LINT***IF**E********** K        DISK                               S01194
     FFDDLNMLLIF  E                    DISK                           UC  S01119
     F*NAME***IF**E********** K        DISK                               S01194
     F************CLINTCBF                          KRENAMESNAMECBF       S01194
     FACCNT   IF  E           K        DISK                               S01194
     F*CNUM***IF**E           K        DISK                               E13163
     FACNUM   IF  E           K        DISK                           U1  E13163
     F            ACCNTABF                          KRENAMEACNUMABF
     FDTRIXHH UF  E                    DISK
     F                                              KCOMIT
     F*EMOS***UF**E                    DISK                               E13163
     FMEMOS   UF  E                    DISK                           U2  E13163
     F                                              KCOMIT
     FOLPOS   UF  E           K        DISK
     F            OLPOSHHF                          KIGNORE
     F            OLPOSOBF                          KIGNORE
     F                                              KCOMIT
     FPRONO   UF  E           K        DISK
     F            PRONOHHF                          KIGNORE
     F                                              KCOMIT
     FDEALSDG O   E                    DISK
     F            DEALSDGF                          KRENAMEPFDEALSF
     F                                              KCOMIT
     FDTRIXDD O   E                    DISK
     F                                              KCOMIT
     F*ABDLI**IF**E********** K        DISK                               S01194
     F**********  TABTE10F                          KIGNORE               S01194
     F**********  TABTE20F                          KIGNORE               S01194
     F**********  TABTG20F                          KIGNORE               S01194
     F**********  TABLETSF                          KIGNORE               S01194
     FDEALS   UF  E           K        DISK
     F                                              KCOMIT
     F***DEALSCH IF  E           K        DISK                            076296
     FDEALSALLIF  E           K        DISK                               076296
     F************DEALSDAF                          KRENAMEDLSCHDAF       042960
     F            DEALSDBF                          KRENAMEDLSCHDBF
     F            DEALSDCF                          KRENAMEDLSCHDCF
     F            DEALSDDF                          KRENAMEDLSCHDDF
     F            DEALSDEF                          KRENAMEDLSCHDEF
     F************DEALSDFF                          KRENAMEDLSCHDFF       042960
     F            DEALSDGF                          KRENAMEDLSCHDGF
     F/COPY WNCPYSRC,DL1600F001
     FDL1600DFCF  E                    WORKSTN
     F*                                                                   S01408
     F/COPY WNCPYSRC,DL1600FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
      * ID  F  C  H  L    FUNCTION OF INDICATORS
      *
      **  NB.  THE FUNCTION OF AN INDICATOR SHOULD NOT BE CHANGED
      **  BETWEEN THE PROGRAMS IN THIS SUITE
      **  i.e. BETWEEN DL1600 / DL1601 / DL1602 / DL1603 / DL1604
      *
      *                 SCREEN RESPONSE INDICATORS:
      *
      *****01***********HELP*INDICATOR***                                 S01199
      *    02           ROLLUP INDICATOR
      *    03           ROLLDOWN INDICATOR
      ********04********FRA/IRS*FUNCTION*NOT*SET*UP*(TABTB40)****         S01194
      *       04        FRA/IRS FUNCTION NOT SET UP (SDMMODPD)            S01194
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *
      *       05        DISPLAY 1ST ERROR CODE FIELD
      *       06        DISPLAY 2ND ERROR CODE/MESSAGE FIELD
      *
      *       07        WARNING ERRORS EXIST
      *       08        RECORD UPDATED BY ANOTHER WORKSTATION
      *       09
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *                 FIELD IN ERROR
      *
      *       10        NEW DEAL NO.
      *       11        NEW ACTION CODE
      *           AND   PROFIT CENTRE USED FLAG                           S01117
      *       12        NEW DEAL TYPE
      *       13        DEAL SUB-TYPE
      *       14        DEAL DATE
      ********15********BRANCH CODE                                       S01117
      *       15        BOOKING BRANCH CODE                               S01117
      *       16        BROKER CODE
      *       17        BROKERAGE AMOUNT
      *       18        LINKED DEAL NO.
      *       19        CUSTOMER NO.
      *       20        VALUE DATE
      *       21        MATURITY DATE
      *       22        CUST. DEAL. ACC. SEQ. NO.
      *       23        (OUR) CURRENCY
      *       24        (OUR) PRINCIPAL AMOUNT
      *       25        (OUR) FED FUNDS IND.
      *       26        OUR BASE CURRENCY EXCHANGE RATE
      *       27        (OUR) CALC. METHOD
      *       28        HEDGE IND.
      *       29        TAXABLE IND.
      *       30        (OUR) NEGATIVE INTEREST IND.
      *       31        OUR FLOATING RATE FIX DAYS
      *       32        OUR BASE RATE TYPE
      *       33        OUR SPREAD/RATE
      *       34        OUR SPREAD IND.
      *       35        THEIR BASE RATE TYPE
      *       36        THEIR SPREAD/RATE
      *       37        THEIR SPREAD IND.
      *       38        RECEIPT SETTLEMENT METHOD
      *       39        PAYMENT SETTLEMENT METHOD
      ********40********OUR RECEIVING ACCOUNT                             S01117
      ********41********OUR PAYMENT ACCOUNT                               S01117
      *       40        OUR RECEIVING ACCOUNT/BRANCH                      S01117
      *       41        OUR PAYMENT ACCOUNT/BRANCH                        S01117
      *       42        COUNTERPARTY PAYING BANK
      *       43        COUNTERPARTY RECEIVING BANK
      *       44        FOR ACCOUNT OF
      *       45        SPECIAL INSTRUCTIONS
      ********46********THEIR NEGATIVE INTEREST IND.                      S01117
      *       46        ORIGINATING BRANCH                                S01117
      *       47        OUR NEXT INTEREST RATE CHANGE DATE
      *       48        OUR INTEREST RATE CHANGE FREQUENCY
      *       49        OUR INTEREST RATE CHANGE DAY IN MONTH
      *       50        OUR SHORT TERM RATE ( OUR EFFECTIVE INT. RATE )
      *       51        OUR INTEREST PAYMENT DATE
      *       52        OUR INTEREST PAYMENT FREQUENCY
      *       53        OUR INTEREST PAYMENT FREQUENCY DAY IN MONTH
      ********54********OUR FLOOR RATE ENTERED IND                        S01117
      *       54        PROFIT CENTRE                                     S01117
      *       55        THEIR BASE CURRENCY EXCHANGE RATE
      *       56        THEIR INTEREST CALC. BASIS
      *       57        THEIR FLOATING RATE FIX DAYS
      *       58        THEIR NEXT INTEREST RATE CHANGE DATE
      *       59        THEIR INTEREST RATE CHANGE FREQUENCY
      *       60        THEIR INTEREST RATE CHANGE DAY IN MONTH
      *       61        THEIR SHORT TERM RATE (THEIR EFFECT. INT. RATE)
      *       62        THEIR INTEREST PAYMENT DATE
      *       63        THEIR INTEREST PAYMENT FREQUENCY
      *       64        THEIR INTEREST PAYMENT DAY IN MONTH
      *       65        THEIR CURRENCY
      *       66        THEIR PRINCIPAL AMOUNT
      *       67        CEILING RATE
      *       68        FLOOR RATE
      *       69        AVERAGE RATE METHOD
      *       70        OUR CAPS AVERAGE RATE IND.
      *       71        THEIR CAPS AVERAGE RATE IND.
      *       72        THEIR FED. FUNDS IND.
      *       73        THEIR FLOOR RATE IND.
      *       74
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *                 PROTECT FIELD FOR AMEND
      *     ( NB THESE INDICATORS ARE UNIQUE IN EACH PGM )
      *
      *       75
      *       76
      *       77
      *       78
      *       79
      *       80
      *       81
      *       82
      *
      *       83        SYSTEM IS MULTIBRANCH DEALING
      *       84        WORK - TESTING NUMERIC ( ON = ALL NUMERIC )
      *       85        WORK - (SEE COMMENTS IN CODE FOR SPECIFIC USE)
      ********86********NON-TABLE*FILE*CHAIN*FAIL*********                S01194
      ********87********SYSTEM IS MULTIBRANCH ACCOUNTING                  S01117
      *       87        ORIGINATING BRANCH USED                           S01117
      *       88        RETAIL ACCOUNT NUMBERS USED IN SYSTEM
      *       89        RETAIL MODULE PRESENT IN SYSTEM
      *
      *     90-99       USED IN STANDARD MIDAS SUB-ROUTINES.
      *
      ********98********ZSYSTM, DATE FORMAT MMDDYY IF ON, DDMMYY IF OFF   S01194
      ********99********TABLE CHAIN FAIL - RECORD NOT FOUND               S01194
      *       99        GENERAL ERROR, REFER TO RELEVANT ROUTINE          S01194
      *
      *       U1        RETAIL MODULE ON, USE ACNUM FILE                  E13163
      *       U2        RETAIL MODULE ON, USE MEMOS FILE                  E13163
      *     U7+U8     DATABASE ERROR
      *
      /EJECT
     E                    CPY@    1   1 80
     E                    ERCD       40  4
      *  Error codes
     E********************ERRMSG  1  10 76                                S01117
     E*                                                                   S01408
     E/COPY WNCPYSRC,DL1600EEP1                                           S01408
     E*                                                                   S01408
     E                    ERRMSG  1  15 76                                S01117
     E*                                                                   S01408
     E/COPY WNCPYSRC,DL1600EEP2                                           S01408
     E*                                                                   S01408
      *  Messages
      /EJECT
      *
      **  Rename spare 'filler' fields to avoid fields with the same
      **  names being defined with different lengths.
      *
     IDEALSDCF
     I*******       ZZ0375                          ZZ010A                S01119
      *
     IDEALSDDF
     I*******       ZZ0063                          ZZ008A                S01119
     I*******       ZZ0375                          ZZ016A                S01119
      *
     IDEALSDEF
     I*******       ZZ0063                          ZZ014A                S01119
     I*******       ZZ0375                          ZZ016A                S01119
      *
     IDLSCHDCF
     I*******       ZZ0375                          ZZ010A                S01119
      *
     IDLSCHDDF
     I*******       ZZ0063                          ZZ008A                S01119
     I*******       ZZ0375                          ZZ016A                S01119
      *
     IDLSCHDEF
     I*******       ZZ0063                          ZZ014A                S01119
     I*******       ZZ0375                          ZZ016A                S01119
      *
     I*ABTB20F**********                                                  S01194
     I**********    ZZ0081                          ZZ009A         S01119 S01194
      **********                                                          S01194
     I*ABLETKF**********                                                  S01194
     I**********    ZZ0063                          ZZ027A         S01119 S01194
      **********                                                          S01194
     I*ABLETLF**                                                          S01194
     I**********    ZZ014A                          ZZ002A         S01119 S01194
      **********                                                          S01194
     I*ABLET1F**                                                          S01194
     I**********    ZZ0057                          ZZ033A         S01119 S01194
      **********                                                          S01194
     IACCNTABF
     I*******       ZZ0017                          ZZ006A                S01119
      /EJECT
      *
      **  Data structures :
      *
      **   Data structure for testing that deal number is numeric
      *
     INOTEST      DS
     I                                        1   6 TESTNO
     I                                        7   7 HIGHZN
      *
      **  Program status data structure for workstation ID
      *
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      245 246 WSID2
      **********                                                          S01194
      *****Local*data*area*to*hold*database*error*information*****        S01194
      **********                                                          S01194
     I*DA*******  DS                            256                       S01194
     I**********                            134 138 DBFILE                S01194
     I**********                            139 167 DBKEY                 S01194
     I**********                            168 175 DBPGM                 S01194
     I**********                            176 1770DBASE                 S01194
     I* DATA AREA TO HOLD D/BASE ERROR INFORMATION                        S01194
     I*                                                                   S01194
     IDBERR       DS                            256                       S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I* MODULE DETAILS ACCESSED VIA ACCESS PROGRAM                        S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I* GENERAL LEDGER  DETAILS ACCESSED VIA ACCESS PROGRAM               S01194
     ISCSARD    E DSSCSARDPD                                              CAP003
     I** SAR Details Accessed via access program                          CAP003
     I*                                                                   S01194
     I* DUMMY DATA STRUCTURES USED BY ACCESS PROGRAMS                     S01194
     I* (DSSDY ONLY USED IF FILE RECORDS OVER 150 CHARS. LONG)            S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1600IIP1                                           S01408
     I*                                                                   S01408
      /EJECT
     C                     MOVEACPY@      BIS@   80
     C*
      *****************************************************************
      *                                                               *
      *    I N I T I A L   P R O C E S S I N G                        *
      *                                                               *
      *****************************************************************
      *
      **   Dummy updates to allow files to be opened at control level
      *
      **   ///   THIS SUBROUTINE WILL NEVER BE EXECUTED  ///
      *
     C                     MOVE '0'       *IN85
     C           *IN85     IFEQ '1'
     C                     EXSR DUMMY
     C                     END
      **********                                                          S01194
      *****Define*LDA*&*clear*positions*used*for*database*errors****      S01194
      **********                                                          S01194
     C********** *NAMVAR   DEFN           LDA                             S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE *BLANKS   DBFILE                          S01194
     C**********           MOVE *BLANKS   DBKEY                           S01194
     C**********           MOVE *BLANKS   DBPGM                           S01194
     C**********           MOVE *BLANKS   DBASE                           S01194
     C**********           OUT  LDA                                       S01194
     C*                                                                   S01194
     C* INITIALISE DATABASE ERROR FIELDS                                  S01194
     C*                                                                   S01194
     C                     MOVE *BLANKS   DBFILE                          S01194
     C                     MOVE *BLANKS   DBKEY                           S01194
     C                     MOVE *BLANKS   DBPGM                           S01194
     C                     MOVE *BLANKS   DBASE                           S01194
      *
      **   Setup parameter list for use in calling detail programs
      *
     C           PLIST1    PLIST
      **   Sending parameter only
     C                     PARM           TNLUX   50
      **   Receiving parameter only
     C           *INKC     PARM *INKC     CMD3    1
      **   Sending / Receiving parameters
     C                     PARM           NEWDL   6
     C                     PARM           NEWAC   1
     C                     PARM           NEWDT   2
      *
      **   Setup workstation ID for screen display
      *
     C                     MOVE WSID      SWSID
      **********                                                          S01194
      *****Check*TABTB40*(IRFRA)*for*FRA/IRS*function*present*****        S01194
      **********                                                          S01194
     C**********           MOVEL'01      'ZTABKY 12                       S01194
     C**********           MOVE '  10'    ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               04           S01119  S01194
     C**N04***** RECI      COMP 'D'                  0404  ON, IS S01119  S01194
     C********** *IN04     IFEQ '1'                               S01119  S01194
     C********** *LOCK     IN   LDA                               S01119  S01194
     C**********           MOVE '01'      DBASE            *******S01119  S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DB*S01119  S01194
     C**********           MOVELZTABKY    DBKEY            *     *S01119  S01194
     C**********           EXSR DBERR                      *******S01119  S01194
     C**********           END                                    S01119  S01194
     C**********           SETOF                     04           S01119  S01194
     C**********                                                          S01194
     C**********           MOVE *BLANKS   KEY                             S01194
     C**********           MOVEL'01'      KEY                             S01194
     C**********           MOVE '40'      KEY    12                       S01194
     C********** KEY       CHAINTABDLI               04                   S01194
     C**N04***** RECI      COMP 'D'                  0404  ON, IS DELETED S01194
     C**N04***** IRFRA     COMP 'Y'                  0404  FRA/IRS MISSINGS01194
      **********                                                          S01194
      *                                                                   CAP003
      ****Access*SAR*details*file*to*determine*if*API*feature*is*on CAP003CAP010
      **  Access SAR details file to determine if FRA/IRS API menu        CAP010
      **  feature is on                                                   CAP010
      *                                                                   CAP003
     C                     CALL 'AOSARDR0'                                CAP003
     C                     PARM *BLANKS   @RTCD                           CAP003
     C                     PARM '*VERIFY' @OPTN                           CAP003
     C******               PARM 'CAP003'  @SARD   6                 CAP003CAP010
     C                     PARM 'CAP123'  @SARD   6                       CAP010
     C           SCSARD    PARM SCSARD    DSFDY                           CAP003
      *                                                                   CAP003
     C           @RTCD     IFNE *BLANKS                                   CAP003
     C           @RTCD     ANDNE'*NRF   '                                 CAP003
     C                     MOVEL'SCSARDPD'DBFILE           ***************CAP003
     C                     MOVEL'003'     DBASE            * DB ERROR 03 *CAP003
     C******               MOVEL'CAP003'  DBKEY            *********CAP003CAP010
     C                     MOVEL'CAP123'  DBKEY            ***************CAP010
     C                     EXSR *PSSR                                     CAP003
     C                     END                                            CAP003
      *                                                                   CAP003
     C           @RTCD     IFEQ *BLANKS                                   CAP003
     C******               MOVEL'Y'       CAP003  1                 CAP003CAP010
     C                     MOVEL'Y'       CAP123  1                       CAP010
     C                     ELSE                                           CAP003
     C******               MOVEL'N'       CAP003                    CAP003CAP010
     C                     MOVEL'N'       CAP123                          CAP010
     C                     END                                            CAP003
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO CHECK IF FRA/IRS MODULE PRESENT            S01194
     C*                                                                   S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                                   S01194
     C           BGFIIN    IFNE 'Y'                                       S01194
     C                     MOVE '1'       *IN04                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN04     IFEQ '1'
     C                     MOVELERRMSG,10 SERCD2
     C                     MOVE '1'       *IN,06
     C                     END
0993 C*
      ***Test*for DRS being present                                                    S01119 159271
     C******************** TESTB'2'       MODI4          85        S01119 S01194
     C********** BGDRFE    IFEQ 'Y'                                                    S01194 159271
     C**********           MOVE '1'       *IN85                                        S01194 159271
     C**********           END                                                         S01194 159271
      *                                                                   S01119
      ** If it is get the deal number range                               S01119
     C********** *IN85     IFEQ '1'                                                    S01119 159271
     C**********           MOVE 'Y'       MDRS    1                                    S01119 159271
     C                     OPEN FDDLNMLL                                  S01119
     C           1         CHAINFDDLNMLL             85                   S01119
     C                     CLOSEFDDLNMLL                                  S01119
     C           *IN85     IFEQ '1'                                       S01119
     C           NODLTF    ORNE ' '                                       S01119
     C*                                                                   S01194
     C********** *LOCK     IN   LDA                                S01119 S01194
     C**********           MOVE '02'      DBASE            ********S01119 S01194
     C**********           MOVE 'DRS  '   DBFILE           *      *S01119 S01194
     C**********           MOVEL'FDDLNMLL'DBWRK  17        *   DBE*S01119 S01194
     C**********           MOVE 'RECORD 1'DBWRK            *      *S01119 S01194
     C**********           MOVELDBWRK     DBKEY            *      *S01119 S01194
     C**********           EXSR DBERR                      ********S01119 S01194
     C*                                                                   S01194
     C                     MOVEL'DRS  '   DBFILE                          S01194
     C                     MOVEL'FDDLNMLL'DBWRK  17        ***************S01194
     C                     MOVE 'RECORD 1'DBWRK            *  DBERROR    *S01194
     C                     MOVELDBWRK     DBKEY            *    02       *S01194
     C                     MOVEL'002'     DBASE            ***************S01194
     C                     EXSR *PSSR                                     S01194
     C*                                                                   S01194
     C                     END                                            S01119
     C**********           ELSE                                                        S01119 159271
     C**********           MOVE 'N'       MDRS                                         S01119 159271
     C**********           END                                                         S01119 159271
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO GET ORIGINATING BRANCH USER                S01194
     C* VALIDATION FLAG                                                   S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                             S01194 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01194 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1600CCP3                                           S01408
     C*                                                                   S01408
      *
      **   Write/Read initial screen
      *
     C******************** EXSR SCRNA                                     S01199
     C                     EXFMTDL1600FA                                  S01199
     C/COPY WNCPYSRC,DL1600C001
      /SPACE 2
      *****************************************************************
      *                                                               *
      *    M A I N   P R O C E S S I N G                              *
      *                                                               *
      *****************************************************************
      *
      **   Continue until cmd/3 taken
      *
     C           *INKC     DOWEQ'0'
     C           *IN04     ANDEQ'0'
      *
      **   Validate initial screen
      *
     C                     EXSR VALD01
      *
      **   If initial screen is invalid:
      *
     C           *IN05     IFEQ '1'
      **   Rewrite screen with errors / read
     C                     MOVEAERCD      SERCD1
     C******************** EXSR SCRNA                                     S01199
     C/COPY WNCPYSRC,DL1600C002
     C                     EXFMTDL1600FA                                  S01199
     C/COPY WNCPYSRC,DL1600C003
      *
      **   If initial screen is valid:
      *
     C                     ELSE
      **   Move screen field values to parameter fields
     C                     MOVE SNEWDL    NEWDL
     C                     MOVE SNEWAC    NEWAC
     C           SNEWDT    IFEQ *BLANKS
     C/COPY WNCPYSRC,DL1600C016
     C                     MOVE DTYP      NEWDT
     C                     ELSE
     C                     MOVE SNEWDT    NEWDT
     C                     END
     C                     Z-ADDTNLU      TNLUX
      *
      **   Determine program to be called to maintain details depending
      **   on the deal type
      *
      **   Forward rate agreements
     C                     MOVE *BLANKS   PGMXX   7
     C/COPY WNCPYSRC,DL1600C004
     C                     MOVEL'DL1601'  PGMXX
      **   Single currency interest rate swaps
     C           NEWDT     IFEQ 'RS'
     C                     MOVEL'DL1602'  PGMXX
     C                     END
      **   Cross-currency interest rate swaps
     C           NEWDT     IFEQ 'RX'
     C                     MOVEL'DL1603'  PGMXX
     C                     END
      **   Interest rate cap & collar transactions
     C********   NEWDT     IFEQ 'RL'                                      S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C           NEWDT     OREQ 'RR'                                      S01157
     C           NEWDT     OREQ 'RF'                                      S01157
     C*                                                                   S01157
     C                     MOVEL'DL1604'  PGMXX
     C                     END
     C/COPY WNCPYSRC,DL1600C005
      **
     C                     MOVE NEWAC     PGMXX
     C/COPY WNCPYSRC,DL1600C013
     C                     CALL PGMXX     PLIST1
      **
      **   On return from called pgm:
      *
      **   If call to detail pgm ends with database error, exit pgm
      *
     C           *NAMVAR   DEFN LDA       DBERR                           S01194
     C                     IN   DBERR
     C           DBFILE    IFNE *BLANKS
     C           *INU7     OREQ '1'                                       S01157
     C           *INU8     OREQ '1'                                       S01157
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      **   Move parameter field values to screen fields for next trans.
     C/COPY WNCPYSRC,DL1600C006
     C                     MOVE NEWDL     SNEWDL
     C                     MOVE NEWAC     SNEWAC
     C                     MOVE NEWDT     SNEWDT
     C/COPY WNCPYSRC,DL1600C007
      *
     C                     END
      *
     C                     END
      *
      /SPACE 2
      *****************************************************************
      *                                                               *
      *    F I N A L   P R O C E S S I N G                            *
      *                                                               *
      *****************************************************************
     C*                                                                   S01157
     C**USE*QCAEXEC*TO*EXECUTE*RCLRSC*TO*CLOSE*DOWN*ALL*FILES*******S01157E20774
     C* USE QCMDEXC TO EXECUTE RCLRSC TO CLOSE DOWN ALL FILES             E20774
     C* OPENED LOWER IN STACK                                             S01157
     C*                                                                   S01157
     C                     Z-ADD6         CMDLEN 155                      S01157
     C                     MOVE 'RCLRSC'  CMD     6                       S01157
     C*********************CALL 'QCAEXEC'                           S01157E20774
     C                     CALL 'QCMDEXC'                                 E20774
     C                     PARM           CMD                             S01157
     C                     PARM           CMDLEN                          S01157
     C*                                                                   S01157
     C                     SETON                     LR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *                    INDEX TO SUBROUTINES                       *
      *                                                               *
      ***1.**SCRNA***:*Write/read*initial*screen*'A'*&*control*HELP****   S01199
      ***2.**HELP****:*Call*MHELP*pgm,*passing*parameters**************   S01199
      *  3.  VALD01  : Validate initial screen entries                *
      *  4.  DUMMY   : Dummy file operations                          *
      ***5.**DBERR***:*To*update*LDA*with*database*error*informatioS01119 S01194
      *****************&*exit*program.*:::::::::                   S01119 S01194
      *   *PSSR   : DATABASE ERROR HANDLING                           *   S01194
      *     ( NB SR DUMMY IS NEVER EXECUTED )                         *
      *                                                               *
      * Standard subroutines:                                         *
      *                                                               *
      *  None.                                                        *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************   S01199
      ***********                                                     *   S01199
      ***SCRNA**SR.****To*write*/*read*initial*screen*&*control********   S01199
      ******************alls*to*HELP********                          *   S01199
      ***SCRNA**SR.****To*write*/*read*initial*screen*****            *   S01199
      **********                                                      *   S01199
      ***CALLED*FROM*:*Main*****                                      *   S01199
      ***CALLS*******:*HELP**********                                 *   S01199
      ***CALLS*******:*NONE*********                                  *   S01199
      **********                                                      *   S01199
      *****************************************************************   S01199
      **********                                                          S01199
     C********** SCRNA     BEGSR                           ** SR  SCRNA **S01199
      **********                                                          S01199
      ***Continue*until*'HELP'*no*longer*requested*****                   S01199
      **********                                                          S01199
     C**********           EXFMTDL1600FA                                  S01199
      **********                                                          S01199
      ***If*'HELP'*requested,*call*MHELP*pgm*******                       S01199
      **********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ DL1600FA                 86               S01199
     C**********           END                                            S01199
      **********                                                          S01199
     C**********           ENDSR                                          S01199
      **********                                                          S01199
      ********************************************************************S01199
      *****************************************************************   S01199
      **********                                                      *   S01199
      ***HELP**SR.*****To call MHELP pgm & pass error codes           *   S01199
      **********                                                      *   S01199
      ***CALLED*FROM*:*SCRNA                                          *   S01199
      ***CALLS*******:*None.                                          *   S01199
      **********                                                      *   S01199
      *****************************************************************   S01199
      **********                                                          S01199
     C********** HELP      BEGSR                           ** SR  HELP  **S01199
      **********                                                          S01199
     C**********           MOVEL'DL1600'  HBPGM   6                       S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
      **********                                                          S01199
     C**********           ENDSR                                          S01199
      **********                                                          S01199
      ********************************************************************S01199
      *****************************************************************
      *                                                               *
      *  VALD01  SR.   To validate initial screen entries             *
      *                                                               *
      *  CALLED FROM : Main                                           *
      *  CALLS       : None.                                          *
      *                                                               *
      *****************************************************************
      *
     C           VALD01    BEGSR                           ** SR VALD01 **
      *
      **
      ** Reset all error indicators
      **
      *
     C                     MOVEA'00'      *IN,5
     C                     MOVEA'000'     *IN,10
     C                     MOVEA*BLANKS   ERCD
     C                     MOVE *BLANKS   SERCD1
     C                     MOVE *BLANKS   SERCD2
     C                     MOVE *BLANKS   TESTNO
     C                     MOVE '0'       HIGHZN
     C                     Z-ADD0         S       10
      *
      /COPY WNCPYSRC,DL1600CCP1                                           S01408
      **
      ** Test if entered Deal Number is numeric and not equal to
      ** Blanks, '000000' or '999999'.
      **
      *
     C                     MOVELSNEWDL    TESTNO                       T
     C                     TESTN          NOTEST     84
      *
     C           *IN84     IFEQ '0'
     C/COPY WNCPYSRC,DL1600C014
     C           SNEWDL    OREQ '000000'
     C           SNEWDL    OREQ '999999'
      *
     C                     ADD  1         S
     C                     MOVE ' 001'    ERCD,S
     C                     MOVELERRMSG,1  SERCD2
     C                     SETON                     050610
     C                     GOTO INVAL
      *
     C                     ELSE                                           S01119
1108 C*                                                                   S01119
      ** Validate deal number against reserved deal number range          S01119
      ** if DRS present for deal inserts only.                            S01119
1108 C*                                                                   S01119
     C********** MDRS      IFEQ 'Y'                        B1                          S01119 159271
     C********** SNEWAC    ANDEQ'I'                        B1                          S01119 159271
     C           SNEWAC    IFEQ 'I'                        B1                                 159271
     C                     MOVE SNEWDL    MDLNO   60       *1             S01119
     C           MDLNO     IFLT NORDLN                     B*2            S01119
     C                     ADD  1         S                **2            S01119
     C                     SETON                     100506**2            S01119
     C                     MOVE ' 001'    ERCD,S           **2            S01119
     C                     MOVELERRMSG,1  SERCD2           **2            S01119
     C                     GOTO INVAL                      **2            S01119
     C                     END                             E*2            S01119
     C                     END                             E1             S01119
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1600CCP4                                           S01408
     C*                                                                   S01408
      *
     C                     END
      *
      **
      ** Check Action Code is I,A,R or E.
      **
      *
     C           SNEWAC    IFNE 'I'
     C           SNEWAC    ANDNE'A'
     C           SNEWAC    ANDNE'R'
     C           SNEWAC    ANDNE'E'
     C/COPY WNCPYSRC,DL1600C008
      *
     C                     ADD  1         S
     C                     MOVE ' 002'    ERCD,S
     C                     MOVELERRMSG,2  SERCD2
     C                     SETON                     050611
     C                     GOTO INVAL
      *
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1600CCP5                                           S01408
     C*                                                                   S01408
      *
      **
      ** Action Code/Deal Number Cross Validation.
      **
      *
     C                     Z-ADD0         DLKEY   60
     C                     MOVELSNEWDL    DLKEY
     C***********DLKEY     CHAINDEALSCH              86                   076296
     C           DLKEY     CHAINDEALSALL             86                   076296
     C************IN86     IFEQ '1'                                E22518 042960
     C***********RECI      OREQ '*'                                E22518 042960
     C***********DLKEY     CHAINCADENQLL             86            E22518 042960
     C***********          END                                     E22518 042960
      *
      ** Deal already on file.
      *
      ** ( Action code = I )
     C           SNEWAC    IFEQ 'I'
      ** Chain does not fail, & RECI not = *
     C           *IN86     IFEQ '0'
     C           RECI      ANDNE'*'
      *
     C                     ADD  1         S
     C                     MOVE ' 003'    ERCD,S
     C                     MOVELERRMSG,3  SERCD2
     C                     SETON                     050610
     C                     SETON                     11
     C                     GOTO INVAL
      *
     C                     END
      *
      ** Deal not found.
      *
      ** ( Action code = A, R or E )
     C                     ELSE
      * If chain fails,
     C           *IN86     IFEQ '1'
      * Or chain succeeds but record indicator value is not D,M or R.
     C           *IN86     OREQ '0'
     C           RECI      ANDNE'D'
     C           RECI      ANDNE'M'
     C           RECI      ANDNE'R'
     C                     ADD  1         S
     C                     MOVE ' 004'    ERCD,S
     C                     MOVELERRMSG,4  SERCD2
     C                     SETON                     050610
     C                     SETON                     11
     C                     GOTO INVAL
      *
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1600CCP6                                           S01408
     C*                                                                   S01408
      *
      ** Requested Deal Not FRA/IRS.
      *
     C           DTYP      IFNE 'FR'
     C           DTYP      ANDNE'RS'
     C*******    DTYP      ANDNE'RL'                                      S01157
     C           DTYP      ANDNE'RP'                                      S01157
     C           DTYP      ANDNE'RR'                                      S01157
     C           DTYP      ANDNE'RF'                                      S01157
     C           DTYP      ANDNE'RX'
      *
     C                     ADD  1         S
     C                     MOVE ' 005'    ERCD,S
     C                     MOVELERRMSG,5  SERCD2
     C                     SETON                     050610
     C                     GOTO INVAL
      *
     C                     END
      **
      ** If API feature is on, only Caps, Floors or Collars may be        CAP003
      ** maintained using this function                                   CAP003
      *                                                                   CAP003
     C******     CAP003    IFEQ 'Y'                                 CAP003CAP010
     C           CAP123    IFEQ 'Y'                                       CAP010
     C           DTYP      ANDNE'RP'                                      CAP003
     C           DTYP      ANDNE'RR'                                      CAP003
     C           DTYP      ANDNE'RF'                                      CAP003
      *                                                                   CAP003
     C                     ADD  1         S                               CAP003
     C                     MOVE ' 020'    ERCD,S                          CAP003
     C                     MOVELERRMSG,9  SERCD2                          CAP003
     C                     SETON                     050610               CAP003
     C                     GOTO INVAL                                     CAP003
      *                                                                   CAP003
     C                     END                                            CAP003
      *                                                                   CAP003
     C                     END
      *
      ** Check for Reversed or Matured Deals if amending or reversing
      *
     C           SNEWAC    IFEQ 'A'
     C           SNEWAC    OREQ 'R'
     C/COPY WNCPYSRC,DL1600C009
      *  Matured deal
     C           RECI      IFEQ 'M'
      *
     C                     ADD  1         S
     C                     MOVE ' 006'    ERCD,S
     C                     MOVELERRMSG,6  SERCD2
     C                     SETON                     050610
     C                     SETON                     11
     C                     GOTO INVAL
      *
     C                     END
      *  Reversed deal
     C           RECI      IFEQ 'R'
      *
     C                     ADD  1         S
     C                     MOVE ' 007'    ERCD,S
     C                     MOVELERRMSG,7  SERCD2
     C                     SETON                     050610
     C                     SETON                     11
     C                     GOTO INVAL
      *
     C                     END
      **
     C                     END
      *
      /COPY WNCPYSRC,DL1600CCP2                                           S01408
      **
      ** Check Deal Type.
      **
      *
     C           SNEWAC    IFEQ 'I'
      ** ( Action code = I )
     C           SNEWDT    IFNE 'FR'
     C           SNEWDT    ANDNE'RS'
     C*********  SNEWDT    ANDNE'RL'                                      S01157
     C           SNEWDT    ANDNE'RP'                                      S01157
     C           SNEWDT    ANDNE'RR'                                      S01157
     C           SNEWDT    ANDNE'RF'                                      S01157
     C           SNEWDT    ANDNE'RX'
     C                     ADD  1         S
     C                     MOVE ' 008'    ERCD,S
     C                     MOVELERRMSG,8  SERCD2
     C                     SETON                     050612
     C                     GOTO INVAL
      *
     C                     END
      *                                                                   CAP003
      ** If API feature is on, only Caps, Floors or Collars may be        CAP003
      ** entered using this function                                      CAP003
      *                                                                   CAP003
     C******     CAP003    IFEQ 'Y'                                 CAP003CAP010
     C           CAP123    IFEQ 'Y'                                       CAP010
     C           SNEWDT    ANDNE'RP'                                      CAP003
     C           SNEWDT    ANDNE'RR'                                      CAP003
     C           SNEWDT    ANDNE'RF'                                      CAP003
      *                                                                   CAP003
     C                     ADD  1         S                               CAP003
     C                     MOVE ' 021'    ERCD,S                          CAP003
     C                     MOVELERRMSG,8  SERCD2                          CAP003
     C                     SETON                     050612               CAP003
     C                     GOTO INVAL                                     CAP003
      *                                                                   CAP003
     C                     END                                            CAP003
      *
     C                     ELSE
      ** ( Action code = A, R or E )
     C           SNEWDT    IFNE DTYP
     C           SNEWDT    ANDNE*BLANKS
      *
     C                     ADD  1         S
     C                     MOVE ' 009'    ERCD,S
     C                     MOVELERRMSG,9  SERCD2
     C                     SETON                     050612
     C                     GOTO INVAL
      *
     C                     END
     C/COPY WNCPYSRC,DL1600C010
      **
     C                     END
      **
     C* IF MULTIBRANCHING ON, PERFORM USER/DEAL BOOKING BRANCH            S01117
     C* VALIDATION (ACTION CODES A, R, E ONLY)                            S01117
     C*                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C           SNEWAC    ANDNE'I'                                       S01117
     C/COPY WNCPYSRC,DL1600C015
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SNEWAC    ZACTN   1                       S01117
     C                     PARM BRCA      ZBR     3                       S01117
     C                     PARM           @ERR    10                      S01117
      *                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 403'    ERCD,S                          S01117
     C                     MOVELERRMSG,11 SERCD2                          S01117
     C                     SETON                     050611               S01117
     C                     SETON                     10                   S01117
     C                     GOTO INVAL                                     S01117
     C                     END                                            S01117
      *                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 404'    ERCD,S                          S01117
     C                     MOVELERRMSG,12 SERCD2                          S01117
     C                     SETON                     050611               S01117
     C                     SETON                     10                   S01117
     C                     GOTO INVAL                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF ORIGINATING BRANCH USER VALIDATION REQUIRED, CHECK AUTHORITY   S01117
     C* TO ORIGINATING BRANCH ON SELECTED DEAL                            S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                                       S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      @ORBR   3                       S01117
     C                     PARM           WERR    10                      S01117
     C*                                                                   S01117
     C           WERR      IFEQ 1                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 401'    ERCD,S                          S01117
     C                     MOVELERRMSG,13 SERCD2                          S01117
     C                     SETON                     050610               S01117
     C                     GOTO INVAL                                     S01117
     C                     END                                            S01117
      *                                                                   S01117
     C           WERR      IFEQ 2                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 402'    ERCD,S                          S01117
     C                     MOVELERRMSG,14 SERCD2                          S01117
     C                     SETON                     0506                 S01117
     C                     GOTO INVAL                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  IF NOT MULTIBRANCHED, CHECK USER AUTHORISED TO ACTION CODE       S01117
     C*                                                                   S01117
     C           BGMBIN    IFNE 'Y'
     C*                                                                   S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SNEWAC    ZACTN   1                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 408'    ERCD,S                          S01117
     C                     MOVELERRMSG,15 SERCD2                          S01117
     C                     SETON                     050611               S01117
     C                     GOTO INVAL                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,DL1600C011
     C           INVAL     TAG                             ** TAG INVAL **
      **
     C                     ENDSR
      *
      ********************************************************************
      *************************************************************S01119 S01194
      **********                                                   S01119 S01194
      ***DBERR**SR.    To update LDA with database error informatioS01119 S01194
      **********       & exit program                              S01119 S01194
      *************************************************************S01119 S01194
      **********                                                   S01119 S01194
     C********** DBERR     BEGSR                           ***  DBES01119 S01194
      **********                                                   S01119 S01194
     C**********           MOVE 'DL1600  'DBPGM              S01119S01157 S01194
     C**********           MOVEL'DL1600  'DBPGM              S01119S01157 S01194
     C**********           OUT  LDA                                S01119 S01194
     C**********           SETON                     U7U8LR        S01119 S01194
     C**********           RETRN                                   S01119 S01194
      **********                                                   S01119 S01194
     C**********           ENDSR                                   S01119 S01194
      *************************************************************S01119 S01194
      /SPACE 4                                                            S01194
      *****************************************************************   S01194
      *                                                               *   S01194
      *  *PSSR SR.     To exit program upon database error            *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
      *                                                                   S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     MOVEL'DL1600'  DBPGM                           S01194
     C           *NAMVAR   DEFN LDA       @LDA  256                       S01194
     C           *LOCK     IN   @LDA                                      S01194
     C                     MOVE DBERR     @LDA                            S01194
     C                     OUT  @LDA                                      S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     RETRN                                          S01194
     C                     ENDSR                                          S01194
      *****************************************************************   S01194
      /EJECT
      *****************************************************************
      *                                                               *
      *          THIS SUBROUTINE MUST NEVER BE EXECUTED               *
      *                                                               *
      *  DUMMY  SR.    To make program compile with files opened      *
      *                at this control level for all operations       *
      *                that will occur at lower levels                *
      *                                                               *
      *  CALLED FROM : Main                                           *
      *  CALLS       : None.                                          *
      *                                                               *
      *****************************************************************
      *
     C           DUMMY     BEGSR                           ** SR  DUMMY **
      **
     C******************** READ TABDLI                   85               S01194
     C******************** READ SNAME                    85               S01194
     C******************** READ CLINT                    85               S01194
     C                     READ ACCNT                    85
     C                     READ ACNUM                    85
     C                     READ DEALS                    85
     C                     READ DTRIXHH                  85
     C                     READ MEMOS                    85
     C                     READ OLPOS                    85
     C                     READ PRONO                    85
     C                     UPDATDEALSDFF
     C                     UPDATDTRIXHF
     C                     UPDATMEMOSMDF
     C                     UPDATOLPOSOAF
     C                     UPDATPRONOPNF
     C                     WRITEPFDEALSF
     C                     WRITEDTRIXDF
     C/COPY WNCPYSRC,DL1600C012
      **
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
     C/COPY WNCPYSRC,DL1600C017
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**    ERRMSG - Array of Error Messages.    **
 MISSING OR INVALID DEAL NUMBER
 ACTION CODE INVALID
 DEAL ALREADY ON FILE
 DEAL NOT FOUND
 REQUESTED DEAL NOT FRA/IRS
 MATURED DEAL
 REVERSED DEAL
 INVALID DEAL TYPE
 INVALID DEAL TYPE FOR REQUESTED DEAL
 **** FRA/IRS **** FUNCTION NOT SET UP ************* JOB CANCELED ********
 USER IS NOT AUTHORISED TO ANY ACTION CODES FOR THIS MENU ITEM AND BRANCH
 USER IS NOT AUTHORISED TO THE ACTION CODE FOR THIS MENU ITEM AND BRANCH
 USER IS NOT AUTHORISED TO ANY ORIGINATING BRANCHES
 USER IS NOT AUTHORISED TO THE ORIGINATING BRANCH
 USER IS NOT AUTHORISED TO THE ACTION CODE FOR THIS MENU ITEM
     X/COPY WNCPYSRC,DL1600X001
