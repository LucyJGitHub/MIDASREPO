     H        1                                                           S01157
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA/IRS maintenance RP/RR/RF insert')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FRA/IRS Module                                       *
     F*                                                               *
     F*  DL1604I  FRA/IRS DEALS MAINTENANCE PROGRAM - 'RL' DEAL TYPE  *
     F*           INTEREST RATE CAPS/COLLARS                          *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CGL184             Date 07Dec16               *
      *  Prev Amend No. CGL165             Date 17Mar15               *
      *                 AR814519           Date 12Mar15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CIR017             Date 10Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 08Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 09May05               *
      *                 CAS011             Date 16May05               *
      *                 CAS009             Date 16May05               *
      *                 CAS008             Date 16Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA101             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CDE005             Date 19Aug03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CRE009             Date 03Sep02               *
      *                 127972             Date 13Oct97               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 186676             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP041             Date 07Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 185896             Date 30Jan01               *
      *                 186458             Date 01Dec00               *
      *                 CIR003             Date 12Sep00               *
      *                 CIR006             Date 21Aug00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 179380             Date 28Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      *                 CIR004             Date 20Jan00               *
      *                 CDE001             Date 30Mar00               *
      *                 176510             Date 21Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSE006             Date 06Mar00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             Date 01MAR99               *
     F*                 134935             Date 10May98               *
     F*                 CEU003             Date 10Jan98               *
     F*                 121768             DATE 20FEB98               *
     F*                 127424             DATE 18FEB98               *
     F*                 126017             DATE 17Nov97               *
     F*                 108190             Date 20Sep96               *
     F*                 108624             Date 24Oct96               *
     F*                 111044             DATE 19FEB97               *
     F*                 097885             DATE 31JAN97               *
     F*                 CCB002             DATE 25AUG96               *
     F*                 S01408             DATE 04OCT96               *
     F*                 S01408             DATE 30SEP96               *
     F*                 S01408             DATE 02SEP96               *
     F*                 CSW096             DATE 03SEP96               *
     F*                 S01408             DATE 11JUN96               *
     F*                 S01408             DATE 01APR96               *
     F*                 S01408             DATE 17JAN96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 S01408             DATE 10NOV95               *
     F*                 046958             DATE 11OCT95               *
     F*                 047250             DATE 11OCT95               *
     F*                 S01408             DATE 10APR95               *
     F*                 CIR001             DATE 13JUN95               *
     F*                 S01408             DATE 13MAR95               *
     F*                 072953             DATE 25OCT94               *
     F*                 064773             DATE 28FEB94               *
     F*                 066550             DATE 04FEB94               *
     F*                 S01408             DATE 20JAN94               *
     F*                 042757             DATE 13JAN94               *
     F*                 046303             DATE 06JAN94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 039457             DATE 17NOV93               *
     F*                 046963             DATE 14OCT93               *
     F*                 046961             DATE 14OCT93               *
     F*                 028574             DATE 14OCT93               *
     F*                 053570             DATE 18AUG93               *
     F*                 047256             DATE 08JUN93               *
     F*                 S01412             DATE 07MAY93               *
     F*                 046960             DATE 25MAR93               *
     F*                 E38323             DATE 30JUL92               *
     F*                 E26553             DATE 27JAN92               *
     F*                 E30325             DATE 22JAN92               *
     F*                 E31717             DATE 22JAN92               *
     F*                 E32190             DATE 13JAN92               *
     F*                 DT0169             DATE 17MAY91               *
     F*                 S01328             DATE 16APR91               *
     F*                 E20928             DATE 12NOV90               *
     F*                 E23018             DATE 08NOV90               *
     F*                 E23407             DATE 19SEP90               *
     F*                 E22134             DATE 06JUL90               *
     F*                 E21041             DATE 03JUL90               *
     F*                 E20918             DATE 05FEB90               *
     F*                 S01117             DATE 27NOV89               *
     F*                 S01194             DATE 27NOV89               *
     F*                 S01195             DATE 27NOV89               *
     F*                 S01199             DATE 27NOV89               *
     F*                 S01203             DATE 04/04/89              *
     F*                 S01157             DATE 11/01/89              *
     F*                 S01154             DATE 16/08/88              *
     F*                 E13163             DATE 23/05/88              *
     F*                 E11505             DATE 23/03/88              *
     F*                 S01119             DATE 14/07/87              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  AR814519 - Allow negative base rate. Applied for MD033488.   *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CIR017 - SIRS Business Day Conventions for both Legs         *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *           No amendment required - API version is used.        *
      *  CAS011 - EIR/AC Accounting Upgrade to MP1                    *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA101 - After and Before image data structure (Z#AST        *
      *           and Z#BST) used in program is short FRA/IRS         *
      *           transaction.  (Recompile)                           *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CDE005 - Data Export - Reservation ID                        *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CRE009 - Projected Account Movements for Retail Accounts     *
      *  127972 - Array Index is not valid.                           *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  186676 - Add new validation for deal type/subtype            *
      *           combination.                                        *
      *  CAP041 - APIs for IRS Fees/Buy-Outs/Processing Method/Next   *
      *           Principal Change Date.                              *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  185896 - Check if interest payment date is greater than      *
      *           maturity date if maturity date is a holiday.        *
      *  186458 - Display Confirmation Matching status.               *
      *           - Recompile only.                                   *
      *  CIR003 - Principal Exchange on Cross Currencies IRS          *
      *  CIR006 - FRA/IRS Amortisation of Caps/Collars/Floors &       *
      *           Individual Compounding Swaps.                       *
      *         - Amortisation of Caps/Collars/Floors only            *
      *  179380 - Confirmation matching status for deal types 'FR'    *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR005 - FRA/IRS Business Day Conventions.                   *
      *  CIR004 - Dealing Calculation Method Change                   *
     F*  CDE001 - Data Export - CCRM Limits                           *
     F*  176510 - Only allocate profit centre from matrix after       *
     F*           customer has been validated (Fix 171062) AND if     *
     F*           Book Code is valid.                                 *
     F*  CSE006 - Repurchase Agreements (REPOS) enhancement:          *
     F*           Rename work field TRTP due to clash with field      *
     F*           added to DEALSDC.                                   *
     F*  CPL002 - Midas-Plato Interface
     F*           Recompile only for new fields on PF/DEALSDG.        *
     F*  134935 - Settlement currency not shown/amendable if          *
     F*           transition starts after value date.                 *
     F*  CEU003 - EMU Dealing Settlement Ccy Conversion               *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  127424 - Do not allow to insert an RP deal without Premium   *
     F*           value date if Premium amout is inserted and         *
     F*           vice versa .                                        *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  108190 - Avoid dual usage of error messages W23 + W24.       *
     F*  108624 - Amended to allow the use of different currency      *
     F*           codes as a basis for the 'rate fix date'            *
     F*           calculation. (Providing this feature has been       *
     F*           switched on, on the FRA/IRS's I.C.D.                *
     F*  111044 - Deal Entered Time and Base Rate Code for Sequencing *
     F*           are not setup correctly.                            *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  CCB002 - COB Performance Enhancements                        *
     F*           Access now via access object                        *
     F*           MEMOS is now accessed via GL/RE key rather than old *
     F*           relative record number.                             *
     F*  S01408 - Addition of Core hook DL1604IIP5                    *
     F*           Addition of Core hook DL1604IIP4                    *
     F*           Addition of Core hook DL1604IIP3                    *
     F*           Addition of Core hook DL1604IIP2                    *
     F*           Addition of Core hook DL1604IEP1                    *
     F*           Addition of Core hook DL1604IC37
     F*           Addition of Core hook DL1604IC36
     F*           Addition of Core hook DL1604IC35
     F*           Addition of Core hook DL1604IC34
     F*           Addition of Core hook DL1604IC33
     F*           Addition of Core hook DL1604IC32
     F*           Addition of Core hook DL1604IC31
     F*           Addition of Core hook DL1604IC30
     F*           Addition of Core hook DL1604IC29
     F*           Addition of Core hook DL1604IC28
     F*           Addition of Core hook DL1604IC27
     F*           Addition of Core hook DL1604IC26
     F*           Addition of Core hook DL1604IC25
     F*           Addition of Core hook DL1604IC24
     F*  S01408 - Core hook DL1604IC23 added                          *
     F*         - Core hook DL1604IC22 added                          *
     F*         - Core hook DL1604IC21 added                          *
     F*         - Core hook DL1604IC20 added                          *
     F*         - Core hook DL1604IC19 added                          *
     F*         - Core hook DL1604IC18 added                          *
     F*         - Core hook DL1604IC17 added                          *
     F*         - Core hook DL1604IC16 added                          *
     F*  S01408 - Core hook DL1604IC15 added                          *
     F*  CSW096 - Swift Changes 1996:                                 *
     F*           Add validation for field 72.                        *
     F*  S01408 - Core hook DL1604IC14 added                          *
     F*         - Core hook DL1604IC13 added                          *
     F*  S01408 - Core hook DL1604IC11 added                          *
     F*         - Core hook DL1604IC12 added                          *
     F*  S01408 - Core hook DL1604IIP1 added                          *
     F*         - Core hook DL1604ICP8 added                          *
     F*         - Core hook DL1604ICP9 added                          *
     F*         - Core hook DL1604IC10 added                          *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  S01408 - Core hook DL1604ICP6 added                          *
     F*         - Core hook DL1604ICP7 added                          *
     F*  046958 - IRS MODULE - INPUT VALIDATION.  SYSTEM SHOULD       *
     F*           DISPLAYS WARNING IF MATURITY DATE IS A HOLIDAY      *
     F*           ON LOCAL CCY OR DEALING CCY.                        *
     F*  047250 - IRS MODULE - INPUT VALIDATION.  SYSTEM SHOULD       *
     F*           DISPLAYS WARNING IF RATE CHANGE DATE IS A HOLIDAY   *
     F*           ON LOCAL CCY OR DEALING CCY.                        *
     F*  S01408 - Core hook DL1604IIPG added                          *
     F*         - Core hook DL1604ICP5 added                          *
     F*         - Core hook DL1604IVSF added                          *
     F*         - Core hook DL1604IVS1 added                          *
     F*         - Core hook DL1604IVS2 added                          *
     F*         - Core hook DL1604IVS3 added                          *
     F*         - Core hook DL1604IVS4 added                          *
     F*  CIR001 - Interest Rate Calendars.                            *
     F*           Hook DL1600GDTA renamed to refer to QWINDSRC.       *
     F*  S01408 - Core hook DL1600GDTA added                          *
     F*         - Core hook DL1604ICPG added                          *
     F*         - Core hook DL1604ICP1 added                          *
     F*         - Core hook DL1604ICP2 added                          *
     F*         - Core hook DL1604ICP3 added                          *
     F*         - Core hook DL1604ICP4 added                          *
     F*         - Core hook DL1604IWIN added                          *
     F*  072953 - FRA/IRS module can input and amend deals with a     *
     F*           settlement other than 00 and not require a nostro   *
     F*           code                                                *
     F*  064773 - CONDITION CALL TO AORETLR0 ON RETAIL BEING PRESENT. *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  S01408 - Core hook DL1604IFPG added                          *
     F*         - Core hook DL1604IEXV added                          *
     F*  042757 - Projected Nostro account movement value dated on    *
     F*           a non-working day should be reflected on the next   *
     F*           working day (and not on the previous working day).  *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  039457 - If '/BEN//SC' is entered on leftmost of Special     *
     F*           Instructions field, it must be followed by six (6)  *
     F*           digits and then blanks.                             *
     F*           (Added a 7th element to ERRMSG array.)              *
     F*  046963 - Validation of counterparty rec bank incorrect       *
     F*  046961 - Validation of linked reference incorrect            *
     F*  028574 - The screen field for RATE CHANGE DAY is being       *
     F*           moved into the file field. This should be changed   *
     F*           to the work field (TICFDX) being moved into the     *
     F*           file field.                                         *
     F*  053570 - IRS : accepts zero spread but then rejects on       *
     F*           amendment.                                          *
     F*  047256 - Change the conditioning of output of error codes    *
     F*           from INT. PAYMENT DATE < VALUE DATE to INT. PAY-    *
     F*           MENT DATE <= VALUE DATE.                            *
     F*  S01412 - SWIFT September 1993 changes - validation           *
     F*           of the format of the special instructions           *
     F*           field.                                              *
     F*  046960 - Parent indicator being checked for Y instead of P   *
     F*  E38323 - Recompilation of the program done due to a          *
     F*           change in copy source ZFWDT subroutine              *
     F*  E26553 - Can now enter a Counterparty Shortname for          *
     F*           Settlement Method 08 and 01 but not 07; (this is    *
     F*           because SWIFT address now exists on SDCNSTPD).      *
     F*  E30325 - If deal forward-valued AND Short Term Rate NOT      *
     F*           entered then the Next Rate Fix Date must be that    *
     F*           associated with the Value Date.  Else the Next      *
     F*           Rate Fix Date must be that associated with the      *
     F*           Next Rate Change Date.                              *
     F*  E31717 - No accounting is processed at Value Date for        *
     F*           IRS, therefore, no need to check Date Account       *
     F*           Opened against Value Date.                          *
     F*  E32190 - Rate Fix Days not defaulting to 0 or 2 (if left     *
     F*           blank) before validating Short Term Rate.           *
     F*  DT0169 - Should accept blanks as well as NIL for zero        *
     F*           Brokerage                                           *
     F*  S01328 - FRA/IRS Revaluations - new fields UNRL/UNRLP        *
     F*           (Unrealised P/L and Unrealised P/L Posted) -        *
     F*           added to DEALSDG. Initialise both fields to zero    *
     F*           at deal input.                                      *
     F*  E20928 - Update account movements file RSACMTPD when         *
     F*           settled through a retail a/c as well as when        *
     F*           settled through a nostro.                           *
     F*  E23018 - Incorrect fields are used in MOPSR subroutine :-    *
     F*           replace UNIPDX with @UNIPDX                         *
     F*           replace BYSL with SBYSL                             *
     F*         - Fields XFLRAT and XCLRAT are not set up if          *
     F*           MOPSR is called from UMEMOS.                        *
     F*  E23407 - Check for modules RE(RETAIL 2) or IA(INTEREST ON    *
     F*           ACCOUNTS), rather than RT(RETAIL 1).                *
     F*  E22134 - The screen field for INTEREST CHANGE DAY is         *
     F*           being moved into the file field. This should be     *
     F*           changed to the work field (TICFDX) being moved      *
     F*           into the file field.                                *
     F*  E21041 - Additional conditioning in warning error SR         *
     F*           VALD12, checks rate change date before              *
     F*           defaulting to maturity date.                        *
     F*  E20918 - S01157 causes ZIRATE not being set up for           *
     F*           interest calculation in subroutine MOPSR.           *
     F*           Therefore the output from subroutine GLINTC is      *
     F*           always zero.  It should only update RSACMTPO in     *
     F*           subroutine MOPSR when it is settling through        *
     F*           NOSTRO.                                             *
     F*  S01117 - MULTI-BRANCHING CHANGES.                            *
     F*  S01194 - NEW STANDING DATA CHANGES.                          *
     F*  S01195 - HOLIDAYS PROCESSING.                                *
     F*  S01199 - ABS HELP SYSTEM. (THIS FIX WAS APPLIED TO THIS      *
     F*           PROGRAM FOR R10 AT THE SAME TIME AS IT WAS          *
     F*           APPLIED TO ANOTHER VERSION FOR R2 - THEREFORE       *
     F*           THEY MAY NOT BE INDENTICAL CHANGES)                 *
     F*  S01203 - INCORPORATION CHANGES                               *
     F*  S01157 - 1.VALD BOOK CODE ,REMOVE SHEDIN & SUNII             *
     F*           2.GENERATE NEW FIELDS                               *
     F*           3.CALL DL1911                                       *
     F*           4.ALLOW FLOORS                                      *
     F*           5.REPLACE OUR/THEIR DETAILS WITH REF DETAILS        *
     F*           6.CHANGE RL TO RF/RR/RP                             *
     F*           7.MDAT CANNOT = VDAT                                *
     F*  S01154 - To output a copy of all Retail and Nostro           *
     F*           changes to a new shadow postings file RSACMTPD.     *
     F*  E13163 - CONDITION USE OF MEMOS AND ACNUM ON RETAIL.         *
     F*  E11505 - SOME OF PROCESSING FOR E/C '068' CHECKS IF          *
     F*           ACCOUNT IS ON ACCNT WHICH DOES NOT CORRESPOND       *
     F*           WITH HELP MESSAGE FOR E/C '068'.                    *
     F*  S01119 - FRA/IRS INCORPORATION (REMOVE FILLER RENAMES)       *
     F*                                                               *
     F*****************************************************************
     F*OOKD***IF**E*******    K        DISK                        S01157 S01194
     F*LINT***IF**E*******    K        DISK                               S01194
     F**********  CLINTCAF                          KIGNORE               S01194
     F**********  CLINTCCF                          KIGNORE               S01194
     F**********  CLINTC1F                          KIGNORE               S01194
     F*NAME***IF**E           K        DISK                               S01194
     F**********  CLINTCBF                          KRENAMESNAMECBF       S01194
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F*CNUM***IF**E           K        DISK                               E13163
     FACNUM   IF  E           K        DISK                           U1  E13163
     F            ACCNTABF                          KRENAMEACNUMABF
     F/COPY WNCPYSRC,DL1604IF01
     FDTRIXHH UF  E                    DISK
     F                                              KCOMIT
     F/COPY WNCPYSRC,DL1604IF02
     F*EMOS***UF**E                    DISK                               E13163
     F*MEMOS**UF**E                    DISK                         E13163CCB002
     F************                                  KCOMIT                CCB002
     FOLPOS   UF  E           K        DISK
     F            OLPOSHHF                          KIGNORE
     F            OLPOSOBF                          KIGNORE
     F                                              KCOMIT
     FPRONO   UF  E           K        DISK
     F            PRONOHHF                          KIGNORE
     F                                              KCOMIT
     FDEALSDG O   E                    DISK
     F            DEALSDGF                          KRENAMEPFDEALSF
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     F/COPY WNCPYSRC,DL1604IF03
     FDTRIXDD O   E                    DISK
     F                                              KCOMIT
     F/COPY WNCPYSRC,DL1604IF04
     F*ABDLI**IF**E********** K        DISK                               S01194
     F**********  TABTE10F                          KIGNORE               S01194
     F**********  TABTE20F                          KIGNORE               S01194
     F**********  TABTG20F                          KIGNORE               S01194
     F**********  TABLETSF                          KIGNORE               S01194
     FDEALS   UF  E           K        DISK
     F                                              KCOMIT
     FDL1600DFCF  E                    WORKSTN
     F            DL1600FB                          KIGNORE
     F            DL1600FC                          KIGNORE
     F            DL1600FD                          KIGNORE
     F            DL1600FE                          KIGNORE
     F            DL1600FF                          KIGNORE
     F            DL1600FG                          KIGNORE
     F            DL1600FH                          KIGNORE
     F            DL1600FI                          KIGNORE
     F            DL1600FJ                          KIGNORE
     F            DL1600FK                          KIGNORE
     F            DL1600FL                          KIGNORE
     F            DL1600FM                          KIGNORE
     F            DL1600FN                          KIGNORE
     F            DL1600FO                          KIGNORE
     F            DL1600FP                          KIGNORE
     F            DL1600FS                          KIGNORE
     F            DL1600FT                          KIGNORE
     F            DL1600FU                          KIGNORE
     F            DL1600FV                          KIGNORE
     F*
     FRSACMTPDO   E                    DISK                               S01154
     F                                              KCOMIT                S01154
     FFDDTSTL1IF  E           K        DISK         KINFSR *PSSR          186676
      *
     F* /COPY MEMBER DL1604IFPG                                           S01408
     F/COPY WNCPYSRC,DL1604IFPG                                           S01408
      *
      /EJECT
      * ID  F  C  H  L    FUNCTION OF INDICATORS
      *
      **  NB.  THE FUNCTION OF AN INDICATOR SHOULD NOT BE CHANGED
      **  BETWEEN THE PROGRAMS IN THIS SUITE
      ** i.e. BETWEEN DL1600 / DL1601 / DL1602 / DL1603 / DL1604 (I,A,R,E)
      *
      *                 SCREEN RESPONSE INDICATORS:
      *
      *****01********** HELP INDICATOR                                    S01199
      *    02           ROLLUP INDICATOR
      *    03           ROLLDOWN INDICATOR
      *       04
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *
      *       05        DISPLAY 1ST ERROR CODE FIELD
      *       06        DISPLAY 2ND ERROR CODE/MESSAGE FIELD
      *
      *       07        WARNING ERRORS EXIST
      *       08        RECORD UPDATED BY ANOTHER WORKSTATION
      *
      *       09        NON DISPLAY 'FLOOR RATE' LABEL & FIELD
      *
      *                 FIELD IN ERROR
      *
      *       10        NEW DEAL NO.
      *       11        NEW ACTION CODE
      *           OR    PROFIT CENTRE USED FLAG (Y/N)                     S01117
      *       12        NEW DEAL TYPE
      *       13        DEAL SUB-TYPE
      *       14        DEAL DATE
      ********15********BRANCH CODE                                       S01117
      *       15        BOOKING BRANCH CODE                               S01117
      *       16        BROKER CODE
      *       17        BROKERAGE AMOUNT
      *       18        LINKED DEAL NO.
      *       19        CUSTOMER NO.
      *       20        VALUE DATE
      *       21        MATURITY DATE
      *       22        CUST. DEAL. ACC. SEQ. NO.
      *       23        (OUR) CURRENCY
      *       24        (OUR) PRINCIPAL AMOUNT
      *       25        (OUR) FED FUNDS IND.
      *       26        OUR BASE CURRENCY EXCHANGE RATE
      *       27        (OUR) CALC. METHOD
      *       28        HEDGE IND.
      *           OR    BOOK CODE                                         176510
      *       29        TAXABLE IND.
      *       30        (OUR) NEGATIVE INTEREST IND.
      *       31        OUR FLOATING RATE FIX DAYS
      *       32        OUR BASE RATE TYPE
      *       33        OUR SPREAD/RATE
      *       34        OUR SPREAD IND.
      *       35        THEIR BASE RATE TYPE
      *       36        THEIR SPREAD/RATE
      *       37        THEIR SPREAD IND.
      *       38        RECEIPT SETTLEMENT METHOD
      *       39        PAYMENT SETTLEMENT METHOD
      *       40        OUR RECEIVING ACCOUNT
      *           AND   RECEIVE SETTLEMENT BRANCH                         S01117
      *       41        OUR PAYMENT ACCOUNT
      *           AND   PAY SETTLEMENT BRANCH                             S01117
      *       42        COUNTERPARTY PAYING BANK
      *       43        COUNTERPARTY RECEIVING BANK
      *       44        FOR ACCOUNT OF
      *       45        SPECIAL INSTRUCTIONS
      ********46********THEIR NEGATIVE INTEREST IND.                      S01117
      *       46        ORIGINATING BRANCH                                S01117
      ********47**      OUR NEXT INTEREST RATE CHANGE DATE                CEU003
      *       47        Error on settlement currency                      CEU003
      *       48        OUR INTEREST RATE CHANGE FREQUENCY
      *       49        OUR INTEREST RATE CHANGE DAY IN MONTH
      *       50        OUR SHORT TERM RATE ( OUR EFFECTIVE INT. RATE )
      *       51        OUR INTEREST PAYMENT DATE
      *       52        OUR INTEREST PAYMENT FREQUENCY
      *       53        OUR INTEREST PAYMENT FREQUENCY DAY IN MONTH
      *       54        OUR FLOOR RATE ENTERED IND
      *       55        THEIR BASE CURRENCY EXCHANGE RATE
      *       56        THEIR INTEREST CALC. BASIS
      *       57        THEIR FLOATING RATE FIX DAYS
      *       58        THEIR NEXT INTEREST RATE CHANGE DATE
      *       59        THEIR INTEREST RATE CHANGE FREQUENCY
      *       60        THEIR INTEREST RATE CHANGE DAY IN MONTH
      *       61        THEIR SHORT TERM RATE (THEIR EFFECT. INT. RATE)
      *       62        THEIR INTEREST PAYMENT DATE
      *       63        THEIR INTEREST PAYMENT FREQUENCY
      *       64        THEIR INTEREST PAYMENT DAY IN MONTH
      *       65        THEIR CURRENCY
      *       66        THEIR PRINCIPAL AMOUNT
      *       67        CEILING RATE
      *       68        FLOOR RATE
      *       69        AVERAGE RATE METHOD
      ********70**      THEIR FED. FUNDS IND.                             CEU003
      *       70        Error on 'In' currency in field 72                CEU003
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *                 PROTECT FIELD FOR AMEND
      *     ( NB THESE INDICATORS ARE UNIQUE FOR THIS PGM )
      *
      ********71**      PROTECT OUR RATE FIX DAYS                         CEU003
      *       71        'In' currency in field 72 is not displayed.       CEU003
      *       72        PROTECT THEIR RATE FIX DAYS
      ********73**      PROTECT SWORK1 (OUR SHORT TERM/CURRENT RATE)      CEU003
      *       73        Settlement currency is not displayed.             CEU003
      *       74        PROTECT SWORK2 (THEIR SHORT TERM/CURRENT RATE)
      *       75        PROTECT ALL FIELDS THAT CANNOT BE AMENDED,
      *                 ( EXCEPT THOSE MENTIONED *IN 71-74 & 77-82: )
      *       76        PROTECT OUR RATE CHANGE DATE / FREQ / DAY
      *                         OUR INTEREST PAYMENT DATE / FREQ / DAY
      *       77        PROTECT THEIR RATE CHANGE DATE / FREQ / DAY
      *                         THEIR INTEREST PAYMENT DATE / FRQ / DAY
      *       78        PROTECT HEDGE / TAXABLE IND
      *       79        PROTECT OUR SPREAD - RATE
      *       80        PROTECT OUR BASE RATE CODE / OUR SPREAD IND
      *       81        PROTECT THEIR SPREAD - RATE
      *       82        PROTECT THEIR BASE RATE CODE / THEIR SPREAD IND
      *
      *       83        SYSTEM IS MULTIBRANCH DEALING
      *       84        WORK - TESTING NUMERIC ( ON = ALL NUMERIC )
      *       85        WORK - (SEE COMMENTS IN CODE FOR SPECIFIC USE)
      ********86********NON-TABLE FILE CHAIN FAIL                         S01194
      *       86        FILE CHAIN FAIL                                   S01194
      ********87********SYSTEM IS MULTIBRANCH ACCOUNTING                  S01117
      *       87        ORIGINATING BRANCH USED FLAG (Y/N)                S01117
      *       88        RETAIL ACCOUNT NUMBERS USED IN SYSTEM
      *       88        Special Instruction line validation               S01412
      ********89********RETAIL MODULE PRESENT IN SYSTEM                   S01194
      *       89                                                          S01194
      *
      *     90-99       USED IN STANDARD MIDAS SUB-ROUTINES.
      *
      ********98********ZSYSTM, DATE FORMAT MMDDYY IF ON, DDMMYY IF OFF   S01194
      *       98        DATE FORMAT MMDDYY IF ON, DDMMYY IF OFF           S01194
      ********99********TABLE CHAIN FAIL - RECORD NOT FOUND               S01194
      *       99        USED IN ZDATE2                                    S01194
      *
      *       U1        RETAIL MODULE ON, USE ACNUM FILE                  E13163
      *       U2        RETAIL MODULE ON, USE MEMOS FILE                  E13163
      *     U7+U8     DATABASE ERROR
      *
     E                    CPY@    1   1 80
     E                    ERCD       40  4
      *  Error codes
     E                    WRCD       20  4
      *  Warning error codes
     E********************ERRMSG  1   6 76                                039457
     E/COPY WNCPYSRC,DL1604IE01
     E                    ERRMSG  1   7 76                                039457
     E/COPY WNCPYSRC,DL1604IE02
      *  Warning/Error messages
      *  ( & Screen labels for 'Short term rate' / 'Current average' )
     E                    ZZZ        14  1
      *  Dlscon - store amount with decimal
     E                    ZZQ        13  1 0
      *  Dlscon - store amount as it is
     E                    ZA1        16  1
      *  Zalign input
     E                    ZA2        16  1
      *  Zalign output
     E                    ZYDY    4   4  4 0
      *  Zdate1/2 array
     E                    ZMDY   13  13  3 0
      *  Zdate1/2 array
     E                    ZMNM   12  12  3
      *  Zdate2 array                                                     S01195
     E                    ZHC        50  3                                S01195
      ***Zdate5*array***                                                  S01195
     E                    ZFMD   12  12  2                             Y  S01195
      ***ZfreqB*array*******                                              S01195
      *  @freqB array                                                     S01195
     E                    PBAL        5 15 0
     E                    PPAY        5 15 0
     E                    PREC        5 15 0
      *  Projected nostros Balances
     E                    PDAT        5  5 0A
      *  Projected nostros Dates
     E                    OBLI       16 15 0
      *  On line position Incoming Balances
     E                    OBLO       16 15 0
      *  On line position Outgoing Balances
     E                    ODAT       16  5 0A
      *  On line position Dates
     E*                                                                   S01195
     E                    UPA    27  27  1                                S01412
      ** Valid codeword characters                                        S01412
      *                                                                   S01412
     E                    UPAN   37  37  1                                                    CSW201
      ** Valid codeword characters (alphanumeric)                                             CSW201
      *                                                                                       CSW201
     E                    SWCH   47  47  1                                S01412
      ** Valid SWIFT ISO characters                                       S01412
      *                                                                   S01412
     E                    SIL        35  1                                S01412
      ** Special instruction line                                         S01412
      *                                                                   S01412
      *                                                                   CIR005
      ** Holiday Currency Array                                           CIR005
      *                                                                   CIR005
     E                    HOL        10  4                                CIR005
     E*
     E/COPY WNCPYSRC,DL1604IEP1
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E*                                                                   S01195
     I*
      **  Rename spare 'filler' fields to avoid fields with the same
      **  names being defined with different lengths.
      *
     IDEALSDCF
     I***           ZZ0375                          ZZ010A                S01119
      *
     IDEALSDDF
     I***           ZZ0063                          ZZ008A                S01119
     I***           ZZ0375                          ZZ016A                S01119
      *
     IDEALSDEF
     I***           ZZ0063                          ZZ014A                S01119
     I***           ZZ0375                          ZZ016A                S01119
      *
     I*TABTB20F***********                                                S01194
     I***           ZZ0081                          ZZ009A                S01119
      *
     I*TABLETKF***********                                                S01194
     I***           ZZ0063                          ZZ027A                S01119
      *
     I*TABLETLF***********                                                S01194
     I***           ZZ014A                          ZZ002A                S01119
      *
     I*TABLET1F***********                                                S01194
     I***           ZZ0057                          ZZ033A                S01119
      *
     IACCNTABF
     I***           ZZ0017                          ZZ006A                S01119
      *
     IPSDS       SDS
      *
      **  Data structures :
      *
      **  Program status data structure for workstation ID &  user ID
      *
     I                                     *PROGRAM ##PGM                 CIR005
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
      *
      **  Data structure to update last transaction number dtaara
      *
     IDNATN       DS                              5
     I                                        1   50FNATN
      *
      **   Data structure for error handling subroutine
      *
     IINFDS       DS
     I                                     *STATUS  STATUS
      *
      **   Data structure to provide text on comit entry in journal
      *
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 IACTX
     I                                       26  35 USRIDX
     I*******                                51 277 SCRN1X                S01117
     I*******                               278 366 SCRN2X                S01117
     I***********                            51 253 SCRN1X          S01117CIR001
     I***********                           254 348 SCRN2X          S01117CIR001
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604IIP2                                           S01408
     I*                                                                   S01408
     I***********                            51 273 SCRN1X         CIR001 CEU003
     I                                       51 276 SCRN1X                CEU003
     I***********                           274 368 SCRN2X         CIR001 CEU003
     I                                      277 374 SCRN2X                CEU003
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604IIP3                                           S01408
     I*                                                                   S01408
      **  Define 'TIM' field ( HH:MM only )
     I                                       19  220TIM
      **   Data structures for testing numeric fields.
      *
     ITESTX6      DS
     I                                        1   6 XTEST6
     I                                        7   7 HIGHZ6
      *
     ITESTX2      DS
     I                                        1   2 XTEST2
     I                                        3   3 HIGHZ2
     ****Data*structure*for setting up key to Table file.                 S01194
     I************DS*******                                               S01194
     I*********************                   1  12 KEY                   S01194
     I*********************                   8  12 WRK5                  S01194
     I*********************                   9  12 WRK4                  S01194
     I*********************                  10  12 WRK3                  S01194
     I*********************                  11  12 WRK2                  S01194
      *********************                                               S01194
      **  Data structure - retail account
      *
     I            DS
     I**********                              1  12 RACC                                      CGL029
     I                                        1  18 RACC                                      CGL029
     I                                        1   6 F6
     I**********                              7  12 L6                                        CGL029
     I                                        7  18 L6                                        CGL029
     I                                       10  11 X2
      *
      **  Data structure - Special Instructions
      *
     I            DS
     I                                        1  35 SPIX
     I                                        1   5 SPI5
     I                                        6   8 SPI3
     I                                        1   8 SPI8
     I                                        9  14 SPI6
     I                                        9  17 SPI9
     I                                       15  35 SPIX1
     I                                       18  35 SPIX2
      *
      **  Data structure for Dlscon to redefine array ZZZ as returned
      **  field ZAMTD
      *
     I            DS
     I                                        1  14 ZAMTD
     I                                        1  14 ZZZ
      *
      **  Data structure for Dlscon to redefine array ZZQ as input
      **  field ZAMTW
      *
     I            DS
     I                                        1  130ZAMTW
     I                                        1  130ZZQ
      *
      **  Data structure to define retail account
      *
     I            DS
     I**********                              1  12 RACNO                                     CGL029
     I**********                              1  12 RACNO                              CGL029 CAS011
     I                                        1  18 RACNO                                     CAS011
     I                                        1   6 RCNUM
     I**********                              7  10 RPCAC                                     CGL029
     I**********                             11  12 RSEQ                                      CGL029
     I                                        7  16 RPCAC                                     CGL029
     I                                       17  18 RSEQ                                      CGL029
      * Work fields DS for subroutine TSTRTL
     I            DS
     I*****                                   1  15 ERRKEY                S01117
     I**********                              1  18 ERRKEY                             S01117 CGL029
     I                                        1  24 ERRKEY                                    CGL029
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   9 WCCY
     I**********                             10  130WACOD                                     CGL029
     I**********                             14  150WACSQ                                     CGL029
     I**********                             16  18 WWBRCA                             S01117 CGL029
     I                                       10  190WACOD                                     CGL029
     I                                       20  210WACSQ                                     CGL029
     I                                       22  24 WWBRCA                                    CGL029
      * split bank a/c for 'ACCNT' key
     I*****                                  16  27 DBNKAC                S01117
     I*****                                  16  210D16#21                S01117
     I*****                                  22  250D22#25                S01117
     I*****                                  26  27 D26#27                S01117
     I**********                             19  30 DBNKAC                             S01117 CGL029
     I**********                             19  240W@CNUM                             S01117 CGL029
     I**********                             25  280W@ACOD                             S01117 CGL029
     I**********                             29  30 W@ACSQ                             S01117 CGL029
     I                                       25  42 DBNKAC                                    CGL029
     I**********                             25  300W@CNUM                             CGL029 CSD027
     I                                       25  30 W@CNUM                                    CSD027
     I                                       31  400W@ACOD                                    CGL029
     I                                       41  42 W@ACSQ                                    CGL029
      *
      **  Data structure for PRONO updating to redefine array PBAL as
      **  file field PNB  ( Prono balances )
      *
     I            DS
     I                                    P   1  400PBAL
     I                                        1  40 PNB
      *
      **  Data structure for PRONO updating to redefine array PDAT as
      **  file field PND  ( Prono dates )
      *
     I            DS
     I                                    P   1  150PDAT
     I                                        1  15 PND
      *
      **  Data structure for OLPOS updating to redefine array OBLI as
      **  file field OFI  ( Olpos incoming balances )
      *
     I            DS
     I                                    P   1 1280OBLI
     I                                        1 128 OFI
      *
      **  Data structure for OLPOS updating to redefine array OBLO as
      **  file field OFO  ( Olpos outgoing balances )
      *
     I            DS
     I                                    P   1 1280OBLO
     I                                        1 128 OFO
      *
      **  Data structure for OLPOS updating to redefine array ODAT as
      **  file field ODT  ( Olpos dates )
      *
     I            DS
     I                                    P   1  480ODAT
     I                                        1  48 ODT
      *
      **  Data structure to define 'day' in date field ( dep. on fmt. )
      *
     I            DS
     I                                        1   6 DATE
     I                                        1   2 DAY1
     I                                        3   4 DAY2
     I/COPY WNCPYSRC,DL1604II03
      *
      **   Data structure to add all first screen fields to comit text
      *
     I            DS
     I                                        1   6 SDLNO
     I                                        7   7 SACCD
     I                                        8   9 SDTYP
     I                                       10  11 SDLST
     I                                       12  17 SDDAT
     I***************************************18  20 SBRCD                 S01117
     I                                       18  20 SBRCA                 S01117
     I                                       21  24 SBRKC
     I                                       25  38 SBAGE
     I                                       39  44 SLNKDN
     I                                       45  54 SCNUM
     I                                       55  60 SVDAT
     I                                       61  66 SMDAT
     I                                       67  68 SCDAS
     I                                       69  71 SUCUCY
     I                                       72  85 SUPAMT
     I                                       86  86 SUFFI
     I                                       87 100 SUBCXR
     I                                      101 102 SBOKC                 S01117
     I*****                                 101 101 SUICBS                S01117
     I*****                                 102 102 SHEDIN                S01157
     I*****                                 102 102 SBYSL         S01157  S01117
     I*****                                 103 103 STAXI                 S01117
     I****                                  104 104 SUNII                 S01157
     I***                                   105 106 SUBRTT                S01157
     I***                                   107 118 SURTSP                S01157
     I**                                    119 119 SUSPIN                S01157
     I***                                   120 121 SUFRFD                S01157
     I***                                   122 127 SUNICD                S01157
     I***                                   128 128 SUICFR                S01157
     I***                                   129 130 SUICFD                S01157
     I***                                   131 142 SWORK1                S01157
     I***                                   143 148 SUNIPD                S01157
     I***                                   149 149 SUIPFR                S01157
     I***                                   150 151 SUIPFD                S01157
     I***                                   152 153 STBRTT                S01157
     I***                                   154 165 STRTSP                S01157
     I***                                   166 166 STSPIN                S01157
     I***                                   167 168 STFRFD                S01157
     I***                                   169 174 STNICD                S01157
     I***                                   175 175 STICFR                S01157
     I***                                   176 177 STICFD                S01157
     I***                                   178 189 SWORK2                S01157
     I***                                   190 195 STNIPD                S01157
     I***                                   196 196 STIPFR                S01157
     I***                                   197 198 STIPFD                S01157
     I*****                                 152 153 SRBRTT        S01157  S01117
     I*****                                 154 165 SRRTSP        S01157  S01117
     I*****                                 166 166 SRSPIN        S01157  S01117
     I*****                                 167 168 SCFRFD        S01157  S01117
     I*****                                 169 174 SRNICD        S01157  S01117
     I*****                                 175 175 SRICFR        S01157  S01117
     I*****                                 176 177 SCICFD        S01157  S01117
     I*****                                 178 189 SWORKR        S01157  S01117
     I*****                                 190 195 SRNIPD        S01157  S01117
     I*****                                 196 196 SRIPFR        S01157  S01117
     I*****                                 197 198 SRIPFD        S01157  S01117
     I*****                                 199 210 SCLRAT                S01117
     I*****                                 211 222 SFLRAT                S01117
     I*****                                 223 223 SAVRAM                S01117
     I*****                                 224 225 SRSETM                S01117
     I*****                                 226 227 SPSETM                S01117
     I*****                                 228 229 SBOKC         S01157  S01117
     I                                      103 103 SUICBS                S01117
     I                                      104 104 STAXI                 S01117
     I                                      105 108 SPRFC                 S01117
     I                                      109 111 SORBR                 S01117
     I                                      112 112 SBYSL                 S01117
     I                                      113 114 SRBRTT                S01117
     I                                      115 126 SRRTSP                S01117
     I                                      127 127 SRSPIN                S01117
     I                                      128 129 SCFRFD                S01117
     I                                      130 135 SRNICD                S01117
     I                                      136 136 SRICFR                S01117
     I                                      137 138 SCICFD                S01117
     I                                      139 153 SLABLR                S01117
     I                                      154 165 SWORKR                S01117
     I**********                            166 171 SRNIPD                           S01117 AR814519
     I**********                            172 172 SRIPFR                           S01117 AR814519
     I**********                            173 174 SRIPFD                           S01117 AR814519
     I**********                            175 186 SCLRAT                           S01117 AR814519
     I**********                            187 198 SFLRAT                           S01117 AR814519
     I**********                            199 199 SAVRAM                           S01117 AR814519
     I**********                            200 201 SRSETM                           S01117 AR814519
     I**********                            202 203 SPSETM                           S01117 AR814519
     I                                      166 166 SRSIGN                                  AR814519
     I                                      167 172 SRNIPD                                  AR814519
     I                                      173 173 SRIPFR                                  AR814519
     I                                      174 175 SRIPFD                                  AR814519
     I                                      176 187 SCLRAT                                  AR814519
     I                                      188 199 SFLRAT                                  AR814519
     I                                      200 200 SAVRAM                                  AR814519
     I                                      201 202 SRSETM                                  AR814519
     I                                      203 204 SPSETM                                  AR814519
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604IIP4                                           S01408
     I*                                                                   S01408
     I                                      204 209 SUPVD                 CIR001
     I                                      210 223 SUPFE                 CIR001
     I                                      224 226 SSTCY                 CEU003
     I/COPY WNCPYSRC,DL1604II01
      *
     I***                                     1 227 SCRN1                 S01157
     I*****                                   1 229 SCRN1          S01157 S01117
     I***********                             1 203 SCRN1           S01117CIR001
     I***********                             1 223 SCRN1          CIR001 CEU003
     I                                        1 226 SCRN1                 CEU003
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604IIP5                                           S01408
     I*                                                                   S01408
      *
      **   Data structure to add all second screen fields to comit text
      *
     I            DS
     I*****                                   1  12 SURACC                S01117
     I*****                                  13  24 SUPACC                S01117
     I*****                                  25  34 SCPPBK                S01117
     I*****                                  35  44 SCPRBK                S01117
     I*****                                  45  54 SFACO                 S01117
     I*****                                  55  89 SSPI                  S01117
      *                                                                   S01117
     I                                        1   3 SROBR                 S01117
     I**********                              4  15 SURACC                             S01117 CGL029
     I**********                             16  18 SPOBR                              S01117 CGL029
     I**********                             19  30 SUPACC                             S01117 CGL029
     I**********                             31  40 SCPPBK                             S01117 CGL029
     I**********                             41  50 SCPRBK                             S01117 CGL029
     I**********                             51  60 SFACO                              S01117 CGL029
     I**********                             61  95 SSPI                               S01117 CGL029
     I**********                             96  98 SIC72                              CEU003 CGL029
     I                                        4  21 SURACC                                    CGL029
     I                                       22  24 SPOBR                                     CGL029
     I                                       25  42 SUPACC                                    CGL029
     I                                       43  52 SCPPBK                                    CGL029
     I                                       53  62 SCPRBK                                    CGL029
     I                                       63  72 SFACO                                     CGL029
     I                                       73 107 SSPI                                      CGL029
     I                                      108 110 SIC72                                     CGL029
      *
     I*****                                   1  89 SCRN2                 S01117
     I***********                             1  95 SCRN2          S01117 CEU003
     I**********                              1  98 SCRN2                              CEU003 CGL029
     I                                        1 110 SCRN2                                     CGL029
      *                                                                   CIR005
     I              'IRSBDYSIN'           C         IRSBSN                CIR005
     I              'IRRTFXCNV'           C         IRRTFX                CIR005
      *
     I/COPY WNCPYSRC,DL1604II02
      **   Local data area to hold database error information
      *
     I*LDA*********DS******                      256                      S01194
     I*********************                 134 138 DBFILE                S01194
     I*********************                 139 167 DBKEY                 S01194
     I*********************                 168 175 DBPGM                 S01194
     I*********************                 176 1770DBASE                 S01194
     I*                                                                   S01408
     I/COPY QWINDSRC,DL1600GDTA                                           S01408
     I*                                                                   S01408
     IDBERR       DS                            256                       S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*                                                                   S01157
     IZMUSER      DS                             17                       S01117
     I* DATA STRUCTURE IN QTEMP - USER DETAILS                            S01117
     I                                       11  13 ZDBRN                 S01117
     I                                       14  16 @DEPT                 S01117
      *                                                                   CIR006
     IZ#BSTS    E DSZ#BST                                                 CIR006
     IZ#ASTS    E DSZ#AST                                                 CIR006
     IZ#WSTS    E DSZ#WST                                                 CIR003
     IZ#XSTS    E DSZ#XST                                                 CIR003
     IZ#YSTS    E DSZ#YST                                                 CIR003
     IZ#ZSTS    E DSZ#ZST                                                 CIR003
     IIRDEAL    E DSDEALSDG                                               CIR006
     I              LCD                             ALCD                  CIR006
     I              UBRTT                           AUBRTT                CIR006
     I              URTSP                           AURTSP                CIR006
     I              UFRFD                           AUFRFD                CIR006
     I              UNICD                           AUNICD                CIR006
     I              UICFD                           AUICFD                CIR006
     I              UEINR                           AUEINR                CIR006
     I              UIPBD                           AUIPBD                CIR006
     I              UIPFD                           AUIPFD                CIR006
     I              UICBD                           AUICBD                CIR006
     I              ULPCD                           AULPCD                CIR006
     I              UINFD                           AUINFD                CIR006
     I              USLIP                           AUSLIP                CIR006
     I              UNIPD                           AUNIPD                CIR006
     I              TBRTT                           ATBRTT                CIR006
     I              TRTSP                           ATRTSP                CIR006
     I              TFRFD                           ATFRFD                CIR006
     I              TNICD                           ATNICD                CIR006
     I              TICFD                           ATICFD                CIR006
     I              TEINR                           ATEINR                CIR006
     I              TIPBD                           ATIPBD                CIR006
     I              TIPFD                           ATIPFD                CIR006
     I              TICBD                           ATICBD                CIR006
     I              TLPCD                           ATLPCD                CIR006
     I              TINFD                           ATINFD                CIR006
     I              TSLIP                           ATSLIP                CIR006
     I              TNIPD                           ATNIPD                CIR006
      *                                                                   CIR006
      *                                                                   CIR005
     IPIRSBS    E DSIRSBDYPD                                              CIR005
      ** Single Currency Business Day Conventions data structure          CIR005
      *                                                                   CIR005
     I                                        1  30 PBDPAY                CIR005
     I                                       35  64 PBDRAT                CIR005
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BANK DETAILS                        S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO MIDAS MODULES DETAILS               S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO DEALS DETAILS                       S01194
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO RETAIL DETAILS                      S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO CURRENCY DETAILS                    S01194
     I*                                                                   S01194
     ISDBROK    E DSSDBROKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BROKER                              S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO GENERAL LEDGER DETAILS              S01194
     I*                                                                   S01194
     ISDDLST    E DSSDDLSTPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO DEAL SUB-TYPES                      S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BRANCH CODES                        S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO CUSTOMER DETAILS                    S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACC3                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO NOSTRO DETAILS                      S01194
     I*                                                                   S01194
     ISDBOOK    E DSSDBOOKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BOOK DETAILS                        S01194
     I*                                                                   S01194
     ISDBSRT    E DSSDBSRTPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BASE RATE DETAILS                   S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I              QQACCD                          QQACC4                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO TRADING DETAILS                     S01194
     I*                                                                   S01194
     ISDCNST    E DSSDCNSTPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO COUNTERPARTY NOSTRO DETAILS         S01194
     I*                                                                   S01194
     ISDPRFC    E DSSDPRFCPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO PROFIT CENTRE DETAILS               S01194
     I*                                                                   S01194
     ISCSARD    E DSSCSARDPD                                              CIR001
      ** SAR descriptions                                                 CIR001
     I*                                                                   S01194
     ISDFAIS    E DSSDFAISPD                                              108624
      *                                                                   108624
      ** Record format for access to  FRA/IRS I.C.D. details              108624
      *                                                                   108624
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604IIPG                                           S01408
     I*                                                                   S01408
     I* DUMMY DATA STRUCTURES USED BY ACCESS PROGRAMS                     S01194
     I* (DSSDY ONLY USED IF FILE RECORDS OVER 150 CHARS. LONG)            S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I* DATA STRUCTURE TO HOLD OUR DETAILS ON DEALSDG                     S01157
     I*                                                                   S01157
     IOURDS       DS                                                      S01157
     I                                        1   20UBRTT                 S01157
     I                                        3  137URTSP                 S01157
     I                                       14  150UFRFD                 S01157
     I                                       16  200UNICD                 S01157
     I                                       21  220UICFD                 S01157
     I                                       23  337UEINR                 S01157
     I                                       34  380UIPBD                 S01157
     I                                       39  400UIPFD                 S01157
     I                                       41  450UICBD                 S01157
     I                                       46  500ULPCD                 S01157
     I                                       51  550UINFD                 S01157
     I                                       56  600USLIP                 S01157
     I                                       61  650UNIPD                 S01157
     I                                        1  65 OUR                   S01157
     I*                                                                   S01157
     I* DATA STRUCTURE TO HOLD THEIR DETAILS ON DEALSDG                   S01157
     I*                                                                   S01157
     ITHRDS       DS                                                      S01157
     I                                        1   20TBRTT                 S01157
     I                                        3  137TRTSP                 S01157
     I                                       14  150TFRFD                 S01157
     I                                       16  200TNICD                 S01157
     I                                       21  220TICFD                 S01157
     I                                       23  337TEINR                 S01157
     I                                       34  380TIPBD                 S01157
     I                                       39  400TIPFD                 S01157
     I                                       41  450TICBD                 S01157
     I                                       46  500TLPCD                 S01157
     I                                       51  550TINFD                 S01157
     I                                       56  600TSLIP                 S01157
     I                                       61  650TNIPD                 S01157
     I                                        1  65 THEIR                 S01157
     I*                                                                   S01157
     I/COPY WNCPYSRC,DL1604IIP1                                           S01408
      *                                                                   S01408
     I            DS                                                      CIR001
      *                                                                   CIR001
      ** Data structure for Up-front fee (premium) update parameters.     CIR001
      *                                                                   CIR001
     I**********                              1  15 XXACC                              CIR001 CGL029
     I                                        1  21 XXACC                                     CGL029
     I**********                              1   60XXCNUM                             CIR001 CSD027
     I                                        1   6 XXCNUM                                    CSD027
     I                                        7   9 XXCCY                 CIR001
     I**********                             10  130XXACOD                             CIR001 CGL029
     I**********                             14  150XXACSQ                             CIR001 CGL029
     I                                       10  190XXACOD                                    CGL029
     I                                       20  210XXACSQ                                    CGL029
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01195
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
      /EJECT                                                              S01157
      *****************************************************************
      *                                                               *
      *    I N I T I A L   P R O C E S S I N G                        *
      *                                                               *
      *****************************************************************
      /SPACE 2
     C                     MOVEACPY@      BIS@   80
     C           ACCKEY    KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WCCY    3
     C**********           KFLD           WACOD   40                                          CGL029
     C                     KFLD           WACOD                                               CGL029
     C                     KFLD           WACSQ   20
     C                     KFLD           WWBRCA  3                       S01117
     C/COPY WNCPYSRC,DL1604IC48
     C*                                                                   S01157
     C* INITIALISE OUR/THEIR DATA-STRUCTURES                              S01157
     C*                                                                   S01157
     C                     MOVE *ZERO     OUR                             S01157
     C                     MOVE *ZERO     THEIR                           S01157
     C*                                                                   S01157
      **
      *
      **   Access  I.C.D. records & test constant data
      *
     C                     EXSR INIT
      *
      *
      **   Receive parameters from calling program
      *
     C           *ENTRY    PLIST
      *
      **   Receiving parameter only
      *
     C                     PARM           TNLUX   50
      *
      **   Sending parameter only
      *
     C******     *INKA     PARM *INKA     CMD1    1                       S01203
     C           *INKC     PARM *INKC     CMD1    1
     C*                                                                   S01203
      *
      **   Receiving / Sending parameters
      *
     C                     PARM           NEWDL   6
     C                     PARM           NEWAC   1
     C                     PARM           NEWDT   2
      *                                                                   CIR005
      ** Parameter list for IRSBDYSIN                                     CIR005
      *                                                                   CIR005
     C           PIRSBD    PLIST                                          CIR005
     C                     PARM           WRTCD  10                       CIR005
     C                     PARM           SACCD                           CIR005
     C                     PARM           SDLNO                           CIR005
     C                     PARM           PIRSBS                          CIR005
     C                     PARM           WFKEY   2                       CIR005
      *                                                                   CIR005
      ** Parameter list for IRRATFXCNV                                    CIR005
      *                                                                   CIR005
     C           PIRRAT    PLIST                                          CIR005
     C                     PARM           ZINDT                           CIR005
     C                     PARM           WRFDY   20                      CIR005
     C                     PARM *BLANK    ZLOC                            CIR005
     C                     PARM           PBDRAT                          CIR005
     C                     PARM *ZEROS    ZRFDT                           CIR005
      *
      *
      **   Setup screen action code, deal no. & deal type fields
      *
     C                     MOVE NEWAC     SACCD
     C                     MOVE NEWDL     SDLNO
     C                     MOVE NEWDT     SDTYP
     C                     MOVE *BLANKS   SNEWAC
     C                     MOVE *BLANKS   SNEWDL
     C                     MOVE *BLANKS   SNEWDT
      /EJECT
      *****************************************************************
      *                                                               *
      *    M A I N   P R O C E S S I N G                              *
      *                                                               *
      *****************************************************************
      *
      **   Set 'labels' to show 'Short term rate' on screen for insert
      *
     C***                  MOVELERRMSG,6  SLABL1                          S01157
     C***                  MOVELERRMSG,6  SLABL2                          S01157
     C                     MOVELERRMSG,6  SLABLR                          S01157
      *
      **   Read/write first detail screen
      *
     C           CEU003    IFEQ 'N'                                       CEU003
     C                     MOVE '1'       *IN71                           CEU003
     C                     MOVE '1'       *IN73                           CEU003
     C                     ENDIF                                          CEU003
     C                     EXSR SCRNQ
      *
      *****Continue*until*cmd/1*or*cmd/5*taken**************              S01203
      *
     C******     *INKA     DOWNE'1'                                       S01203
     C******     *INKE     ANDNE'1'                                       S01203
      **   Continue until cmd/3 or cmd/12 taken                           S01203
      *                                                                   S01203
     C           *INKC     DOWNE'1'                                       S01203
     C           *INKL     ANDNE'1'                                       S01203
      *
      **   Validate first detail screen
      *
     C/COPY WNCPYSRC,DL1604IC01
      *                                                                   CIR005
      ** Not yet passed to BDC input screen, set validate BDC flag to     CIR005
      ** 'N'                                                              CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'N'                                       CIR005
     C                     MOVE 'N'       WVLBDC  1                       CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     EXSR VALD12
      *                                                                   CIR005
      ** If no error on first screen, call Business Day Conventions       CIR005
      ** screen for input.                                                CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           *IN05     ANDEQ*OFF                                      CIR005
     C           *IN07     ANDEQ*OFF                                      CIR005
     C           WBDCPS    ANDEQ'N'                                       CIR005
      *                                                                   CIR005
     C                     MOVE SACCD     WACCD   1                       CIR005
      *                                                                   CIR005
     C           PIRSBS    IFNE *BLANK                                    CIR005
     C           CIR017    IFEQ 'N'                                                           CIR017
     C                     MOVE PIRSBS    WPREV  64                       CIR005
     C                     ELSE                                                               CIR017
      ** Use a longer field to save Business Day Convention data                              CIR017
      ** (new screen layout for Business Day Convention - see IRSBDYPD)                       CIR017
     C                     MOVE PIRSBS    WPREV2128                                           CIR017
     C                     ENDIF                                                              CIR017
     C                     MOVE 'A'       SACCD                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     CALL IRSBSN    PIRSBD                          CIR005
     C                     MOVE 'Y'       WBDCPS                          CIR005
     C                     MOVE WACCD     SACCD                           CIR005
      *                                                                   CIR005
      ** F3 pressed from Business Day Convention screen                   CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '03'                                      CIR005
     C                     MOVE *ON       *INKC                           CIR005
     C                     LEAVE                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** F12 pressed from Business Day Convention screen, back to the     CIR005
      ** first screen                                                     CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '12'                                      CIR005
     C                     MOVE 'N'       WBDCPS                          CIR005
     C                     MOVE *BLANK    WFKEY                           CIR005
     C           CIR017    IFEQ 'N'                                                           CIR017
     C                     MOVE WPREV     PIRSBS                          CIR005
     C                     ELSE                                                               CIR017
     C                     MOVE WPREV2    PIRSBS                                              CIR017
     C                     END                                                                CIR017
      *                                                                                       CIR017
     C                     EXSR SETOF                                     CIR005
     C                     EXSR SCRNQ                                     CIR005
     C           *INKC     IFEQ *ON                                       CIR005
     C           *INKL     OREQ *ON                                       CIR005
     C                     LEAVE                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Validate rate change date/interest date against the business     CIR005
      ** day currency conventions                                         CIR005
      *                                                                   CIR005
     C                     MOVE 'Y'       WVLBDC                          CIR005
     C                     ITER                                           CIR005
     C                     ENDIF                                          CIR005
      *
      **   If 1st detail screen is valid, with no errors or warning
      **   errors, write/read 2nd detail screen
      *
     C           *IN05     IFEQ '0'
     C           *IN07     ANDEQ'0'
     C                     EXSR SETOF
     C*****                EXSR SCRNR                                     S01199
     C                     EXFMTDL1600FR                                  S01199
      *
      *****Continue*until*cmd/1*or*cmd/5*or*ROLLDOWN*taken*****           S01203
      *
     C******     *INKA     DOWNE'1'                                       S01203
     C******     *INKE     ANDNE'1'                                       S01203
      **   Continue until cmd/3 or cmd/12 or ROLLDOWN taken               S01203
      *                                                                   S01203
     C           *INKC     DOWNE'1'                                       S01203
     C           *INKL     ANDNE'1'                                       S01203
     C           *IN03     ANDNE'1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICPG                                           S01408
     C*                                                                   S01408
      *
      **   Validate second detail screen
      *
     C                     EXSR VALD14
      *
      *****If*2nd*detail*screen*is*valid,*update*files*****               S01117
      **   If 2nd detail screen is valid, with no errors or warning       S01117
      **   errors, update files                                           S01117
      *
     C           *IN05     IFEQ '0'
     C           *IN07     ANDEQ'0'                                       S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP1                                           S01408
     C*                                                                   S01408
      *                                                                   CIR006
      **   Call window program if switchable feature CIR006 is ON         CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1604IC88
     C                     EXSR SRDWIN                                    CIR006
      *                                                                   CIR006
      **   Redisplay second screen if F/12 taken from window              CIR006
      *                                                                   CIR006
     C           *INKL     IFEQ *ON                                       CIR006
     C                     EXSR SETOF                                     CIR006
     C                     EXFMTDL1600FR                                  CIR006
     C                     MOVE *OFF      *INKL                                               CAP041
     C                     END                                            CIR006
     C                     END                                            CIR006
      *                                                                   CIR006
      **  Add the records if window details are accepted                  CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'N'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           PRTCD     ANDEQ*BLANKS                                   CIR006
      *                                                                   CIR006
     C                     EXSR URLIN
      *****Seton*cmd/5*to*return*to*initial*screen**********              S01203
      **   Seton cmd/12 to return to initial screen                       S01203
      **   after attempted update ( successful or not )
     C******               MOVE '1'       *INKE                           S01203
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP2                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *INKL                           S01203
     C                     ENDIF                                          CIR006
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP3                                           S01408
     C*                                                                   S01408
      *
      *****If*2nd*detail*screen*is*invalid,*rewrite*with*errors/read      S01117
      **   If 2nd detail screen is invalid, with errors and/or warning    S01117
      **   errors, rewrite with errors/read                               S01117
      *
     C                     ELSE
      **   If warning errors only, save contents of screen fields         S01117
     C*                                                                   S01117
     C           *IN05     IFEQ '0'                                       S01117
     C***********          MOVE SCRN2     SAV2   95                S01117 CEU003
     C                     MOVE SCRN2     SAV2   98                       CEU003
     C                     END                                            S01117
      *                                                                   S01117
     C                     EXSR ERDSP
     C*****                EXSR SCRNR                                     S01199
     C                     EXFMTDL1600FR                                  S01199
     C                     END
      *
     C                     END
      *
      **   If 1st detail screen is invalid, with errors and/or warning
      **   errors, rewrite with errors/read
      *
     C                     ELSE
      **   If warning errors only, save contents of screen fields
     C           *IN05     IFEQ '0'
     C****                 MOVE SCRN1     SAV1  227                       S01157
     C**********           MOVE SCRN1     SAV1  229                S01157 S01117
     C***********          MOVE SCRN1     SAV1  203                 S01117CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC24                                           S01408
     C*                                                                   S01408
     C***********          MOVE SCRN1     SAV1  223                CIR001 CEU003
     C                     MOVE SCRN1     SAV1  226                       CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC25                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C                     EXSR ERDSP
      *                                                                   CIR005
      ** Remove message highlight if message fields SERCD1 and SERCD2     CIR005
      ** are blanks                                                       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVE *BLANK    WIN07   1                       CIR005
     C                     MOVE *BLANK    WIN06   1                       CIR005
     C                     MOVE *BLANK    WIN05   1                       CIR005
     C           SERCD1    IFEQ *BLANK                                    CIR005
     C           SERCD2    ANDEQ*BLANK                                    CIR005
     C                     MOVE *IN07     WIN07   1                       CIR005
     C                     MOVE *IN06     WIN06   1                       CIR005
     C                     MOVE *IN05     WIN05   1                       CIR005
     C           *IN07     IFEQ *ON                                       CIR005
     C                     MOVE *OFF      *IN07                           CIR005
     C                     ENDIF                                          CIR005
     C           *IN06     IFEQ *ON                                       CIR005
     C                     MOVE *OFF      *IN06                           CIR005
     C                     ENDIF                                          CIR005
     C           *IN05     IFEQ *ON                                       CIR005
     C                     MOVE *OFF      *IN05                           CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     EXSR SCRNQ
      *                                                                   CIR005
      ** Put back original value of *IN05, *IN06 and *IN07                CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WIN05     ANDNE*BLANK                                    CIR005
     C           WIN06     ANDNE*BLANK                                    CIR005
     C           WIN07     ANDNE*BLANK                                    CIR005
     C                     MOVE WIN05     *IN05                           CIR005
     C                     MOVE WIN06     *IN06                           CIR005
     C                     MOVE WIN07     *IN07                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Warning found after having gone thru the BDC screen              CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SCRN1     ANDEQSAV1                                      CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           *INKC     ANDEQ*OFF                                      CIR005
     C           *INKL     ANDEQ*OFF                                      CIR005
      *                                                                   CIR005
     C           PIRSBS    IFNE *BLANK                                    CIR005
     C           CIR017    IFEQ 'N'                                                           CIR017
     C                     MOVE PIRSBS    WPREV                           CIR005
     C                     ELSE                                                               CIR017
     C                     MOVE PIRSBS    WPREV2                                              CIR017
     C                     END                                                                CIR017
      *                                                                                       CIR017
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** If warning error connected to BDC currencies, return to          CIR005
      ** BDC screen to allow amendment of currencies                      CIR005
      *                                                                   CIR005
     C           WWARNG    IFEQ 'Y'                                       CIR005
      *                                                                   CIR005
     C                     MOVE SACCD     WACCD                           CIR005
     C                     MOVE 'A'       SACCD                           CIR005
     C                     CALL IRSBSN    PIRSBD                          CIR005
     C                     MOVE WACCD     SACCD                           CIR005
      *                                                                   CIR005
      ** F3 Pressed                                                       CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '03'                                      CIR005
     C                     MOVE *ON       *INKC                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** F12 Pressed                                                      CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '12'                                      CIR005
     C                     MOVE *BLANK    WFKEY                           CIR005
     C           CIR017    IFEQ 'N'                                                           CIR017
     C                     MOVE WPREV     PIRSBS                          CIR005
     C                     ELSE                                                               CIR017
     C                     MOVE WPREV2    PIRSBS                                              CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
     C                     EXSR SETOF                                     CIR005
     C                     EXSR SCRNQ                                     CIR005
     C           *INKC     IFEQ *ON                                       CIR005
     C           *INKL     OREQ *ON                                       CIR005
     C                     LEAVE                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC26                                           S01408
     C*                                                                   S01408
      *
      **   If ROLLDOWN, write/read first screen
      *
     C           *IN03     IFEQ '1'
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVE 'N'       WBDCPS                          CIR005
     C           WWARNG    IFEQ 'Y'                                       CIR005
     C                     MOVE 'N'       WWARNG                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     MOVE '0'       *IN03
     C                     EXSR SETOF
     C                     EXSR SCRNQ
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP4                                           S01408
     C*                                                                   S01408
      *
     C                     END
      *
      *****If*cmd/5,*write/read*initial*screen**************              S01203
      **   If cmd/12, write/read initial screen                           S01203
      *
     C******     *INKE     IFEQ '1'                                       S01203
     C           *INKL     IFEQ '1'                                       S01203
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC27                                           S01408
     C*                                                                   S01408
      *                                                                   CIR006
      **   Rollback any uncommitted transactions                          CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C                     ROLBK                                          CIR006
     C                     ENDIF                                          CIR006
     C*                                                                   S01117
     C* Since *IN11 is used for Profit Centre used as well as             S01117
     C* action code error, set off *IN11 to prevent highlighting          S01117
     C* action code field on initial screen                               S01117
     C*                                                                   S01117
     C                     SETOF                     11                   S01117
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVE 'N'       WBDCPS                          CIR005
     C                     EXSR SRCLR                                     CIR005
     C                     ENDIF                                          CIR005
     C*                                                                   S01117
     C                     EXSR SETOF
     C*****                EXSR SCRNA                                     S01199
     C/COPY WNCPYSRC,DL1604IC02
     C                     EXFMTDL1600FA                                  S01199
     C/COPY WNCPYSRC,DL1604IC03
      **   If 'Record updated by....' clear message after display
     C           *IN08     IFEQ '1'
     C                     MOVE '0'       *IN,08
     C                     MOVE *BLANKS   SERCD2
     C                     END
      *
     C                     END
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F I N A L   P R O C E S S I N G                            *
      *                                                               *
      *****************************************************************
      **   Setup parameter action code, deal no. & deal type fields
     C                     MOVE SNEWAC    NEWAC
     C                     MOVE SNEWDL    NEWDL
     C                     MOVE SNEWDT    NEWDT
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC28                                           S01408
     C*                                                                   S01408
      *                                                                   CIR006
      **   Rollback any uncommitted transactions                          CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C                     ROLBK                                          CIR006
     C                     ENDIF                                          CIR006
      *
     C                     SETON                     LR
      /EJECT
      *****************************************************************
      *                    INDEX TO SUBROUTINES                       *
      *                                                               *
      * Standard subroutines:                                         *
      *   ZDATE1  : Validate dates & convert to no. of days           *
      *   ZDATE2  : Convert no. of days to date format                *
      ****ZDATE5**:*Determine if a day no. is a holiday               *   S01195
      *   ZACCH   : Determine if AOHOLRO needs to be called and sets  *   S01195
      *             up the holiday record appropriately               *   S01195
      *   ZCHKH   : Determine if a MIDAS day no. is a holiday or      *   S01195
      *             working day for a given currency and location     *   S01195
      *   ZFWDT   : Determine the nth working day forward for a given *   S01195
      *             start date, currency and location                 *   S01195
      *   ZALIGN  : Validate & right align numeric fields             *
      ****ZSYSTM**:*Chain*I.C.D. record 1                             *   S01194
      *   ZTNLU1  : Update last transaction data area                 *
      ****ZFREQB**:*Increment*date*by*given*period*********************   S01195
      *   @FREQB  : Increment date by given period                    *   S01195
      *   ZSAVE   : Memorise & set off Indicators 90 - 97             *
      *   ZRSTOR  : Restore Indicators 90 - 97 to pre- SR.ZSAVE values*
      *                                                               *
      *   GLINTC  : Calculate interest between two dates              *
      *   DLBACK  : Calculate rate fix days                           *
      *   GLZADD  : Add amount to total for hashing                   *
      *   GLZSUB  : Subtract amount from total for hashing            *
      *   GLZSUM  : Carry out addition of GLZADD & GLZSUB             *
      *   TSTRTL  : Test for retail account (DL1600 suite of pgms)    *
      *                                                               *
      * Program subroutines:                                          *
      *   INIT    : Initial proc. - access ICD & check constant data  *
      *   SETRL   : Format file data for screen display               *
      ****SCRNA***:*Write/Read*&*call*HELP*for*initial*screen*A********   S01199
      ****SCRNQ***:*Write/Read*&*call*HELP*for*1st*ins/amd*screen*Q****   S01199
      *   SCRNQ   : Write/Read 1st ins/amd screen Q                   *   S01199
      ****SCRNR***:*Write/Read*&*call*HELP*for*2nd*ins/amd*screen*R****   S01199
      *   VALD12  : Validate 1st insert screen                        *
      *   XNTEST  : Test if a 6 char. field contains only numeric data*
      *   VALD14  : Validate 2nd insert screen                        *
      *   V14UB   : Validate settlement methods                       *
      *   V14CB   : Validate settlement methods                       *
      *   SEPTVS  : Validate special instructions field format        *
      *   SRSPI   : Validate special instructions                     *
      *   SETOF   : Setof all error inds./clear arrays & screen fields*
      *   ERDSP   : Load error/warning error codes into screen fields *
      ****HELP****:*Call*MHELP*pgm*&*pass*error*/warning*error*codes***   S01199
      *   URLIN   : Update / add file records for an insert           *   S01157
      *   CRDTA1  : Create data fields for output on an insert        *
      *   CRDTA2  : Create data fields for output on an amend         *
      *   UMEMOS  : Update PF/MEMOS                                   *
      *   WDTDD   : Write PF/DTRIXDD record                           *
      *   UOLPOS  : Update LF/OLPOS                                   *
      *   UPRONO  : Update LF/PRONO                                   *
      *   OUTPOS  : Outputs posting details to RSACMTPD               *   S01154
      *   MOPSR   : Calculate Interest Due and update M/O/P balances  *
      *   UDLDF   : Update PF/DEALSDF                                 *
      *   UDTHH   : Update PF/DTRIXHH                                 *
      *   WDLDG   : Write PF/DEALSDG record                           *
      *   SRDWIN  : Display Window                                    *   CIR006
      *   CONFI   : Set confirmation indicators ( P/DLU018 )          *
      *   CMTXT   : Set up text on comit entry in journal             *
      ****DBERR***:*Database error handling - update LDA & exit pgm   *   S01194
      *   *PSSR   : Database error handling                           *   S01194
      *   INFSR   : Write to file errors / Program exception errors   *
      *****************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C********************************************************************
      /EJECT
     C********************************************************************S01195
     C*********************                                               S01195
     C*****ZDATE5*SR.*TO*DETERMINE IF A DAY NUMBER DATE IS A HOLIDAY      S01195
     C****************IN*GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY         S01195
     C****************AND*IF REQUIRED, DETERMINE NEXT WORKING DAY.        S01195
     C*********************                                               S01195
     C***********ZDATE5****BEGSR                           *** ZDATE5 *** S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE INPUT FIELDS.                           S01195
     C*********************Z-ADDZDAYNO    ZDAYNO  50                      S01195
     C*********************MOVE ZCCY      ZCCY    3                       S01195
     C*********************MOVE ZOPT      ZOPT    1                       S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE/CLEAR WORKFIELDS.                       S01195
     C*********************MOVE '   '     ZHC                             S01195
     C*********************                                               S01195
     C*****RESET*INDICATOR.                                               S01195
     C*********************SETOF                     99                   S01195
     C*********************                                               S01195
     C*****CALCULATION*TO*DEFINE/SET OUTPUT FIELD.                        S01195
     C*********************Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C*********************                                               S01195
     C*****DETERMINE*IF*HOLIDAY                                           S01195
     C***********ZDHOL*****TAG                             ** ZDHOL TAG **S01195
     C*********************SETOF                     91                   S01195
     C*********************                                               S01195
     C*****SET*KEY*FOR*FIRST HOLIDAY RECORD.                              S01195
     C*********************MOVEL'22      'ZTABKY 12                       S01195
     C*********************MOVELZDYNBR    ZWRK6   6                       S01195
     C*********************MOVE '1'       ZWRK6                           S01195
     C*********************MOVE ZWRK6     ZTABKY                          S01195
     C*********************                                               S01195
     C*****CHAIN*FOR*HOLIDAY RECORD, RECORD 1 OR 2.                       S01195
     C***********ZDHCH5****TAG                             ** ZDHCH5 TAG *S01195
     C***********ZTABKY****CHAINTABDLI               90    ON NOT THERE   S01195
     C**N90******RECI******COMP 'D'                  9090  DELETED        S01195
     C*********************                                               S01195
     C*****STORE*CURRENCIES IF RECORD FOUND.                              S01195
     C**N90N91*************MOVEAHCCY      ZHC,1                           S01195
     C***91N90*************MOVEAHCCY      ZHC,26                          S01195
     C*********************                                               S01195
     C*****GET*SECOND*RECORD, IF NOT ALREADY DONE.                        S01195
     C*********************MOVE ZTABKY    ZWRK1N  10                      S01195
     C***********ZWRK1N****COMP 1                        91               S01195
     C*********************MOVE '2'       ZTABKY                          S01195
     C***91N90*************GOTO ZDHCH5                                    S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NO FIRST RECORD FOUND.                        S01195
     C***90*91*************GOTO ZDEND5                                    S01195
     C*********************                                               S01195
     C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
     C***********INEX******COMP 'E'                      92               S01195
     C***********INEX******COMP 'I'                      93               S01195
     C*********************                                               S01195
     C*****CHECK*IF*CURRENCY ON HOLIDAY.                                  S01195
     C***********ZCCY******LOKUPZHC                      94               S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NOT HOLIDAY FOR CURRENCY.                     S01195
     C***92*94*************                                               S01195
     C*OR*93N94************ GOTO ZDEND5                                   S01195
     C*********************                                               S01195
     C*****SET*INDICATOR FOR HOLIDAY FOR DAY NUMBER.                      S01195
     C*********************SETON                     99                   S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C*****CHECK*IF*NEXT*WORKING DAY REQUIRED.                            S01195
     C***********ZOPT******COMP 'Y'                      95               S01195
     C***95******ZDYNBR****ADD  1         ZDYNBR                          S01195
     C***95****************GOTO ZDHOL                                     S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C***********ZDEND5****ENDSR                           * ZDEND5 ENDSR*S01195
     C********************************************************************S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C*                                                                   S01195
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**                                                                  SEEEEE
     C**   DETERMINE IF OPTION ALLOWS 'M' AND 'T' CONSTANTS.              SEEEEE
     C**   DEFAULTS TO 'N'.                                               SEEEEE
     C**   DEFINES ZAOPT.                                                 SEEEEE
     C           ZAOPT     IFNE 'Y'                                       SEEEEE
     C           ZAOPT     ANDNE'N'                                       SEEEEE
     C                     MOVE 'N'       ZAOPT   1                       SEEEEE
     C                     END                                            SEEEEE
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**   IF OPTION TO ALLOW CONSTANTS IS 'Y'                            SEEEEE
     C           ZAOPT     IFEQ 'Y'                                       SEEEEE
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**   END CONSTANT OPTION LOOP.                                      SEEEEE
     C                     END                                            SEEEEE
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   LOOP IF CONSTANT OPTION IS NOT 'Y'.                            SEEEEE
     C           ZAOPT     IFEQ 'Y'                                       SEEEEE
     C**                                                                  SEEEEE
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   RESET ZAOPT.                                                   SEEEEE
     C                     MOVE *BLANK    ZAOPT
     C**   END CONSTANT LOOP.                                             SEEEEE
     C                     END                                            SEEEEE
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C********************************************************************
      /SPACE 5
3571 C********************************************************************
3657 C**
3658 C*****ZFREQ*-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A****             S01195
3658 C**   @FREQB - SR. TO INCREMENT A DAY NUMBER DATE BY A               S01195
3659 C**             PERIOD VALUE DETERMINED BY A CODE.
3660 C**
3661 C*****      ZFREQB    BEGSR                           *** ZFREQB *** S01195
3661 C           @FREQB    BEGSR                           *** @FREQB *** S01195
3662 C**
3663 C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
3664 C                     MOVE ZFREQ     ZFREQ   1
3665 C                     Z-ADDZDAYNO    ZDAYNO  50
3666 C                     Z-ADDZMDAY     ZMDAY   20
3667 C                     MOVE ZCCY      ZCCY    3
3668 C**
3669 C******               MOVE '   '     ZHC                             S01195
3670 C******               MOVE ' '       ZTABKY 12                       S01195
3671 C*
3672 C*            FIELDS USED FOR PERIOD CODES M,T,Q,X,Y
3673 C*
3674 C                     MOVE '  '      ZINDE   2
3675 C                     Z-ADD0         ZINTO   20
3676 C**
3677 C**   CONVERT DAY NUMBER TO DATE.
3678 C                     EXSR ZDATE2
3679 C                     SETOF                     90
3680 C**
3681 C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.
3682 C           ZFREQ     COMP 'D'                      91
3683 C   91      ZDAYNO    ADD  1         ZDAYNO
3684 C   91                GOTO ZFHCHK
3685 C**
3686 C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.
3687 C           ZFREQ     COMP 'W'                      91
3688 C   91      ZDAYNO    ADD  7         ZDAYNO
3689 C   91                GOTO ZFEND
3690 C**
3691 C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.
3692 C           ZFREQ     COMP 'F'                      91
3693 C   91      ZDAYNO    ADD  14        ZDAYNO
3694 C   91                GOTO ZFEND
3695 C**
3696 C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.
3697 C           ZFREQ     COMP 'S'                      91
3698 C   91      ZDAY      COMP 15                   939292
3699 C   91 92             Z-ADD31        ZDAY
3700 C   91 93             Z-ADD15        ZDAY
3701 C   91 93   ZMTH      ADD  1         ZMTH
3702 C   91                GOTO ZFDATE
3703 C**
3704 C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.
3705 C           ZFREQ     COMP 'M'                      91
3706 C   91                MOVE 'IN'      ZINDE
3707 C   91                Z-ADDZMDAY     ZDAY
3708 C   91      ZMTH      ADD  1         ZMTH
3709 C   91                GOTO ZFDATE
3710 C**
3711 C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTH
3712 C           ZFREQ     COMP 'R'                      91
3713 C   91                Z-ADD31        ZDAY
3714 C   91      ZMTH      ADD  1         ZMTH
3715 C   91                GOTO ZFDATE
3716 C**
3717 C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.
3718 C           ZFREQ     COMP 'T'                      91
3719 C   91                MOVE 'IN'      ZINDE
3720 C   91                Z-ADDZMDAY     ZDAY
3721 C   91      ZMTH      ADD  2         ZMTH
3722 C   91                GOTO ZFDATE
3723 C**
3724 C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.
3725 C           ZFREQ     COMP 'Q'                      91
3726 C   91                MOVE 'IN'      ZINDE
3727 C   91                Z-ADDZMDAY     ZDAY
3728 C   91      ZMTH      ADD  3         ZMTH
3729 C   91                GOTO ZFDATE
3730 C**
3731 C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.
3732 C           ZFREQ     COMP 'X'                      91
3733 C   91                MOVE 'IN'      ZINDE
3734 C   91                Z-ADDZMDAY     ZDAY
3735 C   91      ZMTH      ADD  6         ZMTH
3736 C   91                GOTO ZFDATE
3737 C**
3738 C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.
3739 C           ZFREQ     COMP 'Y'                      91
3740 C   91                MOVE 'IN'      ZINDE
3734 C   91                Z-ADDZMDAY     ZDAY
3741 C   91      ZYEAR     ADD  1         ZYEAR
3742 C   91                GOTO ZFDATE
3743 C**
3744 C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH.
3745 C           ZFREQ     COMP 'L'                      91
3746 C   91                Z-ADD31        ZDAY
3747 C   91      ZMTH      ADD  1         ZMTH
3748 C   91                GOTO ZFDATE
3749 C**
3750 C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.
3751 C           ZFREQ     COMP 'B'                      91
3752 C   91                Z-ADD31        ZDAY
3753 C   91      ZMTH      ADD  1         ZMTH
3754 C   91                GOTO ZFDATE
3755 C**
3756 C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.
3757 C           ZFREQ     COMP 'A'                      91
3758 C**                   MOVEL'01    '  ZTABKY
3758 C***91*               MOVEL'01    '  ZTABKY                          S01195
3759 C***91*               MOVE '    11'  ZTABKY                          S01195
3760 C***91*     ZTABKY    CHAINTABLE                99    ON NOT THERE   S01195
3761 C**N99*     RECI      COMP '*'                      99               S01195
3762 C***91N99             Z-ADDAPDA      ZDAYNO                          S01194
3762 C   91                Z-ADDBKAPDT    ZDAYNO                          S01194
3763 C**
3764 C**   BYPASS IF ZFREQ IS 'A' OR ANY OTHER VALUE
3765 C                     GOTO ZFEND
3766 C**
3767 C**
3768 C**   REFORMAT DATE AND ENSURE VALID.
3769 C           ZFDATE    TAG                             ** ZFDATE TAG*
3770 C**
3771 C**   VALIDATE MONTH.
3772 C           ZMTH      COMP 12                   91
3773 C   91      ZMTH      SUB  12        ZMTH
3774 C   91      ZYEAR     ADD  1         ZYEAR
3775 C**
3776 C**   CHECK FOR LEAP YEAR.
3777 C           ZYEAR     DIV  4         ZLYR    20
3778 C                     MVR            ZLY     10     92LEAP YEAR-92 ON
3779 C**
3780 C**   VALIDATE DAY NUMBER.
3781 C                     MOVE ZFMD,ZMTH ZWRK2   20
3782 C           ZMTH      COMP 2                        93
3783 C   92 93             Z-ADD29        ZWRK2
3784 C**
3785 C           ZDAY      COMP ZWRK2                94
3786 C   94                Z-ADDZWRK2     ZDAY
3787 C**
3788 C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.
3789 C           ZFREQ     COMP 'R'                      91
3790 C   91      ZDAY      SUB  6         ZDAY
3791 C**
3792 C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
3793 C                     MOVELZDAY      ZWRK4   40
3794 C                     MOVE ZMTH      ZWRK4
3795 C   98                MOVELZMTH      ZWRK4
3796 C   98                MOVE ZDAY      ZWRK4
3797 C                     MOVELZWRK4     ZDATE
3798 C                     MOVE ZYEAR     ZDATE
3799 C                     EXSR ZDATE1
3800 C**
3801 C**   CHECK IF CODE B, OR M,T,Q,X,Y TO BE CHECKED FOR HOLIDAY.
3802 C           ZFREQ     COMP 'B'                      91
3803 C           ZINDE     COMP 'IN'                     92
3804 C   92N99
3805 COR 91N99             GOTO ZFHCHK
3806 C**
3807 C                     GOTO ZFEND
3808 C**
3809 C**   CHECK IF DAY NUMBER IS A HOLIDAY.
3810 C**
3811 C           ZFHCHK    TAG                             ** ZFHCHK TAG *
3812 C                     SETOF                     94
3813 C           ZFREQ     COMP 'D'                      91
3814 C           ZFREQ     COMP 'B'                      92
3815 C   91
3816 COR 92                GOTO ZSETK
3817 C*
3818 C*   FOR CODES M,T,Q,X,Y, CHECK ZINDE - 'IN' TO INCREMENT,
3819 C*                                    - 'DE' TO DECREMENT
3820 C*
3821 C           ZINDE     COMP 'IN'                     90
3822 C           ZINDE     COMP 'IN'                     91
3823 C           ZINDE     COMP 'DE'                     92
3824 C******                                                              S01195
3825 C******ET KEY FOR FIRST HOLIDAY RECORD.                              S01195
3826 C           ZSETK     TAG                             ** ZSETK TAG **
3827 C******               MOVEL'22    '  ZTABKY                          S01195
3828 C******               MOVELZDAYNO    ZWRK6   6                       S01195
3829 C******               MOVE 1         ZWRK6                           S01195
3830 C******               MOVE ZWRK6     ZTABKY                          S01195
3831 C******                                                              S01195
3832 C******ET HOLIDAY RECORD.                                            S01195
3833 C******     ZFHCHN    TAG                             ** ZFHCHN TAG* S01195
3834 C******     ZTABKY    CHAINTABLE                93    ON NOT THERE   S01195
3835 C**N93*     RECI      COMP '*'                      93               S01195
     C**N94*               MOVE '   '     ZHC                             S01195
3836 C******                                                              S01195
3837 C*****STORE CURRENCIES IF RECORD FOUND.                              S01195
3838 C**N94N93             MOVEAHCCY      ZHC,1                           S01195
3839 C***94N93             MOVEAHCCY      ZHC,26                          S01195
3840 C********                                                            S01195
3841 C*****GET SECOND RECORD, IF NOT ALREADY DONE.                        S01195
3842 C********             MOVE ZTABKY    ZWRK1N  10                      S01195
3843 C********   ZWRK1N    COMP 1                        94               S01195
3844 C********             MOVE '2'       ZTABKY                          S01195
3845 C***94N93             GOTO ZFHCHN                                    S01195
3846 C********                                                            S01195
3847 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
3848 C***93*94             GOTO ZFEND                                     S01195
3849 C*                                                                   S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
3850 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
3851 C********   INEX      COMP 'E'                      95               S01195
3852 C********   INEX      COMP 'I'                      96               S01195
3853 C********                                                            S01195
3854 C*    CHECK IF CURRENCY ON HOLIDAY.                                  S01195
     C*                                                                   S01195
3855 C********   ZCCY      LOKUPZHC                      97               S01195
     C           ZIND      CABEQ'W'       ZFEND                           S01195
3856 C**
3857 C**   BYPASS IF NOT HOLIDAY FOR CURRENCY.
3858 C***95*97                                             EXCLUDE FOUND  S01195
3859 C*R*96N97             GOTO ZFEND                      INCL. NOT FOUNDS01195
3860 C**
3861 C**
3862 C   92                GOTO ZDECR
3863 C*
3864 C**   INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.
3865 C   91      ZDAYNO    ADD  1         ZDAYNO
3866 C*
3867 C*    ONLY FOR PERIOD CODE = M,T,Q,X OR Y, IF INCREMENTATION
3868 C*    TAKES THE OUTPUT DATE INTO THE FOLLOWING MONTH, RETURN TO
3869 C*    THE INPUT DATE AND DECREMENT - 92 ON.
3870 C*
3871 C   90 91   ZINTO     ADD  1         ZINTO
3872 C   90 91   ZINTO     ADD  ZDAY      ZINTOT  20
3873 C   90 91             MOVE ZINTOT    ZINTOA  2
     C**TO ALLOW 29 FEB ON LEAP YEARS TO PASS
     C                     SETOF                     93
     C   90 91   ZYEAR     DIV  4         ZLYR
     C   90 91             MVR            ZLY            92
     C   90 91 92ZMTH      COMP 2                        93
     C   93      ZINTOA    COMP '29'                 92
     C   90 91N93ZINTOA    COMP ZFMD,ZMTH            92
2803 C** 90 91   ZINTOA    COMP ZFMD,ZMTH            92
3875 C   90 91 92ZDAYNO    SUB  ZINTO     ZDAYNO
3876 C   90 91 92          MOVE 'DE'      ZINDE
3877 C**
3878 C           ZDECR     TAG                             ** ZDECR TAG **
3879 C***92*95N97                                          EXCL. NOT FOUNDS01195
3880 C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO           INCLUDE FOUND  S01195
3880 C   92      ZDAYNO    SUB  1         ZDAYNO                          S01195
3881 C                     GOTO ZFHCHK
3882 C**
3883 C**
3884 C           ZFEND     ENDSR                           * ZFEND ENDSR *
3885 C**
3886 C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
     C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
     C**
     C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
     C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
     C**
     C           ZSAVE     BEGSR                           *** ZSAVE ***
     C**
     C                     BITOF'01234567'ZBITS   1
     C   90                BITON'0'       ZBITS
     C   91                BITON'1'       ZBITS
     C   92                BITON'2'       ZBITS
     C   93                BITON'3'       ZBITS
     C   94                BITON'4'       ZBITS
     C   95                BITON'5'       ZBITS
     C   96                BITON'6'       ZBITS
     C   97                BITON'7'       ZBITS
     C**
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     9697
     C**
     C                     ENDSR
     C********************************************************************
      /SPACE 3
     C********************************************************************
     C**
     C**   ZRSTOR SR. TO RESTORE INDICATORS 90 - 97 TO THE SETTINGS
     C**              THEY HAD BEFORE THE EXECUTION OF SR. ZSAVE.
     C**
     C           ZRSTOR    BEGSR                           *** ZRSTOR ***
     C**
     C                     TESTB'0'       ZBITS          90
     C                     TESTB'1'       ZBITS          91
     C                     TESTB'2'       ZBITS          92
     C                     TESTB'3'       ZBITS          93
     C                     TESTB'4'       ZBITS          94
     C                     TESTB'5'       ZBITS          95
     C                     TESTB'6'       ZBITS          96
     C                     TESTB'7'       ZBITS          97
     C**
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************066550
     C***********                                                         066550
     C*****GLINTC SR. TO CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS.  066550
     C***********                                                         066550
     C*****THIS*VERSION REPLACES THE ORIGINAL GLINTC SR. NOW NAMED        066550
     C*****GLINTO.                                                        066550
     C***********                                                         066550
     C*****CALCULATION METHODS ARE -                                      066550
     C*****1**ACTUAL/365                                                  066550
     C*****2**ACTUAL/360                                                  066550
     C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
     C*****4**365/365 (EXCLUDING 29/02)                                   066550
     C*****5**365/360 (EXCLUDING 29/02)                                   066550
     C*****6**ACTUAL/366                                                  066550
     C***********                                                         066550
     C*****REQUIRES SUBRS. - ZDATE2, ZSAVE, & ZRSTOR.                     066550
     C***********                                                         066550
     C***********                                                         066550
     C*                                                                *  066550
     C***********                                                         066550
     C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           066550
     C*R*********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  066550
     C*R*********          Z-ADDZIEND     ZIEND   50       FINISHING DATE 066550
     C*R*********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    066550
     C*R*********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      066550
     C*R*********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST 066550
     C***********                                                         066550
     C****TO*DETERMINE NUMBER OF DAYS INTEREST TO BE CALCULATED           066550
     C*R*********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
     C***********                                                         066550
     C****CHECK*FOR INTEREST CALCULATION BASIS                            066550
     C*****USE*OF INDICATRS                                               066550
     C*****1,92**2,90  3,91  4,97  5,96  6,95                             066550
     C***********          SETOF                     959697               066550
     C*R*********ZICALC    COMP 2                    919290               066550
     C**N91******          GOTO ZICAL                                     066550
     C***********ZICALC    COMP 5                    959796               066550
     C***97******ZICALC    COMP 3                    97  91               066550
     C***95******                                                         066550
     C*R*96******          SETOF                     91                   066550
     C**N91******          GOTO ZILPCK                                    066550
     C***********                                                         066550
     C*****THIS*CODING WILL CALCULATE THE NUMBER OF DAYS TO USE WHEN      066550
     C*****USING*THE 30/360 BASIS - METHOD 3.                             066550
     C***********          EXSR ZSAVE                                     066550
     C***********          Z-ADDZIBEG     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZISD    20                      066550
     C***********          MOVE ZMTH      ZISM    20                      066550
     C***********          MOVE ZYEAR     ZISY    20                      066550
     C***********          Z-ADDZIEND     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZIFD    20                      066550
     C***********          MOVE ZMTH      ZIFM    20                      066550
     C***********          MOVE ZYEAR     ZIFY    20                      066550
     C***********          EXSR ZRSTOR                                    066550
     C***********          SETOF                     93                   066550
     C****IN*ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF  066550
     C****ZIEND*IS GREATER THAN ZIBEG,THEN THE DATE ZIEND MUST BE IN A    066550
     C****DIFFERENT CENTURY TO ZIBEG.IF SO ADD 100 YEARS TO IT.           066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER START YEAR IS A LEAP YEAR AND IF START       066550
     C*****MONTH*IS FEBRUARY.                                             066550
     C***********                                                         066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZISM      COMP 2                        99*FEBRUARY      066550
     C**N99******30        SUB  ZISD      ZID1    50   93                 066550
     C**N99*93***          Z-ADD0         ZID1                            066550
     C***99N98***28        SUB  ZISD      ZID1                            066550
     C***99*98***29        SUB  ZISD      ZID1                            066550
     C***********ZISM      COMP 12                       93               066550
     C***93******          Z-ADD0         ZISM                            066550
     C***93******ZISY      ADD  1         ZISY                            066550
     C***93******ZISY2     ADD  1         ZISY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER END YEAR IS A LEAP YEAR AND IF END MONTH     066550
     C*****IS*FEBRUARY.                                                   066550
     C***********                                                         066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZIFM      COMP 2                        99*FEBRUARY      066550
     C**N99******ZIFD      COMP 31                       93               066550
     C***99N98***ZIFD      COMP 28                       93               066550
     C***99*98***ZIFD      COMP 29                       93               066550
     C***93******ZID1      ADD  30        ZID1                            066550
     C**N93******ZID1      ADD  ZIFD      ZID1                            066550
     C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
     C***93******          GOTO ZIOUT                                     066550
     C***********12        SUB  ZISM      ZIM1    20                      066550
     C***********          Z-ADD1         ZISM                            066550
     C*****USE*ENLARGED FIELDS THAT CAN HANDLE 1999 ONWARDS               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
     C***********ZIY1      MULT 12        ZIM2    30                      066550
     C***********ZIM2      ADD  ZIFM      ZIM2                            066550
     C***********ZIM1      ADD  ZIM2      ZINOM                           066550
     C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
     C***********ZINOM     MULT 30        ZID2    50                      066550
     C***********ZID2      ADD  ZID1      ZDAYN1                          066550
     C***********          SETOF                     93                   066550
     C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
     C**N96N97***          GOTO ZICAL                                     066550
     C*****THE*FOLLOWING CODING APPLIES FOR METHODS 4 AND 5 ONLY.         066550
     C*****1*DAY*IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB   066550
     C*****IN*THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG, & ZIEND.066550
     C***********                                                         066550
     C*****FIND*NO OF 4 YEAR PERIODS BETWEEN DATES                        066550
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
     C***********          MVR            ZIREM   50                      066550
     C*****FIND*NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.                    066550
     C***********ZIBEG     SUB  60        ZIBW1   50                      066550
     C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
     C***********          MVR            ZIDREM  50                      066550
     C***********ZIDREM    COMP 0                        94               066550
     C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
     C***94******          GOTO ZILP1                                     066550
     C*****ROUND*UP RESULT                                                066550
     C***********ZIDW1     ADD  1         ZIDW2                           066550
     C*****CALCULATE NEXT 29 FEB.                                         066550
     C***********ZIDW2     MULT 1461      ZIDW2                           066550
     C***********ZIDW2     ADD  60        ZIDW2                           066550
     C***********ZILP1     TAG                             * ZILP1 TAG *  066550
     C*****IF*THIS NEXT 29 FEB. DAYNO - ZIBEG IS GR. TH. OR EQ. TO        066550
     C*****ZIREM*THEN ADD 1 TO ZIMAN.                                     066550
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
     C***********ZIREM     COMP ZILPCP               94  94               066550
     C***94******ZIMAN     ADD  1         ZIMAN                           066550
     C*****SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1             066550
     C*****REQUIRED FOR THIS INTEREST CALCULATION.                        066550
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
     C***********          SETOF                     94                   066550
     C***********ZICAL     TAG                             * ZICAL TAG *  066550
     C***********                                                         066550
     C****CALCULATE INTEREST                                              066550
     C***90******                                                         066550
     C*R*91******                                                         066550
     C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
     C***92******                                                         066550
     C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
     C*R*********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
     C*R*********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST 066550
     C***********                                                         066550
     C***********          SETOF                     909192               066550
     C***********          SETOF                     959697               066550
     C*R*********          ENDSR                                          066550
     C***********                                                         066550
     C********************************************************************066550
      /EJECT
     C***************************************************************
     C* STANDARD SUBROUTINE FOR DL1601-4 :- SET UP KEY FOR FILE     *
     C* 'ACCNT' GET RECORD & IF FOUND,ACTIVE & RETAIL RETURN RRN    *
     C* OF MEMO RECORD OTHERWISE RETURN RRN OF ZERO.                *
     C*     FIELDS EXPECTED :-                                      *
     C*                        DCNUM.....CUSTOMER NUMBER.           *
     C*                        DDCCY.....DEAL CURRENCY.             *
     C*                        DBNKAC....BANK A/C NUMBER.           *
     C*                        DSETM.....SETTLEMENT TYPE.           *
     C*                        WWBRCA....BRANCH CODE.               *     S01117
     C*                                                             *
     C***************************************************************
     C*
     C           TSTRTL    BEGSR
     C*
     C* SET ROUTINE FIELDS
     C*
     C**********           Z-ADDDCNUM     DCNUM   60                                          CSD027
     C                     MOVE DCNUM     DCNUM   6                                           CSD027
     C                     MOVE DDCCY     DDCCY   3
     C*
     C********** MBIN      IFNE 'Y'                                       S01194
     C                     MOVE '01'      DACSQ   2
     C******************** ELSE                                           S01194
     C******************** MOVE NSACS     DACSQ                           S01194
     C******************** END                                            S01194
     C*
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'Y'       WRETL   1                       CCB002
     C*                                                                   S01154
     C* Initialise shadow postings work indicator                         S01154
     C*                                                                   S01154
     C                     MOVE 'N'       WNOST   1                       S01154
     C*
     C* SETTLEMENT TYPES 01 02 07 08 & 12
     C*
     C           DSETM     IFEQ '01'
     C           DSETM     OREQ '02'
     C           DSETM     OREQ '07'
     C           DSETM     OREQ '08'
     C           DSETM     OREQ '12'
     C*                                                                   S01154
     C* Settlement method is via a nostro set                             S01154
     C*                                                                   S01154
     C                     MOVE 'Y'       WNOST                           S01154
     C*
     C* NOT RETAIL, IF NO DATA ENTERED
     C********             MOVE *BLANKS   KEY                             S01194
     C                     MOVELDBNKAC    WRK2
     C           WRK2      IFNE '  '
     C*
     C**********                                                          S01194
     C**GET*CURRENCY*NOSTRO*RECORD*FROM*'TABDLI'**********                S01194
     C**********           MOVEL'70'      KEY                             S01194
     C**********           MOVELDDCCY     WRK5                            S01194
     C********** KEY       CHAINTABDLI               85                   S01194
     C**IF*RECORD*NOT*FOUND*OR*NOT*ACTIVE*DATABASE*ERROR****              S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '01'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELKEY       DBKEY            *      01     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           ELSE                                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO GET CURRENCY NOSTRO RECORD                 S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C                     PARM DDCCY     @CCY    3        Currency       S01194
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM WRK2      @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C* IF NO RECORD FOUND D/BASE ERROR EXISTS AND IS HANDLED BY          S01194
     C* ACCESS OBJECT PROGRAM.                                            S01194
     C*                                                                   S01194
     C*                                                                   S01194
     C**USE*FIELDS*FROM*TABLE*FILE*&*DEFAULT*CCY*TO*GET*ACCNT*RECORD      S01194
     C*                                                                   S01194
     C**USE FIELDS FROM SDNOST & DEFAULT CCY TO GET ACCNT RECORD          S01194
     C******************** MOVE CNUM      WCNUM                           S01194
     C                     MOVE A7CUST    WCNUM                           S01194
     C                     MOVE DDCCY     WCCY                            S01194
     C******************** MOVE ACOD      WACOD                           S01194
     C                     MOVE A7ACCD    WACOD                           S01194
     C******************** MOVE ACSQ      WACSQ                           S01194
     C                     MOVE A7ACSN    WACSQ                           S01194
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C**MOVE*KEY*FIELDS*INTO*DS*FIELDS*FOR*DB*ERROR*KEY**********         S01194
     C**********           MOVE '02'      DBASE            ***************S01194
     C**********           MOVE 'ACCNT'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELERRKEY    DBKEY            *      02     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C                     MOVEL'ACCNT'   DBFILE                          S01194
     C                     MOVEL'002'     DBASE            ***************S01194
     C                     MOVEL'*KEY  '  DBOPTN  7        *   DBERROR   *S01194
     C                     MOVELERRKEY    DBKEY            *     002     *S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 01
     C******               END                             END ERR 02     S01194
     C                     END                             CHECK IF RETAIL
     C                     END                             01/02/07/08/12
     C*
     C*
     C* SETTLEMENT TYPE 14
     C           DSETM     IFEQ '14'
     C                     MOVELDBNKAC    ACNO
     C           ACNO      CHAINACNUM                85
     C* IF ACNUM RECORD FOUND AND NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '0'                        RECORD FOUND
     C           RECI      IFNE 'D'                        NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
     C                     MOVE '03'      DBASE            ***************
     C                     MOVE 'ACNUM'   DBFILE           *   DBERROR   *
     C                     MOVELACNO      DBKEY            *      03     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C* IF 'ACNUM' RECORD FOUND & ACTIVE USE DATA TO ACCESS 'ACCNT'
     C                     MOVE CNUM      WCNUM
     C                     MOVE CCY       WCCY
     C                     MOVE ACOD      WACOD
     C                     MOVE ACSQ      WACSQ
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'                        NOT FOUND
     C           RECI      ORNE 'D'                        OR NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
     C* MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C                     MOVE '04'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      04     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01117
     C* BRCA (Branch Code) is called the same on both files. Therefore    S01117
     C* does not need moving.                                             S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 29
     C                     END                             END ERR 28
     C                     ELSE                            X NO REC
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END                             END NO REC
     C                     END                             END 14
     C*
     C*
     C* SETTLEMENT TYPE 04
     C           DSETM     IFEQ '04'
     C                     MOVE DCNUM     WCNUM
     C                     MOVE DDCCY     WCCY
     C******************** MOVE CADC      WACOD                           S01194
     C                     MOVE BMACCD    WACOD                           S01194
     C                     MOVE DACSQ     WACSQ
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C                     MOVE '05'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      05     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01117
     C* BRCA (Branch Code) is called the same on both files. Therefore    S01117
     C* does not need moving.                                             S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C                     END
     C*
     C                     END                             END 04
     C*
     C*
     C* SETTLEMENT TYPE 05
     C           DSETM     IFEQ '05'
     C* USE BANK A/C SPLIT FIELDS TO ACCESS 'ACCNT'
     C*****                MOVE D16#21    WCNUM                           S01117
     C                     MOVE W@CNUM    WCNUM                           S01117
     C                     MOVE DDCCY     WCCY
     C*****                MOVE D22#25    WACOD                           S01117
     C                     MOVE W@ACOD    WACOD                           S01117
     C* IF ACCOUNT SEQUENCE IS ZERO OR BLANK USE DEFAULT SEQUENCE
     C*****      D26#27    IFEQ *BLANK                                    S01117
     C*****      D26#27    OREQ *ZERO                                     S01117
     C           W@ACSQ    IFEQ *BLANK                                    S01117
     C           W@ACSQ    OREQ *ZERO                                     S01117
     C                     MOVE DACSQ     WACSQ
     C                     ELSE
     C*****                MOVE D26#27    WACSQ                           S01117
     C                     MOVE W@ACSQ    WACSQ                           S01117
     C                     END
     C*
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C* MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C                     MOVE '06'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      06     *
     C********             EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01117
     C* BRCA (Branch Code) is called the same on both files. Therefore    S01117
     C* does not need moving.                                             S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 30
     C                     END                             END 05
     C* CLEAR PASSED FIELDS
     C                     MOVE *BLANK    DDCCY
     C                     MOVE *BLANK    DSETM   2
     C                     MOVE *BLANK    DBNKAC
     C**********           Z-ADDDCNUM     CNUM                                                CSD027
     C**********           Z-ADD*ZERO     DCNUM                                               CSD027
     C                     MOVE DCNUM     CNUM                                                CSD027
     C                     MOVE *BLANKS   DCNUM                                               CSD027
     C                     MOVE *BLANK    WWBRCA                          S01194
     C                     ENDSR
      *****************************************************************
      /EJECT
     C********************************************************************
     C********************************************************************S01194
     C**********                                                          S01194
     C*****ZSYSTM*SR.**O CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
     C**********                                                          S01194
     C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
     C************                                                        S01194
     C*****SET*UP*KEY FOR INSTALLATION CONTROL RECORD.                    S01194
     C**********           MOVEL'01      'ZTABKY 12                       S01194
     C**********           MOVE '  10'    ZTABKY                          S01194
     C**********                                                          S01194
     C********** ZTABKY    CHAINTABDLI               99    ON NOT THERE   S01194
     C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
     C**********                                                          S01194
     C********** SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
     C**********                                                          S01194
     C**********           ENDSR                                          S01194
     C**********                                                          S01194
     C********************************************************************S01194
      /SPACE 4
     C********************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*   SR: DLBACK - TO CALCULATE RATE FIX DATE FOR FRA/IRS         *
     C*****************************************************************
     C*
     C           DLBACK    BEGSR                           ** DLBACK **
     C*                                                                   S01195
     C* AN EXTRA INPUT FIELD (ZLOC) HAS BEEN ADDED WHICH CONTAINS         S01195
     C* THE RELEVANT BRANCH LOCATION                                      S01195
     C*                                                                   S01195
     C*
     C**  Initialise Work Field
     C                     Z-ADDZINDT     ZINDT   50
     C                     Z-ADDZRFDY     ZRFDY   50
     C                     MOVE ZCCY      ZCCY    3
     C                     Z-ADD0         ZWKFLD  50
     C                     MOVE ZLOC      ZLOC    3                       SO1195
     C**********           MOVE '0'       *IN,99                          S01195
     C*
     C**  Set Rate Fix Date equal to Input Date
     C                     Z-ADDZINDT     ZRFDT   50
     C*
     C**  Perform the following processing until the work field is
     C**  greater than or equal to the Rate Fix Days
     C           ZWKFLD    DOUGEZRFDY
     C*
     C**  If the Rate Fix Days are not equal to zero subtract 1
     C**  from the Rate Fix Date
     C           ZRFDY     IFNE 0
     C                     SUB  1         ZRFDT
     C                     END
     C*
     C**********                                                          S01195
     C****The*following*is*repeated*until*the*resultant*date*is***        S01195
     C****proved*to*be*a*working*day*in*the*relevant*currency.****        S01195
     C****ZDATE5*checks*the*Rate*Fix*Date*for*a*holiday.*The*option       S01195
     C****to*find*a*working*day*in*ZDATE5*is*not*taken.**********         S01195
     C********** *IN99     DOUEQ'0'                        WORKING DAY    S01195
     C**********                                                          S01195
     C**********           Z-ADDZRFDT     ZDAYNO                          S01195
     C**********           MOVE ' '       ZOPT                            S01195
     C**********           EXSR ZDATE5                     (99/HOLIDAY)   S01195
     C**********                                                          S01195
     C****If*the*date*is*a*holiday*(*IN99 = '1')**********                S01195
     C******subtract*1*from*the*Rate*Fix*Date**********                   S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C**********           SUB  1         ZRFDT                           S01195
     C**********           END                                            S01195
     C**********           END                                            S01195
     C**********                                                          S01195
     C*   The following is repeated until the resultant date is proved    S01195
     C*   to be a working day in the relevant currency and location.      S01195
     C*   Uses ZCHKH to check Rate Fix Date for a holiday                 S01195
     C*                                                                   S01195
     C           ZIND      DOUEQ'W'                        WORKING DAY    S01195
     C*                                                                   S01195
     C                     Z-ADDZRFDT     ZDAYNO                          S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
     C* IF DATE IS A HOLIDAY (ZIND = 'H')                                 S01195
     C* SUBTRACT 1 FROM RATE FIX DATE                                     S01195
     C*                                                                   S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SUB  1         ZRFDT                           S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*
     C**  When a working day has been found, add 1 to the Work Field
     C                     ADD  1         ZWKFLD
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZADD    BEGSR                           *** GLZADD ****
     C*
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
     C********************************************************************
      /SPACE 4
     C********************************************************************
     C* SUBROUTINE TO SUBTRACT AN AMOUNT (ZZAMT) FROM THE TOTAL
     C*                                                   (ZZTOTI,ZZTOTD)
     C*  IND '99' IS SET BY AN OVERFLOW ERROR
     CSR         GLZSUB    BEGSR                           *** GLZSUB ****
     C* PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
     CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
     CSR                   EXSR GLZADD                       AND 'ADD'
     CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
     CSR                   ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
     C*
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
     C********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INIT SR.      To access I.C.D. information & check constant  *
      *                data                                           *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ****
      *                                                                   S01194
      ****Access*I.C.D.*record*1**********                                S01194
      **********                                                          S01194
     C**********           EXSR ZSYSTM                                    S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '07'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      07     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*2                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '11'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '08'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      08     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*3                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '20'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '09'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      09     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*5                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '40'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '10'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      10     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*70                                         S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '70'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '11'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      11     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
0327 C* CALL ACCESS PROG. FOR BANK DETAILS.                               S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
0327 C* CALL ACCESS PROG. FOR MODULE DETAILS.                             S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO GET DEALING DETAILS                        S01194
     C*                                                                   S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*                                                                   S01194
     C*   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY                      S01194
     C*                                                                   S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE '1'       *IN98                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
      *                                                                   S01194
0327 C* CALL ACCESS PROG. FOR GENERAL LEDGER DETAILS                      S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM FOR TRADING DETAILS                           S01194
     C*                                                                   S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM FOR RETAIL DETAILS                            S01194
     C           BGRTBN    IFEQ 'Y'                                       064773
     C           BGIOAC    OREQ 'Y'                                       064773
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
      *                                                                   064773
     C                     END                                            064773
     C*                                                                   S01194
      ****Test*constant*data*from*installation*control*data*records       S01194
      **********                                                          S01194
      ****Determine*if*retail*module*is*present*in*system                 S01194
     C***********          TESTB'2'       MODI1          89               E23407
     C***********          TESTB'7'       MODI2          89         E23407S01194
     C************IN89     IFEQ '0'                                 E23407S01194
     C***********          TESTB'2'       MODI5          89         E23407S01194
     C***********          END                                      E23407S01194
      ****If*retail*is*present,*determine*if*retail*account*nos. used     S01194
     C********** *IN89     IFEQ '1'                                       S01194
     C********** RACN      COMP 'Y'                      88               S01194
     C**********           END                                            S01194
      **  If Retail Module is present,                                    S01194
      **  then determine if Retail Account Nos. are used                  S01194
     C           BGRTBN    IFEQ 'Y'                                       S01194
     C           BGIOAC    OREQ 'Y'                                       S01194
     C           BMRANR    COMP 'Y'                      88               S01194
     C                     END                                            S01194
      ****Determine*if*system*is*multibranch*accounting******             S01194
     C********** DFBR      COMP 0                        87               S01194
      ****Determine*if*system*is*multibranch*dealing**********            S01194
     C********** MBIN      COMP 'Y'                      83               S01194
     C*                                                                   S01194
     C* CHECK MULTIBRANCHING ON OR OFF                                    S01194
     C*                                                                   S01194
     C           BGMBIN    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN83                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C* GET USER DETAILS FROM ZMUSER                                      S01194
     C*                                                                   S01194
     C           *NAMVAR   DEFN           ZMUSER                          S01194
     C                     IN   ZMUSER                                    S01194
     C*                                                                   S01194
     C* Check Originating Branch used flag                                S01117
      *                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN87                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* Check Profit Centre used flag                                     S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN11                           S01117
     C                     END                                            S01117
      *                                                                   CIR005
      ** Obtain default message file                                      CIR005
      *                                                                   CIR005
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10                       CIR005
     C                     IN   ZADFMF                                    CIR005
      *                                                                   CIR001
      ** Check if CIR017 - Separate Business Day Convention for SIRS                          CIR017
     C                     CALL 'AOSARDR0'                                                    CIR017
     C                     PARM *BLANKS   PRTCD                                               CIR017
     C                     PARM '*VERIFY' POPTN                                               CIR017
     C                     PARM 'CIR017'  PSARD                                               CIR017
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR017
      **                                                                                      CIR017
     C           PRTCD     IFEQ *BLANKS                                                       CIR017
     C                     MOVE 'Y'       CIR017  1                                           CIR017
     C                     ELSE                                                               CIR017
     C                     MOVE 'N'       CIR017                                              CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
      ** Access AOSARDR0 to check if CIR001 is switched on                CIR001
      *                                                                   CIR001
     C                     CALL 'AOSARDR0'                                CIR001
     C                     PARM *BLANKS   @RTCD   7                       CIR001
     C                     PARM '*VERIFY' @OPTN   7                       CIR001
     C                     PARM 'CIR001'  @SARD   6                       CIR001
     C           SCSARD    PARM SCSARD    DSFDY                           CIR001
      *                                                                   CIR001
     C           @RTCD     IFEQ *BLANKS                                   CIR001
      *                                                                   CIR001
      ** Calculate Event Control Date                                     CIR001
      ** The lesser of - Next Working Day - 1                             CIR001
      **               - Accrual Profit Date                              CIR001
      *                                                                   CIR001
     C           BJDNWD    SUB  1         EVCD    50                      CIR001
     C           BKAPDT    IFLT EVCD                                      CIR001
     C                     MOVE BKAPDT    EVCD                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       CIR001  1                       CIR001
     C                     MOVE '1'       *IN89                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'N'       CIR001                          CIR001
     C                     MOVE '0'       *IN89                           CIR001
     C                     END                                            CIR001
      *                                                                   108624
      ** Call Access Program for FRA/IRS I.C.D. details                   108624
      *                                                                   108624
     C                     CALL 'AOFAISR0'                                108624
     C                     PARM '*DBERR ' @RTCD                           108624
     C                     PARM '*FIRST ' @OPTN                           108624
     C           SDFAIS    PARM SDFAIS    DSFDY                           108624
     C*                                                                   S01117
      **  Set up workstation ID field for display on all screens
      *
     C                     MOVE WSID      SWSID
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP5                                           S01408
     C*                                                                   S01408
      *
      *                                                                   CEU003
      ** Determine if SAR CEU003 EMU Dealing Settlement Ccy Conversion    CEU003
      ** is installed.                                                    CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   P@RTCD                          CEU003
     C                     PARM '*VERIFY 'P@OPTN                          CEU003
     C                     PARM 'CEU003'  P@SARD  6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR004
      ** Access Switchable Features Details                               CIR004
      *                                                                   CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   PRTCD   7                       CIR004
     C                     PARM '*VERIFY 'POPTN   7                       CIR004
     C                     PARM 'CIR004'  PSARD   6                       CIR004
     C           SCSARD    PARM SCSARD    DSSDY                           CIR004
     C           PRTCD     IFEQ *BLANKS                                   CIR004
     C                     MOVE 'Y'       CIR004  1                       CIR004
     C                     ELSE                                           CIR004
     C                     MOVE 'N'       CIR004                          CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR005
      ** Determine if SAR CIR005 Business Day Conventions is ins -        CIR005
      ** talled.                                                          CIR005
      *                                                                   CIR005
     C                     CALL 'AOSARDR0'                                CIR005
     C                     PARM *BLANKS   @RTCD                           CIR005
     C                     PARM '*VERIFY '@OPTN                           CIR005
     C                     PARM 'CIR005'  @SARD                           CIR005
     C           SCSARD    PARM SCSARD    DSFDY                           CIR005
      *                                                                   CIR005
     C           @RTCD     IFNE *BLANKS                                   CIR005
     C           @RTCD     ANDNE'*NRF   '                                 CIR005
     C                     MOVEL'SCSARDPD'DBFILE                          CIR005
     C                     Z-ADD33        DBASE                           CIR005
     C                     MOVEL'CIR005'  DBKEY                           CIR005
     C                     EXSR *PSSR                                     CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           @RTCD     IFEQ *BLANKS                                   CIR005
     C                     MOVE 'Y'       CIR005  1                       CIR005
     C                     ELSE                                           CIR005
     C                     MOVE 'N'       CIR005                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVE 'N'       WBDCPS  1                       CIR005
     C                     MOVE 'N'       WWARNG  1                       CIR005
     C                     MOVE *BLANK    PIRSBS                          CIR005
      *                                                                   CIR005
      ** Initialise screen message queue.                                 CIR005
      *                                                                   CIR005
     C                     MOVEL*BLANKS   ZAMSDA                          CIR005
     C                     EXSR SRCLR                                     CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      *                                                                   CDE001
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   @RTCD                           CDE001
     C                     PARM '*VERIFY' @OPTN                           CDE001
     C                     PARM 'CDE001'  @SARD                           CDE001
     C           @RTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           @RTCD     IFNE '*NRF    '                                CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD29        DBASE            * DBERR 29 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CIR006
      ** Determine if switchable feature CIR006 is ON.                    CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY' @OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD                           CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     MOVE *ON       *IN31                           CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     MOVE *OFF      *IN31                           CIR006
     C           @RTCD     IFNE '*NRF    '                                CIR006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CIR006
     C                     Z-ADD34        DBASE            * DBERR 34 *   CIR006
     C                     MOVEL'CIR006'  DBKEY            ************   CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                                       CSW201
      ** Check if enhancement CSW201 is on                                                    CSW201
      *                                                                                       CSW201
     C                     MOVE *IN01     WINDIC  1                                           CSW201
     C                     CALL 'SWIF2001'             01                                     CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           *IN01     IFEQ '1'                                                           CSW201
     C                     Z-ADD40        DBASE            ***************                    CSW201
     C                     MOVEL'SCSARDPD'DBFILE           * DBERROR 40  *                    CSW201
     C                     MOVEL'CSW201'  DBKEY            ***************                    CSW201
     C                     MOVEL'DL1604I' DBPGM                                               CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
     C                     MOVE WINDIC    *IN01                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Determine if SAR CAP041 is installed                                                 CAP041
      *                                                                                       CAP041
     C                     CALL 'AOSARDR0'                                                    CAP041
     C                     PARM *BLANKS   @RTCD                                               CAP041
     C                     PARM '*VERIFY '@OPTN                                               CAP041
     C                     PARM 'CAP041'  @SARD                                               CAP041
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP041
      *                                                                                       CAP041
     C           @RTCD     IFNE *BLANKS                                                       CAP041
     C           @RTCD     ANDNE'*NRF   '                                                     CAP041
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP041
     C                     Z-ADD41        DBASE                                               CAP041
     C                     MOVEL'CAP041'  DBKEY                                               CAP041
     C                     EXSR *PSSR                                                         CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
     C           @RTCD     IFEQ *BLANKS                                                       CAP041
     C                     MOVE 'Y'       CAP041  1                                           CAP041
     C                     ELSE                                                               CAP041
     C                     MOVE 'N'       CAP041                                              CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CRE009
      ** Determine if SAR CRE009 is installed                                                 CRE009
      *                                                                                       CRE009
     C                     CALL 'AOSARDR0'                                                    CRE009
     C                     PARM *BLANKS   @RTCD                                               CRE009
     C                     PARM '*VERIFY '@OPTN                                               CRE009
     C                     PARM 'CRE009'  @SARD                                               CRE009
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE009
      *                                                                                       CRE009
     C           @RTCD     IFEQ *BLANKS                                                       CRE009
     C                     MOVE 'Y'       CRE009  1                                           CRE009
     C                     ELSE                                                               CRE009
     C                     MOVE 'N'       CRE009                                              CRE009
     C                     ENDIF                                                              CRE009
      *                                                                                       CRE009
     C/COPY WNCPYSRC,DL1604IC81
      *                                                                   CDE001
      *                                                                                       CAP205
      ** Determine if SAR CAP205 Teller Related APIs - Account Balance Check                  CAP205
      ** is installed.                                                                        CAP205
      *                                                                                       CAP205
     C                     MOVEL'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY '@OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVEL'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE *BLANKS                                                       CAP205
     C           @RTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP205
     C                     Z-ADD38        DBASE                                               CAP205
     C                     MOVEL'CAP205'  DBKEY                                               CAP205
     C                     EXSR *PSSR                                                         CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     MOVEL*BLANK    W#MTYP  1                                           CAP205
      *                                                                                       CAP205
     C                     ENDSR
      ********************************************************************
      ****CT**                                                            S01199
      *****************************************************************   S01199
      ***SCRNA**SR.****To*write*/*read*initial*screen*'A'*&*control*  *   S01199
      *****************HELP*facility********                          *   S01199
      ******                                                          *   S01199
      *****************************************************************   S01199
     C*****      SCRNA     BEGSR                           ***  SCRNA ****S01199
      *****                                                               S01199
     C*****                EXFMTDL1600FA                                  S01199
      ***If*'HELP'*requested,*call*MHELP*pgm**********                    S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ DL1600FA                 86               S01199
     C**********           END                                            S01199
      **********                                                          S01199
     C******               ENDSR                                          S01199
      ********************************************************************S01199
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SCRNQ  SR.    To write / read  RL 1st insert/amend screen 'Q'*
      *                & control HELP facility                        *
      *****************************************************************
     C           SCRNQ     BEGSR                           ***  SCRNQ ****
     C*                                                                   S01157
     C* RESET FLOOR & CEILING INDICATORS                                  S01157
     C*                                                                   S01157
     C                     MOVE '0'       *IN09                           S01157
     C                     MOVE '0'       *IN30                           S01157
     C                     MOVE '0'       *IN33                           S01157
     C*                                                                   S01157
     C* IF DEAL IS A CAP DO NOT OUTPUT FLOOR OR COLLAR                    S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C                     MOVE '1'       *IN09                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF DEAL IS A FLOOR DO NOT OUTPUT COLLAR OR CAP                    S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RF'                                      S01157
     C                     MOVE '1'       *IN30                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF DEAL IS A COLLAR SET TITLE AS COLLAR                           S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RR'                                      S01157
     C                     MOVE '1'       *IN33                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     WRITE#MSGCTL                                   CIR005
     C                     ENDIF                                          CIR005
      *
     C/COPY WNCPYSRC,DL1604IC49
     C                     EXFMTDL1600FQ
     C/COPY WNCPYSRC,DL1604IC50
      ***If*'HELP'*requested,*call*MHELP*pgm**********                    S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ DL1600FQ                 86               S01199
     C**********           END                                            S01199
      **********                                                          S01199
      *
     C                     ENDSR
      ********************************************************************
      ***ACE*3                                                            S01199
      *****************************************************************   S01199
      ******                                                          *   S01199
      ***SCRNR  SR.    To write / read  RL 2nd insert/amend screen 'R'*   S01199
      *****************&*control*HELP*facility**********              *   S01199
      *****************************************************************   S01199
     C*****      SCRNR     BEGSR                           ***  SCRNR ****S01199
      *****                                                               S01199
     C*****                EXFMTDL1600FR                                  S01199
      ***If*'HELP'*requested,*call*MHELP*pgm**********                    S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ DL1600FR                 86               S01199
     C**********           END                                            S01199
      **********                                                          S01199
      *****                                                               S01199
     C*****                ENDSR                                          S01199
      ********************************************************************S01199
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALD12  SR.   To validate 1st RL insert screen               *
      *                                                               *
      *****************************************************************
      *
     C           VALD12    BEGSR                           *** VALD12 ****
      *
      * DO NOT VALIDATE, IF warning errors only
      *                 AND  data not changed.
      *
     C                     MOVE '0'       *IN,84
      *
     C           *IN07     IFEQ '1'
     C           *IN05     ANDEQ'0'
     C           SCRN1     ANDEQSAV1
     C           CIR005    ANDEQ'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           *IN07     ANDEQ*ON                                       CIR005
     C           *IN05     ANDEQ*OFF                                      CIR005
     C           SCRN1     ANDEQSAV1                                      CIR005
     C           WVLBDC    ANDEQ'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           CIR017    ANDEQ'N'                                                           CIR017
     C           *IN07     ANDEQ*ON                                       CIR005
     C           *IN05     ANDEQ*OFF                                      CIR005
     C           SCRN1     ANDEQSAV1                                      CIR005
     C           PIRSBS    ANDEQWPREV                                     CIR005
     C           WVLBDC    ANDEQ'Y'                                       CIR005
      *                                                                                       CIR017
      ** IF CIR017 = 'Y', compare with WPREV2                                                 CIR017
     C           CIR005    OREQ 'Y'                                                           CIR017
     C           CIR017    ANDEQ'Y'                                                           CIR017
     C           *IN07     ANDEQ*ON                                                           CIR017
     C           *IN05     ANDEQ*OFF                                                          CIR017
     C           SCRN1     ANDEQSAV1                                                          CIR017
     C           PIRSBS    ANDEQWPREV2                                                        CIR017
     C           WVLBDC    ANDEQ'Y'                                                           CIR017
     C                     MOVE '1'       *IN,84
     C                     END
      *
     C/COPY WNCPYSRC,DL1604IC66
      **
      **  Execute sub-routine SETOF to clear all indicators.
      *
     C                     EXSR SETOF
      **  Initialisation.
     C                     MOVE *BLANKS   XTEST6
     C                     MOVE *BLANKS   XTEST2
     C                     MOVE '0'       HIGHZ6
     C                     MOVE '0'       HIGHZ2
     C                     MOVE *BLANKS   ZFIELD
     C*********************MOVE *BLANKS   ZTABKY                          S01194
      *
     C           *IN84     CABEQ'1'       V12END             >>>>>>>>>>>>>
      /SPACE 3
      *
      /SPACE 3
      **
     C/COPY WNCPYSRC,DL1604C13                                            S01408
      ** Validate Deal sub-type.
      **
      *
     C           SDLST     IFNE *BLANKS
      ***Set*up*Key*for*PF/TABLET5.**********                             S01194
     C**********           MOVE *BLANKS   KEY                             S01194
     C**********           MOVE SDLST     KEY                             S01194
     C**********           MOVEL'42'      KEY                             S01194
     C********** KEY       CHAINTABDLI               85                   S01194
      *                                                                   S01194
     C** Call Access Program for Deal Sub-types                           S01194
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM *BLANK    @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM SDLST     @DLST   2                       S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
      *                                                                   S01194
     C                     END
     C*                                                                   S01194
      ** If Deal sub-type is blank, the sub-type is not found
      ** indicate an error.                                               S01194
      ***or*the*record*is*not*'live'*indicate*an*error.*****              S01194
     C           SDLST     IFEQ *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP6                                           S01408
     C*                                                                   S01408
     C********** *IN85     OREQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C           @RTCD     ORNE *BLANKS                                   S01194
     C                     ADD  1         S
     C                     MOVE ' 010'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN13
     C******************** MOVE '0'       *IN85                           S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     MOVELASDSTC    SDLST                           S01194
      *                                                                   S01194
      *                                                                                       186676
      ** *----------------------------------------*                                           186676
      ** * Validate Deal type/subtype combination *                                           186676
      ** *----------------------------------------*                                           186676
      *                                                                                       186676
      ** Deal type/subtype validation KLIST                                                   186676
      *                                                                                       186676
     C           @DTSTK    KLIST                                                              186676
     C                     KFLD           SDTYP                                               186676
     C                     KFLD           SDLST                                               186676
      *                                                                                       186676
     C                     MOVEA*IN,65    SIN65   1                                           186676
      *                                                                                       186676
      **  Record must exist on FDDTSTL1                                                       186676
      *                                                                                       186676
     C           @DTSTK    CHAINFDDTSTL1             65                                       186676
      *                                                                                       186676
      **  If no record found, the deal type/sub type is invalid                               186676
      *                                                                                       186676
     C           *IN65     IFEQ '1'                                                           186676
     C           RCID11    OREQ '*'                                                           186676
     C                     ADD  1         S                                                   186676
     C                     MOVE ' 090'    ERCD,S                                              186676
     C                     MOVE '1'       *IN05                                               186676
     C                     MOVE '1'       *IN13                                               186676
      *                                                                                       186676
     C                     ENDIF                                                              186676
     C                     MOVE SIN65     *IN65                                               186676
      *                                                                                       186676
     C                     END
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC15                                           S01408
      *                                                                   S01408
      *
      /SPACE 3
      **
      ** Validate Deal Date using Standard sub-routine ZDATE1.
      **
      *
      ** Test if deal date is numeric.
     C                     MOVELSDDAT     XTEST6
     C                     EXSR XNTEST
     C           *IN84     IFEQ '1'
     C                     MOVE SDDAT     ZDATE
     C                     EXSR ZDATE1
     C                     END
      ** If invalid Deal Date...
     C           *IN99     IFEQ '1'
     C           *IN84     OREQ '0'
     C                     ADD  1         S
     C                     MOVE ' 011'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN14
     C                     MOVE '0'       *IN99
     C                     ELSE
      ** Deal date is in error if greater than run date.
     C***********ZDAYNO****IFGT RUND                                      S01194
     C           ZDAYNO    IFGT BJRDNB                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 012'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN14
      *
     C*********************ELSE                                           S01195
      *********************                                               S01195
      ***Indicate*that*next working day is NOT required and               S01195
      ***confirm*that*date*is not a holiday in Local Currency             S01195
      ***using*Standard*sub-routine ZDATE5. (LOCY on PF/TABTB11)          S01195
     C*********************MOVE 'N'       ZOPT                            S01195
     C*********************MOVE LOCY      ZCCY                            S01195
     C*********************EXSR ZDATE5                                    S01195
     C************IN99*****IFEQ '1'                                       S01195
     C*********************ADD  1         S                               S01195
     C*********************MOVE ' 013'    ERCD,S                          S01195
     C*********************MOVE '1'       *IN05                           S01195
     C*********************MOVE '1'       *IN14                           S01195
     C*********************MOVE '0'       *IN84                           S01195
     C*********************END                                            S01195
     C                     END
     C                     END
      *                                                                   S01195
      ***(*If*valid,save*Deal*date*as*midas*day*no.*for*file*output*)*    S01195
     C*****      *IN14     IFEQ '0'                                       S01195
     C*****                Z-ADDZDAYNO    DDATX   50                      S01195
     C*****                END                                            S01195
      *
      /SPACE 3
      *********************                                               S01117
      ***Validate*the*branch code.                                        S01117
      *********************                                               S01117
      ***If*the*Default*Branch*Code is not 000.                           S01117
     C************IN87*****IFEQ '0'                                       S01117
     C*********************MOVE DFBR      WBRCD   3                       S01117
     C***********SBRCD*****IFNE WBRCD                                     S01117
     C***********SBRCD*****ANDNE*BLANKS                                   S01117
     C*********************ADD  1         S                               S01117
     C*********************MOVE ' 014'    ERCD,S                          S01117
     C*********************MOVE '1'       *IN05                           S01117
     C*********************MOVE '1'       *IN15                           S01117
     C*********************END                                            S01117
     C*********************ELSE                                           S01117
      ***If*the*Default*Branch Code is 000.                               S01117
     C***********SBRCD*****IFEQ *BLANKS                                   S01117
     C*********************ADD  1         S                               S01117
     C*********************MOVE ' 015'    ERCD,S                          S01117
     C*********************MOVE '1'       *IN05                           S01117
     C*********************MOVE '1'       *IN15                           S01117
     C*********************ELSE                                           S01117
     C*********************MOVE SBRCD     WBRCD                           S01117
     C*********************END                                            S01117
     C*********************END                                            S01117
      *********************                                               S01117
     C************IN15*****IFEQ '0'                                       S01117
      ***Set*up*key*and*chain to Table File. (PF/TABLETR)                 S01117
     C*********************MOVE *BLANKS   KEY                             S01117
     C*********************MOVEL'10'      KEY                             S01117
     C*********************MOVE WBRCD     KEY                             S01117
     C***********KEY*******CHAINTABDLI               85                   S01117
      ***If*a*live*record*is not found....                                S01117
     C************IN85*****IFEQ '1'                                       S01117
     C***********RECI******ORNE 'D'                                       S01117
     C***********SBRCD*****IFEQ *BLANKS                                   S01117
      **Default*Branch*Code is not on Table File.                         S01117
     C************LOCK*****IN   LDA                                       S01117
     C*********************MOVE '06'      DBASE            ***************S01117
     C*********************MOVE 'TABLE'   DBFILE           *   DBERROR   *S01117
     C*********************MOVELKEY       DBKEY            *      06     *S01117
     C*********************EXSR DBERR                      ***************S01117
      *********************                                               S01117
     C*********************ADD  1         S                               S01117
     C*********************MOVE ' 016'    ERCD,S                          S01117
     C*********************MOVE '1'       *IN05                           S01117
     C*********************MOVE '1'       *IN15                           S01117
     C*********************MOVE '0'       *IN85                           S01117
     C*********************END                                            S01117
     C*********************END                                            S01117
     C*********************END                                            S01117
      *                                                                   S01117
      /SPACE 3                                                            S01117
     C/COPY WNCPYSRC,DL1604IC11                                           S01408
      **                                                                  S01117
      ** Validate booking branch code                                     S01117
      **                                                                  S01117
      *                                                                   S01117
      ** If multibranching is used                                        S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      ** If booking branch is blank, set to default branch                S01117
     C           SBRCA     IFEQ *BLANKS                                   S01117
     C                     MOVE ZDBRN     SBRCA                           S01117
     C                     END                                            S01117
      *                                                                   S01194
      ** Call access program for branch codes                             S01194
     C**********           CALL 'AOBRCHR0'                                S01194              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY'    @OPTN                           S01194
     C                     PARM SBRCA     @BRCH   3                       S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01194
      ** Booking branch code not found                                    S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 016'    ERCD,S                          S01194
     C                     MOVE '1'       *IN05                           S01194
     C                     MOVE '1'       *IN15                           S01194
     C                     ELSE                                           S01117
      *                                                                   S01194
     C                     MOVELA8BRCD    SBRCA                           S01194
      *                                                                   S01117
      ** Check user authorised to booking branch / action code            S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACCD     ZACTN   1                       S01117
     C                     PARM SBRCA     ZBR     3                       S01117
     C                     PARM           ERR     10                      S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                                         S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     MOVE '1'       *IN15                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 403'    ERCD,S                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C           ERR       IFEQ 2                                         S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     MOVE '1'       *IN15                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 404'    ERCD,S                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** If multibranching not used, set Booking Branch to Single         S01117
      ** Branch(will not be displayed).                                   S01117
      *                                                                   S01117
     C                     MOVE BJSBRC    SBRCA                           S01117
     C                     END                                            S01117
      *                                                                   S01117
      /SPACE 3                                                            S01195
      *                                                                   S01195
      ** Since Booking Branch has been validated,                         S01195
      ** validation of Deal Date is continued                             S01195
      *                                                                   S01195
      ** If no errors on Booking Branch and Deal Date                     S01195
     C           *IN14     IFEQ '0'                                       S01195
     C           *IN15     ANDEQ'0'                                       S01195
      *                                                                   S01195
      ** Check Deal Date is a holiday for the relevent location           S01195
      **     and relevent currency using the sub-routine ZCHKH            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     MOVE A8LCCD    ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         S                               S01195
     C                     MOVE ' 013'    ERCD,S                          S01195
     C                     MOVE '1'       *IN05                           S01195
     C                     MOVE '1'       *IN14                           S01195
     C                     MOVE '0'       *IN84                           S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      *  ( If valid,save Deal date as midas day no. for file output )     S01195
     C           *IN14     IFEQ '0'                                       S01195
     C                     Z-ADDZDAYNO    DDATX   50                      S01195
     C                     END                                            S01195
      *
      /SPACE 3
      **
      ** Validate Broker Code.
      **
      *
      ** Broker code may be TELX , PHON , MAIL or a valid code
      ***from*PF/TABLET1*********                                         S01194
     C           SBRKC     IFEQ *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 017'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN16
     C                     ELSE
     C           SBRKC     IFNE 'TELX'
     C           SBRKC     ANDNE'PHON'
     C           SBRKC     ANDNE'MAIL'
      ***Set*up*key*to*table file. (TABDLI / T1)                          S01194
     C*********************MOVE *BLANKS   KEY                             S01194
     C*********************MOVEL'80'      KEY                             S01194
     C*********************MOVE SBRKC     KEY                             S01194
     C***********KEY*******CHAINTABDLI               85                   S01194
      *                                                                   S01194
     C** Call Access Program for Broker Codes                             S01194
     C                     CALL 'AOBROKR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM SBRKC     @SBRKC  4                       S01194
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
      *                                                                   S01194
      ** Check for a record which exists and is live.
     C************IN85*****IFEQ '1'                                       S01194
     C***********RECI******ORNE 'D'                                       S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 017'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN16
     C*********************MOVE '0'       *IN85                           S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     MOVELA9BROK    SBRKC                           S01194
      *                                                                   S01194
     C                     END
     C                     END
      *
     C                     END
      *
      /SPACE 3
      **
      ** If Broker Code is valid,check Brokerage amount.
      **
      *
     C           *IN16     IFEQ '0'
      *
      ** If Broker Code is TELX,PHON or MAIL,Brokerage amount
      ** must be blank.
     C                     Z-ADD0         BAGEX
      *
     C           SBRKC     IFEQ 'TELX'
     C           SBRKC     OREQ 'PHON'
     C           SBRKC     OREQ 'MAIL'
     C           SBAGE     IFNE *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 018'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN17
     C                     END
     C                     ELSE
      ** or a valid Broker Code must have been entered. In this
      ** case Brokerage Amount must be 'NIL' or validated using
      ** Standard sub-routine ZALIGN.
     C           SBAGE     IFNE 'NIL'
     C           SBAGE     ANDNE*BLANKS                                   DT0169
     C*********************MOVE *BLANKS   KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELBKCY      WRK4                            S01194
     C*********************MOVE '1'       KEY                             S01194
     C***********KEY*******CHAINTABDLI               85                   S01194
      *                                                                   S01194
     C** Call Access Program for Currency Details                         S01194
     C**      to Obtain Currency Decimal Places                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR  '@RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM A9BRCY    @BKCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
      ** Chain should not fail,but Access Program will handle             S01194
      ** corrupt files and produce a Dump.                                S01194
      ***Chain*should*not*fail,but*allow*for*corrupt*files.*****          S01194
     C************IN85*****IFEQ '1'                                       S01194
     C***********RECI******ORNE 'D'                                       S01194
     C************LOCK*****IN   LDA                                       S01194
     C*********************MOVE '07'      DBASE            ***************S01194
     C*********************MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C*********************MOVELKEY       DBKEY            *      07     *S01194
     C*********************EXSR DBERR                      ***************S01194
     C*********************SETOF                     85                   S01194
     C******************** ELSE                                           S01194
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSBAGE     ZFIELD
     C*********************Z-ADDCDP       ZADEC                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C***********13********SUB  CDP       ZADIG                           S01194
     C           13        SUB  A6NBDP    ZADIG                           S01194
     C                     MOVE 'Y'       ZAOPT
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    BAGEX  130
     C                     END
     C           *IN99     IFEQ '1'
     C           BAGEX     ORLE 0
     C                     Z-ADD0         BAGEX
     C                     ADD  1         S
     C                     MOVE ' 019'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN17
     C                     END
     C****************     END                                            S01194
     C                     END
     C                     END
      *
     C                     END
      /SPACE 3
      **
      ** Validate linked deal number is numeric.
      **
      *
     C           SLNKDN    IFNE *BLANKS
     C                     MOVE SLNKDN    XTEST6
     C                     EXSR XNTEST
     C           *IN84     IFEQ '0'
     C           SLNKDN    OREQ '000000'                                  046961
     C                     ADD  1         S
     C                     MOVE ' 020'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN18
      *
     C* /COPY MEMBER DL1604IEXV  - VALIDATE LINKED REF NO.                S01408
     C/COPY WNCPYSRC,DL1604IEXV                                           S01408
      *
     C                     END
     C                     MOVE '0'       *IN84
     C                     END
      *
      /SPACE 3
     C/COPY WNCPYSRC,DL1604IC12                                           S01408
      **
      ** Validate Customer Number or Short Name as entered.
      **
      *
      ** A value must be entered.
      *
     C           SCNUM     IFEQ *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 021'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN19
     C                     ELSE
      ***First*character*of*shortname*must*be*'alpha'.**********          S01194
      **********                                                          S01194
     C**********           MOVELSCNUM     CNUM1   1                       S01194
      ***HEX*value*of*letters*is*less*than*that*of*numbers**********      S01194
     C********** CNUM1     IFLT '0'                                       S01194
     C********** SCNUM     CHAINSNAME                85                   S01194
     C**********                                                          S01194
      ***If*the*chain*fails*,or*the*record*is*not*live*,report an error.  S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C**********           ADD  1         S                               S01194
     C**********           MOVE ' 022'    ERCD,S                          S01194
     C**********           MOVE '1'       *IN05                           S01194
     C**********           MOVE '1'       *IN19                           S01194
     C**********           MOVE '0'       *IN85                           S01194
     C**********           ELSE                                           S01194
      **********                                                          S01194
      **********                                                          S01194
      ***If*the*customer*details*are*found*,check*that*it*is*not*a*parent.S01194
     C**********           TESTB'2'       CMIN           84               S01194
     C********** *IN84     IFEQ '1'                                       S01194
     C**********           MOVE '0'       *IN84                           S01194
     C**********           ADD  1         S                               S01194
     C**********           MOVE ' 024'    ERCD,S                          S01194
     C**********           MOVE '1'       *IN05                           S01194
     C**********           MOVE '1'       *IN19                           S01194
     C**********           END                                            S01194
     C**********           END                                            S01194
      **********                                                          S01194
     C**********           ELSE                                           S01194
      ***If*the*first*character*is*a*number*,check*that*the*first six     S01194
      ***characters*are*numeric*and*the*last*four*are*blanks.             S01194
      **********                                                          S01194
     C**********           MOVE SCNUM     CNUM4   4                       S01194
     C**********           MOVELSCNUM     XTEST6                          S01194
     C**********           EXSR XNTEST                                    S01194
     C********** *IN84     IFEQ '0'                                       S01194
     C********** CNUM4     ORNE *BLANKS                                   S01194
     C**********           ADD  1         S                               S01194
     C**********           MOVE ' 021'    ERCD,S                          S01194
     C**********           MOVE '1'       *IN05                           S01194
     C**********           MOVE '1'       *IN19                           S01194
     C**********           ELSE                                           S01194
      ***move*the*alpha*field*into*a*numeric*work*field*for*chaining.     S01194
      **********                                                          S01194
     C**********           MOVE XTEST6    XCNUM   60                      S01194
     C********** XCNUM     CHAINCLINT                85                   S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C**********           MOVE '1'       *IN19                           S01194
     C**********           MOVE '0'       *IN85                           S01194
     C**********           ADD  1         S                               S01194
     C**********           MOVE ' 023'    ERCD,S                          S01194
     C**********           MOVE '1'       *IN05                           S01194
     C**********           ELSE                                           S01194
      *                                                                   S01194
     C** Call Access Program for Customer Details using the Customer      S01194
     C** No. or the Customer Shortname.                                   S01194
      *                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SCNUM     @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If Db error or Customer No./Customer Shortname does not exist... S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           @KYST     OREQ '*ERROR'                                  S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 022'    ERCD,S                          S01194
     C                     MOVE '1'       *IN05                           S01194
     C                     MOVE '1'       *IN19                           S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
      ** If a question mark is entered, set the Customer                  S01194
      ** Number selected by the user (via the Access Object               S01194
      ** Program AOCUSTR0) to the screen field.                           S01194
      *                                                                   S01194
     C                     MOVELSCNUM     @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVEL*BLANKS   SCNUM                           S01194
     C                     MOVELBBCUST    SCNUM                           S01194
     C                     END                                            S01194
      *                                                                   S01194
      ** If the record is found check that the customer is not a parent.
      *
     C**********           TESTB'2'       CMIN           84               S01194
     C********** *IN84     IFEQ '1'                                       S01194
     C**********           MOVE '0'       *IN84                           S01194
     C********** BBPAIN    IFEQ 'Y'                                 S01194046960
     C           BBPAIN    IFEQ 'P'                                       046960
     C                     ADD  1         S
     C                     MOVE ' 024'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN19
     C                     END
     C                     END
     C                     END
     C**********           END                                            S01194
     C**********           END                                            S01194
     C**********           END                                            S01194
      *
      *  ( If valid, save Customer no. for file output )
     C           *IN19     IFEQ '0'
     C*********************Z-ADDCNUM      CNUMX   60                      S01194
     C**********           MOVELBBCUST    CNUMX   60                                   S01194 CSD027
     C                     MOVELBBCUST    CNUMX   6                                           CSD027
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP7                                           S01408
     C*                                                                   S01408
      *
      /SPACE 3
      *  Save details of deal to shadow post later.                       S01154
      *                                                                   S01154
     C**  E20918 - Saving the right detail                                E20918
     C**********           MOVE DTYP      TRYP                     S01154 E20918
     C**********           MOVE DLNO      TNMR                     S01154 E20918
     C                     MOVE NEWDT     TRYP                            E20918
     C                     MOVE NEWDL     TNMR                            E20918
      **
      ** Validate Value Date using Standard sub-routine ZDATE1.
      **
      *
     C           SVDAT     IFNE *BLANKS
     C                     MOVE SVDAT     XTEST6
     C                     EXSR XNTEST
     C           *IN84     IFEQ '1'
     C                     MOVE SVDAT     ZDATE
     C                     EXSR ZDATE1
     C                     END
     C                     END
     C           SVDAT     IFEQ *BLANKS
     C           *IN84     OREQ '0'
     C           *IN99     OREQ '1'
     C                     ADD  1         S
     C                     MOVE ' 025'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN20
     C                     MOVE '0'       *IN99
     C                     END
     C                     MOVE '0'       *IN84
      *
      *  ( If valid, save Value date as midas day no. for file output )
     C           *IN20     IFEQ '0'
     C                     MOVE ZDAYNO    VDATX   50
     C                     END
      *
      /SPACE 2
      **
      ** Check Value Date against Deal Date and Run Date if Deal
      ** Date is valid.
      **
     C* Must be *GE run date
     C*  and   *GE deal date
      *
     C           *IN14     IFEQ '0'
     C           VDATX     IFLT DDATX
     C                     ADD  1         S
     C                     MOVEA' 097'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN20
     C                     END
     C                     END
      *
      /SPACE 3
      *
      ** Validate Maturity Date using Standard sub-routine ZDATE1.
     C           SMDAT     IFNE *BLANKS
     C                     MOVE SMDAT     XTEST6
     C                     EXSR XNTEST
     C           *IN84     IFEQ '1'
     C                     MOVE SMDAT     ZDATE
     C                     EXSR ZDATE1
     C                     END
     C                     END
     C           SMDAT     IFEQ *BLANKS
     C           *IN84     OREQ '0'
     C           *IN99     OREQ '1'
     C                     ADD  1         S
     C                     MOVE ' 027'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN21
     C                     MOVE '0'       *IN99
     C                     END
     C                     MOVE '0'       *IN84
      *
      *
      *  ( If valid, save Mat. date as midas day no. for file output )
     C           *IN21     IFEQ '0'
     C                     MOVE ZDAYNO    MDATX   50
     C                     END
      /SPACE 1
      *
      ** Check Maturity Date against Value Date if Value
      ** Date is valid.
      *
      *
     C           *IN20     IFEQ '0'
     C           *IN21     ANDEQ'0'
     C****       MDATX     ANDLTVDATX                                     S01157
     C           MDATX     ANDLEVDATX                                     S01157
     C                     ADD  1         S
     C                     MOVE ' 028'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN21
     C                     MOVE '1'       *IN20
     C                     END
      *
      ** Check Maturity Date against Run Date if Average Rate
      *
     C           *IN21     IFEQ '0'
     C           SAVRAM    ANDEQ'Y'
     C******     MDATX     ANDLTRUND                                      S01194
     C           MDATX     ANDLTBJRDNB                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 220'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN21
     C                     END
      *
      /SPACE 3
      **
      ** Validate Account Sequence Number.
      **
      *
     C           SCDAS     IFNE *BLANKS
     C                     MOVE SCDAS     XTEST2
     C                     TESTN          TESTX2     84
     C/COPY WNCPYSRC,DL1604IC69
     C           *IN84     IFEQ '0'
     C           SCDAS     ORLT '00'
     C                     ADD  1         S
     C                     MOVE ' 029'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN22
     C******************** ELSE                                           S01194
      *
      ***If*the*System*is*Multi*Branch*,*check*that*the*field*is****      S01194
      ***within*the*range*on*PF/TABLETR.******                            S01194
     C***********MBIN******IFEQ 'Y'                                       S01194
     C*********************MOVE SCDAS     WCDAS   20                      S01194
     C***********WCDAS*****IFLT NSACS                                     S01194
     C***********WCDAS*****ORGT NEACS                                     S01194
     C*****                ADD  1         S                               S01194
     C*****                MOVE ' 095'    ERCD,S                          S01194
     C*****                MOVE '1'       *IN05                           S01194
     C*****                MOVE '1'       *IN22                           S01194
     C*****                END                                            S01194
     C*****                END                                            S01194
     C                     END
     C/COPY WNCPYSRC,DL1604IC70
     C                     END
     C                     MOVE '0'       *IN84
      *
      /SPACE 3
      **
      ** Validate Currency.
      **
     C*********************MOVE '0'       *IN85                           S01194
     C*********************MOVE 'D'       RECI                            S01194
      *
     C           SUCUCY    IFNE *BLANKS
      ***Set*up*key*to*Table file.(PF/TABTG10)                            S01194
     C*********************MOVE *BLANKS   KEY                             S01194
     C*********************MOVEL'20'      KEY                             S01194
     C*********************MOVELSUCUCY    WRK4                            S01194
     C*********************MOVE '1'       KEY                             S01194
     C***********KEY*******CHAINTABDLI               85                   S01194
     C** Call Access Program for Currency Details                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM SUCUCY    @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C************IN85*****IFEQ '0'                                       S01194
     C***********RECI******ANDEQ'D'                                       S01194
     C           @RTCD     IFEQ *BLANK                                    S01194
     C***********DCCY******ANDNE'Y'                                       S01194
     C           A6DLCI    ANDNE'Y'                                       S01194
     C                     ADD  1         S
     C                     MOVE ' 031'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN23
     C                     END
     C                     END
      ** If a live record is not found or the currency is blank
      ** report an error.
     C********** *IN85     IFEQ '1'                                       S01194
     C***********RECI******ORNE 'D'                                       S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           SUCUCY    OREQ *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 030'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN23
     C                     ELSE                                           S01194
      ***********                                                  CEU003 134935
      ***If*value*date*is*earlier*than*the*EMU*transition*start*datCEU003 134935
      ***then*it*should*not*be*defined*as*an*'In'*currency.*       CEU003 134935
      ***********                                                  CEU003 134935
     C***********A6TPSD    IFGT VDATX                              CEU003 134935
     C************IN20     ANDEQ'0'                                CEU003 134935
     C***********          MOVE 'N'       WSUCIN  1                CEU003 134935
     C***********          ELSE                                    CEU003 134935
     C***********          MOVELA6INCY    WSUCIN                   CEU003 134935
     C                     MOVELA6INCY    WSUCIN  1                       134935
     C***********          ENDIF                                   CEU003 134935
      *                                                                   S01194
     C                     MOVELA6CYCD    SUCUCY                          S01194
     C                     END
     C*                                                                   046958
     C** CHECK IF MATURITY DATE IS A HOLIDAY IN LOCAL CCY                 046958
     C*                                                                   046958
     C           *IN21     IFEQ '0'                                       046958
     C                     MOVE MDATX     ZDAYNO                          046958
     C                     MOVE ' W15'    ER                              046958
     C                     MOVE BJLCCY    ZCCY                            046958
     C                     MOVE BJSLCD    ZLOC                            046958
     C           ZDAYNO    IFNE 0                                         046958
     C                     EXSR ZCHKH                                     046958
     C           ZIND      IFEQ 'H'                                       046958
     C                     MOVE '1'       *IN07                           046958
     C                     ADD  1         W                               046958
     C                     MOVE ER        WRCD,W                          046958
     C                     MOVE '1'       *IN21                           046958
     C                     END                                            046958
     C                     END                                            046958
      *                                                                   CEU003
      ** If SAR CEU003 is not installed, then validate maturity date      CEU003
      ** against transaction currency.                                    CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'N'                                       CEU003
     C*                                                                   046958
     C** CHECK IF MATURITY DATE IS A HOLIDAY IN DEALING CCY               046958
     C*                                                                   046958
     C           *IN23     IFEQ '0'                                       046958
     C                     MOVE ' W16'    ER                              046958
     C                     MOVE SUCUCY    ZCCY                            046958
     C           ZDAYNO    IFNE 0                                         046958
     C                     EXSR ZCHKH                                     046958
     C           ZIND      IFEQ 'H'                                       046958
     C                     MOVE '1'       *IN07                           046958
     C                     ADD  1         W                               046958
     C                     MOVE ER        WRCD,W                          046958
     C                     MOVE '1'       *IN21                           046958
     C                     END                                            046958
     C                     END                                            046958
     C                     END                                            046958
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     END                                            046958
      *
      /SPACE 3
      *
      ** Amount is a mandatory entry.
     C           SUPAMT    IFEQ *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 032'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN24
     C                     END
      *
      /SPACE 3
      *
      ** The following section of validation is dependant on
      ** a valid Currency being entered.
      *
     C           *IN23     IFEQ '0'
      *
      **
      ** Validate the Amount using ZALIGN.
      **
      *
     C                     Z-ADD0         PUPAMT 130
     C           SUPAMT    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUPAMT    ZFIELD
     C*********************Z-ADDCDP       ZADEC                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C***********13********SUB  CDP       ZADIG                           S01194
     C           13        SUB  A6NBDP    ZADIG                           S01194
     C                     MOVE 'Y'       ZAOPT
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    PUPAMT
     C                     END
     C                     END
      *
      ** PUPAMT is numeric work field for comparison with 0.
     C           *IN24     IFEQ '0'
     C           *IN99     IFEQ '1'
     C           PUPAMT    ORLE 0
     C                     ADD  1         S
     C                     MOVE ' 032'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN24
     C                     MOVE '0'       *IN99
     C                     END
     C                     END
      *
      *  ( If valid, save Amount for file output )
     C           *IN24     IFEQ '0'
     C                     MOVE ZFIELD    UPAMTX 130
     C                     END
      *
      /SPACE 3
      *
      ** Validate Federal Funds Indicator.
     C           SUFFI     IFNE 'N'
     C           SUFFI     ANDNE*BLANK
      ** indicator may only be Y if the deal currency matches
      ** U.S. Dollar currency code.
     C           SUFFI     IFNE 'Y'
     C***********SUCUCY****ORNE USCY                                      S01194
     C           SUCUCY    ORNE BLUSCY                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 033'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN25
     C                     END
     C                     END
      *
      /SPACE 3
      *
      ** Validate Base Currency Rate using ZALIGN.
      *
     C           SUBCXR    IFNE *BLANKS
     C***********SUCUCY****IFEQ BCCY                                      S01194
     C           SUCUCY    IFEQ BJCYCD                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 034'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN26
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUBCXR    ZFIELD
     C                     Z-ADD8         ZADEC
     C                     Z-ADD5         ZADIG
     C                     MOVE 'N'       ZAOPT
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    UBCXRX 138
     C           UBCXRX    IFNE 0
      *
      ***Check*rate*is*within*25%*of*Base*Currency*Spot*Rate.(PF/TABTG10)*S01194
      ** Check rate is within 25% of Base Currency Spot Rate.(PF/SDCURRPD)S01194
     C***********SPOT******MULT 1.25      H25    138                      S01194
     C           A6SPRT    MULT 1.25      H25    138                      S01194
     C***********SPOT******MULT 0.75      L25    138                      S01194
     C           A6SPRT    MULT 0.75      L25    138                      S01194
     C           UBCXRX    IFGT H25
     C           UBCXRX    ORLT L25
     C                     ADD  1         S
     C                     MOVE ' 035'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN26
     C                     END
      *
     C                     END
      *
     C                     ELSE
     C                     ADD  1         S
     C                     MOVE ' 035'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN26
     C                     END
      *
     C                     END
      *
     C                     ELSE
      ** Reset file field.
     C                     Z-ADD0         UBCXRX
     C                     END
      *
     C                     END
      *
      /SPACE 3
      **
      ** Validate Interest Calculation Method.
      **
     C/COPY WNCPYSRC,DL1604IC51
      *
     C           SUICBS    IFLT '1'
     C           SUICBS    ORGT '6'
     C           CIR004    ANDEQ'N'                                       CIR004
     C           SUICBS    ORGT '7'                                       CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C                     ADD  1         S
     C                     MOVE ' 036'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN27
     C                     END
     C/COPY WNCPYSRC,DL1604IC52
      *
      /SPACE 3
      *
      **                                                                  S01157
      ** VALIDATE BOOK CODE                                               S01157
      **                                                                  S01157
     C           SBOKC     IFEQ *BLANK                                    S01157
     C                     ADD  1         S                               S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C                     MOVE ' 303'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN28                           S01157
     C*                                                                   S01157
     C                     ELSE                                           S01157
     C*                                                                   S01157
     C***********SBOKC*****CHAINBOOKD                72            S01157 S01194
     C** Call Access Program for Book Details                             S01194
     C                     CALL 'AOBOOKR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM SBOKC     @BOKC   2                       S01194
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01194
     C*                                                                   S01157
     C************IN72*****IFEQ '1'                                S01157 S01194
     C***********RECI******OREQ '*'                                S01157 S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     ADD  1         S                               S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C                     MOVE ' 300'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN28                           S01157
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     MOVELBDBKCD    SBOKC                           S01194
      *                                                                   S01194
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
      /SPACE 3                                                            S01157
      ******idate Hedge Indicator.                                        S01157
     C***        SHEDIN    IFNE *BLANK                                    S01157
     C***        SHEDIN    ANDNE'Y'                                       S01157
     C***        SHEDIN    ANDNE'N'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 037'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN28                           S01157
     C***                  END                                            S01157
      *
      /SPACE 3
      *
      ** Validate Taxable Indicator.
      *
     C           STAXI     IFNE *BLANK
     C           STAXI     ANDNE'Y'
     C           STAXI     ANDNE'N'
     C                     ADD  1         S
     C                     MOVE ' 038'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN29
     C                     END
     ****If*BIT*1*of*CMIN*is*off*,the*Customer*is*not*taxable*and*        S01194
      ** If the BBTAIN is 'N' ,the Customer is not taxable and            S01194
      ** STAXI must be 'N' or BLANK.
     C           STAXI     IFEQ 'Y'
     C           *IN19     ANDEQ'0'
     C           *IN29     ANDEQ'0'
     C*********************TESTB'1'       CMIN       84                   S01194
     C********** *IN84     IFEQ '1'                                       S01194
     C           BBTAIN    IFEQ 'Y'                                       S01194
     C                     ADD  1         S
     C                     MOVE ' 039'    ERCD,S
     C                     MOVE '0'       *IN84
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN29
     C                     END
     C                     END
      *                                                                   S01117
      /SPACE 3                                                            S01117
      **                                                                  S01117
      ** Validate profit centre                                           S01117
      **                                                                  S01117
      *                                                                   S01117
      ** If profit centre is used                                         S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C           *IN19     ANDEQ'0'                                       176510
     C           *IN28     ANDEQ'0'                                       176510
      *                                                                   S01117
      ** If profit centre is blank,                                       S01117
      ** then set profit centre to default, if it is used                 S01117
     C           SPRFC     IFEQ *BLANKS                                   S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
      *                                                                   S01117
      **Set*up*Customer*Number*and*Account*Officer*codes*for*call  S01117 176510
      **to*Profit*Centre*default*program*-*if*SCNUM*is*in*error**  S01117 176510
      **(including*blank)*then*set*these*fields*to*blanks********  S01117 176510
      * Set up Customer Number and Account Officer codes for call         176510
      * to Profit Centre default program.                                 176510
     C*********  *IN19     IFEQ '1'                                S01117 176510
     C*********            MOVE *BLANKS   @ACOF                    S01117 176510
     C*********            MOVE *BLANKS   @CUST                    S01117 176510
     C*********            ELSE                                    S01117 176510
     C                     MOVELBBACOC    @ACOF                           S01117
     C                     MOVELBBCUST    @CUST                           S01117
     C*********            END                                     S01117 176510
     C*********            MOVE *BLANKS   TRTP                     S01117 CSE006
     C*********            MOVELSDTYP     TRTP                     S01117 CSE006
     C                     MOVE *BLANKS   @TRTP                           CSE006
     C                     MOVELSDTYP     @TRTP                           CSE006
     C*                                                                   S01117
      ** Get default profit centre using AOPRFMR0                         S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM SBOKC     @BOKC   2        Book Code      S01117
     C********             PARM           TRTP    5    Trans. Type S01117 CSE006
     C                     PARM           @TRTP   5        Trans. Type    CSE006
     C                     PARM SDLST     @DLST   2        Deal Sub-Type  S01117
     C                     PARM SBRCA     @BRCA   3        Branch Code    S01117
     C                     PARM @DEPT     @DEPT1  3        Dept. Code     S01117
     C                     PARM USRID     @USER  10        User I.D.      S01117
     C                     PARM           @ACOF   2        Account OfficerS01117
     C                     PARM           @CUST   6        Customer No.   S01117
     C                     PARM           @PRFC1  4        Profit Centre  S01117
      *                                                                   S01117
      ** If default profit centre not valid                               S01117
     C           @RTCD     IFEQ '2'                                       S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     MOVE '1'       *IN54                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 405'    ERCD,S                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Move default profit centre to screen even if invalid             S01117
      *  (If default was not found field is left blank)                   S01117
     C                     MOVE @PRFC1    SPRFC                           S01117
      *                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** If profit centre is not blank and no previous errors in          S01117
      ** this field check profit centre exists on profit centre file      S01117
     C           SPRFC     IFNE *BLANKS                                   S01117
     C           *IN54     ANDNE'1'                                       S01117
      *                                                                   S01117
      ** Call access program for profit centre details                    S01194
     C                     CALL 'AOPRFCR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM SPRFC     @WPRFC  4                       S01194
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01194
      *                                                                   S01194
      ** If profit centre not found on file                               S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVE '1'       *IN05                           S01117
     C                     MOVE '1'       *IN54                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 405'    ERCD,S                          S01117
     C                     ELSE                                           S01117
     C                     MOVELDSPCCD    SPRFC                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,DL1604IC72
     C                     END                                            S01117
      *                                                                   S01117
      * IF MULTIBRANCHING ON CHECK ORIGINATING BRANCH                     S01117
      *                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C* ORIGINATING BRANCH USED                                           S01117
     C*                                                                   S01117
     C* IF FIELD BLANK USE BOOKING BRANCH PROVIDED NO ERROR               S01117
     C*                                                                   S01117
     C           SORBR     IFEQ *BLANKS                                   S01117
     C           *IN15     ANDEQ'0'                                       S01117
     C                     MOVE SBRCA     SORBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           SORBR     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C*  CALL ACCESS PROGRAM TO VALIDATE ORIGINATING BRANCH CODE          S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANK    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SORBR     @ORBR   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01194              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C* IF BRANCH CODE NOT FOUND DISPLAY ERROR MESSAGE                    S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 016'    ERCD,S                          S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     MOVE '1'       *IN46                           S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVELA8BRCD    SORBR                           S01117
     C*                                                                   S01117
     C* CHECK IF ORIG. BRANCH USER VALIDATION REQD.                       S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                                       S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM SORBR     @ORBR   3                       S01117
     C                     PARM           WERR    10                      S01117
     C*                                                                   S01117
     C           WERR      IFEQ 1                                         S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '1'       *IN46                           S01117
     C                     MOVE ' 401'    ERCD,S                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C           WERR      IFEQ 2                                         S01117
     C                     MOVE '1'       *IN05                           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '1'       *IN46                           S01117
     C                     MOVE ' 402'    ERCD,S                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* If Originating Branch not used set field to same as Booking       S01117
     C* Branch, provided no error exists(will not be displayed).          S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '0'                                       S01117
     C                     MOVE SBRCA     SORBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF MULTIBRANCHING OFF SET ORIGINATING BRANCH TO SAME AS           S01117
     C* BOOKING BRANCH                                                    S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     MOVE BJSBRC    SORBR                           S01117
     C                     END                                            S01117
      *
      /SPACE 3
      **
      ** Validate Negative Interest Indicator.
      **
      *
     C****       SUNII     IFNE *BLANKS                                   S01157
     C***        SUNII     ANDNE'Y'                                       S01157
     C***        SUNII     ANDNE'N'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 040'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN30                           S01157
     C***                  END                                            S01157
      *
      /SPACE 3
      **
      ** Validate Average Rate Method.
      **
     C           SAVRAM    IFNE *BLANKS
     C           SAVRAM    ANDNE'Y'
     C           SAVRAM    ANDNE'N'
     C                     ADD  1         S
     C                     MOVE ' 205'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN69
     C                     END
      *
      /SPACE 4
      ****************************************************************
      *                                                              *
      ***************************TAILS.                             **    S01157
      *                                                              *
      ****************************************************************
      *
      *
      *****lidate Our Base Rate Type.                                     S01157
      ****                                                                S01157
     C***        SUBRTT    IFNE *BLANKS                                   S01157
     C***        *IN23     ANDEQ'0'                                       S01157
      *****t up key for chain to TABLE file (Currencies -PF/TABLETK).     S01157
     C***                  MOVE *BLANKS   KEY                             S01157
     C***                  MOVEL'21'      KEY                             S01157
     C**:                  MOVELSUCUCY    WRK5                            S01157
     C***                  MOVE SUBRTT    KEY                             S01157
     C***        KEY       CHAINTABDLI               85                   S01157
      ****f a live record is not found ,show an error.                    S01157
     C****       *IN85     IFEQ '1'                                       S01157
     C***        RECI      ORNE 'D'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 043'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN32                           S01157
     C****                 MOVE '0'       *IN85                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *
      ***ACE 3                                                            S01157
      *
      *******date OUR Spread/Rate using ZALIGN.                           S01157
      ***                                                                 S01157
     C****                 Z-ADD0         URTSPX 117                      S01157
     C****       SURTSP    IFNE *BLANKS                                   S01157
      ****                                                                S01157
      *****ohibited if Our Base Rate Type NOT entered.                    S01157
     C****       SUBRTT    IFEQ *BLANKS                                   S01157
     C****                 ADD  1         S                               S01157
     C****                 MOVE ' 181'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN33                           S01157
      ***                                                                 S01157
     C****                 ELSE                                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C****                 Z-ADD7         ZADEC                           S01157
     C***                  Z-ADD4         ZADIG                           S01157
     C***                  MOVE SURTSP    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C****                 EXSR ZALIGN                                    S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C****                 MOVE ZFIELD    URTSPX                          S01157
     C****                 ELSE                                           S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 045'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C****                 MOVE '1'       *IN33                           S01157
     C****                 MOVE '0'       *IN99                           S01157
     C****                 END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
     C****                 END                                            S01157
      ****                                                                S01157
      ***ACE 3                                                            S01157
      ****                                                                S01157
      *****lidate OUR Spread Indicator.                                   S01157
      ****                                                                S01157
     C****       SUSPIN    IFNE *BLANKS                                   S01157
      *****ohibited if Our base rate code or Our spread/rate              S01157
      ****** entered.                                                     S01157
      ****                                                                S01157
     C****       *IN32     IFEQ '0'                                       S01157
     C****       *IN33     ANDEQ'0'                                       S01157
      ****                                                                S01157
     C****       SUBRTT    IFEQ *BLANKS                                   S01157
     C****       SURTSP    OREQ *BLANKS                                   S01157
     C****                 ADD  1         S                               S01157
     C****                 MOVE ' 046'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C****                 MOVE '1'       *IN34                           S01157
     C***                  END                                            S01157
     C****                 END                                            S01157
      ****                                                                S01157
     C****       *IN34     IFEQ '0'                                       S01157
     C****       SUSPIN    ANDNE'A'                                       S01157
     C****       SUSPIN    ANDNE'S'                                       S01157
     C***        SUSPIN    ANDNE'P'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 047'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN34                           S01157
     C***                  END                                            S01157
      *****                                                               S01157
     C****                 END                                            S01157
      ***ACE 3                                                            S01157
      ****                                                                S01157
      *****lidate Our Rate Fix Days using ZALIGN.                         S01157
     C*****                Z-ADD0         UFRFDX  20                      S01157
     C***        SUFRFD    IFNE *BLANKS                                   S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 182'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN31                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C****       SUBRTT    IFEQ *BLANKS                                   S01157
     C****                 ADD  1         S                               S01157
     C****                 MOVE ' 100'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN31                           S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***        *IN31     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE SUFRFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    UFRFDX                          S01157
     C***                  ELSE                                           S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 101'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN31                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C****                 ELSE                                *          S01157
      *****e the Default if Average Rate Method not used       *          S01157
     C****       SUBRTT    IFNE *BLANKS                                   S01157
     C***        SAVRAM    ANDNE'Y'                                       S01157
     C***        SUCUCY    IFEQ STCY                                      S01157
     C****       SUCUCY    ANDEQLOCY                                      S01157
     C****                 Z-ADD0         UFRFDX                          S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADD2         UFRFDX                          S01157
     C***                  END                                            S01157
     C***                  END                                 *          S01157
      ****                                                     *          S01157
     C****                 END                                            S01157
      ****                                                                S01157
      ****CE 3                                                            S01157
      ****                                                                S01157
      ******idate Our Rate Change Date using ZDATE1                       S01157
     C                     Z-ADD0         UNICDX  50                      S01157
     C****       SUNICD    IFNE *BLANKS                                   S01157
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 102'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C****                 MOVE '1'       *IN47                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVELSUNICD    XTEST6                          S01157
     C***                  EXSR XNTEST                                    S01157
      ****                                                                S01157
     C***        *IN84     IFEQ '1'                                       S01157
     C***                  MOVE SUNICD    ZDATE                           S01157
     C***                  EXSR ZDATE1                                    S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN84     IFEQ '0'                                       S01157
     C***        *IN99     OREQ '1'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 103'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN47                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
     C****                 MOVE '0'       *IN84                           S01157
     C****                 END                                            S01157
      ****                                                                S01157
      *****oss-check with Value date,Maturity date and Run date.          S01157
     C****       *IN47     IFEQ '0'                                       S01157
     C***        ZDAYNO    IFLT RUND                                      S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 104'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN47                           S01157
     C***                  ELSE                                           S01157
      ****ross check against Value date or Maturity date.                 S01157
     C****       *IN20     IFEQ '0'                                       S01157
     C***        ZDAYNO    ANDLEVDATX                                     S01157
     C***        *IN21     OREQ '0'                                       S01157
     C***        ZDAYNO    ANDGEMDATX                                     S01157
     C****                 ADD  1         S                               S01157
     C***                  MOVE ' 105'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN47                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *                                                                   S01157
     *****ve valid date                                                   S01157
      ***                                                                 S01157
     C***        *IN47     IFEQ '0'                                       S01157
     C***                  Z-ADDZDAYNO    UNICDX                          S01157
     C***                  Z-ADDZDAY      ZDAYX   20                      S01157
     C***                  END                                            S01157
      ** Check through Sub-routine DLBACK if Average Rate Method is not Y S01157
     C***        SAVRAM    IFNE 'Y'                                       S01157
     C****       *IN47     IFEQ '0'                                       S01157
     C***        *IN31     ANDEQ'0'                                       S01157
     C***        *IN23     ANDEQ'0'                                       S01157
     C***                  Z-ADDZDAYNO    ZINDT                           S01157
     C***                  Z-ADDUFRFDX    ZRFDY                           S01157
     C***                  MOVE SUCUCY    ZCCY                            S01157
     C***                  EXSR DLBACK                                    S01157
      ***                                                                 S01157
     C***        ZRFDT     IFLT RUND                                      S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 106'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN47                           S01157
     C***                  Z-ADD0         UNICDX                          S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *                                                                   S01157
      ***ACE 3                                                            S01157
      ****                                                                S01157
      *****lidate Our Rate Change Frequency.                              S01157
     C****       SUICFR    IFNE *BLANK                                    S01157
     C****       SUNICD    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 107'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN48                           S01157
     C***                  ELSE                                           S01157
     C***        SUICFR    IFNE 'M'                                       S01157
     C***        SUICFR    ANDNE'Q'                                       S01157
     C***        SUICFR    ANDNE'X'                                       S01157
     C***        SUICFR    ANDNE'Y'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 108'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN48                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      ****CE 3                                                            S01157
      ****                                                                S01157
      *****lidate Our Rate Change Frequency Day in Month Using ZALIGN.    S01157
     C                     Z-ADD0         UICFDX  20                      S01157
     C****       SUICFD    IFNE *BLANKS                                   S01157
     C***        SUICFR    IFEQ *BLANK                                    S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 109'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN49                           S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***        *IN49     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE SUICFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    UICFDX                          S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '1'                                       S01157
     C***        UICFDX    ORLT 1                                         S01157
     C***        UICFDX    ORGT 31                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 110'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN49                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  Z-ADD0         UICFDX                          S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *                                                                   S01157
      **** not entered, but allowed - default                             S01157
      ****                                                                S01157
     C***        SUICFD    IFEQ *BLANKS                                   S01157
     C***        SUICFR    ANDNE*BLANKS                                   S01157
     C***        UNICDX    ANDNE0                                         S01157
     C***                  Z-ADDZDAYX     UICFDX                          S01157
     C***                  END                                            S01157
      ***ACE 3                                                            S01157
      ***                                                                 S01157
      *****lidate Our Short Term Rate/Average Rate.                       S01157
     C****                 Z-ADD0         WORK1X 117                      S01157
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C***        SWORK1    ANDNE*BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 111'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN50                           S01157
     C***                  END                                            S01157
     C**                                                                  S01157
     C***        *IN32     IFEQ '0'                                       S01157
     C***        *IN20     ANDEQ'0'                                       S01157
     C***        *IN69     ANDEQ'0'                                       S01157
     C***        *IN23     ANDEQ'0'                                       S01157
     C***        *IN50     ANDEQ'0'                                       S01157
     C***        SUBRTT    ANDGT'00'                                      S01157
     C****                                                                S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C****                                                                S01157
     C***        VDATX     IFLT RUND                                      S01157
     C***        SWORK1    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 184'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN50                           S01157
     C***                  END                                            S01157
     C***                  ELSE                                           S01157
     C***        SWORK1    IFNE *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 184'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN50                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C****       *IN31     IFEQ '0'                                       S01157
     C***                  Z-ADDVDATX     ZINDT                           S01157
     C****                 Z-ADDUFRFDX    ZRFDY                           S01157
     C***                  MOVE SUCUCY    ZCCY                            S01157
     C***                  EXSR DLBACK                                    S01157
      ****                                                                S01157
     C***        ZRFDT     IFLT RUND                                      S01157
     C***        SWORK1    ANDEQ*BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 183'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN50                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        *IN50     IFEQ '0'                                       S01157
     C***        SWORK1    ANDNE*BLANKS                                   S01157
     C***                  Z-ADD7         ZADEC                           S01157
     C***                  Z-ADD4         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE SWORK1    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ***                                                                 S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C****                 MOVE ZFIELD    WORK1X                          S01157
      ****                                                                S01157
     C****                 ELSE                                           S01157
      ****                                                                S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 113'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN50                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****CE 3                                                            S01157
      ****                                                                S01157
      *****lidate Interest Payment Date.                                  S01157
     C                     Z-ADD0         UNIPDX  50                      S01157
     C****                                                                S01157
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C****       SUNIPD    ANDNE*BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C****                 MOVE ' 185'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        SUNIPD    IFNE *BLANKS                                   S01157
     C****                 MOVELSUNIPD    XTEST6                          S01157
     C***                  EXSR XNTEST                                    S01157
     C***        *IN84     IFEQ '1'                                       S01157
     C***                  MOVE SUNIPD    ZDATE                           S01157
     C***                  EXSR ZDATE1                                    S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        *IN84     IFEQ '0'                                       S01157
     C***        *IN99     OREQ '1'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 114'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  ELSE                                           S01157
      *****oss check with Value Date/Maturity Date.                       S01157
     C***        *IN20     IFEQ '0'                                       S01157
     C***        ZDAYNO    ANDLTVDATX                                     S01157
     C***        *IN21     OREQ '0'                                       S01157
     C***        ZDAYNO    ANDGTMDATX                                     S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 115'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      ****ve valid dates.                                                 S01157
     C***        *IN51     IFEQ '0'                                       S01157
     C***                  Z-ADDZDAYNO    UNIPDX                          S01157
     C***                  Z-ADDZDAY      ZDAYX                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                               ?            S01157
      ****                                                                S01157
     C***        UNIPDX    IFNE 0                                         S01157
     C***        SAVRAM    ANDEQ'Y'                                       S01157
     C***        *IN47     ANDEQ'0'                                       S01157
      ****                                                                S01157
     C***        UNICDX    IFEQ 0                                         S01157
     C***        *IN21     ANDEQ'0'                                       S01157
     C***        UNIPDX    ANDNEMDATX                                     S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 186'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  END                               ?            S01157
      ****                                                                S01157
     C***        *IN51     IFEQ '0'                                       S01157
     C***        UNICDX    ANDNE0                                         S01157
      ****                                                                S01157
     C***        UNIPDX    IFLT UNICDX                                    S01157
     C****                 ADD  1         S                               S01157
     C***                  MOVE ' 187'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  END                               ?            S01157
      ****                                                                S01157
     C***        *IN51     IFEQ '0'                                       S01157
     C***        UNICDX    ANDLTUNIPDX                                    S01157
     C***        *IN48     ANDEQ'0'                                       S01157
     C***        *IN49     ANDEQ'0'                                       S01157
     C****       *IN21     ANDEQ'0'                                       S01157
     C****                                                                S01157
     C***        SUICFR    IFEQ *BLANKS                                   S01157
     C***                  Z-ADDMDATX     ZDAYNO                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE SUICFR    ZFREQ                           S01157
     C***                  Z-ADDUNICDX    ZDAYNO                          S01157
     C****                 Z-ADDUICFDX    ZMDAY                           S01157
     C*****                MOVE SUCUCY    ZCCY                            S01157
      ****                                                                S01157
     C****       ZDAYNO    DOWLTUNIPDX                                    S01157
     C***                  EXSR ZFREQB                                    S01157
     C***                  END                                            S01157
      *                                                                   S01157
     C***                  END                                            S01157
      *                                                                   S01157
     C***        ZDAYNO    IFNE UNIPDX                                    S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 188'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN51                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN51     IFEQ '1'                                       S01157
     C****                 Z-ADD0         UNIPDX                          S01157
     C****                 END                                            S01157
      ****                                                                S01157
      ***ACE 3                                                            S01157
      ****                                                                S01157
      *****lidate Our Interest Payment Frequency.                         S01157
     C***        SUIPFR    IFNE *BLANK                                    S01157
      ****                                                                S01157
     C***        SUNIPD    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 116'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN52                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C****       SUIPFR    IFNE 'M'                                       S01157
     C***        SUIPFR    ANDNE'Q'                                       S01157
     C***        SUIPFR    ANDNE'X'                                       S01157
     C***        SUIPFR    ANDNE'Y'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 117'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN52                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN52     IFEQ '0'                                       S01157
     C***        SUIPFR    ANDNE*BLANKS                                   S01157
     C***        SAVRAM    ANDEQ'Y'                                       S01157
     C***        *IN49     ANDEQ'0'                                       S01157
      ***                                                                 S01157
     C***        SUICFR    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 189'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN52                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C***        SUICFR    IFEQ 'Q'                                       S01157
     C***        SUIPFR    ANDNE'Q'                                       S01157
     C***        SUIPFR    ANDNE'X'                                       S01157
     C***        SUIPFR    ANDNE'Y'                                       S01157
      ****                                                                S01157
     C***        SUICFR    OREQ 'X'                                       S01157
     C***        SUIPFR    ANDNE'X'                                       S01157
     C***        SUIPFR    ANDNE'Y'                                       S01157
      ****                                                                S01157
     C***        SUICFR    OREQ 'Y'                                       S01157
     C***        SUIPFR    ANDNE'Y'                                       S01157
      ****                                                                S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 190'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN52                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
      ****CE 3                                                            S01157
      ****                                                                S01157
      *****lidate Our Interest Payment Frequency Day in Month.            S01157
      *****e ZALIGN                                                       S01157
     C                     Z-ADD0         UIPFDX  20                      S01157
     C***        SUIPFD    IFNE *BLANKS                                   S01157
     C***        SUIPFR    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 118'    ERCD,S                          S01157
     C****                 MOVE '1'       *IN05                           S01157
     C****                 MOVE '1'       *IN53                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
      ****                                                                S01157
     C***        *IN53     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE SUIPFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      *****                                                               S01157
     C****       *IN99     IFEQ '0'                                       S01157
     C****                 MOVE ZFIELD    UIPFDX                          S01157
     C****                 END                                            S01157
      ****                                                                S01157
     C****       *IN99     IFEQ '1'                                       S01157
     C***        UIPFDX    ORLT 1                                         S01157
     C***        UIPFDX    ORGT 31                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 119'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN53                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  Z-ADD0         UIPFDX                          S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      *****not entered, but allowed - default                             S01157
      *****                                                               S01157
     C***        SUIPFD    IFEQ *BLANKS                                   S01157
     C***        SUIPFR    ANDNE*BLANKS                                   S01157
     C***        UNIPDX    ANDNE0                                         S01157
     C***                  Z-ADDZDAYX     UIPFDX                          S01157
     C***                  END                                            S01157
      ***ACE 1                                                            S01157
      ****                                                                S01157
      ****oss validate, if Rate Chg & Next Payments details valid         S01157
      ****                                                                S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C***        UICFDX    ANDNEUIPFDX                                    S01157
     C***        UNICDX    ANDNE0                                         S01157
     C***        UNIPDX    ANDNE0                                         S01157
      ****                                                                S01157
     C***        SUIPFD    IFNE *BLANKS                                   S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C****                 ADD  1         S                               S01157
     C***                  MOVE ' 200'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN53                           S01157
      ****                                                                S01157
     C***                  ELSE                                           S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 201'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN53                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
      ****                                                                S01157
      ****CE 4                                                            S01157
      ****************************************************************    S01157
      *                                                              *    S01157
      ************************IR DETAILS.                            *    S01157
      *                                                              *    S01157
      ****************************************************************    S01157
      *                                                                   S01157
      ******idate their Base Rate Type.                                   S01157
      **                                                                  S01157
     C***        STBRTT    IFNE *BLANKS                                   S01157
     C***        *IN23     ANDEQ'0'                                       S01157
      ****** up key for chain to TABLE file (Currencies 1).               S01157
     C****                 MOVE *BLANKS   KEY                             S01157
     C***                  MOVEL'21'      KEY                             S01157
     C***                  MOVELSUCUCY    WRK5                            S01157
     C***                  MOVE STBRTT    KEY                             S01157
     C***        KEY       CHAINTABDLI               85                   S01157
      ***** a live record is not found ,show an error.                    S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***        RECI      ORNE 'D'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 048'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN35                           S01157
     C***                  MOVE '0'       *IN85                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      /SPACE 1                                                            S01157
      ********ase Rate Type/Their Base Rate Type Cross Validation.        S01157
     C****       *IN32     IFEQ '0'                                       S01157
     C****       *IN35     ANDEQ'0'                                       S01157
     C***        SUBRTT    ANDNE*BLANKS                                   S01157
     C***        STBRTT    ANDNE*BLANKS                                   S01157
      ***                                                                 S01157
     C****       SUBRTT    OREQ *BLANKS                                   S01157
     C***        STBRTT    ANDEQ*BLANKS                                   S01157
      ***                                                                 S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 053'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN32                           S01157
     C***                  MOVE '1'       *IN35                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      /SPACE 3                                                            S01157
      ***                                                                 S01157
      ******idate Their Spread/Rate using ZALIGN.                         S01157
      ***                                                                 S01157
     C***                  Z-ADD0         TRTSPX 117                      S01157
     C***        STRTSP    IFNE *BLANKS                                   S01157
      ****                                                                S01157
      ******hibited if Their Base Rate Type NOT entered.                  S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 191'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN36                           S01157
      ****                                                                S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  Z-ADD7         ZADEC                           S01157
     C***                  Z-ADD4         ZADIG                           S01157
     C***                  MOVE STRTSP    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    TRTSPX                          S01157
     C***                  ELSE                                           S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 050'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN36                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *
      /SPACE 3
      ***                                                                 S01157
      ******idate THEIR Spread Indicator.                                 S01157
      ***                                                                 S01157
     C***        STSPIN    IFNE *BLANKS                                   S01157
      ******hibited if Their base rate code or Their spread/rate          S01157
      *****T entered.                                                     S01157
      ****                                                                S01157
     C***        *IN35     IFEQ '0'                                       S01157
     C***        *IN36     ANDEQ'0'                                       S01157
      ***                                                                 S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***        STRTSP    OREQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 051'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN37                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN37     IFEQ '0'                                       S01157
     C***        STSPIN    ANDNE'A'                                       S01157
     C***        STSPIN    ANDNE'S'                                       S01157
     C***        STSPIN    ANDNE'P'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 052'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN37                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate Their Rate Fix Days using ZALIGN.                       S01157
     C****                 Z-ADD0         TFRFDX  20                      S01157
     C***        STFRFD    IFNE *BLANKS                                   S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 182'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN57                           S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 120'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN57                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
      ****                                                                S01157
     C***        *IN57     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE STFRFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ***                                                                 S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    TFRFDX  20                      S01157
     C***                  ELSE                                           S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 121'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN57                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  ELSE                                *          S01157
      ****** the Default if Average Rate Method is not used    *          S01157
     C***        STBRTT    IFNE *BLANKS                                   S01157
     C***        SAVRAM    ANDNE'Y'                                       S01157
     C***        SUCUCY    IFEQ STCY                                      S01157
     C***        SUCUCY    ANDEQLOCY                                      S01157
     C***                  Z-ADD0         TFRFDX                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADD2         TFRFDX                          S01157
     C***                  END                                            S01157
     C***                  END                                 *          S01157
      ***                                                      *          S01157
     C***                  END                                            S01157
      ****                                                                S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate Their Rate Change Date using ZDATE1.                    S01157
     C***                  Z-ADD0         TNICDX  50                      S01157
     C***        STNICD    IFNE *BLANKS                                   S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 122'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN58                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVELSTNICD    XTEST6                          S01157
     C***                  EXSR XNTEST                                    S01157
      ****                                                                S01157
     C***        *IN84     IFEQ '1'                                       S01157
     C***                  MOVE STNICD    ZDATE                           S01157
     C***                  EXSR ZDATE1                                    S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN84     IFEQ '0'                                       S01157
     C***        *IN99     OREQ '1'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 123'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN58                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
     C***                  MOVE '0'       *IN84                           S01157
     C***                  END                                            S01157
      *****                                                               S01157
      ******ss-check with Value date,Maturity date and Run date.          S01157
     C***        *IN58     IFEQ '0'                                       S01157
     C***        ZDAYNO    IFLT RUND                                      S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 124'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN58                           S01157
     C***                  ELSE                                           S01157
      *****oss check against Value date or Maturity date.                 S01157
     C***        *IN20     IFEQ '0'                                       S01157
     C***        ZDAYNO    ANDLEVDATX                                     S01157
     C***        *IN21     OREQ '0'                                       S01157
     C***        ZDAYNO    ANDGEMDATX                                     S01157
     C***                  ADD  1         S                               S01157
     C****                 MOVE ' 125'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN58                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      ****ve valid date value                                             S01157
      ****                                                                S01157
     C***        *IN58     IFEQ '0'                                       S01157
     C***                  Z-ADDZDAYNO    TNICDX                          S01157
     C***                  Z-ADDZDAY      ZDAYX                           S01157
     C***                  END                                            S01157
      ****eck through Sub-routine DLBACK if Average Rate Method NE Y      S01157
     C***        SAVRAM    IFNE 'Y'                                       S01157
     C***        *IN58     IFEQ '0'                                       S01157
     C***        *IN57     ANDEQ'0'                                       S01157
     C***        *IN23     ANDEQ'0'                                       S01157
     C***                  Z-ADDZDAYNO    ZINDT                           S01157
     C***                  Z-ADDTFRFDX    ZRFDY                           S01157
     C***                  MOVE SUCUCY    ZCCY                            S01157
     C***                  EXSR DLBACK                                    S01157
      ****                                                                S01157
     C***        ZRFDT     IFLT RUND                                      S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 126'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN58                           S01157
     C***                  Z-ADD0         TNICDX                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate THEIR Rate Change Frequency.                            S01157
     C****       STICFR    IFNE *BLANK                                    S01157
     C***        STNICD    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 127'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN59                           S01157
     C***                  ELSE                                           S01157
     C***        STICFR    IFNE 'M'                                       S01157
     C***        STICFR    ANDNE'Q'                                       S01157
     C***        STICFR    ANDNE'X'                                       S01157
     C***        STICFR    ANDNE'Y'                                       S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 128'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN59                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate Their Rate Change Frequency Day in Month Using ZALIGN.  S01157
     C***                  Z-ADD0         TICFDX  20                      S01157
     C***        STICFD    IFNE *BLANKS                                   S01157
     C***        STICFR    IFEQ *BLANK                                    S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 129'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN60                           S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***        *IN60     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE STICFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ***                                                                 S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    TICFDX                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        *IN99     IFEQ '1'                                       S01157
     C***        TICFDX    ORLT 1                                         S01157
     C***        TICFDX    ORGT 31                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 130'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN60                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  Z-ADD0         TICFDX                          S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      ******ot entered, but allowed - default                             S01157
      ****                                                                S01157
     C***        STICFD    IFEQ *BLANKS                                   S01157
     C***        STICFR    ANDNE*BLANKS                                   S01157
     C***        TNICDX    ANDNE0                                         S01157
     C***                  Z-ADDZDAYX     TICFDX                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      *****lidate Their Short Term Rate/Average Rate.                     S01157
     C***                  Z-ADD0         WORK2X 117                      S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***        SWORK2    ANDNE*BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 131'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN61                           S01157
     C***                  END                                            S01157
     C***                                                                 S01157
     C***        *IN35     IFEQ '0'                                       S01157
     C***        *IN20     ANDEQ'0'                                       S01157
     C***        *IN69     ANDEQ'0'                                       S01157
     C***        *IN23     ANDEQ'0'                                       S01157
     C***        *IN61     ANDEQ'0'                                       S01157
     C***        STBRTT    ANDGT'00'                                      S01157
     C***                                                                 S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C***                                                                 S01157
     C***        VDATX     IFLT RUND                                      S01157
     C***        SWORK2    IFEQ *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 193'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN61                           S01157
     C***                  END                                            S01157
     C***                  ELSE                                           S01157
     C***        SWORK2    IFNE *BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 193'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN61                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***        *IN57     IFEQ '0'                                       S01157
     C***                  Z-ADDVDATX     ZINDT                           S01157
     C***                  Z-ADDTFRFDX    ZRFDY                           S01157
     C***                  MOVE SUCUCY    ZCCY                            S01157
     C***                  EXSR DLBACK                                    S01157
      ***                                                                 S01157
     C***        ZRFDT     IFLT RUND                                      S01157
     C***        SWORK2    ANDEQ*BLANKS                                   S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 192'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN61                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN61     IFEQ '0'                                       S01157
     C***        SWORK2    ANDNE*BLANKS                                   S01157
     C***                  Z-ADD7         ZADEC                           S01157
     C***                  Z-ADD4         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE SWORK2    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C****                 MOVE ZFIELD    WORK2X                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C****                 ADD  1         S                               S01157
     C***                  MOVE ' 133'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  MOVE '1'       *IN61                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate Interest Payment Date.                                  S01157
     C***                  Z-ADD0         TNIPDX  50                      S01157
     C***                                                                 S01157
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***        STNIPD    ANDNE*BLANKS                                   S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 194'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        STNIPD    IFNE *BLANKS                                   S01157
     C***                  MOVELSTNIPD    XTEST6                          S01157
     C***                  EXSR XNTEST                                    S01157
     C***        *IN84     IFEQ '1'                                       S01157
     C***                  MOVE STNIPD    ZDATE                           S01157
     C***                  EXSR ZDATE1                                    S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN84     IFEQ '0'                                       S01157
     C***        *IN99     OREQ '1'                                       S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 134'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  ELSE                                           S01157
      *****oss check with Value Date/Maturity Date.                       S01157
     C***        *IN20     IFEQ '0'                                       S01157
     C***        ZDAYNO    ANDLTVDATX                                     S01157
     C***        *IN21     OREQ '0'                                       S01157
     C***        ZDAYNO    ANDGTMDATX                                     S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 135'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      ****ve valid dates.                                                 S01157
     C***        *IN62     IFEQ '0'                                       S01157
     C***                  Z-ADDZDAYNO    TNIPDX                          S01157
     C***                  Z-ADDZDAY      ZDAYX                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C****       TNIPDX    IFNE 0                                         S01157
     C***        SAVRAM    ANDEQ'Y'                                       S01157
     C***        *IN58     ANDEQ'0'                                       S01157
      ****                                                                S01157
     C***        TNICDX    IFEQ 0                                         S01157
     C***        *IN21     ANDEQ'0'                                       S01157
     C***        TNIPDX    ANDNEMDATX                                     S01157
      *****id exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 195'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        *IN62     IFEQ '0'                                       S01157
     C***        TNICDX    ANDNE0                                         S01157
      ****                                                                S01157
     C***        TNIPDX    IFLT TNICDX                                    S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 196'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN62     IFEQ '0'                                       S01157
     C***        TNICDX    ANDLTTNIPDX                                    S01157
     C***        *IN59     ANDEQ'0'                                       S01157
     C***        *IN60     ANDEQ'0'                                       S01157
     C***        *IN21     ANDEQ'0'                                       S01157
     C***                                                                 S01157
     C***        STICFR    IFEQ *BLANKS                                   S01157
     C***                  Z-ADDMDATX     ZDAYNO                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE STICFR    ZFREQ                           S01157
     C***                  Z-ADDTNICDX    ZDAYNO                          S01157
     C***                  Z-ADDTICFDX    ZMDAY                           S01157
     C***                  MOVE SUCUCY    ZCCY                            S01157
      ***                                                                 S01157
     C***        ZDAYNO    DOWLTTNIPDX                                    S01157
     C***                  EXSR ZFREQB                                    S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        ZDAYNO    IFNE TNIPDX                                    S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 197'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN62                           S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        *IN62     IFEQ '1'                                       S01157
     C***                  Z-ADD0         TNIPDX                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      ******idate Their Interest Payment Frequency.                       S01157
     C***        STIPFR    IFNE *BLANK                                    S01157
      ***                                                                 S01157
     C***        STNIPD    IFEQ *BLANKS                                   S01157
      *****id exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 136'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN63                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C***        STIPFR    IFNE 'M'                                       S01157
     C***        STIPFR    ANDNE'Q'                                       S01157
     C***        STIPFR    ANDNE'X'                                       S01157
     C***        STIPFR    ANDNE'Y'                                       S01157
      *****id exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 137'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN63                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN63     IFEQ '0'                                       S01157
     C***        STIPFR    ANDNE*BLANKS                                   S01157
     C***        SAVRAM    ANDEQ'Y'                                       S01157
     C***        *IN60     ANDEQ'0'                                       S01157
      ****                                                                S01157
     C***        STICFR    IFEQ *BLANKS                                   S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 198'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN63                           S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C***        STICFR    IFEQ 'Q'                                       S01157
     C***        STIPFR    ANDNE'Q'                                       S01157
     C***        STIPFR    ANDNE'X'                                       S01157
     C***        7TIPFR    ANDNE'Y'                                       S01157
      ***                                                                 S01157
     C***        STICFR    OREQ 'X'                                       S01157
     C***        STIPFR    ANDNE'X'                                       S01157
     C***        STIPFR    ANDNE'Y'                                       S01157
      ***                                                                 S01157
     C***        STICFR    OREQ 'Y'                                       S01157
     C***        STIPFR    ANDNE'Y'                                       S01157
      ***                                                                 S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 199'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN63                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
      /SPACE 3                                                            S01157
      ****                                                                S01157
      *****lidate Their Interest Payment Frequency Day in Month.          S01157
      *****e ZALIGN                                                       S01157
     C***                  Z-ADD0         TIPFDX  20                      S01157
     C***        STIPFD    IFNE *BLANKS                                   S01157
     C***        STIPFR    IFEQ *BLANKS                                   S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 138'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN64                           S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
      ***                                                                 S01157
     C***        *IN64     IFEQ '0'                                       S01157
     C***                  Z-ADD0         ZADEC                           S01157
     C***                  Z-ADD2         ZADIG                           S01157
     C***                  MOVE *BLANKS   ZFIELD                          S01157
     C***                  MOVE STIPFD    ZFIELD                          S01157
     C***                  MOVE 'N'       ZAOPT                           S01157
     C***                  EXSR ZALIGN                                    S01157
      ***                                                                 S01157
     C***        *IN99     IFEQ '0'                                       S01157
     C***                  MOVE ZFIELD    TIPFDX                          S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        *IN99     IFEQ '1'                                       S01157
     C***        TIPFDX    ORLT 1                                         S01157
     C***        TIPFDX    ORGT 31                                        S01157
      ****oid exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 139'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN64                           S01157
     C***                  MOVE '0'       *IN99                           S01157
     C***                  Z-ADD0         TIPFDX                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ****                                                                S01157
      *****not entered, but allowed - default                             S01157
      ***                                                                 S01157
     C***        STIPFD    IFEQ *BLANKS                                   S01157
     C***        STIPFR    ANDNE*BLANKS                                   S01157
     C***        TNIPDX    ANDNE0                                         S01157
     C***                  Z-ADDZDAYX     TIPFDX                          S01157
     C***                  END                                            S01157
      /SPACE 1                                                            S01157
      ****                                                                S01157
      *****ss validate, if Rate Chg & Next Payments details valid         S01157
      ****                                                                S01157
     C***        SAVRAM    IFEQ 'Y'                                       S01157
     C***        TICFDX    ANDNETIPFDX                                    S01157
     C***        TNICDX    ANDNE0                                         S01157
     C***        TNIPDX    ANDNE0                                         S01157
      ****                                                                S01157
     C***        STIPFD    IFNE *BLANKS                                   S01157
      *****id exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 206'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN64                           S01157
      ****                                                                S01157
     C***                  ELSE                                           S01157
      *****id exceeding size of error code array.                         S01157
     C***        S         IFLT 38                                        S01157
     C***                  ADD  1         S                               S01157
     C***                  MOVE ' 207'    ERCD,S                          S01157
     C***                  MOVE '1'       *IN05                           S01157
     C***                  END                                            S01157
     C***                  MOVE '1'       *IN64                           S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
      /SPACE 4                                                            S01157
      *****************************************************************   S01157
      *                                                               *   S01157
      *                  GENERAL   DETAILS                            *   S01157
      *                                                               *   S01157
      *****************************************************************   S01157
      *                                                                   S01157
      ** Validate Ceiling Rate.                                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     Z-ADD0         CLRATX 117                      S01157
     C           SCLRAT    IFNE *BLANKS                                   S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     MOVE SCLRAT    ZFIELD                          S01157
     C                     Z-ADD7         ZADEC                           S01157
     C                     Z-ADD4         ZADIG                           S01157
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    CLRATX
     C                     END
      *
     C                     END
      *
     C* ONLY VALIDATE CEILING RATE IF DEAL IS NOT A FLOOR                 S01157
     C*                                                                   S01157
     C           NEWDT     IFNE 'RF'                                      S01157
     C*                                                                   S01157
     C           *IN99     IFEQ '1'
     C           CLRATX    OREQ 0
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 202'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN67
     C                     MOVE '0'       *IN99
     C                     END
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
      *
      ** Validate Floor Rate.
     C                     MOVE '0'       *IN99
     C                     Z-ADD0         FLRATX 117
     C           SFLRAT    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFLRAT    ZFIELD
     C                     Z-ADD7         ZADEC
     C                     Z-ADD4         ZADIG
     C                     MOVE 'N'       ZAOPT
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    FLRATX
     C                     END
     C                     END
     C*                                                                   S01157
     C* ONLY VALIDATE FLOOR IF DEAL IS NOT A CAP                          S01157
     C*                                                                   S01157
     C           NEWDT     IFNE 'RP'                                      S01157
     C*                                                                   S01157
     C           *IN99     IFEQ '1'
     C           FLRATX    OREQ 0                                         S01157
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 203'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN68
     C                     MOVE '0'       *IN99
     C                     ELSE
     C                     MOVE ZFIELD    FLRATX
     C                     END
     C*                                                                   S01157
     C                     END                                            S01157
      *
     C* CROSS VALIDATE FLOOR & CEILING RATE ONLY IF DEAL IS A COLLAR      S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RR'                                      S01157
     C*                                                                   S01157
     C           *IN30     IFEQ '0'
     C           *IN68     ANDEQ'0'
     C           *IN67     ANDEQ'0'
     C           SFLRAT    ANDNE*BLANKS
      *
      *
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****       FLRATX    ANDLTCLRATX                                    S01157
      ***                                                                 S01157
     C***        SUNII     ORNE 'Y'                                       S01157
     C***        FLRATX    ANDGECLRATX                                    S01157
      ****                                                                S01157
     C*                                                                   S01157
     C           FLRATX    IFGE CLRATX                                    S01157
     C*                                                                   S01157
      **Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 204'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN68                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     ELSE                                           S01157
     C                     MOVE ZFIELD    FLRATX                          S01157
     C                     END                                            S01157
      ****                                                                S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     END                                            S01157
      ***                                                                 S01157
      /SPACE 4                                                            S01157
     C*                                                                   S01157
     C* VALIDATE REFERENCE DETAILS                                        S01157
     C*                                                                   S01157
     C* BUY/SELL INDICATOR                                                S01157
     C*                                                                   S01157
     C           SBYSL     IFEQ *BLANK                                    S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 301'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN32                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           SBYSL     IFNE *BLANK                                    S01157
     C           SBYSL     IFNE 'B'                                       S01157
     C           SBYSL     ANDNE'S'                                       S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 302'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN32                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* BASE RATE                                                         S01157
     C*                                                                   S01157
     C           SRBRTT    IFEQ *BLANK                                    S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 305'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN35                           S01157
     C                     ELSE                                           S01157
     C*****ETUP KEY FOR CHAIN TO TABLE FILE (Currencies 1).        S01157 S01194
     C*****                MOVE *BLANKS   KEY                      S01157 S01194
     C*****                MOVEL'21'      KEY                      S01157 S01194
     C*****                MOVELSUCUCY    WRK5                     S01157 S01194
     C*****                MOVE SRBRTT    KEY                      S01157 S01194
     C*****      KEY       CHAINTABDLI               85            S01157 S01194
     C/COPY WNCPYSRC,DL1604IC53
     C*  Call Access Program for Base Rate Details.                       S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM SUCUCY    @BCCY   3                       S01194
     C                     PARM SRBRTT    @BSRT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01157
     C** IF a live record is not found ,show an error.                    S01157
     C*****      *IN85     IFEQ '1'                                S01157 S01194
     C*****      RECI      ORNE 'D'                                S01157 S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     ADD  1         S                               S01157
     C                     MOVE ' 043'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN35                           S01157
     C*****                MOVE '0'       *IN85                    S01157 S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C/COPY WNCPYSRC,DL1604IC54
     C                     MOVELBABSRC    SRBRTT                          S01194
     C/COPY WNCPYSRC,DL1604IC55
      *                                                                   S01194
     C                     END                                            S01157
     C/COPY WNCPYSRC,DL1604IC56
     C                     END                                            S01157
     C*                                                                   S01157
     C* SPREAD RATE                                                       S01157
     C*                                                                   S01157
     C                     Z-ADD0         @RTSPX 117                      S01157
     C           SRRTSP    IFNE *BLANKS                                   S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     Z-ADD7         ZADEC                           S01157
     C                     Z-ADD4         ZADIG                           S01157
     C***********          MOVE SRRTSP    ZFIELD                   S01157 053570
     C                     MOVELSRRTSP    ZFIELD                          053570
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
     C*                                                                   S01157
     C           *IN99     IFEQ '0'                                       S01157
      *                                                                   053570
      **  Send error message if user entered a zero spread.               053570
      *                                                                   053570
     C                     Z-ADD0         SRNUMB 120                      053570
     C                     MOVE ZFIELD    SRNUMB                          053570
     C           SRNUMB    IFEQ 0                                         053570
     C                     ADD  1         S                               053570
     C                     MOVE ' 042'    ERCD,S                          053570
     C                     MOVE '1'       *IN05                           053570
     C                     MOVE '1'       *IN36                           053570
     C                     MOVE '0'       *IN99                           053570
     C                     ELSE                                           053570
     C                     MOVE ZFIELD    @RTSPX                          S01157
     C                     ENDIF                                          053570
      *                                                                   053570
     C                     ELSE                                           S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 045'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN36                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* SPREAD INDICATOR                                                  S01157
     C*                                                                   S01157
     C           SRSPIN    IFNE *BLANKS                                   S01157
     C*PROHIBITED if  spread/rate NOT ENTERED                             S01157
      ****                                                                S01157
     C           *IN36     IFEQ '0'                                       S01157
      *                                                                   S01157
     C           SRRTSP    IFEQ *BLANKS                                   S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 046'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN37                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           *IN37     IFEQ '0'                                       S01157
     C           SRSPIN    IFNE 'A'                                       S01157
     C           SRSPIN    ANDNE'S'                                       S01157
     C           SRSPIN    ANDNE'P'                                       S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 047'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN37                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C/COPY WNCPYSRC,DL1604IC57
     C* RATE FIX DAYS                                                     S01157
     C*                                                                   S01157
     C                     Z-ADD0         @FRFDX  20                      S01157
     C           SCFRFD    IFNE *BLANKS                                   S01157
     C           SAVRAM    IFEQ 'Y'                                       S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 182'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN57                           S01157
     C                     ELSE                                           S01157
     C                     Z-ADD0         ZADEC                           S01157
     C                     Z-ADD2         ZADIG                           S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     MOVE SCFRFD    ZFIELD                          S01157
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
     C*                                                                   S01157
     C           *IN99     IFEQ '0'                                       S01157
     C                     MOVE ZFIELD    @FRFDX                          S01157
     C                     ELSE                                           S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 101'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN57                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   E32190
     C** else, Rate Fix Days left blank, if Deal Currency is the same     E32190
     C** as the Local Currency and both are sterling (and not Average     E32190
     C** Rate Method) then default to zero else default to 2.             E32190
     C                     ELSE                                           E32190
     C           SUCUCY    IFNE BJLCCY                                    E32190
     C           SAVRAM    ANDNE'Y'                                       E32190
     C           SUCUCY    ORNE BLCYCD                                    E32190
     C           SAVRAM    ANDNE'Y'                                       E32190
     C                     Z-ADD02        @FRFDX                          E32190
     C                     END                                            E32190
     C                     END                                            S01157
     C*                                                                   S01157
     C* RATE CHANGE DATE                                                  S01157
     C*                                                                   S01157
     C                     Z-ADD0         @NICDX  50                      S01157
     C           SRNICD    IFNE *BLANKS                                   S01157
     C                     MOVELSRNICD    XTEST6                          S01157
     C                     EXSR XNTEST                                    S01157
     C*                                                                   S01157
     C           *IN84     IFEQ '1'                                       S01157
     C***                  MOVE STNICD    ZDATE                           S01157
     C                     MOVE SRNICD    ZDATE                           S01157
     C                     EXSR ZDATE1                                    S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           *IN84     IFEQ '0'                                       S01157
     C           *IN99     OREQ '1'                                       S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 103'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN58                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     END                                            S01157
     C                     MOVE '0'       *IN84                           S01157
     C*                                                                   S01157
     C*  CROSS-check with Value date,Maturity date and Run date.          S01157
     C           *IN58     IFEQ '0'                                       S01157
     C***********ZDAYNO    IFLT RUND                               S01157 S01194
     C           ZDAYNO    IFLT BJRDNB                                    S01194
     C                     ADD  1         S                               S01157
     C                     MOVE ' 104'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN58                           S01157
     C                     ELSE                                           S01157
     C*  CROSS check against Value date or Maturity date.                 S01157
     C           *IN20     IFEQ '0'                                       S01157
     C           ZDAYNO    ANDLEVDATX                                     S01157
     C           *IN21     OREQ '0'                                       S01157
     C           ZDAYNO    ANDGEMDATX                                     S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 105'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN58                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* Save valid date                                                   S01157
     C*                                                                   S01157
     C           *IN58     IFEQ '0'                                       S01157
     C                     Z-ADDZDAYNO    @NICDX                          S01157
     C                     Z-ADDZDAY      ZDAYX   20                      S01157
     C                     END                                            S01157
     C*CHECK through Sub-routine DLBACK if Average Rate Method NE Y       S01157
     C           SAVRAM    IFNE 'Y'                                       S01157
     C           *IN58     IFEQ '0'                                       S01157
     C           *IN57     ANDEQ'0'                                       S01157
     C           *IN23     ANDEQ'0'                                       S01157
     C                     Z-ADDZDAYNO    ZINDT                           S01157
     C                     Z-ADD@FRFDX    ZRFDY                           S01157
      *                                                                   108624
      ** If 'currency for rate fix holiday' flag from FRA/IRS I.C.D.      108624
      ** is 'F', 'L' or 'D', set currency code to 'sterling code',        108624
      ** 'local currency code' or 'screen currency code' respectively     108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'F'                                       108624
     C                     MOVE BLCYCD    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'L'                                       108624
     C                     MOVE BJLCCY    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'D'                                       108624
     C           BQCRFH    OREQ ' '                                       108624
     C                     MOVE SUCUCY    ZCCY                            S01157
     C                     ENDIF                                          108624
     C*                                                                   108624
     C                     MOVE *BLANKS   ZLOC    3                       S01195
      *                                                                   CIR005
      ** Calculate rate fix date using DLBACK if one of the following     CIR005
      ** conditions is satisfied:                                         CIR005
      ** 1) Business Day Convention enhancement is switched off.          CIR005
      ** 2) Business Day Convention enhancement is switched on and        CIR005
      **    BDC pass flag is set to 'Y' and Rate Fixing Dates Conven      CIR005
      **    tion currency is blank.                                       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDEQ*BLANK                                    CIR005
     C                     EXSR DLBACK                                    S01157
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Calculate rate fix date using new program IRRTFXCNV if the       CIR005
      ** following conditions are satisfied:                              CIR005
      ** 1) Business Day Convention enhancement is switched on.           CIR005
      ** 2) BDC pass flag is set to 'Y'.                                  CIR005
      ** 3) Rate Fixing Dates Convention Currency is not blank            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDNE*BLANK                                    CIR005
     C                     Z-ADDZRFDY     WRFDY                           CIR005
     C                     CALL IRRTFX    PIRRAT                          CIR005
     C                     ENDIF                                          CIR005
     C*                                                                   S01157
     C********** ZRFDT     IFLT RUND                               S01157 S01194
      *                                                                   CIR005
      ** CIR005 is on, validation should only be processed if Business    CIR005
      ** Day Convention pass flag is set to 'Y' (Business Day Curren -    CIR005
      ** cy input is already done), otherwise bypass the validation       CIR005
      *                                                                   CIR005
     C           ZRFDT     IFLT BJRDNB                                    S01194
     C           CIR005    ANDEQ'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           ZRFDT     ANDLTBJRDNB                                    CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C                     ADD  1         S                               S01157
     C                     MOVE ' 106'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN58                           S01157
     C                     Z-ADD0         @NICDX                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   047250
     C** CHECK IF THEIR RATE CHANGE DATE IS A HOLIDAY IN LOCAL CCY        047250
     C*                                                                   047250
     C           *IN58     IFEQ '0'                                       047250
     C                     MOVE @NICDX    ZDAYNO                          046958
     C***********          MOVE ' W23'    ER                        047250108190
     C                     MOVE ' W19'    ER                              108190
     C                     MOVE BJLCCY    ZCCY                            047250
     C                     MOVE BJSLCD    ZLOC                            047250
      *                                                                   CIR005
      ** Validate rate change date against the loc/deal curr. if one of   CIR005
      ** the following conditions is satisfied:                           CIR005
      ** 1.) Business Day Conventions (CIR005) is not installed.          CIR005
      ** 2.) Business Day Conventions is installed and BDC pass flag      CIR005
      **     is set to 'Y' and the Business Day Payment Convention        CIR005
      **     Currency entered from BDC input screen is blank              CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDPAY    ANDEQ*BLANK                                    CIR005
      *                                                                   CIR005
     C           ZDAYNO    IFNE 0                                         047250
     C                     EXSR ZCHKH                                     047250
     C           ZIND      IFEQ 'H'                                       047250
     C                     MOVE '1'       *IN07                           047250
     C                     ADD  1         W                               047250
     C                     MOVE ER        WRCD,W                          047250
     C                     MOVE '1'       *IN58                           047250
     C                     END                                            047250
     C                     END                                            047250
     C*                                                                   047250
     C** CHECK IF THEIR RATE CHANGE DATE IS A HOLIDAY IN                  047250
     C** DEALING CCY                                                      047250
     C*                                                                   047250
     C           *IN23     IFEQ '0'                                       047250
     C***********          MOVE ' W24'    ER                        047250108190
     C                     MOVE ' W20'    ER                              108190
     C                     MOVE SUCUCY    ZCCY                            047250
     C           ZDAYNO    IFNE 0                                         047250
     C                     EXSR ZCHKH                                     047250
     C           ZIND      IFEQ 'H'                                       047250
     C                     MOVE '1'       *IN07                           047250
     C                     ADD  1         W                               047250
     C                     MOVE ER        WRCD,W                          047250
     C                     MOVE '1'       *IN58                           047250
     C                     END                                            047250
     C                     END                                            047250
     C                     END                                            047250
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Validate rate change date against payment convention currency    CIR005
      ** if the following conditions are satisfied:                       CIR005
      ** 1.) BDC enhancement is installed (CIR005 = 'Y')                  CIR005
      ** 2.) BDC pass flag is set to 'Y'                                  CIR005
      ** 3.) Payment conv curr. entered from BDC input screen not blank   CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDPAY    ANDNE*BLANK                                    CIR005
     C           *IN58     ANDEQ*OFF                                      CIR005
     C                     MOVE *BLANK    ZLOC                            CIR005
     C                     MOVE *BLANK    HOL                             CIR005
     C                     MOVE 'N'       WHOLFN  1                       CIR005
     C                     Z-ADD1         H       20                      CIR005
     C                     Z-ADD1         C       20                      CIR005
     C                     Z-ADD1         A       20                      CIR005
     C                     Z-ADD3         L                               CIR005
      *                                                                   CIR005
      ** Get first currency                                               CIR005
      *                                                                   CIR005
     C           L         SUBSTPBDPAY:A  ZCCY                            CIR005
      *                                                                   CIR005
     C           C         DOWLE10                                        CIR005
     C           ZCCY      ANDNE*BLANK                                    CIR005
     C                     EXSR ZCHKH                                     CIR005
      *                                                                   CIR005
      ** Rate change date is holiday in payment convention currency       CIR005
      *                                                                   CIR005
     C           ZIND      IFEQ 'H'                                       CIR005
     C                     MOVELZCCY      HOL,H                           CIR005
     C                     ADD  1         H                               CIR005
      *                                                                   CIR005
      ** Set holiday found indicator to 'Y'                               CIR005
      *                                                                   CIR005
     C                     MOVE 'Y'       WHOLFN                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Get next currency                                                CIR005
      *                                                                   CIR005
     C                     ADD  1         C                               CIR005
     C                     ADD  3         A                               CIR005
     C           C         IFLE 10                                        CIR005
     C           L         SUBSTPBDPAY:A  ZCCY                            CIR005
     C                     ENDIF                                          CIR005
     C                     ENDDO                                          CIR005
      *                                                                   CIR005
      ** Holiday is found in any of the currency.. warning message        CIR005
      ** 'Rate Change Date is a holiday in Payment Convention Currency'   CIR005
      *                                                                   CIR005
     C           WHOLFN    IFEQ 'Y'                                       CIR005
     C                     MOVE *ON       *IN07                           CIR005
     C                     MOVE *ON       *IN58                           CIR005
     C                     MOVE 'Y'       WWARNG                          CIR005
     C                     MOVEAHOL       ZAMSDA                          CIR005
     C                     MOVEL'MMA1112' ZAMSID                          CIR005
     C                     MOVEL'DRSMM'   ZAMSGF                          CIR005
     C                     EXSR ZASNMS                                    CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C                     END                                            047250
     C                     END                                            S01157
     C*                                                                   S01157
     C* RATE CHANGE FREQUENCY                                             S01157
     C*                                                                   S01157
     C           SRICFR    IFNE *BLANK                                    S01157
     C           SRNICD    IFEQ *BLANKS                                   S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 107'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN59                           S01157
     C                     ELSE                                           S01157
     C           SRICFR    IFNE 'M'                                       S01157
     C           SRICFR    ANDNE'Q'                                       S01157
     C           SRICFR    ANDNE'X'                                       S01157
     C           SRICFR    ANDNE'Y'                                       S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 108'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN59                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* RATE CHANGE DAY                                                   S01157
     C*                                                                   S01157
     C                     Z-ADD0         TICFDX  20                      S01157
     C           SCICFD    IFNE *BLANKS                                   S01157
     C           SRICFR    IFEQ *BLANK                                    S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 109'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN60                           S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
     C           *IN60     IFEQ '0'                                       S01157
     C                     Z-ADD0         ZADEC                           S01157
     C                     Z-ADD2         ZADIG                           S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     MOVE SCICFD    ZFIELD                          S01157
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
      *                                                                   S01157
     C           *IN99     IFEQ '0'                                       S01157
     C                     MOVE ZFIELD    TICFDX                          S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN99     IFEQ '1'                                       S01157
     C           TICFDX    ORLT 1                                         S01157
     C           TICFDX    ORGT 31                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 110'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN60                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     Z-ADD0         TICFDX                          S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C* If not entered, but allowed - default                             S01157
     C*                                                                   S01157
     C***        STICFD    IFEQ *BLANKS                                   S01157
     C           SCICFD    IFEQ *BLANKS                                   S01157
     C***        STICFR    ANDNE*BLANKS                                   S01157
     C           SRICFR    ANDNE*BLANKS                                   S01157
     C           @NICDX    ANDNE0                                         S01157
     C                     Z-ADDZDAYX     TICFDX                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* SHORT TERM RATE                                                   S01157
     C*                                                                   S01157
     C                     Z-ADD0         WORK2X 117                      S01157
     C           *IN35     IFEQ '0'                                       S01157
     C           *IN20     ANDEQ'0'                                       S01157
     C           *IN69     ANDEQ'0'                                       S01157
     C           *IN23     ANDEQ'0'                                       S01157
     C           *IN61     ANDEQ'0'                                       S01157
     C*                                                                   S01157
     C           SAVRAM    IFEQ 'Y'                                       S01157
     C*                                                                   S01157
     C********   VDATX     IFLT RUND                               S01157 S01194
     C           VDATX     IFLT BJRDNB                                    S01194
     C           SWORKR    IFEQ *BLANKS                                   S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 184'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN61                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
     C           *IN57     IFEQ '0'                                       S01157
     C                     Z-ADDVDATX     ZINDT                           S01157
     C                     Z-ADD@FRFDX    ZRFDY                           S01157
      *                                                                   108624
      ** If 'currency for rate fix holiday' flag from FRA/IRS I.C.D.      108624
      ** is 'F', 'L' or 'D', set currency code to 'sterling code',        108624
      ** 'local currency code' or 'screen currency code' respectively     108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'F'                                       108624
     C                     MOVE BLCYCD    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'L'                                       108624
     C                     MOVE BJLCCY    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'D'                                       108624
     C           BQCRFH    OREQ ' '                                       108624
     C                     MOVE SUCUCY    ZCCY                            S01157
     C                     ENDIF                                          108624
     C*                                                                   108624
      *                                                                   CIR005
      ** Calculate rate fix date using DLBACK if one of the following     CIR005
      ** conditions is satisfied:                                         CIR005
      ** 1) Business Day Convention enhancement is switched off.          CIR005
      ** 2) Business Day Convention enhancement is switched on and        CIR005
      **    BDC pass flag is set to 'Y' and Rate Fixing Dates Conven      CIR005
      **    tion currency is blank.                                       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDEQ*BLANK                                    CIR005
     C                     EXSR DLBACK                                    S01157
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Calculate rate fix date using new program IRRTFXCNV if the       CIR005
      ** following conditions are satisfied:                              CIR005
      ** 1) Business Day Convention enhancement is switched on.           CIR005
      ** 2) BDC pass flag is set to 'Y'.                                  CIR005
      ** 3) Rate Fixing Dates Convention Currency is not blank            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDNE*BLANK                                    CIR005
     C                     Z-ADDZRFDY     WRFDY                           CIR005
     C                     CALL IRRTFX    PIRRAT                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   S01157
     C********   ZRFDT     IFLT RUND                               S01157 S01194
      *                                                                   CIR005
      ** CIR005 is on, validation should only be processed if Business    CIR005
      ** Day Convention pass flag is set to 'Y' (Business Day Curren -    CIR005
      ** cy input is already done), otherwise bypass the validation       CIR005
      *                                                                   CIR005
     C           ZRFDT     IFLT BJRDNB                                    S01194
     C           SWORKR    ANDEQ*BLANKS                                   S01157
     C           CIR005    ANDEQ'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           ZRFDT     ANDLTBJRDNB                                    CIR005
     C           SWORKR    ANDEQ*BLANKS                                   CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C                     ADD  1         S                               S01157
     C                     MOVE ' 183'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN61                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN61     IFEQ '0'                                       S01157
     C           SWORKR    ANDNE*BLANKS                                   S01157
     C                     Z-ADD7         ZADEC                           S01157
     C                     Z-ADD4         ZADIG                           S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     MOVE SWORKR    ZFIELD                          S01157
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
      *                                                                   S01157
     C           *IN99     IFEQ '0'                                       S01157
      *                                                                                     AR814519
      ** Sign must be '+' or '-'                                                            AR814519
      *                                                                                     AR814519
     C           SOSIGN    IFEQ ' '                                                         AR814519
     C                     MOVE '+'       SOSIGN  1                                         AR814519
     C                     ENDIF                                                            AR814519
      *                                                                                     AR814519
     C           SOSIGN    IFNE '+'                                                         AR814519
     C           SOSIGN    ANDNE'-'                                                         AR814519
     C                     ADD  1         S                                                 AR814519
     C                     MOVE ' 113'    ERCD,S                                            AR814519
     C                     MOVE '1'       *IN05                                             AR814519
     C                     MOVE '1'       *IN61                                             AR814519
      *                                                                                     AR814519
     C                     ELSE                                                             AR814519
      *                                                                                     AR814519
     C                     MOVE ZFIELD    WORK2X                          S01157
      *                                                                                     AR814519
     C           SOSIGN    IFEQ '-'                                                         AR814519
     C                     MULT -1        WORK2X                                            AR814519
     C                     ENDIF                                                            AR814519
      *                                                                                     AR814519
     C                     ENDIF                                                            AR814519
      *                                                                   S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 113'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     MOVE '1'       *IN61                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* INTEREST PAYMENT DATE                                             S01157
     C*                                                                   S01157
     C                     Z-ADD0         @NIPDX  50                      S01157
     C           SRNIPD    IFNE *BLANKS                                   S01157
     C                     MOVELSRNIPD    XTEST6                          S01157
     C                     EXSR XNTEST                                    S01157
     C           *IN84     IFEQ '1'                                       S01157
     C                     MOVE SRNIPD    ZDATE                           S01157
     C                     EXSR ZDATE1                                    S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN84     IFEQ '0'                                       S01157
     C           *IN99     OREQ '1'                                       S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 114'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN62                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     ELSE                                           S01157
      ** Cross check with Value Date/Maturity Date.                       S01157
     C           *IN20     IFEQ '0'                                       S01157
     C***********ZDAYNO    ANDLTVDATX                               S01157047256
     C           ZDAYNO    ANDLEVDATX                                     047256
     C********** *IN21     OREQ '0'                                S01157 185896
     C********** ZDAYNO    ANDGTMDATX                              S01157 185896
     C           ZDAYNO    ORGT MDATX                                     185896
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 115'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN62                           S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C* Save valid dates.                                                 S01157
     C           *IN62     IFEQ '0'                                       S01157
     C                     Z-ADDZDAYNO    @NIPDX                          S01157
     C                     Z-ADDZDAY      ZDAYX                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C           @NIPDX    IFNE 0                                         S01157
     C           SAVRAM    ANDEQ'Y'                                       S01157
     C           *IN58     ANDEQ'0'                                       S01157
      *                                                                   S01157
     C           @NICDX    IFEQ 0                                         S01157
     C           *IN21     ANDEQ'0'                                       S01157
     C           @NIPDX    ANDNEMDATX                                     S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 186'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN62                           S01157
     C                     END                                            S01157
     C           *IN62     IFEQ '0'                                       S01157
     C           @NICDX    ANDNE0                                         S01157
      *                                                                   S01157
     C           @NIPDX    IFLT @NICDX                                    S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 196'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN62                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN62     IFEQ '0'                                       S01157
     C           @NICDX    ANDLT@NIPDX                                    S01157
     C           *IN59     ANDEQ'0'                                       S01157
     C           *IN60     ANDEQ'0'                                       S01157
     C           *IN21     ANDEQ'0'                                       S01157
     C*                                                                   S01157
     C           SRICFR    IFEQ *BLANKS                                   S01157
     C                     Z-ADDMDATX     ZDAYNO                          S01157
     C                     ELSE                                           S01157
     C                     MOVE SRICFR    ZFREQ                           S01157
     C                     Z-ADD@NICDX    ZDAYNO                          S01157
     C                     Z-ADDTICFDX    ZMDAY                           S01157
     C                     MOVE SUCUCY    ZCCY                            S01157
     C                     MOVE *BLANKS   ZLOC                            S01117
      *                                                                   S01157
     C           ZDAYNO    DOWLT@NIPDX                                    S01157
     C*********            EXSR ZFREQB                            S01157  S01195
     C                     EXSR @FREQB                                    S01195
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           ZDAYNO    IFNE @NIPDX                                    S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 197'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN62                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN62     IFEQ '1'                                       S01157
     C                     Z-ADD0         @NIPDX                          S01157
     C                     END                                            S01157
      *                                                                   CIR005
      ** Validate intrst pymnt date against payment convention currency   CIR005
      ** if the following conditions are satisfied:                       CIR005
      ** 1.) BDC enhancement is installed (CIR005 = 'Y')                  CIR005
      ** 2.) BDC pass flag is set to 'Y'                                  CIR005
      ** 3.) Payment conv curr. entered from BDC input screen not blank   CIR005
      ** 4.) Entry to next interest payment date is made                  CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDPAY    ANDNE*BLANK                                    CIR005
     C           SRNIPD    ANDNE*BLANK                                    CIR005
     C           *IN62     ANDEQ*OFF                                      CIR005
     C                     MOVE BJSLCD    ZLOC                            CIR005
     C                     MOVE *BLANK    HOL                             CIR005
     C                     MOVE 'N'       WHOLFN                          CIR005
     C                     Z-ADD1         H                               CIR005
     C                     Z-ADD1         C                               CIR005
     C                     Z-ADD1         A                               CIR005
     C                     Z-ADD3         L                               CIR005
      *                                                                   CIR005
      ** Get first currency                                               CIR005
      *                                                                   CIR005
     C           L         SUBSTPBDPAY:A  ZCCY                            CIR005
      *                                                                   CIR005
     C           C         DOWLE10                                        CIR005
     C           ZCCY      ANDNE*BLANK                                    CIR005
     C                     EXSR ZCHKH                                     CIR005
      *                                                                   CIR005
      ** Rate change date is holiday in payment convention currency       CIR005
      *                                                                   CIR005
     C           ZIND      IFEQ 'H'                                       CIR005
     C                     MOVELZCCY      HOL,H                           CIR005
     C                     ADD  1         H                               CIR005
      *                                                                   CIR005
      ** Set holiday found indicator to 'Y'                               CIR005
      *                                                                   CIR005
     C                     MOVE 'Y'       WHOLFN                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Get next currency                                                CIR005
      *                                                                   CIR005
     C                     ADD  1         C                               CIR005
     C                     ADD  3         A                               CIR005
     C           C         IFLE 10                                        CIR005
     C           L         SUBSTPBDPAY:A  ZCCY                            CIR005
     C                     ENDIF                                          CIR005
     C                     ENDDO                                          CIR005
      *                                                                   CIR005
      ** Holiday is found in any of the currency.. warning message        CIR005
      ** 'Interest Payment Date is a holiday in Payment Convention -      CIR005
      ** Currency'                                                        CIR005
      *                                                                   CIR005
     C           WHOLFN    IFEQ 'Y'                                       CIR005
     C                     MOVE *ON       *IN07                           CIR005
     C                     MOVE *ON       *IN62                           CIR005
     C                     MOVE 'Y'       WWARNG                          CIR005
     C                     MOVEAHOL       ZAMSDA                          CIR005
     C                     MOVEL'MMA1113' ZAMSID                          CIR005
     C                     MOVEL'DRSMM'   ZAMSGF                          CIR005
     C                     EXSR ZASNMS                                    CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
     C*                                                                   S01157
     C* INTERST PAYMENT FREQ                                              S01157
     C*                                                                   S01157
     C           SRIPFR    IFNE *BLANK                                    S01157
      *                                                                   S01157
     C           SRNIPD    IFEQ *BLANKS                                   S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 116'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN63                           S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
     C           SRIPFR    IFNE 'M'                                       S01157
     C           SRIPFR    ANDNE'Q'                                       S01157
     C           SRIPFR    ANDNE'X'                                       S01157
     C           SRIPFR    ANDNE'Y'                                       S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 117'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN63                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN63     IFEQ '0'                                       S01157
     C           SRIPFR    ANDNE*BLANKS                                   S01157
     C           SAVRAM    ANDEQ'Y'                                       S01157
     C           *IN60     ANDEQ'0'                                       S01157
      *                                                                   S01157
     C***        STICFR    IFEQ *BLANKS                                   S01157
     C           SRICFR    IFEQ *BLANKS                                   S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 189'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN63                           S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
     C           SRICFR    IFEQ 'Q'                                       S01157
     C           SRIPFR    ANDNE'Q'                                       S01157
     C           SRIPFR    ANDNE'X'                                       S01157
     C           SRIPFR    ANDNE'Y'                                       S01157
      *                                                                   S01157
     C           SRICFR    OREQ 'X'                                       S01157
     C           SRIPFR    ANDNE'X'                                       S01157
     C           SRIPFR    ANDNE'Y'                                       S01157
      *                                                                   S01157
     C           SRICFR    OREQ 'Y'                                       S01157
     C           SRIPFR    ANDNE'Y'                                       S01157
      *                                                                   S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 190'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN63                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* INTEREST PAYMENT DAY                                              S01157
     C*                                                                   S01157
     C                     Z-ADD0         TIPFDX  20                      S01157
     C           SRIPFD    IFNE *BLANKS                                   S01157
     C           SRIPFR    IFEQ *BLANKS                                   S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 118'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN64                           S01157
     C                     ELSE                                           S01157
      *                                                                   S01157
      *                                                                   S01157
     C           *IN64     IFEQ '0'                                       S01157
     C                     Z-ADD0         ZADEC                           S01157
     C                     Z-ADD2         ZADIG                           S01157
     C                     MOVE *BLANKS   ZFIELD                          S01157
     C                     MOVE SRIPFD    ZFIELD                          S01157
     C                     MOVE 'N'       ZAOPT                           S01157
     C                     EXSR ZALIGN                                    S01157
      *                                                                   S01157
     C           *IN99     IFEQ '0'                                       S01157
     C                     MOVE ZFIELD    TIPFDX                          S01157
     C                     END                                            S01157
      *                                                                   S01157
     C           *IN99     IFEQ '1'                                       S01157
     C           TIPFDX    ORLT 1                                         S01157
     C           TIPFDX    ORGT 31                                        S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 119'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN64                           S01157
     C                     MOVE '0'       *IN99                           S01157
     C                     Z-ADD0         TIPFDX                          S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
     C                     END                                            S01157
     C                     END                                            S01157
      *                                                                   S01157
      * If not entered, but allowed - default                             S01157
      *                                                                   S01157
     C           SRIPFD    IFEQ *BLANKS                                   S01157
     C           SRIPFR    ANDNE*BLANKS                                   S01157
     C           @NIPDX    ANDNE0                                         S01157
     C                     Z-ADDZDAYX     TIPFDX                          S01157
     C/COPY WNCPYSRC,DL1604IC63
     C                     END                                            S01157
      /SPACE 1                                                            S01157
      *                                                                   S01157
      * Cross validate, if Rate Chg & Next Payments details valid         S01157
      *                                                                   S01157
     C           SAVRAM    IFEQ 'Y'                                       S01157
     C           TICFDX    ANDNETIPFDX                                    S01157
     C           @NICDX    ANDNE0                                         S01157
     C           @NIPDX    ANDNE0                                         S01157
      *                                                                   S01157
     C           SRIPFD    IFNE *BLANKS                                   S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 200'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN64                           S01157
      *                                                                   S01157
     C                     ELSE                                           S01157
      * Avoid exceeding size of error code array.                         S01157
     C           S         IFLT 38                                        S01157
     C                     ADD  1         S                               S01157
     C                     MOVE ' 201'    ERCD,S                          S01157
     C                     MOVE '1'       *IN05                           S01157
     C                     END                                            S01157
     C                     MOVE '1'       *IN64                           S01157
     C                     END                                            S01157
      *                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC29                                           S01408
     C*                                                                   S01408
      /SPACE 4
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *                 IRS UP-FRONT FEE (PREMIUM)                    *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
      ** Only perform Up-front Fee validation if enhancement              CIR001
      ** CIR001 is ON.                                                    CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           CIR006    ANDEQ'N'                                       CIR006
      *                                                                   CIR001
     C                     MOVE '0'       *IN01                           CIR001
     C                     MOVE '0'       *IN02                           CIR001
      *                                                                   CIR001
      ** If Deal date and Maturity date are valid                         CIR001
      *                                                                   CIR001
     C           *IN14     IFEQ '0'                                       CIR001
     C           *IN21     ANDEQ'0'                                       CIR001
     C           *IN21     OREQ '1'                                       127424
      *                                                                   CIR001
      ** Validate Up-front Value Date.                                    CIR001
      *                                                                   CIR001
     C           SUPVD     IFEQ *BLANKS                                   CIR001
     C           SUPFE     IFNE *BLANKS                                   CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' 432'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN05                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE *BLANKS   ZDATE                           CIR001
     C                     MOVE *BLANKS   UPVDX                           CIR001
     C           *IN01     IFEQ '0'                                       CIR001
     C           SUPVD     ANDNE*BLANKS                                   CIR001
     C                     MOVE SUPVD     ZDATE                           CIR001
     C                     EXSR ZDATE1                                    CIR001
     C           *IN99     IFEQ '1'                                       CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' 433'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN05                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     MOVE '0'       *IN99                           CIR001
     C                     END                                            CIR001
     C                     ELSE                                           CIR001
     C                     MOVE ZDAYNO    UPVDX   50                      CIR001
      *                                                                   CIR001
     C           UPVDX     IFLT DDATX                                     CIR001
     C           UPVDX     ORGE MDATX                                     CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' 434'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN05                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           *IN20     IFEQ '0'                                       CIR001
     C           *IN01     ANDEQ'0'                                       CIR001
     C           UPVDX     ANDGTVDATX                                     CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' W17'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN07                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** If Deal Ccy code is valid                                        CIR001
      *                                                                   CIR001
     C           *IN23     IFEQ '0'                                       CIR001
     C                     CALL 'AOCURRR0'                                CIR001
     C                     PARM '*DBERR ' @RTCD   7                       CIR001
     C                     PARM '*KEY   ' @OPTN   7                       CIR001
     C                     PARM SUCUCY    @CYCD   3                       CIR001
     C           SDCURR    PARM SDCURR    DSSDY                           CIR001
      *                                                                   CIR001
      ** Validate Up-front Fee Amount.                                    CIR001
      *                                                                   CIR001
     C           SUPFE     IFEQ *BLANKS                                   CIR001
     C           SUPVD     IFNE *BLANKS                                   CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' 435'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN05                           CIR001
     C                     MOVE '1'       *IN02                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           *IN02     IFEQ '0'                                       CIR001
     C           SUPFE     ANDNE*BLANKS                                   CIR001
      *                                                                   CIR001
      ** Validate the Amount using ZALIGN.                                CIR001
      *                                                                   CIR001
     C                     Z-ADD0         UPFEX  130                      CIR001
     C                     MOVE *BLANKS   ZFIELD                          CIR001
     C                     MOVELSUPFE     ZFIELD                          CIR001
     C                     Z-ADDA6NBDP    ZADEC                           CIR001
     C           13        SUB  A6NBDP    ZADIG                           CIR001
     C                     EXSR ZALIGN                                    CIR001
     C           *IN99     IFEQ '0'                                       CIR001
     C                     MOVE ZFIELD    UPFEX                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** UPFEX is numeric work field for comparison with 0.               CIR001
      *                                                                   CIR001
     C           *IN99     IFEQ '1'                                       CIR001
     C           UPFEX     ORLE 0                                         CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' 436'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN05                           CIR001
     C                     MOVE '1'       *IN02                           CIR001
     C                     MOVE '0'       *IN99                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Warning if value date is a holiday for the equivalent CCY.       CIR001
      *                                                                   CIR001
     C           SBYSL     IFEQ 'B'                                       CIR001
     C           SPSETM    IFEQ '01'                                      CIR001
     C           SPSETM    OREQ '02'                                      CIR001
     C           SPSETM    OREQ '07'                                      CIR001
     C           SPSETM    OREQ '08'                                      CIR001
     C           SPSETM    OREQ '12'                                      CIR001
      *                                                                   CEU003
      ** If SAR CEU003 is not installed, then validate value date         CEU003
      ** against transaction currency.                                    CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'N'                                       CEU003
     C                     MOVE SUCUCY    ZCCY                            CIR001
     C                     Z-ADDUPVDX     ZDAYNO                          CIR001
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     EXSR ZCHKH                                     CIR001
      *                                                                   CIR001
      ** If the date is a holiday                                         CIR001
      *                                                                   CIR001
     C           ZIND      IFEQ 'H'                                       CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' W23'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN07                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
     C                     ELSE                                           CIR001
     C                     MOVE BJLCCY    ZCCY                            CIR001
     C                     Z-ADDUPVDX     ZDAYNO                          CIR001
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     EXSR ZCHKH                                     CIR001
      *                                                                   CIR001
      ** If the date is a holiday                                         CIR001
      *                                                                   CIR001
     C           ZIND      IFEQ 'H'                                       CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' W24'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN07                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           SBYSL     IFEQ 'S'                                       CIR001
     C           SRSETM    IFEQ '01'                                      CIR001
     C           SRSETM    OREQ '02'                                      CIR001
     C           SRSETM    OREQ '07'                                      CIR001
     C           SRSETM    OREQ '08'                                      CIR001
     C           SRSETM    OREQ '12'                                      CIR001
      *                                                                   CEU003
      ** If SAR CEU003 is not installed, then validate value date         CEU003
      ** against transaction currency.                                    CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'N'                                       CEU003
     C                     MOVE SUCUCY    ZCCY                            CIR001
     C                     Z-ADDUPVDX     ZDAYNO                          CIR001
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     EXSR ZCHKH                                     CIR001
      *                                                                   CIR001
      **  If the date is a holiday                                        CIR001
      *                                                                   CIR001
     C           ZIND      IFEQ 'H'                                       CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' W23'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN07                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
     C                     ELSE                                           CIR001
     C                     MOVE BJLCCY    ZCCY                            CIR001
     C                     Z-ADDUPVDX     ZDAYNO                          CIR001
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     EXSR ZCHKH                                     CIR001
      *                                                                   CIR001
      **  If the date is a holiday                                        CIR001
      *                                                                   CIR001
     C           ZIND      IFEQ 'H'                                       CIR001
      * Avoid exceeding size of error code array.                         CIR001
     C           S         IFLT 38                                        CIR001
     C                     ADD  1         S                               CIR001
     C                     MOVE ' W24'    ERCD,S                          CIR001
     C                     MOVE '1'       *IN07                           CIR001
     C                     MOVE '1'       *IN01                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC30                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
      /SPACE 4                                                            CIR001
      *****************************************************************
      *                                                               *
      *                 SETTLEMENT  METHODS                           *
      *                                                               *
      *****************************************************************
      *                                                                   CEU003
      ** Settlement Currency Validation                                   CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *  If settlement currency is blank, then transaction-               CEU003
      *  currency will be the taken internally.                           CEU003
     C           SSTCY     IFNE *BLANKS                                   CEU003
      *                                                                   CEU003
     C           SUCUCY    IFNE BKEURO                                    CEU003
     C           WSUCIN    ANDNE'Y'                                       CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 701'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN47                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM *BLANK    P@RTCD  7                       CEU003
     C                     PARM '*KEY   ' P@OPTN  7                       CEU003
     C                     PARM SSTCY     P@CUCY  3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
      *  An 'In' currency only if the transaction currency                CEU003
      *  SUCUCY is EURO.                                                  CEU003
     C                     MOVELA6CYCD    SSTCY                           CEU003
     C           SUCUCY    IFEQ BKEURO                                    CEU003
      ***********                                                  CEU003 134935
      ***If*value*date*is*earlier*than*the*EMU*transition*start*datCEU003 134935
      ***then*it*should*not*be*defined*as*an*'In'*currency.*       CEU003 134935
      ***********                                                  CEU003 134935
     C***********A6TPSD    IFGT VDATX                              CEU003 134935
     C************IN20     ANDEQ'0'                                CEU003 134935
     C***********          MOVE 'N'       A6INCY                   CEU003 134935
     C***********          ENDIF                                   CEU003 134935
      *                                                                   CEU003
     C           A6INCY    IFNE 'Y'                                       CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 702'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN47                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *  A EURO code currency only if the transaction currency            CEU003
      *  SUCUCY is an 'In' currency.                                      CEU003
     C           SSTCY     IFNE BKEURO                                    CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 703'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN47                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *  Settlement currency is not found on currency file.               CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 801'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN47                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Derivation of Effective-Settlement-Currency-Workfield.           CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WSTCY   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           *IN47     ANDEQ'0'                                       CEU003
     C           SSTCY     ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVE SSTCY     WSTCY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVE SUCUCY    WSTCY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Check if maturity date is a holiday in the settlement            CEU003
      ** currency.                                                        CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           *IN47     ANDEQ'0'                                       CEU003
     C           *IN21     ANDEQ'0'                                       CEU003
     C           *IN23     ANDEQ'0'                                       CEU003
      *                                                                   CEU003
     C                     Z-ADDMDATX     ZDAYNO                          CEU003
     C                     MOVE ' W16'    ER                              CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C                     MOVE BJSLCD    ZLOC                            CEU003
     C           ZDAYNO    IFNE 0                                         CEU003
     C                     EXSR ZCHKH                                     CEU003
     C           ZIND      IFEQ 'H'                                       CEU003
     C                     MOVE '1'       *IN07                           CEU003
     C                     ADD  1         W                               CEU003
     C                     MOVE ER        WRCD,W                          CEU003
     C                     MOVE '1'       *IN21                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
     C/COPY WNCPYSRC,DL1604IC76
      *                                                                   CEU003
      ** Check if value date is a holiday in the settlement               CEU003
      ** currency.                                                        CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           CIR001    ANDEQ'Y'                                       CEU003
     C           *IN47     ANDEQ'0'                                       CEU003
     C           *IN23     ANDEQ'0'                                       CEU003
      *                                                                   CEU003
     C           SBYSL     IFEQ 'B'                                       CEU003
     C           SPSETM    IFEQ '01'                                      CEU003
     C           SPSETM    OREQ '02'                                      CEU003
     C           SPSETM    OREQ '07'                                      CEU003
     C           SPSETM    OREQ '08'                                      CEU003
     C           SPSETM    OREQ '12'                                      CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C                     Z-ADDUPVDX     ZDAYNO                          CEU003
     C                     MOVE BJSLCD    ZLOC                            CEU003
     C                     EXSR ZCHKH                                     CEU003
      *                                                                   CEU003
      ** If the date is a holiday                                         CEU003
      *                                                                   CEU003
     C           ZIND      IFEQ 'H'                                       CEU003
      * Avoid exceeding size of error code array.                         CEU003
     C           S         IFLT 38                                        CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' W23'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN07                           CEU003
     C                     MOVE '1'       *IN01                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           SBYSL     IFEQ 'S'                                       CEU003
     C           SRSETM    IFEQ '01'                                      CEU003
     C           SRSETM    OREQ '02'                                      CEU003
     C           SRSETM    OREQ '07'                                      CEU003
     C           SRSETM    OREQ '08'                                      CEU003
     C           SRSETM    OREQ '12'                                      CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C                     Z-ADDUPVDX     ZDAYNO                          CEU003
     C                     MOVE BJSLCD    ZLOC                            CEU003
     C                     EXSR ZCHKH                                     CEU003
      *                                                                   CEU003
      **  If the date is a holiday                                        CEU003
      *                                                                   CEU003
     C           ZIND      IFEQ 'H'                                       CEU003
      * Avoid exceeding size of error code array.                         CEU003
     C           S         IFLT 38                                        CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' W23'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN07                           CEU003
     C                     MOVE '1'       *IN01                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C/COPY WNCPYSRC,DL1604IC77
      *
      ** Validate Receipt Settlement Method.
      * (01,02,03,04,05,06,07,08,12,14)                                   S01117
     C           SRSETM    IFNE *BLANKS
      *
     C* ENQUIRY NOT ALLOWED FOR SETTLEMENT INSTRUCTIONS                   S01194
     C*                                                                   S01194
     C                     MOVELSRSETM    @QMARK                          S01194
     C           @QMARK    IFEQ '?'                                       S01194
      * Avoid exceeding size of error code array.                         S01194
     C           S         IFLT 38                                        S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 407'    ERCD,S                          S01194
     C                     MOVE '1'       *IN05                           S01194
     C                     MOVE '1'       *IN38                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C* NO FURTHER VALIDATION REQUIRED.                                   S01194
     C*                                                                   S01194
     C                     ELSE                                           S01194
     C*                                                                   S01194
     C           SRSETM    IFLT '00'
     C           SRSETM    ORGT '08'
     C           SRSETM    ANDNE'12'
     C           SRSETM    ANDNE'14'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 061'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN38
     C                     END
      *
     C           *IN38     IFEQ '0'
      *
     C           SRSETM    IFEQ '04'
     C           SRSETM    OREQ '14'
      *
     C************IN89*****IFEQ '0'                                       S01194
     C           BGRTBN    IFEQ 'N'                                       S01194
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 062'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN38
     C                     END
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IVSF                                           S01408
     C*                                                                   S01408
      *
     C           *IN38     IFEQ '0'
     C           *IN88     ANDEQ'0'
     C           SRSETM    ANDEQ'14'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 063'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN38
     C                     END
      *
     C           *IN38     IFEQ '0'
     C***********SUCUCY****ANDNEUSCY                                      S01194
     C           SUCUCY    ANDNEBLUSCY                                    S01194
     C           SRSETM    ANDEQ'07'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 064'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN38
     C                     END
     C                     END
      *
     C                     END                                            S01194
      /SPACE 2
      ** Validate Payment Settlement Method.
     C           SPSETM    IFNE *BLANKS
      *
     C* ENQUIRY NOT ALLOWED FOR SETTLEMENT INSTRUCTIONS                   S01194
     C*                                                                   S01194
     C                     MOVELSPSETM    @QMARK                          S01194
     C           @QMARK    IFEQ '?'                                       S01194
      * Avoid exceeding size of error code array.                         S01194
     C           S         IFLT 38                                        S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 407'    ERCD,S                          S01194
     C                     MOVE '1'       *IN05                           S01194
     C                     MOVE '1'       *IN39                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C* NO FURTHER VALIDATION REQUIRED.                                   S01194
     C*                                                                   S01194
     C                     ELSE                                           S01194
     C*                                                                   S01194
     C           SPSETM    IFLT '00'
     C           SPSETM    ORGT '08'
     C           SPSETM    ANDNE'12'
     C           SPSETM    ANDNE'14'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 061'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN39
     C                     END
      *
     C           *IN39     IFEQ '0'
      *
     C           SPSETM    IFEQ '04'
     C           SPSETM    OREQ '14'
      *
     C************IN89*****IFEQ '0'                                       S01194
     C           BGRTBN    IFEQ 'N'                                       S01194
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 062'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN39
     C                     END
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IVS1                                           S01408
     C*                                                                   S01408
      *
     C           *IN39     IFEQ '0'
     C           *IN88     ANDEQ'0'
     C           SPSETM    ANDEQ'14'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 063'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN39
     C                     END
      *
     C           *IN39     IFEQ '0'
     C***********SUCUCY****ANDNEUSCY                                      S01194
     C           SUCUCY    ANDNEBLUSCY                                    S01194
     C           SPSETM    ANDEQ'07'
      * Avoid exceeding size of error code array.
     C           S         IFLT 38
     C                     ADD  1         S
     C                     MOVE ' 064'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     END
     C                     MOVE '1'       *IN39
     C                     END
     C                     END
      *
     C                     END                                            S01194
      /SPACE 3
      *****************************************************************
      *
      **               WARNING ERRORS
      *
      *****************************************************************
      *
      ** Set Day Number According to entries.
      *
     C           *IN32     IFEQ '0'
     C           *IN35     ANDEQ'0'
      *
     C                     Z-ADD0         ZDAYNO
      *
     C**         SUBRTT    IFGT '00'                                      S01157
     C****       *IN51     ANDEQ'0'                                       S01157
      *
     C***        SUNIPD    IFNE *BLANKS                                   S01157
     C***                  Z-ADDUNIPDX    ZDAYNO                          S01157
     C***                  END                                            S01157
      *
     C***        UNIPDX    IFEQ 0                                         S01157
     C***        *IN47     ANDEQ'0'                                       S01157
      *
     C****       SUNICD    IFNE *BLANKS                                   S01157
     C***                  Z-ADDUNICDX    ZDAYNO                          S01157
     C***                  END                                            S01157
      *
     C***        UNIPDX    IFEQ 0                                         S01157
     C***        *IN21     ANDEQ'0'                                       S01157
     C***                  Z-ADDMDATX     ZDAYNO                          S01157
     C***                  END                                            S01157
      *
     C***                  END                                            S01157
     C****                 END                                            S01157
      ** if their details entered.
      *
     C           ZDAYNO    IFEQ 0
      *
     C***        STBRTT    ANDGT'00'                                      S01157
     C           SRBRTT    ANDGT'00'                                      S01157
     C           *IN62     ANDEQ'0'
      *
     C***        STNIPD    IFNE *BLANKS                                   S01157
     C           SRNIPD    IFNE *BLANKS                                   S01157
     C****                 Z-ADDTNIPDX    ZDAYNO                          S01157
     C                     Z-ADD@NIPDX    ZDAYNO                          S01157
     C                     END
      *
     C****       TNIPDX    IFEQ 0                                         S01157
     C           @NIPDX    IFEQ 0                                         S01157
     C           *IN58     ANDEQ'0'
      *
     C***        STNICD    IFNE *BLANKS                                   S01157
     C           SRNICD    IFNE *BLANKS                                   S01157
     C****                 Z-ADDTNICDX    ZDAYNO                          S01157
     C                     Z-ADD@NICDX    ZDAYNO                          S01157
     C                     END
      *
     C****       TNIPDX    IFEQ 0                                         S01157
     C           @NIPDX    IFEQ 0                                         S01157
     C           SRNICD    ANDEQ*BLANKS                                   E21041
     C           *IN21     ANDEQ'0'
     C                     Z-ADDMDATX     ZDAYNO
     C                     END
      *
     C                     END
     C                     END
      *
      *
      ** Receipt Warnings.
      *
     C*****      ZDAYNO    IFNE 0                                         S01195
     C*****      SRSETM    IFEQ '01'                                      S01195
     C*****      SRSETM    OREQ '07'                                      S01195
     C*****      SRSETM    OREQ '08'                                      S01195
     C*****                MOVE ' W11'    ER      4                       S01195
     C*****      *IN23     IFEQ '0'                                       S01195
     C*****                MOVE SUCUCY    ZCCY                            S01195
     C*****                ELSE                                           S01195
     C*****                Z-ADD0         ZDAYNO                          S01195
     C*****                END                                            S01195
     C*****                ELSE                                           S01195
     C*****                MOVE ' W12'    ER                              S01195
     C*****                MOVE LOCY      ZCCY                            S01195
     C*****                END                                            S01195
     C*****                END                                            S01195
      *****                                                               S01195
     C*****      ZDAYNO    IFNE 0                                         S01195
     C*****                MOVE 'N'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C*****      *IN99     IFEQ '1'                                       S01195
     C*****                MOVE '0'       *IN99                           S01195
     C*****                MOVE '1'       *IN07                           S01195
      *****                                                               S01195
     C*****                ADD  1         W                               S01195
     C*****                MOVE ER        WRCD,W                          S01195
     C*****                MOVE '1'       *IN38                           S01195
     C*****                END                                            S01195
     C*****                END                                            S01195
     C*                                                                   S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C*                                                                   S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If Settlement is through a NOSTRO, set day number to a work       S01195
     C* field and generate any WARNING ERRORS in VALD14, when Nostro      S01195
     C* Location is known                                                 S01195
     C*                                                                   S01195
     C                     Z-ADDZDAYNO    @DAYNO  50                      S01195
     C*                                                                   S01195
     C                     GOTO VNOSR                                     S01195
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Settlement is NOT through a NOSTRO...                             S01195
     C* ZCCY set to LOCAL CURRENCY                                        S01195
     C* ZLOC set to SYSTEM LOCATION                                       S01195
     C*                                                                   S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
      * Only generate warning error if no error already in either         S01195
      * Settlement Method field or Interest Payment Date field            S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C           *IN62     ANDNE'1'                                       S01195
     C           *IN38     ANDNE'1'                                       S01195
     C*                                                                   S01195
     C* ZCHKH is a subroutine to check whether a date is a Holiday        S01195
     C*                                                                   S01195
     C                     MOVE '    '    ER      4                       S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE '1'       *IN07                           S01195
      *                                                                   S01195
     C                     ADD  1         W                               S01195
     C                     MOVE ' W12'    WRCD,W                          S01195
     C                     MOVE '1'       *IN38                           S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* BYPASS-TAG used if RECEIPT SETTLEMENT is through a NOSTRO         S01195
     C*                                                                   S01195
     C           VNOSR     TAG                                            S01195
     C*                                                                   S01195
     C*    <====== END OF RECEIVE WARNING VALIDATION ======>              S01195
      *                                                                   S01195
      ** Payment Warnings.                                                S01195
      *                                                                   S01195
     C*****      ZDAYNO    IFNE 0                                         S01195
     C*****      SPSETM    IFEQ '01'                                      S01195
     C*****      SPSETM    OREQ '07'                                      S01195
     C*****      SPSETM    OREQ '08'                                      S01195
     C*****                MOVE ' W13'    ER                              S01195
     C*****      *IN23     IFEQ '0'                                       S01195
     C*****                MOVE SUCUCY    ZCCY                            S01195
     C*****                ELSE                                           S01195
     C*****                Z-ADD0         ZDAYNO                          S01195
     C*****                END                                            S01195
     C*****                ELSE                                           S01195
     C*****                MOVE ' W14'    ER                              S01195
     C*****                MOVE LOCY      ZCCY                            S01195
     C*****                END                                            S01195
     C*****                END                                            S01195
      *****                                                               S01195
     C*****      ZDAYNO    IFNE 0                                         S01195
     C*****                MOVE 'N'       ZOPT                            S01195
     C*****                EXSR ZDATE5                                    S01195
     C*****      *IN99     IFEQ '1'                                       S01195
     C*****                MOVE '1'       *IN07                           S01195
     C*****                MOVE '0'       *IN99                           S01195
      *****                                                               S01195
     C*****                ADD  1         W                               S01195
     C*****                MOVE ER        WRCD,W                          S01195
     C*****                MOVE '1'       *IN39                           S01195
     C*****                END                                            S01195
     C*****                END                                            S01195
     C*                                                                   S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C*                                                                   S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If Settlement is through a NOSTRO, set day number to a work       S01195
     C* field and generate any WARNING ERRORS in VALD14, when Nostro      S01195
     C* Location is known                                                 S01195
     C*                                                                   S01195
     C                     Z-ADDZDAYNO    @DAYNO                          S01195
     C*                                                                   S01195
     C                     GOTO VNOSP                                     S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Settlement is NOT through a NOSTRO...                             S01195
     C* ZCCY set to LOCAL CURRENCY                                        S01195
     C* ZLOC set to SYSTEM LOCATION                                       S01195
     C*                                                                   S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      * Only generate warning error if no error already in either         S01195
      * Settlement Method field or Interest Payment Date field            S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C           *IN62     ANDNE'1'                                       S01195
     C           *IN39     ANDNE'1'                                       S01195
     C*                                                                   S01195
     C* ZCHKH is a subroutine to check whether a date is a Holiday        S01195
     C*                                                                   S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE '1'       *IN07                           S01195
      *                                                                   S01195
     C                     ADD  1         W                               S01195
     C                     MOVE ' W14'    WRCD,W                          S01195
     C                     MOVE '1'       *IN39                           S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* BYPASS-TAG used if PAYMENT SETTLEMENT is through a NOSTRO         S01195
     C*                                                                   S01195
     C           VNOSP     TAG                                            S01195
     C*                                                                   S01195
     C*    <====== END OF PAYMENT WARNING VALIDATION ======>              S01195
     C*                                                                   S01195
     C                     END
      *
      *
     C*                                                                   S01157
     C* IF DEAL TYPE IS A FLOOR - SET CEILING RATE TO ALL 9'S             S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RF'                                      S01157
     C                     Z-ADD*HIVAL    CLRATX                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           V12END    ENDSR
      ********************************************************************
      /SPACE 5
      *****************************************************************
      *                To test whether a 6 character field contains   *
      *  XNTEST  SR.   only numeric data                              *
      *                ( *IN84 = '1' if all numeric )                 *
      *  CALLED FROM : RLAMD, VALD12, V14UB, V14CB                    *
      *****************************************************************
     C           XNTEST    BEGSR
      **
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       HIGHZ   1
     C                     TESTN          TESTX6     84
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALD14  SR.   To validate 2nd RL insert screen               *
      *                                                               *
      *  CALLED FROM : RLINS                                          *
      *  CALLS       : V14UB    V14CB                                 *
      *                                                               *
      *****************************************************************
      *
     C           VALD14    BEGSR
      *                                                                   S01117
      ** Set SURACC to SORACC and set SUPACC to SOPACC                    S01117
      ** so that it can be used for validation routine.                   S01117
     C*                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     MOVE SORACC    SURACC                          S01117
     C                     MOVE SOPACC    SUPACC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
      * DO NOT VALIDATE, IF warning errors only                           S01117
      *                 AND  data not changed.                            S01117
      *                                                                   S01117
     C                     MOVE '0'       *IN,84                          S01117
      *                                                                   S01117
     C           *IN07     IFEQ '1'                                       S01117
     C           *IN05     ANDEQ'0'                                       S01117
     C           SCRN2     ANDEQSAV2                                      S01117
     C                     MOVE '1'       *IN,84                          S01117
     C                     END                                            S01117
     C                     EXSR SETOF
     C           *IN84     CABEQ'1'       V14END             >>>>>>>>>>>>>S01117
      **
      /SPACE 2
      ***********************************************************
      *                                                         *
      *                 >>RECEIPT INSTRUCTIONS<<                *
      *                                                         *
      ***********************************************************
      ** Our Receive Bank/Account debited.
      *
      ** Receive account is represented by two screen fields because      S01117
      ** the screen placement of these fields depends on the system       S01117
      ** being multibranched or not.                                      S01117
      **       in multibranch system use     SROBR  (Settlement Branch)   S01117
      **                                     SORACC (Account Code)        S01117
      *                                                                   S01117
      **       in non-multibranch system use SURACC (Account Code)        S01117
      *                                                                   S01117
      ** If system is multibranched, set up settlement branch input       S01117
      ** field for V14UB.                                                 S01117
     C*                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     MOVE SROBR     @SETBR  3                       S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SETBR                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE '    '    ER      4
     C                     MOVE SRSETM    SETM    2
     C                     MOVE SURACC    RACC
     C                     MOVE '0'       *IN,85
      *                                                                   S01194
      ** If a question mark is entered for Settlement Branch...           S01194
      *                                                                   S01194
     C                     MOVEL@SETBR    @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
      ** If a question mark is entered for Bank A/c debit...              S01194
      *                                                                   S01194
     C                     MOVELRACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
     C           *IN85     IFEQ '0'                                       S01194
     C                     EXSR V14UB
     C                     END                                            S01194
      *                                                                   CIR006
      ** If CIR006 is On and Settlement Method is not '00',               CIR006
      ** setup the fields for window processing.                          CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C           SRSETM    ANDNE'00'                                      CIR006
     C           *IN85     ANDEQ'0'                                       CIR006
     C                     MOVE SRSETM    #1TSEN                          CIR006
      *                                                                   CIR006
      ** Set up account key and relative record number                    CIR006
      *                                                                   CIR006
     C                     MOVE SRSETM    DSETM                           CIR006
     C                     MOVE SCNUM     DCNUM                           CIR006
     C                     MOVE SURACC    DBNKAC                          CIR006
     C                     MOVE @SETBR    WWBRCA                          CIR006
     C                     MOVE WSTCY     DDCCY                           CIR006
     C                     EXSR TSTRTL                                    CIR006
     C                     Z-ADD0         #1TRRN                          CIR006
     C                     MOVELERRKEY    #1TACN                          CIR006
      *                                                                   CIR006
      ** Set up nostro number for window processing                       CIR006
      *                                                                   CIR006
     C           SRSETM    IFEQ '01'                                      CIR006
     C           SRSETM    OREQ '02'                                      CIR006
     C           SRSETM    OREQ '07'                                      CIR006
     C           SRSETM    OREQ '08'                                      CIR006
     C           SRSETM    OREQ '12'                                      CIR006
     C                     MOVE @NOST     #1TNON                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
     C                     Z-ADD0         #1TNON                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
      ** Move blanks and zeroes to window variables                       CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
     C                     MOVE *BLANKS   #1TACN                          CIR006
     C                     Z-ADD0         #1TSEN                          CIR006
     C                     Z-ADD0         #1TRRN                          CIR006
     C                     Z-ADD0         #1TNON                          CIR006
      *                                                                   CIR006
     C                     END                                            CIR006
      *                                                                   S01117
      * If settlement method '05', display settlement branch even         S01117
      * if error exists                                                   S01117
     C           SRSETM    IFEQ '05'                                      S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC16                                           S01408
      *                                                                   S01408
     C                     MOVE @SETBR    SROBR                           S01117
     C                     END                                            S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC17                                           S01408
      *                                                                   S01408
      *
      ** If errors found - set up Error array.
     C           *IN85     IFEQ '1'
     C                     ADD  1         S
     C                     MOVE ER        ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,40
     C                     ELSE
     C*                                                                   S01117
     C* If there are no errors then set file field settlement branch      S01117
     C* to work field settlement branch.                                  S01117
     C*                                                                   S01117
     C                     MOVE @SETBR    ROBR                            S01117
     C*                                                                   S01117
     C           SRSETM    IFEQ '05'
     C**********           MOVE RACC      URACCX 12                                           CGL029
     C                     MOVE RACC      URACCX 18                                           CGL029
     C                     MOVE WRK2      URACCX
     C                     END
      *                                                                   CIR001
      ** Save account details for Up-front fee (premium) updates.         CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C                     MOVEL*BLANKS   XRNOST  2                       CIR001
     C**********           Z-ADD0         XRCNUM  60                                   CIR001 CSD027
     C                     MOVE *BLANKS   XRCNUM  6                                           CSD027
     C                     MOVE *BLANKS   XRCCY   3                       CIR001
     C**********           Z-ADD0         XRACOD  40                                   CIR001 CGL029
     C                     Z-ADD0         XRACOD 100                                          CGL029
     C                     Z-ADD0         XRACSQ  20                      CIR001
     C                     MOVE *BLANK    XRRACC  1                       CIR001
     C           *LIKE     DEFN RRNM      XRRRNM                          CIR001
     C                     Z-ADD0         XRRRNM                          CIR001
     C                     MOVELSURACC    XRNOST                          CIR001
     C**********           Z-ADDWCNUM     XRCNUM                                       CIR001 CSD027
     C                     MOVE WCNUM     XRCNUM                                              CSD027
     C                     MOVE WCCY      XRCCY                           CIR001
     C                     Z-ADDWACOD     XRACOD                          CIR001
     C                     Z-ADDWACSQ     XRACSQ                          CIR001
     C                     MOVE ROBR      XRBRCA  3                       CCB002
     C           ATYP      IFEQ 'R'                                       CIR001
     C                     MOVE 'Y'       XRRACC                          CIR001
     C*********************Z-ADDRRNM      XRRRNM                    CIR001CCB002
     C                     Z-ADD0         XRRRNM                          CCB002
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END
     C*                                                                   S01195
     C* IF OUR RECEIVE ACCOUNT not blank OR in error AND Settlement       S01195
     C* is through a Nostro, save Nostro location for use in new          S01195
     C* Holiday processing.                                               S01195
     C*                                                                   S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C           *IN40     IFEQ '0'                                       S01195
     C           RACC      ANDNE*BLANKS                                   S01195
     C                     MOVE A7NOSN    @RNLOC  3                       S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      *
      ** Counterparty Paying Bank.
      *
     C                     MOVE '    '    ER
     C                     MOVE SRSETM    SETM    2
     C                     MOVE SCPPBK    XACC   10
     C                     MOVE '0'       *IN,85
      *                                                                   S01194
      ** If a question mark is entered...                                 S01194
      *                                                                   S01194
     C                     MOVELXACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     EXSR V14CB
     C                     END                                            S01194
      *                                                                   S01194
     C**********           Z-ADDWCNUM     CPPBKX  60                                          CSD027
     C                     MOVE WCNUM     CPPBKX  6                                           CSD027
     C/COPY WNCPYSRC,DL1604IC78
      *
      ** If errors found - set up Error array.
     C           *IN85     IFEQ '1'
     C                     ADD  1         S
     C                     MOVE ER        ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,42
     C                     END
      /SPACE 2
      ***********************************************************
      *                                                         *
      *                 >>PAYMENT INSTRUCTIONS<<                *
      *                                                         *
      ***********************************************************
     C/COPY WNCPYSRC,DL1604IC67
      ** Our Paying Bank/Account credited.
      *                                                                   S01117
      ** Payment account is represented by two screen fields because      S01117
      ** the screen placement of these fields depends on the system       S01117
      ** being multibranched or not.                                      S01117
      **       in multibranch system use     SPOBR  (Settlement Branch)   S01117
      **                                     SOPACC (Account Code)        S01117
      *                                                                   S01117
      **       in non-multibranch system use SUPACC (Account Code)        S01117
      *                                                                   S01117
      ** If system is multibranched, set up settlement branch input       S01117
      ** field for V14UB.                                                 S01117
     C*                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     MOVELSPOBR     @SETBR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SETBR                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE '    '    ER
     C                     MOVE SPSETM    SETM    2
     C                     MOVE SUPACC    RACC
     C                     MOVE '0'       *IN,85
      *                                                                   S01194
      ** If a question mark is entered for Settlement Branch...           S01194
      *                                                                   S01194
     C                     MOVEL@SETBR    @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
      ** If a question mark is entered for Bank A/c debit...              S01194
      *                                                                   S01194
     C                     MOVELRACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
     C           *IN85     IFEQ '0'                                       S01194
     C                     EXSR V14UB
     C                     END                                            S01194
      *                                                                   CIR006
      ** If CIR006 is On and Settlement Method is not '00',               CIR006
      ** setup the fields for window processing.                          CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C           SPSETM    ANDNE'00'                                      CIR006
     C           *IN85     ANDEQ'0'                                       CIR006
     C                     MOVE SPSETM    #1USEN                          CIR006
      *                                                                   CIR006
      ** Set up account key and relative record number                    CIR006
      *                                                                   CIR006
     C                     MOVE SPSETM    DSETM                           CIR006
     C                     MOVE SCNUM     DCNUM                           CIR006
     C                     MOVE SUPACC    DBNKAC                          CIR006
     C                     MOVE @SETBR    WWBRCA                          CIR006
     C                     MOVE WSTCY     DDCCY                           CIR006
     C                     EXSR TSTRTL                                    CIR006
     C                     Z-ADD0         #1URRN                          CIR006
     C                     MOVELERRKEY    #1UACN                          CIR006
      *                                                                   CIR006
      ** Set up nostro number for window processing                       CIR006
      *                                                                   CIR006
     C           SPSETM    IFEQ '01'                                      CIR006
     C           SPSETM    OREQ '02'                                      CIR006
     C           SPSETM    OREQ '07'                                      CIR006
     C           SPSETM    OREQ '08'                                      CIR006
     C           SPSETM    OREQ '12'                                      CIR006
     C                     MOVE @NOST     #1UNON                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
     C                     Z-ADD0         #1UNON                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
      ** Move blanks and zeroes to window variables                       CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
     C                     MOVE *BLANKS   #1UACN                          CIR006
     C                     Z-ADD0         #1USEN                          CIR006
     C                     Z-ADD0         #1URRN                          CIR006
     C                     Z-ADD0         #1UNON                          CIR006
      *                                                                   CIR006
     C                     END                                            CIR006
      *                                                                   S01117
      * If settlement method '05', display settlement branch even         S01117
      * if error exists                                                   S01117
     C           SPSETM    IFEQ '05'                                      S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC18                                           S01408
      *                                                                   S01408
     C                     MOVE @SETBR    SPOBR                           S01117
     C                     END                                            S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC19                                           S01408
      *                                                                   S01408
      *
      ** If errors found - set up Error array.
     C           *IN85     IFEQ '1'
     C                     ADD  1         S
     C                     MOVE ER        ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,41
     C                     ELSE
     C*                                                                   S01117
     C* If there are no errors then set file field settlement branch      S01117
     C* to work field settlement branch.                                  S01117
     C*                                                                   S01117
     C                     MOVE @SETBR    POBR                            S01117
     C*                                                                   S01117
     C           SPSETM    IFEQ '05'
     C                     MOVE @SETBR    POBR                            S01117
     C**********           MOVE RACC      UPACCX 12                                           CGL029
     C                     MOVE RACC      UPACCX 18                                           CGL029
     C                     MOVE WRK2      UPACCX
     C                     END
      *                                                                   CIR001
      ** Save account details for Up-front fee (premium) updates.         CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C                     MOVEL*BLANKS   XPNOST  2                       CIR001
     C**********           Z-ADD0         XPCNUM  60                                   CIR001 CSD027
     C                     MOVE *BLANKS   XPCNUM  6                                           CSD027
     C                     MOVE *BLANKS   XPCCY   3                       CIR001
     C**********           Z-ADD0         XPACOD  40                                   CIR001 CGL029
     C                     Z-ADD0         XPACOD 100                                          CGL029
     C                     Z-ADD0         XPACSQ  20                      CIR001
     C                     MOVE *BLANK    XPRACC  1                       CIR001
     C           *LIKE     DEFN RRNM      XPRRNM                          CIR001
     C                     Z-ADD0         XPRRNM                          CIR001
     C                     MOVELSUPACC    XPNOST                          CIR001
     C**********           Z-ADDWCNUM     XPCNUM                                       CIR001 CSD027
     C                     MOVE WCNUM     XPCNUM                                              CSD027
     C                     MOVE WCCY      XPCCY                           CIR001
     C                     Z-ADDWACOD     XPACOD                          CIR001
     C                     Z-ADDWACSQ     XPACSQ                          CIR001
     C                     MOVE POBR      XPBRCA  3                       CCB002
     C           ATYP      IFEQ 'R'                                       CIR001
     C                     MOVE 'Y'       XPRACC                          CIR001
     C*********************Z-ADDRRNM      XPRRNM                    CIR001CCB002
     C                     Z-ADD0         XPRRNM                          CCB002
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END
     C*                                                                   S01195
     C* IF OUR PAYMENT ACCOUNT not blank OR in error AND Settlement       S01195
     C* is through a Nostro, save Nostro location for use in new          S01195
     C* Holiday processing.                                               S01195
     C*                                                                   S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C           *IN41     IFEQ '0'                                       S01195
     C           RACC      ANDNE*BLANKS                                   S01195
     C                     MOVE A7NOSN    @PNLOC  3                       S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *
      ** Counterparty Receive Bank.
      *
     C                     MOVE '    '    ER
     C                     MOVE SPSETM    SETM    2
     C                     MOVE SCPRBK    XACC   10
     C                     MOVE '0'       *IN,85
      *                                                                   S01194
      ** If a question mark is entered...                                 S01194
      *                                                                   S01194
     C                     MOVELXACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     EXSR V14CB
     C                     END                                            S01194
      *                                                                   S01194
     C**********           Z-ADDWCNUM     CPRBKX  60                                          CSD027
     C                     MOVE WCNUM     CPRBKX  6                                           CSD027
     C/COPY WNCPYSRC,DL1604IC80
      *
      ** If errors found - set up Error array.
     C           *IN85     IFEQ '1'
     C                     ADD  1         S
     C                     MOVE ER        ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,43
     C                     END
      *
      ** For The Account of.
      *
     C                     MOVE '    '    ER
     C                     MOVE SPSETM    SETM    2
     C                     MOVE SFACO     XACC   10
     C                     MOVE '0'       *IN,85
      *                                                                   S01194
      ** If a question mark is entered...                                 S01194
      *                                                                   S01194
     C                     MOVELXACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C                     EXSR V14CB
     C                     END                                            S01194
      *                                                                   S01194
     C**********           Z-ADDWCNUM     FACOX   60                                          CSD027
     C                     MOVE WCNUM     FACOX   6                                           CSD027
     C/COPY WNCPYSRC,DL1604IC79
      *
      ** If errors found - set up Error array.
     C           *IN85     IFEQ '1'
     C                     ADD  1         S
     C                     MOVE ER        ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,44
     C                     END
     C/COPY WNCPYSRC,DL1604IC68
      /SPACE 2
      **********************************************************
      *                                                        *
      *                 >>SPECIAL INSTRUCTIONS<<               *
      *                                                        *
      **********************************************************
      * Prohibited entry for Method '00'
      *
     C           SSPI      IFNE *BLANKS
     C*                                                                   S01194
     C* ENQUIRY NOT ALLOWED FOR SETTLEMENT INSTRUCTIONS                   S01194
     C*                                                                   S01194
     C                     MOVELSSPI      @QMARK                          S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 407'    ERCD,S                          S01194
     C                     MOVE '1'       *IN,05                          S01194
     C                     MOVE '1'       *IN,45                          S01194
     C                     ELSE                                           S01194
     C*                                                                   S01194
     C           SPSETM    IFEQ '00'
     C           SPSETM    OREQ '  '
     C                     ADD  1         S
     C                     MOVE ' 088'    ERCD,S
     C                     MOVE '1'       *IN,05
     C                     MOVE '1'       *IN,45
     C                     END
      *                                                                   S01412
      ** Validate the format of the special instruction field             S01412
      ** for an electronic pay settlement method                          S01412
      *                                                                   S01412
     C           SSPI      IFNE *BLANKS                                   S01412
     C           SPSETM    IFEQ '01'                                      S01412
     C           SPSETM    OREQ '08'                                      S01412
     C                     MOVEA*BLANKS   SIL                             S01412
     C                     MOVEASSPI      SIL                             S01412
     C                     EXSR SEPTVS                                    S01412
     C           CUL       IFEQ 'E'                                       S01412
     C                     ADD  1         S                               S01412
     C                     MOVE ' 253'    ERCD,S                          S01412
     C                     MOVEA'1'       *IN,05                          S01412
     C                     MOVEA'1'       *IN,45                          S01412
     C                     END                                            S01412
     C           CUL       IFEQ 'X'                                       CSW096
     C                     ADD  1         S                               CSW096
     C                     MOVE ' 254'    ERCD,S                          CSW096
     C                     MOVEA'1'       *IN,05                          CSW096
     C                     MOVEA'1'       *IN,45                          CSW096
     C                     ENDIF                                          CSW096
     C                     END                                            S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     END
     C*                                                                   S01194
     C                     END                                            S01194
     C*                                                                   S01194
      /SPACE 2
     C/COPY WNCPYSRC,DL1604IC73
      ***********************************************
      * Validate SPECIAL INSTRUCTIONS  '/BEN/'  entry
      *
     C                     MOVE SSPI      SPIX
      *
     C           *IN45     IFEQ '0'
      *
      * Validate  /BEN  Special Instructions Entry
      *
     C           SPI5      IFEQ '/BEN/'                      /BEN/
     C           SPI3      OREQ '/CH'                        /FW , /CH
     C           SPI3      OREQ '/FW'
      * Save Deal Customer Number
     C**************       MOVE CNUMX     WRK6                            S01194
     C                     MOVE CNUMX     WRK6    6                       S01194
     C                     EXSR SRSPI
     C                     END
     C                     END
      *                                                                   CEU003
      ** Validation of 'In' Currency in Field 72                          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           SIC72     ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
      ** If screen-payment-method is 08 or 01, input on 'In' currency     CEU003
      ** in field 72 is allowed.                                          CEU003
      *                                                                   CEU003
     C           SPSETM    IFEQ '01'                                      CEU003
     C           SPSETM    OREQ '08'                                      CEU003
      *                                                                   CEU003
      ** If entered, either the settlement currency must be EURO          CEU003
      ** or the settlement currency must be blank and our-                CEU003
      ** transaction currency must be EURO.                               CEU003
      *                                                                   CEU003
     C           SSTCY     IFEQ BKEURO                                    CEU003
     C           SSTCY     OREQ *BLANKS                                   CEU003
     C           SUCUCY    ANDEQBKEURO                                    CEU003
      *                                                                   CEU003
     C                     CALL 'AOCURRR0'                                CEU003
     C                     PARM *BLANK    P@RTCD  7                       CEU003
     C                     PARM '*KEY   ' P@OPTN  7                       CEU003
     C                     PARM SIC72     P@PUCY  3                       CEU003
     C           SDCURR    PARM SDCURR    DSSDY                           CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
      *                                                                   CEU003
      ** If the screen-our-transaction-currency is an 'In' currency and   CEU003
      ** 'In' currency in field 72 is not equal to it, then value will    CEU003
      ** not be accepted.                                                 CEU003
      *                                                                   CEU003
     C                     MOVELA6CYCD    SIC72                           CEU003
      *                                                                   CEU003
     C           SSTCY     IFEQ BKEURO                                    CEU003
     C           SIC72     ANDNESUCUCY                                    CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 711'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN70                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ELSE                                           CEU003
      ***********                                                  CEU003 134935
      ***If*value*date*is*earlier*than*the*EMU*transition*start*datCEU003 134935
      ***then*it*should*not*be*defined*as*an*'In'*currency.*       CEU003 134935
      ***********                                                  CEU003 134935
     C***********A6TPSD    IFGT VDATX                              CEU003 134935
     C***********          MOVE 'N'       A6INCY                   CEU003 134935
     C***********          ENDIF                                   CEU003 134935
      *                                                                   CEU003
      ** If 'In' currency in field 72 is 'In' currency, then value        CEU003
      ** is allowed.                                                      CEU003
      *                                                                   CEU003
     C           A6INCY    IFNE 'Y'                                       CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 709'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN70                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      * 'In' currency in field 72 is not found on currency file           CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 803'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN70                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 710'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN70                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *  Entry is not allowed                                             CEU003
     C                     ADD  1         S                               CEU003
     C                     MOVE ' 901'    ERCD,S                          CEU003
     C                     MOVE '1'       *IN70                           CEU003
     C                     MOVE '1'       *IN05                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *****************************************************************   S01195
      *                                                                   S01195
      **               WARNING ERRORS                                     S01195
      *                                                                   S01195
      *****************************************************************   S01195
      *                                                                   S01195
      ** Receipt Warnings.                                                S01195
      ** Check for receive through a nostro - if not, any                 S01195
      ** warning errors will already have been generated in VALD12        S01195
      *                                                                   S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* Settlement IS through a NOSTRO, set work field day number to      S01195
     C* ZDAYNO, (This work field was set up in VALD12 warning error       S01195
     C* routine)                                                          S01195
     C*                                                                   S01195
     C                     Z-ADD@DAYNO    ZDAYNO                          S01195
     C*                                                                   S01195
      * Only generate warning error if no error already in                S01195
      * Settlement Account/Branch fields                                  S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C           *IN40     ANDNE'1'                                       S01195
     C*                                                                   S01195
     C* ZLOC SET TO BLANKS IF REC. ACCOUNT BLANKS, OTHERWISE SET          S01195
     C* TO NOSTRO LOCATION                                                S01195
     C*                                                                   S01195
     C           SURACC    IFEQ *BLANKS                                   S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     ELSE                                           S01195
     C           *IN40     IFEQ '1'                                       S01195
     C                     Z-ADD0         ZDAYNO                          S01195
     C                     ELSE                                           S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           ZDAYNO    IFEQ @NIPDX                                    CEU003
     C           ZDAYNO    OREQ MDATX                                     CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   ZLOC                            CEU003
     C                     MOVE SUCUCY    ZCCY                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           ZDAYNO    IFNE 0                                         S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE '1'       *IN07                           S01195
     C                     MOVE '1'       *IN38                           S01195
     C                     ADD  1         W                               S01195
     C                     MOVE 'W11'     WRCD,W                          S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
      ** Payment Warnings.                                                S01195
      ** Check for payment through a nostro - if not, any                 S01195
      ** warning errors will already have been generated in VALD12        S01195
      *                                                                   S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* Settlement IS through a NOSTRO, set work field day number to      S01195
     C* ZDAYNO, (This work field was set up in VALD12 warning error       S01195
     C* routine)                                                          S01195
     C*                                                                   S01195
     C                     Z-ADD@DAYNO    ZDAYNO                          S01195
     C*                                                                   S01195
     C*                                                                   S01195
      * Only generate warning error if no error already in                S01195
      * Settlement Account/Branch field                                   S01195
     C           ZDAYNO    IFNE 0                                         S01195
     C           *IN41     ANDNE'1'                                       S01195
     C*                                                                   S01195
     C* ZLOC SET TO BLANKS IF PAY. ACCOUNT BLANKS, OTHERWISE SET          S01195
     C* TO NOSTRO LOCATION                                                S01195
     C*                                                                   S01195
     C           SUPACC    IFEQ *BLANKS                                   S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     ELSE                                           S01195
     C           *IN41     IFEQ '1'                                       S01195
     C                     Z-ADD0         ZDAYNO                          S01195
     C                     ELSE                                           S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           ZDAYNO    IFEQ @NIPDX                                    CEU003
     C           ZDAYNO    OREQ MDATX                                     CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   ZLOC                            CEU003
     C                     MOVE SUCUCY    ZCCY                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           ZDAYNO    IFNE 0                                         S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE '1'       *IN07                           S01195
     C                     MOVE '1'       *IN39                           S01195
     C                     ADD  1         W                               S01195
     C                     MOVE 'W13'     WRCD,W                          S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C****************     ENDSR                                          S01117
     C           V14END    ENDSR                                          S01117
      ********************************************************************
     C/EJECT
      ********************************************************************
      *
     C           V14UB     BEGSR
      *
      ** Pay/Receive Instruction entered.
      ** Entry made.
     C           RACC      IFNE *BLANKS
     C           @SETBR    ORNE *BLANKS                                   S01117
      *
     C***********RUND******SUB  BVLP      D5      50                      S01194
     C***********BJRDNB    SUB  BJBVPD    D5      50                S01194E31717
      *
      ** Method '00'
     C           SETM      IFEQ '00'
     C           SETM      OREQ '  '
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 065'    ER
     C                     GOTO V14UB9                                    S01117
     C                     END
      *
      ** In multibranching system, the settlement branch should be        S01117
      **    blank if settlement method is not '05'                        S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C           @SETBR    ANDNE*BLANKS                                   S01117
     C           SETM      ANDNE'05'                                      S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC20                                           S01408
      *                                                                   S01408
     C                     MOVE '1'       *IN85                           S01117
     C                     MOVE ' 406'    ER                              S01117
     C                     GOTO V14UB9                                    S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Method ( 01, 02, 07, 08, 12)
      ** Optional Entry - (2 Numeric + 10 Blanks)
      *
     C           SETM      IFEQ '01'
     C           SETM      OREQ '02'
     C           SETM      OREQ '07'
     C           SETM      OREQ '08'
     C           SETM      OREQ '12'
      *
     C**********           MOVE RACC      WRK10  10                                           CGL029
     C                     MOVE RACC      WRK10  16                                           CGL029
     C           WRK10     IFNE *BLANKS
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 066'    ER
     C                     ELSE
     C                     MOVELRACC      WRK2    2
     C                     TESTN          WRK2       84
     C           *IN84     IFEQ '0'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 066'    ER
     C                     END
     C                     END
      ***If*Valid*entry.**********                                        S01194
      ***Access*Account*File.***********                                  S01194
     C           *IN85     IFEQ '0'
      **********                                                          S01194
     C*********************MOVE *BLANKS   KEY                             S01194
     C*********************MOVELRACC      WRK2                            S01194
     C*********************MOVELSUCUCY    WRK5                            S01194
     C*********************MOVEL'70'      KEY                             S01194
     C***********KEY*******CHAINTABDLI               85                   S01194
      *                                                                   S01194
      ** Call Access Program for Nostro Details                           S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C***********          PARM SUCUCY    @CCY    3        CurrencyS01194 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM WRK2      @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
      *                                                                   S01194
     C************IN85*****IFEQ '1'                                       S01194
     C***********RECI******ORNE 'D'                                       S01194
      *                                                                   S01194
      ** If nostro details not found                                      S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 067'    ER
      *
     C                     ELSE
      *
      ** If nostro branch is not the same as the single branch in         S01117
      **    a non-multibranched system, an error occurs                   S01117
     C           BGMBIN    IFEQ 'N'                                       S01117
     C           A7BRCD    ANDNEBJSBRC                                    S01117
     C                     MOVE '1'       *IN85                           S01117
     C                     MOVE ' 067'    ER                              S01117
     C                     ELSE                                           S01117
      *                                                                   S01117
     C                     MOVE A7BRCD    WWBRCA                          S01117
     C*********************MOVE CNUM      WCNUM                           S01194
     C                     MOVE A7CUST    WCNUM                           S01194
     C*********************MOVE ACOD      WACOD                           S01194
     C                     MOVE A7ACCD    WACOD                           S01194
     C*********************MOVE ACSQ      WACSQ                           S01194
     C                     MOVE A7ACSN    WACSQ                           S01194
     C***********          MOVE SUCUCY    WCCY                            CEU003
     C                     MOVE WSTCY     WCCY                            CEU003
     C           ACCKEY    CHAINACCNT                85
      *                                                                   S01117
      ** If error on chain                                                S01117
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *IN,85
     C** NEW E/C CREATED TO MATCH ABOVE PROCESSING,                       E11505
     C** E/C 068 IS MEANINGLESS HERE                                      E11505
     C***********          MOVE ' 068'    ER                              E11505
     C                     MOVE ' 060'    ER                              E11505
     C                     ELSE                                           S01117
      *                                                                   S01117
      ** if no error on chain, set work settlement branch                 S01117
      ** to nostro branch.                                                S01117
     C                     MOVE A7BRCD    @SETBR                          S01117
     C*                                                                   S01195
     C                     END                                            S01117
     C                     END
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IVS2                                           S01408
     C*                                                                   S01408
      *********************                                               E31717
      ***Check*Dates,*if*a*RETAIL Account.                                E31717
      *********************                                               E31717
     C************IN85*****IFEQ '0'                                       E31717
     C***********ATYP******ANDEQ'R'                                       E31717
     C***********DACO******IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 068'    ER                              E31717
     C*********************ELSE                                           E31717
     C***********D5********IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 069'    ER                              E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
     C                     END
      *
      ** Method  '03'
      ** Optional entry - (6 Numeric + 6 Blanks)
      *
     C           SETM      IFEQ '03'
      *
      **  Whether multibranching flag is set on or off, set Settlement    S01117
      **  branch to Booking branch, since Booking branch must be valid    S01117
      **  before settlement instructions are validated.                   S01117
      *
     C                     MOVE SBRCA     @SETBR                          S01117
      *                                                                   S01117
     C***********          MOVE F6        XTEST6                                              CSD027
     C***********          EXSR XNTEST                                                        CSD027
     C           L6        IFNE *BLANKS
     C************IN84     OREQ '0'                                                           CSD027
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 070'    ER
     C                     END
     C                     END
      *
      ** Method  '04'
      ** Must be blanks.
      *
     C           SETM      IFEQ '04'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 071'    ER
     C                     END
      *
      ** Method  '05'
      ** Mandatory Entry - (6 Numeric + 4 Numeric + 2 Num/Blanks)
      *
     C           SETM      IFEQ '05'
      *
     C                     MOVELRACC      WRK10
     C                     TESTN          WRK10      84
     C           *IN84     IFEQ '0'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 076'    ER
      *
     C                     ELSE
     C                     MOVE RACC      WRK2
     C           WRK2      IFNE '  '
     C           WRK2      ANDLT'00'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 076'    ER
     C                     END
     C                     END
      *                                                                   S01117
      * If an error exists, set up settlement branch work field           S01117
      * anyway for display purposes (multibranched only)                  S01117
     C           *IN85     IFEQ '1'                                       S01117
     C           BGMBIN    ANDEQ'Y'                                       S01117
      *                                                                   S01117
     C           @SETBR    IFEQ *BLANKS                                   S01117
     C                     MOVE SBRCA     @SETBR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      ** Valid entry.
      ** Set up default value.
     C           *IN85     IFEQ '0'
      *
     C           WRK2      IFLE '00'
      * Default Seq.No.
     C***********MBIN******IFNE 'Y'                                       S01194
     C                     MOVE '01'      WRK2
     C******************   ELSE                                           S01194
     C*********************MOVE NSACS     WRK2                            S01194
     C******************   END                                            S01194
     C                     END                                            S01117
      *
      **  Whether or not multibranched, (Booking Branch valid by now)     S01117
      **  set Branch key to Booking branch if Settlement branch blank     S01117
      **  else to Settlement Branch.                                      S01117
      *
     C           @SETBR    IFEQ *BLANKS                                   S01117
     C                     MOVE SBRCA     WWBRCA                          S01117
     C                     ELSE                                           S01117
     C                     MOVE @SETBR    WWBRCA                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      ** Accounts File.
     C                     MOVE F6        WCNUM
     C***********          MOVE SUCUCY    WCCY                            CEU003
     C                     MOVE WSTCY     WCCY                            CEU003
     C                     MOVE WRK2      WACSQ
     C                     MOVELL6        WACOD
     C*                                                                   S01194
     C* (BMAFNB IS PRIME CURRENT ACCOUNT KEY FROM SDRETL)                 S01194
     C*                                                                   S01194
     C           ACCKEY    CHAINACCNT                85
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 076'    ER
     C                     END
     C                     MOVE WWBRCA    @SETBR                          S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IVS3                                           S01408
     C*                                                                   S01408
     C                     END
      *********************                                               E31717
      ***Check*Dates,*if*a*RETAIL Account.                                E31717
      *********************                                               E31717
     C***********ATYP******IFEQ 'R'                                       E31717
     C************IN85*****ANDEQ'0'                                       E31717
      *********************                                               E31717
     C***********DACO******IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 077'    ER                              E31717
     C*********************ELSE                                           E31717
     C***********D5********IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 078'    ER                              E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
     C                     END
      *
      ** Method  '06'
      ** Prohibited Entry.
      *
     C           SETM      IFEQ '06'
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC21                                           S01408
      *                                                                   S01408
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 079'    ER
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC22                                           S01408
      *                                                                   S01408
     C                     END
      *
      ** Method  '14'
      ** Mandatory Entry (10 Numeric + 2 Blanks)
      *
     C           SETM      IFEQ '14'
      *
     C                     MOVELRACC      WRK10
     C                     MOVE RACC      WRK2
     C                     TESTN          WRK10      84
     C           *IN84     IFEQ '0'
     C           WRK2      ORNE '  '
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 080'    ER
      *
     C                     ELSE
      *
      ** Must be a Retail Account
     C                     MOVELRACC      ACNO
     C                     MOVE ' '       ATYP
     C           ACNO      CHAINACNUM                85
      *                                                                   S01117
      ** If error on chain                                                S01117
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C           ATYP      ORNE 'R'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 081'    ER
      *
     C                     ELSE
      *                                                                   S01117
     C* IF MULTIBRANCHING OFF, CHECK RETAIL BRANCH FROM ACNUM             S01117
     C* IS SAME AS SINGLE BRANCH                                          S01117
      *                                                                   S01117
     C           BGMBIN    IFEQ 'N'                                       S01117
     C           BRCA      ANDNEBJSBRC                                    S01117
     C                     MOVE '1'       *IN,85                          S01117
     C                     MOVE ' 081'    ER                              S01117
     C                     ELSE                                           S01117
      *
      ** Account currency must equeal Deal currency
      *
     C***********CCY       IFNE SUCUCY                                    CEU003
     C           CCY       IFNE WSTCY                                     CEU003
     C           *IN23     ANDEQ'0'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 210'    ER
     C                     END
     C                     END
     C                     END
     C                     END                                            S01117
      *
      ** Check Dates, if a RETAIL Account.
      *
     C           *IN85     IFEQ '0'
      *
     C                     MOVE BRCA      WWBRCA                          S01117
     C                     MOVE CNUM      WCNUM
     C                     MOVE CCY       WCCY
     C                     MOVE ACOD      WACOD
     C                     MOVE ACSQ      WACSQ
     C           ACCKEY    CHAINACCNT                85
      *                                                                   S01194
      ** If error on chain                                                S01194
     C           *IN85     IFEQ '1'
     C************LOCK*****IN   LDA                                       S01194
     C                     MOVE '14'      DBASE            ***************
     C                     MOVE 'ACNUM'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      14     *
     C*********************EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                                     S01194
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* NO ERRORS, SO SET SETTLEMENT BRANCH AS RETAIL BRANCH              S01117
     C*                                                                   S01117
     C                     MOVE BRCA      @SETBR                          S01117
     C                     END
      *********************                                               E31717
     C***********DACO******IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 082'    ER                              E31717
     C*********************ELSE                                           E31717
     C***********D5********IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 083'    ER                              E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
      **                                                                  S01117
     C                     END
     C                     END
      *
      ** No Instruction entered.
      *
     C                     ELSE
      *                                                                   072953
      ** If Settle thru nostro, RACC should not be blank                  072953
      *                                                                   072953
     C           SETM      IFEQ '01'                                      072953
     C           SETM      OREQ '02'                                      072953
     C           SETM      OREQ '07'                                      072953
     C           SETM      OREQ '08'                                      072953
     C           SETM      OREQ '12'                                      072953
     C           RACC      ANDEQ*BLANKS                                   072953
     C                     MOVE '1'       *IN,85                          072953
     C                     MOVE ' 066'    ER                              072953
     C                     END                                            072953
      ** Method  '04'
      *
     C           SETM      IFEQ '04'
      *
     C                     MOVE CNUMX     WCNUM
     C***********          MOVE SUCUCY    WCCY                            CEU003
     C                     MOVE WSTCY     WCCY                            CEU003
      ** Default Account Sequence Code.
     C***********MBIN******IFNE 'Y'                                       S01194
     C                     MOVE '01'      WACSQ
     C*****                ELSE                                           S01194
     C*******************  MOVE NSACS     WACSQ                           S01194
     C*****                END                                            S01194
      *
      **  Whether multibranching flag is set on or off, set Settlement    S01117
      **  branch to Booking branch, since Booking branch must be valid    S01117
      **  before settlement instructions are validated.                   S01117
      *                                                                   S01117
     C                     MOVE SBRCA     WWBRCA                          S01194
      *                                                                   S01117
      *
      ** Accounts File.
     C*********************MOVE CADC      WACOD                           S01194
     C                     MOVE BMACCD    WACOD                           S01194
     C*                                                                   S01117
     C* (BMAFNB IS PRIME CURRENT ACCOUNT KEY FROM SDRETL)                 S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 072'    ER
      *
     C                     ELSE
      ** If a Retail Account
     C           ATYP      IFNE 'R'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 073'    ER
     C*********************ELSE                                           E31717
      *********************                                               E31717
      ***Check*Dates,*if*a*RETAIL Account.                                E31717
      *********************                                               E31717
     C***********DACO******IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 074'    ER                              E31717
     C*********************ELSE                                           E31717
     C***********D5********IFGT VDATX                                     E31717
     C*********************MOVE '1'       *IN,85                          E31717
     C*********************MOVE ' 075'    ER                              E31717
     C*********************END                                            E31717
     C*********************END                                            E31717
     C*                                                                   S01117
     C* IF NO ERRORS, SET SETTLEMENT BRANCH AS BRANCH KEY                 S01117
     C*                                                                   S01117
     C           *IN85     IFEQ '0'                                       S01117
     C                     MOVE WWBRCA    @SETBR                          S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IVS4                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *
      ** Method  '05'
      ** Mandatory Entry
      *
     C           SETM      IFEQ '05'
      *                                                                   S01117
      * Move default settlement branch to work field even though          S01117
      * an error exists, for display purposes (multibranched only)        S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     MOVE SBRCA     @SETBR                          S01117
     C                     END                                            S01117
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 076'    ER
     C                     END
     C*                                                                   S01117
     C* METHOD '06'                                                       S01117
      *
      **  Whether multibranching flag is set on or off, set Settlement    S01117
      **  branch to Booking branch, since Booking branch must be valid    S01117
      **  before settlement instructions are validated.                   S01117
      *                                                                   S01117
     C           SETM      IFEQ '06'                                      S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC23                                           S01408
      *                                                                   S01408
      *                                                                   S01117
     C                     MOVE SBRCA     @SETBR                          S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      *
      ** Method  '14'
      ** Mandatory Entry
      *
     C           SETM      IFEQ '14'
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 080'    ER
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,DL1604IC47
      *
     C*****                ENDSR                                          S01117
     C           V14UB9    ENDSR                                          S01117
      *                                                                   S01117
      ********************************************************************
     C/EJECT
      ********************************************************************
      *
     C           V14CB     BEGSR
      *
     C**********           Z-ADD0         WCNUM   60                                          CSD027
     C                     MOVE *BLANKS   WCNUM   6                                           CSD027
      *
      ** Pay/Receive Instruction entered.
      ** Entry made
     C           XACC      IFNE *BLANKS
      *
      * Method ( 00, 02, 12, 03, 04, 14, 05, 06)
      * Prohibited Entry.
      *
     C           SETM      IFEQ '  '
     C           SETM      OREQ '00'
     C           SETM      OREQ '02'
     C           SETM      OREQ '12'
     C           SETM      OREQ '03'
     C           SETM      OREQ '04'
     C           SETM      OREQ '14'
     C           SETM      OREQ '05'
     C           SETM      OREQ '06'
      *
     C                     MOVE '1'       *IN,85
     C                     MOVE ' 084'    ER
     C                     END
      *
      ** Method  (01,  07, 08)
      ** Optional Entry - (6 Numeric + 4 Blanks, or 10 Alpha)
      *
     C           SETM      IFEQ '01'
     C           SETM      OREQ '07'
     C           SETM      OREQ '08'
      *
     C*****                MOVE XACC      WRK4                            S01194
     C*****                MOVELXACC      WRK6    6                       S01194
     C*****                MOVELXACC      WRK1    1                       S01194
      ******* Numeric.                                                    S01194
     C*****      WRK1      IFGE '0'                                       S01194
     C*****                MOVE WRK6      XTEST6                          S01194
     C*****                EXSR XNTEST                                    S01194
     C*****      WRK4      IFNE *BLANKS                                   S01194
     C*****      *IN84     OREQ '0'                                       S01194
     C*****                MOVE '1'       *IN,85                          S01194
     C*****                MOVE ' 085'    ER                              S01194
      *****                                                               S01194
     C*****                ELSE                                           S01194
     C*****                MOVELXACC      CNUM                            S01194
     C*****      CNUM      CHAINCLINTCBF             85                   S01194
     C*****      *IN85     IFEQ '1'                                       S01194
     C*****      RECI      ORNE 'D'                                       S01194
     C*****                MOVE '1'       *IN,85                          S01194
     C*****                MOVE ' 087'    ER                              S01194
     C*****                ELSE                                           S01194
     C*****                Z-ADDCNUM      WCNUM                           S01194
     C*****                END                                            S01194
     C*****                END                                            S01194
      ***Shortname.                                                       S01194
     C*****                ELSE                                           S01194
      *****                                                               S01194
     C*****      XACC      CHAINSNAME                85                   S01194
     C*****      *IN85     IFEQ '1'                                       S01194
     C*****      RECI      ORNE 'D'                                       S01194
      *****                                                               S01194
      ****** Method '01', Check Tables.                                   S01194
      ******                                                              S01194
     C*****      SETM      IFEQ '01'                                      S01194
     C*****                MOVE *BLANKS   KEY                             S01194
     C*****                MOVEL'71'      KEY                             S01194
     C*****                MOVELXACC      WRK8    8                       S01194
     C*****                MOVE WRK8      KEY                             S01194
     C*****      KEY       CHAINTABDLI               85                   S01194
     C*****      *IN85     IFEQ '1'                                       S01194
     C*****      RECI      ORNE 'D'                                       S01194
     C*****                MOVE '1'       *IN,85                          S01194
     C*****                MOVE ' 086'    ER                              S01194
     C*****                END                                            S01194
      *****                                                               S01194
     C*****                ELSE                                           S01194
     C*****                MOVE '1'       *IN,85                          S01194
     C*****                MOVE ' 086'    ER                              S01194
     C*****                END                                            S01194
     C*****                ELSE                                           S01194
     C*****                Z-ADDCNUM      WCNUM                           S01194
     C*****                END                                            S01194
     C*****                END                                            S01194
      *                                                                   S01194
      ** If a question mark is entered....                                S01194
      *                                                                   S01194
     C                     MOVELXACC      @QMARK  1                       S01194
     C           @QMARK    IFEQ '?'                                       S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 407'    ER                              S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
     C** Call Access Program for Customer Details using the Customer      S01194
     C** No. or the Customer Shortname.                                   S01194
      *                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM XACC      @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
      ** If Customer No./Customer Shortname does not exist...             S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
      *                                                                   S01194
      ** Check if Customer No....(Validation Error)                       S01194
      *                                                                   S01194
     C           @KYST     IFEQ '*CNUM'                                   S01194
     C           @KYST     OREQ '*ERROR '                                 046963
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 087'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
      ** If Customer Shortname....                                        S01194
      *                                                                   S01194
     C           @KYST     IFEQ '*CSHT'                                   S01194
      *                                                                   S01194
      ***And*If*Settlement*Method '01'...                           S01194E26553
      ** And If Settlement Method '01' or '08'                            E26553
      *                                                                   S01194
     C           SETM      IFEQ '01'                                      S01194
     C           SETM      OREQ '08'                                      E26553
      *                                                                   S01194
     C** Call Access Program for Counterparty Nostro details.             S01194
      *                                                                   S01194
     C                     MOVELXACC      @ARCD                           S01194
     C                     CALL 'AOCNSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           @ARCD   8                       S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
      *                                                                   S01194
      ** If Counterparty Nostro does not exist.....(Validation error)     S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 086'    ER                              S01194
     C                     END                                            S01194
      *                                                                   S01194
      ** If Counterparty Nostro does exist....                            S01194
      ** Default to the Counterparty Paying Bank screen field             S01194
      *                                                                   S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
      ***Else*if*Not*Settlement*Method '01'.....Validation Error    S01194E26553
      ** Else if Settlement Method '07'.....Validation Error              E26553
      ** ( Customer Shortname does not exist on AOCUSTR0 )                S01194
      *                                                                   S01194
     C                     MOVE '1'       *IN,85                          S01194
     C                     MOVE ' 086'    ER                              S01194
     C                     END                                            S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     ELSE                                           S01194
      *                                                                   S01194
      ** Else if Customer No./Customer Shortname does exist...            S01194
      ** Save Customer no.                                                S01194
      *                                                                   S01194
     C                     MOVELBBCUST    WCNUM
      *                                                                   S01194
     C                     END                                            S01194
      *                                                                   S01194
     C                     END                                            S01194
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************   S01412
      *   SEPTVS    - Validate field 72                               *   S01412
      *   Called by - MAIN - Main process                             *   S01412
      *                                                               *   S01412
      *   Input     - SIL   - the field to be validated               *   S01412
      *                                                               *   S01412
      *   Output    - CUL   - the field was invalid                   *   S01412
      *****************************************************************   S01412
      *                                                                   S01412
     C           SEPTVS    BEGSR                                          S01412
      *                                                                   S01412
      ** Store the current value of indicator 88                          S01412
      *                                                                   S01412
     C                     MOVEA*IN,88    STOAR   1                       S01412
      *                                                                   S01412
     C                     Z-ADD1         L       30                      S01412
     C                     MOVE *BLANK    CUL     1                       S01412
     C                     MOVE 'F'       SSF     1                       S01412
     C                     SETOF                     88                   S01412
      *                                                                   S01412
      ** First position must be a '/'                                     S01412
      *                                                                   S01412
     C           SIL,L     IFNE '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     Z-ADD2         L                               S01412
      *                                                                   S01412
      ** The first special instruction line cannot have '/'               S01412
      ** in position 2                                                    S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Check the line for '8a/', where 8a represents                    S01412
      ** up to eight upper case alphabetic charaters                      S01412
      *                                                                   S01412
     C           SSF       DOUEQ'T'                                       S01412
     C           L         ORGT 10                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                                       CSW201
      ** If enhancement CSW201 is installed and Settlement Method                             CSW201
      ** is '01' or '08', use table UPAN to validate SIL                                      CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           SIL,L     LOKUPUPAN                     88                                   CSW201
     C                     ELSE                                                               CSW201
      *                                                                   S01412
     C           SIL,L     LOKUPUPA                      88               S01412
     C                     ENDIF                                                              CSW201
      *                                                                   S01412
     C           *IN88     IFNE '1'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'T'       SSF                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Invalid if a second slash is not found                           S01412
      ** within the first ten characters of the                           S01412
      ** field being checked                                              S01412
      *                                                                   S01412
     C           SSF       IFEQ 'F'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Test the rest of the line for ISO format characters              S01412
      *                                                                   S01412
     C           L         DOUGT35                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                   S01412
     C           SIL,L     LOKUPSWCH                     88               S01412
      *                                                                   S01412
     C           *IN88     IFEQ '0'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   CSW096
      ** Check for "/RCB/"                                                CSW096
      *                                                                   CSW096
     C                     MOVEL*BLANKS   USRCB   5                       CSW096
     C                     MOVEASIL,1     USRCB                           CSW096
     C           USRCB     IFEQ '/RCB/'                                   CSW096
     C                     MOVE 'X'       CUL                             CSW096
     C                     ENDIF                                          CSW096
      *                                                                   S01412
      ** Restore the current value of indicator 88                        S01412
      *                                                                   S01412
     C                     MOVEASTOAR     *IN,88                          S01412
      *                                                                   S01412
     C                     ENDSR                                          S01412
     C/EJECT                                                              S01412
      *****************************************************************
      *                                                               *
      *  SRSPI SR.     Validate Special Instructions enterd if /BEN/  *
      *                found in first four characters.                *
      *                Validate Fed.Wire and SWIFT requests.          *
      *                Validate CHIP Number entered against the       *
      *                first six characters of the CHIP ID field      *
      *                on the CLINT file. If Chip Number is blank     *
      *                default to the VALID CHIP No on the CLINT file.*
      *                                                               *
      *****************************************************************
      *
     C           SRSPI     BEGSR                           ***  SRSPI ****
      *
      * /BEN/  ONLY ALLOWED WITH PAYMENT METHOD = 01,02,12,07 OR 08.
      *
     C           SPI5      IFEQ '/BEN/'
     C           SPSETM    IFNE '01'
     C           SPSETM    ANDNE'02'
     C           SPSETM    ANDNE'12'
     C           SPSETM    ANDNE'07'
     C           SPSETM    ANDNE'08'
     C                     ADD  1         S
     C                     MOVE ' 211'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     ELSE
     C*                                                                   039457
     C** If '/BEN//SC' entered, it must be follwed by six (6) digits      039457
     C** and then all blanks. All other cases mean error.                 039457
     C*                                                                   039457
     C           SPI3      IFEQ '/SC'                                     039457
     C*                                                                   039457
     C                     MOVE SPI6      TEST1   60                      039457
     C                     MOVE TEST1     TEST2   6                       039457
     C           SPI6      IFNE TEST2                                     039457
     C           SPI6      OREQ *BLANKS                                   039457
     C           SPIX1     ORNE *BLANK                                    039457
     C                     MOVELERRMSG,7  SERCD1                          039457
     C                     MOVE '1'       *IN05                           039457
     C                     MOVE '1'       *IN45                           039457
     C                     END                                            039457
     C*                                                                   039457
     C                     END                                            039457
     C*                                                                   039457
      *
      * CCY MUST EQUAL US  FOR  /FW, /CH
      *
     C           SPI3      IFEQ '/FW'
     C***********SUCUCY****ANDNEUSCY                                      S01194
     C           SUCUCY    ANDNEBLUSCY                                    S01194
      *
     C           SPI3      OREQ '/CH'
     C***********SUCUCY****ANDNEUSCY                                      S01194
     C           SUCUCY    ANDNEBLUSCY                                    S01194
     C                     ADD  1         S
     C                     MOVE ' 212'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     END
     C                     END
     C                     END
      *
      * FEDERAL WIRE validation  (/FW)
      *
     C           *IN45     IFEQ '0'
     C           SPI3      ANDEQ'/FW'
      * F/F Indicator must = 'Y'
     C           SUFFI     IFNE 'Y'
     C                     ADD  1         S
     C                     MOVE ' 213'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     ELSE
      * Entry must = (9N + Blanks)
     C                     TESTN          SPI9       84
     C           *IN84     IFEQ '0'
     C           SPIX2     ORNE *BLANKS
     C                     ADD  1         S
     C                     MOVE ' 214'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     END
     C                     END
     C                     END
      *
      * CHIPS NUMBER validation  (/CH)
      *
      * If 'For Account of' Counterparty Nostro, do not allow
      * blank CHIP Number entry.
      *
      *     if valid
     C           *IN44     IFEQ '0'                          FACO
     C           *IN45     ANDEQ'0'                          SPI
      *   and Counterparty Nostro
     C           SFACO     ANDNE*BLANKS
     C********** FACOX     ANDEQ0                                                             CSD027
     C           FACOX     ANDEQ*BLANKS                                                       CSD027
      *   and Blank Chip Number
     C           SPI3      ANDEQ'/CH'
     C           SPI6      ANDEQ*BLANKS
     C                     ADD  1         S
     C                     MOVE ' 218'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     END
      *
      * Entry must be a valid CHIPS No (6N + Blanks), or Blanks
      * If blanks default to a valid CHIP ID on CLINT  (first 6 characters
      *  of the  CHID  LF/CLINT).
     C**********           Z-ADD0         WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
      *
     C           *IN45     IFEQ '0'
     C           SPI3      ANDEQ'/CH'
      * Check if Valid Entry
     C                     MOVELSPI6      CHIP7
     C                     MOVE '0'       CHIP7
     C                     TESTN          CHIP7      84
     C           SPIX1     IFNE *BLANKS
     C           *IN84     OREQ '0'
     C           SPI6      ANDNE*BLANKS
     C                     ADD  1         S
     C                     MOVE ' 215'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
      *
     C                     ELSE
      * Set up the CLINT file key (Cust No from FACO,
      *  or, if no entry made, use deal customer).
      *
     C           *IN44     IFEQ '0'
      *
     C********** FACOX     IFNE 0                                                             CSD027
     C**********           Z-ADDFACOX     WCNUM                                               CSD027
     C           FACOX     IFNE *BLANKS                                                       CSD027
     C                     MOVE FACOX     WCNUM                                               CSD027
      *
     C                     ELSE
     C           *IN19     IFEQ '0'                        Deal Cust valid
     C           SFACO     ANDEQ*BLANKS                    & FACO no entry
     C                     MOVE WRK6      WCNUM
     C                     END
      *
     C                     END
     C                     END
     C                     END
     C                     END
      *
      * CHIP NUMBER entered and,or defaulted must be valid.
      * Access the CLINT file, if Cust No found.
      *
     C           *IN45     IFEQ '0'
     C           SPI3      ANDEQ'/CH'
     C********** WCNUM     ANDGT0                                                             CSD027
     C           WCNUM     ANDGT*BLANKS                                                       CSD027
      *
      **Access*the*CLINT*file**(Cust*No*from*FACO,*or*if*                 S01194
      * Access the Customer file  (Cust No from FACO, or if               S01194
      *  counterparty Nostro , the deal customer).
      *
     C***********WCNUM*****CHAINCLINT                85                   S01194
      *                                                                   S01194
     C* Move the numeric field WCNUM into an alpha field                  S01194
     C*      for Access Program call                                      S01194
     C                     MOVELWCNUM     WWCNUM 10                       S01194
      *                                                                   S01194
     C** Call Access Program for Customer Details                         S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM WWCNUM    @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C************IN85*****IFEQ '1'                                       S01194
     C***********RECI******ORNE 'D'                                       S01194
     C************LOCK*****IN   LDA                                       S01194
     C*********************MOVE '09'      DBASE            ***************S01194
     C*********************MOVE 'ACCNT'   DBFILE           *   DBERROR   *S01194
     C*********************MOVELWCNUM     DBKEY            *      09     *S01194
     C*********************EXSR DBERR                      ***************S01194
     C*********************MOVE '0'       *IN85                           S01194
     C***************      ELSE                                           S01194
      *                                                                   S01194
      *
      * CHIP NUMBER entered must be equal to CHID chip number.
      *
     C*********************MOVELCHID      CHIP6   6                       S01194
     C                     MOVELBBCHID    CHIP6   6                       S01194
     C*********************MOVELCHID      CHIP7   7                       S01194
     C                     MOVELBBCHID    CHIP7   7                       S01194
     C                     MOVE '0'       CHIP7
      *
      * Default, if no entry made
     C           SPI6      IFEQ *BLANKS
      *
      **Invalid/Blank**LF/CLINT**CHIP*ID.*****                            S01194
      * Invalid/Blank  SDCUSTPD  CHIP ID.                                 S01194
     C                     TESTN          CHIP7      84
     C           *IN84     IFEQ '0'
     C                     ADD  1         S
     C                     MOVE ' 217'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
      * Set up Default
     C                     ELSE                            Default
     C                     MOVELCHIP6     SPI6              CHIP
     C                     END                               Number
      *
     C                     ELSE
      *
      * If entered must = CHID chip number.
     C           SPI6      IFNE CHIP6
     C                     ADD  1         S
     C                     MOVE ' 216'    ERCD,S
     C                     MOVE '1'       *IN05
     C                     MOVE '1'       *IN45
     C                     END
      ***
     C                     END
     C***********          END                                            S01194
      ***
     C                     END
     C                     ENDSR
      *****************************************************************   CIR006
      /EJECT                                                              CIR006
      *****************************************************************   CIR006
      *                                                               *   CIR006
      *  SRDWIN - Display Window                                      *   CIR006
      *                                                               *   CIR006
      *  Called by  : MAIN   - Main Processing Routine                *   CIR006
      *                                                               *   CIR006
      *  Calls      : DL1600WC - Fees, Buy-outs & Processing Method   *   CIR006
      *                                                               *   CIR006
      *****************************************************************   CIR006
     C           SRDWIN    BEGSR                                          CIR006
      *                                                                   CIR006
      **  Main Details                                                    CIR006
      *                                                                   CIR006
     C                     MOVE SDLNO     #1DLNO                          CIR006
     C                     MOVE 'I'       #1ACTN                          CIR006
     C                     MOVE SDTYP     #1DTYP                          CIR006
     C                     MOVE SDLST     #1DLST                          CIR006
     C                     MOVE DDATX     #1DDAT                          CIR006
     C                     MOVE SBRCA     #1BRCA                          CIR006
     C                     MOVE SBRKC     #1BRKC                          CIR006
     C                     MOVE BAGEX     #1BAGE                          CIR006
     C                     MOVE SLNKDN    #1LNKD                          CIR006
     C                     MOVE SCNUM     #1CNUM                          CIR006
     C                     MOVE VDATX     #1VDAT                          CIR006
     C                     MOVE MDATX     #1MDAT                          CIR006
     C                     MOVE SCDAS     #1CDAS                          CIR006
     C                     MOVE SUCUCY    #1UCUC                          CIR006
     C                     MOVE UPAMTX    #1UPAM                          CIR006
      *                                                                   CIR006
      ** Our Details                                                      CIR006
      *                                                                   CIR006
     C                     MOVE SRICFR    #1UICF                          CIR006
     C                     MOVE SRIPFR    #1UIPF                          CIR006
     C                     MOVE VDATX     #1UIAC                          CIR006
     C                     Z-ADD0         #1USEO                          CIR006
     C                     MOVE *BLANKS   #1UACO                          CIR006
     C                     Z-ADD0         #1URRO                          CIR006
     C                     Z-ADD0         #1UNOO                          CIR006
      *                                                                   CIR006
      **  Their Details                                                   CIR006
      *                                                                   CIR006
     C                     MOVE SRICFR    #1TICF                          CIR006
     C                     MOVE SRIPFR    #1TIPF                          CIR006
     C                     MOVE VDATX     #1TIAC                          CIR006
     C                     Z-ADD0         #1TSEO                          CIR006
     C                     MOVE *BLANKS   #1TACO                          CIR006
     C                     Z-ADD0         #1TRRO                          CIR006
     C                     Z-ADD0         #1TNOO                          CIR006
      *                                                                   CIR006
      ** If SAR CEU003 (EMU DL Settlement Ccy Conversion) is installed.   CIR006
      ** Then move new fields in PF/DEALSDG.                              CIR006
      *                                                                   CIR006
     C           CEU003    IFEQ 'Y'                                       CIR006
      *                                                                   CIR006
     C                     MOVELSSTCY     #1PSCY                          CIR006
     C                     MOVELSSTCY     #1RSCY                          CIR006
     C                     MOVELSIC72     #1IC72                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     MOVE *BLANKS   #1PSCY                          CIR006
     C                     MOVE *BLANKS   #1RSCY                          CIR006
     C                     MOVE *BLANKS   #1IC72                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                                       CAP041
      ** Just call window if CAP041 is not installed. Otherwise                               CAP041
      ** call new API program for Up-Front Fee/Buy-outs                                       CAP041
      *                                                                                       CAP041
     C           CAP041    IFEQ 'Y'                                                           CAP041
     C                     MOVEL'IRFEBO'  WTEXT1  9                                           CAP041
     C                     MOVE 'SIN'     WTEXT1                                              CAP041
     C                     CALL WTEXT1                                                        CAP041
     C                     PARM *BLANKS   PRTCD                                               CAP041
     C                     PARM           DATA                                                CAP041
     C                     PARM *BLANKS   CANCFM  1                                           CAP041
      *                                                                                       CAP041
      ** F12 is pressed                                                                       CAP041
     C           PRTCD     IFEQ 'USR0790'                                                     CAP041
     C                     MOVE *ON       *INKL                                               CAP041
     C                     GOTO EDWIN                                                         CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
      ** F3 is pressed                                                                        CAP041
     C           PRTCD     IFEQ 'Y2U9999'                                                     CAP041
     C                     MOVE *ON       *INKC                                               CAP041
     C                     GOTO EDWIN                                                         CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
     C                     MOVEL'DL1604IX'PPGM                                                CAP041
     C                     ELSE                                                               CAP041
     C                     MOVEL'DL1604I 'PPGM                                                CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
     C/COPY WNCPYSRC,DL1604IC89
     C           BGWDPR    IFEQ 'Y'                                                           CAP041
      *                                                                   CIR006
      **  Call window program.                                            CIR006
      *                                                                   CIR006
     C                     CALL 'WN0010'                                  CIR006
     C**********           PARM 'DL1604I 'PPGM   10                                    CIR006 CAP041
     C                     PARM           PPGM   10                       CIR006              CAP041
     C                     PARM *BLANKS   PFKEY   2                       CIR006
     C                     PARM 'I'       PACTN   1                       CIR006
     C                     PARM           DATA                            CIR006
     C                     PARM *BLANKS   PRTCD   7                       CIR006
     C                     PARM *BLANKS   SPARE 256                       CIR006
      *                                                                   CIR006
      **  F12 is pressed.                                                 CIR006
      *                                                                   CIR006
     C           PRTCD     IFEQ 'USR0790'                                 CIR006
     C                     MOVE '1'       *INKL                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
      **  F3 is pressed.                                                  CIR006
      *                                                                   CIR006
     C           PRTCD     IFEQ 'Y2U9999'                                 CIR006
     C                     MOVE '1'       *INKC                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                                              CAP041
     C**********           ENDSR                                                       CIR006 CAP041
     C           EDWIN     ENDSR                                                              CAP041
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SETOF SR.     To setof all error indicator, clear arrays     *
      *                and screen error fields                        *
      *                ( Except *IN08 & SERCD2 where record updated   *
      *                by another wkstn. Do this after display fmt )  *
      *                                                               *
      *****************************************************************
      *
     C           SETOF     BEGSR                           ***  SETOF ****
      **
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     MOVEA'00'      *IN,1                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVEA'000'     *IN,5
      *                                                                   S01194
      ** *IN11 (Profit Centre) must not be setof                          S01194
      *                                                                   S01194
     C*****                MOVEA'00000000'*IN,10                          S01194
     C                     MOVEA'0'       *IN,10                          S01194
     C                     MOVEA'000000'  *IN,12                          S01194
     C                     MOVEA'00000000'*IN,18
     C*****                MOVEA'00000000'*IN,26                          S01117
     C                     MOVEA'0000'    *IN,26                          S01117
      *                                                                   CIR006
      **  Indicator 31 must not be setoff.                                CIR006
      *                                                                   CIR006
     C**********           MOVEA'00'      *IN,31                   S01117 CIR006
     C                     MOVE '0'       *IN32                           CIR006
     C                     MOVEA'00000000'*IN,34
     C                     MOVEA'00000000'*IN,42
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'00000'   *IN,66
     C/COPY WNCPYSRC,DL1604IC58
     C                     MOVEA*BLANKS   ERCD
     C                     MOVEA*BLANKS   WRCD
     C                     MOVE *BLANKS   SERCD1
      *  Do not blank message here if 'Record updated.....'
     C           *IN08     IFEQ '0'
     C                     MOVE *BLANKS   SERCD2
     C                     END
      *
     C                     Z-ADD0         S       20
     C                     Z-ADD0         W       20
      *                                                                   CIR005
      ** Clear message subfile                                            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     EXSR SRCLR                                     CIR005
     C                     ENDIF                                          CIR005
      **
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  ERDSP   SR.   To load error codes in arrays into screen      *
      *                error fields                                   *
      *****************************************************************
      *
     C           ERDSP     BEGSR                           ***  ERDSP ****
      *
      **  Load any warning error codes into error code array
     C           *IN07     IFEQ '1'
     C           S         ANDLT38
     C                     ADD  1         S
     C                     MOVEAWRCD      ERCD,S
     C                     END
      *
      **  Load first 19 error codes into first screen field
     C** Do not load screen field SERCD1 if it already contains new       039457
     C** error message.                                                   039457
     C*                                                                   039457
     C           SERCD1    IFNE ERRMSG,7                                  039457
     C                     MOVEAERCD,1    SERCD1
     C                     END                                            039457
      *
      **  If more than 19 error codes exist, load the next 19
      **  into the second screen field ( Ignore any more than 38 )
      *
     C           S         IFGT 19
     C                     MOVEAERCD,20   SERCD2
     C                     SETON                     06
     C                     END
      *
     C                     ENDSR
     C*
     C*****************************************************************
      *****************************************************************   S01199
      *****************************************************************   S01199
      ***HELP**SR.*****To*call*MHELP*pgm*&*pass*error*codes************   S01199
      *****************************************************************   S01199
     C********** HELP      BEGSR                           ***  HELP  ****S01199
      **********                                                          S01199
     C**********           MOVEL'DL1604'  HBPGM   6                       S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
      **********                                                          S01199
     C**********           ENDSR                                          S01199
      **********                                                          S01199
      ********************************************************************S01199
      /EJECT
      *****************************************************************
      *                                                               *
      *  URLIN   SR.   To update/add files for a cap/collar           *
      *                IRS INSERT transaction                   (P14) *
      *****************************************************************
      *
     C           URLIN     BEGSR                           ***  URLIN ****
      *
      **  Create data fields for output
     C                     EXSR CRDTA1
      **  Set confirmation indicators for PF/DTRIXDD and PF/DEALSDG
     C                     EXSR CONFI
      **  Set up data structure to provide text on journal comit entry
     C                     EXSR ZTNLU1
     C                     EXSR CMTXT
      *
     C/COPY WNCPYSRC,DL1604C14                                            S01408
      **  Check if PF/MEMOS is to be updated
      **  Shadow post only if Retail module present
      **  and retail account numbers used
     C********** *IN89     IFEQ '1'                                       S01194
     C           BGRTBN    IFEQ 'Y'                                       S01194
     C           *IN88     ANDEQ'1'
      **   Process only , if NON-AVR deal &  back-valued
     C           SAVRAM    ANDNE'Y'
     C*****      VDATX     ANDLTRUND                                      S01194
     C           VDATX     ANDLTBJRDNB                                    S01194
     C           CIR006    ANDEQ'N'                                       CIR006
     C                     EXSR UMEMOS
     C                     END
      **  Write PF/DEALSDG ( IRS cap/collar deal record )
     C                     EXSR WDLDG
      **  If write fails, pass control to INFSR
     C           *IN86     IFEQ '1'
     C                     EXSR INFSR
     C                     ELSE
      **
     C/COPY WNCPYSRC,DL1604ICP8                                           S01408
      *                                                                   S01408
      **  Write PF/DTRIXDD ( deal transaction index detail record )
     C                     EXSR WDTDD
     C/COPY WNCPYSRC,DL1604IC04
      *                                                                   CIR006
      ** If CIR006 is not switched on, use standard on-line update        CIR006
      **   routines.                                                      CIR006
      *                                                                   CIR006
     C           CIR006    IFNE 'Y'                                       CIR006
      *                                                                   CIR006
      **  Update LF/OLPOS ( on line positions )
     C           SAVRAM    CASNE'Y'       UOLPOS
     C                     END
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
      ** If CIR006 is switched on, use AO/AOOUSWU0 to perform on-line     CIR006
      **   updates.                                                       CIR006
      *                                                                   CIR006
     C                     CALL 'AOOUSWU0'                                CIR006
     C                     PARM *BLANKS   ##RTCD  7                       CIR006
     C                     PARM *BLANKS   Z#BSTS                          CIR006
     C                     PARM           Z#ASTS                          CIR006
     C                     PARM           Z#WSTS                          CIR003
     C                     PARM           Z#XSTS                          CIR003
     C                     PARM           Z#YSTS                          CIR003
     C                     PARM           Z#ZSTS                          CIR003
      *                                                                   CIR006
     C           ##RTCD    IFEQ '*ERROR'                                  CIR006
     C                     MOVEL'AOOUSWU0'DBFILE                          CIR006
     C                     Z-ADD35        DBASE                           CIR006
     C                     MOVEL*BLANK    DBKEY                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     END                                            CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      **  Update LF/PRONO ( Projected nostros )
     C           SAVRAM    CASNE'Y'       UPRONO
     C                     END
      **  Update PF/DEALSDF ( deals trailer record )
     C                     EXSR UDLDF
      **  Update PF/DTRIXHH ( deal transaction header record )
     C/COPY WNCPYSRC,DL1604IC05
     C                     EXSR UDTHH
     C/COPY WNCPYSRC,DL1604IC06
      *                                                                   CIR001
      ** Up-Front fee Updates                                             CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     EXSR #LPREM                                    CIR001
     C                     END                                            CIR001
     C*                                                                   S01157
     C* CALL SUMMARY UPDATE PGM                                           S01157
     C*                                                                   S01157
     C* SETUP DEAL NO.                                                    S01157
     C*                                                                   S01157
     C                     MOVE SDLNO     @DLNUM                          S01157
     C*                                                                   S01157
     C                     CALL 'DL1911'                                  S01157
     C                     PARM           @TERM   1                       S01157
     C                     PARM           @DLNUM  60                      S01157
     C                     PARM           SACCD                           S01157
     C                     PARM           SUCUCY                          S01157
     C*                                                                   S01157
     C           @TERM     IFEQ 'E'                                       S01157
     C                     EXSR INFSR                                     S01157
     C                     END                                            S01157
     C*                                                                   S01157
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSDLNO     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'CFCO'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IWIN                                           S01408
     C*                                                                   S01408
      **  End of commitment cycle
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604ICP9                                           S01408
      *                                                                   S01408
     C                     END
      **
     C                     ENDSR
      ********************************************************************
     C/COPY WNCPYSRC,DL1604IC10                                           S01408
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  #LPREM SR.    To set Premium details if entered, for         *   CIR001
      *                call of SR/#LUPRE.                             *   CIR001
      *                                                               *   CIR001
      *  Parameters Passed: XXSETM - Settlement method                *   CIR001
      *                     XXACC  - Account number                   *   CIR001
      *                     XXVDT  - Value date                       *   CIR001
      *                     XXPRI  - Payment/Receipt indicator        *   CIR001
      *                     XXAMT  - Amount                           *   CIR001
      **********************XXRRN**-*Relative*record*number         CIR001CCB002
      *                     XXNOST - NOSTRO number                    *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LPREM    BEGSR                                          CIR001
      *                                                                   CIR001
     C                     MOVE *BLANKS   XXPRI   1                       CIR001
     C                     Z-ADD0         XXVDT   50                      CIR001
     C                     Z-ADD0         XXAMT  150                      CIR001
     C                     Z-ADD0         XXSETM  20                      CIR001
     C                     MOVE *BLANKS   XXNOST  2                       CIR001
     C**********           Z-ADD0         XXCNUM                                       CIR001 CSD027
     C                     MOVE *BLANKS   XXCNUM                                              CSD027
     C                     MOVE *BLANKS   XXCCY                           CIR001
     C                     Z-ADD0         XXACOD                          CIR001
     C                     Z-ADD0         XXACSQ                          CIR001
     C************LIKE*****DEFN RRNM      XXRRN                     CIR001CCB002
     C*********************Z-ADD0         XXRRN                     CIR001CCB002
     C                     MOVE 'N'       XXRET   1                       CCB002
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC31                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C           SUPVD     IFNE *BLANKS                                   CIR001
     C                     Z-ADDUPVDX     XXVDT                           CIR001
      *                                                                   CEU003
      ** Convert premium amount XXAMT to our-effective-settlement         CEU003
      ** -currency-workfield value via conversion program EU0200.         CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           WSTCY     ANDNESUCUCY                                    CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM *BLANKS   P@RTCD  7                       CEU003
     C                     PARM UPFEX     P@FRAM 183                      CEU003
     C                     PARM SUCUCY    P@FRCY  3                       CEU003
     C                     PARM WSTCY     P@TOCY  3                       CEU003
     C                     PARM *ZEROS    P@OUTA 150                      CEU003
     C                     PARM *ZEROS    P@INTA 183                      CEU003
     C                     PARM *ZEROS    P@EXRT 159                      CEU003
     C                     PARM *BLANKS   P@MDIN  1                       CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     Z-ADDP@OUTA    XXAMT                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVEL'EU0200  'DBFILE                          CEU003
     C                     Z-ADD27        DBASE                           CEU003
     C                     MOVEL'CEU003'  DBKEY                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     Z-ADDUPFEX     XXAMT                           CIR001
     C                     ENDIF                                          CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC32                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C           SBYSL     IFEQ 'B'                                       CIR001
     C           SPSETM    ANDNE*BLANKS                                   CIR001
     C           SPSETM    ANDNE'00'                                      CIR001
     C                     Z-ADD1         DORC                            CIR001
     C                     MOVE 'P'       XXPRI                           CIR001
     C                     MOVELSPSETM    XXSETM                          CIR001
     C                     MOVELXPNOST    XXNOST                          CIR001
     C**********           Z-ADDXPCNUM    XXCNUM                                       CIR001 CSD027
     C                     MOVE XPCNUM    XXCNUM                                              CSD027
     C                     MOVE XPCCY     XXCCY                           CIR001
     C                     Z-ADDXPACOD    XXACOD                          CIR001
     C                     Z-ADDXPACSQ    XXACSQ                          CIR001
     C           XPRACC    IFEQ 'Y'                                       CIR001
     C*********************Z-ADDXPRRNM    XXRRN                     CIR001CCB002
     C                     MOVE 'Y'       XXRET                           CCB002
     C                     MOVE XPBRCA    XXBRCA  3                       CCB002
     C                     END                                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR #LUPRE                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           SBYSL     IFEQ 'S'                                       CIR001
     C           SRSETM    ANDNE*BLANKS                                   CIR001
     C           SRSETM    ANDNE'00'                                      CIR001
     C                     Z-ADD0         DORC                            CIR001
     C                     MOVE 'R'       XXPRI                           CIR001
     C                     MOVELSRSETM    XXSETM                          CIR001
     C                     MOVELXRNOST    XXNOST                          CIR001
     C**********           Z-ADDXRCNUM    XXCNUM                                       CIR001 CSD027
     C                     MOVE XRCNUM    XXCNUM                                              CSD027
     C                     MOVE XRCCY     XXCCY                           CIR001
     C                     Z-ADDXRACOD    XXACOD                          CIR001
     C                     Z-ADDXRACSQ    XXACSQ                          CIR001
     C           XRRACC    IFEQ 'Y'                                       CIR001
     C*********************Z-ADDXRRRNM    XXRRN                     CIR001CCB002
     C                     MOVE 'Y'       XXRET                           CCB002
     C                     MOVE XRBRCA    XXBRCA                          CCB002
     C                     END                                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR #LUPRE                                    CIR001
     C                     END                                            CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC33                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC34                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  #LUPRE SR.    To Update PF/PRONO, PF/MEMOS and PF/RSACMTPD   *   CIR001
      *                using data passed from SR/#LPREM.              *   CIR001
      *                                                               *   CIR001
      *  Passed Parameters: XXSETM - Settlement method                *   CIR001
      *                     XXACC  - Account number                   *   CIR001
      *                     XXVDT  - Value date                       *   CIR001
      *                     XXPRI  - Payment/Receipt indicator        *   CIR001
      *                     XXAMT  - Amount                           *   CIR001
      **********************XXRRN**-*Relative*record*number         CIR001CCB002
      *                     XXNOST - NOSTRO number                    *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           #LUPRE    BEGSR                                          CIR001
      *                                                                   CIR001
      ** Update PF/PRONO file.                                            CIR001
      *                                                                   CIR001
     C           PRKEY1    KLIST                                          CIR001
     C                     KFLD           PRCCY1  3                       CIR001
     C                     KFLD           PRNNO1  20                      CIR001
     C                     Z-ADD0         PPAY                            CIR001
     C                     Z-ADD0         PREC                            CIR001
     C                     Z-ADD0         RANGE                           CIR001
     C                     MOVE *BLANKS   XXNST   1                       CIR001
      *                                                                   CIR001
      ** Process if settled through a nostro                              CIR001
      *                                                                   CIR001
     C           XXSETM    IFEQ 01                                        CIR001
     C           XXSETM    OREQ 02                                        CIR001
     C           XXSETM    OREQ 07                                        CIR001
     C           XXSETM    OREQ 08                                        CIR001
     C           XXSETM    OREQ 12                                        CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       XXNST                           CIR001
      *                                                                   CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
      ** If record not found, use 'unallocated' code                      CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
     C                     Z-ADD0         PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           *IN86     IFNE '1'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Range End Date is up to the 6th working day                      CIR001
      *                                                                   CIR001
     C           PDAT,5    ADD  1         ZDAYNO                          CIR001
     C***********          MOVE UCUCY     ZCCY                     CIR001 CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     Z-ADD0         ZNRDYS                          CIR001
     C                     EXSR ZFWDT                                     CIR001
      *                                                                   CIR001
      ** Save the value of the 6th working day                            CIR001
      *                                                                   CIR001
     C                     Z-ADDZDYNBR    RANGE   50                      CIR001
     C                     MOVELPRNNO1    XXNOST                          CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Release PF/PRONOPN record if record found                        CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELPR                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Find relevant element starting postition.                        CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X                               CIR001
      *                                                                   CIR001
     C           XXVDT     IFGT PDAT,5                                    CIR001
     C           XXVDT     ANDGERANGE                                     CIR001
     C                     Z-ADD6         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXVDT     IFGT PDAT,5                                    CIR001
     C           XXVDT     ANDLTRANGE                                     CIR001
     C                     Z-ADD5         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXVDT     IFGE PDAT,1                                    CIR001
     C           XXVDT     ANDLEPDAT,5                                    CIR001
     C           X         ANDLE5                                         127972
     C           XXVDT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Adjust Nostro balances for Entries X to 5                        CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                        PAYMENTS       CIR001
     C                     SUB  XXAMT     PPAY,X                          CIR001
     C                     END                                            CIR001
     C           XXPRI     IFEQ 'R'                        RECEIPTS       CIR001
     C                     ADD  XXAMT     PREC,X                          CIR001
     C                     END                                            CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update projected nostros                                         CIR001
      *                                                                   CIR001
      ** Access PRONO record - PAYMENT                                    CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                                       CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Update projected nostros record                                  CIR001
      *                                                                   CIR001
     C                     ADD  PPAY      PBAL                            CIR001
     C                     Z-ADDNATN      TNLU                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Access PRONO record - RECEIPT                                    CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                                       CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Update projected nostros record                                  CIR001
      *                                                                   CIR001
     C                     ADD  PREC      PBAL                            CIR001
     C                     Z-ADDNATN      TNLU                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update PF/MEMOS file                                             CIR001
      *                                                                   CIR001
     C***********XXRRN*****IFNE *ZEROS                              CIR001CCB002
     C           XXRET     IFEQ 'Y'                                       CCB002
      *                                                                   CIR001
     C                     Z-ADD0         MPAY   150                      CIR001
     C                     Z-ADD0         MREC   150                      CIR001
      *                                                                   CIR001
      ** Only Update PF/MEMOS if Value Date is equal or less than         CIR001
      ** Event Control Date.                                              CIR001
      *                                                                   CIR001
     C           *IN89     IFEQ '1'                                       CIR001
     C           *IN88     ANDEQ'1'                                       CIR001
     C           XXVDT     ANDLEEVCD                                      CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                        PAYMENTS       CIR001
     C                     SUB  XXAMT     MPAY              INSERT        CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                        RECEIPTS       CIR001
     C                     ADD  XXAMT     MREC              INSERT        CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** PAYMENTS                                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                                       CIR001
      *                                                                   CIR001
      ***Access*PF/MEMOS*record                                     CIR001CCB002
      *                                                             CIR001CCB002
     C***********XXRRN*****CHAINMEMOS                86             CIR001CCB002
      *                                                             CIR001CCB002
      ***End*if*detail*record*not*found                             CIR001CCB002
      *                                                             CIR001CCB002
     C************IN86*****IFEQ '1'                                 CIR001CCB002
     C***********RECI******ORNE 'D'                                 CIR001CCB002
     C*********************Z-ADD24        DBASE            *********CIR001CCB002
     C*********************MOVEL'MEMOS'   DBFILE           * DBERROR 024 *CCB002
     C*********************MOVELXXRRN     DBKEY            *********CIR001CCB002
     C*********************EXSR *PSSR                               CIR001CCB002
     C*********************END                                      CIR001CCB002
      *                                                                   CIR001
      ** Update shadow balances record                                    CIR001
      *                                                                   CIR001
     C*********************ADD  MPAY      LDBLN                     CIR001CCB002
     C*********************ADD  MPAY      CLBLN                     CIR001CCB002
     C                     Z-ADDMPAY      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM XXCNUM    W0CNUM           O:Customer No. CCB002
     C                     PARM XXCCY     W0CCY            O:Currency     CCB002
     C                     PARM XXACOD    W0ACOD           O:Account Code CCB002
     C                     PARM XXACSQ    W0ACSQ           O:Account Seq. CCB002
     C                     PARM XXBRCA    W0BRCA           O:Branch       CCB002
     C                     PARM BJRDNB    W0PSTD           O:Posting date CCB002
     C                     PARM XXVDT     W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '24'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 24 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C                     END                                            CIR001
     C/COPY WNCPYSRC,DL1604IC82
      *                                                                   CIR001
      ** RECEIPTS                                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                                       CIR001
      *                                                                   CIR001
      ***Access*PF/MEMOS*record                                     CIR001CCB002
      *                                                             CIR001CCB002
     C***********XXRRN*****CHAINMEMOS                86             CIR001CCB002
      *                                                             CIR001CCB002
      ***End*if*detail*record not found                             CIR001CCB002
      *                                                             CIR001CCB002
     C************IN86*****IFEQ '1'                                 CIR001CCB002
     C***********RECI******ORNE 'D'                                 CIR001CCB002
     C*********************Z-ADD25        DBASE            *********CIR001CCB002
     C*********************MOVEL'MEMOS'   DBFILE           * DBERROR 025 *CIR001
     C*********************MOVELXXRRN     DBKEY            *********CIR001CCB002
     C*********************EXSR *PSSR                               CIR001CCB002
     C*********************END                                      CIR001CCB002
      *                                                                   CIR001
      ** Update shadow balances record                                    CIR001
      *                                                                   CIR001
     C*********************ADD  MREC      LDBLN                     CIR001CCB002
     C*********************ADD  MREC      CLBLN                     CIR001CCB002
     C                     Z-ADDMREC      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM XXCNUM    W0CNUM           O:Customer No. CCB002
     C                     PARM XXCCY     W0CCY            O:Currency     CCB002
     C                     PARM XXACOD    W0ACOD           O:Account Code CCB002
     C                     PARM XXACSQ    W0ACSQ           O:Account Seq. CCB002
     C                     PARM XXBRCA    W0BRCA           O:Branch       CCB002
     C                     PARM BJRDNB    W0PSTD           O:Posting date CCB002
     C                     PARM XXVDT     W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '25'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 25 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604IC83
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update PF/RSACMTPD file IF NOSTRO or RETAIL ACC settlement.      CIR001
      *                                                                   CIR001
     C           XXNST     IFEQ 'Y'                                       CIR001
     C***********XXRRN*****ORGT 0                                   CIR001CCB002
     C           XXRET     OREQ 'Y'                                       CCB002
      *                                                                   CIR001
     C                     Z-ADDXXAMT     MVAM                            CIR001
      *                                                                   CIR001
      ** Only write a record if the amount is not ZERO                    CIR001
      *                                                                   CIR001
     C           MVAM      IFNE *ZEROS                                    CIR001
      *                                                                   CIR001
     C                     MOVE NEWDL     TNMR                            CIR001
     C**********           Z-ADDXXCNUM    CUSN                                         CIR001 CSD027
     C                     MOVE XXCNUM    CUSN                                                CSD027
     C                     MOVE XXCCY     CCYD                            CIR001
     C                     Z-ADDXXACOD    ACDE                            CIR001
     C                     Z-ADDXXACSQ    ASNC                            CIR001
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDXXVDT     VUDT                            CIR001
     C                     MOVE SDTYP     TRYP                            CIR001
     C                     MOVE *BLANKS   NRTC                            CIR001
     C                     MOVEL'Premium' NRTD                            CIR001
     C                     Z-ADD*ZEROS    CQNR                            CIR001
     C                     MOVE *BLANKS   FUND                            CIR001
      *                                                                   CIR001
      ** If CRE009 is ON and account is RE, set posting date the same     CRE009
      ** as value date when the latter is not less than the run date.     CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
     C           XXRET     ANDEQ'Y'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CIR001
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  CIR001
     C/COPY WNCPYSRC,DL1604IC84
      *                                                                   CIR001
     C                     Z-ADD0         MVAM                            CIR001
     C                     MOVE *BLANKS   TNMR                            CIR001
     C**********           Z-ADD0         CUSN                                         CIR001 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C                     MOVE *BLANKS   CCYD                            CIR001
     C                     Z-ADD0         ACDE                            CIR001
     C                     Z-ADD0         ASNC                            CIR001
     C                     Z-ADD0         PTDT                            CIR001
     C                     Z-ADD0         VUDT                            CIR001
     C                     MOVE *BLANKS   TRYP                            CIR001
     C                     MOVE *BLANKS   NRTD                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *                                                                   CIR001
      *****************************************************************   CIR001
      /EJECT
      *****************************************************************
      *                                                               *
      *  CRDTA1  SR.   To create data fields for output on insert     *
      *                                                         (P14) *
      *****************************************************************
      *
     C           CRDTA1    BEGSR                           *** CRDTA1 ****
      *
      **  Our effective interest rate
      *
     C           SAVRAM    IFEQ 'Y'
     C                     Z-ADD0         UEINRX 117
     C                     ELSE
     C***        SWORK1    IFEQ *BLANKS                                   S01157
     C           SWORKR    IFEQ *BLANKS                                   S01157
     C                     Z-ADD0         UEINRX
     C                     ELSE
     C****                 Z-ADDWORK1X    UEINRX                          S01157
     C                     Z-ADDWORK2X    UEINRX                          S01157
     C                     END
     C                     END
      *
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****                 Z-SUBUEINRX    UEINRX                          S01157
     C****                 END                                            S01157
      *
      **  Our interest fix date
      *
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C           SRBRTT    IFEQ *BLANKS                                   S01157
     C******               Z-ADD0         UINFDX  50                      S01157
     C                     Z-ADD0         @INFDX  50                      S01157
     C                     ELSE
      **
     C           SAVRAM    IFEQ 'Y'
      *
     C***        SWORK1    IFEQ *BLANKS                                   S01157
     C           SWORKR    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         UINFDX                          S01157
     C                     Z-ADD0         @INFDX                          S01157
     C                     ELSE
     C****                 Z-ADDRUND      UINFDX                          S01157
     C******               Z-ADDRUND      @INFDX                   S01157 S01194
     C                     Z-ADDBJRDNB    @INFDX                          S01194
     C                     END
      *
     C                     ELSE
      *
     C***        SUFRFD    IFEQ *BLANKS                                   S01157
     C           SCFRFD    IFEQ *BLANKS                                   S01157
     C********** LOCY      IFEQ STCY                                      S01194
     C           BJLCCY    IFEQ BLCYCD                                    S01194
     C********** SUCUCY    ANDEQSTCY                                      S01194
     C           SUCUCY    ANDEQBLCYCD                                    S01194
     C****                 Z-ADD0         UFRFDX                          S01157
     C                     Z-ADD0         @FRFDX                          S01157
     C                     ELSE
     C****                 Z-ADD2         UFRFDX                          S01157
     C                     Z-ADD2         @FRFDX                          S01157
     C                     END
     C****                 ELSE                                           S01157
     C****                 Z-ADDUFRFDX    UFRFDX                          S01157
     C                     END
      *
     C/COPY WNCPYSRC,DL1604IC59
     C                     Z-ADDVDATX     ZINDT
     C****                 MOVE UFRFDX    ZRFDY                           S01157
     C                     MOVE @FRFDX    ZRFDY                           S01157
      *                                                                   108624
      ** If 'currency for rate fix holiday' flag from FRA/IRS I.C.D.      108624
      ** is 'F', 'L' or 'D', set currency code to 'sterling code',        108624
      ** 'local currency code' or 'screen currency code' respectively     108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'F'                                       108624
     C                     MOVE BLCYCD    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'L'                                       108624
     C                     MOVE BJLCCY    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'D'                                       108624
     C           BQCRFH    OREQ ' '                                       108624
     C                     MOVE SUCUCY    ZCCY
     C                     ENDIF                                          108624
     C*                                                                   108624
     C                     MOVE *BLANKS   ZLOC                            S01195
      *                                                                   CIR005
      ** Calculate rate fix date using DLBACK if one of the following     CIR005
      ** conditions is satisfied:                                         CIR005
      ** 1) Business Day Convention enhancement is switched off.          CIR005
      ** 2) Business Day Convention enhancement is switched on and        CIR005
      **    BDC pass flag is set to 'Y' and Rate Fixing Dates Conven      CIR005
      **    tion currency is blank.                                       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDEQ*BLANK                                    CIR005
     C                     EXSR DLBACK
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Calculate rate fix date using new program IRRTFXCNV if the       CIR005
      ** following conditions are satisfied:                              CIR005
      ** 1) Business Day Convention enhancement is switched on.           CIR005
      ** 2) BDC pass flag is set to 'Y'.                                  CIR005
      ** 3) Rate Fixing Dates Convention Currency is not blank            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDNE*BLANK                                    CIR005
     C                     Z-ADDZRFDY     WRFDY                           CIR005
     C                     CALL IRRTFX    PIRRAT                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** CIR005 is on, this should only be done if Business Day Con -     CIR005
      ** vention pass flag is set to 'Y' (Business Day Currency input     CIR005
      ** already done), otherwise bypass this processing                  CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
      *
     C*****      ZRFDT     IFGE RUND                                      S01194
      **  If deal forward-valued AND Short Term Rate NOT entered then     E30325
      **  the Next Interest Rate Fix Date must be that associated         E30325
      *   with the Value Date...                                          E30325
     C                     Z-ADDWORK2X    CWEINR 137                                        AR814519
     C           ZRFDT     IFGE BJRDNB                                    S01194
     C********** SWORKR    ANDEQ*BLANKS                                              E30325 AR814519
     C           CWEINR    ANDEQ0                                                           AR814519
     C****                 Z-ADDZRFDT     UINFDX                          S01157
     C                     Z-ADDZRFDT     @INFDX                          S01157
     C                     ELSE
      *
      **  ...else the Next Interest Rate Fix Date must be that            E30325
      **  associated with the Next Rate Change Date.                      E30325
     C***        SUNICD    IFNE *BLANKS                                   S01157
     C           SRNICD    IFNE *BLANKS                                   S01157
     C****                 Z-ADDUNICDX    ZINDT                           S01157
     C                     Z-ADD@NICDX    ZINDT                           S01157
     C****                 MOVE UFRFDX    ZRFDY                           S01157
     C                     MOVE @FRFDX    ZRFDY                           S01157
      *                                                                   108624
      ** If 'currency for rate fix holiday' flag from FRA/IRS I.C.D.      108624
      ** is 'F', 'L' or 'D', set currency code to 'sterling code',        108624
      ** 'local currency code' or 'screen currency code' respectively     108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'F'                                       108624
     C                     MOVE BLCYCD    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'L'                                       108624
     C                     MOVE BJLCCY    ZCCY                            108624
     C                     ENDIF                                          108624
      *                                                                   108624
     C           BQCRFH    IFEQ 'D'                                       108624
     C           BQCRFH    OREQ ' '                                       108624
     C                     MOVE SUCUCY    ZCCY
     C                     ENDIF                                          108624
     C*                                                                   108624
     C                     MOVE *BLANKS   ZLOC                            S01195
      *                                                                   CIR005
      ** Calculate rate fix date using DLBACK if one of the following     CIR005
      ** conditions is satisfied:                                         CIR005
      ** 1) Business Day Convention enhancement is switched off.          CIR005
      ** 2) Business Day Convention enhancement is switched on and        CIR005
      **    BDC pass flag is set to 'Y' and Rate Fixing Dates Conven      CIR005
      **    tion currency is blank.                                       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDEQ*BLANK                                    CIR005
     C                     EXSR DLBACK
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Calculate rate fix date using new program IRRTFXCNV if the       CIR005
      ** following conditions are satisfied:                              CIR005
      ** 1) Business Day Convention enhancement is switched on.           CIR005
      ** 2) BDC pass flag is set to 'Y'.                                  CIR005
      ** 3) Rate Fixing Dates Convention Currency is not blank            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C           PBDRAT    ANDNE*BLANK                                    CIR005
     C                     Z-ADDZRFDY     WRFDY                           CIR005
     C                     CALL IRRTFX    PIRRAT                          CIR005
     C                     ENDIF                                          CIR005
     C****                 Z-ADDZRFDT     UINFDX                          S01157
      *                                                                   CIR005
      ** CIR005 is on, this should only be done if the Business Day       CIR005
      ** Convention pass flag is set to 'Y' (Business Day Currency        CIR005
      ** input is already done), otherwise bypass this processing         CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'N'                                       CIR005
     C           CIR005    OREQ 'Y'                                       CIR005
     C           WBDCPS    ANDEQ'Y'                                       CIR005
     C                     Z-ADDZRFDT     @INFDX                          S01157
     C                     ENDIF                                          CIR005
     C                     ELSE
     C****                 Z-ADD0         UINFDX                          S01157
     C                     Z-ADD0         @INFDX                          S01157
     C                     END
     C                     END
     C                     ENDIF                                          CIR005
     C                     END
     C                     END
      *
      **  Their effective interest rate
      *
     C           SAVRAM    IFEQ 'Y'
     C                     Z-ADD0         TEINRX 117
     C                     ELSE
     C***        SWORK2    IFEQ *BLANKS                                   S01157
     C           SWORKR    IFEQ *BLANKS                                   S01157
     C                     Z-ADD0         TEINRX
     C                     ELSE
     C                     Z-ADDWORK2X    TEINRX
     C                     END
     C                     END
      *
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***                  Z-SUBTEINRX    TEINRX                          S01157
     C****                 END                                            S01157
      *
      **  Their interest fix date
      *
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C****       SRBRTT    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         TINFDX  50                      S01157
     C****                 ELSE                                           S01157
      **                                                                  S01157
     C****       SAVRAM    IFEQ 'Y'                                       S01157
     C***        SWORK2    IFEQ *BLANKS                                   S01157
     C****       SWORKR    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         TINFDX                          S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADDRUND      TINFDX                          S01157
     C****                 END                                            S01157
      *                                                                   S01157
     C****                 ELSE                                           S01157
      *                                                                   S01157
     C***        STFRFD    IFEQ *BLANKS                                   S01157
     C****       SCFRFD    IFEQ *BLANKS                                   S01157
     C****       LOCY      IFEQ STCY                                      S01157
     C****       SUCUCY    ANDEQSTCY                                      S01157
     C****                 Z-ADD0         TFRFDX                          S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADD2         TFRFDX                          S01157
     C****                 END                                            S01157
     C****                 Z-ADDTFRFDX    TFRFDX                          S01157
     C****                 END                                            S01157
      ****                                                                S01157
     C****                 Z-ADDVDATX     ZINDT                           S01157
     C****                 MOVE TFRFDX    ZRFDY                           S01157
     C****                 MOVE SUCUCY    ZCCY                            S01157
     C****                 EXSR DLBACK                                    S01157
      *                                                                   S01157
     C****       ZRFDT     IFGE RUND                                      S01157
     C****                 Z-ADDZRFDT     TINFDX                          S01157
     C****                 ELSE                                           S01157
      *                                                                   S01157
     C***        STNICD    IFNE *BLANKS                                   S01157
     C****       SRNICD    IFNE *BLANKS                                   S01157
     C****                 Z-ADDTNICDX    ZINDT                           S01157
     C****                 MOVE TFRFDX    ZRFDY                           S01157
     C****                 MOVE SUCUCY    ZCCY                            S01157
     C****                 EXSR DLBACK                                    S01157
     C****                 Z-ADDZRFDT     TINFDX                          S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADD0         TINFDX                          S01157
     C****                 END                                            S01157
     C****                 END                                            S01157
     C****                 END                                            S01157
     C****                 END                                            S01157
      *                                                                   S01157
      **  Averaging period
      *
     C           SAVRAM    IFNE 'Y'
     C                     Z-ADD0         AVPERX  30
     C                     ELSE
      *
     C***        SWORK1    IFNE *BLANKS                                   S01157
     C           SWORKR    IFNE *BLANKS                                   S01157
     C****       UINFDX    SUB  VDATX     AVPERX                          S01157
     C           @INFDX    SUB  VDATX     AVPERX                          S01157
     C                     ELSE
     C***        SWORK2    IFNE *BLANKS                                   S01157
     C****       SWORKR    IFNE *BLANKS                                   S01157
     C****       TINFDX    SUB  VDATX     AVPERX                          S01157
     C****                 ELSE                                           S01157
     C                     Z-ADD0         AVPERX
     C****                 END                                            S01157
     C                     END
     C                     END
      *
      **  Total interest
      *
     C           SAVRAM    IFNE 'Y'
     C                     Z-ADD0         TIRATX 158
     C                     ELSE
      *
     C**         SWORK1    IFNE *BLANKS                                   S01157
     C           SWORKR    IFNE *BLANKS                                   S01157
     C****       WORK1X    MULT AVPERX    TIRATX                          S01157
     C           WORK2X    MULT AVPERX    TIRATX                          S01157
     C                     ELSE
     C***        SWORK2    IFNE *BLANKS                                   S01157
     C           SWORKR    IFNE *BLANKS                                   S01157
     C           WORK2X    MULT AVPERX    TIRATX
     C                     ELSE
     C                     Z-ADD0         TIRATX
     C                     END
     C                     END
     C                     END
      *
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***                  Z-SUBTIRATX    TIRATX                          S01157
     C***                  END                                            S01157
      *
      **  Actual average calculated rate
      *
     C           SAVRAM    IFNE 'Y'
     C                     Z-ADD0         AACRTX 117
     C                     ELSE
      *
     C***        SWORK1    IFNE *BLANKS                                   S01157
     C****                 Z-ADDWORK1X    AACRTX                          S01157
     C***                  ELSE                                           S01157
     C***        SWORK2    IFNE *BLANKS                                   S01157
     C           SWORKR    IFNE *BLANKS                                   S01157
     C                     Z-ADDWORK2X    AACRTX
     C                     ELSE
     C                     Z-ADD0         AACRTX
     C                     END
     C****                 END                                            S01157
     C                     END
      *
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****                 Z-SUBAACRTX    AACRTX                          S01157
     C****                 END                                            S01157
      *
      **  Our deal static indicators
      **  Their deal static indicators
      *
     C                     BITOF'01234567'UDSTI
     C                     BITOF'01234567'TDSTI
      *
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***                  BITON'1'       UDSTI                           S01157
     C***                  BITON'1'       TDSTI                           S01157
     C***                  END                                            S01157
     C           SUFFI     IFEQ 'Y'
     C                     BITON'2'       UDSTI
     C                     BITON'2'       TDSTI
     C                     END
     C           SAVRAM    IFEQ 'Y'
     C                     BITON'3'       UDSTI
     C                     BITON'3'       TDSTI
     C                     END
     C           SFLRAT    IFNE *BLANKS
     C                     BITON'4'       UDSTI
     C                     BITON'4'       TDSTI
     C                     END
      **
     C                     ENDSR
      ********************************************************************
      /SPACE 3
     C/COPY WNCPYSRC,DL1604IC07
      *****************************************************************
      *                                                               *
      *  WDTDD  SR.    To write PF/DTRIXDD deal transaction index     *
      *                record                                   (W18) *
      *                                                               *
      *****************************************************************
      *
     C           WDTDD     BEGSR                           ***  WDTDD ****
      *
      **  Setup information in file fields
     C                     MOVE 'D'       RECI
     C                     MOVE 'D'       RCDT
     C                     MOVE SDLNO     DLNO
     C                     Z-ADD0         VDAT
     C                     Z-ADD0         DASN
     C                     MOVE SACCD     CHTP
      *  (NB Confirmation inds set in subroutine CONFI )
     C                     MOVE 'N'       CNPR
     C                     MOVE ' '       REPR
      *  ( NB. Only HH:MM: put out on file in field 'TIM' )
     C                     TIME           MTIME
     C                     MOVE 'N'       DADI
     C                     Z-ADD0         PRI1
     C                     Z-ADD0         PRI2
     C                     Z-ADD0         PRI3
     C                     Z-ADD0         ICIN
     C********** SBRCD     IFEQ *BLANKS                                   S01117
     C           SBRCA     IFEQ *BLANKS                                   S01117
     C**********           MOVE DFBR      BRCD                            S01117
     C                     MOVE ZDBRN     BRCA                            S01117
     C                     ELSE
     C**********           MOVE SBRCD     BRCD                            S01117
     C                     MOVE SBRCA     BRCA                            S01117
     C                     END
      *
     C                     Z-ADDNATN      TNLU
     C                     WRITEDTRIXDF
     C                     ENDSR
      ********************************************************************
     C/COPY WNCPYSRC,DL1604IC08
      /EJECT
      *****************************************************************
      *                                                               *
      *  UMEMOS SR.    To update PF/MEMOS shadow postings file        *
      *                                                               *
      *****************************************************************
      *
     C           UMEMOS    BEGSR                           *** UMEMOS ****
      *
      **  SET UP WORK FIELDS
      *
     C*****      RUND      ADD  1         RANGE   50                      S01194
     C           BJRDNB    ADD  1         RANGE   50                      S01194
     C                     MOVE 'M'       XMOP    1
     C                     Z-ADDUPAMTX    UPAMT
     C                     MOVE SUICBS    UICBS
      *
      * Set up DSPF-work fields for ***MEMOS***
      *
     C***        SUBRTT    IFNE *BLANKS                                   S01157
     C           SRBRTT    IFNE *BLANKS                                   S01157
      *
     C***                  MOVE SUICFR    XICFR                           S01157
     C                     MOVE SRICFR    XICFR                           S01157
     C***                  MOVE SUIPFR    XIPFR                           S01157
     C                     MOVE SRIPFR    XIPFR                           S01157
      *
     C                     Z-ADDUICFDX    XICFD
     C***        SUICFR    IFNE *BLANKS                                   S01157
     C           SRICFR    IFNE *BLANKS                                   S01157
     C           UICFDX    ANDEQ0
     C***                  MOVE SUNICD    DATE                            S01157
     C                     MOVE SRNICD    DATE                            S01157
     C           *IN98     IFEQ '0'
     C                     MOVE DAY1      XICFD
     C                     ELSE
     C                     MOVE DAY2      XICFD
     C                     END
     C/COPY WNCPYSRC,DL1604IC64
     C                     END
      *
     C                     Z-ADDUIPFDX    XIPFD
     C***        SUIPFR    IFNE *BLANKS                                   S01157
     C           SRIPFR    IFNE *BLANKS                                   S01157
     C           UIPFDX    ANDEQ0
     C***                  MOVE SUNIPD    DATE                            S01157
     C                     MOVE SRNIPD    DATE                            S01157
     C           *IN98     IFEQ '0'
     C                     MOVE DAY1      XIPFD
     C                     ELSE
     C                     MOVE DAY2      XIPFD
     C                     END
     C/COPY WNCPYSRC,DL1604IC71
     C                     END
      *
     C                     ELSE
      *
     C***                  MOVE STICFR    XICFR                           S01157
     C                     MOVE SRICFR    XICFR                           S01157
     C***                  MOVE STIPFR    XIPFR                           S01157
     C                     MOVE SRIPFR    XIPFR                           S01157
      *
     C                     Z-ADDTICFDX    XICFD
     C***        STICFR    IFNE *BLANKS                                   S01157
     C           SRICFR    IFNE *BLANKS                                   S01157
     C           TICFDX    ANDEQ0
     C****                 MOVE STNICD    DATE                            S01157
     C                     MOVE SRNICD    DATE                            S01157
     C           *IN98     IFEQ '0'
     C                     MOVE DAY1      XICFD
     C                     ELSE
     C                     MOVE DAY2      XICFD
     C                     END
     C                     END
      *
     C                     Z-ADDTIPFDX    XIPFD
     C***        STIPFR    IFNE *BLANKS                                   S01157
     C           SRIPFR    IFNE *BLANKS                                   S01157
     C           TIPFDX    ANDEQ0
     C***                  MOVE STNIPD    DATE                            S01157
     C                     MOVE SRNIPD    DATE                            S01157
     C           *IN98     IFEQ '0'
     C                     MOVE DAY1      XIPFD
     C                     ELSE
     C                     MOVE DAY2      XIPFD
     C                     END
     C/COPY WNCPYSRC,DL1604IC65
     C                     END
     C                     END
      *
     C                     Z-ADD0         XCOMPL  10
     C                     Z-ADD0         XPAY    10
     C                     Z-ADD0         XREC    10
      * MEMOS BALANCES
     C                     Z-ADD0         MPAY   150
     C                     Z-ADD0         MREC   150
      /SPACE 2
      **   Process Our Details
      *~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C***        SUBRTT    IFNE *BLANKS                                   S01157
     C           SRBRTT    IFNE *BLANKS                                   S01157
     C           UEINRX    ANDEQ0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Process THEIR Details
      *~~~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C***        STBRTT    IFNE *BLANKS                                   S01157
     C           SRBRTT    IFNE *BLANKS                                   S01157
     C           TEINRX    ANDEQ0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Calculate interest & update shadow balances until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      *
      /SPACE 2
      **   Only process Details if instructions settled through
      **   a retail account,
      **
     C                     MOVE '00'      WSETM   2
     C**********           MOVE *BLANKS   WBNKAC 12                                           CGL029
     C                     MOVE *BLANKS   WBNKAC 18                                           CGL029
     C**********           Z-ADDCNUMX     DCNUM                                               CSD027
     C                     MOVE CNUMX     DCNUM                                               CSD027
     C***********          MOVE SUCUCY    DDCCY                           CEU003
     C                     MOVE WSTCY     DDCCY                           CEU003
      *
     C           XREC      IFEQ 1                          RECEIPTS
      *
     C* MOVE RECEIVE BRANCH CODE TO WORK FIELD FOR CHAIN TO 'ACCNT'       S01117
     C*                                                                   S01117
     C                     MOVE ROBR      @@BRCA  3                       S01117
     C*                                                                   S01117
     C           SRSETM    IFNE *BLANKS
     C                     MOVE SRSETM    WSETM
     C                     END
     C           SRSETM    IFEQ '05'
     C                     MOVELURACCX    WBNKAC
     C                     ELSE
     C                     MOVELSURACC    WBNKAC
     C                     END
     C                     END
      /SPACE 2
     C           XPAY      IFEQ 1                          PAYMENTS
      **
     C* MOVE PAYMENT BRANCH CODE TO WORK FIELD FOR CHAIN TO 'ACCNT'       S01117
     C*                                                                   S01117
     C                     MOVE POBR      WWBRCA                          S01117
     C*                                                                   S01117
     C           SPSETM    IFNE *BLANKS
     C                     MOVE SPSETM    DSETM
     C                     END
      *
      *
     C           SPSETM    IFEQ '05'
     C                     MOVELUPACCX    DBNKAC
     C                     ELSE
     C                     MOVELSUPACC    DBNKAC
     C                     END
      *
      ** If BOTH Pay & Rec settl.instructions are the same,
      **  process both at one access to MEMOS file.
      *                                                    SETTL METHOD
     C           DSETM     IFEQ WSETM                      PAY = REC
     C           DBNKAC    ANDEQWBNKAC
     C           WWBRCA    ANDEQ@@BRCA                                    S01117
     C                     ADD  MREC      MPAY
     C                     Z-ADD0         XREC             ONE ACCESS ONLY
     C                     END
      **
     C                     EXSR TSTRTL
      *
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******IFGT 0                                         CCB002
      *                                                                   CCB002
      *****Access*PF/MEMOS*record                                         CCB002
     C***********RRNM******CHAINMEMOS                86                   CCB002
      *****End*if**detail*record not found                                CCB002
     C************IN86*****IFEQ '1'                                       CCB002
     C***********RECI******ORNE 'D'                                       CCB002
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '16'      DBASE            ***************S01194
     C**********           MOVE 'MEMOS'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELRRNM      DBKEY            *      16     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C*                                                                   S01194
     C*********************MOVE '016'     DBASE            *********S01194CCB002
     C*********************MOVE 'MEMOS'   DBFILE           *   DBERRS01194CCB002
     C*********************MOVELRRNM      DBKEY            *      16S01194CCB002
     C*********************MOVE '*KEY   ' DBOPTN           *********S01194CCB002
     C*********************EXSR *PSSR                               S01194CCB002
     C*********************END                                            CCB002
      *                                                                   CCB002
      ** If account is retail                                             CCB002
      *                                                                   CCB002
     C           WRETL     IFEQ 'Y'                                       CCB002
      *
      **   Update shadow balances record
      *
     C*********************ADD  MPAY      LDBLN                           CCB002
     C*********************ADD  MPAY      CLBLN                           CCB002
     C                     Z-ADDMPAY      #PAMT  150                      CCB002
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD  7        I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO 100       O:Retail A/C NoCCB002
     C**********           PARM WCNUM     W0CNUM  60       O:Customer No.              CCB002 CSD027
     C                     PARM WCNUM     W0CNUM  6        O:Customer No.                     CSD027
     C                     PARM WCCY      W0CCY   3        O:Currency     CCB002
     C**********           PARM WACOD     W0ACOD  40       O:Account Code              CCB002 CGL029
     C                     PARM WACOD     W0ACOD 100                                          CGL029
     C                     PARM WACSQ     W0ACSQ  20       O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA  3        O:Branch       CCB002
     C                     PARM PTDT      W0PSTD  50       O:Posting date CCB002
     C                     PARM VUDT      W0VDAT  50       O:Value date   CCB002
     C                     PARM #PAMT     W0AMT  150       O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV  1        O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '16'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 16 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604IC85
     C*                                                                   S01154
     C* If not a nostro account then output posting details to RSACMTPD   S01154
     C*                                                                   S01154
     C           WNOST     IFEQ 'N'                                       S01154
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    S01154
     C                     END                                            S01154
     C*                                                                   S01154
     C                     END
     C                     END
      /SPACE 2
     C           XREC      IFEQ 1                          RECEIPTS
      **
     C                     MOVE WSETM     DSETM
     C                     MOVELWBNKAC    DBNKAC
     C                     MOVE @@BRCA    WWBRCA
     C                     EXSR TSTRTL
      *
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******IFGT 0                                         CCB002
      *                                                                   CCB002
      *****Access*PF/MEMOS*record                                         CCB002
      *                                                                   CCB002
     C***********RRNM******CHAINMEMOS                86                   CCB002
      *****End*if**detail*record not found                                CCB002
     C************IN86*****IFEQ '1'                                       CCB002
     C***********RECI******ORNE 'D'                                       CCB002
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '17'      DBASE            ***************S01194
     C**********           MOVE 'MEMOS'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELRRNM      DBKEY            *      17     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C*                                                                   S01194
     C*********************MOVE '017'     DBASE            *********S01194CCB002
     C*********************MOVE 'MEMOS'   DBFILE           *   DBERRS01194CCB002
     C*********************MOVELRRNM      DBKEY            *      17S01194CCB002
     C*********************MOVE '*KEY   ' DBOPTN           *********S01194CCB002
     C*********************EXSR *PSSR                               S01194CCB002
     C*********************END                                            CCB002
      *                                                                   CCB002
      ** If account is retail                                             CCB002
      *                                                                   CCB002
     C           WRETL     IFEQ 'Y'                                       CCB002
      *
      **   Update shadow balances record
     C*********************ADD  MREC      LDBLN                           CCB002
     C*********************ADD  MREC      CLBLN                           CCB002
     C                     Z-ADDMREC      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM WCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM WCCY      W0CCY            O:Currency     CCB002
     C                     PARM WACOD     W0ACOD           O:Account Code CCB002
     C                     PARM WACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '17'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 17 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604IC86
     C*                                                                   S01154
     C* If not a nostro account then output posting details to RSACMTPD   S01154
     C*                                                                   S01154
     C           WNOST     IFEQ 'N'                                       S01154
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    S01154
     C                     END                                            S01154
     C*                                                                   S01154
     C                     END
     C                     END
      *
     C**********           Z-ADDCNUMX     CNUM                                                CSD027
     C                     MOVE CNUMX     CNUM                                                CSD027
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UOLPOS SR.    To update LF/OLPOS on line positions file      *
      *                                                               *
      *****************************************************************
      *
     C           UOLPOS    BEGSR                           *** UOLPOS ****
      **
      *
      **   Access Olpos record
      **   Only process Details if a record is found
      *
     C           OLKEY     KLIST
     C                     KFLD           BRCA                            S01117
     C***********          KFLD           UCUCY                           CEU003
     C                     KFLD           WSTCY                           CEU003
     C                     KFLD           OLPNO   20
      *
     C                     MOVE '02'      OLPNO
     C           OLKEY     CHAINOLPOS                86
      *
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
      *    Release PF/OLPOSOA record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELOL
     C                     MOVE '1'       *IN86
     C                     END
     C                     END
      /SPACE 4
      **  SET UP WORK FIELDS
      *
     C           *IN86     IFEQ '0'
      *
     C                     MOVE 'O'       XMOP
      *
     C           MDAT      ADD  1         RANGE
     C                     Z-ADD0         XCOMPL  10
     C*                                                                   S01117
     C* Store BRCA in temporary work field to prevent possible            S01117
     C* corruption in OUTPOS SR                                           S01117
     C*                                                                   S01117
     C                     MOVE BRCA      ##BRCA  3                       S01117
      /SPACE 2
      **   Process Our Details
      *~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C                     TESTB'0'       UDNSI          85
     C           *IN85     IFEQ '0'
     C           UBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Process Their Details
      *~~~~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C                     TESTB'0'       TDNSI          85
     C           *IN85     IFEQ '0'
     C           TBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Calculate interest & update shadow balances until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      /SPACE 2
      **   Update on line positions record
     C           XPAY      IFEQ 1
     C           XREC      OREQ 1
      *
     C                     Z-ADDNATN      TNLU
     C                     MOVE ##BRCA    BRCA                            S01117
     C                     UPDATOLPOSOAF
      **
     C                     END
     C                     END
      **
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPRONO SR.    To update LF/PRONO projected nostros file      *
      *                                                               *
      *****************************************************************
      *
     C           UPRONO    BEGSR                           *** UPRONO ****
      *
     C           PRKEY     KLIST
     C***********          KFLD           UCUCY                           CEU003
     C                     KFLD           WSTCY                           CEU003
     C                     KFLD           PRNNO   20
      *
     C                     MOVE 'P'       XMOP
      *
     C                     Z-ADD0         XCOMPL  10
     C                     Z-ADD0         PPAY
     C                     Z-ADD0         PREC
     C                     MOVE ' '       @PNOST  1                       E20928
     C                     MOVE ' '       @RNOST  1                       E20928
      *
     C                     Z-ADD0         RANGE
     C**********           MOVE *BLANKS   XUPACC 12                                           CGL029
     C**********           MOVE *BLANKS   XURACC 12                                           CGL029
     C                     MOVE *BLANKS   XUPACC 18                                           CGL029
     C                     MOVE *BLANKS   XURACC 18                                           CGL029
      *
      **   Process if payment, or receipt settled through a nostro
      *
     C           PSETM     IFEQ 01
     C           PSETM     OREQ 02
     C           PSETM     OREQ 07
     C           PSETM     OREQ 08
     C           PSETM     OREQ 12
      *                                                     PAYMENT
     C**  Set @PNOST to Yes to indicate nostro on Pay side                E20928
     C                     MOVE 'Y'       @PNOST  1                       E20928
     C*                                                                   E20928
     C                     MOVELUPACC     PRNNO
     C           PRKEY     CHAINPRONO                86
      *
      **   If record not found, use 'unallocated' code
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD0         PRNNO
     C           PRKEY     CHAINPRONO                86
     C                     END
      *
     C           *IN86     IFNE '1'
     C           RECI      ANDEQ'D'
      *
      *   Range End Date is up to the 6th working day
     C           PDAT,5    ADD  1         ZDAYNO
     C***********          MOVE UCUCY     ZCCY                            CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C******************** MOVE 'Y'       ZOPT                            S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C*                                                                   S01195
     C* SETTLEMENT THROUGH A NOSTRO SO SET ZLOC TO NOSTRO LOCATION        S01195
     C*                                                                   S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
      *    Save the value of the 6th working day
     C                     Z-ADDZDYNBR    RANGE
     C                     MOVELPRNNO     XUPACC
     C                     END
      *
      *    Release PF/PRONOPN record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
     C                     END
      /SPACE 2
     C           RSETM     IFEQ 01
     C           RSETM     OREQ 02
     C           RSETM     OREQ 07
     C           RSETM     OREQ 08
     C           RSETM     OREQ 12
      *                                                     RECEIPT
     C**  Set @RNOST to Yes to indicate nostro on Receive side            E20928
     C                     MOVE 'Y'       @RNOST  1                       E20928
     C*                                                                   E20928
     C                     MOVELURACC     PRNNO
     C           PRKEY     CHAINPRONO                86
      *
      **   If record not found, use 'unallocated' code
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD0         PRNNO
     C           PRKEY     CHAINPRONO                86
     C                     END
      *
     C           *IN86     IFNE '1'
     C           RECI      ANDEQ'D'
      *
      *   Range End Date is up to the 6th working day
     C           RANGE     IFEQ 0
     C           PDAT,5    ADD  1         ZDAYNO
     C***********          MOVE UCUCY     ZCCY                            CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C******************** MOVE 'Y'       ZOPT                            S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C*                                                                   S01195
     C* SETTLEMENT THROUGH A NOSTRO SO SET ZLOC TO NOSTRO LOCATION        S01195
     C*                                                                   S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
      *    Save the value of the 6th working day
     C                     Z-ADDZDYNBR    RANGE   50
     C                     END
     C                     MOVELPRNNO     XURACC
     C                     END
      *
      *    Release PF/PRONOPN record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
     C                     END
      *
      * NOT A NOSTRO - IGNORE
      *
     C           RANGE     IFNE 0
      *
     C           RANGE     IFGT MDAT
     C           MDAT      ADD  1         RANGE
     C                     END
      /EJECT
      *
      **   OUR details
      *   ~~~~~~~~~~~~~~
      **   Process if floating rate present
      *
     C                     TESTB'0'       UDNSI          85
     C           *IN85     IFEQ '0'
     C           UBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   THEIR details
      *   ~~~~~~~~~~~~~~~~
      **   Process if floating rate present
      *
     C                     TESTB'0'       TDNSI          85
     C           *IN85     IFEQ '0'
     C           TBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Calculate interest & update PROJECTED NOSTRO BALANCES until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      /SPACE 4
      **   Update projected nostros
      *                                                     PAYMENT
     C           XUPACC    IFEQ XURACC                      *EQ RECEIPT
     C           XUPACC    ANDNE*BLANKS
     C           XPAY      ANDNE0
     C                     ADD  PREC      PPAY
     C                     Z-ADD0         XREC
     C                     END
      *
      **   Access Prono record
      *                                                     PAYMENT
     C           XPAY      IFNE 0
     C           XUPACC    ANDNE*BLANKS
     C                     MOVELXUPACC    PRNNO
     C           PRKEY     CHAINPRONO                86
      *
     C           *IN86     IFEQ '0'
     C           RECI      ANDEQ'D'
      /EJECT
      *
      **   Update projected nostros record
     C                     ADD  PPAY      PBAL
      *
     C                     Z-ADDNATN      TNLU
     C                     UPDATPRONOPNF
     C                     END
     C                     END
      *
      *                                                     RECEIPT
     C           XREC      IFNE 0
     C           XURACC    ANDNE*BLANKS
     C                     MOVELXURACC    PRNNO
     C           PRKEY     CHAINPRONO                86
      *
     C           *IN86     IFEQ '0'
     C           RECI      ANDEQ'D'
      *
      **   Update projected nostros record
     C                     ADD  PREC      PBAL
      *
     C                     Z-ADDNATN      TNLU
     C                     UPDATPRONOPNF
     C                     END
     C                     END
      *
     C                     END
      **
     C                     ENDSR
      *
      ********************************************************************S01154
      /EJECT                                                              S01154
      *****************************************************************   S01154
      *                                                               *   S01154
      *  OUTPOS SR.    Output posting details to RSACMTPD.            *   S01154
      *                                                               *   S01154
      *****************************************************************   S01154
      *                                                                   S01154
     C           OUTPOS    BEGSR                           *** OUTPOS ****S01154
      *                                                                   E20928
      **   Only write a record if the amount is not zero                  E20928
     C           MVAM      IFNE *ZEROS                                    E20918
     C**********                                                   S01154 S01194
     C*****Retrieve*currency*nostro*record*from*'TABDLI'********** S01154 S01194
     C***********WNOST*****IFNE 'N'                                S01154 E20928
     C**********           MOVEL'70'      KEY                      S01154 S01194
     C**********           MOVELUCUCY     WRK5                     S01154 S01194
     C**********           MOVELPRNNO     WRK2                     S01154 S01194
     C********** KEY       CHAINTABDLI               85            S01154 S01194
     C*  XMOP says that either OLPOS, PRONO or MEMOS being processed -    E20928
     C*  if this routine called from UMEMOS (XMOP=M) then account is      E20928
     C*  not a nostro (retail only) so do not call AONOSTR0; if this      E20928
     C*  routine called from MOPSR and XMOP=P then account is a nostro    E20928
     C*  (might be retail also) and file should be accessed.              E20928
     C           XMOP      IFEQ 'P'                                       E20928
     C                     MOVELPRNNO     @NOST                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO RETRIEVE CURRENCY NOSTRO RECORD            S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C***********          PARM UCUCY     @CCY    3        CurrencyS01194 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM           @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01154
     C********** MVAM      IFNE *ZEROS                             S01154 E20918
     C**********************                                       S01154 E20928
     C*****Only*write*a*record if the amount is                    S01154 E20928
     C*****not*zero*********                                       S01154 E20928
     C**********************                                       S01154 E20928
     C*****      *IN85     IFNE '1'                                S01154 S01194
     C*****      RECI      ANDEQ'D'                                S01154 S01194
     C**********************                                       S01154 E20928
     C**********************                                       S01154 E20928
     C******Use*fields*from*table*file*to*shadow*post**********    S01154 S01194
     C******************** MOVE CNUM      CUSN                     S01154 S01194
     C******************** MOVE CCY       CCYD                     S01154 S01194
     C******************** MOVE ACOD      ACDE                     S01154 S01194
     C******************** MOVE ACSQ      ASNC                     S01154 S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C* Use fields from SDNOST to Shadow Post.                     S01154 S01194
     C                     MOVE A7CUST    CUSN                     S01154 S01194
     C                     MOVE A7CYCD    CCYD                     S01154 S01194
     C                     MOVE A7ACCD    ACDE                     S01154 S01194
     C                     MOVE A7ACSN    ASNC                     S01154 S01194
     C                     MOVE A7BRCD    BRCA                            S01117
      *                                                                   S01154
     C                     ELSE                                           S01154
      *                                                                   S01154
      *  Else initialise account keys of unallocated nostros.             S01154
      *                                                                   S01154
      *                                                                   S01154
     C**********           Z-ADD*ZEROS    CUSN                                         S01154 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C***********          MOVE UCUCY     CCYD                     S01154 CEU003
     C                     MOVE WSTCY     CCYD                            CEU003
     C                     Z-ADD*ZEROS    ACDE                            S01154
     C                     Z-ADD*ZEROS    ASNC                            S01154
     C                     MOVE *BLANKS   BRCA                            S01154
      *                                                                   S01154
     C                     END                                            S01154
      *                                                                   S01154
     C                     END                                            E20918
      *                                                                   S01154
      ** If CRE009 is ON and the account is RE, set the posting date      CRE009
      ** to the same value of the value date when this one is not less    CRE009
      ** than the run date.                                               CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
      *                                                                   CRE009
      ** Determine if account is REtail                                   CRE009
      *                                                                   CRE009
     C                     MOVE *BLANKS   @RET    1                       CRE009
     C           XMOP      IFEQ 'M'                                       CRE009
     C                     MOVE 'Y'       @RET                            CRE009
     C                     ELSE                                           CRE009
     C                     MOVE CUSN      WCNUM                           CRE009
     C                     MOVE CCYD      WCCY                            CRE009
     C                     MOVE ACDE      WACOD                           CRE009
     C                     MOVE ASNC      WACSQ                           CRE009
     C                     MOVE BRCA      WWBRCA                          CRE009
     C           ACCKEY    CHAINACCNT                85                   CRE009
     C           *IN85     IFEQ *OFF                                      CRE009
     C           ATYP      ANDEQ'R'                                       CRE009
     C                     MOVE 'R'       @RET                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C           @RET      IFEQ 'Y'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  S01154
     C/COPY WNCPYSRC,DL1604IC87
     C                     Z-ADD0         MVAM                            S01154
      *                                                                   S01154
     C                     END                                            S01154
      *                                                                   S01154
     C**********           END                                     S01154 E20918
      *                                                                   S01154
     C           OUTEND    ENDSR                                          S01154
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  MOPSR  SR.    Accumulate Interest Due for M/O/P balances'    *
      *                update.                                        *
      *                                                               *
      *****************************************************************
      *
     C           MOPSR     BEGSR
      *
      * Set up work fields
      *
     C                     Z-ADD0         XICSD   50       Calcs STRT date
     C                     Z-ADDRANGE     XICED   50       Calcs end date
     C                     MOVE ' '       XXPAY   1        U/T (Our/Thr)
     C                     Z-ADD0         XPAY    10       Payment made
     C                     Z-ADD0         XREC    10       Payment made
     C                     Z-ADD0         XRRAT  117       Reimb. rate
     C                     Z-ADD0         XTRAT  117       Top-up rate
     C                     Z-ADD0         XUINTD 130       Our Accr Intr
     C                     Z-ADD0         XTINTD 130       Thr Accr Intr
     C                     MOVE 'N'       WRTFL   1                       CIR005
      *
      **   Set Initial MOPSR  FIELDS
      *
     C           XMOP      IFEQ 'M'                               MEMOS
     C                     Z-ADDMDATX     XMDAT
     C***                  MOVE SUBRTT    XBRTT                           S01157
     C                     MOVE SRBRTT    XBRTT                           S01157
     C                     Z-ADDFLRATX    XFLRAT                          E23018
     C                     Z-ADDCLRATX    XCLRAT                          E23018
     C***        SUNII     IFNE 'Y'                                       S01157
     C***                  Z-ADDFLRATX    XFLRAT                          S01157
     C***                  Z-ADDCLRATX    XCLRAT                          S01157
     C***                  ELSE                            NEG. INTR.     S01157
     C***                  Z-SUBFLRATX    XFLRAT                          S01157
     C***                  Z-SUBCLRATX    XCLRAT                          S01157
     C***                  END                                            S01157
     C           XBRTT     IFNE 0                                         S01157
     C                     Z-ADDUEINRX    XEINR
     C****                 Z-ADDURTSPX    XRTSP                           S01157
     C                     Z-ADD@RTSPX    XRTSP                           S01157
     C****                 Z-ADDUINFDX    XINFD                           S01157
     C                     Z-ADD@INFDX    XINFD                           S01157
     C***                  MOVE SUSPIN    XSPIN                           S01157
     C                     MOVE SRSPIN    XSPIN                           S01157
     C****                 Z-ADDUNICDX    XNICD                           S01157
     C                     Z-ADD@NICDX    XNICD                           S01157
     C***********          Z-ADDUNIPDX    XNIPD                           E23018
     C                     Z-ADD@NIPDX    XNIPD                           E23018
     C****                 Z-ADDUNICDX    XICBD                           S01157
     C                     Z-ADD@NICDX    XICBD                           S01157
     C***********          Z-ADDUNIPDX    XIPBD                           E23018
     C                     Z-ADD@NIPDX    XIPBD                           E23018
     C                     ELSE
     C                     Z-ADDTEINRX    XEINR
     C****                 Z-ADDTRTSPX    XRTSP                           S01157
     C                     Z-ADD@RTSPX    XRTSP                           S01157
     C****                 Z-ADDTINFDX    XINFD                           S01157
     C                     Z-ADD@INFDX    XINFD                           S01157
     C*****                MOVE STSPIN    XSPIN                           S01157
     C                     MOVE SRSPIN    XSPIN                           S01157
     C****                 Z-ADDTNICDX    XNICD                           S01157
     C                     Z-ADD@NICDX    XNICD                           S01157
     C****                 Z-ADDTNIPDX    XNIPD                           S01157
     C                     Z-ADD@NIPDX    XNIPD                           S01157
     C****                 Z-ADDTNICDX    XICBD                           S01157
     C                     Z-ADD@NICDX    XICBD                           S01157
     C****                 Z-ADDTNIPDX    XIPBD                           S01157
     C                     Z-ADD@NIPDX    XIPBD                           S01157
     C                     END
     C                     END
      *
     C           XMOP      IFNE 'M'                            OLPOS/PRONO
     C                     Z-ADDMDAT      XMDAT   50
     C                     Z-ADDUBRTT     XBRTT   20
     C                     Z-ADDFLRAT     XFLRAT 117
     C                     Z-ADDCLRAT     XCLRAT 117
     C           XBRTT     IFNE 0
     C                     Z-ADDUEINR     XEINR  117
     C                     Z-ADDURTSP     XRTSP  117
     C                     MOVE USPIN     XSPIN   1
     C                     Z-ADDUBRTE     XBRTE  117
     C                     Z-ADDUINFD     XINFD   50
     C                     Z-ADDUNICD     XNICD   50
     C                     Z-ADDUNIPD     XNIPD   50
     C                     MOVE UICFR     XICFR   1
     C                     MOVE UIPFR     XIPFR   1
     C                     Z-ADDUICFD     XICFD   20
     C                     Z-ADDUIPFD     XIPFD   20
     C                     Z-ADDUICBD     XICBD   50
     C                     Z-ADDUIPBD     XIPBD   50
     C                     ELSE
     C                     Z-ADDTEINR     XEINR
     C                     Z-ADDTRTSP     XRTSP
     C                     MOVE TSPIN     XSPIN
     C                     Z-ADDTBRTE     XBRTE
     C                     Z-ADDTINFD     XINFD
     C                     Z-ADDTNICD     XNICD
     C                     Z-ADDTNIPD     XNIPD
     C                     MOVE TICFR     XICFR
     C                     MOVE TIPFR     XIPFR
     C                     Z-ADDTICFD     XICFD
     C                     Z-ADDTIPFD     XIPFD
     C                     Z-ADDTICBD     XICBD   50
     C                     Z-ADDTIPBD     XIPBD   50
     C                     END
     C                     END
      *                                          Accrued Interest To Date
      *
     C                     Z-ADDVDATX     XUICSD  50       Accr To date
     C                     Z-ADDVDATX     XTICSD  50        "   "   "
      *
      **   Set Initial Next Interest Payment Date
      *
     C           XNICD     IFEQ 0
     C                     Z-ADDXMDAT     XNICD
     C                     END
      *
     C           XNIPD     IFEQ 0
     C           XNICD     ANDNE0
     C                     Z-ADDXNICD     XNIPD
     C                     Z-ADDXICBD     XIPBD
     C                     MOVE XICFR     XIPFR
     C                     Z-ADDXICFD     XIPFD
     C                     MOVE 'Y'       WRTFL                           CIR005
     C                     END
      *
      **   Process ONLY if Next Interest Payment Date LE RANGE
      *
     C           XNIPD     IFGE RANGE
     C                     Z-ADDXNIPD     XNICD
     C                     END
      *
      **   Set Interest Calculation  End Date
      *
     C           XNIPD     IFGT XNICD
     C                     Z-ADDXNICD     XICED
     C                     ELSE
     C                     Z-ADDXNIPD     XICED
     C                     END
      *                                                                   CIR005
     C                     Z-ADDXICED     WXCED   50                      CIR005
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C                     Z-ADDXIPBD     WXCED                           CIR005
     C                     ENDIF                                          CIR005
      /SPACE 5
      **   Calculate interest & update shadow balances until
      **   ALL PAYMENT BALANCES UPDATED.
      *
      /SPACE 2
     C           XICED     DOWLTRANGE                      <<<< LOOP >>>>
      *          ====================
      /SPACE 2
     C                     Z-ADDRANGE     WNIPD   50
     C                     Z-ADD0         WINTD  130
     C                     MOVE ' '       WPR     1        P/R (Pay/Rec)
      *
      ** Determine which side is to PAY.
      ** (initial calcs and after each rate change date)
      *
     C           XXPAY     IFEQ ' '
      *                                           Their Rate *GT  ceiling
     C***        XBRTT     IFEQ 0                          & Neg Intr.    S01157
     C***        XEINR     ANDGTXCLRAT                                    S01157
     C***        SUNII     ANDEQ'Y'                                       S01157
      ****                                        Our Rate   *LT  floor   S01157
     C***        XBRTT     ORNE 0                          & Neg Intr     S01157
     C***        XEINR     ANDLTXFLRAT                                    S01157
     C***        SUNII     ANDEQ'Y'                                       S01157
      *                                           Our Rate   *GT  ceiling
     C****       XBRTT     ORNE 0                                         S01157
     C****       XBRTT     IFNE 0                                         S01157
     C****       XEINR     ANDGTXCLRAT                                    S01157
     C***        SUNII     ANDNE'Y'                                       S01157
      *                                           Their Rate *LT  floor
     C***        XBRTT     OREQ 0                                         S01157
     C***        XEINR     ANDLTXFLRAT                                    S01157
     C****       SUNII     ANDNE'Y'                                       S01157
      *
     C***                  MOVE 'U'       XXPAY            We pay         S01157
     C***                  ELSE                                           S01157
     C***                  MOVE 'T'       XXPAY            They pay       S01157
     C***                  END                                            S01157
     C**  E20918 - Setting up XXPAY                                       E20918
     C**           Seller of 'RP' and 'RR' responsible for interest       E20918
     C**           over the ceiling.                                      E20918
     C**           Buyer of 'RR' responsible for interest below the       E20918
     C**           floor.                                                 E20918
     C**           Seller of 'RF' responsible for interest below the      E20918
     C**           floor.                                                 E20918
     C**           In those instances where the market rate is between    E20918
     C**           the ceiling and floor rates neither party is under     E20918
     C**           any obligation to the other.                           E20918
     C*                                                                   E20918
     C           XEINR     IFGT XCLRAT                     B**3           E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RP'                       B***4          E20918
     C           NEWDT     OREQ 'RR'                       B***4          E20918
     C*                                                                   E20918
     C***********BYSL      IFEQ 'S'                        B****5  E20918 E23018
     C           SBYSL     IFEQ 'S'                        B****5         E23018
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C                     END                             E**3           E20918
     C*                                                                   E20918
     C           XEINR     IFLT XFLRAT                     B**3           E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RF'                       B***4          E20918
     C*                                                                   E20918
     C***********BYSL      IFEQ 'S'                        B****5  E20918 E23018
     C           SBYSL     IFEQ 'S'                        B****5         E23018
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RR'                       B***4          E20918
     C*                                                                   E20918
     C***********BYSL      IFEQ 'B'                        B****5  E20918 E23018
     C           SBYSL     IFEQ 'B'                        B****5         E23018
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C*                                                                   E20918
     C                     END                             E**3           E20918
      *
      ** Determine the Interest Rate to be used.
      *
     C                     Z-ADD0         XRRAT
     C                     Z-ADD0         XTRAT
      *
     C           XXPAY     IFNE ' '
      *                                             Reimbursement Rate
     C           XEINR     IFGT XCLRAT
     C           XEINR     SUB  XCLRAT    XRRAT
     C                     END
      *                                             Topping Up Rate
     C           XEINR     IFLT XFLRAT
     C           SFLRAT    ANDNE*BLANKS
     C           XFLRAT    SUB  XEINR     XTRAT
     C                     END
     C                     END
     C*                                                                   E20918
     C           XRRAT     IFNE 0                                         E20918
     C                     Z-ADDXRRAT     ZIRATE                          E20918
     C                     ELSE                                           E20918
     C                     Z-ADDXTRAT     ZIRATE                          E20918
     C                     END                                            E20918
      *
      * Select OUR details
      *
     C           XXPAY     IFEQ 'U'
      *
     C                     Z-ADDXUICSD    XICSD
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****       XBRTT     ANDEQ0                                         S01157
      ****                                                                S01157
     C****       SUNII     ORNE 'Y'                                       S01157
     C***        XBRTT     ANDNE0                                         S01157
     C****       XBRTT     IFNE 0                                         S01157
      *
     C***                  Z-ADDXRRAT     ZIRATE                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDXTRAT     ZIRATE                          S01157
     C***                  END                                            S01157
      *
     C                     END                                            S01157
      *
      * Select THEIR details
      *
     C           XXPAY     IFEQ 'T'
      *
     C                     Z-ADDXTICSD    XICSD
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***        XBRTT     ANDEQ0                                         S01157
      ***                                                                 S01157
     C***        SUNII     ORNE 'Y'                                       S01157
     C****       XBRTT     ANDNE0                                         S01157
     C***        XBRTT     IFNE 0                                         S01157
      *
     C***                  Z-ADDXTRAT     ZIRATE                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDXRRAT     ZIRATE                          S01157
     C***                  END                                            S01157
     C                     END                                            S01157
     C                     END
      /EJECT
      *
      **   Calculate Interest using Effective Interest Rate between
      **   Interest Calculation Start & End Date via GLINTC
      **   ( = Interest Calculated )
      *
     C                     Z-ADDXICSD     ZIBEG
     C                     Z-ADDXICED     ZIEND
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C                     Z-ADDXIPBD     ZIEND                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDUICBS     ZICALC
     C                     Z-ADDUPAMT     ZIAMT
     C/COPY WNCPYSRC,DL1604IC60
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL1604IC61
     C                     Z-ADDZINTR     WINTD     H
      *
     C           XXPAY     IFEQ 'U'
     C                     ADD  WINTD     XUINTD
     C                     ELSE
     C                     ADD  WINTD     XTINTD
     C                     END
     C                     Z-ADD0         WINTD
      /SPACE 4
      **   Update Balances For This Interest Payment Date
      **   ------------------------------------------------
      *
     C           XNIPD     IFLE XNICD
      *
      * Calculate tax for OUR payment
     C           XUINTD    IFNE 0
     C           STAXI     ANDEQ'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP   54                      S01194
     C           BNHKTR    DIV  100       TAXRP   54                      S01194
     C           XUINTD    MULT TAXRP     INTTAX 130H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
     C                     SUB  INTTAX    XUINTD
      *
      **  Calculate Net Interest Amount Due
     C           XUINTD    IFGE XTINTD
     C           XUINTD    SUB  XTINTD    WINTD
     C                     MOVE 'P'       WPR
     C                     ELSE
     C           XTINTD    SUB  XUINTD    WINTD
     C                     MOVE 'R'       WPR
     C                     END
     C                     Z-ADDXNIPD     WNIPD
     C                     Z-ADD0         XUINTD
     C                     Z-ADD0         XTINTD
     C                     END
      /EJECT
      **   UPDATE BALANCES   --  WITHIN RANGE SPECIFIED
      * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C           WINTD     IFNE 0
     C           WNIPD     ANDLTRANGE
      *                                                                   CEU003
      ** Convert interest amount WINTD to effective-settlement-currency   CEU003
      ** -workfield value via conversion program EU0200.                  CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           WSTCY     ANDNESUCUCY                                    CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM *BLANKS   P@RTCD  7                       CEU003
     C                     PARM WINTD     P@FRAM 183                      CEU003
     C                     PARM SUCUCY    P@FRCY  3                       CEU003
     C                     PARM WSTCY     P@TOCY  3                       CEU003
     C                     PARM *ZEROS    P@OUTA 150                      CEU003
     C                     PARM *ZEROS    P@INTA 183                      CEU003
     C                     PARM *ZEROS    P@EXRT 159                      CEU003
     C                     PARM *BLANKS   P@MDIN  1                       CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     Z-ADDP@OUTA    WINTD                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVEL'EU0200  'DBFILE                          CEU003
     C                     Z-ADD28        DBASE                           CEU003
     C                     MOVEL'CEU003'  DBKEY                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *********************
      **** M E M O S ******
      *********************
      *
     C           XMOP      IFEQ 'M'
     C*****      WNIPD     ANDEQRUND                                      S01194
     C           WNIPD     ANDEQBJRDNB                                    S01194
     C*                                                                   S01154
     C**  Move VDAT and PDAT to shadow post later                         S01154
     C*                                                                   S01154
     C*****                Z-ADDRUND      PTDT                     S01154 S01194
     C                     Z-ADDBJRDNB    PTDT                            S01194
     C                     Z-ADDWNIPD     VUDT                            S01154
      * TO add NEW payments
     C           WPR       IFEQ 'P'                        PAYMENTS
     C                     SUB  WINTD     MPAY
      *  To indicate that the amount is credit.                           S01154
      *                                                                   S01154
     C                     Z-ADD1         DORC                            S01154
     C                     END
      * TO add NEW receipts
     C           WPR       IFEQ 'R'                        RECEIPTS
     C                     ADD  WINTD     MREC
      *  To indicate that the amount is debit.                            S01154
      *                                                                   S01154
     C                     Z-ADD0         DORC                            S01154
     C                     END
      * Shadow post amount to RSACMTPD.                                   S01154
      *                                                                   S01154
     C                     Z-ADDWINTD     MVAM                            S01154
     C                     END
      *
      *********************
      **** O L P O S ******
      *********************
      *
     C           XMOP      IFEQ 'O'
      **
      **   Interest Due Amounts are applied to the on line position
      **   balance whose occurrence is the greatest of the 16 dates
      **   which is less than, or equal to, the event date
      **   ( i.e. Next Interest Payment Date )
      *    NB..
      **   If event is earlier than the first of the 16th dates,
      **      use the first date
      **   If event is on or after the 16th date,
      **      use the 16th date ( Catchall )
     C                     Z-ADD1         P       20
      *
     C           WNIPD     IFGT ODAT,1
     C           WNIPD     IFGE ODAT,16
     C                     Z-ADD16        P
     C                     ELSE
     C           WNIPD     LOKUPODAT,P                 8585
     C                     END
     C                     END
      ** ADJUST the OUTGOING Balances
     C           WPR       IFEQ 'P'                        >>> Payment
     C                     ADD  WINTD     OBLO,P
      ** ADJUST the INCOMING Balances
     C                     ELSE                            >>> Receipt
     C                     ADD  WINTD     OBLI,P
     C                     END
     C                     END
      *
      *********************
      **** P R O N O ******
      *********************
      *
     C           XMOP      IFEQ 'P'
      *
      **   Interest Due Amounts are applied to the projected nostro
      **   balances whose occurrence matches the projected nostro dates
      **   which are GE the Event Date ( Next Interest Payment Date )
      *    NB..
      **   If event is earlier than the first of the 5 dates,
      **      use from the first date
      **   If event is after the 5th date, but before the 6th
      **      use the 5th date
      **   ( NB  Dates GE 6th date excluded in above validation )
     C                     Z-ADD1         X       10
      *
     C           WNIPD     IFGT PDAT,1
     C           WNIPD     IFGE PDAT,5
     C                     Z-ADD5         X
     C                     ELSE
     C           WNIPD     LOKUPPDAT,X                 8585
     C                     END
     C                     END
     C*                                                                   S01154
     C**  Move VDAT and PDAT to shadow post later                         S01154
     C*                                                                   S01154
     C                     Z-ADDPDAT,X    PTDT                            S01154
     C                     Z-ADDWNIPD     VUDT                            S01154
     C*                                                                   042757
     C** Access the date 'equal to' or 'greater than' the                 042757
     C** event date and update the appropriate balances                   042757
     C*                                                                   042757
     C           WNIPD     IFGT PDAT,5                                    042757
     C                     Z-ADD6         X                               042757
     C                     ELSE                                           042757
     C                     Z-ADD1         X                               042757
     C           WNIPD     LOKUPPDAT,X               85  85               042757
     C                     END                                            042757
     C*
      **   Adjust Nostro balances for Entries X to 5
     C           X         DOWLE5
      * TO add NEW payments
     C           WPR       IFEQ 'P'                        PAYMENTS
     C*********************MOVELXUPACC**  PRNNO                     S01154E20928
     C                     SUB  WINTD     PPAY,X
     C*********************Z-ADD1*******  DORC                      S01154E20928
     C                     END
      * TO add NEW receipts
     C           WPR       IFEQ 'R'                        RECEIPTS
     C*********************MOVELXURACC**  PRNNO                     S01154E20928
     C                     ADD  WINTD     PREC,X
     C*********************Z-ADD0*******  DORC                      S01154E20928
     C                     END
     C                     ADD  1         X
     C                     END
     C**********           END                                            E20918
      *                                                                   E20928
      *  To indicate that the amount is debit or credit (Payments)        E20928
      *   - if a payment and nostro on the pay side then do RSACMTPD      E20928
     C           WPR       IFEQ 'P'                                       E20928
     C           @PNOST    ANDEQ'Y'                                       E20928
     C                     Z-ADD1         DORC    10                      E20928
      *                                                                   E20928
      * Shadow post amount to RSACMTPD.                                   E20908
     C                     MOVELXUPACC    PRNNO                           E20928
     C                     Z-ADDWINTD     MVAM                            E20928
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E20928
      *                                                                   E20928
     C                     END                                            E20928
      *                                                                   E20928
      *  To indicate that the amount is debit or credit (Receipts)        E20928
      *   - if a receipt and nostro on the rec side then do RSACMTPD      E20928
      *                                                                   E20928
     C           WPR       IFEQ 'R'                        B03            E20928
     C           @RNOST    ANDEQ'Y'                                       E20928
     C                     Z-ADD0         DORC    10                      E20928
      *                                                                   E20928
      * Shadow post amount to RSACMTPD.                                   E20928
      *                                                                   E20928
     C                     MOVELXURACC    PRNNO                           E20928
     C                     Z-ADDWINTD     MVAM                            E20928
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E20928
      *                                                                   E20928
     C                     END                             E03            E20928
     C**Shadow*post*amount*to*RSACMTPD.*                            S01154E20928
     C**********************************                            S01154E20928
     C*********************Z-ADDWINTD***  MVAM                      S01154E20928
     C*********************EXSR*OUTPOS**                            S01154E20928
     C                     END                                            E20918
      /SPACE 2
     C           WPR       IFEQ 'P'
     C                     Z-ADD1         XPAY
     C                     END
     C           WPR       IFEQ 'R'
     C                     Z-ADD1         XREC
     C                     END
     C                     END
      /EJECT
      *
      ** If Next Interest Rate Change Date , or Maturity Date reached
      **   ---- END CALCS FOR THIS DEAL.
      *
     C           XNIPD     IFGE XNICD
     C           XNIPD     OREQ XMDAT
     C                     Z-ADDRANGE     XNIPD
     C                     Z-ADDRANGE     XNICD
     C                     END
      /SPACE 4
      **   If Next Interest Payment Date  *LE  Next Interest
      **   Rate Change Date, calculate subsequent Next Interest
      **   Payment Date
      *
     C           XNIPD     IFLE XNICD
     C           XNIPD     ANDLTRANGE
      **
     C           XIPFR     IFNE *BLANK
     C                     Z-ADDXIPBD     ZDAYNO
     C                     MOVE XIPFR     ZFREQ
     C                     Z-ADDXIPFD     ZMDAY
     C******************** MOVE SUCUCY    ZCCY                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is PAY...                                      S01195
     C*                                                                   S01195
     C           WPR       IFEQ 'P'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C*                                                                   S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C*                                                                   S01195
     C                     MOVELSUPACC    WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C*                                                                   S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C* Else if Nostro Code blank...Move blanks to location.              S01195
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is RECEIVE...                                  S01195
     C*                                                                   S01195
     C           WPR       IFEQ 'R'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C*                                                                   S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C*                                                                   S01195
     C                     MOVELSURACC    WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C*                                                                   S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C* Else if Nostro Code blank...Move blanks to location.              S01195
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
      *                                                                   CIR005
      ** Get next int payment date using business day currencies          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SC1P1     ANDNE*BLANKS                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PBDPAY                          CIR005
     C                     PARM           SPDC1                           CIR005
     C                     PARM           BJSLCD                          CIR005
     C                     PARM           BJDFIN                          CIR005
     C                     PARM *ZEROS    PAJDT   50                      CIR005
     C                     PARM *ZEROS    PBSDT   50                      CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
     C                     Z-ADDPBSDT     ESAVD                           CIR005
      *                                                                   CIR005
     C           XNIPD     IFGE PAJDT                                     CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
     C                     ELSE                                           CIR005
     C*                                                                   S01195
     C******************** EXSR ZFREQB                                    S01195
     C                     EXSR @FREQB                                    S01195
     C                     Z-ADDZDAYNO    ESAVD   50
     C******************** MOVE 'Y'       ZOPT                            S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     Z-ADD0         ZNRDYS  20                      S01195
     C                     EXSR ZFWDT                                     S01195
     C                     ENDIF                                          CIR005
      *
      *****If*date*output*from*ZDATE5*is*LT*maturity*date,**********      S01195
      **   If date output from ZFWDT is LT maturity date,                 S01195
      **   Set Next Interest Payment & Base Dates to this Date
      **   If Not, set both Payment & Base Dates to Maturity date.
      *
     C           ZDYNBR    IFLT XMDAT
     C                     Z-ADDZDYNBR    XNIPD
     C                     Z-ADDESAVD     XIPBD
     C                     ELSE
     C                     Z-ADDXMDAT     XNIPD
     C                     Z-ADDXMDAT     XIPBD
     C                     END
      *
      **   If Interest Payment Frequency is blank, set to Maturity Date
     C                     ELSE
     C                     Z-ADDXMDAT     XNIPD
     C                     Z-ADDXMDAT     XIPBD
     C                     END
     C                     END
      /EJECT
      ** Set details for further interest calculations
      * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      **   Set Interest Calculation Start Date to previous
      **   Interest Calculation End Date
      *
     C***********          Z-ADDXICED     XUICSD                          CIR005
     C***********          Z-ADDXICED     XTICSD                          CIR005
     C***********          Z-ADDXICED     XICSD                           CIR005
     C                     Z-ADDWXCED     XUICSD                          CIR005
     C                     Z-ADDWXCED     XTICSD                          CIR005
     C                     Z-ADDWXCED     XICSD                           CIR005
      *
      ** If Next Interest Payment Date LE Next Interest Rate Change Date,
      **   set Interest Calc. End Date to Next Interest Payment Date
      **   else set it to the Next Interest Rate Change Date.
      *
     C           XNIPD     IFLE XNICD
     C                     Z-ADDXNIPD     XICED
     C                     ELSE
     C                     Z-ADDXNICD     XICED
     C                     END
      *                                                                   CIR005
     C                     Z-ADDXICED     WXCED   50                      CIR005
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C                     Z-ADDXIPBD     WXCED                           CIR005
     C                     ENDIF                                          CIR005
     C                     END                             >>>END=LOOP<<<
      **
     C                     ENDSR
      **********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UDLDF  SR.    To update PF/DEALSDF deal trailer record       *
      *                                                         (U01) *
      *****************************************************************
      *
     C           UDLDF     BEGSR                           ***  UDLDF ****
      *
      **  Obtain deals trailer record
     C                     Z-ADD999999    DLKEY   60
     C           DLKEY     CHAINDEALS                86
     C  N86      RECI      COMP 'T'                  8686
     C           *IN86     IFEQ '1'
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '18'      DBASE            ***************S01194
     C**********           MOVE 'DEALS'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELDLKEY     DBKEY            *      18     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C*                                                                   S01194
     C                     MOVE '018'     DBASE            ***************S01194
     C                     MOVE 'DEALS'   DBFILE           *   DBERROR   *S01194
     C                     MOVELDLKEY     DBKEY            *      18     *S01194
     C                     EXSR *PSSR                                     S01194
     C                     END
      *
      **  Setup information in file fields
      **   Update relevant total fields
     C           NORE      ADD  1         NORE
     C/COPY WNCPYSRC,DL1604IC43
     C           NINS      ADD  1         NINS
     C/COPY WNCPYSRC,DL1604IC44
     C           NLRA      ADD  1         NLRA
      *
      **   Update amount fields
     C/COPY WNCPYSRC,DL1604IC45
     C                     Z-ADD0         ZZAMT
     C                     MOVE UPAMTX    ZZAMT
     C                     Z-ADDVRIF      ZZTOTI
     C                     Z-ADDVRIL      ZZTOTD
     C                     EXSR GLZADD
      *
     C                     Z-ADDZZTOTI    VRIF
     C                     Z-ADDZZTOTD    VRIL
     C/COPY WNCPYSRC,DL1604IC46
     C                     Z-ADDVLAF      ZZTOTI
     C                     Z-ADDVLAL      ZZTOTD
     C                     Z-ADD0         ZZAMT
     C                     MOVE UPAMTX    ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
      *
      **   Update control fields
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE SACCD     CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATDEALSDFF
      **
     C                     ENDSR
      ********************************************************************
      /EJECT
     C/COPY WNCPYSRC,DL1604IC09
      *****************************************************************
      *                                                               *
      *  UDTHH  SR.    To update PF/DTRIXHH deal transaction index    *
      *                header record                            (U02) *
      *****************************************************************
      *
     C           UDTHH     BEGSR                           ***  UDTHH ****
      **
     C                     MOVE '1'       DTXKEY  10
     C           DTXKEY    CHAINDTRIXHH              86
     C  N86      RECI      COMP 'H'                  8686
     C           *IN86     IFEQ '1'
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '19'      DBASE            ***************S01194
     C**********           MOVE 'DTRIX'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELDTXKEY    DBKEY            *      19     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C*                                                                   S01194
     C                     MOVE '019'     DBASE            ***************S01194
     C                     MOVE 'DTRIX'   DBFILE           *   DBERROR   *S01194
     C                     MOVELDTXKEY    DBKEY            *      19     *S01194
     C                     MOVE '*KEY   ' DBOPTN           ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END
      *
      **  Setup information in file fields
     C           NDLR      ADD  1         NDLR
     C                     Z-ADDNATN      TNLU
     C                     UPDATDTRIXHF
      **
     C                     ENDSR
      ********************************************************************
     C/COPY WNCPYSRC,DL1604IC13
      /EJECT
      *****************************************************************
      *                                                               *
      *  WDLDG  SR.    To write PF/DEALSDG cap/collar IRS             *
      *                transaction detail record                (W21) *
      *                                                               *
      *****************************************************************
      *
     C           WDLDG     BEGSR                           ***  WDLDG ****
      **
      *
      **  Setup information in file fields
     C                     MOVE 'D'       RECI
     C                     MOVE SDLNO     DLNO
     C                     MOVE 'G'       RCDT
     C                     Z-ADD24        RCDC
     C**********           Z-ADDCNUMX     CNUM                                                CSD027
     C                     MOVE CNUMX     CNUM                                                CSD027
      *
     C********** SBRCD     IFEQ *BLANKS                                   S01117
     C           SBRCA     IFEQ *BLANKS                                   S01117
     C**********           MOVE DFBR      BRCD                            S01117
     C                     MOVE ZDBRN     BRCA                            S01117
     C                     ELSE
     C**********           MOVE SBRCD     BRCD                            S01117
     C                     MOVE SBRCA     BRCA                            S01117
     C                     END
      *
     C                     MOVE SDTYP     DTYP
     C                     MOVE SDLST     DLST
     C                     Z-ADDDDATX     DDAT
     C                     Z-ADDVDATX     VDAT
     C                     Z-ADDMDATX     MDAT
      *
     C           SCDAS     IFEQ *BLANKS
     C           SCDAS     OREQ '00'
     C*****      *IN83     IFEQ '0'                                       S01194
     C                     MOVE '01'      CDAS
     C*****                ELSE                                           S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'10'      ZTABKY                          S01194
     C**********           MOVE BRCD      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               85                   S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '20'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      20     *S01194
     C**********           EXSR DBERR                      ***************S01194
      *
     C*****************    END                                            S01194
      *
     C******************** MOVE NSACS     CDAS                            S01194
     C*****                END                                            S01194
     C                     ELSE
     C                     MOVE SCDAS     CDAS
     C                     END
      *
     C                     MOVE SBRKC     BRKC
      *
     C           SBAGE     IFEQ 'NIL'
     C           SBAGE     OREQ *BLANKS
     C                     Z-ADD0         BAGE
     C                     ELSE
     C                     Z-ADDBAGEX     BAGE
     C                     END
      *
     C           SLNKDN    IFEQ *BLANKS
     C                     Z-ADD0         LNKDN
     C                     ELSE
     C                     MOVE SLNKDN    LNKDN
     C                     END
      *
     C***        SHEDIN    IFEQ *BLANK                                    S01157
     C***                  MOVE 'N'       HEDIN                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE SHEDIN    HEDIN                           S01157
     C***                  END                                            S01157
      *
     C* WRITE BOOK CODE TO FILE                                           S01117
     C*                                                                   S01117
     C                     MOVE SBOKC     BOKC                            S01117
     C*                                                                   S01117
     C           STAXI     IFEQ *BLANK
     C                     MOVE 'N'       TAXI
     C                     ELSE
     C                     MOVE STAXI     TAXI
     C                     END
     C* PROFIT CENTRE                                                     S01117
     C*                                                                   S01117
     C                     MOVE SPRFC     PRFC                            S01117
     C* ORIGINATING BRANCH                                                S01117
     C*                                                                   S01117
     C                     MOVE SORBR     ORBR                            S01117
     C*                                                                   S01117
      *
     C                     MOVE SUCUCY    UCUCY
     C                     Z-ADDUPAMTX    UPAMT
      *
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         UBRTT                           S01157
     C***                  ELSE                                           S01157
     C****                 MOVE SUBRTT    UBRTT                           S01157
     C***                  END                                            S01157
      *
     C                     Z-ADD0         USTRT
     C                     Z-ADD0         UBRTE
      *
     C***        SURTSP    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         URTSP                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDURTSPX    URTSP                           S01157
     C***                  END                                            S01157
      *
     C****       SUBRTT    IFNE *BLANKS                                   S01157
     C***        SURTSP    ANDNE*BLANKS                                   S01157
     C***        SUSPIN    ANDEQ*BLANK                                    S01157
     C***                  MOVE 'A'       USPIN                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE SUSPIN    USPIN                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADDUEINRX    UEINR                           S01157
     C                     MOVE SUICBS    UICBS
      *
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         UFRFD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDUFRFDX    UFRFD                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADD@INFDX    UINFD                           S01157
     C****                 Z-ADDVDAT      USLIP                           S01157
      *
     C***        SUNICD    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         UNICD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDUNICDX    UNICD                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADDUNICD     UICBD                           S01157
     C***                  MOVE SUICFR    UICFR                           S01157
      *
     C***        SUICFD    IFEQ *BLANKS                                   S01157
      *
     C****       SUICFR    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         UICFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE SUNICD    DATE                            S01157
     C***                  MOVE SRNICD    DATE                            S01157
     C***        *IN98     IFEQ '0'                                       S01157
     C***                  MOVE DAY1      UICFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE DAY2      UICFD                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDUICFDX    UICFD                           S01157
     C***                  END                                            S01157
      *
     C***        SUNIPD    IFNE *BLANKS                                   S01157
     C***                  Z-ADDUNIPDX    UNIPD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADD0         UNIPD                           S01157
     C***                  END                                            S01157
      *                                                                   S01157
     C***                  Z-ADDUNIPD     UIPBD                           S01157
     C***                  MOVE SUIPFR    UIPFR                           S01157
      *
     C***        SUIPFD    IFEQ *BLANKS                                   S01157
      *
     C***        SUIPFR    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         UIPFD                           S01157
     C***                  ELSE                                           S01157
     C****                 MOVE SUNIPD    DATE                            S01157
     C***        *IN98     IFEQ '0'                                       S01157
     C***                  MOVE DAY1      UIPFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE DAY2      UIPFD                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *                                                                   S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDUIPFDX    UIPFD                           S01157
     C***                  END                                            S01157
      *
     C           SUBCXR    IFEQ *BLANKS
     C**********           MOVE *BLANKS   CYKY12 12                       S01194
     C**********           MOVELSUCUCY    CYKY4   4                       S01194
     C**********           MOVE '1'       CYKY4                           S01194
     C**********           MOVE CYKY4     CYKY12                          S01194
     C**********           MOVEL'20'      CYKY12                          S01194
     C********** CYKY12    CHAINTABDLI               85                   S01194
      ***Chain*should*not*fail,but*allow*for*corrupt*files.**********     S01194
     C**N85******RECI      COMP 'D'                  8585                 S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '21'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELCYKY12    DBKEY            *      21     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO CHECK CURRENCY CODE                        S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM SUCUCY    @UCUCY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C* IF CURRENCY CODE NOT FOUND D/BASE ERROR MUST EXIST                S01194
     C*                                                                   S01194
     C**********           ELSE                                           S01194
     C******************** Z-ADDSPOT      UBCXR                           S01194
     C                     Z-ADDA6SPRT    UBCXR                           S01194
     C**********           END                                            S01194
     C                     ELSE
     C                     Z-ADDUBCXRX    UBCXR
     C                     END
      *
     C                     Z-ADDVDAT      UIACD
     C                     Z-ADD0         UIALC
     C                     Z-ADD0         UAITC
     C                     Z-ADD0         UAIPD
     C                     Z-ADD0         UAIAN
     C                     Z-ADD0         UAIAP
     C                     Z-ADD0         UIPRD
     C                     Z-ADD0         UIPRM
     C                     Z-ADD0         UNSAM
     C                     Z-ADD0         UTAXD
     C                     Z-ADD0         UTAXM
     C                     MOVE UCUCY     TCUCY
     C                     Z-ADDUPAMT     TPAMT
      *
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         TBRTT                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE STBRTT    TBRTT                           S01157
     C***                  END                                            S01157
      *
     C                     Z-ADD0         TSTRT
     C                     Z-ADD0         TBRTE
      *
     C***        STRTSP    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         TRTSP                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDTRTSPX    TRTSP                           S01157
     C***                  END                                            S01157
      *                                                                   S01157
     C***        STBRTT    IFNE *BLANKS                                   S01157
     C***        STRTSP    ANDNE*BLANKS                                   S01157
     C***        STSPIN    ANDEQ*BLANK                                    S01157
     C***                  MOVE 'A'       TSPIN                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE STSPIN    TSPIN                           S01157
     C***                  END                                            S01157
      *
     C                     Z-ADDTEINRX    TEINR
     C                     MOVE UICBS     TICBS
      *
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         TFRFD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDTFRFDX    TFRFD                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADD@INFDX    TINFD                           S01157
     C****                 Z-ADDVDAT      TSLIP                           S01157
      *
     C***        STNICD    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         TNICD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDTNICDX    TNICD                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADDTNICD     TICBD                           S01157
     C***                  MOVE STICFR    TICFR                           S01157
      *
     C***        STICFD    IFEQ *BLANKS                                   S01157
      *
     C***        STICFR    IFEQ *BLANKS                                   S01157
     C***                  Z-ADD0         TICFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE STNICD    DATE                            S01157
     C***        *IN98     IFEQ '0'                                       S01157
     C***                  MOVE DAY1      TICFD                           S01157
     C***                  ELSE                                           AS1157
     C***                  MOVE DAY2      TICFD                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      *
     C***                  ELSE                                           S01157
     C***                  Z-ADDTICFDX    TICFD                           S01157
     C***                  END                                            S01157
      *
     C***        STNIPD    IFNE *BLANKS                                   S01157
     C***                  Z-ADDTNIPDX    TNIPD                           S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADD0         TNIPD                           S01157
     C***                  END                                            S01157
      *
     C****                 Z-ADDTNIPD     TIPBD                           S01157
     C***                  MOVE STIPFR    TIPFR                           S01157
      *
     C***        STIPFD    IFEQ *BLANKS                                   S01157
      *
     C***        STIPFR    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         TIPFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE STNIPD    DATE                            S01157
     C***        *IN98     IFEQ '0'                                       S01157
     C***                  MOVE DAY1      TIPFD                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE DAY2      TIPFD                           S01157
     C***                  END                                            S01157
     C****                 END                                            S01157
      *
     C***                  ELSE                                           S01157
     C***                  Z-ADDTIPFDX    TIPFD                           S01157
     C***                  END                                            S01157
      *
     C                     Z-ADDUBCXR     TBCXR
     C                     Z-ADDVDAT      TIACD
     C                     Z-ADD0         TIALC
     C                     Z-ADD0         TAITC
     C                     Z-ADD0         TAIPD
     C                     Z-ADD0         TAIAN
     C                     Z-ADD0         TAIAP
     C                     Z-ADD0         TIPRD
     C                     Z-ADD0         TIPRM
     C                     Z-ADD0         TNSAM
     C                     Z-ADD0         TTAXD
     C                     Z-ADD0         TTAXM
     C                     Z-ADDCLRATX    CLRAT
      *
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****                 Z-SUBCLRAT     CLRAT                           S01157
     C***                  END                                            S01157
      *
     C           SFLRAT    IFEQ *BLANKS
     C                     Z-ADD0         FLRAT
     C                     ELSE
     C                     Z-ADDFLRATX    FLRAT
     C                     END
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***                  Z-SUBFLRAT     FLRAT                           S01157
     C****                 END                                            S01157
      *
     C                     Z-ADDAVPERX    AVPER
     C                     Z-ADDTIRATX    TIRAT
     C                     Z-ADDAACRTX    AACRT
      *
     C           SRSETM    IFEQ *BLANKS
     C                     MOVE '00'      RSETM
     C                     ELSE
     C                     MOVE SRSETM    RSETM
     C                     END
      *
     C           SRSETM    IFNE '04'
     C                     MOVE SURACC    URACC
     C           SRSETM    IFEQ '05'
     C                     MOVE URACCX    URACC
     C                     END
     C                     ELSE
     C                     MOVE CNUMX     RCNUM
     C******************** MOVE CADC      RPCAC                           S01194
     C                     MOVE BMACCD    RPCAC                           S01194
     C********** *IN83     IFEQ '1'                                       S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'10'      ZTABKY                          S01194
     C**********           MOVE BRCD      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               85                   S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '22'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      22     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
     C******************** MOVE NSACS     RSEQ                            S01194
     C**********           ELSE                                           S01194
     C                     MOVE '01'      RSEQ
     C**********           END                                            S01194
     C                     MOVE RACNO     URACC
     C                     END
      *
     C********** CPPBKX    IFEQ 0                                                             CSD027
     C           CPPBKX    IFEQ *BLANKS                                                       CSD027
     C                     MOVE SCPPBK    CPPBK
     C                     ELSE
     C                     MOVE *BLANKS   CPPBK
     C                     MOVELCPPBKX    CPPBK
     C                     END
      *                                                                   CIR001
      ** Move Up-front fee details to file fields                         CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR006
      **  If CIR006 is On, update fields according to the                 CIR006
      **  values entered on the windows screen.                           CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
     C                     MOVE #1UINP    UINPM                           CIR006
     C                     MOVE #1TINP    TINPM                           CIR006
     C                     Z-ADD#1TNPC    TNPCD                           CIR006
     C                     Z-ADD#1UNPC    UNPCD                           CIR006
      *                                                                   CIR006
     C                     Z-ADD#1UPVD    UPVD                            CIR006
     C                     Z-ADD#1UPFE    UPFE                            CIR006
     C                     MOVE #1UPPR    UPPR                            CIR006
     C                     Z-ADD0         UPAD                            CIR006
     C                     Z-ADD#1BODD    BODD                            CIR006
     C                     Z-ADD#1BOVD    BOVD                            CIR006
     C                     Z-ADD#1BOAM    BOAM                            CIR006
     C                     MOVE #1BAPR    BAPR                            CIR006
      *                                                                   CIR006
      **  Else, proceed with the existing update processing.              CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     Z-ADD0         UNPCD                           CIR006
     C                     Z-ADD0         TNPCD                           CIR006
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC35                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C           SUPVD     IFEQ *BLANKS                                   CIR001
     C                     MOVE *ZEROS    UPVD                            CIR001
     C                     ELSE                                           CIR001
     C                     MOVE UPVDX     UPVD                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           SUPFE     IFEQ *BLANKS                                   CIR001
     C                     MOVE *ZEROS    UPFE                            CIR001
     C                     ELSE                                           CIR001
     C                     MOVE UPFEX     UPFE                            CIR001
     C                     END                                            CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC36                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
     C           SBYSL     IFEQ 'B'                                       CIR001
     C                     MOVE 'P'       UPPR                            CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'R'       UPPR                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     Z-ADD0         UPAD                            CIR001
     C                     Z-ADD0         BOAM                            CIR001
     C                     Z-ADD0         BOVD                            CIR001
     C                     Z-ADD0         BODD                            CIR001
     C                     MOVE *BLANK    BAPR                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR006
      *                                                                   CIR006
     C                     Z-ADD0         OUSI                            CIR006
     C                     Z-ADD0         OUSA                            CIR006
     C                     Z-ADD0         TUSI                            CIR006
     C                     Z-ADD0         TUSA                            CIR006
     C                     END                                            CIR001
      *
     C           SPSETM    IFEQ *BLANKS
     C                     MOVE '00'      PSETM
     C                     ELSE
     C                     MOVE SPSETM    PSETM
     C                     END
      *
     C           SPSETM    IFNE '04'
     C                     MOVE SUPACC    UPACC
     C           SPSETM    IFEQ '05'
     C                     MOVE UPACCX    UPACC
     C                     END
     C                     ELSE
     C                     MOVE CNUMX     RCNUM
     C******************** MOVE CADC      RPCAC                           S01194
     C                     MOVE BMACCD    RPCAC                           S01194
     C********** *IN83     IFEQ '1'                                       S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'10'      ZTABKY                          S01194
     C**********           MOVE BRCD      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               85                   S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '23'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      23     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C******************** MOVE NSACS     RSEQ                            S01194
     C**********           ELSE                                           S01194
     C                     MOVE '01'      RSEQ
     C**********           END                                            S01194
     C                     MOVE RACNO     UPACC
     C                     END
      *
     C********** CPRBKX    IFEQ 0                                                             CSD027
     C           CPRBKX    IFEQ *BLANKS                                                       CSD027
     C                     MOVE SCPRBK    CPRBK
     C                     ELSE
     C                     MOVE *BLANKS   CPRBK
     C                     MOVELCPRBKX    CPRBK
     C                     END
      *
     C********** FACOX     IFEQ 0                                                             CSD027
     C           FACOX     IFEQ *BLANKS                                                       CSD027
     C                     MOVE SFACO     FACO
     C                     ELSE
     C                     MOVE *BLANKS   FACO
     C                     MOVELFACOX     FACO
     C                     END
      *
     C                     MOVE SPIX      SPI
      *
     C                     Z-ADD0         SDCAR
     C           SAVRAM    IFEQ 'Y'
     C*********  VDAT      ANDLTRUND                                      S01194
     C           VDAT      ANDLTBJRDNB                                    S01194
     C                     Z-ADDVDAT      SDCAR
     C                     END
      *
     C***        SUBRTT    IFEQ *BLANKS                                   S01157
     C****       SRBRTT    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         ULPCD                           S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADDVDAT      ULPCD                           S01157
     C****                 END                                            S01157
      *
     C***        STBRTT    IFEQ *BLANKS                                   S01157
     C****       SRBRTT    IFEQ *BLANKS                                   S01157
     C****                 Z-ADD0         TLPCD                           S01157
     C****                 ELSE                                           S01157
     C****                 Z-ADDVDAT      TLPCD                           S01157
     C****                 END                                            S01157
      *
     C                     Z-ADD0         UAEXA
     C                     Z-ADD0         TAEXA
      *
     C                     BITOF'01234567'UDNSI
     C           SAVRAM    IFNE 'Y'
     C***        SWORK1    ANDNE*BLANKS                                   S01157
     C           SWORKR    ANDNE*BLANKS                                   S01157
      *                                                                                     AR814519
      ** Check if our interest fix date is on or before value date.                         AR814519
      *                                                                                     AR814519
     C           @INFDX    IFLE VDAT                                                        AR814519
     C           CWEINR    ANDEQ0                                                           AR814519
     C                     BITOF'0'       UDNSI                                             AR814519
     C                     ELSE                                                             AR814519
     C                     BITON'0'       UDNSI
     C                     ENDIF                                                            AR814519
     C                     END
      *
     C                     BITOF'01234567'TDNSI
     C           SAVRAM    IFNE 'Y'
     C***        SWORK2    ANDNE*BLANKS                                   S01157
     C           SWORKR    ANDNE*BLANKS                                   S01157
      *                                                                                     AR814519
      ** Check if our interest fix date is on or before value date.                         AR814519
      *                                                                                     AR814519
     C           @INFDX    IFLE VDAT                                                        AR814519
     C           CWEINR    ANDEQ0                                                           AR814519
     C                     BITOF'0'       TDNSI                                             AR814519
     C                     ELSE                                                             AR814519
     C                     BITON'0'       TDNSI
     C                     ENDIF                                                            AR814519
     C                     END
      *
      ** (NB UDSTI/TDSTI set in subroutine CRDTA1 )
      *
      ** (NB Confirmation inds set in subroutine CONFI )
      *
     C                     BITOF'01234567'ACEI
     C                     BITOF'01234567'TLXI
      *
     C                     Z-ADD0         LSWC
     C                     Z-ADD0         LSWS
     C*****                Z-ADDRUND      ORED                            S01194
     C                     Z-ADDBJRDNB    ORED                            S01194
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNATN      TNLU
      **
     C*                                                                   S01157
     C* SETUP FILE FIELDS                                                 S01157
     C*                                                                   S01157
     C                     MOVE SBYSL     BYSL             *INSERT(DL1904)S01157
     C*                                                                   S01157
     C* RATE CHANGE DATE STORED IN @NICDX S01157                          S01157
     C* INT PAYMENT DATE STORED IN @NIPDX                                 S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C           BYSL      ANDEQ'B'                                       S01157
     C           NEWDT     OREQ 'RR'                                      S01157
     C           BYSL      ANDEQ'B'                                       S01157
     C           NEWDT     OREQ 'RF'                                      S01157
     C           BYSL      ANDEQ'S'                                       S01157
     C*                                                                   S01157
     C                     MOVE SRBRTT    TBRTT                           S01157
     C                     Z-ADD@RTSPX    TRTSP                           S01157
     C                     Z-ADD@FRFDX    TFRFD                           S01157
     C                     MOVE @NICDX    TNICD                           S01157
     C                     Z-ADDTNICD     TICBD                           S01157
     C                     MOVE SRICFR    TICFR                           S01157
     C*********************MOVE SCICFD****TICFD******************** S01157E22134
     C                     Z-ADDTICFDX    TICFD                           E22134
     C*                                                                   S01157
     C** IF BASE RATE AND SPREAD ENTERED BUT NO SPREAD INDICATOR          S01157
     C** THEN DEFAULT TO 'A'.                                             S01157
     C*                                                                   S01157
     C           SRBRTT    IFNE *BLANKS                                   S01157
     C           SRRTSP    ANDNE*BLANKS                                   S01157
     C           SRSPIN    ANDEQ*BLANK                                    S01157
     C                     MOVE 'A'       TSPIN                           S01157
     C                     ELSE                                           S01157
     C                     MOVE SRSPIN    TSPIN                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* ONLY SETUP TEINR IF AV RATE METHOD ISN'T Y                        S01157
     C*                                                                   S01157
     C           SAVRAM    IFNE 'Y'                                       S01157
     C                     Z-ADDWORK2X    TEINR                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     Z-ADD@NIPDX    TIPBD                           S01157
     C                     Z-ADD@NIPDX    TNIPD                           S01157
     C                     MOVE SRIPFR    TIPFR                           S01157
     C                     Z-ADDTIPFDX    TIPFD                           S01157
     C                     Z-ADDVDAT      TLPCD                           S01157
     C                     Z-ADD@INFDX    TINFD                           S01157
     C                     Z-ADDVDAT      TSLIP                           S01157
     C*                                                                   S01157
     C* SET EQUIVALENT  OUR DETAILS TO BLANK                              S01157
     C*                                                                   S01157
     C                     MOVE *ZERO     OUR               DATASTRUC     S01157
     C                     MOVE *BLANK    USPIN                           S01157
     C                     MOVE *BLANK    UICFR                           S01157
     C                     MOVE *BLANK    UIPFR                           S01157
     C*                                                                   S01157
     C* ELSE DEAL HAS BEEN SOLD                                           S01157
     C*                                                                   S01157
     C                     ELSE                                           S01157
     C*                                                                   S01157
     C                     MOVE SRBRTT    UBRTT                           S01157
     C                     Z-ADD@RTSPX    URTSP                           S01157
     C                     Z-ADD@FRFDX    UFRFD                           S01157
     C                     MOVE @NICDX    UNICD                           S01157
     C                     Z-ADDUNICD     UICBD                           S01157
     C                     MOVE SRICFR    UICFR                           S01157
     C***********          MOVE SCICFD    UICFD                    S01157 028574
     C                     Z-ADDTICFDX    UICFD                           028574
     C*                                                                   S01157
     C** IF BASE RATE AND SPREAD ENTERED BUT NO SPREAD INDICATOR          S01157
     C** THEN DEFAULT TO 'A'.                                             S01157
     C*                                                                   S01157
     C           SRBRTT    IFNE *BLANKS                                   S01157
     C           SRRTSP    ANDNE*BLANKS                                   S01157
     C           SRSPIN    ANDEQ*BLANK                                    S01157
     C                     MOVE 'A'       USPIN                           S01157
     C                     ELSE                                           S01157
     C                     MOVE SRSPIN    USPIN                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* ONLY SETUP UEINR IF AV RATE METHOD ISN'T Y                        S01157
     C*                                                                   S01157
     C           SAVRAM    IFNE 'Y'                                       S01157
     C                     Z-ADDWORK2X    UEINR                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     Z-ADD@NIPDX    UIPBD                           S01157
     C                     Z-ADD@NIPDX    UNIPD                           S01157
     C                     MOVE SRIPFR    UIPFR                           S01157
     C                     Z-ADDTIPFDX    UIPFD                           S01157
     C                     Z-ADDVDAT      ULPCD                           S01157
     C                     Z-ADD@INFDX    UINFD                           S01157
     C                     Z-ADDVDAT      USLIP                           S01157
     C*                                                                   S01157
     C* SET EQUIVALENT THEIR DETAILS TO BLANK                             S01157
     C*                                                                   S01157
     C                     MOVE *ZERO     THEIR             DATASTRUC     S01157
     C                     MOVE *BLANK    TSPIN                           S01157
     C                     MOVE *BLANK    TICFR                           S01157
     C                     MOVE *BLANK    TIPFR                           S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* LF/BOOKD ALREADY ACCESSES FOR VALIDATION OF BOOK CODE             S01157
     C*                                                                   S01157
     C******************** MOVE HDGI      HEDIN                    S01157 S01194
     C                     MOVE BDHGIN    HEDIN                           S01194
     C*                                                                   S01194
     C** Initialise Unrealised P/L and Unrealised P/L Posted fields       S01328
     C** to zero in order to avoid decimal data error.                    S01328
     C                     Z-ADD0         UNRL                            S01328
     C                     Z-ADD0         UNRLP                           S01328
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604IC37                                           S01408
     C*                                                                   S01408
     C*                                                                   S01328
     C** Store machine time                                               111044
     C*                                                                   111044
     C                     TIME           DDTM                            111044
     C*                                                                   111044
     C** Setup Base Rate Code for Sequencing                              111044
     C*                                                                   111044
     C                     Z-ADD*ZEROS    BRSQ                            111044
     C*                                                                   111044
      *                                                                   CEU003
      ** If SAR CEU003 (EMU DL Settlement Ccy Conversion) is installed.   CEU003
      ** Then move new fields in PF/DEALSDG.                              CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELSSTCY     PSCY                            CEU003
     C                     MOVELSSTCY     RSCY                            CEU003
     C                     MOVELSIC72     IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   PSCY                            CEU003
     C                     MOVE *BLANKS   RSCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR005
      ** Write Business Day Conventions Fields                            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVELSC1P1     L1CYP1                          CIR005
     C                     MOVELSC2P1     L1CYP2                          CIR005
     C                     MOVELSC3P1     L1CYP3                          CIR005
     C                     MOVELSC4P1     L1CYP4                          CIR005
     C                     MOVELSC5P1     L1CYP5                          CIR005
     C                     MOVELSC6P1     L1CYP6                          CIR005
     C                     MOVELSC7P1     L1CYP7                          CIR005
     C                     MOVELSC8P1     L1CYP8                          CIR005
     C                     MOVELSC9P1     L1CYP9                          CIR005
     C                     MOVELSC0P1     L1CYP0                          CIR005
     C                     MOVELSPDC1     L1PDCN                          CIR005
     C                     MOVELSAMC1     L1AMCN                          CIR005
     C                     MOVELSC1R1     L1CYR1                          CIR005
     C                     MOVELSC2R1     L1CYR2                          CIR005
     C                     MOVELSC3R1     L1CYR3                          CIR005
     C                     MOVELSC4R1     L1CYR4                          CIR005
     C                     MOVELSC5R1     L1CYR5                          CIR005
     C                     MOVELSC6R1     L1CYR6                          CIR005
     C                     MOVELSC7R1     L1CYR7                          CIR005
     C                     MOVELSC8R1     L1CYR8                          CIR005
     C                     MOVELSC9R1     L1CYR9                          CIR005
     C                     MOVELSC0R1     L1CYR0                          CIR005
     C                     ENDIF                                          CIR005
     C                     WRITEPFDEALSF               86
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
      *                                                                   CIR006
      ** If CIR006 is switched on, call PGM/DL2900 to set up deal         CIR006
      **   activity for on-line updates.                                  CIR006
      *                                                                   CIR006
     C                     MOVELIRDEAL    Z#ASTS                          CIR006
     C                     CALL 'DL2900'                                  CIR006
     C                     PARM *BLANK    PRTCD   7                       CIR006
     C                     PARM SDLNO     PDLNO   6                       CIR006
     C                     PARM 'A'       PBEAF   1                       CIR006
      *                                                                   CIR006
     C           PRTCD     IFEQ '*ERROR'                                  CIR006
     C                     MOVEL'DL2900'  DBFILE                          CIR006
     C                     Z-ADD36        DBASE                           CIR006
     C                     MOVEL*BLANK    DBKEY                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     END                                            CIR006
      *                                                                   CIR006
     C                     END                                            CIR006
      **
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CONFI  SR.    To set confirmation indicators in accordance   *
      *                with P/DLU018                       (P/DLU018) *
      *****************************************************************
     C           CONFI     BEGSR                           ***  CONFI ****
      *
      **  Set initial value of confirmation required indicator
     C/COPY WNCPYSRC,DL1604IC14
     C                     MOVE 'N'       CNRQ
     C/COPY WNCPYSRC,DL1604IC38
      *
      **  The confirmation required indicator may be set to 'Y'
      **  and the confirmation indicators may be set to OFF if...
     C                     BITOF'01234567'CNFI
      **
      **  If the two level input indicator = N:
     C********** TLII      IFEQ 'N'                                       S01194
     C           BLL2II    IFEQ 'N'                                       S01194
     C/COPY WNCPYSRC,DL1604IC39
     C                     MOVE 'Y'       CNRQ
     C/COPY WNCPYSRC,DL1604IC40
      **
      **  Else, if the two level input indicator = Y:
      **    and part or all settlement instructions entered
     C                     ELSE
     C           SRSETM    IFNE '00'
     C           SPSETM    ORNE '00'
     C/COPY WNCPYSRC,DL1604IC41
     C                     MOVE 'Y'       CNRQ
     C/COPY WNCPYSRC,DL1604IC42
     C                     END
     C                     END
      **
     C                     ENDSR
      ********************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CMTXT  SR.    To set up text on comit entry in journal       *
      *****************************************************************
     C           CMTXT     BEGSR                           ***  CMTXT ****
      *
     C                     MOVE 'DL'      MDID
     C                     MOVE 'DL1604I' PGMN
     C                     MOVE WSID      WSIDX
     C                     TIME           MTIME
     C                     MOVE SACCD     IACTX
     C                     MOVE USRID     USRIDX
     C                     MOVE SCRN1     SCRN1X
     C                     MOVE SCRN2     SCRN2X
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************   S01194
      *********************                                           *   S01194
      ***DBERR  SR.****To*update LDA with database error information  *   S01194
      *****************&*exit program                                 *   S01194
      *********************                                           *   S01194
      *****************************************************************   S01194
      *********************                                               S01194
     C***********DBERR*****BEGSR                           ***  DBERR ****S01194
      *********************                                               S01194
     C************NAMVAR***DEFN           LDA                             S01194
     C*********************MOVE 'DL1604I 'DBPGM                    S01157 S01194
     C*********************MOVEL'DL1604I 'DBPGM                    S01157 S01194
     C*********************OUT  LDA                                       S01194
      *********************                                               S01194
     C*********************SETON                     U7U8LR               S01194
      *********************                                               S01194
     C*********************RETRN                                          S01194
      *********************                                               S01194
     C*********************ENDSR                                          S01194
      ********************************************************************S01194
0344 C********************************************************************S01194
     C*                                                                   S01194
     C*   *PSSR SR HANDLES DATABASE ERROR IN NEW STANDING DATA FILES      S01194
     C*                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     MOVEL'DL1604I' DBPGM                           S01194
     C           *NAMVAR   DEFN           LDA   256                       S01194
     C           *LOCK     IN   LDA                                       S01194
     C                     MOVELDBERR     LDA                             S01194
     C                     OUT  LDA                                       S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C********************************************************************S01194
      /SPACE 4
      *****************************************************************
      *                                                               *
      *  INFSR  SR.    File exception / Error handling                *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           ***  INFSR ****
      **
     C                     ROLBK
      *
      **  If write error is because record already exists
     C           STATUS    IFEQ 01021
      *
      **  Set up message, clear error and return to next statement
     C                     Z-ADD0         STATUS  50
     C                     MOVELERRMSG,2  SERCD2
     C                     SETON                     08
     C                     MOVE *BLANKS   EXTTAG  6
      *
      **   ELSE, for any other write errors
     C                     ELSE
      *
      **  Exit pgm as if no INFSR specified
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
      *
     C                     ENDSREXTTAG
      ********************************************************************
      *                                                                   CIR005
      *****************************************************************   CIR005
     C/EJECT                                                              CIR005
      *****************************************************************   CIR005
      *                                                               *   CIR005
      *  SRCLR  - Use to clear messages in program queue.             *   CIR005
      *                                                               *   CIR005
      *  Called By: SRINIT, Main routine                              *   CIR005
      *                                                               *   CIR005
      *  Calls:                                                       *   CIR005
      *  Y2CLMSC   - Clear messages from program queue                *   CIR005
      *                                                               *   CIR005
      *****************************************************************   CIR005
      *                                                                   CIR005
     C           SRCLR     BEGSR                           *** SRCLR  *** CIR005
      *                                                                   CIR005
      ** Clear messages from program message queue                        CIR005
      *                                                                   CIR005
     C                     CALL 'Y2CLMSC'                                 CIR005
     C                     PARM ##PGM     ZAPGMQ 10                       CIR005
     C                     PARM '*SAME'   ZAPGRL  5                       CIR005
     C                     WRITE#MSGCTL                                   CIR005
      *                                                                   CIR005
     C                     ENDSR                                          CIR005
      *                                                                   CIR005
      *****************************************************************   CIR005
     C/EJECT                                                              CIR005
      *****************************************************************   CIR005
      *                                                               *   CIR005
      *  ZASNMS - Use to send message to program queue. Used for      *   CIR005
      *           sending messages or other information.              *   CIR005
      *                                                               *   CIR005
      *  Called By: Main routine                                      *   CIR005
      *                                                               *   CIR005
      *  Calls:                                                       *   CIR005
      *  Y2SNMGC   - Send messages to program queue                   *   CIR005
      *                                                               *   CIR005
      *****************************************************************   CIR005
      *                                                                   CIR005
     C           ZASNMS    BEGSR                           *** ZASNMS *** CIR005
      *                                                                   CIR005
     C           ZAPGMQ    IFEQ *BLANK                                    CIR005
     C                     MOVEL##PGM     ZAPGMQ                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** If no message file specified, use default                        CIR005
      *                                                                   CIR005
     C           ZAMSGF    IFEQ *BLANK                                    CIR005
     C                     MOVELZADFMF    ZAMSGF                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     CALL 'Y2SNMGC'                                 CIR005
     C                     PARM           ZAPGMQ 10        Program queue  CIR005
     C                     PARM           ZAPGRL  5        Rel queue      CIR005
     C                     PARM           ZAMSID  7        Message ID     CIR005
     C                     PARM           ZAMSGF 10        Message file   CIR005
     C                     PARM           ZAMSDA132        Message data   CIR005
     C                     PARM           ZAMSTP  7        Message type   CIR005
      *                                                                   CIR005
     C                     ENDSR                                          CIR005
      *                                                                   CIR005
      *****************************************************************   CIR005
     C/COPY WNCPYSRC,DL1604IC62
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,GLINTCZ1                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZFRQB3                                                 CIR005
      /EJECT                                                              CIR005
     O**   Release prono record
     OPRONOPNFE                RELPR
      **   Release Olpos record
     OOLPOSOAFE                RELOL
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ERRMSG - SCREEN MESSAGES
 INVALID KEY, F10 TO REVERSE
 RECORD HAS BEEN UPDATED BY ANOTHER WORKSTATION
 MATURED DEAL
 REVERSED DEAL
Current average
Short term rate
 '/BEN//SC' MUST BE FOLLOWED BY A SIX-DIGIT NUMBER ONLY
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   UPA - Valid codeword characters                                      S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ/
**   UPAN - Valid codeword characters (alphanumeric)                                          CSW201
ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789/                                                         CSW201
**   SWCH - Valid SWIFT ISO format characters                             S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890/-?:().,'+
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
