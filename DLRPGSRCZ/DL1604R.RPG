     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA/IRS maintenance RP/RR/RF delete')         *
/*XBIA*: OVRDBF DEALSCH DEALS                                       : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FRA/IRS Module                                       *
     F*                                                               *
     F*  DL1604R  FRA/IRS DEALS MAINTENANCE PROGRAM - 'RL' DEAL TYPE  *
     F*           INTEREST RATE CAPS/COLLARS                          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD058815           Date 19Jun23               *
      *  Prev Amend No. MD054957           Date 11Dec19               *
      *                 MD051554           Date 28Sep18               *
      *                 MD055733           Date 03Jul20               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CIR017             Date 10Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 08Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 226723             Date 03Mar06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CAS009             Date 16May05               *
      *                 CAS008             Date 16Jun04               *
      *                 CDL028             Date 07Feb05               *
      *                 CGL014             Date 20Oct03               *
      *                 TDA101             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CDE005             Date 19Aug03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CRE009             Date 03Sep02               *
      *                 127972             Date 13Oct97               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP041             Date 07Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 188363             Date 06Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186458             Date 01Dec00               *
      *                 CIR003             Date 12Sep00               *
      *                 CIR006             Date 13Sep00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 179380             Date 28Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      *                 CIR004             Date 20Jan00               *
      *                 CDE001             Date 09Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU003             Date 10Jan98               *
     F*                 121768             Date 20Feb98               *
     F*                 126017             DATE 17Nov97               *
     F*                 097885             Date 31Jan97               *
     F*                 CCB002             Date 25Aug96               *
     F*                 S01408             DATE 04OCT96               *
     F*                 S01408             DATE 27SEP96               *
     F*                 S01408             DATE 02AUG96               *
     F*                 S01408             DATE 29JUL96               *
     F*                 S01408             DATE 18JAN96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 CIR002             DATE 13JUN95               *
     F*                 CIR001             DATE 13JUN95               *
     F*                 S01408             DATE 10MAR95               *
     F*                 064773             DATE 28FEB94               *
     F*                 066550             DATE 04FEB94               *
     F*                 042757             DATE 13JAN94               *
     F*                 046303             DATE 06JAN94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 E38323             DATE 30JUL92               *
     F*                 E23400             DATE 19NOV90               *
     F*                 E20928             DATE 12NOV90               *
     F*                 E23407             DATE 17SEP90               *
     F*                 E20918             DATE 14FEB90               *
     F*                 S01117             DATE 27NOV89               *
     F*                 S01194             DATE 27NOV89               *
     F*                 S01195             DATE 27NOV89               *
     F*                 S01199             DATE 27NOV89               *
     F*                 S01203             DATE 05/04/89              *
     F*                 S01157             DATE 09/11/88              *
     F*                 S01154             DATE 21/06/88              *
     F*                 E13163             DATE 23/05/88              *
     F*                 S01119             DATE 14/07/87              *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Applied for MD061152. (Recompile)                 *
      *  MD054957 - RBRU SP21 Compatibility Patch (Recompile).        *
      *  MD051554 - Leap Year Fix for interest calculation basis to   *
      *             be used for 1st Jan should not be present in      *
      *             FRA/IRS module                                    *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CIR017 - SIRS Business Day Conventions for both legs         *
      *           (Recompile)                                         *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  226723 - Add a sign field for Short Term Rate in order to    *
      *           allow negative entry.  Partially applied 219686.    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  TDA101 - After and Before image data structure (Z#AST        *
      *           and Z#BST) used in program is short FRA/IRS         *
      *           transaction.  (Recompile)                           *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CDE005 - Data Export - Reservation ID                        *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CRE009 - Projected Account Movements for RE Accounts         *
      *  127972 - Array Index is not valid.                           *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CAP041 - APIs for IRS Fees/Buy-Outs/Processing Method/Next   *
      *           Principal Change Date.                              *
      *  188363 - Wrong Interest Payment Date due field taken from    *
      *           DEALSDG(IPBD instead of NIPD).                      *
      *  186458 - Display Confirmation Matching status.               *
      *           - Recompile only.                                   *
      *  CIR003 - Principal Exchange on Cross Currencies IRS          *
      *  CIR006 - Amortisation of Caps/Collars/Floors and Individual  *
      *           Compounding Swaps. Coding done for Amortisation of  *
      *           Caps/Collars/Floors only.                           *
      *  179380 - Confirmation matching status for deal types 'FR'    *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR005 - FRA/IRS Business Day Conventions.                   *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
     F*  CDE001 - Data Export - CCRM Limits                           *
     F*  CEU003 - EMU Dealing Settlement Ccy Conversion               *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  CCB002 - COB Performance Enhancements                        *
     F*           Access now via access object                        *
     F*           MEMOS is now accessed via GL/RE key rather than old *
     F*           relative record number.                             *
     F*  S01408 - Addition of Core Hook DL1604RIP2                    *
     F*           Addition of Core Hook DL1604RIP3                    *
     F*           Addition of Core Hook DL1604RC12
     F*           Addition of Core Hook DL1604RC11
     F*           Addition of Core Hook DL1604RC10
     F*  S01408 Core Hook DL1604RCP9 Added                            *
     F*  S01408 Core Hook DL1604RCP8 Added                            *
     F*         Core Hook DL1604RCP7 Added                            *
     F*  S01408 Core Hook DL1604RCP6 Added                            *
     F*         Core Hook DL1604RCP5 Added                            *
     F*         Core Hook DL1604RCP4 Added                            *
     F*  S01408 Core Hook DL1604RIP1 Added                            *
     F*         Core Hook DL1604RCP1 Added                            *
     F*         Core Hook DL1604RCP2 Added                            *
     F*         Core Hook DL1604RCP3 Added                            *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  CIR002 - Compounding of Interest.                            *
     F*  CIR001 - Interest Rate Calendars.                            *
     F*           Hook DL1600GDTA renamed to refer to QWINDSRC.       *
     F*  S01408 - Addition of Core hooks DL1600GDTA                   *
     F*                                  DL1604RWIN                   *
     F*  064773 - CONDITION CALL TO AORETLR0 ON RETAIL BEING PRESENT. *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  042757 - Projected Nostro account movement value dated on    *
     F*           a non-working day should be reflected on the next   *
     F*           working day (and not on the previous working day).  *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  E38323 - Recompilation of the program dome due to a change   *
     F*           in copy source ZFWDT subroutine                     *
     F*  E23400 - Remove unnecessary use of bit 1 of UDSTI/TDSTI (was *
     F*           used to indicate negative rate but this field,      *
     F*           SUNII, removed by S01157).                          *
     F*  E20928 - Update account movements file RSACMTPD when         *
     F*           settled through a retail a/c as well as when        *
     F*           settled through a nostro.                           *
     F*  E23407 - Check for modules RE(RETAIL 2) or IA(INTEREST ON    *
     F*           ACCOUNTS), rather than RT(RETAIL 1).                *
     F*  E20918 - S01157 causes ZIRATE not being set up for           *
     F*           interest calculation in subroutine MOPSR.           *
     F*           Therefore the output from subroutine GLINTC is      *
     F*           always zero.  It should only update RSACMTPO in     *
     F*           subroutine MOPSR when it is settling through        *
     F*           NOSTRO.                                             *
     F*  S01117 - MULTI-BRANCHING CHANGES.                            *
     F*  S01194 - NEW STANDING DATA CHANGES.                          *
     F*  S01195 - HOLIDAYS PROCESSING.                                *
     F*  S01199 - ABS HELP SYSTEM. (THIS FIX WAS APPLIED TO THIS      *
     F*           PROGRAM FOR R10 AT THE SAME TIME AS IT WAS          *
     F*           APPLIED TO ANOTHER VERSION FOR R2 - THEREFORE       *
     F*           THEY MAY NOT BE INDENTICAL CHANGES)                 *
     F*  S01203 - INCORPORATION CHANGES                               *
     F*  S01157 - 1.CALL DL1911                                       *
     F*           2.ALLOW FLOORS                                      *
     F*           3.REPLACE OUR/THEIR DETAILS WITH REF DETAILS        *
     F*           4.CHANGE RL TO RF/RR/RP                             *
     F*  S01154 - To output a copy of all Retail and Nostro           *
     F*           changes to a new shadow postings file RSACMTPD.     *
     F*  E13163 - CONDITION USE OF MEMOS AND ACNUM ON RETAIL.         *
     F*  S01119 - FRA/IRS INCORPORATION                               *
     F*                                                               *
     F*****************************************************************
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F*CNUM***IF**E           K        DISK                               E13163
     FACNUM   IF  E           K        DISK                           U1  E13163
     F            ACCNTABF                          KRENAMEACNUMABF
     FDTRIXHH UF  E                    DISK
     F                                              KCOMIT
     F*EMOS***UF**E                    DISK                               E13163
     F*MEMOS**UF**E                    DISK                         E13163CCB002
     F************                                  KCOMIT                CCB002
     FOLPOS   UF  E           K        DISK
     F            OLPOSHHF                          KIGNORE
     F            OLPOSOBF                          KIGNORE
     F                                              KCOMIT
     FPRONO   UF  E           K        DISK
     F            PRONOHHF                          KIGNORE
     F                                              KCOMIT
     FDTRIXDD O   E                    DISK
     F                                              KCOMIT
     F*TABDLI**IF**E           K        DISK                              S01194
     F************TABTE10F                          KIGNORE               S01194
     F************TABTE20F                          KIGNORE               S01194
     F************TABTG20F                          KIGNORE               S01194
     F************TABLETSF                          KIGNORE               S01194
     FDEALS   UF  E           K        DISK
     F                                              KCOMIT
     FDEALSCH IF  E           K        DISK
     F            DEALSDAF                          KRENAMEDLSCHDAF
     F            DEALSDBF                          KRENAMEDLSCHDBF
     F            DEALSDCF                          KRENAMEDLSCHDCF
     F            DEALSDDF                          KRENAMEDLSCHDDF
     F            DEALSDEF                          KRENAMEDLSCHDEF
     F            DEALSDFF                          KRENAMEDLSCHDFF
     F            DEALSDGF                          KRENAMEDLSCHDGF
     FDL1600DFCF  E                    WORKSTN
     F            DL1600FB                          KIGNORE
     F            DL1600FC                          KIGNORE
     F            DL1600FD                          KIGNORE
     F            DL1600FE                          KIGNORE
     F            DL1600FF                          KIGNORE
     F            DL1600FG                          KIGNORE
     F            DL1600FH                          KIGNORE
     F            DL1600FI                          KIGNORE
     F            DL1600FJ                          KIGNORE
     F            DL1600FK                          KIGNORE
     F            DL1600FL                          KIGNORE
     F            DL1600FM                          KIGNORE
     F            DL1600FN                          KIGNORE
     F            DL1600FO                          KIGNORE
     F            DL1600FP                          KIGNORE
     F            DL1600FQ                          KIGNORE
     F            DL1600FR                          KIGNORE
     F            DL1600FU                          KIGNORE
     F            DL1600FV                          KIGNORE
     FRSACMTPDO   E                    DISK                               S01154
     F                                              KCOMIT                S01154
     F/COPY WNCPYSRC,DL1604RF01
     E                    CPY@    1   1 80
     E/EJECT
      * ID  F  C  H  L    FUNCTION OF INDICATORS
      *
      **  NB.  THE FUNCTION OF AN INDICATOR SHOULD NOT BE CHANGED
      **  BETWEEN THE PROGRAMS IN THIS SUITE
      ** i.e. BETWEEN DL1600 / DL1601 / DL1602 / DL1603 / DL1604 (I,A,R,E)
      *
      *                 SCREEN RESPONSE INDICATORS:
      *
      *****01***********HELP INDICATOR                                    S01199
      *    01                                                             S01199
      *    02           ROLLUP INDICATOR
      *    03           ROLLDOWN INDICATOR
      *       04
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *
      *       05        DISPLAY 1ST ERROR CODE FIELD
      *       06        DISPLAY 2ND ERROR CODE/MESSAGE FIELD
      *
      *       07        WARNING ERRORS EXIST
      *       08        RECORD UPDATED BY ANOTHER WORKSTATION
      *
      *       09        NON DISPLAY 'FLOOR RATE' LABEL & FIELD
      *
      *                 FIELD IN ERROR
      *
      *       10        NEW DEAL NO.
      *       11        NEW ACTION CODE
      *           OR    PROFIT CENTRE USED FLAG (Y/N)                     S01117
      *       12        NEW DEAL TYPE
      *           OR    PROFIT CENTRE AMENDABLE FLAG (Y/N)                S01117
      *       13        DEAL SUB-TYPE
      *       14        DEAL DATE
      ********15********BRANCH CODE                                       S01117
      *       15        BOOKING BRANCH CODE                               S01117
      *       16        BROKER CODE
      *       17        BROKERAGE AMOUNT
      *       18        LINKED DEAL NO.
      *       19        CUSTOMER NO.
      *       20        VALUE DATE
      *       21        MATURITY DATE
      *       22        CUST. DEAL. ACC. SEQ. NO.
      *       23        (OUR) CURRENCY
      *       24        (OUR) PRINCIPAL AMOUNT
      *       25        (OUR) FED FUNDS IND.
      *       26        OUR BASE CURRENCY EXCHANGE RATE
      *       27        (OUR) CALC. METHOD
      *       28        HEDGE IND.
      *       29        TAXABLE IND.
      *       30        (OUR) NEGATIVE INTEREST IND.
      *       31        OUR FLOATING RATE FIX DAYS
      *       32        OUR BASE RATE TYPE
      *       33        OUR SPREAD/RATE
      *       34        OUR SPREAD IND.
      *       35        THEIR BASE RATE TYPE
      *       36        THEIR SPREAD/RATE
      *       37        THEIR SPREAD IND.
      *       38        RECEIPT SETTLEMENT METHOD
      *       39        PAYMENT SETTLEMENT METHOD
      *       40        OUR RECEIVING ACCOUNT
      *           AND   RECEIVE SETTLEMENT BRANCH                         S01117
      *       41        OUR PAYMENT ACCOUNT
      *           AND   PAY SETTLEMENT BRANCH                             S01117
      *       42        COUNTERPARTY PAYING BANK
      *       43        COUNTERPARTY RECEIVING BANK
      *       44        FOR ACCOUNT OF
      *       45        SPECIAL INSTRUCTIONS
      ********46********THEIR NEGATIVE INTEREST IND.                      S01117
      *       46        ORIGINATING BRANCH                                S01117
      *       47        OUR NEXT INTEREST RATE CHANGE DATE
      *       48        OUR INTEREST RATE CHANGE FREQUENCY
      *       49        OUR INTEREST RATE CHANGE DAY IN MONTH
      *       50        OUR SHORT TERM RATE ( OUR EFFECTIVE INT. RATE )
      *       51        OUR INTEREST PAYMENT DATE
      *       52        OUR INTEREST PAYMENT FREQUENCY
      *       53        OUR INTEREST PAYMENT FREQUENCY DAY IN MONTH
      *       54        OUR FLOOR RATE ENTERED IND
      *       55        THEIR BASE CURRENCY EXCHANGE RATE
      *       56        THEIR INTEREST CALC. BASIS
      *       57        THEIR FLOATING RATE FIX DAYS
      *       58        THEIR NEXT INTEREST RATE CHANGE DATE
      *       59        THEIR INTEREST RATE CHANGE FREQUENCY
      *       60        THEIR INTEREST RATE CHANGE DAY IN MONTH
      *       61        THEIR SHORT TERM RATE (THEIR EFFECT. INT. RATE)
      *       62        THEIR INTEREST PAYMENT DATE
      *       63        THEIR INTEREST PAYMENT FREQUENCY
      *       64        THEIR INTEREST PAYMENT DAY IN MONTH
      *       65        THEIR CURRENCY
      *       66        THEIR PRINCIPAL AMOUNT
      *       67        CEILING RATE
      *       68        FLOOR RATE
      *       69        AVERAGE RATE METHOD
      *       70        THEIR FED. FUNDS IND.
      *
      *                 SCREEN DISPLAY ATTRIBUTE INDICATORS:
      *                 PROTECT FIELD FOR AMEND
      *     ( NB THESE INDICATORS ARE UNIQUE FOR THIS PGM )
      *
      ********71**      PROTECT OUR RATE FIX DAYS                         CEU003
      *       71        'In' currrency in field 72 is not shown on        CEU003
      *                 screen.                                           CEU003
      *       72        PROTECT THEIR RATE FIX DAYS
      ********73**      PROTECT SWORK1 (OUR SHORT TERM/CURRENT RATE)      CEU003
      *       73        Settlement currency is not shown on screen        CEU003
      *       74        PROTECT SWORK2 (THEIR SHORT TERM/CURRENT RATE)
      *       75        PROTECT ALL FIELDS THAT CANNOT BE AMENDED,
      *                 ( EXCEPT THOSE MENTIONED *IN 71-74 & 77-82: )
      *       76        PROTECT OUR RATE CHANGE DATE / FREQ / DAY
      *                         OUR INTEREST PAYMENT DATE / FREQ / DAY
      *       77        PROTECT THEIR RATE CHANGE DATE / FREQ / DAY
      *                         THEIR INTEREST PAYMENT DATE / FRQ / DAY
      *       78        PROTECT HEDGE / TAXABLE IND
      *       79        PROTECT OUR SPREAD - RATE
      *       80        PROTECT OUR BASE RATE CODE / OUR SPREAD IND
      *       81        PROTECT THEIR SPREAD - RATE
      *       82        PROTECT THEIR BASE RATE CODE / THEIR SPREAD IND
      *
      *       83        SYSTEM IS MULTIBRANCH DEALING
      *       84        WORK - TESTING NUMERIC ( ON = ALL NUMERIC )
      *       85        WORK - (SEE COMMENTS IN CODE FOR SPECIFIC USE)
      ********86********NON-TABLE FILE CHAIN FAIL                         S01194
      *       86        FILE CHAIN FAIL                                   S01194
      ********87********SYSTEM IS MULTIBRANCH ACCOUNTING                  S01117
      *       87        ORIGINATING BRANCH USED FLAG (Y/N)                S01117
      *       88        RETAIL ACCOUNT NUMBERS USED IN SYSTEM
      ********89********RETAIL MODULE PRESENT IN SYSTEM                   S01194
      *       89                                                          S01194
      *
      *     90-99       USED IN STANDARD MIDAS SUB-ROUTINES.
      *
      ********98********ZSYSTM, DATE FORMAT MMDDYY IF ON, DDMMYY IF OFF   S01194
      *       98        DATE FORMAT MMDDYY IF ON, DDMMYY IF OFF           S01194
      ********99********TABLE CHAIN FAIL - RECORD NOT FOUND               S01194
      *       99        USED IN ZDATE2                                    S01194
      *
      *       U1        RETAIL MODULE ON, USE ACNUM FILE                  E13163
      *       U2        RETAIL MODULE ON, USE MEMOS FILE                  E13163
      *     U7+U8     DATABASE ERROR
      *
     E                    ERCD       40  4
      *  Error codes
     E                    WRCD       20  4
      *  Warning error codes
     E                    ERRMSG  1   6 76
      *  Warning/Error messages
      *  ( & Screen labels for 'Short term rate' / 'Current average' )
     E                    ZZZ        14  1
      *  Dlscon - store amount with decimal
     E                    ZZQ        13  1 0
      *  Dlscon - store amount as it is
     E                    ZA1        16  1
      *  Zalign input
     E                    ZA2        16  1
      *  Zalign output
     E                    ZYDY    4   4  4 0
      *  Zdate1/2 array
     E                    ZMDY   13  13  3 0
      *  Zdate1/2 array
     E                    ZMNM   12  12  3
      *  Zdate2 array
     E********************ZHC        50  3                                S01195
      ***Zdate5 array*****                                                S01195
     E                    ZFMD   12  12  2
      ***ZfreqB*array                                                     S01194
      *  @freqB array                                                     S01194
     E                    PBAL        5 15 0
     E                    PPAY        5 15 0
     E                    PREC        5 15 0
      *  Projected nostros Balances
     E                    PDAT        5  5 0A
      *  Projected nostros Dates
     E                    OBLI       16 15 0
      *  On line position Incoming Balances
     E                    OBLO       16 15 0
     E*  On line position Outgoing Balances
     E                    ODAT       16  5 0A
     E*  On line position Dates
     E*
      ****Rename*spare*'filler'*fields*to*avoid*fields*with*the*same**    S01119
      ****names*being*defined*with*different*lengths.*****************    S01119
      *
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     IDEALSDCF
     I******        ZZ0375                          ZZ010A                S01119
      *
     IDEALSDDF
     I******        ZZ0063                          ZZ008A                S01119
     I******        ZZ0375                          ZZ016A                S01119
      *
     IDEALSDEF
     I******        ZZ0063                          ZZ014A                S01119
     I******        ZZ0375                          ZZ016A                S01119
      *
     IDLSCHDCF
     I******        ZZ0375                          ZZ010A                S01119
      *
     IDLSCHDDF
     I******        ZZ0063                          ZZ008A                S01119
     I******        ZZ0375                          ZZ016A                S01119
      *
     IDLSCHDEF
     I******        ZZ0063                          ZZ014A                S01119
     I******        ZZ0375                          ZZ016A                S01119
      *
     I*TABTB20F***********                                                S01194
     I******        ZZ0081                          ZZ009A                S01119
      *
     I*TABLETKF***********                                                S01194
     I******        ZZ0063                          ZZ027A                S01119
      *
     I*TABLETLF***********                                                S01194
     I******        ZZ014A                          ZZ002A                S01119
      *
     I*TABLET1F***********                                                S01194
     I******        ZZ0057                          ZZ033A                S01119
      *
     IACCNTABF
     I              ORED                            OREDB
     I******        ZZ0017                          ZZ006A                S01119
     IPSDS       SDS
      *
      **  Data structures :
      *
      **  Program status data structure for workstation ID &  user ID
      *
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
      *
      **  Data structure to update last transaction number dtaara
      *
     IDNATN       DS                              5
     I                                        1   50FNATN
      *
      **   Data structure to provide text on comit entry in journal
      *
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 IACTX
     I                                       26  35 USRIDX
     I*****                                  51 277 SCRN1X                S01194
     I*****                                 278 366 SCRN2X                S01194
     I***********                            51 253 SCRN1X         S01194 CEU003
     I                                       51 256 SCRN1X                CEU003
     I***********                           254 348 SCRN2X         S01194 CEU003
     I                                      257 354 SCRN2X                CEU003
      **  Define 'TIM' field ( HH:MM only )
     I                                       19  220TIM
      ***Data*structure*for setting up key to Table file.                 S01194
     I************DS*******                                               S01194
     I*********************                   1  12 KEY                   S01194
     I*********************                   8  12 WRK5                  S01194
     I*********************                   9  12 WRK4                  S01194
     I*********************                  10  12 WRK3                  S01194
     I*********************                  11  12 WRK2                  S01194
      *
      **  Data structure for Dlscon to redefine array ZZZ as returned
      **  field ZAMTD
      *
     I            DS
     I                                        1  14 ZAMTD
     I                                        1  14 ZZZ
      *
      **  Data structure for Dlscon to redefine array ZZQ as input
      **  field ZAMTW
      *
     I            DS
     I                                        1  130ZAMTW
     I                                        1  130ZZQ
      * Work fields DS for subroutine TSTRTL
     I            DS
     I*********************                   1  15 ERRKEY                S01117
     I**********                              1  18 ERRKEY                             S01117 CGL029
     I                                        1  24 ERRKEY                                    CGL029
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   9 WCCY
     I**********                             10  130WACOD                                     CGL029
     I**********                             14  150WACSQ                                     CGL029
     I**********                             16  18 WWBRCA                             S01117 CGL029
     I                                       10  190WACOD                                     CGL029
     I                                       20  210WACSQ                                     CGL029
     I                                       22  24 WWBRCA                                    CGL029
      * split bank a/c for 'ACCNT' key
     I*********************                  16  27 DBNKAC                S01117
     I*********************                  16  210D16#21                S01117
     I*********************                  22  250D22#25                S01117
     I*********************                  26  27 D26#27                S01117
     I**********                             19  30 DBNKAC                             S01117 CGL029
     I**********                             19  240W@CNUM                             S01117 CGL029
     I**********                             25  280W@ACOD                             S01117 CGL029
     I**********                             29  30 W@ACSQ                             S01117 CGL029
     I                                       25  42 DBNKAC                                    CGL029
     I**********                             25  300W@CNUM                             CGL029 CSD027
     I                                       25  30 W@CNUM                                    CSD027
     I                                       31  400W@ACOD                                    CGL029
     I                                       41  42 W@ACSQ                                    CGL029
      *
      **  Data structure for PRONO updating to redefine array PBAL as
      **  file field PNB  ( Prono balances )
      *
     I            DS
     I                                    P   1  400PBAL
     I                                        1  40 PNB
      *
      **  Data structure for PRONO updating to redefine array PDAT as
      **  file field PND  ( Prono dates )
      *
     I            DS
     I                                    P   1  150PDAT
     I                                        1  15 PND
      *
      **  Data structure for OLPOS updating to redefine array OBLI as
      **  file field OFI  ( Olpos incoming balances )
      *
     I            DS
     I                                    P   1 1280OBLI
     I                                        1 128 OFI
      *
      **  Data structure for OLPOS updating to redefine array OBLO as
      **  file field OFO  ( Olpos outgoing balances )
      *
     I            DS
     I                                    P   1 1280OBLO
     I                                        1 128 OFO
      *
      **  Data structure for OLPOS updating to redefine array ODAT as
      **  file field ODT  ( Olpos dates )
      *
     I            DS
     I                                    P   1  480ODAT
     I                                        1  48 ODT
      *
      **   Data structure to add all first screen fields to comit text
      *
     I            DS
     I                                        1   6 SDLNO
     I                                        7   7 SACCD
     I                                        8   9 SDTYP
     I                                       10  11 SDLST
     I                                       12  17 SDDAT
     I*********************                  18  20 SBRCD                 S01194
     I                                       18  20 SBRCA                 S01194
     I                                       21  24 SBRKC
     I                                       25  38 SBAGE
     I                                       39  44 SLNKDN
     I                                       45  54 SCNUM
     I                                       55  60 SVDAT
     I                                       61  66 SMDAT
     I                                       67  68 SCDAS
     I                                       69  71 SUCUCY
     I                                       72  85 SUPAMT
     I                                       86  86 SUFFI
     I                                       87 100 SUBCXR
     I                                      101 102 SBOKC                 S01117
     I*****                                 101 101 SUICBS                S01117
     I*****                                 102 102 SHEDIN        S01157  S01117
     I*****                                 102 102 SBYSL         S01157  S01117
     I*****                                 103 103 STAXI                 S01117
     I*****                                 104 104 SUNII         S01157  S01117
     I*****                                 105 106 SUBRTT                S01117
     I*****                                 107 118 SURTSP                S01117
     I*****                                 119 119 SUSPIN                S01117
     I*****                                 120 121 SUFRFD                S01117
     I*****                                 122 127 SUNICD                S01117
     I*****                                 128 128 SUICFR                S01117
     I*****                                 129 130 SUICFD                S01117
     I*****                                 131 142 SWORK1                S01117
     I*****                                 143 148 SUNIPD                S01117
     I*****                                 149 149 SUIPFR                S01117
     I*****                                 150 151 SUIPFD                S01117
     I*****                                 152 153 STBRTT                S01117
     I*****                                 154 165 STRTSP                S01117
     I*****                                 166 166 STSPIN                S01117
     I*****                                 167 168 STFRFD                S01117
     I*****                                 169 174 STNICD                S01117
     I*****                                 175 175 STICFR                S01117
     I*****                                 176 177 STICFD                S01117
     I*****                                 178 189 SWORK2                S01117
     I*****                                 190 195 STNIPD                S01117
     I*****                                 196 196 STIPFR                S01117
     I*****                                 197 198 STIPFD                S01117
     I*****                                 199 210 SCLRAT                S01117
     I*****                                 211 222 SFLRAT                S01117
     I*****                                 223 223 SAVRAM                S01117
     I*****                                 224 225 SRSETM                S01117
     I*****                                 226 227 SPSETM                S01117
     I*****                                 228 229 SBOKC         S01157  S01117
      *
     I                                      103 103 SUICBS                S01117
     I                                      104 104 STAXI                 S01117
     I                                      105 108 SPRFC                 S01117
     I                                      109 111 SORBR                 S01117
     I                                      112 112 SBYSL                 S01117
     I                                      113 114 SRBRTT                S01117
     I                                      115 126 SRRTSP                S01117
     I                                      127 127 SRSPIN                S01117
     I                                      128 129 SCFRFD                S01117
     I                                      130 135 SRNICD                S01117
     I                                      136 136 SRICFR                S01117
     I                                      137 138 SCICFD                S01117
     I                                      139 153 SLABLR                S01117
     I                                      154 165 SWORKR                S01117
     I                                      166 171 SRNIPD                S01117
     I                                      172 172 SRIPFR                S01117
     I                                      173 174 SRIPFD                S01117
     I                                      175 186 SCLRAT                S01117
     I                                      187 198 SFLRAT                S01117
     I                                      199 199 SAVRAM                S01117
     I                                      200 201 SRSETM                S01117
     I                                      202 203 SPSETM                S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604RIP2                                           S01408
     I*                                                                   S01408
     I                                      204 209 SUPVD                 CIR001
     I                                      210 223 SUPFE                 CIR001
     I                                      224 226 SSTCY                 CEU003
     I/COPY WNCPYSRC,DL1604RI01
      *
     I***                                     1 227 SCRN1                 S01157
     I********                                1 229 SCRN1          S01157 S01117
     I***********                             1 203 SCRN1           S01117CIR001
     I***********                             1 223 SCRN1          CIR001 CEU003
     I                                        1 226 SCRN1                 CEU003
     I*                                                                   S01408
     I/COPY WNCPYSRC,DL1604RIP3                                           S01408
     I*                                                                   S01408
      *
      **   Data structure to add all second screen fields to comit text
      *
     I            DS
     I*****                                   1  12 SURACC                S01117
     I*****                                  13  24 SUPACC                S01117
     I*****                                  25  34 SCPPBK                S01117
     I*****                                  35  44 SCPRBK                S01117
     I*****                                  45  54 SFACO                 S01117
     I*****                                  55  89 SSPI                  S01117
      *                                                                   S01117
      * For Receive/Pay branches and accounts, use original               S01117
      * file fields, since screen fields only contain branches            S01117
      * if settlement method '05'                                         S01117
      *                                                                   S01117
     I                                        1   3 ROBR                  S01117
     I**********                              4  15 URACC                              S01117 CGL029
     I**********                             16  18 POBR                               S01117 CGL029
     I**********                             19  30 UPACC                              S01117 CGL029
     I**********                             31  40 SCPPBK                             S01117 CGL029
     I**********                             41  50 SCPRBK                             S01117 CGL029
     I**********                             51  60 SFACO                              S01117 CGL029
     I**********                             61  95 SSPI                               S01117 CGL029
     I**********                             96  98 SIC72                              CEU003 CGL029
     I                                        4  21 URACC                                     CGL029
     I                                       22  24 POBR                                      CGL029
     I                                       25  42 UPACC                                     CGL029
     I                                       43  52 SCPPBK                                    CGL029
     I                                       53  62 SCPRBK                                    CGL029
     I                                       63  72 SFACO                                     CGL029
     I                                       73 107 SSPI                                      CGL029
     I                                      108 110 SIC72                                     CGL029
      *
     I*****                                   1  89 SCRN2                 S01117
     I***********                             1  95 SCRN2          S01117 CEU003
     I**********                              1  98 SCRN2                              CEU003 CGL029
     I                                        1 110 SCRN2                                     CGL029
      *
      **   Local data area to hold database error information
      *
     I*LDA*********DS******                      256                      S01194
     I*********************                 134 138 DBFILE                S01194
     I*********************                 139 167 DBKEY                 S01194
     I*********************                 168 175 DBPGM                 S01194
     I*********************                 176 1770DBASE                 S01194
     I*                                                                   S01408
     I/COPY QWINDSRC,DL1600GDTA                                           S01408
     I*                                                                   S01408
     IDBERR       DS                            256                       S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
      *                                                                   CIR005
     IPIRSBS    E DSIRSBDYPD                                              CIR005
      ** Single Currency Business Day Conventions data structure          CIR005
      *                                                                   CIR005
     I                                        1  30 PBDPAY                CIR005
      *                                                                   S01408
     I/COPY WNCPYSRC,DL1604RIP1                                           S01408
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01195
      *                                                                   S01194
      ** Dummy data structures used by access programs                    S01194
      ** (DSSDY only used if file records over 150 chars long)            S01194
      *                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
      ** Access objects programs                                          S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BANK DETAILS                        S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO MIDAS MODULES DETAILS               S01194
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO RETAIL DETAILS                      S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO CURRENCY DETAILS                    S01194
     I*                                                                   S01194
     ISDBROK    E DSSDBROKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BROKER CODES                        S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO GENERAL LEDGER DETAILS              S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO NOSTRO DETAILS                      S01194
     I*                                                                   S01194
     ISDBSRT    E DSSDBSRTPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO NOSTRO DETAILS                      S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I              QQACCD                          QQACC3                                    CGL029
     I** RECORD FORMATS FOR ACCESS TO DEAL DETAILS                        S01194
     I*                                                                   S01194
     ISCSARD    E DSSCSARDPD                                              CIR001
      ** SAR descriptions                                                 CIR001
     I/COPY WNCPYSRC,DL1604RI02
      *                                                                   CIR001
     IZ#BSTS    E DSZ#BST                                                 CIR006
      *                                                                   CIR006
     IZ#ASTS    E DSZ#AST                                                 CIR006
      *                                                                   CIR006
     IZ#WSTS    E DSZ#WST                                                 CIR003
     IZ#XSTS    E DSZ#XST                                                 CIR003
     IZ#YSTS    E DSZ#YST                                                 CIR003
     IZ#ZSTS    E DSZ#ZST                                                 CIR003
     IIRDEAL    E DSDEALSDG                                               CIR006
     I              LCD                             ##LCD                 CIR006
     I              ROBR                            ##ORBR                CIR006
     I              POBR                            ##OPBR                CIR006
     I              URACC                           ##URAC                CIR006
     I              UPACC                           ##UPAC                CIR006
     I*                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I* DATA STRUCTURE IN QTEMP - USER DETAILS                            S01117
     I                                       11  13 ZDBRN                 S01117
     I                                       14  16 @DEPT                 S01117
      *                                                                   CIR001
      * Data structure for Up-front fee (premium) update parameters.      CIR001
      *                                                                   CIR001
     I            DS                                                      CIR001
     I**********                              1  15 XXACC                              CIR001 CGL029
     I                                        1  21 XXACC                                     CGL029
     I**********                              1   60XXCNUM                             CIR001 CSD027
     I                                        1   6 XXCNUM                                    CSD027
     I                                        7   9 XXCCY                 CIR001
     I**********                             10  130XXACOD                             CIR001 CGL029
     I**********                             14  150XXACSQ                             CIR001 CGL029
     I                                       10  190XXACOD                                    CGL029
     I                                       20  210XXACSQ                                    CGL029
      *                                                                   CIR005
     I              'IRSBDYSIN'           C         IRSBSN                CIR005
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      *                                                                   CIR005
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I*                                                                   S01117
      /EJECT
     C                     MOVEACPY@      BIS@   80
      *****************************************************************
      *                                                               *
      *    I N I T I A L   P R O C E S S I N G                        *
      *                                                               *
      *****************************************************************
     C           ACCKEY    KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WCCY    3
     C**********           KFLD           WACOD   40                                          CGL029
     C                     KFLD           WACOD                                               CGL029
     C                     KFLD           WACSQ   20
     C                     KFLD           WWBRCA  3                       S01194
      **
      *
      **   Access  I.C.D. records & test constant data
      *
     C                     EXSR INIT
      *
      *
      **   Receive parameters from calling program
      *
     C           *ENTRY    PLIST
      *
      **   Receiving parameter only
      *
     C                     PARM           TNLUX   50
      *
      **   Sending parameter only
      *
     C* PREV     *INKA     PARM *INKA     CMD1    1                       S01203
     C           *INKC     PARM *INKC     CMD1    1                       S01203
      *
      **   Receiving / Sending parameters
      *
     C                     PARM           NEWDL   6
     C                     PARM           NEWAC   1
     C                     PARM           NEWDT   2
      *                                                                   CIR005
      ** Parameter list for IRSBDYSIN                                     CIR005
      *                                                                   CIR005
     C           PIRSBD    PLIST                                          CIR005
     C                     PARM           WRTCD  10                       CIR005
     C                     PARM           SACCD                           CIR005
     C                     PARM           SDLNO                           CIR005
     C                     PARM           PIRSBS                          CIR005
     C                     PARM           WFKEY   2                       CIR005
      *
      *
      **   Setup screen action code, deal no. & deal type fields
      *
     C                     MOVE NEWAC     SACCD
     C                     MOVE NEWDL     SDLNO
     C                     MOVE NEWDT     SDTYP
     C                     MOVE *BLANKS   SNEWAC
     C                     MOVE *BLANKS   SNEWDL
     C                     MOVE *BLANKS   SNEWDT
      /EJECT
      *****************************************************************
      *                                                               *
      *    M A I N   P R O C E S S I N G                              *
      *                                                               *
      *****************************************************************
      *
      **  Read/write first detail screen
      *
     C                     EXSR SETRL
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
      *                                                                   CIR006
     C                     MOVE URACC     ##URAC                          CIR006
     C                     MOVE UPACC     ##UPAC                          CIR006
     C                     MOVE POBR      ##OPBR                          CIR006
     C                     MOVE ROBR      ##ORBR                          CIR006
     C                     MOVELIRDEAL    Z#BSTS                          CIR006
      *                                                                   CIR006
     C                     CALL 'DL2900'                                  CIR006
     C                     PARM *BLANK    PRTCD   7                       CIR006
     C                     PARM SDLNO     PDLNO   6                       CIR006
     C                     PARM 'B'       PBEAF   1                       CIR006
      *                                                                   CIR006
     C           PRTCD     IFEQ '*ERROR'                                  CIR006
     C                     MOVEL'DL2900'  DBFILE                          CIR006
     C                     Z-ADD30        DBASE                           CIR006
     C                     MOVEL*BLANK    DBKEY                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     EXSR SCRNS
      *
      ****Continue*unless*cmd/1*or*cmd/5*taken**************              S01203
      **  Continue unless cmd/3 or cmd/12 taken                           S01203
      *
     C******     *INKA     DOWNE'1'                                       S01203
     C******     *INKE     ANDNE'1'                                       S01203
     C           *INKC     DOWNE'1'                                       S01203
     C           *INKL     ANDNE'1'                                       S01203
      *
      **  Continue displaying 1st screen until 'ENTER' key is not taken
      *
     C******     *INKA     DOWNE'1'                                       S01203
     C******     *INKE     ANDNE'1'                                       S01203
     C******     *INKD     ANDNE'1'                                       S01203
     C           *INKC     DOWNE'1'                                       S01203
     C           *INKL     ANDNE'1'                                       S01203
     C           *INKJ     ANDNE'1'                                       S01203
     C           *INKH     ANDNE'1'                                       CIR006
     C           *IN02     ANDNE'1'
      *
      **  If 'ENTER' taken, rewrite/read 1st detail screen
      **  with error message
      *
     C                     MOVELERRMSG,1  SERCD2
     C                     SETON                     06
     C                     EXSR SCRNS
     C                     EXSR SETOF
      *
     C                     END
      *
      **  Display 2nd detail screen if ROLLUP taken
      *
     C           *IN02     IFEQ '1'
     C           *INKH     OREQ '1'                                       CIR006
      *                                                                   CIR005
      ** Show Business Day Conventions details                            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           PIRSBS    ANDNE*BLANK                                    CIR005
     C                     CALL IRSBSN    PIRSBD                          CIR005
      *                                                                   CIR005
      ** F3 pressed from Business Day Convention screen, end program      CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '03'                                      CIR005
     C                     MOVE *ON       *INKC                           CIR005
     C                     LEAVE                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** F12 pressed from Business Day Convention screen, back to the     CIR005
      ** first screen                                                     CIR005
      *                                                                   CIR005
     C           WFKEY     IFEQ '12'                                      CIR005
     C                     MOVE *BLANK    WFKEY                           CIR005
     C                     EXSR SCRNS                                     CIR005
     C           *INKC     IFEQ *ON                                       CIR005
     C           *INKL     OREQ *ON                                       CIR005
     C                     LEAVE                                          CIR005
     C                     ENDIF                                          CIR005
     C                     ITER                                           CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      **
     C                     MOVE '0'       *IN02
     C*******************  EXSR SCRNT                                     S01199
     C                     EXFMTDL1600FT                                  S01199
      *
      **  Continue displaying 2nd screen until 'ENTER' key is not taken
      *
     C******     *INKA     DOWNE'1'                                       S01203
     C******     *INKE     ANDNE'1'                                       S01203
     C******     *INKD     ANDNE'1'                                       S01203
     C           *INKC     DOWNE'1'                                       S01203
     C           *INKL     ANDNE'1'                                       S01203
     C           *INKJ     ANDNE'1'                                       S01203
     C           *IN03     ANDNE'1'
      *
      **   If 'ENTER' taken, rewrite/read 2nd detail screen
      **   with error message
      *
     C                     MOVELERRMSG,1  SERCD2
     C                     SETON                     06
     C*******************  EXSR SCRNT                                     S01199
     C                     EXFMTDL1600FT                                  S01199
     C                     EXSR SETOF
      *
     C                     END
      *
      **   Display 1st detail screen if ROLLDOWN taken
      *
     C           *IN03     IFEQ '1'
      *
     C                     MOVE '0'       *IN03
     C                     EXSR SCRNS
      *
     C                     END
      **
     C                     END
      *
      *****If*cmd/4*taken,*update*files*********************              S01203
      **   If cmd/10 taken, update files                                  S01203
      *
     C******     *INKD     IFEQ '1'                                       S01203
     C           *INKJ     IFEQ '1'                                       S01203
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP9                                           S01408
     C*                                                                   S01408
     C           CIR006    IFEQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1604RC37
     C                     EXSR SRDWIN                                    CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     EXSR URLRV
      *****Seton*cmd/5*to*return*to*initial*screen*************           S01203
      **   Seton cmd/12 to return to initial screen                       S01203
      **   after attempted update ( successful or not )
     C******               MOVE '1'       *INKE                           S01203
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP7                                           S01408
      *                                                                   S01408
     C                     MOVE '1'       *INKL                           S01203
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP8                                           S01408
      *                                                                   S01408
      *
     C                     END
      **
     C                     END
      *
      *****If*cmd/5,*write/read*initial*screen**************              S01203
      **   If cmd/12, write/read initial screen                           S01203
      *
     C******     *INKE     IFEQ '1'                                       S01203
     C           *INKL     IFEQ '1'                                       S01203
     C*                                                                   S01117
     C* Since *IN11 is used for Profit Centre used as well as             S01117
     C* action code error, set off *IN11 to prevent highlighting          S01117
     C* action code field on initial screen                               S01117
     C*                                                                   S01117
     C                     SETOF                     11                   S01117
     C*                                                                   S01117
     C                     EXSR SETOF
     C***************      EXSR SCRNA                                     S01199
     C/COPY WNCPYSRC,DL1604RC02
     C                     EXFMTDL1600FA                                  S01199
     C/COPY WNCPYSRC,DL1604RC03
      **   If 'Record updated by....' clear message after display
     C           *IN08     IFEQ '1'
     C                     MOVE '0'       *IN,08
     C                     MOVE *BLANKS   SERCD2
     C                     END
      *
     C                     END
      /SPACE 2
      *****************************************************************
      *                                                               *
      *    F I N A L   P R O C E S S I N G                            *
      *                                                               *
      *****************************************************************
      **   Setup parameter action code, deal no. & deal type fields
     C                     MOVE SNEWAC    NEWAC
     C                     MOVE SNEWDL    NEWDL
     C                     MOVE SNEWDT    NEWDT
      *
     C                     SETON                     LR
      /EJECT
      *****************************************************************
      *                                                               *
      *                    INDEX TO SUBROUTINES                       *
      *                                                               *
      * Standard subroutines:                                         *
      *                                                               *
      *   ZDATE1  : Validate dates & convert to no. of days           *
      *   ZDATE2  : Convert no. of days to date format                *
      ****ZDATE5**:*Determine if a day no. is a holiday               *   S01195
      *   ZCHKH   : DETERMINE IF DAY NO. IS A HOLIDAY                 *   S01195
      *   ZACCH   : Determine if AOHOLRO needs to be called and sets  *   S01195
      *             up the holiday record appropriately               *   S01195
      *   ZFWDT   : Determine the nth working day forward for a given *   S01195
      *             start date, currency and location                 *   S01195
      ****ZSYSTM**:*Chain*I.C.D. record 1                             *   S01194
      *   ZTNLU1  : Update last transaction data area                 *
      ****ZFREQB**:*Increment*date*by*given*period*********************   S01195
      *   @FREQB  : INCREMENT DATE BY GIVEN PERIOD (STANDARD SR ZFREQB*   S01195
      *   ZSAVE   : Memorise & set off Indicators 90 - 97             *
      *   ZRSTOR  : Restore Indicators 90 - 97 to pre- SR.ZSAVE values*
      *                                                               *
      *   GLINTC  : Calculate interest between two dates              *
      *   TSTRTL  : Test account details to see if retail (& get key) *
      *   DLSCON  : Format numeric file field for screen field display*
      *   GLZADD  : Add amount to total for hashing                   *
      *   GLZSUB  : Subtract amount from total for hashing            *
      *   GLZSUM  : Carry out addition of GLZADD & GLZSUB             *
      *                                                               *
      * Program subroutines:                                          *
      *                                                               *
      ****INIT****:*Initial*proc**-*access*ICD*&*check*constant*data***   S01194
      *   INIT    : INITIAL PROC.- ACCESS STANDING DATA & CHECK       *   S01194
      *   SETRL   : Format file data for screen display               *
      ****SCRNA***:*Write/Read*&*call*HELP*for*initial*screen*A********   S01199
      ****SCRNS***:*Write/Read*&*call HELP for 1st reversal screen S  *   S01199
      *   SCRNS   : Write/Read for 1st reversal screen S              *   S01199
      ****SCRNT***:*Write/Read*&*call*HELP*for*2nd*reversal*screen*T***   S01199
      *   SETOF   : Setof all error inds./clear arrays & screen fields*
      ****HELP****:*Call*MHELP*pgm & pass error /warning error codes  *   S01199
      *   URLRV   : Update file records for a reverse                 *
      *   UMEMOS  : Update PF/MEMOS                                   *
      *   URDLDG  : Update PF/DEALSDG for a reverse                   *
      *   WDTDD   : Write PF/DTRIXDD record                           *
      *   UOLPOS  : Update LF/OLPOS                                   *
      *   UPRONO  : Update LF/PRONO                                   *
      *   OUTPOS  : Outputs posting details to RSACMTPD               *   S01154
      *   MOPSR   : Calculate interest due and update M/O/P balances. *
      *   UDLDF   : Update PF/DEALSDF                                 *
      *   UDTHH   : Update PF/DTRIXHH                                 *
      *   CONFI   : Set confirmation indicators ( P/DLU018 )          *
      *   CMTXT   : Set up text on comit entry in journal             *
      ****DBERR***:*Database error handling - update LDA & exit pgm   *   S01194
      *   *PSSR   : Database error handling                           *   S01194
      *                                                               *
      *****************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*********************                                               S01195
     C*****ZDATE5*SR.*TO*DETERMINE IF A DAY NUMBER DATE IS A HOLIDAY      S01195
     C****************IN*GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY         S01195
     C****************AND*IF REQUIRED, DETERMINE NEXT WORKING DAY.        S01195
     C*********************                                               S01195
     C***********ZDATE5****BEGSR                           *** ZDATE5 *** S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE INPUT FIELDS.                           S01195
     C*********************Z-ADDZDAYNO    ZDAYNO  50                      S01195
     C*********************MOVE ZCCY      ZCCY    3                       S01195
     C*********************MOVE ZOPT      ZOPT    1                       S01195
     C*********************                                               S01195
     C*****CALCULATIONS*TO*DEFINE/CLEAR WORKFIELDS.                       S01195
     C*********************MOVE '   '     ZHC                             S01195
     C*********************                                               S01195
     C*****RESET*INDICATOR.                                               S01195
     C*********************SETOF                     99                   S01195
     C*********************                                               S01195
     C*****CALCULATION*TO*DEFINE/SET OUTPUT FIELD.                        S01195
     C*********************Z-ADDZDAYNO    ZDYNBR  50                      S01195
     C*********************                                               S01195
     C*****DETERMINE*IF*HOLIDAY                                           S01195
     C***********ZDHOL*****TAG                             ** ZDHOL TAG **S01195
     C*********************SETOF                     91                   S01195
     C*********************                                               S01195
     C*****SET*KEY*FOR*FIRST HOLIDAY RECORD.                              S01195
     C*********************MOVEL'22      'ZTABKY 12                       S01195
     C*********************MOVELZDYNBR    ZWRK6   6                       S01195
     C*********************MOVE '1'       ZWRK6                           S01195
     C*********************MOVE ZWRK6     ZTABKY                          S01195
     C*********************                                               S01195
     C*****CHAIN*FOR*HOLIDAY RECORD, RECORD 1 OR 2.                       S01195
     C***********ZDHCH5****TAG                             ** ZDHCH5 TAG *S01195
     C***********ZTABKY****CHAINTABDLI               90    ON NOT THERE   S01195
     C**N90******RECI******COMP 'D'                  9090  DELETED        S01195
     C*********************                                               S01195
     C*****STORE*CURRENCIES IF RECORD FOUND.                              S01195
     C**N90N91*************MOVEAHCCY      ZHC,1                           S01195
     C***91N90*************MOVEAHCCY      ZHC,26                          S01195
     C*********************                                               S01195
     C*****GET*SECOND*RECORD, IF NOT ALREADY DONE.                        S01195
     C*********************MOVE ZTABKY    ZWRK1N  10                      S01195
     C***********ZWRK1N****COMP 1                        91               S01195
     C*********************MOVE '2'       ZTABKY                          S01195
     C***91N90*************GOTO ZDHCH5                                    S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NO FIRST RECORD FOUND.                        S01195
     C***90*91*************GOTO ZDEND5                                    S01195
     C*********************                                               S01195
     C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
     C***********INEX******COMP 'E'                      92               S01195
     C***********INEX******COMP 'I'                      93               S01195
     C*********************                                               S01195
     C*****CHECK*IF*CURRENCY ON HOLIDAY.                                  S01195
     C***********ZCCY******LOKUPZHC                      94               S01195
     C*********************                                               S01195
     C*****BYPASS*TO*END*IF NOT HOLIDAY FOR CURRENCY.                     S01195
     C***92*94*************                                               S01195
     C*OR*93N94************ GOTO ZDEND5                                   S01195
     C*********************                                               S01195
     C*****SET*INDICATOR FOR HOLIDAY FOR DAY NUMBER.                      S01195
     C*********************SETON                     99                   S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C*****CHECK*IF*NEXT*WORKING DAY REQUIRED.                            S01195
     C***********ZOPT******COMP 'Y'                      95               S01195
     C***95******ZDYNBR****ADD  1         ZDYNBR                          S01195
     C***95****************GOTO ZDHOL                                     S01195
     C*********************                                               S01195
     C*********************                                               S01195
     C***********ZDEND5****ENDSR                           * ZDEND5 ENDSR*S01195
     C********************************************************************S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      *                                                                   S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
      *                                                                   S01195
     C********************************************************************
     C**
      /SPACE 2
     C********************************************************************S01194
     C*********************                                               S01194
     C*****ZSYSTM*SR.*TO*CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
     C*********************                                               S01194
     C***********ZSYSTM****BEGSR                           *** ZSYSTM *** S01194
     C*********************                                               S01194
     C*****SET*UP*KEY*FOR*INSTALLATION CONTROL RECORD.                    S01194
     C*********************MOVEL'01      'ZTABKY 12                       S01194
     C*********************MOVE '  10'    ZTABKY                          S01194
     C*********************                                               S01194
     C***********ZTABKY****CHAINTABDLI               99    ON NOT THERE   S01194
     C**N99******RECI******COMP 'D'                  9999  ON, IS DELETED S01194
     C*********************                                               S01194
     C*****CHECK*SYSTEM*DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C***********DATF******COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*********************                                               S01194
     C*********************ENDSR                                          S01194
     C*********************                                               S01194
     C********************************************************************S01194
      /SPACE 2
     C********************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************
      /EJECT
3571 C********************************************************************
3657 C**
3658 C*****ZFREQ*-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A****             S01195
3658 C**   @FREQB - SR. TO INCREMENT A DAY NUMBER DATE BY A               S01195
3659 C**             PERIOD VALUE DETERMINED BY A CODE.
3660 C**
3661 C*****      ZFREQB    BEGSR                           *** ZFREQB *** S01195
3661 C           @FREQB    BEGSR                           *** @FREQB *** S01195
3662 C**
3663 C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
3664 C                     MOVE ZFREQ     ZFREQ   1
3665 C                     Z-ADDZDAYNO    ZDAYNO  50
3666 C                     Z-ADDZMDAY     ZMDAY   20
3667 C                     MOVE ZCCY      ZCCY    3
3668 C**
3669 C******               MOVE '   '     ZHC                             S01195
3670 C******               MOVE ' '       ZTABKY 12                       S01195
3671 C*
3672 C*            FIELDS USED FOR PERIOD CODES M,T,Q,X,Y
3673 C*
3674 C                     MOVE '  '      ZINDE   2
3675 C                     Z-ADD0         ZINTO   20
3676 C**
3677 C**   CONVERT DAY NUMBER TO DATE.
3678 C                     EXSR ZDATE2
3679 C                     SETOF                     90
3680 C**
3681 C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.
3682 C           ZFREQ     COMP 'D'                      91
3683 C   91      ZDAYNO    ADD  1         ZDAYNO
3684 C   91                GOTO ZFHCHK
3685 C**
3686 C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.
3687 C           ZFREQ     COMP 'W'                      91
3688 C   91      ZDAYNO    ADD  7         ZDAYNO
3689 C   91                GOTO ZFEND
3690 C**
3691 C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.
3692 C           ZFREQ     COMP 'F'                      91
3693 C   91      ZDAYNO    ADD  14        ZDAYNO
3694 C   91                GOTO ZFEND
3695 C**
3696 C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.
3697 C           ZFREQ     COMP 'S'                      91
3698 C   91      ZDAY      COMP 15                   939292
3699 C   91 92             Z-ADD31        ZDAY
3700 C   91 93             Z-ADD15        ZDAY
3701 C   91 93   ZMTH      ADD  1         ZMTH
3702 C   91                GOTO ZFDATE
3703 C**
3704 C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.
3705 C           ZFREQ     COMP 'M'                      91
3706 C   91                MOVE 'IN'      ZINDE
3707 C   91                Z-ADDZMDAY     ZDAY
3708 C   91      ZMTH      ADD  1         ZMTH
3709 C   91                GOTO ZFDATE
3710 C**
3711 C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTH
3712 C           ZFREQ     COMP 'R'                      91
3713 C   91                Z-ADD31        ZDAY
3714 C   91      ZMTH      ADD  1         ZMTH
3715 C   91                GOTO ZFDATE
3716 C**
3717 C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.
3718 C           ZFREQ     COMP 'T'                      91
3719 C   91                MOVE 'IN'      ZINDE
3720 C   91                Z-ADDZMDAY     ZDAY
3721 C   91      ZMTH      ADD  2         ZMTH
3722 C   91                GOTO ZFDATE
3723 C**
3724 C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.
3725 C           ZFREQ     COMP 'Q'                      91
3726 C   91                MOVE 'IN'      ZINDE
3727 C   91                Z-ADDZMDAY     ZDAY
3728 C   91      ZMTH      ADD  3         ZMTH
3729 C   91                GOTO ZFDATE
3730 C**
3731 C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.
3732 C           ZFREQ     COMP 'X'                      91
3733 C   91                MOVE 'IN'      ZINDE
3734 C   91                Z-ADDZMDAY     ZDAY
3735 C   91      ZMTH      ADD  6         ZMTH
3736 C   91                GOTO ZFDATE
3737 C**
3738 C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.
3739 C           ZFREQ     COMP 'Y'                      91
3740 C   91                MOVE 'IN'      ZINDE
3734 C   91                Z-ADDZMDAY     ZDAY
3741 C   91      ZYEAR     ADD  1         ZYEAR
3742 C   91                GOTO ZFDATE
3743 C**
3744 C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH.
3745 C           ZFREQ     COMP 'L'                      91
3746 C   91                Z-ADD31        ZDAY
3747 C   91      ZMTH      ADD  1         ZMTH
3748 C   91                GOTO ZFDATE
3749 C**
3750 C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.
3751 C           ZFREQ     COMP 'B'                      91
3752 C   91                Z-ADD31        ZDAY
3753 C   91      ZMTH      ADD  1         ZMTH
3754 C   91                GOTO ZFDATE
3755 C**
3756 C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.
3757 C           ZFREQ     COMP 'A'                      91
3758 C**                   MOVEL'01    '  ZTABKY
3758 C***91*               MOVEL'01    '  ZTABKY                          S01195
3759 C***91*               MOVE '    11'  ZTABKY                          S01195
3760 C***91*     ZTABKY    CHAINTABLE                99    ON NOT THERE   S01195
3761 C**N99*     RECI      COMP '*'                      99               S01195
3762 C***91N99             Z-ADDAPDA      ZDAYNO                          S01194
3762 C   91                Z-ADDBKAPDT    ZDAYNO                          S01194
3763 C**
3764 C**   BYPASS IF ZFREQ IS 'A' OR ANY OTHER VALUE
3765 C                     GOTO ZFEND
3766 C**
3767 C**
3768 C**   REFORMAT DATE AND ENSURE VALID.
3769 C           ZFDATE    TAG                             ** ZFDATE TAG*
3770 C**
3771 C**   VALIDATE MONTH.
3772 C           ZMTH      COMP 12                   91
3773 C   91      ZMTH      SUB  12        ZMTH
3774 C   91      ZYEAR     ADD  1         ZYEAR
3775 C**
3776 C**   CHECK FOR LEAP YEAR.
3777 C           ZYEAR     DIV  4         ZLYR    20
3778 C                     MVR            ZLY     10     92LEAP YEAR-92 ON
3779 C**
3780 C**   VALIDATE DAY NUMBER.
3781 C                     MOVE ZFMD,ZMTH ZWRK2   20
3782 C           ZMTH      COMP 2                        93
3783 C   92 93             Z-ADD29        ZWRK2
3784 C**
3785 C           ZDAY      COMP ZWRK2                94
3786 C   94                Z-ADDZWRK2     ZDAY
3787 C**
3788 C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.
3789 C           ZFREQ     COMP 'R'                      91
3790 C   91      ZDAY      SUB  6         ZDAY
3791 C**
3792 C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
3793 C                     MOVELZDAY      ZWRK4   40
3794 C                     MOVE ZMTH      ZWRK4
3795 C   98                MOVELZMTH      ZWRK4
3796 C   98                MOVE ZDAY      ZWRK4
3797 C                     MOVELZWRK4     ZDATE
3798 C                     MOVE ZYEAR     ZDATE
3799 C                     EXSR ZDATE1
3800 C**
3801 C**   CHECK IF CODE B, OR M,T,Q,X,Y TO BE CHECKED FOR HOLIDAY.
3802 C           ZFREQ     COMP 'B'                      91
3803 C           ZINDE     COMP 'IN'                     92
3804 C   92N99
3805 COR 91N99             GOTO ZFHCHK
3806 C**
3807 C                     GOTO ZFEND
3808 C**
3809 C**   CHECK IF DAY NUMBER IS A HOLIDAY.
3810 C**
3811 C           ZFHCHK    TAG                             ** ZFHCHK TAG *
3812 C                     SETOF                     94
3813 C           ZFREQ     COMP 'D'                      91
3814 C           ZFREQ     COMP 'B'                      92
3815 C   91
3816 COR 92                GOTO ZSETK
3817 C*
3818 C*   FOR CODES M,T,Q,X,Y, CHECK ZINDE - 'IN' TO INCREMENT,
3819 C*                                    - 'DE' TO DECREMENT
3820 C*
3821 C           ZINDE     COMP 'IN'                     90
3822 C           ZINDE     COMP 'IN'                     91
3823 C           ZINDE     COMP 'DE'                     92
3824 C******                                                              S01195
3825 C******ET KEY FOR FIRST HOLIDAY RECORD.                              S01195
3826 C           ZSETK     TAG                             ** ZSETK TAG **
3827 C******               MOVEL'22    '  ZTABKY                          S01195
3828 C******               MOVELZDAYNO    ZWRK6   6                       S01195
3829 C******               MOVE 1         ZWRK6                           S01195
3830 C******               MOVE ZWRK6     ZTABKY                          S01195
3831 C******                                                              S01195
3832 C******ET HOLIDAY RECORD.                                            S01195
3833 C******     ZFHCHN    TAG                             ** ZFHCHN TAG* S01195
3834 C******     ZTABKY    CHAINTABLE                93    ON NOT THERE   S01195
3835 C**N93*     RECI      COMP '*'                      93               S01195
     C**N94*               MOVE '   '     ZHC                             S01195
3836 C******                                                              S01195
3837 C*****STORE CURRENCIES IF RECORD FOUND.                              S01195
3838 C**N94N93             MOVEAHCCY      ZHC,1                           S01195
3839 C***94N93             MOVEAHCCY      ZHC,26                          S01195
3840 C********                                                            S01195
3841 C*****GET SECOND RECORD, IF NOT ALREADY DONE.                        S01195
3842 C********             MOVE ZTABKY    ZWRK1N  10                      S01195
3843 C********   ZWRK1N    COMP 1                        94               S01195
3844 C********             MOVE '2'       ZTABKY                          S01195
3845 C***94N93             GOTO ZFHCHN                                    S01195
3846 C********                                                            S01195
3847 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
3848 C***93*94             GOTO ZFEND                                     S01195
3849 C*                                                                   S01195
     C                     EXSR ZCHKH                                     S01195
     C*                                                                   S01195
3850 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
3851 C********   INEX      COMP 'E'                      95               S01195
3852 C********   INEX      COMP 'I'                      96               S01195
3853 C********                                                            S01195
3854 C*    CHECK IF CURRENCY ON HOLIDAY.                                  S01195
     C*                                                                   S01195
3855 C********   ZCCY      LOKUPZHC                      97               S01195
     C           ZIND      CABEQ'W'       ZFEND                           S01195
3856 C**
3857 C**   BYPASS IF NOT HOLIDAY FOR CURRENCY.
3858 C***95*97                                             EXCLUDE FOUND  S01195
3859 C*R*96N97             GOTO ZFEND                      INCL. NOT FOUNDS01195
3860 C**
3861 C**
3862 C   92                GOTO ZDECR
3863 C*
3864 C**   INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.
3865 C   91      ZDAYNO    ADD  1         ZDAYNO
3866 C*
3867 C*    ONLY FOR PERIOD CODE = M,T,Q,X OR Y, IF INCREMENTATION
3868 C*    TAKES THE OUTPUT DATE INTO THE FOLLOWING MONTH, RETURN TO
3869 C*    THE INPUT DATE AND DECREMENT - 92 ON.
3870 C*
3871 C   90 91   ZINTO     ADD  1         ZINTO
3872 C   90 91   ZINTO     ADD  ZDAY      ZINTOT  20
3873 C   90 91             MOVE ZINTOT    ZINTOA  2
     C**TO ALLOW 29 FEB ON LEAP YEARS TO PASS
     C                     SETOF                     93
     C   90 91   ZYEAR     DIV  4         ZLYR
     C   90 91             MVR            ZLY            92
     C   90 91 92ZMTH      COMP 2                        93
     C   93      ZINTOA    COMP '29'                 92
     C   90 91N93ZINTOA    COMP ZFMD,ZMTH            92
2803 C** 90 91   ZINTOA    COMP ZFMD,ZMTH            92
3875 C   90 91 92ZDAYNO    SUB  ZINTO     ZDAYNO
3876 C   90 91 92          MOVE 'DE'      ZINDE
3877 C**
3878 C           ZDECR     TAG                             ** ZDECR TAG **
3879 C***92*95N97                                          EXCL. NOT FOUNDS01195
3880 C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO           INCLUDE FOUND  S01195
3880 C   92      ZDAYNO    SUB  1         ZDAYNO                          S01195
3881 C                     GOTO ZFHCHK
3882 C**
3883 C**
3884 C           ZFEND     ENDSR                           * ZFEND ENDSR *
3885 C**
3886 C********************************************************************
      /EJECT
     C********************************************************************
     C**
     C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
     C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
     C**
     C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
     C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
     C**
     C           ZSAVE     BEGSR                           *** ZSAVE ***
     C**
     C                     BITOF'01234567'ZBITS   1
     C   90                BITON'0'       ZBITS
     C   91                BITON'1'       ZBITS
     C   92                BITON'2'       ZBITS
     C   93                BITON'3'       ZBITS
     C   94                BITON'4'       ZBITS
     C   95                BITON'5'       ZBITS
     C   96                BITON'6'       ZBITS
     C   97                BITON'7'       ZBITS
     C**
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     9697
     C**
     C                     ENDSR
     C********************************************************************
      /SPACE 3
     C********************************************************************
     C**
     C**   ZRSTOR SR. TO RESTORE INDICATORS 90 - 97 TO THE SETTINGS
     C**              THEY HAD BEFORE THE EXECUTION OF SR. ZSAVE.
     C**
     C           ZRSTOR    BEGSR                           *** ZRSTOR ***
     C**
     C                     TESTB'0'       ZBITS          90
     C                     TESTB'1'       ZBITS          91
     C                     TESTB'2'       ZBITS          92
     C                     TESTB'3'       ZBITS          93
     C                     TESTB'4'       ZBITS          94
     C                     TESTB'5'       ZBITS          95
     C                     TESTB'6'       ZBITS          96
     C                     TESTB'7'       ZBITS          97
     C**
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************066550
     C***********                                                         066550
     C*****GLINTC SR. TO CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS.  066550
     C***********                                                         066550
     C*****THIS*VERSION REPLACES THE ORIGINAL GLINTC SR. NOW NAMED        066550
     C*****GLINTO.                                                        066550
     C***********                                                         066550
     C*****CALCULATION METHODS ARE -                                      066550
     C*****1**ACTUAL/365                                                  066550
     C*****2**ACTUAL/360                                                  066550
     C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
     C*****4**365/365 (EXCLUDING 29/02)                                   066550
     C*****5**365/360 (EXCLUDING 29/02)                                   066550
     C*****6**ACTUAL/366                                                  066550
     C***********                                                         066550
     C*****REQUIRES SUBRS. - ZDATE2, ZSAVE, & ZRSTOR.                     066550
     C***********                                                         066550
     C***********                                                         066550
     C*R*********GLINTC    BEGSR                           ** GLINTC  **  066550
     C***********                                                         066550
     C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           066550
     C*R*********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  066550
     C*R*********          Z-ADDZIEND     ZIEND   50       FINISHING DATE 066550
     C*R*********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    066550
     C*R*********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      066550
     C*R*********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST 066550
     C***********                                                         066550
     C****TO*DETERMINE NUMBER OF DAYS INTEREST TO BE CALCULATED           066550
     C*R*********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
     C***********                                                         066550
     C****CHECK*FOR INTEREST CALCULATION BASIS                            066550
     C*****USE*OF INDICATRS                                               066550
     C*****1,92**2,90  3,91  4,97  5,96  6,95                             066550
     C***********          SETOF                     959697               066550
     C*R*********ZICALC    COMP 2                    919290               066550
     C**N91******          GOTO ZICAL                                     066550
     C***********ZICALC    COMP 5                    959796               066550
     C***97******ZICALC    COMP 3                    97  91               066550
     C***95******                                                         066550
     C*R*96******          SETOF                     91                   066550
     C**N91******          GOTO ZILPCK                                    066550
     C***********                                                         066550
     C*****THIS*CODING WILL CALCULATE THE NUMBER OF DAYS TO USE WHEN      066550
     C*****USING*THE 30/360 BASIS - METHOD 3.                             066550
     C***********          EXSR ZSAVE                                     066550
     C***********          Z-ADDZIBEG     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZISD    20                      066550
     C***********          MOVE ZMTH      ZISM    20                      066550
     C***********          MOVE ZYEAR     ZISY    20                      066550
     C***********          Z-ADDZIEND     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZIFD    20                      066550
     C***********          MOVE ZMTH      ZIFM    20                      066550
     C***********          MOVE ZYEAR     ZIFY    20                      066550
     C***********          EXSR ZRSTOR                                    066550
     C***********          SETOF                     93                   066550
     C****IN*ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF  066550
     C****ZIEND*IS GREATER THAN ZIBEG,THEN THE DATE ZIEND MUST BE IN A    066550
     C****DIFFERENT CENTURY TO ZIBEG.IF SO ADD 100 YEARS TO IT.           066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER START YEAR IS A LEAP YEAR AND IF START       066550
     C*****MONTH*IS FEBRUARY.                                             066550
     C***********                                                         066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZISM      COMP 2                        99*FEBRUARY      066550
     C**N99******30        SUB  ZISD      ZID1    50   93                 066550
     C**N99*93***          Z-ADD0         ZID1                            066550
     C***99N98***28        SUB  ZISD      ZID1                            066550
     C***99*98***29        SUB  ZISD      ZID1                            066550
     C***********ZISM      COMP 12                       93               066550
     C***93******          Z-ADD0         ZISM                            066550
     C***93******ZISY      ADD  1         ZISY                            066550
     C***93******ZISY2     ADD  1         ZISY2                           066550
     C***********                                                         066550
     C*****DETERMINE WHETHER END YEAR IS A LEAP YEAR AND IF END MONTH     066550
     C*****IS*FEBRUARY.                                                   066550
     C***********                                                         066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZIFM      COMP 2                        99*FEBRUARY      066550
     C**N99******ZIFD      COMP 31                       93               066550
     C***99N98***ZIFD      COMP 28                       93               066550
     C***99*98***ZIFD      COMP 29                       93               066550
     C***93******ZID1      ADD  30        ZID1                            066550
     C**N93******ZID1      ADD  ZIFD      ZID1                            066550
     C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
     C***93******          GOTO ZIOUT                                     066550
     C***********12        SUB  ZISM      ZIM1    20                      066550
     C***********          Z-ADD1         ZISM                            066550
     C*****USE*ENLARGED FIELDS THAT CAN HANDLE 1999 ONWARDS               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
     C***********ZIY1      MULT 12        ZIM2    30                      066550
     C***********ZIM2      ADD  ZIFM      ZIM2                            066550
     C***********ZIM1      ADD  ZIM2      ZINOM                           066550
     C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
     C***********ZINOM     MULT 30        ZID2    50                      066550
     C***********ZID2      ADD  ZID1      ZDAYN1                          066550
     C***********          SETOF                     93                   066550
     C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
     C**N96N97***          GOTO ZICAL                                     066550
     C*****THE*FOLLOWING CODING APPLIES FOR METHODS 4 AND 5 ONLY.         066550
     C*****1*DAY*IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB   066550
     C*****IN*THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG, & ZIEND.066550
     C***********                                                         066550
     C*****FIND*NO OF 4 YEAR PERIODS BETWEEN DATES                        066550
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
     C***********          MVR            ZIREM   50                      066550
     C*****FIND*NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.                    066550
     C***********ZIBEG     SUB  60        ZIBW1   50                      066550
     C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
     C***********          MVR            ZIDREM  50                      066550
     C***********ZIDREM    COMP 0                        94               066550
     C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
     C***94******          GOTO ZILP1                                     066550
     C*****ROUND*UP RESULT                                                066550
     C***********ZIDW1     ADD  1         ZIDW2                           066550
     C*****CALCULATE NEXT 29 FEB.                                         066550
     C***********ZIDW2     MULT 1461      ZIDW2                           066550
     C***********ZIDW2     ADD  60        ZIDW2                           066550
     C***********ZILP1     TAG                             * ZILP1 TAG *  066550
     C*****IF*THIS NEXT 29 FEB. DAYNO - ZIBEG IS GR. TH. OR EQ. TO        066550
     C*****ZIREM*THEN ADD 1 TO ZIMAN.                                     066550
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
     C***********ZIREM     COMP ZILPCP               94  94               066550
     C***94******ZIMAN     ADD  1         ZIMAN                           066550
     C*****SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1             066550
     C*****REQUIRED FOR THIS INTEREST CALCULATION.                        066550
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
     C***********          SETOF                     94                   066550
     C***********ZICAL     TAG                             * ZICAL TAG *  066550
     C***********                                                         066550
     C****CALCULATE INTEREST                                              066550
     C***90******                                                         066550
     C*R*91******                                                         066550
     C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
     C***92******                                                         066550
     C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
     C*R*********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
     C*R*********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST 066550
     C***********                                                         066550
     C***********          SETOF                     909192               066550
     C***********          SETOF                     959697               066550
     C*R*********          ENDSR                                          066550
     C***********                                                         066550
     C********************************************************************066550
      /EJECT
     C***************************************************************
     C* STANDARD SUBROUTINE FOR DL1601-4 :- SET UP KEY FOR FILE     *
     C* 'ACCNT' GET RECORD & IF FOUND,ACTIVE & RETAIL RETURN RRN    *
     C* OF MEMO RECORD OTHERWISE RETURN RRN OF ZERO.                *
     C*     FIELDS EXPECTED :-                                      *
     C*                        DCNUM.....CUSTOMER NUMBER.           *
     C*                        DDCCY.....DEAL CURRENCY.             *
     C*                        DBNKAC....BANK A/C NUMBER.           *
     C*                        DSETM.....SETTLEMENT TYPE.           *
     C*                                                             *
     C***************************************************************
     C*
     C           TSTRTL    BEGSR
     C*
     C* SET ROUTINE FIELDS
     C*
     C**********           Z-ADDDCNUM     DCNUM   60                                          CSD027
     C                     MOVE DCNUM     DCNUM   6                                           CSD027
     C                     MOVE DDCCY     DDCCY   3
     C*
     C********** MBIN      IFNE 'Y'                                       S01117
     C                     MOVE '01'      DACSQ   2
     C******************** ELSE                                           S01117
     C******************** MOVE NSACS     DACSQ                           S01117
     C******************** END                                            S01117
     C*
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'Y'       WRETL   1                       CCB002
     C*                                                                   S01154
     C* Initialise shadow postings work indicator                         S01154
     C*                                                                   S01154
     C                     MOVE 'N'       WNOST   1                       S01154
     C*
     C* SETTLEMENT TYPES 01 02 07 08 & 12
     C*
     C           DSETM     IFEQ '01'
     C           DSETM     OREQ '02'
     C           DSETM     OREQ '07'
     C           DSETM     OREQ '08'
     C           DSETM     OREQ '12'
     C*                                                                   S01154
     C* Settlement method is via a nostro set                             S01154
     C*                                                                   S01154
     C                     MOVE 'Y'       WNOST                           S01154
     C*
     C* NOT RETAIL, IF NO DATA ENTERED
     C********             MOVE *BLANKS   KEY                             S01194
     C                     MOVELDBNKAC    WRK2
     C           WRK2      IFNE '  '
     C*
     C**********                                                          S01194
     C**GET*CURRENCY*NOSTRO*RECORD*FROM*'TABDLI'**********                S01194
     C**********           MOVEL'70'      KEY                             S01194
     C**********           MOVELDDCCY     WRK5                            S01194
     C********** KEY       CHAINTABDLI               85                   S01194
     C**IF*RECORD*NOT*FOUND*OR*NOT*ACTIVE*DATABASE*ERROR****              S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '01'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELKEY       DBKEY            *      01     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           ELSE                                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO GET CURRENCY NOSTRO RECORD                 S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C                     PARM DDCCY     @CCY    3        Currency       S01194
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM WRK2      @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C* IF NO RECORD FOUND D/BASE ERROR EXISTS AND IS HANDLED BY          S01194
     C* ACCESS OBJECT PROGRAM.                                            S01194
     C*                                                                   S01194
     C*                                                                   S01194
     C**USE*FIELDS*FROM*TABLE*FILE*&*DEFAULT*CCY*TO*GET*ACCNT*RECORD      S01194
     C**USE FIELDS FROM SDNOST & DEFAULT CCY TO GET ACCNT RECORD          S01194
     C******************** MOVE CNUM      WCNUM                           S01194
     C                     MOVE A7CUST    WCNUM                           S01194
     C                     MOVE DDCCY     WCCY                            S01194
     C******************** MOVE ACOD      WACOD                           S01194
     C                     MOVE A7ACCD    WACOD                           S01194
     C******************** MOVE ACSQ      WACSQ                           S01194
     C                     MOVE A7ACSN    WACSQ                           S01194
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C**MOVE*KEY*FIELDS*INTO*DS*FIELDS*FOR*DB*ERROR*KEY**********         S01194
     C**********           MOVE '02'      DBASE            ***************S01194
     C**********           MOVE 'ACCNT'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELERRKEY    DBKEY            *      02     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C                     MOVEL'ACCNT'   DBFILE                          S01194
     C                     MOVEL'002'     DBASE            ***************S01194
     C                     MOVEL'*KEY  '  DBOPTN  7        *   DBERROR   *S01194
     C                     MOVELERRKEY    DBKEY            *     002     *S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 01
     C******               END                             END ERR 02     S01194
     C                     END                             CHECK IF RETAIL
     C                     END                             01/02/07/08/12
     C*
     C*
     C* SETTLEMENT TYPE 14
     C           DSETM     IFEQ '14'
     C                     MOVELDBNKAC    ACNO
     C           ACNO      CHAINACNUM                85
     C* IF ACNUM RECORD FOUND AND NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '0'                        RECORD FOUND
     C           RECI      IFNE 'D'                        NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
     C                     MOVE '03'      DBASE            ***************
     C                     MOVE 'ACNUM'   DBFILE           *   DBERROR   *
     C                     MOVELACNO      DBKEY            *      03     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C* IF 'ACNUM' RECORD FOUND & ACTIVE USE DATA TO ACCESS 'ACCNT'
     C                     MOVE CNUM      WCNUM
     C                     MOVE CCY       WCCY
     C                     MOVE ACOD      WACOD
     C                     MOVE ACSQ      WACSQ
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'                        NOT FOUND
     C           RECI      ORNE 'D'                        OR NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
     C* MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C                     MOVE '04'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      04     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01154
     C* No need to set up branch code since field name (BRCA) is          S01117
     C* common to all files                                               S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 29
     C                     END                             END ERR 28
     C                     ELSE                            X NO REC
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END                             END NO REC
     C                     END                             END 14
     C*
     C*
     C* SETTLEMENT TYPE 04
     C           DSETM     IFEQ '04'
     C                     MOVE DCNUM     WCNUM
     C                     MOVE DDCCY     WCCY
     C******************** MOVE CADC      WACOD                           S01194
     C                     MOVE BMACCD    WACOD                           S01194
     C                     MOVE DACSQ     WACSQ
     C*                                                                   S01117
     C* WWBRCA (BRANCH CODE) KEY ALREADY SET UP BFORE CALL TO TSTRTL      S01117
     C*                                                                   S01117
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C                     MOVE '05'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      05     *
     C*********            EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01154
     C* No need to set up branch code since field name (BRCA) is          S01117
     C* common to all files                                               S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C                     END
     C*
     C                     END                             END 04
     C*
     C*
     C* SETTLEMENT TYPE 05
     C           DSETM     IFEQ '05'
     C* USE BANK A/C SPLIT FIELDS TO ACCESS 'ACCNT'
     C*********************MOVE D16#21    WCNUM                           S01117
     C                     MOVE W@CNUM    WCNUM                           S01117
     C                     MOVE DDCCY     WCCY
     C*********************MOVE D22#25    WACOD                           S01117
     C                     MOVE W@ACOD    WACOD                           S01117
     C* IF ACCOUNT SEQUENCE IS ZERO OR BLANK USE DEFAULT SEQUENCE
     C***********D26#27****IFEQ *BLANK                                    S01117
     C           W@ACSQ    IFEQ *BLANK                                    S01117
     C***********D26#27****OREQ *ZERO                                     S01117
     C           W@ACSQ    OREQ *ZERO                                     S01117
     C                     MOVE DACSQ     WACSQ
     C                     ELSE
     C*********************MOVE D26#27    WACSQ                           S01117
     C                     MOVE W@ACSQ    WACSQ                           S01117
     C                     END
     C*
     C           ACCKEY    CHAINACCNT                85
     C* IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN85     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C* MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C                     MOVE '06'      DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      06     *
     C********             EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   S01154
     C**   Move account details to shadow post later                      S01154
     C*                                                                   S01154
     C**********           Z-ADDCNUM      CUSN                                         S01154 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            S01154
     C                     Z-ADDACOD      ACDE                            S01154
     C                     Z-ADDACSQ      ASNC                            S01154
     C*                                                                   S01154
     C* No need to set up branch code since field name (BRCA) is          S01117
     C* common to all files                                               S01117
     C*                                                                   S01154
     C*  IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C*
     C                     END                             END ERR 30
     C                     END                             END 05
     C* CLEAR PASSED FIELDS
     C                     MOVE *BLANK    DDCCY
     C                     MOVE *BLANK    DSETM   2
     C                     MOVE *BLANK    DBNKAC
     C**********           Z-ADDDCNUM     CNUM                                                CSD027
     C**********           Z-ADD*ZERO     DCNUM                                               CSD027
     C                     MOVE DCNUM     CNUM                                                CSD027
     C                     MOVE *BLANKS   DCNUM                                               CSD027
     C                     MOVE *BLANK    WWBRCA                          S01117
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DLSCON SR.    To accept an amount field (13N) & a field (1N) *
      *                specifying no. of decimals, and to convert the *
      *                amount into an alpameric field (14A) , zero    *
      *                supressed, with the required decimal place.    *
      *                                                               *
      *   INPUT   : ZAMTW  AMOUNT       FORMAT (13N)                  *
      *             ZQECN  DECIMAL NO.  FORMAT (1N)                   *
      *                                                               *
      *   OUTPUT  : ZAMTD  AMOUNT WITH DECIMAL FORMAT (14A)           *
      *                                                               *
      *   USES    : ZAMTW  AMOUNT FIELD PASSED                        *
      *             ZQECN  NO. OF DECIMAL PLACES FIELD                *
      *             ZQECW  POSITION ON ARRAY ZZZ FOR A DECIMAL POINT  *
      *             ZSIG   POSITION ON ARRAY THAT CANNOT BE BLANK     *
      *             ZZ     INDEX FOR ARRAY ZZZ                        *
      *             ZQ     INDEX FOR ARRAY ZZQ                        *
      *             ZSWT   SWITCH SAYING ZERO HAS BEEN SUPPRESSED     *
      *             ZSWT1  SWITCH SAYING ZERO SUPPRESSION OVER        *
      *                                                               *
      *   ARRAYS  : ZZZ ARRAY USED FOR DECIMAL ALIGNMENT              *
      *             ZZQ ARRAY USED FOR STORING AMOUNT PASSED TO SR.   *
      *                                                               *
      *****************************************************************
      *
     C           DLSCON    BEGSR                           *** DLSCON ***
      *
      **  Initialisation
     C                     MOVE '0'       ZSWT1   1
      **  Find decimal position
     C           14        SUB  ZQECN     ZQECW   20
      **  Find most significant position
     C           ZQECW     SUB  1         ZSIG    20
     C                     MOVEA*BLANKS   ZZZ
     C                     Z-ADD1         ZQ      20
      *
      **  Check to see if no. of decimal places is zero.  If zero
      **  then significant position is 14 and position 1 is blank.
      *
     C           ZQECW     IFEQ 14
     C                     Z-ADD14        ZSIG
     C                     Z-ADD2         ZZ      20
     C                     ELSE
     C                     Z-ADD1         ZZ
     C                     END
      *
      **  Perform actual movement
      *
     C           ZZ        DOWLT15
     C           ZQ        ANDLT14
      **  Switch for zero suppression
     C                     MOVE '0'       ZSWT    1
      *
      **  If element of array ZZQ is zero, and index ZZ for array ZZZ
      **  is *LT sig. position and also *LT decimal position, then
      **  zero can be suppressed ( ie seton zero suppression switch )
      *
     C           ZZQ,ZQ    IFEQ 0
     C           ZSWT1     ANDEQ'0'
     C           ZZ        ANDLTZSIG
     C           ZZ        ANDLTZQECW
     C                     MOVE *BLANK    ZZZ,ZZ
     C                     MOVE '1'       ZSWT
     C                     END
      *
      **  If index ZZ for array ZZZ is equal to the decimal position
      **  and not equal to the length of the array ZZZ (14), then
      **  move decimal position and increment ZZ by 1
      *
     C           ZZ        IFEQ ZQECW
     C           ZZ        ANDNE14
     C                     MOVE '.'       ZZZ,ZZ
     C                     ADD  1         ZZ
     C                     END
      *
      **  If zero has not been suppressed, then move element from
      **  ZZQ to ZZZ & seton 'zero suppression over' switch (ZSWT1)
      *
     C           ZSWT      IFEQ '0'
     C                     MOVE ZZQ,ZQ    ZZZ,ZZ
     C                     MOVE '1'       ZSWT1
     C                     END
      *
     C                     ADD  1         ZQ
     C                     ADD  1         ZZ
      *
     C                     END
      *
      **  Dummy move for definition of work field
     C                     GOTO DLSEND
     C                     MOVE ZQECN     ZQECN   10
      *
     C           DLSEND    ENDSR
      ********************************************************************
      /EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZADD    BEGSR                           *** GLZADD ****
     C*
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
     C********************************************************************
      /SPACE 4
     C********************************************************************
     C* SUBROUTINE TO SUBTRACT AN AMOUNT (ZZAMT) FROM THE TOTAL
     C*                                                   (ZZTOTI,ZZTOTD)
     C*  IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZSUB    BEGSR                           *** GLZSUB ****
     C*
     C* PROCESSING. JUST REVERSE THE 'SIGN' AND ADD
     CSR                   Z-SUBZZAMT     ZZAMT  153       REVERSE 'SIGN'
     C*
     CSR                   EXSR GLZADD                       AND 'ADD'
     CSR                   Z-SUBZZAMT     ZZAMT            RESTORE 'SIGN'
     C*
     CSR                   ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
     C*
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
     C********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INIT SR.      To access I.C.D. information & check constant  *
      *                data                                           *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ****
      *                                                                   S01194
      ****Access*I.C.D.*record*1**********                                S01194
      **********                                                          S01194
     C**********           EXSR ZSYSTM                                    S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '07'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      07     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*2                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '11'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '08'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      08     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*3                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '20'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '09'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      09     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*5                                          S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '40'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '10'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      10     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I.C.D.*record*70                                         S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '70'      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '11'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      11     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
     C* CALL ACCESS PROG. FOR BANK DETAILS.                               S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROG. FOR MODULE DETAILS.                             S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO GET DEALING DETAILS                        S01194
     C*                                                                   S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*                                                                   S01194
     C*   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY                      S01194
     C*                                                                   S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE '1'       *IN98                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
      *                                                                   S01194
0327 C* CALL ACCESS PROG. FOR GENERAL LEDGER DETAILS                      S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM FOR RETAIL DETAILS                            S01194
     C           BGRTBN    IFEQ 'Y'                                       064773
     C           BGIOAC    OREQ 'Y'                                       064773
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
      *                                                                   064773
     C                     END                                            064773
     C*                                                                   S01194
      ****Test*constant*data*from*installation*control*data*records       S01194
      **********                                                          S01194
      ****Determine*if*retail*module*is*present*in*system                 S01194
     C***********          TESTB'2'       MODI1          89               E23407
     C***********          TESTB'7'       MODI2          89         E23407S01194
     C************IN89     IFEQ '0'                                 E23407S01194
     C***********          TESTB'2'       MODI5          89         E23407S01194
     C***********          END                                      E23407S01194
      ****If*retail*is*present,*determine*if*retail*account*nos. used     S01194
     C********** *IN89     IFEQ '1'                                       S01194
     C********** RACN      COMP 'Y'                      88               S01194
     C**********           END                                            S01194
      **  If Retail Module is present,                                    S01194
      **  then determine if Retail Account Nos. are used                  S01194
     C           BGRTBN    IFEQ 'Y'                                       S01194
     C           BGIOAC    OREQ 'Y'                                       S01194
     C           BMRANR    COMP 'Y'                      88               S01194
     C                     END                                            S01194
      ****Determine*if*system*is*multibranch*accounting******             S01194
     C********** DFBR      COMP 0                        87               S01194
      ****Determine*if*system*is*multibranch*dealing**********            S01194
     C********** MBIN      COMP 'Y'                      83               S01194
     C*                                                                   S01194
     C* CHECK MULTIBRANCHING ON OR OFF                                    S01194
     C*                                                                   S01194
     C           BGMBIN    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN83                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C* GET USER DETAILS FROM ZMUSER                                      S01194
     C*                                                                   S01194
     C           *NAMVAR   DEFN           ZMUSER                          S01194
     C                     IN   ZMUSER                                    S01194
     C*                                                                   S01194
     C* Check Originating Branch used flag                                S01117
      *                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN87                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* Check Profit Centre used flag                                     S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN11                           S01117
     C                     END                                            S01117
      *                                                                   CIR001
      ** Access AOSARDR0 to check if CIR001 is switched on                CIR001
      *                                                                   CIR001
     C                     CALL 'AOSARDR0'                                CIR001
     C                     PARM *BLANKS   @RTCD   7                       CIR001
     C                     PARM '*VERIFY' @OPTN   7                       CIR001
     C                     PARM 'CIR001'  @SARD   6                       CIR001
     C           SCSARD    PARM SCSARD    DSFDY                           CIR001
      *                                                                   CIR001
     C           @RTCD     IFEQ *BLANKS                                   CIR001
      *                                                                   CIR001
      ** Calculate Event Control Date                                     CIR001
      ** The lesser of - Next Working Day - 1                             CIR001
      **               - Accrual Profit Date                              CIR001
      *                                                                   CIR001
     C           BJDNWD    SUB  1         EVCD    50                      CIR001
     C           BKAPDT    IFLT EVCD                                      CIR001
     C                     MOVE BKAPDT    EVCD                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       CIR001  1                       CIR001
     C                     MOVE '1'       *IN89                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'N'       CIR001                          CIR001
     C                     MOVE '0'       *IN89                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR002
      ** Access AOSARDR0 to check if CIR002 is switched on                CIR002
      *                                                                   CIR002
     C                     CALL 'AOSARDR0'                                CIR002
     C                     PARM *BLANKS   @RTCD   7                       CIR002
     C                     PARM '*VERIFY' @OPTN   7                       CIR002
     C                     PARM 'CIR002'  @SARD   6                       CIR002
     C           SCSARD    PARM SCSARD    DSFDY                           CIR002
      *                                                                   CIR002
     C           @RTCD     IFEQ *BLANKS                                   CIR002
     C                     MOVE 'Y'       CIR002  1                       CIR002
     C                     ELSE                                           CIR002
     C                     MOVE 'N'       CIR002                          CIR002
     C                     END                                            CIR002
      *                                                                   CEU003
      ** Determine if SAR CEU003 EMU Dealing Settlement Ccy Conversion    CEU003
      ** is installed.                                                    CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   P@RTCD  7                       CEU003
     C                     PARM '*KEY    'P@OPTN  7                       CEU003
     C                     PARM 'CEU003'  P@SARD  6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR005
      ** Determine if SAR CIR005 Business Day Conventions is ins -        CIR005
      ** talled.                                                          CIR005
      *                                                                   CIR005
     C                     CALL 'AOSARDR0'                                CIR005
     C                     PARM *BLANKS   @RTCD                           CIR005
     C                     PARM '*VERIFY '@OPTN                           CIR005
     C                     PARM 'CIR005'  @SARD                           CIR005
     C           SCSARD    PARM SCSARD    DSFDY                           CIR005
      *                                                                   CIR005
     C           @RTCD     IFNE *BLANKS                                   CIR005
     C           @RTCD     ANDNE'*NRF   '                                 CIR005
     C                     MOVEL'SCSARDPD'DBFILE                          CIR005
     C                     Z-ADD29        DBASE                           CIR005
     C                     MOVEL'CIR005'  DBKEY                           CIR005
     C                     EXSR *PSSR                                     CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           @RTCD     IFEQ *BLANKS                                   CIR005
     C                     MOVE 'Y'       CIR005  1                       CIR005
     C                     ELSE                                           CIR005
     C                     MOVE 'N'       CIR005                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CDE001
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM *BLANKS   @RTCD                           CDE001
     C                     PARM '*VERIFY' @OPTN                           CDE001
     C                     PARM 'CDE001'  @SARD                           CDE001
     C           @RTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           @RTCD     IFNE '*NRF    '                                CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD22        DBASE            * DBERR 22 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     EXSR *PSSR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
      *                                                                   CIR006
      ** Determine if SAR CIR006 is installed                             CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY '@OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD                           CIR006
     C           SCSARD    PARM SCSARD    DSFDY                           CIR006
      *                                                                   CIR006
     C           @RTCD     IFNE *BLANKS                                   CIR006
     C           @RTCD     ANDNE'*NRF   '                                 CIR006
     C                     MOVEL'SCSARDPD'DBFILE                          CIR006
     C                     Z-ADD32        DBASE                           CIR006
     C                     MOVEL'CIR006'  DBKEY                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     MOVE *ON       *IN31                           CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     MOVE *OFF      *IN31                           CIR006
     C                     ENDIF                                          CIR006
     C*                                                                   S01117
      ** Determine if SAR CAP041 is installed                                                 CAP041
      *                                                                                       CAP041
     C                     CALL 'AOSARDR0'                                                    CAP041
     C                     PARM *BLANKS   @RTCD                                               CAP041
     C                     PARM '*VERIFY '@OPTN                                               CAP041
     C                     PARM 'CAP041'  @SARD                                               CAP041
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP041
      *                                                                                       CAP041
     C           @RTCD     IFNE *BLANKS                                                       CAP041
     C           @RTCD     ANDNE'*NRF   '                                                     CAP041
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP041
     C                     Z-ADD33        DBASE                                               CAP041
     C                     MOVEL'CAP041'  DBKEY                                               CAP041
     C                     EXSR *PSSR                                                         CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
     C           @RTCD     IFEQ *BLANKS                                                       CAP041
     C                     MOVE 'Y'       CAP041  1                                           CAP041
     C                     ELSE                                                               CAP041
     C                     MOVE 'N'       CAP041                                              CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CRE009
      ** Determine if SAR CRE009 is installed                                                 CRE009
      *                                                                                       CRE009
     C                     CALL 'AOSARDR0'                                                    CRE009
     C                     PARM *BLANKS   @RTCD                                               CRE009
     C                     PARM '*VERIFY '@OPTN                                               CRE009
     C                     PARM 'CRE009'  @SARD                                               CRE009
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE009
      *                                                                                       CRE009
     C           @RTCD     IFEQ *BLANKS                                                       CRE009
     C                     MOVE 'Y'       CRE009  1                                           CRE009
     C                     ELSE                                                               CRE009
     C                     MOVE 'N'       CRE009                                              CRE009
     C                     ENDIF                                                              CRE009
      *                                                                                       CRE009
      **  Set up workstation ID field for display on all screens
      *
     C                     MOVE WSID      SWSID
      *
     C* Initialise receive + payment location fields.                     S01195
     C                     MOVE *BLANKS   @RNLOC                          S01195
     C                     MOVE *BLANKS   @PNLOC                          S01195
     C/COPY WNCPYSRC,DL1604RC01
      *                                                                   S01195
      ** Determine if SAR CAP205 Teller Related APIs - Account Balance Check                  CAP205
      ** is installed.                                                                        CAP205
      *                                                                                       CAP205
     C                     MOVEL'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY '@OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVEL'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE *BLANKS                                                       CAP205
     C           @RTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP205
     C                     Z-ADD38        DBASE                                               CAP205
     C                     MOVEL'CAP205'  DBKEY                                               CAP205
     C                     EXSR *PSSR                                                         CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     MOVEL*BLANK    W#MTYP  1                                           CAP205
      *                                                                                       CAP205
      **********                                                                   MD035545 MD051554
      ***Retrieve*system*value*setting***********************                      MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C**********           MOVELWPARML    P@OP01                                   MD035545 MD051554
     C**********           CALL 'AOSVALR0'                                         MD035545 MD051554
     C**********           PARM *BLANKS   W0RTCD  7                                MD035545 MD051554
     C**********           PARM           P@OP01 20                                MD035545 MD051554
     C**********           PARM           P@VL01200                                MD035545 MD051554
     C**********           PARM           P@OP02 20                                MD035545 MD051554
     C**********           PARM           P@VL02200                                MD035545 MD051554
     C**********           PARM           P@OP03 20                                MD035545 MD051554
     C**********           PARM           P@VL03200                                MD035545 MD051554
     C**********           PARM           P@OP04 20                                MD035545 MD051554
     C**********           PARM           P@VL04200                                MD035545 MD051554
     C**********           PARM           P@OP05 20                                MD035545 MD051554
     C**********           PARM           P@VL05200                                MD035545 MD051554
     C**********           PARM           P@OP06 20                                MD035545 MD051554
     C**********           PARM           P@VL06200                                MD035545 MD051554
     C**********           PARM           P@OP07 20                                MD035545 MD051554
     C**********           PARM           P@VL07200                                MD035545 MD051554
     C**********           PARM           P@OP08 20                                MD035545 MD051554
     C**********           PARM           P@VL08200                                MD035545 MD051554
     C**********           PARM           P@OP09 20                                MD035545 MD051554
     C**********           PARM           P@VL09200                                MD035545 MD051554
     C**********           PARM           P@OP10 20                                MD035545 MD051554
     C**********           PARM           P@VL10200                                MD035545 MD051554
      **********                                                                   MD035545 MD051554
      ***If*system value is not found then default value to 'N'                    MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C********** W0RTCD    IFNE '       '                                          MD035545 MD051554
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD051554
     C**********           ELSE                                                    MD035545 MD051554
     C**********           MOVELP@VL01    WCALC6                                   MD035545 MD051554
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD051554
      *                                                                                     MD035545
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SETRL  SR.    To setup file information correctly formated   *
      *                in screen fields  ( & to save pre-amend data   *
      *                for use when calculating confirmations )       *
      *                                               (W10 & W13/W16) *
      *****************************************************************
      *
     C           SETRL     BEGSR                           ***  SETRL ****
      *
      **  Access file information
      *
     C                     Z-ADD0         DLKEY   60
     C                     MOVELSDLNO     DLKEY
     C           DLKEY     CHAINDEALSCH              86
      **  End if  detail record not found
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'M'
     C           RECI      ANDNE'R'
     C*********  *LOCK     IN   LDA                                      S01194
     C                     MOVE '12'      DBASE            ***************
     C                     MOVE 'DEALS'   DBFILE           *   DBERROR   *
     C                     MOVELDLKEY     DBKEY            *      12     *
     C***************      EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END
      *
      **  Set up message if deal has matured or been reversed
      **  ( enquiry only )
      *
     C           RECI      IFEQ 'M'
     C                     MOVELERRMSG,3  SERCD2
     C                     SETON                     06
     C                     END
      *
     C           RECI      IFEQ 'R'
     C                     MOVELERRMSG,4  SERCD2
     C                     SETON                     06
     C                     END
     C/COPY WNCPYSRC,DL1604RC21
      *
      **  Transfer information to screen fields
      *
     C*                                                                   S01157
     C                     MOVE BYSL      SBYSL                           S01157
     C                     MOVE BOKC      SBOKC                           S01157
     C*                                                                   S01157
     C                     MOVE DTYP      SDTYP
     C                     MOVE DLST      SDLST
     C                     MOVE DDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDDAT
     C*******************  MOVE BRCD      SBRCD                           S01194
     C                     MOVE BRCA      SBRCA                           S01194
      *
     C* PROFIT CENTRE                                                     S01117
     C                     MOVE PRFC      SPRFC                           S01117
     C*                                                                   S01117
     C* ORIGINATING BRANCH                                                S01117
     C                     MOVE ORBR      SORBR                           S01117
     C*                                                                   S01117
     C                     MOVE BRKC      SBRKC
     C*                                                                   S01117
     C           BRKC      IFNE 'TELX'
     C           BRKC      ANDNE'PHON'
     C           BRKC      ANDNE'MAIL'
      *
     C**********           MOVE *BLANKS   BRKEY  12                       S01194
     C**********           MOVEL'80'      BRKEY                           S01194
     C**********           MOVE BRKC      BRKEY                           S01194
     C********** BRKEY     CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '13'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELBRKEY     DBKEY            *      13     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
     C*                                                                   S01194
      ** Call Access Program for Broker Codes                             S01194
     C                     CALL 'AOBROKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM BRKC      @BROKY  4                       S01194
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
     C*                                                                   S01194
     C**********           MOVE *BLANKS   CYKY12 12                       S01194
     C**********           MOVELBKCY      CYKY4   4                       S01194
     C**********           MOVE '1'       CYKY4                           S01194
     C**********           MOVE CYKY4     CYKY12                          S01194
     C**********           MOVEL'20'      CYKY12                          S01194
     C********** CYKY12    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '14'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELCYKY12    DBKEY            *      14     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
     C*                                                                   S01194
     C** Call Access Program for Currency Details                         S01194
     C**      to Obtain Currency Decimal Places                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM A9BRCY    @BKCYY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C                     MOVE *BLANKS   ZAMTW
     C                     MOVE BAGE      ZAMTW
     C*****                MOVE CDP       ZQECN                           S01194
     C                     MOVE A6NBDP    ZQECN                           S01194
     C                     EXSR DLSCON
     C                     MOVE ZAMTD     SBAGE
      *
     C                     ELSE
     C                     MOVE *BLANKS   SBAGE
     C                     END
      *
     C           LNKDN     IFEQ 0
     C                     MOVE *BLANKS   SLNKDN
     C                     ELSE
     C                     MOVE LNKDN     SLNKDN
     C                     END
      *
     C                     MOVELCNUM      SCNUM
      *
      *  Save details of deal to shadow post later.                       S01154
      *                                                                   S01154
     C**  E20918 - Saving the right detail                                E20918
     C**********           MOVE DTYP      TRYP                     S01154 E20918
     C**********           MOVE DLNO      TNMR                     S01154 E20918
     C                     MOVE NEWDT     TRYP                            E20918
     C                     MOVE NEWDL     TNMR                            E20918
      *
     C                     MOVE VDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SVDAT
      *
     C                     MOVE MDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SMDAT
      *
     C                     MOVE CDAS      SCDAS
     C                     MOVE UCUCY     SUCUCY
      *
     C**********           MOVE *BLANKS   CYKY12 12                       S01194
     C**********           MOVELUCUCY     CYKY4   4                       S01194
     C**********           MOVE '1'       CYKY4                           S01194
     C**********           MOVE CYKY4     CYKY12                          S01194
     C**********           MOVEL'20'      CYKY12                          S01194
     C********** CYKY12    CHAINTABDLI               99                   S01194
     C**N99***** RECI      COMP 'D'                  9999                 S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '15'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELCYKY12    DBKEY            *      15     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
     C*                                                                   S01194
      *                                                                   S01194
     C** Call Access Program for Currency Details                         S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM UCUCY     @UCUCY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C                     MOVE A6INCY    WSUCIN  1                       CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   ZAMTW
     C                     MOVE UPAMT     ZAMTW
     C********             MOVE CDP       ZQECN                           S01194
     C                     MOVE A6NBDP    ZQECN                           S01194
     C                     EXSR DLSCON
     C                     MOVE ZAMTD     SUPAMT
      *
     C                     TESTB'2'       UDSTI          85
     C           *IN85     IFEQ '1'
     C                     MOVE 'Y'       SUFFI
     C                     ELSE
     C                     MOVE *BLANK    SUFFI
     C                     END
      *
     C                     MOVE *BLANKS   ZAMTW
     C                     MOVE UBCXR     ZAMTW
     C                     MOVE '8'       ZQECN
     C                     EXSR DLSCON
     C                     MOVE ZAMTD     SUBCXR
     C                     MOVE UICBS     SUICBS
     C****                 MOVE HEDIN     SHEDIN                          S01157
     C                     MOVE TAXI      STAXI
      *
     C*********************TESTB'1'       UDSTI          85               E23400
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  MOVE 'Y'       SUNII                           S01157
     C***                  ELSE                                           S01157
     C***                  TESTB'1'       TDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  MOVE 'Y'       SUNII                           S01157
     C***                  ELSE                                           S01157
     C***                  MOVE 'N'       SUNII                           S01157
     C***                  END                                            S01157
     C***                  END                                            S01157
      ***************ils to all be blank if UBRTT = 0                     S01157
     C*                                                                   S01157
     C* SETUP SCREEN FIELDS                                               S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C           BYSL      ANDEQ'B'                                       S01157
     C           NEWDT     OREQ 'RR'                                      S01157
     C           BYSL      ANDEQ'B'                                       S01157
     C           NEWDT     OREQ 'RF'                                      S01157
     C           BYSL      ANDEQ'S'                                       S01157
     C*                                                                   S01157
     C                     MOVE TBRTT     SRBRTT                          S01157
     C*                                                                   S01157
     C           TRTSP     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRRTSP                          S01157
     C                     ELSE                                           S01157
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE TRTSP     ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SRRTSP                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE TSPIN     SRSPIN                          S01157
     C                     MOVE TFRFD     SCFRFD                          S01157
     C*                                                                   S01157
     C* CONVERT DAY NO. TO DATE FORMAT                                    S01157
     C*                                                                   S01157
     C           TNICD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRNICD                          S01157
     C                     ELSE                                           S01157
     C                     Z-ADDTNICD     ZDAYNO                          S01157
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZDATE     SRNICD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE TICFR     SRICFR                          S01157
     C           TICFD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SCICFD                          S01157
     C                     ELSE                                           S01157
     C                     MOVE TICFD     SCICFD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           TEINR     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SWORKR                          S01157
     C                     ELSE                                           S01157
      *                                                                                       226723
     C           TEINR     IFLT 0                                                             226723
     C                     Z-SUBTEINR     POSRAT                                              226723
     C                     ELSE                                                               226723
     C                     Z-ADDTEINR     POSRAT                          S01157
     C                     ENDIF                                                              226723
      *                                                                                       226723
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE POSRAT    ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SWORKR                          S01157
      *                                                                                       226723
      ** Output sign for short term interest rate                                             226723
      *                                                                                       226723
     C           TEINR     IFLT 0                                                             226723
     C                     MOVE '-'       SOSIGN  1                                           226723
     C                     ELSE                                                               226723
     C                     MOVE '+'       SOSIGN                                              226723
     C                     ENDIF                                                              226723
     C                     END                                            S01157
     C*                                                                   S01157
     C* CONVERT DAY NO. TO DATE FORMAT                                    S01157
     C*                                                                   S01157
     C********** TIPBD     IFEQ 0                                  S01157 188363
     C           TNIPD     IFEQ 0                                         188363
     C                     MOVE *BLANK    SRNIPD                          S01157
     C                     ELSE                                           S01157
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           L1AMCN    ANDEQ'A '                                      CIR005
     C**********           Z-ADDTIPBD     ZDAYNO                   S01157 188363
     C                     Z-ADDTNIPD     ZDAYNO                          188363
     C                     ELSE                                           CIR005
     C                     Z-ADDTNIPD     ZDAYNO                          CIR005
     C                     ENDIF                                          CIR005
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZDATE     SRNIPD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE TIPFR     SRIPFR                          S01157
     C           TIPFD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRIPFD                          S01157
     C                     ELSE                                           S01157
     C                     MOVE TIPFD     SRIPFD                          S01157
     C                     END                                            S01157
     C/COPY WNCPYSRC,DL1604RC22
     C*                                                                   S01157
     C* ELSE DEAL HAS BEEN SOLD                                           S01157
     C*                                                                   S01157
     C                     ELSE                                           S01157
     C*                                                                   S01157
     C                     MOVE UBRTT     SRBRTT                          S01157
     C*                                                                   S01157
     C           URTSP     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRRTSP                          S01157
     C                     ELSE                                           S01157
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE URTSP     ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SRRTSP                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE USPIN     SRSPIN                          S01157
     C                     MOVE UFRFD     SCFRFD                          S01157
     C*                                                                   S01157
     C* CONVERT DAY NO. TO DATE FORMAT                                    S01157
     C*                                                                   S01157
     C           UNICD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRNICD                          S01157
     C                     ELSE                                           S01157
     C                     Z-ADDUNICD     ZDAYNO                          S01157
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZDATE     SRNICD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE UICFR     SRICFR                          S01157
     C           UICFD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SCICFD                          S01157
     C                     ELSE                                           S01157
     C                     MOVE UICFD     SCICFD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C           UEINR     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SWORKR                          S01157
     C                     ELSE                                           S01157
      *                                                                                       226723
     C           UEINR     IFLT 0                                                             226723
     C                     Z-SUBUEINR     POSRAT                                              226723
     C                     ELSE                                                               226723
     C                     Z-ADDUEINR     POSRAT                          S01157
     C                     ENDIF                                                              226723
      *                                                                                       226723
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE POSRAT    ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SWORKR                          S01157
      *                                                                                       226723
      ** Output sign for short term interest rate                                             226723
      *                                                                                       226723
     C           UEINR     IFLT 0                                                             226723
     C                     MOVE '-'       SOSIGN                                              226723
     C                     ELSE                                                               226723
     C                     MOVE '+'       SOSIGN                                              226723
     C                     ENDIF                                                              226723
     C                     END                                            S01157
     C*                                                                   S01157
     C* CONVERT DAY NO. TO DATE FORMAT                                    S01157
     C*                                                                   S01157
     C********** UIPBD     IFEQ 0                                  S01157 188363
     C           UNIPD     IFEQ 0                                         188363
     C                     MOVE *BLANK    SRNIPD                          S01157
     C                     ELSE                                           S01157
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           L1AMCN    ANDEQ'A '                                      CIR005
     C**********           Z-ADDUIPBD     ZDAYNO                   S01157 188363
     C                     Z-ADDUNIPD     ZDAYNO                          188363
     C                     ELSE                                           CIR005
     C                     Z-ADDUNIPD     ZDAYNO                          CIR005
     C                     ENDIF                                          CIR005
     C                     EXSR ZDATE2                                    S01157
     C                     MOVE ZDATE     SRNIPD                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C                     MOVE UIPFR     SRIPFR                          S01157
     C           UIPFD     IFEQ 0                                         S01157
     C                     MOVE *BLANK    SRIPFD                          S01157
     C                     ELSE                                           S01157
     C                     MOVE UIPFD     SRIPFD                          S01157
     C                     END                                            S01157
     C/COPY WNCPYSRC,DL1604RC23
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C***        UBRTT     IFEQ 0                                         S01157
      ***                                                                 S01157
     C***                  MOVE *BLANKS   SUBRTT                          S01157
     C***                  MOVE *BLANKS   SURTSP                          S01157
     C***                  MOVE *BLANKS   SUSPIN                          S01157
     C***                  MOVE *BLANKS   SUFRFD                          S01157
     C***                  MOVE *BLANKS   SUNICD                          S01157
     C***                  MOVE *BLANKS   SUICFR                          S01157
     C***                  MOVE *BLANKS   SUICFD                          S01157
     C***                  MOVE *BLANKS   SLABL1                          S01157
     C***                  MOVE *BLANKS   SWORK1                          S01157
     C***                  MOVE *BLANKS   SUNIPD                          S01157
     C***                  MOVE *BLANKS   SUIPFR                          S01157
     C***                  MOVE *BLANKS   SUIPFD                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***                  MOVE UBRTT     SUBRTT                          S01157
      ***                                                                 S01157
     C***        USPIN     IFEQ ' '                                       S01157
     C***                  MOVE *BLANKS   SURTSP                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE URTSP     ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SURTSP                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE USPIN     SUSPIN                          S01157
      ***                                                                 S01157
     C***                  TESTB'3'       UDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  MOVE *BLANKS   SUFRFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE UFRFD     SUFRFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        UNICD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   SUNICD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE UNICD     ZDAYNO                          S01157
     C***                  EXSR ZDATE2                                    S01157
     C***                  MOVE ZDATE     SUNICD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE UICFR     SUICFR                          S01157
      ***                                                                 S01157
     C***        UICFD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   SUICFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE UICFD     SUICFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C                     TESTB'3'       UDSTI          85               S01157
     C           *IN85     IFEQ '1'                                       S01157
      ***                                                                 S01157
     C                     MOVELERRMSG,5  SLABLR                          S01157
      ***                                                                 S01157
     C***        VDAT      IFLT RUND                                      S01157
      ***                                                                 S01157
     C***                  TESTB'1'       UDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  Z-SUBAACRT     POSRAT 117                      S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDAACRT     POSRAT                          S01157
     C***                  END                                            S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE POSRAT    ZAMTW                           S01157
     ***                   MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SWORK1                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   SWORK1                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C                     ELSE                                           S01157
      ***                                                                 S01157
     C                     MOVELERRMSG,6  SLABLR                          S01157
      ***                                                                 S01157
     C***                  TESTB'0'       UDNSI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
      ***                                                                 S01157
     C***                  TESTB'1'       UDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  Z-SUBUEINR     POSRAT                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDUEINR     7OSRAT                          S01157
     C***                  END                                            S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE POSRAT    ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SWORK1                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   SWORK1                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C                     END                                            S01157
      ***                                                                 S01157
     C***        UNIPD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   SUNIPD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE UNIPD     ZDAYNO                          S01157
     C***                  EXSR ZDATE2                                    S01157
     C***                  MOVE ZDATE     SUNIPD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE UIPFR     SUIPFR                          S01157
      ***                                                                 S01157
     C***        UIPFD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   SUIPFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE UIPFD     SUIPFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ***                                                                 S01157
      *******eir'  details to all be blank if TBRTT = 0                   S01157
     C***        TBRTT     IFEQ 0                                         S01157
      ***                                                                 S01157
     C***                  MOVE *BLANKS   STBRTT                          S01157
     C***                  MOVE *BLANKS   STRTSP                          S01157
     C***                  MOVE *BLANKS   STSPIN                          S01157
     C***                  MOVE *BLANKS   STFRFD                          S01157
     C***                  MOVE *BLANKS   STNICD                          S01157
     C***                  MOVE *BLANKS   STICFR                          S01157
     C***                  MOVE *BLANKS   STICFD                          S01157
     C***                  MOVE *BLANKS   SLABL2                          S01157
     C***                  MOVE *BLANKS   SWORK2                          S01157
     C***                  MOVE *BLANKS   STNIPD                          S01157
     C***                  MOVE *BLANKS   STIPFR                          S01157
     C***                  MOVE *BLANKS   STIPFD                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ***                                                                 S01157
     C***                  MOVE TBRTT     STBRTT                          S01157
      ***                                                                 S01157
     C***        TSPIN     IFEQ ' '                                       S01157
     C***                  MOVE *BLANKS   STRTSP                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE TRTSP     ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     STRTSP                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE TSPIN     STSPIN                          S01157
      ***                                                                 S01157
     C***                  TESTB'3'       TDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  MOVE *BLANKS   STFRFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE TFRFD     STFRFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***        TNICD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   STNICD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE TNICD     ZDAYNO                          S01157
     C***                  EXSR ZDATE2                                    S01157
     C***                  MOVE ZDATE     STNICD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE TICFR     STICFR                          S01157
      ***                                                                 S01157
     C***        TICFD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   STICFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE TICFD     STICFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  TESTB'3'       TDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
      ***                                                                 S01157
     C***                  MOVELERRMSG,5  SLABL2                          S01157
      ***                                                                 S01157
     C***        VDAT      IFLT RUND                                      S01157
      ***                                                                 S01157
     C***                  TESTB'1'       TDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  Z-SUBAACRT     POSRAT                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDAACRT     POSRAT                          S01157
     C***                  END                                            S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE 7OSRAT    ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SWORK2                          S01157
      ****                                                                S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   SWORK2                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C***                  MOVELERRMSG,6  SLABL2                          S01157
      ***                                                                 S01157
     C***                  TESTB'0'       TDNSI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
      ***                                                                 S01157
     C***                  TESTB'1'       TDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  Z-SUBTEINR     POSRAT                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDTEINR     POSRAT                          S01157
     C***                  END                                            S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE 7OSRAT    ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C***                  EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SWORK2                          S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
     C***                  MOVE *BLANKS   SWORK2                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***        TNIPD     IFEQ 0                                         S01157
     C***                  MOVE *BLANKS   STNIPD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE TNIPD     ZDAYNO                          S01157
     C***                  EXSR ZDATE2                                    S01157
     C***                  MOVE ZDATE     STNIPD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  MOVE TIPFR     STIPFR                          S01157
      ***                                                                 S01157
     C***        TIPFD     IFEQ 0                                         S01157
     C**                   MOVE *BLANKS   STIPFD                          S01157
     C***                  ELSE                                           S01157
     C***                  MOVE TIPFD     STIPFD                          S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  TESTB'1'       UDSTI          85               S01157
     C***        *IN85     IFEQ '1'                                       S01157
     C***                  Z-SUBCLRAT     POSRAT                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDCLRAT     POSRAT                          S01157
     C***                  END                                            S01157
     C***                  MOVE *BLANKS   ZAMTW                           S01157
     C***                  MOVE POSRAT    ZAMTW                           S01157
     C***                  MOVE '7'       ZQECN                           S01157
     C****                 EXSR DLSCON                                    S01157
     C***                  MOVE ZAMTD     SCLRAT                          S01157
      ***                                                                 S01157
     C***                  SETOF                     09                   S01157
      ***                                                                 S01157
     C***        UBRTT     IFNE 0                                         S01157
      ****                                                                S01157
     C***                  TESTB'4'       UDSTI          85               S01157
     C***        *IN85     IFEQ '0'                                       S01157
     C***                  SETON                     09                   S01157
     C***                  END                                            S01157
      ***                                                                 S01157
     C***                  ELSE                                           S01157
      ****                                                                S01157
     C***                  TESTB'4'       TDSTI          85               S01157
     C***        *IN85     IFEQ '0'                                       S01157
     C***                  SETON                     09                   S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C***                  END                                            S01157
      ****                                                                S01157
     C*                                                                   S01157
     C* RESET FLOOR & CAP DEALS                                           S01157
     C*                                                                   S01157
     C                     MOVE '0'       *IN30                           S01157
     C                     MOVE '0'       *IN09                           S01157
     C*                                                                   S01157
     C* IF DEAL IS A FLOOR DO NOT OUTPUT CEILING RATE                     S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RF'                                      S01157
     C                     MOVE '1'       *IN30                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C* IF DEAL IS A CAP DO NOT OUTPUT FLOOR RATE                         S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C                     MOVE '1'       *IN09                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C*                                                                   S01157
     C* IF FLOOR ALLOWED                                                  S01157
     C*                                                                   S01157
     C           *IN09     IFEQ '0'                                       S01157
     C*********************TESTB'1'       UDSTI          85         S01157E23400
     C************IN85*****IFEQ '1'                                 S01157E23400
     C*********************Z-SUBFLRAT     POSRAT 117                S01157E23400
     C*********************ELSE                                     S01157E23400
     C*********************Z-ADDFLRAT     POSRAT                    S01157E23400
     C*********************END                                      S01157E23400
     C                     Z-ADDFLRAT     POSRAT 117                      E23400
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE POSRAT    ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SFLRAT                          S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF CEILING ALLOWED                                                S01157
     C*                                                                   S01157
     C           *IN30     IFEQ '0'                                       S01157
     C*                                                                   S01157
     C*********************TESTB'1'       UDSTI          85         S01157E23400
     C************IN85*****IFEQ '1'                                 S01157E23400
     C*********************Z-SUBCLRAT     POSRAT                    S01157E23400
     C*********************ELSE                                     S01157E23400
     C                     Z-ADDCLRAT     POSRAT                          S01157
     C*********************END                                      S01157E23400
     C                     MOVE *BLANKS   ZAMTW                           S01157
     C                     MOVE POSRAT    ZAMTW                           S01157
     C                     MOVE '7'       ZQECN                           S01157
     C                     EXSR DLSCON                                    S01157
     C                     MOVE ZAMTD     SCLRAT                          S01157
     C*                                                                   S01157
     C                     END                                            S01157
     C*                                                                   S01157
      ***                                                                 S01157
     C                     TESTB'3'       UDSTI          85               S01157
     C           *IN85     IFEQ '1'                                       S01157
     C                     MOVE 'Y'       SAVRAM                          S01157
     C                     ELSE                                           S01157
     C                     TESTB'3'       TDSTI          85
     C           *IN85     IFEQ '1'
     C                     MOVE 'Y'       SAVRAM
     C                     ELSE
     C                     MOVE 'N'       SAVRAM
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604RC10                                           S01408
     C*                                                                   S01408
      *                                                                   CIR001
      ** Format Up-front fee (premium) details for display.               CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           UPVD      IFEQ *ZEROS                                    CIR001
     C                     MOVE *BLANKS   SUPVD                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE UPVD      ZDAYNO                          CIR001
     C                     EXSR ZDATE2                                    CIR001
     C                     MOVE ZDATE     SUPVD                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           UPFE      IFEQ *ZEROS                                    CIR001
     C                     MOVE *BLANKS   SUPFE                           CIR001
     C                     ELSE                                           CIR001
     C                     CALL 'AOCURRR0'                                CIR001
     C                     PARM '*DBERR ' @RTCD   7                       CIR001
     C                     PARM '*KEY   ' @OPTN   7                       CIR001
     C                     PARM SUCUCY    @CYCD   3                       CIR001
     C           SDCURR    PARM SDCURR    DSSDY                           CIR001
      *                                                                   CIR001
     C                     MOVE *BLANKS   ZAMTW                           CIR001
     C                     MOVE UPFE      ZAMTW                           CIR001
     C                     MOVE A6NBDP    ZQECN                           CIR001
     C                     EXSR DLSCON                                    CIR001
     C                     MOVE ZAMTD     SUPFE                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C/COPY WNCPYSRC,DL1604RC20
     C                     END                                            CIR001
     C/COPY WNCPYSRC,DL1604RC29
      *                                                                   CEU003
      ** Move Settlement Currency on the screen                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           WSUCIN    ANDEQ'Y'                                       CEU003
     C           CEU003    OREQ 'Y'                                       CEU003
     C           UCUCY     ANDEQBKEURO                                    CEU003
      *                                                                   CEU003
     C                     MOVELPSCY      SSTCY                           CEU003
     C                     MOVELIC72      SIC72                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVE '1'       *IN73                           CEU003
     C                     MOVE '1'       *IN71                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604RC11                                           S01408
     C*                                                                   S01408
      *
     C                     MOVE RSETM     SRSETM
     C                     MOVE PSETM     SPSETM
     C**********           MOVE URACC     SURACC                          S01117
     C**********           MOVE UPACC     SUPACC                          S01117
     C*                                                                   S01117
     C* If multibranching on, receiving/paying accounts must have         S01117
     C* receive/pay branch (3A) added at the front                        S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP4                                           S01408
      *                                                                   S01408
     C* (Branch is only displayed if settlement method = '05')            S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SORACC                          S01117
     C                     MOVE *BLANKS   SOPACC                          S01117
     C*                                                                   S01117
      *           === RECEIVE METHOD ===                                  S01117
      ** If Multibranched and settlement method = '05'                    S01117
      *                                                                   S01117
     C           *IN83     IFEQ '1'                                       S01117
     C           SRSETM    ANDEQ'05'                                      S01117
     C                     MOVELROBR      SORACC                          S01117
     C                     MOVE URACC     SORACC                          S01117
      *                                                                   S01117
      ** Else if not Multibranched, or Multibranched and                  S01117
      ** settlement method not = '05'                                     S01117
      *                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVELURACC     SORACC                          S01117
     C                     END                                            S01117
      *                                                                   S01117
      *           === PAYMENT METHOD ===                                  S01117
      ** If Multibranched and settlement method = '05'                    S01117
      *                                                                   S01117
     C           *IN83     IFEQ '1'                                       S01117
     C           SPSETM    ANDEQ'05'                                      S01117
     C                     MOVELPOBR      SOPACC                          S01117
     C                     MOVE UPACC     SOPACC                          S01117
      *                                                                   S01117
      ** Else if not Multibranched, or Multibranched and                  S01117
      ** settlement method not = '05'                                     S01117
      *                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVELUPACC     SOPACC                          S01117
     C                     END                                            S01117
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP5                                           S01408
      *                                                                   S01408
      *                                                                   S01117
     C                     MOVE CPPBK     SCPPBK
     C                     MOVE CPRBK     SCPRBK
     C                     MOVE FACO      SFACO
     C/COPY WNCPYSRC,DL1604RC30
     C                     MOVE SPI       SSPI
      * SAVE CUST NO.
     C**********           Z-ADDCNUM      CNUMX   60                                          CSD027
     C                     MOVE CNUM      CNUMX   6                                           CSD027
      *                                                                   CIR005
      ** Move Business Day Conventions Fields to screen fields            CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVELL1CYP1    SC1P1                           CIR005
     C                     MOVELL1CYP2    SC2P1                           CIR005
     C                     MOVELL1CYP3    SC3P1                           CIR005
     C                     MOVELL1CYP4    SC4P1                           CIR005
     C                     MOVELL1CYP5    SC5P1                           CIR005
     C                     MOVELL1CYP6    SC6P1                           CIR005
     C                     MOVELL1CYP7    SC7P1                           CIR005
     C                     MOVELL1CYP8    SC8P1                           CIR005
     C                     MOVELL1CYP9    SC9P1                           CIR005
     C                     MOVELL1CYP0    SC0P1                           CIR005
     C                     MOVELL1PDCN    SPDC1                           CIR005
     C                     MOVELL1AMCN    SAMC1                           CIR005
     C                     MOVELL1CYR1    SC1R1                           CIR005
     C                     MOVELL1CYR2    SC2R1                           CIR005
     C                     MOVELL1CYR3    SC3R1                           CIR005
     C                     MOVELL1CYR4    SC4R1                           CIR005
     C                     MOVELL1CYR5    SC5R1                           CIR005
     C                     MOVELL1CYR6    SC6R1                           CIR005
     C                     MOVELL1CYR7    SC7R1                           CIR005
     C                     MOVELL1CYR8    SC8R1                           CIR005
     C                     MOVELL1CYR9    SC9R1                           CIR005
     C                     MOVELL1CYR0    SC0R1                           CIR005
     C                     ENDIF                                          CIR005
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************   S01199
      *********************                                           *   S01199
      ***SCRNA**SR.****To*write / read initial screen 'A' & control   *   S01199
      ********************* facility                                  *   S01199
      *****************************************************************   S01199
      *********************                                               S01199
     C***********SCRNA*****BEGSR                           ***  SCRNA ****S01199
      *********************                                               S01199
     C*********************EXFMTDL1600FA                                  S01199
      *********************                                               S01199
      ***If*'HELP'*requested, call MHELP pgm                              S01199
     C************IN01*****DOWEQ'1'                                       S01199
     C*********************EXSR HELP                                      S01199
     C*********************READ DL1600FA                 86               S01199
     C*********************END                                            S01199
      *********************                                               S01199
     C*********************ENDSR                                          S01199
      ********************************************************************S01199
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SCRNS  SR.    To write / read  RL 1st reversal screen 'S'    *
      *                & control HELP facility                        *
      *****************************************************************
     C           SCRNS     BEGSR                           ***  SCRNS ****
      *
     C*                                                                   S01157
     C*                                                                   S01157
     C* RESET FLOOR & CEILING INDICATORS                                  S01157
     C*                                                                   S01157
     C                     MOVE '0'       *IN09                           S01157
     C                     MOVE '0'       *IN30                           S01157
     C                     MOVE '0'       *IN33                           S01157
     C*                                                                   S01157
     C* IF DEAL IS A CAP DO NOT OUTPUT FLOOR OR COLLAR                    S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RP'                                      S01157
     C                     MOVE '1'       *IN09                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF DEAL IS A FLOOR DO NOT OUTPUT COLLAR OR CAP                    S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RF'                                      S01157
     C                     MOVE '1'       *IN30                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C* IF DEAL IS A COLLAR SET TITLE AS COLLAR                           S01157
     C*                                                                   S01157
     C           NEWDT     IFEQ 'RR'                                      S01157
     C                     MOVE '1'       *IN33                           S01157
     C                     END                                            S01157
     C*                                                                   S01157
     C/COPY WNCPYSRC,DL1604RC24
     C                     EXFMTDL1600FS
     C/COPY WNCPYSRC,DL1604RC25
      ***If*'HELP'*requested,*call*MHELP*pgm*****************             S01199
     C************IN01*****DOWEQ'1'                                       S01199
     C*********************EXSR HELP                                      S01199
     C*********************READ DL1600FS                 86               S01199
     C*********************END                                            S01199
      *
     C                     ENDSR
      ********************************************************************
      /SPACE 3
      *****************************************************************   S01199
      *********************                                           *   S01199
      ***SCRNT**SR.****To*write*/*read**RL 2nd reversal screen 'T'    *   S01199
      *****************&*control HELP facility                        *   S01199
      *****************************************************************   S01199
      *********************                                               S01199
     C***********SCRNT*****BEGSR                           ***  SCRNT ****S01199
      *********************                                               S01199
     C*********************EXFMTDL1600FT                                  S01199
      *********************                                               S01199
      ***If*'HELP'*requested, call MHELP pgm                              S01199
     C************IN01*****DOWEQ'1'                                       S01199
     C*********************EXSR HELP                                      S01199
     C*********************READ DL1600FT                 86               S01199
     C*********************END                                            S01199
      *********************                                               S01199
     C*********************ENDSR                                          S01199
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SETOF SR.     To setof all error indicator, clear arrays     *
      *                and screen error fields                        *
      *                ( Except *IN08 & SERCD2 where record updated   *
      *                by another wkstn. Do this after display fmt )  *
      *****************************************************************
      *
     C           SETOF     BEGSR                           ***  SETOF ****
      **
     C                     MOVEA'000'     *IN,5
      *                                                                   S01194
      ** *IN11 (Profit Centre) must not be setof                          S01194
      *                                                                   S01194
     C*****                MOVEA'00000000'*IN,10                          S01194
     C                     MOVEA'0'       *IN,10                          S01194
     C                     MOVEA'000000'  *IN,12                          S01194
     C                     MOVEA'00000000'*IN,18
     C*****                MOVEA'00000000'*IN,26                          S01117
     C                     MOVEA'0000'    *IN,26                          S01117
      *                                                                   CIR006
      **  Indicator 31 must not be setoff.                                CIR006
      *                                                                   CIR006
     C**********           MOVEA'00'      *IN,31                   S01117 CIR006
     C                     MOVE '0'       *IN32                           CIR006
     C                     MOVEA'00000000'*IN,34
     C                     MOVEA'00000000'*IN,42
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'00000'   *IN,66
     C                     MOVEA*BLANKS   ERCD
     C                     MOVEA*BLANKS   WRCD
     C/COPY WNCPYSRC,DL1604RC04
     C                     MOVE *BLANKS   SERCD1
     C/COPY WNCPYSRC,DL1604RC05
      *  Do not blank message here if 'Record updated.....'
     C           *IN08     IFEQ '0'
     C                     MOVE *BLANKS   SERCD2
     C                     END
     C                     Z-ADD0         S       20
     C                     Z-ADD0         W       20
      **
     C                     ENDSR
      ********************************************************************
      /SPACE 3
      *****************************************************************   S01199
      *****************************************************************   S01199
      ***HELP**SR.*****To*call*MHELP*pgm*&*pass*error*codes************   S01199
      *****************************************************************   S01199
      *****************************************************************   S01199
     C********** HELP      BEGSR                           ***  HELP  ****S01199
      **********                                                          S01199
     C**********           MOVEL'DL1604'  HBPGM   6                       S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
      **********                                                          S01199
     C**********           ENDSR                                          S01199
      **********                                                          S01199
      ********************************************************************S01199
      /EJECT
      *****************************************************************
      *                                                               *
      *  URLRV   SR.   To update files for a RL reverse        (P09)  *
      *****************************************************************
      *
     C           URLRV     BEGSR                           ***  URLRV ****
      /SPACE 2
      **  Check that record has not been updated since initial screen
     C                     Z-ADD0         DLKEY
     C                     MOVELSDLNO     DLKEY
     C/COPY WNCPYSRC,DL1604RC06
      /SPACE
     C           DLKEY     CHAINDEALS                86
      /SPACE
      **  If detail record not found, or trans. no. last update changed
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C           TNLUX     ORNE TNLU
     C                     EXCPTREL
     C                     MOVELERRMSG,2  SERCD2
     C                     SETON                     08
     C                     ELSE
      /SPACE
      **  Set confirmation indicators for PF/DTRIXDD and PF/DEALSDG
     C/COPY WNCPYSRC,DL1604RC07
     C                     EXSR CONFI
     C/COPY WNCPYSRC,DL1604RC08
      /SPACE
      **  Set up data structure to provide text on journal comit entry
     C                     EXSR ZTNLU1
     C                     EXSR CMTXT
      *                                                                   CEU003
      ** Determine the effective currency for use in PRONO/MEMOS          CEU003
      ** OLPOS/RSACTM.                                                    CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WSTCY   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           *IN73     ANDEQ'0'                                       CEU003
     C           SSTCY     ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELSSTCY     WSTCY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELUCUCY     WSTCY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP6                                           S01408
      *                                                                   S01408
      /SPACE
      **  Update files
      *
      **  Check if PF/MEMOS is to be updated
      **  Shadow post only if Retail module present
      **  and retail account numbers used
      /SPACE
     C********** *IN89     IFEQ '1'                                       S01194
     C           BGRTBN    IFEQ 'Y'                                       S01194
     C           *IN88     ANDEQ'1'
      /SPACE
      **   Process only , if deal is back-valued
     C*****      VDAT      ANDLTRUND                                      S01194
     C           VDAT      ANDLTBJRDNB                                    S01194
     C           SAVRAM    ANDNE'Y'
     C           CIR006    ANDEQ'N'                                       CIR006
      /SPACE
      *                                                                   S01117
      **  The profit centre is moved to a work field because in the       S01117
      **      update memos sub-routine it is blanked out when the         S01117
      **      ACCNT file is accessed. The work field is moved back        S01117
      **      into the profit centre after the sub-routine call.          S01117
      **  Ditto for booking branch.                                       S01117
     C                     MOVE PRFC      @PRFC   4                       S01117
     C                     MOVE BRCA      @WBRCA  3                       S01117
      *                                                                   S01117
     C                     EXSR UMEMOS
      *                                                                   S01117
     C                     MOVE @PRFC     PRFC                            S01117
     C                     MOVE @WBRCA    BRCA                            S01117
      *                                                                   S01117
     C                     END
      /SPACE
      **  Update PF/DEALSDG ( IRS cap/collar deal record )
     C                     EXSR URDLDG
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP1                                           S01408
      *                                                                   S01408
      /SPACE
      **  Write PF/DTRIXDD ( deal transaction index detail record )
     C/COPY WNCPYSRC,DL1604RC09
     C                     EXSR WDTDD
     C/COPY WNCPYSRC,DL1604RC13
      /SPACE
      ** For all non-average deals
     C           SAVRAM    IFNE 'Y'
      /SPACE
      **  Update LF/OLPOS ( on line positions )
      /SPACE
     C           CIR006    IFEQ 'N'                                       CIR006
     C                     EXSR UOLPOS
      /SPACE
      **  Update LF/PRONO ( Projected nostros )
     C                     EXSR UPRONO
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     CALL 'AOOUSWU0'                                CIR006
     C                     PARM *BLANK    ##RTCD  7                       CIR006
     C                     PARM           Z#BSTS                          CIR006
     C                     PARM           Z#ASTS                          CIR006
     C                     PARM           Z#WSTS                          CIR003
     C                     PARM           Z#XSTS                          CIR003
     C                     PARM           Z#YSTS                          CIR003
     C                     PARM           Z#ZSTS                          CIR003
      *                                                                   CIR006
     C           ##RTCD    IFEQ '*ERROR'                                  CIR006
     C                     MOVEL'AOOUSWU0'DBFILE                          CIR006
     C                     Z-ADD31        DBASE                           CIR006
     C                     MOVEL*BLANK    DBKEY                           CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     END
      /SPACE
      **  Update PF/DEALSDF ( deals trailer record )
     C                     EXSR UDLDF
      /SPACE
      **  Update PF/DTRIXHH ( deal transaction header record )
     C/COPY WNCPYSRC,DL1604RC14
     C                     EXSR UDTHH
     C/COPY WNCPYSRC,DL1604RC15
      *                                                                   CIR001
      ** Up-front fee (premium) updates                                   CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C                     EXSR #LPREM                                    CIR001
     C                     END                                            CIR001
      /SPACE 2
      **  End of commitment cycle
      *
     C*                                                                   S01157
     C* CALL SUMMARY UPDATE PGM                                           S01157
     C*                                                                   S01157
     C* SETUP DEAL NO.                                                    S01157
     C*                                                                   S01157
     C                     MOVE SDLNO     @DLNUM                          S01157
     C*                                                                   S01157
     C                     CALL 'DL1911'                                  S01157
     C                     PARM           @TERM   1                       S01157
     C                     PARM           @DLNUM  60                      S01157
     C                     PARM           SACCD                           S01157
     C                     PARM           SUCUCY                          S01157
     C*                                                                   S01157
     C           @TERM     IFEQ 'E'                                       S01157
     C                     EXSR INFSR                                     S01157
     C                     END                                            S01157
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C                     MOVELSDLNO     T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C                     PARM           T#TREF 20                       CDE001
     C                     PARM 'CFCO'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604RWIN                                           S01408
     C*                                                                   S01408
     C*                                                                   S01157
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,DL1604RCP2                                           S01408
      *                                                                   S01408
     C                     END
      *
     C                     ENDSR
      ********************************************************************
     C/COPY WNCPYSRC,DL1604RCP3                                           S01408
      /EJECT
      *****************************************************************
      *                                                               *
      *  UMEMOS SR.    To update PF/MEMOS shadow postings file        *
      *                                                               *
      *****************************************************************
      *
     C           UMEMOS    BEGSR                           *** UMEMOS ****
      **
      *
      **  SET UP WORK FIELDS
      *
     C*****      RUND      ADD  1         RANGE   50                      S01194
     C           BJRDNB    ADD  1         RANGE   50                      S01194
     C                     MOVE 'M'       XMOP    1
      *
     C                     Z-ADD0         XCOMPL
     C                     Z-ADD0         XPAY    10
     C                     Z-ADD0         XREC    10
      * MEMOS BALANCES
     C                     Z-ADD0         MPAY   150
     C                     Z-ADD0         MREC   150
      /SPACE 2
      **   Process Our Details
      *~~~~~~~~~~~~~~~~~~~~~~~~
      *
      *
     C                     TESTB'0'       UDNSI          85
     C           *IN85     IFEQ '0'
     C           UBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Process THEIR Details
      *~~~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C                     TESTB'0'       TDNSI          85
     C           *IN85     IFEQ '0'
     C           TBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Calculate interest & update shadow balances until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      *
      /SPACE 2
      **   Only process Details if instructions settled through
      **   a retail account,
      *
     C                     MOVE '00'      WSETM   2
     C**********           MOVE *BLANKS   WBNKAC 12                                           CGL029
     C                     MOVE *BLANKS   WBNKAC 18                                           CGL029
     C**********           Z-ADDCNUMX     DCNUM                                               CSD027
     C                     MOVE CNUMX     DCNUM                                               CSD027
     C***********          MOVE SUCUCY    DDCCY                           CEU003
     C                     MOVELWSTCY     DDCCY                           CEU003
      *
     C           XREC      IFEQ 1                          RECEIPTS
     C           RSETM     IFNE 0
      *                                                                   S01117
     C* MOVE RECEIVE BRANCH CODE TO WORK FIELD FOR CHAIN TO 'ACCNT'       S01117
     C*                                                                   S01117
     C                     MOVE ROBR      @@BRCA  3                       S01117
     C*                                                                   S01117
     C                     MOVE RSETM     WSETM
     C                     END
     C                     MOVELURACC     WBNKAC
     C                     END
      /SPACE 2
     C           XPAY      IFEQ 1                          PAYMENTS
      **
     C           PSETM     IFNE 0
      **                                                                  S01117
     C* MOVE PAYMENT BRANCH CODE TO WORK FIELD FOR CHAIN TO 'ACCNT'       S01117
     C*                                                                   S01117
     C                     MOVE POBR      WWBRCA                          S01117
     C*                                                                   S01117
     C                     MOVE PSETM     DSETM
     C                     END
     C                     MOVELUPACC     DBNKAC
      **                                                   SETTL METHOD
     C           DSETM     IFEQ WSETM                      PAY = REC
     C           DBNKAC    ANDEQWBNKAC
     C           WWBRCA    ANDEQ@@BRCA                                    S01117
     C                     ADD  MREC      MPAY
     C                     Z-ADD0         XREC             ONE ACCESS ONLY
     C                     END
      **
     C                     EXSR TSTRTL
      *
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******IFGT 0                                         CCB002
      *                                                                   CCB002
      *****Access*PF/MEMOS*record                                         CCB002
      *                                                                   CCB002
     C***********RRNM******CHAINMEMOS                86                   CCB002
      *****End*if**detail*record not found                                CCB002
     C************IN86*****IFEQ '1'                                       CCB002
     C***********RECI******ORNE 'D'                                       CCB002
     C************LOCK     IN   LDA                                       S01194
     C*********************MOVE '16'      DBASE            ***************CCB002
     C*********************MOVE 'MEMOS'   DBFILE           *   DBERROR   *CCB002
     C*********************MOVELRRNM      DBKEY            *      16     *CCB002
     C******************** EXSR DBERR                      ***************S01194
     C*********************EXSR *PSSR                      *********S01194CCB002
     C*********************END                                            CCB002
      *                                                                   CCB002
      ** If account is retail                                             CCB002
      *                                                                   CCB002
     C           WRETL     IFEQ 'Y'                                       CCB002
      *
      **   Update shadow balances record
      *
     C*********************ADD  MPAY      LDBLN                           CCB002
     C*********************ADD  MPAY      CLBLN                           CCB002
     C                     Z-ADDMPAY      #PAMT  150                      CCB002
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD  7        I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO 100       O:Retail A/C NoCCB002
     C**********           PARM WCNUM     W0CNUM  60       O:Customer No.              CCB002 CSD027
     C                     PARM WCNUM     W0CNUM  6        O:Customer No.                     CSD027
     C                     PARM WCCY      W0CCY   3        O:Currency     CCB002
     C**********           PARM WACOD     W0ACOD  40       O:Account Code              CCB002 CGL029
     C                     PARM WACOD     W0ACOD 100                                          CGL029
     C                     PARM WACSQ     W0ACSQ  20       O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA  3        O:Branch       CCB002
     C                     PARM PTDT      W0PSTD  50       O:Posting date CCB002
     C                     PARM VUDT      W0VDAT  50       O:Value date   CCB002
     C                     PARM #PAMT     W0AMT  150       O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV  1        O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '16'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 16 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604RC31
     C*                                                                   S01154
     C* If not a nostro account then output posting details to RSACMTPD   S01154
     C*                                                                   S01154
     C           WNOST     IFEQ 'N'                                       S01154
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    S01154
     C                     END                                            S01154
     C*                                                                   S01154
     C                     END
     C                     END
      /SPACE 2
     C           XREC      IFEQ 1                          RECEIPTS
      **
     C                     MOVE WSETM     DSETM
     C                     MOVELWBNKAC    DBNKAC
     C                     MOVE @@BRCA    WWBRCA                          S01117
      **
     C                     EXSR TSTRTL
      *
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******IFGT 0                                         CCB002
      *                                                                   CCB002
      *****Access*PF/MEMOS*record                                         CCB002
      *                                                                   CCB002
     C***********RRNM******CHAINMEMOS                86                   CCB002
      *****End*if**detail*record not found                                CCB002
     C************IN86*****IFEQ '1'                                       CCB002
     C***********RECI******ORNE 'D'                                       CCB002
     C************LOCK     IN   LDA                                       S01194
     C*********************MOVE '17'      DBASE            ***************CCB002
     C*********************MOVE 'MEMOS'   DBFILE           *   DBERROR   *CCB002
     C*********************MOVELRRNM      DBKEY            *      17     *CCB002
     C******************** EXSR DBERR                      ***************S01194
     C*********************EXSR *PSSR                      *********S01194CCB002
     C*********************END                                            CCB002
      *                                                                   CCB002
      ** If account is retail                                             CCB002
      *                                                                   CCB002
     C           WRETL     IFEQ 'Y'                                       CCB002
      *
      **   Update shadow balances record
      *
     C*********************ADD  MREC      LDBLN                           CCB002
     C*********************ADD  MREC      CLBLN                           CCB002
     C                     Z-ADDMREC      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM WCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM WCCY      W0CCY            O:Currency     CCB002
     C                     PARM WACOD     W0ACOD           O:Account Code CCB002
     C                     PARM WACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '17'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 17 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604RC32
     C*                                                                   S01154
     C* If not a nostro account then output posting details to RSACMTPD   S01154
     C*                                                                   S01154
     C           WNOST     IFEQ 'N'                                       S01154
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    S01154
     C                     END                                            S01154
     C*                                                                   S01154
     C                     END
     C                     END
      *
     C**********           Z-ADDCNUMX     CNUM                                                CSD027
     C                     MOVE CNUMX     CNUM                                                CSD027
      **
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  URDLDG SR.    To update PF/DEALSDG cap/collar IRS            *
      *                transaction detail record for a reverse  (U04) *
      *****************************************************************
      *
     C           URDLDG    BEGSR                           *** URDLDG ****
      **
     C                     MOVE 'R'       RECI
      *  (NB Confirmation inds set in subroutine CONFI )
     C********             Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'R'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATDEALSDGF
      *                                                                   CIR006
     C                     MOVE URACC     ##URAC                          CIR006
     C                     MOVE UPACC     ##UPAC                          CIR006
     C                     MOVE POBR      ##OPBR                          CIR006
     C                     MOVE ROBR      ##ORBR                          CIR006
     C                     MOVELIRDEAL    Z#ASTS                          CIR006
      **
     C                     ENDSR
      ********************************************************************
      /SPACE 2
      *****************************************************************
      *                                                               *
      *  WDTDD  SR.    To write PF/DTRIXDD deal transaction index     *
      *                record                                   (W18) *
      *****************************************************************
      *
     C           WDTDD     BEGSR                           ***  WDTDD ****
      *
     C                     MOVE 'D'       RECI
     C                     MOVE 'D'       RCDT
     C                     MOVE SDLNO     DLNO
     C                     Z-ADD0         VDAT
     C                     Z-ADD0         DASN
     C                     MOVE SACCD     CHTP
      *  (NB Confirmation inds set in subroutine CONFI )
     C                     MOVE 'N'       CNPR
     C                     MOVE ' '       REPR
      *  ( NB. Only HH:MM: put out on file in field 'TIM' )
     C                     TIME           MTIME
     C                     MOVE 'N'       DADI
     C                     Z-ADD0         PRI1
     C                     Z-ADD0         PRI2
     C                     Z-ADD0         PRI3
     C                     Z-ADD0         ICIN
     C********** SBRCD     IFEQ *BLANKS                                   S01117
     C           SBRCA     IFEQ *BLANKS                                   S01117
     C**********           MOVE DFBR      BRCD                            S01117
     C                     MOVE ZDBRN     BRCA                            S01117
     C                     ELSE
     C**********           MOVE SBRCD     BRCD                            S01117
     C                     MOVE SBRCA     BRCA                            S01117
     C                     END
     C                     Z-ADDNATN      TNLU
      /SPACE
     C                     WRITEDTRIXDF
      **
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UOLPOS SR.    To update LF/OLPOS on line positions file      *
      *                                                               *
      *****************************************************************
      *
     C           UOLPOS    BEGSR                           *** UOLPOS ****
      *
      **   Access Olpos record
      *
      **   Process Details only, if an active record is found
      *
     C           OLKEY     KLIST
     C                     KFLD           BRCA                            S01117
     C***********          KFLD           UCUCY                           CEU003
     C                     KFLD           WSTCY                           CEU003
     C                     KFLD           OLPNO   20
      *
     C                     MOVE '02'      OLPNO
     C           OLKEY     CHAINOLPOS                86
      *
      *    Release PF/OLPOSOA record if record found, but not live
      *
     C           *IN86     IFEQ '0'
     C           RECI      ANDNE'D'
      *
     C                     EXCPTRELOL
     C                     MOVE '1'       *IN86
     C                     END
      *
      **  SET UP WORK FIELDS
      *
     C           *IN86     IFEQ '0'
      *
     C                     MOVE 'O'       XMOP
      *
     C           MDAT      ADD  1         RANGE
     C                     Z-ADD0         XCOMPL  10
     C                     Z-ADD0         XPAY    10
     C                     Z-ADD0         XREC    10
     C*                                                                   S01117
     C* Store BRCA in temporary work field to prevent possible            S01117
     C* corruption in OUTPOS SR                                           S01117
     C*                                                                   S01117
     C                     MOVE BRCA      ##BRCA  3                       S01117
      /SPACE 2
      **   Process Our Details
      *~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C                     TESTB'0'       UDNSI          85
     C           *IN85     IFEQ '0'
     C           UBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /EJECT
      *
      **   Process Their Details
      *~~~~~~~~~~~~~~~~~~~~~~~~~~~
      *
     C                     TESTB'0'       TDNSI          85
     C           *IN85     IFEQ '0'
     C           TBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   Calculate interest & update shadow balances until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      /SPACE 2
      **   Update on line positions record
     C           XPAY      IFEQ 1
     C           XREC      OREQ 1
      *
     C                     Z-ADDNATN      TNLU
     C                     MOVE ##BRCA    BRCA                            S01117
     C                     UPDATOLPOSOAF
     C                     END
      **
     C                     END
      **
     C                     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPRONO SR.    To update LF/PRONO projected nostros file      *
      *                                                               *
      *****************************************************************
      *
     C           UPRONO    BEGSR                           *** UPRONO ****
      *
     C           PRKEY     KLIST
     C***********          KFLD           UCUCY                           CEU003
     C                     KFLD           WSTCY                           CEU003
     C                     KFLD           PRNNO   20
      *
     C                     MOVE 'P'       XMOP
      *
     C                     Z-ADD0         XCOMPL  10
     C                     Z-ADD0         PPAY
     C                     Z-ADD0         PREC
     C                     MOVE *BLANKS   @PNOST  1                       E20928
     C                     MOVE *BLANKS   @RNOST  1                       E20928
      *
     C                     Z-ADD0         RANGE
     C**********           MOVE *BLANKS   XUPACC 12                                           CGL029
     C**********           MOVE *BLANKS   XURACC 12                                           CGL029
     C                     MOVE *BLANKS   XUPACC 18                                           CGL029
     C                     MOVE *BLANKS   XURACC 18                                           CGL029
      *
      **   Process if payment, or receipt settled through a nostro
      *
     C           PSETM     IFEQ 01
     C           PSETM     OREQ 02
     C           PSETM     OREQ 07
     C           PSETM     OREQ 08
     C           PSETM     OREQ 12
      *                                                     PAYMENT
     C**  Set @PNOST to Yes to indicate nostro on Pay side                E20928
     C                     MOVE 'Y'       @PNOST  1                       E20928
     C*                                                                   E20928
     C                     MOVELUPACC     PRNNO
     C           PRKEY     CHAINPRONO                86
      *
      **   If record not found, use 'unallocated' code
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD0         PRNNO
     C           PRKEY     CHAINPRONO                86
     C                     END
      *
     C           *IN86     IFNE '1'
     C           RECI      ANDEQ'D'
      *
      *   Range End Date is up to the 6th working day
     C           PDAT,5    ADD  1         ZDAYNO
     C***********          MOVE UCUCY     ZCCY                            CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C******************** MOVE 'Y'       ZOPT                            S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C*                                                                   S01195
     C* If payment nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C*                                                                   S01195
     C           @PNLOC    IFEQ *BLANKS                                   S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C*                                                                   S01195
     C                     MOVELUPACC     WRK2    2                       S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C*                                                                   S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C*                                                                   S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save payment nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C*                                                                   S01195
     C                     MOVE A7NOSN    @PNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
      *    Save the value of the 6th working day
     C                     Z-ADDZDYNBR    RANGE   50
     C                     MOVELPRNNO     XUPACC
     C                     END
      /EJECT
      *    Release PF/PRONOPN record if record found
      *
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
     C                     END
      /SPACE 2
     C           RSETM     IFEQ 01
     C           RSETM     OREQ 02
     C           RSETM     OREQ 07
     C           RSETM     OREQ 08
     C           RSETM     OREQ 12
      *                                                     RECEIPT
     C**  Set @RNOST to Yes to indicate nostro on Receive side            E20928
     C                     MOVE 'Y'       @RNOST  1                       E20928
     C*                                                                   E20928
     C                     MOVELURACC     PRNNO
     C           PRKEY     CHAINPRONO                86
      *
      **   If record not found, use 'unallocated' code
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD0         PRNNO
     C           PRKEY     CHAINPRONO                86
     C                     END
      *
     C           *IN86     IFNE '1'
     C           RECI      ANDEQ'D'
      *
      *   Range End Date is up to the 6th working day
     C           RANGE     IFEQ 0
     C           PDAT,5    ADD  1         ZDAYNO
     C***********          MOVE UCUCY     ZCCY                            CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C******************** MOVE 'Y'       ZOPT                            S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C*                                                                   S01195
     C* If receive nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C*                                                                   S01195
     C           @RNLOC    IFEQ *BLANKS                                   S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C*                                                                   S01195
     C                     MOVELURACC     WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C*                                                                   S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C*                                                                   S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save receive nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C*                                                                   S01195
     C                     MOVE A7NOSN    @RNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     EXSR ZFWDT                                     S01195
      *    Save the value of the 6th working day
     C                     Z-ADDZDYNBR    RANGE   50
     C                     END
     C                     MOVELPRNNO     XURACC
     C                     END
      *
      *    Release PF/PRONOPN record, if record found
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
     C                     END
      /SPACE 2
      * NOT A NOSTRO - IGNORE
      *
     C           RANGE     IFNE 0
      *
     C           RANGE     IFGT MDAT
     C           MDAT      ADD  1         RANGE
     C                     END
      /EJECT
      *
      **   OUR details
      *   ~~~~~~~~~~~~~~
      **   Process if floating rate present
      *
     C                     TESTB'0'       UDNSI          85
     C           *IN85     IFEQ '0'
     C           UBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 2
      **   THEIR details
      *   ~~~~~~~~~~~~~~~~
      **   Process if floating rate present
      *
     C                     TESTB'0'       TDNSI          85
     C           *IN85     IFEQ '0'
     C           TBRTT     ANDNE0
      * FLOATING RATE NOT SET
     C                     ADD  1         XCOMPL
     C                     END
      /SPACE 4
      **   Calculate interest & update PROJECTED NOSTRO BALANCES until
      **   exit conditions met
      *
     C           XCOMPL    CASEQ0         MOPSR
     C                     END
      /SPACE 4
      **   Update projected nostros
      **    One access to the file, if Pay Acc. *EQ Rec Acc..
      *                                                     PAYMENT
     C           XUPACC    IFEQ XURACC                      *EQ RECEIPT
     C           XUPACC    ANDNE*BLANKS
     C           XPAY      ANDNE0
     C                     ADD  PREC      PPAY
     C                     Z-ADD0         XREC
     C                     END
      /EJECT
      *
      **   Access Prono record
      *                                                     PAYMENT
     C           XPAY      IFNE 0
     C           XUPACC    ANDNE*BLANKS
     C                     MOVELXUPACC    PRNNO
     C           PRKEY     CHAINPRONO                86
      *
     C           *IN86     IFEQ '0'
     C           RECI      ANDEQ'D'
      *
      **   Update projected nostros record
      *
     C                     ADD  PPAY      PBAL
      *
     C                     Z-ADDNATN      TNLU
     C                     UPDATPRONOPNF
     C                     END
     C                     END
      /SPACE 4
      *                                                     RECEIPT
     C           XREC      IFNE 0
     C           XURACC    ANDNE*BLANKS
     C                     MOVELXURACC    PRNNO
     C           PRKEY     CHAINPRONO                86
      *
     C           *IN86     IFEQ '0'
     C           RECI      ANDEQ'D'
      *
      **   Update projected nostros record
      *
     C                     ADD  PREC      PBAL
      *
     C                     Z-ADDNATN      TNLU
     C                     UPDATPRONOPNF
     C                     END
     C                     END
      *
     C                     END
      **
     C                     ENDSR
      *
      ********************************************************************S01154
      /EJECT                                                              S01154
      *****************************************************************   S01154
      *                                                               *   S01154
      *  OUTPOS SR.    Output posting details to RSACMTPD.            *   S01154
      *                                                               *   S01154
      *****************************************************************   S01154
      *                                                                   S01154
     C           OUTPOS    BEGSR                           *** OUTPOS ****S01154
     C**  E20918 - Allow the routine to update RSACMTPD for               E20918
     C**           settlement through retail A/C if amount is not         E20918
     C**           zero.                                                  E20918
      **   Only write a record if the amount is not zero                  E20928
     C           MVAM      IFNE *ZEROS                                    E20918
     C**********                                                   S01154 S01194
     C*****Retrieve*currency*nostro*record*from*'TABDLI'********** S01154 S01194
     C**********                                                   S01154 S01194
     C***********WNOST     IFNE 'N'                                S01154 E20928
     C**********           MOVEL'70'      KEY                      S01154 S01194
     C**********           MOVELUCUCY     WRK5                     S01154 S01194
     C**********           MOVELPRNNO     WRK2                     S01154 S01194
     C********** KEY       CHAINTABDLI               85            S01154 S01194
     C*  XMOP says that either OLPOS, PRONO or MEMOS being processed -    E20928
     C*  if this routine called from UMEMOS (XMOP=M) then account is      E20928
     C*  not a nostro (retail only) so do not call AONOSTR0; if this      E20928
     C*  routine called from MOPSR and XMOP=P then account is a nostro    E20928
     C*  (might be retail also) and file should be accessed.              E20928
     C           XMOP      IFEQ 'P'                                       E20928
     C                     MOVELPRNNO     @NOST                           S01194
     C*                                                                   S01194
     C* CALL ACCESS PROGRAM TO RETRIEVE CURRENCY NOSTRO RECORD            S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C***********          PARM UCUCY     @CCY    3        CurrencyS01194 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM           @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C***********************                                      S01154 E20928
     C********** MVAM      IFNE *ZEROS                             S01154 E20918
     C***********************                                      S01154 E20928
     C*****Only*write*a*record if the amount is                    S01154 E20928
     C*****not*zero**********                                      S01154 E20928
     C***********************                                      S01154 E20928
     C*****      *IN85     IFNE '1'                                S01154 S01194
     C*****      RECI      ANDEQ'D'                                S01154 S01194
     C******Use*fields*from*table*file*to*shadow*post**********    S01154 S01194
     C******************** MOVE CNUM      CUSN                     S01154 S01194
     C******************** MOVE CCY       CCYD                     S01154 S01194
     C******************** MOVE ACOD      ACDE                     S01154 S01194
     C******************** MOVE ACSQ      ASNC                     S01154 S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C*                                                                   S01154
     C* Use fields from SDNOST to Shadow Post.                     S01154 S01194
     C                     MOVE A7CUST    CUSN                     S01154 S01194
     C                     MOVE A7CYCD    CCYD                     S01154 S01194
     C                     MOVE A7ACCD    ACDE                     S01154 S01194
     C                     MOVE A7ACSN    ASNC                     S01154 S01194
     C                     MOVE A7BRCD    BRCA                            S01117
      *                                                                   S01154
     C                     ELSE                                           S01154
      *                                                                   S01154
      *  Else initialise account keys of unallocated nostros.             S01154
      *                                                                   S01154
     C**********           Z-ADD*ZEROS    CUSN                                         S01154 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C***********          MOVE UCUCY     CCYD                     S01154 CEU003
     C                     MOVELWSTCY     CCYD                            CEU003
     C                     Z-ADD*ZEROS    ACDE                            S01154
     C                     Z-ADD*ZEROS    ASNC                            S01154
     C                     MOVE *BLANKS   BRCA                            S01117
      *                                                                   S01154
     C                     END                                            S01154
      *                                                                   S01154
     C                     END                                            E20918
      *                                                                   CRE009
      ** If CRE009 is ON and the account is RE, set the posting date      CRE009
      ** to the same value of the value date when this one is not less    CRE009
      ** than the run date.                                               CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
      *                                                                   CRE009
      ** Determine if account is REtail                                   CRE009
      *                                                                   CRE009
     C                     MOVE *BLANKS   @RET    1                       CRE009
     C           XMOP      IFEQ 'M'                                       CRE009
     C                     MOVE 'Y'       @RET                            CRE009
     C                     ELSE                                           CRE009
     C                     MOVE CUSN      WCNUM                           CRE009
     C                     MOVE CCYD      WCCY                            CRE009
     C                     MOVE ACDE      WACOD                           CRE009
     C                     MOVE ASNC      WACSQ                           CRE009
     C                     MOVE BRCA      WWBRCA                          CRE009
     C           ACCKEY    CHAINACCNT                85                   CRE009
     C           *IN85     IFEQ *OFF                                      CRE009
     C           ATYP      ANDEQ'R'                                       CRE009
     C                     MOVE 'R'       @RET                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C           @RET      IFEQ 'Y'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  S01154
     C/COPY WNCPYSRC,DL1604RC33
     C                     Z-ADD0         MVAM                            S01154
      *                                                                   S01154
     C                     END                                            S01154
      *                                                                   S01154
     C**********           END                                     S01154 E20918
      *                                                                   S01154
     C           OUTEND    ENDSR                                          S01154
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  MOPSR  SR.    Accumulate Interest Due for M/O/P balances'    *
      *                update.                                        *
      *                                                               *
      *****************************************************************
      *
     C           MOPSR     BEGSR
      *
      * Set up work fields
      *
     C                     Z-ADD0         XICSD   50       Calcs STRT date
     C                     Z-ADDRANGE     XICED   50       Calcs END date
     C                     MOVE ' '       XXPAY   1        U/T (Our/Thr)
     C                     Z-ADD0         XPAY    10       Payment made
     C                     Z-ADD0         XREC    10       Payment made
     C                     Z-ADD0         XRRAT  117       Reimb. rate
     C                     Z-ADD0         XTRAT  117       Top-up rate
     C                     Z-ADD0         XUINTD 130       Our Accr Intr
     C                     Z-ADD0         XTINTD 130       Thr Accr Intr
     C                     MOVE 'N'       WRTFL   1                       CIR005
      *
      **   Set Initial MOPSR  FIELDS
      *
     C           UBRTT     IFNE 0
     C                     Z-ADDUEINR     XEINR  117
     C                     Z-ADDURTSP     XRTSP  117
     C                     MOVE USPIN     XSPIN   1
     C                     Z-ADDUBRTE     XBRTE  117
     C                     Z-ADDUINFD     XINFD   50
     C                     Z-ADDUNICD     XNICD   50
     C                     Z-ADDUNIPD     XNIPD   50
     C                     MOVE UICFR     XICFR   1
     C                     MOVE UIPFR     XIPFR   1
     C                     Z-ADDUICFD     XICFD   20
     C                     Z-ADDUIPFD     XIPFD   20
     C                     Z-ADDUICBD     XICBD   50
     C                     Z-ADDUIPBD     XIPBD   50
     C                     ELSE
     C                     Z-ADDTEINR     XEINR
     C                     Z-ADDTRTSP     XRTSP
     C                     MOVE TSPIN     XSPIN
     C                     Z-ADDTBRTE     XBRTE
     C                     Z-ADDTINFD     XINFD
     C                     Z-ADDTNICD     XNICD
     C                     Z-ADDTNIPD     XNIPD
     C                     MOVE TICFR     XICFR
     C                     MOVE TIPFR     XIPFR
     C                     Z-ADDTICFD     XICFD
     C                     Z-ADDTIPFD     XIPFD
     C                     Z-ADDTICBD     XICBD
     C                     Z-ADDTIPBD     XIPBD
     C                     END
      *
      *                                          Accrued Interest To Date
      *
     C                     Z-ADDUIACD     XUICSD  50
     C           UAITC     ADD  UAIAN     XUINTD
     C                     ADD  UAIAP     XUINTD
     C                     SUB  UIPRD     XUINTD
      *
     C                     Z-ADDTIACD     XTICSD  50
     C           TAITC     ADD  TAIAN     XTINTD
     C                     ADD  TAIAP     XTINTD
     C                     SUB  TIPRD     XTINTD
      *
      **   Set Initial Next Interest Payment Date
      *
     C           XNICD     IFEQ 0
     C                     Z-ADDMDAT      XNICD
     C                     END
      *
     C           XNIPD     IFEQ 0
     C           XNICD     ANDNE0
     C                     Z-ADDXNICD     XNIPD
     C                     Z-ADDXICBD     XIPBD
     C                     MOVE XICFR     XIPFR
     C                     Z-ADDXICFD     XIPFD
     C                     MOVE 'Y'       WRTFL                           CIR005
     C                     END
      *
      **   Process ONLY if Next Interest Payment Date LE RANGE
      *
     C           XNIPD     IFGE RANGE
     C                     Z-ADDXNIPD     XNICD
     C                     END
      *
      **   Set Interest Calculation  End Date
      *
     C           XNIPD     IFGT XNICD
     C                     Z-ADDXNICD     XICED
     C                     ELSE
     C                     Z-ADDXNIPD     XICED
     C                     END
     C                     Z-ADDXICED     WXCED   50                      CIR005
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C                     Z-ADDXIPBD     WXCED                           CIR005
     C                     ENDIF                                          CIR005
      /SPACE 5
      **   Calculate interest & update shadow balances until
      **   ALL PAYMENT BALANCES UPDATED.
      *
      /SPACE 3
     C           XICED     DOWLTRANGE                      <<<< LOOP >>>>
      *         ======================
      /SPACE 3
     C                     Z-ADDRANGE     WNIPD   50
     C                     Z-ADD0         WINTD  130
     C                     MOVE ' '       WPR     1        P/R (Pay/Rec)
      *
      ** Determine which side is to PAY.
      ** (initial calcs and after each rate change date)
      *
     C***        XXPAY     IFEQ ' '
      *                                           Their Rate *GT  ceiling
     C***        UBRTT     IFEQ 0                          & Neg Intr.
     C***        XEINR     ANDGTCLRAT
     C***        SUNII     ANDEQ'Y'                                       S01157
      *                                           Our Rate   *LT  floor
     C***        UBRTT     ORNE 0                          & Neg Intr
     C***        XEINR     ANDLTFLRAT
     C***        SUNII     ANDEQ'Y'                                       S01157
      *                                           Our Rate   *GT  ceiling
     C***        UBRTT     ORNE 0
     C***        XEINR     ANDGTCLRAT
     C***        SUNII     ANDNE'Y'                                       S01157
      *                                           Their Rate *LT  floor
     C***        UBRTT     OREQ 0
     C***        XEINR     ANDLTFLRAT
     C****       SUNII     ANDNE'Y'                                       S01157
      *
     C***                  MOVE 'U'       XXPAY            We pay
     C***                  ELSE
     C***                  MOVE 'T'       XXPAY            They pay
     C***                  END
     C**  E20918 - Setting up XXPAY                                       E20918
     C**           Seller of 'RP' and 'RR' responsible for interest       E20918
     C**           over the ceiling.                                      E20918
     C**           Buyer of 'RR' responsible for interest below the       E20918
     C**           floor.                                                 E20918
     C**           Seller of 'RF' responsible for interest below the      E20918
     C**           floor.                                                 E20918
     C**           In those instances where the market rate is between    E20918
     C**           the ceiling and floor rates neither party is under     E20918
     C**           any obligation to the other.                           E20918
     C*                                                                   E20918
     C           XEINR     IFGT CLRAT                      B**3           E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RP'                       B***4          E20918
     C           NEWDT     OREQ 'RR'                       B***4          E20918
     C*                                                                   E20918
     C           BYSL      IFEQ 'S'                        B****5         E20918
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C                     END                             E**3           E20918
     C*                                                                   E20918
     C           XEINR     IFLT FLRAT                      B**3           E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RF'                       B***4          E20918
     C*                                                                   E20918
     C           BYSL      IFEQ 'S'                        B****5         E20918
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C*                                                                   E20918
     C           NEWDT     IFEQ 'RR'                       B***4          E20918
     C*                                                                   E20918
     C           BYSL      IFEQ 'B'                        B****5         E20918
     C                     MOVE 'U'       XXPAY                           E20918
     C                     ELSE                            X****5         E20918
     C                     MOVE 'T'       XXPAY                           E20918
     C                     END                             E****5         E20918
     C                     END                             E***4          E20918
     C*                                                                   E20918
     C                     END                             E**3           E20918
      *
      ** Determine the Interest Rate to be used.
      *
     C                     Z-ADD0         XRRAT
     C                     Z-ADD0         XTRAT
      *
     C           XXPAY     IFNE ' '
      *                                             Reimbursement Rate
     C           XEINR     IFGT CLRAT
     C           XEINR     SUB  CLRAT     XRRAT
     C                     END
      *                                             Topping Up Rate
     C           XEINR     IFLT FLRAT
     C           SFLRAT    ANDNE*BLANKS
     C           FLRAT     SUB  XEINR     XTRAT
     C                     END
     C                     END
     C*                                                                   E20918
     C           XRRAT     IFNE 0                                         E20918
     C                     Z-ADDXRRAT     ZIRATE                          E20918
     C                     ELSE                                           E20918
     C                     Z-ADDXTRAT     ZIRATE                          E20918
     C                     END                                            E20918
      *
      * Select OUR details
      *
     C           XXPAY     IFEQ 'U'
      *
     C                     Z-ADDXUICSD    XICSD
     C****       SUNII     IFEQ 'Y'                                       S01157
     C****       UBRTT     ANDEQ0                                         S01157
      ****                                                                S01157
     C***        SUNII     ORNE 'Y'                                       S01157
     C***        UBRTT     ANDNE0                                         S01157
      *
     C****                 Z-ADDXRRAT     ZIRATE                          S01157
     C***                  ELSE                                           S01157
     C***                  Z-ADDXTRAT     ZIRATE                          S01157
     C***                  END                                            S01157
      *
     C                     END
      *
      * Select THEIR details
      *
     C           XXPAY     IFEQ 'T'
      *
     C                     Z-ADDXTICSD    XICSD
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***        UBRTT     ANDEQ0                                         S01157
      ***                                                                 S01157
     C****       SUNII     ORNE 'Y'                                       S01157
     C***        UBRTT     ANDNE0                                         S01157
      ***                                                                 S01157
     C****                 Z-ADDXTRAT     ZIRATE
     C***                  ELSE                                           S01157
     C***                  Z-ADDXRRAT     ZIRATE                          S01157
     C***                  END                                            S01157
      *
     C                     END
      *
     C****                 END
      /SPACE 4
      **   Calculate Interest using Effective Interest Rate between
      **   Interest Calculation Start & End Date via GLINTC
      **   ( = Interest Calculated )
      *
     C                     Z-ADDXICSD     ZIBEG
     C                     Z-ADDXICED     ZIEND
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C                     Z-ADDXIPBD     ZIEND                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDUICBS     ZICALC
     C                     Z-ADDUPAMT     ZIAMT
      *                                                                   CIR002
      ** Add the Unsettled Interest and Unsettled Interest Adjustment     CIR002
      *                                                                   CIR002
     C           CIR002    IFEQ 'Y'                                       CIR002
      *                                                                   CIR002
     C           XXPAY     IFEQ 'U'                                       CIR002
     C                     ADD  OUSI      ZIAMT                           CIR002
     C                     ADD  OUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
     C           XXPAY     IFEQ 'T'                                       CIR002
     C                     ADD  TUSI      ZIAMT                           CIR002
     C                     ADD  TUSA      ZIAMT                           CIR002
     C                     END                                            CIR002
      *                                                                   CIR002
     C                     END                                            CIR002
      *                                                                   CIR002
     C/COPY WNCPYSRC,DL1604RC26
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL1604RC27
     C                     Z-ADDZINTR     WINTD     H
      *
     C           XXPAY     IFEQ 'U'
     C                     ADD  WINTD     XUINTD
     C                     ELSE
     C                     ADD  WINTD     XTINTD
     C                     END
     C                     Z-ADD0         WINTD
      /SPACE 4
      **   Update Balances For This Interest Payment Date
      **   ------------------------------------------------
      *
     C           XNIPD     IFLE XNICD
      *
      * Calculate tax for OUR payment
      *
     C           XUINTD    IFNE 0
     C           STAXI     ANDEQ'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP   54                      S01194
     C           BNHKTR    DIV  100       TAXRP   54                      S01194
     C           XUINTD    MULT TAXRP     INTTAX 130H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
     C                     SUB  INTTAX    XUINTD
      *
      **  Calculate Net Interest Amount Due
      *
     C           XUINTD    IFGE XTINTD
     C           XUINTD    SUB  XTINTD    WINTD
     C                     MOVE 'P'       WPR
     C                     ELSE
     C           XTINTD    SUB  XUINTD    WINTD
     C                     MOVE 'R'       WPR
     C                     END
     C                     Z-ADDXNIPD     WNIPD
     C                     Z-ADD0         XUINTD
     C                     Z-ADD0         XTINTD
     C                     END
      /SPACE 4
      **   UPDATE BALANCES   --  WITHIN RANGE SPECIFIED
      *
     C           WINTD     IFNE 0
     C           WNIPD     ANDLTRANGE
      *                                                                   CEU003
      ** Convert interest amount WINTD to effective-setllement-currency   CEU003
      ** -workfield value via conversion program EU0200.                  CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           WSTCY     ANDNESUCUCY                                    CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM *BLANKS   P@RTCD  7                       CEU003
     C                     PARM WINTD     P@FRAM 183                      CEU003
     C                     PARM SUCUCY    P@FRCY  3                       CEU003
     C                     PARM WSTCY     P@TOCY  3                       CEU003
     C                     PARM *ZEROS    P@OUTA 150                      CEU003
     C                     PARM *ZEROS    P@INTA 183                      CEU003
     C                     PARM *ZEROS    P@EXRT 159                      CEU003
     C                     PARM *BLANKS   P@MDIN  1                       CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     Z-ADDP@OUTA    WINTD                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVEL'EU0200  'DBFILE                          CEU003
     C                     Z-ADD28        DBASE                           CEU003
     C                     MOVEL'CEU003'  DBKEY                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *
      *********************
      **** M E M O S ******
      *********************
      *
     C           XMOP      IFEQ 'M'
     C*****      WNIPD     ANDEQRUND                                      S01194
     C           WNIPD     ANDEQBJRDNB                                    S01194
     C*                                                                   S01154
     C**  Move VDAT and PDAT to shadow post later                         S01154
     C*                                                                   S01154
     C*****                Z-ADDRUND      PTDT                     S01154 S01194
     C                     Z-ADDBJRDNB    PTDT                            S01194
     C                     Z-ADDWNIPD     VUDT                            S01154
      * To reverse OLD payments
     C           WPR       IFEQ 'P'                        PAYMENTS
     C                     ADD  WINTD     MPAY              REVERSAL
      *                                                                   S01154
      *  To indicate that the amount is debit.                            S01154
     C                     Z-ADD0         DORC                            S01154
     C                     END
      *                                                                   E20928
      * TO reverse OLD receipts
     C           WPR       IFEQ 'R'                        RECEIPTS
     C                     SUB  WINTD     MREC              REVERSAL
      *                                                                   S01154
      *  To indicate that the amount is credit.                           S01154
     C                     Z-ADD1         DORC                            S01154
     C                     END
      *                                                                   S01154
      * Shadow post amount to RSACMTPD.                                   S01154
     C                     Z-ADDWINTD     MVAM                            S01154
     C                     END
      /SPACE 2
      *********************
      **** O L P O S ******
      *********************
      *
     C           XMOP      IFEQ 'O'
      **
      **   Interest Due Amounts are applied to the on line position
      **   balance whose occurrence is the greatest of the 16 dates
      **   which is less than, or equal to, the event date
      **   ( i.e. Next Interest Payment Date )
      *    NB..
      **   If event is earlier than the first of the 16th dates,
      **      use the first date
      **   If event is on or after the 16th date,
      **      use the 16th date ( Catchall )
     C                     Z-ADD1         P       20
      *
     C           WNIPD     IFGT ODAT,1
      *
     C           WNIPD     IFGE ODAT,16
     C                     Z-ADD16        P
     C                     ELSE
     C           WNIPD     LOKUPODAT,P                 8585
     C                     END
     C                     END
      ** ADJUST the OUTGOING Balances
     C           WPR       IFEQ 'P'                        >>> Payment
     C                     SUB  WINTD     OBLO,P
      ** ADJUST the INCOMING Balances
     C                     ELSE                            >>> Receipt
     C                     SUB  WINTD     OBLI,P
     C                     END
     C                     END
      /SPACE 2
      *********************
      **** P R O N O ******
      *********************
      *
     C           XMOP      IFEQ 'P'
      *
      **   Interest Due Amounts are applied to the projected nostro
      **   balances whose occurrence matches the projected nostro dates
      **   which are GE the Event Date ( Next Interest Payment Date )
      *    NB..
      **   If event is earlier than the first of the 5 dates,
      **      use from the first date
      **   If event is after the 5th date, but before the 6th
      **      use the 5th date
      **   ( NB  Dates GE 6th date excluded in above validation )
     C                     Z-ADD1         X       10
      *
     C           WNIPD     IFGT PDAT,1
     C           WNIPD     IFGE PDAT,5
     C                     Z-ADD5         X
     C                     ELSE
     C           WNIPD     LOKUPPDAT,X                 8585
     C                     END
     C                     END
     C*                                                                   S01154
     C**  Move VDAT and PDAT to shadow post later                         S01154
     C*                                                                   S01154
     C                     Z-ADDPDAT,X    PTDT                            S01154
     C                     Z-ADDWNIPD     VUDT                            S01154
     C*                                                                   042757
     C** Access the date 'equal to' or 'greater than' the                 042757
     C** event date and update the appropriate balances                   042757
     C*                                                                   042757
     C           WNIPD     IFGT PDAT,5                                    042757
     C                     Z-ADD6         X                               042757
     C                     ELSE                                           042757
     C                     Z-ADD1         X                               042757
     C           WNIPD     LOKUPPDAT,X               85  85               042757
     C                     END                                            042757
      *
      **   Adjust Nostro balances for Entries X to 5
     C           X         DOWLE5
      *
      * To reverse OLD payments,
     C           WPR       IFEQ 'P'                        PAYMENTS
     C                     ADD  WINTD     PPAY,X
     C                     END
      * To reverse OLD receipts,
     C           WPR       IFEQ 'R'                        RECEIPTS
     C                     SUB  WINTD     PREC,X
     C                     END
      **
     C                     ADD  1         X
     C                     END
      *                                                                   S01154
      *  To indicate that the amount is debit.                            S01154
      *   - if a payment and nostro on the pay side then do RSACMTPD      E20928
      *                                                                   S01154
     C           WPR       IFEQ 'P'                                       S01154
     C           @PNOST    ANDEQ'Y'                                       E20928
     C                     MOVELXUPACC    PRNNO                           S01154
     C                     Z-ADD0         DORC                            S01154
      * Shadow post amount to RSACMTPD.                                   E20928
     C                     Z-ADDWINTD     MVAM                            E20928
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E20928
     C                     END                                            S01154
      *                                                                   S01154
      *  To indicate that the amount is credit.                           S01154
      *   - if a receipt and nostro on the rec side then do RSACMTPD      E20928
      *                                                                   S01154
     C           WPR       IFEQ 'R'                                       S01154
     C           @RNOST    ANDEQ'Y'                                       E20928
     C                     MOVELXURACC    PRNNO                           S01154
     C                     Z-ADD1         DORC                            S01154
      * Shadow post amount to RSACMTPD.                                   E20928
     C                     Z-ADDWINTD     MVAM                            E20928
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E20928
     C                     END                                            S01154
     C**********************************                            S01154E20928
     C**Shadow*post*amount*to*RSACMTPD.*                            S01154E20928
     C**********************************                            S01154E20928
     C*********************Z-ADDWINTD***  MVAM                      S01154E20928
     C*********************EXSR*OUTPOS**                            S01154E20928
     C**********************************                            S01154E20928
     C                     END
      *>>>>>>
     C           WPR       IFEQ 'P'
     C                     Z-ADD1         XPAY
     C                     END
     C           WPR       IFEQ 'R'
     C                     Z-ADD1         XREC
     C                     END
     C                     END
      /EJECT
      **   Only calculate subsequent Next Interest Rate Change & Payment
      **   dates, if RANGE not reached, and Interest Fix Date EQ 0, or
      **   if Interest Fix Date GT Next Interest Rate Change Date
      *
     C           XNIPD     IFGE MDAT
     C           XNICD     ANDGEMDAT
      *
     C           XNICD     ORLE XNIPD
     C           XINFD     ANDGT0
     C           XINFD     ANDLEXNICD
     C                     Z-ADDRANGE     XNIPD
     C                     Z-ADDRANGE     XNICD
     C                     ELSE
      *
      ** If Next Interest Payment Date GE Next Interest Rate Change
      ** Date, calculate subsequent Next Interest Rate Change Date
      *
     C                     Z-ADDXNICD     SNICD   50
      *
     C           XNIPD     IFGE XNICD
     C           XNICD     ANDLTMDAT
      *
      **   Calculate subsequent Next Interest Rate Change Date
     C           XICFR     IFNE *BLANK
     C                     Z-ADDXICBD     ZDAYNO
     C                     MOVE XICFR     ZFREQ
     C                     Z-ADDXICFD     ZMDAY
     C******************** MOVE SUCUCY    ZCCY                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is PAY...                                      S01195
     C           WPR       IFEQ 'P'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If payment nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C           @PNLOC    IFEQ *BLANKS                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C                     MOVELSOPACC    WRK2    2                       S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save payment nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C                     MOVE A7NOSN    @PNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is RECEIVE...                                  S01195
     C*                                                                   S01195
     C           WPR       IFEQ 'R'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C*                                                                   S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If receive nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C           @RNLOC    IFEQ *BLANKS                                   S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C                     MOVELSORACC    WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save receive nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C                     MOVE A7NOSN    @RNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
      *                                                                   CIR005
      ** Get next rate change date using business day currencies          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SC1P1     ANDNE*BLANKS                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PBDPAY                          CIR005
     C                     PARM           SPDC1                           CIR005
     C                     PARM           BJSLCD                          CIR005
     C                     PARM           BJDFIN                          CIR005
     C                     PARM *ZEROS    PAJDT   50                      CIR005
     C                     PARM *ZEROS    PBSDT   50                      CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
     C                     Z-ADDPBSDT     ESAVD                           CIR005
      *                                                                   CIR005
     C           XNICD     IFGE PAJDT                                     CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
     C                     ELSE                                           CIR005
     C*                                                                   S01195
     C******************** EXSR ZFREQB                                    S01195
     C                     EXSR @FREQB                                    S01195
     C                     Z-ADDZDAYNO    ESAVD   50
     C******************** MOVE 'Y'       ZOPT                            S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     Z-ADD0         ZNRDYS  20                      S01195
     C                     EXSR ZFWDT                                     S01195
      *
     C                     ENDIF                                          CIR005
     C*                                                                   S01195
      *
      *****If*date*output*from*ZDATE5*is*LT*maturity*date,**********      S01195
      **   If date output from ZFWDT is LT maturity date,                 S01195
      **   Set Next Interest Change Date to this Date
      **   If Not, set Change Date to Maturity date.
     C           ZDYNBR    IFLT MDAT
     C                     Z-ADDZDYNBR    XNICD
     C                     ELSE
     C                     Z-ADDMDAT      XNICD
     C                     END
      *
      **   If Interest Payment Frequency is blank, set to Maturity Date
     C                     ELSE
     C                     Z-ADDMDAT      XNICD
     C                     END
      *
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SC1P1     ANDNE*BLANKS                                   CIR005
     C                     Z-ADDPBSDT     XICBD                           CIR005
     C                     ELSE                                           CIR005
     C                     Z-ADDXNICD     XICBD
     C                     ENDIF                                          CIR005
     C                     MOVE ' '       XXPAY
      *
      **   Apply Spread/Rate to Base Rate for New Effective Int. Rate
      **   (If no Spread/Rate, New Effective Interest Rate = Base Rate)
     C           XRTSP     IFEQ 0
     C                     Z-ADDXBRTE     XEINR
     C                     ELSE
     C           XSPIN     IFEQ 'A'
     C           XBRTE     ADD  XRTSP     XEINR
     C                     END
     C           XSPIN     IFEQ 'S'
     C           XBRTE     SUB  XRTSP     XEINR
     C                     END
     C           XSPIN     IFEQ 'P'
     C           XRTSP     DIV  100       WK119  119
     C           XBRTE     MULT WK119     XEINR     H
     C                     ADD  XBRTE     XEINR
     C                     END
     C                     END
      *
      ***********tive interest specified, reverse sign of New Eff. Int.   S01157
     C***        SUNII     IFEQ 'Y'                                       S01157
     C***                  Z-SUBXEINR     XEINR                           S01157
     C***                  END                                            S01157
     C                     END
      /SPACE 4
      **   If Next Interest Payment Date LE STORED  Next Interest
      **   Rate Change Date, calculate subsequent Next Interest
      **   Payment Date
      *
     C           XNIPD     IFLE SNICD
     C           XNIPD     ANDLTMDAT
      **
     C           XIPFR     IFNE *BLANK
     C                     Z-ADDXIPBD     ZDAYNO
     C                     MOVE XIPFR     ZFREQ
     C                     Z-ADDXIPFD     ZMDAY
     C******************** MOVE SUCUCY    ZCCY                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is PAY...                                      S01195
     C*                                                                   S01195
     C           WPR       IFEQ 'P'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C*                                                                   S01195
     C           SPSETM    IFEQ '01'                                      S01195
     C           SPSETM    OREQ '02'                                      S01195
     C           SPSETM    OREQ '07'                                      S01195
     C           SPSETM    OREQ '08'                                      S01195
     C           SPSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If payment nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C           @PNLOC    IFEQ *BLANKS                                   S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C                     MOVELSOPACC    WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save payment nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C                     MOVE A7NOSN    @PNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @PNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* If Pay/Receive ind is RECEIVE...                                  S01195
     C           WPR       IFEQ 'R'                                       S01195
     C*                                                                   S01195
     C* If Settlement is via a NOSTRO...                                  S01195
     C           SRSETM    IFEQ '01'                                      S01195
     C           SRSETM    OREQ '02'                                      S01195
     C           SRSETM    OREQ '07'                                      S01195
     C           SRSETM    OREQ '08'                                      S01195
     C           SRSETM    OREQ '12'                                      S01195
     C*                                                                   S01195
     C* If receive nostro location has been set up earlier                S01195
     C* do no set it up again.                                            S01195
     C           @RNLOC    IFEQ *BLANKS                                   S01195
     C*                                                                   S01195
     C* Set up work field with Nostro Code.                               S01195
     C                     MOVELSORACC    WRK2                            S01195
     C*                                                                   S01195
     C* If Nostro Code not blank...set up location.                       S01195
     C           WRK2      IFNE *BLANKS                                   S01195
     C*                                                                   S01195
     C* Call ACCESS program to get CURRENCY NOSTRO record                 S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*DBERR ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM WSTCY     @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C* If no record found database error exists and is handled by        S01195
     C* ACCESS program.                                                   S01195
     C*                                                                   S01195
     C* Save receive nostro location for use in new holiday               S01195
     C* processing later.                                                 S01195
     C                     MOVE A7NOSN    @RNLOC  3                       S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C* Set ZLOC to location - will be blank if nostro not known          S01195
     C                     MOVE @RNLOC    ZLOC                            S01195
     C*                                                                   S01195
     C***********          MOVE SUCUCY    ZCCY                     S01195 CEU003
     C                     MOVELWSTCY     ZCCY                            CEU003
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C* Else if Settlement is NOT via a NOSTRO...Set location to System   S01195
     C* Location and currency to Local Currency.                          S01195
     C*                                                                   S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
      *                                                                   CIR005
      ** Get next rate change date using business day currencies          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SC1P1     ANDNE*BLANKS                                   CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM           PBDPAY                          CIR005
     C                     PARM           SPDC1                           CIR005
     C                     PARM           BJSLCD                          CIR005
     C                     PARM           BJDFIN                          CIR005
     C                     PARM *ZEROS    PAJDT   50                      CIR005
     C                     PARM *ZEROS    PBSDT   50                      CIR005
     C                     Z-ADDPAJDT     ZDYNBR                          CIR005
     C                     Z-ADDPBSDT     ESAVD                           CIR005
      *                                                                   CIR005
     C           XNIPD     IFGE PAJDT                                     CIR005
     C                     Z-ADDPBSDT     ZDYNBR                          CIR005
     C                     ENDIF                                          CIR005
     C                     ELSE                                           CIR005
     C*                                                                   S01195
     C******************** EXSR ZFREQB                                    S01195
     C                     EXSR @FREQB                                    S01195
     C                     Z-ADDZDAYNO    ESAVD   50
     C******************** MOVE 'Y'       ZOPT                            S01195
     C******************** EXSR ZDATE5                                    S01195
     C                     Z-ADD0         ZNRDYS  20                      S01195
     C                     EXSR ZFWDT                                     S01195
      *
     C                     ENDIF                                          CIR005
      *
      *****If*date*output*from*ZDATE5*is*LT*maturity*date,**********      S01195
      **   If date output from ZFWDT is LT maturity date,                 S01195
      **   Set Next Interest Payment & Base Dates to this Date
      **   If Not, set both Payment & Base Dates to Maturity date.
      *
     C           ZDYNBR    IFLT MDAT
     C                     Z-ADDZDYNBR    XNIPD
     C                     Z-ADDESAVD     XIPBD
     C                     ELSE
     C                     Z-ADDMDAT      XNIPD
     C                     Z-ADDMDAT      XIPBD
     C                     END
      *
      **   If Interest Payment Frequency is blank, set to Maturity Date
     C                     ELSE
     C                     Z-ADDMDAT      XNIPD
     C                     Z-ADDMDAT      XIPBD
     C                     END
     C                     END
      *
     C                     END
      /SPACE 4
      ** Set details for further interest calculations
      * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      **   Set Interest Calculation Start Date to previous
      **   Interest Calculation End Date
      *
     C***********          Z-ADDXICED     XUICSD                          CIR005
     C***********          Z-ADDXICED     XTICSD                          CIR005
     C***********          Z-ADDXICED     XICSD                           CIR005
     C                     Z-ADDWXCED     XUICSD                          CIR005
     C                     Z-ADDWXCED     XTICSD                          CIR005
     C                     Z-ADDWXCED     XICSD                           CIR005
      *
      ** If Next Interest Payment Date LE Next Interest Rate Change Date,
      **   set Interest Calc. End Date to Next Interest Payment Date
      **   else set it to the Next Interest Rate Change Date.
      *
     C           XNIPD     IFLE XNICD
     C                     Z-ADDXNIPD     XICED
     C                     ELSE
     C                     Z-ADDXNICD     XICED
     C                     END
     C                     Z-ADDXICED     WXCED                           CIR005
      *                                                                   CIR005
      ** Get int payment base date when amount convention is actual       CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           SAMC1     ANDEQ'A '                                      CIR005
     C           XNIPD     ANDLEXNICD                                     CIR005
     C           WRTFL     ANDNE'Y'                                       CIR005
     C           XIPBD     ANDNE0                                         CIR005
     C                     Z-ADDXIPBD     WXCED                           CIR005
     C                     ENDIF                                          CIR005
     C                     END                             >>>END=LOOP<<<
      **
     C                     ENDSR
      **********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UDLDF  SR.    To update PF/DEALSDF deal trailer record       *
      *                                                         (U01) *
      *****************************************************************
     C           UDLDF     BEGSR                           ***  UDLDF ****
      *
      **  Obtain deals trailer record
     C                     Z-ADD0         DLKEY
     C                     MOVE '999999'  DLKEY
     C           DLKEY     CHAINDEALS                86
     C  N86      RECI      COMP 'T'                  8686
     C           *IN86     IFEQ '1'
     C************LOCK     IN   LDA                                       S01194
     C                     MOVE '18'      DBASE            ***************
     C                     MOVE 'DEALS'   DBFILE           *   DBERROR   *
     C                     MOVELDLKEY     DBKEY            *      18     *
     C******************** EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END
      *
      **  Setup information in file fields
      **   Update relevant total fields
     C/COPY WNCPYSRC,DL1604RC16
     C           NDEL      ADD  1         NDEL
     C/COPY WNCPYSRC,DL1604RC17
     C           NLRA      SUB  1         NLRA
      **   Update amount fields
      *
     C/COPY WNCPYSRC,DL1604RC18
     C                     Z-ADD0         ZZAMT
     C                     MOVE UPAMT     ZZAMT
     C                     Z-ADDVRDF      ZZTOTI
     C                     Z-ADDVRDL      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VRDF
     C                     Z-ADDZZTOTD    VRDL
     C/COPY WNCPYSRC,DL1604RC19
      *
     C                     Z-ADDVLAF      ZZTOTI
     C                     Z-ADDVLAL      ZZTOTD
     C                     Z-ADD0         ZZAMT
     C                     MOVE UPAMT     ZZAMT
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
      *
      **   Update control fields
     C********             Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE SACCD     CHTP
     C                     Z-ADDNATN      TNLU
     C                     UPDATDEALSDFF
      **
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UDTHH  SR.    To update PF/DTRIXHH deal transaction index    *
      *                header record                            (U02) *
      *                                                               *
      *****************************************************************
      *
     C           UDTHH     BEGSR                           ***  UDTHH ****
      **
     C                     MOVE '1'       DTXKEY  10
     C           DTXKEY    CHAINDTRIXHH              86
     C  N86      RECI      COMP 'H'                  8686
     C           *IN86     IFEQ '1'
     C************LOCK     IN   LDA                                       S01194
     C                     MOVE '19'      DBASE            ***************
     C                     MOVE 'DTRIX'   DBFILE           *   DBERROR   *
     C                     MOVELDTXKEY    DBKEY            *      19     *
     C******************** EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END
      *
      **  Setup information in file fields
     C           NDLR      ADD  1         NDLR
     C                     Z-ADDNATN      TNLU
     C                     UPDATDTRIXHF
      **
     C                     ENDSR
      ********************************************************************
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  #LPREM SR.    To set Premium details if entered, for         *   CIR001
      *                call of SR/#LUPRE.                             *   CIR001
      *                                                               *   CIR001
      *  Parameters Passed: XXSETM - Settlement method                *   CIR001
      *                     XXACC  - Account number                   *   CIR001
      *                     XXVDT  - Value date                       *   CIR001
      *                     XXPRI  - Payment/Receipt indicator        *   CIR001
      *                     XXAMT  - Amount                           *   CIR001
      **********************XXRRN**-*Relative*record*number         CIR001CCB002
      *                     XXNOST - NOSTRO number                    *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
     C           #LPREM    BEGSR                                          CIR001
      *                                                                   CIR001
     C                     MOVE *BLANKS   XXPRI   1                       CIR001
     C                     Z-ADD0         XXVDT   50                      CIR001
     C                     Z-ADD0         XXAMT  150                      CIR001
     C                     Z-ADD0         XXSETM  20                      CIR001
     C                     MOVE *BLANKS   XXNOST  2                       CIR001
     C**********           Z-ADD0         XXCNUM                                       CIR001 CSD027
     C                     MOVE *BLANKS   XXCNUM                                              CSD027
     C                     MOVE *BLANKS   XXCCY                           CIR001
     C                     Z-ADD0         XXACOD                          CIR001
     C                     Z-ADD0         XXACSQ                          CIR001
     C************LIKE*****DEFN RRNM      XXRRN                     CIR001CCB002
     C*********************Z-ADD0         XXRRN                     CIR001CCB002
     C                     MOVE 'N'       XXRET   1                       CCB002
     C                     MOVE '00'      DSETM                           CIR001
     C                     MOVE *BLANKS   DBNKAC                          CIR001
      *                                                                   CIR001
     C           UPVD      IFNE *ZEROS                                    CIR001
     C                     Z-ADDUPVD      XXVDT                           CIR001
      *                                                                   CEU003
      ** Convert premium amount XXAMT to our-effective-setllement         CEU003
      ** -currency-workfield value via conversion program EU0200.         CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           WSTCY     ANDNESUCUCY                                    CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM *BLANKS   P@RTCD  7                       CEU003
     C                     PARM UPFE      P@FRAM 183                      CEU003
     C                     PARM SUCUCY    P@FRCY  3                       CEU003
     C                     PARM WSTCY     P@TOCY  3                       CEU003
     C                     PARM *ZEROS    P@OUTA 150                      CEU003
     C                     PARM *ZEROS    P@INTA 183                      CEU003
     C                     PARM *ZEROS    P@EXRT 159                      CEU003
     C                     PARM *BLANKS   P@MDIN  1                       CEU003
      *                                                                   CEU003
     C           P@RTCD    IFEQ *BLANKS                                   CEU003
     C                     Z-ADDP@OUTA    XXAMT                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVEL'EU0200  'DBFILE                          CEU003
     C                     Z-ADD27        DBASE                           CEU003
     C                     MOVEL'CEU003'  DBKEY                           CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     Z-ADDUPFE      XXAMT                           CIR001
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
     C           BYSL      IFEQ 'B'                                       CIR001
     C           PSETM     ANDNE0                                         CIR001
      *                                                                   CIR001
     C**********           Z-ADDCNUMX     DCNUM                                        CIR001 CSD027
     C                     MOVE CNUMX     DCNUM                                               CSD027
     C***********          MOVE SUCUCY    DDCCY                    CIR001 CEU003
     C                     MOVELWSTCY     DDCCY                           CEU003
     C                     MOVE PSETM     DSETM                           CIR001
     C                     MOVELUPACC     DBNKAC                          CIR001
     C                     MOVELPOBR      WWBRCA                          CIR001
      *                                                                   CIR001
     C                     EXSR TSTRTL                                    CIR001
      *                                                                   CIR001
     C**********           Z-ADDWCNUM     XXCNUM                                       CIR001 CSD027
     C                     MOVE WCNUM     XXCNUM                                              CSD027
     C                     MOVE WCCY      XXCCY                           CIR001
     C                     Z-ADDWACOD     XXACOD                          CIR001
     C                     Z-ADDWACSQ     XXACSQ                          CIR001
     C           ATYP      IFEQ 'R'                                       CIR001
     C*********************Z-ADDRRNM      XXRRN                     CIR001CCB002
     C                     MOVE 'Y'       XXRET                           CCB002
     C                     MOVE BRCA      XXBRCA  3                       CCB002
     C                     END                                            CIR001
     C                     MOVELUPACC     XXNOST                          CIR001
      *                                                                   CIR001
     C                     MOVE 'R'       XXPRI                           CIR001
     C                     Z-ADD0         DORC                            CIR001
     C                     MOVELPSETM     XXSETM                          CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR #LUPRE                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           BYSL      IFEQ 'S'                                       CIR001
     C           RSETM     ANDNE0                                         CIR001
      *                                                                   CIR001
     C**********           Z-ADDCNUMX     DCNUM                                        CIR001 CSD027
     C                     MOVE CNUMX     DCNUM                                               CSD027
     C***********          MOVE SUCUCY    DDCCY                    CIR001 CEU003
     C                     MOVELWSTCY     DDCCY                           CEU003
     C                     MOVE RSETM     DSETM                           CIR001
     C                     MOVELURACC     DBNKAC                          CIR001
     C                     MOVELROBR      WWBRCA                          CIR001
      *                                                                   CIR001
     C                     EXSR TSTRTL                                    CIR001
      *                                                                   CIR001
     C**********           Z-ADDWCNUM     XXCNUM                                       CIR001 CSD027
     C                     MOVE WCNUM     XXCNUM                                              CSD027
     C                     MOVE WCCY      XXCCY                           CIR001
     C                     Z-ADDWACOD     XXACOD                          CIR001
     C                     Z-ADDWACSQ     XXACSQ                          CIR001
     C           ATYP      IFEQ 'R'                                       CIR001
     C*********************Z-ADDRRNM      XXRRN                     CIR001CCB002
     C                     MOVE 'Y'       XXRET                           CCB002
     C                     MOVE BRCA      XXBRCA                          CCB002
     C                     END                                            CIR001
     C                     MOVELURACC     XXNOST                          CIR001
      *                                                                   CIR001
     C                     MOVE 'P'       XXPRI                           CIR001
     C                     Z-ADD1         DORC                            CIR001
     C                     MOVELRSETM     XXSETM                          CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR #LUPRE                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *****************************************************************   CIR001
      /EJECT                                                              CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  #LUPRE SR.    To Update PF/PRONO, PF/MEMOS and PF/RSACMTPD   *   CIR001
      *                using data passed from SR/#LPREM.              *   CIR001
      *                                                               *   CIR001
      *  Passed Parameters: XXSETM - Settlement method                *   CIR001
      *                     XXACC  - Account number                   *   CIR001
      *                     XXVDT  - Value date                       *   CIR001
      *                     XXPRI  - Payment/Receipt indicator        *   CIR001
      *                     XXAMT  - Amount                           *   CIR001
      **********************XXRRN**-*Relative*record*number         CIR001CCB002
      *                     XXNOST - NOSTRO number                    *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           #LUPRE    BEGSR                                          CIR001
      *                                                                   CIR001
      ** Update PF/PRONO file.                                            CIR001
      *                                                                   CIR001
     C           PRKEY1    KLIST                                          CIR001
     C                     KFLD           PRCCY1  3                       CIR001
     C                     KFLD           PRNNO1  20                      CIR001
     C                     Z-ADD0         PPAY                            CIR001
     C                     Z-ADD0         PREC                            CIR001
     C                     Z-ADD0         RANGE                           CIR001
     C                     MOVE *BLANKS   XXNST   1                       CIR001
      *                                                                   CIR001
      ** Process if settled through a nostro                              CIR001
      *                                                                   CIR001
     C           XXSETM    IFEQ 01                                        CIR001
     C           XXSETM    OREQ 02                                        CIR001
     C           XXSETM    OREQ 07                                        CIR001
     C           XXSETM    OREQ 08                                        CIR001
     C           XXSETM    OREQ 12                                        CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       XXNST                           CIR001
      *                                                                   CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
      ** If record not found, use 'unallocated' code                      CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
     C                     Z-ADD0         PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           *IN86     IFNE '1'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Range End Date is up to the 6th working day                      CIR001
      *                                                                   CIR001
     C           PDAT,5    ADD  1         ZDAYNO                          CIR001
     C***********          MOVE UCUCY     ZCCY                     CIR001 CEU003
     C                     MOVE WSTCY     ZCCY                            CEU003
     C                     MOVE BJSLCD    ZLOC                            CIR001
     C                     Z-ADD0         ZNRDYS                          CIR001
     C                     EXSR ZFWDT                                     CIR001
      *                                                                   CIR001
      ** Save the value of the 6th working day                            CIR001
      *                                                                   CIR001
     C                     Z-ADDZDYNBR    RANGE   50                      CIR001
     C                     MOVELPRNNO1    XXNOST                          CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Release PF/PRONOPN record if record found                        CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELPR                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Find relevant element starting postition.                        CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X                               CIR001
      *                                                                   CIR001
     C           XXVDT     IFGT PDAT,5                                    CIR001
     C           XXVDT     ANDGERANGE                                     CIR001
     C                     Z-ADD6         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXVDT     IFGT PDAT,5                                    CIR001
     C           XXVDT     ANDLTRANGE                                     CIR001
     C                     Z-ADD5         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXVDT     IFGE PDAT,1                                    CIR001
     C           XXVDT     ANDLEPDAT,5                                    CIR001
     C           X         ANDLE5                                         127972
     C           XXVDT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Adjust Nostro balances for Entries X to 5                        CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                        PAYMENTS       CIR001
     C                     SUB  XXAMT     PPAY,X                          CIR001
     C                     END                                            CIR001
     C           XXPRI     IFEQ 'R'                        RECEIPTS       CIR001
     C                     ADD  XXAMT     PREC,X                          CIR001
     C                     END                                            CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update projected nostros                                         CIR001
      *                                                                   CIR001
      ** Access PRONO record - PAYMENT                                    CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                                       CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Update projected nostros record                                  CIR001
      *                                                                   CIR001
     C                     ADD  PPAY      PBAL                            CIR001
     C                     Z-ADDNATN      TNLU                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Access PRONO record - RECEIPT                                    CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                                       CIR001
     C                     MOVELXXCCY     PRCCY1                          CIR001
     C                     MOVELXXNOST    PRNNO1                          CIR001
     C           PRKEY1    CHAINPRONO                86                   CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C           RECI      ANDEQ'D'                                       CIR001
      *                                                                   CIR001
      ** Update projected nostros record                                  CIR001
      *                                                                   CIR001
     C                     ADD  PREC      PBAL                            CIR001
     C                     Z-ADDNATN      TNLU                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update PF/MEMOS file                                             CIR001
      *                                                                   CIR001
     C***********XXRRN*****IFNE *ZEROS                              CIR001CCB002
     C           XXRET     IFEQ 'Y'                                       CCB002
      *                                                                   CIR001
     C                     Z-ADD0         MPAY   150                      CIR001
     C                     Z-ADD0         MREC   150                      CIR001
      *                                                                   CIR001
      ** Only Update PF/MEMOS if Value Date is equal or less than         CIR001
      ** Event Control Date.                                              CIR001
      *                                                                   CIR001
     C           *IN89     IFEQ '1'                                       CIR001
     C           *IN88     ANDEQ'1'                                       CIR001
     C           XXVDT     ANDLEEVCD                                      CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                        PAYMENTS       CIR001
     C                     SUB  XXAMT     MPAY              INSERT        CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                        RECEIPTS       CIR001
     C                     ADD  XXAMT     MREC              INSERT        CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** PAYMENTS                                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'P'                                       CIR001
      *                                                                   CIR001
      ***Access*PF/MEMOS*record                                     CIR001CCB002
      *                                                             CIR001CCB002
     C***********XXRRN*****CHAINMEMOS                86             CIR001CCB002
      *                                                             CIR001CCB002
      ***End*if*detail*record*not*found                             CIR001CCB002
      *                                                             CIR001CCB002
     C************IN86*****IFEQ '1'                                 CIR001CCB002
     C***********RECI******ORNE 'D'                                 CIR001CCB002
     C*********************Z-ADD20        DBASE            *********CIR001CCB002
     C*********************MOVEL'MEMOS'   DBFILE           * DBERROR 020 *CCB002
     C*********************MOVELXXRRN     DBKEY            *********CIR001CCB002
     C*********************EXSR *PSSR                               CIR001CCB002
     C*********************END                                      CIR001CCB002
      *                                                                   CIR001
      ** Update shadow balances record                                    CIR001
      *                                                                   CIR001
     C*********************ADD  MPAY      LDBLN                     CIR001CCB002
     C*********************ADD  MPAY      CLBLN                     CIR001CCB002
     C                     Z-ADDMPAY      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM XXCNUM    W0CNUM           O:Customer No. CCB002
     C                     PARM XXCCY     W0CCY            O:Currency     CCB002
     C                     PARM XXACOD    W0ACOD           O:Account Code CCB002
     C                     PARM XXACSQ    W0ACSQ           O:Account Seq. CCB002
     C                     PARM XXBRCA    W0BRCA           O:Branch       CCB002
     C                     PARM BJRDNB    W0PSTD           O:Posting date CCB002
     C                     PARM XXVDT     W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '20'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 20 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604RC34
     C                     END                                            CIR001
      *                                                                   CIR001
      ** RECEIPTS                                                         CIR001
      *                                                                   CIR001
     C           XXPRI     IFEQ 'R'                                       CIR001
      *                                                                   CIR001
      ***Access*PF/MEMOS*record                                     CIR001CCB002
      *                                                             CIR001CCB002
     C***********XXRRN*****CHAINMEMOS                86             CIR001CCB002
      *                                                             CIR001CCB002
      ***End*if*detail*record not found                             CIR001CCB002
      *                                                             CIR001CCB002
     C************IN86*****IFEQ '1'                                 CIR001CCB002
     C***********RECI******ORNE 'D'                                 CIR001CCB002
     C*********************Z-ADD21        DBASE            *********CIR001CCB002
     C*********************MOVEL'MEMOS'   DBFILE           * DBERROR 021 *CCB002
     C*********************MOVELXXRRN     DBKEY            *********CIR001CCB002
     C*********************EXSR *PSSR                               CIR001CCB002
     C*********************END                                      CIR001CCB002
      *                                                                   CIR001
      ** Update shadow balances record                                    CIR001
      *                                                                   CIR001
     C*********************ADD  MREC      LDBLN                     CIR001CCB002
     C*********************ADD  MREC      CLBLN                     CIR001CCB002
     C                     Z-ADDMREC      #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM XXCNUM    W0CNUM           O:Customer No. CCB002
     C                     PARM XXCCY     W0CCY            O:Currency     CCB002
     C                     PARM XXACOD    W0ACOD           O:Account Code CCB002
     C                     PARM XXACSQ    W0ACSQ           O:Account Seq. CCB002
     C                     PARM XXBRCA    W0BRCA           O:Branch       CCB002
     C                     PARM BJRDNB    W0PSTD           O:Posting date CCB002
     C                     PARM XXVDT     W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '21'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 21 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1604RC35
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Update PF/RSACMTPD file IF NOSTRO or RETAIL ACC settlement.      CIR001
      *                                                                   CIR001
     C           XXNST     IFEQ 'Y'                                       CIR001
     C***********XXRRN*****ORGT 0                                   CIR001CCB002
     C           XXRET     OREQ 'Y'                                       CCB002
      *                                                                   CIR001
     C                     Z-ADDXXAMT     MVAM                            CIR001
      *                                                                   CIR001
      ** Only write a record if the amount is not ZERO                    CIR001
      *                                                                   CIR001
     C           MVAM      IFNE *ZEROS                                    CIR001
      *                                                                   CIR001
     C**********           Z-ADDXXCNUM    CUSN                                         CIR001 CSD027
     C                     MOVE XXCNUM    CUSN                                                CSD027
     C                     MOVE XXCCY     CCYD                            CIR001
     C                     Z-ADDXXACOD    ACDE                            CIR001
     C                     Z-ADDXXACSQ    ASNC                            CIR001
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDXXVDT     VUDT                            CIR001
     C                     MOVE SDTYP     TRYP                            CIR001
     C                     MOVE *BLANKS   NRTC                            CIR001
     C                     MOVEL'Premium' NRTD                            CIR001
     C                     Z-ADD*ZEROS    CQNR                            CIR001
     C                     MOVE *BLANKS   FUND                            CIR001
      *                                                                   CIR001
      ** If CRE009 is ON and account is RE, set posting date the same     CRE009
      ** as value date when the latter is not less than the run date.     CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
     C           XXRET     ANDEQ'Y'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  CIR001
     C/COPY WNCPYSRC,DL1604RC36
      *                                                                   CIR001
     C                     Z-ADD0         MVAM                            CIR001
     C**********           Z-ADD0         CUSN                                         CIR001 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C                     MOVE *BLANKS   CCYD                            CIR001
     C                     Z-ADD0         ACDE                            CIR001
     C                     Z-ADD0         ASNC                            CIR001
     C                     Z-ADD0         PTDT                            CIR001
     C                     Z-ADD0         VUDT                            CIR001
     C                     MOVE *BLANKS   TRYP                            CIR001
     C                     MOVE *BLANKS   NRTD                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      *                                                                   CIR001
      *****************************************************************   CIR001
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CONFI  SR.    To set confirmation indicators in accordance   *
      *                with P/DLU018                       (P/DLU018) *
      *****************************************************************
     C           CONFI     BEGSR                           ***  CONFI ****
      *
      **  Set initial value of confirmation required indicator
     C                     MOVE 'N'       CNRQ
      *
      **  The confirmation required indicator may be set to 'Y'
      **  and the confirmation indicators may be set to OFF if...
      **  If confirmation control ind is on:
     C                     TESTB'7'       CNFI           85
     C           *IN85     IFEQ '1'
     C                     MOVE 'Y'       CNRQ
     C                     BITOF'0'       CNFI
     C                     END
      **
     C                     ENDSR
      *****************************************************************   CIR006
      /EJECT                                                              CIR006
      *****************************************************************   CIR006
      *                                                               *   CIR006
      *  SRDWIN        To display window                              *   CIR006
      *                                                               *   CIR006
      *****************************************************************   CIR006
      *                                                                   CIR006
     C           SRDWIN    BEGSR                                          CIR006
      *                                                                   CIR006
      ** Main Details                                                     CIR006
      *                                                                   CIR006
     C                     MOVE DLNO      #1DLNO                          CIR006
     C                     MOVE 'R'       #1ACTN                          CIR006
     C                     MOVE DTYP      #1DTYP                          CIR006
     C                     MOVE DLST      #1DLST                          CIR006
     C                     MOVE DDAT      #1DDAT                          CIR006
     C                     MOVE BRCA      #1BRCA                          CIR006
     C                     MOVE BRKC      #1BRKC                          CIR006
     C                     MOVE BAGE      #1BAGE                          CIR006
     C                     MOVE LNKDN     #1LNKD                          CIR006
     C                     MOVE CNUM      #1CNUM                          CIR006
     C                     MOVE VDAT      #1VDAT                          CIR006
     C                     MOVE MDAT      #1MDAT                          CIR006
     C                     MOVE CDAS      #1CDAS                          CIR006
      *                                                                   CIR006
      ** Our Details                                                      CIR006
      *                                                                   CIR006
     C                     MOVE UCUCY     #1UCUC                          CIR006
     C                     MOVE UPAMT     #1UPAM                          CIR006
     C                     MOVE UICFR     #1UICF                          CIR006
     C                     MOVE UIPFR     #1UIPF                          CIR006
     C                     MOVE VDAT      #1UIAC                          CIR006
     C                     MOVE UINPM     #1UINP                          CIR006
     C                     MOVE UNPCD     #1UNPC                          CIR006
     C                     MOVE OUSI      #1OUSI                          CIR006
     C                     MOVE OUSA      #1OUSA                          CIR006
     C                     MOVE PSETM     #1USEO                          CIR006
      *                                                                   CIR006
     C           CEU003    IFEQ 'Y'                                       CIR006
     C           *IN73     ANDEQ'0'                                       CIR006
     C           SSTCY     ANDNE*BLANKS                                   CIR006
     C                     MOVELSSTCY     DDCCY                           CIR006
     C                     ELSE                                           CIR006
     C                     MOVELUCUCY     DDCCY                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           PSETM     IFNE 0                                         CIR006
      *                                                                   CIR006
      ** Get relative record number for retail accounts                   CIR006
      *                                                                   CIR006
     C**********           Z-ADDCNUM      DCNUM                                        CIR006 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE UPACC     DBNKAC                          CIR006
     C                     MOVE PSETM     DSETM                           CIR006
     C                     MOVE POBR      WWBRCA                          CIR006
     C                     EXSR TSTRTL                                    CIR006
     C                     MOVELERRKEY    #1UACO                          CIR006
     C                     Z-ADD0         #1URRO                          CIR006
      *                                                                   CIR006
     C           PSETM     IFEQ 01                                        CIR006
     C           PSETM     OREQ 02                                        CIR006
     C           PSETM     OREQ 07                                        CIR006
     C           PSETM     OREQ 08                                        CIR006
     C           PSETM     OREQ 12                                        CIR006
     C                     MOVE @NOST     #1UNOO                          CIR006
     C                     ELSE                                           CIR006
     C                     Z-ADD0         #1UNOO                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     MOVE *BLANKS   #1UACO                          CIR006
     C                     Z-ADD0         #1URRO                          CIR006
     C                     Z-ADD0         #1UNOO                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     MOVE *BLANKS   #1UACN                          CIR006
     C                     Z-ADD0         #1USEN                          CIR006
     C                     Z-ADD0         #1URRN                          CIR006
     C                     Z-ADD0         #1UNON                          CIR006
      *                                                                   CIR006
      ** Their Details                                                    CIR006
      *                                                                   CIR006
     C                     MOVE TICFR     #1TICF                          CIR006
     C                     MOVE TIPFR     #1TIPF                          CIR006
     C                     MOVE UCUCY     #1TCUC                          CIR006
     C                     MOVE VDAT      #1TIAC                          CIR006
     C                     MOVE TINPM     #1TINP                          CIR006
     C                     MOVE TNPCD     #1TNPC                          CIR006
     C                     MOVE TUSI      #1TUSI                          CIR006
     C                     MOVE TUSA      #1TUSA                          CIR006
     C                     MOVE RSETM     #1TSEO                          CIR006
      *                                                                   CIR006
     C           CEU003    IFEQ 'Y'                                       CIR006
     C           *IN73     ANDEQ'0'                                       CIR006
     C           SSTCY     ANDNE*BLANKS                                   CIR006
     C                     MOVELSSTCY     DDCCY                           CIR006
     C                     ELSE                                           CIR006
     C                     MOVELUCUCY     DDCCY                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           RSETM     IFNE 0                                         CIR006
      *                                                                   CIR006
      ** Get relative record number for retail accounts                   CIR006
      *                                                                   CIR006
     C**********           Z-ADDCNUM      DCNUM                                        CIR006 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE URACC     DBNKAC                          CIR006
     C                     MOVE RSETM     DSETM                           CIR006
     C                     MOVE ROBR      WWBRCA                          CIR006
     C                     EXSR TSTRTL                                    CIR006
     C                     MOVELERRKEY    #1TACO                          CIR006
     C                     Z-ADD0         #1TRRO                          CIR006
      *                                                                   CIR006
     C           RSETM     IFEQ 01                                        CIR006
     C           RSETM     OREQ 02                                        CIR006
     C           RSETM     OREQ 07                                        CIR006
     C           RSETM     OREQ 08                                        CIR006
     C           RSETM     OREQ 12                                        CIR006
     C                     MOVE @NOST     #1TNOO                          CIR006
     C                     ELSE                                           CIR006
     C                     Z-ADD0         #1TNOO                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ELSE                                           CIR006
      *                                                                   CIR006
     C                     MOVE *BLANKS   #1TACO                          CIR006
     C                     Z-ADD0         #1TRRO                          CIR006
     C                     Z-ADD0         #1TNOO                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     MOVE *BLANKS   #1TACN                          CIR006
     C                     Z-ADD0         #1TSEN                          CIR006
     C                     Z-ADD0         #1TRRN                          CIR006
     C                     Z-ADD0         #1TNON                          CIR006
      *                                                                   CIR006
      ** Premium and Buy-Out Details                                      CIR006
      *                                                                   CIR006
     C                     MOVE UPVD      #1UPVD                          CIR006
     C                     MOVE UPFE      #1UPFE                          CIR006
     C                     MOVE UPPR      #1UPPR                          CIR006
     C                     MOVE BODD      #1BODD                          CIR006
     C                     MOVE BOVD      #1BOVD                          CIR006
     C                     MOVE BOAM      #1BOAM                          CIR006
     C                     MOVE BAPR      #1BAPR                          CIR006
     C                     MOVE ORED      #1ORED                          CIR006
      *                                                                                       CAP041
      ** Just call window if CAP041 is not installed. Otherwise                               CAP041
      ** call new API program for Up-Front Fee/Buy-outs                                       CAP041
      *                                                                                       CAP041
     C           CAP041    IFEQ 'Y'                                                           CAP041
     C                     MOVEL'IRFEBO'  WTEXT1  9                                           CAP041
     C                     MOVE 'SIN'     WTEXT1                                              CAP041
     C                     CALL WTEXT1                                                        CAP041
     C                     PARM *BLANKS   PRTCD                                               CAP041
     C                     PARM           DATA                                                CAP041
     C                     PARM *BLANKS   CANCFM  1                                           CAP041
      *                                                                                       CAP041
     C                     MOVEL'DL1604RX'PPGM                                                CAP041
     C                     ELSE                                                               CAP041
     C                     MOVEL'DL1604R 'PPGM                                                CAP041
     C                     ENDIF                                                              CAP041
      *                                                                                       CAP041
     C/COPY WNCPYSRC,DL1604RC38
     C           BGWDPR    IFEQ 'Y'                                                           CAP041
      *                                                                   CIR006
      ** Call window program                                              CIR006
      *                                                                   CIR006
     C                     CALL 'WN0010'                                  CIR006
     C**********           PARM 'DL1604R 'PPGM   10                                    CIR006 CAP041
     C                     PARM           PPGM   10                                           CAP041
     C                     PARM *BLANKS   PFKEY   2                       CIR006
     C                     PARM 'R'       PACTN   1                       CIR006
     C                     PARM           DATA                            CIR006
     C                     PARM *BLANKS   PRTCD                           CIR006
     C                     PARM *BLANKS   SPARE 256                       CIR006
      *                                                                   CIR006
     C                     ENDIF                                                              CAP041
     C                     ENDSR                                          CIR006
      *                                                                   CIR006
      ********************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CMTXT  SR.    To set up text on comit entry in journal       *
      *                                                               *
      *****************************************************************
      *
     C           CMTXT     BEGSR                           ***  CMTXT ****
      *
     C                     MOVE 'DL'      MDID
     C                     MOVE 'DL1604R' PGMN
     C                     MOVE WSID      WSIDX
     C                     TIME           MTIME
     C                     MOVE SACCD     IACTX
     C                     MOVE USRID     USRIDX
     C                     MOVE SCRN1     SCRN1X
     C                     MOVE SCRN2     SCRN2X
      *
     C                     ENDSR
      ********************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1604RC12                                           S01408
     C*                                                                   S01408
      /SPACE 4
      *****************************************************************   S01194
      *********************                                           *   S01194
      ***DBERR**SR.****To*update LDA with database error information  *   S01194
      *****************&*exit program                                 *   S01194
      **********************                                          *   S01194
      *****************************************************************   S01194
      **********************                                              S01194
     C***********DBERR*****BEGSR                           ***  DBERR ****S01194
      *********************                                               S01194
     C************NAMVAR***DEFN           LDA                             S01194
     C*********************MOVE 'DL1604R 'DBPGM                           S01194
     C*********************MOVEL'DL1604R 'DBPGM                           S01194
     C*********************OUT  LDA                                       S01194
      *********************                                               S01194
     C*********************SETON                     U7U8LR               S01194
      *********************                                               S01194
     C*********************RETRN                                          S01194
      *********************                                               S01194
     C*********************ENDSR                                          S01194
      ********************************************************************S01194
      /SPACE 4                                                            S01194
      *****************************************************************   S01194
      *                                                               *   S01194
      *  *PSSR SR.     To exit program upon database error            *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
      *                                                                   S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     MOVEL'DL1604R' DBPGM                           S01194
     C           *NAMVAR   DEFN           LDA   256                       S01194
     C           *LOCK     IN   LDA                                       S01194
     C                     MOVE DBERR     LDA                             S01194
     C                     OUT  LDA                                       S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     RETRN                                          S01194
     C                     ENDSR                                          S01194
      *****************************************************************   S01194
      /SPACE 3                                                            S01157
      *****************************************************************   S01157
      *                                                               *   S01157
      *  INFSR  SR.    File exception / Error handling                *   S01157
      *                                                               *   S01157
      *****************************************************************   S01157
      *                                                                   S01157
     C           INFSR     BEGSR                           ***  INFSR ****S01157
     C**                                                                  S01157
     C                     ROLBK                                          S01157
     C*                                                                   S01157
     C                     MOVE '1'       *INLR                           S01157
     C                     DUMP                                           S01157
     C                     RETRN                                          S01157
     C*                                                                   S01157
     C                     ENDSR                                          S01157
      ********************************************************************S01157
     C/COPY WNCPYSRC,DL1604RC28
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,GLINTCZ1                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZFRQB3                                                 CIR005
      /EJECT                                                              CIR005
      **   Release dealsdg record
     ODEALSDGFE                REL
     O**   Release prono record
     OPRONOPNFE                RELPR
      **   Release Olpos record
     OOLPOSOAFE                RELOL
**  CPY@  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ERRMSG - SCREEN MESSAGES
 INVALID KEY, F10 TO REVERSE
 RECORD HAS BEEN UPDATED BY ANOTHER WORKSTATION
 MATURED DEAL
 REVERSED DEAL
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
