     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA Monthly Summary Rebuild 1')
     F*****************************************************************
     F*                                                               *
     F*  Midas - FRA/IRS Module
     F*                                                               *
     F* DL1906 - FRA MONTHLY SUMMARY REBUILD 1                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 176570             Date 20Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 138231             Date 03Jul98               *
      *                 CEU012             Date 04Mar98               *
      *                 110523             Date 11Dec96               *
     F*                 S01194             Date 09Apr90               *
     F*                  S01157                 DATE 12/07/88         *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  176570 - FRA Monthly Summary enquiry error : user thrown out *
      *           and returned to the previous menu. Due to duplicate *
      *           records on DLMSY1PP for each half of the month read.*
      *  138231 - The CEU012 processing does not check for EOF        *
      *           of DLDLDGLA.                                        *
      *  CEU012 - EMU Position/Risk Enquiries                         *
     F*   110523 - TO CORRECT DISPLAY ORDER OF MTHLY SUMMARY REPORTS  *
     F*            AND DIFFERENTIATE BETWEEN RECORDS BEFORE AND AFTER *
     F*            YEAR 2000                                          *
     F*                                                               *
     F*   S01194 - NEW STANDING DATA CHANGES                          *
     F*                                                               *
     F*   S01157 - NEW PROGRAM FOR FRA/IRS PROJECT                    *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     FFDMNTHLLIF  E           K        DISK         KINFSR *PSSR      UC
     FDLDLDGLAIF  E           K        DISK         KINFSR *PSSR      UC
     F*DLMSB1L*UF**E*******    K        DISK         KINFSR *PSSR A    UC S01194
     FDLMSY1L UF  E           K        DISK         KINFSR *PSSR A    UC  S01194
     F*DLMSB2L*O***E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*DLMST1L*O*  E           K        DISK         KINFSR *PSSR  S01194 CEU012
     FDLMST1L UF  E           K        DISK         KINFSR *PSSR A    UC  CEU012
     F*DLMSM2L*O***E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*DLMST2L*O*  E           K        DISK         KINFSR *PSSR  S01194 CEU012
     FDLMST2L UF  E           K        DISK         KINFSR *PSSR A    UC  CEU012
     F*FDBRNCLLIF**E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*FDICDRLLIF**E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*
     F/EJECT
     F*
     F*****************************************************************
     F*
     F*    FUNCTION OF INDICATORS
     F*
     F*    08 - PREVENT LOOPING WITHIN *PSSR
     F*    60 - FAIL ON DLDLDGLA
     F*****70*-*FAIL*ON*DLMSB1L                                           S01194
     F*    70 - FAIL ON DLMSY1L                                           S01194
     F*****80*-*FAIL*ON*FDBRNCLL                                          S01194
     F*    98 - DATE FORMAT OF SYSTEM
     F*****************************************************************
     F/EJECT
     E*
     E/COPY ZSRSRC,ZDATE8Z1
     E*
     E                    TOT1        5 15 0             FRA MTH SUM
     E                    TOT4        5 15 0             FRA MTH SUM
     E                    TOT2       10 15 0             MTH SUM TOT2
     E                    TOT3       10 15 0             MTH SUM TOT3
     E                    EUT1        5 15 0             FRA MTH SUM EUR  CEU012
     E                    EUT2       10 15 0             MTH SUM TOT2 EUR CEU012
     E                    EUT3       10 15 0             MTH SUM TOT3 EUR CEU012
     E*
     E                    CPY@    1   1 80
     E** COMPILE TIME ARRAY FOR COPYRIGHT STATEMENT
     E*
     E/EJECT
     E*
     I*
     I/COPY ZSRSRC,ZDATE8Z2
     I*
     I*
     I* DATA STRUCTURE TO SPLIT UP DATE FORMAT (*IN98 = 0)
     I*
     IDATEA       DS
     I                                        1   20@SSDAY
     I                                        3   40@MM1
     I                                        5   60@YY1
     I                                        1   60@DATE
     I*
     I* DATA STRUCTURE TO SPLIT UP DATE FORMAT (*IN98 = 1)
     I*
     IDATEB       DS
     I                                        1   20@MM
     I                                        3   40@DD
     I                                        5   60@YY
     I                                        1   60@DATE2
     I*
     IPERIOD      DS
     I                                        1   50@VDCM
     I                                        5   50@PERD
     I*
     ITOTAL1      DS
     I                                        1  750TOT1
     I*
     ITOTAL2      DS
     I                                        1 1500TOT2
     I*
     ITOTAL3      DS
     I                                        1 1500TOT3
     I*
     IFILE1       DS
     I                                        1  150KDNP03
     I                                       16  300KDNP06
     I                                       31  450KDNP09
     I                                       46  600KDNP12
     I                                       61  750KDNPRR
     I                                        1  750TOT4
     I*
     IFILE2       DS
     I                                        1  150KHBP03
     I                                       16  300KHSP03
     I                                       31  450KHBP06
     I                                       46  600KHSP06
     I                                       61  750KHBP09
     I                                       76  900KHSP09
     I                                       91 1050KHBP12
     I                                      106 1200KHSP12
     I                                      121 1350KHBPRR
     I                                      136 1500KHSPRR
     I*
     IFILE3       DS
     I                                        1  150KFBP03
     I                                       16  300KFSP03
     I                                       31  450KFBP06
     I                                       46  600KFSP06
     I                                       61  750KFBP09
     I                                       76  900KFSP09
     I                                       91 1050KFBP12
     I                                      106 1200KFSP12
     I                                      121 1350KFBPRR
     I                                      136 1500KFSPRR
     I*
     IDBERR       DS                            256
     I*
     I** DATA STRUCTURE FOR DATABASE ERROR HANDLING
     I*
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*********************                                        BO0001 S01194
     I**KEY*TO*BRANCH*FILE*FDBRNCLL                                       S01194
     I*********************                                               S01194
     I*KEY2********DS******                                               S01194
     I*********************                   1   20@RECT                 S01194
     I*********************                   3   9 @ZZ007                S01194
     I*********************                  10  120BRCD                  S01194
     I*********************                                               S01194
     I*@CPYRT******DS******
     I*********************
     I***DATA*STRUCTURE*FOR COMPILATION - COPYRIGHT INSERTION
     I*********************
     I*********************                   1  80 CPY@
     I*********************                   1  20 CPY@##
     I*
      *                                                                   S01194
      ** Dummy data structures used by access programs                    S01194
      ** (DSSDY only used if file records over 150 chars long)            S01194
      *                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BANK DETAILS                        S01194
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              CEU012
      ** General ledger details                                           CEU012
      *                                                                   CEU012
     ISCSARD    E DSSCSARDPD                                              CEU012
      **  Switchable Features File                                        CEU012
      *                                                                   CEU012
     ISDCURR    E DSSDCURRPD                                              CEU012
      * Currency details                                                  CEU012
      *                                                                   CEU012
     I/EJECT
     C*****************************************************************
     C*
     C                     MOVEACPY@      BIS@   80
     C*
     C                     EXSR #A
     C*
     C                     EXSR #B
     C*
     C                     MOVE '1'       *INLR
     C*
     C                     RETRN
     C*
     C*****************************************************************
     C*
     C* SUBROUTINES USED
     C*
     C*         #A     - INITIAL PROCESSING
     C*         #B     - MAIN PROCESSING
     C*         #BA    - ACCUMULATE TOTALS
     C**********#BAA***- CONVERT BRANCH TO DRS FORMAT                     S01194
     C*         #BB    - WRITE CCY RCD
     C*         #BC    - WRITE BRANCH RCD
     C*         #BD    - WRITE VDAT PERIOD RCD
     C*         ZDATE8 - FORMAT MIDAS DAY NO.(MMDDYY/DDMMYY)
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C* #A - INITIAL PROCESSING
     C*
     C* CALLS -
     C*
     C* CALLED BY - MAIN CONTROLLING ROUTINE
     C*
     C* FLDS USED - @RECT  - RECORD TYPE
     C*             @ZZ007 - FILLER
     C*
     C*****************************************************************
     C           #A        BEGSR
     C*
     C* OPEN ALL FILES
     C*
     C                     OPEN FDMNTHLL
     C                     OPEN DLDLDGLA
     C*********************OPEN DLMSB1L                                   S01194
     C                     OPEN DLMSY1L                                   S01194
     C*********************OPEN DLMSB2L                                   S01194
     C                     OPEN DLMST1L                                   S01194
     C*********************OPEN DLMSM2L                                   S01194
     C                     OPEN DLMST2L                                   S01194
     C*********************OPEN FDBRNCLL                                  S01194
     C*********************OPEN FDICDRLL                                  S01194
      *                                                                   S01194
      ** Call Access Program for Bank Details                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   S01194
      ** If database error                                                S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL'10'      DBASE            *DBERROR 10*   S01194
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*
     C                     READ FDMNTHLL                 85
     C*
     C           *IN85     IFEQ '1'                        B*1
     C           MNDLTF    ORNE ' '
     C*                                                    ***************
     C                     MOVEL'FDMNTHLL'DBFILE           *             *
     C                     MOVEL*BLANK    DBKEY            * DBERROR 011 *
     C                     MOVE '011'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                       *1
     C                     END                             E*1
     C*
     C*********************READ FDICDRLL                 86               S01194
     C*********************                                               S01194
     C************IN86*****IFEQ '1'                        B*1            S01194
     C***********RECI******ORNE 'D'                                       S01194
     C*********************                                ***************S01194
     C*********************MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*********************MOVEL*BLANK    DBKEY            * DBERROR 021 *S01194
     C*********************MOVE '021'     DBASE            *             *S01194
     C*********************                                ***************S01194
     C*********************EXSR *PSSR                       *1            S01194
     C*********************END                             E*1            S01194
     C*
     C* DETERMINE DATE FORMAT OF SYSTEM AND SET *IN98 ACCORDINGLY
     C* FOR USE WITH SUBROUTINE ZDATE8
     C*
     C***********DATF******IFEQ 'M'                        B*1            S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE '1'       *IN98             *1
     C                     ELSE                            X*1
     C                     MOVE '0'       *IN98             *1
     C                     END                             E*1
     C*********************                                               S01194
     C**SETUP*PARTS*OF*KEY*TO FDBRNCLL THAT WON'T ALTER                   S01194
     C*********************                                               S01194
     C*********************Z-ADD10        @RECT                           S01194
     C*********************MOVE *BLANK    @ZZ007                          S01194
     C*
     C* INITIALISE ARRAYS
     C*
     C                     Z-ADD0         TOT1
     C                     Z-ADD0         TOT2
     C                     Z-ADD0         TOT3
     C                     Z-ADD0         TOT4
      *                                                                   CEU012
      ** Check if SAR CEU012 is installed                                 CEU012
      *                                                                   CEU012
     C                     CALL 'AOSARDR0'                                CEU012
     C                     PARM *BLANKS   @RTCD                           CEU012
     C                     PARM '*VERIFY' @OPTN                           CEU012
     C                     PARM 'CEU012'  @SARD   6                       CEU012
     C           SCSARD    PARM SCSARD    DSFDY                           CEU012
      *                                                                   CEU012
     C           @RTCD     IFEQ *BLANKS                                   CEU012
     C                     MOVE 'Y'       CEU012  1                       CEU012
     C                     ELSE                                           CEU012
     C                     MOVE 'N'       CEU012                          CEU012
      *                                                                   CEU012
     C           @RTCD     IFNE '*NRF   '                                 CEU012
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU012
     C                     MOVEL'CEU012'  DBKEY            *DBERROR 12*   CEU012
     C                     MOVEL'012'     DBASE            ************   CEU012
     C                     EXSR *PSSR                                     CEU012
     C                     ENDIF                                          CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
      ** Retrieve general ledger details                                  CEU012
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C**********           CALL 'AOGELRR0'                                CEU012              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           CEU012
     C                     PARM '*FIRST ' @OPTN                           CEU012
     C           SDGELR    PARM SDGELR    DSSDY                           CEU012
      *                                                                   CEU012
     C           @RTCD     IFNE *BLANKS                                   CEU012
     C                     MOVEL'SDGELRPD'DBFILE           ************   CEU012
     C                     MOVEL'*FIRST'  DBKEY            *DBERROR 13*   CEU012
     C                     MOVEL'013'     DBASE            ************   CEU012
     C                     EXSR *PSSR                                     CEU012
     C                     ENDIF                                          CEU012
     C                     ENDIF                                          CEU012
     C*
     C           #A9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C* #B - MAIN PROCESSING
     C*
     C* CALLS - #BA    - ACCUMULATE TOTALS
     C*         #BB    - WRITE CCY RCD
     C*         #BC    - WRITE BRANCH RCD
     C*         #BD    - WRITE VDAT PERIOD RCD
     C*         ZDATE8 - FORMAT MIDAS DAY NO.(MMDDYY/DDMMYY)
     C*
     C* CALLED BY - MAIN CONTROLLING ROUTINE
     C*
     C* FLDS USED - @BOKC - BOOK CODE
     C*             @CCY  - CURRENCY
     C**************@BRCD*- BRANCH                                        S01194
     C*             @BRCA - BRANCH                                        S01194
     C*             @YYMM - YEAR/MONTH
     C*             @VDPD - VAL DATE PERIOD
     C*             @SSDAY- DAY
     C*             @VDCM - VAL DATE PERIOD (COMPARISION)
     C**************@NDR1*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSB1PP        S01194
     C*             @NDR1 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSY1PP        S01194
     C**************@NDR2*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSM2PP        S01194
     C*             @NDR2 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMST2PP        S01194
     C**************@NDR3*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSB2PP        S01194
     C*             @NDR3 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMST1PP        S01194
     C*
     C*****************************************************************
     C           #B        BEGSR
     C*
     C                     READ DLDLDGLA                 60
     C*
     C*INITIALISE COMPARISION FIELDS
     C*
     C                     MOVE BOKC      @BOKC   2
     C                     MOVE UCUCY     @CCY    3
     C*********************MOVE BRCD      @BRCD   30                      S01194
     C                     MOVE BRCA      @BRCA   3                       S01194
      *                                                                   CEU012
      ** Check if currency is an 'In' currency and if is within           CEU012
      ** EMU transition start date and transition end date.               CEU012
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           *IN60     ANDEQ'0'                                       138231
     C                     CALL 'AOCURRR0'                                CEU012
     C                     PARM *BLANK    P@RTCD  7                       CEU012
     C                     PARM '*KEY   ' P@OPTN  7                       CEU012
     C                     PARM UCUCY     P@CUCY  3                       CEU012
     C           SDCURR    PARM SDCURR    DSSDY                           CEU012
      *                                                                   CEU012
     C           P@RTCD    IFEQ *BLANKS                                   CEU012
     C                     MOVELA6INCY    WTINCY  1                       CEU012
      *                                                                   CEU012
     C                     ELSE                                           CEU012
     C                     MOVEL'SDCURRPD'DBFILE                          CEU012
     C                     MOVELUCUCY     DBKEY            ************   CEU012
     C                     MOVEL'14'      DBASE            *DBERROR 14*   CEU012
     C                     EXSR *PSSR                      ************   CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*
     C* DETERMINE VALUE DATE PERIOD
     C*
     C* CONVERT VALUE DATE (DAY NO. FORMAT) TO DATE FORMAT
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE8
     C*
     C* SETUP @YYMM - DEPENDANT UPON DATE FORMAT RETURNED
     C*
     C           *IN98     IFEQ '1'                        B*1
     C                     Z-ADDZDATE     @DATE2            *1
     C                     MOVEL@YY       @YYMM   40        *1
     C                     MOVE @MM       @YYMM             *1
     C                     Z-ADD@DD       @SSDAY            *1
     C                     ELSE                            X*1
     C                     Z-ADDZDATE     @DATE             *1
     C                     MOVEL@YY1      @YYMM             *1
     C                     MOVE @MM1      @YYMM             *1
     C                     END                             E*1
     C*
     C                     Z-ADD@YYMM     @VDPD   50
     C                     MULT 10        @VDPD
     C*
     C* IF DAY NO. OF MONTH IS LESS THAN 15
     C*
     C           @SSDAY    IFLE 15                         B*1
     C                     ADD  1         @VDPD             *1
     C                     ELSE                            X*1
     C                     ADD  2         @VDPD             *1
     C                     END                             E*1
     C*
     C                     Z-ADD@VDPD     @VDCM   50
     C*
     C* DO WHILE NOT END OF FILE
     C*
     C           *IN60     DOWEQ'0'                        B*1
     C*
     C*INITIALISE NUMBER-OF-DEALS-IN-RECORD FIELDS
     C*
     C                     Z-ADD0         @NDR1   50
     C                     Z-ADD0         @NDR2   50
     C                     Z-ADD0         @NDR3   50
     C*
     C*
     C* DO WHILE SAME CURRENCY AND BOOK CODE AS PREVIOUS RECORD
     C* & NOT END OF FILE
     C*
     C           UCUCY     DOWEQ@CCY                       B*2
     C           BOKC      ANDEQ@BOKC                       *2
     C           *IN60     ANDEQ'0'                         *2
     C*
     C***ADD*1*TO*NO-DEALS-IN-RECORD FOR DLMSM2PP                         S01194
     C** ADD 1 TO NO-DEALS-IN-RECORD FOR DLMST2PP                         S01194
     C*
     C                     ADD  1         @NDR2             *2
     C*
     C* IF SAME BRANCH AS PREVIOUS RECORD
     C*
     C***********BRCD******IFEQ @BRCD                      B*3            S01194
     C           BRCA      IFEQ @BRCA                                     S01194
     C*
     C***ADD*1*TO*NO-DEALS-IN-RECORD FOR DLMSB2PP                         S01194
     C** ADD 1 TO NO-DEALS-IN-RECORD FOR DLMST1PP                         S01194
     C*
     C                     ADD  1         @NDR3            **3
     C*
     C* IF VALUE DATE PERIOD NOT SAME AS PREVIOUS RECORD
     C*
     C           @VDPD     IFNE @VDCM                      B*4
     C*
     C**WRITE*RECORD*TO*DLMSB1L                                           S01194
     C* WRITE RECORD TO DLMSY1L                                           S01194
     C*
     C                     EXSR #BD                         *4
     C*
     C* STORE NEW VALUE DATE FOR COMPARISON
     C*
     C                     Z-ADD@VDPD     @VDCM             *4
     C*
     C* ZEROISE TOTALS
     C*
     C                     Z-ADD0         TOT1              *4
     C*
     C***ELSE*ADD*1*TO*NO-DEALS-IN-RECORD FOR DLMSB1PP                    S01194
     C** ELSE ADD 1 TO NO-DEALS-IN-RECORD FOR DLMSY1PP                    S01194
     C*
     C                     ELSE                            X*4
     C                     ADD  1         @NDR1            **4
     C                     END                             E*4
     C*
     C* ELSE IF NOT SAME BRANCH
     C*
     C                     ELSE                            X*3
     C*
     C**WRITE*RECORD*TO*DLMSB2L                                           S01194
     C* WRITE RECORD TO DLMST1L                                           S01194
     C*
     C                     EXSR #BC                         *3
     C*
     C**WRITE*RECORD*TO*DLMSB1L                                           S01194
     C* WRITE RECORD TO DLMSY1L                                           S01194
     C*
     C                     EXSR #BD                         *3
     C*
     C* STORE NEW BRANCH & VALUE DATE PERIOD OR COMPARISON
     C*
     C*********************MOVE BRCD      @BRCD             *3            S01194
     C                     MOVE BRCA      @BRCA                           S01194
     C                     Z-ADD@VDPD     @VDCM             *3
     C*
     C* ZEROISE TOTALS
     C*
     C                     Z-ADD0         TOT2              *3
     C                     Z-ADD0         TOT1              *3
     C*
     C                     END                             E*3
     C*
     C* ACCUMULATE TOTALS
     C*
     C                     EXSR #BA                         *2
     C*
     C                     READ DLDLDGLA                 60 *2
     C*
     C* DETERMINE VALUE DATE PERIOD - IF NOT END OF FILE
     C*
     C           *IN60     IFEQ '0'                        B*3
     C*
     C* CONVERT VALUE DATE (DAY NO. FORMAT) TO DATE FORMAT
     C*
     C                     Z-ADDVDAT      ZDAYNO            *3
     C                     EXSR ZDATE8                      *3
     C*
     C* SETUP @YYMM - DEPENDANT UPON DATE FORMAT RETURNED
     C*
     C           *IN98     IFEQ '1'                        B*4
     C                     Z-ADDZDATE     @DATE2            *4
     C                     MOVEL@YY       @YYMM             *4
     C                     MOVE @MM       @YYMM             *4
     C                     Z-ADD@DD       @SSDAY            *4
     C                     ELSE                            X*4
     C                     Z-ADDZDATE     @DATE             *4
     C                     MOVEL@YY1      @YYMM             *1
     C                     MOVE @MM1      @YYMM             *1
     C                     END                             E*4
     C*
     C                     Z-ADD@YYMM     @VDPD             *3
     C                     MULT 10        @VDPD             *3
     C*
     C* IF DAY NO. OF MONTH IS LESS THAN 15
     C*
     C           @SSDAY    IFLE 15                         B*4
     C                     ADD  1         @VDPD             *4
     C                     ELSE                            X*4
     C                     ADD  2         @VDPD             *4
     C                     END                             E*4
     C*
     C                     END                             E*3
     C*
     C                     END                             E*2
     C*
     C* OTHERWISE CURRENCY OR BOOK CODE HAS CHANGED
     C*
     C*
     C**WRITE*RECORD*TO*DLMSM2L                                           S01194
     C* WRITE RECORD TO DLMST2L                                           S01194
     C*
     C                     EXSR #BB                         *1
     C*
     C**WRITE*RECORD*TO*DLMSB2L                                           S01194
     C* WRITE RECORD TO DLMST1L                                           S01194
     C*
     C                     EXSR #BC                         *1
     C*
     C**WRITE*RECORD*TO*DLMSB1L                                           S01194
     C* WRITE RECORD TO DLMSY1L                                           S01194
     C*
     C                     EXSR #BD                         *1
      *                                                                   CEU012
      ** Access currency file for 'In' currency indicator for EMU         CEU012
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C                     CALL 'AOCURRR0'                                CEU012
     C                     PARM *BLANK    P@RTCD  7                       CEU012
     C                     PARM '*KEY   ' P@OPTN  7                       CEU012
     C                     PARM UCUCY     P@CUCY  3                       CEU012
     C           SDCURR    PARM SDCURR    DSSDY                           CEU012
      *                                                                   CEU012
      ** Check if currency is an 'In' currency and if is within           CEU012
      ** EMU transition start date and transition end date.               CEU012
      *                                                                   CEU012
     C           P@RTCD    IFEQ *BLANKS                                   CEU012
     C                     MOVELA6INCY    WTINCY                          CEU012
      *                                                                   CEU012
     C                     ELSE                                           CEU012
     C                     MOVEL'SDCURRPD'DBFILE           ************   CEU012
     C                     MOVELUCUCY     DBKEY            *DBERROR 15*   CEU012
     C                     MOVEL'15'      DBASE            ************   CEU012
     C                     EXSR *PSSR                                     CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*
     C* STORE BOOK, CCY, BRANCH & VAL.DATE PERIOD FOR COMPARISON
     C*
     C                     MOVE BOKC      @BOKC             *1
     C                     MOVE UCUCY     @CCY              *1
     C*********************MOVE BRCD      @BRCD             *1            S01194
     C                     MOVE BRCA      @BRCA                           S01194
     C                     Z-ADD@VDPD     @VDCM             *1
     C*
     C* ZEROISE TOTALS
     C*
     C                     Z-ADD0         TOT1              *1
     C                     Z-ADD0         TOT2              *1
     C                     Z-ADD0         TOT3              *1
     C*
     C                     END                             E*1
     C*
     C           #B9       ENDSR
     C*
     C/EJECT
     C*
     C*****************************************************************
     C*
     C*   #BA - ACCUMULATE TOTALS
     C*
     C**CALLS*-*#BAA*-*CONVERT BRANCH TO DRS FORMAT                       S01194
     C* CALLS -                                                           S01194
     C*
     C* CALLED BY - #B - MAIN PROCESSING ROUTINE
     C*
     C* FLDS USED - @BRAN  - BRANCH
     C*             @VDAT1 - VAL DATE PERIOD +100
     C*             @VDAT2 - VAL DATE PERIOD +190
     C*             @VDAT3 - VAL DATE PERIOD +285
     C*             @VDAT4 - VAL DATE PERIOD +375
     C*             X,Y,Z  - ARRAY INDICES
     C*
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*********************                                               S01194
     C**CONVERT*MIDAS*BRANCH TO DRS FORMAT - IF CHANGED FROM PREV RCD     S01194
     C*********************                                               S01194
     C***********BRCD******IFNE @BRAN                      B*1            S01194
     C*********************EXSR #BAA                        *1            S01194
     C*********************Z-ADDBRCD      @BRAN   30        *1            S01194
     C*********************END                             E*1            S01194
     C*********************                                               S01194
     C*
     C* DETERMINE MATURITY DATE PERIOD & SET ARRAY INDEX
     C*
     C           VDAT      ADD  100       @VDAT1  50
     C           VDAT      ADD  190       @VDAT2  50
     C           VDAT      ADD  285       @VDAT3  50
     C           VDAT      ADD  375       @VDAT4  50
     C*
     C           VDAT      IFLE MDAT                       B*1
     C           MDAT      ANDLE@VDAT1                      *1
     C                     MOVE ' 3M'     @MDPD   3         *1
     C                     Z-ADD1         X       10        *1
     C                     Z-ADD1         Y       10        *1
     C                     Z-ADD2         Z       20        *1
     C                     END                             E*1
     C*
     C           @VDAT1    IFLT MDAT                       B*1
     C           MDAT      ANDLE@VDAT2                      *1
     C                     MOVE ' 6M'     @MDPD             *1
     C                     Z-ADD2         X                 *1
     C                     Z-ADD3         Y                 *1
     C                     Z-ADD4         Z                 *1
     C                     END                             E*1
     C*
     C           @VDAT2    IFLT MDAT                       B*1
     C           MDAT      ANDLE@VDAT3                      *1
     C                     MOVE ' 9M'     @MDPD             *1
     C                     Z-ADD3         X                 *1
     C                     Z-ADD5         Y                 *1
     C                     Z-ADD6         Z                 *1
     C                     END                             E*1
     C*
     C           @VDAT3    IFLT MDAT                       B*1
     C           MDAT      ANDLE@VDAT4                      *1
     C                     MOVE '12M'     @MDPD             *1
     C                     Z-ADD4         X                 *1
     C                     Z-ADD7         Y                 *1
     C                     Z-ADD8         Z                 *1
     C                     END                             E*1
     C*
     C           @VDAT4    IFLT MDAT                       B*1
     C                     MOVE 'REM'     @MDPD             *1
     C                     Z-ADD5         X                 *1
     C                     Z-ADD9         Y                 *1
     C                     Z-ADD10        Z                 *1
     C                     END                             E*1
     C*
     C* IF BUY/SELL INDICATOR IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*1
     C*
     C* ADD DEAL CONTRACT AMOUNTS TO APPROPRIATE FIELDS
     C*
     C                     ADD  UPAMT     TOT1,X            *1
     C                     ADD  UPAMT     TOT2,Y            *1
     C                     ADD  UPAMT     TOT3,Y            *1
     C*
     C*
     C* ELSE BUY/SELL INDICATOR IS 'S'
     C*
     C                     ELSE                            X*1
     C*
     C                     SUB  UPAMT     TOT1,X            *1
     C                     ADD  UPAMT     TOT2,Z            *1
     C                     ADD  UPAMT     TOT3,Z            *1
     C*
     C                     END                             E*1
     C*
     C           #BA9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01194
     C*********************                                               S01194
     C**#BAA*-*CONVERT*BRANCH TO DRS FORMAT                               S01194
     C*********************                                               S01194
     C**CALLS*-************                                               S01194
     C*********************                                               S01194
     C**CALLED*BY*-*#B*-*MAIN PROCESSING ROUTINE                          S01194
     C*********************                                               S01194
     C**FLDS*USED*-*KEY2*-*FDBRNCLL                                       S01194
     C*********************                                               S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#BAA******BEGSR                                          S01194
     C*********************                                               S01194
     C***********KEY2******CHAINFDBRNCLL             80                   S01194
     C*********************                                               S01194
     C************IN80*****IFEQ '1'                        B*1            S01194
     C***********RECI******ORNE 'D'                         *1            S01194
     C*********************                                ***************S01194
     C*********************MOVEL'FDBRNCLL'DBFILE           *             *S01194
     C*********************MOVELBRCD      DBKEY            * DBERROR 001 *S01194
     C*********************MOVE '001'     DBASE            *             *S01194
     C*********************                                ***************S01194
     C*********************EXSR *PSSR                       *1            S01194
     C*********************END                             E*1            S01194
     C*********************                                               S01194
     C***********#BAA9*****ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************   S01194
     C*/EJECT**************                                               S01194
     C*****************************************************************
     C*
     C* #BB - WRITE CCY RCD
     C*
     C* CALLS -
     C*
     C* CALLED BY - #B - MAIN PROCESSING ROUTINE
     C*
     C* FLDS USED - @BOKC -  BOOK CODE
     C*             @CCY  -  CURRENCY
     C**************@NDR2*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSM2PP        S01194
     C*             @NDR2 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMST2PP        S01194
     C*
     C*****************************************************************
     C*
     C           #BB       BEGSR
     C*
     C* SET UP BOOK, CCY FIELD AND N0-OF-DEALS-IN-RECORD-FOR-FILE FIELD
     C*
     C                     MOVE @BOKC     KFBOKC
     C                     MOVE @CCY      KFCCY
     C                     Z-ADD@NDR2     KFNDLR
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
     C                     Z-ADD1         J       20                      CEU012
      *                                                                   CEU012
     C           J         DOWLT10                                        CEU012
     C                     Z-ADDTOT3,J    W@AMT1 150                      CEU012
     C           W@AMT1    IFNE *ZEROS                                    CEU012
     C           @CCY      ANDNEBKEURO                                    CEU012
     C                     MOVEL'016'     WDBASE  3                       CEU012
     C                     EXSR SRECOV                                    CEU012
     C                     Z-ADDW@AMT2    EUT3,J                          CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDTOT3,J    EUT3,J                          CEU012
     C                     ENDIF                                          CEU012
     C                     ADD  1         J                               CEU012
     C                     ENDDO                                          CEU012
      *                                                                   CEU012
     C           KEY3      CHAINDLMST2L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '0'                                       CEU012
     C                     ADD  EUT3,1    KFBP03                          CEU012
     C                     ADD  EUT3,2    KFSP03                          CEU012
     C                     ADD  EUT3,3    KFBP06                          CEU012
     C                     ADD  EUT3,4    KFSP06                          CEU012
     C                     ADD  EUT3,5    KFBP09                          CEU012
     C                     ADD  EUT3,6    KFSP09                          CEU012
     C                     ADD  EUT3,7    KFBP12                          CEU012
     C                     ADD  EUT3,8    KFSP12                          CEU012
     C                     ADD  EUT3,9    KFBPRR                          CEU012
     C                     ADD  EUT3,10   KFSPRR                          CEU012
     C                     ADD  @NDR2     KFNDLR                          CEU012
     C                     UPDATDLMST2P0                                  CEU012
     C                     MOVEL@CCY      KFCCY                           CEU012
     C                     Z-ADD@NDR2     KFNDLR                          CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDEUT3,1    KFBP03                          CEU012
     C                     Z-ADDEUT3,2    KFSP03                          CEU012
     C                     Z-ADDEUT3,3    KFBP06                          CEU012
     C                     Z-ADDEUT3,4    KFSP06                          CEU012
     C                     Z-ADDEUT3,5    KFBP09                          CEU012
     C                     Z-ADDEUT3,6    KFSP09                          CEU012
     C                     Z-ADDEUT3,7    KFBP12                          CEU012
     C                     Z-ADDEUT3,8    KFSP12                          CEU012
     C                     Z-ADDEUT3,9    KFBPRR                          CEU012
     C                     Z-ADDEUT3,10   KFSPRR                          CEU012
     C                     Z-ADD@NDR2     KFNDLR                          CEU012
     C                     MOVELBKEUCP    KFCCY                           CEU012
     C                     WRITEDLMST2P0                                  CEU012
     C                     MOVEL@CCY      KFCCY                           CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*
     C* SET UP POSITION BOUGHT FIELDS
     C*
     C                     MOVE TOTAL3    FILE3
     C*
     C**WRITE*RECORD*TO*DLMSM2L                                           S01194
     C* WRITE RECORD TO DLMST2L                                           S01194
     C*
     C*********************WRITEDLMSM2P0                                  S01194
     C                     WRITEDLMST2P0                                  S01194
     C*
     C***SET*NO*OF*DEALS*IN-RECORD-FOR-DLMSM2PP TO 1                      S01194
     C** SET NO-OF-DEALS-IN-RECORD-FOR-DLMST2PP TO 1                      S01194
     C*
     C                     Z-ADD1         @NDR2
     C*
     C           #BB9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C* #BC  WRITE BRANCH RCD
     C*
     C* CALLS -
     C*
     C* CALLED BY - #B - MAIN PROCESSING ROUTINE
     C*
     C* FLDS USED - @BOKC -  BOOK CODE
     C*             @CCY  -  CURRENCY
     C**************@NDR3*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSB2PP        S01194
     C*             @NDR3 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMST1PP        S01194
     C*
     C*****************************************************************
     C*
     C           #BC       BEGSR
     C*
     C* SET UP BOOK, CCY FIELD AND N0-OF-DEALS-IN-RECORD-FOR-FILE FIELD
     C*
     C                     MOVE @BOKC     KHBOKC
     C                     MOVE @CCY      KHCCY
     C                     MOVE @NDR3     KHNDLR
     C*
     C* SETUP BRANCH
     C*
     C*********************MOVE BRSN      KHBRSN                          S01194
     C*********************MOVE BRCA      KHBRCA                          S01194
     C                     MOVE @BRCA     KHBRCA                          S01194
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
     C                     Z-ADD1         J                               CEU012
      *                                                                   CEU012
     C           J         DOWLT10                                        CEU012
     C                     Z-ADDTOT2,J    W@AMT1                          CEU012
     C           W@AMT1    IFNE *ZEROS                                    CEU012
     C           @CCY      ANDNEBKEURO                                    CEU012
     C                     MOVEL'017'     WDBASE                          CEU012
     C                     EXSR SRECOV                                    CEU012
     C                     Z-ADDW@AMT2    EUT2,J                          CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDTOT2,J    EUT2,J                          CEU012
     C                     ENDIF                                          CEU012
     C                     ADD  1         J                               CEU012
     C                     ENDDO                                          CEU012
      *                                                                   CEU012
     C           KEY2      CHAINDLMST1L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '0'                                       CEU012
     C                     ADD  EUT2,1    KHBP03                          CEU012
     C                     ADD  EUT2,2    KHSP03                          CEU012
     C                     ADD  EUT2,3    KHBP06                          CEU012
     C                     ADD  EUT2,4    KHSP06                          CEU012
     C                     ADD  EUT2,5    KHBP09                          CEU012
     C                     ADD  EUT2,6    KHSP09                          CEU012
     C                     ADD  EUT2,7    KHBP12                          CEU012
     C                     ADD  EUT2,8    KHSP12                          CEU012
     C                     ADD  EUT2,9    KHBPRR                          CEU012
     C                     ADD  EUT2,10   KHSPRR                          CEU012
     C                     ADD  @NDR3     KHNDLR                          CEU012
     C                     UPDATDLMST1P0                                  CEU012
     C                     MOVEL@CCY      KHCCY                           CEU012
     C                     Z-ADD@NDR3     KHNDLR                          CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDEUT2,1    KHBP03                          CEU012
     C                     Z-ADDEUT2,2    KHSP03                          CEU012
     C                     Z-ADDEUT2,3    KHBP06                          CEU012
     C                     Z-ADDEUT2,4    KHSP06                          CEU012
     C                     Z-ADDEUT2,5    KHBP09                          CEU012
     C                     Z-ADDEUT2,6    KHBP09                          CEU012
     C                     Z-ADDEUT2,7    KHSP12                          CEU012
     C                     Z-ADDEUT2,8    KHBP12                          CEU012
     C                     Z-ADDEUT2,9    KHSPRR                          CEU012
     C                     Z-ADDEUT2,10   KHBPRR                          CEU012
     C                     Z-ADD@NDR3     KHNDLR                          CEU012
     C                     Z-ADD@NDR3     KHNDLR                          CEU012
     C                     MOVELBKEUCP    KHCCY                           CEU012
     C                     WRITEDLMST1P0                                  CEU012
     C                     MOVEL@CCY      KHCCY                           CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*
     C* SETUP POSN NET FIELDS
     C*
     C                     MOVE TOTAL2    FILE2
     C*
     C* WRITE RCD
     C*
     C*********************WRITEDLMSB2P0                                  S01194
     C                     WRITEDLMST1P0                                  S01194
     C*
     C***SET*NO*OF*DEALS*IN-RECORD-FOR-DLMSB2PP TO 1                      S01194
     C** SET NO-OF-DEALS-IN-RECORD-FOR-DLMST1PP TO 1                      S01194
     C*
     C                     Z-ADD1         @NDR3
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C* #BD - WRITE VDAT PERD RCD
     C*
     C* CALLS -
     C*
     C* CALLED BY - #B - MAIN PROCESSING ROUTINE
     C*
     C* FLDS USED - @VDCM - VAL DATE PERIOD
     C*             @PERD - PART OF VAL DATE PERIOD
     C**************KEY1**- KEY TO DLMSB1L                                S01194
     C*             KEY1  - KEY TO DLMSY1L                                S01194
     C*             @BOKC -  BOOK CODE
     C*             @CCY  -  CURRENCY
     C**************@NDR1*- NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSB1PP        S01194
     C*             @NDR1 - NUMBER-OF-DEALS-IN-RECORD-FOR-DLMSY1PP        S01194
     C*        @YY1/@YY   - YEAR, USED TO DETERMINE THE CENTURY (FROM A   110523
     C*                     PREVIOUS SUBROUTINE, #B)                      110523
     C*****************************************************************
     C*
     C           #BD       BEGSR
     C*
     C* SETUP BOOK, CCY, BRANCH, VAL DATE PERIOD
     C*
     C                     MOVE @BOKC     KDBOKC
     C                     MOVE @CCY      KDCCY
     C*********************MOVE BRSN      KDBRSN                          S01194
     C*********************MOVE BRCA      KDBRCA                          S01194
     C                     MOVE @BRCA     KDBRCA                          S01194
     C                     Z-ADD@VDCM     KDVDTP
     C*                                                                   110523
     C** TO DIFFERENTIATE BETWEEN RECORDS BEFORE AND AFTER YR 2000.       110523
     C*                                                                   110523
     C           *IN98     IFEQ '1'                                       110523
     C*                                                                   110523
     C           @YY       IFLT 72                                        110523
     C                     MOVE '2'       KDCENT                          110523
     C                     ELSE                                           110523
     C                     MOVE '1'       KDCENT                          110523
     C                     ENDIF                                          110523
     C*                                                                   110523
     C                     ELSE                                           110523
     C*                                                                   110523
     C           @YY1      IFLT 72                                        110523
     C                     MOVE '2'       KDCENT                          110523
     C                     ELSE                                           110523
     C                     MOVE '1'       KDCENT                          110523
     C                     ENDIF                                          110523
     C*                                                                   110523
     C                     END                                            110523
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
     C                     Z-ADD1         J                               CEU012
      *                                                                   CEU012
     C           J         DOWLT5                                         CEU012
     C                     Z-ADDTOT1,J    W@AMT1                          CEU012
     C           W@AMT1    IFNE *ZEROS                                    CEU012
     C           @CCY      ANDNEBKEURO                                    CEU012
     C                     MOVEL'018'     WDBASE                          CEU012
     C                     EXSR SRECOV                                    CEU012
     C                     Z-ADDW@AMT2    EUT1,J                          CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDTOT1,J    EUT1,J                          CEU012
     C                     ENDIF                                          CEU012
     C                     ADD  1         J                               CEU012
     C                     ENDDO                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*                                                                   110523
     C           @PERD     IFEQ 1                          B*1
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
      *                                                                   CEU012
     C           KEY4      CHAINDLMSY1L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '0'                                       CEU012
     C                     ADD  EUT1,1    KDNP03                          CEU012
     C                     ADD  EUT1,2    KDNP06                          CEU012
     C                     ADD  EUT1,3    KDNP09                          CEU012
     C                     ADD  EUT1,4    KDNP12                          CEU012
     C                     ADD  EUT1,5    KDNPRR                          CEU012
     C                     ADD  @NDR1     KDNDLR                          CEU012
     C                     UPDATDLMSY1P0                                  CEU012
     C                     MOVEL@CCY      KDCCY                           CEU012
     C                     ELSE                                           CEU012
     C                     Z-ADDEUT1,1    KDNP03                          CEU012
     C                     Z-ADDEUT1,2    KDNP06                          CEU012
     C                     Z-ADDEUT1,3    KDNP09                          CEU012
     C                     Z-ADDEUT1,4    KDNP12                          CEU012
     C                     Z-ADDEUT1,5    KDNPRR                          CEU012
     C                     Z-ADD@NDR1     KDNDLR                          CEU012
     C                     MOVELBKEUCP    KDCCY                           CEU012
     C                     WRITEDLMSY1P0                                  CEU012
      *                                                                   CEU012
     C                     ADD  1         KDVDTP                          CEU012
     C                     Z-ADD0         KDNDLR                          CEU012
     C                     Z-ADD0         TOT4                            CEU012
     C                     WRITEDLMSY1P0                                  CEU012
      *                                                                   CEU012
     C                     SUB  1         KDVDTP                          CEU012
     C                     MOVEL@CCY      KDCCY                           CEU012
     C                     ENDIF                                          CEU012
      *                                                                   CEU012
     C                     ENDIF                                          CEU012
     C*
     C* SET UP POSN NET FIELDS AND NO-OF-DEALS-IN-RECORD COUNT
     C*
     C                     MOVE TOTAL1    FILE1             *1
     C                     Z-ADD@NDR1     KDNDLR            *1
     C*
     C* WRITE RCD
     C*
     C*********************WRITEDLMSB1P0                    *1            S01194
     C                     WRITEDLMSY1P0                                  S01194
     C*
     C* SET VAL DATE PERIOD TO MMYY2
     C*
     C                     ADD  1         KDVDTP            *1
     C*
     C* WRITE RCD WITH ZERO POSITIONS
     C*
     C                     Z-ADD0         KDNDLR            *1
     C                     Z-ADD0         TOT4              *1
     C*********************WRITEDLMSB1P0                    *1            S01194
     C                     WRITEDLMSY1P0                                  S01194
     C*
     C* ELSE VDAT PERIOD IS MMYY2
     C*
     C                     ELSE                            X*1
     C*
     C**RETRIEVE*RCD*FROM*DLMSB1L                                         S01194
     C* RETRIEVE RCD FROM DLMSY1L                                         S01194
     C*
     C***********KEY1******CHAINDLMSB1L              70     *1            S01194
     C           KEY1      CHAINDLMSY1L              70                   S01194
     C*
     C* IF RCD FOUND - UPDATE RCD ; ELSE WRITE NEW RCD
     C*
     C           *IN70     IFEQ '0'                        B*2
     C*
     C                     ADD  @NDR1     KDNDLR            *2
     C                     ADD  TOT1      TOT4              *2
     C*
     C*********************UPDATDLMSB1P0                    *2            S01194
     C                     UPDATDLMSY1P0                                  S01194
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
      *                                                                   CEU012
     C           KEY4      CHAINDLMSY1L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '0'                                       CEU012
     C                     ADD  @NDR1     KDNDLR                          CEU012
     C                     ADD  EUT1,1    TOT4,1                          CEU012
     C                     ADD  EUT1,2    TOT4,2                          CEU012
     C                     ADD  EUT1,3    TOT4,3                          CEU012
     C                     ADD  EUT1,4    TOT4,4                          CEU012
     C                     ADD  EUT1,5    TOT4,5                          CEU012
     C                     ADD  @NDR1     KDNDLR                          CEU012
     C                     UPDATDLMSY1P0                                  CEU012
     C                     MOVEL@CCY      KDCCY                           CEU012
     C                     ENDIF                                          CEU012
     C                     ENDIF                                          CEU012
     C*
     C                     ELSE                            X*2
     C*
     C                     Z-ADDTOT1      TOT4              *2
     C                     Z-ADD@NDR1     KDNDLR            *2
     C*
     C*********************WRITEDLMSB1P0                    *2            S01194
     C                     WRITEDLMSY1P0                                  S01194
      *                                                                   CEU012
      ** Write RCD with zero positions                                    176570
      *                                                                   176570
     C                     SUB  1         KDVDTP            *1            176570
     C                     Z-ADD0         TOT4              *2            176570
      *                                                                   176570
     C                     WRITEDLMSY1P0                                  176570
      *                                                                   176570
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
      *                                                                   CEU012
     C                     ADD  1         KDVDTP                          176570
     C           KEY4      CHAINDLMSY1L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '1'                                       CEU012
     C                     Z-ADDEUT1,1    TOT4,1                          CEU012
     C                     Z-ADDEUT1,2    TOT4,2                          CEU012
     C                     Z-ADDEUT1,3    TOT4,3                          CEU012
     C                     Z-ADDEUT1,4    TOT4,4                          CEU012
     C                     Z-ADDEUT1,5    TOT4,5                          CEU012
     C                     Z-ADD@NDR1     KDNDLR                          CEU012
     C                     MOVELBKEUCP    KDCCY                           176570
      *                                                                   176570
     C                     WRITEDLMSY1P0                                  CEU012
     C**********           MOVEL@CCY      KDCCY                    CEU012 176570
      *                                                                   176570
     C                     SUB  1         KDVDTP                          176570
     C                     Z-ADD0         TOT4                            176570
      *                                                                   176570
     C                     WRITEDLMSY1P0                                  176570
      *                                                                   176570
     C                     ENDIF                                          CEU012
     C                     ENDIF                                          CEU012
     C*
     C                     GOTO WEND1                                     176570
      *                                                                   176570
     C                     END                             E*2
     C*
     C* SET VAL DATE PERIOD TO MMYY1
     C*
     C                     SUB  1         KDVDTP            *1
     C*
     C***********KEY1******CHAINDLMSB1L              70     *1            S01194
     C           KEY1      CHAINDLMSY1L              70                   S01194
     C*
     C* IF RCD DOESN'T EXIST WRITE EMPTY RCD
     C*
     C           *IN70     IFEQ '1'                        B*2
     C*
     C                     Z-ADD0         TOT4              *2
     C                     Z-ADD0         KDNDLR            *2
     C*
     C*********************WRITEDLMSB1P0                    *2            S01194
     C                     WRITEDLMSY1P0                                  S01194
     C*
     C                     END                             E*2
      *                                                                   CEU012
     C           CEU012    IFEQ 'Y'                                       CEU012
     C           WTINCY    ANDEQ'Y'                                       CEU012
     C           CEU012    OREQ 'Y'                                       CEU012
     C           @CCY      ANDEQBKEURO                                    CEU012
      *                                                                   CEU012
     C           KEY4      CHAINDLMSY1L              70                   CEU012
      *                                                                   CEU012
     C           *IN70     IFEQ '1'                                       CEU012
     C                     Z-ADD0         TOT4                            CEU012
     C                     Z-ADD0         KDNDLR                          CEU012
      *                                                                   176570
     C                     MOVE BKEUCP    KDCCY                           176570
     C                     WRITEDLMSY1P0                                  CEU012
      *                                                                   176570
     C                     MOVE @CCY      KDCCY                           176570
      *                                                                   176570
     C                     ENDIF                                          CEU012
     C                     ENDIF                                          CEU012
     C*
     C                     END                             E*1
      *                                                                   176570
     C           WEND1     TAG                                            176570
     C*
     C** SET NO-OF-DEALS-IN-RECORD COUNT TO 1
     C*
     C                     Z-ADD1         @NDR1
     C*
     C           #BD9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C/COPY ZSRSRC,ZDATE8Z3
     C*
     C*****************************************************************
     C/EJECT
     C*
     C*****************************************************************
     C*
     C*                    KLIST DEFN
     C*                    PLIST DEFN
     C*
     C*****************************************************************
     C*
     C           KEY1      KLIST
     C                     KFLD           @BOKC
     C                     KFLD           @CCY
     C*********************KFLD           BRSN                            S01194
     C*********************KFLD           BRCA                            S01194
     C                     KFLD           @BRCA                           S01194
     C                     KFLD           KDCENT                          110523
     C                     KFLD           KDVDTP
      *                                                                   CEU012
     C           KEY2      KLIST                                          CEU012
     C                     KFLD           @BOKC                           CEU012
     C                     KFLD           BKEUCP                          CEU012
     C                     KFLD           @BRCA                           CEU012
      *                                                                   CEU012
     C           KEY3      KLIST                                          CEU012
     C                     KFLD           @BOKC                           CEU012
     C                     KFLD           BKEUCP                          CEU012
      *                                                                   CEU012
     C           KEY4      KLIST                                          CEU012
     C                     KFLD           @BOKC                           CEU012
     C                     KFLD           BKEUCP                          CEU012
     C                     KFLD           @BRCA                           CEU012
     C                     KFLD           KDCENT                          CEU012
     C                     KFLD           @VDCM                           CEU012
     C*
     C           *ENTRY    PLIST
     C                     PARM           @@TERM
     C*
     C*****************************************************************
     C/EJECT                                                              CEU012
      *****************************************************************   CEU012
      *  SRECOV - This is use to convert the net position from the    *   CEU012
      *           original currency into the Euro equivalent.         *   CEU012
      *                                                               *   CEU012
      *  Call on   : EU0200 - Euro conversion program                 *   CEU012
      *  Call by   : #BB - Write curenccy records                     *   CEU012
      *              #BC - Write branch records                       *   CEU012
      *              #BD - Write VDAT PERD records                    *   CEU012
      *                                                               *   CEU012
      *****************************************************************   CEU012
     C           SRECOV    BEGSR                                          CEU012
     C                     CALL 'EU0200'               1010               CEU012
     C                     PARM *BLANKS   P@RTCD  7                       CEU012
     C                     PARM W@AMT1    P@FRAM 183                      CEU012
     C                     PARM @CCY      P@FRCY  3                       CEU012
     C                     PARM BKEURO    P@TOCY  3                       CEU012
     C                     PARM *ZEROS    P@OUTA 150                      CEU012
     C                     PARM *ZEROS    P@INTA 183                      CEU012
     C                     PARM *ZEROS    P@EXRT 159                      CEU012
     C                     PARM *BLANKS   P@MDIN  1                       CEU012
      *                                                                   CEU012
     C           P@RTCD    IFEQ *BLANKS                                   CEU012
     C                     Z-ADDP@OUTA    W@AMT2 150                      CEU012
     C                     ELSE                                           CEU012
     C                     MOVEL'*CALL'   DBFILE                          CEU012
     C                     MOVEL'EU0200'  DBKEY                           CEU012
     C                     MOVELWDBASE    DBASE                           CEU012
     C                     EXSR *PSSR                                     CEU012
     C                     ENDIF                                          CEU012
     C                     ENDSR                                          CEU012
      *****************************************************************   CEU012
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - DATABASE ERROR SUBROUTINE                          *
     C*                                                               *
     C* CALLS    -                                                    *
     C*                                                               *
     C* CALLED IF ANY PROGRAM OR FILE ERRORS                          *
     C*                                                               *
     C*                                                               *
     C* FLDS USED - DBPGM   -  HOLDS PGM NAME IN LDA                  *
     C*             @LDA    -  VARIABLE TO SET UP LDA WITH DB ERRORS  *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C* SET INDICATOR *IN08 ON FIRST PASS THROUGH *PSSR TO PREVENT
     C* LOOPING WITHIN *PSSR
     C*
     C           *IN08     IFEQ '0'                        B*1
     C                     MOVE '1'       *IN08             *1
     C*
     C** MOVE DATABASE ERROR DETAILS INTO LDA FIELD
     C*
     C           *NAMVAR   DEFN LDA       @LDA  256         *1
     C           *LOCK     IN   @LDA                        *1
     C                     MOVELDBERR     @LDA              *1
     C                     OUT  @LDA                        *1
     C*
     C** SET UP TERMINATION PARAMETER, TURN ON ERROR SWITCHES,
     C** SET ON LR, DUMP AND RETURN
     C*
     C                     MOVE 'E'       @@TERM  1         *1
     C                     MOVE '1'       *INU7             *1
     C                     MOVE '1'       *INU8             *1
     C                     MOVE '1'       *INLR             *1
     C                     DUMP                             *1
     C                     RETRN                            *1
     C*
     C                     ELSE                            X*1
     C                     MOVE '1'       *INLR             *1
     C                     RETRN                            *1
     C                     END                             E*1
     C*
     C                     ENDSR
     C*****************************************************************
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**  CPY@  **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
