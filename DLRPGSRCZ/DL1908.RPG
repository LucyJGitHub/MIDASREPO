     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA Monthly Summary Maintenance')
     F*****************************************************************
     F*                                                               *
     F* Midas  FRA/IRS                                            *
     F*                                                               *
     F* DL1908  - FRA MONTHLY SUMMARY MAINTENANCE                     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD027             Date 09Dec05               *
      *  Prev Amend No. CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 110523             Date 20Jan97               *
      *                 061426             Date 30Sep93               *
     F*                  S01117                 DATE 01FEB90          *
     F*                  S01194                 DATE 30JAN90          *
     F*                  S01157                 DATE 21/06/88         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
     F*   110523 - TO CORRECT DISPLAY ORDER OF MTHLY SUMMARY REPORTS  *
     F*            AND DIFFERENTIATE BETWEEN RECORDS BEFORE AND AFTER *
     F*            YEAR 2000                                          *
     F*                                                               *
     F*   061426 - ZDATE9 correction                                  *
     F*                                                               *
     F*   S01117 - MULTI-BRANCHING CHANGES                            *
     F*                                                               *
     F*   S01194 - NEW STANDING DATA CHANGES                          *
     F*                                                               *
     F*   S01157 - NEW PROGRAM WRITTEN FOR FRA/IRS                    *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F/EJECT
     F* ID  F  C  H  L    FUNCTION OF INDICATORS
     F*****************************************************************
     F*                                                               *
     F* INDICATORS                                                    *
     F*                                                               *
     F* INDICATORS TO REPORT RECORD NOT FOUND                         *
     F*                                                               *
     F******70***-**RECORD NOT FOUND ON DLMSB1L                       *   S01117
     F*     70   -  RECORD NOT FOUND ON DLMSY1L                       *   S01117
     F******71***-**RECORD NOT FOUND ON DLMSM1L                       *   S01117
     F*     71   -  RECORD NOT FOUND ON DLMSY2L                       *   S01117
     F******72***-**RECORD NOT FOUND ON DLMSB2L                       *   S01117
     F*     72   -  RECORD NOT FOUND ON DLMST1L                       *   S01117
     F******73***-**RECORD NOT FOUND ON DLMSM2L                       *   S01117
     F*     73   -  RECORD NOT FOUND ON DLMST2L                       *   S01117
     F*                                                               *
     F* INDICATORS TO REPORT DATABASE ERRORS                          *
     F*                                                               *
     F******80***-**)*USED*IN*ZDATE9***********************************   061426
     F******81***-**)**************************************************   061426
     F*     82   -  DATABASE ERROR ON DEALS FILE - DLDLDGLE           *
     F******83***-**DATABASE ERROR ON BRANCH FILE - FDBRNCLL          *   S01194
     F******84***-**DATABASE ERROR ON INSTALLATION FILE - FDICDRLL    *   S01194
     F******85***-**DATABASE ERROR ON TABLE FILE - DLTB70LL           *   S01194
     F*                                                               *
     F*****************************************************************
     F*********************                                               S01194
     F*DLTB70LLIF**E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*********************                                               S01194
     F*FDICDRLLIF**E*******    K        DISK         KINFSR *PSSR      UC S01194
     F************TABTB11F*                         KIGNORE               S01194
     F************TABTB20F*                         KIGNORE               S01194
     F*********************                                               S01194
     F*FDBRNCLLIF**E*******    K        DISK         KINFSR *PSSR      UC S01194
     F*
     FDLDLDGLEIF  E           K        DISK         KINFSR *PSSR      UC
     F*
     F*DLMSB1L*UF**E***********K        DISK         KINFSR *PSSR A    UC S01117
     FDLMSY1L UF  E           K        DISK         KINFSR *PSSR A    UC  S01117
     F                                              KCOMIT
     F*
     F*DLMSM1L*UF**E***********K        DISK         KINFSR *PSSR A    UC S01117
     FDLMSY2L UF  E           K        DISK         KINFSR *PSSR A    UC  S01117
     F                                              KCOMIT
     F*
     F*DLMSB2L*UF**E***********K        DISK         KINFSR *PSSR A    UC S01117
     FDLMST1L UF  E           K        DISK         KINFSR *PSSR A    UC  S01117
     F                                              KCOMIT
     F*
     F*DLMSM2L*UF**E***********K        DISK         KINFSR *PSSR A    UC S01117
     FDLMST2L UF  E           K        DISK         KINFSR *PSSR A    UC  S01117
     F                                              KCOMIT
     F*
     F*****************************************************************
     E*
     E                    CPY@    1   1 80
     E** COMPILE TIME ARRAY FOR COPYRIGHT STATEMENT
     E*
      /COPY ZSRSRC,ZDATE9Z1
     I*
      /COPY ZSRSRC,ZDATE9Z2
     I*
     I*@CPYRT******DS******
     I*********************
     I***DATA*STRUCTURE*FOR COMPILATION - COPYRIGHT INSERTION
     I*********************
     I*********************                   1  80 CPY@
     I*********************                   1  20 CPY@##
     I*********************
     I*
     I@XVDTP      DS                              5
     I*
     I** DS TO HELP SET UP VALUE DATE PERIOD USING @@VDT FROM ZDATE9
     I*
     I                                        1   50@VDTP
     I                                        1   4 @VDPYM
     I                                        5   5 @VDPDY
     I*
     I*********************                                               S01194
     I*@KYT70******DS******                       12                      S01194
     I*********************                                               S01194
     I***DATA*STRUCTURE*FOR KEY TO READ TABTB70 FILE                      S01194
     I*********************                                               S01194
     I*********************                   1   2 @K1T70                S01194
     I*********************                  11  12 @K2T70                S01194
     I*********************                                               S01194
     I*********************                                               S01194
     I*@KYBCH******DS******                       12                      S01194
     I*********************                                               S01194
     I***DATA*STRUCTURE*FOR KEY TO BRANCH FILE                            S01194
     I*********************                                               S01194
     I*********************                   1   2 @K1BCH                S01194
     I*********************                  10  120@K2BCH                S01194
     I*********************                                               S01194
     I*********************                                               S01194
     I*@KYICD******DS******                       12                      S01194
     I*********************                                               S01194
     I***DATA*STRUCTURE*FOR KEY TO INSTALLAION CONTROL FILE               S01194
     I*********************                                               S01194
     I*********************                   1   2 @K1ICD                S01194
     I*********************                  11  12 @K2ICD                S01194
     I*********************                                               S01194
     I*
     IDBERR       DS                            256
     I*
     I** DATA STRUCTURE FOR DATABASE ERROR HANDLING
     I*
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*
      ** Dummy data structures used by access programs                    S01194
      ** (DSSDY only used if file records over 150 chars long)            S01194
      *                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** RECORD FORMATS FOR ACCESS TO BANK DETAILS                        S01194
     I*                                                                   S01194
     I*
     C*****************************************************************
     C/EJECT
      *
     C                     MOVEACPY@      BIS@   80
      *
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Main controlling routine                           *
     C*                                                               *
     C* CALLS      #A      -  INITIAL PROCESSING                      *
     C*            #B      -  MAIN PROCESSING                         *
     C*            #C      -  TERMINATION PROCESSING                  *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C*
     C                     EXSR #A
     C*
     C** PROCESS ONLY IF VALUE DATE FOR THE DEAL IS GREATER THAN OR
     C** EQUAL TO THE RUN DATE
     C*
     C***********VDAT******IFGE RUND                                      S01194
     C           VDAT      IFGE BJRDNB                                    S01194
     C                     EXSR #B
     C                     END
     C*
     C                     EXSR #C
     C*
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*      #A      -  INITIAL PROCESSING                            *
     C*      #B      -  MAIN PROCESSING                               *
     C*      #C      -  TERMINATION PROCESSING                        *
     C*      #BA     -  DETERMINE MONTHLY SUMMARY PERIODS             *
     C*      ZDATE9  -  CONVERT FROM MIDAS DAY NO. TO YYYYMMDD        *
     C*      #BB     -  PROCESS AN INSERTED DEAL                      *
     C*      #BC     -  PROCESS A DELETED DEAL                        *
     C*******#BBA****-  PROCESS DLMSB1L FOR AN INSERTED DEAL          *   S01117
     C*      #BBA    -  PROCESS DLMSY1L FOR AN INSERTED DEAL          *   S01117
     C*******#BBB****-  PROCESS DLMSM1L FOR AN INSERTED DEAL          *   S01117
     C*      #BBB    -  PROCESS DLMSY2L FOR AN INSERTED DEAL          *   S01117
     C*******#BBC****-  PROCESS DLMSB2L FOR AN INSERTED DEAL          *   S01117
     C*      #BBC    -  PROCESS DLMST1L FOR AN INSERTED DEAL          *   S01117
     C*******#BBD****-  PROCESS DLMSM2L FOR AN INSERTED DEAL          *   S01117
     C*      #BBD    -  PROCESS DLMST2L FOR AN INSERTED DEAL          *   S01117
     C*******#BCA****-  PROCESS DLMSB1L FOR A DELETED DEAL            *   S01117
     C*      #BCA    -  PROCESS DLMSY1L FOR A DELETED DEAL            *   S01117
     C*******#BCB****-  PROCESS DLMSM1L FOR A DELETED DEAL            *   S01117
     C*      #BCB    -  PROCESS DLMSY2L FOR A DELETED DEAL            *   S01117
     C*******#BCC****-  PROCESS DLMSB2L FOR A DELETED DEAL            *   S01117
     C*      #BCC    -  PROCESS DLMST1L FOR A DELETED DEAL            *   S01117
     C*******#BCD****-  PROCESS DLMSM2L FOR A DELETED DEAL            *   S01117
     C*      #BCD    -  PROCESS DLMST2L FOR A DELETED DEAL            *   S01117
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - INITIAL PROCESSING                                 *
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*                                                               *
     C* CALLED BY  MAIN CONTROLLING ROUTINE                           *
     C*                                                               *
     C* FLDS USED  @ACTCD     - ACTION CODE - I/A/D   ) INPUT         *
     C*            @DLNUM     - DEAL NUMBER           ) PARAMETER     *
     C*            @TERM      - TERMINATION PARAMETER )               *
     C*            @FCALL     - FIRST CALL OF PROGRAM INDICATOR       *
     C*************@KYT70*****- KEY TO DLTB70LL                       *   S01194
     C*************@K1T70*****- PART OF KEY TO DLTB70LL               *   S01194
     C*************@K2T70*****- PART OF KEY TO DLTB70LL               *   S01194
     C*************@KYICD*****- KEY TO FDICDRLL                       *   S01194
     C*************@K1ICD*****- PART OF KEY TO FDICDRLL               *   S01194
     C*************@K2ICD*****- PART OF KEY TO FDICDRLL               *   S01194
     C*                                                               *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C                     MOVEL'DL1908'  DBPGM
     C*
     C** RECEIVE INPUT PARAMETERS
     C*
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C                     PARM           @ACTCD  1
     C                     PARM           @DLNUM  60
     C*
     C** IF THIS IS THE FIRST CALL TO THE PROGRAM THEN OPEN FILES AND
     C** READ TABLE FILE FOR DEFAULT FRA TRADING BOOK
     C*
     C           @FCALL    IFNE 'N'                        B1
     C*
     C*********************OPEN DLTB70LL                   *1             S01194
     C*********************OPEN FDICDRLL                   *1             S01194
     C*********************OPEN FDBRNCLL                   *1             S01194
     C                     OPEN DLDLDGLE                   *1
     C*********************OPEN DLMSB1L                    *1             S01117
     C                     OPEN DLMSY1L                                   S01117
     C*********************OPEN DLMSM1L                    *1             S01117
     C                     OPEN DLMSY2L                                   S01117
     C*********************OPEN DLMSB2L                    *1             S01117
     C                     OPEN DLMST1L                                   S01117
     C*********************OPEN DLMSM2L                    *1             S01117
     C                     OPEN DLMST2L                                   S01117
     C*********************                                               S01194
     C***READ*FDICDRLL*****                                               S01194
     C*********************                                               S01194
     C*********************MOVE '01'      @K1ICD           *1             S01194
     C*********************MOVE '10'      @K2ICD           *1             S01194
     C*********************                                               S01194
     C***********@KYICD****CHAINFDICDRLL             84                   S01194
     C*********************                                               S01194
     C************IN84*****IFEQ '1'                        B*2            S01194
     C***********RECI******ORNE 'D'                        **2            S01194
     C*********************                                ***************S01194
     C*********************MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*********************MOVEL@KYICD    DBKEY            * DBERROR 001 *S01194
     C*********************MOVE '001'     DBASE            *             *S01194
     C*********************                                ***************S01194
     C*********************EXSR *PSSR                      *2             S01194
     C*********************END                             E2             S01194
     C*********************                                               S01194
     C***READ*TABTB70******                                               S01194
     C*********************                                               S01194
     C*********************MOVE '01'      @K1T70           *1             S01194
     C*********************MOVE '70'      @K2T70           *1             S01194
     C*********************                                               S01194
     C***********@KYT70****CHAINDLTB70LL             85    *1             S01194
     C*********************                                               S01194
     C************IN85*****IFEQ '1'                        B*2            S01194
     C***********RECI******ORNE 'D'                        **2            S01194
     C*********************                                ***************S01194
     C*********************MOVEL'DLTB70LL'DBFILE           *             *S01194
     C*********************MOVEL'002'     DBASE            * DBERROR 002 *S01194
     C*********************MOVEL@KYT70    DBKEY            *             *S01194
     C*********************                                ***************S01194
     C*********************EXSR *PSSR                      **2            S01194
     C*********************END                             E*2            S01194
      *                                                                   S01194
      ** Access I.C.D. record                                             S01194
      *                                                                   S01194
      ** Call Access Program for Bank Details                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*
     C                     END                             E1
     C*
     C                     MOVE 'N'       @FCALL  1
     C*
     C** READ THE DEALS FILE FOR THE DEAL USING THE DEAL NUMBER AS KEY
     C** IF RECORD NOT FOUND PROCESS A DATABASE ERROR
     C*
     C           @DLNUM    CHAINDLDLDGLE             82
     C*
     C           *IN82     IFEQ '1'                        B1
     C*                                                    ***************
     C                     MOVEL'DLDLDGLE'DBFILE           *             *
     C                     MOVEL'003'     DBASE            * DBERROR 003 *
     C                     MOVEL@DLNUM    DBKEY            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      *1
     C                     END                             E1
     C*
     C           #A9       ENDSR                           *** #A9 ***
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - MAIN PROCESSING                                    *
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*            #BA     -  DETERMINE MONTHLY SUMMARY PERIODS       *
     C*                                                               *
     C* CALLED BY  MAIN CONTROLLING ROUTINE                           *
     C*                                                               *
     C* FLDS USED                                                     *   S01194
     C**FLDS*USED**@KYBCH*****- KEY TO FDBRNCLL                       *   S01194
     C*************@K1BCH*****- PART OF KEY TO FDBRNCLL               *   S01194
     C*************@K2BCH*****- PART OF KEY TO FDBRNCLL               *   S01194
     C*            @ACTCD     - ACTION CODE - I/A/D                   *
     C*************@BRSN******- DRS BRANCH CODE FOR DEAL              *   S01194
     C*            BRCA       - BRANCH CODE FOR DEAL                  *   S01194
     C*            @VDTP      - VALUE DATE PERIOD CALCULATED FOR DEAL *
     C*************@KMSB1*****- KEY LIST FOR FILE DLMSB1L             *   S01117
     C*            @KMSB1     - KEY LIST FOR FILE DLMSY1L             *   S01117
     C*************@KMSM1*****- KEY LIST FOR FILE DLMSM1L             *   S01117
     C*            @KMSM1     - KEY LIST FOR FILE DLMSY2L             *   S01117
     C*************@KMSB2*****- KEY LIST FOR FILE DLMSB2L             *   S01117
     C*            @KMSB2     - KEY LIST FOR FILE DLMST1L             *   S01117
     C*************@KMSM2*****- KEY LIST FOR FILE DLMSM2L             *   S01117
     C*            @KMSM2     - KEY LIST FOR FILE DLMST2L             *   S01117
     C*                                                               *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C***CONVERT*MIDAS*BRANCH CODE FOR DEAL TO DRS BRANCH CODE            S01194
     C*********************                                               S01194
     C*********************MOVE '10'      @K1BCH                          S01194
     C*********************Z-ADDBRCD      @K2BCH                          S01194
     C*********************                                               S01194
     C***********@KYBCH****CHAINFDBRNCLL             83                   S01194
     C*********************                                               S01194
     C************IN83*****IFEQ '1'                        B1             S01194
     C***********RECI******ORNE 'D'                        *1             S01194
     C*********************                                ***************S01194
     C*********************MOVEL'FDBRNCLL'DBFILE           *             *S01194
     C*********************MOVEL@KYBCH    DBKEY            * DBERROR 004 *S01194
     C*********************MOVE '004'     DBASE            *             *S01194
     C*********************                                ***************S01194
     C*********************EXSR *PSSR                      *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C*********************MOVE BRSN      @BRSN   3                       S01194
     C*
     C** DETERMINE VALUE DATE PERIOD AND MATURITY DATE PERIOD (#BA)
     C*
     C                     EXSR #BA
     C*
     C** SET UP THE KEY LISTS - ONE FOR EACH FILE
     C*
     C           @KMSB1    KLIST
     C                     KFLD           BOKC
     C                     KFLD           UCUCY
     C*********************KFLD           @BRSN                           S01194
     C                     KFLD           BRCA                            S01194
     C                     KFLD           @@CENT                          110523
     C                     KFLD           @VDTP
     C*
     C           @KMSM1    KLIST
     C                     KFLD           BOKC
     C                     KFLD           UCUCY
     C                     KFLD           @@CENT                          110523
     C                     KFLD           @VDTP
     C*
     C           @KMSB2    KLIST
     C                     KFLD           BOKC
     C                     KFLD           UCUCY
     C*********************KFLD           @BRSN                           S01194
     C                     KFLD           BRCA                            S01194
     C*
     C           @KMSM2    KLIST
     C                     KFLD           BOKC
     C                     KFLD           UCUCY
     C*
     C** IF ACTION CODE IS 'I' THEN PROCESS FOR AN INSERTED DEAL (#BB)
     C*
     C           @ACTCD    IFEQ 'I'                        B1
     C                     EXSR #BB                        *1
     C                     END                             E1
     C*
     C** IF ACTION CODE IS 'R' THEN PROCESS FOR A DELETED DEAL (#BC)
     C*
     C           @ACTCD    IFEQ 'R'                        B1
     C                     EXSR #BC                        *1
     C                     END                             E1
     C*
     C           #B9       ENDSR                           *** #B9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #C       - TERMINATION PROCESSING                             *
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  MAIN CONTROLLING ROUTINE                           *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #C        BEGSR
     C*
     C** RETURN WITHOUT SETTING ON LR
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR                           *** #C9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA      - DETERMINE MONTHLY SUMMARY PERIODS                  *
     C*                                                               *
     C* CALLS      ZDATE9  -  CONVERT FROM MIDAS DAY NO. TO YYYYMMDD  *
     C*                                                               *
     C* CALLED BY  #B      -  MAIN PROCESSING                         *
     C*                                                               *
     C* FLDS USED  @TOP3M     - TOP OF THE RANGE FOR PERIOD OF 3M     *
     C*            @TOP6M     - TOP OF THE RANGE FOR PERIOD OF 6M     *
     C*            @TOP9M     - TOP OF THE RANGE FOR PERIOD OF 9M     *
     C*            @TOP12     - TOP OF THE RANGE FOR PERIOD OF 12     *
     C*                                                               *
     C*            @@DAYN     - MIDAS DAY NO. SENT TO ZDATE9          *
     C*                                                               *
     C*            @@YR       - YYYY SECTION OF YYYYMMDD ) DS USED    *
     C*            @@Z71M     - MM SECTION OF YYYYMMDD   ) IN         *
     C*            @@Z71D     - DD SECTION OF YYYYMMDD   ) ZDATE9     *
     C*            @DRSY      - 2,0 FIELD TO GET YY                   *
     C*            @VDPYM     - YYMM SECTION OF VALUE DATE PERIOD     *
     C*            @VDPDY     - DAY (1/2) SECTION OF VALUE DATE PERIOD*
     C*                                                               *
     C*            @MDTP      - MATURITY DATE PERIOD FOR DEAL         *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C** DETERMINE VALUE DATE PERIOD
     C*
     C** CONVERT THE VALUE DATE FOR THE DEAL FROM MIDAS TO DRS FORMAT
     C*
     C                     Z-ADDVDAT      @@DAYN  50
     C                     EXSR ZDATE9
     C*
     C** GET YYMM FROM YYYYMMDD INTO THE RELEVANT PART OF THE VALUE
     C** DATE PERIOD USING THE DATA STRUCTURE USED BY ZDATE9
     C*
     C                     MOVE @@YR      @DRSY   20
     C                     MOVEL@DRSY     @VDPYM
     C                     MOVE @@Z71M    @VDPYM
     C*                                                                   110523
     C** TO DIFFERENTIATE BETWEEN RECORDS BEFORE AND AFTER YEAR 2000      110523
     C** IF YY IS LESS THAN 72 (THIS MEANS IT IS EQUAL TO OR GREATER      110523
     C** THAN THE YEAR 2000) THEN THE CENTURY PERIOD IS '2' ELSE IF       110523
     C** GREATER THAN OR EQUAL TO 72 THE RECORD IS IN THIS CENTURY        110523
     C** AND CENTURY PERIOD IS '1'                                        110523
     C*                                                                   110523
     C           @DRSY     IFLT 72                                        110523
     C                     MOVE '2'       @@CENT  10                      110523
     C                     ELSE                                           110523
     C                     MOVE '1'       @@CENT  10                      110523
     C                     ENDIF                                          110523
     C*                                                                   110523
     C** IF THE DAY PORTION IS LESS THAN OR EQUAL TO '15' THEN VALUE
     C** DATE PERIOD END NUMBER IS '1' ELSE (DAY NUMBER IS GREATER
     C** THAN '15') VALUE DATE PERIOD END NUMBER IS '2'
     C*
     C           @@Z71D    IFLE 15                         B1
     C                     MOVE '1'       @VDPDY           *1
     C                     ELSE                            X1
     C                     MOVE '2'       @VDPDY           *1
     C                     END                             E1
     C*
     C** DETERMINE MATURITY DATE PERIOD
     C*
     C** SET THE TOP OF THE RANGE FOR THE THREE MONTH PERIOD (@TOP3M)
     C** AND TEST FOR MATURITY DATE WITHIN THE RANGE (VALUE DATE BEING
     C** THE BOTTOM OF THE RANGE) IF NOT WITHIN THIS RANGE CALCULATE
     C** THE TOP OF THE RANGE FOR THE NEXT PERIOD (SIX MONTHS) AND
     C** TEST AGAIN - REPEAT THIS UNTIL CORRECT RANGE FOUND (IE. THE
     C** CORRECT MATURITY DATE PERIOD)
     C*
     C           VDAT      ADD  100       @TOP3M  50
     C           MDAT      IFGE VDAT                       B1
     C           MDAT      ANDLE@TOP3M                     *1
     C                     MOVE '03'      @MDTP   2        *1
     C                     ELSE                            X1
     C*
     C           VDAT      ADD  190       @TOP6M  50       *1
     C           MDAT      IFGT @TOP3M                     B*2
     C           MDAT      ANDLE@TOP6M                     **2
     C                     MOVE '06'      @MDTP            **2
     C                     ELSE                            X*2
     C*
     C           VDAT      ADD  285       @TOP9M  50       **2
     C           MDAT      IFGT @TOP6M                     B**3
     C           MDAT      ANDLE@TOP9M                     ***3
     C                     MOVE '09'      @MDTP            ***3
     C                     ELSE                            X**3
     C*
     C           VDAT      ADD  375       @TOP12  50       ***3
     C           MDAT      IFGT @TOP9M                     B***4
     C           MDAT      ANDLE@TOP12                     ****4
     C                     MOVE '12'      @MDTP            ****4
     C                     ELSE                            X***4
     C*
     C                     MOVE 'RM'      @MDTP            ****4
     C*
     C                     END                             E***4
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BA9      ENDSR                           *** #BA9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      /COPY ZSRSRC,ZDATE9Z3
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      - PROCESS AN INSERTED DEAL                           *
     C*                                                               *
     C**CALLS******#BBA****-  PROCESS DLMSB1L FOR AN INSERTED DEAL    *   S01117
     C* CALLS      #BBA    -  PROCESS DLMSY1L FOR AN INSERTED DEAL    *   S01117
     C*************#BBB****-  PROCESS DLMSM1L FOR AN INSERTED DEAL    *   S01117
     C*            #BBB    -  PROCESS DLMSY2L FOR AN INSERTED DEAL    *   S01117
     C*************#BBC****-  PROCESS DLMSB2L FOR AN INSERTED DEAL    *   S01117
     C*            #BBC    -  PROCESS DLMST1L FOR AN INSERTED DEAL    *   S01117
     C*************#BBD****-  PROCESS DLMSM2L FOR AN INSERTED DEAL    *   S01117
     C*            #BBD    -  PROCESS DLMST2L FOR AN INSERTED DEAL    *   S01117
     C*                                                               *
     C* CALLED BY  #B      -  MAIN PROCESSING                         *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BB       BEGSR
     C*
     C** ACCESS EACH FILE AND UPDATE OR WRITE THE RECORD AS NECESSARY
     C*
     C                     EXSR #BBA
     C                     EXSR #BBB
     C                     EXSR #BBC
     C                     EXSR #BBD
     C*
     C           #BB9      ENDSR                           *** #BB9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BC      - PROCESS A DELETED DEAL                             *
     C*                                                               *
     C**CALLS******#BCA****-  PROCESS DLMSB1L FOR A DELETED DEAL      *   S01117
     C* CALLS      #BCA    -  PROCESS DLMSY1L FOR A DELETED DEAL      *   S01117
     C*************#BCB****-  PROCESS DLMSM1L FOR A DELETED DEAL      *   S01117
     C*            #BCB    -  PROCESS DLMSY2L FOR A DELETED DEAL      *   S01117
     C*************#BCC****-  PROCESS DLMSB2L FOR A DELETED DEAL      *   S01117
     C*            #BCC    -  PROCESS DLMST1L FOR A DELETED DEAL      *   S01117
     C*************#BCD****-  PROCESS DLMSM2L FOR A DELETED DEAL      *   S01117
     C*            #BCD    -  PROCESS DLMST2L FOR A DELETED DEAL      *   S01117
     C*                                                               *
     C* CALLED BY  #B      -  MAIN PROCESSING                         *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BC       BEGSR
     C*
     C** ACCESS EACH FILE AND UPDATE THE RECORD AS NECESSARY
     C*
     C                     EXSR #BCA
     C                     EXSR #BCB
     C                     EXSR #BCC
     C                     EXSR #BCD
     C*
     C           #BC9      ENDSR                           *** #BC9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BBA*****-*PROCESS DLMSB1L FOR AN INSERTED DEAL               *   S01117
     C* #BBA     - PROCESS DLMSY1L FOR AN INSERTED DEAL               *   S01117
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  #BB     -  PROCESS AN INSERTED DEAL                *
     C*                                                               *
     C**FLDS*USED**@KMSB1**-  KEY TO DLMSB1L                          *   S01117
     C* FLDS USED  @KMSB1  -  KEY TO DLMSY1L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @VDTP   -  VALUE DATE PERIOD CALCULATED FOR DEAL   *
     C*            @VDPDY  -  VALUE DATE PERIOD END NUMBER - 1 OR 2   *
     C*************@BRSN***-  DRS BRANCH CODE FOR DEAL                *   S01194
     C*            BRCA    -  BRANCH CODE FOR DEAL                    *   S01194
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBA      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSB1****CHAINDLMSB1L              70                   S01117
     C           @KMSB1    CHAINDLMSY1L              70                   S01117
     C*
     C** IF A RECORD IS FOUND
     C*
     C           *IN70     IFNE '1'                        B1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET POSITION
     C** FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KDNP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KDNP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KDNP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KDNP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KDNPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     SUB  UPAMT     KDNP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     SUB  UPAMT     KDNP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     SUB  UPAMT     KDNP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     SUB  UPAMT     KDNP12           ******6
     C                     ELSE                            X*****6
     C                     SUB  UPAMT     KDNPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Increment the number of deals making up this summary record
     C                     ADD  1         KDNDLR           *1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSB1P0                   *1             S01117
     C                     UPDATDLMSY1P0                   *1             S01117
     C*
     C** ELSE THE RECORD IS NOT FOUND
     C*
     C                     ELSE                            X1
     C*
     C** SET UP ALL THE FIELDS ON THE FILE INCLUDING THE NET POSITION
     C** ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C                     MOVE BOKC      KDBOKC           *1
     C                     MOVE UCUCY     KDCCY            *1
     C*********************MOVE @BRSN     KDBRSN           *1             S01194
     C                     MOVE BRCA      KDBRCA           *1             S01194
     C                     MOVE @VDTP     KDVDTP           *1
     C                     MOVE @@CENT    KDCENT           *1             110523
     C*
     C** SET ALL THE NET POSITIONS TO BLANK AND THEN SET THE RELEVANT
     C** ONE TO THE DEAL AMOUNT
     C*
     C                     Z-ADD0         KDNP03           *1
     C                     Z-ADD0         KDNP06           *1
     C                     Z-ADD0         KDNP09           *1
     C                     Z-ADD0         KDNP12           *1
     C                     Z-ADD0         KDNPRR           *1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KDNP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KDNP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KDNP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KDNP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KDNPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** Z-SUB THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-SUBUPAMT     KDNP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-SUBUPAMT     KDNP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-SUBUPAMT     KDNP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-SUBUPAMT     KDNP12           ******6
     C                     ELSE                            X*****6
     C                     Z-SUBUPAMT     KDNPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Initialise the number of deals making up this summary record
     C                     Z-ADD1         KDNDLR            *1
     C*
     C** WRITE THE RECORD TO THE FILE
     C*
     C*********************WRITEDLMSB1P0                   *1             S01117
     C                     WRITEDLMSY1P0                                  S01117
     C*
     C** TO ENSURE MONTHLY SUMMARY RECORDS ARE ALWAYS WRITTEN IN PAIRS
     C** WRITE AN EMPTY RECORD FOR THE OPPOSITE HALF OF THE MONTH
     C** (ADD OR SUBTRACT 1 FROM THE VALUE DATE PERIOD TO CHANGE TO
     C** THE FIRST OR SECOND HALF OF THE MONTH AS APPROPRIATE - PERIOD
     C** FORMAT IS YYMM1/2)
     C*
     C           @VDPDY    IFEQ '1'                        B*2
     C                     ADD  1         KDVDTP           **2
     C                     ELSE                            X*2
     C                     SUB  1         KDVDTP           **2
     C                     END                             E*2
     C*
     C                     Z-ADD0         KDNP03           *1
     C                     Z-ADD0         KDNP06           *1
     C                     Z-ADD0         KDNP09           *1
     C                     Z-ADD0         KDNP12           *1
     C                     Z-ADD0         KDNPRR           *1
     C                     Z-ADD0         KDNDLR            *1
     C*
     C*********************WRITEDLMSB1P0                   *1             S01117
     C                     WRITEDLMSY1P0                                  S01117
     C*
     C                     END                             E1
     C*
     C           #BBA9     ENDSR                           *** #BBA9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BBB*****-*PROCESS DLMSM1L FOR AN INSERTED DEAL               *   S01117
     C* #BBB     - PROCESS DLMSY2L FOR AN INSERTED DEAL               *   S01117
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  #BB     -  PROCESS AN INSERTED DEAL                *
     C*                                                               *
     C**FLDS*USED**@KMSM1**-  KEY TO DLMSM1L                          *   S01117
     C* FLDS USED  @KMSM1  -  KEY TO DLMSY2L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @VDTP   -  VALUE DATE PERIOD CALCULATED FOR DEAL   *
     C*            @VDPDY  -  VALUE DATE PERIOD END NUMBER - 1 OR 2   *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBB      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSM1****CHAINDLMSM1L              71                   S01117
     C           @KMSM1    CHAINDLMSY2L              71                   S01117
     C*
     C** IF A RECORD IS FOUND
     C*
     C           *IN71     IFNE '1'                        B1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET POSITION
     C** FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KENP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KENP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KENP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KENP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KENPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     SUB  UPAMT     KENP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     SUB  UPAMT     KENP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     SUB  UPAMT     KENP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     SUB  UPAMT     KENP12           ******6
     C                     ELSE                            X*****6
     C                     SUB  UPAMT     KENPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Increment the number of deals making up this summary record
     C                     ADD  1         KENDLR           *1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSM1P0                   *1             S01117
     C                     UPDATDLMSY2P0                                  S01117
     C*
     C** ELSE THE RECORD IS NOT FOUND
     C*
     C                     ELSE                            X1
     C*
     C** SET UP ALL THE FIELDS ON THE FILE INCLUDING THE NET POSITION
     C** ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C                     MOVE BOKC      KEBOKC           *1
     C                     MOVE UCUCY     KECCY            *1
     C                     MOVE @@CENT    KECENT           *1             110523
     C                     Z-ADD@VDTP     KEVDTP           *1
     C*
     C** SET ALL THE NET POSITIONS TO BLANK AND THEN SET THE RELEVANT
     C** ONE TO THE DEAL AMOUNT
     C*
     C                     Z-ADD0         KENP03           *1
     C                     Z-ADD0         KENP06           *1
     C                     Z-ADD0         KENP09           *1
     C                     Z-ADD0         KENP12           *1
     C                     Z-ADD0         KENPRR           *1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KENP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KENP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KENP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KENP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KENPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** Z-SUB THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-SUBUPAMT     KENP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-SUBUPAMT     KENP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-SUBUPAMT     KENP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-SUBUPAMT     KENP12           ******6
     C                     ELSE                            X*****6
     C                     Z-SUBUPAMT     KENPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Initialise the number of deals making up this summary record
     C                     Z-ADD1         KENDLR            *1
     C*
     C** WRITE THE RECORD TO THE FILE
     C*
     C*********************WRITEDLMSM1P0                   *1             S01117
     C                     WRITEDLMSY2P0                                  S01117
     C*
     C** TO ENSURE MONTHLY SUMMARY RECORDS ARE ALWAYS WRITTEN IN PAIRS
     C** WRITE AN EMPTY RECORD FOR THE OPPOSITE HALF OF THE MONTH
     C** (ADD OR SUBTRACT 1 FROM THE VALUE DATE PERIOD TO CHANGE TO
     C** THE FIRST OR SECOND HALF OF THE MONTH AS APPROPRIATE - PERIOD
     C** FORMAT IS YYMM1/2)
     C*
     C           @VDPDY    IFEQ '1'                        B*2
     C                     ADD  1         KEVDTP           **2
     C                     ELSE                            X*2
     C                     SUB  1         KEVDTP           **2
     C                     END                             E*2
     C*
     C                     Z-ADD0         KENP03           *1
     C                     Z-ADD0         KENP06           *1
     C                     Z-ADD0         KENP09           *1
     C                     Z-ADD0         KENP12           *1
     C                     Z-ADD0         KENPRR           *1
     C                     Z-ADD0         KENDLR           *1
     C*
     C*********************WRITEDLMSM1P0                   *1             S01117
     C                     WRITEDLMSY2P0                                  S01117
     C*
     C                     END                             E1
     C*
     C           #BBB9     ENDSR                           *** #BBB9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BBC*****- PROCESS DLMSB2L FOR AN INSERTED DEAL               *   S01117
     C* #BBC     - PROCESS DLMST1L FOR AN INSERTED DEAL               *   S01117
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  #BB     -  PROCESS AN INSERTED DEAL                *
     C*                                                               *
     C**FLDS*USED**@KMSB2**-  KEY TO DLMSB2L                          *   S01194
     C* FLDS USED  @KMSB2  -  KEY TO DLMST1L                          *   S01194
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*************@BRSN   -  DRS BRANCH CODE FOR DEAL                *   S01194
     C*            BRCA    -  BRANCH CODE FOR DEAL                    *   S01194
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBC      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSB2****CHAINDLMSB2L              72                   S01117
     C           @KMSB2    CHAINDLMST1L              72                   S01117
     C*
     C** IF A RECORD IS FOUND
     C*
     C           *IN72     IFNE '1'                        B1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KHBP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KHBP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KHBP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KHBP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KHBPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KHSP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KHSP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KHSP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KHSP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KHSPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Increment the number of deals making up this summary record
     C                     ADD  1         KHNDLR           *1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSB2P0                   *1             S01117
     C                     UPDATDLMST1P0                                  S01117
     C*
     C** ELSE THE RECORD IS NOT FOUND
     C*
     C                     ELSE                            X1
     C*
     C** SET UP ALL THE FIELDS ON THE FILE INCLUDING THE BOUGHT OR
     C** SOLD POSITION ACCORDING TO THE MATURITY DATE PERIOD AND THE
     C** BUY/SELL INDICATOR
     C*
     C                     MOVE BOKC      KHBOKC           *1
     C                     MOVE UCUCY     KHCCY            *1
     C*********************MOVE @BRSN     KHBRSN           *1             S01194
     C                     MOVE BRCA      KHBRCA           *1             S01194
     C*
     C** SET ALL THE BOUGHT/SOLD POSITIONS TO BLANK AND THEN SET THE
     C** RELEVANT ONE TO THE DEAL AMOUNT
     C*
     C                     Z-ADD0         KHBP03           *1
     C                     Z-ADD0         KHBP06           *1
     C                     Z-ADD0         KHBP09           *1
     C                     Z-ADD0         KHBP12           *1
     C                     Z-ADD0         KHBPRR           *1
     C                     Z-ADD0         KHSP03           *1
     C                     Z-ADD0         KHSP06           *1
     C                     Z-ADD0         KHSP09           *1
     C                     Z-ADD0         KHSP12           *1
     C                     Z-ADD0         KHSPRR           *1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KHBP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KHBP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KHBP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KHBP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KHBPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KHSP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KHSP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KHSP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KHSP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KHSPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Initialise the number of deals making up this summary record
     C                     Z-ADD1         KHNDLR           *1
     C*
     C** WRITE THE RECORD TO THE FILE
     C*
     C*********************WRITEDLMSB2P0                   *1             S01117
     C                     WRITEDLMST1P0                                  S01117
     C*
     C                     END                             E1
     C*
     C           #BBC9     ENDSR                           *** #BBC9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BBD*****-*PROCESS DLMSM2L FOR AN INSERTED DEAL               *   S01117
     C* #BBD     - PROCESS DLMST2L FOR AN INSERTED DEAL               *   S01117
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  #BB     -  PROCESS AN INSERTED DEAL                *
     C*                                                               *
     C**FLDS*USED**@KMSM2**-  KEY TO DLMSM2L                          *   S01117
     C* FLDS USED  @KMSM2  -  KEY TO DLMST2L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBD      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSM2****CHAINDLMSM2L              73                   S01117
     C           @KMSM2    CHAINDLMST2L              73                   S01117
     C*
     C** IF A RECORD IS FOUND
     C*
     C           *IN73     IFNE '1'                        B1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KFBP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KFBP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KFBP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KFBP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KFBPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     ADD  UPAMT     KFSP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     ADD  UPAMT     KFSP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     ADD  UPAMT     KFSP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     ADD  UPAMT     KFSP12           ******6
     C                     ELSE                            X*****6
     C                     ADD  UPAMT     KFSPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Increment the number of deals making up this summary record
     C                     ADD  1         KFNDLR           *1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSM2P0                   *1             S01117
     C                     UPDATDLMST2P0                                  S01117
     C*
     C** ELSE THE RECORD IS NOT FOUND
     C*
     C                     ELSE                            X1
     C*
     C** SET UP ALL THE FIELDS ON THE FILE INCLUDING THE BOUGHT OR
     C** SOLD POSITION ACCORDING TO THE MATURITY DATE PERIOD AND THE
     C** BUY/SELL INDICATOR
     C*
     C                     MOVE BOKC      KFBOKC           *1
     C                     MOVE UCUCY     KFCCY            *1
     C*
     C** SET ALL THE BOUGHT/SOLD POSITIONS TO BLANK AND THEN SET THE
     C** RELEVANT ONE TO THE DEAL AMOUNT
     C*
     C                     Z-ADD0         KFBP03           *1
     C                     Z-ADD0         KFBP06           *1
     C                     Z-ADD0         KFBP09           *1
     C                     Z-ADD0         KFBP12           *1
     C                     Z-ADD0         KFBPRR           *1
     C                     Z-ADD0         KFSP03           *1
     C                     Z-ADD0         KFSP06           *1
     C                     Z-ADD0         KFSP09           *1
     C                     Z-ADD0         KFSP12           *1
     C                     Z-ADD0         KFSPRR           *1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KFBP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KFBP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KFBP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KFBP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KFBPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X*2
     C*
     C** Z-ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B**3
     C                     Z-ADDUPAMT     KFSP03           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '06'                       B***4
     C                     Z-ADDUPAMT     KFSP06           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '09'                       B****5
     C                     Z-ADDUPAMT     KFSP09           *****5
     C                     ELSE                            X****5
     C           @MDTP     IFEQ '12'                       B*****6
     C                     Z-ADDUPAMT     KFSP12           ******6
     C                     ELSE                            X*****6
     C                     Z-ADDUPAMT     KFSPRR           ******6
     C                     END                             E*****6
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C**  Initialise the number of deals making up this summary record
     C                     Z-ADD1         KFNDLR            *1
     C*
     C** WRITE THE RECORD TO THE FILE
     C*
     C*********************WRITEDLMSM2P0                   *1             S01117
     C                     WRITEDLMST2P0                                  S01117
     C*
     C                     END                             E1
     C*
     C           #BBD9     ENDSR                           *** #BBD9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BCA*****-*PROCESS DLMSB1L FOR A DELETED DEAL                 *   S01117
     C* #BCA     - PROCESS DLMSY1L FOR A DELETED DEAL                 *   S01117
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*                                                               *
     C* CALLED BY  #BC     -  PROCESS A DELETED DEAL                  *
     C*                                                               *
     C**FLDS*USED**@KMSB1**-  KEY TO DLMSB1L                          *   S01117
     C* FLDS USED  @KMSB1  -  KEY TO DLMSY1L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @EMSB1  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @WORK1  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @WORK2  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @VDTP   -  VALUE DATE PERIOD (USED IF DB ERROR)    *
     C*************@BRSN   -  BRANCH CODE (USED IF DB ERROR)          *   S01194
     C*            BRCA    -  BRANCH CODE (USED IF DB ERROR)          *   S01194
     C*            @MTHH   -  OTHER HALF OF MONTH FOR DELETE          *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BCA      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSB1****CHAINDLMSB1L              70                   S01117
     C           @KMSB1    CHAINDLMSY1L              70                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN70     IFEQ '1'                        B1
     C*                                                    *1
     C*********************MOVEL'DLMSB1L 'DBFILE           *1             S01117
     C                     MOVEL'DLMSY1L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1  5        *1
     C                     MOVE UCUCY     @WORK1           *1
     C*********************MOVEL@BRSN     @WORK2  8        *1             S01194
     C                     MOVELBRCA      @WORK2  8        *1             S01194
     C                     MOVE @VDTP     @WORK2           *1
     C                     MOVEL@WORK1    @EMSB1 13        ***************
     C                     MOVE @WORK2    @EMSB1           *             *
     C                     MOVEL@EMSB1    DBKEY            * DBERROR 005 *
     C                     MOVE '005'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      *1
     C                     END                             E1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KDNP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KDNP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KDNP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KDNP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KDNPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X1
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     ADD  UPAMT     KDNP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     ADD  UPAMT     KDNP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     ADD  UPAMT     KDNP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     ADD  UPAMT     KDNP12           *****5
     C                     ELSE                            X****5
     C                     ADD  UPAMT     KDNPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Maintain running total of number of deals making up record
     C                     SUB  1         KDNDLR
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSB1P0                                  S01117
     C                     UPDATDLMSY1P0                                  S01117
     C*
     C**  If there are now no deal records making up this record
     C**  & none for the second half of the month either then records
     C**  are no longer needed
     C           KDNDLR    IFEQ *ZERO                      B1
     C*
     C** Access other half of month
     C                     MOVE @VDPDY    @MTHH   1
     C           @VDPDY    IFEQ '1'                        B*2
     C                     MOVE '2'       @VDPDY           **2
     C                     ELSE                            X*2
     C                     MOVE '1'       @VDPDY           **2
     C                     END                             E*2
     C*
     C***********@KMSB1****CHAINDLMSB1L              70    *1             S01117
     C           @KMSB1    CHAINDLMSY1L              70                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN70     IFEQ '1'                        B*2
     C*                                                    **2
     C*********************MOVEL'DLMSB1L 'DBFILE           **2            S01117
     C                     MOVEL'DLMSY1L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1  5        **2
     C                     MOVE UCUCY     @WORK1           **2
     C*********************MOVEL@BRSN     @WORK2  8        **2            S01194
     C                     MOVELBRCA      @WORK2  8        **2            S01194
     C                     MOVE @VDTP     @WORK2           **2
     C                     MOVEL@WORK1    @EMSB1 13        ***************
     C                     MOVE @WORK2    @EMSB1           *             *
     C                     MOVEL@EMSB1    DBKEY            * DBERROR 009 *
     C                     MOVE '009'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      **2
     C                     END                             E*2
     C*
     C** If no deals make up other half of month then delete records
     C** for first & second halves.
     C           KDNDLR    IFEQ *ZERO                      B*2
     C*********************DELETDLMSB1P0                   **2            S01117
     C                     DELETDLMSY1P0                                  S01117
     C*
     C** Delete other month half
     C                     MOVE @MTHH     @VDPDY           **2
     C*
     C***********@KMSB1****DELETDLMSB1L              70    **2            S01117
     C           @KMSB1    DELETDLMSY1L              70                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN70     IFEQ '1'                        B**3
     C*                                                    ***3
     C*********************MOVEL'DLMSB1L 'DBFILE           ***3           S01117
     C                     MOVEL'DLMSY1L 'DBFILE           ***3           S01117
     C                     MOVELBOKC      @WORK1  5        ***3
     C                     MOVE UCUCY     @WORK1           ***3
     C*********************MOVEL@BRSN     @WORK2  8        ***3           S01194
     C                     MOVELBRCA      @WORK2  8        ***3           S01194
     C                     MOVE @VDTP     @WORK2           ***3
     C                     MOVEL@WORK1    @EMSB1 13        ***************
     C                     MOVE @WORK2    @EMSB1           *             *
     C                     MOVEL@EMSB1    DBKEY            * DBERROR 010 *
     C                     MOVE '010'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      ***3
     C                     END                             E**3
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BCA9     ENDSR                           *** #BCA9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BCB*****-*PROCESS DLMSM1L FOR A DELETED DEAL                 *   S01117
     C* #BCB     - PROCESS DLMSY2L FOR A DELETED DEAL                 *   S01117
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*                                                               *
     C* CALLED BY  #BC     -  PROCESS A DELETED DEAL                  *
     C*                                                               *
     C**FLDS*USED**@KMSM1**-  KEY TO DLMSM1L                          *   S01117
     C* FLDS USED  @KMSM1  -  KEY TO DLMSY2L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @EMSM1  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @WORK1  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @VDTP   -  VALUE DATE PERIOD (USED IF DB ERROR)    *
     C*            @MTHH   -  OTHER HALF OF MONTH FOR DELETE
     C*                                                               *
     C*****************************************************************
     C*
     C           #BCB      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSM1****CHAINDLMSM1L              71                   S01117
     C           @KMSM1    CHAINDLMSY2L              71                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN71     IFEQ '1'                        B1
     C*
     C*********************MOVEL'DLMSM1L 'DBFILE           *1             S01117
     C                     MOVEL'DLMSY2L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1           *1
     C                     MOVE UCUCY     @WORK1           *1
     C                     MOVEL@WORK1    @EMSM1 10        ***************
     C                     MOVE @VDTP     @EMSM1           *             *
     C                     MOVEL@EMSM1    DBKEY            * DBERROR 006 *
     C                     MOVE '006'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      *1
     C                     END                             E1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KENP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KENP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KENP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KENP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KENPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X1
     C*
     C** ADD THE DEAL CONTRACT AMOUNT TO THE APPROPRIATE NET
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     ADD  UPAMT     KENP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     ADD  UPAMT     KENP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     ADD  UPAMT     KENP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     ADD  UPAMT     KENP12           *****5
     C                     ELSE                            X****5
     C                     ADD  UPAMT     KENPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Maintain running total of number of deals making up record
     C                     SUB  1         KENDLR
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSM1P0                                  S01117
     C                     UPDATDLMSY2P0                                  S01117
     C*
     C*
     C**  If there are now no deal records making up this record
     C**  & none for the second half of the month either then records
     C**  are no longer needed
     C           KENDLR    IFEQ *ZERO                      B1
     C*
     C** Access other half of month
     C                     MOVE @VDPDY    @MTHH   1
     C           @VDPDY    IFEQ '1'                        B*2
     C                     MOVE '2'       @VDPDY           **2
     C                     ELSE                            X*2
     C                     MOVE '1'       @VDPDY           **2
     C                     END                             E*2
     C*
     C***********@KMSM1****CHAINDLMSM1L              71    *1             S01117
     C           @KMSM1    CHAINDLMSY2L              71                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN71     IFEQ '1'                        B*2
     C*
     C*********************MOVEL'DLMSM1L 'DBFILE           **2            S01117
     C                     MOVEL'DLMSY2L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1           **2
     C                     MOVE UCUCY     @WORK1           **2
     C                     MOVEL@WORK1    @EMSM1 10        ***************
     C                     MOVE @VDTP     @EMSM1           *             *
     C                     MOVEL@EMSM1    DBKEY            * DBERROR 011 *
     C                     MOVE '011'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      **2
     C                     END                             E*2
     C*
     C** If no deals make up other half of month then delete records
     C** for first & second halves.
     C           KENDLR    IFEQ *ZERO                      B*2
     C*********************DELETDLMSM1P0                   **2            S01117
     C                     DELETDLMSY2P0                                  S01117
     C*
     C** Delete other month half
     C                     MOVE @MTHH     @VDPDY           **2
     C*
     C***********@KMSM1****DELETDLMSM1L              71    **2            S01117
     C           @KMSM1    DELETDLMSY2L              71                   S01117
     C*
     C           *IN71     IFEQ '1'                        B**3
     C*
     C*********************MOVEL'DLMSM1L 'DBFILE           ***3           S01117
     C                     MOVEL'DLMSY2L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1           ***3
     C                     MOVE UCUCY     @WORK1           ***3
     C                     MOVEL@WORK1    @EMSM1 10        ***************
     C                     MOVE @VDTP     @EMSM1           *             *
     C                     MOVEL@EMSM1    DBKEY            * DBERROR 012 *
     C                     MOVE '012'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      ***3
     C                     END                             E**3
     C*
     C*
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BCB9     ENDSR                           *** #BCB9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BCC*****-*PROCESS DLMSB2L FOR A DELETED DEAL                 *   S01117
     C* #BCC     - PROCESS DLMST1L FOR A DELETED DEAL                 *   S01117
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*                                                               *
     C* CALLED BY  #BC     -  PROCESS A DELETED DEAL                  *
     C*                                                               *
     C**FLDS*USED**@KMSB2**-  KEY TO DLMSB2L                          *   S01117
     C* FLDS USED  @KMSB2  -  KEY TO DLMST1L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @EMSB2  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @WORK1  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*            @BRSN   -  BRANCH CODE (USED IF DB ERROR)          *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BCC      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSB2****CHAINDLMSB2L              72                   S01117
     C           @KMSB2    CHAINDLMST1L              72                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN72     IFEQ '1'                        B1
     C*
     C*********************MOVEL'DLMSB2L 'DBFILE           *1             S01117
     C                     MOVEL'DLMST1L 'DBFILE                          S01117
     C                     MOVELBOKC      @WORK1           *1
     C                     MOVE UCUCY     @WORK1           *1
     C                     MOVEL@WORK1    @EMSB2  8        ***************
     C*********************MOVE @BRSN     @EMSB2           *             *S01194
     C                     MOVE BRCA      @EMSB2           *             *S01194
     C                     MOVEL@EMSB2    DBKEY            * DBERROR 007 *
     C                     MOVE '007'     DBASE            *             *
     C*                                                    ***************
     C                     EXSR *PSSR                      *1
     C                     END                             E1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KHBP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KHBP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KHBP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KHBP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KHBPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KHSP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KHSP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KHSP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KHSP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KHSPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Maintain running total of number of deals making up record
     C                     SUB  1         KHNDLR
     C*
     C*
     C**  If there are now no deal records making up this record
     C**  then it is no longer needed so delete record
     C*
     C           KHNDLR    IFEQ *ZERO                      B1
     C*********************DELETDLMSB2P0                   *1             S01117
     C                     DELETDLMST1P0                                  S01117
     C*
     C                     ELSE                            X1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSB2P0                   *1             S01117
     C                     UPDATDLMST1P0                                  S01117
     C                     END                             E1
     C*
     C           #BCC9     ENDSR                           *** #BCC9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#BCD*****-*PROCESS DLMSM2L FOR A DELETED DEAL                 *   S01117
     C* #BCD     - PROCESS DLMST2L FOR A DELETED DEAL                 *   S01117
     C*                                                               *
     C* CALLS      *PSSR   -  DATABASE ERROR HANDLING                 *
     C*                                                               *
     C* CALLED BY  #BC     -  PROCESS A DELETED DEAL                  *
     C*                                                               *
     C**FLDS*USED**@KMSM2**-  KEY TO DLMSM2L                          *   S01117
     C* FLDS USED  @KMSM2  -  KEY TO DLMST2L                          *   S01117
     C*            @MDTP   -  MATURITY DATE PERIOD CALCULATED FOR DEAL*
     C*            @EMSM2  -  USED TO SET UP LDA IF DB ERROR ON FILE  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BCD      BEGSR
     C*
     C** ACCESS THE FILE WITH THE KEY AS SET UP IN #B
     C*
     C***********@KMSM2****CHAINDLMSM2L              73                   S01117
     C           @KMSM2    CHAINDLMST2L              73                   S01117
     C*
     C** IF A RECORD IS NOT FOUND
     C*
     C           *IN73     IFEQ '1'                        B1
     C*
     C*********************MOVEL'DLMSM2L 'DBFILE           ***************S01117
     C                     MOVEL'DLMST2L 'DBFILE           ***************S01117
     C                     MOVELBOKC      @EMSM2  5        *             *
     C                     MOVE UCUCY     @EMSM2           * DBERROR 008 *
     C                     MOVEL@EMSM2    DBKEY            *             *
     C                     MOVE '008'     DBASE            ***************
     C*
     C                     EXSR *PSSR                      *1
     C                     END                             E1
     C*
     C** IF THE BUY/SELL INDICATOR FOR THE DEAL IS 'B'
     C*
     C           BYSL      IFEQ 'B'                        B1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE BOUGHT
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KFBP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KFBP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KFBP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KFBP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KFBPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** ELSE THE BUY/SELL INDICATOR FOR THE DEAL IS 'S'
     C*
     C                     ELSE                            X1
     C*
     C** SUBTRACT THE DEAL CONTRACT AMOUNT FROM THE APPROPRIATE SOLD
     C** POSITION FIELD ACCORDING TO THE MATURITY DATE PERIOD
     C*
     C           @MDTP     IFEQ '03'                       B*2
     C                     SUB  UPAMT     KFSP03           **2
     C                     ELSE                            X*2
     C           @MDTP     IFEQ '06'                       B**3
     C                     SUB  UPAMT     KFSP06           ***3
     C                     ELSE                            X**3
     C           @MDTP     IFEQ '09'                       B***4
     C                     SUB  UPAMT     KFSP09           ****4
     C                     ELSE                            X***4
     C           @MDTP     IFEQ '12'                       B****5
     C                     SUB  UPAMT     KFSP12           *****5
     C                     ELSE                            X****5
     C                     SUB  UPAMT     KFSPRR           *****5
     C                     END                             E****5
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Maintain running total of number of deals making up record
     C                     SUB  1         KFNDLR
     C*
     C**  If there are now no deal records making up this record
     C**  then it is no longer needed so delete record
     C*
     C           KFNDLR    IFEQ *ZERO                      B1
     C*********************DELETDLMSM2P0                   *1             S01117
     C                     DELETDLMST2P0                                  S01117
     C*
     C                     ELSE                            X1
     C*
     C** UPDATE THE RECORD ON THE FILE
     C*
     C*********************UPDATDLMSM2P0                   *1             S01117
     C                     UPDATDLMST2P0                                  S01117
     C                     END                             E1
     C*
     C           #BCD9     ENDSR                           *** #BCD9 ***
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - DATABASE ERROR SUBROUTINE                          *
     C*                                                               *
     C* CALLS    -                                                    *
     C*                                                               *
     C* CALLED IF ANY PROGRAM OR FILE ERRORS                          *
     C*                                                               *
     C* FLDS USED  @BEEN    -  ALREADY BEEN THROUGH *PSSR INDICATOR   *
     C*            @LDA     -  VARIABLE TO SET UP LDA WITH DB ERRORS  *
     C*            DBERR    -  DS TO HOLD DB ERROR                    *
     C*            @TERM    -  TERMINATION PARAMETER RETURNED         *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** IF NOT BEEN ALREADY BEEN THROUGH *PSSR THEN PROCESS ERROR
     C** ELSE JUST RETURN
     C*
     C           @BEEN     IFNE 'Y'                        B1
     C*
     C** SET ALREADY-BEEN-THROUGH-*PSSR INDICATOR TO YES
     C*
     C                     MOVE 'Y'       @BEEN   1        *1
     C*
     C** SET UP TERMINATION PARAMETER, TURN ON ERROR SWITCHES,
     C** SET ON LR AND DUMP
     C*
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     MOVE '1'       *INLR            *1
     C                     DUMP                            *1
     C*
     C** MOVE DATABASE ERROR DETAILS INTO LDA
     C*
     C           *NAMVAR   DEFN LDA       @LDA  256        *1
     C           *LOCK     IN   @LDA                       *1
     C                     MOVELDBERR     @LDA             *1
     C                     OUT  @LDA                       *1
     C*
     C                     END                             E1
     C*
     C                     RETRN
     C*
     C           PSSR9     ENDSR                           *** *PSSR9 ***
     C*
**  CPY@  **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
