     H        1   D
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL IRS summary file rebuild')
     F*****************************************************************
     F*                                                               *
     F*  Midas  -  FRA/IRS Module
     F*                                                               *
     F*  DL1910  -  IRS SUMMARY FILE REBUILD                          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD060920           Date 09Feb23               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 047163             Date 10Jan94               *
     F*                 S01117             DATE 05MAR90               *
     F*                 S01194             DATE 02MAR90               *
     F*                 S01157             DATE 0000000               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD060920 - FRA/IRS: incorrect reflection of interest in      *
      *             assets and liabilities for CAPS/Coll/Floor.       *
      *           - Condition the floor/ceiling rate when calculating *
      *             the accrued interest. Also, system should display *
      *             the correct side (OUR/THEIR) of deal's interest   *
      *             details.                                          *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
     F*  CSD006 - Use long DS with SDBSRTPD.                          *
     F*  047163 - Summary shows the deal's NRCD and not VDAT when     *
     F*           the deal is forward-valued.  Set NRCD to VDAT if    *
     F*           VDAT is today or later.                             *
     F*  S01117 - MULTIBRANCHING CHANGES                              *
     F*  S01194 - NEW STANDING DATA CHANGES                           *
     F*  S01157 - NEW PROGRAM FOR FRA/IRS ENHANCEMENTS                *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                                  *
     F********************************************************************
     F/SPACE 3
     F*ABTB10*IF**E*****               DISK         KINFSR *PSSR          S01194
     FFDMNTHLLIF  E           K        DISK         KINFSR *PSSR
     F*DBRNCLLIF**E*****      K        DISK         KINFSR *PSSR          S01194
     F*DBSRTLLIF**E*****      K        DISK         KINFSR *PSSR          S01194
     F*DCCYTLLIF**E*****      K        DISK         KINFSR *PSSR          S01194
     FDLDLDGLDIP  E           K        DISK
     FDLIRSSPPO   E                    DISK
     F/SPACE 3
      *
      ** ID F  C  H  L    FUNCTION OF INDICATORS
      *  ***************************************
      *
      *       20          1st cycle indicator.
      *       50          Average Price bit on
      ********85**********CHAIN failure on PF/TABTB10.                    S01194
      ********86**********CHAIN failure on LF/FDCCYLL.                    S01194
      ********87**********CHAIN failure on LF/FDBSRTLL.                   S01194
      ********88**********CHAIN failure on LF/FDBRNCLL.                   S01194
      *       89          READ failure on LF/FDMNTHLL.
      *
      ********************************************************************
      *
     E                    CPY@    1   1 80               COPYRIGHT.
      *
      /COPY ZSRSRC,ZAMTEZ1
      /SPACE 5
      *
      /COPY ZSRSRC,ZRATE1Z1
      /SPACE 5
      *
      /COPY ZSRSRC,ZDATE8Z1
      *
      ********************************************************************
      /EJECT
      *
      /COPY ZSRSRC,ZDATE8Z2
      /SPACE 5
      *
      /COPY ZSRSRC,ZAMTEZ2
      /EJECT
      *
      ***Key*to*chain*to*base*rate*file**FDBSRTLL***                      S01194
     I*KBSRT******DS                                                      S01194
     I**********                              1   2 @K21                  S01194
     I**********                              3   7 @BLK5                 S01194
     I**********                              8  10 @KCCY                 S01194
     I**********                             11  12 @KBRC                 S01194
      **********                                                          S01194
      ***Key*to*chain*to*branch*codes*file**FDBRNCLL***                   S01194
     I*KBRNC******DS                                                      S01194
     I**********                              1   2 @K10                  S01194
     I**********                              3   9 @BLK7                 S01194
     I**********                             10  120BRCD                  S01194
      **********                                                          S01194
      ***Key*to*chain*to*currency*file*for*currency*d*p*s**FDCCYTLL       S01194
     I*KCDP*******DS                                                      S01194
     I**********                              1   2 @K20                  S01194
     I**********                              3   8 @BLK6                 S01194
     I**********                              9  11 @@CCY                 S01194
     I**********                             12  12 @SREC                 S01194
      *
      ** Data structure to move blanks into 'other detail' fields
     I@STBLK      DS
     I                                        1   3 KGXOCD
     I                                        4  13 KGXOAD
     I                                       14  21 KGXOP1
     I                                       22  29 KGXOP2
     I                                       30  37 KGXOR1
     I                                       38  45 KGXOR2
      *
      ** Data structure to enable left-alignment of rate field
     I@ALGN       DS
     I                                        1  13 @@OUTR
     I                                        1   1 @FST1
     I                                        2  11 @NXT10
     I                                        1   2 @FST2
     I                                        3  11 @NXT9
     I                                        1   3 @FST3
     I                                        4  11 @NXT8
     I                                        1   4 @FST4
     I                                        5  11 @NXT7
      *
      ** Need a dummy data structure for IRS key so that we can
      ** manipulate the key if a database error occurs
     I@DIRS       DS
     I                                        1   60@DDLNO
     I                                        7   9 @DCCY
      *
0392 ISDCURR    E DSSDCURRPD                                              S01194
0393 I* Currency details accessed via access program                      S01194
0393 I*                                                                   S01194
0392 ISDBSRT    E DSSDBSRTPD                                              S01194
0393 I* Base Rate code details accessed via access program                S01194
     I*                                                                   S01194
0392 ISDBANK    E DSSDBANKPD                                              S01194
0393 I* Bank details accessed via access program                          S01194
0393 I*                                                                   S01194
     I* Dummy data structures used by access programs                     S01194
     I* (DSSDY only used if file records over 150 chars. long)            S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
      ** Data structure for database error handling
     IDBERR       DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I**********                            181 183 DBASE                 S01194
     I                                      181 1830DBASE                 S01194
      *
     C                     MOVEACPY@      BIS@   80
     C*
      ********************************************************************
      /TITLE  *******     MAINLINE PROCESSING.   *******
      *****************************************************************
      *                                                               *
      *            Mainline Proccessing.                              *
      *                                                               *
      * CALLS:     #A     - Programme initialisation sub-routine.     *
      *            #B     - Find the earliest next rate change date.  *
      *            #C     - Write Single Currency Swap detail record. *
      *            #D     - Write Cap,Collar or Floor detail record.  *
      *            #E     - Write 1st Cross Currency Swap details.    *
      *            #F     - Write 2nd Cross Currency Swap details.    *
      *                                                               *
      * FLDS USED: None                                               *
      *                                                               *
      *****************************************************************
      *
      * Perform initialisation sub-routine on 1st cycle only.
     C           *IN20     IFEQ '0'                        B1
     C                     EXSR #A                          1
     C                     END                             E1
      *
      ** If the deal type is an interest rate swap.
     C           DTYP      IFEQ 'RS'                       B1
      *
      **    Perform process #B to find the earliest next rate change date.
     C                     EXSR #B                          1
      *
      **    Perform write #C Summary file details single currency IRS.
     C                     EXSR #C                          1
      *
      ** End of if the deal type is an interest rate swap.
     C                     END                             E1
      *
      ** If the deal type is a cap, collar or floor.
     C           DTYP      IFEQ 'RP'                       B1
     C           DTYP      OREQ 'RR'                        1
     C           DTYP      OREQ 'RF'                        1
      *
      **    Perform process #B to find the earliest next rate change date.
     C                     EXSR #B                          1
      *
      **    Perform write #D Summary file details Caps,Collars & Floors.
     C                     EXSR #D                          1
      *
      ** End of if the deal type is a cap, collar or floor.
     C                     END                             E1
      *
      ** If the deal type is cross-currency
     C           DTYP      IFEQ 'RX'                       B1
      *
      **    Perform process #B to find the earliest next rate change date.
     C                     EXSR #B                          1
      *
      **    Perform write #E Summary file details cross-ccy 1st record.
     C                     EXSR #E                          1
      *
      **    Perform write #F Summary file details cross-ccy 2nd record.
     C                     EXSR #F                          1
      *
      ** End of if the deal type is cross-currency.
     C                     END                             E1
      *
      ********************************************************************
      /TITLE #B    - FIND THE EARLIEST NEXT CHANGE DATE.
      *****************************************************************
      *                                                               *
      * #B         Find earliest next rate change date.               *
      *                                                               *
      * CALLS:     ZDATE8 - Conversion to Date for display format.    *
      *                                                               *
      * CALLED BY: MAINLINE code                                      *
      *                                                               *
      * FLDS USED: None                                               *
      *                                                               *
      *****************************************************************
      *
     C           #B        BEGSR
     C*                                                                   047163
     C** If value date is today or later, set KGERTC to value date        047163
     C*                                                                   047163
     C           VDAT      IFGE BJRDNB                                    047163
     C                     MOVE VDAT      KGERTC                          047163
     C                     ELSE                                           047163
      *
      ** If our next rate change date = 0.
     C           UNICD     IFEQ 0                          B1
      *
      **    Make their next rate change date the earliest NRCD.
     C                     MOVE TNICD     KGERTC            1
      *
      ** Else (our next rate change date is not 0).
     C                     ELSE                            X1
      *
      **    If their next rate change date = 0.
     C           TNICD     IFEQ 0                          B*2
      *
      **       Make our next rate change date the earliest NRCD.
     C                     MOVE UNICD     KGERTC            *2
      *
      **    Else (their next rate change date is not 0).
     C                     ELSE                            X*2
      *
      **       If their next rate change date < our next rate change date.
     C           TNICD     IFLE UNICD                      B**3
      *
      **          Make their next rate change date the earliest NRCD.
     C                     MOVE TNICD     KGERTC
      *
      **       Else (their next rate change date is not < our NRCD).
     C                     ELSE                            X**3
      *
      **          Make our next rate change date the earliest NRCD.
     C                     MOVE UNICD     KGERTC
      *
      **       End of if their next rate change date < our NRCD.
     C                     END                             E**3
      *
      **    End of if their next rate change date = 0.
     C                     END                             E*2
      *
      ** End of if our next rate change date = 0.
     C                     END                             E1
     C                     END                                            047163
      *
      ** If the earliest next rate change date = 0.
     C           KGERTC    IFEQ 0                          B1
      *
      **    Make the next rate change date display field blank.
     C                     MOVE *BLANKS   KGERDD
      *
      ** Else (the earliest next rate change date is not 0.)
     C                     ELSE                            X1
      *
      **    Convert the earliest next rate change date for display (ZDATE8).
     C                     Z-ADDKGERTC    ZDAYNO            1
     C                     EXSR ZDATE8                      1
     C                     MOVE ZADATE    KGERDD            1
      *
      ** End of if the earliest next rate change date = 0.
     C                     END                             E1
      *
     C           #B9       ENDSR                           ***  #B9  ***
      *
      ********************************************************************
      /EJECT
      ********************************************************************
      *
      ** STANDARD SUBROUTINE SOURCES COPIED IN FROM AN EXTERNAL SOURCE.
      *
      /TITLE STANDARD SUB-ROUTINE ZDATE8Z3
      /COPY ZSRSRC,ZDATE8Z3
      /TITLE STANDARD SUB-ROUTINE ZAMTEZ3
      /COPY ZSRSRC,ZAMTEZ3
      /TITLE STANDARD SUB-ROUTINE ZRATE1Z2
      /COPY ZSRSRC,ZRATE1Z2
      *
      ********************************************************************
      /TITLE #C    - SINGLE CURRENCY IRS.
      *****************************************************************
      *                                                               *
      * #C         Summary file details - Single currency IRS.        *
      *                                                               *
      * CALLS:     ZDATE8 - Conversion to Date for display format.    *
      *            ZAMTE  - Conversion to Amount to display format.   *
      *            ZRATE1 - Conversion to Rate for Display format.    *
      *            #CA    - Left-aligns rate field output by ZRATE1   *
      *            @LJUST - Rate field left-justified for display     *
      *            *PSSR  - Database error handling sub-routine       *
      *                                                               *
      * CALLED BY: MAINLINE code                                      *
      *                                                               *
      * FLDS USED: @@IAMT - Standard sub-routine input amount field   *
      *            @@CCY  - Standard sub-routine currency field       *
      *************@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
      *            @@CDP  - Standard sub-routine ccy dp's. field      *
      *            @@AMNT - Standard sub-routine edited amount field  *
      *            @@INPR - Standard sub-routine input rate field     *
      *            @LJUST - Rate field left-justified for display     *
      *************@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
      *************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
      *************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
      *                                                               *
      *****************************************************************
      *
     C           #C        BEGSR
      *
      ** Set up the Deal No. & make the Currency Code equal to Our Currency.
     C                     MOVE DLNO      KGDLNO
     C                     MOVE UCUCY     KGCCY
      *
      ** Convert the Maturity Date to display format.
     C                     Z-ADDMDAT      KGMDAT
     C                     Z-ADDKGMDAT    ZDAYNO
     C                     EXSR ZDATE8
     C                     MOVE ZADATE    KGMTDD
      *
      ** Set up Deal Type display as 'IRS   '.
     C                     MOVE 'IRS   '  KGDTPD
      *
      ** Convert Our Prinipal Amount to the Amount To Display format.
     C                     Z-ADDUPAMT     @@IAMT
     C**********           MOVE UCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             86                   S01194
      **********                                                          S01194
     C********** *IN86     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '001'     DBASE            *     01      *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Call access program to get Our Currency Decimal Places            S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM UCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     DBKEY            *   DBERROR   *S01194
     C                     MOVEL@OPTN     DBOPTN           *     01      *S01194
     C                     MOVEL'001'     DBASE            ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGAMOD
      *
      ** Set up Our Pay Display1 equal to Our Effective Rate (or blank if=0)
      ** and convert rate to display format.
     C           UEINR     IFGT 0                          B1
     C                     Z-ADDUEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGOPD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD1            1
     C                     END                             E1
      *
      ** Set up Our Pay Display2 equal to our DRS Base Rate Code
      ** (will be blank if not floating).
     C********** UBRTT     IFGT 0                          B1                                 CSD103
     C           UBRTT     IFNE *BLANKS                    B1                                 CSD103
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '002'     DBASE            *      02     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT  2                       S01194
      *                                                                   S01194
      * Call Access Program to get Our Base Rate shortname                S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     WDBKEY  5        *   DBERROR   *S01194
     C                     MOVE @UBRTT    WDBKEY           *     02      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'002'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD2            1             S01194
     C                     MOVELBABSRS    KGOPD2            1             S01194
      *
      ** If Our Spread Indicator is 'A' or 'P' put '+S' onto the end of
      ** Base Rate Code (if no spread indicator - leave blank).
     C           USPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGOPD2            *2
     C                     END                             E*2
      *
     C           USPIN     IFEQ 'A'                        B*2
     C           USPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD2            *2
     C                     END                             E*2
      *
      ** If Our Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           USPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGOPD2
     C                     END                             E*2
      *
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD2            1
     C                     END                             E1
      *
      ** Set up Our Receive Display1 equal to Their Effective Rate
      ** and convert rate to display format.
     C           TEINR     IFGT 0                          B1
     C                     Z-ADDTEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGORD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGORD1            1
     C                     END                             E1
      *
      ** Set up Our Pay Display2 equal to their DRS Base Rate Code
      ** (will be blank if not floating).
     C********** TBRTT     IFGT 0                          B1                                 CSD103
     C           TBRTT     IFNE *BLANKS                    B1                                 CSD103
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '003'     DBASE            *      03     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                     1             S01194
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT  2                       S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELTCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @TBRTT    WDBKEY           *     03      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'003'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD2            1             S01194
     C                     MOVELBABSRS    KGORD2            1             S01194
      *
      ** If their spread indicator is 'A' or 'P' put '+S' onto the end of
      ** base rate code (if no spread indicator - leave blank).
     C           TSPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGORD2            *2
     C                     END                             E*2
      *
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGORD2            *2
     C                     END                             E*2
      *
      ** If Their Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           TSPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGORD2
     C                     END                             E*2
      *
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGORD2            1
     C                     END                             E1
      *
      ** Set up Book Code
     C                     MOVE BOKC      KGBPBK
      *
      ** Set up Branch Code
      ***(Key*for*branch*codes*file*already*set*up*in*data*structure*)**
     C********** @KBRNC    CHAINTABLETRF             88
      **********
     C********** *IN88     IFEQ '1'                        B1
     C********** RECI      ORNE 'D'                         1
     C**********           MOVE 'FDBRNCLL'DBFILE           ***************
     C**********           MOVEL@KBRNC    DBKEY            *   DBERROR   *
     C**********           MOVE '004'     DBASE            *      04     *
     C**********           EXSR *PSSR                      ***************
     C**********           END                             E1
      *
      * No chain needed since branch read in directly from file           S01117
      *                                                                   S01117
     C**********           MOVE BRSN      KGBRSN                          S01117
     C                     MOVE BRCA      KGBRCA                          S01117
      *
      ** Blank out Cross Currency fields - Other CCY display,Other Amount
      ** display,Other Pay Display1, Other Pay Display2,Other Receive
      ** Display1,Other Receive Display2.
     C                     MOVE *BLANKS   @STBLK
      *
     C           #C9       ENDSR                           ***  #C9  ***
      *
      ********************************************************************
      /TITLE #D    - CAPS,COLLARS & FLOORS.
      *****************************************************************
      *                                                               *
      * #D         Summary file details - Caps,Collars & Floors.      *
      *                                                               *
      * CALLS:     ZDATE8 - Conversion to Date for display format.    *
      *            ZAMTE  - Conversion to Amount to display format.   *
      *            ZRATE1 - Conversion to Rate for Display format.    *
      *            #CA    - Left-aligns rate field output by ZRATE1   *
      *            @LJUST - Rate field left-justified for display     *
      *            *PSSR  - Database error handling sub-routine       *
      *                                                               *
      * CALLED BY: MAINLINE code                                      *
      *                                                               *
      * FLDS USED: @FISIX - Field for 5th &6th character of KGDTPD    *
      *            @@IAMT - Standard sub-routine input amount field   *
      *            @@CCY  - Standard sub-routine currency field       *
      *************@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
      *            @@CDP  - Standard sub-routine ccy dp's. field      *
      *            @@AMNT - Standard sub-routine edited amount field  *
      *            @@INPR - Standard sub-routine input rate field     *
      *            @LJUST - Rate field left-justified for display     *
      *************@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
      *************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
      *************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
      *            @TEMP1 - Field to hold value temporarily           *
      *            @TEMP2 - Field to hold value temporarily           *
      *            @TEMP3 - Field to hold value temporarily           *
      *                                                               *
      *****************************************************************
      *
     C           #D        BEGSR
      *
      ** Set up the Deal No. & make the Currency Code equal to Our Currency.
     C                     MOVE DLNO      KGDLNO
     C                     MOVE UCUCY     KGCCY
      *
      ** Convert the Maturity Date to display format.
     C                     Z-ADDMDAT      KGMDAT
     C                     Z-ADDKGMDAT    ZDAYNO
     C                     EXSR ZDATE8
     C                     MOVE ZADATE    KGMTDD
      *
      ** Set up Deal Type display such that :-
      **    1. 1st 4 characters are :-
      **       'CLR-' collar(RR), 'CAP-' cap(RA) or 'FLR-' floor(RF).
      **    2. 5th character - Buy Or Sell Indicator  (B or S)
      **    3. 6th character - Blank or 'A' if Ave. Rate Indicator is 'Y'.
     C           DTYP      IFEQ 'RR'                       B1
     C                     MOVEL'CLR-'    KGDTPD            1
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RP'                       B1
     C                     MOVEL'CAP-'    KGDTPD            1
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RF'                       B1
     C                     MOVEL'FLR-'    KGDTPD            1
     C                     END                             E1
      *
     C*
     C** If Average Rate Method indicator on set up display
     C*
     C                     TESTB'3'       UDSTI          50
     C           *IN50     IFEQ '1'                        B1
     C                     MOVE 'A'       @FISIX  2         1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   @FISIX            1
     C                     END                             E1
      *
     C                     MOVELBYSL      @FISIX
     C                     MOVE @FISIX    KGDTPD
      *
      ** Convert Our Prinipal Amount to the Amount To Display format.
     C                     Z-ADDUPAMT     @@IAMT
     C**********           MOVE UCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             86                   S01194
      **********                                                          S01194
     C********** *IN86     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '005'     DBASE            *     05      *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Call access program to get Our Currency Decimal Places            S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM UCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     DBKEY            *   DBERROR   *S01194
     C                     MOVEL@OPTN     DBOPTN           *     05      *S01194
     C                     MOVEL'005'     DBASE            ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGAMOD
      *
      ** Set up Our Pay Display1 equal to OUR DRS Base Rate Code if C  AP
      ** or COLLAR sold. If COLLAR bought or FLOOR sold set up as THEIR DRS
      ** Base Rate Code (will be blank for CAP or FLOOR bought).
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'S'                         1
     C           DTYP      OREQ 'RR'                        1
     C           BYSL      ANDEQ'S'                         1
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '006'     DBASE            *      06     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                     1             S01194
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT                          S01194
      * Call Access Program to get Our Base Rate shortname                S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @UBRTT    WDBKEY           *     06      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'006'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD1            1             S01194
     C                     MOVELBABSRS    KGOPD1            1             S01194
      *
      ** If Our Spread Indicator is 'A' or 'P' put '+S' onto the end of
      ** Base Rate Code (if no spread indicator - leave blank).
     C           USPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGOPD1            *2
     C                     END                             E*2
      *
     C           USPIN     IFEQ 'A'                        B*2
     C           USPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD1            *2
     C                     END                             E*2
      *
      ** If Our Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           USPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGOPD1
     C                     END                             E*2
      *
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RR'                       B1
     C           BYSL      ANDEQ'B'                         1
     C           DTYP      OREQ 'RF'                        1
     C********** BYSL      ANDEQ'S'                         1                               MD060920
     C           BYSL      ANDEQ'B'                         1                               MD060920
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '007'     DBASE            *      07     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                     1             S01194
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT                          S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELTCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @TBRTT    WDBKEY           *     07      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'007'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD1            1             S01194
     C                     MOVELBABSRS    KGOPD1            1             S01194
      *
      ** If THEIR Spread Indicator is 'A' or 'P' put '+S' onto THE
      ** END OF  Base Rate Code (if no spread indicator - leave blank).
     C           TSPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGOPD1            *2
     C                     END                             E*2
      *
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD1            *2
     C                     END                             E*2
      *
      ** If Our Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           TSPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGOPD1
     C                     END                             E*2
      *
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'B'                         1
     C           DTYP      OREQ 'RF'                        1
     C           BYSL      ANDEQ'B'                         1
      *                                                     1
     C                     MOVE *BLANKS   KGOPD1            1
     C                     MOVE *BLANKS   KGOPD2            1
     C                     END                             E1
      *
      ** Set up Our Pay Display2 equal to Ceiling rate if CAP or COLLAR sold
      ** Set up equal to Floor rate if COLLAR bought or FLOOR sold.(Leave
      ** blank for a CAP or FLOOR bought)and convert the rate to display fmt
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'S'                         1
     C           DTYP      OREQ 'RR'                        1
     C           BYSL      ANDEQ'S'                         1
      *                                                     1
     C                     Z-ADDCLRAT     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGOPD2            1
      *                                                     1
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RR'                       B1
     C           BYSL      ANDEQ'B'                         1
     C           DTYP      OREQ 'RF'                        1
     C********** BYSL      ANDEQ'S'                         1                               MD060920
     C           BYSL      ANDEQ'B'                         1                               MD060920
      *                                                     1
     C                     Z-ADDFLRAT     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGOPD2            1
     C                     END                             E1
      *
      ** Set up Our Receive Display1 equal to our DRS Base Rate Code if
      ** COLLAR sold or FLOOR bought. If CAP or COLLAR bought set up
      ** as their DRS Base Rate Code (will be blank for CAP or FLOOR sold).
     C           DTYP      IFEQ 'RR'                       B1
     C           BYSL      ANDEQ'S'                         1
     C           DTYP      OREQ 'RF'                        1
     C********** BYSL      ANDEQ'B'                         1                               MD060920
     C           BYSL      ANDEQ'S'                         1                               MD060920
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '008'     DBASE            *      08     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                     1             S01194
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT                          S01194
      * Call Access Program to get Our Base Rate shortname                S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @UBRTT    WDBKEY           *     08      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'008'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD1            1             S01194
     C                     MOVELBABSRS    KGORD1            1             S01194
      *
      ** If their spread indicator is 'A' or 'P' put '+S' onto the end of
      ** base rate code (if no spread indicator - leave blank).
     C           TSPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGORD1            *2
     C                     END                             E*2
      *
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGORD1            *2
     C                     END                             E*2
      *
      ** If Their Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           TSPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGORD1
     C                     END                             E*2
      *
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'B'                         1
     C           DTYP      OREQ 'RR'                        1
     C           BYSL      ANDEQ'B'                         1
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '009'     DBASE            *      09     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                     1             S01194
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT                          S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELTCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @TBRTT    WDBKEY           *     09      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'009'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD1            1             S01194
     C                     MOVELBABSRS    KGORD1            1             S01194
      *
      ** If their spread indicator is 'A' or 'P' put '+S' onto the end of
      ** base rate code (if no spread indicator - leave blank).
     C           TSPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGORD1            *2
     C                     END                             E*2
      *
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGORD1            *2
     C                     END                             E*2
      *
      ** If Their Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           TSPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGORD1
     C                     END                             E*2
      *
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'S'                         1
     C           DTYP      OREQ 'RF'                        1
     C           BYSL      ANDEQ'S'                         1
      *                                                     1
     C                     MOVE *BLANKS   KGORD1            1
     C                     MOVE *BLANKS   KGORD2            1
     C                     END                             E1
      *
      ** Set up Our Receive Display2 equal to Ceiling rate if CAP or COLLAR
      ** bought. Set up equal to Floor rate if COLLAR sold or FLOOR bought.
      ** (Leave blank for a CAP or FLOOR sold) and convert the rate to
      ** display format.
     C           DTYP      IFEQ 'RP'                       B1
     C           BYSL      ANDEQ'B'                         1
     C           DTYP      OREQ 'RR'                        1
     C           BYSL      ANDEQ'B'                         1
      *                                                     1
     C                     Z-ADDCLRAT     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGORD2            1
      *                                                     1
     C                     END                             E1
      *
     C           DTYP      IFEQ 'RR'                       B1
     C           BYSL      ANDEQ'S'                         1
     C           DTYP      OREQ 'RF'                        1
     C********** BYSL      ANDEQ'B'                         1                               MD060920
     C           BYSL      ANDEQ'S'                         1                               MD060920
      *                                                     1
     C                     Z-ADDFLRAT     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGORD2            1
     C                     END                             E1
      *
      ** Set up Book Code
     C                     MOVE BOKC      KGBPBK
      *
      ** Set up Branch Code
      ***(Key*for*branch*codes*file*already*set*up*in*data*structure*)***
     C********** @KBRNC    CHAINTABLETRF             88
      **********
     C********** *IN88     IFEQ '1'                        B1
     C********** RECI      ORNE 'D'                         1
     C**********           MOVE 'FDBRNCLL'DBFILE           ***************
     C**********           MOVEL@KBRNC    DBKEY            *   DBERROR   *
     C**********           MOVE '010'     DBASE            *      10     *
     C**********           EXSR *PSSR                      ***************
     C**********           END                             E1
      *
      * No chain needed since branch read in directly from file           S01117
      *                                                                   S01117
     C**********           MOVE BRSN      KGBRSN                          S01117
     C                     MOVE BRCA      KGBRCA                          S01117
      *
      ** Blank out Cross Currency fields - Other CCY display,Other Amount
      ** display,Other Pay Display1, Other Pay Display2,Other Receive
      ** Display1,Other Receive Display2.
     C                     MOVE *BLANKS   @STBLK
      *
     C           #D9       ENDSR                           ***  #D9  ***
      *
      ********************************************************************
      /TITLE #E    - CROSS CURRENCY IRS, 1ST RECORD.
      *****************************************************************
      *                                                               *
      * #E     Summary file details - Cross Currency Swap, 1st record.*
      *                                                               *
      * CALLS:     ZDATE8 - Conversion to Date for display format.    *
      *            ZAMTE  - Conversion to Amount to display format.   *
      *            ZRATE1 - Conversion to Rate for Display format.    *
      *            #CA    - Left-aligns rate field output by ZRATE1   *
      *            @LJUST - Rate field left-justified for display     *
      *            *PSSR  - Database error handling sub-routine       *
      *                                                               *
      * CALLED BY: MAINLINE code                                      *
      *                                                               *
      * FLDS USED: @@IAMT - Standard sub-routine input amount field   *
      *            @@CCY  - Standard sub-routine currency field       *
      *************@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
      *            @@CDP  - Standard sub-routine ccy dp's. field      *
      *            @@AMNT - Standard sub-routine edited amount field  *
      *            @@INPR - Standard sub-routine input rate field     *
      *            @LJUST - Rate field left-justified for display     *
      *************@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
      *************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
      *************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
      *            @TEMP1 - Field to hold value temporarily           *
      *            @TEMP2 - Field to hold value temporarily           *
      *            @TEMP3 - Field to hold value temporarily           *
      *            @TEMP4 - Field to hold value temporarily           *
      *            @TEMP5 - Field to hold value temporarily           *
      *                                                               *
      *****************************************************************
      *
     C           #E        BEGSR
      *
      ** Set up the Deal No. & make the Currency Code equal to Our Currency.
     C                     MOVE DLNO      KGDLNO
     C                     MOVE UCUCY     KGCCY
      *
      ** Convert the Maturity Date to display format.
     C                     Z-ADDMDAT      KGMDAT
     C                     Z-ADDKGMDAT    ZDAYNO
     C                     EXSR ZDATE8
     C                     MOVE ZADATE    KGMTDD
      *
      ** Set up Deal Type display as 'IRX{  '.
     C                     MOVE 'IRX{  '  KGDTPD
      *
      ** Convert Our Prinipal Amount to the Amount To Display format.
     C                     Z-ADDUPAMT     @@IAMT
     C**********           MOVE UCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             86                   S01194
      **********                                                          S01194
     C********** *IN86     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '011'     DBASE            *      11     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Call access program to get Our Currency Decimal Places            S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM UCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     DBKEY            *   DBERROR   *S01194
     C                     MOVEL'011'     DBASE            *     11      *S01194
     C                     MOVEL@OPTN     DBOPTN           ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGAMOD
      *
      ** Save amount for display for 2nd cross currency record.
     C                     MOVE KGAMOD    @TEMP1 10
      *
      ** Set up Our Pay Display1 equal to Our Effective Rate (or blank if=0)
      ** and convert rate to dsiplay format.
     C           UEINR     IFGT 0                          B1
     C                     Z-ADDUEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGOPD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD1            1
     C                     END                             E1
      *
      ** Save Our Pay For Display1 for 2nd cross currency record.
     C                     MOVE KGOPD1    @TEMP2  8
      *
      ** Set up Our Pay Display2 equal to our DRS Base Rate Code
      ** (will be blank if not floating).
     C********** UBRTT     IFGT 0                          B1                                 CSD103
     C           UBRTT     IFNE *BLANKS                    B1                                 CSD103
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '012'     DBASE            *      12     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT                          S01194
      * Call Access Program to get Our Base Rate shortname                S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELUCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @UBRTT    WDBKEY           *     12      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'012'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD2            1             S01194
     C                     MOVELBABSRS    KGOPD2            1             S01194
      *
      ** If Our Spread Indicator is 'A' or 'P' put '+S' onto the end of
      ** Base Rate Code (if no spread indicator - leave blank).
     C           USPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGOPD2             2
     C                     END                             E*2
      *
     C           USPIN     IFEQ 'A'                        B*2
     C           USPIN     OREQ 'P'                          2
     C                     MOVE '+S '     KGOPD2             2
     C                     END                             E*2
      *
      ** If Our Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           USPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGOPD2             2
     C                     END                             E*2
      *
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD2            1
     C                     END                             E1
      *
      ** Save Our Pay For Display2 for 2nd cross currency record.
     C                     MOVE KGOPD2    @TEMP3  8
      *
      ** Blank out Our Receive Display1 & Our Receive Display2
     C                     MOVE *BLANKS   KGORD1
     C                     MOVE *BLANKS   KGORD2
      *
      ** Set up the RX Other Currency equal to Their Currency.
     C                     MOVE TCUCY     KGXOCD
      *
      ** Convert Their Principal Amount to the RX Other Amount to Display.
     C                     Z-ADDTPAMT     @@IAMT
     C**********           MOVE TCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             86                   S01194
      **********                                                          S01194
     C********** *IN86     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '013'     DBASE            *      13     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Call access program to get Their Currency Decimal Places          S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM TCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01194
     C                     MOVELTCUCY     DBKEY            *   DBERROR   *S01194
     C                     MOVEL@OPTN     DBOPTN           *     13      *S01194
     C                     MOVEL'013'     DBASE            ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGXOAD
      *
      ** Blank out RX Other Pay For Display1 & RX Other Pay For Display2.
     C                     MOVE *BLANKS   KGXOP1
     C                     MOVE *BLANKS   KGXOP2
      *
      ** Convert Their Effective Rate to the RX Other Receive For Display1.
     C           TEINR     IFGT 0                          B1
     C                     Z-ADDTEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #CA                         1
     C                     MOVE @LJUST    KGXOR1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGXOR1            1
     C                     END                             E1
      *
      ** Save RX Other Receive for Display1 for 2nd cross currency record.
     C                     MOVE KGXOR1    @TEMP4  8
      *
      ** Set up RX Other Receive For Display2 as Their Base Rate Code(will
      ** be blank if not floating).
     C********** TBRTT     IFGT 0                          B1                                 CSD103
     C           TBRTT     IFNE *BLANKS                    B1                                 CSD103
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             87     1             S01194
      **********                                            1             S01194
     C********** *IN87     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '014'     DBASE            *      14     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT                          S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBSRTPD'DBFILE           ***************S01194
     C                     MOVELTCUCY     WDBKEY           *   DBERROR   *S01194
     C                     MOVE @TBRTT    WDBKEY           *     14      *S01194
     C                     MOVELWDBKEY    DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     MOVEL'014'     DBASE                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C**********           MOVELFSRT      KGXOR2            1             S01194
     C                     MOVELBABSRS    KGXOR2            1             S01194
      *
      ** If their spread indicator is 'A' or 'P' put '+S' onto the end of
      ** base rate code (if no spread indicator - leave blank).
     C           TSPIN     IFEQ *BLANKS                    B*2
     C                     MOVE '   '     KGXOR2            *2
     C                     END                             E*2
      *
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGXOR2            *2
     C                     END                             E*2
      *
      ** If Their Spread Indicator is 'S' put '-S' onto the end of
      ** base rate code.
     C           TSPIN     IFEQ 'S'                        B*2
     C                     MOVE '-S '     KGXOR2            *2
     C                     END                             E*2
      *
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGXOR2            1
     C                     END                             E1
      *
      ** Save RX Other Receive for Display2 for 2nd cross currency record.
     C                     MOVE KGXOR2    @TEMP5  8
      *
      ** Set up Book Code
     C                     MOVE BOKC      KGBPBK
      *
      ** Set up Branch Code
      ***(Key*for*branch*codes*file*already*set*up*in*data*structure*)*** S01194
     C********** @KBRNC    CHAINTABLETRF             88                   S01194
      **********                                                          S01194
     C********** *IN88     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDBRNCLL'DBFILE           ***************S01194
     C**********           MOVEL@KBRNC    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '015'     DBASE            *      15     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *
      * No chain needed since branch read in directly from file           S01117
     C**********           MOVE BRSN      KGBRSN                          S01117
     C                     MOVE BRCA      KGBRCA                          S01117
      *
     C                     WRITEDLIRSSP0
      *
     C           #E9       ENDSR                           ***  #E9  ***
      *
      ********************************************************************
      /TITLE #F    - CROSS CURRENCY IRS, 2ND RECORD.
      *****************************************************************
      *                                                               *
      * #F     Summary file details - Cross Currency Swap, 2nd record.*
      *                                                               *
      * CALLS:     ZDATE8 - Conversion to Date for display format.    *
      *            ZAMTE  - Conversion to Amount to display format.   *
      *            ZRATE1 - Conversion to Rate for Display format.    *
      *            *PSSR  - Database error handling sub-routine       *
      *                                                               *
      * CALLED BY: MAINLINE code                                      *
      *                                                               *
      * FLDS USED: @@IAMT - Standard sub-routine input amount field   *
      *            @@CCY  - Standard sub-routine currency field       *
      *************@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
      *            @@CDP  - Standard sub-routine ccy dp's. field      *
      *            @@AMNT - Standard sub-routine edited amount field  *
      *            @@INPR - Standard sub-routine input rate field     *
      *            @LJUST - Rate field left-justified for display     *
      *************@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
      *************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
      *************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
      *            @TEMP1 - Field to hold value temporarily           *
      *            @TEMP2 - Field to hold value temporarily           *
      *            @TEMP3 - Field to hold value temporarily           *
      *            @TEMP4 - Field to hold value temporarily           *
      *            @TEMP5 - Field to hold value temporarily           *
      *                                                               *
      *****************************************************************
      *
     C           #F        BEGSR
      *
      ** The Deal No.,Maturity Date & Deal Type already set up in #E   .
      *
      ** Set up the Currency Code equal to Their Currency.
     C                     MOVE TCUCY     KGCCY
      *
      ** Make Their Prinipal Amount the Other Amount for display in 1st rec.
     C                     MOVE KGXOAD    KGAMOD
      *
      ** Blank out Our Pay Display1 & Our Pay Display2
     C                     MOVE *BLANKS   KGOPD1
     C                     MOVE *BLANKS   KGOPD2
      *
      ** Set up Our Receive Display1 equal to their effective rate
      ** (or blank if = 0) and convert rate to dsiplay format.
      ** (Restore from save in 1st cross currency record).
     C                     MOVE @TEMP4    KGORD1
      *
      ** Set up Our Receive For Display2 as Their Base Rate Code(will
      ** be blank if not floating) and convert to display format.
      ** (Restore from save in 1st cross currency record).
     C                     MOVE @TEMP5    KGORD2
      *
      ** Set up the RX Other Currency equal to Our Currency.
     C                     MOVE UCUCY     KGXOCD
      *
      ** Convert Our Principal Amount to the RX Other Amount To Display.
      ** (Restore from save in 1st cross currency record).
     C                     MOVE @TEMP1    KGXOAD
      *
      ** Convert Our Effective Rate to the RX Other Pay For Display1.
      ** (Restore from save in 1st cross currency record).
     C                     MOVE @TEMP2    KGXOP1
      *
      ** Set up RX Other Pay For Display2 as Our Base Rate Code(will
      ** be blank if not floating) with '+S ' or '-S ' in the field.
      ** (Restore from save in 1st cross currency record).
     C                     MOVE @TEMP3    KGXOP2
      *
      ** Blank out RX Other Receive For Display1 & RX Other Receive
      ** For Display2.
     C                     MOVE *BLANKS   KGXOR1
     C                     MOVE *BLANKS   KGXOR2
      *
      *
     C           #F9       ENDSR                           ***  #F9  ***
      *
      ********************************************************************
      /TITLE  #CA  SUB-ROUTINE TO LEFT-ALIGN OUTPUT FROM ZRATE1
     C*****************************************************************
     C*                                                               *
     C* #CA      - Takes output from ZRATE1(@@OUTR) and left-justifies*
     C*            it for output                                      *
     C*                                                               *
     C* CALLS:     None                                               *
     C*                                                               *
     C* CALLED BY: #C                                                 *
     C*            #D                                                 *
     C*            #E                                                 *
     C*            #F                                                 *
     C*                                                               *
     C* FLDS USED: @LJUST - Rate field left-justified for display     *
     C*            @FST1  - DS sub-field; first char of @@OUTR        *
     C*            @FST2  - DS sub-field; first two chars of @@OUTR   *
     C*            @FST3  - DS sub-field; first three chars of @@OUTR *
     C*            @FST4  - DS sub-field; first four chars of @@OUTR  *
     C*            @NXT7  - DS sub-field; next seven chars of @@OUTR  *
     C*                     starting from position 5 (ie. decimal pt) *
     C*            @NXT8  - DS sub-field; next eight chars of @@OUTR  *
     C*                     starting from position 4                  *
     C*            @NXT9  - DS sub-field; next nine chars of @@OUTR   *
     C*                     starting from position 3                  *
     C*            @NXT10 - DS sub-field; next ten chars of @@OUTR    *
     C*                     starting from position 2                  *
     C*            @@OUTR - Standard sub-routine output rate field    *
     C*                                                               *
     C*****************************************************************
     C*
     C           #CA       BEGSR
      *
      ** Initialise output field with zero in first position just in
      ** case rate is less than 1, then start moving in field from the
      ** left. Least significant digits may be excluded and no rounding
      ** occurs.
      ** NOTE: @NXT7 uses 'MOVE' operation to avoid over-writing
      ** leading zero.
      *
     C                     MOVEL'0'       @LJUST  8
     C*
     C           @FST4     IFEQ *BLANKS                    B1
     C                     MOVE @NXT7     @LJUST            1
     C                     ELSE                            X1
     C           @FST3     IFEQ *BLANKS                    B*2
     C                     MOVEL@NXT8     @LJUST            *2
     C                     ELSE                            X*2
     C           @FST2     IFEQ *BLANKS                    B**3
     C                     MOVEL@NXT9     @LJUST            **3
     C                     ELSE                            X**3
     C           @FST1     IFEQ *BLANKS                    B***4
     C                     MOVEL@NXT10    @LJUST            ***4
     C                     ELSE                            X***4
     C                     MOVEL@@OUTR    @LJUST            ***4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #CA9      ENDSR                           *** #CA9 ***
     C*****************************************************************
      /TITLE #A  INITIALISATION SUB-ROUTINE
     C*****************************************************************
      *                                                               *
      * #A       - Initial sub-routine                                *
      *                                                               *
      * CALLS:     *PSSR  - Database error handling sub-routine       *
      *                                                               *
      * CALLED BY: Main-line code                                     *
      *                                                               *
      * FLDS USED: @TERM  - Termination code parameter                *
      *            @KIRS    Key for IRS file                          *
      *            @PDLNO - Deal no. parameter                        *
      *            @PCCY  - Currency parameter                        *
      *************@SREC****Data*structure*sub*field*to*form*part*of***   S01194
      **********************key*for*ccy*file**set*to*'1'*permanently***   S01194
      *************@K10*****Part*of*key**type*identifier**10***********   S01194
      *************@K20*****Part*of*key**type*identifier**20***********   S01194
      *************@K21*****Part*of*key**type*identifier*'21'**********   S01194
      *                                                               *
      *****************************************************************
      *
     C           #A        BEGSR
      *
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
      *
      ** Set the first cycle indicator on.
     C                     MOVE '1'       *IN20
      *
      ** Initialise the following
     C                     MOVEL'DL1910'  DBPGM
      *
     C**********           MOVE '1'       @SREC                           S01194
      *
     C**********           MOVE '10'      @K10                            S01194
     C**********           MOVE '20'      @K20                            S01194
     C**********           MOVE '21'      @K21                            S01194
      *
     C                     READ FDMNTHLL                 89
      *
     C           *IN89     IFEQ '1'                        B1
     C           RECI      ORNE 'D'                         1
     C                     MOVEL'FDMNTHLL'DBFILE           ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 016 *
     C                     MOVE '016'     DBASE            *      16     *
     C                     EXSR *PSSR                      ***************
     C                     END                             E1
      *
      ***Access*I*C*D*R*1*to*find*the*date*format*required****            S01194
     C********** 1         CHAINTABTB10              85                   S01194
      **********                                                          S01194
     C********** *IN85     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVEL'TABTB10 'DBFILE           ***************S01194
     C**********           MOVE *BLANKS   DBKEY            * DBERROR 017 *S01194
     C**********           MOVE '017'     DBASE            *      17     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
     C* Call Access prog. for Bank Details.                               S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'SDBANKPD'DBFILE           ***************S01194
     C                     MOVE *BLANKS   DBKEY            *  DBERROR    *S01194
     C                     MOVEL@OPTN     DBOPTN  7        *    17       *S01194
     C                     MOVEL'017'     DBASE            ***************S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C***********DATF******IFEQ 'M'                        B1             S01194
     C** Set up date format indicator later used by ZDATE8                S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE '1'       *IN98             1
     C                     END                             E1
      *********************                                               S01117
     C***********DATF******IFEQ 'D'                        B1             S01117
     C*********************MOVE '0'       *IN98             1             S01117
     C*********************END                             E1             S01117
      *
     C           #A9       ENDSR                           **** #A9 ****
     C*****************************************************************
      /TITLE SUB-ROUTINE FOR HANDLING DATABASE ERRORS
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - DATABASE ERROR SUBROUTINE                          *
     C*                                                               *
     C* CALLS    -                                                    *
     C*                                                               *
     C* CALLED IF ANY PROGRAM OR FILE ERRORS                          *
     C*                                                               *
     C* FLDS USED  @BEEN    -  ALREADY BEEN THROUGH *PSSR INDICATOR   *
     C*            @LDA     -  VARIABLE TO SET UP LDA WITH DB ERRORS  *
     C*            DBERR    -  DS TO HOLD DB ERROR                    *
     C*            @TERM    -  TERMINATION PARAMETER RETURNED         *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** IF NOT BEEN ALREADY BEEN THROUGH *PSSR THEN PROCESS ERROR
     C** ELSE JUST RETURN
     C*
     C           @BEEN     IFNE 'Y'                        B1
     C*
     C** SET ALREADY-BEEN-THROUGH-*PSSR INDICATOR TO YES
     C*
     C                     MOVE 'Y'       @BEEN   1        *1
     C*
     C** SET UP TERMINATION PARAMETER, TURN ON ERROR SWITCHES,
     C** SET ON LR AND DUMP
     C*
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     MOVE '1'       *INLR            *1
     C                     DUMP                            *1
     C*
     C** MOVE DATABASE ERROR DETAILS INTO LDA
     C*
     C           *NAMVAR   DEFN LDA       @LDA  256        *1
     C           *LOCK     IN   @LDA                       *1
     C                     MOVELDBERR     @LDA             *1
     C                     OUT  @LDA                       *1
     C*
     C                     END                             E1
     C*
     C                     RETRN
     C*
     C           PSSR9     ENDSR                           *** *PSSR9 ***
     C*****************************************************************
      /TITLE '                                       '
     C*****************************************************************
      *
     ODLIRSSP0D        20
     O                         *ALL
      *
      *****************************************************************
**   CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
