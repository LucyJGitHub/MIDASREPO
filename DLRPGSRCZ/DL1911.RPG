     H        1   D
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL IRS summary maintenance')
      *
     F*****************************************************************
     F*                                                               *
     F*  Midas  -  FRA/IRS Module
     F*                                                               *
     F*  DL1911  - IRS Summary File Maintenance                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD060920           Date 09Feb23               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 047163             Date 10Jan94               *
     F*                 S01117             DATE 05MAR90               *
     F*                 S01194             DATE 05MAR90               *
     F*                 S01157             DATE 03/10/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD060920 - FRA/IRS: incorrect reflection of interest in      *
      *             assets and liabilities for CAPS/Coll/Floor.       *
      *           - Condition the floor/ceiling rate when calculating *
      *             the accrued interest. Also, system should display *
      *             the correct side (OUR/THEIR) of deal's interest   *
      *             details.                                          *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
     F*  CSD006 - Use long DS with SDBSRTPD.                          *
     F*  047163 - Summary shows the deal's NRCD and not VDAT when     *
     F*           the deal is FORWARD-VALUED.  Set NRCD to VDAT if    *
     F*           VDAT is today or later.                             *
     F*  S01117 - MULTIBRANCHING CHANGES                              *
     F*  S01194 - NEW STANDING DATA CHANGES                           *
     F*  S01157 - New program                                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F* Function of indicators
     F*
     F*  50   -  Average Price bit on
     F*
     F*  89   -  General fail on chain to a file
     F*
     F* 90-99 -  Used in standard sub-routines
     F*
     F*****************************************************************
     F*
     F*DICDRLLIF**E*******    K        DISK         KINFSR *PSSR      UC  S01194
     F**********  TABTB11F                          KIGNORE               S01194
     F**********  TABTB20F                          KIGNORE               S01194
     FFDMNTHLLIF  E                    DISK         KINFSR *PSSR      UC
     F*DBRNCLLIF**E*******    K        DISK         KINFSR *PSSR      UC  S01194
     F*DCCYTLLIF**E*******    K        DISK         KINFSR *PSSR      UC  S01194
     F*DBSRTLLIF**E*******    K        DISK         KINFSR *PSSR      UC  S01194
     FDLDLDGLDIF  E           K        DISK         KINFSR *PSSR      UC
     FDLIRSSL0UF  E           K        DISK         KINFSR *PSSR A    UC
     F                                              KCOMIT
      *
     E                    CPY@    1   1 80
     E** COMPILE TIME ARRAY FOR COPYRIGHT STATEMENT
     E*
      /COPY ZSRSRC,ZDATE8Z1
      /COPY ZSRSRC,ZAMTEZ1
      /COPY ZSRSRC,ZRATE1Z1
      *
      /COPY ZSRSRC,ZDATE8Z2
      /COPY ZSRSRC,ZAMTEZ2
      *
      *
      ***Key*to*chain*to*base*rate*file**FDBSRTLL***                      S01194
      **********                                                          S01194
     I*KBSRT******DS                                                      S01194
     I**********                              1   2 @K21                  S01194
     I**********                              3   7 @BLK5                 S01194
     I**********                              8  10 @KCCY                 S01194
     I**********                             11  12 @KBRC                 S01194
      **********                                                          S01194
      ***Key*to*chain*to*branch*codes*file**FDBRNCLL***                   S01194
      **********                                                          S01194
     I*KBRNC******DS                                                      S01194
     I**********                              1   2 @K10                  S01194
     I**********                              3   9 @BLK7                 S01194
     I**********                             10  120BRCD                  S01194
      **********                                                          S01194
      ***Key*to*chain*to*installation*control*data*file**FDICDRLL**       S01194
      **********                                                          S01194
     I*KICDR******DS                                                      S01194
     I**********                              1   2 @K01                  S01194
     I**********                             11  12 @E10                  S01194
      **********                                                          S01194
      ***Key*to*chain*to*currency*file*for*currency*d*p*s**FDCCYTLL**     S01194
      **********                                                          S01194
     I*KCDP*******DS                                                      S01194
     I**********                              1   2 @K20                  S01194
     I**********                              3   8 @BLK6                 S01194
     I**********                              9  11 @@CCY                 S01194
     I**********                             12  12 @SREC                 S01194
      *
      ** Data structure to access middle of KGDTPD field and also to
      ** set 5th & 6th characters of field; (CAPS, COLLARS & FLOORS)
      *
     I@DLTYP      DS
     I                                        1   6 KGDTPD
     I                                        2   3 @DTYP
     I                                        5   5 @FIFTH
     I                                        6   6 @SIXTH
      *
      ** Data structure to move blanks into 'other detail' fields
      *
     I@STBLK      DS
     I                                        1   3 KGXOCD
     I                                        4  13 KGXOAD
     I                                       14  21 KGXOP1
     I                                       22  29 KGXOP2
     I                                       30  37 KGXOR1
     I                                       38  45 KGXOR2
      *
      ** Data structure to enable left-alignment of rate field
      *
     I@ALGN       DS
     I                                        1  13 @@OUTR
     I                                        1   1 @FST1
     I                                        2  11 @NXT10
     I                                        1   2 @FST2
     I                                        3  11 @NXT9
     I                                        1   3 @FST3
     I                                        4  11 @NXT8
     I                                        1   4 @FST4
     I                                        5  11 @NXT7
      *
      ** Need a dummy data structure for IRS key so that we can
      ** manipulate the key if a database error occurs
      *
     I@DIRS       DS
     I                                        1   60@DDLNO
     I                                        7   9 @DCCY
0392 ISDCURR    E DSSDCURRPD                                              S01194
0393 I* Currency details accessed via access program                      S01194
0393 I*                                                                   S01194
0392 ISDBSRT    E DSSDBSRTPD                                              S01194
0393 I* Base Rate code details accessed via access program                S01194
     I*                                                                   S01194
0392 ISDBANK    E DSSDBANKPD                                              S01194
0393 I* Bank details accessed via access program                          S01194
0393 I*                                                                   S01194
     I* Dummy data structures used by access programs                     S01194
     I* (DSSDY only used if file records over 150 chars. long)            S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
      *
      ** Data structure for database error handling
      *
     IDBERR       DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I**********                            181 183 DBASE                 S01194
     I                                      181 1830DBASE                 S01194
      /TITLE     START OF CALCULATION SPECIFICATIONS
     C                     MOVEACPY@      BIS@   80
      *
      ** If this is the first time this program is called, then the
      ** initial sub-routine must be called first
      *
     C           @FIRST    IFEQ 'N'                        B1
     C                     EXSR #B                          1
     C                     ELSE                            X1
     C                     EXSR #A                          1
     C                     EXSR #B                          1
     C                     END                             E1
      *
      ** Return from program without setting on LR, so that subsequent
      ** calls will run more quickly
      *
     C                     RETRN
      /TITLE   MAIN SUB-ROUTINE; CALLED EVERY TIME PROGRAM IS CALLED
     C*****************************************************************
     C*                                                               *
     C* #B       - Main Processing                                    *
     C*                                                               *
     C* CALLS:     *PSSR - Database error handling sub-routine        *
     C*            #BA   - Determines earliest next rate change date  *
     C*            #BB   - Sets up detail record fields               *
     C*                                                               *
     C* CALLED BY: Main-line code                                     *
     C*                                                               *
     C* FLDS USED: @KIRS  - Key for IRS detail file                   *
     C*            @PDLNO - Parameter deal number passed to program   *
     C*            @PCCY  - Parameter currency passed to program      *
     C*            @DDLNO - Dummy parameter deal no.                  *
     C*            @DCCY  - Dummy parameter currency                  *
     C*            @DIRS  - Dummy IRS key for easy manipulation       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C           ACTION    IFEQ 'R'                        B1
     C           ACTION    OREQ 'A'                         1
      *                                                     1
      ** Key has been set up by parameters passed by calling program
      *                                                     1
     C           @KIRS     CHAINDLIRSSP0             89     1
     C*                                                     1
     C           *IN89     IFEQ '1'                        B*2
     C                     MOVE 'DLIRSSL0'DBFILE            *2
     C                     Z-ADD@PDLNO    @DDLNO            *2
     C                     MOVE @PCCY     @DCCY            ***************
     C                     MOVEL@DIRS     DBKEY            *   DBERROR   *
     C                     MOVE '001'     DBASE            *      01     *
     C                     EXSR *PSSR                      ***************
     C                     END                             E*2
     C*                                                     1
     C                     DELETDLIRSSP0                    1
      *                                                     1
      ** If type of record just deleted was 'RX' then there is a second
      ** detail record to be deleted.                       1
      *                                                     1
     C           @DTYP     IFEQ 'RX'                       B*2
     C                     MOVELKGXOCD    @PCCY             *2
     C           @KIRS     CHAINDLIRSSP0             89     *2
     C*                                                     *2
     C           *IN89     IFEQ '1'                        B**3
     C                     MOVE 'DLIRSSL0'DBFILE            **3
     C                     Z-ADD@PDLNO    @DDLNO            **3
     C                     MOVE @PCCY     @DCCY            ***************
     C                     MOVEL@DIRS     DBKEY            *   DBERROR   *
     C                     MOVE '002'     DBASE            *      02     *
     C                     EXSR *PSSR                      ***************
     C                     END                             E**3
     C*                                                     *2
     C                     DELETDLIRSSP0                    *2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           ACTION    IFEQ 'I'                        B1
     C           ACTION    OREQ 'A'                         1
     C*                                                     1
     C                     MOVE *BLANKS   @PCCY             1
     C           @PDLNO    CHAINDLDLDGLD             89     1
     C*                                                     1
     C           *IN89     IFEQ '1'                        B*2
     C           RECI      ORNE 'D'                         *2
     C                     MOVE 'DLDLDGLD'DBFILE           ***************
     C                     MOVEL@PDLNO    DBKEY            *   DBERROR   *
     C                     MOVE '003'     DBASE            *      03     *
     C                     EXSR *PSSR                      ***************
     C                     END                             E*2
     C*                                                     1
     C                     EXSR #BA                         1
     C                     EXSR #BB                         1
     C                     END                             E1
     C*
     C           #B9       ENDSR                           *** #B9 ****
     C*****************************************************************
      /TITLE  SUB-ROUTINE TO FIND EARLIEST NEXT RATE CHANGE DATE
     C*****************************************************************
     C*                                                               *
     C* #BA      - Find earliest next rate change date                *
     C*                                                               *
     C* CALLS:     ZDATE8 - Format dayno. for DDMMMYY output          *
     C*                                                               *
     C* CALLED BY: #B                                                 *
     C*                                                               *
     C* FLDS USED: None                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*                                                                   047163
     C** If value date is today or later, set KGERTC to value date        047163
     C*                                                                   047163
     C           VDAT      IFGE BJRDNB                                    047163
     C                     MOVE VDAT      KGERTC                          047163
     C                     ELSE                                           047163
     C*
     C           UNICD     IFEQ 0                          B1
     C                     MOVE TNICD     KGERTC            1
     C                     ELSE                            X1
     C           TNICD     IFEQ 0                          B*2
     C                     MOVE UNICD     KGERTC            *2
     C                     ELSE                            X*2
     C           TNICD     IFLE UNICD                      B**3
     C                     MOVE TNICD     KGERTC            **3
     C                     ELSE                            X**3
     C                     MOVE UNICD     KGERTC            **3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C                     END                                            047163
     C*
     C           KGERTC    IFEQ 0                          B1
     C                     MOVE *BLANKS   KGERDD            1
     C*                                                     1
     C                     ELSE                            X1
     C*                                                     1
     C                     Z-ADDKGERTC    ZDAYNO            1
     C                     EXSR ZDATE8                      1
     C                     MOVE ZADATE    KGERDD            1
     C                     END                             E1
     C*
     C           #BA9      ENDSR                           *** #BA9 ***
     C*****************************************************************
      /TITLE
      /COPY ZSRSRC,ZDATE8Z3
      /TITLE  SUB-ROUTINE FOR FILLING IN DETAIL RECORD FOR ALL TYPES
     C*****************************************************************
     C*                                                               *
     C* #BB      - Set up detail record for all deal types            *
     C*                                                               *
     C* CALLS:     ZDATE8 - Format dayno. for DDMMMYY output          *
     C*            ZAMTE  - Edit amount to display in '000s'          *
     C*            *PSSR  - Database error handling sub-routine       *
     C*            #BBA   - Sets fields 'unique' to RS detail record  *
     C*            #BBB   - Sets fields 'unique' to RX detail record  *
     C*            #BBC   - Sets fields 'unique' to RR detail record  *
     C*            #BBD   - Sets fields 'unique' to RA detail record  *
     C*            #BBE   - Sets fields 'unique' to RF detail record  *
     C*                                                               *
     C* CALLED BY: #B                                                 *
     C*                                                               *
     C* FLDS USED:                                                    *   S01194
     C**FLDS*USED**@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
     C*************@KBRNC***Key*to*retreive*DRS*branch*code************   S01194
     C*            @@IAMT - Standard sub-routine input amount field   *
     C*            @@CCY  - Standard sub-routine currency field       *
     C*            @@CDP  - Standard sub-routine ccy dp's. field      *
     C*            @@AMNT - Standard sub-routine edited amount field  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BB       BEGSR
     C                     Z-ADDDLNO      KGDLNO
     C                     MOVE UCUCY     KGCCY
      *
      **  KGERTC, KGERDD already loaded by ENRCD sub-routine
      *
     C                     Z-ADDMDAT      KGMDAT
     C                     Z-ADDKGMDAT    ZDAYNO
     C                     EXSR ZDATE8
     C                     MOVE ZADATE    KGMTDD
      *
      ** 'Unique' fields done separately, after the 'common' fields
      *
     C                     Z-ADDUPAMT     @@IAMT
     C**********           MOVE UCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             89                   S01194
     C**********                                                          S01194
     C********** *IN89     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '004'     DBASE            *      04     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
     C*                                                                   S01194
      * Call access program to get Our Currency Decimal Places            S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM UCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGAMOD
      *
      ** Our pay1, pay2, our rec1, rec2 done last
      *
     C                     MOVE BOKC      KGBPBK
      *
      ***Key*for*branch*codes*file*already*set*up*in*data*structure***    S01194
      **********                                                          S01194
     C********** @KBRNC    CHAINTABLETRF             89                   S01194
     C**********                                                          S01194
     C********** *IN89     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDBRNCLL'DBFILE           ***************S01194
     C**********           MOVEL@KBRNC    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '005'     DBASE            *      05     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
     C*
      * No chain needed since branch read in directly from file           S01117
     C**********           MOVE BRSN      KGBRSN                          S01117
     C                     MOVE BRCA      KGBRCA                          S01117
     C*
     C           DTYP      CASEQ'RS'      #BBA
     C           DTYP      CASEQ'RX'      #BBB
     C           DTYP      CASEQ'RR'      #BBC
     C           DTYP      CASEQ'RP'      #BBD
     C           DTYP      CASEQ'RF'      #BBE
     C                     CAS            *PSSR
     C                     END
     C*
     C                     WRITEDLIRSSP0
     C*
     C           #BB9      ENDSR                           *** #BB9 ***
     C*****************************************************************
      /TITLE
      /COPY ZSRSRC,ZAMTEZ3
     C*****************************************************************
      /TITLE SUB-ROUTINE TO SET FIELDS 'UNIQUE' TO 'RS' DETAIL RECORD
     C*****************************************************************
     C*                                                               *
     C* #BBA     - Set up fields unique to 'RS' records               *
     C*                                                               *
     C* CALLS:     ZRATE1 - Converts a rate to display format         *
     C*            *PSSR  - Database error handling sub-routine       *
     C*            #BBAA  - Left-aligns rate field output by ZRATE1   *
     C*                                                               *
     C* CALLED BY: #BB                                                *
     C*                                                               *
     C* FLDS USED:                                                    *   S01194
     C**FLDS*USED**@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
     C*************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
     C*************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
     C*            @STBLK - Data structure to move blanks to 'other   *
     C*                     detail' fields in record                  *
     C*            @LJUST - Rate field left-justified for display     *
     C*            @@INPR - Standard sub-routine input rate field     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBA      BEGSR
     C*
     C                     MOVE 'IRS   '  KGDTPD
     C*
     C           UEINR     IFGT 0                          B1
     C                     Z-ADDUEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGOPD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD1            1
     C                     END                             E1
     C*
     C           UBRTT     IFGT 0                          B1
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '006'     DBASE            *      06     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT  2                       S01194
      *                                                                   S01194
      * Call Access Program to get Our Base Rate shortname                S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD2            1             S01194
     C                     MOVELBABSRS    KGOPD2            1             S01194
     C*                                                     1
     C           USPIN     IFEQ 'A'                        B*2
     C           USPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD2            *2
     C                     ELSE                            X*2
     C           USPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGOPD2            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGOPD2            **3
     C                     END                             E**3
     C                     END                             E*2
     C*                                                     1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD2            1
     C                     END                             E1
     C*
     C           TEINR     IFGT 0                          B1
     C                     Z-ADDTEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGORD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGORD1            1
     C                     END                             E1
     C*
     C           TBRTT     IFGT 0                          B1
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '007'     DBASE            *      07     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT  2                       S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD2            1             S01194
     C                     MOVELBABSRS    KGORD2            1             S01194
     C*                                                     1
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGORD2            *2
     C                     ELSE                            X*2
     C           TSPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGORD2            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGORD2            **3
     C                     END                             E**3
     C                     END                             E*2
     C*                                                     1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGORD2            1
     C                     END                             E1
     C*
     C                     MOVE *BLANKS   @STBLK
     C*
     C           #BBA9     ENDSR                           *** #BBA9 **
     C*****************************************************************
      /TITLE
      /COPY ZSRSRC,ZRATE1Z2
     C*****************************************************************
      /TITLE  SUB-ROUTINE TO LEFT-ALIGN OUTPUT FROM ZRATE1
     C*****************************************************************
     C*                                                               *
     C* #BBAA    - Takes output from ZRATE1(@@OUTR) and left-justifies*
     C*            it for output                                      *
     C*                                                               *
     C* CALLS:     None                                               *
     C*                                                               *
     C* CALLED BY: #BBA                                               *
     C*            #BBB                                               *
     C*            #BBCA                                              *
     C*                                                               *
     C* FLDS USED: @LJUST - Rate field left-justified for display     *
     C*            @FST1  - DS sub-field; first char of @@OUTR        *
     C*            @FST2  - DS sub-field; first two chars of @@OUTR   *
     C*            @FST3  - DS sub-field; first three chars of @@OUTR *
     C*            @FST4  - DS sub-field; first four chars of @@OUTR  *
     C*            @NXT7  - DS sub-field; next seven chars of @@OUTR  *
     C*                     starting from position 5 (ie. decimal pt) *
     C*            @NXT8  - DS sub-field; next eight chars of @@OUTR  *
     C*                     starting from position 4                  *
     C*            @NXT9  - DS sub-field; next nine chars of @@OUTR   *
     C*                     starting from position 3                  *
     C*            @NXT10 - DS sub-field; next ten chars of @@OUTR    *
     C*                     starting from position 2                  *
     C*            @@OUTR - Standard sub-routine output rate field    *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBAA     BEGSR
      *
      ** Initialise output field with zero in first position just in
      ** case rate is less than 1, then start moving in field from the
      ** left. Least significant digits may be excluded and no rounding
      ** occurs.
      ** NOTE: @NXT7 uses 'MOVE' operation to avoid over-writing
      ** leading zero.
      *
     C                     MOVEL'0'       @LJUST  8
     C*
     C           @FST4     IFEQ *BLANKS                    B1
     C                     MOVE @NXT7     @LJUST            1
     C                     ELSE                            X1
     C           @FST3     IFEQ *BLANKS                    B*2
     C                     MOVEL@NXT8     @LJUST            *2
     C                     ELSE                            X*2
     C           @FST2     IFEQ *BLANKS                    B**3
     C                     MOVEL@NXT9     @LJUST            **3
     C                     ELSE                            X**3
     C           @FST1     IFEQ *BLANKS                    B***4
     C                     MOVEL@NXT10    @LJUST            ***4
     C                     ELSE                            X***4
     C                     MOVEL@@OUTR    @LJUST            ***4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BBAA9    ENDSR                           *** #BBAA9 *
     C*****************************************************************
      /TITLE  SUB-ROUTINE TO DO FIELDS 'UNIQUE' TO 'RX' DETAIL RECORD
     C*****************************************************************
     C*                                                               *
     C* #BBB     - Set up fields unique to 'RX' records               *
     C*                                                               *
     C* CALLS:     ZRATE1 - Converts a rate to display format         *
     C*            ZAMTE  - Edit amount to display in '000s'          *
     C*            *PSSR  - Database error handling sub-routine       *
     C*            #BBAA  - Left-aligns rate field output by ZRATE1   *
     C*                                                               *
     C* CALLED BY: #BB                                                *
     C*                                                               *
     C* FLDS USED:                                                    *   S01194
     C**FLDS*USED**@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
     C*************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
     C*************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
     C*************@KCDP****Key*to*retreive*no**of*dp*s**for*currency**   S01194
     C*            @TEMP  - Field to hold value temporarily           *
     C*            @LJUST - Rate field left-justified for display     *
     C*            @@INPR - Standard sub-routine input rate field     *
     C*            @@IAMT - Standard sub-routine input amount field   *
     C*            @@CCY  - Standard sub-routine currency field       *
     C*            @@CDP  - Standard sub-routine ccy dp's. field      *
     C*            @@AMNT - Standard sub-routine edited amount field  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBB      BEGSR
     C*
     C                     MOVE 'IRX{  '  KGDTPD
     C*
     C           UEINR     IFGT 0                          B1
     C                     Z-ADDUEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGOPD1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD1            1
     C                     END                             E1
     C*
     C           UBRTT     IFGT 0                          B1
     C**********           MOVE UCUCY     @KCCY             1             S01194
     C**********           MOVE UBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '008'     DBASE            *      08     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT  2                       S01194
      *                                                                   S01194
      * Call Access Program to get Our Base Rate shortname                S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD2            1             S01194
     C                     MOVELBABSRS    KGOPD2            1             S01194
     C*                                                     1
     C           USPIN     IFEQ 'A'                        B*2
     C           USPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD2            *2
     C                     ELSE                            X*2
     C           USPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGOPD2            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGOPD2            **3
     C                     END                             E**3
     C                     END                             E*2
     C*                                                     1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGOPD2            1
     C                     END                             E1
     C*
     C                     MOVE *BLANKS   KGORD1
     C                     MOVE *BLANKS   KGORD2
     C*
     C                     MOVE TCUCY     KGXOCD
     C*
     C                     Z-ADDTPAMT     @@IAMT
     C**********           MOVE TCUCY     @@CCY                           S01194
     C********** @KCDP     CHAINFDCCYTLL             89                   S01194
     C**********                                                          S01194
     C********** *IN89     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                         1             S01194
     C**********           MOVE 'FDCCYTLL'DBFILE           ***************S01194
     C**********           MOVEL@KCDP     DBKEY            *   DBERROR   *S01194
     C**********           MOVE '009'     DBASE            *      09     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
     C*
      * Call access program to get Their Currency Decimal Places          S01194
      * @@CCY returned currency code used in ZAMTE                        S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM TCUCY     @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C**********           Z-ADDCDP       @@CDP                           S01194
     C                     Z-ADDA6NBDP    @@CDP                           S01194
     C                     EXSR ZAMTE
     C                     MOVE @@AMNT    KGXOAD
     C*
     C                     MOVE *BLANKS   KGXOP1
     C                     MOVE *BLANKS   KGXOP2
     C*
     C           TEINR     IFGT 0                          B1
     C                     Z-ADDTEINR     @@INPR            1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGXOR1            1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   KGXOR1            1
     C                     END                             E1
     C*
     C           TBRTT     IFGT 0                          B1
     C**********           MOVE TCUCY     @KCCY             1             S01194
     C**********           MOVE TBRTT     @KBRC             1             S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '010'     DBASE            *      10     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT  2                       S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGXOR2            1             S01194
     C                     MOVELBABSRS    KGXOR2            1             S01194
     C*                                                     1
     C           TSPIN     IFEQ 'A'                        B*2
     C           TSPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGXOR2            *2
     C                     ELSE                            X*2
     C           TSPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGXOR2            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGXOR2            **3
     C                     END                             E**3
     C                     END                             E*2
     C*                                                     1
     C                     ELSE                             1
     C                     MOVE *BLANKS   KGXOR2            1
     C                     END                             E1
     C*
     C                     WRITEDLIRSSP0
      *
      ** Set up the fields for RX2 detail record. This simply involves
      ** swapping the fields from rx-other-details to the main fields
      ** and vice-versa.
      *
     C                     MOVE TCUCY     KGCCY
     C*
     C                     MOVE KGAMOD    @TEMP  10
     C                     MOVE KGXOAD    KGAMOD
     C                     MOVE @TEMP     KGXOAD
     C*
     C                     MOVE KGXOR1    KGORD1
     C                     MOVE KGXOR2    KGORD2
     C*
     C                     MOVE UCUCY     KGXOCD
     C*
     C                     MOVE KGOPD1    KGXOP1
     C                     MOVE KGOPD2    KGXOP2
     C*
     C                     MOVE *BLANKS   KGOPD1
     C                     MOVE *BLANKS   KGOPD2
     C                     MOVE *BLANKS   KGXOR1
     C                     MOVE *BLANKS   KGXOR2
     C*
     C           #BBB9     ENDSR                           *** #BBB9 **
     C*****************************************************************
      /TITLE  SUB-ROUTINE TO SET DETAILS FOR 'UNIQUE' 'RR' RECORD
     C*****************************************************************
     C*                                                               *
     C* #BBC     - Set up fields unique to 'RR' records               *
     C*                                                               *
     C* CALLS:     #BBCA  - Set 'our pay/rec' 1 & 2 field details     *
     C*                                                               *
     C* CALLED BY: #BB                                                *
     C*                                                               *
     C* FLDS USED: @FIFTH - Data structure sub-field to set 5th char. *
     C*                     of KGDTPD field                           *
     C*            @SIXTH - Data structure sub-field to set 6th char. *
     C*                     of KGDTPD field                           *
     C*            @STBLK - Data structure to move blanks to 'other   *
     C*                     detail' fields in record                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBC      BEGSR
     C*
     C                     MOVE 'CLR-  '  KGDTPD
     C                     MOVE BYSL      @FIFTH
     C*
     C** If Average Rate Method indicator on set up display
     C*
     C                     TESTB'3'       UDSTI          50
     C           *IN50     IFEQ '1'                        B1
     C                     MOVE 'A'       @SIXTH            1
     C                     END                             E1
     C*
     C                     EXSR #BBCA
     C*
     C                     MOVE *BLANKS   @STBLK
     C*
     C           #BBC9     ENDSR                           *** #BBC9 **
     C*****************************************************************
      /TITLE  SUB-ROUTINE TO SET FIELDS 'UNIQUE' TO 'RP' DETAIL RECORD
     C*****************************************************************
     C*                                                               *
     C* #BBD     - Set up fields unique to 'RP' records               *
     C*                                                               *
     C* CALLS:     #BBCA  - Set 'our pay/rec' 1 & 2 field details     *
     C*                                                               *
     C* CALLED BY: #BB                                                *
     C*                                                               *
     C* FLDS USED: @FIFTH - Data structure sub-field to set 5th char. *
     C*                     of KGDTPD field                           *
     C*            @SIXTH - Data structure sub-field to set 6th char. *
     C*                     of KGDTPD field                           *
     C*            @STBLK - Data structure to move blanks to 'other   *
     C*                     detail' fields in record                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBD      BEGSR
     C*
     C                     MOVE 'CAP-  '  KGDTPD
     C                     MOVE BYSL      @FIFTH
     C*
     C** If Average Rate Method indicator on set up display
     C*
     C                     TESTB'3'       UDSTI          50
     C           *IN50     IFEQ '1'                        B1
     C                     MOVE 'A'       @SIXTH            1
     C                     END                             E1
     C*
     C                     EXSR #BBCA
     C*
     C                     MOVE *BLANKS   @STBLK
     C*
     C           #BBD9     ENDSR                           *** #BBD9 **
     C*****************************************************************
      /TITLE SUB-ROUTINE FOR FIELDS 'UNIQUE' TO 'RF' DETAIL RECORD
     C*****************************************************************
     C*                                                               *
     C* #BBE     - Set up fields unique to 'RF' records               *
     C*                                                               *
     C* CALLS:     #BBCA  - Set 'our pay/rec' 1 & 2 field details     *
     C*                                                               *
     C* CALLED BY: #BB                                                *
     C*                                                               *
     C* FLDS USED: @FIFTH - Data structure sub-field to set 5th char. *
     C*                     of KGDTPD field                           *
     C*            @SIXTH - Data structure sub-field to set 6th char. *
     C*                     of KGDTPD field                           *
     C*            @STBLK - Data structure to move blanks to 'other   *
     C*                     detail' fields in record                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBE      BEGSR
     C*
     C                     MOVE 'FLR-  '  KGDTPD
     C                     MOVE BYSL      @FIFTH
     C*
     C** If Average Rate Method indicator on set up display
     C*
     C                     TESTB'3'       UDSTI          50
     C           *IN50     IFEQ '1'                        B1
     C                     MOVE 'A'       @SIXTH            1
     C                     END                             E1
     C*
     C                     EXSR #BBCA
     C*
     C                     MOVE *BLANKS   @STBLK
     C*
     C           #BBE9     ENDSR                           *** #BBE9 **
     C*****************************************************************
      /TITLE SET 'OUR PAY/REC' 1 & 2 FIELDS FOR CAPS, COLLARS & FLOORS
     C*****************************************************************
     C*                                                               *
     C* #BBCA    - Set up 'our pay/rec' 1 & 2 fields for CAPS,        *
     C*            COLLARS & FLOORS only                              *
     C*                                                               *
     C* CALLS:     ZRATE1 - Converts a rate to display format         *
     C*            *PSSR  - Database error handling sub-routine       *
     C*            #BBAA  - Left-aligns rate field output by ZRATE1   *
     C*                                                               *
     C* CALLED BY: #BBC                                               *
     C*            #BBD                                               *
     C*            #BBE                                               *
     C*                                                               *
     C* FLDS USED:                                                    *   S01194
     C**FLDS*USED**@KCCY****Currency*part*of*key*for*base*rate*file****   S01194
     C*************@KBRC****Base*rate*code*of*key*for*base*rate*file***   S01194
     C*************@KBSRT***Key*to*chain*to*base*rate*file*************   S01194
     C*                     detail' fields in record                  *
     C*            @LJUST - Rate field left-justified for display     *
     C*            @@INPR - Standard sub-routine input rate field     *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BBCA     BEGSR
      *
      ** Blank out fields first
      *
     C                     MOVE *BLANKS   KGOPD1
     C                     MOVE *BLANKS   KGOPD2
     C                     MOVE *BLANKS   KGORD1
     C                     MOVE *BLANKS   KGORD2
      *
      ** If CAP, FLOOR or COLLAR sold then set KGOPD1, KGOPD2
      *
     C           BYSL      IFEQ 'S'                        B1
      *                                                     1
      ** If floor, use their details, otherwise our's       1
      *                                                     1
     C********** DTYP      IFEQ 'RF'                       B*2                              MD060920
      *                                                                   S01194
      * @KCCY redefined here as 3A field, since no longer                 S01194
      * defined in data structure                                         S01194
     C**********           MOVE TCUCY     @KCCY             *2            S01194
     C**********           MOVE TCUCY     @KCCY   3         *2                       S01194 MD060920
      *                                                                   S01194
      * Work field @KBRC redefined as 2A field for call                   S01194
      * to AOBSRTR0                                                       S01194
     C**********           MOVE TBRTT     @KBRC             *2            S01194
     C**********           MOVE TBRTT     @KBRC   2         *2                       S01194 MD060920
     C**********           MOVE TSPIN     @SPIN   1         *2                              MD060920
     C**********           ELSE                            X*2                              MD060920
     C                     MOVE UCUCY     @KCCY             *2            S01194
     C                     MOVE UBRTT     @KBRC             *2
     C                     MOVE USPIN     @SPIN             *2
     C**********           END                             E*2                              MD060920
     C*                                                     1
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '011'     DBASE            *      11     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Call Access Program to get either Their Base Rate shortname       S01194
      * if rate floor, otherwise Our Base Rate shortname                  S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM @KCCY     @CCY    3                       S01194
     C                     PARM @KBRC     @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD1            1             S01194
     C                     MOVELBABSRS    KGOPD1            1             S01194
     C*                                                     1
     C           @SPIN     IFEQ 'A'                        B*2
     C           @SPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGOPD1            *2
     C                     ELSE                            X*2
     C           @SPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGOPD1            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGOPD1            **3
     C                     END                             E**3
     C                     END                             E*2
      *                                                     1
      ** If FLOOR, then use floor rate, otherwise ceiling   1
      *                                                     1
     C           DTYP      IFEQ 'RF'                        B*2
     C                     Z-ADDFLRAT     @@INPR             *2
     C                     ELSE                             X*2
     C                     Z-ADDCLRAT     @@INPR             *2
     C                     END                              E*2
     C*                                                     1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGOPD2            1
      *                                                     1
      ** Otherwise is CAP, FLOOR or COLLAR bought           1
      *                                                     1
     C                     ELSE                            X1
      *                                                     1
      ** If COLLAR then set KGOPD1, KGOPD2                  1
      *                                                     1
     C           DTYP      IFEQ 'RR'                       B*2
     C**********           MOVE TCUCY     @KCCY             *2            S01194
     C**********           MOVE TBRTT     @KBRC             *2            S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     *2            S01194
     C**********                                            *2            S01194
     C********** *IN89     IFEQ '1'                        B**3           S01194
     C********** RECI      ORNE 'D'                         **3           S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '012'     DBASE            *      12     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E**3           S01194
     C*                                                     *2
      * Create temporary 2A field for Their Base Rate Type                S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE TBRTT     @TBRTT  2                       S01194
      * Call Access Program to get Their Base Rate shortname              S01194
      *                                                                   S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM TCUCY     @CUCY   3                       S01194
     C                     PARM @TBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGOPD1            *2            S01194
     C                     MOVELBABSRS    KGOPD1            1             S01194
     C*
     C           TSPIN     IFEQ 'A'                        B*3
     C           TSPIN     OREQ 'P'                         *3
     C                     MOVE '+S '     KGOPD1            *3
     C                     ELSE                            X*3
     C           TSPIN     IFEQ 'S'                        B**4
     C                     MOVE '-S '     KGOPD1            **4
     C                     ELSE                            X**4
     C                     MOVE '   '     KGOPD1            **4
     C                     END                             E**4
     C                     END                             E*3
     C*
     C                     Z-ADDFLRAT     @@INPR            *2
     C                     EXSR ZRATE1                      *2
     C                     EXSR #BBAA                       *2
     C                     MOVE @LJUST    KGOPD2            *2
      *                                                     *2
      ** Otherwise move *blanks for CAP or FLOOR bought     *2
      *                                                     *2
     C                     ELSE                            X*2
     C*                                                     *2
     C                     MOVE *BLANKS   KGOPD1            *2
     C                     MOVE *BLANKS   KGOPD2            *2
     C                     END                             E*2
     C                     END                             E1
      *
      ** If CAP, FLOOR or COLLAR bought then set KGORD1, KGORD2
      *
     C           BYSL      IFEQ 'B'                        B1
      *                                                     1
      ** If floor, then use our details, otherwise their's  1
      *                                                     1
     C********** DTYP      IFEQ 'RF'                       B*2                              MD060920
     C**********           MOVE UCUCY     @KCCY             *2                              MD060920
     C**********           MOVE UBRTT     @KBRC             *2                              MD060920
     C**********           MOVE USPIN     @SPIN             *2                              MD060920
     C**********           ELSE                            X*2                              MD060920
     C                     MOVE TCUCY     @KCCY             *2
     C                     MOVE TBRTT     @KBRC             *2
     C                     MOVE TSPIN     @SPIN             *2
     C**********           END                             E*2                              MD060920
     C*                                                     1
     C********** @KBSRT    CHAINFDBSRTLL             89     1             S01194
     C**********                                            1             S01194
     C********** *IN89     IFEQ '1'                        B*2            S01194
     C********** RECI      ORNE 'D'                         *2            S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '013'     DBASE            *      13     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E*2            S01194
     C*                                                     1
      * Call Access Program to get either Their Base Rate shortname       S01194
      * if rate floor, otherwise Our Base Rate shortname                  S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM @KCCY     @CCY    3                       S01194
     C                     PARM @KBRC     @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD1            1             S01194
     C                     MOVELBABSRS    KGORD1            1             S01194
     C*                                                     1
     C           @SPIN     IFEQ 'A'                        B*2
     C           @SPIN     OREQ 'P'                         *2
     C                     MOVE '+S '     KGORD1            *2
     C                     ELSE                            X*2
     C           @SPIN     IFEQ 'S'                        B**3
     C                     MOVE '-S '     KGORD1            **3
     C                     ELSE                            X**3
     C                     MOVE '   '     KGORD1            **3
     C                     END                             E**3
     C                     END                             E*2
      *                                                     1
      ** If FLOOR then use floor rate, otherwise ceiling    1
      *                                                     1
     C           DTYP      IFEQ 'RF'                        B*2
     C                     Z-ADDFLRAT     @@INPR             *2
     C                     ELSE                             X*2
     C                     Z-ADDCLRAT     @@INPR             *2
     C                     END                              E*2
     C*                                                     1
     C                     EXSR ZRATE1                      1
     C                     EXSR #BBAA                       1
     C                     MOVE @LJUST    KGORD2            1
      *                                                     1
      ** Otherwise is CAP, FLOOR or COLLAR sold             1
      *                                                     1
     C                     ELSE                            X1
      *                                                     1
      ** If COLLAR then set KGORD1, KGORD2                  1
      *                                                     1
     C           DTYP      IFEQ 'RR'                       B*2
     C**********           MOVE UCUCY     @KCCY             *2            S01194
     C**********           MOVE UBRTT     @KBRC             *2            S01194
     C********** @KBSRT    CHAINFDBSRTLL             89     *2            S01194
     C**********                                            *2            S01194
     C********** *IN89     IFEQ '1'                        B**3           S01194
     C********** RECI      ORNE 'D'                         **3           S01194
     C**********           MOVE 'FDBSRTLL'DBFILE           ***************S01194
     C**********           MOVEL@KBSRT    DBKEY            *   DBERROR   *S01194
     C**********           MOVE '014'     DBASE            *      14     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E**3           S01194
     C*                                                     *2
      * Create temporary 2A field for Our Base Rate Type                  S01194
      * for use in call to AOBSRTR0                                       S01194
     C                     MOVE UBRTT     @UBRTT  2                       S01194
      *                                                                   S01194
      * Call Access Program to get Our Base Rate shortname                S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM UCUCY     @CUCY   3                       S01194
     C                     PARM @UBRTT    @BRTT   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C**********           MOVELFSRT      KGORD1            *2            S01194
     C                     MOVELBABSRS    KGORD1            *2            S01194
     C*
     C           USPIN     IFEQ 'A'                        B*3
     C           USPIN     OREQ 'P'                         *3
     C                     MOVE '+S '     KGORD1            *3
     C                     ELSE                            X*3
     C           USPIN     IFEQ 'S'                        B**4
     C                     MOVE '-S '     KGORD1            **4
     C                     ELSE                            X**4
     C                     MOVE '   '     KGORD1            **4
     C                     END                             E**4
     C                     END                             E*3
     C*
     C                     Z-ADDFLRAT     @@INPR            *2
     C                     EXSR ZRATE1                      *2
     C                     EXSR #BBAA                       *2
     C                     MOVE @LJUST    KGORD2            *2
      *                                                     *2
      ** Otherwise move *blanks to KGORD1, KGORD2           *2
      *                                                     *2
     C                     ELSE                            X*2
     C*                                                     *2
     C                     MOVE *BLANKS   KGORD1            *2
     C                     MOVE *BLANKS   KGORD2            *2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BBCA9    ENDSR                           *** #BBCA9 *
     C*****************************************************************
      /TITLE SUB-ROUTINE FOR HANDLING DATABASE ERRORS
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - DATABASE ERROR SUBROUTINE                          *
     C*                                                               *
     C* CALLS    -                                                    *
     C*                                                               *
     C* CALLED IF ANY PROGRAM OR FILE ERRORS                          *
     C*                                                               *
     C* FLDS USED  @BEEN    -  ALREADY BEEN THROUGH *PSSR INDICATOR   *
     C*            @LDA     -  VARIABLE TO SET UP LDA WITH DB ERRORS  *
     C*            DBERR    -  DS TO HOLD DB ERROR                    *
     C*            @TERM    -  TERMINATION PARAMETER RETURNED         *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** IF NOT BEEN ALREADY BEEN THROUGH *PSSR THEN PROCESS ERROR
     C** ELSE JUST RETURN
     C*
     C           @BEEN     IFNE 'Y'                        B1
     C*
     C** SET ALREADY-BEEN-THROUGH-*PSSR INDICATOR TO YES
     C*
     C                     MOVE 'Y'       @BEEN   1        *1
     C*
     C** SET UP TERMINATION PARAMETER, TURN ON ERROR SWITCHES,
     C** SET ON LR AND DUMP
     C*
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     MOVE '1'       *INLR            *1
     C                     DUMP                            *1
     C*
     C** MOVE DATABASE ERROR DETAILS INTO LDA
     C*
     C           *NAMVAR   DEFN LDA       @LDA  256        *1
     C           *LOCK     IN   @LDA                       *1
     C                     MOVELDBERR     @LDA             *1
     C                     OUT  @LDA                       *1
     C*
     C                     END                             E1
     C*
     C                     RETRN
     C*
     C           PSSR9     ENDSR                           *** *PSSR9 ***
     C*****************************************************************
      /TITLE INITIALISATION SUB-ROUTINE
     C*****************************************************************
     C*                                                               *
     C* #A       - Initial sub-routine                                *
     C*                                                               *
     C* CALLS:     *PSSR  - Database error handling sub-routine       *
     C*                                                               *
     C* CALLED BY: Main-line code                                     *
     C*                                                               *
     C* FLDS USED: @TERM  - Termination code parameter                *
     C*            @KIRS  - Key for IRS file                          *
     C*            @PDLNO - Deal no. parameter                        *
     C*            @PCCY  - Currency parameter                        *
     C*************@SREC****Data*structure*sub*field*to*form*part*of***   S01194
     C**********************key*for*ccy*file**set*to**1**permanently***   S01194
     C*************@K10*****Part*of*key**type*identifier**10***********   S01194
     C*************@K20*****Part*of*key**type*identifier**20***********   S01194
     C*************@K21*****Part*of*key**type*identifier**21***********   S01194
     C*            @FIRST - Field to say initial sub-routine has been *
     C*                     called previously in this invocation      *
     C*                                                               *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C                     PARM           @PDLNO  60
     C                     PARM           ACTION  1
     C                     PARM           @PCCY   3
      *
      ** Key to chain to IRS summary file; DLIRSSL0
      *
     C           @KIRS     KLIST
     C                     KFLD           @PDLNO
     C                     KFLD           @PCCY
     C*
     C**********           OPEN FDICDRLL                                  S01194
     C                     OPEN FDMNTHLL
     C**********           OPEN FDBRNCLL                                  S01194
     C**********           OPEN FDCCYTLL                                  S01194
     C**********           OPEN FDBSRTLL                                  S01194
     C                     OPEN DLDLDGLD
     C                     OPEN DLIRSSL0
      *
      ** Initialise the following
      *
     C                     MOVEL'DL1911'  DBPGM
     C*
     C**********           MOVE '1'       @SREC                           S01194
     C*
     C**********           MOVE '01'      @K01                            S01194
     C**********           MOVE '10'      @E10                            S01194
     C**********           MOVE '10'      @K10                            S01194
     C**********           MOVE '20'      @K20                            S01194
     C**********           MOVE '21'      @K21                            S01194
     C*
     C           1         CHAINFDMNTHLL             89
     C*
     C           *IN89     IFEQ '1'                        B1
     C                     MOVEL'FDMNTHLL'DBFILE           ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 015 *
     C                     MOVE '015'     DBASE            *      15     *
     C                     EXSR *PSSR                      ***************
     C                     END                             E1
      *
      ***Chain*to*the*ICDR*for*the*date*format*field****                  S01194
      **********                                                          S01194
     C********** @KICDR    CHAINFDICDRLL             89                   S01194
     C**********                                                          S01194
     C********** *IN89     IFEQ '1'                        B1             S01194
     C**********           MOVEL'FDICDRLL'DBFILE           ***************S01194
     C**********           MOVE *BLANKS   DBKEY            * DBERROR 016 *S01194
     C**********           MOVE '016'     DBASE            *      16     *S01194
     C**********           EXSR *PSSR                      ***************S01194
     C**********           END                             E1             S01194
      *
     C* Call Access prog. for Bank Details.                               S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
      ***Set*indicator*98*for standard sub-routine ZDATE8                 S01117
      *********************                                               S01117
     C***********DATF******IFEQ 'D'                        B1             S01117
     C*********************MOVE '0'       *IN98             1             S01117
     C*********************ELSE                            X1             S01117
     C*********************MOVE '1'       *IN98             1             S01117
     C*********************END                             E1             S01117
      *                                                                   S01117
      *  If American date format is being used then subroutine ZDATE8     S01117
      *  outputs the date in the form MMMDDYY. Although this is correct   S01117
      *  it is inconsistent with Midas, which displays the form DDMMMYY   S01117
      *  regardless of the Date Format Indicator.  Therefore, the         S01117
      *  Date Format Indicator input to this subroutines must be          S01117
      *  over-ridden to ensure expected input and output is in the        S01117
      *  format DDMMMYY regardless.                                       S01117
      *                                                                   S01117
     C                     MOVE '0'       *IN98                           S01117
     C*
     C                     MOVE 'N'       @FIRST  1
     C*
     C                     MOVE *BLANKS   @KCCY   3                                         MD060920
     C                     MOVE *BLANKS   @KBRC   2         *2                              MD060920
     C                     MOVE *BLANK    @SPIN   1         *2                              MD060920
      *                                                                                     MD060920
     C           #A9       ENDSR                           *** #A9 ****
     C*****************************************************************
      /TITLE
**   CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
